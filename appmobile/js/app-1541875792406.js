!function(e){function t(t){for(var i,o,s=t[0],l=t[1],u=t[2],c=0,h=[];c<s.length;c++)o=s[c],n[o]&&h.push(n[o][0]),n[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(d&&d(t);h.length;)h.shift()();return r.push.apply(r,u||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],i=!0,s=1;s<a.length;s++){var l=a[s];0!==n[l]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=a[0]))}return e}var i={},n={0:0},r=[];function o(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.e=function(e){var t=[],a=n[e];if(0!==a)if(a)t.push(a[2]);else{var i=new Promise(function(t,i){a=n[e]=[t,i]});t.push(a[2]=i);var r,s=document.getElementsByTagName("head")[0],l=document.createElement("script");l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.src=function(e){return o.p+""+({1:"delayedUI"}[e]||e)+"-1541875792406.js"}(e),r=function(t){l.onerror=l.onload=null,clearTimeout(u);var a=n[e];if(0!==a){if(a){var i=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src,o=new Error("Loading chunk "+e+" failed.\n("+i+": "+r+")");o.type=i,o.request=r,a[1](o)}n[e]=void 0}};var u=setTimeout(function(){r({type:"timeout",target:l})},12e4);l.onerror=l.onload=r,s.appendChild(l)}return Promise.all(t)},o.m=e,o.c=i,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(a,i,function(t){return e[t]}.bind(null,i));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="js/",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=l;r.push([227,3]),a()}([function(e,t,a){"use strict";a.r(t);var i=a(1);function n(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}function r(){}n.prototype={tokenize:function(){for(var e,t=0,a=[],i=0,n=this.str.length;i<n;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=this.str.charAt(i),this.checkChar(e)}return this.list.forEach(function(e){e.value=(e.value||"").toString().trim(),e.value&&a.push(e)}),a},checkChar:function(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}this.escaped||"\\"!==e?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1):this.escaped=!0}},r.prototype={_handleAddress:function(e){var t,a,i,n,r=0,o=!1,s="text",l=[],u={address:[],comment:[],group:[],text:[]};for(i=0,n=e.length;i<n;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if("operator"===(t=e[i]).type)switch(t.value){case"<":s="address";break;case"(":s="comment";break;case":":s="group",o=!0;break;default:s="text"}else t.value&&("address"===s&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),u[s].push(t.value))}if(!u.text.length&&u.comment.length&&(u.text=u.comment,u.comment=[]),o)u.text=u.text.join(" "),l.push({name:u.text||a&&a.name,group:u.group.length?this.parse(u.group.join(",")):[]});else{if(!u.address.length&&u.text.length){var d=0;for(i=u.text.length-1;i>=0;i--){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(u.text[i].match(/^[^@\s]+@[^@\s]+$/)){u.address=u.text.splice(i,1);break}}var c=function(e){return u.address.length?e:(u.address=[e.trim()]," ")};if(!u.address.length){var h=0;for(i=u.text.length-1;i>=0;i--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(u.text[i]=u.text[i].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,c).trim(),u.address.length)break}}}if(!u.text.length&&u.comment.length&&(u.text=u.comment,u.comment=[]),u.address.length>1&&(u.text=u.text.concat(u.address.splice(1))),u.text=u.text.join(" "),u.address=u.address.join(" "),!u.address&&o)return[];(a={address:u.address||u.text||"",name:u.text||u.address||""}).address===a.name&&((a.address||"").match(/@/)?a.name="":a.address=""),l.push(a)}return l},parse:function(e){var t=this,a=0,i=new n(e).tokenize(),r=[],o=[],s=[];i.forEach(function(e){"operator"!==e.type||","!==e.value&&";"!==e.value?o.push(e):(o.length&&r.push(o),o=[])}),o.length&&r.push(o),r.forEach(function(e){var a=t._handleAddress(e);a.length&&(s=s.concat(a))});for(var l=[],u=0;u<s.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;l.push({type:"contact",text:s[u].name||s[u].address,email:s[u].address})}return l}};var o=new r,s=a(2),l=a(64);a(299);function u(e){return(u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var d={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};if("function"!==typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(e){return h.Assert(h.isArray(e),"Must only supply array to pushArray"),this.push.apply(this,e)}),"function"!==typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(e){return h.Assert(h.isArray(e),"Must only supply array to removeArray"),this.filter(function(t){return!e||e.indexOf(t)<0})}),"function"!==typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(e){return this.splice(e,1)[0]}),"function"!==typeof Array.prototype.remove&&(Array.prototype.remove=function(e,t){var a=this.indexOf(e,t);return a>=0&&this.removeAt.call(this,a),a}),"function"!==typeof Array.prototype.equals){var c=function(e,t){return e&&t&&"object"===u(e)&&"object"===u(t)?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(a,i){return a&&e[i]===t[i]},!0):e===t};Array.prototype.equals=function(e){var t=0;if(!e)return!1;if(this.length!==e.length)return!1;for(var a=0,i=this.length;a<i;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this[a]instanceof Array&&e[a]instanceof Array){if(!this[a].equals(e[a]))return!1}else if(this[a]!==e[a]&&!c(this[a],e[a]))return!1}return!0}}"function"!==typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(e,t){var a=0;for(var i=0;i<this.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this[i][e]===t)return i}return-1}),"function"!==typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(e,t){var a=0;h.Assert(void 0!==e&&null!==e,"Require a valid element to insert"),h.Assert(t,"Require a valid comparison function");for(var i=0,n=this.length-1;i<=n;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i+n>>1,o=t(this[r],e);if(o<0)i=r+1;else{if(!(o>0))return r;n=r-1}}return i}),"function"!==typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(e,t){var a=this.findInsertIndex(e,t);if(0===t(this[a],e))return this[a]}),"function"!==typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(e,t){var a=this.findInsertIndex(e,t);return this.splice.apply(this,[a,0,e]),a}),"function"!==typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(e,t){var a=0;if(!e)return this;for(var i=0,n=e.length;i<n;++i){var r=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var o=!0,s=0,l=this.length;s<l;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t&&t(e[i],this[s])||!t&&e[i]===this[s]){o=!1;break}}o&&this.push(e[i])}return this});var h={LogLevel:i.a.LogLevels.Error|i.a.LogLevels.Warning,noLocalWrites:!1,noLocalWritesReason:"",totalItems:0,totalArchivedItems:0,totalArchivedParents:0,totalPanes:0,tempIndex:0,__FULL_NOTIFICATION_UPDATES:0,__SINGLE_NOTIFICATION_UPDATES:0,TEMP_PREFIX:"~T^",_itemAnimationMode:void 0,fnRegex:/function\s+([^(]*?)\s*\(([^)]*)\)/,supportSimpleStack:!0,__LOG_BUFFER:new l.a(s.a.isMobile?30:50),isLoaded:!1,aggregateEvents:{},anonID:void 0,defaultSeed:129831293,_isInCompleteAction:!1,timeouts:{},Assert:function(){},reportError:function(e,t,a,i){console.log(e),console.log(t)},isFlagSet:function(e,t){return(e&t)===t},isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isString:function(e){return"string"===typeof e},isObject:function(e){return"object"===u(e)&&null!==e&&!this.isArray(e)},isNumber:function(e){return"number"===typeof e&&!isNaN(e)},isBoolean:function(e){return!0===e||!1===e},isAnything:function(){return!0},clone:function(e,t){var a;if(this.isArray(e))return this.cloneDeep(e);if(t)for(var i in a={},e)e.hasOwnProperty(i)&&(t&&void 0===e[i]||(a[i]=e[i]));else a=Object.assign({},e);return a},cloneWithoutUndefineds:function(e){return this.clone(e,!0)},cloneDeep:function(e){return JSON.parse(JSON.stringify(e))},arrayDifference:function(e,t){for(var a=0,i=[],n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t[e[n]]||i.push(e[n])}return i},emptyFn:function(){},newEmptyFn:function(){return function(){}},weeks:function(e){return 6048e5*e},days:function(e){return 864e5*e},hours:function(e){return 36e5*e},minutes:function(e){return 6e4*e},seconds:function(e){return 1e3*e},parseInt:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return parseInt(e,10)}),shouldLog:function(e){return(this.LogLevel&e)===e},shouldWriteLocal:function(){return!this.noLocalWrites},isLocalWriteReason:function(e){return this.noLocalWritesReason===e},isValidChangeType:function(e){if(void 0!==e&&null!==e){var t=e&~i.a.ChangeType.All;if(this.inMaskOnly(e,i.a.ChangeType.Valid))return(t&i.a.ChangeType.Locations)===i.a.ChangeType.None||this.isOneFlagSet(t,i.a.ChangeType.Local|i.a.ChangeType.Remote|i.a.ChangeType.Auto)}return!1},isRemoteChange:function(e){this.Assert(this.isValidChangeType(e),"Must supply a valid changeType");var t=e&~i.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,i.a.ChangeType.Remote)},isUndoRedoChange:function(e){this.Assert(this.isValidChangeType(e),"Must supply a valid changeType");var t=e&~i.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,i.a.ChangeType.UndoRedo)},isLocalChange:function(e){this.Assert(this.isValidChangeType(e),"Must supply a valid changeType");var t=e&~i.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,i.a.ChangeType.Local)},isAutoChange:function(e){this.Assert(this.isValidChangeType(e),"Must supply a valid changeType");var t=e&~i.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,i.a.ChangeType.Auto)},inMaskOnly:function(e,t){return 0===(~t&e)},isOneFlagSet:function(e,t){var a=e&t;return 0!==a&&0===(a&a-1)},isAtLeastOneFlagSet:function(e,t){return 0!==(e&t)},forEachFlagSet:function(e,t){for(var a=0;0!==e;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t(Math.abs(e&-e)),e&=e-1}},generateTempId:function(){return this.TEMP_PREFIX+Date.now()+ ++this.tempIndex},toLowerCase:function(e){return e.toLowerCase()},numberComparator:function(e,t){return e-t},insertIntoText:function(e,t,a){return this.Assert(a<=e.length),e.substr(0,a)+t+e.substr(a,e.length-a)},arrayUnion:function(e,t){for(var a=0,i=0,n=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n.indexOf(e[r])<0&&n.push(e[r])}for(r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n.indexOf(t[r])<0&&n.push(t[r])}return n},arrayDiff:function(e,t){for(var a=0,i=0,n=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(e[r])<0&&n.push(e[r])}for(r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.indexOf(t[r])<0&&n.push(t[r])}return n},arrayIntersection:function(e,t){for(var a=0,i=[],n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(e[n])>=0&&i.push(e[n])}return i},arrayUniques:function(e,t){e=e||[];var a=[];if(t)for(var i=0,n=0;n<e.length;++n){var r=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o=!0,s=e[n],l=0;l<a.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t(s,a[l])){o=!1;break}}o&&a.push(s)}else for(var u=0,d=0,c=e.length;d<c;d++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;a.indexOf(e[d])<0&&a.push(e[d])}return a},areObjectsEqual:function(e,t){return(void 0!==e&&void 0!==t||e===t)&&JSON.stringify(e,Object.keys(e).sort())===JSON.stringify(t,Object.keys(t).sort())},extend:function(e,t){if(t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},classNames:function(){for(var e=0,t=arguments,a=[],i=0;i<t.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t[i];if(n)if(this.isString(n)||this.isNumber(n))a.push(n);else if("object"===u(n))for(var r in n)n.hasOwnProperty(r)&&n[r]&&a.push(r)}return a.join(" ")},getDefaultItemText:function(e){return(e=e||a(3).default.settings.defaultItemPrefix())?e+" ":""},isPrefixTask:function(e){return e&&(e===i.a.Prefix.Task||e===i.a.Prefix.Task2||e===i.a.Prefix.Task3||e===i.a.Prefix.Task4||e===i.a.Prefix.Task5||e===i.a.Prefix.Task6||e===i.a.Prefix.Task7||e===i.a.Prefix.Task8)},escape:function(e){return String(e).replace(/[&\"<>]/g,function(e){return d[e]})},unescape:function(e){return String(e).replace(/&lt;|&gt;|&amp;|&quot;/g,function(e){for(var t in d)if(d.hasOwnProperty(t)&&d[t]===e)return t;return this.Assert(!1,"Should have found a character to replace"),e})},escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},stripTagsBasic:function(e){return e.replace(/<.*>/g,"")},stripFormattingTags:function(e){return e.replace(/<\/?[biu]>/g,"")},invertObject:function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[e[a]]=a);return t},filterWithNonMatches:function(e,t){for(var a=0,i={match:[],fail:[]},n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n];t(r)?i.match.push(r):i.fail.push(r)}return i},isUrlImage:function(e){return(e=e.toLowerCase()).endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".gif")},isDateSoft:function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1},isDateValid:function(e){return e&&e instanceof Date&&!isNaN(e.getTime())},getItemAnimationMode:function(){return this._itemAnimationMode},setItemAnimationMode:function(e){this._itemAnimationMode=e},resetItemAnimationMode:function(){this._itemAnimationMode=i.a.ItemAnimationMode.Normal},parseEmailAddresses:function(e){return o.parse(e)},isTempId:function(e){return e&&e[0]===this.TEMP_PREFIX[0]&&e[1]===this.TEMP_PREFIX[1]&&e[2]===this.TEMP_PREFIX[2]},isLocalItem:function(e){return this.Assert(e.id,"All items should have an ID even if it is a temp one"),this.isTempId(e.id)},getCurrentStack:function(e){var t;if(this.supportSimpleStack)try{t=JSON.stringify(e)}catch(a){h.log("Error stringifying stack message",a,e)}if(this.supportSimpleStack){var a=new Error(t||e);if(a.stack)return a.stack}this.supportSimpleStack=!1;try{for(var i=0,n=["GenError: "+(t||e)],r=arguments.callee.caller,o=0;r&&o++<75;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s,l=r.toString(),u=this.fnRegex.exec(l);s=u&&3===u.length&&""!==u[1]&&void 0!==u[1]?"at "+u[1]+"("+u[2].replace(/[\r\n]/g,"")+")":u&&3===u.length?"at <anonymous> ("+u[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",n.push(s),r=r.caller}return n.join("\n")}catch(d){h.log("Error generating stack trace",d)}return""},isVMLI:function(e){return e&&e.__ISVMLI},isPane:function(e){return e&&e.__ISPANE},log:function(){for(var e=0,t=arguments.length,a=new Array(t),i=0;i<t;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[i]=arguments[i]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(n){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(r){console.log("Error adding to __LOG_BUFFER: ",arguments)}}console.log.apply(console,arguments)},registerEvent:function(e,t,a){this.Assert(!this.aggregateEvents.hasOwnProperty(e),"Should only register an event once"),this.Assert(void 0!==e,"Must specify a name for the event"),this.Assert(void 0!==t,"Must specify a category for the event"),this.Assert(void 0!==a,"Must specify an action for the event");var i={category:t,action:a,label:this.getAnonUserIdentifier(),count:0};this.aggregateEvents[e]=i},aggregateEvent:function(e,t){this.Assert(this.aggregateEvents.hasOwnProperty(e),"Must register an event before using it"),void 0===t&&(t=1),this.aggregateEvents[e]&&(this.aggregateEvents[e].count+=t)},UIAction:function(e){this.sendEvent("UIAction",e)},getAggregateEvents:function(){return this.aggregateEvents},getAnonUserIdentifier:function(){if(!this.anonID){var e=this.getUserIdentifier();this.anonID=e?e[0]+e[1]+e[2]+this.murmurhash3_32_gc(e,17124123):"loggedout"}return this.anonID},murmurhash3_32_gc:function(e,t){var a,i,n,r,o,s,l,u,d=0;for(a=3&e.length,i=e.length-a,n=t,o=3432918353,s=461845907,u=0;u<i;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,n=27492+(65535&(r=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16)}switch(l=0,a){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0},hashString:function(e){return this.Assert(this.isString(e),"Must always be passing a string to hash"),this.murmurhash3_32_gc(e,this.defaultSeed)},getUserIdentifier:function(){return this.isDemoMode()?"demouser":this.getSettings().activeUser.get()},beginCompleteAction:function(){this._isInCompleteAction=!0},isInCompleteAction:function(){return this._isInCompleteAction},endCompleteAction:function(){this._isInCompleteAction=!1},getObjectInfo:function(e){try{if(e&&e.constructor)return e.constructor.name}catch(t){this.reportError(t)}return u(e)},getSettings:function(){return a(3).default.settings},hasTimeoutOnce:function(e){return!!this.timeouts[e]},timeoutOnce:function(e,t,a,i,n,r,o,s){var l=this;this.Assert(e,"Must supply a valid name"),this.Assert(this.isFunction(t),"must supply a valid cb fn"),this.Assert(arguments.length<=8,"Too many args passed in");var u=this.timeouts[e];u&&clearTimeout(u),this.timeouts[e]=setTimeout(function(){delete l.timeouts[e],t(i,n,r,o,s)},a)},clearTimeoutOnce:function(e){var t=this.timeouts[e];t&&(clearTimeout(t),delete this.timeouts[e])},sendEvent:function(e,t,a){}},f=h,p=a(11),g=(a(18),a(7)),m=a(51),v=a.n(m),y=(a(14),a(224));function _(e){return(_="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.default=function(){var e={vmMain:void 0,isShowingLogin:new g.a(!1),topBarHeight:s.a.android?56:44,archivedPadding:34,itemTransitionTime:100,iOSDragTime:400,iOSDragTimeKeyboardOpen:200,scrollbarWidth:12,hasFocus:!0,zoomTime:0,demoMode:!1,intro:void 0,focusedPane:void 0,focusedItem:void 0,ClickThreshold:5,isFirstRun:!1,isReconnected:!1,isBlocked:!1,blockedMessage:"",authImmediateFailed:!1,authUserLoggedIn:!1,noLocalWrites:!1,noLocalWritesReason:i.a.LocalWriteReason.Enabled,isLoadingRemote:!1,isSendingEmail:!1,isSavingDrafts:!1,isKeyboardOpen:!1,itemMenuOpenedOn:void 0,errorPlatformInfo:void 0,nativeBacklog:[],nativeBridge:{sendToApp:function(t,a){e.nativeBacklog.push({method:t,data:a})}},elements:{},SPThresholdLeft:8,SPThresholdRight:42,MobileSideTapThreshold:40,MobileSideTapThresholdKeyboardOpen:15,colorBlue:"#09d",colorLightBlue:"#02b1ff",colorRed:"#d43",colorLightRed:"#f34433",MinItemWidth:50};p.a.extend(e,f,!0),e.paneTop=s.a.isMobile?e.topBarHeight:s.a.app?20:0,e.wasAppCacheUpdated=!1;var t,n=!1;e.setAppCacheUpdateState=function(t){n=t,t&&(e.wasAppCacheUpdated=!0)},e.reload=function(t){e.Assert(!n,"Page should not be reloaded while waiting for an appcache update to finish."),n&&e.reportError(new Error("Page requesting reload while waiting for AppCache update.")),window.location.reload(t)},e.isEmail=function(e){var t=!1;return e&&(t=!!new RegExp(/\S+@\S+\.\S+/i).exec(e))&&(t=e.indexOf('"')<0),t},e.parseTokensFromText=function(e){for(var t,a=0,i=[],n=/(?:(?:[\"]([^\"<>]*)[\"]\s))|(?:([^\",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,r=0;null!==(t=n.exec(e));){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e.substring(r,t.index),s=t[1]||t[2],l=t[3]||t[5];r=n.lastIndex,o&&o.trim().length>0&&i.push({text:o,type:"text"}),i.push({text:s||l,email:l,type:"contact"})}var u=e.substring(r,e.length);return u&&u.length>0&&i.push({text:u,type:"text"}),i},e.isWhiteSpace=function(e){return/^\s*$/.test(e)},e.isRunningScript=function(){return e.AScript&&e.AScript.isRunning},e.preventLocalWrites=function(t){window.__IS_AUTOMATED_TEST||(e.Assert(!e.noLocalWrites,"Should only disable local writes once"),e.Assert(t>=0,"Must provide a valid reason for disabling local writes"),e.isDemoMode()||e.shouldLog(i.a.LogLevels.Warning)&&e.log("---- WARNING: Local Writes Disabled ----")),e.noLocalWrites=!0,e.noLocalWritesReason=t},e.enableDemoMode=function(){e.demoMode=!0;var t=p.a.getURLParam("dmode");t&&e.enableMinMode(t),e.preventLocalWrites(i.a.LocalWriteReason.DemoMode)},e.isDemoMode=function(){return e.demoMode},e.activeDisplayMode=i.a.DisplayMode.Default,e.isDisplayModeActive=function(t){return(e.activeDisplayMode&t)===t},e.isDemoInIframe=function(){return this.isDisplayModeActive(i.a.DisplayMode.InIframe)},e.enableMinMode=function(t){try{if(e.addClass(document.body,"minMode"),e.isMinMode=!0,t=e.parseInt(t),s.a.touch||(t&i.a.DisplayMode.InIframe&&e.addClass(document.documentElement,"inIframe"),t&i.a.DisplayMode.Invisible&&e.addClass(document.documentElement,"invisible"),t&i.a.DisplayMode.NoPaneHeaders&&e.addClass(document.body,"noPaneHeaders"),t&i.a.DisplayMode.NoMinPaneSize&&(e.minPaneWidth=0),t&i.a.DisplayMode.NoPaneStyle&&e.addClass(document.body,"noPaneStyle")),t&i.a.DisplayMode.NoPanePadding&&(e.addClass(document.body,"noPanePadding"),e.noPanePadding=!0),t&i.a.DisplayMode.NoScrollbars&&(e.noScrollbars=!0),t&i.a.DisplayMode.NoBackground&&e.addClass(document.documentElement,"noBackground"),t&i.a.DisplayMode.NoInteraction){var a=document.getElementById("outerWrapper"),n=document.createElement("div");n.id="preventInteraction",a.appendChild(n),t&i.a.DisplayMode.PromptStart&&e.setupClick(n,n,function(){var t=e.toasts.getMessageById(i.a.MessageID.PromptScriptStart);t&&(t.doAction(),t.hide())})}t&i.a.DisplayMode.ShowDemoExit&&setTimeout(function(){e.toasts.pushMessage(i.a.MessageID.ExitDemo)},0),t&i.a.DisplayMode.PromptStart&&setTimeout(function(){e.toasts.pushMessage(i.a.MessageID.PromptScriptStart)},0),e.activeDisplayMode=t}catch(r){e.reportError(r)}},e.setDimension=function(t,a){window.ga&&!e.isDemoMode()&&ga("set",t,a)},f.sendEvent=e.sendEvent=function(t,a,i){if(e.Assert(void 0===i||e.isNumber(i),"Values must be numeric"),window.ga&&!e.isDemoMode())try{ga("send","event",t,a,e.getAnonUserIdentifier(),i)}catch(n){e.reportError(n,"Category: "+t+" Action: "+a+" Value: "+i)}},e.sendTimeEvent=function(t,a,i){if(e.Assert(e.isNumber(i),"Values must be numeric"),window.ga&&!e.isDemoMode())try{ga("send","timing",t,a,i,e.getAnonUserIdentifier())}catch(n){e.reportError(n,"Category: "+t+" Variable: "+a+" Value: "+i)}},e.startTimeEvent=function(a,i){window.log&&window.log.now&&(e.Assert(void 0===t,"This function needs to be updated to allow nested timing events"),t={startTime:log.now(),category:a,variable:i})},e.endTimeEvent=function(){if(window.log&&window.log.now&&(e.Assert(void 0!==t,"Must have started a timing event"),t)){var a=log.now()-t.startTime;e.sendTimeEvent(t.category,t.variable,a),t=void 0}};var r=976910954,o=0x6bf609b2d12c;e.reportAdConversion=function(t,a){try{!function(e,t){var a=new Image(1,1),i="//www.googleadservices.com/pagead/conversion/"+r+"/?label="+e+"&guid=ON";t&&(i+="&value="+t+"&currency_code=USD"),a.src=i}(t,a)}catch(i){e.reportError(i)}try{!function(){var e=new Image(1,1),t="//www.facebook.com/tr?id="+o+"&ev=PageView";e.src=t}()}catch(i){e.reportError(i)}};var u=!1;function d(e){switch(e){case i.a.KeyCode.Backspace:return"BACKSPACE";case i.a.KeyCode.Delete:return"DELETE";case i.a.KeyCode.Enter:return"ENTER";case i.a.KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}e.pageDataCleared=function(){u=!0},e.hasPageDataBeenCleared=function(){return u},"function"!==typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}):String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!==typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(e,t){for(var a=0,i=-1,n=t-1;n>=0;--n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this[n]===e){i=n;break}}return i}),"function"!==typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}),e.findFirstDiff=function(e,t,a,i){var n=0;if(!e)return i?0:t.length;if(!t)return i?e.length:0;for(var r=Math.min(e.length,t.length),o=0;o<r;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(a){if(e.charAt(o).toLowerCase()!==t.charAt(o).toLowerCase())return o}else if(e.charAt(o)!==t.charAt(o))return o}return i?e.length:t.length},e.lerp=function(e,t,a){return e+(t-e)*a},e.hashCode=function(e){var t,a=0,i=0;if(0===e.length)return i;for(t=0;t<e.length;t++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=(i<<5)-i+e.charCodeAt(t),i|=0}return i},e.sanitizePaneState=function(e){try{for(var t=0,a=JSON.parse(JSON.stringify(e)),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;""!==a[i].search&&(a[i].search="HasSearch")}return JSON.stringify(a)}catch(n){return"Failed to sanitize pane state"}},e.sanitizeLocalSettings=function(e){try{var t=JSON.parse(e);return delete t.values.Default.paneState,delete t.values.Default.localPaneState,delete t.values.Default.gdocTitle,t}catch(a){return"Failed to parse settings"}},e.sanitizeURL=function(e){return e.replace(/&?access_token=[^&]*/g,"")},e.getLoadedScripts=function(e){try{for(var t=0,a=document.getElementsByTagName("script"),i=[],n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[n];r.src&&i.push(r.src)}e.loadedScripts=i}catch(o){e.loadedScripts="ERROR: "+o.message}},e.reportSignup=function(t,a,n){e.Assert(t,"Must specify a valid email address to signup with"),e.Assert(a,"Must provide valid signup info in addition to an email address"),t&&a&&(e.sendEvent("Subscribe","NewUser"),a.email=t,function(e){e.platformConfig=s.a.getUserPlatformConfig()}(a),e.XHR_PrivateAPI({type:"POST",path:"/tracking/signup",data:a,requireAuth:!0,cb:function(t){200!==t.status?(e.shouldLog(i.a.LogLevels.Error)&&e.log("Failed to report signup",t.responseText,t),n&&n(!1)):n&&n(!0)}}),e.reportAdConversion(i.a.ConversionID.Signup))};var c=!1;e.criticalErrorReported=function(){return c},e.handleCriticalError=function(){c=!0;try{if(e.isDemoMode())e.reload();else{var t=document.createElement("div");t.id="criticalError",t.textContent="There was a critical error while loading the app, "+s.a.actionVerb()+" to reload.",s.a.isTouchDevice?t.addEventListener(s.a.touchStartEvent,function(){e.reload()},!0):t.addEventListener(s.a.upEvent,function(){e.reload()},!0),e.prependChild(document.body,t);var a=document.getElementById("outerWrapper");e.Assert(a,"DOM Element must exist to remove it"),a&&a.parentNode.removeChild(a)}}catch(i){e.reportError(i)}},e.safeStringify=function(e){try{return JSON.stringify(e)}catch(t){}},e.reportEvent=function(t){if(!e.isDemoMode()){var a=e.parseExtra(t);a&&e.eventStream.push(a)}},e.getEventStream=function(){return e.eventStream.ordered()},e.parseExtra=function(t){var a;if(t)try{var i;if(t instanceof window.KeyboardEvent){var n=e.elementToString(t.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(n)<0&&(i={type:t.type,currentTarget:e.elementToString(t.currentTarget),target:n,keyCode:d(t.keyCode),normCode:d(t.normCode),ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,tstamp:Date.now()})}else if(t instanceof window.MouseEvent)i={type:t.type,currentTarget:e.elementToString(t.currentTarget),relatedTarget:e.elementToString(t.relatedTarget),target:e.elementToString(t.target),clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,which:t.which,button:t.button,tstamp:Date.now()};else if(window.TouchEvent&&t instanceof window.TouchEvent){i={type:t.type,currentTarget:e.elementToString(t.currentTarget),relatedTarget:e.elementToString(t.relatedTarget),target:e.elementToString(t.target),tstamp:Date.now()};var r=t.touches[0];r&&(i.clientX=r.clientX,i.clientY=r.clientY)}else if(window.PointerEvent&&t instanceof window.PointerEvent)i={type:t.type,currentTarget:e.elementToString(t.currentTarget),relatedTarget:e.elementToString(t.relatedTarget),target:e.elementToString(t.target),clientX:t.clientX,clientY:t.clientY,tstamp:Date.now()};else if(t instanceof window.Event)i={type:t.type,name:t.name,code:t.code,message:t.message,currentTarget:e.elementToString(t.currentTarget),relatedTarget:e.elementToString(t.relatedTarget),target:e.elementToString(t.target),tstamp:Date.now()};else if(t instanceof window.Selection)if(0===t.rangeCount)i={rangeCount:0};else{var o=t.getRangeAt(0),s=o.startContainer,l=!1,u=o.endContainer,c=!1;s.nodeType===Node.TEXT_NODE&&(s=s.parentNode,l=!0),u.nodeType===Node.TEXT_NODE&&(u=u.parentNode,c=!0),i={rangeCount:t.rangeCount,startContainer:e.getElementPath(s),startWasTextNode:l,startOffset:o.startOffset,endContainer:e.getElementPath(u),endWasTextNode:c,endOffset:o.endOffset}}else i=t;a=i?e.safeStringify(i):void 0}catch(h){e.log("Error parsing extra "+h.message)}return a};var h=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"];e.rollbarIgnoreFn=function(e,t,a){return!!(a&&a.body&&a.body.trace&&a.body.trace.frames&&a.body.trace.frames[0]&&h.indexOf(a.body.trace.frames[0].filename)>=0)};var m=0,b=!1,k=!1,w={};e.handleJSError=function(t,a,n,r,o){if(r||window.__error("JS Error: "+t,"  Stack: ",a,"  Extra: ",n),t||a){o||(o=i.a.LogLevels.Error);try{var s=w[a];if(!s||s<Date.now()-5e3){var l=e.__LOG_BUFFER.ordered().join("\r\n"),u=e.getUserIdentifier();k||("me"!==u&&(k=!0),Rollbar.configure({payload:{person:{id:u}},maxItems:i.a.__MAX_ERRORS_REPORTED,checkIgnore:e.rollbarIgnoreFn}));var d=e.parseExtra(n);if(++m<=i.a.__MAX_ERRORS_REPORTED){var c={};if(!b){if(b=!0,e.vmMain)try{e.vmMain.getAppInfo(c)}catch(p){Rollbar.error(p)}b=!1}c.numReported=m;var h={url:e.sanitizeURL(window.location.href),logs:l,info:c,user:u,extra:d,jsVersion:i.a.__jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"};if(window.Rollbar){var f={message:t,stack:a};o===i.a.LogLevels.Error?(Rollbar.error(f,h),e.sendEvent("ErrorReport","Error")):o===i.a.LogLevels.Warning?(Rollbar.warning(f,h),e.sendEvent("ErrorReport","Warning")):(Rollbar.error(f,h),e.sendEvent("ErrorReport","Unknown"))}else h.msg=t,h.stack=a,e.XHR_PrivateAPI({type:"POST",path:"/feedback/error",data:h,cb:function(t){200!==t.status?e.log("Failed to report remote error",t.responseText,t):e.log("Reported Remote Error: ",t.responseText)}})}}w[a]=Date.now()}catch(g){e.log("Badness happened reporting errors to server: ",g);try{Rollbar.error({message:t,stack:a}),Rollbar.error(g)}catch(v){e.log("More badness happened reporting errors to rollbar: ",v)}}}},window.onerror=function(t,a,i,n,r){r?(e.log("Reported Global OnError: "+t+" Script: "+a+" Line: "+i+" Column: "+n),e.reportError(r)):(e.log("Unreported Global OnError: "+t+" Script: "+a+" Line: "+i+" Column: "+n),e.reportError(t))},f.reportError=e.reportError=function(t,a,i,n){!t||a||t.message||t.stack?t&&t.e&&e.isString(t.e)&&(t={message:t.e,stack:e.getCurrentStack("")}):(a=t,t=void 0),t||(t={message:"Undefined error passed to reporter",stack:e.getCurrentStack("")}),e.handleJSError((n||"")+t.message,t.stack,a,!1,i)},e.checkpoint=function(e){window.__checkpoints|=e};var S=0;function I(t,a){return function(){try{return t.apply(this,arguments)}catch(i){e.reportError(i),a&&a(i)}}}function D(t){return e.Assert(t,"Must specify a callback"),function(){try{if(t)return t.apply(void 0,arguments)}catch(a){e.reportError(a,arguments)}}}function C(e,t,a){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onreadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())},a&&(e.onerror=a)}e.checkForRemoteChanges=function(){var t=Date.now();if(S-t>=12e5)try{e.AppCache&&e.AppCache.checkForUpdate()}catch(a){e.reportError(a)}finally{S=t}},e.protectFn=I,function(){var e=function(e){var t=window[e];window[e]=function(){var e=Array.prototype.slice.call(arguments),a=e[0];return"function"===typeof a&&(e[0]=I(a)),t.apply?t.apply(this,e):t(e[0],e[1])}};e("setTimeout"),e("setInterval")}(),function(){try{window.console.error=function(){try{var t=arguments[0],a=arguments[1];2===arguments.length&&e.isString(t)&&e.isString(a)?e.reportError({message:t,stack:a}):window.__error.apply(window,arguments)}catch(i){window.__error.apply(window,arguments),e.reportError(i)}}}catch(t){e.reportError(t),e.log("Unable to override console.error")}}(),e.packedFnToString=function(e){for(var t=0,a="",i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a+=e[i]+"."}return a},e.unpackFn=function(t,a){e.Assert(e.isFunction(t)||e.isArray(t),"Must supply either a valid function or packed function");var i=NaN;if(e.isFunction(t))i=t;else if(t)try{var n=0;i=a||window;for(var r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e.Assert(e.isString(t[r]),"Packed fns must only contain strings: "+r),e.Assert(i,"Must be able to unpack each step in object chain: "+t[r]+" in "+e.packedFnToString(t)),!i){i=NaN;break}i=i[t[r]]}}catch(o){e.reportError(o),i=NaN}return i},e.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.isString=function(e){return"string"===typeof e},e.isObject=function(t){return"object"===_(t)&&null!==t&&!e.isArray(t)},e.isNumber=function(e){return"number"===typeof e&&!isNaN(e)},e.isBoolean=function(e){return!0===e||!1===e},e.isAnything=function(){return!0},e.isValidColor=function(t){return e.isString(t)&&null!==/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.exec(t)},e.parseBoolean=function(e){return!0===e||"true"===e},e.parseDate=function(t){var a=new Date(t);return e.isDateValid(a)?a:void 0},e.isDOMNode=function(e){return window.HTMLElement?e instanceof HTMLElement:e&&e.tagName&&e.nodeType===Node.ELEMENT_NODE},e.isTextNode=function(e){return e&&e.nodeType===Node.TEXT_NODE},e.ensureDOMNode=function(t){var a;return e.isDOMNode(t)?a=t:e.isTextNode(t)&&(a=t.parentElement),a},e.enumToString=function(e,t){for(var a in e)if(e[a]===t)return a;return null},e.elementToString=function(e,t){if(e){var a=e.nodeName;return e.id&&(a+="#"+e.id),e.className&&(a+="."+e.className.replace(/ /g,".")),t&&e.innerText&&(a+=":"+e.innerText.length),a}return"UNDEFINED"},e.getElementPath=function(t,a){var i=!0,n="";try{for(var r=0;t&&"container"!==t.id&&t!==document.documentElement&&t!==document.body;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n+=i?e.elementToString(t,a)+" ":e.elementToString(t)+" ",i=!1,t=t.nodeType===Node.TEXT_NODE?t.parentNode:t.parentElement}}catch(o){n+=o.message}return n},e.setupClick=function(t,a,n){e.Assert(t,"Expecting an object to bind the click handlers to."),e.Assert(a,"Must specify a valid owner for click handlers"),e.shouldLog(i.a.LogLevels.Input)&&e.log("SetupClick: "+e.elementToString(t)),a||(a=t);var r=!1;function o(t,i){return e.Assert(!a.isDestroyed||!a.isDestroyed()||"onMove"===t||"onEnd"===t,"Owner must not be destroyed to handle a click"),n[t].call(a,i)}function l(t){e.shouldLog(i.a.LogLevels.Input)&&e.log("Move: ",t.id);var a=t.eventX-this.lastX,r=t.eventY-this.lastY;if(0!==a||0!==r){var s=!this.moved;this.lastX=t.eventX,this.lastY=t.eventY,t.distanceX=this.distanceX=this.distanceX+Math.abs(a),t.distanceY=this.distanceY=this.distanceY+Math.abs(r),(this.moved||t.distanceX>e.ClickThreshold||t.distanceY>e.ClickThreshold)&&(this.moved=!0,t.moved=this.moved),(n.onMove||n.onFirstMove)&&(t.diffX=t.eventX-this.startX,t.diffY=t.eventY-this.startY,t.xThisFrame=a,t.yThisFrame=r,t.startX=this.startX,t.startY=this.startY,t.startClientX=this.startClientX,t.startClientY=this.startClientY,t.startSrc=this.startSrc,s&&n.onFirstMove&&o("onFirstMove",t),n.onMove&&o("onMove",t)&&t.stopImmediatePropagation())}}function u(a){e.shouldLog(i.a.LogLevels.Input)&&e.log("End: ",a.id,e.elementToString(a.target),e.elementToString(t));var r=Date.now(),l=this.lastTouch||r,u=Math.max(0,r-l);this.numClicks?this.numClicks++:this.numClicks=1,a.moved=this.moved,a.timeDelta=u,a.diffX=this.lastX-this.startX,a.diffY=this.lastY-this.startY,a.startX=this.startX,a.startY=this.startY,a.startSrc=this.startSrc,this.startSrc=void 0,u<i.a.DoubleClickTime&&u>0&&n.onDoubleClick&&!this.moved&&o("onDoubleClick",a),isNaN(a.button)||a.button===i.a.ButtonCode.Left?(this.lastTouch=r,!n.onClick||this.moved||s.a.mac&&a.ctrlKey||o("onClick",a),n.onEnd&&o("onEnd",a)):a.button===i.a.ButtonCode.Middle&&n.onMiddleClick&&!this.moved&&o("onMiddleClick",a),setTimeout(function(){this.lastTouch=void 0,this.numClicks=void 0}.bind(this),i.a.DoubleClickTime)}function d(a){e.shouldLog(i.a.LogLevels.Input)&&e.log("Start: ",a.id,e.elementToString(a.target),e.elementToString(t)),a.timeStart=this.timeStart=Date.now(),this.startSrc=a.target,a.startSrc=a.target,this.moved=!1,a.startX=this.startX=a.eventX,a.startY=this.startY=a.eventY,a.startClientX=this.startClientX=a.clientX,a.startClientY=this.startClientY=a.clientY,this.lastX=a.eventX,this.lastY=a.eventY,this.distanceX=0,this.distanceY=0,(isNaN(a.button)||a.button===i.a.ButtonCode.Left||a.button===i.a.ButtonCode.Right)&&((isNaN(a.button)||a.button===i.a.ButtonCode.Left)&&n.onStart?o("onStart",a):a.button===i.a.ButtonCode.Right&&n.onRightStart&&o("onRightStart",a)),isNaN(a.changeLastY)||(this.lastY+=a.changeLastY)}e.isFunction(n)?n={onClick:n}:n&&n.useCapture&&(r=n.useCapture);var c=D(function(a){if(!a.handled){e.shouldLog(i.a.LogLevels.Input)&&e.log("TouchStart: ",a.id,e.elementToString(a.target),e.elementToString(t)),e.lastInputTouch=!0;var n=s.a.ie?a:a.touches[0];return a.eventX=n.pageX,a.eventY=n.pageY,a.clientX=n.clientX,a.clientY=n.clientY,d.call(t,a),a.ignore||(document.addEventListener(s.a.touchMoveEvent,h,r),document.addEventListener(s.a.touchEndEvent,f,r),document.addEventListener(s.a.touchCancelEvent,p,r)),!a.returnFalse&&void 0}}),h=D(function(e){var a=s.a.ie?e:e.touches[0];if(e.eventX=a.pageX,e.eventY=a.pageY,e.clientX=a.clientX,e.clientY=a.clientY,l.call(t,e),e.returnFalse)return!1}),f=D(function(a){e.shouldLog(i.a.LogLevels.Input)&&e.log("TouchUp: ",a.id,e.elementToString(a.target),e.elementToString(t)),document.removeEventListener(s.a.touchMoveEvent,h,r),document.removeEventListener(s.a.touchEndEvent,f,r),document.removeEventListener(s.a.touchCancelEvent,p,r);var n=s.a.ie?a:a.changedTouches[0];if(a.eventX=n.pageX,a.eventY=n.pageY,a.clientX=n.clientX,a.clientY=n.clientY,u.call(t,a),a.returnFalse)return!1}),p=D(function(a){if(e.shouldLog(i.a.LogLevels.Input)&&e.log("TouchCancel: ",a.id,e.elementToString(a.target),e.elementToString(t)),document.removeEventListener(s.a.touchMoveEvent,h,r),document.removeEventListener(s.a.touchEndEvent,f,r),document.removeEventListener(s.a.touchCancelEvent,p,r),function(a){e.shouldLog(i.a.LogLevels.Input)&&e.log("Cancel: ",a.id,e.elementToString(a.target),e.elementToString(t)),n.onCancel&&o("onCancel",a)}.call(t,a),a.returnFalse)return!1}),g=D(function(a){if(!a.handled&&!e.lastInputTouch)return e.shouldLog(i.a.LogLevels.Input)&&e.log("MouseDown: ",a.id,e.elementToString(a.target),e.elementToString(t)),e.lastInputTouch=!1,a.eventX=a.pageX,a.eventY=a.pageY,d.call(t,a),a.ignore||(a.button===i.a.ButtonCode.Left&&document.addEventListener(s.a.moveEvent,m,r),document.addEventListener(s.a.upEvent,v,r)),!a.returnFalse&&void 0}),m=D(function(a){if(!e.lastInputTouch)return a.eventX=a.pageX,a.eventY=a.pageY,l.call(t,a),!a.returnFalse&&void 0}),v=D(function(a){if(!a.handled&&!e.lastInputTouch)return e.shouldLog(i.a.LogLevels.Input)&&e.log("MouseUp: ",a.id,e.elementToString(a.target),e.elementToString(t)),document.removeEventListener(s.a.moveEvent,m,r),document.removeEventListener(s.a.upEvent,v,r),a.button===i.a.ButtonCode.Left&&u.call(t,a),!a.returnFalse&&void 0}),y=D(function(a){a.handled||e.lastInputTouch||(e.shouldLog(i.a.LogLevels.Input)&&e.log("ContextMenu: ",a.id,e.elementToString(a.target),e.elementToString(t)),n.onRightClick&&o("onRightClick",a))});return s.a.isTouchDevice&&s.a.isMobileBrowser?t.addEventListener(s.a.touchStartEvent,c,r):t.addEventListener(s.a.downEvent,g,r),s.a.usePointerEvents&&s.a.isMobile&&t.addEventListener("mousedown",function(e){return e.preventDefault(),e.stopImmediatePropagation(),!1},r),n.onRightClick&&!s.a.isMobile&&t.addEventListener("contextmenu",y,r),this},e.mergeObjects=function(t,a){var i=Array.isArray(a),n=i&&[]||{};return i?(t=t||[],n=n.concat(t),a.forEach(function(a,i){"undefined"===typeof n[i]?n[i]=a:"object"===_(a)?n[i]=e.mergeObjects(t[i],a):-1===t.indexOf(a)&&n.push(a)})):(t&&"object"===_(t)&&Object.keys(t).forEach(function(e){n[e]=t[e]}),Object.keys(a).forEach(function(i){"object"===_(a[i])&&a[i]&&t[i]?n[i]=e.mergeObjects(t[i],a[i]):n[i]=a[i]})),n},e.getGoogleAPIStats=function(){var e={};if(window.gapi&&window.gapi.client)for(var t in gapiMap){var a=gapiMap[t],i={api:a.api,version:a.version,isLoaded:a.isLoaded,numRetries:a.numRetries,lastTimeout:a.lastTimeout,hasTimeout:!!a.timer};if(a.isLoaded)try{i.isAccessible=!!window.gapi.client[t]}catch(n){i.isAccessible=!1}else i.isAccessible=!1;e[t]=i}else e.error="GAPI Client not loaded";return e},e.clamp=function(e,t,a){return Math.max(t,Math.min(a,e))},e.pad2=function(e){return 1===(e=""+e).length?"0"+e:""+e},e.createPath=function(e){return window.location.protocol+"//"+window.location.host+"/"+e},e.addScript=function(t,a,i,n){e.Assert(!a||null===document.getElementById(a),"Should never include the same script ID multiple times");var r=document.createElement("script");r.src=t,a&&(r.id=a),i&&C(r,i,n),e.Assert("undefined"!==typeof r,"Should always be able to create a valid script object"),"undefined"!==typeof r&&document.getElementsByTagName("head")[0].appendChild(r)},e.addScriptHack=function(t,a,i,n){window.define||(window.define={}),e.addScript(t,a,function(){window.define.amd={jQuery:!0},i&&i()},function(){window.define.amd={jQuery:!0},n&&n()})},e.addStylesheet=function(e,t,a){var i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,t&&C(i,t,a),"undefined"!==typeof i&&document.getElementsByTagName("head")[0].appendChild(i)},e.DAssert=f.DAssert=function(){},e.PAssert=f.PAssert=function(t,a){if(!a){var n={isAssert:!0,tag:t};try{var r=function(t){for(var a=0,i="",n=0;n<t.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i+=" "+e.safeStringify(t[n])}return i}(Array.prototype.slice.call(arguments,2).map(function(t){return e.isFunction(t)?t():t}));arguments.length>2?e.log("Assert Failure "+t+": "+r):e.log("Assert Failure "+t),e.reportError(new Error("Assert Failure: "+r),n,i.a.LogLevels.Warning)}catch(o){e.log("Exception in PAssert "+t+": ",o),e.reportError(o,n)}}},e.getElementParent=function(t){for(var a=0;t;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e.hasClass(t,"item")||e.hasClass(t,"paneHiddenInput"))return t;t=t.parentNode}};var P=0;function A(t,a){if(t){var i=function(e,t){return!!e&&(t?e.lastFindPass===P:e.lastFindPass<P)}(t,a);return e.Assert(i,"Item should always be valid"),t.lastFindPass=P,i}return!1}function M(t,a,i){var n,r=i&&i.isTest,o=i&&i.ignoreSearch,s=i&&i.sameLevel,l=i&&i.includeNotes;if(A(t,r)){var u=t.parent();if(u){if(t.isNote())return t.parent();var d=u.getChildIndex(t);if(d>0)for(var c=0;!n;){var h=0;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;for(var f=!1,p=d-1;p>=0;p--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var g=u.getChild(p);if(!A(g,r))return void e.Assert(!1,"Invalid child found during findPreviousItem");if(s||!g.hasChildren()||a&&g.isCollapsed(a,!1)){if(o||!a||!g.isHidden(a,!1)){n=g,f=!0;break}}else if(o||!a||!g.isHidden(a,!1)){u=g,d=g.numChildren(),f=!0;break}}if(s)break;f||(n=u)}else s||(n=t.parent());return l&&n&&n.hasNote()&&(n=n.getNote()),e.Assert(!s||!n||n.parent()===t.parent(),"Previous item must share the same parent"),e.Assert(r||!n||a&&n.isCollapsed(a,!1)||t===T(n,a,{isTest:!0,ignoreSearch:o,sameLevel:s}),"Previous/Next should always match"),n}}}function T(t,a,i){var n,r=0,o=i&&i.isTest,s=i&&i.ignoreSearch,l=i&&i.sameLevel,u=i&&i.includeNotes;if(t){if(u&&t.hasNote())return t.getNote();if(t.isNote()&&(t=t.parent()),!l&&t.hasChildren()&&(!a||!t.isCollapsed(a,!1)))for(var d=0,c=t.numChildren(),h=0;h<c;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(!A(v=t.getChild(h),o))return void e.Assert(!1,"Invalid child found during findNextItem A");if(s||!a||!v.isHidden(a,!1)){n=v,i&&i.numLevels++;break}}for(var f=t;!n;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!A(f,o)){e.Assert(!1,"Invalid parent found during findNextItem B");break}var p=f.parent();if(!p)break;var g=p.getChildIndex(f);if(c=p.numChildren(),!a||!p.isCollapsed(a,!1)){var m=0;for(h=g+1;h<c;++h){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var v;if(!A(v=p.getChild(h),o))return void e.Assert(!1,"Invalid child found during findNextItem C");if(s||!a||!v.isHidden(a,!1)){n=v;break}}}if(f=p,i&&!n&&i.numLevels--,l||a&&f===a.getItem())break}return e.Assert(!l||!n||n.parent()===t.parent(),"Next item must share the same parent"),e.Assert(o||!n||t===M(n,a,{isTest:!0,ignoreSearch:s,sameLevel:l}),"Previous/Next should always match"),n}}e.getPreviousItem=function(e,t,a){return P++,M(e,t,a)},e.getNextItem=function(e,t,a){return P++,T(e,t,a)},e.easeOut=function(e,t,a){return-a*e*(e-2)+t};var E={};e.scrollTo=function(t,a,i,n,r){e.Assert(void 0!==t||void 0!==a,"Must be scrolling something"),e.Assert(void 0===t||e.isNumber(t),"Must provide a valid scrollPosX"),e.Assert(void 0===a||e.isNumber(a),"Must provide a valid scrollPosY"),e.Assert(e.isNumber(i),"Must provide a valid duration"),e.Assert(e.isDOMNode(n),"Must provide a valid element to scroll"),e.Assert(!r||e.isFunction(r),"Must provide a valid scrollDone callback");var o=n.getAttribute("data-moo-id")||n.id;if(e.Assert(o,"Should only scroll elements with ids"),E[o]&&(cancelAnimationFrame(E[o]),delete E[o]),n)if(i>0){if(void 0!==t)var s=n.scrollLeft,l=t-s;if(void 0!==a)var u=n.scrollTop,d=a-u;var c;(Math.abs(l)>0||Math.abs(d)>0)&&(E[o]=requestAnimationFrame(function h(f){c||(c=f-20);var p=Math.min((f-c)/i,1);if(void 0!==t){var g=e.easeOut(p,s,l);n.scrollLeft=g}if(void 0!==a){var m=e.easeOut(p,u,d);n.scrollTop=m}1===p?(delete E[o],r&&r()):E[o]=requestAnimationFrame(h)}))}else n&&(void 0!==t&&(n.scrollLeft=t),void 0!==a&&(n.scrollTop=a)),r&&r();else e.reportError(new Error("Must specify an element to scroll to"))},e.computeScrollSpeed=function(t,a,i,n,r){var o=(a-t-(a-(i=e.clamp(i,t,a))))/(a-t);return r<0&&(o-=1),o*n};var L={speedPane:0,pane:void 0,speedPanes:0,panes:!1};function x(){if(L.pane||L.panes){var t;if(L.pane){var a=6*L.speedPane;t=L.pane.addScrollDelta(a)}else{var i=6*L.speedPanes,n=e.element("panes"),r=n.scrollLeft;n.scrollLeft+=i,t=r!==n.scrollLeft}t?requestAnimationFrame(x):e.cancelRepeatScroll(L.pane?"pane":"panes")}}e.repeatScroll=function(t,a,i,n){e.Assert(n||i&&!e.isString(i),"Must pass a valid pane object to repeatScroll"),L["speed"+(i?"Pane":"Panes")]=a,(L.pane||L.panes)&&i===L.pane||(L.pane=i,L.panes=n,requestAnimationFrame(x))},e.cancelRepeatScroll=function(e){L[e]=void 0},e.elementInPane=function(t){if(t){var a=0;for(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);t;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e.hasClass(t,"pane")||e.hasClass(t,"paneOverview"))return!!t;t=t.parentElement}}return!1},e.elementInPaneEdit=function(t){var a=!1,i=e.getPaneForElement(t);return i&&e.isAncestor(t,i.getContentElement())&&(a=!0),a},e.elementInNonPaneEdit=function(t){var a=!1;if(t&&(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode),!e.elementInPaneEdit(t)))for(var i=0;t;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.isKeyboardInputElement(t)){a=!0;break}t=t.parentElement}return a},e.isNonPaneDropTarget=function(t){var a=!1;return e.elementInNonPaneEdit(t)?a=!0:e.findParent(t,"validDropTarget")&&(a=!0),a},e.scrollIntoView=function(t,a,n){e.Assert(e.isDOMNode(t),"Must supply a valid DOM node to scroll into view"),e.Assert(e.isNumber(a)&&a>=0,"Must supply a valid scroll duration"),e.Assert(!n||e.isFunction(n),"Callback must be a function"),e.Assert(!e.getListCellForElement(t),"Use methods on VMPane to scroll VMLIs");var r=!1;if(t){var o=e.findParent(t,"scroller")||e.findParent(t,"fancyScrollContent")||s.a.isMobile&&e.findParent(t,"fancyScroller");if(e.Assert(o,"Every element must be a child of a scroller to be able to scroll it into view"),e.Assert(!e.hasClass(o,"customScroller"),"Must not be scrolling this way, use methods on VMPane instead"),o){var l,u=o.getBoundingClientRect(),d=u.bottom,c=t.getBoundingClientRect(),h=Math.min(c.bottom,c.top+80),f=o.scrollTop;if(s.a.isMobile){var p=s.a.orientation===i.a.Orientation.Landscape?e.topBarHeight:120;d=Math.max(u.top+p,d-400)}c.top<u.top?l=f+c.top-u.top:h>d&&c.top>u.top&&(l=f+h-d),void 0!==l&&(e.scrollTo(void 0,l,a,o,n),r=!0)}}return r},e.isKeyboardInputElement=function(t){if(t){if("checkbox"===t.type)return!1;if("INPUT"===t.nodeName||"textarea"===t.type||e.findParentAttr(t,"contenteditable","true"))return!0}return!1},e.openKeyboardOnIndex=function(t,a,i,n,r){e.batchRenderUpdates(function(){e._openKeyboardOnIndex(t,a,i,n,r)})},e._openKeyboardOnIndex=function(t,a,n,r,o){e.Assert(s.a.isMobile,"Should only be opening keyboard on mobile devices");var l=a.getScrollOffset(),u=!1;if(e.keyboardToolbar.preShow(),!e.isKeyboardOpen){var d=function(){r&&r(),s.a.iosui&&e.keyboardToolbar.show(i.a.KeyboardToolbarMode.Item),e.enforceScroll()};a.addPadding(),s.a.app||s.a.android||s.a.mobileie?u=a.scrollIndexIntoView(n,s.a.keyboardOpenTime,d):(u=a.scrollIndexIntoView(n,s.a.keyboardOpenTime),d()),e.keyboardToolbar.hideTopBarIfLandscape()}return u&&s.a.app&&!s.a.android&&!s.a.ioswk||(r&&r(),e.keyboardToolbar.show(i.a.KeyboardToolbarMode.Item)),F=a,N=o,B=l,R=O.Item,s.a.ios&&e.preventClick(),t&&(e.preventAndStop(t),t.returnFalse=!0),e.enforceScroll(),u},e.openKeyboardOnElement=function(t,a,n,r){var o,l;e.Assert(s.a.isMobile,"Should only be opening keyboard on mobile devices"),e.Assert(e.isDOMNode(a),"Must supply a valid element"),a&&(o=e.findParent(a,"scroller"),e.Assert(!e.hasClass(a,"paneScroller"),"Must never scroll a custom scroller this way"),l=o?o.scrollTop:0);var u=!1;if(e.keyboardToolbar.preShow(),!e.isKeyboardOpen){var d=function(){e.keyboardToolbar.show(i.a.KeyboardToolbarMode.Modal),n&&n(),e.enforceScroll()};!function(t){if(t){var a=e.getItemForElement(t);a&&a.addPadding&&a.addPadding()}}(o),s.a.app&&!s.a.ioswk||s.a.android||s.a.mobileie?u=e.scrollIntoView(a,s.a.keyboardOpenTime,d):(u=e.scrollIntoView(a,s.a.keyboardOpenTime),d()),e.keyboardToolbar.hideTopBarIfLandscape()}return u&&s.a.app&&!s.a.android||(n&&n(),e.keyboardToolbar.show(i.a.KeyboardToolbarMode.Modal)),F=o,N=r,B=l,R=O.Element,s.a.ios&&e.preventClick(),t.stopImmediatePropagation(),t.returnFalse=!0,e.enforceScroll(),u};var O={None:0,Item:1,Element:2},R=O.None,F=void 0,N=void 0,B=0;function U(e,t,a){a=a||0;var i,n=t.noCollapsed,r=t.pane,o=t.overview;t.includeNotes&&!t.headers&&e.hasNote()&&(t.comparator&&!t.comparator(e.getNote(),t)||t.each&&(i=t.each(e.getNote(),t))),!1===i||n&&0!==a&&e.isCollapsed(r,o)||(i=function(e,t,a){for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(!e.headers||r.showInOverview(e.includeArchived)){if((!e.comparator||e.comparator(r,e))&&e.each&&!1===e.each(r,e))return!1;U(r,e,a+1)}}}(t,e.items.get(),a))}e.onCloseKeyboardItem=function(){e.shouldLog(i.a.LogLevels.Selection)&&e.log("OnClose Keyboard"),e.isKeyboardOpen&&(F.addPadding(),F.setScrollOffset(B,s.a.keyboardOpenTime),e.isKeyboardOpen=!1,N&&N())},e.onCloseKeyboardElement=function(){e.shouldLog(i.a.LogLevels.Selection)&&e.log("OnClose Keyboard"),e.isKeyboardOpen&&(e.Assert(F,"Must have a valid scroller"),e.scrollTo(void 0,B,s.a.keyboardOpenTime,F),e.isKeyboardOpen=!1,N&&N())},e.onCloseKeyboard=function(){R===O.Item?e.onCloseKeyboardItem():R===O.Element&&e.onCloseKeyboardElement()},e.blurActiveElement=function(t){e.ignoreSelectionChange=!!t,e.shouldLog(i.a.LogLevels.Selection)&&e.log("Blur Active Element"),document.activeElement&&document.activeElement.blur(),setTimeout(function(){e.ignoreSelectionChange=!1},100)},e.trimString=function(e){for(var t=0,a=/\s/,i=(e=e.replace(/^\s\s*/,"")).length;a.test(e.charAt(--i));)if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;return e.slice(0,i+1)},e.enforceScroll=function(e,t){(e||(s.a.ios||s.a.android)&&(!s.a.app||s.a.ios71))&&(setTimeout(function(){window.scrollTo(0,t||0)},0),requestAnimationFrame(function(){window.scrollTo(0,t||0)}),window.scrollTo(0,t||0),document.body.scrollTop=0)},e.preventAndStop=function(t){e.preventDefault(t),e.stopPropagation(t)},e.preventDefault=function(t){t&&t.preventDefault?t.preventDefault():e.Assert(!1,"Invalid event object: "+t)},e.stopPropagation=function(t){t&&t.stopPropagation?t.stopPropagation():e.Assert(!1,"Invalid event object: "+t)},e.preventClick=function(){e.addClass(e.element("outerWrapper"),"noClick"),window.ontouchstart=e.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,e.removeClass(e.element("outerWrapper"),"noClick")})},e.searchVMLIs=function(t){e.Assert(t,"Must supply a valid options param");try{t.itemStoreFilter?e.vmMain.itemStoreManager.runForEachStore(function(e){var a=t.item;U(a&&a.belongsToItemStore(e)?a:e.getRoot(),t)},t.itemStoreFilter):t.item?(e.Assert(!t.itemStore&&!t.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter"),U(t.item,t)):t.itemStore?(e.Assert(!t.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter"),U(t.itemStore.getRoot(),t)):(e.Assert(!1,"Must specify a valid search root, using the default root is deprecated"),e.vmMain.itemStoreManager.getDefaultItemStore().getRoot())}catch(a){e.reportError(a)}},e.getActiveSearch=function(){return e.focusedPane.search},e.loadXML=function(t){try{if("undefined"!==typeof window.DOMParser)return(new window.DOMParser).parseFromString(t,"text/xml");if("undefined"!==typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var a=new window.ActiveXObject("Microsoft.XMLDOM");return a.async="false",a.loadXML(t),a}return void e.Assert(!1,"No XML parser found")}catch(i){return void e.reportError(i)}},e.hasClass=function(t,a){if(e.Assert(t,"Must pass in a valid element"),t.classList)for(var i=0,n=Array.prototype.slice.call(arguments,1),r=0;r<n.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t.classList.contains(n[r]))return!0}return!1},e.removeClass=function(t,a){e.Assert(t,"Must pass in a valid element"),t&&t.classList&&t.classList.remove(a)},e.addClass=function(t,a){e.Assert(t,"Must pass in a valid element"),t&&t.classList&&t.classList.add(a)},e.toggleClass=function(t,a){e.Assert(t,"Must pass in a valid element"),t&&t.classList&&t.classList.toggle(a)},e.findChild=function(t,a){if(e.Assert(t,"Must pass in a valid element"),t)for(var i=0,n=0;n<t.childElementCount;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t.children[n];if(e.hasClass(r,a))return r;var o=e.findChild(r,a);if(o)return o}},e.getPluginForElement=function(t){return e.findParent(t,"plugin",4)},e.findParentInItem=function(t,a){for(var i=0;t&&!e.hasClass(t,"item");){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.hasClass(t,a))return t;t=t.parentNode}},e.findParent=function(t,a,i){if(e.Assert(t,"Must pass in a valid element"),i||(i=1e3),t)for(var n=0,r=t,o=0;o<i&&r;++o,r=r.parentNode){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e.hasClass(r,a))return r}},e.findParentID=function(t,a,i){if(e.Assert(t,"Must pass in a valid element"),i||(i=1e4),t)for(var n=0,r=t,o=0;o<i&&r;++o,r=r.parentNode){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r.id===a)return r}},e.findParentAttr=function(t,a,i){if(e.Assert(t,"Must pass in a valid element"),t)for(var n=0,r=t;r&&r.getAttribute;r=r.parentNode){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r.getAttribute(a)===i)return r}},e.isAncestor=function(t,a){var i=0;for(e.Assert(t,"Must have a valid element"),e.Assert(a,"Must have a valid candidate");t&&t!==a;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t=t.parentNode}return!!t},e.prependChild=function(t,a){e.Assert(t,"Must pass in a valid element"),e.Assert(a,"Must pass in a valid element"),t.insertBefore(a,t.firstChild)},e.getAncestorChain=function(e){for(var t=0,a=e;a;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a.push(a),a=a.parentNode}return[]},e.isAttachedToDoc=function(t){return e.Assert(t,"Must supply a valid element to check"),e.Assert(t.ownerDocument,"Checked element must have a valid owner document"),!!t.ownerDocument&&(t.ownerDocument.body.contains(t)||t.ownerDocument.documentElement===t)},e.offset=function(t){e.Assert(t,"Must pass in a valid element");var a=t.getBoundingClientRect(),i=t.ownerDocument,n=t.ownerDocument.documentElement,r=i.defaultView;return{top:a.top+r.pageYOffset-n.clientTop,left:a.left+r.pageXOffset-n.clientLeft}},e.position=function(e){var t=e.offsetParent,a=e.getBoundingClientRect(),i=t.getBoundingClientRect();return{left:a.left-i.left,top:a.top-i.top}},e.height=function(t){e.Assert(t,"Must pass in a valid element");var a=t.offsetHeight,n=window.getComputedStyle(t);return n?("border-box"!==n.boxSizing&&(a-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom)),a-=parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth)):e.shouldLog(i.a.LogLevels.Error)&&e.log("GetComputedStyle failed in globals::height"),a},e.width=function(t){e.Assert(t,"Must pass in a valid element");var a=t.offsetWidth,n=window.getComputedStyle(t);return n?("border-box"!==n.boxSizing&&(a-=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)),a-=parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth)):e.shouldLog(i.a.LogLevels.Error)&&e.log("GetComputedStyle failed in globals::width"),a};var V={};function j(t){var a=e.sanitizeURL(t).split("?")[0];return V[a]||(V[a]={requests:0,successes:0,retries:0,failures:0}),V[a]}function H(e){j(e).failures++}e.getXHRStats=function(){return V};var z=[0,5,15,35,80,170,400,1200],q=[0,408,429,500,502,503,504];e.XHR=function(t){e.Assert(t.url,"Must specify a valid URL to use"),e.Assert(t.type,"Must specify a valid request type");var a=t.url,i=t.type,n=t.cb,r=t.data,o=t.headers,s=t.autoRetry,l=t.timeout,u=Math.min(t.maxRetries||2,6),d=0,c=t.username,h=t.password;function f(){e.Assert(d<u,"Should not be calling retry once retries have been exhausted"),d<u?(d++,function(e){j(e).retries++}(a),setTimeout(p,1e3*z[d])):(H(a),e.reportError(new Error("XHR Failed: "+a)))}function p(){var t,p=new XMLHttpRequest;if(p.timeout=l,p.onreadystatechange=function(){4===p.readyState&&(200!==p.status?d<u?(p.retry=f,s&&q.indexOf(p.status)>=0?p.retry():n(p)):(H(a),n(p)):(function(e){j(e).successes++}(a),n(p)))},c&&h?p.open(i.toUpperCase(),a,!0,c,h):p.open(i.toUpperCase(),a,!0),o)for(var g in o)p.setRequestHeader(g,o[g]);r?(p.setRequestHeader("Accept","*/*"),o&&o["Content-Type"]||p.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t=r instanceof Blob?r:function(t){var a="";if("object"===_(t)){var i=[];for(var n in t)i[i.length]=encodeURIComponent(n)+"="+encodeURIComponent(t[n]);a=i.join("&").replace(/%20/g,"+")}else e.Assert("string"===typeof t,"Only Objects or Strings are currently supported"),a=t;return a}(r),p.send(t)):p.send()}!function(e){j(e).requests++}(a),p()},e.XHR_PrivateAPI=function(t){e.vmMain.XHR_PrivateAPI(t)};var W=!1,G=1,K={};function Y(e){var t,a;if(a=e.url,t=!!a&&K[a.split("?")[0]]){e.iid=G++;var i=e.onreadystatechange;e.onreadystatechange=function(){i&&i.apply(e,arguments),t(e)}}}e.registerURLForNotifyXHR=function(e,t){return K[e]||(K[e]=t),W};var X=["https://drive.google.com/otservice/save","https://drive.google.com/otservice/bind"];e.wrapXHR=function(){try{var t=window.XMLHttpRequest.prototype.open,a=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.open=function(a,i,n,r,o){this.url=i,void 0===n&&(n=!0);try{t.call(this,a,i,n,r,o)}catch(s){throw e.reportError(s),s}},window.XMLHttpRequest.prototype.send=function(t){Y(this),!this.timeout&&function(e){var t=!1;if(e&&e.url){var a=e.url.split("?")[0];X.indexOf(a)>=0&&(t=!0)}return t}(this)&&(this.timeout=e.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&a.call(this,t)}catch(i){throw e.reportError(i),i}}}catch(i){return void e.reportError(i)}W=!0},e.wrapXHR(),e.element=function(t,a){return e.Assert(t,"Tried to get an element without an id"),e.elements[t]&&!a||(e.elements[t]=document.getElementById(t)),e.Assert(e.elements[t],"Tried to get an element that doesn't exist",t),e.elements[t]},e.openUrl=function(t,a,i){if(e.Assert(t,"Must always provide a valid URL to open"),!t)return!1;var n=e.parseEvernoteLink(t);if(n){var r=e.getSettings().openEvernoteApp.get();if(void 0===r)return void e.menus.confirm("Open Evernote links in Evernote app?",function(n){e.getSettings().openEvernoteApp.set(n),e.openUrl(t,a,i)});r&&(n.viewUrl?t=n.viewUrl:(t="evernote:///view/"+n.userId+"/"+n.shardId+"/"+n.noteGuid+"/"+n.noteGuid+"/",console.log(t)))}if(s.a.standalone){var o=document.createElement("a");o.setAttribute("href",t),o.setAttribute("target","_blank"),o.setAttribute("rel","noopener noreferrer");var l=document.createEvent("HTMLEvents");l.initEvent("click",!0,!0),o.dispatchEvent(l)}else s.a.app?(s.a.ios&&s.a.appv>=5||s.a.android&&s.a.appv>=5||s.a.isChrome||!t.startsWith("http://")&&!t.startsWith("https://")?t.startsWith("/")&&(t=window.location.host+t):t=t.replace("http://","").replace("https://",""),t.startsWith("callto:")&&(t=t.replace("callto:","tel:")),s.a.ios&&t.startsWith("tel:")?(t.indexOf("://")<0&&(t=t.replace("tel:","tel://")),e.nativeBridge.sendToApp("openURL",t)):s.a.ios&&t.startsWith("mailto:")?open(t):e.nativeBridge.sendToApp("openURL",t),a&&(e.preventAndStop(a),a.returnFalse=!0)):(i=i||t.startsWith("evernote:///")||t.startsWith("onenote:")||t.startsWith("bear:"))?open(t,"_self"):open(t,"_blank");return!0},e.getLocationOrigin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")},e.isSpellcheckEnabled=function(){return!1},e.fFalse=function(){return!1},e.fTrue=function(){return!0},e.round=function(e,t){return t=t||2,Number(Math.round(e+"e"+t)+"e-"+t)},e.toFileSize=function(e){if(e){var t=Math.log(e)/Math.log(1024)|0;return(e/Math.pow(1024,t)).toFixed(2)+" "+(0===t?"bytes":"KMGTPEZY"[t-1]+"B")}return null},e.saveFile=function(e,t){var a=new Blob([e],{type:"text/plain;charset=utf-8"});Object(y.saveAs)(a,t)};var Q=[];e.downloadFile=function(t,a){if(s.a.supportsNativeDownload())e.Assert(!Q[t],"Should not double create a download for the same file"),Q[t]=e.toasts.pushMessage({text:"Downloading "+a+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),e.nativeBridge.sendToApp("downloadURL",{url:t,name:a});else if(document.createEvent){var i=document.createElement("a");i.href=t;var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),i.dispatchEvent(n)}else window.open(t,"_self")},e.handleNativeDownloadProgress=function(e){var t=e.url,a=e.name,i=e.progress,n=Q[t];if(n)if(1===i)n.hide(),delete Q[t];else{var r=isNaN(i)?"...":Math.round(100*i)+"%";n.setText("Downloading "+a+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+r)}},e.printPage=function(e){s.a.app||window.open(e).print()},e.eventStream=new l.a(25),e.reactNodeForElement=function(t){var a=t;if(a.nodeType===Node.TEXT_NODE&&(a=a.parentNode),a=e.getParentWithMooKey(a))for(var i in a)if(i.startsWith("__reactInternalInstance$")){var n=a[i],r=n&&n.return&&n.return.stateNode;if(r&&r.props)return r}},e.getParentWithMooKey=function(e){for(var t=0;e&&e!==document;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.getAttribute("data-moo-id"))return e;e=e.parentNode}},e.getItemForElement=function(t){var a=e.reactNodeForElement(t),i=a&&a.getPaneObject&&a.getPaneObject(),n=i&&(e.isVMLI(i)?i:i.item);if(e.Assert(!n||e.isVMLI(n),"Must always find a valid VMLI for a given element: "+e.elementToString(t)),n)return n},e.getIndexForElement=function(t){var a=-1,i=e.findParent(t,"item");if(i){var n=e.reactNodeForElement(i);n&&(a=n.getIndex())}return a},e.getPaneForElement=function(t){var a=e.findParent(t,"pane")||e.findParent(t,"paneOverviewWrapper");if(a){var i=e.reactNodeForElement(a);return i&&i.getPane&&i.getPane()}if(e.findParent(t,"mobileUIBottom"))return e.focusedPane},e.getPaneObjectForElement=function(t){var a=e.reactNodeForElement(t);if(a&&a.getPaneObject)return a.getPaneObject()},e.getCellForElement=function(t){var a=e.reactNodeForElement(t);if(a&&a.getCell)return a.getCell()},e.getListCellForElement=function(t){var a=e.reactNodeForElement(t);if(a&&a.getCell)return a},e.encodeMIMEHeader=function(e){return"=?UTF-8?B?"+window.btoa(unescape(encodeURIComponent(e)))+"?="},e.utf8_to_b64=function(t){var a;try{a=window.btoa(unescape(encodeURIComponent(t))).replace(/\+/g,"-").replace(/\//g,"_")}catch(i){e.reportError(i,t)}return a},e.b64_to_utf8=function(t){var a;try{a=decodeURIComponent(escape(window.atob(t.replace(/-/g,"+").replace(/_/g,"/"))))}catch(i){e.reportError(i,t)}return a},e.qp_to_utf8=function(t){var a;try{a=t.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,function(e,t){var a=parseInt(t,16);return String.fromCharCode(a)})}catch(i){e.reportError(i,t)}return a},e.isHTTPStatusCode=function(e,t){return e&&e.error&&e.error.code===t},e.hasGoogleError=function(t,a,i){e.Assert(t,"Must specify a valid result object"),e.Assert(a,"Must specify a valid error domain"),e.Assert(i,"Must specify a valid error reason");var n=!1;if(t&&t.error&&t.errors)for(var r=0,o=t.error.errors,s=0;s<o.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=o[s];if(l.domain===a&&l.reason===i){n=!0;break}}return n},e.timeouts={},e.hasTimeoutOnce=function(t){return!!e.timeouts[t]},e.timeoutOnce=function(t,a,i,n,r,o,s,l){e.Assert(t,"Must supply a valid name"),e.Assert(e.isFunction(a),"must supply a valid cb fn"),e.Assert(arguments.length<=8,"Too many args passed in");var u=e.timeouts[t];u&&clearTimeout(u),e.timeouts[t]=setTimeout(function(){delete e.timeouts[t],a(n,r,o,s,l)},i)},e.clearTimeoutOnce=function(t){var a=e.timeouts[t];a&&(clearTimeout(a),delete e.timeouts[t])},e.animFrameOnce=function(t,a){var i=e.timeouts[t];i&&cancelAnimationFrame(i),e.timeouts[t]=requestAnimationFrame(a)},e.contentSetAuto=void 0,e.elementFromPoint=function(e,t){return document.elementFromPoint(e,t)},e.parentTextForItem=function(e){for(var t=0,a=e.parents(),i="",n=1;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n>1&&(i+="  |  "),i+=a[n].generateTitleText()}return i},e.scrollToAndHighlightItem=function(t,n){t.highlight(),a(3).default.paneManager.runForEachPane(function(a){if(a!==n){var r=a.indexOfItem(t);if(r<0&&a.type===i.a.PaneMode.Task&&a.isViewOutline()&&t.isDescendantOf(a.item.get())&&a.search.isMatched(t)){var o=0;e.vmMain.beginUpdateItems();for(var s=t.parent();s&&s!==a.item.get();){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;s.isCollapsed(a,!1)&&(a.setIgnoreRestoreScroll(),s.setCollapsed(!1,a,!1)),s=s.parent()}e.vmMain.commitUpdateItems(),r=a.indexOfItem(t)}r>=0&&a.scrollIndexToMiddle(r,i.a.ScrollDuration.Default)}})},e.batchRenderUpdates=function(e,t,a,i,n,r){return v.a.unstable_batchedUpdates(e,t,a,i,n,r)},e.hexToRgb=function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}},e.hexToRgbStr=function(e){return parseInt(e.substr(1,2),16)+","+parseInt(e.substr(3,2),16)+","+parseInt(e.substr(5,2),16)},e.rgbToHex=function(t,a,i){return[e.pad2(Math.round(t).toString(16)),e.pad2(Math.round(a).toString(16)),e.pad2(Math.round(i).toString(16))].join("")},s.a.demo&&e.enableDemoMode();var J=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g;e.parseEvernoteLink=function(e){return e.startsWith("evernote:///view/")?{viewUrl:e}:(J.lastIndex=0,null!==(t=J.exec(e))?{shardId:t[1],userId:t[2],noteGuid:t[3]}:void 0);var t},e.isOneNoteLink=function(e){return e.startsWith("onenote:https://")},e.isBearLink=function(e){return e.startsWith("bear://x-callback-url/")};var Z,$=-1;return e.__infLoop=function(t){if(!Z||t<$)Z=Date.now();else if(t>$&&t>3e4&&t%200===0&&Date.now()-Z>1e4)return e.Assert(!1,"Infinite loop!",t),e.toasts&&e.toasts.pushMessage(i.a.MessageID.ReactError),!0;$=t},e}()},function(e,t,a){"use strict";var i;function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Date.Config={__DEV__:!0,DisableCache:!0},Error.stackTraceLimit=1/0;var r={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,Minus:109,F1:112,F4:115,F12:123,Equals:187,Plus:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222},o={None:0,Note:32,Archived:128,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},s={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",DriveFull:"https://www.googleapis.com/auth/drive",DriveReadOnly:"https://www.googleapis.com/auth/drive.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoEmail:"email",UserInfoProfile:"profile",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",Plus:"https://www.googleapis.com/auth/plus.me"},l={CloudFunctionsURL:"https://us-central1-markdone-218007.cloudfunctions.net/",EmailOpenTime:250,ItemTransitionTime:150,DoubleClickTime:500,EmailPreviewSizeMin:600,EmailPreviewSizeMaxFlex:800,EmailPreviewSizeMax:1200,PremiumMaxBoards:5,PremiumMaxPanes:3,ExpandedPaneWidth:400,HelpWidth:360,StdPaneWidthMin:400,StdPaneWidthMax:900,PaneWidthMax:1400,EmailOpenTimeMobile:150,OverviewWidth:260,OverviewItemHeightDesktop:26,OverviewItemHeightMobile:36,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,PaneSpaceSize:0,MSPerMinute:6e4,MSPerHour:36e5,MSPerDay:864e5,DefaultEventDuration:36e5,MaxBatchSize:45,TooltipDelay:400,MobileBottomHeight:50,HorizScrollbarHeight:18,PaneHeaderButtonWidth:32,PaneHeaderButtonHeight:36,PaneHeaderRow2ButtonHeight:30,PaneHeaderRow2Height:36,MobileHeaderRow2Height:36,CalendarResizeHandleHeight:8,DesktopMenuWidthDefault:120,DesktopMenuWidthMax:240,DesktopMenuWidthMinBig:66,DesktopMenuWidthSmall:36,RootItemName:"Home",MinEmailScale:.25,SidebarDragHandleSize:16,SearchHeight:22,PaneAddItemBoxHeight:36,DateFormat:{DMY:"dmy",DMYDot:"dmydot",MDY:"mdy",YMD:"ymd",YMDDot:"ymddot"},SettingsSections:{General:"General",Dates:"Dates",Plugins:"Enable Plugins",Account:"Moo.do Account",EarlyAccess:"Send Feedback",Linked:"Email Accounts",Invite:"Invite Friends",GoogleCalendar:"Google Calendar",Contacts:"Contacts",Gmail:"Gmail",Agenda:"Agenda",Backups:"Backups",Security:"Security"},ItemAnimationMode:{None:0,Normal:1,Move:2,Search:3},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:0,Reply:1,ReplyAll:2,Forward:3,Other:4},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},TaskViewMode:{Outline:"Outline",List_Flat:"List_Flat",Groups_Project:"Groups_Project",Groups_Tag:"Groups_Tag",Groups_Contact:"Groups_Contact",Groups_Priority:"Groups_Priority",Agenda_Today:"Agenda_Today",Agenda_Week:"Agenda_Week",Agenda_All:"Agenda_All",Calendar_Day:"Calendar_Day",Calendar_Custom:"Calendar_Custom",Calendar_Week:"Calendar_Week",Calendar_Month:"Calendar_Month"},TaskViewModesPremium:{Groups_Tag:!0,Groups_Contact:!0,Groups_Priority:!0},TaskViewModeText:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Project",Groups_Tag:"Tag",Groups_Contact:"Contact",Groups_Priority:"Priority",Agenda_Today:"Today",Agenda_Week:"Week",Agenda_All:"All",Calendar_Day:"Day",Calendar_Custom:"# Days",Calendar_Week:"Week",Calendar_Month:"Month"},TaskViewModeTextSimple:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priorities",Agenda_Today:"Agenda",Agenda_Week:"Agenda",Agenda_All:"Agenda",Calendar_Day:"Calendar",Calendar_Custom:"Calendar",Calendar_Week:"Calendar",Calendar_Month:"Calendar"},TaskViewModeIcon:{Outline:"icon-format_list_bulleted",List_Flat:"icon-reorder",Groups_Project:"icon-project",Groups_Tag:"icon-hash",Groups_Contact:"icon-user",Groups_Priority:"icon-exclamation",Agenda_Today:"icon-today",Agenda_Week:"icon-view-groups",Agenda_All:"icon-format_align_justify",Calendar_Day:"icon-view_carousel",Calendar_Custom:"icon-view_week",Calendar_Week:"icon-cal-week",Calendar_Month:"icon-view_comfy"},TaskSortMode:{None:"None",Alphabetical:"Alphabetical",NumItems:"NumItems",Priority:"Priority",Date:"Date",Created:"Created",Completed:"Completed"},TaskSortModeText:{None:"None",Alphabetical:"A-Z",NumItems:"# Items",Priority:"!!!",Date:"Date",Created:"Created",Completed:"Completed"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:52,CalendarDayViewNumDaysPad:168,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,CalendarMaxSyncWeeks:52,CalendarMinSyncWeeks:-52,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},DFormat:{LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},HelpMode:{None:0,Normal:1,Hotkeys:3},Pricing:{None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3},LoginFlags:{None:0,NewUser:1,OldUserNewTrial:2,TrialOver:4,TrialAutoReset:8},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailViewMode:{Date:"Date",Priority:"Priority"},MaxGmailSyncTime:{Premium:30,Free:5},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},AutocompleteMode:{All:"all",Move:"move",Jump:"jump",Item:"item",Email:"email",Contact:"contact",Tag:"tag",Date:"date",Snooze:"snooze",GmailLabel:"gmailLabel"},ContextMenuMode:{Default:0,Archived:1,Drive:2,Gmail:3},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1,Portrait:0,Landscape:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown",SpacingCompact:"SpacingCompact",SpacingComfortable:"SpacingComfortable",PrefixesFaded:"PrefixesFaded",PrefixesStrong:"PrefixesStrong"},ColorTheme:{Light:"light",Dark:"dark"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Header2:"^",Bullet:"*",Bullet2:"-",Bullet3:"+",Task:"[",Task2:"[]",Task3:"]",Task4:"[ ]",Task5:"(",Task6:"()",Task7:")",Task8:"( )",NumList:"1."},MinimumTokenExpireTimeMS:6e4,MinimumTokenExpireTime:60,ToastTimeoutDefault:5e3,PrefixWidth:20,PaddingAgendaTime:30,HeightAgendaParents:18,LineLeftPad:5,PrefixItemAutocomplete:"$",TextSpace:"\ufeff",AttachChar:"\u2000",EmbedAttachChar:"\u2001",PerPaneStateField:{Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},ItemStoreFilter:{None:0,Dates:1,Contacts:2,Priority:4},NumKeys:[r.D1,r.D2,r.D3,r.D4,r.D5,r.D6,r.D7,r.D8,r.D9,r.D0],ContactPrefix:"+",TagPrefix:"#",TextMDHR:"---",DisplaySettings:{bulletOpacity:"bulletOpacity",projectOpacity:"projectOpacity",checkboxOpacity:"checkboxOpacity",checkboxBackgroundOpacity:"checkboxBackgroundOpacity",showVerticalLines:"showVerticalLines",verticalLinesOpacity:"verticalLinesOpacity",boldHeaders:"boldHeaders",itemPadding:"itemPadding",notePadding:"notePadding",itemLineHeight:"itemLineHeight",noteLineHeight:"noteLineHeight",itemIndentSize:"itemIndentSize",fontSize:"fontSize",fontSizeHeader:"fontSizeHeader",fontSizeHeaderTopLevel:"fontSizeHeaderTopLevel",noteFontSize:"noteFontSize",tagColor:"tagColor",dateColor:"dateColor",contactColor:"contactColor",linkColor:"linkColor",underlineP:"underlineP",displaySpacing:"displaySpacing",displayPrefixes:"displayPrefixes",grayscale:"grayscale"},KeyCode:r,KeyCodesModifiers:[r.LeftMeta,r.RightMeta,r.Ctrl,r.Alt,r.Shift],KeyCodesArrows:[r.UpArrow,r.DownArrow,r.LeftArrow,r.RightArrow],PrivateAPIErrorCodes:{Success:0,UnknownFailure:1,Unexpected:2,DatabaseReadError:3,DatabaseWriteError:4,MissingParameter:5,InvalidParameter:6,UnauthorizedUser:7,ErrorSendingEmail:8,AlreadyReferred:9,ErrorContactingRemote:10,BraintreeUnknown:11,InvalidToken:12,InvalidReferralCode:13,NoSignupFound:14,TrialOver:15,RemoteServerError:16,TokenMissing:17,BraintreePaypalBlock:18,BraintreeInvalidCCN:19,AlreadyExists:20,DomainPolicy:21,InvalidCode:22},SearchDates:{Overdue:"@overdue",Before:"before:",After:"after:",Date:"date:"},Regexp:{Link:/\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/g,LinkExc:/(!?)\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/g,MDLink:/(!?)\[([^\[]*)\]\((\S+)(\s=\d{0,3}x)?(?=\))\)/g,Prefix:/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) /gi},ItemProp:{Date:"date",Items:"items",Tags:"tags",Text:"text",Font:"font",Search:"search"},APIKey:"AIzaSyAFWYJ0MNL0-V4nB2Jc96Oxj7ds50IbXDE",ClientID:"661309247798-daiu336t3mpoe9njg9csd5bk07vie9es.apps.googleusercontent.com",DefaultBackupFrequency:36e5,DriveFolder:{Root:"root",Attach:"attach",Backup:"backup"},CrudActions:{Added:"added",Modified:"modified",Removed:"removed"},TestDocName:"demo",LocalStoreMode:{Mirror:"mirror"},LogLevels:{Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Edit:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},URLPart:{Search:1,Hash:2},PremiumStatus:{Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},UninitializedVersion:-1,DETAILED_STATS:!1,DEBUG_DATE:!1,OAuthSchemeType:{Invalid:-1,None:0,Web:1,Native:2,Count:2},RepeatFreq:{Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},ChangeType:{None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},DataChangeType:{Add:1,Remove:2,Change:3},VMLIFlag:o,VersionType:{Structure:1,Text:2},SearchResultStatus:{Done:1,TooMany:2,None:3,Error:4},PaneMode:{Task:"PaneTask",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail"},ScrollDuration:{Snap:0,Default:200,Slow:500},LoadState:{Connecting:0,NeedPassword:1,LoadingDocs:2,Connected:3},LoginState:{NONE:0,LOGGED_OUT:1,LOGGED_IN:2},ButtonCode:{None:-1,Left:0,Middle:1,Right:2},Direction:{Up:-1,None:0,Down:1},MessageAction:{Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenLinkedSettings:17,OpenGeneralSettings:18,OpenCalendarSettings:19},MessageType:{Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},MessageID:{Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,OldUserNewTrial:32,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,NeedGmailPermission:37,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,MissingOffline:41,MissingOfflineMobile:42,FlatSearchMultiSelect:43,FlatSearchEnter:44,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49,ReactError:50},SaveFlag:{None:0,Prop:1,Text:2,All:3},DateType:{Once:1,Repeat:2},StorageType:{InMemory:1,LocalStorage:2,IndexedDB:3},DataSource:{Paste:1,Drop:2,Plugin:3},PluginID:{Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar"},PluginSettingsID:{Moodo:{IsEnabled:"isEnabled"},Mailbird:{IsEnabled:"isEnabled"},Gmail:{IsEnabled:"isEnabled",ArchiveOnSchedule:"archiveOnSchedule",ArchiveOnOrganize:"archiveOnOrganize",InsertSignatureAboveReplies:"insertSignatureAboveReplies",WriteAccess:"writeAccess",SyncTime:"syncTime",SyncAccounts:"syncAccounts"},Drive:{IsEnabled:"isEnabled",WriteAccess:"writeAccess",LastChangeId:"lastChangeId",DriveRootId:"driveRootId"},GCalendar:{IsEnabled:"isEnabled",WriteAccess:"writeAccess",ImportCalendars:"importCalendars",ExportCalendar:"exportCalendar",WeeksPast:"weeksPast",WeeksFuture:"weeksFuture",DisplayOverdueInAgenda:"displayOverdueInAgenda",SyncNewEvents:"syncNewEvents",SyncDraggedEvents:"syncDraggedEvents",CreateLocalEvents:"createLocalEvents"}},PluginLoad:{None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},PluginDependency:{DemoMode:"DemoMode",GoogleLogin:"GoogleLogin",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess"},PluginRenderTypes:{Generic:0,StyledText:1,UnstyledText:2,Measure:3},PluginRenderers:{Unknown:-1,DriveFile:0,EmailThread:1,CalendarEvent:2},Modals:{ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode",Backups:"backups"},DisplayMode:{Default:0,InIframe:1,NoPaneHeaders:2,Invisible:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,PromptStart:4096,FullMin:8191},Checkpoint:{MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},PlatformConfig:{DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},AppPlatform:{iOS:0,Android:1,Embed:2,Electron:3},EmbedApps:{Mailbird:"mailbird"},DeployVariable:{Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},GScope:s,GScopeArray:[s.Calendar,s.CalendarRO,s.Contacts,s.Drive,s.DriveMetadataRO,s.DriveFull,s.DriveReadOnly,s.GmailCompose,s.GmailModify,s.TasksRO,s.UserInfoEmail,s.UserInfoProfile,s.DriveAppData,s.Plus],OnlineStatus:{Offline:-1,Connecting:0,Online:1},__jsVersion:"##VERSION##",__devServerURL:"##DEV_SERVER_URL##",__MAX_ERRORS_REPORTED:50,inputAccessoryViewID:"inputAccessoryView1",ProductName:"Moo.doAlpha",EncryptionSentinel:"MDsentinel",EncryptionKeys:{Global:"Global",User:"User",UserPassword:"UserPassword",Document:"Document"},PCMask:o.P0|o.P1|o.P2|o.Complete,PMask:o.P0|o.P1|o.P2,PriorityClass:(i={},n(i,o.None," "),n(i,o.P0," p0"),n(i,o.P1," p1"),n(i,o.P2," p2"),i),OverviewPaddingStart:32,OverviewPaddingIncrement:18,MobileItemIndentStart:30,ColorBrand:"#0099dd"};t.a=l},function(e,t,a){"use strict";var i=a(11),n=a(39),r=a(1),o=a(7);var s=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onResize=new n.a};function l(e){return(l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=function(e){function t(){var e,a,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,e=!(s=d(t).call(this))||"object"!==l(s)&&"function"!==typeof s?h(a):s,i.a.binder(h(h(e)),"normalizeKeys","getKeyCode"),e.versionRequired=[],e.versionAvailable=[],e.versionRequired[r.a.AppPlatform.iOS]=4,e.versionAvailable[r.a.AppPlatform.iOS]=6,e.versionRequired[r.a.AppPlatform.Android]=4,e.versionAvailable[r.a.AppPlatform.Android]=5,e.versionRequired[r.a.AppPlatform.Electron]=1,e.versionAvailable[r.a.AppPlatform.Electron]=1,e.versionMobile=2,e.versionDesktop=13,e.versionMobileMessages={},e.versionDesktopMessages={},e.appSubVersion=void 0,e.setDeployEnvironments(),e.appStoreLinks=[],e.appStoreLinks[r.a.AppPlatform.iOS]="https://itunes.apple.com/us/app/moo.do-organize-your-way/id889830074?ls=1&mt=8",e.appStoreLinks[r.a.AppPlatform.Android]="https://play.google.com/store/apps/details?id=moo.do",e.appStoreLinks[r.a.AppPlatform.Electron]="https://github.com/MooDoApp/MooDoApp.github.io/releases/latest",e.appReviewLinks=[],e.appReviewLinks[r.a.AppPlatform.iOS]=void 0,e.appReviewLinks[r.a.AppPlatform.Android]=void 0,e.appReviewLinks[r.a.AppPlatform.Electron]=void 0,e.appPlatform=void 0,e.appStoreLink=void 0,e.appReviewLink=void 0,e.requireCustomRedirect=!1,e.requireCustomPurchase=!1,e.requireCustomPaypal=!1,e.bodyClass=void 0,e.b=document.documentElement,e.orientation=r.a.Orientation.Portrait,e.onResize=new n.a,e.kbsizePortrait=Math.ceil(e.getActualWindowHeight()/2),e.kbsizeLandscape=void 0,e.kbsize=new o.a(e.kbsizePortrait),e.appState=void 0,e.isHosted=!1,e.hostedBy=void 0,e.initStorageQuota={quota:NaN,usage:NaN},e.isNearStorageQuota=!1,e.pageVisibilityHidden=void 0,e.pageVisibilityChange=void 0,e._allowNativeNotifications=!0,e.isDevURL="localhost"===window.location.hostname||"dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,e.isBeta="beta.moo.do"===window.location.hostname,e._features={},e.init(),e._windowWidth=new o.a(e.getActualWindowWidth()),e._windowHeight=new o.a(e.getActualWindowHeight()),e.app&&(e.customRedirectState={app:!0,appv:e.appv,webview:e.getAppState("webview")}),e.app||e.android?e.keyboardOpenTime=200:e.winphone?e.keyboardOpenTime=200:e.mobileie?e.keyboardOpenTime=600:e.keyboardOpenTime=0,e}var f,p,g;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,s),f=t,(p=[{key:"getDeployVar",value:function(e){return this.deployEnvironment[e]}},{key:"setDeployEnvironments",value:function(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[r.a.DeployVariable.Environment]="dev",this.deployEnvironment[r.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[r.a.DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[r.a.DeployVariable.Environment]="beta",this.deployEnvironment[r.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[r.a.DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[r.a.DeployVariable.Environment]="local",this.deployEnvironment[r.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[r.a.DeployVariable.APIHost]="//api-dev.moo.do"):(this.deployEnvironment[r.a.DeployVariable.Environment]=this.isMobile?"mobile":"web",this.deployEnvironment[r.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[r.a.DeployVariable.APIHost]="//api.moo.do")}},{key:"getKBSize",value:function(){var e=this.kbsize.get();return!e||isNaN(e)||e<100?400:e}},{key:"setKBSize",value:function(e){this.kbsize.set(+e)}},{key:"windowWidth",value:function(){if(!this._windowWidth.get()){var e=a(0).default;e&&e.Assert&&e.Assert(!1,"Window width was not set",this._windowWidth.get(),this._windowHeight.get()),this._windowWidth.set(this.getActualWindowWidth())}return this._windowWidth.get()}},{key:"windowHeight",value:function(){if(!this._windowHeight.get()){var e=a(0).default;e&&e.Assert&&e.Assert(!1,"Window height was not set",this._windowWidth.get(),this._windowHeight.get()),this._windowHeight.set(this.getActualWindowHeight())}return this._windowHeight.get()}},{key:"setWindowSize",value:function(e,t){this._windowWidth.set(e),this._windowHeight.set(t)}},{key:"getLocaleInfo",value:function(e){try{e.lang=navigator.language||navigator.userLanguage}catch(t){e.lang="EXCEPTION"}}},{key:"getPlatformInfo",value:function(e){e.os=this.OSName,e.browser=this.browser,e.majorVersion=this.majorVersion,e.minorVersion=this.minorVersion,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.requireCustomRedirect=this.requireCustomRedirect,e.requireCustomPurchase=this.requireCustomPurchase,e.requireCustomPaypal=this.requireCustomPaypal,e.isMobile=this.mobile,e.isMobileBrowser=this.isMobileBrowser,e.isPhone=this.phone,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.kbsize=this.kbsize.get(),e.appState=this.appState,e.isHosted=this.isHosted,e.hostedBy=this.hostedBy,e.embed=this.embed,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent,e.referrer=document.referrer,e.devicePixelRatio=window.devicePixelRatio,e.pageVisibilityChange=!!this.pageVisibilityChange,e.appSubVersion=this.appSubVersion,e.initStorageQuota=this.initStorageQuota,e.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(e)}},{key:"getUserPlatformConfig",value:function(){var e=r.a.PlatformConfig.Unknown,t=location.pathname.replace(/\//g,"")+(this.isBeta?",beta":"");if(this.app)switch(this.appPlatform){case r.a.AppPlatform.iOS:e=r.a.PlatformConfig.iOSApp;break;case r.a.AppPlatform.Android:e=r.a.PlatformConfig.AndroidApp;break;case r.a.AppPlatform.Electron:e="Windows"===this.OSName?r.a.PlatformConfig.ElectronWindows:"MacOS"===this.OSName?r.a.PlatformConfig.ElectronMac:r.a.PlatformConfig.ElectronUnknown;break;case r.a.AppPlatform.Embed:e=this.mobile?r.a.PlatformConfig.EmbedMobileApp:r.a.PlatformConfig.EmbedDesktopApp}else switch(this.OSName){case"Windows":e=this.phone?r.a.PlatformConfig.WinPhoneBrowser:r.a.PlatformConfig.DesktopWindows;break;case"iPad":case"iPod":case"iPhone":e=r.a.PlatformConfig.iOSBrowser;break;case"MacOS":e=r.a.PlatformConfig.DesktopMac;break;case"Android":e=r.a.PlatformConfig.AndroidBrowser;break;case"ChromeOS":case"Linux":default:e=this.phone?r.a.PlatformConfig.MobileOther:r.a.PlatformConfig.DesktopOther}return e+=","+t}},{key:"getAppDownloadURL",value:function(){return this.appDownloadUrl||(this.ios?this.appDownloadUrl=this.appStoreLinks[r.a.AppPlatform.iOS]:this.android?this.appDownloadUrl=this.appStoreLinks[r.a.AppPlatform.Android]:this.appDownloadUrl="https://www.moo.do/download/"),this.appDownloadUrl||"https://github.com/MooDoApp/MooDoApp.github.io/releases/latest"}},{key:"supportsNativeApp",value:function(){switch(this.OSName){case"Windows":case"MacOS":return!this.mobile;default:return!1}}},{key:"isNativeApp",value:function(){return this.appPlatform===r.a.AppPlatform.Electron}},{key:"isNativeMac",value:function(){return this.isNativeApp()&&this.mac}},{key:"isNativeMacFullscreen",value:function(){return this.isNativeApp()&&this.mac&&!window.screenTop&&!window.screenY}},{key:"canDownloadNativeApp",value:function(){return this.supportsNativeApp()&&!this.isNativeApp()}},{key:"init",value:function(){var e=this;this.initAppState(),this.initHostState(),this.initFeatures();var t,n,o=navigator.userAgent,s="";if(this.OSName="Unknown OS",this.app&&(s+=" app"),-1!==o.indexOf("Win")?(this.OSName="Windows",this.windows=!0,-1!==o.indexOf("Windows Phone")?(this.phone=!0,this.touch=!0,this.mobile=!0):this.appStoreLink=this.appStoreLinks[r.a.AppPlatform.Electron]):-1!==o.indexOf("iPad")?(this.OSName="iPad",this.ios=!0,this.ipad=!0,this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[r.a.AppPlatform.iOS],this.app&&(this.appPlatform=r.a.AppPlatform.iOS)):-1!==o.indexOf("iPhone")?(this.OSName="iPhone",this.ios=!0,this.iphone=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[r.a.AppPlatform.iOS],this.app&&(this.appPlatform=r.a.AppPlatform.iOS)):-1!==o.indexOf("iPod")?(this.OSName="iPod",this.ios=!0,this.ipod=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[r.a.AppPlatform.iOS],this.app&&(this.appPlatform=r.a.AppPlatform.iOS)):-1!==o.indexOf("Mac")?(this.OSName="MacOS",this.mac=!0,this.appStoreLink=this.appStoreLinks[r.a.AppPlatform.Electron]):-1!==o.indexOf("X11")?-1!==o.indexOf("CrOS")?(this.OSName="ChromeOS",this.chromeOS=!0):(this.OSName="UNIX",this.unix=!0):-1!==o.indexOf("Android")?(this.OSName="Android",this.android=!0,this.touch=!0,this.mobile=!0,this.phone=!0,this.appStoreLink=this.appStoreLinks[r.a.AppPlatform.Android],this.app&&(this.appPlatform=r.a.AppPlatform.Android),s+=" android"):-1!==o.indexOf("Linux")&&(this.OSName="Linux",this.linux=!0),this.ios){if(this.ios7=-1!==o.indexOf("OS 7"),this.ios70=-1!==o.indexOf("OS 7_0"),this.ios71=-1!==o.indexOf("OS 7_1"),this.ios10=-1!==o.indexOf("OS 10"),this.ios11=-1!==o.indexOf("OS 11"),this.appState)"ioswk"===this.appState.webview?this.ioswk=!0:this.iosui=!0,this.appState.oauth&&this._enableFeature(r.a.Feature.OAuth);this.ios7&&(s+=" ios7")}(this.majorVersion=1e3,this.minorVersion=1e3,-1!==o.indexOf("MSIE")||-1!==o.indexOf("Trident"))?(this.browser="Trident",this.ie=!0,this.winphone=!!o.match(/IEMobile/i),null!==(this.winphone||"Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(o)?this.majorVersion=parseFloat(RegExp.$1):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(o)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==o.indexOf("Chrome")||-1!==o.indexOf("CriOS")?(this.browser="Chrome",this.isChrome=!0,null!==new RegExp("Chrome/([0-9]{1,}).").exec(o)&&(this.majorVersion=parseFloat(RegExp.$1)),-1!==o.indexOf("Edge")&&(this.ieEdge=!0),this.app&&this.appPlatform!==r.a.AppPlatform.Android&&(this.requireCustomPaypal=!0)):-1!==o.indexOf("Android")?(this.browser="Native Android",null!==new RegExp("Linux; Android ([0-9]{1,}).([0-9]{1,}).").exec(o)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))):-1!==o.indexOf("Firefox")?(this.browser="Firefox",this.isFirefox=!0,null!==new RegExp("Firefox/([0-9]{1,}).").exec(o)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==o.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName?(this.browser="Safari",this.safari=!0,null!==(this.mobile?new RegExp("OS ([0-9]{1,})_([0-9]{1,})"):new RegExp("Version/([0-9]{1,}).([0-9]{1,}).")).exec(o)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))):-1!==o.indexOf("Opera")&&(this.browser="Opera");if(o.indexOf("Electron")>=0&&o.indexOf(r.a.ProductName)>=0){if(this.app=!0,this.appPlatform=r.a.AppPlatform.Electron,s+=" electron",null!==new RegExp("Moo\\.do/([^\\s]+)\\s").exec(navigator.userAgent)){var l,u=function(e,t){for(var a=0,i=e.split("."),n=t.split("."),r=0;r<3;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=+i[r],s=+n[r];if(o>s)return 1;if(s>o)return-1;if(!isNaN(o)&&isNaN(s))return 1;if(isNaN(o)&&!isNaN(s))return-1}return 0},d=RegExp.$1;u(d,"1.1.3")<=0&&setTimeout(function(){var t=a(0).default;a(3).default.toasts.pushMessage({text:"A new version of this app is available with important fixes. Future versions will update themselves, but please download this one manually.",hold:!0,holdOnAction:!0,actionText:"DOWNLOAD",action:function(){t.openUrl(e.getAppDownloadURL())}})},2e3),l=u(d,"1.1.0")>=0?2:1,this.appv=l}this.mac&&(s+=" electronMac"),this.appState||(this.appState={}),this.appState.appType||(this.appState.appType="electron"),this.appStoreLink=this.appStoreLinks[r.a.AppPlatform.Electron],this.requireCustomPurchase=!0,this._enableFeature(r.a.Feature.OAuth)}if(this.appReviewLink=this.appReviewLinks[this.appPlatform],this.isTouchDevice=!!("ontouchstart"in window||navigator.msMaxTouchPoints),this.isMobileBrowser=this.checkMobileBrowser(),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.useCustomScroller=!!this.iosui,this.isTouchDevice&&this.isMobileBrowser&&(this.usePointerEvents?(this.touchStartEvent="MSPointerDown",this.touchMoveEvent="MSPointerMove",this.touchEndEvent="MSPointerUp",this.touchCancelEvent="MSPointerCancel"):(this.touchStartEvent="touchstart",this.touchMoveEvent="touchmove",this.touchEndEvent="touchend",this.touchCancelEvent="touchcancel")),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),i.a.hasURLParam("touch","false")?(this.touch=!1,this.phone=!1,this.mobile=!1,this.ios=!1,this.android=!1):(this.isTouchDevice&&this.isMobileBrowser||i.a.hasURLParam("touch","true"))&&(this.touch=!0,this.phone=!0,this.mobile=!0),this.windows&&(s+=" windows",this.ie&&(s+=" ie",this.demo||(this.mobro=this.isMobro()))),"Firefox"===this.browser&&(s+=" firefox"),this.safari&&(s+=" safari"),this.phone&&(s+=" phone"),this.ipad&&(s+=" ipad"),this.embed===r.a.EmbedApps.Mailbird&&(s+=" mailbird",this.isMailbirdSidebar()&&(s+=" mailbirdSidebar")),this.demo&&(s+=" demoMode"),this.mobileie=this.ie&&this.mobile,this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"\u2318":"ctrl",this.priModKey=this.mac?"\u2318":"Ctrl",this.secModKeyForce=this.mac?"\u2303":"Alt",this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app||this.mobro)&&(this.requireCustomRedirect=!0),s&&s.length>0&&(this.bodyClass=s,this.b.className+=s),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!(this.ie||this.ieEdge||this.ios10||this.ios11),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),this.isMobile=this.mobile,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){clearTimeout(e)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),"undefined"!==typeof document.hidden?(t="hidden",n="visibilitychange"):["moz","ms","webkit"].forEach(function(e){if("undefined"!==document[e+"Hidden"])return t=e+"Hidden",n=e+"visibilitychange",!1}),void 0!==t&&(this.pageVisibilityHidden=t,this.pageVisibilityChange=n),this.initRedirectString(),this.supportsEstimatedStorage()){this.estimateAvailableStorage(function(e){this.initStorageQuota=e,e.usage/e.quota>.9&&(this.isNearStorageQuota=!0)}.bind(this),function(){})}}},{key:"updateBodyClass",value:function(){this.bodyClass&&(document.body.className+=this.bodyClass)}},{key:"supportsNotifications",value:function(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()}},{key:"supportsNativeNotifications",value:function(){var e=!1;return this._allowNativeNotifications&&(this.app&&this.appPlatform!==r.a.AppPlatform.Electron?(this.ios||this.android||this.isChrome)&&(e=!0):this.embed===r.a.EmbedApps.Mailbird&&(e=!0)),e}},{key:"supportsHTML5Notifications",value:function(){return"Notification"in window}},{key:"usesHTML5Notifications",value:function(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()}},{key:"hasNotificationPermission",value:function(){return!this.usesHTML5Notifications()||"granted"===Notification.permission}},{key:"disallowNativeNotifications",value:function(){this._allowNativeNotifications=!1}},{key:"supportsPersistedStorage",value:function(){var e=!1;return"storage"in navigator&&"persist"in navigator.storage&&(e=!0),e}},{key:"requestStoragePersistence",value:function(e,t){navigator.storage.persisted().then(function(a){a?e():navigator.storage.persist().then(e,t)})}},{key:"isStoragePersisted",value:function(e){this.supportsPersistedStorage()?navigator.storage.persisted().then(e):setTimeout(e,0,!1)}},{key:"supportsNativePromises",value:function(){return!!window.Promise}},{key:"supportsEstimatedStorage",value:function(){var e=!1;return"storage"in navigator&&"estimate"in navigator.storage?e=!0:"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage&&(e=!0),e&&this.supportsNativePromises()}},{key:"estimateAvailableStorage",value:function(e,t){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(e,t):setTimeout(t,0)}},{key:"_estimateAvailableStorage",value:function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise(function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t,a){e({usage:t,quota:a})},t)}):Promise.resolve({usage:NaN,quota:NaN})}},{key:"supportsWebworkers",value:function(){var e=!1;return window.Worker&&(e=!0),e}},{key:"supportsNativeDownload",value:function(){return this.isNativeApp()&&this.appv>=2}},{key:"supportsIDBWebworkers",value:function(){var e=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":e=this.majorVersion>=37;break;case"Chrome":e=this.majorVersion>=24}return e}},{key:"supportsPassiveListeners",value:function(){if(void 0===this._supportsPassiveListeners){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(a){}this._supportsPassiveListeners=e}return this._supportsPassiveListeners}},{key:"addPassiveListener",value:function(e,t,a){this.supportsPassiveListeners()?e.addEventListener(t,a,{passive:!0}):e.addEventListener(t,a)}},{key:"isMobro",value:function(){var e,t=null;try{new ActiveXObject("")}catch(a){e=a.name}try{t=!!new ActiveXObject("htmlfile")}catch(a){t=!1}return!(t="ReferenceError"===e||!1!==t)}},{key:"normalizeKeys",value:function(e){void 0!==e.normCode&&(e.synthetic||e instanceof KeyboardEvent)||(e.normCode=this.getKeyCode(e))}},{key:"getKeyCode",value:function(e){var t;return 46===(t=null===e.keyCode||0===e.keyCode?null!==e.charCode?e.charCode:e.which:e.keyCode)&&"keypress"===e.type&&(t=190),t}},{key:"initAppState",value:function(){var e=location.hash.substring(1);if(e)for(var t,n=0,r=/([^&=]+)=([^&]*)/g;null!==(t=r.exec(e));){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if("state"===decodeURIComponent(t[1])){var o=decodeURIComponent(t[2]);if(o){try{e=JSON.parse(o)}catch(l){var s=a(0).default;s.log("Error parsing AppState: ",o),s.reportError(l),e=void 0}e&&(this.app=!0===e.app,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.syncContacts=e.syncContacts,this.test=e.test,this.embed=e.embed,this.appState=e)}break}}this.live=this.live||i.a.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||this.test||i.a.hasURLParam("offline","true")||!1,this.demo=i.a.hasURLParam("demo","true")||!1,this.script=i.a.hasURLParam("script"),this.app=this.app||!1}},{key:"getAppState",value:function(e){return this.appState?this.appState[e]:void 0}},{key:"_enableFeature",value:function(e){this._features[e]=!0}},{key:"_disableFeature",value:function(e){this._features[e]=!1}},{key:"initFeatures",value:function(){this._enableFeature(r.a.Feature.ClonePane)}},{key:"isMailbirdSidebar",value:function(){return this.embed===r.a.EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")}},{key:"checkMobileBrowser",value:function(){var e,t=!1;if(this.android&&this.app)t=!0;else if(!this.embed&&(e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),!t)){window.matchMedia&&window.matchMedia("(max-device-width: 620px)").matches&&(t=!0)}return t}},{key:"initHostState",value:function(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)}},{key:"initRedirectString",value:function(){var e,t;e=this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone?window.location.host:"www.moo.do",t=this.app&&this.appPlatform===r.a.AppPlatform.Electron?"oauthRelay.html":"app/",this.customRedirectString=window.location.protocol+"//"+e+"/"+t}},{key:"addPrefix",value:function(e,t){var a="",i=["ms","webkit","moz","o"],n=this.b.style;if(t||(t=e),"string"===typeof n[e])a="";else for(var r=0,o=0;o<i.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if("string"===typeof n["-"+i[o]+"-"+t]){a=i[o];break}}var s=a.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;if(a){var l=a.length>0?a.charAt(0).toUpperCase()+a.slice(1):e;return{prop:"-"+a+"-"+t,style:a+s,react:l+s}}return{prop:e,style:s,react:s}}},{key:"blockClient",value:function(){if(this.isMobile&&!this.app)return{needsApp:!0};switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0};break;case"Safari":if(this.mobile&&this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};if(!this.mobile&&(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6))return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){a(0).default.log("App Version out of date.");var e={version:this.versionRequired[this.appPlatform]};return this.ios?(e.update=!0,e.platform="iOS App"):this.android?(e.update=!0,e.platform="Android App"):a(0).default.nativeBridge.sendToApp("updateRequired"),e}if(this.appv>this.versionAvailable[this.appPlatform])return a(0).default.log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0}}}},{key:"actionVerb",value:function(){return this.touch?"tap":"click"}},{key:"actionVerbCaps",value:function(){return this.touch?"Tap":"Click"}},{key:"updateOrientation",value:function(){return this.orientation=90===Math.abs(window.orientation)?r.a.Orientation.Landscape:r.a.Orientation.Portrait,this.app||this.kbsize.set(this.orientation===r.a.Orientation.Portrait?this.kbsizePortrait:this.kbsizeLandscape),this.orientation}},{key:"isPageVisible",value:function(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]}},{key:"getUpdateMessages",value:function(e){for(var t=0,a=[],i=this.mobile?"versionMobile":"versionDesktop",n=(e||0)+1;n<=this[i];n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this[i+"Messages"][n];r&&a.push(r)}return a}},{key:"isFeatureEnabled",value:function(e){return this._features[e]}},{key:"recordAppSubVersion",value:function(e){this.appSubVersion=e}},{key:"getPlatformName",value:function(){return this.mac?"Mac":this.windows?"Windows":this.iphone?"iPhone":this.ipad?"iPad":this.android?"Android":"Chrome"}},{key:"getPlatformIcon",value:function(){return this.mac||this.iphone||this.ipad?"icon-apple":this.windows?"icon-windows":this.android?"icon-android":"icon-chrome"}},{key:"getActualWindowWidth",value:function(){return document.body&&document.body.clientWidth||this.android&&window.screen&&window.screen.width||0}},{key:"getActualWindowHeight",value:function(){return document.body&&document.body.clientHeight||this.android&&window.screen&&window.screen.height||0}},{key:"hasBetaFeatures",value:function(){return this.isDevURL}},{key:"isPlatformOnline",value:function(){return navigator.onLine}}])&&u(f.prototype,p),g&&u(f,g),t}();t.a=new f},function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(1),r=a(90),o=a(14);function s(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l,u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._localized=[],this._loadedDateFormat=void 0}var t,a,r;return t=e,(a=[{key:"init",value:function(){var e=this,t=xo.settings.dateFormat.get()||n.a.DateFormat.MDY;this._loadLocalized(t),xo.settings.dateFormat.listen(function(t){e._loadLocalized(t||n.a.DateFormat.MDY),i.default.vmMain.parseAll(n.a.ChangeType.Auto),o.a.fireEvent("clearMeasureCacheAll",[]),xo.PaneUpdateBatcher.updateAllItems(!1,!0)})}},{key:"parseDate",value:function(e,t){return Date.parse(this.normalizeDateString(e,t))}},{key:"parseDateDefaultFormat",value:function(e){return Date.parse(this.normalizeDateString(e,this.getCurrentDateFormat()))}},{key:"getFormat",value:function(e){return i.default.Assert(this._localized[e],"Invalid format request"),this._localized[e]}},{key:"getCurrentDateFormat",value:function(){return this._loadedDateFormat||n.a.DateFormat.MDY}},{key:"_loadLocalized",value:function(e){this._loadedDateFormat=e,this._localized[n.a.DFormat.LongDayTime]="dddd h:mm tt",this._localized[n.a.DFormat.ShortTime]="h:mm tt",this._localized[n.a.DFormat.MonthDay]="MMM d",this._localized[n.a.DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[n.a.DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[n.a.DFormat.MonthDayLong]="MMMM d",this._localized[n.a.DFormat.MonthDayYearLong]="MMMM d, yyyy",e===n.a.DateFormat.MDY?(this._localized[n.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[n.a.DFormat.ShortDate]="MM/dd",this._localized[n.a.DFormat.MonthDayYear]="MM/dd/yy",this._localized[n.a.DFormat.MonthDayYearShort]="M/d/yy",this._localized[n.a.DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[n.a.DFormat.DayDate]="ddd M/d",this._localized[n.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[n.a.DFormat.MonthDayShort]="M/d"):e===n.a.DateFormat.DMY?(this._localized[n.a.DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[n.a.DFormat.ShortDate]="dd/MM",this._localized[n.a.DFormat.MonthDayYear]="dd/MM/yy",this._localized[n.a.DFormat.MonthDayYearShort]="d/M/yy",this._localized[n.a.DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[n.a.DFormat.DayDate]="ddd d/M",this._localized[n.a.DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[n.a.DFormat.MonthDayShort]="d/M"):e===n.a.DateFormat.DMYDot?(this._localized[n.a.DFormat.ShortDayTime]="dd.MM h:mm tt",this._localized[n.a.DFormat.ShortDate]="dd.MM",this._localized[n.a.DFormat.MonthDayYear]="dd.MM.yy",this._localized[n.a.DFormat.MonthDayYearShort]="d.M.yy",this._localized[n.a.DFormat.DayYearTime]="dd.MM.yy h:mm tt",this._localized[n.a.DFormat.DayDate]="ddd d.M",this._localized[n.a.DFormat.NoPadShortDayTime]="dd.M h:mm tt",this._localized[n.a.DFormat.MonthDayShort]="d.M"):e===n.a.DateFormat.YMD?(this._localized[n.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[n.a.DFormat.ShortDate]="MM/dd",this._localized[n.a.DFormat.MonthDayYear]="yy/MM/dd",this._localized[n.a.DFormat.MonthDayYearShort]="yy/M/d",this._localized[n.a.DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[n.a.DFormat.DayDate]="ddd M/d",this._localized[n.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[n.a.DFormat.MonthDayShort]="M/d"):e===n.a.DateFormat.YMDDot?(this._localized[n.a.DFormat.ShortDayTime]="MM.dd h:mm tt",this._localized[n.a.DFormat.ShortDate]="MM.dd",this._localized[n.a.DFormat.MonthDayYear]="yy.MM.dd",this._localized[n.a.DFormat.MonthDayYearShort]="yy.M.d",this._localized[n.a.DFormat.DayYearTime]="yy.MM.dd h:mm tt",this._localized[n.a.DFormat.DayDate]="ddd M.d",this._localized[n.a.DFormat.NoPadShortDayTime]="M.dd h:mm tt",this._localized[n.a.DFormat.MonthDayShort]="M.d"):i.default.Assert(!1,"Unsupport date format requested: "+e)}},{key:"formatDate",value:function(e,t,a){var n;if(i.default.Assert(i.default.isDateValid(e),"Must provide a valid date to format"),i.default.Assert(t,"Must provide a valid format for the date"),i.default.isDateValid(e)){var r=e.toString(this.getFormat(t));n=a&&a!==this._loadedDateFormat?this.convertDateFormat(r,this._loadedDateFormat,a):r}return n}},{key:"_isParsedDateValid",value:function(e,t,a){var n=!0,r=i.default.parseInt(e),o=i.default.parseInt(t),s=i.default.parseInt(a);return void 0!==e&&r<13?n=!1:o<=0||o>12?n=!1:(s<=0||s>31)&&(n=!1),n}},{key:"_detectDelim",value:function(e){var t="/";return e.indexOf("-")>=0?t="-":e.indexOf(".")>=0&&(t="."),t}},{key:"convertDateFormat",value:function(e,t,a){i.default.Assert(t,"Must provide a date format to convert from"),i.default.Assert(a,"Must provide a date format to convert to");var r=e;if(t!==a){var o,s,l=0;for(c.lastIndex=0,d.lastIndex=0,o=t===n.a.DateFormat.YMD?c:d;null!==(s=o.exec(r));){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var u,h,f,p,g=this._detectDelim(r);if(a===n.a.DateFormat.MDY)switch(t){case n.a.DateFormat.DMY:s[4]?(h=s[4],u=(f=s[3])+g+(p=s[2])+g+h):s[2]&&s[3]&&(u=(f=s[3])+g+(p=s[2]));break;case n.a.DateFormat.YMD:s[2]?(h=s[2],u=(f=s[3])+g+(p=s[4])+g+h):s[3]&&s[4]&&(u=(f=s[3])+g+(p=s[4]));break;default:i.default.Assert(!1,"Invalid date format requested from MDY: ",t)}else if(a===n.a.DateFormat.DMY)switch(t){case n.a.DateFormat.MDY:s[4]?(h=s[4],f=s[2],u=(p=s[3])+g+f+g+h):s[2]&&s[3]&&(f=s[2],u=(p=s[3])+g+f);break;case n.a.DateFormat.YMD:s[2]?(h=s[2],f=s[3],u=(p=s[4])+g+f+g+h):s[3]&&s[4]&&(f=s[3],u=(p=s[4])+g+f);break;default:i.default.Assert(!1,"Invalid date format requested from DMY: ",t)}else if(a===n.a.DateFormat.YMD)switch(t){case n.a.DateFormat.MDY:s[4]?u=(h=s[4])+g+(f=s[2])+g+(p=s[3]):s[2]&&s[3]&&(u=(f=s[2])+g+(p=s[3]));break;case n.a.DateFormat.DMY:s[4]?u=(h=s[4])+g+(f=s[3])+g+(p=s[2]):s[2]&&s[3]&&(u=(f=s[3])+g+(p=s[2]));break;default:i.default.Assert(!1,"Invalid date format requested from YMD: ",t)}else i.default.Assert(!1,"Invalid date format requested: ",a);u&&this._isParsedDateValid(h,f,p)&&(r=r.substr(0,s.index)+s[1]+u+r.substr(s.index+s[0].length))}}return r}},{key:"normalizeDateString",value:function(e,t){var a=e;return this.convertDateFormat(a,t,n.a.DateFormat.MDY)}},{key:"getAppendDateText",value:function(e,t,a){var r,o=Date.today();r=e<o||e.getFullYear()!==o.getFullYear()?this.getFormat(n.a.DFormat.MonthDayYearShort):this.getFormat(n.a.DFormat.MonthDayShort);var s=e.toString(r);if(t instanceof Date)r=0===t.getMinutes()?" htt":" h:mmtt",s+=t.toString(r);else if(i.default.isNumber(t)){var l=Math.floor(t),u=l%12;0===u&&(u=12),s+=" "+u+":"+i.default.pad2(60*(t-l))+(l>11?"pm":"am")}return isNaN(a)||(s+=" "+i.default.round(a,2)+"hr"),s}}])&&s(t.prototype,a),r&&s(t,r),e}(),d=/([\s]|^)(\d{1,2})[-\/.](\d{1,2})(?:[-\/.](\d{2,4}))?/g,c=/([\s]|^)(?:(\d{2,4})[-\/.])?(\d{1,2})(?:[-\/.](\d{1,2}))/g,h=u,f=a(2),p=a(42),g=a(16);function m(e){return(m="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t){return!t||"object"!==m(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var w=(k((l=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=y(this,_(t).call(this))).styles={},e.stylesheet={},e.Themes={SpacingCompact:{itemLineHeight:18,itemPadding:3,itemIndentSize:20,fontSizeHeader:16,fontSizeHeaderTopLevel:16},SpacingComfortable:{itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSizeHeader:16,fontSizeHeaderTopLevel:18},PrefixesFaded:{projectOpacity:30,bulletOpacity:30,checkboxOpacity:25,checkboxBackgroundOpacity:0},PrefixesStrong:{projectOpacity:80,bulletOpacity:80,checkboxOpacity:80,checkboxBackgroundOpacity:20}},e.Defaults={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,boldHeaders:!1,fontSize:14,showVerticalLines:!0,verticalLinesOpacity:6,Colors:{light:{bulletColor:"#222222",projectColor:"#222222",verticalLinesColor:32,tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{bulletColor:"#F6F6F6",projectColor:"#F6F6F6",verticalLinesColor:255,tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}},e.timeoutSettingChanged=void 0,e}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,p["a"]),a=t,(r=[{key:"init",value:function(){this.updateSettingValues(),f.a.mobile||(xo.settings.ui.listen(this.onSettingChanged),this.updateStyles())}},{key:"getSettingValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!t;if(t)if(xo.billingManager.hasPremiumFeatures())a=!0;else{var i=xo.billingManager.getPremiumStatus();a=i===n.a.PremiumStatus.Unknown||i===n.a.PremiumStatus.Trial||i===n.a.PremiumStatus.Active||i===n.a.PremiumStatus.Never}if(a){var r=xo.settings.ui[e].get();return r===this.Defaults.Desktop.Colors.light[e]?this.Defaults.Desktop.Colors[this._colorTheme][e]:r}return this.getThemeValue(e)}},{key:"getThemeValue",value:function(e){var t=this.Themes.SpacingComfortable[e];return void 0===t&&(t=this.Themes.PrefixesFaded[e]),void 0===t&&(t=this.Defaults.Desktop[e]),void 0===t&&(t=this.Defaults.Desktop.Colors[this._colorTheme][e]),t}},{key:"setFromThemeValue",value:function(e,t){xo.settings.ui[t].set(this.getThemeValue(t))}},{key:"updateSettingValues",value:function(){this._colorTheme=xo.settings.ui.theme.get(),this._bulletColor=this.Defaults.Desktop.Colors[this._colorTheme].bulletColor,this._projectColor=this.Defaults.Desktop.Colors[this._colorTheme].projectColor,this._verticalLinesColor=this.Defaults.Desktop.Colors[this._colorTheme].verticalLinesColor,this._boldHeaders=this.getSettingValue(n.a.DisplaySettings.boldHeaders),this._fontSize=this.getSettingValue(n.a.DisplaySettings.fontSize,!0),this._fontSizeHeader=this.getSettingValue(n.a.DisplaySettings.fontSizeHeader,!0),this._fontSizeHeaderTopLevel=this.getSettingValue(n.a.DisplaySettings.fontSizeHeaderTopLevel,!0),this._noteFontSize=this.getSettingValue(n.a.DisplaySettings.noteFontSize,!0),this._itemPadding=this.getSettingValue(n.a.DisplaySettings.itemPadding,!0),this._notePadding=this.getSettingValue(n.a.DisplaySettings.notePadding,!0),this._itemLineHeight=this.getSettingValue(n.a.DisplaySettings.itemLineHeight,!0),this._noteLineHeight=this.Defaults.Desktop.noteLineHeight,this._itemIndentSize=this.getSettingValue(n.a.DisplaySettings.itemIndentSize,!0),this._bulletOpacity=this.getSettingValue(n.a.DisplaySettings.bulletOpacity,!0),this._projectOpacity=this.getSettingValue(n.a.DisplaySettings.projectOpacity,!0),this._checkboxOpacity=this.getSettingValue(n.a.DisplaySettings.checkboxOpacity,!0),this._checkboxBackgroundOpacity=this.getSettingValue(n.a.DisplaySettings.checkboxBackgroundOpacity,!0),this._showVerticalLines=this.getSettingValue(n.a.DisplaySettings.showVerticalLines,!0),this._verticalLinesOpacity=this.getSettingValue(n.a.DisplaySettings.verticalLinesOpacity,!0),this._tagColor=this.getSettingValue(n.a.DisplaySettings.tagColor,!0),this._dateColor=this.getSettingValue(n.a.DisplaySettings.dateColor,!0),this._contactColor=this.getSettingValue(n.a.DisplaySettings.contactColor,!0),this._linkColor=this.getSettingValue(n.a.DisplaySettings.linkColor,!0),this._grayscale=this.getSettingValue(n.a.DisplaySettings.grayscale)}},{key:"onSettingChanged",value:function(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))}},{key:"_updateSettings",value:function(){var e=this._fontSize,t=this._fontSizeHeader,a=this._fontSizeHeaderTopLevel,n=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var r=this._fontSize!==e||this._fontSizeHeader!==t||this._fontSizeHeaderTopLevel!==a||this._noteFontSize!==n;this.fireEvent("settingsChanged",[r]),xo.PaneManager&&xo.PaneManager.clearPaneCaches(),this.updateStyles(),i.default.vmMain&&xo.PaneUpdateBatcher.updateAllItems(!1,!0)}},{key:"fontSize",value:function(){return f.a.isMobile?15:this._fontSize}},{key:"fontSizeHeader",value:function(){return this._fontSizeHeader}},{key:"fontSizeHeaderTopLevel",value:function(){return this._fontSizeHeaderTopLevel}},{key:"fontSizeHeaderProjectView",value:function(){return 17}},{key:"noteFontSize",value:function(){return this._noteFontSize}},{key:"itemPadding",value:function(){return this._itemPadding}},{key:"notePadding",value:function(){return this._notePadding}},{key:"itemLineHeight",value:function(){return this._itemLineHeight}},{key:"noteLineHeight",value:function(){return this._noteLineHeight}},{key:"itemIndentSize",value:function(){return this._itemIndentSize}},{key:"itemIndentStart",value:function(){return 45}},{key:"paddingForBlockHeader",value:function(){return 0}},{key:"paddingForItemBottom",value:function(e,t,a){return t.hasNote()?a&&a.isViewProject()&&a.isItemTopLevel(e,t)?this.itemPadding():0:this.itemPadding()}},{key:"paddingForItemTop",value:function(e,t){return t.isNote()?this.notePadding():this.itemPadding()}},{key:"fontSizeForItem",value:function(e,t,a){if(t.isPrefixHeader()){if(a.isItemTopLevel(e,t))return this.fontSizeHeaderTopLevel();if(a.isViewOutline())return this.fontSizeHeader()}else if(t.isNote())return this.noteFontSize();return this.fontSize()}},{key:"lineHeightForItem",value:function(e,t,a){var i=this.itemLineHeight()-this.fontSize();return t.isNote()?this.noteLineHeight():this.fontSizeForItem(e,t,a)+i}},{key:"boldHeaders",value:function(){return!!f.a.phone||this._boldHeaders}},{key:"createSheet",value:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.rel="stylesheet",e.appendChild(t),this.sheet=t.sheet}},{key:"changeColorTheme",value:function(e){e!==this._colorTheme&&(this._colorTheme=e,xo.settings.ui.theme.set(e),this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))}},{key:"changeTheme",value:function(e,t){this.isChangingTheme=!0;var a=this.Themes[t];for(var i in a)a.hasOwnProperty(i)&&xo.settings.ui[i].set(a[i]);e.set(t),this.isChangingTheme=!1,this._updateSettings()}},{key:"updateStyles",value:function(){var e=0;if(this.sheet){var t=this.sheet.ownerNode;t.parentNode.removeChild(t)}this.createSheet();var a=[];if(this.boldHeaders()&&a.push(".item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var n=this.itemIndentSize(),r=this._verticalLinesColor,o="rgba("+r+","+r+","+r+",",s=o+.01*this._verticalLinesOpacity+")",l=o+"0)";a.push(".vertLines { background: repeating-linear-gradient(to right, "+l+" 0, "+s+" 1px, "+l+" 2px, "+l+" "+n+"px) }")}a.push(".item:not(.hasNote) .line.last .itemPrefix:not(.prefixTask):before { bottom: "+this.itemPadding()+"px; }"),a.push(".item:not(.hasNote) .line.last .prefixTask:before { bottom: "+(this.itemPadding()+(this.itemLineHeight()-18)/2)+"px; }"),a.push(".item .prefixTask:before { margin-top: "+(this.itemLineHeight()-14)/2+"px; }");var u="rgba("+i.default.hexToRgbStr(this._bulletColor)+","+.01*this._bulletOpacity+")";a.push(".prefixBullet:before { color: "+u+"; }");var d="rgba("+i.default.hexToRgbStr(this._projectColor)+","+.01*this._projectOpacity+")";a.push(".prefixHeader:before { color: "+d+"; }"),a.push(".collapser { color: "+u+"; }");var c="rgba("+i.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxOpacity+")";a.push(".prefixTask { border-color: "+c+"; }");var h="rgba("+i.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxBackgroundOpacity+")";a.push(".prefixTask:not(.searchButton) { background-color: "+h+"; }"),a.push(".c-tag { color: "+this._tagColor+";}"),a.push(".c-date { color: "+this._dateColor+";}"),a.push(".c-contact { color: "+this._contactColor+";}"),a.push(".c-link, .fancyContenteditable a    { color: "+this._linkColor+";}"),a.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+this.Defaults.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }"),xo.settings.ui.underlineP.get()?i.default.addClass(document.body,"underlineTags"):i.default.removeClass(document.body,"underlineTags"),this._grayscale?i.default.addClass(document.body,"grayscale"):i.default.removeClass(document.body,"grayscale"),i.default.removeClass(document.body,"theme-light"),i.default.removeClass(document.body,"theme-dark"),i.default.addClass(document.body,"theme-"+this._colorTheme);for(var f=0;f<a.length;f++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sheet.insertRule(a[f],0)}}},{key:"tagColor",value:function(){return this._tagColor}},{key:"dateColor",value:function(){return this._dateColor}},{key:"contactColor",value:function(){return this._contactColor}},{key:"noteColor",value:function(){return""}},{key:"isDark",value:function(){return"dark"===this._colorTheme}},{key:"isItemBold",value:function(e){return!1}},{key:"lineItemHeight",value:function(e,t,a,n){return i.default.isNumber(n)&&!t.isNote()||(n=1),this.paddingForItemTop(e,t)+this.paddingForItemBottom(e,t,a)+this.lineHeightForItem(e,t,a)*n}}])&&v(a.prototype,r),o&&v(a,o),t}()).prototype,"onSettingChanged",[g.a],Object.getOwnPropertyDescriptor(l.prototype,"onSettingChanged"),l.prototype),k(l.prototype,"_updateSettings",[g.a],Object.getOwnPropertyDescriptor(l.prototype,"_updateSettings"),l.prototype),k(l.prototype,"updateStyles",[g.a],Object.getOwnPropertyDescriptor(l.prototype,"updateStyles"),l.prototype),l),S=a(11),I=a(12),D=a(15),C=a(5),P=a(17),A=a(6),M=a(28),T=a(34);function E(e){return(E="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function x(e,t){return!t||"object"!==E(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var F=a(36),N=a(35);function B(e){return(B="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function V(e,t){return!t||"object"!==B(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var z=a(43);function q(e){return(q="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e,t){return!t||"object"!==q(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var X=a(7),Q=a(24),J=a(39);function Z(){this._favMap={}}Z.prototype={_ensureGroup:function(e){var t=[];return this._favMap[e]||(this._favMap[e]=t),t},notifyAdd:function(e,t){var a=this._ensureGroup(t);i.default.Assert(a.indexOf(e)<0,"Should not double add item to group"),a.push(e)},notifyRemove:function(e,t){var a=this._ensureGroup(t);i.default.Assert(a.indexOf(e)>=0,"Must have been added to group before removing"),a.remove(e)},getItems:function(e){return this._favMap[e]},hasItems:function(e){var t=this.getItems(e);return t&&t.length>0}};var $,ee=new Z,te=a(56);function ae(e){return(ae="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ne=new Date(9e12),re=(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}(($=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),S.a.binder(this,"sizeInPane","onInsertLink","onTouchHoldTimeout"),"dragScroll"in this&&S.a.binder(this,"dragScroll"),this.__ISVMLI=!0,this.isInitialized=!1,i.default.Assert(a,"Each VMLI must be given a set of additional info"),i.default.Assert(i.default.isValidChangeType(a.changeType),"Must specify a valid change type when creating a VMLI"),i.default.Assert(a.store,"Must supply a valid itemStore for each VMLI"),i.default.Assert(!a.parent||a.parent._store===a.store,"All VMLIs in a tree must share the same owner"),this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1,!t.id&&t.data&&t.data.id?t.id=t.data.id:t.id&&t.data&&i.default.Assert(t.id===t.data.id,"If passing in a local id and a remote ID, they should match"),i.default.Assert(void 0===t.v,"We should never be passing in 'v'"),i.default.Assert(void 0===t.extern,"We should never be passing in 'extern'"),i.default.Assert(a.store,"Must specify a valid item store this item belongs to"),this._store=a.store,this._parent=a.parent,this._documentOwner=a.documentOwner,this._rawText=(t.data?"":t.text)||"",this._searchText=t.data?"":t.text?t.text.toLowerCase():"",this._parsedText=void 0,this._notePreviewText=void 0,this.els=void 0,this.id=void 0,this.index=t.index,this._isArchived=t.isArchived||!1,this.items=new Q.a([],this.itemsHasMutated),this._note=void 0,this.itemChanged=new J.a,this._demandLoadChildren=t.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=a.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._attachments=void 0,this.draggedInPane=new X.a;var r=t.flags;t.isNote&&(r|=n.a.VMLIFlag.Note),t.isComplete&&(r|=n.a.VMLIFlag.Complete),i.default.isDemoMode()&&(t.isStarred&&(r|=n.a.VMLIFlag.Starred),t.priority&&(r|=t.priority),t.isArchived),this.flags=new X.a(r),this.prefix=void 0,this._favorites=void 0,this.dateCreated=t.dateCreated?new Date(t.dateCreated):new Date,this.dateCompleted=t.dateCompleted?new Date(t.dateCompleted):void 0,this.dateModified=t.dateModified?new Date(t.dateModified):this.dateCreated,this._activeTags=void 0,this.isRoot=t.isRoot||a.isRoot,this._isDeleted=t.isDeleted||!1,this.highlightTimeout=void 0,this._version=n.a.UninitializedVersion,this._versionText=n.a.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new X.a(a.isEditable||!1),this.levelsDeep=new X.a(this._parent?this._parent.levelsDeep.get()+1:0),this.isHighlighted=new X.a,i.default.totalItems++,t.isArchived&&i.default.totalArchivedItems++,this._needsParse=!1,this.isLoaded=void 0,this.init(t,a),this.isInitialized=!0}var t,a,r;return t=e,(a=[{key:"getReactKey",value:function(){return this._store.id+this.id}},{key:"notifyDemandLoadUpdate",value:function(e,t){e&&!this._loadedOnDemandData&&(t.requestDemandLoadData(this),this.notifyLoadedData())}},{key:"notifyLoadedData",value:function(){this._loadedOnDemandData=!0}},{key:"notifyLoadDataFailed",value:function(e){this.setCollapsed(!1,e,!1),this._loadedOnDemandData=!1}},{key:"isDemandLoad",value:function(){return this._demandLoadChildren}},{key:"isDemandNotYetLoaded",value:function(){return this._demandLoadChildren&&!this._loadedOnDemandData}},{key:"showInOverview",value:function(){return this.numItems()>0||this._demandLoadChildren}},{key:"paginationTokenInUse",value:function(){return i.default.Assert(this._paginationToken,"Should always have a valid pagination token when beginning to load a data page"),this._paginationToken.isInUse()}},{key:"hasPaginationToken",value:function(){return!!(this.flags.get()&n.a.VMLIFlag.HasPageToken)}},{key:"needsPaginationToken",value:function(){return!this.hasPaginationToken()&&!this._paginationToken}},{key:"setPaginationToken",value:function(e){i.default.Assert(e,"Should never be setting an undefined token - use clear instead"),i.default.Assert(!this._paginationToken,"Should never be overriding a pagination token - clear then set"),this._paginationToken=e,this.setFlags(this.flags.get()|n.a.VMLIFlag.HasPageToken)}},{key:"clearPaginationToken",value:function(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0,this.setFlags(this.flags.get()&~n.a.VMLIFlag.HasPageToken)}},{key:"beginDataPageLoad",value:function(){return i.default.Assert(this._paginationToken,"Should always have a valid pagination token when beginning to load a data page"),i.default.Assert(!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load"),this._paginationToken.notifyBeginUse(),this._paginationToken}},{key:"endDataPageLoad",value:function(e){i.default.Assert(this._paginationToken,"Should always have a valid pagination token when done loading a data page"),i.default.Assert(this._paginationToken.isInUse(),"Token should always be in use when running a request"),e?this._paginationToken.notifyEndUse():this.setFlags(this.flags.get()&~n.a.VMLIFlag.HasPageToken)}},{key:"notifyPaginationUpdate",value:function(){i.default.Assert(this._paginationToken,"Must have a valid token to get next page of data"),this._paginationToken&&i.default.focusedPane.requestDataPage(this)}},{key:"canHaveNote",value:function(){var e=this.belongsToItemStore(xo.itemStoreManager.getDefaultItemStore()),t=this.belongsToItemStore(xo.itemStoreManager.getTempItemStore());return e||t}},{key:"createNote",value:function(){var e;return i.default.Assert(!this.isNote(),"Should never create a note on a note item"),this.hasNote()?e=this.getNote():(e=this._store.createItemRaw({text:"",isNote:!0},{parent:this,documentOwner:this._documentOwner,changeType:n.a.ChangeType.AllLocal}),this.setNote(e,n.a.ChangeType.Local)),e}},{key:"hasNote",value:function(){return void 0!==this._note}},{key:"getNote",value:function(){return i.default.Assert(this.hasNote(),"Must have a note to get one"),this._note}},{key:"setNote",value:function(t,a){i.default.Assert(i.default.isValidChangeType(a),"Must supply a valid changeType"),i.default.Assert(!t||this.belongsToSameItemStore(t),"Note must belong to the same item store"),i.default.Assert(!this.isNote(),"Should never set a note on a note"),i.default.Assert(!this._note||!t,"Should never set a note multiple times on a single item"),i.default.Assert(!t||t.isNote(),"Should only set items that are notes as notes"),i.default.Assert(!t||!t.isDeleted(),"Should note set a deleted note"),i.default.Assert(!t||t instanceof e,"Note must be a valid VMLI"),i.default.Assert(!t||t.parent()===this,"Should always have a valid parent set before setting note on item");var n=this._note;this._note=t,this.shouldSave()&&(A.e.beginAction(),I.a.setNote(this,t,n,a),A.e.endAction()),o.a.fireEvent("itemNoteSet",[{item:this}]),this.itemsHasMutated()}},{key:"isNote",value:function(e){if(void 0===e)return this._isFlagHelper(n.a.VMLIFlag.Note);if(e!==this._isFlagHelper(n.a.VMLIFlag.Note)){var t=e?this.flags.get()|n.a.VMLIFlag.Note:this.flags.get()&~n.a.VMLIFlag.Note;this.setFlags(t)}}},{key:"addFavorite",value:function(e,t){if(this._favorites||(this._favorites=[]),i.default.Assert(this._favorites.indexOf(e)>=0,"Must not already be in the favorites group"),this._favorites.push(e),ee.notifyAdd(this,e),this.shouldSave()){var a={favorites:this._favorites};I.a.saveItem(this,a,t,n.a.SaveFlag.Prop)}}},{key:"removeFavorite",value:function(e,t){if(i.default.Assert(this._favorites,"Must always have favorites defined before removing from item"),i.default.Assert(this._favorites.indexOf(e)>=0,"Must already be in the favorites group"),this._favorites.remove(e),ee.notifyRemove(this,e),this.shouldSave()){var a={favorites:this._favorites};I.a.saveItem(this,a,t,n.a.SaveFlag.Prop)}}},{key:"setFavorites",value:function(e,t){for(var a=0,r=0,o=(e||[]).removeArray(this._favorites),s=(this._favorites||[]).removeArray(e),l=0;l<s.length;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;ee.notifyRemove(this,s[l])}for(l=0;l<o.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;ee.notifyAdd(this,o[l])}if(this._favorites=e,this.shouldSave()){var u=0,d=[];for(l=0;l<e.length;l++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;d[l]=i.default.clone(e[l])}var c={favorites:d};I.a.saveItem(this,c,t,n.a.SaveFlag.Prop)}}},{key:"getFavorites",value:function(){return this._favorites}},{key:"shouldSave",value:function(){return this._shouldSave}},{key:"canDestroy",value:function(){return this._canDestroy}},{key:"getPadding",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;if(i.default.Assert(e&&e.getItem(),"Invalid pane"),this.isNote())return this.parent().getPadding(e,t,a);if(isNaN(a)){var n;if(t)n=1;else if(e.isSearchedFlat()){for(var r=0,o=this;o;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e.search.isFlatSearchResult(o)){n=o.levelsDeep.get()-1;break}o=o.parent()}i.default.Assert(!isNaN(n),"Item has no root depth",!!this.parent()),isNaN(n)&&(n=1)}else n=e.getItem().levelsDeep.get();a=this.levelsDeep.get()-n-(t?e.overviewPadLevels:1)}return this.getPaddingForLevel(a,e,t)}},{key:"getPaddingForLevel",value:function(e,t,a){var r;return e=Math.max(e,0),r=a?n.a.OverviewPaddingStart+e*n.a.OverviewPaddingIncrement:xo.DisplaySettings.itemIndentStart()+e*xo.DisplaySettings.itemIndentSize(),i.default.Assert(i.default.isNumber(r),"Must have a valid padding"),r}},{key:"_updateStylePadding",value:function(e,t){i.default.Assert(this._parent,"Must have a valid parent to update padding, root should never change");var a=e+(this.isNote()?0:1),n=this.levelsDeep.get()!==a;if(n||t){var r=0;n&&this.levelsDeep.set(a);for(var o=this.getItems(),s=0;s<o.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;o[s]._updateStylePadding(a,t)}}}},{key:"setFlags",value:function(e){this.flags.set(e)}},{key:"getPriorityProps",value:function(){var e=this.flags.get();return n.a.PriorityClass[e&n.a.PMask]+" "}},{key:"styleProps",value:function(e,t){var a=this.flags.get(),i=this.isHeader()&&!t.isSearchedFlat()?"pHeader ":"";this.isPrefixHeader()?i+="itemHeader ":this.isPrefixTask()?i+="itemTask ":this.isPrefixBullet()?i+="itemBullet ":this.isPrefixNumList()&&(i+="itemNumList "),this.prefix&&(i+="hasPrefix "),t.isItemTopLevel(e,this)&&(i+="topLevel ");var r=!1;if(a&n.a.VMLIFlag.Complete?r=!0:!(a&n.a.VMLIFlag.Note)&&a&n.a.VMLIFlag.DisplayComplete&&(r=!0),r?(i+="pComplete ",t.search.isMatchStuckHiding(this)||(i+="pDisplayComplete c-foreground-super-faded c-before-super-faded ")):a&n.a.PMask?i+=n.a.PriorityClass[a&n.a.PMask]+" ":i+="pNormal ",a&n.a.VMLIFlag.Starred&&!(a&n.a.VMLIFlag.Complete||a&n.a.VMLIFlag.DisplayComplete)&&(i+="pStar c-star "),a&n.a.VMLIFlag.Note){i+="pNote c-foreground-faded ";var o=this.parent().flags.get();(o&n.a.VMLIFlag.Complete||o&n.a.VMLIFlag.DisplayComplete)&&(i+="pComplete c-foreground-super-faded c-before-super-faded "),o&n.a.PMask&&(i+=n.a.PriorityClass[o&n.a.PMask]+" "),o&n.a.VMLIFlag.Starred&&!(o&n.a.VMLIFlag.Complete||o&n.a.VMLIFlag.DisplayComplete)&&(i+="pStar c-star ")}var s=this.getAttachments();if(s)for(var l=0,u=0;u<s.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=s[u];if(d.isLoaded()){var c=d.getPlugin().getCssClass(d,t);c&&(i+=c)}}return i}},{key:"onAttachmentIDChange",value:function(e,t){if(e.getPlugin().id===n.a.PluginID.GCalendar){var a=this.getMooDate();a&&(a.setGCalId(e.id),this.onMooDateUpdated(n.a.ChangeType.Local))}this.setText(this.getParsedText(),!0,n.a.ChangeType.Local)}},{key:"onAttachmentUpdate",value:function(e,t,a){e.fieldsHaveParseEffect(t)&&(o.a.fireEvent("clearMeasureCacheItem",[this.id]),this.parseText(!0,a),N.a.beginBatch(this),N.a.itemTextChanged(this))}},{key:"setAttachments",value:function(e,t,a){var i=!1;if(!this._attachments&&e&&(this._attachments=[]),this._attachments){for(var r=0,o=0,s=this._attachments,l=0;l<s.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.indexOf(s[l])<0&&(s[l].unsubscribe(this),s[l].notifyItemTextChanged(this,!0),this.shouldSave()&&s[l].markUnused(t),i=!0)}for(l=0;l<e.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=e[l];if(s.indexOf(u)<0){if(u.shouldBeDeleted()){var d=u.getEmbedString(),c=this.getRawText().replace(d,"File failed to upload");return void this.setText(c,!0,n.a.ChangeType.Local)}u.subscribe(this),this.shouldSave()&&u.markInUse(t),i=!0}}i&&(this._attachments=e)}i&&!1!==a&&this.itemChanged.notify()}},{key:"getAttachment",value:function(e){if(i.default.Assert(this._attachments,"Must have valid attachments in order to query"),this._attachments)return this._attachments[e]}},{key:"hasAttachment",value:function(e){if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[a].id===e)return!0}return!1}},{key:"hasPluginAttachment",value:function(e){if(i.default.Assert(e,"Must provide a valid plugin type to query"),this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[a].getPlugin().id===e)return!0}return!1}},{key:"getAttachmentByType",value:function(e){if(i.default.Assert(e,"Must provide a valid plugin type to query"),this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._attachments[a];if(n.isType(e))return n}}},{key:"getAttachmentByPlugin",value:function(e){if(i.default.Assert(e,"Must provide a valid plugin type to query"),this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._attachments[a];if(n.isPlugin(e))return n}}},{key:"getAttachments",value:function(){if(this._attachments&&this._attachments.length>0)return this._attachments}},{key:"hasAttachments",value:function(){return this._attachments&&this._attachments.length>0}},{key:"getNumAttachments",value:function(){return this._attachments?this._attachments.length:0}},{key:"hasAttachmentType",value:function(e){return xo.pluginManager.hasAttachmentType(this,e)}},{key:"copyProperties",value:function(e){this.setStarred(e.isStarred(),n.a.ChangeType.Auto),this.setComplete(e.isComplete(),n.a.ChangeType.Auto),this.setPriority(e.priority(),n.a.ChangeType.Auto)}},{key:"moveNote",value:function(e,t){i.default.Assert(e.hasNote(),"Must have a note to move"),i.default.Assert(!this.hasNote(),"Must not already have a note");var a=e.getNote();e.setNote(void 0,t),a&&(a.setParent(this),this.setNote(a,t))}},{key:"parent",value:function(){return this._parent}},{key:"setParent",value:function(e){var t=this._parent;return this._parent=e,e&&e!==t&&this._updateStylePadding(this._parent.levelsDeep.get(),!1),this._parent}},{key:"getParser",value:function(){var e,t=this.getItemStore();return t&&(e=t.getParser()),e}},{key:"requireStoredEls",value:function(){var e=this.getItemStore();return!!e&&e.requireStoredEls()}},{key:"getItemStore",value:function(){return i.default.Assert(this._store,"Should never be getting the item store from a destroyed VMLI"),this._store}},{key:"belongsToSameItemStore",value:function(e){return this.getItemStore()===e.getItemStore()}},{key:"belongsToItemStore",value:function(e){return this.getItemStore()===e}},{key:"notifyItemPropertyChanged",value:function(e,t){if(this.hasAttachments())for(var a=0,i=this.getAttachments(),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n].notifyItemPropertyChanged(this,e,t)}}},{key:"unArchiveIntoItem",value:function(e,t){this._documentOwner.unArchiveItem(this,e,t)}},{key:"archiveSelf",value:function(e){this._documentOwner.archiveItem(this,e)}},{key:"isArchived",value:function(e,t){return this._isArchived}},{key:"isHidden",value:function(e){return i.default.Assert(e,"Must specify the pane for the item being checked"),i.default.Assert(!e||e.search,"Pane search obj must exist: ",e.isDestroyed()),!(!e||!e.search)&&!e.search.isMatched(this)}},{key:"getRawText",value:function(){return this._rawText}},{key:"getParsedText",value:function(){return i.default.Assert(!1===this._needsParse,"Text should be parsed before calling get"),void 0!==this._parsedText?this._parsedText:this._rawText}},{key:"getSearchText",value:function(e){if(e){var t=e.search.getItemSearchText(this);if(t)return t}return i.default.Assert(void 0!==this._searchText,"Item should always have search text"),this._searchText}},{key:"setRawText",value:function(e){void 0!==e&&null!==e||(e=""),i.default.Assert(e.indexOf(n.a.AttachChar)<0,"Should never have an AttachChar present in raw text"),this._rawText=e,this._searchText=this.generateSearchText(),this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0}},{key:"setParsedText",value:function(e){this._parsedText=e,this._needsParse=!1,this._searchText=this.generateSearchText()}},{key:"generateSearchText",value:function(){var e=this.getParsedTextWithoutPrefix().toLowerCase();return this.hasAttachments()?this._generateUsableText(e,"getTitleString").replace(/[\*_]/g,"").toLowerCase():e}},{key:"priority",value:function(e){if(e){var t=e.search.getItemPriority(this);if(void 0!==t)return t}return this.flags.get()&n.a.PMask}},{key:"setPriority",value:function(e,t){i.default.Assert(i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t),i.default.Assert(null===e||n.a.PriorityClass[e],"Priority must be defined in globals");var a=this.priority();if(e!==a){var r=this.flags.get(),o=r&~n.a.PCMask|e;if(r&n.a.VMLIFlag.Complete&&(o&=~n.a.VMLIFlag.Complete),this.setFlags(o),this.shouldSave()){var s={flags:o};I.a.saveItem(this,s,t,n.a.SaveFlag.Text)}this.notifyItemPropertyChanged(t,"priority"),N.a.itemSearchChanged(this),A.e.performAction(A.c.Update,{itemID:this.id,field:"priority",newValue:e,oldValue:a})}}},{key:"isScheduled",value:function(){return!!this._date}},{key:"getDuration",value:function(e,t){if(e){var a=e.search.getItemDuration(this);if(a)return a}if(this._date)return this._date.duration||n.a.DefaultEventDuration}},{key:"setDuration",value:function(e){this._date?this._date.setDuration(e):this._date=new z.a(void 0,{duration:e})}},{key:"getEndDate",value:function(e){if(this._date)return this._date.getEnd()}},{key:"isMultidayEvent",value:function(){var e=!1;if(this.getDate()&&this.getDuration()>0){var t=this.getEndDate();this.getDate().isSameDay(t)||(e=!0)}return e}},{key:"getStickySearchInfo",value:function(){return{prefix:this.getPrefix(),date:this.getDate(),duration:this.getDuration(),tagsLower:this.getTagsLower(),contacts:this.getContacts(),searchText:this.getSearchText(),priority:this.priority(),isComplete:this.isComplete(),isStarred:this.isStarred()}}},{key:"onMooDateUpdated",value:function(e){var t=this;if(xo.timeline.updateNotifications(this),i.default.isFlagSet(e,n.a.ChangeType.ItemLoad)||N.a.itemDateChanged(this),this.itemChanged.notify(),this.shouldSave()||this._attachments){var a={date:this._date?this._date.toData():null};i.default.timeoutOnce("setMooDate",function(){t.shouldSave()&&I.a.saveItem(t,a,e,n.a.SaveFlag.Text),t._attachments&&t._attachments.forEach(function(e){e.getPlugin().id===n.a.PluginID.GCalendar&&e.notifyItemDateChanged(t)})},500)}}},{key:"setMooDate",value:function(e,t,a){this._date&&e?this._date.copyFrom(e):this._date=e,!1!==a&&(this.onMooDateUpdated(t),i.default.isLocalChange(t)&&A.e.miscAction({type:A.c.Misc,misc:A.a.ChangeDate,data:{itemID:this.id,date:this._date}}))}},{key:"setDate",value:function(e,t,a){this._date?e!==this._date.getDate()&&(this._date.setDate(e),this._date.setDuration(t),this.onMooDateUpdated(a)):this.setMooDate(new z.a(e),a)}},{key:"getMooDate",value:function(){return this._date}},{key:"getNextDate",value:function(e){return this._date?this._date.getNext(e):void 0}},{key:"getDate",value:function(e){if(e){var t=e.search.getItemDate(this);if(t)return t}return this._date?this._date.getDate():void 0}},{key:"allDayDate",value:function(){return!!this._date&&!this._date.getTime()}},{key:"_isFlagHelper",value:function(e,t){if(void 0===t)return!!(this.flags.get()&e);var a=t?this.flags.get()|e:this.flags.get()&~e;this.setFlags(a)}},{key:"isDeleted",value:function(e,t){if(void 0!==e){var a=0;i.default.Assert(i.default.isValidChangeType(t),"Must supply a valid changetype to delete an item: "+t),this._isDeleted=e;for(var n=0;this._favorites&&n<this._favorites.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._favorites[n];e?ee.notifyRemove(this,r):ee.notifyAdd(this,r)}if(this._attachments){var o=0,s=this._attachments;for(n=0;n<s.length;++n){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e?(s[n].unsubscribe(this),this.shouldSave()&&s[n].markUnused(t)):(s[n].subscribe(this),this.shouldSave()&&s[n].markInUse(t))}}}return this._isDeleted}},{key:"isImportant",value:function(e){return this.priority(e)}},{key:"forceComplete",value:function(e,t){return this.setComplete(e,t,!0)}},{key:"isDisplayComplete",value:function(){return this._isFlagHelper(n.a.VMLIFlag.DisplayComplete)}},{key:"computeDisplayComplete",value:function(){var e=this.parent(),t=e&&!this.isComplete()&&(e.isComplete()||e._isFlagHelper(n.a.VMLIFlag.DisplayComplete));this._isFlagHelper(n.a.VMLIFlag.DisplayComplete,t)}},{key:"propagateDisplayComplete",value:function(){var e=0;this.computeDisplayComplete();for(var t=0;t<this.numItems();t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.itemAtIndex(t);a.isComplete()||a.propagateDisplayComplete()}}},{key:"isComplete",value:function(){return this._isFlagHelper(n.a.VMLIFlag.Complete)&&(!this.isRepeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===ne.getTime())}},{key:"setComplete",value:function(e,t,a){var r=e,o={};i.default.Assert(i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t),e?(this.isRepeatDate()?(this._date.complete(),this.onMooDateUpdated(t),r=!1,xo.toasts.pushMessage({text:"Completed. Next occurrence: "+te.a.toHumanText(this._date.getNext()),action:n.a.MessageAction.Undo,hold:!1})):this.dateCompleted||(this.dateCompleted=new Date,o.dateCompleted=this.getDateCompletedTime()),i.default.isLocalChange(t)&&i.default.aggregateEvent("ItemCompleted")):(this.dateCompleted=void 0,o.dateCompleted=null),this._isFlagHelper(n.a.VMLIFlag.Complete,r),i.default.isRemoteChange(t)||(o.flags=this.flags.get(),this.shouldSave()&&I.a.saveItem(this,o,t,n.a.SaveFlag.Text),A.e.performAction(A.c.Update,{itemID:this.id,field:"isComplete",newValue:e,oldValue:!e})),this.notifyItemPropertyChanged(t,"isComplete"),this.propagateDisplayComplete(),xo.timeline.updateNotifications(this),N.a.itemSearchChanged(this)}},{key:"setStarred",value:function(e,t){if(void 0!==e&&(i.default.Assert(i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t),e!==this._isFlagHelper(n.a.VMLIFlag.Starred))){var a=this.flags.get();e&&a&n.a.VMLIFlag.Complete&&(a&=~n.a.VMLIFlag.Complete);var r=e?a|n.a.VMLIFlag.Starred:a&~n.a.VMLIFlag.Starred;this.setFlags(r);var o={flags:r};this.shouldSave()&&I.a.saveItem(this,o,t,n.a.SaveFlag.Text),this.notifyItemPropertyChanged(t,"isStarred"),N.a.itemSearchChanged(this),A.e.performAction(A.c.Update,{itemID:this.id,field:"isStarred",newValue:e,oldValue:!e})}}},{key:"isStarred",value:function(e){if(e){var t=e.search.getItemStarred(this);if(void 0!==t)return t}return this._isFlagHelper(n.a.VMLIFlag.Starred)}},{key:"isHeader",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"getVisibleChildren",value:function(e){if(!this.isNote()){for(var t=0,a=this.getItems(),i=[],n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[n].isHidden(e)||i.push(a[n])}return i}}},{key:"hasVisibleChildren",value:function(e){if(this.isNote())return!1;for(var t=0,a=this.getItems(),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!a[i].isHidden(e))return!0}return!1}},{key:"hasHeaderChildren",value:function(){if(this.isNote())return!1;for(var e=0,t=this.getItems(),a=0;a<t.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t[a].isHeader())return!0}return!1}},{key:"getCollapsedField",value:function(e,t){return t?n.a.PerPaneStateField.CollapsedOverview:e.collapsedFieldName}},{key:"isCollapsed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;if(i.default.Assert(e,"Must specify the pane for the item being checked for collapsed"),!e||!t&&e.isSearchedFlat())return!1;var r=!a&&e.isSearchedText()?e.getPerPaneState(this.id,n.a.PerPaneStateField.CollapsedSearch):void 0;return void 0===r&&void 0===(r=e.getPerPaneState(this.id,this.getCollapsedField(e,t)))&&(r=this.isDemandLoad()?0===this.numItems()||!e.isSearched()&&!t:e.getCollapsedDefault(this,t)),!!r}},{key:"setCollapsed",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(i.default.Assert(t,"Must specify the pane for the item being checked for collapsed"),!t)return!1;var o=this.isCollapsed(t,a);void 0!==e&&(e&&!this.isCollapsible()||(t.isSearchedText()&&t.setPerPaneState(this.id,n.a.PerPaneStateField.CollapsedSearch,void 0),t.setPerPaneState(this.id,this.getCollapsedField(t,a),e),!1!==r&&xo.PaneManager.updatePaneStateForPane(t),A.e.performAction(A.c.Update,{itemID:this.id,field:"isCollapsed",pane:t,newValue:e,oldValue:o}),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!e,i.default.focusedPane),e!==o&&t.updateItems())),this.itemChanged.notify()}},{key:"setCollapsedQuiet",value:function(e,t){t.setPerPaneState(this.id,this.getCollapsedField(t,!1),e)}},{key:"toggleCollapsed",value:function(e){i.default.Assert(e,"Must specify the pane that this item is being collapsed in"),o.a.fireEvent("clearMeasureCacheItem",[this.id]),this.setCollapsed(!this.isCollapsed(e,!1),e,!1)}},{key:"isCollapsible",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"isDraggable",value:function(){return!this.isNote()}},{key:"setTags",value:function(e,t){var a=this._activeTags&&!e&&this._activeTags||!this._activeTags&&e&&e||i.default.arrayDiff(this._activeTags,e);this._activeTags=e,this._activeTagsLower=e?e.map(function(e){return e.toLowerCase()}):void 0,a&&a.length>0&&!i.default.isFlagSet(t,n.a.ChangeType.ItemLoad)&&N.a.itemTagsChanged(this,a)}},{key:"getTags",value:function(){return this._activeTags}},{key:"getTagsLower",value:function(e){if(e){var t=e.search.getItemTagsLower(this);if(t)return t}return this._activeTagsLower}},{key:"setContacts",value:function(e,t){var a=!(this._activeContacts&&e&&this._activeContacts.equals(e));this._activeContacts=e,a&&!i.default.isFlagSet(t,n.a.ChangeType.ItemLoad)&&N.a.itemSearchChanged(this)}},{key:"getContacts",value:function(e){if(e){var t=e.search.getItemContacts(this);if(t)return t}return this._activeContacts}},{key:"hasCompletedAncestor",value:function(){for(var e=0,t=this.parent();t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t.isComplete())return!0;t=t.parent()}}},{key:"hasTime",value:function(){return this._date&&!!this._date.getTime()}},{key:"getTimeOfDay",value:function(){return this._date?this._date.getTime():this.dateCompleted?this.dateCompleted.getTimeOfDay():0}},{key:"_formatDateTime",value:function(e){return e.toString(xo.International.getFormat(n.a.DFormat.ShortTime))}},{key:"getDisplayDateWithDuration",value:function(e,t){var a=this.getDate(t);if(a){var i=this.getEndDate(t);a=a.clone().clearTime().equals(a)?a:i.clone().clearTime().equals(a)?i:a}return a}},{key:"getTime",value:function(){var e="",t=this.getNextDate();if(this.dateCompleted&&this.isComplete())e=this._formatDateTime(this.dateCompleted);else if(t&&t.hasTimeOfDay())if(this.getDuration()>0){var a=this.getDisplayDateWithDuration();a.equals(t)?e="<div>"+this._formatDateTime(t)+'</div><div class="c-foreground-very-faded">'+this._formatDateTime(this.getEndDate())+"</div>":a.equals(this.getEndDate())&&(e="Ends "+this._formatDateTime(this.getEndDate()))}else e=this._formatDateTime(t);return e}},{key:"createDateString",value:function(e){return e.isBefore(Date.today().addWeeks(1))?e.toString(xo.International.getFormat(n.a.DFormat.LongDayTime)):e.toString(xo.International.getFormat(n.a.DFormat.ShortDayTime))}},{key:"fullTime",value:function(){var e=this.getDate();if(!e)return"";this.createDateString(e)}},{key:"isVersionUninitialized",value:function(e){var t;switch(e){case n.a.VersionType.Structure:t=this._version;break;case n.a.VersionType.Text:t=this._versionText;break;default:t=-2,i.default.Assert(!1,"Invalid version type")}return(t||0)===n.a.UninitializedVersion}},{key:"setVersion",value:function(e,t){switch(i.default.Assert(i.default.isNumber(t),"Must always be setting a version to a number: ",t),e){case n.a.VersionType.Structure:this._version=t;break;case n.a.VersionType.Text:this._versionText=t;break;default:i.default.Assert(!1,"Invalid version type")}}},{key:"getVersion",value:function(e){var t;switch(e){case n.a.VersionType.Structure:t=this._version;break;case n.a.VersionType.Text:t=this._versionText;break;default:t=-2,i.default.Assert(!1,"Invalid version type")}return t||0}},{key:"setRemoteVersion",value:function(e,t){switch(i.default.Assert(void 0===t||i.default.isNumber(t),"Must always be setting a remote version to a number: ",t),e){case n.a.VersionType.Structure:this._versionRemote=t;break;case n.a.VersionType.Text:this._versionRemoteText=t;break;default:i.default.Assert(!1,"Invalid version type")}}},{key:"getRemoteVersion",value:function(e,t){var a;switch(e){case n.a.VersionType.Structure:a=this._versionRemote;break;case n.a.VersionType.Text:a=this._versionRemoteText;break;default:a=-2,i.default.Assert(!1,"Invalid version type")}return a||t?a:0}},{key:"isLocalVersionNewer",value:function(e){return this.getVersion(e)===this.getRemoteVersion(e)||void 0===this.getRemoteVersion(e,!0)}},{key:"isRemoteVersionNewer",value:function(e){return!this.isLocalVersionNewer(e)}},{key:"init",value:function(e,t){if(this._shouldSave=!(t&&t.noSave),i.default.Assert(!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items"),void 0!==e.version&&this.setVersion(n.a.VersionType.Structure,e.version),void 0!==e.versionText&&this.setVersion(n.a.VersionType.Text,e.versionText),this.id=e.id||I.a.generateID(),e.date){var a=e.date instanceof z.a?e.date.clone():z.a.fromData(e.date);a?this._date=a:i.default.reportError(new Error("Initial invalid date: "+e.date))}e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),e.favorites&&this.setFavorites(e.favorites,t.changeType),this.computeDisplayComplete(),(e.items&&e.items.length>0||e.note)&&this.updateItems(e.items,e.note,t.changeType),this.__TEMP_InitCalled=!0,i.default.Assert(t,"Missing required properties in extraInfo");var r=t?t.changeType:n.a.ChangeType.Auto;(i.default.Assert(i.default.isValidChangeType(r),"Must supply a valid changetype to VMLIs"),this.__TEMP_InitParseCalled=!0,this.parseText(!0,t.changeType|n.a.ChangeType.ItemLoad),this.shouldSave()&&!i.default.isAutoChange(t.changeType))?(i.default.isLocalChange(t.changeType)?n.a.SaveFlag.All:n.a.SaveFlag.None,this.getItemStore().trackGlobally()&&I.a.setItem(this)):this.getItemStore().trackGlobally()&&I.a.setItem(this);i.default.isLocalChange(t.changeType)&&i.default.aggregateEvent("ItemCreated")}},{key:"onLoad",value:function(e){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(e,!1)||e.isSearched()||this.notifyDemandLoadUpdate(!0,e),this.isLoaded=!0)}},{key:"destroy",value:function(){i.default.Assert(this._canDestroy,"VMLI must be explicitly marked as destroyable"),i.default.Assert(!this.shouldSave()||i.default.isDemoMode(),"Should never destory a saveable VMLI");var e=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var t=0,a=this._attachments,n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[n].unsubscribe(this)}this._attachments=void 0}e.trackGlobally()&&I.a.clearItem(this.id),this.items.unlisten(this.itemsHasMutated),N.a.itemSearchChanged(this),this._store=void 0,S.a.destroy(this)}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"isFullscreen",value:function(){return i.default.focusedItem===this}},{key:"findItem",value:function(e){var t=this.getIndexOf(e.id);if(t>=0)return{index:t,arr:this.items,isArchived:!1}}},{key:"updateItems",value:function(t,a,n){var r=!1;if(t&&t.length>0){var o=0;i.default.Assert(!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded");for(var s=0;s<t.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=t[s],u=void 0;if(l instanceof e?u=l:i.default.isString(l)&&(u=I.a.getItem(l)),u){var d=I.a.getItem(u.parent().id);if(d&&d.id!==this.id){var c=d.items.indexOf(u.id);i.default.Assert(-1===c,"Expect that the old parent has been notified");var h=u.getIndex();h>-1&&u.parent().removeChildAtIndex(h,n)}u.setParent(this)}else if("object"!==ae(l)){var f=I.a.getItemDataLocal(this._documentOwner,l);i.default.Assert(f,"Referenced item doesn't exist",l),f&&(u=this._store.createItemRaw(f,{documentOwner:this._documentOwner,parent:this,changeType:n}))}else i.default.Assert(l,"Item must exist otherwise we arent creating anything"),l&&(u=this._store.createItemRaw(l,{documentOwner:this._documentOwner,parent:this,changeType:n}));if(i.default.Assert(u,"There must be a model at this point"),u){if(u.isNote()){a=u.id;continue}r=!0,this.items.push(u)}}}if(a){var p;if(i.default.Assert(!this._note,"Must not already have a valid note set"),i.default.Assert(i.default.isString(a)||i.default.isObject(a),"Note must be a valid ID"),i.default.isString(a)){if(!(p=I.a.getItem(a))){var g=I.a.getItemDataLocal(this._documentOwner,a);i.default.Assert(g,"Referenced note doesn't exist",a),g&&(g=Object.assign({isNote:!0},g),p=this._store.createItemRaw(g,{documentOwner:this._documentOwner,parent:this,changeType:n}))}}else i.default.isObject(a)&&(p=this._store.createItemRaw(a,{documentOwner:this._documentOwner,parent:this,changeType:n}));i.default.Assert(p,"Must have a valid note VM at this point"),this._note=p,r=!0}r&&this.itemsHasMutated()}},{key:"addItemAtIndex",value:function(e,t,a){i.default.Assert(a,"Must pass pane when adding item at index"),A.e.beginAction();var r=a.createVMLI({text:e},{documentOwner:this._documentOwner,parent:this,changeType:n.a.ChangeType.AllLocal,isEditable:!0});return this.insertItem(r,t),A.e.performAction(A.c.Create,{itemID:r.id,parent:this.id,position:isNaN(t)?this.numItems()-1:t,text:e}),this.isCollapsed(a,!1)&&this.setCollapsed(!1,a),A.e.endAction(),r}},{key:"insertItem",value:function(e,t,a){i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(e,"Must specify a valid item to be inserted"),i.default.Assert(this!==e,"Should not insert an item into itself"),i.default.Assert(this.belongsToSameItemStore(e),"Items must belong to the same item store"),this!==e&&(isNaN(t)||t<0?this.items.push(e):this.items.splice(t,0,e),this.shouldSave()&&I.a.addItem(this,e,t,a))}},{key:"insertSorted",value:function(e,t,a){i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(e,"Must specify a valid item to be inserted"),i.default.Assert(t,"Must supply a valid comparator"),i.default.Assert(this.belongsToSameItemStore(e),"Items must belong to the same item store");var n=this.items.insertSorted(e,t,a);this.shouldSave()&&I.a.addItem(this,e,n)}},{key:"moveTo",value:function(t,a){var n=t.parent,r=t.index,o=t.shouldBeArchived;t.noVersion,t.underlying,t.fromTab;i.default.Assert(n instanceof e,"New parent must be a valid VMLI"),void 0===r&&(r=-1),void 0===o&&(o=!1);var s=this.parent(),l=s.findItem(this),u=this.index;if(this.getRawText(),l){var d=r;if(s===n){if(l.index===d)return;l.index<d&&d--}xo.PaneUpdateBatcher.beginUpdateItems(),l.arr.splice(l.index,1),N.a.itemSearchChanged(this);var c=n.items;d<0?c.push(this,!1):c.splice(d,0,this,!1),this.setParent(n),c.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),xo.PaneUpdateBatcher.commitUpdateItems(),i.default.Assert(this.shouldSave(),"Item must be marked as saveable"),i.default.Assert(s.shouldSave(),"Old parent must be marked as saveable"),i.default.Assert(this.parent().shouldSave(),"New parent must be marked as saveable"),this.shouldSave()&&I.a.moveItem(this,s,u,a),s.propagateDisplayComplete(),n.propagateDisplayComplete()}}},{key:"getItemsArrayForSave",value:function(){var e=0;i.default.Assert(!this.isNote(),"Notes cannot use this function");for(var t=[],a=this.getItems(),n=0;n<a.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(a[n].id)}return t}},{key:"getDateTime",value:function(){if(this.getDate())return this.getDate().getTime()}},{key:"getDateCompletedTime",value:function(){if(this.dateCompleted)return this.dateCompleted.getTime()}},{key:"isForceCompleted",value:function(){return!(!this.dateCompleted||!this.dateCompleted.equals(ne))}},{key:"getMetaTextSaveData",value:function(){this.getDate();return{date:this._date?this._date.toData():void 0,dateCompleted:this.getDateCompletedTime()}}},{key:"_generateNotificationEntry",value:function(e){var t,a=e.toJSON(),n=new Date(e);return i.default.Assert(i.default.isDateValid(n),"Must provide a valid alert date: "+e),t=e.hasTimeOfDay()?n.addMinutes(-xo.settings.notificationDelay.get()).toJSON():n.addDays(-1).clearTime().addHours(17).toJSON(),{id:this.id,text:this.getParsedTextWithoutPrefix(),date:a,alertDate:t}}},{key:"getNotificationEntries",value:function(){if(i.default.Assert(this.getNextDate(),"Must have a valid date"),i.default.Assert(!this.allDayDate(),"All day dates should not be scheduled"),!this.allDayDate())try{var e=this.getNextDate();if(e)return this._generateNotificationEntry(e)}catch(t){return void i.default.reportError(t)}}},{key:"getDebugData",value:function(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isDeleted:this.isDeleted(),version:this.getVersion(n.a.VersionType.Structure),versionText:this.getVersion(n.a.VersionType.Text)}}},{key:"getFullSaveData",value:function(){i.default.Assert(this.shouldSave(),"Item must be marked as saveable");var e={id:this.id,index:this.index,text:this.getRawText(),date:this._date?this._date.toData():void 0,dateCreated:this.dateCreated.getTime(),dateModified:this.dateModified.getTime(),dateCompleted:this.getDateCompletedTime(),flags:this.flags.get(),isRoot:this.isRoot,docId:this._documentOwner.id,note:this.hasNote()?this.getNote().id:void 0,isDeleted:void 0,parent:this.parent()?this.parent().id:void 0};return Object.keys(e).forEach(function(t){void 0===e[t]&&delete e[t]}),e}},{key:"save",value:function(e,t,a){}},{key:"highlight",value:function(){var e=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout(function(){e.isHighlighted.set(!0)},0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout(function(){e.isHighlighted.set(!1)},2e3)}},{key:"removeChild",value:function(e,t){i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(!e.isNote(),"Do not use remove child to remove notes from items");var a=this.items.remove(e);return a>=0?this.shouldSave()&&I.a.deleteItem(this,e,a,t,!1):(i.default.Assert(!1,"Child not found in parent"),i.default.Assert(this===e.parent(),"Parent of child is not set to this item, should not remove: "+e.parent())),a}},{key:"removeChildAtIndex",value:function(e,t){i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(!this.itemAtIndex(e).isArchived());var a=this.items.removeAt(e);return this.shouldSave()&&I.a.deleteItem(this,a,e,t,!1),a}},{key:"_moveChildrenHelper",value:function(e,t){var a=e.newParent,n=e.index,r=e.isArchived;i.default.Assert(void 0!==a&&void 0!==r,"_moveChildrenHelper is missing parameters");var o=this.getItems();if(o.length>0){var s=0,l=r?a.archivedItems(!0):a.getItems();!r&&(isNaN(n)||n<0)&&(n=l.length);for(var u=0;o.length>0;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;i.default.Assert(o[u]!==a,"Should never be reparenting to a child");var d=o[0].id;o[0].moveTo({parent:a,index:n+u,shouldBeArchived:r,underlying:!0},t),A.e.performAction(A.c.Move,{itemID:d,oldParent:this.id,oldPosition:u,newParent:a.id,newPosition:n+u}),u++}}}},{key:"moveChildren",value:function(e,t,a){if(i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(this.id!==e.id,"Do not use moveChildren to move a child to the same parent"),e.parent()===this){var n=this.removeChild(e,a);A.e.performAction(A.c.Delete,{itemID:e.id,parent:this.id,position:n})}xo.PaneUpdateBatcher.beginUpdateItems(),this._moveChildrenHelper({newParent:e,index:t,isArchived:!1},a),this._moveChildrenHelper({newParent:e,index:t,isArchived:!0},a),xo.PaneUpdateBatcher.commitUpdateItems()}},{key:"deleteSelf",value:function(e){this.parent().deleteChild(this,void 0,void 0,e),this.setParent(void 0)}},{key:"deleteChild",value:function(e,t,a,n){if(i.default.Assert(e,"Must provide a valid child to delete"),i.default.Assert(!this.isNote(),"Notes cannot use this function"),A.e.beginAction(),xo.PaneUpdateBatcher.beginUpdateItems(),e.isNote())this.setNote(void 0,n);else if(e.hasChildren())if(t)e.moveChildren(t,a,n);else for(var r=0,o=e.getItems(),s=o.length-1;s>=0;s--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.deleteChild(o[s],void 0,void 0,n)}if(e.hasNote()&&e.setNote(void 0,n),!e.isDeleted()&&!e.isNote()){var l=this.removeChild(e,n);A.e.performAction(A.c.Delete,{itemID:e.id,parent:this.id,position:l})}e.notifyItemPropertyChanged(n,"isDeleted"),N.a.itemItemsChanged(this),xo.timeline.updateNotifications(e),xo.PaneUpdateBatcher.commitUpdateItems(),A.e.endAction()}},{key:"replaceChild",value:function(e,t,a){i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(!e.isNote(),"Old child should not be a note"),i.default.Assert(!t.isNote(),"New child should not be a note");var n=e.getIndex();this.items.removeAt(n),A.e.performAction(A.c.Delete,{itemID:e.id,parent:this.id,position:n}),t.moveTo({parent:this,index:n},a),I.a.deleteItem(this,e,n+1,a,!1),e.moveChildren(t,t.numChildren(),a);var r=t.parent().id;if(r!==this.id){var o=t.parent().items.remove(t);A.e.performAction(A.c.Move,{itemID:t.id,oldParent:r,oldPosition:o,newParent:this.id,newPosition:n})}}},{key:"getChildren",value:function(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()}},{key:"getChild",value:function(e){return i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(e>=0,"Child index is out of range: ",e),i.default.Assert(e<this.numItems(),"Child index out of range: ",e,this.numItems()),this.itemAtIndex(e)}},{key:"getFirstChild",value:function(){return i.default.Assert(!this.isNote(),"Notes cannot use this function"),this.hasChildren()?this.itemAtIndex(0):void 0}},{key:"isFirstChild",value:function(){return i.default.Assert(!this.isNote(),"Notes cannot use this function"),!!this.parent()&&this.parent().getFirstChild()===this}},{key:"getLastChild",value:function(){return i.default.Assert(!this.isNote(),"Notes cannot use this function"),this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0}},{key:"isLastChild",value:function(){return i.default.Assert(!this.isNote(),"Notes cannot use this function"),!!this.parent()&&this.parent().getLastChild()===this}},{key:"isDescendantOf",value:function(e){for(var t=0,a=this.parent();a&&a!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a=a.parent()}return void 0!==a}},{key:"getChildIndex",value:function(e){return i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(!e.isNote(),"Should not get the index of an item note"),this.getIndexOf(e.id)}},{key:"getIndexOf",value:function(e){i.default.Assert(!this.isNote(),"Notes cannot use this function"),i.default.Assert(i.default.isString(e),function(){return"ID must be a valid string: "+i.default.getObjectInfo(e)});var t=-1,a=this.getItems();if(a)for(var n=0,r=0;r<a.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(a[r].id===e){t=r;break}}return t}},{key:"getIndex",value:function(){return i.default.Assert(!this.isNote(),"Should never be getting a child index of a note"),this.parent().getChildIndex(this)}},{key:"hasChildren",value:function(){return!this.isNote()&&this.numItems()>0}},{key:"numChildren",value:function(){return i.default.Assert(!this.isNote(),"Notes cannot use this function"),this.numItems()}},{key:"canZoom",value:function(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)}},{key:"parents",value:function(e){for(var t=0,a=[],i=this.parent();i&&i!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a.splice(0,0,i),i=i.parent()}return a}},{key:"getSiblings",value:function(e){i.default.Assert(!this.isNote(),"Notes cannot use this function"),e=e||0;var t=[];if(this.parent())for(var a=0,n=this.parent().getItems(),r=e,o=n.length;r<o;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[r]!==this&&t.push(n[r])}return t}},{key:"nextSibling",value:function(){var e=this.getIndex();return this.parent().getItems()[e+1]}},{key:"isRootItem",value:function(){var e=this.getItemStore();return!!e&&e.isRoot(this)}},{key:"clone",value:function(e,t){var a=0;i.default.Assert(!i.default.isAutoChange(t),"Cloning should always be a user action");for(var n=e.getItemStore().createItemRaw({text:this.getRawText(),isComplete:this.isComplete(),date:this._date?this._date.clone():void 0,priority:this.priority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:e,documentOwner:this._documentOwner,changeType:t}),r=0;r<this.numItems();++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this.itemAtIndex(r).clone(n,t);n.insertItem(o)}if(this.hasNote()){var s=this.getNote().clone(n,t);n.setNote(s,t)}return n}},{key:"getItems",value:function(){return this.items.get()}},{key:"itemAtIndex",value:function(e){return this.items.get()[e]}},{key:"numItems",value:function(){return this.items.length()}},{key:"itemsHasMutated",value:function(){i.default.Assert(!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id),!this._destroyed&&this.isInitialized&&N.a.itemItemsChanged(this)}},{key:"numChildrenRecursive",value:function(){var e=0,t={item:this,each:function(t){e++}};return i.default.searchVMLIs(t),e}},{key:"isOnDate",value:function(e){return!!this._date&&this._date.isOnDate(e)}},{key:"getCalendarColor",value:function(){var e;if(this.isComplete())return"#ddd";if(this.hasAttachmentType(n.a.PluginType.Calendar)){var t=this.getAttachmentByType(n.a.PluginType.Calendar);e=t.getPlugin().getCalendarBackgroundColor(t.getField("calendarID"))}else e="rgba(0, 153, 221, 0.85)";return e}},{key:"getCalendarDisplayProps",value:function(){var e;if(this.hasAttachmentType(n.a.PluginType.Calendar)){var t=this.getAttachmentByType(n.a.PluginType.Calendar);e=t.getPlugin().getCalendarDisplayProps(t.getField("calendarID"))}return e}},{key:"allowTextEditing",value:function(){var e=!0;return(f.a.android&&this.hasAttachments()||!xo.pluginManager.allowTextEditing(this))&&(e=!1),e}},{key:"getPreviousItem",value:function(){var e=this.parent(),t=e.getChildIndex(this);if(t>0)return e.getChild(t-1)}},{key:"isRepeatDate",value:function(){return this._date&&this._date.isRepeatDate()}},{key:"getEls",value:function(){return this.els}},{key:"getDocumentOwner",value:function(){return this._documentOwner}},{key:"sortComparatorIndex",value:function(e,t){return e.index-t.index}}])&&ie(t.prototype,a),r&&ie(t,r),e}()).prototype,"itemsHasMutated",[g.a],Object.getOwnPropertyDescriptor($.prototype,"itemsHasMutated"),$.prototype),$);S.a.extendClass(re,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se;return function(t){function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),V(this,j(a).apply(this,arguments))}var r,s,l;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(a,e),r=a,(s=[{key:"_runAndGetSaveData",value:function(e,t,a){if(i.default.Assert(t,"We do not support deferred text paring"),this.shouldSave())var n=this.getMetaTextSaveData();if(this.setRawText(this.generateSaveText(e)),this.parseText(t,a),this.shouldSave()){var r=this.getMetaTextSaveData(),o={};for(var s in r)n[s]!==r[s]&&(o[s]=r[s])}return o}},{key:"setText",value:function(e,t,a){i.default.Assert(i.default.isLocalChange(a)||!e||e.indexOf(n.a.AttachChar)<0,"Should never be setting text with an attach char in it"),i.default.Assert(this.isNote()||!e||e.indexOf("\n")<0,"Non-notes should never have newlines"),i.default.Assert(!e||i.default.isRemoteChange(a)||e.indexOf(n.a.TextSpace)<0,"Should never insert text space into item when editing locally"),a|=n.a.ChangeType.Text;var r=this.isPrefixHeader();!this.isNote()&&e&&e.indexOf("\n")>=0&&(e=e.replace(/\n/g," ")),this.isInitialized&&o.a.fireEvent("clearMeasureCacheItem",[this.id]),N.a.beginBatch(this);var s=this._runAndGetSaveData(e,t,a);this.shouldSave()&&(s.text=this.generateSaveText(e),I.a.saveItem(this,s,a,n.a.SaveFlag.Text)),N.a.itemTextChanged(this),this.isPrefixHeader()!==r&&N.a.itemFontChanged(this),N.a.commitBatch(this)}},{key:"metricsInPane",value:function(e,t){var a;try{var n=t>=0&&C.a.isSelected(t,e),r=e.objectAtIndex(t);a=e.getMetricsForPaneObject(r,!1,n)}catch(o){i.default.reportError(o)}return a}},{key:"sizeInPane",value:function(e,t,a){if(a)return f.a.isMobile?n.a.OverviewItemHeightMobile:n.a.OverviewItemHeightDesktop;if(this.isNote()){var i=e.objectAtIndex(t);return xo.DisplaySettings.lineItemHeight(i,this,e,1)}var r=e.objectAtIndex(t),o=this.metricsInPane(e,t).height;return this.shouldShowParents(r,e)&&(o+=n.a.HeightAgendaParents),o}},{key:"shouldShowParents",value:function(e,t){return t.type===n.a.PaneMode.Task&&e.item&&!t.isSearchedFlat()&&(t.isViewTag()||t.isViewAgenda()||t.isViewContact()||t.isViewPriority())&&!e.item.isNote()&&0===e.levelsDeep&&e.item.parent()!==t.getItem()}},{key:"generateExportText",value:function(e,t){return void 0!==e&&null!==e?this._generateUsableText(e,"getExportString",t):null}},{key:"generateSaveText",value:function(e,t){return void 0!==e&&null!==e?this._generateUsableText(e,"getEmbedString",t):null}},{key:"generateTitleText",value:function(e){var t="";if(e&&!this.parent())return e.titleOfFirstItem();if(e&&this.els&&this.els.length>0)for(var a=0,n=0;n<this.els.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this.els[n];r.hasClass("mdMarkup")||r.hasClass("itemPrefix")||(t+=i.default.unescape(r.getUnstyledText(e)))}else t=this.getParsedTextWithoutPrefix();return(this.hasAttachments()?this._generateUsableText(t,"getTitleString").replace(/[\*_]/g,""):t).trim()}},{key:"_generateUsableText",value:function(e,t,a){i.default.Assert(this.hasAttachments()||e.indexOf(n.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars");var r=e;if(this.hasAttachments()&&e.indexOf(n.a.AttachChar)>=0){var o=a||0,s=this.getNumAttachments();r=e.replace(/\u2000/g,function(){if(o<s){var e=this.getAttachment(o);return o++,e.isLoaded()?e[t]():""}return i.default.Assert(!1,"Unable to find valid attachment for AttachChar"),""}.bind(this)),i.default.Assert(r.indexOf(n.a.AttachChar)<0,"Should convert all attachments to their string form")}return r}},{key:"splitUsableText",value:function(e,t,a){var r=this;i.default.Assert(this.hasAttachments()||e.indexOf(n.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars");var o=e.substring(0,t)+e.substring(a),s=t;if(this.hasAttachments()&&e.indexOf(n.a.AttachChar)>=0){var l=0,u=this.getNumAttachments();o=e.replace(/\u2000/g,function(e,a){if(l<u){var i=r.getAttachment(l);l++;var o=i.getEmbedString();return a<t&&(s+=Math.max(o.length-1,0)),o}return n.a.AttachChar}),i.default.Assert(o.indexOf(n.a.AttachChar)<0,"Should convert all attachments to their string form")}return{before:o.substring(0,s),after:o.substring(s)}}},{key:"parseText",value:function(e,t,a){var r;if(i.default.Assert(!this.isDestroyed(),"Must not parse a destroyed VMLI"),i.default.Assert(e,"Currently we only support immediate parsing"),i.default.Assert(i.default.isValidChangeType(t),"Must specify a valid changetype"),this.__TEMP_ParseCalled=!0,e){if(this.isNote())r=F.a.parseNote(this);else{var s=this.getParser();if(i.default.Assert(s,"Must be able to get valid parse function for item"),!s)return;r=s(this,t)}i.default.isFlagSet(t,n.a.ChangeType.Local)&&r.numContacts>0&&A.e.miscAction({type:A.c.Misc,misc:A.a.AddContact,data:[{itemID:this.id}]})}else i.default.Assert(!1,"Should always be using immediate parse");var l=this.isPrefixNumList(),u=this.styleText(r,e,t,a);return this.itemChanged.notify(),this.isInitialized&&this.isPrefixNumList()!==l&&o.a.fireEvent("numListChanged",[]),u}},{key:"styleText",value:function(e,t,a,r){i.default.Assert(t,"Currently we only support full parses"),i.default.Assert(i.default.isValidChangeType(a),"Must specify a valid changetype"),i.default.Assert(!(!e&&t),"In a full parse, styleInfo should always be defined");var o=!1,s=[];if(e){this.prefix=e.prefix;var l=this.getMooDate();if(l&&l.getGCalId()&&(e.attachments||(e.attachments=[]),e.attachments.push({p:n.a.PluginID.GCalendar,id:l.getGCalId()})),e.attachments||this.hasAttachments()){for(var u=0,d=[],c=0;e.attachments&&c<e.attachments.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=xo.pluginManager.getAttachment(e.attachments[c]);h&&(d.push(h),i.default.isLocalChange(a)&&!h.getOldID()&&s.push(h))}o=!0,this.setAttachments(d,a,!1)}t&&this.setParsedText(e.parsedText),i.default.Assert(e.els||i.default.isFlagSet(a,n.a.ChangeType.ItemLoad),"Must always return an els list"),e.els&&(this.els=e.els),this.prefix&&A.e.miscAction({type:A.c.Misc,misc:A.a.SetPrefix,data:{itemID:this.id,prefix:this.prefix}}),(e.tags||this._activeTags)&&this.setTags(e.tags,a),(e.contacts||this._activeContacts)&&this.setContacts(e.contacts,a)}if(this.isInitialized){if(s.length>0){var f=0;for(c=0;c<s.length;c++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;s[c].notifyItemTextChanged(this,!1)}}if(i.default.isLocalChange(a)&&this.isNote()&&this.parent().hasAttachments()){var p=0,g=this.parent().getAttachments();for(c=0;c<g.length;++c){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;g[c].notifyItemNoteChanged(this)}}o&&this.itemChanged.notify()}return!1}},{key:"getCalendarRawText",value:function(){return this.getRawText().replace(/^ +/g,"").replace(/ +$/g,"")}},{key:"getCalendarParsedText",value:function(){return(this.hasAttachmentType(n.a.PluginType.Email)?this.getAttachmentByType(n.a.PluginType.Email).getField("subject"):this.getParsedTextWithoutPrefix().replace(/\u2000/g,"")).trim()}},{key:"getStyledTextAsOneLine",value:function(e,t){var a;return t&&(a='<span class="numChildren c-foreground-super-faded">'+this.numItems()+"</span>"),xo.ElementRenderer.render(this.els,{convertSpaces:!1,noPrefix:e,suffix:a})}},{key:"hasText",value:function(){var e=this.getParsedText();return(e=e.replace(/ /g,"")).length>0}},{key:"setPrefix",value:function(e){var t=this.getRawText(),a=this.getPrefix();a&&(t=t.substr(a.length)),this.prefix=e,t=(e?e+" ":"")+t,this.setText(t,!0,n.a.ChangeType.Local)}},{key:"getPrefix",value:function(){return this.prefix?this.prefix+" ":""}},{key:"getPrefixLength",value:function(){return this.prefix?this.prefix.length+1:0}},{key:"isPrefixHeader",value:function(e){var t;return e&&(t=e.search.getItemPrefix(this)),void 0===t&&(t=this.prefix),t&&(t[0]===n.a.Prefix.Header||t[0]===n.a.Prefix.Header2)}},{key:"isPrefixTask",value:function(){return this.prefix&&i.default.isPrefixTask(this.prefix)}},{key:"isPrefixBullet",value:function(){return this.prefix&&this.prefix===n.a.Prefix.Bullet||this.prefix===n.a.Prefix.Bullet2||this.prefix===n.a.Prefix.Bullet3}},{key:"isPrefixNumList",value:function(){return this.prefix&&+this.prefix[0]>=0&&+this.prefix[0]<10}},{key:"hasPrefix",value:function(){return!!this.prefix}},{key:"numListNumber",value:function(){if(this.isPrefixNumList()){for(var e=0,t=1,a=this.parent(),i=this.getIndex()-1;i>=0;--i,++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=a.getChild(i);if(!n||!n.isPrefixNumList())break}return t}}},{key:"shouldCopyPrefix",value:function(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()}},{key:"getParsedTextWithoutPrefix",value:function(){var e=this.getPrefix(),t=this.getParsedText();return e?t.substr(e.length):t}},{key:"applyFormatToSelection",value:function(e,t,a,i){var r,o,s,l=0,u=0,d=this.getParsedText(),c=t,h=a,f=!1;for(t===a&&(t=0,a=d.length),t<this.getPrefixLength()&&(t=this.getPrefixLength()),a<this.getPrefixLength()&&(a=this.getPrefixLength()),s=t;s>=Math.max(t-e.length,0);s--){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(d.substr(s,e.length)===e){r=s;break}}for(s=a-e.length;s<=a;s++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(d.substr(s,e.length)===e){o=s;break}}return isNaN(r)||isNaN(o)||i===n.a.SetMode.Yes?i!==n.a.SetMode.No&&(c+=e.length,h+=e.length,d=d.substr(0,t)+e+d.substr(t,a-t)+e+d.substr(a),f=!0):(c-=e.length,h-=e.length,d=d.substr(0,r)+d.substr(r+e.length,o-r-e.length)+d.substr(o+e.length)),this.setText(d,!0,n.a.ChangeType.Local),{didSet:f,selStart:c,selEnd:h}}},{key:"insertLinkAtSelection",value:function(){var e=C.a.getStartIndex();if(C.a.isValid()&&e===C.a.getEndIndex()){var t,a=C.a.getStartOffset(),i=C.a.getEndOffset(),n=this.getRawText();if(a!==i)t=n.substr(a,i-a);else if(a>0&&i<n.length){for(var r,o,s=0,l=this.getEls(),u=0,d=-1,c=0;c<l.length;c++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(l[c].hasClass("mdMarkupStart")&&"["===l[c].getParsedText())d=u;else if(l[c].hasClass("mdMarkupEnd")&&")"===l[c].getParsedText()&&d>=0){var h=u+l[c].getOrigTextLength();if(a>=d&&i<=h){r=d,o=h;break}d=-1}u+=l[c].getOrigTextLength()}r||o||" "===n[a-1]||" "===n[a]||(r=n.prevIndexOf(" ",a)+1,(o=n.indexOf(" ",i))<0&&(o=n.length)),isNaN(r)||isNaN(o)||r===a||o===i||(t=n.substr(r,o-r),C.a.selectIndices(e,r,e,o))}xo.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:C.a.getEndElement(),onInsertLink:this.onInsertLink,text:t})}}},{key:"onInsertLink",value:function(e,t){if(C.a.isValid()&&C.a.getStartIndex()===C.a.getEndIndex()){t&&!e.text&&(e.text=e.url);var a=C.a.getStartOffset(),i=C.a.getEndOffset(),r=this.getRawText(),o=r.substr(a,i-a),s=e.url?e.text?(t?"!":"")+"["+e.text+"]("+e.url+")":e.url:e.text,l=i+s.length-o.length;r=r.substr(0,a)+s+r.substr(i),this.setText(r,!0,n.a.ChangeType.Local),C.a.selectIndex(C.a.getStartIndex(),l)}}},{key:"getTextLength",value:function(){return this.getParsedText().length}},{key:"getNotePreviewText",value:function(){var e=this.getParsedText();if(e){var t=(e=e.substr(0,Math.min(e.length,400))).match(/[^\r\n]+/);if(t){for(var a=0,n=(e=t[0]).split(/<\/?(?:div|p|br)[^>]*>\s*/im),r=0;r<n.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(n[r]){var o=document.createElement("div");if(o.innerHTML=n[r],e=i.default.escape(o.textContent||o.innerText))break}}e=e.substr(0,Math.min(e.length,200))}}return e}}])&&U(r.prototype,s),l&&U(r,l),a}()}(re),!0),S.a.extendClass(re,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se;return function(t){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),x(this,O(r).apply(this,arguments))}var s,l,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(r,e),s=r,(l=[{key:"dragStart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.pane||i.default.focusedPane;i.default.Assert(!f.a.isMobile||a.isItemDraggable(this),"Should not be able to drag/drop on timeline on mobile"),i.default.Assert(a.isItemDraggable(this),"Pane must be draggable in order to start a drag"),i.default.Assert(xo.DragDrop.startDragItem,"Should always have a valid item to start dragging from");var n=i.default.getElementParent(e.startSrc||e.target);if(i.default.Assert(n,"Must have a valid target node"),n){var r,o;if(xo.DragDrop.startDragItem=void 0,xo.DragDrop.dragItem=this,a.isViewCalendar()||t||i.default.findParent(n,"itemNotInPane"))r=[{item:this,levelsDeep:0}];else{var s=i.default.getPaneObjectForElement(n),l=this.levelsDeep.get(),u=s.levelsDeep;if(r=[s],o=s.block,!this.isCollapsed(a)){var d=0,c=this.getVisibleChildren(a),h={},p=[];h[this.id]=s;for(var g=0;g<c.length;g++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var m=c[g],v={item:m,levelsDeep:m.levelsDeep.get()-l+u,index:s.index+g+1,parentObject:h[m.parent().id]};h[m.id]=v,p.push(v)}r=r.concat(p)}}var y=i.default.offset(n),_=y.left,b=y.top;f.a.isMobile?a.addScrollListener(this.dragScroll):xo.PaneManager.runForEachPane(function(e){e.addScrollListener(this.dragScroll)}.bind(this));var k={x:e.clientX,y:e.clientY,items:r},w={dropEffect:a.dropEffect(this),item:this,element:n,block:o,pane:a};xo.DragDrop.start(this,r,_,b,a,k,w,t),i.default.disableMouseMove=!0}}},{key:"dragMove",value:function(e){if(i.default.Assert(xo.DragDrop.startInfo,"Must have started a drag to be valid"),xo.DragDrop.startInfo){if("touchmove"===e.type){if(!e.cancelable)return void this.dragEnd(e);e.returnValue=!1,e.returnFalse=!0,e.preventDefault(),e.stopPropagation()}var t=e.clientX-xo.DragDrop.startInfo.x,a=e.clientY-xo.DragDrop.startInfo.y,n=i.default.elementFromPoint(e.clientX,e.clientY);xo.DragDrop.setTransform(t,a),n&&xo.DragDrop.handleDragOver({item:this,target:n,dataTransfer:xo.DragDrop.dataTransfer,diffY:e.diffY,clientX:e.clientX,clientY:e.clientY,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn})}}},{key:"dragScroll",value:function(e){if(xo.DragDrop.isDragging&&!isNaN(C.a.mousePos.x)&&!isNaN(C.a.mousePos.y)){var t={clientX:C.a.mousePos.x,clientY:C.a.mousePos.y,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,diffY:0};this.dragMove(t)}}},{key:"dragEnd",value:function(e){var t=this;i.default.disableMouseMove=!1,xo.DragDrop.stop(),e&&e.target!==document.documentElement&&xo.DragDrop.handleDrop({target:e.target,clientX:e.clientX,clientY:e.clientY,dataTransfer:xo.DragDrop.dataTransfer,fromDropBucket:e.fromDropBucket,ctrlKey:e.ctrlKey,altKey:e.altKey,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn}),xo.DragDrop.finish(),xo.PaneManager.runForEachPane(function(e){e.getInfiniteList().hasScrollListener(t.dragScroll)&&e.removeScrollListener(t.dragScroll)}),i.default.disableMouseMove=!1}},{key:"onTouchHoldTimeout",value:function(e){this._destroyed||(i.default.isKeyboardOpen?this.isLoupeOpen=!0:i.default.focusedPane&&i.default.focusedPane.isDropTarget&&this.isDraggable()&&i.default.focusedPane.isItemDraggable(this)&&!i.default.findParent(e.target,"androidInput")&&(this.isEditable.set(!1),xo.DragDrop.startDragItem=this,this.dragStart(e),this.dragMove(e)))}},{key:"checkDragOnStart",value:function(e){xo.DragDrop.escapedDragging=!1,xo.DragDrop.startDragItem=this,i.default.preventDefault(e),i.default.stopPropagation(e)}},{key:"checkDragOnMove",value:function(e,t){if(xo.DragDrop.startDragItem&&!xo.DragDrop.escapedDragging&&(!f.a.touch||Math.abs(e.distanceY)>i.default.ClickThreshold&&Math.abs(e.distanceX)<i.default.ClickThreshold)){var a=e.pane||i.default.focusedPane;xo.DragDrop.startDragItem===this&&this.isDraggable()&&a.isItemDraggable(this)&&this.dragStart(e,t)}xo.DragDrop.isDragging&&(this.dragMove(e),i.default.preventDefault(e),i.default.stopPropagation(e))}},{key:"checkDragOnEnd",value:function(e){xo.DragDrop.startDragItem=void 0,xo.DragDrop.isDragging&&this.dragEnd(e)}},{key:"onStart",value:function(e,t,a){var n=i.default.focusedPane,r=!1;if(f.a.mobile&&(i.default.isKeyboardOpen||this.isEditable.set(!1),!i.default.isKeyboardOpen&&f.a.useCustomScroller&&i.default.preventAndStop(a)),i.default.scrollAtTouchStart=n.getScrollOffset(),f.a.isMobile&&(i.default.isKeyboardOpen||this.isEditable.set(!1),!i.default.isKeyboardOpen&&f.a.useCustomScroller&&i.default.preventAndStop(a)),i.default.hasClass(a.target,"paneScroller"))f.a.useCustomScroller&&(r=!0);else if(f.a.isMobile||!i.default.hasClass(a.target,"prefixNumList")&&!i.default.hasClass(a.target,"mdImage"))if(!f.a.isMobile&&i.default.hasClass(a.target,"emptyItemAddButton"))xo.menus.openContextMenu({componentName:"ReactContextMenuAddItem",element:a.target,item:this,paneObject:t,pane:n}),r=!0;else if(!f.a.isMobile&&i.default.hasClass(a.target,"link")){var s=a.target.getAttribute("data-href"),l=C.a.isSelected(e,n);l||f.a.mac&&a.metaKey||!f.a.mac&&a.ctrlKey||!i.default.isUrlImage(s)?(f.a.mac&&a.metaKey||!f.a.mac&&a.ctrlKey||f.a.isMobile||i.default.findParent(a.target,"appLink",2)&&!l)&&(i.default.openUrl(s,a),i.default.preventAndStop(a)):(xo.menus.openLightbox(s),i.default.preventAndStop(a))}else f.a.isMobile&&!f.a.ie&&"UL"!==a.target.tagName&&n.isItemDraggable(this)&&!o.a.isListening("touchHoldTimeout",this.onTouchHoldTimeout)&&o.a.listen("touchHoldTimeout",this.onTouchHoldTimeout),!f.a.isMobile&&this.isDraggable()&&n.isItemDraggable(this)&&(f.a.isMobile&&a.clientX<this.getPadding(n)||!f.a.isMobile&&i.default.hasClass(a.target,"collapser")||!f.a.isMobile&&i.default.hasClass(a.target,"itemMenuIcon")||!f.a.isMobile&&i.default.findParent(a.target,"agendaTime")||!f.a.isMobile&&i.default.hasClass(a.target,"itemEditButton")||!f.a.isMobile&&i.default.hasClass(a.target,"itemPrefix")||i.default.findParent(a.target,"plugin")&&!n.isEditable)?(this.checkDragOnStart(a),i.default.vmMain.updateCursorFromEvent(a)):f.a.isMobile&&a.clientX>n.getWidth()-i.default.SPThresholdRight||!f.a.isMobile&&i.default.hasClass(a.target,"itemCheckbox")||(!f.a.isMobile&&i.default.hasClass(a.target,"blockHeaderNumItems")?r=!0:xo.pluginManager.handleTapStart(this,n,a));else r=!0;return r}},{key:"onMove",value:function(e,t){this.checkDragOnMove(e,!1)}},{key:"onClick",value:function(e,t,r){var o=i.default.focusedPane,s=f.a.isMobile&&xo.DragDrop.draggingToOutline.get();if(f.a.isMobile)var l=a(30).default;if(f.a.isMobile&&xo.DragDrop.isDragging)i.default.preventAndStop(r),f.a.isMobile&&this.isEditable.set(!1);else if(f.a.isMobile&&i.default.hasClass(r.target,"prefixTask"))o.supportCompleting&&(i.default.beginCompleteAction(),this.setComplete(!this.isComplete(),n.a.ChangeType.Local),i.default.endCompleteAction());else if(f.a.isMobile&&l.isInMultiselect()){var u;if(P.a.toggleSelected(e,o),this.isNote()?u=e-1:this.hasNote()&&(u=e+1),!isNaN(u)){var d=P.a.isSelected(e,o);P.a.toggleSelected(u,o,d)}}else if(s)s.pane.moveItem(s.item,this),xo.DragDrop.stopDraggingToOutline();else if(i.default.hasClass("blockCollapser"))t.block.toggleCollapsed();else if(f.a.isMobile||!i.default.hasClass(r.target,"prefixHeader")&&!i.default.hasClass(r.target,"prefixBullet"))if(!f.a.isMobile&&(i.default.hasClass(r.target,"itemPrefix")||i.default.hasClass(r.target,"collapser")||i.default.hasClass(r.target,"itemMenuIcon"))&&(f.a.mac&&r.metaKey||!f.a.mac&&r.ctrlKey))o.zoomIn(this,!1,!0),i.default.preventAndStop(r);else if(f.a.isMobile&&r.clientX<o.getPaddingForPaneObject(t)||!f.a.isMobile&&i.default.hasClass(r.target,"collapser"))o.handleLeftSideTap(t,r),i.default.preventAndStop(r);else if(!f.a.isMobile&&i.default.hasClass(r.target,"itemMenuIcon"))this.openItemMenu(r),i.default.preventAndStop(r);else if(!f.a.isMobile&&i.default.hasClass(r.target,"itemTime"))xo.menus.openContextMenu({componentName:"ReactContextMenuDate",element:r.target,item:this,pane:o}),i.default.preventAndStop(r);else if(!f.a.isMobile||!i.default.hasClass(r.target,"link")||f.a.isMobile&&i.default.isKeyboardOpen)if(!f.a.isMobile&&i.default.hasClass(r.target,"itemCheckbox"))o.handleRightSideTap(this,r),i.default.preventAndStop(r);else if(!f.a.isMobile&&i.default.hasClass(r.target,"prefixTask"))o.supportCompleting&&(i.default.beginCompleteAction(),this.setComplete(!this.isComplete(),n.a.ChangeType.Local),o.selectNearestItem(e),i.default.endCompleteAction()),i.default.preventAndStop(r);else if(!f.a.isMobile&&i.default.hasClass(r.target,"itemAddButton")){var c=xo.settings.getDefaultItemText();this.addItemAtIndex(c,0,o);var h=o.indexOfNextVMLI(e,!1,!0);C.a.selectIndex(h,0),i.default.preventAndStop(r)}else if(!f.a.isMobile&&i.default.hasClass(r.target,"itemEditButton"))C.a.reset(),xo.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:i.default.findParent(r.target,"item"),item:this,pane:o,selectIndex:0}),i.default.preventAndStop(r);else if("SPAN"===r.target.tagName&&i.default.hasClass(r.target,"itemDataPageLoad"))this.notifyPaginationUpdate();else if(!(i.default.hasClass(r.target,"tag")||i.default.hasClass(r.target,"date")||i.default.hasClass(r.target,"duration"))||f.a.isMobile&&i.default.isKeyboardOpen)if(!i.default.hasClass(r.target,"contact")||f.a.isMobile&&i.default.isKeyboardOpen){if(!f.a.isMobile&&i.default.hasClass(r.target,"email")){if(f.a.mac&&r.metaKey||!f.a.mac&&r.ctrlKey){var p=i.default.vmMain.getDefaultEmailPlugin();if(p.isActive()){C.a.reset();var g={to:[{text:"",email:r.target.textContent}]};xo.menus.openComposeEmail(p,void 0,void 0,g)}}}else if(xo.pluginManager.handleTapClick(this,o,r))f.a.isMobile?i.default.preventAndStop(r):xo.DragDrop.isDragging&&this.dragEnd(r);else if(M.a.hide(),f.a.isMobile){var m=document.activeElement,v=o.getScrollOffset(),y=Math.abs(v-i.default.scrollAtTouchStart)>0;if(this.allowTextEditing()){if(o.isWriteable&&!y){var _,b=this;if(f.a.ios&&this.isEditable.set(!0),f.a.isMobile&&this===o.getItem())b=o.getLastItem(),_=b.getParsedText().length;else if(i.default.getElementParent(r.target))if(f.a.isMobile&&r.clientX<this.getPadding(o))_=0;else{var k=D.default.getSelectOffsetsForMouseEvent(r);_=k?k.start:0}else _=b.getParsedText().length;f.a.isMobile&&f.a.android&&this.isEditable.set(!0),i.default.Assert(b,"Click on undefined item should not happen"),i.default.isKeyboardOpen&&m&&!i.default.findParentID(m,"search")||i.default.openKeyboardOnIndex(r,o,e,function(){o.setFocused(!0),C.a.selectIndex(e,_)},function(){}),C.a.selectIndex(e,_),setTimeout(function(){P.a.setSelected([e],o)},100)}}else r.preventDefault()}}else{if(f.a.mac&&r.metaKey||!f.a.mac&&r.ctrlKey){C.a.reset();var w=r.target.textContent;r.shiftKey?o.search.setValue(w):o.search.addToValue(w)}else if(!f.a.isMobile||!i.default.isKeyboardOpen){var S=r.target.textContent,I=T.a.findMatchExact(S[0]===n.a.ContactPrefix?S.substr(1):S);I&&xo.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:r.target,contact:I})}f.a.isMobile&&i.default.preventAndStop(r)}else{var E=r.target.textContent,L=f.a.mac&&r.metaKey||!f.a.mac&&r.ctrlKey,x=r.altKey;if((L||x)&&(C.a.reset(),P.a.reset()),L)o.search.toggleText(E,r.shiftKey);else if(x){A.e.beginAction(),xo.PaneUpdateBatcher.beginUpdateItems();var O=this.getRawText();i.default.hasClass(r.target,"date")||i.default.hasClass(r.target,"duration")?this.setMooDate(void 0,n.a.ChangeType.Local):(O=O.replace(new RegExp(E,"g"),"").replace(/  +/g," "),this.setText(O,!0,n.a.ChangeType.Local)),xo.PaneUpdateBatcher.commitUpdateItems(),A.e.endAction()}f.a.isMobile&&i.default.preventAndStop(r)}else{var R=r.target.getAttribute("data-href");i.default.openUrl(R,r),i.default.preventAndStop(r)}else o.zoomIn(this,!1,!0),i.default.preventAndStop(r)}},{key:"onEnd",value:function(e){o.a.isListening("touchHoldTimeout",this.onTouchHoldTimeout)&&o.a.unlisten("touchHoldTimeout",this.onTouchHoldTimeout),this.checkDragOnEnd(e),f.a.mobile&&a(30).default.isInMultiselect()&&(i.default.preventAndStop(e),e.returnFalse=!0),this.isLoupeOpen=!1,i.default.vmMain.updateCursorFromEvent(e)}},{key:"onCancel",value:function(e){xo.DragDrop.isDragging&&this.dragEnd(e)}},{key:"openItemMenu",value:function(e){xo.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"menu"+this.id+e.clientX+e.clientY,element:e.target,item:this,pane:i.default.focusedPane,pos:{left:e.pageX,top:e.pageY}})}},{key:"onRightClick",value:function(e,t){this.openItemMenu(t),t.preventDefault(),t.stopPropagation()}},{key:"onDoubleClick",value:function(e,t){var a=i.default.focusedPane;!f.a.isMobile&&xo.pluginManager.handleDoubleTap(this,a,t)&&(f.a.isMobile?i.default.preventAndStop(t):xo.DragDrop.isDragging&&this.dragEnd(t))}},{key:"onAutocompleteTapped",value:function(e,t,a){i.default.Assert(a,"Must be tracking the current AC tag");var r=this.getParsedText(),o=C.a.getStartOffset()-a.length,s=r.substr(0,o)+e+r.substr(C.a.getStartOffset()+1);C.a.getPane().setFocused(!0),this.setText(s,!0,n.a.ChangeType.Local),C.a.selectIndex(C.a.getStartIndex(),o+t)}}])&&L(s.prototype,l),u&&L(s,u),r}()}(re),!0),S.a.extendClass(re,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se;return function(t){function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),G(this,K(a).apply(this,arguments))}var r,o,s;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(a,e),r=a,(o=[{key:"onChangeRemote",value:function(e,t,a){var r=this,o=!1;if("isArchived"in t){if(t.isArchived&&!this._isArchived)this.archiveSelf(a);else if(this._isArchived){var s=t.parent?I.a.getItem(t.parent):void 0;s||(s=this.getItemStore().getRoot()),this.unArchiveIntoItem(s,a)}o=!0}Object.keys(t).map(function(e){var s,l=t[e];switch(e){case"text":r.onChangeRemoteText(l,a);break;case"parent":o||r.parent().id===l||(r.onChangeRemoteParentOrIndex(t,a),o=!0);break;case"index":o||r.index===l||(r.onChangeRemoteParentOrIndex(t,a),o=!0);break;case"priority":r.setPriority(l||0,a);break;case"isComplete":r.setComplete(l||!1,a);break;case"isStarred":r.setStarred(l||!1,a);break;case"dateCompleted":r.dateCompleted=l?new Date(l):null,s=!0;break;case"date":r.setMooDate(z.a.fromData(l),a);break;case"note":l?r.addRemoteNote(l,a):r.hasNote()&&r.removeRemoteNote(a);break;case"dateModified":r.dateModified=new Date(l);break;case"flags":var u=i.default.isFlagSet(l,n.a.VMLIFlag.Complete);r.isComplete()!==u?r.setComplete(u,a):r.setFlags(l),N.a.itemSearchChanged(r)}s&&r.parseText(!0,a)})}},{key:"onChangeRemoteText",value:function(e,t){this.setText(e,!0,t)}},{key:"findRealItemIndex",value:function(e,t){for(var a=0,i=e.items.get(),n=0;n<i.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t<i[n].index)return n}return i.length-1}},{key:"onChangeRemoteParentOrIndex",value:function(e,t){var a=this.parent(),i=e.parent?I.a.getItem(e.parent):a;xo.PaneUpdateBatcher.beginUpdateItems(),this.index=e.index,a!==i&&(this.setParent(i),a.items.remove(this),i.items.push(this),a.items.sort(this.sortComparatorIndex)),i.items.sort(this.sortComparatorIndex),N.a.itemSearchChanged(this),xo.PaneUpdateBatcher.commitUpdateItems()}},{key:"addRemoteNote",value:function(e,t){}},{key:"removeRemoteNote",value:function(e){}}])&&W(r.prototype,o),s&&W(r,s),a}()}(re),!0);var oe,se=re;function le(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ue(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var de=(ue((oe=function(){function e(t,a,n,r,o,s,l,u,d){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.numItems=0,i.default.Assert(i.default.isFunction(u),"Must supply a valid parser"),this._readonly=!!a,this._isDestructible=!!n,this._enabledFilters=l,this._trackGlobally=!!r,this._requireStoredEls=!!o,this._parser=u,this._owner=d,this._root=void 0,this._data={},this._destroyed=!1}var t,a,r;return t=e,(a=[{key:"getParser",value:function(){return this._parser}},{key:"areFiltersEnabled",value:function(e){return i.default.isAtLeastOneFlagSet(this._enabledFilters,e)}},{key:"getEnabledFilters",value:function(){return this._enabledFilters}},{key:"isOwner",value:function(e){return this._owner===e}},{key:"destroy",value:function(){i.default.Assert(this._isDestructible,"Item store must be destructible to destroy"),this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0}},{key:"checkDestroyed",value:function(){i.default.Assert(!this._destroyed,"Should not be using a destroyed item store")}},{key:"trackGlobally",value:function(){return this._trackGlobally}},{key:"requireStoredEls",value:function(){return this._requireStoredEls}},{key:"clearStore",value:function(){if(this._isDestructible){for(var e in xo.PaneUpdateBatcher.beginUpdateItems(),this._data)this._root&&e===this._root.id||this._data[e].destroy();xo.PaneUpdateBatcher.commitUpdateItems()}this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)}},{key:"createRoot",value:function(e,t){return this.checkDestroyed(),this._root=this.createItem(e,t,void 0,{isRoot:!0},n.a.ChangeType.None),this._root}},{key:"setRoot",value:function(e){this.checkDestroyed(),i.default.Assert(e,"Must specify a valid root item"),i.default.Assert(e.belongsToItemStore(this),"Root item must belong to this item store"),this._root=e}},{key:"createItem",value:function(e,t,a,r,o){var s;i.default.Assert(a||r&&r.isRoot,"Must always sepcify a valid parentID when creating a new item"),this.checkDestroyed(),i.default.Assert(!this._data[e],"Should never double-create for the same item, should use update instead"),void 0===o&&(o=n.a.ChangeType.None),a&&(s=this._data[a],i.default.Assert(s,"Parent must be valid if defined"));var l={id:e,text:t};if(r)for(var u in r)r.hasOwnProperty(u)&&(l[u]=r[u]);var d=new se(l,{store:this,parent:s,changeType:o,canDestroy:this._isDestructible,noSave:this._readonly});return this.numItems++,this._data[d.id]=d,d}},{key:"createItemRaw",value:function(e,t){i.default.Assert(t.parent||t&&(t.isRoot||t.noSave||t.noParentOkay),"Must always sepcify a valid parentID when creating a new item"),this.checkDestroyed(),i.default.Assert(!!t.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match"),i.default.Assert(!!t.noSave===this._readonly,"When creating raw items, noSave must match"),t.store=this;var a=new se(e,t);return i.default.Assert(!this._data[a.id],"Should not create an item that already exists in this store"),this._data[a.id]=a,this.numItems++,a}},{key:"destroyItem",value:function(e){i.default.Assert(this._isDestructible,"ItemStore must be destructible to destroy items");var t=this._data[e];i.default.Assert(t,"Must always destroy a valid item"),i.default.Assert(!t.isDestroyed(),"Should never destroy an item twice"),t.parent()&&(t.parent().removeChild(t,n.a.ChangeType.Local),t.setParent(void 0)),t.destroy(),delete this._data[e]}},{key:"modifyItemID",value:function(e,t){i.default.Assert(e.belongsToItemStore(this),"Item must belong to this item store"),i.default.Assert(e.id!==t,"Must actually be modifying the item ID"),i.default.Assert(this._data[e.id],"Must have a valid item stored under the current ID: "+e.id+" - "+t+" - "+e.isDestroyed()),i.default.Assert(!this._data[t],"Must not be overwriting an existing item"+e.id+" - "+t+" - "+e.isDestroyed()),delete this._data[e.id],this._data[t]=e}},{key:"manualModifyItemID",value:function(e,t){i.default.Assert(!this._data[t],"Must not be overwriting an existing item"+e+" - "+t);var a=this._data[e];i.default.Assert(a,"Must have valid item to change its ID"),a&&(delete this._data[e],this._data[t]=a)}},{key:"getItem",value:function(e){return this.checkDestroyed(),this._data[e]}},{key:"hasItem",value:function(e){return this.checkDestroyed(),!!this._data[e]}},{key:"getRoot",value:function(){return this.checkDestroyed(),this._root}},{key:"isRoot",value:function(e){return this.checkDestroyed(),this._root===e}},{key:"getCount",value:function(){return this.checkDestroyed(),Object.keys(this._data).length}},{key:"forEach",value:function(e){for(var t in this.checkDestroyed(),this._data)this._data[t]&&e(this._data[t])}},{key:"_markPaneDirty",value:function(e){e.usesItemStore(this)&&(e===i.default.focusedPane?e.setItemsWillBeDirty():e.setItemsDirty())}},{key:"updateItems",value:function(e){e&&!e.belongsToItemStore(this)||(xo.PaneManager.runForEachPane(function(t){t.usesItemStore(this)&&(t.preventUpdateItemsForItem&&t.preventUpdateItemsForItem.item===e?t.setItemsWillBeDirty():t.setItemsDirty())}.bind(this)),xo.PaneUpdateBatcher.updateAllItems())}},{key:"onItemChanged",value:function(e,t){var a,i=this;e&&!e.belongsToItemStore(this)||xo.PaneManager.runForEachPane(function(n){if(n.usesItemStore(i)){var r=n.handleItemChanged(e,t);a=a||r}}),a&&xo.PaneUpdateBatcher.updateAllItems()}}])&&le(t.prototype,a),r&&le(t,r),e}()).prototype,"_markPaneDirty",[g.a],Object.getOwnPropertyDescriptor(oe.prototype,"_markPaneDirty"),oe.prototype),ue(oe.prototype,"updateItems",[g.a],Object.getOwnPropertyDescriptor(oe.prototype,"updateItems"),oe.prototype),oe);function ce(e){return(ce="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fe(e,t){return!t||"object"!==ce(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pe(e){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var me,ve=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=fe(this,pe(t).call(this)))._itemStores={},e._iteratingStores=!1,e.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},e}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(t,p["a"]),a=t,(r=[{key:"init",value:function(){var e=n.a.ItemStoreFilter.Dates|n.a.ItemStoreFilter.Priority;this.registerItemStore("DefaultStore",void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:e}),this._tempItemStore=this.registerItemStore("TempStore",void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})}},{key:"registerItemStore",value:function(e,t,a){i.default.Assert(!this._itemStores[e],"Should only register a single item store per plugin: ",e),i.default.Assert(!this._iteratingStores,"Should never add a store while iterating");var r=!0,o=!0,s=!0,l=!0,u=!1,d=n.a.ItemStoreFilter.None,c=F.a.runParseText.bind(F.a);a&&(void 0!==a.isReadonly&&(r=a.isReadonly),void 0!==a.isDestructible&&(o=a.isDestructible),void 0!==a.enabledFilters&&(d=a.enabledFilters),void 0!==a.parserFn&&(c=a.parserFn),void 0!==a.trackGlobally&&(s=a.trackGlobally),void 0!==a.requireStoredEls&&(l=a.requireStoredEls),void 0!==a.listenToItemStateChanged&&(u=a.listenToItemStateChanged));var h=new de(e,r,o,s,l,u,d,c,t);return a&&a.noRegister||(this._itemStores[e]=h,this.fireEvent(this.Events.StoreAdded,h.getEnabledFilters(),[h])),h}},{key:"unregisterItemStore",value:function(e){i.default.Assert(this._itemStores[e],"Must register an item store before destroying it"),i.default.Assert(!this._iteratingStores,"Should never remove a store while iterating");var t=this._itemStores[e];delete this._itemStores[e],t.destroy(),this.fireEvent(this.Events.StoreRemoved,t.getEnabledFilters(),[t])}},{key:"getItemStore",value:function(e){return i.default.Assert(this._itemStores[e],"Must register an item store before using it"),this._itemStores[e]}},{key:"getDefaultItemStore",value:function(){return this._itemStores.DefaultStore}},{key:"getTempItemStore",value:function(){return this._tempItemStore}},{key:"runForEachStore",value:function(e,t){for(var a in t=t||n.a.ItemStoreFilter.None,this._iteratingStores=!0,this._itemStores)if(this._itemStores.hasOwnProperty(a)){var r=this._itemStores[a];if(t===n.a.ItemStoreFilter.None||r.areFiltersEnabled(t))try{e(r)}catch(o){i.default.reportError(o)}}this._iteratingStores=!1}}])&&he(a.prototype,r),o&&he(a,o),t}(),ye=a(18),_e=a(52);function be(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ke(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var we=(ke((me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.enableTempPanePosition=!1,this.totalWidth=new X.a(0),this._panesById={},this._panes=new Q.a,this.displayPanes=new Q.a,this.isLoading=new X.a(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0}var t,a,r;return t=e,(a=[{key:"init",value:function(){}},{key:"load",value:function(){xo.settings.activeUser.get()&&this.setupInitialTimeout(),this.isLoaded||(this._panes.listen(this.updateDisplayPanes),f.a.onResize.listen(this.onResize),o.a.listen("panesChanged",this.updateDisplayPanes),this.onResize(),this.isLoaded=!0)}},{key:"onPluginGmailToggled",value:function(){this.savePaneState(),this.loadPanesFromState()}},{key:"loadDemoPanes",value:function(e){var t=0;this.load(),xo.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[a].split(",");if("help"===r[0])i.default.vmMain.showHelp();else{var o=r[0],s={document:I.a.getDefaultDocument()};if("1"===o||"Outline"===o?(o=n.a.PaneMode.Task,s.viewState={viewMode:n.a.TaskViewMode.Outline}):("2"===o||"Calendar"===o)&&(o=n.a.PaneMode.Task,s.viewState={viewMode:n.a.TaskViewMode.Calendar_Week}),r.length>1){if(r[1]){for(var l=0,u={text:r[1]},d=r[1].split(" "),c=0;c<d.length;c++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=!1,f="-"===d[c][0],p=d[c].replace("-","");if(p.indexOf("//")>=0)h=!0,u.complete=f?-1:1;else if(p.indexOf("*")>=0)h=!0,u.starred=f?-1:1;else if(p.indexOf("!")>=0){var g;h=!0,3===p.length?g=n.a.VMLIFlag.P0:2===p.length?g=n.a.VMLIFlag.P1:1===p.length&&(g=n.a.VMLIFlag.P2),u.priority=g}h&&(u.text=u.text.replace(d[c],""))}s.search=u}var m=void 0;r[2]&&(m=I.a.getItem(r[2])),s.item=m}var v=_e.a.createPane(o,s);v&&this.addPaneAtIndex(v)}}var y=this.getPaneAtIndex(0);i.default.Assert(y,"Must always have at least one valid pane in demo mode"),y&&(C.a.setFocusedPane(y),y.zoomIn(y.getItem(),!0)),this.notifyPanes(),xo.PaneUpdateBatcher.commitUpdateItems()}},{key:"getStats",value:function(e){var t={};return void 0===e?this.runForEachPane(function(e){t[e.id]=e.getStats()}):t=this.getPaneById(e).getStats(),t}},{key:"setupInitialTimeout",value:function(){0===this._panes.length()&&(clearTimeout(this._initialTimeout),this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))}},{key:"_timeoutLoadFailed",value:function(){i.default.reportError(new Error("Pane Load Timeout")),xo.toasts.pushMessage({text:"The file is taking an unusually long time to load. Please try loading again.",actionText:"RELOAD",action:i.default.reload}),this._initialTimeout=void 0}},{key:"notifyPanes",value:function(){this._panes.notify()}},{key:"onResize",value:function(){this.updatePaneRects()}},{key:"getNextPaneID",value:function(){return++i.default.totalPanes+"P"+Date.now()}},{key:"getAllPerPaneState",value:function(e,t){for(var a=0,i=[],n=this.paneCount(),r=0;r<n;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this.getPaneAtIndex(r);i.push(o.getPerPaneState(e,t))}return i}},{key:"setAllPerPaneState",value:function(e,t,a){for(var i=0,n=this.paneCount(),r=0;r<n;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.getPaneAtIndex(r).setPerPaneState(e,t,a)}}},{key:"deletePerPaneState",value:function(e,t){var a=this.getPaneById(e);a&&a.deletePerPaneState(t)}},{key:"updatePaneStateForPane",value:function(e){i.default.Assert(e,"Must pass in a valid pane to update"),this.savePaneState()}},{key:"recreatePaneState",value:function(){var e=[];return this.runForEachPane(function(t){e.push(t.getSaveInfo())}),e}},{key:"isPaneActive",value:function(e){return!!this._panesById[e]}},{key:"createPaneAtIndex",value:function(e,t,a,n){i.default.Assert(e,"Must supply a valid pane type"),i.default.Assert(!this._iteratingPanes,"Should not change pane array while iterating"),isNaN(t)&&(t=this.paneCount()),(a=a||{}).id=a.id||this.getNextPaneID(),a.document=a.document||I.a.getDefaultDocument(),i.default.isString(a.item)&&(a.item=I.a.getItem(a.item));var r=_e.a.createPane(e,a);return r?this.addPaneAtIndex(r,t,!1,n):i.default.reportError(new Error("Invalid pane created: "+e+" | "+t)),r}},{key:"addPaneAtIndex",value:function(e,t,a,r){if(i.default.Assert(e,"Must supply a valid pane"),i.default.Assert(!this._panesById[e.id],"Should never add the same pane twice"),this._panesById[e.id]=e,this.enableTempPanePosition&&this._panes.length()>0&&t===this._panes.length()){var o=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:o,left:o.rect.get().left+n.a.PaneSpaceSize}}if(isNaN(t)?this._panes.push(e,r):this._panes.splice(t,0,e,r),e.init(),e.isExpanded.listen(this.onResize),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(e),!a){var s=this.getPaneState();isNaN(t)?s.push(e.getSaveInfo()):s.splice(t,0,e.getSaveInfo()),this.savePaneState()}}},{key:"unloadPane",value:function(e){e.unload(),e.isExpanded.unlisten(this.onResize),o.a.fireEvent("paneRemoved",[e]),i.default.Assert(this._panesById[e.id],"Should never add the same pane twice"),this._panesById[e.id]=void 0,e.destroy()}},{key:"removePaneAtIndex",value:function(e,t){var a;i.default.Assert(!isNaN(e),"Must supply a valid index to remove from"),i.default.Assert(!this._iteratingPanes,"Should not change pane array while iterating");var n=this._panes.splice(e,1,void 0,t)[0];return i.default.Assert(n,"Must have removed a valid pane"),this.unloadPane(n),this.getPaneState().splice(e,1),this.savePaneState(),a=n.id,this.ensurePaneInView(),a}},{key:"indexOfPaneType",value:function(e,t){return this._panes.get().findIndex(function(a){return e!==n.a.PaneMode.Task?a.type===e:t===n.a.TaskViewMode.Outline?a.isViewOutline():a.isViewAgenda()})}},{key:"removeFocusedPane",value:function(){return this.removePane(i.default.focusedPane)}},{key:"removePane",value:function(e){var t=this.getPaneIndex(e);return this.removePaneAtIndex(t)}},{key:"clearPanes",value:function(e){i.default.Assert(i.default.isDemoMode(),"Should only be clearing panes in demo mode"),C.a.setFocusedPane(void 0),this.runForEachPane(function(e){e.destroy()}),this._panesById={},this._panes.set([],e)}},{key:"clearPaneCaches",value:function(){this.runForEachPane(function(e){e.getInfiniteList().clearCache()})}},{key:"getPaneAtIndex",value:function(e){return this._panes.get()[e]}},{key:"getPaneIndex",value:function(e){return this._panes.get().indexOf(e)}},{key:"getFocusedPaneIndex",value:function(){return this.getPaneIndex(i.default.focusedPane)}},{key:"getPaneById",value:function(e){return i.default.Assert(this._panesById[e],"Should never request a pane that is not currently loaded"),this._panesById[e]}},{key:"getPanesByType",value:function(e){for(var t=0,a=[],i=this.paneCount(),n=0;n<i;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.getPaneAtIndex(n);e&&r.type!==e||a.push(r)}return a}},{key:"paneCount",value:function(){return this._panes.get().length}},{key:"runForEachPane",value:function(e,t){var a=0;this._iteratingPanes=!0;for(var n=this.paneCount(),r=0;r<n;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this.getPaneAtIndex(r);if(i.default.Assert(!o.isDestroyed(),"Should never have a destroyed pane in pane list"),!t||o.type===t)try{e(o)}catch(s){i.default.reportError(s)}}this._iteratingPanes=!1}},{key:"applyFnToPanes",value:function(e,t){var a=0;this._iteratingPanes=!0;for(var n=this.paneCount(),r=0;r<n;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this.getPaneAtIndex(r);if(i.default.Assert(!o.isDestroyed(),"Should never have a destroyed pane in pane list"),!t||o.type===t){var s=o[e];i.default.Assert(s,"Must provide a valid function name for the given pane type");try{s.apply(o,Array.prototype.slice.call(arguments,2))}catch(l){i.default.reportError(l)}}}this._iteratingPanes=!1}},{key:"dragPaneTo",value:function(e,t,a){for(var i,n=0,r=this._panes.get(),o=r.indexOf(e),s=-1,l=Number.MAX_VALUE,u=this.paneCount(),d=0;d<u;++d){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=this.getPaneAtIndex(d).rect.get(),h=Math.abs(d<=o?c.left-t:c.right-a);h<l&&(l=h,s=d)}if(s>=0){var f=r.indexOf(e);f!==s&&(r.splice(s,0,r.splice(f,1)[0]),this._panes.set(r),this.savePaneState(),i=!0)}return i}},{key:"paneSortFn",value:function(e,t){return e.uniquePaneID-t.uniquePaneID}},{key:"clearLoadTimeout",value:function(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0}},{key:"updateDisplayPanes",value:function(){var e=0;this._initialTimeout&&this.clearLoadTimeout();for(var t=this._panes.get().slice(0).sort(this.paneSortFn),a=[],i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t[i];n.isOverviewVisible()&&a.push({type:"overview",pane:n}),a.push({type:"pane",pane:n}),n.isExpanded.get()&&a.push({type:"emailPreview",pane:n})}this.updatePaneRects(),this.displayPanes.set(a),this.isLoading.set(!1)}},{key:"hasScrollbar",value:function(){return this.totalWidth.get()>f.a.windowWidth()}},{key:"onBoardChanged",value:function(){this.loadPanesFromState()}},{key:"_addPaneByButton",value:function(e,t,a,n){var r=this.createPaneAtIndex(e,void 0,{viewState:{viewMode:t},item:a});r&&(A.e.performAction(A.c.UIAction,{type:A.d.AddPane,data:{type:e,pane:r}}),i.default.sendEvent("Menu","AddPane_"+e)),C.a.setFocusedPane(r),r.onAdded(n)}},{key:"addPaneByButton",value:function(e,t,a){i.default.vmMain.paneFactory.canCreatePane(e)&&this._addPaneByButton(e,t,a)}},{key:"emailPreviewSize",value:function(e){var t=this._panes.length()>1?n.a.EmailPreviewSizeMaxFlex:n.a.EmailPreviewSizeMax,a=e.widthManual||n.a.ExpandedPaneWidth;return e.getOverview().isVisible.get()&&(a+=n.a.OverviewWidth),Math.max(Math.min(t,f.a.windowWidth()-a),n.a.EmailPreviewSizeMin)}},{key:"onLoadRemote",value:function(){}}])&&be(t.prototype,a),r&&be(t,r),e}()).prototype,"onResize",[g.a],Object.getOwnPropertyDescriptor(me.prototype,"onResize"),me.prototype),ke(me.prototype,"updateDisplayPanes",[g.a],Object.getOwnPropertyDescriptor(me.prototype,"updateDisplayPanes"),me.prototype),me),Se=a(30);function Ie(e){return(Ie="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ce(e,t){return!t||"object"!==Ie(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pe(e,t,a){return(Pe="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=Ae(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function Ae(e){return(Ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Te=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ce(this,Ae(t).call(this)))._docID=void 0,e._state={selected:"",panes:{}},e.selected=new X.a({type:n.a.PaneMode.Task,viewMode:n.a.TaskViewMode.Outline}),e}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(t,we),a=t,(r=[{key:"init",value:function(){Pe(Ae(t.prototype),"init",this).call(this),xo.settings.panesMobile.listen(this.onSettingChanged.bind(this))}},{key:"loadPanesFromState",value:function(e){if(0===this._panes.length()&&I.a.hasDocuments()&&(e||xo.settings.panesMobile.get())){var t=0;this.load();var a=[];a.push(this.loadPaneFromState(n.a.PaneMode.Task,"Tasks",n.a.TaskViewMode.Outline)),a.push(this.loadPaneFromState(n.a.PaneMode.Task,"Agenda",n.a.TaskViewMode.Agenda_All));for(var r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=a[r];this._panesById[o.id]=o}this._panes.set(a,!1),i.default.Assert(this.selected.get(),"Mobile pane selected should be set");var s,l=this.selected.get();if(l&&(s=this.indexOfPaneType(l.type,l.viewMode)),isNaN(s)||!a[s]){var u={type:n.a.PaneMode.Task,viewMode:n.a.TaskViewMode.Outline};this.selected.set(u),s=this.indexOfPaneType(u.type,u.viewMode)}C.a.setFocusedPane(a[s]),this.notifyPanes()}}},{key:"onLoadRemote",value:function(){this.loadPanesFromState(!0)}},{key:"loadPaneFromState",value:function(e,t,a){var i,n=this.getMobilePaneName(e,a),r=this._state.panes&&this._state.panes[n];if(r)i=xo.PaneManager.loadPaneFromState(r);else{var o=I.a.getDefaultDocument();i=_e.a.createPane(e,{name:t,viewState:{viewMode:a},document:o})}return i.init(),i}},{key:"hasLoadedPaneState",value:function(){return this._panes.length()>0}},{key:"getPaneState",value:function(){return 0===this._panes.length()&&this.load(),this._panes.get()}},{key:"savePaneState",value:function(){var e=this.recreatePaneState();if(e[0])for(var t=0,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a],n=this.getMobilePaneName(i.type,i.viewState.viewMode);this._state.panes||(this._state.panes={}),this._state.panes[n]=i}this.save()}},{key:"migrateFromPaneState",value:function(e){var t={};for(var a in e)if(e.hasOwnProperty(a)){var i=e[a];t[a]=this.createDefaultState(i),i[0]&&(t[a].selected={type:i[0].type,viewMode:n.a.TaskViewMode.Outline})}return t}},{key:"createDefaultState",value:function(e){var t={selected:n.a.PaneMode.Task,panes:{}};if(e)for(var a=0,i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.panes[e[i].type]=[e[i]]}return t}},{key:"load",value:function(){Pe(Ae(t.prototype),"load",this).call(this);var e,a,r=!1,o=xo.settings.panesMobile.get();if(e=o,o){if(i.default.isString(o))try{a="A",e=JSON.parse(o),a="AA"}catch(l){a="AB"}}else{a="B",r=!0;var s=ye.a.getValue("paneState");if(s){try{s=JSON.parse(s),a="BA"}catch(l){a="BB",i.default.reportError(l),s={}}e=this.migrateFromPaneState(s)}else a="C"}(e=e||this._state)||(e=this.createDefaultState([]),r=!0),e.selected||(e.selected={type:n.a.PaneMode.Task,viewMode:n.a.TaskViewMode.Outline}),i.default.Assert(e.panes,"Should have panes set by now",a),e.panes||(e.panes={}),this._state=e,this.selected.set(e.selected),r&&this.save(),this._isLoaded=!0}},{key:"save",value:function(){this._state.selected=this.selected.get(),xo.settings.panesMobile.set(this._state)}},{key:"onSettingChanged",value:function(){this._isSaving||this.load()}},{key:"getMobilePaneName",value:function(e,t){return e+(e===n.a.PaneMode.Task&&t?"_"+t:"")}},{key:"swapToPane",value:function(e,t,a){i.default.Assert(f.a.isMobile,"We only perform pane swapping on mobile"),i.default.Assert(!this._iteratingPanes,"Should not change pane array while iterating"),Se.default.setOverviewVisibility(i.default.focusedPane,!1);var n=this.indexOfPaneType(e,t);n<0&&(this.loadPanesFromState(),n=this.indexOfPaneType(e,t));var r=this._panes.get()[n];return this.animatePaneSwap=a,i.default.Assert(r,"Swapping to undefined pane",e,this._panes.length()),C.a.setFocusedPane(r),this.selected.set({type:e,viewMode:t}),this.savePaneState(),r}},{key:"loadInitialState",value:function(){var e=xo.pluginManager.getPlugin(n.a.PluginID.Gmail);e.onSettingChanged(e.Settings.IsEnabled,this.onPluginGmailToggled.bind(this)),this.loadPanesFromState()}},{key:"removePanesByType",value:function(e){i.default.Assert(e,"Must supply a valid pane type to remove"),i.default.focusedPane&&i.default.focusedPane.type!==e||this.swapToPane(n.a.PaneMode.Task)}},{key:"getPaneTopPadding",value:function(){return i.default.topBarHeight}},{key:"updatePaneRects",value:function(e){var t=0;this.isResizingPane=e;var a,n=this._panes.get(),r=f.a.windowWidth(),o=f.a.windowHeight()-this.getPaneTopPadding();for(a=0;a<n.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s={left:a*r,top:0,width:r,height:o,right:r,bottom:o},l=n[a];i.default.areObjectsEqual(l.rect.get(),s)||l.rect.set(s)}this.selected.notify()}},{key:"ensurePaneInView",value:function(e){}}])&&De(a.prototype,r),o&&De(a,o),t}(),Ee=a(67),Le=a(40);function xe(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Oe,Re=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,i;return t=e,(a=[{key:"asdfasdf",value:function(){}},{key:"setNotifications",value:function(e){}}])&&xe(t.prototype,a),i&&xe(t,i),e}());function Fe(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ne=(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((Oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,this.oldSoftDates=["now","next","soon","later","someday"],this.agendaSort=new X.a(xo.settings.agendaSort.get()||this.createDefaultAgendaSort())}var t,a,r;return t=e,(a=[{key:"clearDailyCaches",value:function(){}},{key:"addNotification",value:function(e){i.default.Assert(e,"Must provide a valid item to schedule notifications for"),this.notificationItems[e.id]=e,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),i.default.shouldLog(n.a.LogLevels.Timeline)&&i.default.log("Add Notification: ",e)}},{key:"removeNotification",value:function(e){i.default.Assert(e,"Must provide a valid item to unschedule notifications for"),this.notificationItems[e.id]&&(this.notificationItems[e.id]=void 0,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),i.default.shouldLog(n.a.LogLevels.Timeline)&&i.default.log("Remove Notification: ",e))}},{key:"clearNotifications",value:function(){for(var e in this.notificationItems)this.notificationItems.hasOwnProperty(e)&&(this.notificationItems[e]=void 0,this.numNotificationItemsChanged++);clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),i.default.shouldLog(n.a.LogLevels.Timeline)&&i.default.log("Clear Notifications")}},{key:"shouldNotify",value:function(e,t){t||(t=new Date);var a=e.getNextDate();return!e.isDestroyed()&&!e.isDeleted()&&!e.isComplete()&&!e.hasCompletedAncestor()&&!e.allDayDate()&&a&&a>t&&+a-Date.now()<864e5}},{key:"updateNotifications",value:function(e){var t=this;if(f.a.supportsNotifications()&&Le.a.isNotificationsEnabled()&&!i.default.isDemoMode()){var a=new Date;e?(i.default.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(e,a)?this.addNotification(e):this.removeNotification(e)):(i.default.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),I.a.runOnAllDocumentRoots(function(e){i.default.searchVMLIs({item:e,includeArchived:!1,each:function(e){t.shouldNotify(e,a)&&t.addNotification(e)}})}))}}},{key:"setupNotifications",value:function(){i.default.Assert(f.a.supportsNotifications(),"Platform must support notifications");var e=[];for(var t in this.notificationItems)if(this.notificationItems.hasOwnProperty(t)){var a=this.notificationItems[t];if(a&&a.getNotificationEntries){var r=a.getNotificationEntries();if(r)if(i.default.isArray(r))for(var o=0,s=0;s<r.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e.push(r[s])}else e.push(r)}else delete this.notificationItems[t]}Re.setNotifications(e),i.default.shouldLog(n.a.LogLevels.Timeline)&&i.default.log("Notifications Scheduled: "+this.numNotificationItemsChanged),this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,i.default.shouldLog(n.a.LogLevels.Timeline)&&i.default.log("Scheduled Notifications: ",e)}},{key:"createDefaultAgendaSort",value:function(){return{overdue:-2,"#now":-1,starred:1,important:2,"#next":3,"#soon":101,"#later":301,"#someday":1401}}},{key:"getDateForKey",value:function(e){return this.oldSoftDates.indexOf(e)>=0&&(e="#"+e),this.agendaSort.get()[e]}},{key:"saveAgendaSort",value:function(e){this.agendaSort.set(e),xo.settings.agendaSort.set(e),xo.PaneManager.runForEachPane(function(e){e.isViewAgenda()&&e.setItemsDirty()}),xo.PaneUpdateBatcher.updateAllItems()}}])&&Fe(t.prototype,a),r&&Fe(t,r),e}()).prototype,"setupNotifications",[g.a],Object.getOwnPropertyDescriptor(Oe.prototype,"setupNotifications"),Oe.prototype),Oe);function Be(){this._registeredRenderers=[],this._registeredRenderers[n.a.PluginRenderTypes.Generic]={},this._registeredRenderers[n.a.PluginRenderTypes.StyledText]={},this._registeredRenderers[n.a.PluginRenderTypes.UnstyledText]={},this._registeredRenderers[n.a.PluginRenderTypes.Measure]={}}Be.prototype={registerDefaultRenderers:function(){var e=this;this.registerRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.DriveFile,function(e,t,a){if(e.isLoaded()){var i=e.getField("title");return a&&(i=xo.ElementRenderer.replaceTextWithSearch(i,t)),e.hasField("isDeleted")&&e.getField("isDeleted")?i+"  (Deleted)":i}return e.hasField("title")?e.getField("title")+"  (Loading...)":"Loading..."},["title"]),this.registerRenderer(n.a.PluginRenderTypes.UnstyledText,n.a.PluginRenderers.DriveFile,function(e){return e.hasField("title")?e.getField("title"):"Loading..."},["title"]),this.registerRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.DriveFile,function(t,a,i){var r=e.useRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.DriveFile);return xo.Measure.measureWord(a,r(t),i,!1)},["title"]),this.registerRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.EmailThread,function(e,t,a){var i="";if(e&&e.isLoaded()){var r=e.getField("count"),o=e.getField("subject");if(o&&""!==o||(o="(no subject)"),a&&(o=xo.ElementRenderer.replaceTextWithSearch(o,t)),o='<span class="subject c-foreground'+(r>1?" hasCount":"")+'">'+o+"</span>",t&&t.type===n.a.PaneMode.Gmail){var s=e.getPlugin().getDisplayTags(e,t);i+='<span class="line1"><span class="from">'+e.getPlugin().getDisplayParticipants(e)+"</span>";var l,u=e.getField("date");if(l=u.isToday()?xo.International.getFormat(n.a.DFormat.ShortTime):u.getYear()!==(new Date).getYear()?xo.International.getFormat(n.a.DFormat.MonthDayYearShort):xo.International.getFormat(n.a.DFormat.MonthDay),i+='<span class="emailDate c-foreground-faded">'+u.toString(l)+"</span></span>",i+='<span class="line2">'+o,(e.getField("hasAttachments")||r>1)&&(i+='<span class="line2Right">',e.getField("hasAttachments")&&(i+='<span class="attach icon-attach_file"></span>'),r>1&&(i+='<span class="count">'+r+"</span>"),i+="</span>"),i+="</span>",e.hasField("snippet")||s.length){if(i+='<span class="line3">',e.hasField("snippet")&&(i+='<span class="snippet c-foreground-faded">'+e.getField("snippet")+"</span>"),s.length){var d=0;i+='<span class="tags">';for(var c=0;c<s.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;i+='<span class="emailLabel c-tag">'+s[c]+"</span>"}i+="</span>"}i+="</span>"}}else i=o}else i="Loading...";return i},["from","subject","snippet","count","date"]),this.registerRenderer(n.a.PluginRenderTypes.UnstyledText,n.a.PluginRenderers.EmailThread,function(e){if(e.isLoaded()){var t=e.getField("subject");return t&&""!==t||(t="(no subject)")," "+t+" "}return"Loading..."},["from","subject"]),this.registerRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.EmailThread,function(e,t,a){var i;return e.isLoaded()?(i=e.getField("subject"))&&""!==i||(i="(no subject)"):i="Loading...",xo.Measure.measureWord(t,i,a,!1)},[]),this.registerRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.CalendarEvent,function(e){return""},[]),this.registerRenderer(n.a.PluginRenderTypes.UnstyledText,n.a.PluginRenderers.CalendarEvent,function(e){return""},[]),this.registerRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.CalendarEvent,function(t,a,i){var r=e.useRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.CalendarEvent);return xo.Measure.measureWord(a,r(t),i,!1)},[]),this.registerRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.Unknown,function(e){return"Unknown Plugin"},[]),this.registerRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.Unknown,function(e,t,a){return xo.Measure.measureWord(t,"Unknown Plugin",a,!0)},[])},registerRenderer:function(e,t,a,n){i.default.Assert(this._registeredRenderers[e],"Invalid renderer type",e,t),i.default.Assert(!this._registeredRenderers[e][t],"Cannot register a renderer twice",e,t),this._registeredRenderers[e][t]={fn:a,fields:n}},useRenderer:function(e,t){return i.default.Assert(this._registeredRenderers[e],"Invalid renderer type",e,t),i.default.Assert(this._registeredRenderers[e][t],"Renderer has not been registered yet",e,t),this._registeredRenderers[e][t].fn},ensureRendererFields:function(e,t,a){}};var Ue=Be,Ve=a(19);function je(e){this._cb=e,this._pageToken=void 0,this._validToken=!1}var He={hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(e){this._pageToken=e,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(e){e?this._pageToken.notifyEndUse():this._validToken=!1},notifyPaginationUpdate:function(){i.default.log("Pagination Update")}};S.a.defineBase(je),S.a.extend(je.prototype,He);var ze=je;function qe(e,t,a){this._super.constructor.call(this),this._searchQuery=e,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=a,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=t,S.a.forceBind("onEntry",this)}var We={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(e,t){if(i.default.Assert(i.default.isFunction(e)&&i.default.isFunction(t)||this._lastPageRequest,"Must provide valid callbacks"),i.default.Assert(!this._invalid,"Should never request another page from an invalidated search"),i.default.Assert(this.hasMoreResults(),"Should never request another page if there are no possible results"),i.default.Assert(!this._activePageRequest,"Should only run a single request at a time"),e||t||!this._lastPageRequest||(e=this._lastPageRequest.entryCB,t=this._lastPageRequest.doneCB),this._activePageRequest)t(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var a=0,n=0;n<this._pageSize;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._cachedResults[this._localPageOffset+n];try{e(r)}catch(l){i.default.reportError(l)}}this._localPageOffset+=this._pageSize,t(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:e,doneCB:t},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(var o=0,s=this._localPageOffset;s<this._cachedResults.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;r=this._cachedResults[s];try{e(r)}catch(l){i.default.reportError(l)}this._localPageOffset++}t(!0)}},onEntry:function(e){this._invalid||this._cachedResults.push(e)},onDone:function(e){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,e?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,this._lastPageRequest.doneCB(e)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};S.a.inherit(ze,qe),S.a.extend(qe.prototype,We);var Ge=qe,Ke=a(26);function Ye(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Xe={Unloaded:1,Waiting:2,Requesting:3,LoadedPreview:4,LoadedFull:5,FailedRequest:6,Updating:7},Qe=function(){function e(t,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=a,this._oldLocalID=void 0,this._plugin=t,this._loadState=Xe.Unloaded,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=i,this.load()}var t,a,r;return t=e,(a=[{key:"load",value:function(e){this._loadState=Xe.Waiting,this._plugin.requestData(this,e)}},{key:"notifyDataRequested",value:function(){i.default.Assert(!this.isLoaded(),"Should not request additional data once loaded"),this._numRemoteRequests++,this._loadState=Xe.Requesting}},{key:"notifyDataLoaded",value:function(e,t,a,r){i.default.Assert(t||this._loadState!==Xe.LoadedFull||i.default.isFlagSet(e,n.a.PluginLoad.Full),"Should not load preview data after full data has been loaded"),i.default.Assert(!t||this._loadState===Xe.LoadedPreview||i.default.isFlagSet(e,n.a.PluginLoad.Full),"Incoming update much match previous type"),this._loadState=i.default.isFlagSet(e,n.a.PluginLoad.Full)?Xe.LoadedFull:Xe.LoadedPreview,this.onUpdate(!0,a,r)}},{key:"notifyDataMutated",value:function(e,t){i.default.Assert(e&&i.default.isArray(e),"Must specify valid update fields when mutating attachment state manually"),this.onUpdate(!0,e,t)}},{key:"notifyDataRequestFailed",value:function(){i.default.Assert(this._loadState===Xe.FailedRequest||this._loadState===Xe.Requesting||this._loadState===Xe.LoadedPreview,"Must be requesting remote data or a preview cache was able to service after the request was sent"),this._loadState===Xe.FailedRequest||(this._loadState===Xe.Requesting?this._loadState=Xe.FailedRequest:this._loadState===Xe.LoadedPreview?i.default.Assert(!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?"):i.default.Assert(!1,"Invalid loadstate when remote request failed: ",this._loadState))}},{key:"isLoaded",value:function(){return this._loadState===Xe.LoadedPreview||this._loadState===Xe.LoadedFull}},{key:"needsRemoteData",value:function(){return this._loadState!==Xe.LoadedFull}},{key:"getOldID",value:function(){return this._oldLocalID}},{key:"changeID",value:function(e){if(i.default.Assert(this.id!==e,"Change the ID of an attachment to the same value"),this.id!==e){var t=0,a=this.id;this.id=e,this._oldLocalID=a,i.default.Assert(!this._iteratingSubscribers,"Should not nest subscriber iterations"),this._iteratingSubscribers=!0;for(var n=0;n<this._subscribers.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._subscribers[n].onAttachmentIDChange(this,a)}catch(r){i.default.reportError(r)}}this._iteratingSubscribers=!1,this._oldLocalID=void 0}}},{key:"delayChangeID",value:function(){var e=0;i.default.Assert(!this._iteratingSubscribers,"Should not nest subscriber iterations"),this._iteratingSubscribers=!0;for(var t=0;t<this._subscribers.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._subscribers[t];try{var n=a.onAttachmentIDChange.bind(a,this,this.id);setTimeout(n,0)}catch(r){i.default.reportError(r)}}this._iteratingSubscribers=!1}},{key:"isFieldDefined",value:function(e){return this._plugin.isFieldDefined(e)}},{key:"hasField",value:function(e){return this._plugin.hasAttachField(this,e)}},{key:"getField",value:function(e){return this._plugin.getAttachField(this,e)}},{key:"updateField",value:function(e,t,a){return this._plugin.updateAttachField(this,e,t,a)}},{key:"fieldsHaveParseEffect",value:function(e){return this._plugin.fieldsHaveParseEffect(e)}},{key:"isFieldDefault",value:function(e){return this._plugin.isAttachFieldDefault(this,e)}},{key:"fieldNeedsWrite",value:function(e,t){return this._plugin.fieldNeedsWrite(this,e,t)}},{key:"getFieldAsDate",value:function(e){var t=this._plugin.getAttachField(this,e);if(t)return new Date(t).toString(xo.International.getFormat(n.a.DFormat.MonthDay));i.default.Assert(!1,"Invalid attachment date field: ",this._plugin.id,e)}},{key:"getPlugin",value:function(){return this._plugin}},{key:"getData",value:function(){return this._plugin.getCacheData(this.id)}},{key:"getExportString",value:function(){return this._plugin.getAttachmentExportString(this)}},{key:"getEmbedString",value:function(){return this._plugin.getAttachmentEmbedString(this)}},{key:"getTitleString",value:function(){return this._plugin.getAttachmentTitleString(this)}},{key:"unload",value:function(){this._loadState=Xe.Unloaded,this._plugin.releaseAttachment(this)}},{key:"match",value:function(e){return!!this.isLoaded()&&this._plugin.matchAttachment(this,e)}},{key:"markInUse",value:function(e){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,e),this._countInUse++}},{key:"markUnused",value:function(e){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,e),i.default.Assert(this._countInUse>=0,"Should never have negative users of the attachment")}},{key:"isInUse",value:function(){return this._countInUse>0}},{key:"subscribe",value:function(e){i.default.Assert(this._subscribers.indexOf(e)<0,"Must not double subscribe"),i.default.Assert(!this._iteratingSubscribers,"Should not modify subscriptions during iteration"),i.default.Assert(e.onAttachmentUpdate,"Must specify a valid subscriber callback"),this._subscribers.push(e)}},{key:"unsubscribe",value:function(e){i.default.Assert(this._subscribers.indexOf(e)>=0,"Subscriber should be active"),i.default.Assert(!this._iteratingSubscribers,"Should not modify subscriptions during iteration"),this._subscribers.remove(e)}},{key:"forEachItem",value:function(e,t){var a=0;i.default.Assert(!this._iteratingSubscribers,"Should not nest subscriber iterations"),this._iteratingSubscribers=!0;for(var n=0;n<this._subscribers.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i.default.isVMLI(this._subscribers[n])&&(!e||this._subscribers[n].belongsToItemStore(e)))try{t(this._subscribers[n])}catch(r){i.default.reportError(r)}}this._iteratingSubscribers=!1}},{key:"onUpdate",value:function(e,t,a){var r=0;if(i.default.Assert(!t||i.default.isArray(t),"Must supply a valid value for updateFields:",t),a=a||n.a.ChangeType.Remote,e&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(l){i.default.reportError(l)}if(e||(a|=n.a.ChangeType.PluginLoad),t)for(var o=0,s=0;s<t.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;i.default.Assert(this._plugin.isFieldDefined(t[s]),"Invalid field supplied to be updated: ",t[s])}i.default.Assert(!this._iteratingSubscribers,"Should not nest subscriber iterations"),this._iteratingSubscribers=!0;for(s=0;s<this._subscribers.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{this._subscribers[s].onAttachmentUpdate(this,t,a)}catch(l){i.default.reportError(l)}}this._iteratingSubscribers=!1}},{key:"notifyItemNoteChanged",value:function(e){this._plugin.notifyItemNoteChanged(this,e)}},{key:"notifyItemTextChanged",value:function(e,t){this._plugin.notifyItemTextChanged(this,e,t)}},{key:"notifyItemDateChanged",value:function(e){this._plugin.notifyItemDateChanged(this,e)}},{key:"notifyItemPropertyChanged",value:function(e,t,a){this._plugin.notifyItemPropertyChanged(this,e,t,a)}},{key:"isLocalOnlyAttachment",value:function(){return i.default.isTempId(this.id)}},{key:"isType",value:function(e){return this._plugin.getType()===e}},{key:"isPlugin",value:function(e){return this._plugin.id===e}},{key:"shouldBeDeleted",value:function(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()}},{key:"hasFatalError",value:function(){return this._loadState===Xe.FailedRequest&&this._numRemoteRequests>3}},{key:"hasInlineData",value:function(){return!!this._inlineData}},{key:"getInlineData",value:function(){return this._inlineData}},{key:"clearInlineData",value:function(){this._inlineData=void 0}}])&&Ye(t.prototype,a),r&&Ye(t,r),e}();function Je(e){this._taskCB=e,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,S.a.forceBind("handleLowImpactBegin",this),S.a.forceBind("_onTaskEndRun",this),o.a.listen("lowImpactBegin",this.handleLowImpactBegin)}Je.prototype={getStats:function(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},handleLowImpactBegin:function(){this._startTaskRun()},requestRun:function(){this._forceRun=!0,this._startTaskRun()},notifyWorkAvailable:function(){this._workAvailable=!0,i.default.vmMain.isLowImpact()&&!this._isRunning&&this._startTaskRun()},_startTaskRun:function(){this._isRunning||this._disabled||!this._workAvailable||(i.default.Assert(this._forceRun||i.default.vmMain.isLowImpact(),"Must always run a task during a low impact timeframe"),this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun))},_onTaskEndRun:function(e){i.default.Assert(this._isRunning,"Must be currently running task to finish"),this._isRunning=!1,this._forceRun=!1,(e||this._workAvailable)&&(this._workAvailable=!0,i.default.vmMain.isLowImpact()&&this._startTaskRun())}};var Ze=Je;function $e(e,t,a,n,r,o){i.default.Assert(i.default.isFunction(r),"Must supply a valid entry CB"),i.default.Assert(i.default.isFunction(o),"Must supply a valid done CB"),this._nextPageToken=e,this._inUse=!1,this._q=t,this._info=a,this._maxResults=n,this._entryCB=r,this._doneCB=o}var et={updateToken:function(e){i.default.Assert(this._nextPageToken!==e,"Should never update token to be same value"),this._nextPageToken=e},getNextPageToken:function(){return this._nextPageToken},getInfo:function(){return this._info},getQuery:function(){return this._q},getEntryCB:function(){return this._entryCB},getDoneCB:function(){return this._doneCB},getMaxResults:function(){return this._maxResults},hasMorePages:function(){return!!this._nextPageToken},notifyBeginUse:function(){i.default.Assert(!this._inUse,"Should not currently be in use"),this._inUse=!0},notifyEndUse:function(){i.default.Assert(this._inUse,"Should always be using token when done"),this._inUse=!1},isInUse:function(){return this._inUse}};S.a.defineBase($e),S.a.extend($e.prototype,et);var tt=$e;function at(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var it=[1,5,20,40,80,170],nt=[n.a.HTTPStatusCode.Network,n.a.HTTPStatusCode.Timeout,n.a.HTTPStatusCode.TooMany,n.a.HTTPStatusCode.ServerError,n.a.HTTPStatusCode.BadGateway,n.a.HTTPStatusCode.Unavailable,n.a.HTTPStatusCode.GatewayTimeout,null],rt=[n.a.HTTPStatusCode.Forbidden,n.a.HTTPStatusCode.TooMany],ot={};ot[n.a.PluginDependency.DemoMode]={online:!1},ot[n.a.PluginDependency.GoogleLogin]={online:!0},ot[n.a.PluginDependency.PremiumSub]={online:!1},ot[n.a.PluginDependency.EarlyAccess]={online:!1};var st=n.a.DETAILED_STATS,lt=function(){function e(t,a,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i.default.Assert(t,"Must supply a valid id"),i.default.Assert(n,"Must supply a valid name"),this.id=t,this.name=n,this.DefaultRequestTimeout=i.default.seconds(15),this.LongWaitThreshold=i.default.seconds(7),this._previewCache="p_"+t,this._offlineCache="ocache_"+t,this._paneType="Pane"+t,this._acProviderId="AC"+t,this._settingsGroup="plugin"+this.id,this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new X.a(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._attachKeys=[],this._attachCache={},this._dataKeys=[],this._dataCache={},this._scorchOfflineCache=!1,this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._requiresOfflineAuth=!1,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._hasServicedPreviewCache=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this.Settings={},S.a.binder(this,"_retryRemoteRequest","_reqSortFn"),xo.settings.registerGroup(this._settingsGroup,a),this.registerSetting("IsEnabled","isEnabled","e",!0,!1),this.getDataPane()&&_e.a.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),st&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,combinedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0,previewCacheIsAvailable:0,previewCacheUpdate:0,previewCacheQuery:0,previewCacheMissedWrites:0},this.__TrackedStats={},this.__ReqStats=[]),this.onSettingChanged(this.Settings.IsEnabled,function(e,t){e&&xo.pluginManager.activatePlugin(r)})}var t,a,r;return t=e,(a=[{key:"getType",value:function(){return n.a.PluginType.Unknown}},{key:"sendEvent",value:function(e,t){return i.default.sendEvent(this.id,e,t)}},{key:"getSetting",value:function(e){return xo.settings[this._settingsGroup][e].get()}},{key:"setSetting",value:function(e,t,a){return xo.settings[this._settingsGroup][e].set(t,a)}},{key:"registerSetting",value:function(e,t,a,i,n){this.Settings[e]=t,xo.settings.registerSetting(t,a,this._settingsGroup,i,n)}},{key:"onSettingChanged",value:function(e,t){xo.settings[this._settingsGroup][e].listen(t)}},{key:"getCacheStats",value:function(e){var t={};if(this.supportOfflineCache()&&i.default.shouldWriteLocal()){var a={},n=ye.a.getValue(this.getOfflineCacheName());if(n){a.size=n.length;try{var r=JSON.parse(n);if(r){a.props=r.props;var o=r.data;a.count=Object.keys(o).length}}catch(c){i.default.reportError(c)}}t.Offline=a}var s=Object.keys(this._registeredCaches).length,l=0,u=function(a){t[a.id]=a,s===++l&&e(t)};if(s>0)for(var d in this._registeredCaches){if(this._registeredCaches.hasOwnProperty(d))this._registeredCaches[d].getStats(u)}else e()}},{key:"getCacheState",value:function(){var e={};for(var t in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(t)){var a=this._registeredCaches[t];e[t]=a.getState()}return e}},{key:"registerLocalCache",value:function(e,t,a,i){var n;n=a?this.id:this.id+"_"+e;var r=xo.cacheManager.registerLocalCache(n,e,t,i);return this._registeredCaches[n]=r,r}},{key:"registerDeferredTaskType",value:function(e,t,a,n){i.default.Assert(e,"Must specify a valid deferred task type"),xo.deferredTaskManager.registerTaskType(e,t,a,n)}},{key:"scheduleDeferredTask",value:function(e,t,a,n){i.default.Assert(e,"Must supply a valid local ID for deferred task"),i.default.Assert(t,"Must specify a valid deferred task type"),xo.deferredTaskManager.scheduleTask(e,t,a,!1,void 0,n)}},{key:"cancelDeferredTask",value:function(e,t){xo.deferredTaskManager.cancelTask(e,t)}},{key:"createRecurringTask",value:function(e,t){var a,i=this.id+"_"+e,n=xo.recurringTaskManager;return this.hasRecurringTask(e)?a=n.getRecurringTask(i):(this._recurringTasks.push(e),a=xo.recurringTaskManager.createRecurringTask(i,t)),a}},{key:"getRecurringTask",value:function(e){return xo.recurringTaskManager.getRecurringTask(this.id+"_"+e)}},{key:"hasRecurringTask",value:function(e){return xo.recurringTaskManager.hasRecurringTask(this.id+"_"+e)}},{key:"cancelRecurringTask",value:function(e){var t=this.id+"_"+e;return this._recurringTasks.remove(e),xo.recurringTaskManager.cancelRecurringTask(t)}},{key:"cancelRecurringTasks",value:function(){for(var e=0;this._recurringTasks.length>0;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.cancelRecurringTask(this._recurringTasks[0])}}},{key:"getRecurringStats",value:function(){for(var e=0,t={},a=0;a<this._recurringTasks.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._recurringTasks[a],n=this.getRecurringTask(i);t[i]=n.getStats()}return t}},{key:"registerLowImpactTask",value:function(e,t){i.default.Assert(!this._lowImpactTasks[e],"Must specify different IDs for each task: ",e);var a=new Ze(t);return this._lowImpactTasks[e]=a,a}},{key:"getLowImpactStats",value:function(){var e={};for(var t in this._lowImpactTasks)if(this._lowImpactTasks.hasOwnProperty(t)){var a=this._lowImpactTasks[t];e[t]=a.getStats()}return e}},{key:"getTrackedStat",value:function(e){if(st)return this.__TrackedStats[e]}},{key:"addTrackedStat",value:function(e){st&&(i.default.Assert(!this.__TrackedStats.hasOwnProperty(e),"Should not double define a tracked stat for a plugin"),this.__TrackedStats[e]=0)}},{key:"reportTrackedStat",value:function(e){st&&(i.default.Assert(this.__TrackedStats.hasOwnProperty(e),"Must first register a tracked stat before reporting instantces of it"),this.__TrackedStats[e]++)}},{key:"getStats",value:function(){return{fnCalls:st?this.__Stats:void 0,tracked:st?this.__TrackedStats:void 0,remoteReqs:st?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numDataCache:this._dataKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._numSendRequests>0?this._totalRequestSendTime/this._numSendRequests:0,avgRequestHandleTime:this._numHandledRequests>0?this._totalRequestHandleTime/this._numHandledRequests:0,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}}},{key:"getState",value:function(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,scorchedCaches:this._scorchOfflineCache,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState(),isPreviewCacheAvailable:this.isPreviewCacheAvailable(),hasServicedPreviewCache:this._hasServicedPreviewCache}}},{key:"isPluginPane",value:function(e){return e.type===this._paneType}},{key:"getPaneType",value:function(){return this._paneType}},{key:"activate",value:function(e){var t=this,a=this.isActiveObs.get();if(!a){if(this.isActiveObs.set(!0),this.useItemStore()){this._defaultItemStore=xo.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions());var r=this._defaultItemStore.createRoot(this.id+"Root","");setTimeout(function(){t.isActive()&&r.setText(t.useItemStore(),!0,n.a.ChangeType.Auto)},0)}this._hasLoadedCaches||(this.usesPreviewCache()&&this.registerPreviewCache(),this.supportOfflineCache()&&i.default.shouldWriteLocal()&&this.loadOfflineCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive()}if(this._unloadedDependencies)for(var o in e)e.hasOwnProperty(o)&&this.onDependencyLoaded(o,e[o]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),this._activate&&this._activate(),a||xo.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),!a}},{key:"deactivate",value:function(){return i.default.Assert(this.isActiveObs.get(),"Must be active in order to deactivate pane"),this.isActiveObs.set(!1),xo.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.getDataPane()&&i.default.vmMain.paneFactory.deactivatePaneType(this._paneType),this.useItemStore()&&(xo.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0}},{key:"ensurePaneTypeIsActive",value:function(){(!this.hasDependency(n.a.PluginDependency.PremiumSub)||xo.billingManager.hasPremiumFeatures())&&this.getDataPane()&&!_e.a.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||i.default.isDemoMode())&&_e.a.activatePaneType(this._paneType)}},{key:"isActive",value:function(){return this.isActiveObs.get()}},{key:"isReady",value:function(){return this._isReady}},{key:"isEnabled",value:function(){return i.default.isDemoMode()||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)}},{key:"isAvailable",value:function(){var e=!1,t=this.hasDependency(n.a.PluginDependency.EarlyAccess),a=this.hasDependency(n.a.PluginDependency.PremiumSub);i.default.Assert(!a||!t,"Must not require both early access and premium sub: "+this.id);var r=xo.billingManager.hasEarlyAccess(),o=xo.billingManager.hasPremiumFeatures();return t&&r?e=!0:a&&o?e=!0:t||a?i.default.isDemoMode()&&(e=!0):e=!0,e}},{key:"hasSettingsError",value:function(){return!1}},{key:"isCurrentlyAuthorized",value:function(e){var t=this.googleScopes();return!t||Ke.a.isAuthorizedForScopes(e,t)}},{key:"onAuthorized",value:function(e){this._pendingRequests.length>0&&xo.pluginManager.notifyHasPendingRemoteRequest()}},{key:"verifyAuthorization",value:function(e){return!0}},{key:"notifyUnauthorized",value:function(e,t){}},{key:"isOnline",value:function(){return xo.pluginManager.isOnline()}},{key:"goOnline",value:function(){}},{key:"goOffline",value:function(){}},{key:"onDocumentShared",value:function(e){}},{key:"onShutdown",value:function(){}},{key:"onDependencyLoaded",value:function(e,t){if(this._unloadedDependencies){var a=this._unloadedDependencies.indexOf(e);if(a>=0&&(i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Plugin Dependency Loaded: ",this.id,e),this._unloadedDependencies.removeAt(a),e===n.a.PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var r=0,o=!1,s=0;s<this._unloadedDependencies.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=this._unloadedDependencies[s];ot[l].online||(o=!0)}!o&&this.isActiveObs.get()&&this.offlineLoad()}}}},{key:"onAllDependenciesLoaded",value:function(){var e=this;this.isActiveObs.get()&&setTimeout(function(){i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Plugin All Dependencies Loaded: ",e.id),e._isReady=!0,e._updateAttachmentStates(),e.offlineLoad(),e.load()},0)}},{key:"areDependenciesLoaded",value:function(){return void 0===this._unloadedDependencies}},{key:"hasDependencyBeenLoaded",value:function(e){var t=!1;return this.hasDependency(e)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(e)<0&&(t=!0):t=!0),t}},{key:"getUnloadedDependencies",value:function(){return this._unloadedDependencies}},{key:"areRemoteAPIsLoaded",value:function(){return!0}},{key:"forceLoad",value:function(){this._loadedInitialData=!1,this.activate({}),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())}},{key:"hasDependency",value:function(e){var t=this.getDependencies();return!!t&&t.indexOf(e)>=0}},{key:"getOfflineCacheName",value:function(){return this._offlineCache}},{key:"loadOfflineCache",value:function(){if(i.default.Assert(0===this._dataKeys.length,"Must have no data already loaded"),this.supportOfflineCache()&&i.default.shouldWriteLocal()){var e=ye.a.getValue(this.getOfflineCacheName());if(e)try{var t=JSON.parse(e);t&&(this.loadDataFromObject(t),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Offline Cache Loaded: ",this.id))}catch(a){i.default.reportError(a)}else i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("No offline cache present: ",this.id)}}},{key:"loadDataFromObject",value:function(e){var t=0;i.default.Assert(e,"Must provide a valid dataset to load");e.props;var a=e.data;i.default.Assert(a,"Load object must contain valid data"),this._dataKeys=Object.keys(a);for(var n=0;n<this._dataKeys.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._dataKeys[n];this._dataCache[r]=this.createEntryFromLocal(r,a[r]),this._dataCache[r].id=r}}},{key:"saveOfflineCache",value:function(){if(this.supportOfflineCache()&&i.default.shouldWriteLocal())if(this._scorchOfflineCache)i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Skipping Saving Plugin Cache: ",this.id);else{for(var e=0,t=0,a={},r=0;r<this._activeAttachments.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=this._activeAttachments[r];if(i.default.Assert(o.isInUse(),"Attachments in the active list should always be in use"),o.isInUse()){var s=this.serializeEntry(o.id);s&&(a[o.id]=s,t++)}}var l={data:a,info:{writeDate:Date.now(),entries:t}};try{var u=JSON.stringify(l);i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Save Plugin Cache: ",this.id,l),ye.a.setValue(this.getOfflineCacheName(),u)}catch(d){i.default.reportError(d)}}}},{key:"clearOfflineCache",value:function(e){this.supportOfflineCache()&&i.default.shouldWriteLocal()&&(ye.a.removeValue(this.getOfflineCacheName()),e&&(this._scorchOfflineCache=!0))}},{key:"supportOfflineLoad",value:function(){return!1}},{key:"supportOfflineCache",value:function(){return!1}},{key:"createEntryFromLocal",value:function(e,t){i.default.Assert(!1,"SubClass must override")}},{key:"clearData",value:function(){for(var e=0,t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._attachCache[this._attachKeys[t]].unload()}this._attachKeys=[],this._attachCache={},this._dataKeys=[],this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]}},{key:"onCacheLimitExceeded",value:function(){for(var e in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(e)){var t=this._registeredCaches[e];t.usesDiskSpace()&&t.clearCache()}}},{key:"changeID",value:function(e,t,a){if(i.default.Assert(t!==a,"Should never be switching to the same ID"),this._attachCache[a])e.delayChangeID(a),this._attachCache[t]=void 0,this._attachKeys.remove(t),this._dataCache[t]=void 0,this._dataKeys.remove(t);else{var n=this._attachCache[t];i.default.Assert(e===n,"Attach entries must match"),n&&(this._attachCache[t]=void 0,this._attachCache[a]=n,this._attachKeys.remove(t),this._attachKeys.push(a));var r=this._dataCache[t];this._dataCache[t]=void 0,r?(r.id===t&&(r.id=a),this._dataCache[a]=r,this._dataKeys.remove(t),this._dataKeys.push(a)):i.default.Assert(this._dataKeys.indexOf(a)>=0,"Should have already changed the ID");var o=e.isLocalOnlyAttachment();e.changeID(a),e.isInUse()&&o&&this.notifyAttachmentUpdated(e)}}},{key:"_isPreviewData",value:function(e){for(var t=0,a=this.getPropertySet(n.a.PluginLoad.Preview),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.getPropertyDescriptor(a[i]).isOpt&&!e.hasOwnProperty(a[i]))return!1}return!0}},{key:"_isFullData",value:function(e){for(var t=0,a=this.getPropertySet(n.a.PluginLoad.Full),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.getPropertyDescriptor(a[i]).isOpt&&!e.hasOwnProperty(a[i]))return!1}return!0}},{key:"_addPreviewEntry",value:function(e,t){var a=this.createEntryFromLocal(e,t);return this.cacheData(e,a),a}},{key:"cacheData",value:function(e,t,a,n,r){i.default.Assert(e,"Must supply a valid key for data"),st&&this.__Stats.cacheWrites++;var o=this._dataCache[e];if(this._dataCache[e]=t,o?st&&this.__Stats.cacheUpdates++:this._dataKeys.push(e),this._attachCache[e]){var s=this._attachCache[e],l=this._getPluginLoadType(t);i.default.Assert(l,"Must either contain valid preview or full data"),s.notifyDataLoaded(l,a,n,r)}}},{key:"getCacheData",value:function(e){return this._dataCache[e]}},{key:"_attachMetadataFields",value:function(){}},{key:"fieldsHaveParseEffect",value:function(e){var t=!1;if(e){var a=this._attachMetadataFields();if(a)for(var i=0,n=0;n<e.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a.indexOf(e[n])<0){t=!0;break}}else t=!0}else t=!0;return t}},{key:"isFieldDefined",value:function(e){return!!this.getPropertyDescriptor(e)}},{key:"hasAttachField",value:function(e,t){var a=!1,n=this._dataCache[e.id];if(n&&n.hasOwnProperty(t))a=!0;else{var r=this.getPropertyDescriptor(t);if(i.default.Assert(r,"Must have a valid field descriptor",t),r&&r.isOpt)a=!0;else{var o=e.getInlineData();o&&o.hasOwnProperty(t)&&(a=!0)}}return a}},{key:"getAttachField",value:function(e,t){var a,n=this._dataCache[e.id];if(n&&n.hasOwnProperty(t))a=n[t];else{var r=this.getPropertyDescriptor(t);i.default.Assert(r,"Must have a valid field descriptor",t);var o=e.getInlineData();o&&o.hasOwnProperty(t)?a=o[t]:(i.default.Assert(!r||r.isOpt,"Field must be optional if it is not defined",t),a=r?r.defaultValue:void 0)}return a}},{key:"updateAttachField",value:function(e,t,a,n){var r=!1;i.default.Assert(this.isFieldDefined(t),"Must be updating a valid attachment field");var o=this._dataCache[e.id];(i.default.Assert(o,"Invalid field request: ",this.id,t),o)&&(this.dataFieldNeedsWrite(o,t,a)&&(o[t]=a,this.cacheData(e.id,o,!0,[t])),r=!0);var s=e.getInlineData();return s&&s.hasOwnProperty(t)&&!n&&i.default.Assert(s[t]===a,"Should never change inline field value"),r}},{key:"isAttachFieldDefault",value:function(e,t){var a=!1,n=this._dataCache[e.id];if(i.default.Assert(n,"Invalid field request: ",this.id,t),n){var r=this.getPropertyDescriptor(t);i.default.Assert(r,"Must have a valid field descriptor",t),n.hasOwnProperty(t)?r&&r.isOpt&&r.defaultValue===n[t]&&(a=!0):r&&r.isOpt&&(a=!0)}return a}},{key:"fieldNeedsWrite",value:function(e,t,a){var n=this._dataCache[e.id];return i.default.Assert(n,"Invalid field request: ",this.id,t),this.dataFieldNeedsWrite(n,t,a)}},{key:"dataFieldNeedsWrite",value:function(e,t,a){var n=!1;if(e){var r=this.getPropertyDescriptor(t);i.default.Assert(r,"Must have a valid field descriptor",t);var o=this.compactCacheField(e,t);e.hasOwnProperty(t)?void 0===a&&o===r.defaultValue||(r&&r.comparator?r.comparator(o,a)||(n=!0):o!==a?n=!0:(i.default.isObject(o)||i.default.isObject(a)||i.default.isArray(o)||i.default.isArray(a))&&(n=!0)):void 0!==a&&(r&&r.isOpt&&r.defaultValue===a||(n=!0))}return n}},{key:"hasCacheData",value:function(e){return!!this._dataCache[e]}},{key:"findCachedItemsByField",value:function(e,t,a){var i=0;st&&this.__Stats.findByField++;for(var n=[],r=0;r<this._dataKeys.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this._dataCache[this._dataKeys[r]];if(o[e]===t&&(n.push(o),n.length>=a))break}return n}},{key:"findCachedItemsByFn",value:function(e,t){var a=0;i.default.Assert(e,"Must supply a valid match function"),i.default.Assert(i.default.isFunction(e),"Match function must be a valid function"),st&&this.__Stats.findByFn++;for(var n=[],r=0;r<this._dataKeys.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._dataCache[this._dataKeys[r]];if(e(o)&&(n.push(o),n.length>=t))break}return n}},{key:"notifyAttachmentInUse",value:function(e,t){i.default.Assert(this._activeAttachments.indexOf(e)<0,"Attachment should not already be active"),this._activeAttachments.push(e),i.default.isLocalChange(t)&&this.usesPreviewCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.writeAttachmentToPreviewCache(e)}},{key:"notifyAttachmentUpdated",value:function(e){this.usesPreviewCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.writeAttachmentToPreviewCache(e)}},{key:"notifyAttachmentUnused",value:function(e,t){i.default.Assert(this._activeAttachments.indexOf(e)>=0,"Attachment should be marked active"),this._activeAttachments.remove(e),i.default.isLocalChange(t)&&this.usesPreviewCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.updatePreviewCache(e.id,void 0)}},{key:"onAuthorizedSetting",value:function(e,t){}},{key:"notifyItemNoteChanged",value:function(e,t){}},{key:"notifyItemDateChanged",value:function(e,t){}},{key:"notifyItemTextChanged",value:function(e,t,a){}},{key:"notifyItemPropertyChanged",value:function(e,t,a,i){}},{key:"getAttachment",value:function(e,t){return i.default.Assert(e,"Must provide a valid key"),e&&!this._attachCache[e]&&(this._attachCache[e]=this._requestAttachment(e,t),this._attachKeys.push(e)),this._attachCache[e]}},{key:"hasAttachment",value:function(e){return!!this._attachCache[e]}},{key:"forEachActiveAttachment",value:function(e){for(var t=0,a=0;a<this._activeAttachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._activeAttachments[a])}}},{key:"forEachAttachment",value:function(e){for(var t=0,a=0;a<this._attachKeys.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._attachCache[this._attachKeys[a]])}}},{key:"numActiveAttachments",value:function(){return this._activeAttachments.length}},{key:"getAttachmentExportString",value:function(e){for(var t=0,a=n.a.EmbedAttachChar+"p:"+this.id+",id:"+e.id,r=this.getPropertySet(n.a.PluginLoad.Inline),o=0;o<r.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=r[o],l=this.getPropertyDescriptor(s),u=e.getField(s);i.default.Assert(l.isOpt||u&&u.indexOf(":")<0&&u.indexOf(" ")<0,"Property value is invalid: "+s+", "+u),void 0!==u&&(a+=","+s+":"+u)}return a+=n.a.EmbedAttachChar}},{key:"getAttachmentEmbedString",value:function(e,t){return this._getTextForItem(e,t)}},{key:"getAttachmentTitleString",value:function(e){return this.getUnstyledText(e)}},{key:"_getTextForItem",value:function(e,t){return i.default.Assert(e,"Must pass in a valid item to get text for"),n.a.EmbedAttachChar+"p:"+this.id+",id:"+e.id+(t?","+t:"")+n.a.EmbedAttachChar}},{key:"_requestAttachment",value:function(e,t){return i.default.Assert(e,"Must provide a valid key"),st&&this.__Stats.createdAttachments++,new Qe(this,e,t)}},{key:"releaseAttachment",value:function(e){}},{key:"registerPreviewCache",value:function(){}},{key:"isPreviewCacheAvailable",value:function(){return!1}},{key:"updatePreviewCache",value:function(e,t){}},{key:"queryPreviewCache",value:function(e){}},{key:"onPreviewCacheChange",value:function(e,t,a){}},{key:"writeActiveAttachmentsToPreviewCache",value:function(){}},{key:"writeAttachmentToPreviewCache",value:function(e){}},{key:"dataHasChanged",value:function(e,t){for(var a=0,i=!e,r=this.getPropertySet(n.a.PluginLoad.Full),o=0;!i&&o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=r[o];this.dataFieldNeedsWrite(e,s,t[s])&&(i=!0)}return i}},{key:"getChangedFields",value:function(e,t){for(var a=0,i=[],r=this.getPropertySet(n.a.PluginLoad.Full),o=0;o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=r[o];this.dataFieldNeedsWrite(e,s,t[s])&&i.push(s)}return i}},{key:"serviceRemoteRequestsFromPreview",value:function(){for(var e=0,t=0,a=0;a<this._pendingRequests.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._pendingRequests[a];if(i.attach)for(var n=0,r=0;r<i.attach.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this.queryPreviewCache(i.attach[r].id);o&&this._addPreviewEntry(i.attach[r].id,o)}}for(var s=0;s<this._activeAttachments.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l=this._activeAttachments[s];if(!l.isLoaded()&&!l.isLocalOnlyAttachment()){var u=this.queryPreviewCache(l.id);u&&this._addPreviewEntry(l.id,u)}}this._hasServicedPreviewCache=!0}},{key:"usesPreviewCache",value:function(){return!1}},{key:"matchAttachment",value:function(e,t){i.default.Assert(!1,"SubClass must override")}},{key:"getStyledText",value:function(e,t,a){i.default.Assert(!1,"SubClass must override")}},{key:"getUnstyledText",value:function(e){i.default.Assert(!1,"SubClass must override")}},{key:"getBlockedText",value:function(e){return"Blocked"}},{key:"getAttachMeasure",value:function(e,t,a){}},{key:"useRenderer",value:function(e,t){var a,r=xo.pluginManager.useRenderer(e,t);switch(e){case n.a.PluginRenderTypes.StyledText:a="getStyledText";break;case n.a.PluginRenderTypes.UnstyledText:a="getUnstyledText";break;case n.a.PluginRenderTypes.Measure:a="getAttachMeasure";break;default:i.default.Assert(!1,"Unknown plugin renderer type")}a&&(this[a]=r)}},{key:"_getDisplayText",value:function(e,t,a){return this.isPluginBlocked()?this.getBlockedText(e):this.getStyledText(e,t,a)}},{key:"createDisplayElement",value:function(e){var t=this.getAttachmentClass(e);i.default.Assert(i.default.isArray(t),"Must have a valid class list"),i.default.Assert(t.indexOf("plugin")<0,"Should not already have plugin as a class"),t.push("plugin"),this.isPluginBlocked()&&t.push("blocked");var a=this._getDisplayText(e),n={attrs:{cls:t,plugin:this.id,"plugin-id":e.id},text:a},r=this.getAttachmentTooltip(e);return r&&(n.attrs["data-tooltip"]=r),n}},{key:"measureAttachment",value:function(e,t){var a;if(i.default.Assert(t&&t.attrs&&t.attrs["plugin-id"],"Must have a valid word style obj with attachment ID"),t.attrs&&!t.attrs.isUnknown){var n=this.getAttachment(t.attrs["plugin-id"]);i.default.Assert(n,"Must have valid attachment to measure: ",t.attrs["plugin-id"]),a=this.isPluginBlocked()?xo.Measure.measureWord(e,this.getBlockedText(n),t):this.getAttachMeasure(n,e,t)}else a=xo.Measure.measureWord(e,"Unknown Plugin",t);if(t.attrs&&t.attrs.cls){var r=t.attrs.cls;a+=this.pluginMargin,r.indexOf("padB")>=0&&(a+=this.pluginMargin)}return a+=this.pluginPadding}},{key:"getAttachmentClass",value:function(e){return[]}},{key:"getAttachmentTooltip",value:function(e){}},{key:"isPluginBlocked",value:function(){var e=!1;return xo.billingManager.hasPremiumFeatures()||!this.hasDependency(n.a.PluginDependency.PremiumSub)&&!this.hasDependency(n.a.PluginDependency.EarlyAccess)||(e=!0),e}},{key:"_displayMissingProperties",value:function(e,t,a){var n=0,r=!1,o=this.getPropertySet(a);i.default.log("Displaying Missing Properties: ",e);for(var s=0;s<o.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this.getPropertyDescriptor(o[s]).isOpt||t.hasOwnProperty(o[s])||(i.default.log(" Missing Property: ",o[s]),r=!0)}i.default.Assert(r,"Must be missing props to run this")}},{key:"_getPluginLoadType",value:function(e){i.default.Assert(e,"Must be querying loaded data for load state with valid data");var t=n.a.PluginLoad.None;return this._isPreviewData(e)&&(t|=n.a.PluginLoad.Preview,this._isFullData(e)&&(t|=n.a.PluginLoad.Full)),t}},{key:"requestData",value:function(e,t){var a=this;st&&this.__Stats.requestData++,t=t||n.a.PluginLoad.Preview|n.a.PluginLoad.Full;var r,o=this.getCacheData(e.id);o?(r=this._getPluginLoadType(o),i.default.isFlagSet(r,t)?e.notifyDataLoaded(r,!1,void 0,n.a.ChangeType.Remote):(i.default.forEachFlagSet(t,function(t){a._displayMissingProperties(e.id,o,t)}),!e.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(e,t))):e.isLocalOnlyAttachment()||(r=n.a.PluginLoad.None,this.isPreviewCacheAvailable()&&this._loadPreviewData(e,t),this.allowRemoteRequests()&&!i.default.isFlagSet(r,t)&&this._getRemoteAttachmentData(e,t))}},{key:"_loadPreviewData",value:function(e,t){i.default.Assert(this.isPreviewCacheAvailable(),"Preview cache must always be available after gdata cb");var a=!1,r=this.queryPreviewCache(e.id);if(r){r=this.createEntryFromLocal(e.id,r),this.cacheData(e.id,r);var o=this._getPluginLoadType(r);i.default.isFlagSet(o,t)&&e.notifyDataLoaded(o,!1,void 0,n.a.ChangeType.Remote),a=!0}return a}},{key:"_getRemoteAttachmentData",value:function(e,t){this.usesPreviewCache()&&!i.default.isDemoMode()||this.getRemoteAttachmentData(e,t)}},{key:"getRemoteAttachmentData",value:function(e,t){i.default.Assert(!1,"SubClass must override")}},{key:"_appendDupeRequest",value:function(e,t){i.default.Assert(e,"Must provide a valid queued request"),i.default.Assert(t,"Must provide a valid duped request"),i.default.Assert(!e.duped,"Must never use an already duped request as a dupe for another request"),t.attach&&(e.attach||(e.attach=[]),e.attach.pushOnlyUniques(t.attach)),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestFnsEqual",value:function(e,t){var a=!1;return e===t?a=!0:i.default.isArray(e)&&i.default.isArray(t)&&(a=e.equals(t)),a}},{key:"_areRequestsEqual",value:function(e,t){i.default.Assert(e,"Must have a valid request A"),i.default.Assert(t,"Must have a valid request B");var a=!0;if(e.accountID!==t.accountID)a=!1;else if(e.forceNoDupe||t.forceNoDupe)a=!1;else if(e.id!==t.id&&this._areRequestFnsEqual(e.requestFn,t.requestFn))if(e.data===t.data)a=!0;else{for(var n in e.data){if(!e.data.hasOwnProperty(n)||!t.data.hasOwnProperty(n)){a=!1;break}if(e.data[n]!==t.data[n]){a=!1;break}}if(a)for(var r in t.data){if(!e.data.hasOwnProperty(r)||!t.data.hasOwnProperty(r)){a=!1;break}if(e.data[r]!==t.data[r]){a=!1;break}}}else a=!1;return a}},{key:"_getDupeRequest",value:function(e){for(var t,a=0,i=0,n=0;!t&&n<this._outstandingRequests.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!this._outstandingRequests[n].duped&&this._areRequestsEqual(this._outstandingRequests[n],e)&&(t=this._outstandingRequests[n])}for(var r=0;!t&&r<this._pendingRequests.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;!this._pendingRequests[r].duped&&this._areRequestsEqual(this._pendingRequests[r],e)&&(t=this._pendingRequests[r])}return t}},{key:"_combineRequest",value:function(e,t){i.default.Assert(e,"Must provide a valid queued request"),i.default.Assert(t,"Must provide a valid combine request"),i.default.Assert(!e.combined,"Must never use an already combined request as a target for another request"),e.data=i.default.mergeObjects(e.data,t.data),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestsCombinable",value:function(e,t){i.default.Assert(e,"Must have a valid request A"),i.default.Assert(t,"Must have a valid request B");var a=!1;return e.id!==t.id&&e.combinable&&t.combinable&&e.accountID===t.accountID&&this._areRequestFnsEqual(e.requestFn,t.requestFn)&&e.type===t.type&&(e.attach||t.attach?e.attach&&t.attach&&e.attach.equals(t.attach)&&(a=!0):a=!0),a}},{key:"_getCombineRequest",value:function(e){var t;if(e.combinable)for(var a=0,i=0;!t&&i<this._pendingRequests.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!this._pendingRequests[i].combined&&this._areRequestsCombinable(this._pendingRequests[i],e)&&(t=this._pendingRequests[i])}return t}},{key:"_handleBatchRequestResponse",value:function(e){this._numOutstandingReqs--,i.default.Assert(this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}},{key:"_handleRequestResponse",value:function(e,t){t||(this._numOutstandingReqs--,i.default.Assert(this._numOutstandingReqs>=0,"Outstanding requests cannot be negative"))}},{key:"_handleRequestTimeout",value:function(e){if(this._pendingRequests.indexOf(e)>=0){var t=0;e.timedOut=!0;for(var a={error:{code:n.a.HTTPStatusCode.Network,message:"Internal request timeout"}},r=0;r<e.failureCB.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e.failureCB[r](a)}catch(o){i.default.reportError(o)}}0,this._pendingRequests.remove(e)}}},{key:"_queueRemoteRequestMulti",value:function(e,t,a,n,r,o,s,l){i.default.Assert(e,"Missing accountID parameter"),i.default.Assert(!i.default.isArray(e),"Missing accountID paramter"),i.default.Assert(!i.default.isFunction(e),"Missing accountID parameter"),i.default.Assert(!l||void 0===l.accountID,"AccountID is specified as a separate param");var u=l?i.default.clone(l):{};return u.accountID=e,this._queueRemoteRequest(t,a,n,r,o,s,u)}},{key:"_computeTimeoutMS",value:function(e){var t;return e&&void 0!==e.timeoutMS&&(0===e.timeoutMS?t=this.DefaultRequestTimeout:e.timeoutMS>=1e3&&(t=e.timeoutMS)),t}},{key:"_updateRequestTimeout",value:function(e){e.timeoutMS&&(this._clearRequestTimeout(e),e.timeout=setTimeout(this._handleRequestTimeout.bind(this,e),e.timeoutMS))}},{key:"_clearRequestTimeout",value:function(e){e.timeout&&(clearTimeout(e.timeout),e.timeout=void 0)}},{key:"_queueRemoteRequest",value:function(e,t,a,r,o,s,l){var u=this;l=l||{},i.default.Assert(e&&i.default.isArray(e),"RequestFn must be a valid packed function"),i.default.Assert(t,"Must provide valid data for the request"),i.default.Assert(a,"Must supply a callback for request success"),i.default.Assert(i.default.isFunction(a),"Success callback must be a valid function"),i.default.Assert(r,"Must supply a callback for request failure"),i.default.Assert(i.default.isFunction(r),"Failure callback must be a valid function"),i.default.Assert(s,"Request type must be specified"),i.default.Assert(l.accountID||l.token,"Must have an accountID"),i.default.Assert(!l.combinable,"Combinable is not currently a valid option. Do not use."),i.default.Assert(!o||!o.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",o?o.id:"UNDEFINED"),l.token&&!l.accountID&&(l.accountID="from_token"),st&&(this.__ReqStats[s]=this.__ReqStats[s]?this.__ReqStats[s]+1:1);var d={id:++this._requestCounter,plugin:this,attach:o?[o]:void 0,request:void 0,requestFn:e,data:t,successCB:[a],failureCB:[r],type:s,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,requestsBehind:this._pendingRequests.length,token:l.token,accountID:l.accountID,combinable:l.combinable,autoRetry:!l||void 0===l.autoRetry||l.autoRetry,timeoutMS:this._computeTimeoutMS(l),forceNoDupe:l.forceNoDupe,priority:l.priority?l.priority:n.a.RequestPriority.Default};d.autoRetry&&(d.numRetries=l&&l.numRetries?l.numRetries:2,d.currentRetries=0),this._updateRequestTimeout(d),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Request Queued: ",this.name,s,d.id,d);var c=function(){var e=u._insertPendingRequest(d);d.priority>n.a.RequestPriority.Default&&i.default.log("Insert Index: ",e,u._pendingRequests.length,d),xo.pluginManager.notifyHasPendingRemoteRequest()};d.token?c():Ke.a.getAccountAuthToken(l.accountID,this.googleScopes(),function(e){d.token=e,c()})}},{key:"_insertPendingRequest",value:function(e){e.priority++;var t=this._pendingRequests.insertSorted(e,this._reqSortFn);return e.priority--,t}},{key:"_reqSortFn",value:function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1}},{key:"_queuePagedRemoteRequestMulti",value:function(e,t,a,n,r,o,s,l){i.default.Assert(e,"Missing accountID parameter"),i.default.Assert(!i.default.isArray(e),"Missing accountID paramter"),i.default.Assert(!i.default.isFunction(e),"Missing accountID parameter"),i.default.Assert(!l||void 0===l.accountID,"AccountID is specified as a separate param");var u=l?i.default.clone(l):{};return u.accountID=e,this._queuePagedRemoteRequest(t,a,n,r,o,s,u)}},{key:"_queuePagedRemoteRequest",value:function(e,t,a,n,r,o,s){var l=this;i.default.Assert(s,"Must supply a valid options param"),i.default.Assert(!s.getAllPages||!s.maxPages,"Should only define either maxPages or getAllPages: ",s.getAllPages,s.maxPages),s.maxPages=s.maxPages||1,s.getAllPages=s.getAllPages||!1,s.maxPageResults=s.maxPageResults||(s.maxResults?s.maxResults:100),s.maxResults=s.maxResults||1/0,s.resultsField=s.resultsField||"items";var u,d=0,c=[],h=i.default.clone(t);h.maxResults=s.maxPageResults;var f=function(e){e[s.resultsField]?c.pushArray(e[s.resultsField]):e.items?c.pushArray(e.items):e.history&&c.pushArray(e.history),e.nextPageToken&&(s.getAllPages||s.maxPages>d)&&c.length<s.maxResults?u(e.nextPageToken):e.nextPageToken||e.nextSyncToken||e.historyId?a(c,t,e):a(c)},p=function(e){n(e,c)};(u=function(t){t&&(h.pageToken=t),d++,l._queueRemoteRequest(e,h,f,p,void 0,o,s)})()}},{key:"_retryRemoteRequest",value:function(e,t){var a=this;i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Request Re-Queued: ",this.name,e.type,e.id,e),st&&this.__Stats.remoteRetries++,e.request=void 0,e.wasBatched=void 0,e.batchID=void 0,e.batchRequestID=void 0,setTimeout(function(){e.currentRetries=e.currentRetries?e.currentRetries+1:1,a._insertPendingRequest(e),xo.pluginManager.notifyHasPendingRemoteRequest()},this._getRetryDelay(e,t))}},{key:"getNumOutstandingReqs",value:function(){return this._numOutstandingReqs}},{key:"_pumpRequestQueue",value:function(e,t,a,r){var o=0,s=0;i.default.Assert(this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue"),i.default.Assert(!this.hasDependency(n.a.PluginDependency.GoogleLogin)||this.hasDependencyBeenLoaded(n.a.PluginDependency.GoogleLogin),"Must be authorized to make remote requests");var l=0,u=0,d=0,c=0,h=0,f=0,p=0;i.default.Assert(this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests");var g,m=t;i.default.Assert(m>0,"Should never have more than max outstanding requests for a given plugin"),m>1&&this._pendingRequests.length>1&&(g=this.createBatch());for(var v=[],y=0;m>0&&y<this._pendingRequests.length&&p<n.a.MaxBatchSize;++y){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var _=this._pendingRequests[y];if(_.priority<e)f++;else{i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Request Pumped: ",this.name,_.type,_.id,_),i.default.Assert(!i.default.isFunction(_),"Should never use a deferred request"),i.default.Assert(!1===_.handled,"Should never service a request that has already been handled");var b=this._getDupeRequest(_);if(b)st&&this.__Stats.dupedRequests++,_.duped=!0,v.push(_),d++,this._appendDupeRequest(b,_);else{var k=this._getCombineRequest(_);if(k)st&&this.__Stats.combinedRequests++,_.combined=!0,v.push(_),c++,this._combineRequest(k,_);else{var w=!1;if(_.attach)for(var S=0,I=0;I<_.attach.length;++I){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;_.attach[I].needsRemoteData()&&(_.attach[I].notifyDataRequested(),w=!0)}else w=!0;if(w)if(_.token||this.isCurrentlyAuthorized(_.accountID)){var D=this._runRemoteRequest(g,_,a);st&&this.__Stats.remoteRequests++,(D.isNewRequest||0===p)&&(i.default.Assert(t>l,"Should not be making more requests for plugin than allowed"),l++,m--,this._numOutstandingReqs++,st&&this.__Stats.actualRemoteCallsSent++),D.wasBatched&&p++,v.push(_)}else Ke.a.notifyUnauthorizedRequest(_.accountID),h++;else st&&this.__Stats.canceledRequests++,_.canceled=!0,u++,v.push(_)}}}}this._pendingRequests=this._pendingRequests.removeArray(v);for(var C=0;C<v.length;++C){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;v[C].canceled||v[C].duped||this._addRequest(this._outstandingRequests,v[C])}return i.default.Assert(!g||p+u+d+c+h+f>1,"Batches should always have multiple items in them"),g&&(p>0?(st&&this.__Stats.remoteBatches++,this.commitBatch(g,r)):st&&this.__Stats.canceledBatches++),l}},{key:"_clearRequestQueue",value:function(){i.default.log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0}},{key:"_addRequest",value:function(e,t){return i.default.Assert(e.indexOf(t)<0,"Should never re-add a request to a queue without removing it first"),e.push(t)}},{key:"_removeRequest",value:function(e,t){return e.remove(t)}},{key:"isRateLimited",value:function(){return this._isRateLimited}},{key:"_notifyRateLimitedOver",value:function(){this._isRateLimited=!1}},{key:"_notifyRateLimited",value:function(e){this._isRateLimited=!0,this._lastRateLimitTime=new Date}},{key:"isRateLimitError",value:function(e){var t=!1;return e&&rt.indexOf(e.status)>=0&&(e.status===n.a.HTTPStatusCode.Forbidden?i.default.hasGoogleError(e,n.a.GoogleErrorDomain.UsageLimits,n.a.GoogleError.UserRateLimitExceeded)?t=!0:i.default.hasGoogleError(e,n.a.GoogleErrorDomain.UsageLimits,n.a.GoogleError.RateLimitExceeded)?t=!0:i.default.hasGoogleError(e,n.a.GoogleErrorDomain.UsageLimits,n.a.GoogleError.QuotaExceeded)&&(t=!0):t=!0),t}},{key:"_getRetryDelay",value:function(e,t){var a=e.currentRetries;return t&&(a=Math.max(2,e.currentRetries)),i.default.seconds(it[a])}},{key:"_notifyRequestSuccess",value:function(e,t){var a={cbList:e.successCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)}},{key:"_notifyRequestFailure",value:function(e,t){var a={cbList:e.failureCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)}},{key:"_handleResponse",value:function(e){for(var t=0,a=0;a<e.cbList.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e.cbList[a](e.result)}catch(n){i.default.reportError(n)}}}},{key:"_notifyBatchCompleted",value:function(e){var t=this._batchedResponses[e.getBatchID()];if(delete this._batchedResponses[e.getBatchID()],t){var a=0;xo.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._handleResponse(t[i])}xo.PaneUpdateBatcher.commitUpdateItems()}}},{key:"computeBatchGroupID",value:function(e){return e.accountID}},{key:"computeRequestID",value:function(e){return e.id+"-"+Date.now()}},{key:"_setSendTime",value:function(e){var t=Date.now();if(0===e.sendTimes.length){var a=t-e.queueTime;this._numSendRequests++,this._totalRequestSendTime+=a,a>this.LongWaitThreshold&&this._numLongWaitRequests++}e.sendTimes.push(t)}},{key:"_setHandleTime",value:function(e){var t=Date.now();if(0===e.handleTimes.length){var a=t-e.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=a}e.handleTimes.push(t)}},{key:"_runRemoteRequest",value:function(e,t,a){var r=this,o={wasBatched:!1,isNewRequest:!1};if(Ve.a.canConstruct(t.requestFn))t.request=Ve.a.createRequest(t.accountID,t.requestFn,t.data,t.token);else{var s=i.default.unpackFn(t.requestFn);i.default.Assert(i.default.isFunction(s,"Must specify a valid packed function: ",t.requestFn)),s&&(t.request=s(t.data))}if(t.request){if(i.default.Assert(t.request.then,"Remote request must be thenable"),e){var l=this.computeBatchGroupID(t),u=this.computeRequestID(t);o.isNewRequest=e.add(t.request,l,u),i.default.Assert(i.default.isBoolean(o.isNewRequest),"Add must return whether it will create a new remote request for this request"),o.wasBatched=!0,t.wasBatched=!0,t.batchID=e.getBatchID(),t.batchRequestID=u}else t.wasBatched=!1,t.batchID=void 0,t.batchRequestID=void 0;i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Request Run: ",this.name,t.type,t.id,t),i.default.Assert(t.token||this.isCurrentlyAuthorized(t.accountID),"Must be currently authorized to make this request"),this._clearRequestTimeout(t),this._setSendTime(t),t.request.then(function(e){i.default.Assert(!1===t.handled,"Must not handle the same request multiple times"),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Request Success: ",r.name,t.type,t.id,t,e),r._setHandleTime(t),t.handled=!0,r._notifyRateLimitedOver(),r._notifyRequestSuccess(t,e.result),a(t.attach,t.plugin,t.wasBatched),r._removeRequest(r._outstandingRequests,t)},function(e){i.default.Assert(!1===t.handled,"Must not handle the same request multiple times"),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Request Failed: ",r.name,t.type,t.id,t,e),r._setHandleTime(t);var o=r.isRateLimitError(e);if(o&&r._notifyRateLimited(e),(o||nt.indexOf(e.status)>=0)&&t.autoRetry&&t.currentRetries<t.numRetries)a(t.attach,t.plugin,t.wasBatched),r._removeRequest(r._outstandingRequests,t),r._retryRemoteRequest(t,o);else{if(t.handled=!0,t.failed=!0,t.attach)for(var s=0,l=0;l<t.attach.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;t.attach[l].notifyDataRequestFailed()}r._notifyRequestFailure(t,e.result),a(t.attach,t.plugin,t.wasBatched),r._removeRequest(r._outstandingRequests,t)}},this)}return o}},{key:"createPaginationToken",value:function(e,t,a,i,n,r){return new tt(e,t,a,i,n,r)}},{key:"updatePaginationToken",value:function(e,t){return i.default.Assert(e,"Must specify a valid token to update"),i.default.Assert(t,"Must update the pagination token with a valid next page token"),e.updateToken(t),e}},{key:"createBatch",value:function(e){return Ve.a.createBatch(e)}},{key:"commitBatch",value:function(e,t){var a=this;i.default.Assert(e,"Batch to commit must be specified"),e.then(function(i){a._notifyBatchCompleted(e),t(a,!0)},function(){a._notifyBatchCompleted(e),t(a,!1)})}},{key:"addModifiedOffline",value:function(e,t){if(i.default.Assert(e,"Must have a valid cache entry to update"),i.default.Assert(i.default.isBoolean(t)||i.default.isArray(t),"Incoming fields must be valid"),i.default.Assert(!1!==t,"Use removeModifiedOffline to clear data instead"),e){var a=e.modifiedOffline||!1;i.default.Assert(i.default.isBoolean(a)||i.default.isArray(a),"Previous fields must be valid"),!1===a?e.modifiedOffline=t:!0===a||(!0===t?e.modifiedOffline=!0:e.modifiedOffline.pushOnlyUniques(t))}}},{key:"removeModifiedOffline",value:function(e,t){if(i.default.Assert(e,"Must have a valid cache entry to update"),i.default.Assert(i.default.isBoolean(t)||i.default.isArray(t),"Incoming fields must be valid"),i.default.Assert(!0!==t,"Use addModifiedOffline to add data instead"),e){var a=e.modifiedOffline||!1;i.default.Assert(i.default.isBoolean(a)||i.default.isArray(a),"Previous fields must be valid"),!1===a||(!0===a?!1===t&&(e.modifiedOffline=!1):!1===t?e.modifiedOffline=!1:(e.modifiedOffline=e.modifiedOffline.removeArray(t),0===e.modifiedOffline.length&&(e.modifiedOffline=!1)))}}},{key:"compactCacheField",value:function(e,t){return e[t]}},{key:"_serializeObj",value:function(e,t){var a=0;i.default.Assert(e,"Must specify a valid entry to serialize"),i.default.Assert(t,"Must provide a valid property list");for(var n={},r=0;r<t.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t[r],s=this.getPropertyDescriptor(o);if(!s.isOpt||s.defaultValue!==e[o]){var l=this.compactCacheField(e,o);void 0!==l&&(n[o]=l)}}var u=this.getBlobData(e);return u&&(n._blob=u),n}},{key:"serializeEntry",value:function(e){var t=this.getPropertySet(n.a.PluginLoad.Full),a=this.getCacheData(e);if(a)return this._serializeObj(a,t)}},{key:"serializeExternalData",value:function(e){i.default.Assert(e,"Must supply valid data to serialize");var t=this.getPropertySet(n.a.PluginLoad.Full),a=this._serializeObj(e,t);return a.id=e.id,e.parents&&(a.parents=e.parents),a}},{key:"serializePreview",value:function(e){var t=this.getPropertySet(n.a.PluginLoad.Preview),a=this.getCacheData(e.id);if(a)return this._serializeObj(a,t)}},{key:"declareProperty",value:function(e,t,a,r,o){var s=this;i.default.Assert(!this._propertyDescriptors[e],"Should not declare the same property twice"),t=t||n.a.PluginLoad.Preview|n.a.PluginLoad.Full,a=a||!1,i.default.forEachFlagSet(t,function(t){s._propertySets[t]||(s._propertySets[t]=[]),s._propertySets[t].push(e)}),this._propertyDescriptors[e]={isOpt:a,defaultValue:r,comparator:o}}},{key:"getPropertySet",value:function(e){return this._propertySets[e]||[]}},{key:"getPropertyDescriptor",value:function(e){return this._propertyDescriptors[e]}},{key:"getBlobData",value:function(e){}},{key:"_updateAttachmentStates",value:function(){try{var e=0;xo.PaneUpdateBatcher.beginUpdateItems();for(var t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._attachCache[this._attachKeys[t]];a.isInUse()&&a.onUpdate(!1,void 0,n.a.ChangeType.Auto)}xo.PaneUpdateBatcher.commitUpdateItems()}catch(r){i.default.reportError(r)}}},{key:"offlineLoad",value:function(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad())try{this._offlineLoad&&(this._hasRunOfflineLoad=this._offlineLoad())}catch(e){i.default.reportError(e)}}},{key:"load",value:function(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(e){i.default.reportError(e)}}this._loadedInitialData||!i.default.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()}},{key:"loadInitialData",value:function(){i.default.Assert(!this._loadedInitialData,"Do not make multiple requests for initial data load"),i.default.Assert(!this.isPluginBlocked(),"Should not load data for blocked plugins"),this._loadedInitialData=!0}},{key:"getDataPane",value:function(){}},{key:"getPaneIcon",value:function(){return"icon-question"}},{key:"getPanePriority",value:function(){return 0}},{key:"getDefaultDisplayItem",value:function(e){}},{key:"useItemStore",value:function(){}},{key:"itemStoreOptions",value:function(){}},{key:"getDefaultItemStore",value:function(){return i.default.Assert(this.useItemStore(),"Must request an item store"),this._defaultItemStore}},{key:"getActiveItemStore",value:function(e){i.default.Assert(e,"Must specify a valid paneID to get the item store for"),i.default.Assert(this.useItemStore(),"Must request item store usage");var t=this._activeItemStore[e];return t||this._defaultItemStore}},{key:"getBucketItemStore",value:function(e){return this._searchBuckets[e]}},{key:"allowRemoteRequests",value:function(){return!1}},{key:"handleDropEvent",value:function(e,t){return!1}},{key:"handleTapClick",value:function(e,t,a,i){return!1}},{key:"handleDoubleTap",value:function(e,t,a,i){return!1}},{key:"notifyPaneCreated",value:function(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||this.areDependenciesLoaded()&&this.loadInitialData()}},{key:"notifyPaneDestroyed",value:function(){this._numActivePanes--,i.default.Assert(this._numActivePanes>=0,"Should never have negative active panes")}},{key:"notifyPanesReadyForLoad",value:function(){xo.PaneManager.runForEachPane(function(e){e.notifyPluginLoaded()},this.getPaneType())}},{key:"hasActiveDataPanes",value:function(){return this._numActivePanes>0}},{key:"allowTextEditing",value:function(e,t){return!0}},{key:"_createSearchBucket",value:function(e,t){var a;a=i.default.generateTempId();var n=xo.itemStoreManager.registerItemStore(a,this,{trackGlobally:!1});return n.createRoot(t||i.default.generateTempId(),"Search Results"),this._searchBuckets[a]=n,a}},{key:"_destroySearchBucket",value:function(e){this._searchBuckets[e].clearStore()}},{key:"swapInSearchBucket",value:function(e,t){if(i.default.Assert(this.useItemStore(),"Must be marked as using an item store to support searches"),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Swap IN search bucket: ",e),xo.PaneManager.isPaneActive(t)){var a=xo.PaneManager.getPaneById(t),r=this._searchBuckets[e];if(!this._activeSearchBucket[t]||this._activeSearchBucket[t].id!==e){var o=r.getRoot();this._activeSearchBucket[t]||(this._defaultZoomItems[t]=a.getItem()),this._activeItemStore[t]=r,this._activeSearchBucket[t]=r,a.setRootItem(o,!0),a.useItemStore(r)}}}},{key:"swapOutSearchBucket",value:function(e,t){i.default.Assert(this.useItemStore(),"Must be marked as using an item store to support searches");var a=this._activeSearchBucket[e].id;i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Swap OUT search bucket: ",a);var r=xo.PaneManager.getPaneById(e),o=this._searchBuckets[a];i.default.Assert(o,"Must have a valid bucket we are swapping from");var s=r.getRootItem();i.default.Assert(s===o.getRoot(),"Current root for pane should match bucket root"),t=t||this._defaultZoomItems[e],i.default.Assert(t,"Must always be able to get a valid default zoom item"),this._activeItemStore[e]=void 0,this._activeSearchBucket[e]=void 0,this._defaultZoomItems[e]=void 0,r.setItem(t,!0),r.stopUsingItemStore(o),this._destroySearchBucket(a)}},{key:"runSearch",value:function(e,t,a,n,r){var o;return i.default.Assert(this.useItemStore(),"Must be marked as using an item store to support searches"),n&&(o=this._createSearchBucket(e,a)),this.runRemoteSearch(e,t,o,r)}},{key:"getSearchRoot",value:function(e){var t=this._searchBuckets[e];return i.default.Assert(t,"Should always reference a valid search bucket"),t.getRoot()}},{key:"isRemoteSearchBucketActive",value:function(e){return!!this._activeSearchBucket[e]}},{key:"clearSearch",value:function(e,t){this._activeSearchBucket[e]&&this.swapOutSearchBucket(e,t)}},{key:"refreshCurrentView",value:function(e){i.default.Assert(!1,"SubClass must override")}},{key:"dumpRequestQueue",value:function(e){var t=0,a=0;console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(var n=0;n<this._outstandingRequests.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._outstandingRequests[n];console.log("  ",r.requestFn,":",r.id," - ",r.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(var o=0;o<this._pendingRequests.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._pendingRequests[o];console.log("  ",s.requestFn,":",s.id," - ",s.data)}if(e){var l=0;i.default.Assert(!1,"Must be in __DEV__ mode to display info on handled requests"),console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(var u=0;u<this._handledRequests.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=this._handledRequests[u];d.failed?console.log(" !",d.requestFn,":",d.id," - ",d.data):console.log("  ",d.requestFn,":",d.id," - ",d.data)}}}},{key:"dumpQueueStats",value:function(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)}},{key:"getCssClass",value:function(e,t){return""}},{key:"getAccounts",value:function(){return xo.pluginManager.getPluginGmail().getSyncAccounts()}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"_offlineLoad",value:function(){}},{key:"_load",value:function(){}},{key:"runRemoteSearch",value:function(e,t,a,i){}},{key:"googleScopes",value:function(e){return[]}},{key:"getDependencies",value:function(){return[]}}])&&at(t.prototype,a),r&&at(t,r),e}();S.a.defineBase(lt);var ut=lt,dt=a(58);function ct(e){return(ct="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ht(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ft(e,t){return!t||"object"!==ct(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pt(e,t,a){return(pt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=gt(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function gt(e){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vt=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i={title:"Files",paneEmptyMessage:"Loading Google Drive...",paneEmptySearchMessage:"",titleContextMenuHeader:"Open folder",dropEffect:function(){return n.a.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:!0,supportPagination:!0,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,hasMoreButtons:!0,searchFilters:[],supportsDocuments:!1};return e.plugin=xo.pluginManager.getPlugin(n.a.PluginID.Drive),(a=ft(this,gt(t).call(this,e,i))).type=a.plugin._paneType,a.paneClass="paneOutline panePlugin paneDrive noComplete",a._isSearchingRemote=new X.a(!1),a._currentSearch=void 0,a.initDrive(),a}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,dt["a"]),a=t,(r=[{key:"initDrive",value:function(){this.search.onChanged.listen(S.a.forceBind("notifySearchChanged",this)),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0}},{key:"destroy",value:function(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,pt(gt(t.prototype),"destroy",this).call(this)}},{key:"_getNotReadyStatus",value:function(){var e="Unknown Error: Unable to load pane data.",t=this.plugin.getUnloadedDependencies();return t&&(t.indexOf(n.a.PluginDependency.PremiumSub)>=0?e="Only available to premium subscribers.":t.indexOf(n.a.PluginDependency.GoogleLogin)>=0&&(e="Missing permissions for Google Drive access.")),e}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"bottomListMessage",value:function(){var e;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(e="LOAD MORE"),{text:e,clickable:!0}}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDemandLoadData",value:function(e){this.plugin.requestDemandLoadData(this.id,e)}},{key:"requestDataPage",value:function(e){this.plugin.requestDataPage(e)}},{key:"onAfterLoaded",value:function(){pt(gt(t.prototype),"onAfterLoaded",this).call(this)}},{key:"onClose",value:function(){pt(gt(t.prototype),"onClose",this).call(this)}},{key:"_runRemoteSearch",value:function(){if(xo.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var e=this.search.getValue();this._lastSearchValue=e,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(e,this.id,void 0,!1,function(e){switch(this.isLoading.set(!1),e){case n.a.SearchResultStatus.Done:this.paneTopText.set("");break;case n.a.SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case n.a.SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case n.a.SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:i.default.Assert(!1,"Invalid search state: ",e)}}.bind(this))}}},{key:"notifySearchChanged",value:function(e){var t=this.search.getValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"refreshPaneData",value:function(){this.plugin.refreshCurrentView(this.id)}},{key:"notifyDropFrom",value:function(e,t){this.plugin.notifyDropFrom(e,t)}},{key:"notifyDropFromToEdit",value:function(e,t){return this.plugin.notifyDropFromToEdit(e,t)}},{key:"applyDropOnBlock",value:function(e,t){if(e.isDate){var a,r=e.dateTime||e.date;a=i.default.isString(r)?xo.International.parseDate(r,n.a.DateFormat.MDY):r,i.default.Assert(i.default.isDateValid(a),"Must provide a valid date when scheduling an email",e.dateTime,e.date),i.default.isDateValid(a)&&this.plugin.scheduleFile(t,a)}}},{key:"dropEffectCopyBehavior",value:function(e,a){return pt(gt(t.prototype),"dropEffectCopyBehavior",this).call(this,e,a)}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"isItemHeader",value:function(e,t){if(t){var a=this.plugin,i=e.getAttachmentByPlugin(a.id),n=i&&a.getCacheData(i.id);return!n||a.isFolder(n)}return e.isHeader()}}])&&ht(a.prototype,r),o&&ht(a,o),t}(),yt=a(22);function _t(e){return(_t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e,t,a){return(kt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=wt(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function wt(e){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function St(e,t){return(St=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function It(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Dt="application/octet-stream",Ct="application/vnd.google-apps.folder",Pt="application/vnd.google-apps.spreadsheet",At="application/vnd.google-apps.presentation",Mt="application/vnd.google-apps.document",Tt="application/vnd.google-apps.drive-sdk.597847337936",Et="image/png",Lt="image/jpg",xt="image/jpeg",Ot="image/gif",Rt=1,Ft=2,Nt=3,Bt=4,Ut=5,Vt=6,jt=7,Ht="S~SharedWithMe",zt="https://drive.google.com/open?id=",qt="-------314159265358979323846",Wt="\r\n--"+qt+"\r\n",Gt=function(e){function t(){var e,a,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,(e=!(r=wt(t).call(this,n.a.PluginID.Drive,"d","Files"))||"object"!==_t(r)&&"function"!==typeof r?It(a):r).displaySharedWithMe=!i.default.isDemoMode(),e._requiresOfflineAuth=!0,S.a.forceBind("sortFn",It(It(e))),e.registerSetting("WriteAccess","writeAccess","w",!0),e.registerSetting("LastChangeId","lastChangeId","i"),e.registerSetting("DriveRootId","driveRootId","d"),e._folderCache=e.registerLocalCache("FolderCache",n.a.StorageType.IndexedDB,!0),e.declareProperty("showInline",n.a.PluginLoad.Preview|n.a.PluginLoad.Full|n.a.PluginLoad.Inline,!0),e.declareProperty("imageWidth",n.a.PluginLoad.Preview|n.a.PluginLoad.Full|n.a.PluginLoad.Inline,!0),e.declareProperty("titleLower",n.a.PluginLoad.Runtime,!1,""),e.declareProperty("dataUrl",n.a.PluginLoad.Preview|n.a.PluginLoad.Runtime,!0),e.declareProperty("pinToTop",n.a.PluginLoad.Runtime,!0,!1),e.declareProperty("title"),e.declareProperty("mimeType"),e.declareProperty("fileSize",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0),e.declareProperty("alternateLink",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0),e.declareProperty("webContentLink",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0),e.declareProperty("isDeleted",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,!1),e.declareProperty("modifiedDate",n.a.PluginLoad.Autocomplete,!0),e.declareProperty("parents",n.a.PluginLoad.Autocomplete,!0),e.useRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.DriveFile),e.useRenderer(n.a.PluginRenderTypes.UnstyledText,n.a.PluginRenderers.DriveFile),e.useRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.DriveFile),e}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&St(e,t)}(t,ut),a=t,(r=[{key:"getType",value:function(){return n.a.PluginType.Storage}},{key:"getDataPane",value:function(){return i.default.Assert(!!this.getPaneIcon(),"Should have a pane icon specified"),vt}},{key:"getPaneIcon",value:function(){return"icon-drive-file"}},{key:"getPanePriority",value:function(){return 96}},{key:"useItemStore",value:function(){return"Google Drive"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,parserFn:F.a.runParseSinglePlugin.bind(F.a)}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"onAuthorizedSetting",value:function(e,t){switch(e){case this.Settings.WriteAccess:t&&this._ensureAttachmentsAreShared()}}},{key:"_ensureSpecialFolders",value:function(){var e=this.getDefaultItemStore();if(e){var t=e.getRoot();if(this.displaySharedWithMe&&!e.hasItem(Ht)){var a=i.default.generateTempId();this.cacheData(a,{title:"Shared With Me",titleLower:"shared with me",mimeType:Ct,pinToTop:!0});var n=this.getAttachment(a),r=e.createItem(Ht,this.getAttachmentEmbedString(n),t.id,{demandLoadChildren:!0});t.insertSorted(r,this.sortFn)}}}},{key:"_load",value:function(){this._ensureSpecialFolders(),i.default.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:i.default.minutes(15),minDelay:i.default.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate.bind(this)})}},{key:"_notifyFailedRequest",value:function(e){e&&e.error&&i.default.reportError(new Error("Failed Drive request: "+e.error.code),e)}},{key:"refreshCurrentView",value:function(){this.hasRecurringTask("ChangeListUpdates")&&this.getRecurringTask("ChangeListUpdates").forceUpdate()}},{key:"loadInitialData",value:function(){var e=this;kt(wt(t.prototype),"loadInitialData",this).call(this),this._ensureSpecialFolders();var a=new ze(function(){});setTimeout(function(){e._folderCache.onCacheMetadataReady(function(){e._folderCache.getMetadata("isSyncd",function(t){t||(i.default.log("Folder cache unsyncd - running folder sync"),e._folderCache.onCacheReady(function(){var t="trashed=false and mimeType contains '"+Ct+"'";e._requestRemoteFiles(Ft,a,t,999,function(t){e._folderCache.cacheEntry(t.id,e.serializeExternalData(t)),0},function(e){0}),e._folderCache.setMetadata("isSyncd",!0)}))})})},100);var n=!1,r=this.getDefaultItemStore(),o=r.getRoot(),s="trashed=false and 'root' in parents and mimeType != '"+Tt+"'";this._requestRemoteFiles(Nt,o,s,70,function(t){if(e.hasCacheData(t.id)||e._addRemoteEntry(t),!e._hasSameItem(t.id,o.id,r)){var a=r.createItem(e._createItemID(t.id,r),e._getTextForItem(t),o.id,{demandLoadChildren:t.mimeType===Ct});o.insertSorted(a,e.sortFn)}if(!e.getSetting(e.Settings.DriveRootId)&&t.parents)for(var i=0,n=0;n<t.parents.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t.parents[n].isRoot&&e.setSetting(e.Settings.DriveRootId,t.parents[n].id)}},function(){n||(n=!0)})}},{key:"performChangeListUpdate",value:function(){var e=this,t=-1,a=this.getSetting(this.Settings.LastChangeId);this._requestChangeList(a,function(n){i.default.Assert(!a||parseInt(n.id)>parseInt(a),"Must have correctly ordered change entry"),t=n.id;try{!n.fileId||n.file&&n.file.mimeType===Tt||e._handleChange(n)}catch(r){i.default.reportError(r)}},function(a){a&&-1!==t&&e.setSetting(e.Settings.LastChangeId,t)})}},{key:"_deleteFile",value:function(e){e.forEachItem(this.getDefaultItemStore(),function(e){e.parent().removeChild(e,n.a.ChangeType.Remote),e.setParent(void 0)}),e.updateField("isDeleted",!0)}},{key:"_handleChange",value:function(e){var t=this;if(i.default.Assert(e&&(e.deleted||e.file),"Must have a valid formed change entry to handle"),(e.deleted||e.file.mimeType===Ct)&&(e.deleted?this._folderCache.hasEntry(e.fileId,function(a){a&&t._folderCache.removeEntry(e.fileId)}):this._folderCache.cacheEntry(e.fileId,this.serializeExternalData(e.file))),!this.hasCacheData(e.fileId)&&!e.deleted&&e.file){for(var a=0,r=e.file.parents,o=!1,s=0;s<r.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.hasCacheData(r[s].id)||r[s].isRoot){o=!0;break}}o&&this._addRemoteEntry(e.file)}var l=this.getCacheData(e.fileId);if(l){e.deleted||this.dataHasChanged(l,e.file)&&this._addRemoteEntry(e.file);var u=this.getDefaultItemStore();if(e.deleted){var d=this.getAttachment(e.fileId);this._deleteFile(d)}else{var c=0,h=[];(d=this.getAttachment(e.fileId)).forEachItem(u,function(a){for(var i=0,r=!1,o=0;o<e.file.parents.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=e.file.parents[o];if(s.isRoot&&a.parent()&&a.parent().isRootItem()||a.parent()&&a.parent().hasAttachment(s.id)){r=!0,h.push(s.id);break}}a.parent()&&t._isSpecialFolder(a.parent().id)&&(r=!0,h.push(a.parent().id)),!r&&a.parent()&&(a.parent().removeChild(a,n.a.ChangeType.Remote),a.setParent(void 0))});for(var f=0;f<e.file.parents.length;++f){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var p=e.file.parents[f];if(h.indexOf(p.id)<0)if(p.isRoot){var g=u.getRoot(),m=u.createItem(this._createItemID(e.fileId,u),this._getTextForItem(e.file),g.id,{demandLoadChildren:e.file.mimeType===Ct});g.insertSorted(m,this.sortFn)}else{this.getAttachment(p.id).forEachItem(u,function(a){var i=u.createItem(t._createItemID(e.fileId,u),t._getTextForItem(e.file),a.id,{demandLoadChildren:e.file.mimeType===Ct});a.insertSorted(i,t.sortFn)})}}if(this.displaySharedWithMe&&e.file.sharedWithMeDate&&h.indexOf(Ht)<0){var v=u.getItem(Ht),y=u.createItem(this._createItemID(e.fileId,u),this._getTextForItem(e.file),v.id,{demandLoadChildren:e.file.mimeType===Ct});v.insertSorted(y,this.sortFn)}}}}},{key:"_isValidFileID",value:function(e){return e.indexOf("~")<0}},{key:"_createItemID",value:function(e,t){var a=0;i.default.Assert(e,"Must provide a fileID"),i.default.Assert(this._isValidFileID(e),"Invalid fileID - "+e),i.default.Assert(t,"Must provide a valid itemStore");for(var n=e,r=0;t.hasItem(n)&&r<50;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n=e+"~"+ ++r}return i.default.Assert(r<50,"SANITY: Should not have items with 50+ parents"),n}},{key:"_hasSameItem",value:function(e,t,a){for(var i=0,n=!1,r=e,o=0;a.hasItem(r)&&o<50;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a.getItem(r);if(s&&s.parent()&&s.parent().id===t){n=!0;break}r=e+"~"+ ++o}return n}},{key:"_isSpecialFolder",value:function(e){return e.startsWith("S~")}},{key:"requestDemandLoadData",value:function(e,t){var a=this;i.default.Assert(1===t.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs");var n,r=xo.PaneManager.getPaneById(e),o=t.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(t.id))switch(t.id){case Ht:n="trashed=false and sharedWithMe and mimeType != '"+Tt+"'";break;default:i.default.Assert(!1,"Invalid special folder ID")}n||(n="trashed=false and '"+o.id+"' in parents and mimeType != '"+Tt+"'");var s=this.getActiveItemStore(e);this._requestRemoteFiles(Nt,t,n,70,function(e){if(a.hasCacheData(e.id)||a._addRemoteEntry(e),!a._hasSameItem(e.id,t.id,s)){var i=s.createItem(a._createItemID(e.id,s),a._getTextForItem(e),t.id,{demandLoadChildren:e.mimeType===Ct});t.insertSorted(i,a.sortFn)}},function(e){e||t.hasPaginationToken()||t.notifyLoadDataFailed(r)}),this.sendEvent("RequestDemandLoadData")}},{key:"requestDataPage",value:function(e){this._requestRemoteFiles(Ut,e)}},{key:"_ensureAncestorChain",value:function(e,t,a,n){var r=this;if(i.default.Assert(a,"Must provide a valid success callback"),i.default.Assert(n,"Must provide a valid error callback"),t.parents&&t.parents.length)for(var o=0,s=t.parents.length,l=0,u=function(){++l===s&&a()},d=function(t){i.default.Assert(t,"Must provide valid fileInfo up ancestor chain"),r.hasCacheData(t.id)||r._addRemoteEntry(t),r._ensureAncestorChain(e,t,u,n)},c=function(e){if(e){var t=r.serializeExternalData(e);r._folderCache.cacheEntry(t.id,t),d(t)}else n({error:"Undefined success result."})},h=function(e,t){if(e)d(e);else{var a=Ve.a.fns("drive").files.get.packedFn,i={fileId:t};r._queueRemoteRequestMulti(yt.a.getDefaultAccountID(),a,i,c,n,void 0,jt)}},f=0;f<t.parents.length;++f){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var p=t.parents[f].id;i.default.Assert(p,"Must supply a valid parent ID to query"),this._folderCache.getEntry(p,h)}else a()}},{key:"_hasAttachmentChild",value:function(e,t){for(var a=0,i=!1,n=0;n<e.numItems();++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e.itemAtIndex(n).hasAttachment(t)){i=!0;break}}return i}},{key:"_attachAncestorChain",value:function(e,t){var a=this;if(i.default.Assert(t,"Must provide a valid cache entry to create items for"),t.parents&&t.parents.length>0)for(var n=0,r=0;r<t.parents.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t.parents[r];if(i.default.Assert(o&&o.id,"Must supply a valid parent ID to query"),o.isRoot){var s=e.getRoot();if(!this._hasAttachmentChild(s,t.id)){var l=e.createItem(this._createItemID(t.id,e),this._getTextForItem(t),s.id,{demandLoadChildren:t.mimeType===Ct});s.insertSorted(l,this.sortFn)}}else this._folderCache.getEntry(o.id,function(i){a._attachAncestorChain(e,i),a.getAttachment(i.id).forEachItem(e,function(i){if(!a._hasAttachmentChild(i,t.id)){var n=e.createItem(a._createItemID(t.id,e),a._getTextForItem(t),i.id,{demandLoadChildren:t.mimeType===Ct});i.insertSorted(n,a.sortFn)}})})}}},{key:"getNextSearchPage",value:function(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()}},{key:"runRemoteSearch",value:function(e,t,a,r){var o=this;i.default.Assert(e,"Must provide a valid search"),i.default.Assert(t,"Must provide a valid pane"),i.default.Assert(i.default.isFunction(r),"Must provide a valid search callback");var s=!1,l=0,u=0,d=0,c=new Ge(e,10,this.requestDataPage.bind(this)),h=function(){if(l===u&&s){i.default.log("Done Searching! "+l);var e=n.a.SearchResultStatus.Done;if(c.isValid())xo.PaneManager.getPaneById(t).search.update(!0),c.isValid()&&c.hasMoreResults()?(i.default.log("Too many search results"),e=n.a.SearchResultStatus.TooMany):c.hasError()||d>0?e=n.a.SearchResultStatus.Error:0===l&&(e=n.a.SearchResultStatus.None),o._lastCompletedSearch=c;r(e)}},f=function(e){l++,o.hasCacheData(e.id)||o._addRemoteEntry(e);var a=o.getActiveItemStore(t);o._ensureAncestorChain(a,e,function(){c.isValid()&&o._attachAncestorChain(a,e),u++,h()},function(e){i.default.reportError(new Error("Error during remote search: "+e)),u++,d++,h()})},p=function(e){s=!0,h()},g=!1,m="trashed=false and (fullText contains '"+e+"')";return this._requestRemoteFiles(Bt,c,m,100,c.onEntry,function(e){c.onDone(e),g||(g=!0,c.isValid()&&(c.hasResults()?c.getNextPage(f,p):p()))}),this.sendEvent("RemoteSearch"),c}},{key:"_requestRemoteFiles",value:function(e,t,a,n,r,o){var s,l=this;t&&t.hasPaginationToken()&&!t.paginationTokenInUse()?(a=(s=t.beginDataPageLoad()).getQuery(),n=s.getMaxResults(),r=s.getEntryCB(),o=s.getDoneCB()):t&&t.needsPaginationToken()&&(s=this.createPaginationToken(void 0,a,{},n,r,o),t.setPaginationToken(s),t.beginDataPageLoad()),n=n||70,i.default.Assert(r&&i.default.isFunction(r),"Must define a valid entry callback"),i.default.Assert(o&&i.default.isFunction(o),"Must define a valid done callback");var u,d,c=Ve.a.fns("drive").files.list.packedFn,h={fields:"items,nextPageToken",maxResults:n,q:a,pageToken:s&&s.hasMorePages()?s.getNextPageToken():void 0};s||!t?(u=function(e){if(e.items){var a=0;xo.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<e.items.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r(e.items[i])}xo.PaneUpdateBatcher.commitUpdateItems()}e.nextPageToken&&s&&l.updatePaginationToken(s,e.nextPageToken),t&&s&&t.endDataPageLoad(!!e.nextPageToken),o(!0)},d=function(){s&&t.endDataPageLoad(!!s),o(!1)}):(u=function(){o(!0)},d=function(){o(!1)}),this._queueRemoteRequestMulti(yt.a.getDefaultAccountID(),c,h,u,d,void 0,e)}},{key:"getRemoteAttachmentData",value:function(e){var t=this,a=Ve.a.fns("drive").files.get.packedFn,r={fileId:e.id};this._queueRemoteRequestMulti(yt.a.getDefaultAccountID(),a,r,function(a){i.default.Assert(!a||a.id===e.id,"If valid result, attachment should match remote file ID"),a&&(t._addRemoteEntry(a),(a.deleted||a.mimeType===Ct)&&(a.deleted?t._folderCache.hasEntry(a.id,function(e){e&&t._folderCache.removeEntry(a.id)}):t._folderCache.cacheEntry(a.id,t.serializeExternalData(a))))},function(a){if(i.default.isHTTPStatusCode(a,n.a.HTTPStatusCode.NotFound)){var r={id:e.id,mimeType:Dt,title:"Unknown",titleLower:"unknown",fileSize:0};t._addRemoteEntry(r),t._deleteFile(e)}else e.notifyDataRequestFailed(),t._notifyFailedRequest(a)},e,Rt)}},{key:"_requestChangeList",value:function(e,t,a){var n,r,o,s,l=this;e&&e>=0?(i.default.Assert(t,"Must supply a valid entry CB"),i.default.Assert(a,"Must provide a valid done CB"),n=Ve.a.fns("drive").changes.list.packedFn,r={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+e+1,fields:"items,nextPageToken"},o=function(n){var r=0,o=e;xo.PaneUpdateBatcher.beginUpdateItems();for(var s=0;s<n.items.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=n.items[s];i.default.Assert(u,"Must have a valid change entry"),i.default.Assert(parseInt(u.id)<1e8,"Must have a valid entry ID"),i.default.Assert(parseInt(u.id)>parseInt(o),"Must be ordered monotonic increasing"),o=u.id,t(u)}xo.PaneUpdateBatcher.commitUpdateItems(),n.nextPageToken?l._requestChangeList(o,t,a):a(!0)},s=function(e){a(!1)}):(n=Ve.a.fns("drive").changes.list.packedFn,r={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:1e8},o=function(e){var i=e.largestChangeId;t({id:i}),a(!0)},s=function(e){a(!1)}),this._queueRemoteRequestMulti(yt.a.getDefaultAccountID(),n,r,o,s,void 0,Vt)}},{key:"_createRemoteEntry",value:function(e){var t={id:e.id,mimeType:e.mimeType,title:e.title,titleLower:e.title.toLowerCase(),alternateLink:e.alternateLink,webContentLink:e.webContentLink,dataUrl:e.dataUrl,fileSize:+e.fileSize,parents:e.parents,modifiedDate:e.modifiedDate?new Date(e.modifiedDate):void 0};if(t.parents)for(var a=0,i=0;i<t.parents.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._updateParentsEntry(t.parents[i])}return this.isFolder(t)&&(t.items=[]),t}},{key:"_addRemoteEntry",value:function(e){var t=this._createRemoteEntry(e);this.cacheData(t.id,t)}},{key:"createEntryFromLocal",value:function(e,t){if(this.isFolder(t)&&(t.items=[]),t.titleLower=t.title.toLowerCase(),t.modifiedDate=t.modifiedDate?new Date(t.modifiedDate):void 0,t.isDeleted=t.isDeleted||i.default.isTempId(e),t.parents)for(var a=0,n=0;n<t.parents.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._updateParentsEntry(t.parents[n])}return t}},{key:"_updateParentsEntry",value:function(e){this._folderCache.getEntry(e.id,function(t){t&&(e.title=t.title)})}},{key:"isFolder",value:function(e){return e.mimeType===Ct}},{key:"_getCompStringForItem",value:function(e){return e.hasPluginAttachment(this.id)?e.getAttachmentByPlugin(this.id).getTitleString():e.getParsedText()}},{key:"_isItemPinnedToTop",value:function(e){return!!e.hasPluginAttachment(this.id)&&e.getAttachmentByPlugin(this.id).getField("pinToTop")}},{key:"sortFn",value:function(e,t){return this._isItemPinnedToTop(e)?-1:this._isItemPinnedToTop(t)?1:this._getCompStringForItem(e).localeCompare(this._getCompStringForItem(t))}},{key:"getAttachmentClass",value:function(e){var t=["plugin_drive"];return e.hasField("mimeType")?t.push(this.getMimetypeClass(e)):t.push("plugin_drive_unk"),e.hasField("isDeleted")&&e.getField("isDeleted")&&t.push("fileDeleted"),t}},{key:"getMimetypeClass",value:function(e){var t=e.getField("mimeType");if(this.isMimetypeImage(t))return e.getField("showInline")?"plugin_drive_image_inline":"plugin_drive_image";switch(t){case Ct:return"plugin_drive_folder";case Pt:return"plugin_drive_sheet";case At:return"plugin_drive_slide";case Mt:return"plugin_drive_doc";default:return"plugin_drive_unk"}}},{key:"isMimetypeImage",value:function(e){switch(e){case Et:case Ot:case Lt:case xt:return!0}}},{key:"isImage",value:function(e){var t=this.getMimetypeClass(e);return e.hasField("mimeType")&&("plugin_drive_image"===t||"plugin_drive_image_inline"===t)}},{key:"googleScopes",value:function(e){return e||this.getSetting(this.Settings.WriteAccess)?[n.a.GScope.DriveFull]:[n.a.GScope.Drive,n.a.GScope.DriveMetadataRO]}},{key:"getDependencies",value:function(){return[n.a.PluginDependency.PremiumSub,n.a.PluginDependency.GoogleLogin]}},{key:"verifyAuthorization",value:function(e){return Ke.a.isAuthorizedForScopes(e,this.googleScopes())}},{key:"handleDropEvent",value:function(e,t){var a=e.dataTransfer?e.dataTransfer.getData("text/uri-list"):void 0,r=i.default.getPaneForElement(e.target);if(a&&a.startsWith(zt)){var o=a.replace(zt,""),s=o.indexOf("&"),l=o.substr(0,s);return i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Dropped File: ",l),t(this.getAttachment(l).getEmbedString()),!0}if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){for(var u=0,d=0;d<e.dataTransfer.files.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var c=e.dataTransfer.files[d];this.handleDropFile(c,r,e,t)}return A.e.miscAction({type:A.c.Misc,misc:A.a.DriveUpload}),!0}if(e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0){var h=0;for(d=0;d<e.clipboardData.items.length;++d){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var f=e.clipboardData.items[d];(c=f?f.getAsFile():void 0)&&(c.customName="Moo.do Upload "+Date.now(),this.handleDropFile(c,r,e,t))}return A.e.miscAction({type:A.c.Misc,misc:A.a.DriveUpload}),!0}return!1}},{key:"highlightItem",value:function(e){e.highlight()}},{key:"handleDropFile",value:function(e,t,a,r){for(var o=0,s=this,l=e.customName||e.name,u=this.findCachedItemsByField("title",l),d=this.getDefaultItemStore(),c=t.type===n.a.PaneMode.Task&&this.isMimetypeImage(e.type)&&xo.settings.showImagesInline.get()?{showInline:!0}:void 0,h=!1,f=0;f<u.length;++f){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var p=u[f];if(p.fileSize===e.size&&!p.isDeleted){var g=this.getAttachment(p.id,c);if(t&&t.isWriteable&&t.plugin!==this)r(this.getAttachmentEmbedString(g),!1);else if(t&&t.plugin===this){var m=this.getDefaultItemStore();g.forEachItem(m,this.highlightItem)}h=!0;break}}if(!h){var v=i.default.generateTempId();this.cacheData(v,{title:l,titleLower:l.toLowerCase(),mimeType:e.type});var y,_,b=this.getAttachment(v,c),k=t&&t.isWriteable&&t.plugin!==this,w=!1;if(t&&t.isWriteable&&t.plugin!==this)w=!0;else if(a&&this.getSetting(this.Settings.WriteAccess)){var S=a.target;(y=i.default.hasClass(S,"paneContent")?t.getItem():i.default.getItemForElement(S))&&!y.isHeader()&&(y=y.parent())}if(y){if(!y.isRootItem()){var I=y.getAttachmentByPlugin(this.id);i.default.Assert(I,"Drive items must have valid attachments"),_=I.id}}else y=d.getRoot(),_=this.getSetting(this.Settings.DriveRootId);this._upload(e,b,k,t.getPaneDoc(),_,function(){i.default.Assert(!d.hasItem(b.id),"When uploading a new file, should never have duplicated items");var e=d.createItem(b.id,s.getAttachmentEmbedString(b),y.id);y.insertSorted(e,s.sortFn),w&&r(s.getAttachmentEmbedString(b),!0)})}}},{key:"notifyDropFrom",value:function(e,t){var a=this;if(i.default.Assert(e,"Must have a valid item that was dropped"),i.default.Assert(t,"Must have a valid pane the item was dropped on"),!i.default.isDemoMode()){var r=e.getAttachmentByPlugin(this.id),o=t.getPaneDoc();o.shareFile(r.id,function(e,t){e||(a.getSetting(a.Settings.WriteAccess)&&t.code===n.a.HTTPStatusCode.Unauthorized&&a.setSetting(a.Settings.WriteAccess,!1),o.isShared()&&xo.toasts.pushMessage(n.a.MessageID.ShareFailure))}),this.sendEvent("AttachmentDropped")}}},{key:"notifyDropFromToEdit",value:function(e,t){if(!i.default.isDemoMode())if(this.getSetting(this.Settings.WriteAccess)){if(e.getAttachmentByPlugin(this.id)){var a=document.createEvent("Event");a.item=e,a.initEvent("cdrop",!0,!0),t.dispatchEvent(a)}this.sendEvent("AttachmentDroppedEdit")}else xo.toasts.pushMessage(n.a.MessageID.NeedDrivePermission)}},{key:"getAttachUrl",value:function(e){var t=this.getCacheData(e.id);if(t)return t.webContentLink&&t.webContentLink.replace("export=download","")||t.dataUrl}},{key:"getAttachDataUrl",value:function(e){var t=this.getCacheData(e.id);return t&&t.dataUrl}},{key:"handleTapStart",value:function(e,t,a,i){return!0}},{key:"handleTapClick",value:function(e,t,a,i){var n=this.getAttachment(a);return this.openAttach(n,e,t,!0,i)}},{key:"openAttach",value:function(e,t,a,r,o){var s=this,l=this.getCacheData(e.id);if(l){if(this.isPluginPane(a)&&this.isFolder(l))a.zoomIn(t),this.sendEvent("Tap_FolderZoom");else if(f.a.isMobile){var u=this.createDisplayElement(e).text;i.default.preventDefault(o),i.default.preventClick(),xo.menus.openMenuExternalApp(u,function(){l.alternateLink?i.default.openUrl(l.alternateLink,o):l.id?i.default.openUrl(s._createDriveURL(l.id,l.mimeType),o):xo.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:n.a.MessageAction.Okay})}),this.sendEvent("Tap_OpenFileMobile")}else{var d;l.alternateLink?d=l.alternateLink:l.id?d=this._createDriveURL(l.id,l.mimeType):xo.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:n.a.MessageAction.Okay}),d&&(r&&!(f.a.mac&&o.metaKey||!f.a.mac&&o.ctrlKey)&&this.isImage(e)&&!f.a.isMobile?(d="https://drive.google.com/uc?export=view&id="+l.id,xo.menus.openLightbox(d)):d&&(i.default.isDemoMode()?xo.toasts.pushMessage(n.a.MessageID.DemoPluginClick):(i.default.openUrl(d,o),this.sendEvent("Tap_OpenFileDesktop"))))}return!0}return!1}},{key:"createFolderURL",value:function(e){return"https://drive.google.com/drive/folders/"+e}},{key:"_createDriveURL",value:function(e,t){var a="https://docs.google.com/";switch(t){case Ct:return a+"folderview?id="+e+"&usp=drivesdk";case Pt:return a+"spreadsheets/d/"+e+"/edit?usp=drivesdk";case Mt:return a+"document/d/"+e+"/edit?usp=drivesdk";case At:return a+"presentation/d/"+e+"/edit?usp=drivesdk";default:return a+"file/d/"+e+"/edit?usp=drivesdk"}}},{key:"compactCacheField",value:function(e,t){var a;switch(t){case"alternateLink":e[t]!==this._createDriveURL(e.id,e.mimeType)&&(a=e[t]);break;default:a=e[t]}return a}},{key:"supportOfflineCache",value:function(){return!0}},{key:"usesPreviewCache",value:function(){return!0}},{key:"matchAttachment",value:function(e,t){return e.getField("titleLower").indexOf(t)>=0}},{key:"getBlockedText",value:function(e){return"Go Premium to view Drive files"}},{key:"onDocumentShared",value:function(e){this.getSetting(this.Settings.WriteAccess)?e&&this._ensureAttachmentsAreShared():this.numActiveAttachments()>0&&xo.toasts.pushMessage(n.a.MessageID.NoSharingWarning)}},{key:"_ensureAttachmentsAreShared",value:function(){var e=i.default.vmMain.docManager.getOpenDoc();this.forEachActiveAttachment(function(t){e.shareFile(t.id,function(e){0})})}},{key:"notifyAttachmentUnused",value:function(e,a){(kt(wt(t.prototype),"notifyAttachmentUnused",this).call(this,e,a),i.default.isDemoMode())||i.default.vmMain.docManager.getOpenDoc().unshareFile(e.id,function(e){0})}},{key:"_upload",value:function(e,t,a,r,o,s){var l=this;e.size>20971520?(xo.toasts.pushMessage(n.a.MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var u=this.isMimetypeImage(e.type)&&xo.settings.showImagesInline.get();if(u){var d=new FileReader;d.onload=function(e){var a=l.getCacheData(t.id);a.dataUrl=e.target.result,l.cacheData(t.id,a),s(e)},d.readAsDataURL(e)}var c=new FileReader;c.readAsBinaryString(e),c.onload=function(n){var s=e.type||Dt;i.default.Assert(r,"Must supply a valid paneDoc if uploading a file"),r.getDocumentFolder(function(i){!function(i){var n={title:e.customName||e.name,mimeType:s,parents:o?[{id:o}]:[]};a&&i&&n.parents.push({id:i});var r=btoa(c.result),u=Wt+"Content-Type: application/json\r\n\r\n"+JSON.stringify(n)+Wt+"Content-Type: "+s+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+r+"\r\n---------314159265358979323846--";window.gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+qt+'"'},body:u}).execute(function(e){l.changeID(t,t.id,e.id);var a=l.getAttachDataUrl(t);a&&(e.dataUrl=a),l._addRemoteEntry(e)})}(i)})},u||s()}},{key:"scheduleFile",value:function(e,t){A.e.beginAction();var a=e.getAttachmentByPlugin(this.id);i.default.Assert(a,"Must be able to get a valid attachment from item");var r=n.a.MSPerHour,o=i.default.vmMain.getDefaultCalendarPlugin();if(o){var s=o.getDefaultExportCalendarID();if(s&&(i.default.isDemoMode()||o.getSetting(o.Settings.WriteAccess))){var l=a.getField("title"),u=this._createDriveURL(a.id,a.getField("mimeType"));o.createEventForEmail(s,l,u,t,r,function(e,t,a,i){e||t?t||xo.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:n.a.MessageAction.Okay}):xo.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){xo.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:n.a.MessageAction.Okay})}})})}else xo.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:n.a.MessageAction.OpenCalendarSettings})}else xo.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:n.a.MessageAction.OpenSettings});A.e.endAction()}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var a=e.toLowerCase(),i=this.findCachedItemsByFn(function(e){return e.titleLower.indexOf(a)>=0},t);return i.sort(function(e,t){return e.modifiedDate&&t.modifiedDate?Date.compare(e.modifiedDate,t.modifiedDate):e.modifiedDate?-1:t.modifiedDate?1:e.titleLower.localeCompare(t.titleLower)}),i}},{key:"getAttachmentEmbedString",value:function(e){return kt(wt(t.prototype),"getAttachmentEmbedString",this).call(this,e,e.getField("showInline")?"showInline:true":void 0)}},{key:"getAttachWidth",value:function(e){return e.hasField("imageWidth")&&e.getField("imageWidth")?+e.getField("imageWidth"):void 0}},{key:"setAttachWidth",value:function(e,t){e.updateField("imageWidth",t,!0)}},{key:"setShowInline",value:function(e,t){e.updateField("showInline",t,!0)}}])&&bt(a.prototype,r),o&&bt(a,o),t}(),Kt="Gmail";function Yt(){if(this._isBuiltin=!0,this._super.constructor.call(this,n.a.PluginID.Mailbird,"b","Mailbird"),this.declareProperty("subject",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!1,""),this.declareProperty("from",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!1,""),this.declareProperty("date",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,new Date),this.declareProperty("subjectLower",n.a.PluginLoad.Runtime,!1,""),this.declareProperty("fromLower",n.a.PluginLoad.Runtime,!1,""),this.declareProperty("unread",n.a.PluginLoad.Runtime,!0,!1),this.declareProperty("snippet",n.a.PluginLoad.Runtime,!0,""),this.declareProperty("count",n.a.PluginLoad.Runtime,!0,1),this.declareProperty("latestMessageAt",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0),this.declareProperty("provider",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0),this.declareProperty("threadID",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0),this.declareProperty("hasAttachments",n.a.PluginLoad.Full,!0,!1),this.useRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.EmailThread),this.useRenderer(n.a.PluginRenderTypes.UnstyledText,n.a.PluginRenderers.EmailThread),this.useRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.EmailThread),this.isMailbirdEmbed=f.a.embed===n.a.EmbedApps.Mailbird,this.isMailbirdEmbed){this.setSetting(this.Settings.IsEnabled,!0),i.default.nativeBridge.registerEmbedBridge(this);var e=i.default.nativeBridge.registerInboundAPI("mailbird");i.default.Assert(e,"Error creating native inbound API for mailbird"),e&&(e.registerVariable("_prevX"),e.registerVariable("_prevY"),e.registerFunction("dragOver",Xt.dragOver,!0),e.registerFunction("drop",Xt.drop,!0),e.registerFunction("dragLeave",Xt.dragLeave,!0),e.registerFunction("reportError",Xt.reportError,!0)),this._mailbirdOutAPI=i.default.nativeBridge.registerOutboundAPI("mailbird"),i.default.Assert(this._mailbirdOutAPI,"Error creating native outbound API for mailbird"),this._mailbirdOutAPI&&(this._mailbirdOutAPI.requireFunction("selectConversation"),this._mailbirdOutAPI.requireFunction("selectConversationEx",!0),this._mailbirdOutAPI.requireFunction("scheduleNotifications",!0))}}var Xt={dragOver:function(e){var t=i.default.elementFromPoint(e.x,e.y);if(t){var a=void 0!==this._prevX?e.x-this._prevX:0,n=void 0!==this._prevY?e.y-this._prevY:0;this._prevX=e.x,this._prevY=e.y;var r={clientX:e.x,clientY:e.y,diffX:a,diffY:n,target:t,dataTransfer:{}};xo.DragDrop.handleDragOver(r)}},drop:function(e){var t=i.default.elementFromPoint(e.x,e.y);var a={clientX:e.x,clientY:e.y,target:t,dataTransfer:{getData:function(t){if("mailbird/email"===t){var a={subject:e.subject||"",from:e.from||"",id:e.mailMessageId?e.mailMessageId:"mailbird_"+e.id,latestMessageAt:e.latestMessageAt};return e.gmailID&&(a.provider="Gmail",a.threadID=e.gmailID),a}}},preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn};setTimeout(function(){xo.DragDrop.handleDrop(a)},0)},dragLeave:function(){xo.DragDrop.handleDragLeave({target:document.getElementById("container")})},reportError:function(e){i.default.reportError(new Error(e))}},Qt={getPaneIcon:function(){return"icon-envelope"},useItemStore:function(){return"Mailbird"},_addRemoteEntry:function(e){var t={id:e.id,provider:e.provider,threadID:e.threadID,subject:e.subject,subjectLower:e.subject.toLowerCase(),from:e.from,fromLower:e.from.toLowerCase(),latestMessageAt:e.latestMessageAt};return this.cacheData(t.id,t),t},createEntryFromLocal:function(e,t){return t.subjectLower=t.subject.toLowerCase(),t.fromLower=t.from.toLowerCase(),t},getAttachmentClass:function(e){return["plugin_mailbird"]},isPluginBlocked:function(){return!1},handleEmbedMessage:function(e,t){switch(e){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var a=JSON.stringify(t);this._mailbirdOutAPI.call("scheduleNotifications",a)}catch(n){i.default.reportError(n)}break;default:i.default.Assert(!1,"Unknown embed message: "+e)}},handleDropEvent:function(e,t){if(i.default.Assert(t,"Must provide a valid callback to the drop event"),e.dataTransfer){var a=e.dataTransfer.getData("mailbird/email");if(a){var n=this._addRemoteEntry(a);t(this._getTextForItem(n));var r=this.getAttachment(n.id);return i.default.Assert(r.isLoaded(),"Mailbird attachments must always be loaded after creation"),this.writeAttachmentToPreviewCache(r),!0}}return!1},handleTapStart:function(e,t,a,i){return!0},handleTapClick:function(e,t,a,r){var o=this.getCacheData(a);if(o){if(this.isMailbirdEmbed){var s;if(!o.id.startsWith("mailbird_")&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var l=null;"Gmail"===o.provider&&(i.default.Assert(o.threadID,"Must provide a valid Gmail ID if it is defined as the provider"),l=parseInt(o.threadID));a=o.id;s=this._mailbirdOutAPI.call("selectConversationEx",l,a,o.latestMessageAt)}else{a=o.id.replace("mailbird_","");s=this._mailbirdOutAPI.call("selectConversation",a)}i.default.Assert(void 0!==s,"Must always receive a value back from Mailbird"),!0===s||!1===s?i.default.Assert(s,"Must have successfully selected the email conversation in Mailbird: ",o.id,o.provider):(i.default.Assert(s&&s.then,"Must have a valid promise object returned"),s.then(function(e){i.default.Assert(e,"Must have successfully selected the email conversation in Mailbird: ",o.id,o.provider)},function(e){i.default.Assert(!1,"Failed to successfully select the email conversation in Mailbird: ",o.id,o.provider)}))}else switch(o.provider){case Kt:i.default.openUrl("https://mail.google.com/mail/u/0/#inbox/"+o.threadID);break;default:xo.toasts.pushMessage(n.a.MessageID.MailbirdClick)}return!0}return!1},getDisplayTags:function(e){return[]},getDisplayParticipants:function(e){return""},matchAttachment:function(e,t){return e.getField("fromLower").indexOf(t)>=0||e.getField("subjectLower").indexOf(t)>=0},findMatchExact:function(e){},findMatchLike:function(e,t){var a=e.toLowerCase();return this.findCachedItemsByFn(function(e){return e.subjectLower.indexOf(a)>=0||e.fromLower.indexOf(a)>=0},t)},supportOfflineCache:function(){return!0},usesPreviewCache:function(){return!0}};S.a.inherit(ut,Yt),S.a.extend(Yt.prototype,Qt);var Jt=Yt;function Zt(e){this._maxSize=e,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}Zt.prototype={registerOwner:function(e,t){i.default.Assert(e,"Must supply a valid owner object"),i.default.Assert(!this._registeredOwners[t],"Must not double define an owner"),this._registeredOwners[t]=e,this._registeredActions[t]={}},registerAction:function(e,t,a){i.default.Assert(e,"Must provide a valid owner"),i.default.Assert(t,"Must provide a valid action ID"),i.default.Assert(this._registeredOwners[e],"Must have already registered a valid owner"),i.default.Assert(!this._registeredActions[e][t],"Must not double define an action for an owner"),i.default.Assert(a,"Must pass in a valid undo/redo descriptor"),i.default.Assert(i.default.isFunction(a.undo),"Must provide a valid undo fn"),i.default.Assert(i.default.isFunction(a.redo),"Must provide a valid redo fn"),this._registeredActions[e][t]=a},_getOwner:function(e){return i.default.Assert(this._registeredOwners[e.ownerID],"Must have previously registered owner"),this._registeredOwners[e.ownerID]},_getActionData:function(e){return i.default.Assert(this._registeredOwners[e.ownerID],"Must have previously registered owner"),i.default.Assert(this._registeredActions[e.ownerID][e.actionID],"Must have previously registered action for owner"),this._registeredActions[e.ownerID][e.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(e){return{id:this._useNextGroupID(),events:e||[]}},_pushNewGroup:function(e){var t=this._createGroup(e);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(t),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(e){0===this._aggregateActions&&(i.default.Assert(0===this._currentAction.length,"Current actions should be flushed"),this._actionsPreventUndo=!!e),this._aggregateActions++},runAction:function(e,t,a){var i={ownerID:e,actionID:t},n=this._getOwner(i);return this._getActionData(i).redo.apply(n,a)},performAction:function(e,t,a){i.default.Assert(this._aggregateActions>0,"Must be in a begin/end action block"),i.default.Assert(a,"Must provide valid data for the action"),this._currentAction.push({ownerID:e,actionID:t,data:a})},performActions:function(e){if(e&&e.length>0){var t=0;this.beginAction();for(var a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];this.performAction(i.ownerID,i.actionID,i.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var e=0,t=this._groups[this._cursor--],a=t.events.length-1;a>=0;a--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t.events[a],n=this._getOwner(i);this._getActionData(i).undo.apply(n,i.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var e=0,t=this._groups[++this._cursor],a=0;a<t.events.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t.events[a],n=this._getOwner(i);this._getActionData(i).redo.apply(n,i.data.redoParams)}}};var $t=Zt;function ea(e,t,a,r,o,s){i.default.Assert(e,"Must specify a valid account ID"),i.default.Assert(t,"Must specify a valid label ID"),i.default.Assert(!r||i.default.isDateValid(r),"Must provide a valid oldestSync date"),i.default.Assert(s,"Must supply a valid label store this label belongs to"),this._labelStore=s,this._accountID=e,this._labelID=t,this._fullName=a,this._minName=void 0,this._matchName=a?a.toUpperCase():void 0,this._oldestSync=r,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!o||!o.isDeleted),this._labelListVisibility=o&&o.labelListVisibility?o.labelListVisibility:n.a.LabelListVisibility.Show,this._messageListVisibility=o&&o.messageListVisibility?o.messageListVisibility:n.a.MessageListVisibility.Show,this._origLabelID=void 0}var ta={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},aa={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},ia={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},na={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},ra={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0};ea.prototype={_getDisplayPriority:function(){return aa[this.getLabelID()]||-1},displayCompare:function(e){var t=this.isSystemOrSpecialLabel(),a=e.isSystemOrSpecialLabel();return t&&a?this._getDisplayPriority()<e._getDisplayPriority()?1:-1:t?-1:a?1:this.getName().localeCompare(e.getName())},isDropTarget:function(){return!ra[this.getLabelID()]},_getStoreLabel:function(e){var t,a=e.toUpperCase();for(var i in this._labelStore){var n=this._labelStore[i].getRawName();if(n&&n.toUpperCase()===a){t=this._labelStore[i];break}}return t},_computeAncestors:function(){if(i.default.Assert(this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors"),this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var e=0,t=this._fullName.split("/"),a="",n=0;n<t.length-1;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a+=t[n];var r=this._getStoreLabel(a);r&&r!==this&&this._ancestors.push(r),a+="/"}this._computeMinName()}i.default.Assert(this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")},_computeMinName:function(){for(var e=0,t=this.getRawName(),a=0;a<this._ancestors.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._ancestors[a].getMinName()+"/",n=t.indexOf(i);t=t.substr(n+i.length)}this._minName=t},getAccountID:function(){return this._accountID},getLabelID:function(){return this._labelID},getRawName:function(){return this._fullName},getMinName:function(){return this._minName?this._minName:this._fullName},getMatchName:function(){return this._matchName},isMatched:function(e){i.default.Assert(i.default.isString(e),"Must pass in a valid string for label name");var t=!1,a=this.getMatchName();return e&&a&&a.indexOf(e.toUpperCase())>=0&&(t=!0),t},isNamed:function(e){i.default.Assert(i.default.isString(e),"Must pass in a valid string for label name");var t=!1,a=this.getMatchName();return e&&a&&a===e.toUpperCase()&&(t=!0),t},getName:function(e){var t;return ta[this.getLabelID()]?t=ta[this.getLabelID()]:ia[this.getLabelID()]?t=ia[this.getLabelID()]:e&&this._minName?t=this.getMinName():this._fullName?t=this._fullName:(i.default.Assert(!this.isLocalOnly(),"Should not have a local-only label without a name"),t=this.getLabelID()),t||""},hasName:function(){return ta[this.getLabelID()]||ia[this.getLabelID()]||!!this._fullName},clearOldestSync:function(){this._oldestSync=void 0},getOldestSync:function(){return this._oldestSync},setOldestSync:function(e){i.default.Assert(i.default.isDateValid(e),"Must provide a valid oldestSync date"),this._oldestSync=e},getMessageListVisibility:function(){return this._messageListVisibility},getLabelListVisibility:function(){return this._labelListVisibility},isLocalOnly:function(){return i.default.isTempId(this.getLabelID())},updateLabelID:function(e){i.default.Assert(this.isLocalOnly(),"Should only ever modify local labels"),this._origLabelID=this.getLabelID(),this._labelID=e},updateLabelName:function(e){this._fullName=e,this._matchName=e.toUpperCase(),this._computeAncestors()},getSaveData:function(){return{id:this.getLabelID(),name:this._fullName,oldestSync:this.getOldestSync(),messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted}},getDisplayText:function(e){var t;return this.getName()&&(t=this.getName().startsWith("Moo.do/")?this.getName().substr("Moo.do".length+1):this.getName(e)),t},getOutlineText:function(){var e=this.getDisplayText();return e?e.replace(/ /g,"_"):void 0},matchesText:function(e){return this.getDisplayText().toLowerCase().indexOf(e)>=0},hasAncestors:function(){return!!this._fullName&&this.getAncestors().length>0},getAncestors:function(){return this._computeAncestors(),this._ancestors},getParent:function(){var e=this.getAncestors();return e[e.length-1]},isSystemLabel:function(){return!!ta[this.getLabelID()]},isSpecialLabel:function(){return!!ia[this.getLabelID()]},isSystemOrSpecialLabel:function(){return this.isSystemLabel()||this.isSpecialLabel()},isCategoryLabel:function(){return!!na[this.getLabelID()]},isArchived:function(){return"Archived"===this.getName()},isStarred:function(){return"Starred"===this.getName()},isInbox:function(){return"Inbox"===this.getName()},isDraft:function(){return"Draft"===this.getName()},isTrash:function(){return"Trash"===this.getName()},isCustom:function(){return!this.isSystemLabel()&&!this.isSpecialLabel()},getUnreadCount:function(){return this._numUnread},shouldDisplayInLabelList:function(){var e=!1;return this._isDeleted||(this.getLabelListVisibility()===n.a.LabelListVisibility.Show?e=!0:this.getLabelListVisibility()===n.a.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0&&(e=!0)),e},shouldDisplayInMessageList:function(){return this._messageListVisibility===n.a.MessageListVisibility.Show},delete:function(){i.default.Assert(!this.isSystemOrSpecialLabel(),"Should never delete a special or system label"),this._isDeleted=!0}};var oa=ea,sa=a(44);function la(e){this._plugin=e,this._headers=[],this._mimeTree=void 0}var ua=0;la.prototype={reset:function(){this._headers=[],this._mimeTree=void 0},getMessageText:function(e,t){return e.decoded},updateFromDraft:function(e,t,a,n,r,o){var s,l,u=this;if(this.reset(),this.addHeader("From",this._plugin._formatAddressText(a,n,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(t.to,!0)),t.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(t.cc,!0)),t.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(t.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",i.default.encodeMIMEHeader(t.subject||"(no subject)")),t.inReplyTo){this.addHeader("In-Reply-To",t.inReplyTo.trim());var d=e.messages.indexOfWithProperty("messageID",t.inReplyTo);i.default.Assert(d>=0,"Must always be able to find the message being replied to"),s=e.messages[d]}t.references?l=t.references:s&&(l=(i.default.isTempId(s.messageID)?"":s.messageID)+(s.references?" "+s.references:"")),l&&this.addHeader("References",l.trim());var c,h=sa.a.generatePlaintext(this.getMessageText(t,r),{}),f=this._getAttachedResources(t);if(f.length>0&&(c=this.createMimePart("multipart/mixed"),this.addMimePart(c)),h){var p=this.createMimePart("multipart/alternative");this.addMimePart(p,c);var g=this.createMimePart("text/plain",h,"7bit");this.addMimePart(g,p);var m=this._getInlineResources(t);if(m.length>0){var v=0,y=this.createMimePart("multipart/related");this.addMimePart(y,p);var _=this.createMimePart("text/html",this.getMessageText(t,r),"7bit");this.addMimePart(_,y);for(var b=0;b<m.length;++b){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var k=m[b],w=this.createResourcePart(k);w&&this.addMimePart(w,y)}}else{var S=this.createMimePart("text/html",this.getMessageText(t,r),"7bit");this.addMimePart(S,p)}}else{var I=this.createMimePart(t.contentType||"text/html",this.getMessageText(t,r),"7bit");this.addMimePart(I,c)}if(c&&r)for(var D=0,C=0,P=function(){if(++C===f.length){for(var e=0,t=0;t<f.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=f[t],i=u.createResourcePart(a);i&&u.addMimePart(i,c)}o()}},A=0;A<f.length;++A){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;this._plugin.loadResource(e.id,t.id,f[A].cid,P)}else setTimeout(o,0)},_getInlineResources:function(e){var t=[];return e.resources.forEachResource(function(e){"inline"===e.disposition&&t.push(e)}),t},_getAttachedResources:function(e){var t=[];return e.resources.forEachResource(function(e){"attachment"===e.disposition&&e.id&&t.push(e)}),t},addHeader:function(e,t){i.default.Assert(t.indexOf("\n")<0,"Header should not have a newline: "+e);var a=t.trim().replace(/[\r\n]/g,"");this._headers.push(e+": "+a)},_generateBoundary:function(){return"=========3141592653589moodo"+Date.now()+ ++ua},createMimePart:function(e,t,a,n){return i.default.Assert(e,"Must supply a valid content type"),i.default.Assert(void 0===t||a,"Must supply a valid content encoding"),{boundary:this._generateBoundary(),contentType:e,content:t,contentEncoding:a,contentDisposition:n,children:[]}},createResourcePart:function(e){var t;if(i.default.Assert(e&&e.data,"Must have valid data loaded for resource to embed it in message"),e&&e.data){var a=e.mimeType+'; name="'+e.cid+'"',n=e.disposition+'; filename="'+e.cid+'"';(t=this.createMimePart(a,e.data,e.contentEncoding,n)).contentID=e.cid}return t},addMimePart:function(e,t){i.default.Assert(e,"Must supply a valid mime part"),t?t.children.push(e):(i.default.Assert(!this._mimeTree,"Must not yet have a valid mime tree root"),this._mimeTree=e)},_mimePartToBlob:function(e){var t="\r\n",a=[];function n(e,t){if(t){i.default.Assert(t.indexOf("\n")<0,"Header should not have a newline: "+e);var n=t.trim().replace(/[\r\n]/g,"");a.push(e+": "+n)}}var r=e.contentType;(e.content||(r+='; boundary="'+e.boundary+'"'),n("MIME-Version","1.0"),n("Content-Type",r),n("Content-Transfer-Encoding",e.contentEncoding),n("Content-Disposition",e.contentDisposition),e.contentID)&&n("Content-ID","<"+e.contentID+">");if(t=a.join("\r\n").trim(),t+="\r\n",e.content)t+="\r\n"+e.content+"\r\n";else if(e.children&&e.children.length>0){for(var o=0,s=0;s<e.children.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;t+="\r\n--"+e.boundary+"\r\n",t+=this._mimePartToBlob(e.children[s])}t+="--"+e.boundary+"--\r\n"}else t+="\r\n(no text)\r\n";return t},generateBlob:function(){var e=this._headers.join("\r\n").trim();return e+="\r\n"+this._mimePartToBlob(this._mimeTree)}};var da=la;function ca(){this._lib={}}ca.prototype={add:function(e){i.default.Assert(1===arguments.length,"Only expect a single resource to be passed in, not a res,key pair"),i.default.Assert(e.id,"Must specify a valid resource ID"),i.default.Assert(!this._lib[e.id],"Should never have duped resources"),this._lib[e.id]=e},getByCID:function(e){var t;this._lib;return this.forEachResource(function(a){if(a.cid===e)return t=a,!1}),t},find:function(e){var t;if(this.has(e))t=this.getByCID(e);else{var a=e.split("@");t=this.getByCID(a[0])}return t},has:function(e){return!!this.getByCID(e)},remove:function(e){i.default.Assert(this._lib[e.id],"Must only remove resouces that actually exist"),delete this._lib[e.id]},isEmpty:function(){return i.default.isEmpty(this._lib)},forEachResource:function(e){for(var t in this._lib)try{if(!1===e(this._lib[t]))break}catch(a){i.default.reportError(a)}},clone:function(){var e=new ca;for(var t in this._lib)e.add(i.default.clone(this._lib[t]));return e}};var ha=ca;function fa(e){return(fa="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pa(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ga(e,t,a){return(ga="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=ma(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function ma(e){return(ma=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function va(e,t){return(va=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ya(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}if(f.a.isMobile)var _a=a(30).default;var ba=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i,r,o={title:"Email",contextMenuMode:n.a.ContextMenuMode.Gmail,paneEmptyMessage:"No emails here",paneEmptySearchMessageDefault:"Press enter to search",paneEmptySearchMessage:"Press enter to search",titleContextMenuHeader:"Open label",dropEffect:function(){return n.a.DropEffect.Copy},isWriteable:!1,overrideCopyBehavior:!1,supportCollapsing:!1,supportCompleting:!0,supportCheckbox:!0,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:!0,supportReportError:!0,supportCompose:!0,supportPagination:!0,supportVertLines:!1,supportSearchItemAutocomplete:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportLocalSearch:!1,supportClone:!1,supportDeferredItemLoad:!0,supportCellTransition:!1,useLineCache:!1,shouldSearchMatchParents:!1,noOverviewStyle:!0,supportStarClick:!0,supportClickOverviewScroll:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,overviewHasPaneItems:!1,overviewPadLevels:-1,showRootOnRow2:!0,maxWidthFlex:n.a.ExpandedPaneWidth,maxWidth:n.a.ExpandedPaneWidth+200,maxWidthSingle:n.a.ExpandedPaneWidth,widthBiggerInSingle:!1,supportsDocuments:!1,_topBoxHeight:0,searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-in:trash -is:unread";break;case 1:t="-in:trash is:unread";break;default:t=""}return t},matchFn:function(e,t){var i=a.plugin.isItemUnread(t);if(e)return i&&e>0||!i&&e<0?n.a.MatchState.Yes:n.a.MatchState.No}},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-is:starred";break;case 1:t="is:starred";break;default:t=""}return t},matchFn:function(e,t){var i=a.plugin.isItemStarred(t);if(e)return i&&e>0||!i&&e<0?n.a.MatchState.Yes:n.a.MatchState.No}},{name:"priority",remoteStringFn:function(e){var t;switch(e){case n.a.VMLIFlag.P0:t="label:Moo.do/Priority High";break;case n.a.VMLIFlag.P1:t="label:Moo.do/Priority Medium";break;case n.a.VMLIFlag.P2:t="label:Moo.do/Priority Low";break;default:t=""}return t},matchFn:function(e,t){return a.plugin.getItemPriority(t)>=e?n.a.MatchState.Yes:n.a.MatchState.No}},{name:"category",remoteStringFn:function(e){return e?"category:"+e:""},matchFn:function(e,t){return e?a.plugin.itemHasLabel(t,e)?n.a.MatchState.Yes:n.a.MatchState.No:n.a.MatchState.Yes}}]};return e.plugin=xo.pluginManager.getPlugin(n.a.PluginID.Gmail),i=this,r=ma(t).call(this,e,o),(a=!r||"object"!==fa(r)&&"function"!==typeof r?ya(i):r).type=a.plugin._paneType,a.paneClass="panePlugin paneGmail",a.isInitializing=!0,a._lines=[{text:"\u2000",start:0,length:1,width:0}],a.dragMarginTop=25,a.blocks=[],a.blocksByKey={},a._focusedTrash=!1,a.shouldCheckHeight=!0,a.maxScrollOffset=0,a.selectedIndex=new X.a(-1,a.onSelectedIndexChanged.bind(ya(ya(a)))),a._isSearchingRemote=new X.a(!1),a._overviewAccount=new X.a,a._currentSearch=void 0,a._ignoreRestoreScroll=!0,a._failedPageRequest=new X.a(!1),a.viewState=new X.a(e.viewState&&e.viewState.viewMode?e.viewState:{viewMode:n.a.GmailViewMode.Date}),a.item.listen(a._onItemChange.bind(ya(ya(a)))),a.viewState.listen(a._onViewStateChange.bind(ya(ya(a)))),S.a.binder(ya(ya(a)),"onScroll","_runRemoteSearch","searchCompare","onTopTextChanged","headerSearchCompare","onMultiselectReset","changeView","openViewMenu","onEmailComposeClosed","onEmailPreviewClosed"),a.initGmail(),a._firstSelectedItem=void 0,!f.a.isMobile&&e.isExpanded&&(xo.EmailPreview.startOpenOnLoad(ya(ya(a))),a._firstSelectedItem=e.selectedItem),a.isInitializing=void 0,a}var a,r,s;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&va(e,t)}(t,dt["a"]),a=t,(r=[{key:"initGmail",value:function(){P.a.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._onItemChange(this.getItem()),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),o.a.listen("EmailCompose","onClosed",this.onEmailComposeClosed),o.a.listen("EmailPreview","onClosed",this.onEmailPreviewClosed)}},{key:"destroy",value:function(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),o.a.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),o.a.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),P.a.unlisten("reset",this.onMultiselectReset),ga(ma(t.prototype),"destroy",this).call(this)}},{key:"onLoad",value:function(e){ga(ma(t.prototype),"onLoad",this).call(this,e),this.addScrollListener(this.onScroll)}},{key:"notifyPluginLoaded",value:function(){var e=this.deferredItemState;if(e){var t=this.getItemStore().getItem(e.itemID);t&&this.setItem(t,!0)}}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(e){return this.plugin.getDefaultDisplayItem(e)}},{key:"searchCompare",value:function(e){var t=!1;return this.plugin.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0):this.search.isMatched(e,!1)&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0),t}},{key:"runItemSearch",value:function(e){return i.default.Assert(e,"Must supply a valid param set for local item search"),i.default.Assert(e.item,"Gmail pane always expects a valid item when running local item search"),e.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(e):ga(ma(t.prototype),"runItemSearch",this).call(this,e)}},{key:"getItemSearchParams",value:function(){var e=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=e&&e.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}}},{key:"setOverviewAccount",value:function(e){this._overviewAccount.set(e),this.updateHeaders(!0)}},{key:"headerSearchCompare",value:function(e){if(this.plugin.isLabelItem(e)){var t=this.plugin.getLabelForVMLI(e);return!t||t.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(e)}},{key:"getHeaderSearchParams",value:function(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?1:NaN,overview:!0,pane:this}}},{key:"saveSelection",value:function(){return P.a.getSelectedItems(this)}},{key:"restoreSelection",value:function(e){if(e.length>0){for(var t=0,a=[],i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.indexOfItem(e[i]);n>=0&&a.push(n)}if(a.length>1)this.selectedIndex.set(a[0],!1),P.a.setSelected(a,this);else if(1===a.length)this.selectIndex(a[0]);else{var r=this.selectedIndex.get();r>=this.numItems()&&(r=this.numItems()-1),this.selectIndex(r,!0)}}}},{key:"_setItems",value:function(e,t){for(var a,i=0,r=this.saveSelection(),o=[],s={},l=this.getViewMode()===n.a.GmailViewMode.Date?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn,u=0;u<e.length;++u){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var d=e[u],c=this.plugin._getThreadIDFromItem(d);c&&!s[c]&&(o.insertSorted(d,l),this._firstSelectedItem&&d.id===this._firstSelectedItem&&(a=d),s[c]=!0)}if(this.updateOutline(o),this.restoreSelection(r),a&&e.length>0){var h=this.indexOfItem(a);h>=0&&(this.selectIndex(h),requestAnimationFrame(function(){this.setScrollOffset(this.getScrollTop(),n.a.ScrollDuration.Snap)}.bind(this))),this._firstSelectedItem=void 0}}},{key:"setHeaders",value:function(e,t){var a=0;if(!this._overviewAccount.get()){var n=this.plugin.getDescriptorForItem(this.getItem());this._overviewAccount.set(n.accountID)}this._allHeaders=e;for(var r=[],o={},s={},l=0;l<this._allHeaders.length;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u,d=this._allHeaders[l];if(o[u=this.plugin._getAccountIDFromItem(d)]||(o[u]=[]),this.plugin.isAccountItem(d))s[u]=d;else{var c=o[u];this.plugin.isDisplayHeader(d)&&c.insertSorted(d,this.plugin.labelVMLISortFn)}}var h=o[this._overviewAccount.get()];if(h){var f=s[u];if(i.default.Assert(f,"Must have valid account item"),f){var p=0;for(l=0;l<h.length;++l){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;if(l>0){var g=this.plugin.getLabelForVMLI(h[l-1]),m=this.plugin.getLabelForVMLI(h[l]);(g.isSystemOrSpecialLabel()&&!m.isSystemOrSpecialLabel()||!g.isCategoryLabel()&&m.isCategoryLabel())&&r.push({type:"hr",id:"hr"+u+l,sizeInPane:this.heightOverviewHR})}r.push(h[l])}}}this.headers.set(r)}},{key:"heightOverviewHR",value:function(){return 4}},{key:"getTitleList",value:function(){if(this.getItem().isDescendantOf(this.getRootItem())){var e=this.plugin.getDescriptorForItem(this.getItem()),t=this.plugin.getVMLIForAccount(e.accountID);return t===this.getItem()?[this.getItem(),"Everything"]:this.plugin.numSyncAccounts()>1?[t,this.getItem()]:[this.getItem()]}return[this.getItem()]}},{key:"onClickTitle",value:function(e){this.plugin.isAccountItem(e)?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e)):e===this.getRootItem()?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(e)||(e=this.plugin.getDefaultDisplayItem(this.plugin.getDefaultAccount())),ga(ma(t.prototype),"onClickTitle",this).call(this,e)}},{key:"onTopTextChanged",value:function(){this.topBoxHeight.set(this.paneTopText.get()?36:0)}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDataPage",value:function(e){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(e,this.onDataPagedIn.bind(this))}},{key:"dropEffectCopyBehavior",value:function(e,t){return i.default.Assert(!e.belongsToSameItemStore(t),"Dropping onto a Gmail pane is not supported"),this.plugin.createOutlinePaneItem(e,t)}},{key:"refreshPaneData",value:function(){this.plugin.refreshCurrentView()}},{key:"reportPaneError",value:function(){xo.menus.openModal(n.a.Modals.ReportBug)}},{key:"_onItemChange",value:function(e){P.a.reset(this),this._clearCurrentSearch();var t=this.plugin.getLabelForVMLI(e);this._focusedTrash=t&&t.isTrash(),e.hasPaginationToken()||this.plugin.handleItemChange(e,function(){this.isLoading.set(!1)}.bind(this)),this.numItems()>0&&this.selectIndex(0)}},{key:"_onViewStateChange",value:function(){P.a.reset(this),this.plugin.handleViewModeChange(this.getItem(),this.getViewMode()),this.updateItemsImmediate(!0,void 0,void 0,!0),xo.PaneManager.updatePaneStateForPane(this),this.setScrollOffset(0)}},{key:"getItemLabel",value:function(e){var t=e?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(t)}},{key:"onDataPagedIn",value:function(e){e?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)}},{key:"onScroll",value:function(){if(!this.isLoadingNewPage.get()&&!this.isSearched()){var e=this._infiniteList.getMaxScrollOffset();this.getScrollOffset()>=e&&this.requestDataPage(this.getItem())}}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){var e=this.plugin._getAccountIDFromItem(this.getItem());return Ke.a.isAuthorizedForScopes(e,[n.a.GScope.GmailModify])?"Loading...":"Authorizing..."}},{key:"bottomListMessage",value:function(){var e;return this.getItem().hasPaginationToken()&&(e=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),{text:e,clickable:!0}}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"sizeOfItem",value:function(e,a,i){if("blockHeader"===e.type)return 40;if(i)return ga(ma(t.prototype),"sizeOfItem",this).call(this,e,a,i);var r=this.objectAtIndex(a);return i?xo.DisplaySettings.lineItemHeight(r,e,this,1):n.a.EmailItemHeight}},{key:"onClickItem",value:function(e,t,a,n){i.default.vmMain.activeInput.get()&&i.default.vmMain.activeInput.get().blur();var r=!0;if(f.a.isMobile&&_a.isInMultiselect()||(f.a.mac&&n.metaKey||!f.a.mac&&n.ctrlKey)&&P.a.getSelected(this).length>0)P.a.toggleSelected(e,this),r=!1;else if(n.shiftKey){var o=P.a.getFirstSelectedIndex(this),s=P.a.getLastSelectedIndex(this);e<o?o=e:e>s&&(s=e),P.a.selectInOrder(o,s,this),r=!1}else if(i.default.hasClass(n.target,"emailLabel")){var l=n.target.textContent,u=t.getAttachmentByPlugin(this.plugin.id).getField("accountID"),d=this.plugin._getLabelByName(u,l);if(i.default.Assert(d,"Must be able to get a valid label if clicking a valid label: ",l),d){var c=this.plugin.getVMLIForLabel(u,d);this.zoomIn(c),r=!1}}else i.default.hasClass(n.target,"itemCheckbox")||this.selectIndex(e);r&&t.onClick(e,a,n)}},{key:"onRightClickItem",value:function(e,a,i){(P.a.numSelectedInPane(this)<=1||!P.a.isSelected(e,this))&&this.selectIndex(e),ga(ma(t.prototype),"onRightClickItem",this).call(this,e,a,i),i.preventDefault(),i.stopPropagation()}},{key:"handleLeftSideTap",value:function(e,t){var a=e.item;f.a.isMobile?xo.pluginManager.handleTapClick(a,this,t):this.toggleStar(a)}},{key:"handleRightSideTap",value:function(e,t){if(e&&e.hasPluginAttachment(this.plugin.id))if(f.a.isMobile)xo.pluginManager.handleTapClick(e,this,t);else{var a=this.getItemLabel(!0),n=!a.isArchived();this.archiveItem(n,e),a.isInbox()||a.isArchived()||this.removeItemFromCurrentLabel(e);var r=this.selectedIndex.get();r>=this.numItems()&&(r=this.numItems()-1),this.selectIndex(r,!0),i.default.vmMain.redoLastMouseMove()}}},{key:"onMultiselectReset",value:function(e){this===e&&this.selectedIndex.set(-1)}},{key:"selectIndex",value:function(e,t){var a=this.selectedIndex.get();this.selectedIndex.set(e,t),e>=0?P.a.setSelected([e],this):P.a.reset(this),(t||a!==e)&&this.selectedIndex.notify(),this.isLoading.get()||xo.PaneManager.updatePaneStateForPane(this)}},{key:"selectItem",value:function(e,t){if(e){var a=this.indexOfItem(e);a>=0&&this.selectIndex(a,t)}else this.selectIndex(-1,t)}},{key:"onSelectedIndexChanged",value:function(e){if(xo.EmailPreview.isOpenOnPane(this))if(e>=0){var t=this.itemAtIndex(e);this.openEmailByItem(t)}else e<0&&xo.EmailPreview.reset()}},{key:"_runRemoteSearch",value:function(){if(xo.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var e=this.search.getRemoteValue(),t=this.plugin.getDescriptorForItem(this.item.get());if(t.labelID){var a=this.plugin._getLabelByID(t.accountID,t.labelID);a.isSpecialLabel()||a.isInbox()||!a.hasName()||(e+=" label:"+a.getName())}this._lastSearchValue=e,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var r="R~"+this.getActualPaneItem().id+"~"+i.default.generateTempId();i.default.log("Gmail Remote Search ItemID: ",r),this._currentSearch=this.plugin.runSearch(e,this.id,r,!0,function(e){if(!this._destroyed&&this._isSearchingRemote.get())switch(this.paneEmptySearchMessage=e===n.a.SearchResultStatus.Done?this.paneEmptySearchMessageDefault:"",this.isLoading.set(!1),e){case n.a.SearchResultStatus.Done:this.paneTopText.set(""),this.setScrollOffset(0);break;case n.a.SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case n.a.SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case n.a.SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:i.default.Assert(!1,"Invalid search state: ",e)}}.bind(this))}}},{key:"_clearCurrentSearch",value:function(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)}},{key:"onSearchChanged",value:function(e){var t=this.search.getRemoteValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"isRemoteSearchActive",value:function(){return this.plugin.isRemoteSearchBucketActive(this.id)}},{key:"onEmailComposeClosed",value:function(){var e=this.plugin,t=e.getDefaultAccount(),a=e._getLabelByID(t,Ea.DRAFT),i=e.getVMLIForLabel(t,a);this.item.get()===i&&this.selectIndex(-1)}},{key:"onEmailPreviewClosed",value:function(){f.a.isMobile&&this.selectIndex(-1)}},{key:"applyToSelection",value:function(e){var t=this.saveSelection();P.a.applyFnToSelected(e,this),this.restoreSelection(t)}},{key:"_autocompletePopup",value:function(e,t,a){var i=this;if(!e.elementDisplay){var n=P.a.getFirstSelectedIndex(this),r=this.elementAtIndex(n);e.elementDisplay=r}var o=[];P.a.applyFnToSelected(function(e){o.push(e)},this),e.items=o,e.onSelected=function(n){i.plugin.beginAction(),e.item?t(e.item,n):P.a.applyFnToSelected(function(e){t(e,n)},i),a&&a(),i.plugin.endAction()},M.a.showPopup(e)}},{key:"getPaddingForPaneObject",value:function(e,a){return a?ga(ma(t.prototype),"getPaddingForPaneObject",this).call(this,e,a):24}},{key:"getWidth",value:function(){return this.rect.get().width}},{key:"getFirstSelectedItem",value:function(){return P.a.getFirstSelectedItem(this)}},{key:"getFirstSelectedIndex",value:function(){return P.a.getFirstSelectedIndex(this)}},{key:"moveItem",value:function(e,t,a){this.plugin.beginAction(),a||(e=e.clone(t,n.a.ChangeType.Local));var r=e.getAttachmentByPlugin(this.plugin.id);i.default.Assert(r,"Must be able to get a valid attachment"),this.plugin.performAction(n.a.PluginAction.Gmail.Move,!1,r,e,t),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(n.a.PluginAction.Gmail.Archive,!1,r),this.plugin.attachmentHasLabel(r,"Moo.do/Handled")||this.plugin.performAction(n.a.PluginAction.Gmail.AddLabel,!1,r,"Moo.do/Handled"),this.plugin.endAction()}},{key:"autocompleteSchedule",value:function(e,a){var i=this,n=this.selectedIndex.get();ga(ma(t.prototype),"autocompleteSchedule",this).call(this,e,function(){n>=i.numItems()&&(n=i.numItems()-1),i.selectIndex(n,!0),a&&a()})}},{key:"autocompleteSnooze",value:function(e,a,i){var n=this,r=this.selectedIndex.get();ga(ma(t.prototype),"autocompleteSnooze",this).call(this,e,a,function(){r>=n.numItems()&&(r=n.numItems()-1),n.selectIndex(r,!0),i&&i()})}},{key:"autocompleteMove",value:function(e,a){var i=this;e=e||{};var n=this.selectedIndex.get();e.positionOffset={left:40},ga(ma(t.prototype),"autocompleteMove",this).call(this,e,function(){n>=i.numItems()&&(n=i.numItems()-1),i.selectIndex(n,!0),a&&a()})}},{key:"autocompleteCreateTask",value:function(){var e=this,t=this.selectedIndex.get();if(!isNaN(t)){var a=this.elementAtIndex(t),i=P.a.getSelectedItems(this);xo.menus.openItemEditor({element:a,pane:this,selectIndex:0,addOnSave:!0,side:"bottom",children:i,positionOffset:{left:10},options:[{text:"Archive email",vlue:xo.pluginManager.getSetting(n.a.PluginID.Gmail,n.a.PluginSettingsID.Gmail.ArchiveOnOrganize),cb:function(){for(var t=0,a=0;a<i.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[a].getAttachmentByPlugin(e.plugin.id);e.plugin.performAction(n.a.PluginAction.Gmail.Archive,!1,r)}}}],beginSave:function(){var t=0;xo.PaneUpdateBatcher.beginUpdateItems(),e.plugin.beginAction();for(var a=0;a<i.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[a].getAttachmentByPlugin(e.plugin.id);e.plugin.attachmentHasLabel(r,"Moo.do/Handled")||e.plugin.performAction(n.a.PluginAction.Gmail.AddLabel,!1,r,"Moo.do/Handled")}},endSave:function(t){e.plugin.endAction(),xo.PaneUpdateBatcher.commitUpdateItems()}})}}},{key:"toggleStarSelected",value:function(){ga(ma(t.prototype),"toggleStarSelected",this).call(this),this.updateItems()}},{key:"toggleStar",value:function(e){var t=e.getAttachmentByPlugin(this.plugin.id);i.default.Assert(t,"Must be able to get a valid attachment");var a=t.getPlugin();a.isItemStarred(e)?a.performAction(n.a.PluginAction.Gmail.Unstar,!1,t):a.performAction(n.a.PluginAction.Gmail.Star,!1,t),this.updateItems()}},{key:"_openSelectedInMode",value:function(e){var t=P.a.getFirstSelectedIndex(this);this.selectIndex(t);var a=this.itemAtIndex(t);this.openEmailByItem(a,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(n.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(n.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(n.a.EmailResponseMode.Forward)}},{key:"archiveSelected",value:function(e){this.plugin.beginAction(),this.applyToSelection(this.archiveItem.bind(this,e)),this.plugin.endAction()}},{key:"archiveItem",value:function(e,t){var a=t.getAttachmentByPlugin(this.plugin.id);i.default.Assert(a,"Must be able to get a valid attachment"),!e&&this.plugin.isItemArchived(t)?this.plugin.performAction(n.a.PluginAction.Gmail.Unarchive,!1,a):e&&!this.plugin.isItemArchived(t)&&this.plugin.performAction(n.a.PluginAction.Gmail.Archive,!1,a)}},{key:"deleteSelected",value:function(e,t){this.plugin.beginAction(),this.applyToSelection(this._deleteItem.bind(this,t)),this.plugin.endAction()}},{key:"_deleteItem",value:function(e,t){var a=t.getAttachmentByPlugin(this.plugin.id);i.default.Assert(a,"Must be able to get a valid attachment");var r=this.plugin.getLabelForVMLI(this.getItem());e&&r&&r.isDraft()&&this.plugin.itemHasDraft(t)?this.plugin.performAction(n.a.PluginAction.Gmail.DiscardDraft,!0,a):!e&&this.plugin.isItemFullTrashed(t)?this.plugin.performAction(n.a.PluginAction.Gmail.Untrash,!1,a):e&&!this.plugin.isItemFullTrashed(t)&&this.plugin.performAction(n.a.PluginAction.Gmail.Trash,!1,a)}},{key:"applyPriorityToSelection",value:function(e,t){var a=e,r=!0;this.plugin.beginAction(),this.applyToSelection(function(o){var s=o.getAttachmentByPlugin(this.plugin.id);i.default.Assert(s,"Must be able to get a valid attachment"),t&&r&&(this.plugin.getAttachmentPriority(s)===e&&(a=n.a.VMLIFlag.None),r=!1),this.plugin.performAction(n.a.PluginAction.Gmail.SetPriority,!1,s,a),this.updateItems()}.bind(this)),this.plugin.endAction()}},{key:"handleUndo",value:function(){this.plugin.handleUndo()}},{key:"handleRedo",value:function(){this.plugin.handleRedo()}},{key:"keyMoveDown",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(P.a.isInverted(this)&&1===P.a.numSelectedInPane(this)&&P.a.setInverted(!1,this),P.a.isInverted(this)?(t=P.a.getFirstSelectedIndex(this),P.a.removeSelected(t,this)):(t=this.indexOfNextVMLI(P.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(P.a.addSelected(t,this),this.scrollIndexIntoView(t,n.a.ScrollDuration.Default))):(t=this.indexOfNextVMLI(P.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(this.selectIndex(t),this.scrollIndexIntoView(t,n.a.ScrollDuration.Default))}},{key:"keyMoveUp",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(P.a.isInverted(this)||1!==P.a.numSelectedInPane(this)||P.a.setInverted(!0,this),P.a.isInverted(this)?(t=this.indexOfPrevVMLI(P.a.getFirstSelectedIndex(this)))>=0&&(P.a.addSelected(t,this),this.scrollIndexIntoView(t,n.a.ScrollDuration.Default)):(t=P.a.getLastSelectedIndex(this),P.a.removeSelected(t,this))):(t=this.indexOfPrevVMLI(P.a.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(t),this.scrollIndexIntoView(t,n.a.ScrollDuration.Default))}},{key:"onHotkey",value:function(e,t,a){if(this.selectedIndex.get()>=0&&!xo.menus.isContextMenuOpen()&&"Email"===e){var r=this.itemAtIndex(this.selectedIndex.get()),o=!0;if(r){if("Up"===t)this.keyMoveUp(a);else if("Down"===t)this.keyMoveDown(a);else if("Open"===t)xo.EmailPreview.isOpenOnPane(this)||this.openEmailByItem(r);else if("Archive"===t){a.shiftKey&&xo.EmailPreview.isOpenOnPane(this)&&xo.EmailPreview.close();var s=!this.getItemLabel(!0).isArchived();this.archiveSelected(s)}else if("Delete"===t)this.deleteSelected(this.plugin.isGmailItem,!0);else if("Schedule"===t)this.autocompleteSchedule();else if("Snooze"===t)this.autocompleteSnooze();else if("Move"===t)this.autocompleteMove();else if("Task"===t)this.autocompleteCreateTask();else if("Label"===t)this.autocompleteLabel({item:r});else if("MarkRead"===t)this.markReadSelected(!0);else if("MarkUnread"===t)this.markReadSelected(!1);else if("Star"===t)this.toggleStarSelected();else if("Reply"===t)this.replySelected();else if("ReplyAll"===t)this.replyAllSelected();else if("Forward"===t)this.forwardSelected();else if("Priority1"===t)this.applyPriorityToSelection(n.a.VMLIFlag.P0,!0);else if("Priority2"===t)this.applyPriorityToSelection(n.a.VMLIFlag.P1,!0);else if("Priority3"===t)this.applyPriorityToSelection(n.a.VMLIFlag.P2,!0);else if("RemoveFromLabel"===t)this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel.bind(this)),this.plugin.endAction());else if("Undo"===t)this.handleUndo();else if("Print"===t){if(1===P.a.numSelectedInPane(this)){var l=P.a.getFirstSelectedItem(this),u=this.plugin.createPrintURLForThread(l.getAttachmentByPlugin(this.plugin.id));i.default.printPage(u)}}else if("OpenInGmail"===t){if(1===P.a.numSelectedInPane(this)){var d=P.a.getFirstSelectedItem(this),c=this.plugin.createURLForThread(d.getAttachmentByPlugin(this.plugin.id));i.default.openUrl(c)}}else o=!1;o&&i.default.preventDefault(a)}}}},{key:"removeItemFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);i.default.Assert(t,"Must be able to find a valid label for pane");var a=e.getAttachmentByPlugin(this.plugin.id);i.default.Assert(a,"Must be able to get a valid attachment"),t&&(t.isCustom()?this.plugin.performAction(n.a.PluginAction.Gmail.RemoveLabel,!1,a,t.getName()):t.isInbox()?this.plugin.performAction(n.a.PluginAction.Gmail.Archive,!1,a):t.isArchived()?this.plugin.performAction(n.a.PluginAction.Gmail.Unarchive,!1,a):t.isStarred()&&this.plugin.performAction(n.a.PluginAction.Gmail.Unstar,!1,a))}},{key:"canAcceptDragOver",value:function(e,t,a,n){if(e&&this.type===e.type&&(n||e&&this!==e)){var r,o=e.getItemLabel();if(n){var s=i.default.getElementParent(a);r=s&&i.default.getItemForElement(s)}else r=this.getItem();if(r&&this.plugin.isLabelItem(r)&&this.plugin.areItemsFromSameAccount(t,r)){var l=this.plugin.getLabelForVMLI(r);if(l!==o&&l.isDropTarget())return!0}}return!1}},{key:"_handleDragOverPane",value:function(e,t,a,i,n,r,o){return{targetElement:a,targetItem:this.getItem()}}},{key:"_handleDragDrop",value:function(e,t,a,r,o){if(a){var s,l=t.pane,u=l.getItemLabel(),d=a.targetItem,c=this.plugin.getLabelForVMLI(d);e.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(e,d)&&(s=e.getAttachmentByPlugin(this.plugin.id),i.default.Assert(s,"Must be able to get a valid attachment"),this.plugin.beginAction(),this.plugin.performAction(n.a.PluginAction.Gmail.RemoveLabel,!1,s,u.getName()),this.plugin.attachmentHasLabel(s,c.getName())||this.plugin.performAction(n.a.PluginAction.Gmail.AddLabel,!1,s,c.getName()),l.notifyDropFrom(e,this),this.plugin.endAction())}}},{key:"notifyDropFrom",value:function(e,t){if(this.selectIndex(-1),t.type===n.a.PaneMode.Task){var a=e.getAttachmentByPlugin(this.plugin.id);i.default.Assert(a,"Must be able to get a valid attachment"),this.plugin.attachmentHasLabel(a,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(n.a.PluginAction.Gmail.RemoveLabel,!1,a,"Inbox"),this.plugin.performAction(n.a.PluginAction.Gmail.AddLabel,!1,a,"Moo.do/Handled"),this.plugin.endAction());var r=this.plugin.getAttachmentPriority(a);r!==n.a.VMLIFlag.None&&e.setPriority(r,n.a.ChangeType.Local),this.plugin.attachmentHasLabelByID(a,"STARRED")&&e.setStarred(!0,n.a.ChangeType.Local)}}},{key:"maxWidthOfPaneObject",value:function(){return f.a.isMobile?this.getWidth()-36:this.getWidth()-56}},{key:"allowZoom",value:function(e){var t=!1;return this.plugin.isLabelItem(e)&&(t=!0),t}},{key:"performOverviewAction",value:function(e){if(this.plugin.isAccountItem(e)){e.setCollapsed(!e.isCollapsed(this,!0),this,!0);var t=e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e));this.zoomIn(t),i.default.sendEvent("Menu","OverviewZoom_Gmail")}}},{key:"setItem",value:function(e,a){return this.isLoading.set(!0),this.selectIndex(-1),ga(ma(t.prototype),"setItem",this).call(this,e,a)}},{key:"isItemHeader",value:function(e,t){if(!t)return e.isHeader();for(var a=0,i=this.plugin,n=e.getItems(),r=0;r<n.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i.isLabelItem(n[r])||i.isAccountItem(n[r]))return!0}}},{key:"getActualPaneItem",value:function(){return this.plugin._defaultZoomItems[this.id]||this.item.get()}},{key:"canResetMultiselect",value:function(){return!xo.EmailPreview.isOpenOnPane(this)||0===this.numItems()}},{key:"setExpanded",value:function(e,a){ga(ma(t.prototype),"setExpanded",this).call(this,e,a),e||this===i.default.focusedPane||P.a.reset(this)}},{key:"applyDropOnBlock",value:function(e,t){var a=e,r=t.getAttachmentByPlugin(this.plugin.id);if(i.default.Assert(r,"Must be able to get a valid attachment"),a.isDate){var o,s=a.dateTime||a.date;o=i.default.isString(s)?xo.International.parseDate(s,n.a.DateFormat.MDY):s,i.default.Assert(i.default.isDateValid(o),"Must provide a valid date when scheduling an email",a.dateTime,a.date),i.default.isDateValid(o)&&this.plugin.scheduleEmail(t,o)}else{var l;a.isStarred?this.plugin.performAction(n.a.PluginAction.Gmail.Star,!1,r):a.p0||a.isImportant?l=n.a.VMLIFlag.P0:a.p1?l=n.a.VMLIFlag.P1:a.p2&&(l=n.a.VMLIFlag.P2),l&&this.plugin.performAction(n.a.PluginAction.Gmail.SetPriority,!1,r,l)}}},{key:"getSaveInfo",value:function(){var e=ga(ma(t.prototype),"getSaveInfo",this).call(this);if(e.viewState=this.viewState.get(),!f.a.isMobile){var a=P.a.getFirstSelectedItem(this);e.selectedItem=a?a.id:void 0}return e}},{key:"setIgnoreRestoreScroll",value:function(){}},{key:"getSwipeMenuItems",value:function(){var e=this;return{leftOuter:{text:"Add to Outline",icon:"icon-align-left",clor:"#09d",fn:function(t){e.autocompleteMove({item:t,position:"autocomplete"})}},leftInner:{text:"Snooze",icon:"icon-access_time",clor:"#2a6",fn:function(t){e.autocompleteSnooze({item:t,position:"autocomplete"})}},rightInner:{text:"Archive",icon:"icon-check",clor:"#0c0",fn:function(t){var a=e.getItemLabel(!0),i=!a.isArchived();e.archiveItem(i,t),a.isInbox()||a.isArchived()||e.removeItemFromCurrentLabel(t)}},rightOuter:{text:"Delete",icon:"icon-delete",clor:"#a30",fn:function(t){e._deleteItem(!0,t)}}}}},{key:"onTapAddItem",value:function(e){xo.menus.openComposeEmail(i.default.vmMain.getDefaultEmailPlugin())}},{key:"isOverviewVisibleInPane",value:function(){return!0}},{key:"getMinItemSize",value:function(){return n.a.EmailItemHeight}},{key:"widthOfDrag",value:function(e){return this.getWidth()}},{key:"getStyledLinesForPaneObject",value:function(e,a){if(a)return ga(ma(t.prototype),"getStyledLinesForPaneObject",this).call(this,e,a);var r=e.item;return r.els||i.default.vmMain.runSingleParse(r,n.a.ChangeType.Auto),F.a.generateStyledLines(r.els,this._lines,this)}},{key:"viewModeIcon",value:function(){return"Date"===this.getViewMode()?"icon-access_time":"icon-exclamation"}},{key:"viewModeColor",value:function(){return"#2a6"}},{key:"openViewMenu",value:function(e){xo.menus.openContextMenu({componentName:"ReactContextMenuGmailSort",element:e.target,pane:this,onSelected:this.changeView})}},{key:"changeView",value:function(e){this.viewMode.set(e),this.updateItems(!1,!0)}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){var t=this.viewState.get();t.viewMode!==e&&(t.viewMode=e,this.viewState.set(t,!this.isFakePane))}},{key:"becomeReal",value:function(){this.getItem()&&this.setItem(this.getItem(),!0)}}])&&pa(a.prototype,r),s&&pa(a,s),t}(),ka=5e3;function wa(e,t,a){i.default.Assert(i.default.isFunction(e),"Must provide a valid entry callback"),i.default.Assert(i.default.isFunction(t),"Must provide a valid done callback"),this._entryCB=e,this._doneCB=t,this._delay=a||ka,this._flushTimeout=void 0,this._entries=[],S.a.binder(this,"_onEntry","_onDone","_flushEntries","_flushEntriesWatchdog")}wa.prototype={getEntryCB:function(){return this._onEntry},getDoneCB:function(){return this._onDone},_onEntry:function(e){e&&this._entries.push(e),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))},_onDone:function(e,t){xo.PaneUpdateBatcher.beginUpdateItems(),this._flushEntries();try{this._doneCB(e,t)}catch(a){i.default.reportError(a)}xo.PaneUpdateBatcher.commitUpdateItems()},_flushEntriesWatchdog:function(){0},_flushEntries:function(){var e=0;this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),xo.PaneUpdateBatcher.beginUpdateItems();for(var t=0;t<this._entries.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{this._entryCB(this._entries[t])}catch(a){i.default.reportError(a)}}this._entries=[],xo.PaneUpdateBatcher.commitUpdateItems()}};var Sa=wa,Ia=a(83);function Da(e){return(Da="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ca(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pa(e,t,a){return(Pa="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=Aa(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function Aa(e){return(Aa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ma(e,t){return(Ma=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ta(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Ea,La={EnsureLabelVMLI:"EnsureLabelVMLI",CreateLabelVMLI:"CreateLabelVMLI",MergeThread:"MergeThread",SyncdMessage:"SyncdMessage",ErrorSyncdMessage:"ErrorSyncdMessage",UnsyncdMessage:"UnsyncdMessage",OldUnsyncdMessage:"OldUnsyncdMessage",MessagesSyncd:"MessagesSyncd",MessageDataCached:"MessageDataCached"},xa={Snooze:"snoozemail",SendMail:"sendmail"},Oa=1,Ra=2,Fa=3,Na=4,Ba=5,Ua=6,Va=7,ja=8,Ha=9,za=10,qa=11,Wa=12,Ga=13,Ka=14,Ya=15,Xa=16,Qa=17,Ja=18,Za=19,$a=20,ei="historyIDs",ti="labels",ai="sendAs";!function(e){e.INBOX="INBOX",e.SPAM="SPAM",e.TRASH="TRASH",e.UNREAD="UNREAD",e.STARRED="STARRED",e.IMPORTANT="IMPORTANT",e.SENT="SENT",e.DRAFT="DRAFT",e.CHAT="CHAT",e.CATEGORY_PERSONAL="CATEGORY_PERSONAL",e.CATEGORY_SOCIAL="CATEGORY_SOCIAL",e.CATEGORY_PROMOTIONS="CATEGORY_PROMOTIONS",e.CATEGORY_UPDATES="CATEGORY_UPDATES",e.CATEGORY_FORUMS="CATEGORY_FORUMS"}(Ea||(Ea={}));var ii={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},ni="==MOODO_ARCHIVED==",ri="==MOODO_ALLMAIL==",oi={PRI0:"Moo.do/Priority High",PRI1:"Moo.do/Priority Medium",PRI2:"Moo.do/Priority Low"},si=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError"],li="multipart/signed",ui="multipart/related",di="message/partial",ci="multipart/mixed",hi="multipart/report",fi="multipart/parallel",pi="multipart/alternative",gi="multipart/digest",mi="multipart/encrypted",vi="multipart/voice-message",yi="text/calendar",_i="text/plain",bi="text/html",ki="text/watch-html",wi="text/x-watch-html",Si="inline",Ii="attachment",Di=["application","audio","example","image","message","model","video","text"],Ci=[pi,ci,_i,bi,hi],Pi=[_i,bi],Ai=[yi,vi,mi,ci],Mi=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],Ti=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,Ei=/\'(.*)\'/g,Li=function(e){function t(){var e,a,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,(e=!(r=Aa(t).call(this,n.a.PluginID.Gmail,"g","Email"))||"object"!==Da(r)&&"function"!==typeof r?Ta(a):r)._lastSyncTime=void 0,e._requiresOfflineAuth=!0,S.a.binder(Ta(Ta(e)),"threadSortFn","threadSortPriorityFn","labelSortFn","labelVMLISortFn","sortFn","_fromComparator","_toComparator","_dateComparator","_messagesComparator","_shallowObjComparator","isGmailItem","_flushPendingDraftUpdates","driveMessageContentSync","_cleanupLocalCaches","_handleDeferredSnoozeTask","_cancelDeferredSnoozeTask","_persistRemoteSnoozeTask","_handleDeferredSendMailTask","_cancelDeferredSendMailTask","_persistRemoteSendMailTask"),e._emailCache={},e._labelsByID={},e._labelsByName={},e._priorityLabels={},e._creatingDrafts={},e._pendingDraftUpdates={},e._pendingThreadLoads={},e._loadThreadMutex=0,e._activeDraftUpdates=0,e._accountSettings={},e._pendingSends={},e._draftCache={},e._unsyncdMessages={},e._pendingSyncdMessages={},e._numUnsyncdMessages=0,e._numSyncdMessages=0,e._outstandingContentSync=!1,e._undoStack=new $t(10),e._generateUndoRedo(),e._syncingOfflineChanges=!1,e._draftFlushTimer=void 0,e.registerSetting("WriteAccess","writeAccess","w",!0),e.registerSetting("SyncTime","syncTime","t",!0,n.a.MaxGmailSyncTime.Free),e.registerSetting("SyncAccounts","syncAccounts","s",!0,["me"]),e.registerSetting("ArchiveOnSchedule","archiveOnSchedule","a",!0,!1),e.registerSetting("ArchiveOnOrganize","archiveOnOrganize","o",!0,!1),e.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies","i",!0,!1),e.addTrackedStat(La.EnsureLabelVMLI),e.addTrackedStat(La.CreateLabelVMLI),e.addTrackedStat(La.MergeThread),e.addTrackedStat(La.SyncdMessage),e.addTrackedStat(La.ErrorSyncdMessage),e.addTrackedStat(La.UnsyncdMessage),e.addTrackedStat(La.OldUnsyncdMessage),e.addTrackedStat(La.MessagesSyncd),e.addTrackedStat(La.MessageDataCached),e._threadCache=e.registerLocalCache("GmailThreadCache",n.a.StorageType.IndexedDB,!0,{noInMemoryCache:!0}),e._rawCache=e.registerLocalCache("RawCache",n.a.StorageType.IndexedDB,!1,{noInMemoryCache:!0}),e.registerDeferredTaskType(xa.Snooze,e._handleDeferredSnoozeTask,e._cancelDeferredSnoozeTask,e._persistRemoteSnoozeTask),e.registerDeferredTaskType(xa.SendMail,e._handleDeferredSendMailTask,e._cancelDeferredSendMailTask,e._persistRemoteSendMailTask),e._contentSyncTask=e.registerLowImpactTask("ContentSync",e.driveMessageContentSync),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._cleanupLocalCaches),e._lastCacheCleanup=0,i.default.isDemoMode()?e.declareProperty("accountID",n.a.PluginLoad.Preview|n.a.PluginLoad.Full|n.a.PluginLoad.Inline,!0,"me"):e.declareProperty("accountID",n.a.PluginLoad.Preview|n.a.PluginLoad.Full|n.a.PluginLoad.Inline),e.declareProperty("from",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!1,void 0,e._fromComparator),e.declareProperty("to",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!1,void 0,e._toComparator),e.declareProperty("subject",n.a.PluginLoad.Preview|n.a.PluginLoad.Full),e.declareProperty("date",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,new Date(0),e._dateComparator),e.declareProperty("lastModifiedDate",n.a.PluginLoad.Full,!0,void 0,e._dateComparator),e.declareProperty("modifiedOffline",n.a.PluginLoad.Full,!0,!1),e.declareProperty("pendingSend",n.a.PluginLoad.Full,!0,!1),e.declareProperty("messages",n.a.PluginLoad.Full,!0,[],e._messagesComparator),e.declareProperty("snippet",n.a.PluginLoad.Full),e.declareProperty("participants",n.a.PluginLoad.Runtime,!0,[]),e.declareProperty("subjectLower",n.a.PluginLoad.Runtime),e.declareProperty("count",n.a.PluginLoad.Runtime),e.declareProperty("dataLoaded",n.a.PluginLoad.Runtime,!0,!1),e.declareProperty("isDeleted",n.a.PluginLoad.Runtime,!0,!1),e.declareProperty("labelIds",n.a.PluginLoad.Runtime,!0,[]),e.declareProperty("hasAttachments",n.a.PluginLoad.Full,!0,!1),e.useRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.EmailThread),e.useRenderer(n.a.PluginRenderTypes.UnstyledText,n.a.PluginRenderers.EmailThread),e.useRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.EmailThread),e}var a,r,s;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ma(e,t)}(t,ut),a=t,(r=[{key:"getType",value:function(){return n.a.PluginType.Email}},{key:"_attachMetadataFields",value:function(){return Mi}},{key:"getDataPane",value:function(){return i.default.Assert(!!this.getPaneIcon(),"Should have a pane icon specified"),ba}},{key:"getPaneIcon",value:function(){return"icon-mail_outline"}},{key:"getPanePriority",value:function(){return 97}},{key:"useItemStore",value:function(){return"Gmail"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,enabledFilters:n.a.ItemStoreFilter.Priority,parserFn:F.a.runParseSinglePlugin.bind(F.a)}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"ensureAccountEmail",value:function(e){return"me"===e?this.getDefaultAccount():e}},{key:"getDefaultAccount",value:function(){var e,t=i.default.getUserIdentifier();return t?(i.default.Assert(i.default.isDemoMode()||"me"!==t,'Should never return "me" as a valid user'),e=t):(i.default.Assert(!1,'Unable to get default account name, returning "me"'),e="me"),e}},{key:"isSameAccount",value:function(e,t){return"me"===e&&(e=this.getDefaultAccount()),"me"===t&&(t=this.getDefaultAccount()),e===t}},{key:"areItemsFromSameAccount",value:function(e,t){var a=this._getAccountIDFromItem(e),i=this._getAccountIDFromItem(t);return this.isSameAccount(a,i)}},{key:"_handleAccountChanges",value:function(){var e=this,t=0,a=[];xo.PaneManager.runForEachPane(function(t){var n=e._getAccountIDFromItem(t.getItem());i.default.Assert(n,"Missing Account ID: ",t.id,t.getItem().id),e.hasSyncAccount(n)||a.push(t)},this.getPaneType());for(var n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;xo.PaneManager.removePane(a[n])}0===a.length&&xo.PaneManager.notifyPanes()}},{key:"addSyncAccount",value:function(e,t){var a=this,r=this.getSetting(this.Settings.SyncAccounts).slice(0);i.default.Assert(r.indexOf(e)<0,"Must not double add sync accounts to list"),r.indexOf(e)<0&&r.push(e),this.setSetting(this.Settings.SyncAccounts,r),this.isActive()&&(this._ensureLabel(e,Ea.INBOX,"Inbox",void 0,void 0,n.a.ChangeType.Local),this._ensureLabel(e,Ea.UNREAD,"Unread",void 0,void 0,n.a.ChangeType.Local),this._ensureLabel(e,ni,"Archived",void 0,void 0,n.a.ChangeType.Local),this._ensureLabel(e,ri,"All Mail",void 0,void 0,n.a.ChangeType.Local),this._forceLabelSync(function(){a._forceThreadSync()})),t(!0),this._handleAccountChanges()}},{key:"removeSyncAccount",value:function(e,t){var a=this.getSetting(this.Settings.SyncAccounts).slice(0);if(i.default.Assert(a.indexOf(e)>=0,"Must be able to find sync account if removing"),a.remove(e),this.setSetting(this.Settings.SyncAccounts,a),this._clearCachedData(e,t),this.getDefaultItemStore()){var r=this.getVMLIForAccount(e);r&&(r.deleteSelf(n.a.ChangeType.Local),r.getItemStore().destroyItem(r.id))}this._handleAccountChanges()}},{key:"_iterateSendAs",value:function(e){for(var t=0,a=this.getSyncAccounts(),i=!1,n=0;!i&&n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.getAccountSetting(a[n],"sendAs");if(r)for(var o=0,s=0;s<r.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=r[s];if(e(a[n],l)){i=!0;break}}else e(a[n])}}},{key:"getSignature",value:function(e){var t;return this._iterateSendAs(function(a,i){if(i&&i.sendAsEmail===e)return t=i.signature,!0}),t}},{key:"getReplyToAddress",value:function(e){var t;return this._iterateSendAs(function(a,i){if(i&&i.sendAsEmail===e&&i.replyToAddress)return t=i.replyToAddress,!0}),t}},{key:"_computeDisplayName",value:function(e,t){var a;return!t.displayName&&t.isPrimary||(a=t.displayName),a}},{key:"getDisplayName",value:function(e){var t,a=this;return this._iterateSendAs(function(i,n){if(n&&n.sendAsEmail===e)return t=a._computeDisplayName(i,n),!0}),t}},{key:"getDefaultSendingAccount",value:function(e){var t;return this._iterateSendAs(function(a,i){if(a===e&&i&&i.isDefault)return t=i.sendAsEmail,!0}),t||(t=e),t}},{key:"getDefaultFromInfo",value:function(e){var t=this.getDefaultSendingAccount(e);return i.default.Assert(t,"Must have found a valid account to send from"),{text:this.getDisplayName(t),email:t}}},{key:"getSendingAccounts",value:function(e){var t=[];return this._iterateSendAs(function(a,i){e&&e!==a||(i?"pending"!==i.verificationStatus&&t.push(i.sendAsEmail):t.push(a))}),t}},{key:"getSyncAccount",value:function(e){var t;return this._iterateSendAs(function(a,i){if(i){if(i.sendAsEmail===e)return t=a,!0}else if(e===a)return t=a,!0}),t}},{key:"getSendingAccountInfo",value:function(e){var t,a=this;return this._iterateSendAs(function(i,n){if(n){if(n.sendAsEmail===e)return t={text:a._computeDisplayName(i,n),email:e},!0}else if(e===i)return!0}),t}},{key:"getSyncAccounts",value:function(){if(f.a.isMobile)return[this.getDefaultAccount()];for(var e=0,t=this.getSetting(this.Settings.SyncAccounts)||["me"],a=[],n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;"me"===t[n]?a.push(this.getDefaultAccount()):a.push(t[n].toLowerCase())}return i.default.Assert(i.default.isDemoMode()||a.indexOf("me")<0,'Must not contain "me" as an account'),i.default.arrayUniques(a)}},{key:"numSyncAccounts",value:function(){return this.getSyncAccounts().length}},{key:"hasSyncAccount",value:function(e){return this.getSyncAccounts().indexOf(e)>=0}},{key:"_getSettingsSendAs",value:function(e){for(var t=0,a=this.getSyncAccounts(),i=a.length,n=0,r={},o=function(t,a,o){t&&(r[a]=o.sendAs),++n===i&&e(r)},s=0;s<a.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._requestSettings(a[s],o)}}},{key:"_requestSettings",value:function(e,t){var a=this,i=Ve.a.fns("gmail").users.settings.sendAs.list.packedFn,n={userId:e};this._queueRemoteRequestMulti(e,i,n,function(a){t(!0,e,a)},function(i){t(!1,e,i),a._notifyFailedRequest(e,i)},void 0,$a)}},{key:"_fromComparator",value:function(e,t){var a=!1;return e||t?e&&t&&(i.default.Assert(!i.default.isString(e),"Old from must not be a string"),i.default.Assert(!i.default.isString(t),"New from must not be a string"),e.text===t.text&&e.email===t.email&&(a=!0)):a=!0,a}},{key:"_toComparator",value:function(e,t){var a=!1;return e||t?e&&t&&(i.default.Assert(i.default.isArray(e),"Old to must be an array"),i.default.Assert(i.default.isArray(t),"New to must be an array"),a=t.equals(e)):a=!0,a}},{key:"_dateComparator",value:function(e,t){var a=!1;return e||t?e&&t&&(i.default.isString(e)&&(e=this.parseDateHeader(e)),i.default.isString(t)&&(t=this.parseDateHeader(t)),i.default.Assert(i.default.isDateValid(e),"Must be an old valid date to compare"),i.default.Assert(i.default.isDateValid(t),"Must be a new valid date to compare"),i.default.isDateValid(e)&&i.default.isDateValid(t)&&(a=e.equals(t))):a=!0,a}},{key:"_messagesComparator",value:function(e,t){var a=!0;if(e&&t)if(e.length===t.length)for(var i=0,n=0;a&&n<t.length;++n){var r=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o=e[n],s=t[n],l=0;l<si.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=si[l],d=!0;switch(u){case"from":d=this._fromComparator(o[u],s[u]);break;case"to":d=this._toComparator(o[u],s[u]);break;case"resources":case"listUnsubscribe":d=this._shallowObjComparator(o[u],s[u]);break;case"labelIds":d=s[u].equals(o[u]);break;case"date":case"internalDate":d=this._dateComparator(o[u],s[u]);break;default:d=o[u]===s[u]}d||(a=!1)}0}else a=!1;else a=!1;return a}},{key:"_shallowObjComparator",value:function(e,t){var a=!1;if(e||t){if(e&&t)if(e===t)a=!0;else for(var i in a=!0,e)if(!t.hasOwnProperty(i)){a=!1;break}}else a=!0;return a}},{key:"_offlineLoad",value:function(){var e=this;return yt.a.onActiveUser(function(){e._threadCache.onCacheReady(function(){e._threadCache.onCacheMetadataReady(function(){i.default.isDemoMode()||e._threadCache.getMetadata(ai,function(t){if(t)for(var a in t)t.hasOwnProperty(a)&&e.setAccountSetting(a,"sendAs",t[a])}),e._threadCache.getMetadata(ti,function(t){i.default.batchRenderUpdates(function(){var a=0,r=e.getSyncAccounts();!i.default.isDemoMode()&&t||(t={}),t.me&&!t[e.getDefaultAccount()]&&(t[e.getDefaultAccount()]=t.me),xo.PaneUpdateBatcher.beginUpdateItems();for(var o=0;o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=r[o];e._ensureLabel(s,Ea.INBOX,"Inbox",void 0,void 0,n.a.ChangeType.Local),e._ensureLabel(s,Ea.UNREAD,"Unread",void 0,void 0,n.a.ChangeType.Local),e._ensureLabel(s,ni,"Archived",void 0,void 0,n.a.ChangeType.Local),e._ensureLabel(s,ri,"All Mail",void 0,void 0,n.a.ChangeType.Local);var l=t[s];if(l){for(var u in l)if(l.hasOwnProperty(u)){var d=l[u];if(!Ea[d.id]){var c=d.name||"LocalLabel"+Date.now();e._ensureLabel(s,u,c,d.oldestSync,d,n.a.ChangeType.Local)}}for(var h in Ea)if(Ea.hasOwnProperty(h)){var f=ii[h];e._ensureLabel(s,h,f,void 0,void 0,n.a.ChangeType.Local)}}e._ensureLabelVMLIsForAccount(s)}var p=e._getMetadataSyncTime(),g=e._getUnreadSyncTime(),m=function(e){return r.indexOf(e.accountID)>=0&&e.date.isAfter(g)},v=function(t,a,n){if(t&&t.length>0){var r=function(){var n=0;xo.PaneUpdateBatcher.beginUpdateItems();for(var r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t[r];if(i.default.Assert(o,"Must always contain a valid entry when retreiving data from preload"),o&&(!a||m(o))){var s=e.createEntryFromLocal(o.id,o);(e.isPriorityData(s)||o.date.isAfter(p))&&(e.cacheData(s.id,s),e._updateSpecialLabels(s))}}xo.PaneUpdateBatcher.commitUpdateItems()};n?r():i.default.batchRenderUpdates(r)}};e._threadCache.requestPreloadData(function(t){i.default.isArray(t)?v(t,!0,!0):e._threadCache.getFilterEntries(m,v)}),xo.PaneUpdateBatcher.commitUpdateItems(),e.notifyPanesReadyForLoad()})})})})}),!0}},{key:"isPriorityData",value:function(e){var t=!1;return e.labelIds.indexOf(Ea.UNREAD)>=0?t=!0:e.labelIds.indexOf(oi.PRI0)>=0?t=!0:e.labelIds.indexOf(oi.PRI1)>=0?t=!0:e.labelIds.indexOf(oi.PRI2)>=0&&(t=!0),t}},{key:"_load",value:function(){i.default.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:i.default.minutes(15),minDelay:i.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runThreadSync.bind(this)}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:i.default.minutes(30),minDelay:i.default.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync.bind(this)})}},{key:"_notifyFailedRequest",value:function(e,t){if(i.default.Assert(i.default.isString(e),"Must supply a valid accountID string"),t&&t.error)if(t.error.code===n.a.HTTPStatusCode.Unauthorized)xo.pluginManager.verifyAuthorization(e);else if(t.error.code===n.a.HTTPStatusCode.BadRequest)for(var a=0,r=t.error.errors,o=0;o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r[o].reason===n.a.GoogleError.FailedPrecondition&&(xo.toasts.pushMessage(n.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else if(t.error.code===n.a.HTTPStatusCode.Forbidden)for(var s=0,l=t.error.errors,u=0;u<l.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;l[u].reason===n.a.GoogleError.InsufficientPermissions&&(xo.toasts.pushMessage(n.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else t.error.code>=400&&t.error.code<500&&this._reportErrorCode(t.error.code)&&i.default.reportError(new Error("Failed Gmail request: "+t.error.code),t)}},{key:"_reportErrorCode",value:function(e){var t=!1;return e!==n.a.HTTPStatusCode.NotFound&&(t=!0),t}},{key:"_notifySendFailed",value:function(){xo.toasts.pushMessage(n.a.MessageID.EmailSendFail)}},{key:"_createResourceCID",value:function(e,t){var a=0;t||(t="UnnamedFile");for(var n=t,r=1;e.has(n);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t.split(".");if(n=o[0]+"_"+r,o[1]&&(n+="."+o[1]),r++,i.default.checkLoopLength(r))break}return n}},{key:"_createResource",value:function(e,t){return i.default.Assert(e,"Must have valid resources lib to add to"),{cid:this._createResourceCID(e,t.name),id:i.default.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:Ii,parentType:ci,mimeType:t.type,contentEncoding:void 0}}},{key:"_getLinkedResourceString",value:function(e){return'<a cid="'+e.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+e.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+e.cid+"</a>"}},{key:"_removeAttachContent",value:function(e,t,a){var i,n=sa.a.removeElementsByAttribute(t.decoded,"cid",a.cid);return i=n!==t.decoded,t.decoded=n,i}},{key:"notifyAttachLinkedFile",value:function(e,t,a,i){var r={name:a.getField("title"),type:a.getField("mimeType")},o=this._createResource(t.resources,r);o.size=a.getField("fileSize"),o.link=a.getField("alternateLink"),this._shareAttachment(e,a.id,o,i),t.resources.add(o),e.notifyDataMutated(["hasAttachments"],n.a.ChangeType.Local)}},{key:"notifyAttachFiles",value:function(e,t,a,i){for(var r=0,o=this,s=e.getField("accountID"),l=0;l<a.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=a[l],d=this._createResource(t.resources,u);d.size=u.size,d.uploader=new Ia.a(u,s,n.a.DriveFolder.Attach,void 0,function(){e.notifyDataMutated(["hasAttachments"],n.a.ChangeType.Local)},function(t,a){t.error=!1,t.link=a.alternateLink,t.thumbnail=a.thumbnailLink,o._shareAttachment(e,a.id,t,i)}.bind(this,d),function(t){t.error=!0,xo.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:function(){t.uploader.resume()}}),e.notifyDataMutated(["hasAttachments"],n.a.ChangeType.Local),i&&i(!1)}.bind(this,d)),d.uploader.upload(),t.resources.add(d)}e.notifyDataMutated(["messages"],n.a.ChangeType.Local)}},{key:"_shareAttachment",value:function(e,t,a,r){var o=this;i.default.Assert(t,"Must supply a valid fileID to share"),i.default.Assert(a,"Must supply a valid resource object to share"),i.default.vmMain.remoteAPI().drivePermissionsPublic(t,function(){a.error=!1,e.notifyDataMutated(["messages"],n.a.ChangeType.Local),r&&r(!0)},function(s){a.error=!0,i.default.isHTTPStatusCode(s,n.a.HTTPStatusCode.Forbidden)?xo.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):xo.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:function(){o._shareAttachment(e,t,a,r)}}),e.notifyDataMutated(["hasAttachments"],n.a.ChangeType.Local),r&&r(!1)})}},{key:"removeAttachFiles",value:function(e,t,a){i.default.Assert(a,"Must always specify a valid resource to remove from the message");var r=!1;return a.uploader&&!a.uploader.isDone()&&(a.uploader.cancel(),r=!0),t.resources.has(a.cid)&&t.resources.remove(a),r=this._removeAttachContent(e,t,a)||r,e.notifyDataMutated(["messages"],n.a.ChangeType.Local),r}},{key:"notifyItemPropertyChanged",value:function(e,t,a,i){var n=this.attachmentIsArchived(e);t.belongsToItemStore(this.getDefaultItemStore())&&(t.dateCompleted&&!n&&this.archiveAttachment(e));"priority"===i?this.getAttachmentPriority(e)!==t.priority()&&this.setAttachmentPriority(e,t.priority()):"isArchived"===i&&(n&&!t.isArchived()?this.unarchiveAttachment(e):!n&&t.isArchived()&&(this.archiveAttachment(e),xo.EmailPreview.isOpenOnThread(e)&&xo.EmailPreview.reset()))}},{key:"createLabelString",value:function(e){if(!ii[e.toUpperCase()])return e}},{key:"isDisplayTag",value:function(e,t){var a=!1;if(e&&e.shouldDisplayInMessageList()){var i=e.isCustom()||e.getLabelID()===Ea.DRAFT,n=t&&!t.isInbox()&&e.isInbox();if(i||n)switch(a=!0,e.getName()){case oi.PRI0:case oi.PRI1:case oi.PRI2:case"Moo.do/Handled":case ii.STARRED:a=!1}}return a}},{key:"isDisplayHeader",value:function(e){var t=!1;this.isLabelItem(e)&&(this._getLabelIDFromItem(e)!==Ea.UNREAD&&(t=!0));return t}},{key:"isMessageDraft",value:function(e){return e&&e.labelIds&&e.labelIds.indexOf(Ea.DRAFT)>=0}},{key:"getDisplayTags",value:function(e,t,a){var i,n=0,r=e.getField("labelIds"),o=e.getField("accountID"),s=[];t&&(i=t.getItemLabel(!0));for(var l=0;l<r.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=this._getLabelByID(o,r[l]);if(this.isDisplayTag(u,i)){var d=a?u.getOutlineText():u.getDisplayText();d&&s.push(d)}}return s}},{key:"_getParticipantDisplayName",value:function(e,t){var a;if(this.isMyAccountID(e.email))a="me";else if(e.text)if(1===t)a=e.text;else{var i=e.text.split(" ");a=i&&i.length>0?i[0]:e.email}else a=e.email;return a}},{key:"getDisplayParticipants",value:function(e){for(var t=0,a=e.getField("participants"),i=[],n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i.push(this._getParticipantDisplayName(a[n],a.length))}return i.join(", ")}},{key:"getDefaultDisplayItem",value:function(e){e=e||this.getDefaultAccount();var t=this._getLabelByID(e,Ea.INBOX);return this.getVMLIForLabel(e,t)}},{key:"getEmailRootItem",value:function(){return ee.getItems(n.a.FavoriteGroup.EmailRoot)[0]}},{key:"hasEmailRootItem",value:function(){return ee.hasItems(n.a.FavoriteGroup.EmailRoot)}},{key:"createEmailRootItem",value:function(){i.default.Assert(!this.hasEmailRootItem(),"Should not create email root if it already exists");var e=xo.itemStoreManager.getDefaultItemStore().getRoot(),t=I.a.createVMLI({text:"Email",favorites:[n.a.FavoriteGroup.EmailRoot]},{parent:e,changeType:n.a.ChangeType.AllLocal});return e.insertItem(t,0),xo.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:n.a.MessageAction.Okay,hold:!0}),t}},{key:"ensureEmailItem",value:function(e){var t=0;A.e.beginAction(),this.hasEmailRootItem()||this.createEmailRootItem();for(var a,i=this.getEmailRootItem(),r=i.getItems(),o=0;o<r.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(r[o].getRawText()===e){a=r[o];break}}return a||(a=I.a.createVMLI({text:e},{parent:i,changeType:n.a.ChangeType.AllLocal}),i.insertItem(a,0)),A.e.endAction(),a}},{key:"getWaitingItem",value:function(e){e(this.ensureEmailItem("Waiting"))}},{key:"allowTextEditing",value:function(e){var t=!0,a=this.getDefaultItemStore();return e.belongsToItemStore(a)&&(t=!1),t}},{key:"getDraftForMessage",value:function(e,t,a,n){var r;i.default.Assert(t,"Must have a valid thread ID"),i.default.Assert(a,"Must have a valid message ID");var o=this.getAttachment(t),s=o.getField("messages").indexOfWithProperty("id",a);i.default.Assert(s>=0,"Must be able to find the requested message");var l=o.getField("messages")[s+1];return l&&l.labelIds.indexOf(Ea.DRAFT)>=0?r=l:(this.createDraft(e,t,a,{from:n}),r=o.getField("messages")[s+1]),i.default.Assert(r.labelIds.indexOf(Ea.DRAFT)>=0,"Must return a valid draft"),r}},{key:"getDraftByID",value:function(e,t,a,n){var r,o;if(t)r=this.getAttachment(t),o=a?this._getMessageFromAttachment(r,a):r.getField("messages")[0],i.default.Assert(o.labelIds.indexOf(Ea.DRAFT)>=0,"Must be a valid draft");else{var s=this.createDraft(e,void 0,void 0,n);o=(r=this.getAttachment(s.threadID)).getField("messages")[0]}return{attach:r,draftMsg:o}}},{key:"_notifyDraftMessage",value:function(e,t,a){var n=this;i.default.Assert(e,"Must supply a valid accountID"),i.default.Assert(t&&!i.default.isTempId(t),"Must supply a valid threadID: ",t),i.default.Assert(a&&!i.default.isTempId(a),"Must supply a valid messageID: ",a),setTimeout(function(){n.hasCacheData(t)&&n._getRemoteDraftID(e,t,a,function(e,a){a&&(i.default.log("DraftID: ",e),n.cacheData(t,n.getCacheData(t),!0,["messages"]))})},0)}},{key:"_notifyLocalDraftDelete",value:function(e,t,a){}},{key:"_getInlineResources",value:function(e){var t=new ha;return e.resources.forEachResource(function(e){e.disposition===Si&&t.add(i.default.clone(e))}),t}},{key:"createDraft",value:function(e,t,a,r){r=r||{},i.default.Assert(!r.body||!r.decoded,"Must not supply both a decoded field and a body"),this.sendEvent("CreateDraft");var o=i.default.generateTempId(),s=r.from||this.getDefaultFromInfo(e),l=r.body||r.decoded||"";""===l&&(l=this.createSignature(s.email));var u,d,c={id:o,modifiedOffline:!0,labelIds:[Ea.DRAFT],messageID:void 0,raw:"",decoded:l,mimeType:bi,contentType:"text/html;charset=utf-8",from:s,replyTo:this.getReplyToAddress(s.email),to:r.to||[],cc:r.cc||[],bcc:r.bcc||[],snippet:"",subject:r.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:new ha};if(t){u=this.getCacheData(t),i.default.Assert(a,"When supplying a thread ID, must also supply a valid message ID");var h=u.messages.indexOfWithProperty("id",a);i.default.Assert(h>=0,"If requesting a reply to a message, it must exist in the thread");var f=u.messages[h];if(f&&(c.references=(i.default.isTempId(f.messageID)?"":f.messageID)+(f.references?" "+f.references:""),i.default.isTempId(f.messageID)||(c.inReplyTo=f.messageID),c.resources=this._getInlineResources(f)),u.messages.splice(h+1,0,c),this.hasAttachment(t)){var p=this.getAttachment(t);this._updateAttachmentFromMessages(p,n.a.ChangeType.Local),p.notifyDataMutated(["messages"],n.a.ChangeType.Local)}this.addModifiedOffline(u,["messages"]),d=u}else u={id:o,accountID:e,modifiedOffline:!0,messages:[c],labelIds:[Ea.DRAFT],subject:r.subject||"",from:e},d=this.createEntryFromLocal(o,u),this.cacheData(d.id,d);return this.cacheThreadData(d.id,this.serializeExternalData(d)),{threadID:d.id,draftID:o,messageID:a}}},{key:"_updateDraftID",value:function(e,t,a){i.default.Assert(a,"Must provide a valid set of draft info"),i.default.Assert(a.id&&a.message,"Draft info must contain valid data");var r=e.isLocalOnlyAttachment();r&&(this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.message.threadId),this._threadCache.removeEntry(t));var o=this._findDraft(e,t,a.id);o&&(o.id=a.message.id,i.default.Assert(o.draftID===a.id,"Should have valid draft ID associated with the message"),this._draftCache[o.id]=a.id,r&&this.cacheData(e.id,e.getData()),this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[o.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[o.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],n.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData())))}},{key:"_updateDraftFromSend",value:function(e,t,a){i.default.Assert(a,"Must provide a valid set of draft info"),i.default.Assert(a.id&&a.threadId,"Draft info must contain valid data"),e.isLocalOnlyAttachment()&&(this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.threadId),i.default.Assert(!i.default.isTempId(e.id),"After an ID change, should never be a temp ID"),this._threadCache.removeEntry(t));var r=this._getMessageFromAttachment(e,t);r.id=a.id,r.labelIds=a.labelIds||[],this._updateAttachmentFromMessages(e,n.a.ChangeType.Remote),this._draftCache[r.id]=a.id,this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[r.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[r.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],n.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}},{key:"_createRemoteDraft",value:function(e,t,a){var n=this;if(this._creatingDrafts[t])a(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[t]=!0;var r=this._getMessageFromAttachment(e,t);if(r)this._createRFC822Message(e.getData(),r,!1,function(i){var o={raw:i};e.isLocalOnlyAttachment()||(o.threadId=e.id);var s=Ve.a.fns("gmail").users.drafts.create.packedFn,l={userId:e.getField("accountID"),resource:{message:o}};n._queueRemoteRequestMulti(e.getField("accountID"),s,l,function(i){n._attachmentHasMessage(e,t)&&(delete n._creatingDrafts[t],r.draftID=i.id,n.removeModifiedOffline(e.getData(),!1),n.removeModifiedOffline(r,!1),n._pendingDraftUpdates[t]&&n._notifyPendingDraftUpdate(),n._updateDraftID(e,t,i),n._updateIsSavingDrafts()),a(!0)},function(i){delete n._creatingDrafts[t],n._updateIsSavingDrafts(),a(!1,i),n._notifyFailedRequest(e.getField("accountID"),i)},void 0,Ga)});else{try{var o={length:e.getField("messages").length};i.default.reportError(new Error("Unable to find valid draft for creation"),o)}catch(s){i.default.reportError(s)}a(!1,{msg:"Unable to find requested message in thread"})}}}},{key:"_updateIsSavingDrafts",value:function(){i.default.isSavingDrafts=this._activeDraftUpdates>0||!i.default.isEmpty(this._pendingDraftUpdates)||!i.default.isEmpty(this._creatingDrafts)}},{key:"_notifyPendingDraftUpdate",value:function(e,t,a,i){e&&t&&(this._pendingDraftUpdates[t]={attach:e,draftID:a,lastUpdate:Date.now()},i&&this._runDraftUpdate(t)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()}},{key:"_flushPendingDraftUpdates",value:function(){if(this.isOnline()){for(var e in this._pendingDraftUpdates)this._pendingDraftUpdates.hasOwnProperty(e)&&this._runDraftUpdate(e);this._draftFlushTimer=void 0}}},{key:"_runDraftUpdate",value:function(e){var t=this;if(!this._creatingDrafts[e]){var a=this._pendingDraftUpdates[e];i.default.Assert(a,"Must be able to find valid draft info for pending draft update"),this._updateRemoteDraft(a.attach,e,a.draftID,!1,function(e,a){e?xo.toasts.clearMessage(n.a.MessageID.EmailUpdateFail):i.default.isHTTPStatusCode(a,n.a.HTTPStatusCode.NotFound)?xo.toasts.clearMessage(n.a.MessageID.EmailUpdateFail):xo.toasts.pushMessage(n.a.MessageID.EmailUpdateFail),t._updateIsSavingDrafts()}),delete this._pendingDraftUpdates[e],this.sendEvent("UpdateDraft")}}},{key:"_clearPendingDraftUpdate",value:function(e,t){var a=this._pendingDraftUpdates[t];a&&(i.default.Assert(a.attach===e,"Must have the correct attachment for the draft update"),delete this._pendingDraftUpdates[t])}},{key:"hasPendingSends",value:function(){return this._pendingSends.length>0}},{key:"notifyPendingSend",value:function(e,t){i.default.Assert(!this._pendingSends[t],"Must not have an already pending send for a message"),this._pendingSends[t]=e,i.default.isSendingEmail=!0}},{key:"notifySent",value:function(e,t){i.default.Assert(this._pendingSends[t],"Must have a pending send to be sent"),delete this._pendingSends[t],this.hasPendingSends()||(i.default.isSendingEmail=!1)}},{key:"notifySendError",value:function(e,t){i.default.Assert(this._pendingSends[t],"Must have a pending send to have an error"),delete this._pendingSends[t],this.hasPendingSends()||(i.default.isSendingEmail=!1)}},{key:"onShutdown",value:function(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()}},{key:"_getLinkedResources",value:function(e){var t=[];return e.forEachResource(function(e){"attachment"===e.disposition&&e.link&&t.push(e)}),t}},{key:"_createDraftBody",value:function(e,t){var a;if(t){var i=this._getLinkedResources(t);if(i.length>0){for(var n=0,r="<br/><br/>",o=0;o<i.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r+=this._getLinkedResourceString(i[o])}a=e+'<var id="moodoAttach" moodoAttach="true">'+r+"</var>"}else a=e}else a=e;return a}},{key:"updateDraft",value:function(e,t,a,r,o,s,l,u){i.default.Assert(i.default.isBoolean(s),"Must supply a valid bool for updateRemoteDraft"),i.default.Assert(i.default.isBoolean(l),"Must supply a valid bool for forceFlush"),i.default.Assert(i.default.isFunction(u),"Must supply a valid bool for cb");var d=this._findDraft(e,t,a);return d?(d.to=r.to,d.from=r.from||d.from,d.cc=r.cc,d.bcc=r.bcc,d.subject=r.subject,d.decoded=this._createDraftBody(r.body||r.decoded,d.resources),d.snippet=o?i.default.escape(o.substring(0,30)):"",r.hasOwnProperty("resources")&&(i.default.Assert(d.resources instanceof ha,"Resources must always be a valid resource lib"),d.resources=r.resources),this._updateAttachmentFromMessages(e,n.a.ChangeType.Local),e.notifyDataMutated(["messages"],n.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(this.getCacheData(e.id))),!this._creatingDrafts[d.id]&&s?i.default.isTempId(d.id)?this._createRemoteDraft(e,d.id,function(e,t){e||xo.toasts.pushMessage(n.a.MessageID.EmailUpdateFail),u(e,t)}):(this._notifyPendingDraftUpdate(e,d.id,d.draftID,l),u(!0)):(s&&this._notifyPendingDraftUpdate(e,d.id,d.draftID,l),u(!0)),this._updateIsSavingDrafts()):(i.default.Assert(!1,"Unable to update draft as expected from compose window"),u(!1)),{threadID:e.id,draftID:d.draftID,messageID:d.id}}},{key:"_updateRemoteDraft",value:function(e,t,a,n,r){var o=this;i.default.Assert(t&&a,"Must specify both a valid messageID and draftID"+t+"."+a);var s=this._findDraft(e,t,a);i.default.Assert(s&&s.labelIds.indexOf(Ea.DRAFT)>=0,"Must be updating a valid draft"+!!s),i.default.Assert(!this._creatingDrafts[s.id],"Should not send a remote update while the original draft is being created"),this._activeDraftUpdates++,this._getRemoteDraftID(e.getField("accountID"),e.id,s.id,function(t){t?o._createRFC822Message(e.getData(),s,n,function(a){var i=Ve.a.fns("gmail").users.drafts.update.packedFn,n={userId:e.getField("accountID"),id:t,resource:{message:{raw:a,threadId:e.id}}};o._queueRemoteRequestMulti(e.getField("accountID"),i,n,function(t){o._updateDraftID(e,s.id,t),o._activeDraftUpdates--,r(t)},function(t){r(void 0,t),o._activeDraftUpdates--,o._notifyFailedRequest(e.getField("accountID"),t)},void 0,Ka)}):(i.default.Assert(!1,"Must always be able to get a valid draft ID when updating"),r(!1))})}},{key:"sendDraft",value:function(e,t,a,r,o){var s=this;i.default.Assert(!e.getField("pendingSend"),"Should not try to re-send a message after it has already been sent");var l=!0,u=this._findDraft(e,t,a),d=function(t,a){t?(e.updateField("pendingSend",!1),s.removeModifiedOffline(e.getData(),!1),s.removeModifiedOffline(u,!1),s.notifySent(e,u.id)):(i.default.isHTTPStatusCode(a,n.a.HTTPStatusCode.Network)||e.updateField("pendingSend",!1),s.notifySendError(e,u.id)),o(t,a)},c=this._verifyEmailRecipients(e,u.id,u.draftID);if(c||(c=this._verifyEmailAttachments(e,u.id,u.draftID)),c){l=!1;var h=xo.toasts.pushMessage({text:c.message,action:n.a.MessageAction.Okay});c.handleMessageFn&&c.handleMessageFn(h),this.notifyPendingSend(e,u.id),d(!1)}else if(!r){e.updateField("pendingSend",!0),this.notifyPendingSend(e,u.id);var f=!1;this.onEmailReadyToSend(u,function(){i.default.Assert(!f,"Should not send an email twice"),f||(f=!0,e.isLocalOnlyAttachment()||i.default.isTempId(u.id)?s._sendEmail(e,u.id,u.draftID,d):s._sendRemoteDraft(e,u.id,d))})}return l}},{key:"onEmailReadyToSend",value:function(e,t){var a=this,n=!0;e.resources.forEachResource(function(r){r.uploader&&!r.uploader.isDone()&&(n=!1,r.uploader.hasError()?i.default.Assert(!1,"Attachment has error when sending."):r.uploader.notifyOnComplete(a.onEmailReadyToSend.bind(a,e,t)))}),n&&setTimeout(t,0)}},{key:"_sendRemoteDraft",value:function(e,t,a){var r=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(o){o?r._updateRemoteDraft(e,t,o,!0,function(t){if(t&&t.message){var i=Ve.a.fns("gmail").users.drafts.send.packedFn,s={userId:e.getField("accountID"),resource:{id:o}};r._queueRemoteRequestMulti(e.getField("accountID"),i,s,function(i){r._updateLocalDraftFromSend(e,t.message.id,i,a)},function(t){r._notifySendFailed(),a(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)},void 0,Xa)}else xo.toasts.pushMessage(n.a.MessageID.EmailUpdateFail),a(!1)}):(i.default.Assert(!1,"Must always be able to get a valid draft ID when sending"),xo.toasts.pushMessage(n.a.MessageID.EmailUpdateFail),a(!1))})}},{key:"_updateLocalDraftFromSend",value:function(e,t,a,n){i.default.Assert(a,"Must have a valid draft result");var r=this._getMessageFromAttachment(e,t);i.default.Assert(r,"Must always be able to find the sent message"),r&&(this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(r,!1),this._updateDraftFromSend(e,t,a)),i.default.isDemoMode()||this._requestRemoteMessageData(e,a.id,function(e){i.default.Assert(e,"Should always be able to update message data after send")}),n(!0)}},{key:"runDiscardDraft",value:function(e){var t=this._getDraftFromAttachment(e);this.discardDraft(e,t.id,t.draftID,function(e){i.default.Assert(e,"Must be able to discard message draft")})}},{key:"discardDraft",value:function(e,t,a,r){var o=e.getData(),s=this._findDraft(e,t,a),l=o.messages.indexOf(s);i.default.isTempId(t)?r(!0):this._deleteRemoteDraft(e,t,r);var u=o.messages[l];o.messages.splice(l,1),this._removeRemoteResources(u),this._updateAttachmentFromMessages(e,n.a.ChangeType.Local),this._clearPendingDraftUpdate(e,t),e.notifyDataMutated(["messages"],n.a.ChangeType.Local),this.cacheThreadData(o.id,this.serializeExternalData(o)),this.sendEvent("DiscardDraft")}},{key:"_removeRemoteResources",value:function(e){e&&e.resources.forEachResource(function(e){e.uploader&&!e.uploader.isDone()&&e.uploader.cancel()})}},{key:"_deleteRemoteDraft",value:function(e,t,a){var r=this;i.default.Assert(!i.default.isTempId(t),"Should not try to remotely delete a local message"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(t){if(t){var o=Ve.a.fns("gmail").users.drafts.delete.packedFn,s={userId:e.getField("accountID"),id:t};r._queueRemoteRequestMulti(e.getField("accountID"),o,s,function(){a(!0)},function(t){i.default.isHTTPStatusCode(t,n.a.HTTPStatusCode.NotFound)?a(!0):a(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)},void 0,Ya)}else i.default.Assert(!1,"Must always be able to get a valid draft ID when deleting"),xo.toasts.pushMessage(n.a.MessageID.EmailUpdateFail),a(!1)})}},{key:"_getRemoteDraftIDRaw",value:function(e,t,a,i){var n=Ve.a.fns("gmail").users.drafts.list.packedFn,r={userId:e,q:"rfc822msgid:"+t};this._queuePagedRemoteRequestMulti(e,n,r,a,i,void 0,Qa,{getAllPages:!0,resultsField:"drafts"})}},{key:"_getRemoteDraftID",value:function(e,t,a,r){var o=this;i.default.Assert(i.default.isString(e),"Must provide a valid accountID"),i.default.Assert(i.default.isString(t)&&!i.default.isTempId(t),"Should not try to remotely get the draft ID of a local thread: ",t),i.default.Assert(i.default.isString(a)&&!i.default.isTempId(a),"Should not try to remotely get the draft ID of a local draft: ",a);var s=this.getAttachment(t);if(i.default.Assert(s,"Must be able to find a valid attachment for the requested thread"),!s)return setTimeout(r,0,void 0,!1);var l=this._getMessageFromAttachment(s,a);if(i.default.Assert(l,"Must be able to find a valid message for the requested draft"),!l)return setTimeout(r,0,void 0,!1);if(l.draftID)setTimeout(r,0,l.draftID,!1);else{if(i.default.Assert(l.messageID&&!i.default.isTempId(l.messageID),"Must have a valid messageID for the draft being queried"),!l.messageID||i.default.isTempId(l.messageID))return setTimeout(r,0,void 0,!1);this._getRemoteDraftIDRaw(e,l.messageID,function(u){if(i.default.Assert(u&&u.length<=1,"Must find only a single draft ID for a given message: ",u.length,l.messageID),u){for(var d=0,c=0;c<u.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h=u[c];1!==u.length&&h.message.threadId!==t||(i.default.Assert(!l.draftID||l.draftID===h.id,"Draft ID must either match or not be known yet"),l.draftID=h.id)}i.default.Assert(0===u.length||l.draftID,"Draft returned but IDs dont match: ",u[0]?u[0].message.threadId:"NO RESULT",t,u[0]?u[0].message.id:"NO RESULT",a)}return l.draftID?r(l.draftID,!0):l.contentType&&l.mimeType&&l.decoded?void o._createRemoteDraft(s,l.id,function(a,s){return a?r(l.draftID,!0):(i.default.isHTTPStatusCode(s,n.a.HTTPStatusCode.NotFound)&&o._deleteCachedThread(e,t),r(void 0,!1))}):(o._notifyLocalDraftDelete(e,t,a),r(void 0,!1))},function(t){return o._notifyFailedRequest(e,t),r(void 0,!1)})}}},{key:"_attachmentHasMessage",value:function(e,t){return e.getField("messages").indexOfWithProperty("id",t)>=0}},{key:"_getMessageFromAttachment",value:function(e,t){var a=e.getField("messages"),n=a.indexOfWithProperty("id",t);return i.default.Assert(n>=0,"Must have a vald draft"),a[n]}},{key:"_getDraftFromAttachment",value:function(e,t){for(var a,i=0,n=e.getField("messages"),r=0;r<n.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n[r].labelIds.indexOf(Ea.DRAFT)>=0){t&&t!==n[r].draftID||(a=n[r]);break}}return a}},{key:"_findDraft",value:function(e,t,a){var n,r=e.getField("messages"),o=r.indexOfWithProperty("id",t);if(o>=0)n=r[o];else if(a){var s=r.indexOfWithProperty("draftID",a);s>=0&&(n=r[s])}return i.default.Assert(n,"Must be able to find a valid draft for given messageID/draftID"),n}},{key:"isAttachmentDraftOnly",value:function(e){return this.attachmentHasLabel(e,ii.DRAFT)&&1===e.getField("messages").length}},{key:"archiveAttachment",value:function(e){return i.default.Assert(!this.attachmentIsArchived(e),"Should not archive a thread that is already archived"),this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(e,ii.INBOX)}},{key:"unarchiveAttachment",value:function(e){return i.default.Assert(this.attachmentIsArchived(e),"Thread must be unarchived to archive it"),this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(e,ii.INBOX)}},{key:"trashAttachment",value:function(e){return this.sendEvent("TrashMail"),this.trashMail(e.getField("accountID"),e.id,void 0,function(e){i.default.Assert(e,"Must have successfully trashed remote thread")})}},{key:"untrashAttachment",value:function(e){return this.sendEvent("UntrashMail"),this.untrashMail(e.getField("accountID"),e.id,void 0,function(e){i.default.Assert(e,"Must have successfully untrashed remote thread")})}},{key:"markAttachmentRead",value:function(e){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(e,ii.UNREAD)}},{key:"markAttachmentUnread",value:function(e){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(e,ii.UNREAD)}},{key:"snoozeAttachment",value:function(e,t){}},{key:"unsnoozeAttachment",value:function(e){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(e,"Moo.do/Snoozed"),this.addLabelToAttachment(e,ii.INBOX),this.addLabelToAttachment(e,ii.UNREAD),this.cancelDeferredTask(e.id,xa.Snooze)}},{key:"_handleDeferredSnoozeTask",value:function(e){}},{key:"scheduleSendMessage",value:function(e,t,a){}},{key:"cancelSendMessage",value:function(e,t){var a=this;this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(e,"Moo.do/ScheduledSend"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(e){e&&a.cancelDeferredTask(e,xa.SendMail)})}},{key:"_handleDeferredSendMailTask",value:function(e){var t=e.getData();i.default.Assert(t.gidLinked,"Must have valid gidLinked"),i.default.Assert(t.threadID,"Must have a valid threadID"),i.default.log("Handling deferred send mail: ",t)}},{key:"_ensureNoPriority",value:function(e){var t=n.a.VMLIFlag.None;return this.attachmentHasLabel(e,oi.PRI0)&&(this.removeLabelFromAttachment(e,oi.PRI0),t=n.a.VMLIFlag.P0),this.attachmentHasLabel(e,oi.PRI1)&&(this.removeLabelFromAttachment(e,oi.PRI1),t=n.a.VMLIFlag.P1),this.attachmentHasLabel(e,oi.PRI2)&&(this.removeLabelFromAttachment(e,oi.PRI2),t=n.a.VMLIFlag.P2),t}},{key:"getAttachmentPriority",value:function(e){return this._attachmentHasPriorityLabel(e,n.a.VMLIFlag.P0)&&n.a.VMLIFlag.P0||this._attachmentHasPriorityLabel(e,n.a.VMLIFlag.P1)&&n.a.VMLIFlag.P1||this._attachmentHasPriorityLabel(e,n.a.VMLIFlag.P2)&&n.a.VMLIFlag.P2||n.a.VMLIFlag.None}},{key:"setAttachmentPriority",value:function(e,t){this.sendEvent("SetMailPriority");var a=this._ensureNoPriority(e);switch(t){case n.a.VMLIFlag.None:break;case n.a.VMLIFlag.P0:this.addLabelToAttachment(e,oi.PRI0);break;case n.a.VMLIFlag.P1:this.addLabelToAttachment(e,oi.PRI1);break;case n.a.VMLIFlag.P2:this.addLabelToAttachment(e,oi.PRI2);break;default:i.default.Assert(!1,"Invalid priority for email attachment")}return a}},{key:"markAttachmentStarred",value:function(e){return this.sendEvent("StarMail"),this.addLabelToAttachment(e,ii.STARRED)}},{key:"markAttachmentUnstarred",value:function(e){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(e,ii.STARRED)}},{key:"attachmentHasLabelByID",value:function(e,t){return this.hasLabelByID(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasLabel",value:function(e,t){return this.hasLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasFullLabel",value:function(e,t){return this.hasFullLabel(e.getField("accountID"),e.id,t)}},{key:"attachmentIsArchived",value:function(e){return this._threadIsArchived(e.getData())}},{key:"addLabelToAttachment",value:function(e,t){return this.addLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"removeLabelFromAttachment",value:function(e,t){return this.removeLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"trashMail",value:function(e,t,a,r){var o=this.getAttachment(t);if(this.isAttachmentDraftOnly(o)){var s=o.getField("messages")[0];this.discardDraft(o,s.id,s.draftID,r)}else this.removeLabelsFromMessage(e,t,a,[Ea.INBOX],n.a.ChangeType.Local),this.addLabelsToMessage(e,t,a,[Ea.TRASH],n.a.ChangeType.Local),i.default.isTempId(t)?r(!0):this._trashRemoteMail(e,t,a,r)}},{key:"untrashMail",value:function(e,t,a,r){this.removeLabelsFromMessage(e,t,a,[Ea.TRASH],n.a.ChangeType.Local),i.default.isTempId(t)?(this.addLabelsToMessage(e,t,a,[Ea.INBOX],n.a.ChangeType.Local),r(!0)):(this.addLabel(e,t,a,ii.INBOX),this._untrashRemoteMail(e,t,a,r))}},{key:"moveItem",value:function(e,t,a){return a.insertItem(t,0),[t,a]}},{key:"unmoveItem",value:function(e,t,a){return a.removeChild(t,n.a.ChangeType.Local),[t,a]}},{key:"hasLabelByID",value:function(e,t,a,n){return i.default.Assert(!a,"We don't support individual queries on messages, only threads"),this.getAttachment(t).getField("labelIds").indexOf(n)>=0}},{key:"hasLabel",value:function(e,t,a,n){i.default.Assert(!a,"We don't support individual queries on messages, only threads");var r=!1;if(!a){var o=this._getLabelByName(e,n,!0);o&&(r=this.hasLabelByID(e,t,a,o.getLabelID()))}return r}},{key:"hasFullLabel",value:function(e,t,a){var i=!1,n=this.getCacheData(t),r=this._getLabelByName(e,a,!0);if(r&&n){var o=0,s=n.messages;i=!0;for(var l=0;l<s.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(s[l].labelIds.indexOf(r.getLabelID())<0){i=!1;break}}}return i}},{key:"hasLabelLike",value:function(e,t,a){var i=!1,n=this.getAttachment(t);if(n){var r=n.getField("labelIds"),o=this._getAccountLib(e,this._labelsByID);if(o)for(var s=0,l=0;l<r.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=o[r[l]];u&&u.isMatched(a)&&(i=!0)}}return i}},{key:"addLabel",value:function(e,t,a,r){var o=this;i.default.Assert(!a,"We currently do not support setting labels on single messages"),i.default.Assert(!this.hasLabel(e,t,a,r),"Should not add the same label to a thread/message twice");var s=this._getLabelByName(e,r,!0);if(s)s.isLocalOnly()?this._createRemoteLabel(e,r,function(a){a&&(i.default.Assert(a,"Should have successfully created the remote label"),o._changeLabelID(e,s.getLabelID(),a.id),o._modifyRemoteThreadLabels(e,t,[a.id],void 0))}):this._modifyRemoteThreadLabels(e,t,[s.getLabelID()],void 0);else{var l=i.default.generateTempId();s=this._ensureLabel(e,l,r,void 0,void 0,n.a.ChangeType.Local),this._ensureVMLIsForLabel(e,s),this._writeLabelsToCache(function(a){a&&o._createRemoteLabel(e,r,function(a){i.default.Assert(a,"Should have successfully created the remote label"),a&&(o._changeLabelID(e,l,a.id),o._modifyRemoteThreadLabels(e,t,[a.id],void 0))})})}return this.addLabelsToMessage(e,t,a,[s.getLabelID()],n.a.ChangeType.Local),r}},{key:"removeLabel",value:function(e,t,a,r){i.default.Assert(!a,"We currently do not support setting labels on single messages");var o=this._getLabelByName(e,r);return i.default.Assert(o,"Must have valid label for gmail in order to remove"),o&&(o.isLocalOnly()||this._modifyRemoteThreadLabels(e,t,void 0,[o.getLabelID()]),this.removeLabelsFromMessage(e,t,a,[o.getLabelID()],n.a.ChangeType.Local)),r}},{key:"_threadIsArchived",value:function(e){if(e){var t=e.labelIds.indexOf(Ea.INBOX)>=0,a=this.hasFullLabel(e.accountID,e.id,ii.TRASH),n=e.labelIds.indexOf(Ea.SPAM)>=0,r=this.hasFullLabel(e.accountID,e.id,ii.DRAFT);return!i.default.isTempId(e.id)&&!t&&!a&&!n&&!r}return!1}},{key:"_trashRemoteMail",value:function(e,t,a,n){var r,o,s=this;i.default.Assert(!i.default.isTempId(t),"Should not try to trash local only threads"),i.default.Assert(!a||!i.default.isTempId(a),"Should not try to trash local only messages"),a?(r=Ve.a.fns("gmail").users.messages.trash.packedFn,o={userId:e,id:a}):(r=Ve.a.fns("gmail").users.threads.trash.packedFn,o={userId:e,id:t});this._queueRemoteRequestMulti(e,r,o,function(){n(!0)},function(t){n(!1,t),s._notifyFailedRequest(e,t)},void 0,qa)}},{key:"_untrashRemoteMail",value:function(e,t,a,n){var r,o,s=this;i.default.Assert(!i.default.isTempId(t),"Should not try to untrash local only threads"),i.default.Assert(!a||!i.default.isTempId(a),"Should not try to untrash local only messages"),a?(r=Ve.a.fns("gmail").users.messages.untrash.packedFn,o={userId:e,id:a}):(r=Ve.a.fns("gmail").users.threads.untrash.packedFn,o={userId:e,id:t});this._queueRemoteRequestMulti(e,r,o,function(){n(!0)},function(t){n(!1,t),s._notifyFailedRequest(e,t)},void 0,qa)}},{key:"_createRemoteLabel",value:function(e,t,a){var r=this,o=Ve.a.fns("gmail").users.labels.create.packedFn,s={userId:e,resource:{name:t,labelListVisibility:"labelHide",messageListVisibility:"hide"}};this._queueRemoteRequestMulti(e,o,s,function(e){a&&a(e)},function(t){i.default.isHTTPStatusCode(t,n.a.HTTPStatusCode.Conflict)?a&&a(void 0,t):(a&&a(void 0,t),r._notifyFailedRequest(e,t))},void 0,Ha)}},{key:"_modifyRemoteThreadLabels",value:function(e,t,a,i,n){var r=this,o=Ve.a.fns("gmail").users.threads.modify.packedFn,s={userId:e,id:t,resource:{addLabelIds:a,removeLabelIds:i}};this._queueRemoteRequestMulti(e,o,s,function(e){n&&n(e)},function(t){n&&n(void 0,t),r._notifyFailedRequest(e,t)},void 0,za)}},{key:"_ensureRemoteLabel",value:function(e,t,a,r){this._getLabelByName(e,t,!0)?r&&r(!0):(this._ensureLabel(e,i.default.generateTempId(),t,void 0,void 0,a),this._createRemoteLabel(e,t,function(e,t){i.default.Assert(e||i.default.isHTTPStatusCode(t,n.a.HTTPStatusCode.Conflict),"Should have successful root label creation"),r&&r(!!e)}))}},{key:"_createInMemoryLabel",value:function(e,t,a,i,n,r){var o=new oa(e,t,a,this._clampSyncTime(i),n,r);r[t]=o,this._ensureAccountLib(e,this._labelsByName)[a]=o}},{key:"_updateLabelName",value:function(e,t){var a=e.getAccountID(),n=this._getAccountLib(a,this._labelsByName);i.default.Assert(n,"Must have valid label name bucket"),i.default.Assert(n[e.getRawName()],"Must have valid label in bucket"),e.updateLabelName(t),delete n[e.getRawName()],n[t]=e}},{key:"_ensureLabel",value:function(e,t,a,n,r,o){var s=this._ensureAccountLib(e,this._labelsByID);if(s[t])!i.default.isRemoteChange(o)&&s[t].hasName()||s[t].isSystemLabel()||this._updateLabelName(s[t],a);else{var l=this._getLabelByName(e,a,!0);l?l.isLocalOnly()&&!i.default.isTempId(t)?this._changeLabelID(e,l.getLabelID(),t):l.isLocalOnly()||(s[t]=l):(i.default.Assert(a||!i.default.isTempId(t),"All local labels must have a valid name"),this._createInMemoryLabel(e,t,a,n,r,s))}return s[t]}},{key:"_clampSyncTime",value:function(e){return e&&e.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():e}},{key:"_ensureLabelVMLIsForAccount",value:function(e){var t=this._getAccountLib(e,this._labelsByID);for(var a in t)t.hasOwnProperty(a)&&this._ensureVMLIsForLabel(e,t[a])}},{key:"_changeLabelID",value:function(e,t,a){var i=this._getLabelByID(e,t);xo.PaneUpdateBatcher.beginUpdateItems(),i.updateLabelID(a),this._getAccountLib(e,this._labelsByID)[a]=i,this._ensureVMLIsForLabel(e,i),xo.PaneUpdateBatcher.commitUpdateItems(),this.forEachAttachment(function(e){var i=e.getField("labelIds");if(i.remove(t)>=0){for(var n=0,r=e.getField("messages"),o=0;o<r.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[o].labelIds.remove(t)>=0&&r[o].labelIds.push(a)}i.push(a),e.updateField("labelIds",i)}});var n=this.getDefaultItemStore(),r="L~"+e+"~"+t;n.hasItem(r)&&n.destroyItem(r)}},{key:"labelExists",value:function(e,t){var a=this._getAccountLib(e,this._labelsByID);return a&&a[t]}},{key:"_getLabelByID",value:function(e,t){i.default.Assert(e,"Must supply a valid accountID"),i.default.Assert(t,"Must supply a valid labelID");var a=this._ensureAccountLib(e,this._labelsByID);if(!a[t]){var n=ii[t];this._createInMemoryLabel(e,t,n,void 0,void 0,a)}return a[t]}},{key:"_getLabelByName",value:function(e,t,a){i.default.Assert(this.hasSyncAccount(e),"Must provide a valid accountID with a matching sync account: "+e);var n,r=this._getAccountLib(e,this._labelsByName);return i.default.Assert(a||r,"Unable to find labelsByName for given account: "+e),r&&(n=r[t]),n}},{key:"_getPriorityLabel",value:function(e,t){var a=this._ensureAccountLib(e,this._priorityLabels);if(!a[t]){var r;switch(t){case n.a.VMLIFlag.P0:r=oi.PRI0;break;case n.a.VMLIFlag.P1:r=oi.PRI1;break;case n.a.VMLIFlag.P2:r=oi.PRI2;break;default:i.default.Assert(!1,"Invalid priority for email attachment")}a[t]=this._getLabelByName(e,r)}return a[t]}},{key:"_getAccountLib",value:function(e,t){var a;if(i.default.Assert(e,"Must provide valid accountID"),i.default.Assert(t,"Must provide valid lib object"),e)if(t[e])a=t[e];else for(var n in t)n.toUpperCase()===e.toUpperCase()&&i.default.Assert(!1,"Mismatch case request found for accountIDs: "+e,n);return a}},{key:"_ensureAccountLib",value:function(e,t){var a;if(i.default.Assert(e,"Must provide valid accountID"),i.default.Assert(t,"Must provide valid lib object"),e)if(t[e=e.toLowerCase()])a=t[e];else{for(var n in t)t.hasOwnProperty(n)&&i.default.Assert(!e||!n||n.toUpperCase()!==e.toUpperCase(),"Dupe accountID found with non-matching case: "+e,n);a=t[e]={}}return a}},{key:"_deleteAccountLib",value:function(e,t){i.default.Assert(e,"Must provide valid accountID"),i.default.Assert(t,"Must provide valid lib object"),i.default.Assert(t[e],"Trying to delete an account lib that doesnt exist: ",e),delete t[e]}},{key:"_attachmentHasPriorityLabel",value:function(e,t){var a=this._getPriorityLabel(e.getField("accountID"),t);return!!a&&e.getField("labelIds").indexOf(a.getLabelID())>=0}},{key:"getLabels",value:function(e,t,a){var i=[],n=t.toLowerCase(),r=0,o=this._labelsByID[e];for(var s in o)if(o.hasOwnProperty(s)){var l=o[s];if(l.matchesText(n)&&this.isDisplayTag(l)&&i.indexOf(l)<0&&(i.push(l),r++),a&&r>=a)break}return i}},{key:"_writeLabelsToCache",value:function(e){var t={};for(var a in this._labelsByID)if(this._labelsByID.hasOwnProperty(a)){t[a]={};var i=this._labelsByID[a];for(var n in i)i.hasOwnProperty(n)&&(t[a][n]=i[n].getSaveData())}this._threadCache.setMetadata(ti,t,e)}},{key:"_writeSendAsToCache",value:function(e){var t={};this._iterateSendAs(function(e,a){t[e]||(t[e]=[]),t[e].push(a)}),this._threadCache.setMetadata(ai,t,e)}},{key:"runLabelSync",value:function(e){var t=this;this._threadCache.onCacheMetadataReady(function(){for(var a=0,r=t.getSyncAccounts(),o=r.length,s=0,l=0,u=function(a,r){xo.PaneUpdateBatcher.beginUpdateItems();var u={};if(r)for(var d=0,c=0;c<r.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h,f=r[c];u[f.id]=!0,h="system"===f.type&&ii[f.id]?ii[f.id]:f.name,t._ensureLabel(a,f.id,h,void 0,f,n.a.ChangeType.Remote)}t._ensureLabelVMLIsForAccount(a),t._ensureRemoteLabel(a,"Moo.do",n.a.ChangeType.Local),t._ensureRemoteLabel(a,oi.PRI0,n.a.ChangeType.Local),t._ensureRemoteLabel(a,oi.PRI1,n.a.ChangeType.Local),t._ensureRemoteLabel(a,oi.PRI2,n.a.ChangeType.Local),t._ensureRemoteLabel(a,"Moo.do/Snoozed",n.a.ChangeType.Local),t._ensureRemoteLabel(a,"Moo.do/Handled",n.a.ChangeType.Local),t._ensureRemoteLabel(a,"Moo.do/Scheduled",n.a.ChangeType.Local);var p=t._getAccountLib(a,t._labelsByID);if(p)for(var g in p)if(p.hasOwnProperty(g)){var m=p[g];m.isLocalOnly()?(i.default.Assert(m.hasName(),"Label must have a valid name to be created on remote"),t._createRemoteLabel(a,m.getName(),function(e,t){t&&this._changeLabelID(a,e,t.id)}.bind(t,g))):0!==l||u[g]||m.isSystemOrSpecialLabel()||i.default.isDemoMode()||m.delete()}xo.PaneUpdateBatcher.commitUpdateItems(),t._writeLabelsToCache(),l+s===o&&e&&e()},d=function(e,t){s++,u(e,t.labels)},c=function(e,a){l++,u(e),t._notifyFailedRequest(e,a)},h=0;h<r.length;++h){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var f=Ve.a.fns("gmail").users.labels.list.packedFn,p={userId:r[h],timeoutMS:0};t._queueRemoteRequestMulti(r[h],f,p,d.bind(t,r[h]),c.bind(t,r[h]),void 0,ja)}})}},{key:"getDescriptorForItem",value:function(e){i.default.Assert(e,"Must have a valid item to get a description for");var t=this._getAccountIDFromItem(e),a=this._getLabelIDFromItem(e),n={accountID:t,labelID:a,threadID:this._getThreadIDFromItem(e)};if(t&&a){var r=this._getLabelByID(t,a);n.labelName=r.getName()}return n}},{key:"handleItemChange",value:function(e,t){var a=this;this._threadCache.onCacheReady(function(){a._threadCache.onCacheMetadataReady(function(){var n=a.getDescriptorForItem(e);n.labelID&&(i.default.Assert(n.accountID,"Must specify a valid accountID"),a._getThreadsForLabel(n.accountID,a._getLabelByID(n.accountID,n.labelID),e,function(e){i.default.Assert(e,"Expected success when querying for remote threads"),t&&t()}))})})}},{key:"handleViewModeChange",value:function(e,t){var a=this;t===n.a.GmailViewMode.Priority&&this._threadCache.onCacheReady(function(){var t=a._getAccountIDFromItem(e);i.default.Assert(t,"Missing Account ID: ",e.id);var n=a._getLabelByName(t,oi.PRI0);n&&a._getThreadsForLabel(t,n,void 0,function(e){i.default.Assert(e,"Expected success when querying for remote PRI0 threads")});var r=a._getLabelByName(t,oi.PRI1);r&&a._getThreadsForLabel(t,r,void 0,function(e){i.default.Assert(e,"Expected success when querying for remote PRI1 threads")});var o=a._getLabelByName(t,oi.PRI2);o&&a._getThreadsForLabel(t,o,void 0,function(e){i.default.Assert(e,"Expected success when querying for remote PRI2 threads")})})}},{key:"_getThreadsForLabel",value:function(e,t,a,n){var r=this;i.default.Assert(t,"Must provide a valid label to get thrads for");var o="-in:chats -in:spam label:"+t.getName(),s=t.getOldestSync();i.default.isDateValid(s)&&(o+=" before:"+Math.floor(s.getTime()/1e3));var l=new Date,u=new Sa(function(t){if(t){var a=r._addRemoteEntry(e,t);a.internalDate.isBefore(l)&&(l=a.internalDate),r.cacheThreadData(a.id,r.serializeExternalData(a))}},function(e){t.setOldestSync(l),r._writeLabelsToCache(),n(e)});this._requestRemoteThreads(e,Wa,a,o,25,void 0,u.getEntryCB(),u.getDoneCB())}},{key:"createOutlinePaneItem",value:function(e,t){for(var a=0,r=t.getItemStore(),o=e.getRawText(),s=e.getAttachmentByPlugin(this.id),l=this.getDisplayTags(s,void 0,!0),u=0;u<l.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;o+=" #"+l[u]}return r.createItem(i.default.generateTempId(),o,t.id,void 0,n.a.ChangeType.Local)}},{key:"refreshCurrentView",value:function(){this._forceThreadSync()}},{key:"goOnline",value:function(){this._forceThreadSync(this._notifyPendingDraftUpdate.bind(this))}},{key:"loadInitialData",value:function(){Pa(Aa(t.prototype),"loadInitialData",this).call(this),i.default.isDemoMode()&&this._forceThreadSync()}},{key:"_forceThreadSync",value:function(e){this.hasRecurringTask("GmailThreadSync")&&this.getRecurringTask("GmailThreadSync").forceUpdate(e)}},{key:"_forceLabelSync",value:function(e){this.hasRecurringTask("GmailLabelSync")&&this.getRecurringTask("GmailLabelSync").forceUpdate(e)}},{key:"_syncOfflineChanges",value:function(){i.default.Assert(!1,"Currently we do not perform a sync offline step for Gmail changes"),this._syncingOfflineChanges||(this._syncingOfflineChanges=!0)}},{key:"_cleanupLocalCaches",value:function(e){var t=this;i.default.Assert(i.default.isFunction(e),"Must have a valid callback when cleaning local caches");var a=0,n=0,r=this._getFullSyncTime(),o=this._getUnreadSyncTime(),s=this._getMetadataSyncTime();this._threadCache.getFilterEntries(function(e){return e&&e.date&&e.date.isBefore(r)},function(r){if(r)for(var l=0,u=0;u<r.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=r[u],c=!0;if(!d.date.isBefore(o))for(var h=0,f=0;c&&f<d.messages.length;++f){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var p=d.messages[f];if(t.isPriorityData(p)){c=!1;break}}if(c){var g=0;d.date.isBefore(s)&&(t._threadCache.removeEntry(d.id),a++);for(var m=0;m<d.messages.length;++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var v=d.messages[m];t._rawCache.removeEntry(v.id),n++}}}i.default.log("Gmail Cache Pruned: ",a,n),e(!1)})}},{key:"_cleanupRawCache",value:function(e){var t=this;i.default.Assert(i.default.isFunction(e),"Must have a valid callback when cleaning local caches");var a=0,n=this._getUnreadSyncTime();this._rawCache.getFilterEntries(function(e){return!e.internalDate||new Date(parseInt(e.internalDate)).isBefore(n)},function(n){if(n)for(var r=0,o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=n[o];t._rawCache.removeEntry(s.id),a++}i.default.log("Raw Cache Pruned: ",a),e()})}},{key:"getAccountSetting",value:function(e,t){var a,i=this._getAccountLib(e,this._accountSettings);return i&&(a=i[t]),a}},{key:"setAccountSetting",value:function(e,t,a){var i,n=this._ensureAccountLib(e,this._accountSettings);return i=n[t],n[t]=a,i}},{key:"runSettingsSync",value:function(){var e=this;this._getSettingsSendAs(function(t){for(var a in t)t.hasOwnProperty(a)&&e.setAccountSetting(a,"sendAs",t[a]);e._writeSendAsToCache(function(){})})}},{key:"_getSyncDays",value:function(){var e=this.getSetting(this.Settings.SyncTime);xo.billingManager.isTrialOver()&&(e=n.a.MaxGmailSyncTime.Free);var t=xo.pluginManager.getCacheSizeRatio();return t<1&&t>0&&(e=Math.round(e*t)),e}},{key:"_getMetadataSyncDays",value:function(){var e=Math.max(this.getSetting(this.Settings.SyncTime),15),t=xo.pluginManager.getCacheSizeRatio();return t<.5&&(e=Math.max(Math.round(e*t),7)),e}},{key:"_getUnreadSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-1.5*e)}},{key:"_getFullSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-e)}},{key:"_getMetadataSyncTime",value:function(){var e=this._getMetadataSyncDays();return(new Date).addDays(-e)}},{key:"_getFullSyncTimeStr",value:function(){return this._getSyncDays()+"d"}},{key:"_getMetadataSyncTimeStr",value:function(){return this._getMetadataSyncDays()+"d"}},{key:"runThreadSync",value:function(e){var t,a=this,r=0,o=0,s=[],l=[],u=function(u,d,c){u?(r++,s.push(d)):(o++,!i.default.isHTTPStatusCode(c,n.a.HTTPStatusCode.Network)&&i.default.vmMain.isOnline()&&l.push(d)),o+r===t&&(l.length>0?xo.toasts.pushMessage(n.a.MessageID.EmailSyncFail):xo.toasts.clearMessage(n.a.MessageID.EmailSyncFail),s.length>0&&a._contentSyncTask.requestRun(),e&&e(0===l.length))},d=!1,c=this._getSyncDays();void 0!==this._lastSyncTime&&this._lastSyncTime<c&&(d=!0,i.default.log("Forcing full gmail sync")),this._lastSyncTime=c,this._threadCache.onCacheMetadataReady(function(){a._threadCache.getMetadata(ei,function(e){var i=0,n=a.getSyncAccounts();t=n.length;for(var r=0;r<n.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o;if(!d){var s=e?e[n[r]]:void 0;o=s?s.historyID:void 0}a.performThreadSync(n[r],o,u)}})})}},{key:"performThreadSync",value:function(e,t,a){t?(Date.now()-this._lastCacheCleanup>i.default.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(e,t,a)):this._performThreadSyncFull(e,a)}},{key:"_performThreadSyncFull",value:function(e,t){var a,n=this,r="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),o=this.getDefaultItemStore(),s=this._ensureVMLIsForAccount(e,o);s.clearPaginationToken();var l=new Sa(function(t){if(t&&(!a&&t.historyId&&(a=t.historyId,n.setHistoryID(e,a)),n._shouldCacheThread(t))){var i=n._addRemoteEntry(e,t);n.cacheThreadData(i.id,n.serializeExternalData(i))}},function(a){t(a,e)});this._requestRemoteThreads(e,Oa,s,r,999,0,l.getEntryCB(),l.getDoneCB()),this._getThreadsForLabel(e,this._getLabelByID(e,Ea.UNREAD),void 0,function(e){i.default.Assert(e,"Expect to be able to get all unread messages")})}},{key:"_compactHistoryEntries",value:function(e){for(var t=0,a={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n],o=0;if(r.messagesAdded){for(var s=0,l=0;l<r.messagesAdded.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=r.messagesAdded[l].message,d=a.messagesAdded[u.threadId];d||(d=a.messagesAdded[u.threadId]=[]),d.indexOf(u.id)<0&&d.push(u.id)}o+=r.messagesAdded.length}if(r.messagesDeleted){for(var c=0,h=0;h<r.messagesDeleted.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=r.messagesDeleted[h].message,p=a.messagesDeleted[f.threadId];p||(p=a.messagesDeleted[f.threadId]=[]),p.indexOf(f.id)<0&&p.push(f.id)}o+=r.messagesDeleted.length}if(r.labelsAdded){for(var g=0,m=0;m<r.labelsAdded.length;++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var v=r.labelsAdded[m].message,y=a.labelsAdded[v.threadId];y||(y=a.labelsAdded[v.threadId]={}),y[v.id]||(y[v.id]=[]),y[v.id].pushOnlyUniques(r.labelsAdded[m].labelIds)}o+=r.labelsAdded.length}if(r.labelsRemoved){for(var _=0,b=0;b<r.labelsRemoved.length;++b){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;var k=r.labelsRemoved[b].message,w=a.labelsRemoved[k.threadId];w||(w=a.labelsRemoved[k.threadId]={}),w[k.id]||(w[k.id]=[]),w[k.id].pushOnlyUniques(r.labelsRemoved[b].labelIds)}o+=r.labelsRemoved.length}if(i.default.Assert(0===o||o===r.messages.length,"Must have handled all or none of the generic messages"),0===o)for(var S=0,I=0;I<r.messages.length;++I){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;var D=r.messages[I],C=a.messages[D.threadId];C||(C=a.messages[D.threadId]=[]),C.indexOf(D.id)<0&&C.push(D.id)}}var P={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(var A in a.messages)a.messages.hasOwnProperty(A)&&P.messages.push({id:A,msgIDs:a.messages[A]});for(var M in a.messagesAdded)a.messagesAdded.hasOwnProperty(M)&&!a.messages[M]&&P.messagesAdded.push({id:M,msgIDs:a.messagesAdded[M]});for(var T in a.messagesDeleted)a.messagesDeleted.hasOwnProperty(T)&&!a.messages[T]&&P.messagesDeleted.push({id:T,msgIDs:a.messagesDeleted[T]});for(var E in a.labelsAdded)if(a.labelsAdded.hasOwnProperty(E)&&!a.labelsAdded[E])for(var L in a.labelsAdded[E])a.labelsAdded[E].hasOwnProperty(L)&&P.labelsAdded.push({id:E,msgID:L,labelIDs:a.labelsAdded[E][L]});for(var x in a.labelsRemoved)if(a.labelsRemoved.hasOwnProperty(x)&&!a.messages[x])for(var O in a.labelsRemoved[x])a.labelsRemoved[x].hasOwnProperty(O)&&P.labelsRemoved.push({id:x,msgID:O,labelIDs:a.labelsRemoved[x][O]});return P}},{key:"_performThreadSyncPartial",value:function(e,t,a){var r=this,o=Ve.a.fns("gmail").users.history.list.packedFn,s={userId:e,startHistoryId:t},l={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},u=function(e,t){i.default.log("History Sync Request Failed: ",e,t)};this._queuePagedRemoteRequestMulti(e,o,s,function(t,i,n){var o;n&&(o=n.historyId,r.setHistoryID(e,o)),xo.PaneUpdateBatcher.beginUpdateItems();var s=r._compactHistoryEntries(t);r._handleCompactHistory(e,s,u),xo.PaneUpdateBatcher.commitUpdateItems(),a(!0,e)},function(t){t&&t.error&&t.error.code===n.a.HTTPStatusCode.NotFound?r._clearCachedData(e,function(i){i?r.performThreadSync(e,void 0,a):a(!1,e,t)}):(a(!1,e,t),r._notifyFailedRequest(e,t))},void 0,Ra,l)}},{key:"_handleCompactHistory",value:function(e,t,a){for(var i=0,n=0,r=0,o=0,s=0,l=0,u=0;u<t.messages.length;++u){var d=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var c=t.messages[u],h=0;h<c.msgIDs.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;this._handleMessageUpdated(e,c.id,c.msgIDs[h],a),l++}}for(var f=0;f<t.messagesAdded.length;++f){var p=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var g=t.messagesAdded[f],m=0;m<g.msgIDs.length;++m){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;this._handleMessageAdded(e,g.id,g.msgIDs[m],a),l++}}for(var v=0;v<t.messagesDeleted.length;++v){var y=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var _=t.messagesDeleted[v],b=0;b<_.msgIDs.length;++b){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;this._handleMessageDeleted(e,_.id,_.msgIDs[b]),l++}}for(var k=0;k<t.labelsAdded.length;++k){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var w=t.labelsAdded[k];this._handleLabelsAdded(e,w.id,w.msgID,w.labelIDs),l++}for(var S=0;S<t.labelsRemoved.length;++S){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var I=t.labelsRemoved[S];this._handleLabelsRemoved(e,I.id,I.msgID,I.labelIDs),l++}return l}},{key:"_handleMessageAdded",value:function(e,t,a,i){this.refreshThreadCacheData(e,t,a,i)}},{key:"_handleMessageDeleted",value:function(e,t,a){this._deleteCachedMessage(e,t,a)}},{key:"_handleLabelsAdded",value:function(e,t,a,i){this.addLabelsToMessage(e,t,a,i,n.a.ChangeType.Remote)}},{key:"_handleLabelsRemoved",value:function(e,t,a,i){this.removeLabelsFromMessage(e,t,a,i,n.a.ChangeType.Remote)}},{key:"_handleMessageUpdated",value:function(e,t,a,i){this.refreshThreadCacheData(e,t,a,i)}},{key:"getLastSyncTime",value:function(e,t){this._threadCache.getMetadata(ei,function(a){var i;if(a){var n=a[e];n&&n.date&&(i=new Date(n.date))}t(i)})}},{key:"getAllLastSyncTimes",value:function(e){var t=this;this._threadCache.getMetadata(ei,function(a){for(var i=0,n={},r=t.getSyncAccounts(),o=0;o<r.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=r[o],l=a?a[s]:void 0;l&&l.date?n[s]=new Date(l.date):n[s]=void 0}e(n)})}},{key:"setHistoryID",value:function(e,t,a){var n=this;i.default.Assert(i.default.isString(e),"Must provide a valid account ID to set history ID"),i.default.Assert(i.default.isString(t),"Must provide a valid history ID to set"),this._threadCache.getMetadata(ei,function(i){(i=i||{})[e]={historyID:t,date:Date.now()},n._threadCache.setMetadata(ei,i,a)})}},{key:"clearHistoryID",value:function(e,t){var a=this;i.default.Assert(i.default.isString(e),"Must provide a valid account ID to clear history ID for"),i.default.Assert(i.default.isFunction(t),"Must provide valid CB function when clearing history ID"),this._threadCache.getMetadata(ei,function(i){i?(delete i[e],a._threadCache.setMetadata(ei,i,t)):t(!1)})}},{key:"clearCachedLabel",value:function(e,t){var a=this;i.default.Assert(i.default.isString(e),"Must provide a valid account ID to clear history ID for"),i.default.Assert(i.default.isFunction(t),"Must provide valid CB function when clearing history ID"),this._threadCache.getMetadata(ti,function(i){i?(delete i[e],a._threadCache.setMetadata(ti,i,t)):t(!1)})}},{key:"_clearCachedData",value:function(e,t){var a=this;this.clearHistoryID(e,function(i){i?a.clearCachedLabel(e,function(i){i?a.clearAccountThreadCache(e,t):t(!1)}):t(!1)})}},{key:"clearAccountThreadCache",value:function(e,t){var a=this;i.default.Assert(i.default.isString(e),"Must provide a valid account ID to clear thread cache for"),i.default.Assert(i.default.isFunction(t),"Must provide valid CB function when clearing thread cache");this._threadCache.getFilterEntries(function(t){return t.accountID===e},function(n){if(n){var r=0;i.default.log("Clearing account thread cache: "+e);for(var o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=n[o];if(a._threadCache.removeEntry(s.id),s.messages)for(var l=0,u=0;u<s.messages.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;a._rawCache.removeEntry(s.messages[u].id)}}t(!0)}else t(!1)})}},{key:"requestDataPage",value:function(e,t){i.default.log("Data Page: ",e.hasPaginationToken()),e.hasPaginationToken()&&!e.paginationTokenInUse()?this._requestRemoteThreads(void 0,Ua,e,void 0,25,void 0,void 0,t):t(!0)}},{key:"_requestRemoteThreads",value:function(e,t,a,n,r,o,s,l){var u,d=arguments,c=this;if(a&&a.hasPaginationToken()&&!a.paginationTokenInUse()){if(u=a.beginDataPageLoad(),i.default.Assert(!n,"Should not define a new q for paged token"),i.default.Assert(!s,"Should not define a new entryCB for paged token"),n=u.getQuery(),r=u.getMaxResults(),s=u.getEntryCB(),l){var h=l;l=function(){u.getDoneCB().apply(null,d),h.apply(null,d)}}else l=u.getDoneCB();e=e||u.getInfo().accountID}else a&&a.needsPaginationToken()&&(u=this.createPaginationToken(void 0,n,{accountID:e},r,s,l),a.setPaginationToken(u),a.beginDataPageLoad());r=r||25,i.default.Assert(s&&i.default.isFunction(s),"Must define a valid entry callback"),i.default.Assert(l&&i.default.isFunction(l),"Must define a valid done callback");var f,p,g=Ve.a.fns("gmail").users.threads.list.packedFn,m={userId:e,maxResults:r,timeoutMS:o,q:n,pageToken:u&&u.hasMorePages()?u.getNextPageToken():void 0};u||!a?(f=function(t){if(t.nextPageToken&&u&&c.updatePaginationToken(u,t.nextPageToken),a&&u&&a.endDataPageLoad(!!t.nextPageToken),t.threads)for(var i=0,n=t.threads.length,r=0,o=0,d=function(e){e?(s(e),r++):(s(void 0),o++),r+o===n&&l(!0)},h=0;h<t.threads.length;++h){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var f=t.threads[h];c._requestRemoteThreadMetadata(e,f.id,void 0,d)}else l(!0)},p=function(t){a&&u&&a.endDataPageLoad(u),l(!1),c._notifyFailedRequest(e,t)}):(f=function(){l(!0)},p=function(t){l(!1),c._notifyFailedRequest(e,t)}),this._queueRemoteRequestMulti(e,g,m,f,p,void 0,t)}},{key:"_requestRemoteMessageData",value:function(e,t,a){var n=this;i.default.Assert(!e.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment");var r=Ve.a.fns("gmail").users.messages.get.packedFn,o={userId:e.getField("accountID"),id:t,format:"full"};this._queueRemoteRequestMulti(e.getField("accountID"),r,o,function(r){var o=n._parseMailMessage(r);i.default.Assert(o,"Must be able to parse message"),n._updateMessageData(e,t,o),a(!0)},function(t){a(!1,t),n._notifyFailedRequest(e.getField("accountID"),t)},void 0,Za)}},{key:"_requestRemoteMessageDataRaw",value:function(e,t,a,i){var n=this,r=Ve.a.fns("gmail").users.messages.get.packedFn,o={userId:e,id:a,format:"full"};this._queueRemoteRequestMulti(e,r,o,i,function(t){i(void 0,t),n._notifyFailedRequest(e,t)},void 0,Za)}},{key:"_requestRemoteThreadDataRaw",value:function(e,t,a){var i=this,n=Ve.a.fns("gmail").users.threads.get.packedFn,r={userId:e,id:t,format:"full"};this._queueRemoteRequestMulti(e,n,r,a,function(t){a(void 0,t),i._notifyFailedRequest(e,t)},void 0,Fa)}},{key:"_requestRemoteThreadMetadata",value:function(e,t,a,i){var n=this,r=Ve.a.fns("gmail").users.threads.get.packedFn,o={userId:e,id:t,format:"metadata"};this._queueRemoteRequestMulti(e,r,o,function(e){i(e)},function(t){i(void 0,t),n._notifyFailedRequest(e,t)},a,Na)}},{key:"_persistRemoteSnoozeTask",value:function(e,t){var a=e.getData();i.default.XHR_PrivateAPI({type:"POST",path:"/tasks/snoozeMail",data:a,requireAuth:!0,autoRetry:!1,cb:this._handleRemotePersist.bind(this,t)})}},{key:"_cancelDeferredSnoozeTask",value:function(e,t){var a=e.getData();i.default.XHR_PrivateAPI({type:"POST",path:"/tasks/snoozeMail/cancel",data:a,requireAuth:!0,autoRetry:!1,cb:function(e){t(e.status===n.a.HTTPStatusCode.Success)}})}},{key:"_persistRemoteSendMailTask",value:function(e,t){var a=e.getData();i.default.XHR_PrivateAPI({type:"POST",path:"/tasks/sendMail",data:a,requireAuth:!0,autoRetry:!1,cb:this._handleRemotePersist.bind(this,t)})}},{key:"_cancelDeferredSendMailTask",value:function(e,t){var a=e.getData();i.default.XHR_PrivateAPI({type:"POST",path:"/tasks/sendMail/cancel",data:a,requireAuth:!0,autoRetry:!1,cb:function(e){t(e.status===n.a.HTTPStatusCode.Success)}})}},{key:"_handleRemotePersist",value:function(e,t){if(t.status!==n.a.HTTPStatusCode.Success)return e(!1);try{return e(!0,JSON.parse(t.response).data.messageID)}catch(a){return i.default.reportError(a),e(!1)}}},{key:"_parseMailThread",value:function(e,t){for(var a=0,r=[],o=0;o<t.messages.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._parseMailMessage(t.messages[o]);i.default.Assert(s,"Must be able to parse each message"),s&&r.push(s)}var l=e.getField("messages");this._mergeMessagesData(l,r,["labelIds","draftID"]),e.updateField("dataLoaded",!0),e.updateField("messages",r),this._updateAttachmentFromMessages(e,n.a.ChangeType.Remote)}},{key:"getAttachmentURL",value:function(e,t,a){return"https://mail.google.com/mail/b/"+e+"/?ui=2&view=att&disp=safe&zw"+("&th="+t)+("&attid="+a)}},{key:"getPreviewURL",value:function(e){return e.link}},{key:"reportMessage",value:function(e,t,a,n,r){var o=Ve.a.fns("gmail").users.messages.get.packedFn,s={userId:e,id:a,format:"full",forceNoDupe:!0};this._queueRemoteRequestMulti(e,o,s,this._sendReport.bind(this,r,n),function(){i.default.Assert(!1,"Failed to report message")},void 0,Za)}},{key:"dumpMessage",value:function(e,t,a){var i=this.getAttachment(t),n=this._getMessageFromAttachment(i,a);console.log("Message Dump: ",n)}},{key:"_sanitizeMessage",value:function(e){if(e.parts)for(var t=0,a=0;a<e.parts.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._sanitizeMessage(e.parts[a])}if(e.body&&e.body.data){var i=this._runDecodeEmail(e);i&&i.mimeType===bi?e.body.data=this._encodeEmail(sa.a.sanitizeContent(i.decoded)):e.body.data=this._encodeEmail(sa.a.sanitizePlaintext(i.decoded))}if(e.headers)for(var n=0,r=0;r<e.headers.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e.headers[r];switch(o.name.toUpperCase()){case"TO":case"CC":case"BCC":case"FROM":o.value=o.value.replace(/[A-Za-z0-9]/g,"#");break;case"SUBJECT":case"SNIPPET":o.value=new Array(o.name.length+1).join("#")}}}},{key:"_sendReport",value:function(e,t,a){i.default.Assert(i.default.isBoolean(e),"Must provide a valid boolean for sendContent"),i.default.Assert(i.default.isString(t),"Must provide a valid description string"),i.default.Assert(i.default.isObject(a),"Must provide valid raw data");try{i.default.log("Sending Message Report",a),e||this._sanitizeMessage(a.payload);var n={description:t,payload:a.payload};i.default.reportError(new Error("Report Message"),n)}catch(r){i.default.reportError(r)}}},{key:"loadResource",value:function(e,t,a,i){if(this.hasCacheData(e)){var n=this.getAttachment(e),r=this._getMessageFromAttachment(n,t).resources.find(a);r?(r.data?i(r,a):this._requestRemoteAttachment(n.getField("accountID"),t,r.id,function(e,t){e&&(r.data=e,r.size=t),i(r,a)}),this.sendEvent("FetchAttachment")):i(void 0,a)}else i(void 0,a)}},{key:"_requestRemoteAttachment",value:function(e,t,a,i){var n=this,r=Ve.a.fns("gmail").users.messages.attachments.get.packedFn,o={id:a,messageId:t,userId:e};this._queueRemoteRequestMulti(e,r,o,function(e){i(e.data.replace(/-/g,"+").replace(/_/g,"/"),e.size)},function(t){i(void 0),n._notifyFailedRequest(e,t)},void 0,Ja)}},{key:"_parseAttachment",value:function(e,t,a){var n,r,o,s,l;i.default.Assert(e,"Must have valid multipart lib"),i.default.Assert(a.body,"Must have a valid attachment body"),i.default.Assert(a.body.attachmentId,"Must have a valid attachment ID");var u="0."+a.partId;if(a.headers)for(var d=0,c=0;c<a.headers.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h=a.headers[c];switch(h.name.toUpperCase()){case"CONTENT-ID":var f=/^<(.*)>$/.exec(h.value);r=n=f?f[1]:h.value;break;case"CONTENT-TRANSFER-ENCODING":l=h.value;break;case"CONTENT-DISPOSITION":var p=h.value.split(";");s=p[0]?p[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":o=h.value}}n&&s!==Ii||!a.filename?!n&&a.body.attachmentId&&(n=a.body.attachmentId):n=a.filename,i.default.Assert(n,"Must be able to find a valid resource ID");var g={cid:n,rawContentID:r,id:a.body.attachmentId,attID:u,realAttrID:o,data:void 0,size:a.body.size,uploader:void 0,disposition:s,parentType:t.mimeType,mimeType:a.mimeType,contentEncoding:l};e.add(g)}},{key:"_decodeFlowed",value:function(e,t){return e.split(/\r?\n/).reduce(function(e,a,i){var n=e;return t&&(n=n.replace(/[ ]+$/,"")),/ $/.test(e)&&!/(^|\n)\-\- $/.test(e)||1===i?n+a:n+"\n"+a}).replace(/^ /gm,"")}},{key:"_decodeEmail",value:function(e,t,a){var n;if(i.default.Assert(i.default.isString(e),"Passing in an invalid string to decode"),e)try{n=i.default.b64_to_utf8(e),"FLOWED"===a.format&&(n=this._decodeFlowed(n,a.delSp))}catch(r){i.default.reportError(r)}return n}},{key:"_encodeEmail",value:function(e){var t;try{t=i.default.utf8_to_b64(e)}catch(a){i.default.reportError(a)}return t}},{key:"_runDecodeEmail",value:function(e){i.default.Assert(e&&e.body,"Must pass in a valid part");var t,a=this._getHeader(e,"Content-Transfer-Encoding"),n=!1;if(Ai.indexOf(e.mimeType)>=0)return{decoded:t=this._generateMessageDisplayNode(e),mimeType:bi,contentType:"text/html;charset=utf-8",name:"GeneratedContent",hasError:n};var r=this._getHeader(e,"Content-Type")||"text/html;charset=utf-8";i.default.Assert(r,"Must have a valid contentType");var o=this._sanitizeContentType(r);return e.body&&e.body.data?t=this._decodeEmail(e.body.data,a,o):e.body&&e.body.attachmentId?t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>':(t="Unable to decode email content",n=!0),{decoded:t,mimeType:e.mimeType,contentType:o.type,name:o.name,hasError:n}}},{key:"_runDecodeMessage",value:function(e){var t=this._decodeMessagePart(e);return 0===t.length&&e?Ci.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:Ai.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:[]:t}},{key:"_decodeMessagePart",value:function(e){var t=[];if(e)if(e.mimeType===ci||e.mimeType===hi||e.mimeType===di)for(var a=0,i=0;i<e.parts.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this._decodeMessagePart(e.parts[i]);t.pushArray(n)}else if(e.mimeType===ui||e.mimeType===li||e.mimeType===li||e.mimeType===pi)for(var r=0,o=e.parts.length-1;o>=0;o--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(this._isValidDisplayPart(e.parts[o])){var s=this._decodeMessagePart(e.parts[o]);if(s.length>0){t.pushArray(s);break}}}else this._isValidDisplayPart(e)&&t.push(this._runDecodeEmail(e));return t}},{key:"_combineMessageParts",value:function(e){var t="",a=_i,i="text/html;charset=utf-8",n=!1;if(e&&e.length>0){var r=0;a=e[0].mimeType,i=e[0].contentType;for(var o=0;o<e.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;Pi.indexOf(e[o].mimeType)<0&&(n=!0)}t=sa.a.combineParts(e)}else t=" ";return a===_i&&(a=bi,i=bi+";charset="+i.split(";charset=")[1]),{decoded:t,mimeType:a,contentType:i,reportMessage:n}}},{key:"_isValidDisplayPart",value:function(e){var t=!1;return!this._isResourcePart(e)&&Ci.indexOf(e.mimeType)>=0&&(t=!0),t}},{key:"_isResourcePart",value:function(e){var t=!1;return e.filename?t=!0:this._getHeader(e,"CONTENT-ID")&&(this._getHeader(e,"CONTENT-DISPOSITION")||Ci.indexOf(e.mimeType)<0)&&(t=!0),t}},{key:"_parseMessagePart",value:function(e,t){var a=0,n=0,r={parent:t,raw:e,mimeType:e.mimeType,children:[],resources:[]};switch(e.mimeType){case _i:case bi:case gi:break;case li:case di:case mi:case ui:case fi:case hi:case vi:case ci:for(var o=0;o<e.parts.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=e.parts[o],l=this._parseMessagePart(s,r);this._isResourcePart(s)?r.resources.push(l):r.children.push(l)}break;case pi:for(var u=0;u<e.parts.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var d=this._parseMessagePart(e.parts[u],r);r.children.push(d)}break;default:var c=e.mimeType.split("/")[0];Di.indexOf(c)<0&&(i.default.log("Unknown Part Mimetype: ",e),i.default.reportError(new Error("Unknown attachment mimetype: "+e.mimeType)))}return r}},{key:"_getMessageDisplay",value:function(e,t){var a=0;switch(e.mimeType){case _i:case bi:case ci:case hi:case fi:t.push(e);break;case ui:case li:case pi:case di:for(var n=0;n<e.children.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._getMessageDisplay(e.children[n],t)}break;case ki:case wi:break;case mi:case yi:case vi:t.push(e);break;default:i.default.Assert(!1,"Should never have an unknown multipart mimetype in the tree: ",e.mimeType)}}},{key:"_getResourcesForNode",value:function(e,t){for(var a=0,i=e.resources,n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i[n].raw;this._parseAttachment(t,e,r)}e.raw&&e.raw.body&&e.raw.body.attachmentId&&this._parseAttachment(t,e.parent,e.raw)}},{key:"_getResourcesForPart",value:function(e){var t=0,a=new ha;if(e.mimeType===ci||e.mimeType===hi)for(var i=0,n=0;n<e.children.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._getResourcesForNode(e.children[n],a)}for(;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._getResourcesForNode(e,a),e=e.parent}return a}},{key:"_displayAttachment",value:function(e,t){var a=!1;return e.cid===t&&(e.disposition===Ii?a=!0:e.disposition===Si&&e.parentType===ci&&(a=!0)),a}},{key:"getMessageAttachments",value:function(e){var t=this,a=[];return e.resources.forEachResource(function(e){t._displayAttachment(e,e.cid)&&a.push(e)}),a}},{key:"getMessageDisplayAttachments",value:function(e){var t,a=0,i=this.getMessageAttachments(e);if(e.initializedForDisplay)t=e.specialLinks?e.specialLinks.attachments:[];else{var n={ignoreQuotedAttachments:!!(e.labelIds.indexOf(Ea.DRAFT)>=0)};t=sa.a.getAttachmentLinks(e.decoded,n)}for(var r=0;r<t.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t[r];if(!e.resources.has(o.name)){var s=this._createResource(e.resources,o);s.link=o.href,i.push(s)}}return i}},{key:"_verifyDKIM",value:function(e){var t;if(e)for(var a=0,i=e.split(";"),n=/([a-z]+)[=](.*)/i,r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=i[r].trim();if(o){var s=n.exec(o);if(s)switch(t={},s[1]){case"d":t.domain=s[2];break;case"h":t.headers=s[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return t}},{key:"_sanitizeContentType",value:function(e){var t="text/html;charset=utf-8";try{var a,n,r,o,s=0,l=e.replace(/[\"\']/g,"").split(";"),u=l[0].trim().toLowerCase();i.default.Assert(u===_i||u===bi,"Unknown ContentType MediaType: "+u);for(var d=1;d<l.length;++d){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=l[d].trim();if(c){var h=c.indexOf("=");if(h>=1){var f=c.substr(0,h).trim(),p=c.substr(h+1).trim();if(f&&p)switch(f.toUpperCase()){case"CHARSET":a=p;break;case"FORMAT":n=p.toUpperCase();break;case"DELSP":r="YES"===p.toUpperCase();break;case"NAME":o=p;break;case"BOUNDARY":break;default:i.default.Assert(!1,"Unknown param in ContentType: "+c)}else i.default.Assert(!1,"Malformed contentType part: ",e)}else i.default.Assert(!1,"Invalid contentType part: ",e)}}a||(a="utf-8"),u&&a&&(t=u+";charset="+a)}catch(g){i.default.reportError(g)}return{type:t,format:n,delSp:r,name:o}}},{key:"_getHeader",value:function(e,t){var a;if(e&&e.headers)for(var i=0,n=0;n<e.headers.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.headers[n].name.toUpperCase()===t.toUpperCase()){a=e.headers[n].value;break}}return a}},{key:"_generateMessageDisplayNode",value:function(e){var t;if(i.default.Assert(Ai.indexOf(e.mimeType)>=0,"Must be a valid mimeType to generate content from"),e.body&&e.body.attachmentId)t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>';else{var a;switch(e.mimeType){case yi:case vi:case ci:a="&nbsp;";break;case mi:a="Unable to display encrypted message content.";break;default:a="Unable to display unknown content type: "+e.mimeType}t="<html><body>"+a+"</body></html>"}return t}},{key:"_parseMailMessage",value:function(e){var t;try{t=this._parseMailMessageInternal(e)}catch(a){i.default.reportError(a)}return t}},{key:"_parseMailMessageInternal",value:function(e){var t=0,a={},n=e.payload,r=!!n.body&&n.body.size>0;i.default.Assert(r!==n.mimeType.startsWith("multipart/")||n.mimeType===di,"Checking the body size should be the same as checking whether this is a multipart message"),this._verifyDKIM(this._getHeader(e.payload,"DKIM-Signature"));for(var o,s,l=e.payload.headers,u=0;u<l.length;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var d=l[u];switch(d.name.toUpperCase()){case"FROM":e.from=this.parseEmailAddress(d.value);break;case"REPLY-TO":e.replyTo=this.parseEmailAddress(d.value);break;case"TO":e.to=this.parseEmailAddresses(d.value);break;case"CC":e.cc=this.parseEmailAddresses(d.value);break;case"BCC":e.bcc=this.parseEmailAddresses(d.value);break;case"SUBJECT":e.subject=d.value;break;case"DATE":e.date=this.parseDateHeader(d.value),i.default.Assert(i.default.isDateValid(e.date),"Must have a valid message date: ",e.date);break;case"MESSAGE-ID":e.messageID=d.value;break;case"REFERENCES":e.references=d.value;break;case"IN-REPLY-TO":e.inReplyTo=d.value;break;case"LIST-UNSUBSCRIBE":e.listUnsubscribe=d.value;break;default:0}}if(e.messageID||(e.messageID=i.default.generateTempId()),r)s=n;else{var c,h=0,f=this._parseMessagePart(n),p=[];this._getMessageDisplay(f,p);for(var g=p.length-1;!c&&g>=0;g--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;Ci.indexOf(p[g].mimeType)>=0?c=p[g]:Ai.indexOf(p[g].mimeType)>=0?c=p[g]:(i.default.log("Unknown bestNode mimepart: ",p[g]),i.default.Assert(!1,"Unknown mimePart display type: ",p[g].mimeType))}c?(o=this._getResourcesForPart(c),s=c.raw):this._sendReport(!1,"Missing bestNode",e)}i.default.Assert(s,"Must have found a valid message part to display");var m=this._runDecodeMessage(s);if(i.default.Assert(m.length>0,"Should have at least one decoded message part available"),0===m.length)try{var v=JSON.parse(JSON.stringify(e));this._sendReport(!0,"No valid decoded part",v)}catch(_){i.default.reportError(_)}var y=this._combineMessageParts(m);y&&(a={id:e.id,labelIds:e.labelIds,messageID:e.messageID,decoded:y.decoded,mimeType:y.mimeType,contentType:y.contentType,from:e.from,to:e.to||[],cc:e.cc,bcc:e.bcc,snippet:e.snippet,subject:e.subject||"",date:e.date,internalDate:e.internalDate?new Date(i.default.parseInt(e.internalDate)):new Date,references:e.references,inReplyTo:e.inReplyTo,listUnsubscribe:e.listUnsubscribe,resources:o||new ha},y.reportMessage&&this._sendReport(!1,"Mismatch mimeType/contentType",e));return a}},{key:"parseEmailAddress",value:function(e){Ti.lastIndex=0;var t=Ti.exec(e),a={};if(t){var i=Ei.exec(t[1]);a.text=i?i[1]:t[1],a.email=t[2]}else a.email=e;return a.email&&(a.email=a.email.replace(/[\r\n]/g,"")),a.text&&(a.text=a.text.replace(/[\r\n]/g,"")),a}},{key:"parseEmailAddresses",value:function(e){for(var t=0,a=[],n=i.default.parseEmailAddresses(e),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=n[r];"contact"===o.type&&o.email&&a.push(o)}return a}},{key:"parseDateHeader",value:function(e){var t=new Date(e);return i.default.isDateValid(t)||(t=xo.International.parseDate(e,n.a.DateFormat.MDY)),t}},{key:"runRemoteSearch",value:function(e,t,a,r){var o=this;i.default.Assert(e,"Must provide a valid search"),i.default.Assert(t,"Must provide a valid pane"),i.default.Assert(a,"Must provide a valid bucket ID"),i.default.Assert(i.default.isFunction(r),"Must provide a valid search callback");var s="-in:chats -in:spam "+e,l=xo.PaneManager.getPaneById(t),u=this._getAccountIDFromItem(l.getItem())||this.getDefaultAccount(),d=!1,c=0,h=0,f=new Ge(e,25,this.requestDataPage.bind(this)),p=function(e){if(c===h&&d){i.default.log("Done Searching: ",c);var s=e?n.a.SearchResultStatus.Error:c>0?n.a.SearchResultStatus.Done:n.a.SearchResultStatus.None;f.isValid()&&o.swapInSearchBucket(a,t),r(s)}},g=function(e){if(c++,e){var t=o._addRemoteEntry(u,e),i=o.getBucketItemStore(a);o._ensureVMLIsForSearchResult(t,i),h++}else h++;p()},m=function(e){d=!0,p(!e)},v=!1,y=new Sa(f.onEntry,function(e){f.onDone(e),v||(v=!0,f.isValid()&&f.hasResults()?f.getNextPage(g,m):m(e))});return this._requestRemoteThreads(u,Ba,void 0,s,25,void 0,y.getEntryCB(),y.getDoneCB()),f}},{key:"_addSearchCacheEntryInternal",value:function(e,t,a){var i=!1,n=this._ensureAccountLib(e,this._emailCache);return n[t]||(n[t]={}),n[t][a]||(n[t][a]=!0,i=!0),i}},{key:"_removeSearchCacheEntryInternal",value:function(e,t,a){var i,n=this._getAccountLib(e,this._emailCache);return n&&n[t]&&(i=n[t][a],delete n[t][a]),i}},{key:"_getSearchCacheLabelEntryInternal",value:function(e,t){var a,i=this._getAccountLib(e,this._emailCache);return i&&i[t]&&(a=i[t]),a}},{key:"_addEmailToSearchCache",value:function(e,t){var a=!1;if(t&&i.default.isArray(t.labelIds))for(var n=0,r=0;r<t.labelIds.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a=this._addSearchCacheEntryInternal(t.accountID,t.labelIds[r],e)||a}return a}},{key:"_removeEmailFromSearchCache",value:function(e,t){var a=!1;if(t&&i.default.isArray(t.labelIds))for(var n=0,r=0;r<t.labelIds.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=!!this._removeSearchCacheEntryInternal(t.accountID,t.labelIds[r],e);a=a||o,o&&this._removeThreadLabelVMLI(t.accountID,e,t.labelIds[r])}return a}},{key:"_addEmailLabelToSearchCache",value:function(e,t,a){return this._addSearchCacheEntryInternal(e,a,t)}},{key:"_removeEmailLabelFromSearchCache",value:function(e,t,a){var i=!!this._removeSearchCacheEntryInternal(e,a,t);return i&&this._removeThreadLabelVMLI(e,t,a),i}},{key:"runLocalItemSearch",value:function(e){var t=this.getDescriptorForItem(e.item),a=this._getSearchCacheLabelEntryInternal(t.accountID,t.labelID);if(a)for(var n in a)if(a.hasOwnProperty(n)){var r=this.getCacheData(n);if(i.default.Assert(r,"Must have valid data for search entry"),r){var o=this._ensureThreadLabelVMLI(r,t.labelID);e.comparator&&!e.comparator(o)||e.each&&e.each(o)}}}},{key:"getRemoteAttachmentData",value:function(e){var t=this;if(i.default.Assert(e.hasField("accountID"),"Must have a valid accountID for a thread"),e.hasField("accountID")){this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,e,function(a,i){a?t._addRemoteEntry(e.getField("accountID"),a):(e.notifyDataRequestFailed(),t._notifyFailedRequest(e.getField("accountID"),i))})}else e.notifyDataRequestFailed()}},{key:"_updateThreadFromMessages",value:function(e){var t=0,a=this;i.default.Assert(!e.isDeleted||0===e.messages.length,"Should never run an update on a deleted thread with messages");var n=e.labelIds,r=i.default.getUserIdentifier();"me"===e.accountID&&"me"!==r&&(e.accountID=r),e.labelIds=[],e.date=void 0,e.participants=[],e.count=e.messages.length,e.snippet=e.count>0?e.messages[e.messages.length-1].snippet:"",e.hasPriority=!1;for(var o=0;o<e.messages.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e.messages[o];i.default.Assert(s.id,"Each message must have a valid ID"),e.labelIds.pushOnlyUniques(s.labelIds);var l=s.labelIds.indexOf(Ea.DRAFT)>=0,u=!1;if(s.labelIds.indexOf(Ea.SENT)>=0)for(var d=0,c=0;c<s.to.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h=s.to[c];if(this.isMyAccountID(h.email)){u=!0;break}}else u=!0;(!e.date||s.date&&e.date.isBefore(s.date)&&!l&&u)&&(e.date=s.date),(!e.internalDate||s.internalDate&&e.internalDate.isBefore(s.internalDate))&&(e.internalDate=s.internalDate),s.from&&e.participants.indexOfWithProperty("email",s.from.email)<0&&e.participants.push(s.from),s.resources instanceof ha?s.resources.forEachResource(function(t){a._displayAttachment(t,t.cid)&&(e.hasAttachments=!0)}):i.default.Assert(!1,"Message must always be a resource lib")}return e.date=e.date?new Date(e.date):new Date(0),i.default.isDateValid(e.date)||(e.date=new Date(0)),e.internalDate=e.internalDate?new Date(e.internalDate):new Date,i.default.isDateValid(e.internalDate)||(e.internalDate=new Date),e.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):e.date,i.default.isDateValid(e.lastModifiedDate)&&!e.lastModifiedDate.isBefore(e.date)||(e.lastModifiedDate=e.date),e.messages.length>0&&(e.subject=e.messages[0].subject,e.subjectLower=e.subject.toLowerCase(),e.from=e.messages[e.messages.length-1].from,e.to=e.messages[0].to),{labelsAdded:n?e.labelIds.removeArray(n):e.labelIds,labelsRemoved:n?n.removeArray(e.labelIds):void 0}}},{key:"_updateAttachmentFromMessages",value:function(e,t){var a=this._updateThreadFromMessages(e.getData());this._handleThreadLabelUpdates(e.getData(),a.labelsAdded,a.labelsRemoved),e.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],t)}},{key:"_createRemoteEntry",value:function(e,t){for(var a=0,n={id:t.id,accountID:e,messages:[],labelIds:[]},r=0;r<t.messages.length;++r){var o=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t.messages[r];i.default.Assert(s.id,"Message must have a valid id"),i.default.Assert(!s.labelIds||s.labelIds.indexOf(Ea.CHAT)<0,"Should never receive a chat message"),s.labelIds&&s.labelIds.indexOf(Ea.DRAFT)>=0&&this._notifyDraftMessage(e,t.id,s.id);for(var l={id:s.id,messageID:void 0,internalDate:s.internalDate?new Date(i.default.parseInt(s.internalDate)):new Date,snippet:s.snippet,labelIds:s.labelIds||[],to:[],resources:new ha,subject:""},u=0;u<s.payload.headers.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=s.payload.headers[u];switch(d.name.toUpperCase()){case"TO":l.to=this.parseEmailAddresses(d.value);break;case"FROM":l.from=this.parseEmailAddress(d.value);break;case"SUBJECT":l.subject=d.value;break;case"MESSAGE-ID":l.messageID=d.value;break;case"IN-REPLY-TO":l.inReplyTo=d.value;break;case"DATE":l.date=this.parseDateHeader(d.value),i.default.Assert(i.default.isDateValid(l.date),"Must have a valid message date: ",d.value)}}i.default.isDateValid(l.date)||(l.date=l.internalDate),l.subject||(l.subject=""),l.messageID||(l.messageID=i.default.generateTempId()),n.messages.push(l)}return this._updateThreadFromMessages(n),n}},{key:"_addRemoteEntry",value:function(e,t){var a=this._createRemoteEntry(e,t);if(this.hasCacheData(a.id)){var i=this.getCacheData(a.id);if(i){this._mergeThreadData(i,a);var r=this._updateThreadFromMessages(a);this._handleThreadLabelUpdates(a,r.labelsAdded,r.labelsRemoved)}var o=this.getChangedFields(i,a);if(this.cacheData(a.id,a,!!i,o),this.fieldsHaveParseEffect(o))if(this.hasAttachment(a.id))this.getAttachment(a.id).notifyDataMutated(o,n.a.ChangeType.Remote)}else this.cacheData(a.id,a),this._updateSearchPanes(a,a.labelIds,[]);return a}},{key:"cacheData",value:function(e,a,i,n){this._verifyMessageState(a,!1);var r=this._addEmailToSearchCache(e,a);if(Pa(Aa(t.prototype),"cacheData",this).call(this,e,a,i,n),a.messages&&this._checkUnsyncdMessageContent(a),r){var o=this.getDefaultItemStore();o&&o.updateItems()}}},{key:"cacheThreadData",value:function(e,t){this._verifyMessageState(t,!0),this._threadCache.cacheEntry(e,t)}},{key:"_verifyMessageState",value:function(e,t){}},{key:"createEntryFromLocal",value:function(e,t){var a=0;t.subjectLower=t.subject.toLowerCase(),t.messages=t.messages||[];for(var n=0;n<t.messages.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t.messages[n];if(i.default.isString(r.date)?r.date=this.parseDateHeader(r.date):r.date||(r.date=new Date),i.default.isString(r.internalDate)?r.internalDate=new Date(r.internalDate):r.internalDate||(r.internalDate=new Date),r.to||(r.to=[]),r.resources){var o=r.resources;if(o instanceof ha)r.resources=o.clone();else for(var s in r.resources=new ha,o)o.hasOwnProperty(s)&&r.resources.add(o[s])}else r.resources=new ha;i.default.Assert(r.draftID||r.messageID||i.default.isTempId(r.id),"Remotely saved messages must have a valid message ID"),i.default.Assert(i.default.isDateValid(r.date),"Must have a valid message date: ",r.date),i.default.Assert(i.default.isDateValid(r.internalDate),"Must have a valid internal message date: ",r.internalDate),!i.default.isTempId(r.id)&&!r.draftID&&r.labelIds&&r.labelIds.indexOf(Ea.DRAFT)>=0&&this._notifyDraftMessage(t.accountID,e,r.id),r.decoded&&this.reportTrackedStat(La.MessageDataCached)}return this._updateThreadFromMessages(t),t}},{key:"_updateMessageData",value:function(e,t,a){var r=e.getField("messages"),o=r.indexOfWithProperty("id",t);i.default.Assert(o>=0,"Must always be able to find the message being updated"),o>=0&&(this._mergeMessageData(r[o],a,["labelIds"]),r[o]=a,e.updateField("messages",r),this._updateAttachmentFromMessages(e,n.a.ChangeType.Remote))}},{key:"_mergeMessageData",value:function(e,t,a){if(i.default.Assert(i.default.isObject(e),"Must pass in a valid old message"),i.default.Assert(i.default.isObject(t),"Must pass in a valid new message"),e.modifiedOffline){var n=0,r=e.modifiedOffline;i.default.Assert(i.default.isArray(r),"Should not be receiving an update for an event that was created locally");for(var o=0;o<r.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t[r[o]]=e[r[o]]}t.modifiedOffline=e.modifiedOffline}if(a)for(var s=0,l=0;l<a.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e.hasOwnProperty(a[l])&&(t[a[l]]=e[a[l]])}for(var u in e)if(e.hasOwnProperty(u))switch(u){case"snippet":this._pendingDraftUpdates[e.id]&&(t[u]=e[u]);break;default:t.hasOwnProperty(u)||(t[u]=e[u])}}},{key:"_mergeMessagesData",value:function(e,t,a){var n=0;i.default.Assert(i.default.isArray(e),"Must have a valid old messages array"),i.default.Assert(i.default.isArray(t),"Must have a valid new messages array"),i.default.Assert(e!==t,"Should not pass in the same array for old and new");for(var r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e[r],s=t.indexOfWithProperty("id",o.id);if(s>=0){var l=t[s];i.default.Assert(l,"Must have a valid new message"),this._mergeMessageData(o,l,a)}else if(o.labelIds.indexOf(Ea.DRAFT)>=0)if(i.default.isTempId(o.id)){var u=t.indexOfWithProperty("messageID",o.inReplyTo);i.default.Assert(u>=0,"Must be able to find the message being replied to"),u>=0&&t.splice(u+1,0,o)}else if(o.inReplyTo){var d=t.indexOfWithProperty("inReplyTo",o.inReplyTo);if(d>=0){var c=t[d];i.default.Assert(c,"Must have a valid new message"),this._mergeMessageData(o,c,a)}}}}},{key:"_mergeThreadData",value:function(e,t){if(this.reportTrackedStat(La.MergeThread),i.default.Assert(!e.isDeleted,"Should never merge message data in a deleted thread"),this._mergeMessagesData(e.messages,t.messages,["resources","draftID"]),e.modifiedOffline){var a=0,n=e.modifiedOffline;i.default.Assert(i.default.isArray(n),"Should not be receiving an update for an event that was created locally");for(var r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=n[r];switch(o){case"messages":break;default:t[o]=e[o]}}t.modifiedOffline=e.modifiedOffline}for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s]);t.labelIds=e.labelIds}},{key:"_shouldCacheThread",value:function(e){for(var t=0,a=!0,i=0;i<e.messages.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.messages[i];if(n.labelIds&&(n.labelIds.indexOf(Ea.SPAM)>=0||n.labelIds.indexOf(Ea.CHAT)>=0)){a=!1;break}}return a}},{key:"_shouldCacheMessageData",value:function(e){var t=!1,a=this._getFullSyncTime(),i=this._getUnreadSyncTime();if(e.date.isAfter(a))t=!0;else if(e.date.isAfter(i))for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e.messages[r];if(this.isPriorityData(o)){t=!0;break}}return t}},{key:"refreshThreadCacheData",value:function(e,t,a,i,r){var o=this;this._requestRemoteThreadMetadata(e,t,void 0,function(a,s){if(a)if(o._shouldCacheThread(a)){var l=o._addRemoteEntry(e,a);o.cacheThreadData(t,o.serializeExternalData(l)),r&&r(!0)}else o._deleteCachedThread(e,t,r);else s&&s.error&&s.error.code===n.a.HTTPStatusCode.NotFound?o._deleteCachedThread(e,t,r):(i(e,t),r&&r(!1))})}},{key:"_deleteCachedThread",value:function(e,t,a){if(this.hasCacheData(t)){for(var r=0,s=this.getAttachment(t),l=s.getField("messages"),u=0;u<l.length;++u){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;xo.menus.isComposeOpenForEmail(l[u].id)&&(this._clearPendingDraftUpdate(s,l[u].id),o.a.fireEvent("EmailCompose","onClosed",[]),xo.menus.closeComposeEmail(s,l[u])),this._rawCache.removeEntry(l[u].id)}s.updateField("isDeleted",!0),s.updateField("messages",[]),this._updateAttachmentFromMessages(s,n.a.ChangeType.Remote)}this._threadCache.removeEntry(t,function(e){i.default.Assert(e,"Should be able to delete the thread from the local thread cache"),a&&a(e)})}},{key:"_deleteCachedMessage",value:function(e,t,a){var r=this;if(i.default.Assert(a,"Must specify a valid message ID to remove from thread"),this.hasCacheData(t))for(var o=0,s=this.getAttachment(t),l=s.getField("messages"),u=0;u<l.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(l[u].id===a){l.removeAt(u),this._updateAttachmentFromMessages(s,n.a.ChangeType.Remote),s.updateField("messages",l);break}}this._threadCache.getEntry(t,function(e){if(e)for(var i=0,n=0;n<e.messages.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.messages[n].id===a){e.messages.removeAt(n),r.cacheThreadData(t,e);break}}}),this._rawCache.removeEntry(a)}},{key:"setLastModifiedDate",value:function(e,t,a){var i=this;this.hasCacheData(t)&&this.getAttachment(t).updateField("lastModifiedDate",a);this._threadCache.getEntry(t,function(e){e&&(e.lastModifiedDate=a,i.cacheThreadData(t,e))})}},{key:"addLabelsToMessage",value:function(e,t,a,n,r){var o=this;if(this.hasCacheData(t)){for(var s=0,l=this.getAttachment(t),u=l.getField("messages"),d=0;d<u.length;++d){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if((!a||u[d].id===a)&&(u[d].labelIds.pushOnlyUniques(n),a))break}this._updateAttachmentFromMessages(l,r),l.updateField("messages",u)}this._threadCache.getEntry(t,function(e){if(e){for(var r=0,s=!1,l=0;l<e.messages.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!a||e.messages[l].id===a){e.messages[l].labelIds.pushOnlyUniques(n),o.cacheThreadData(t,e),s=!0;break}}i.default.Assert(s,"Must have found message to add labels to")}})}},{key:"removeLabelsFromMessage",value:function(e,t,a,n,r){var o=this;if(this.hasCacheData(t)){for(var s=0,l=this.getAttachment(t),u=l.getField("messages"),d=0;d<u.length;++d){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(!a||u[d].id===a){for(var c=0,h=0;h<n.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;u[d].labelIds.remove(n[h])}if(a)break}}this._updateAttachmentFromMessages(l,r),l.updateField("messages",u)}this._threadCache.getEntry(t,function(e){if(e){for(var r=0,s=!1,l=0;l<e.messages.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!a||e.messages[l].id===a){for(var u=0,d=0;d<n.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;e.messages[l].labelIds.remove(n[d])}o.cacheThreadData(t,e),s=!0;break}}i.default.Assert(s,"Must have found message to remove labels from")}})}},{key:"changeMessageAccount",value:function(e,t,a,n,r,o){i.default.Assert(o,"Must supply a valid from contact");var s=n!==e.getField("accountID"),l=this._findDraft(e,t,a);return s&&this.discardDraft(e,l.id,l.draftID,function(e){i.default.Assert(e,"Must successfully delete remote draft")}),l.from=o,l.replyTo=this.getReplyToAddress(o.email),l.decoded=sa.a.replaceSignature(l.decoded,this.getSignature(r)),s?this.createDraft(n,void 0,void 0,l):this.updateDraft(e,l.id,l.draftID,l,l.snippet,!0,!0,function(e){i.default.Assert(e,"Must be able to successfully update the draft when swiching sending accounts")})}},{key:"_ensureVMLIsForSearchResult",value:function(e,t){i.default.Assert(t,"Should never be ensuring a search VMLI in the default item store");var a="S~"+e.accountID,n=this._ensureVMLIsForAccount(a,t),r=this._createThreadID(a,"",e.id);if(!t.hasItem(r)){var o=t.createItem(r,this._getTextForItem(e),n.id);n.insertSorted(o,this.sortFn)}}},{key:"_removeVMLIFromSearchResult",value:function(e,t){i.default.Assert(t,"Should never be ensuring a search VMLI in the default item store");var a="S~"+e.accountID,n=this._createThreadID(a,"",e.id);t.hasItem(n)&&t.destroyItem(n)}},{key:"_createThreadID",value:function(e,t,a){return"T~"+e+"~"+t+"~"+a}},{key:"_getItemProps",value:function(e,t){var a;return t.isNamed(oi.PRI0)?a={priority:n.a.VMLIFlag.P0}:t.isNamed(oi.PRI1)?a={priority:n.a.VMLIFlag.P1}:t.isNamed(oi.PRI2)&&(a={priority:n.a.VMLIFlag.P2}),a}},{key:"_ensureThreadLabelVMLI",value:function(e,t,a){a=a||this.getDefaultItemStore();var i,n=this._getLabelByID(e.accountID,t),r=this._ensureVMLIsForLabel(e.accountID,n,a),o=this._createThreadID(e.accountID,t,e.id);if(this.reportTrackedStat(La.EnsureLabelVMLI),a.hasItem(o))i=a.getItem(o);else{this.reportTrackedStat(La.CreateLabelVMLI);var s=this._getItemProps(e,n);i=a.createItem(o,this._getTextForItem(e),r.id,s),r.insertSorted(i,this.threadSortFn,!1)}return i}},{key:"_removeThreadLabelVMLI",value:function(e,t,a,i){i=i||this.getDefaultItemStore();var n=this._createThreadID(e,a,t);i.hasItem(n)&&i.destroyItem(n)}},{key:"_getRequiredSearchLabels",value:function(e){for(var t=0,a=[Ea.INBOX],i=e.split(" "),n=0;n<i.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[n].split(":");r&&2===r.length&&("label"!==r[0]&&"category"!==r[0]&&"is"!==r[0]||a.push(r[1].toUpperCase()))}return a}},{key:"_handleThreadLabelUpdates",value:function(e,t,a){xo.PaneUpdateBatcher.beginUpdateItems();var i=!1;if(t)for(var n=0,r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i=this._addEmailLabelToSearchCache(e.accountID,e.id,t[r])||i}if(a)for(var o=0,s=0;s<a.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;i=this._removeEmailLabelFromSearchCache(e.accountID,e.id,a[s])||i}this._updateSpecialLabels(e),this._updateSearchPanes(e,t,a),i&&this.getDefaultItemStore().updateItems(),xo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSearchPanes",value:function(e,t,a){var n=this;xo.PaneUpdateBatcher.beginUpdateItems(),xo.PaneManager.runForEachPane(function(r){if(r.isSearchingRemote()){var o=n.getActiveItemStore(r.id),s=r.search.getRemoteValue(),l=n._getRequiredSearchLabels(s),u=!1,d=!1;l.forEach(function(e){a&&a.indexOf(e)>=0?u=!0:t&&t.indexOf(e)>=0&&(d=!0)}),u?o!==n.getDefaultItemStore()&&(i.default.focusedPane===r&&0===t.length&&a&&1===a.length&&a[0]===Ea.UNREAD||n._removeVMLIFromSearchResult(e,o)):d&&o!==n.getDefaultItemStore()&&n._ensureVMLIsForSearchResult(e,o)}},this.getPaneType()),xo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSpecialLabels",value:function(e){this._threadIsArchived(e)?this._addEmailLabelToSearchCache(e.accountID,e.id,ni):this._removeEmailLabelFromSearchCache(e.accountID,e.id,ni),this._addEmailLabelToSearchCache(e.accountID,e.id,ri)}},{key:"_ensureVMLIsForAccount",value:function(e,t){i.default.Assert(e,"Must specify a valid account ID");var a="A~"+e,n=(t=t||this.getDefaultItemStore()).getItem(a);if(!n){var r=t.getRoot();n=t.createItem(a,e,r.id),r.insertSorted(n,this.sortFn)}return n}},{key:"_ensureVMLIsForLabel",value:function(e,t,a){i.default.Assert(t,"Must specify a valid label"),i.default.Assert(t instanceof oa,"Must pass in a valid label object"),a=a||this.getDefaultItemStore();var r="L~"+e+"~"+t.getLabelID(),o=a.getItem(r),s=t.getDisplayText(!0);if(o)o.getParsedText()!==s&&o.setText(s,!0,n.a.ChangeType.Auto);else{var l;if(t.hasAncestors()){var u=this._getLabelByName(e,t.getParent().getRawName(),!0);l=u?this._ensureVMLIsForLabel(e,u,a):this._ensureVMLIsForAccount(e,a)}else l=this._ensureVMLIsForAccount(e,a);o=a.createItem(r,s,l.id),l.insertSorted(o,this.sortFn)}return o}},{key:"getVMLIForAccount",value:function(e){return this._ensureVMLIsForAccount(e)}},{key:"getVMLIForLabel",value:function(e,t){return this._ensureVMLIsForLabel(e,t)}},{key:"getLabelForVMLI",value:function(e){var t,a=this.getDescriptorForItem(e);return a.accountID&&a.labelID&&(t=this._getLabelByID(a.accountID,a.labelID)),t}},{key:"_getAccountIDFromItem",value:function(e){var t,a=e.id;return a.startsWith("R~")&&(a=a.substr(2)),a.startsWith("A~")?(t=a.substr(2)).startsWith("S~")&&(t=t.substr(2)):a.startsWith("L~")?t=a.substring(2,a.indexOf("~",2)):a.startsWith("T~")&&(t=a.substring(2,a.indexOf("~",2))),i.default.Assert(!t||t.indexOf("~")<0,"Should not contain delim in label ID"),t}},{key:"_getLabelIDFromItem",value:function(e){var t,a=e.id;return a.startsWith("L~")?t=a.substr(a.indexOf("~",2)+1):a.startsWith("T~")&&(t=a.substr(a.indexOf("~",2)+1)),i.default.Assert(!t||i.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in label ID"),i.default.Assert(!t||t.length>3,"Label ID should be longer than a couple of chars"),t}},{key:"_getThreadIDFromItem",value:function(e){return this._getThreadID(e.id)}},{key:"_getThreadID",value:function(e){var t;return e.startsWith("T~")?t=e.substr(e.lastIndexOf("~")+1):e.startsWith("A~")||e.startsWith("L~")||e.startsWith("R~")||(t=e),i.default.Assert(!t||i.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in thread ID"),i.default.Assert(!t||t.length>3,"Thread ID should be longer than a couple of chars"),t}},{key:"isAccountItem",value:function(e){return e.id.startsWith("A~")}},{key:"isLabelItem",value:function(e){return e.id.startsWith("L~")}},{key:"isThreadItem",value:function(e){return e.id.startsWith("T~")}},{key:"getAttachmentClass",value:function(){return["plugin_gmail"]}},{key:"googleScopes",value:function(){return[n.a.GScope.GmailModify,n.a.GScope.GmailCompose]}},{key:"getDependencies",value:function(){return[n.a.PluginDependency.GoogleLogin]}},{key:"verifyAuthorization",value:function(e){return!this.getSetting(this.Settings.IsEnabled)||this.isCurrentlyAuthorized(e)}},{key:"handleUnauthorized",value:function(e){this.removeSyncAccount(e)}},{key:"_activate",value:function(){var e=this;yt.a.onActiveUser(function(t){e.hasSyncAccount(t)||e.addSyncAccount(t)})}},{key:"_deactivate",value:function(){}},{key:"handleTapStart",value:function(){return!0}},{key:"handleTapClick",value:function(e,t,a,n){var r=n.target;if(i.default.Assert(t,"Gmail tapped but is not actually a pane",i.default.getElementPath(r)),t&&(f.a.isMobile||!this.isPluginPane(t)))return this.openEmailByItem(e,t)}},{key:"handleDoubleTap",value:function(e,t,a,i){return this.openEmailByItem(e,t),!0}},{key:"isMyAccountID",value:function(e){i.default.Assert("me"!==e||i.default.isDemoMode(),"Should not be checking me");var t=i.default.getUserIdentifier();return i.default.Assert(i.default.isDemoMode()||"me"!==t,"Should not be checking against current account until loaded"),e===t}},{key:"createURLForThread",value:function(e){var t=e.getField("accountID");return"me"===t&&(t=i.default.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"#all/"+e.id}},{key:"createPrintURLForThread",value:function(e){var t=e.getField("accountID");return"me"===t&&(t=i.default.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"/?ui=2&view=pt&search=all&th="+e.id}},{key:"openEmailByItem",value:function(e,t,a){var i=this,r=e.getAttachmentByPlugin(n.a.PluginID.Gmail);if((r&&r!==xo.EmailPreview.getThreadAttach()||!xo.EmailPreview.isOpenOnPane(this)||a)&&this.getCacheData(r.id))return this.isAttachmentDraftOnly(r)?(this.sendEvent("Tap_DesktopDraft"),this.loadThread(r,function(){xo.menus.openComposeEmail(i,r.id)})):xo.EmailPreview.open(e,r,t,a),!0}},{key:"_convertRawMessage",value:function(e,t,a,n){var r={id:t,payload:a},o=this._getMessageFromAttachment(e,t);i.default.Assert(o,"Must be able to get message metadata"),r.labelIds=o.labelIds,r.messageID=o.messageID,r.snippet=o.snippet,r.internalDate=a.internalDate,n(r)}},{key:"getThreadData",value:function(e,t,a){var i=this;if(0!==e.getField("messages").length)return this._getThreadData(e,t,a);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,void 0,function(r,o){var s=!0;r?i._addRemoteEntry(e.getField("accountID"),r):o&&o.error&&o.error.code===n.a.HTTPStatusCode.NotFound&&(s=!1),s?i._getThreadData(e,t,a):t(!1,"The conversation that you requested no longer exists.")})}},{key:"_getThreadData",value:function(e,t,a){for(var n=0,r=e.getField("messages"),o=r.length,s=0,l=!1,u={},d=function(){if(s===o&&l){for(var e=0,a={messages:[]},n=0,d=0;d<r.length;++d){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var c=u[r[d].id];c?a.messages.push(c):++n}i.default.Assert(a.messages.length+n===r.length,"Messages should always be found for thread"),0===r.length?t(void 0,"This message is not cached locally and we could not contact the remote server."):t(a)}},c=function(e){e&&(u[e.id]=e),++s,d()},h=0;h<r.length;++h){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var f=r[h];this.getMessageData(e,f.id,c)}l=!0,setTimeout(d.bind(this),0)}},{key:"getMessageData",value:function(e,t,a){var n=this;this._rawCache.getEntry(t,function(r){r?n._convertRawMessage(e,t,r,a):(i.default.log("Warning: Local message cache missing email display data: ",e.id,t),n._requestRemoteMessageDataRaw(e.getField("accountID"),e.id,t,a))})}},{key:"_handleThreadLoaded",value:function(e,t,a,n){var r=this._pendingThreadLoads[e];if(i.default.Assert(r,"Must always have a valid pending load when handling laod"),delete this._pendingThreadLoads[e],r)for(var o=0,s=0;s<r.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;try{r[s](t,a,n)}catch(l){i.default.reportError(l)}}}},{key:"loadThread",value:function(e,t){var a=this;i.default.Assert(0===this._loadThreadMutex,"Should never have an outstanding lock on thread load"),this._loadThreadMutex++;var r=e.getField("accountID");Ke.a.getAccountAuthToken(r,[n.a.GScope.GmailModify],function(i){i?a._loadThread(e,t,8e3):t(!1,!1,"This thread belongs to an account ("+e.getField("accountID")+") you are not authorized to access.")}),this._loadThreadMutex--}},{key:"_loadThread",value:function(e,t,a){var n=this,r=this.isAttachmentDraftOnly(e),o=this._pendingThreadLoads[e.id];if(o)i.default.log("Duped pending thread load: ",e.id),o.push(t);else if(this._pendingThreadLoads[e.id]=[t],e.getField("dataLoaded")||e.isLocalOnlyAttachment()){for(var s=0,l=e.getField("messages"),u=!1,d=!1,c=0,h=0,f=l.length,p=0,g=function(){u&&c===h&&(f===p&&(d=!0),setTimeout(function(){n._handleThreadLoaded(e.id,!0,d)},0))},m=function(t){if(h++,t){""===t.decoded&&(t.decoded=void 0);var a=n._parseMailMessage(t);i.default.Assert(a,"Must be able to parse message"),n._updateMessageData(e,a.id,a),d=!0}g()},v=0;v<l.length;++v){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var y=l[v];void 0===y.decoded?(y.decoded="",c++,this.getMessageData(e,y.id,m)):(y.decoded||y.labelIds.indexOf(Ea.DRAFT)>=0)&&p++}u=!0,g()}else if(r){var _=e.getField("messages")[0];this.getMessageData(e,_.id,function(t){if(t){var a=n._parseMailMessage(t);i.default.Assert(a,"Must be able to parse message"),n._updateMessageData(e,a.id,a)}d=!0,n._handleThreadLoaded(e.id,!0,d)})}else this.getThreadData(e,function(t,a){t&&n._parseMailThread(e,t),d=!0,n._handleThreadLoaded(e.id,!!e.getField("dataLoaded"),d,a)},a)}},{key:"forceReloadMessage",value:function(e,t,a){this._requestRemoteMessageData(e,t,a)}},{key:"_verifyEmailAttachments",value:function(e,t,a){var i,n,r=this,o=this._findDraft(e,t,a);return o?o.resources.forEachResource(function(e){e.uploader&&(e.uploader.hasError()?i="There was an error uploading one or more attachments. Please remove them or try uploading again.":e.uploader.isDone()||(i="One or more of your attachments is still uploading.",n=function(e){r.onEmailReadyToSend(o,function(){xo.toasts.clearMessage(e)})}))}):i="Could not find message to verify attachments.",i?{message:i,handleMessageFn:n}:void 0}},{key:"_verifyEmailRecipients",value:function(e,t,a){var n,r=this._findDraft(e,t,a);if(r)if(r.to&&0!==r.to.length)for(var o=0,s=0;s<r.to.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=r.to[s];l&&l.email?i.default.isEmail(l.email)||(n="You have entered an invalid email"):n="You have entered a contact with an invalid email address"}else n="You must enter at least one person to send this email to";else n="Unable to find the message you are trying to send";return n?{message:n}:void 0}},{key:"_formatAddressText",value:function(e,t,a){return e?a?'"'+i.default.encodeMIMEHeader(e)+'" <'+t+">":'"'+e+'" <'+t+">":t}},{key:"_createAddressTextFromTokens",value:function(e,t){var a="";if(e)for(var n=0,r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e[r];i.default.isEmail(o.email)&&(0!==r&&(a+=", "),a+=this._formatAddressText(o.text,o.email,t))}return i.default.Assert(!a.startsWith(","),"Should not start with a comma"),i.default.Assert(!a.endsWith(","),"Should not end with a comma"),i.default.Assert(a.indexOf(",,")<0,"Should not have two commas in a row"),a.trim()}},{key:"_createRFC822Message",value:function(e,t,a,n){var r=this;i.default.Assert(t,"Must specify a valid draft"),i.default.Assert(t.contentType,"Must specify a valid content type for the draft"),i.default.Assert(t.from,"Must be able to get the from information for a user."),i.default.Assert(!t.inReplyTo||t.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+t.inReplyTo),i.default.Assert(!t.references||t.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+t.references);var o=t.from.text,s=t.from.email,l=new da(this);l.updateFromDraft(e,t,o,s,a,function(){var e=l.generateBlob();n(r._encodeEmail(e))})}},{key:"createSignature",value:function(e){var t=this.getSignature(e);return t?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+t+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+t+"</div>":'<div class="gmail_signature"></div>'}},{key:"createReplyQuote",value:function(e){var t;e&&(t='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+e.date.toString("MMM dd, y")+" at "+e.date.toString("hh:mm tt")+", "+i.default.escape(this._createAddressTextFromTokens([e.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+e.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n");return t}},{key:"createForwardQuote",value:function(e){var t,a=i.default.isArray(e.to)?e.to:[e.to];return e&&(t='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+i.default.escape(this._createAddressTextFromTokens([e.from]))+"<br>\nDate: "+e.date.toString("ddd, MMM dd, y")+" at "+e.date.toString("hh:mm tt")+"<br>\nSubject: "+e.subject+"<br>\nTo: "+i.default.escape(this._createAddressTextFromTokens(a))+"\n<br>\n<br>\n"+e.decoded+"\n</div>\n<br>\n"),t}},{key:"createMessageBody",value:function(e,t,a){var r,o=this.createSignature(t);return a===n.a.EmailResponseMode.Reply||a===n.a.EmailResponseMode.ReplyAll?r=this.createReplyQuote(e):a===n.a.EmailResponseMode.Forward?r=this.createForwardQuote(e):i.default.Assert(!1,"Invalid email response mode: "+a),this.getSetting(this.Settings.InsertSignatureAboveReplies)?o+r:r+o}},{key:"_sendEmail",value:function(e,t,a,i){var n=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t);var r=this._findDraft(e,t,a);this._createRFC822Message(e.getData(),r,!0,function(t){var a={raw:t};e.isLocalOnlyAttachment()||(a.threadId=e.id);var o=Ve.a.fns("gmail").users.messages.send.packedFn,s={userId:e.getField("accountID"),resource:a};n._queueRemoteRequestMulti(e.getField("accountID"),o,s,function(t){n._updateLocalDraftFromSend(e,r.id,t,i)},function(t){n._notifySendFailed(),i(!1,t),n._notifyFailedRequest(e.getField("accountID"),t)},void 0,Va)})}},{key:"_shouldSaveMessageContent",value:function(e,t){return t.labelIds.indexOf(Ea.DRAFT)>=0}},{key:"compactCacheField",value:function(e,t){var a,n=0;switch(t){case"messages":a=[];for(var r=e[t],o={},s=function(e){var t=i.default.clone(e);delete t.data,delete t.size,delete t.uploader,o[e.id]=t},l=0;l<r.length;++l){var u=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var d=r[l],c={},h=0;h<si.length;++h){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;c[si[h]]=d[si[h]]}this._shouldSaveMessageContent(e,d)||(delete c.decoded,delete c.mimeType,delete c.contentType,delete c.listUnsubscribe),c.resources.forEachResource(s),c.resources=o,a.push(c)}break;default:a=e[t]}return a}},{key:"_generateUndoRedo",value:function(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,n.a.PluginAction.Gmail.DiscardDraft,{undo:i.default.emptyFn,redo:this.runDiscardDraft})}},{key:"performAction",value:function(e,t,a,n,r){var o;i.default.Assert(e,"Must supply a valid action"),i.default.Assert(i.default.isBoolean(t),"Invalid preventUndo param"),this.beginAction(t);var s=[a,n,r];try{o=this._undoStack.runAction(this.id,e,s)}catch(u){i.default.reportError(u)}if(this._undoStack.isUndoableAction()){var l=[a];i.default.isArray(o)?l.pushArray(o):l.push(o),this._undoStack.performAction(this.id,e,{undoParams:l,redoParams:s})}this.endAction()}},{key:"performActions",value:function(e,t){var a=0;this.beginAction(t);for(var i=0;i<e.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.performAction(e[i].action,!1,e[i].attach,e[i].param)}this.endAction()}},{key:"beginAction",value:function(e){this._undoStack.beginAction(e),A.e.beginAction()}},{key:"endAction",value:function(){this._undoStack.endAction(),A.e.endAction()}},{key:"handleUndo",value:function(){A.e.beginAction(),this._undoStack.undoAction(),A.e.endAction()}},{key:"handleRedo",value:function(){A.e.beginAction(),this._undoStack.redoAction(),A.e.endAction()}},{key:"supportOfflineCache",value:function(){return!0}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"usesPreviewCache",value:function(){return!0}},{key:"_matchParticipant",value:function(e,t){var a=!1;return e&&(e.text&&(a=e.text.toLowerCase().indexOf(t)>=0),!a&&e.email&&(a=e.email.toLowerCase().indexOf(t)>=0)),a}},{key:"_matchLabels",value:function(e,t){return this.hasLabelLike(e.accountID,e.id,t)}},{key:"_matchEntry",value:function(e,t){return e.subjectLower.indexOf(t)>=0||this._matchParticipant(e.from,t)||this._matchLabels(e,t)}},{key:"matchAttachment",value:function(e,t){return this._matchEntry(e.getData(),t)}},{key:"findMatchExact",value:function(){}},{key:"findMatchLike",value:function(e,t){var a=this,i=e.toLowerCase();return this.findCachedItemsByFn(function(e){return a._matchEntry(e,i)},t)}},{key:"isGmailItem",value:function(e){return!!e.getAttachmentByPlugin(this.id)}},{key:"itemHasLabelByID",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabelByID(a,t)}},{key:"itemHasLabel",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabel(a,t)}},{key:"itemHasFullLabel",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasFullLabel(a,t)}},{key:"itemHasDraft",value:function(e){return this.itemHasLabelByID(e,Ea.DRAFT)}},{key:"isItemUnread",value:function(e){return this.itemHasLabelByID(e,Ea.UNREAD)}},{key:"isItemImportant",value:function(e){return this.itemHasLabelByID(e,Ea.IMPORTANT)}},{key:"isItemStarred",value:function(e){return this.itemHasLabelByID(e,Ea.STARRED)}},{key:"isItemArchived",value:function(e){var t=e.getAttachmentByPlugin(this.id);return!!t&&this.attachmentIsArchived(t)}},{key:"isItemTrashed",value:function(e){return this.itemHasLabelByID(e,Ea.TRASH)}},{key:"isItemFullTrashed",value:function(e){return this.itemHasFullLabel(e,ii.TRASH)}},{key:"isItemSpam",value:function(e){return this.itemHasLabelByID(e,Ea.SPAM)}},{key:"isDisplayItem",value:function(e,t){var a=!1;return this.isItemSpam(e)||!this.isThreadItem(e)||this.isItemFullTrashed(e)&&!t||(a=!0),a}},{key:"getItemPriority",value:function(e){return e.hasPluginAttachment(this.id)?this.getAttachmentPriority(e.getAttachmentByPlugin(this.id)):0}},{key:"_getCompDateForItem",value:function(e){var t=0,a=e.getAttachmentByPlugin(this.id);if(a){var i=a.getField("lastModifiedDate");if(i)t=i.getTime();else{var n=a.getField("internalDate");n&&(t=n.getTime())}}return t}},{key:"_timeCompare",value:function(e,t){return e>t?1:e<t?-1:0}},{key:"threadSortFn",value:function(e,t){return this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"threadSortPriorityFn",value:function(e,t){var a=e.getAttachmentByPlugin(this.id),i=t.getAttachmentByPlugin(this.id),n=this.getAttachmentPriority(a),r=this.getAttachmentPriority(i),o=this.attachmentHasLabelByID(a,Ea.STARRED),s=this.attachmentHasLabelByID(i,Ea.STARRED);return n>r?-1:n<r?1:o&&!s?-1:s&&!o?1:this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"labelSortFn",value:function(e,t){return e.displayCompare(t)}},{key:"labelVMLISortFn",value:function(e,t){var a=this._getLabelByID(this._getAccountIDFromItem(e),this._getLabelIDFromItem(e)),i=this._getLabelByID(this._getAccountIDFromItem(t),this._getLabelIDFromItem(t));return this.labelSortFn(a,i)}},{key:"sortFn",value:function(e,t){return e.getParsedText().localeCompare(t.getParsedText())}},{key:"getCssClass",value:function(e,t){if(t&&t.type===this.getPaneType())return i.default.classNames({starred:this.attachmentHasLabelByID(e,Ea.STARRED)},{unread:this.attachmentHasLabelByID(e,Ea.UNREAD)},{p0:this.attachmentHasLabel(e,oi.PRI0)},{p1:this.attachmentHasLabel(e,oi.PRI1)},{p2:this.attachmentHasLabel(e,oi.PRI2)})}},{key:"getTotalMessageCount",value:function(e){var t=this._threadCache;t.onCacheReady(function(){t.count(e)})}},{key:"getUnsyncdMessageCount",value:function(){return this._numUnsyncdMessages}},{key:"getSyncdMessageCount",value:function(){return this._numSyncdMessages}},{key:"_checkUnsyncdMessageContent",value:function(e){for(var t=0,a=0;a<e.messages.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e.messages[a];i.cached?(this.reportTrackedStat(La.SyncdMessage),this._numSyncdMessages++):i.cachedError?this.reportTrackedStat(La.ErrorSyncdMessage):this._shouldCacheMessageData(e)?(this.reportTrackedStat(La.UnsyncdMessage),this._notifyUnsyncdMessage(e.accountID,e.id,i.id)):this.reportTrackedStat(La.OldUnsyncdMessage)}}},{key:"_notifyUnsyncdMessage",value:function(e,t,a){i.default.isTempId(t)||i.default.isTempId(a)||(this._handleSyncContentCacheOp(this._unsyncdMessages,e,t,a),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())}},{key:"_notifyContentCached",value:function(e,t,a){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,e,t,a)}},{key:"_handleSyncContentCacheOp",value:function(e,t,a,i){var n=this._ensureAccountLib(t,e);n[a]?!0!==n[a]&&n[a].indexOf(i)<0&&n[a].push(i):n[a]=!i||[i]}},{key:"_removeUnsyncdMessage",value:function(e,t,a){this.reportTrackedStat(La.MessagesSyncd),this._numUnsyncdMessages--;var n=this._getAccountLib(e,this._unsyncdMessages);if(a){var r=n[t];r.remove(a),0===r.length&&delete n[t]}else delete n[t];i.default.isEmpty(n)&&this._deleteAccountLib(e,this._unsyncdMessages)}},{key:"_setCachedFieldForMessage",value:function(e,t,a){var i=this;if(this.hasCacheData(t))for(var n=0,r=this.getAttachment(t).getField("messages"),o=0;o<r.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;(!0===a||a.indexOf(r[o].id)>=0)&&(r[o].cached=!0)}this._threadCache.getEntry(t,function(e){if(e){for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e.messages[r];(!0===a||a.indexOf(o.id)>=0)&&(o.cached=!0)}i.cacheThreadData(t,e)}})}},{key:"_updateCachedErrorFieldForMessage",value:function(e,t,a){var i=this;if(this.hasCacheData(t))for(var n=0,r=this.getAttachment(t).getField("messages"),o=0;o<r.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;(!0===a||a.indexOf(r[o].id)>=0)&&(r[o].cachedError?r[o].cachedError++:r[o].cachedError=1)}this._threadCache.getEntry(t,function(e){if(e){for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e.messages[r];(!0===a||a.indexOf(o.id)>=0)&&(o.cached?o.cachedError++:o.cachedError=1)}i.cacheThreadData(t,e)}})}},{key:"_processSyncdContent",value:function(){for(var e in this._pendingSyncdMessages)if(this._pendingSyncdMessages.hasOwnProperty(e)){var t=this._pendingSyncdMessages[e];for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];if(i.default.isArray(n)){for(var r=0,o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=n[o];this._removeUnsyncdMessage(e,a,s)}this._setCachedFieldForMessage(e,a,n)}else!0===n&&this._removeUnsyncdMessage(e,a)}}this._pendingSyncdMessages={}}},{key:"_processSyncErrors",value:function(e){for(var t in i.default.log("Process Sync Errors: ",e),e)if(e.hasOwnProperty(e)){var a=e[t];for(var n in a)if(a.hasOwnProperty(n)){var r=0,o=a[n];i.default.Assert(i.default.isArray(o),"Must have a valid message ID list");for(var s=0;s<o.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=o[s];this._removeUnsyncdMessage(t,n,l)}this._updateCachedErrorFieldForMessage(t,n,o)}}}},{key:"driveMessageContentSync",value:function(e){var t=this;this._rawCache.onCacheReady(function(){if(xo.cacheManager.hasReportedQuotaError())return e(!1);t._outstandingContentSync=!0,t._runMessageContentSync(35,function(a,n){if(!a)try{t._processSyncErrors(n)}catch(r){i.default.reportError(r)}return t._processSyncdContent(),t._outstandingContentSync=!1,e(!i.default.isEmpty(t._unsyncdMessages))})})}},{key:"_runMessageContentSync",value:function(e,t){var a=0,i=0,n=!1,r=0,o=0,s={},l=function(e,a,l){if(e?r++:(o++,s[a]=l),n&&r+o===i){var u=0===o;t(u,u?void 0:s)}},u=this.getSyncAccounts();for(var d in this._unsyncdMessages)if(u.indexOf(d)>=0&&(a+=this._syncMessageContentForAccount(d,this._unsyncdMessages[d],e-a,l),i++,a>=e))break;return n=!0,0===a&&setTimeout(function(){t(!0)},0),a}},{key:"_syncMessageContentForAccount",value:function(e,t,a,i){var n=0,r=0,o=0,s=0,l={},u=function(t,a,n){if(t?o++:(s++,l[a]=n),o+s===r){var u=0===s;i(u,e,u?void 0:l)}};for(var d in t)if(t.hasOwnProperty(d)&&(n+=this._syncMessageContentForThread(e,d,t[d],a-n,u),r++,n>=a))break;return n}},{key:"_syncMessageContentForThread",value:function(e,t,a,n,r){var o=this,s=0;if(i.default.isArray(a)){for(var l=0,u=!1,d=0,c=[],h=function(a,i){if(i?(d++,o._notifyContentCached(e,t,a)):c.push(a),u&&d+c.length===s){var n=0===c.length;r(n,t,n?void 0:c)}},f=0;f<a.length&&s<n;++f){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;this._requestRemoteMessageDataRaw(e,t,a[f],function(a,i,n){i?this._handleContentSyncdMessage(e,t,i,h.bind(this,a)):h.call(this,a,!1)}.bind(this,a[f])),s++}u=!0}else this._requestRemoteThreadDataRaw(e,t,function(a,i){a?o._handleContentSyncdThread(e,a,function(a){o._notifyContentCached(e,t),r(a,t)}):r(!1,t,!0)}),s++;return s}},{key:"_handleContentSyncdMessage",value:function(e,t,a,i){a.payload.id=a.id,a.payload.internalDate=a.internalDate,this._rawCache.cacheEntry(a.id,a.payload,i)}},{key:"_handleContentSyncdThread",value:function(e,t,a){for(var i=0,n=0;n<t.messages.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t.messages[n];this._handleContentSyncdMessage(e,t.id,r,a)}}},{key:"scheduleEmail",value:function(e,t){var a=this;A.e.beginAction();var r=e.getAttachmentByPlugin(this.id);i.default.Assert(r,"Must be able to get a valid attachment from item");var o=r.getField("subject"),s=this.createURLForThread(r),l=n.a.MSPerHour,u=i.default.vmMain.getDefaultCalendarPlugin();if(u){var d=u.getDefaultExportCalendarID();d&&(i.default.isDemoMode()||u.getSetting(u.Settings.WriteAccess))?u.createEventForEmail(d,o,s,t,l,function(e,t){e||t?t?(a.addLabelToAttachment(r,"Moo.do/Scheduled"),a.getSetting(a.Settings.ArchiveOnSchedule)&&a.archiveAttachment(r)):t||xo.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:n.a.MessageAction.Okay}):xo.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){xo.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:n.a.MessageAction.Okay})}})}):xo.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:n.a.MessageAction.OpenCalendarSettings})}else xo.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:n.a.MessageAction.OpenSettings});A.e.endAction()}},{key:"getIconForLabel",value:function(e){switch(e.getParsedText()){case"Inbox":return"inbox2";case"Starred":return"star";case"Important":return"exclamation";case"Sent Mail":return"send";case"Draft":return"drafts";case"Archived":return"inbox";case"Trash":return"delete";case"Primary":return"user";case"Social":return"group";case"Promotions":return"tag";case"Updates":return"flag";case"Forums":return"question_answer";case"Chat":return"chat";case"Spam":return"warning"}}}])&&Ca(a.prototype,r),s&&Ca(a,s),t}();function xi(e){return(xi="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oi(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ri(e,t){return!t||"object"!==xi(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fi(e){return(Fi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ni(e,t){return(Ni=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bi=1,Ui=3,Vi=4,ji=5,Hi=6,zi=7,qi=8,Wi=9,Gi=10,Ki=11,Yi=12,Xi=13,Qi="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)",Ji=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ri(this,Fi(t).call(this,n.a.PluginID.Moodo,"m","Moodo")))._isBuiltin=!0,e.setSetting(e.Settings.IsEnabled,!0,!1),e.useRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.Unknown),e.useRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.Unknown),e}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ni(e,t)}(t,ut),a=t,(r=[{key:"isPluginBlocked",value:function(){return!1}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"getRemoteAttachmentData",value:function(e){this.cacheData(e.id,{})}},{key:"runRemoteSingleRequest",value:function(e,t,a,i,n,r){var o=yt.a.getDefaultAccountID();this._queueRemoteRequestMulti(o,e,t,a,i,void 0,n||Bi,r)}},{key:"runRemotePagedRequest",value:function(e,t,a,i,n,r){n||(n={}),n.accountID=yt.a.getDefaultAccountID(),this._queuePagedRemoteRequest(e,t,a,i,void 0,r,n)}},{key:"drivePermissionsInsert",value:function(e,t,a,n,r){i.default.Assert(i.default.isEmail(t),"Should pass in a valid email address");var o=Ve.a.fns("drive").permissions.insert.packedFn,s={fileId:e,sendNotificationEmails:a,resource:{value:t,type:"user",role:"writer",withLink:!1}};this.runRemoteSingleRequest(o,s,n,r,Ui)}},{key:"drivePermissionsDelete",value:function(e,t,a,i){var n=Ve.a.fns("drive").permissions.delete.packedFn,r={fileId:e,permissionId:t};this.runRemoteSingleRequest(n,r,a,i,Vi)}},{key:"drivePermissionsList",value:function(e,t,a){var i=Ve.a.fns("drive").permissions.list.packedFn,n={fileId:e,fields:"items(id,name,role,type,emailAddress)"};this.runRemoteSingleRequest(i,n,t,a,ji)}},{key:"drivePermissionsPublic",value:function(e,t,a){var i=Ve.a.fns("drive").permissions.insert.packedFn,n={fileId:e,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this.runRemoteSingleRequest(i,n,t,a,Ui)}},{key:"driveFilesGet",value:function(e,t,a,i){var n=Ve.a.fns("drive").files.get.packedFn,r={fileId:e,fields:Qi};i&&i.props&&Object.assign(r,i.props),this.runRemoteSingleRequest(n,r,t,a,Hi)}},{key:"driveFilesExport",value:function(e,t,a,i){var n=Ve.a.fns("drive").files.export.packedFn,r={fileId:e,mimeType:"application/vnd.google-apps.drive-sdk.597847337936"};this.runRemoteSingleRequest(n,r,t,a,Hi,i)}},{key:"realtimeFileGet",value:function(e,t,a,i){var n=Ve.a.fns("drive").realtime.get.packedFn,r={fileId:e};this.runRemoteSingleRequest(n,r,t,a,Hi,i)}},{key:"driveFilesList",value:function(e,t,a,i){var n=Ve.a.fns("drive").files.list.packedFn,r={q:e,fields:"items(createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)),nextPageToken"};i&&i.props&&Object.assign(r,i.props),this.runRemotePagedRequest(n,r,t,a,i,zi)}},{key:"driveFilesTrash",value:function(e,t,a){var i=Ve.a.fns("drive").files.trash.packedFn,n={fileId:e};this.runRemoteSingleRequest(i,n,t,a,qi)}},{key:"driveFilesUntrash",value:function(e,t,a){var i=Ve.a.fns("drive").files.untrash.packedFn,n={fileId:e};this.runRemoteSingleRequest(i,n,t,a,qi)}},{key:"drivePropertiesInsert",value:function(e,t,a,i,n){var r=Ve.a.fns("drive").properties.insert.packedFn,o={fileId:e,resource:{key:t,value:a,visibility:"PRIVATE"}};this.runRemoteSingleRequest(r,o,i,n,Wi)}},{key:"drivePropertiesUpdate",value:function(e,t,a,i,n){var r=Ve.a.fns("drive").properties.update.packedFn,o={fileId:e,propertyKey:t,resource:{key:t,value:a,visibility:"PRIVATE"}};this.runRemoteSingleRequest(r,o,i,n,Gi)}},{key:"driveParentsInsert",value:function(e,t,a,i){var n=Ve.a.fns("drive").parents.insert.packedFn,r={fileId:e,resource:{id:t}};this.runRemoteSingleRequest(n,r,a,i,Ki)}},{key:"driveParentsDelete",value:function(e,t,a,i){var n=Ve.a.fns("drive").parents.delete.packedFn,r={fileId:e,parentId:t};this.runRemoteSingleRequest(n,r,a,i,Yi)}},{key:"driveChildrenList",value:function(e,t,a,i){var n=Ve.a.fns("drive").children.list.packedFn,r={folderId:e,fields:"items(id),nextPageToken"};this.runRemotePagedRequest(n,r,t,a,i,Xi)}}])&&Oi(a.prototype,r),o&&Oi(a,o),t}(),Zi=["SU","MO","TU","WE","TH","FR","SA"],$i=500,en=new Date(1401606e6);function tn(e){this._valid=!0,this._initData=e,this._maxCount=$i,i.default.isString(e)?this.fromString(e):i.default.isArray(e)?this.fromICal(e):e instanceof tn?(this._startDate=new Date(e._startDate),this._endDate=e._endDate?new Date(e._endDate):void 0,this._frequency=e._frequency,this._separation=e._separation,this._offsets=e._offsets?e._offsets.slice():void 0):i.default.isObject(e)?(i.default.Assert(e.type===n.a.DateType.Repeat,"Must have a valid date type set"),this._startDate=new Date(e.startDate),this._endDate=e.endDate?new Date(e.endDate):void 0,this._frequency=e.frequency,this._separation=e.separation||1,this._offsets=e.offsets):(i.default.Assert(!1,"Invalid object passed to RepeatDate constructor",e),this._valid=!1),this._startDate?(i.default.Assert(this._startDate instanceof Date,"Must be a valid date instance"),i.default.Assert(this._startDate.isAfter(en),"Start date must be after the minimum start date"),i.default.Assert(!this._endDate||this._endDate instanceof Date,"Must be a valid date instance"),i.default.Assert(!this._offsets||this._offsets.length>=1,"Must always store at least one offset if _offsets is defined",this._offsets),this._endDate&&(this._startDate.isBefore(this._endDate)||this._startDate.equals(this._endDate)||(this._valid=!1,i.default.Assert(!1,"Start date must always be before the end date")))):this._valid=!1,this._doneGenerating=!this._valid,this._cache=[],this._cacheDate=new Date(this._startDate)}tn.prototype={isValid:function(){return this._valid},_isValidDate:function(e){return e&&e instanceof Date},setStartDate:function(e){i.default.Assert(e,"Must provide a valid date"),this._startDate=new Date(e),this._endDate&&(this._startDate.isBefore(this._endDate)||this._startDate.equals(this._endDate)||(this._valid=!1,i.default.Assert(!1,"Start date must always be before the end date"))),this._resetCache()},getStartDate:function(){return this._startDate},getEndDate:function(){return this._endDate},_isBeforeEnd:function(e){i.default.Assert(this._isValidDate(e),"Must provide a valid date: ",e);var t=this._cache.length<this._maxCount,a=!this._endDate||(e.isBefore(this._endDate)||e.equals(this._endDate));return t&&a},_resetCache:function(){this._cache=[],this._cacheDate=new Date(this._startDate),this._doneGenerating=!this._valid},_getNext:function(e){return this._cache.length<e&&this._generate(e),this._cache.slice(0,e)},_generateUntil:function(e){var t=0;i.default.Assert(this._isValidDate(e),"Must provide a valid date to generate until: ",e);for(var a=!1,n=0;!this._doneGenerating&&(!this._getLastCachedDate()||this._getLastCachedDate().isBefore(e))&&n<50;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._generateNext(1),a=!0,n++}return a},_generateNext:function(e){i.default.Assert(e>0,"Must request a valid number of additional dates"),this._generate(this._cache.length+e)},_doGenerateInstance:function(e,t,a){var r=!1;switch(t){case n.a.RepeatFreq.Weekly:r=e.getDay()<=a;break;case n.a.RepeatFreq.DayOfMonth:r=e.getDate()<=a;break;default:i.default.Assert(!1,"Invalid repeat frequency for offset dates",t)}return r},_generate:function(e){var t=0,a=0;i.default.Assert(e>0,"Must request a valid number of dates"),i.default.Assert(e<this._maxCount,"Must request less than maxCount dates");var r=new Date(this._cacheDate);e=Math.min(e,this._maxCount);for(var o=0;o<e&&this._cache.length<e&&this._isBeforeEnd(r);){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._offsets)for(var s=0,l=0;l<this._offsets.length&&this._cache.length<e;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=this._offsets[l],d=new Date(r);if(this._doGenerateInstance(d,this._frequency,u)){switch(this._frequency){case n.a.RepeatFreq.Weekly:d.addDays(u-d.getDay());break;case n.a.RepeatFreq.DayOfMonth:d.addDays(u-d.getDate());break;default:i.default.Assert(!1,"Invalid repeat frequency for offset dates",this._frequency)}var c=this._cache[this._cache.length-1];!this._isBeforeEnd(d)||c&&!d.isAfter(c)?this._isBeforeEnd(d)||(this._doneGenerating=!0):this._cache.push(d)}}else{d=new Date(r),c=this._cache[this._cache.length-1];if(!this._isBeforeEnd(d)||c&&!d.isAfter(c))return void(this._isBeforeEnd(d)||(this._doneGenerating=!0));this._cache.push(d)}switch(this._frequency){case n.a.RepeatFreq.Daily:r.addDays(this._separation);break;case n.a.RepeatFreq.Weekly:this._offsets&&this._offsets.length>1&&r.getDay()!==this._offsets[0]&&r.moveToDayOfWeek(this._offsets[0],-1),r.addWeeks(this._separation);break;case n.a.RepeatFreq.Monthly:r.addMonths(this._separation);break;case n.a.RepeatFreq.NthMonthInst:var h=this._startDate.getDay(),f=Math.ceil(this._startDate.getDate()/7);r.addMonths(this._separation),4!==f&&5!==f||(f=-1),r.moveToNthOccurrence(h,f);break;case n.a.RepeatFreq.Yearly:r.addYears(this._separation);break;case n.a.RepeatFreq.EndOfMonthOffset:r.addMonths(this._separation);var p=this._startDate.getDate(),g=this._startDate.getDaysInMonth()-p;r.setDate(r.getDaysInMonth()-g);break;case n.a.RepeatFreq.DayOfMonth:for(l=0;l<this._separation;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.getNextValidMonth(r,this._startDate.getDate())}break;case n.a.RepeatFreq.Once:default:return i.default.Assert(!1,"Invalid repeat frequency"),void(this._doneGenerating=!0)}this._cacheDate=r,o++}this._isBeforeEnd(r)||(this._doneGenerating=!0)},getNextValidMonth:function(e,t){(i.default.Assert(this._isValidDate(e),"Must provide a valid date: ",e),e.addMonths(1),e.getDate()!==t)&&(t>e.getDaysInMonth()&&(e.addMonths(1),e.setDate(t)))},includesDate:function(e){for(var t=0,a=this.getDates(!1),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].clone().clearTime().equals(e))return!0}return!1},getDates:function(e){i.default.Assert(this._valid,"Must not call getDates with invalid RepeatDate: ",this._initData);var t=new Date;this._generate(4),this._generateUntil(t);var a=this._cache.findInsertIndex(t,Date.compare),n=this._cache.length-a;n<4&&this._generateNext(4-n);var r=e?Math.max(a,0):Math.max(a-3,0),o=Math.min(a+4,this._cache.length);return this._cache.slice(r,o)},getDateOnDay:function(e){if(i.default.Assert(i.default.isDateValid(e),"Day is not valid",e),e){var t=this._cache.findInsertIndex(e,Date.compare);return this._cache[t]}},next:function(e){if(e>0)return this._getNext(e)},nextIndex:function(e){i.default.Assert(this._valid,"Must not call nextIndex with invalid RepeatDate: ",this._initData),i.default.Assert(!e||this._isValidDate(e),"Must provide a valid from date",e);var t=e?new Date(e):this._startDate;if(this._generateUntil(t))return this._cache.length-1;for(var a=0,n=0;n<this._cache.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this._cache[n].isAfter(t)||this._cache[n].equals(t))return n}return this._generateNext(1),this._cache.length-1},nextComplete:function(e){i.default.Assert(this._valid,"Must not call nextComplete with invalid RepeatDate: ",this._initData),i.default.Assert(!e||this._isValidDate(e),"Must provide a valid from date",e);var t=this.nextIndex(e);return this._cache[t]},nextActive:function(e){i.default.Assert(this._valid,"Must not call nextActive with invalid RepeatDate: ",this._initData),i.default.Assert(!e||this._isValidDate(e),"Must provide a valid from date",e);var t=this.nextIndex(e);return this._cache.length<=t+1&&this._generateNext(1),this._cache[t+1]},_getLastCachedDate:function(){return this._cache[this._cache.length-1]},hasTimeOfDay:function(){return!!this._valid&&this._startDate.hasTimeOfDay()},isRepeatDate:function(){return!0},getTimeOfDay:function(){return this._valid?this._startDate.getTimeOfDay():0},getTime:function(e){return this._valid?this._startDate.toString(e):""},equals:function(e){if(this._valid){if(i.default.isString(e))return this.toString()===e;if(e instanceof tn){if(e._valid){var t=!isNaN(this._startDate)&&!isNaN(e._startDate)&&this._startDate.equals(e._startDate),a=this._endDate?this._endDate.equals(e._endDate):this._endDate===e._endDate,r=this._frequency===e._frequency,o=this._separation===e._separation,s=this._offsets?this._offsets.equals(e._offsets):this._offsets===e._offsets;return t&&a&&r&&o&&s}}else if(i.default.isObject(e)){i.default.Assert(e.type===n.a.DateType.Repeat,"Must have a valid date type set");var l=new Date(e.startDate);i.default.Assert(this._isValidDate(l),"Must provide a valid comp date",l);var u=!isNaN(this._startDate)&&!isNaN(l)&&this._startDate.equals(l),d=this._endDate==(e._endDate?new Date(e._endDate):void 0),c=this._frequency===e.frequency,h=this._separation===e._separation,f=this._offsets?this._offsets.equals(e._offsets):this._offsets===e._offsets;return u&&d&&c&&h&&f}}return!1},fromString:function(e){try{var t=e.split("|"),a=t[0];if("1"===a){if(this._startDate=new Date(parseInt(t[1])),this._endDate=t[2]?new Date(parseInt(t[2])):void 0,this._frequency=parseInt(t[3]),this._separation=parseInt(t[4]),i.default.Assert(i.default.isNumber(this._frequency),"Invalid frequency",t[3]),i.default.Assert(i.default.isNumber(this._separation),"Invalid frequency",t[4]),this._offsets=void 0,t[5]){var n=t[5].split(",");if(n.length>0){var r=0;this._offsets=[];for(var o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=parseInt(n[o]);i.default.Assert(i.default.isNumber(s),"Date offsets must be valid numbers",n[o]),this._offsets.push(s)}}}(!this._isValidDate(this._startDate)||this._endDate&&!this._isValidDate(this._endDate))&&(i.default.Assert(!1,"Invalid start or end date parsing from string",this._startDate,this._endDate),this._valid=!1)}else i.default.Assert(!1,"Unknown repeated date version: ",a),this._valid=!1}catch(l){this._valid=!1,i.default.reportError(l)}this._resetCache()},toString:function(){if(this._valid){var e=this._startDate.getTime(),t=this._endDate?this._endDate.getTime():"",a=this._offsets&&this._offsets.length>1?this._offsets.join(","):"";return"1|"+e+"|"+t+"|"+this._frequency+"|"+this._separation+"|"+a}},toICal:function(){var e=0,t=[],a={};if(this._valid){switch(this._startDate&&t.push("DTSTART:"+this._startDate.getTime()+"Z"),this._endDate&&(a.UNTIL=this._endDate.getTime()+"Z"),this._frequency){case n.a.RepeatFreq.Daily:a.FREQ="DAILY";break;case n.a.RepeatFreq.Weekly:a.FREQ="WEEKLY";for(var r=this._startDate.clone(),o=[Zi[r.getDay()]],s=0;s<this._offsets.length;++s){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r.moveToDayOfWeek(this._offsets[s]),o.push(Zi[r.getDay()])}a.BYDAY=o.toString();break;case n.a.RepeatFreq.Monthly:a.FREQ="MONTHLY";break;case n.a.RepeatFreq.DayOfMonth:a.FREQ="MONTHLY",a.BYMONTHDAY=this._startDate.getDate();break;case n.a.RepeatFreq.Yearly:a.FREQ="YEARLY";break;case n.a.RepeatFreq.EndOfMonthOffset:a.FREQ="MONTHLY",a.BYMONTHDAY=-this._startDate.getDate();break;case n.a.RepeatFreq.NthMonthInst:a.FREQ="MONTHLY",a.BYDAY=Zi[this._getStartDate.getDay()],a.BYSETPOS=Math.ceil(this._getStartDate.getDate()/7);break;default:i.default.Assert(!1,"Invalid repeat date frequencey: "+this._frequency)}a.INTERVAL=this._separation;var l="RRULE:";for(var u in a)l+=u+"="+a[u]+";";t.push(l)}return t},_handleICalString:function(e,t){for(var a=0,i=e.split(";"),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i[n].split("=");t(r[0],r[1])}},_handleDTSTART:function(e){i.default.Assert(e.endsWith("Z"),"Timestamp must be in UTC time: "+e),i.default.log("DTSTART: ",e),this._startDate=new Date(parseInt(e.slice(0,-1))),i.default.Assert(this._startDate,"Must have a valid start date: "+e)},_handleRRULE:function(e){this._handleICalString(e,function(e,t){var a=0;switch(i.default.log("RRULE: ",e,"->",t),e){case"FREQ":switch(t){case"DAILY":this._frequency=n.a.RepeatFreq.Daily;break;case"WEEKLY":this._frequency=n.a.RepeatFreq.Weekly;break;case"MONTHLY":this._frequency=n.a.RepeatFreq.Monthly;break;case"YEARLY":this._frequency=n.a.RepeatFreq.Yearly;break;case"SECONDLY":case"MINUTELY":case"HOURLY":default:i.default.Assert(!1,"Invalid RRULE FREQ value: ",t)}break;case"UNTIL":i.default.Assert(t.indexOf("T")<0,"Do not currently support date-time");var r=t.substring(0,4),o=t.substring(4,6),s=t.substring(6,8);this._endDate=new Date(r,o,s);break;case"COUNT":this._maxCount=parseInt(t);break;case"INTERVAL":this._separation=parseInt(t);break;case"BYDAY":var l=t.split(",");this._offsets=[];for(var u=0;u<l.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var d=Zi.indexOf(l[u]);d>=0?this._offsets.push(d):this._offsets.push(parseInt(l[u]))}break;case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYMONTH":case"BYSETPOS":case"WKST":break;case"BYSECOND":case"BYMINUTE":case"BYHOUR":default:i.default.Assert(!1,"Invalid RRULE action: ",e)}})},_handleEXRULE:function(e){this._handleICalString(e,function(e,t){i.default.log("EXRULE: ",e,"->",t)})},_handleRDATE:function(e){this._handleICalString(e,function(e,t){i.default.log("RDATE: ",e,"->",t)})},_handleEXDATE:function(e){this._handleICalString(e,function(e,t){i.default.log("EXDATE: ",e,"->",t)})},fromICal:function(e){var t=0;i.default.Assert(2===e.length,"Only handle single instance RRULE with added DTSTART");for(var a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[a].split(":"),r=n[0],o=n[1];switch(r){case"DTSTART":this._handleDTSTART(o);break;case"RRULE":this._handleRRULE(o);break;case"EXRULE":this._handleEXRULE(o);break;case"RDATE":this._handleRDATE(o);break;case"EXDATE":this._handleEXDATE(o);break;default:i.default.Assert(!1,"Invalid recurrence rule: "+r)}}},getHours:function(){return this._startDate.getHours()},getMinutes:function(){return this._startDate.getMinutes()}};var an=tn;function nn(e){return(nn="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rn(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function on(e,t,a){return(on="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=sn(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function sn(e){return(sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function un(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var dn,cn=1,hn=4,fn=["description","end","start","status","summary","extendedProperties"],pn="syncTokens",gn="calendarList",mn={IsComplete:"isComplete",Priority:"priority",IsStarred:"isStarred",IsArchived:"isArchived"},vn=["modifiedOffline"],yn=2,_n=3,bn=4,kn=6,wn=7,Sn=8,In=9,Dn=10,Cn=11,Pn=12,An=13,Mn=14,Tn=n.a.DefaultEventDuration,En=function(e){function t(){var e,a,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,(e=!(r=sn(t).call(this,n.a.PluginID.GCalendar,"c","Calendar"))||"object"!==nn(r)&&"function"!==typeof r?un(a):r).pluginMargin=4,e.pluginPadding=14,e._requiresOfflineAuth=!0,e._numEntriesSyncd=0,e._calendarList={},S.a.binder(un(un(e)),"_flushEventUpdateQueue","_purgeOldData","parsePriority","runCalendarListSync","runCalendarSync","createEventForItem"),e.registerSetting("WriteAccess","writeAccess","w",!0,!0),e.registerSetting("ImportCalendars","importCalendars","i",!0),e.registerSetting("ExportCalendar","exportCalendar","x",!0),e.registerSetting("WeeksPast","weeksPast","p",!0,cn),e.registerSetting("WeeksFuture","weeksFuture","f",!0,hn),e.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda","o",!0,!1),e.registerSetting("SyncNewEvents","syncNewEvents","n",!0,!0),e.registerSetting("SyncDraggedEvents","syncDraggedEvents","d",!0,!0),e.registerSetting("CreateLocalEvents","createLocalEvents","l",!0,!0),e._updateSyncTimes(),e._eventCache=e.registerLocalCache("EventCache",n.a.StorageType.IndexedDB,!0),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._purgeOldData),e.declareProperty("isInvalid",n.a.PluginLoad.Runtime,!0,!1),i.default.isDemoMode()?e.declareProperty("calendarID",n.a.PluginLoad.Preview|n.a.PluginLoad.Full|n.a.PluginLoad.Inline,!0,"me"):e.declareProperty("calendarID",n.a.PluginLoad.Preview|n.a.PluginLoad.Full|n.a.PluginLoad.Inline),e.declareProperty("summary",n.a.PluginLoad.Preview|n.a.PluginLoad.Full),e.declareProperty("status",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,"confirmed"),e.declareProperty("startTime",n.a.PluginLoad.Preview|n.a.PluginLoad.Full),e.declareProperty("endTime",n.a.PluginLoad.Preview|n.a.PluginLoad.Full),e.declareProperty("allDayEvent",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,!1),e.declareProperty("recurringEventId",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0),e.declareProperty("eid",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0),e.declareProperty("isComplete",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,!1),e.declareProperty("isArchived",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,!1),e.declareProperty("isStarred",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,!1),e.declareProperty("priority",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,n.a.VMLIFlag.None),e.declareProperty("locked",n.a.PluginLoad.Preview|n.a.PluginLoad.Full,!0,!1),e.declareProperty("modifiedOffline",n.a.PluginLoad.Full,!0,!1),e.declareProperty("source",n.a.PluginLoad.Full,!0),e.declareProperty("location",n.a.PluginLoad.Full,!0),e.declareProperty("description",n.a.PluginLoad.Full,!0),e.declareProperty("attendees",n.a.PluginLoad.Full,!0),e.declareProperty("organizer",n.a.PluginLoad.Full,!0),e.useRenderer(n.a.PluginRenderTypes.StyledText,n.a.PluginRenderers.CalendarEvent),e.useRenderer(n.a.PluginRenderTypes.UnstyledText,n.a.PluginRenderers.CalendarEvent),e.useRenderer(n.a.PluginRenderTypes.Measure,n.a.PluginRenderers.CalendarEvent),e._pendingCreates={},e._syncingOfflineChanges=!1,e._hasInitializedTasks=!1,e._purgeOldDataTimeout=void 0,e._eventUpdateTimeout=void 0,e._eventUpdateQueue={},e._propConverter={},e._propConverter[mn.IsComplete]=i.default.parseDate,e._propConverter[mn.IsArchived]=i.default.parseBoolean,e._propConverter[mn.IsStarred]=i.default.parseBoolean,e._propConverter[mn.Priority]=e.parsePriority,e}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(t,ut),a=t,(r=[{key:"getType",value:function(){return n.a.PluginType.Calendar}},{key:"_attachMetadataFields",value:function(){return vn}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"useItemStore",value:function(){return"Google Calendar"}},{key:"itemStoreOptions",value:function(){return{listenToItemStateChanged:!0,enabledFilters:n.a.ItemStoreFilter.Dates}}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"supportOfflineCache",value:function(){return!0}},{key:"usesPreviewCache",value:function(){return!0}},{key:"googleScopes",value:function(){return this.getSetting(this.Settings.WriteAccess)?[n.a.GScope.Calendar]:[n.a.GScope.CalendarRO]}},{key:"getDependencies",value:function(){return[n.a.PluginDependency.PremiumSub,n.a.PluginDependency.GoogleLogin]}},{key:"hasSettingsError",value:function(){return!1}},{key:"verifyAuthorization",value:function(e){var t=this.googleScopes();return Ke.a.isAuthorizedForScopes(e,t)}},{key:"getBlockedText",value:function(){return""}},{key:"computeBatchGroupID",value:function(e){var t="me";return e.data&&e.data.calendarId&&(t=e.data.calendarId),t}},{key:"_serializeDate",value:function(e){return e instanceof Date?e.toISOString():i.default.isNumber(e)?new Date(e).toISOString():e}},{key:"compactCacheField",value:function(e,t){var a;switch(t){case"startTime":case"endTime":a=this._serializeDate(e[t]);break;default:a=e[t]}return a}},{key:"_updateSyncTimes",value:function(){var e=-(this.getSetting(this.Settings.WeeksPast)||cn),t=this.getSetting(this.Settings.WeeksFuture)||hn;i.default.Assert(i.default.isNumber(e)&&e<=0,"Invalid value for weeksPast: ",e),i.default.Assert(i.default.isNumber(t)&&t>=0,"Invalid valid for weeksFuture: ",t);var a=Math.min(-7,e),n=Math.max(20,t);this._minSyncStartTime=(new Date).clearTime().addWeeks(a),this._maxSyncStartTime=(new Date).clearTime().addWeeks(n),this._syncTokenDuration=i.default.weeks(10),this._minDisplayStartTime=(new Date).clearTime().addWeeks(e),this._maxDisplayStartTime=(new Date).clearTime().addWeeks(t),i.default.Assert(this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}},{key:"_shouldDisplayTime",value:function(e,t){return t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime||e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime}},{key:"_filterDates",value:function(e,t,a){return function(i){var n=new Date(i[e]);return n>=t&&n<=a}}},{key:"_getEndClearTime",value:function(){return this._minDisplayStartTime.clone().addDays(-1)}},{key:"_purgeOldData",value:function(e){var t=this;this._eventCache.onCacheReady(function(){t._eventCache.getFilterEntries(t._filterDates("startTime",new Date(0),t._getEndClearTime()),function(a){if(a){var n=0;i.default.log("Removing "+a.length+" old calendar entries.");for(var r=0;r<a.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t._eventCache.removeEntry(a[r].id)}}e&&e(!1)})})}},{key:"_offlineLoad",value:function(){var e=this;if(this.isEnabled())return this._eventCache.onCacheMetadataReady(function(){e._eventCache.getMetadata(gn,function(t){i.default.isEmpty(e._calendarList)&&(e._calendarList=t||{}),e._eventCache.onCacheReady(function(){var t=e._filterDates("startTime",e._minDisplayStartTime,e._maxDisplayStartTime),a=function(a,r){i.default.batchRenderUpdates(function(){var o=0;xo.PaneUpdateBatcher.beginUpdateItems();for(var s=e.getDefaultItemStore(),l=s.getRoot(),u=0;u<a.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=a[u];if(!r||t(d)){var c=e.createEntryFromLocal(d.id,d);if(e.cacheData(c.id,c,void 0,void 0,n.a.ChangeType.Auto),i.default.Assert(!s.hasItem(c.id),"Load should never try to create a VMLI that has already been created"),e._eventNeedsItem(c)){if(c.source){var h=xo.pluginManager.parseEmailURL(c.source.url);if(h.plugin&&!h.plugin.hasCacheData(h.threadID)){var f=h.plugin.createEntryFromLocal(h.threadID,{accountID:h.accountID,subject:c.source.title});h.plugin.cacheData(h.threadID,f)}}var p=e._createItem(s,c,l.id);l.insertItem(p)}}}xo.PaneUpdateBatcher.commitUpdateItems(),e._cacheCleanup.notifyWorkAvailable()})};e._eventCache.requestPreloadData(function(n){i.default.isArray(n)?a(n,!0):e._eventCache.getFilterEntries(t,a)})})})}),!0}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){xo.PaneUpdateBatcher.beginUpdateItems(),this._hasInitializedTasks=!1,xo.PaneUpdateBatcher.updateAllItems(!0,!0),xo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_load",value:function(){!i.default.isDemoMode()&&this.isEnabled()&&(this.createRecurringTask("CalendarListSync",{delay:i.default.hours(2),minDelay:i.default.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runCalendarListSync}),this.createRecurringTask("CalendarEventSync",{delay:i.default.minutes(15),minDelay:i.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runCalendarSync}),this._hasInitializedTasks=!0)}},{key:"goOnline",value:function(){this._hasInitializedTasks&&this.getRecurringTask("CalendarEventSync").forceUpdate()}},{key:"handleTapStart",value:function(e,t,a,i){return f.a.isMobile&&i.preventDefault(),!0}},{key:"handleTapClick",value:function(e,t,a,r){var o=this.getCacheData(a);if(o){var s=this.getAttachment(a),l=s.getField("calendarID"),u=this._getCalendarInfo(l);if(u&&i.default.Assert(u.accountID,"Should have an accountID on the calendar"),o.eid&&u.accountID){var d="https://www.google.com/calendar/event?eid="+o.eid+"&authuser="+u.accountID;if(f.a.isMobile){var c=this.createDisplayElement(s).text;r.preventDefault(),i.default.preventClick(),xo.menus.openMenuExternalApp(c,function(){i.default.openUrl(d,r)}),this.sendEvent("Tap_OpenGCalendarMobile")}else i.default.isDemoMode()?xo.toasts.pushMessage(n.a.MessageID.DemoPluginClick):(i.default.openUrl(d,r),this.sendEvent("Tap_OpenGCalendarDesktop"))}return!0}return!1}},{key:"_durationToString",value:function(e){var t=Math.round(e/6e4),a=0,i=0;t>0&&(t-=60*(a=Math.floor(t/60)),a>0&&(a-=24*(i=Math.floor(a/24))));var n="";return i>0&&(n+=i+"d "),a>0&&(n+=a+"h "),t>0&&(n+=t+"m "),n.trim()}},{key:"_createItemDateText",value:function(e){return e.allDayEvent?e.startTime.toString(xo.International.getFormat(n.a.DFormat.MonthDayYear)):e.startTime.toString(xo.International.getFormat(n.a.DFormat.DayYearTime))}},{key:"_createItemDurationText",value:function(e){var t,a=e.endTime-e.startTime;if(e.allDayEvent)if(a>i.default.days(1)){var r=e.endTime.clone();r.addMilliseconds(-1),t="until "+r.toString(xo.International.getFormat(n.a.DFormat.MonthDayYear))}else t="";else t=this._durationToString(a);return t}},{key:"_createItemSummaryText",value:function(e){var t;if(e.source&&e.source.url){var a=xo.pluginManager.parseEmailURL(e.source.url);a.plugin&&(t=a.plugin._getTextForItem({id:a.threadID}))}return t||(t=e.summary?e.summary.replace(/\u2000/g,""):""),t}},{key:"_createItemText",value:function(e){return i.default.Assert(e,"Must specify a valid attachment"),this._createItemSummaryText(e)}},{key:"_eventNeedsItem",value:function(e){return"cancelled"!==e.status&&!e.isArchived}},{key:"_createItem",value:function(e,t,a){var r;i.default.Assert(this._eventNeedsItem(t),"Item must always be required to cause create"),i.default.isDateValid(t.isComplete)&&(r=t.isComplete);var o=!t.allDayEvent&&t.endTime-t.startTime||void 0,s={date:new z.a(new Date(t.startTime.getTime()),{gcalId:t.id,duration:o}).toData(),priority:t.priority,isComplete:!!t.isComplete,isArchived:t.isArchived,dateCompleted:r,isStarred:t.isStarred},l=e.createItem(t.id,this._createItemText(t),a,s,n.a.ChangeType.Auto);if(t.description){var u=e.createItem(t.id+"_note",t.description,l.id,{isNote:!0},n.a.ChangeType.Auto);l.setNote(u,n.a.ChangeType.Auto)}return l}},{key:"getRemoteAttachmentData",value:function(e){var t=this;if(i.default.Assert(e.hasField("calendarID"),"Must have a valid calendarID for an event"),e.hasField("calendarID")){var a=e.getField("calendarID"),n=this._getCalendarInfo(a);n&&i.default.Assert(n.accountID,"Should have an accountID on the calendar");var r=Ve.a.fns("calendar").events.get.packedFn,o={eventId:e.id,calendarId:a};n&&this._queueRemoteRequestMulti(n.accountID,r,o,function(n){if(i.default.Assert(!n||n.id===e.id,"If valid result, attachment should match remote event ID"),n){var r=t._addRemoteEntry(a,n);t._eventCache.cacheEntry(n.id,t.serializeExternalData(r))}},function(){e.notifyDataRequestFailed()},e,kn)}else e.updateField("status","cancelled")}},{key:"_createRemoteEntry",value:function(e,t){var a,n,r,o=!1;if(i.default.Assert(t.start,"Must always have valid start data"),t.start.dateTime)i.default.Assert(t.end.dateTime,"End date format should always match start"),a=new Date(t.start.dateTime),n=new Date(t.end.dateTime);else if(t.start.date){i.default.Assert(t.end.date,"End date format should always match start");var s=t.start.date.split("-"),l=t.end.date.split("-");a=new Date(s[0],s[1]-1,s[2]),n=new Date(l[0],l[1]-1,l[2]),o=!0}t.htmlLink&&(r=t.htmlLink.split("?eid=")[1]);var u={id:t.id,calendarID:e,status:t.status,summary:t.summary,startTime:a,endTime:n,allDayEvent:o,recurringEventId:t.recurringEventId,eid:r,isComplete:this._getRemoteProperty(t,mn.IsComplete),isArchived:this._getRemoteProperty(t,mn.IsArchived),isStarred:this._getRemoteProperty(t,mn.IsStarred),priority:this._getRemoteProperty(t,mn.Priority),locked:t.locked||!1,attendees:t.attendees,location:t.location,description:t.description,organizer:t.organizer?t.organizer.displayName||t.organizer.email||t.organizer.id:"Unknown"};return t.source&&(u.source={title:t.source.title,url:t.source.url}),u}},{key:"_addRemoteEntry",value:function(e,t){var a=this._createRemoteEntry(e,t);return this.cacheData(a.id,a),a}},{key:"createEntryFromLocal",value:function(e,t){return t.startTime=t.startTime?new Date(t.startTime):void 0,t.endTime=t.endTime?new Date(t.endTime):void 0,t.isComplete=this._propConverter[mn.IsComplete](t.isComplete),t.isArchived=this._propConverter[mn.IsArchived](t.isArchived),t.isStarred=this._propConverter[mn.IsStarred](t.isStarred),t.priority=this._propConverter[mn.Priority](t.priority),t}},{key:"_notifyFailedRequest",value:function(e,t){e&&e.error&&(e.error.code===n.a.HTTPStatusCode.Unauthorized?xo.toasts.pushMessage(n.a.MessageID.LostPermission):e.error.code>=400&&e.error.code<500&&i.default.reportError(new Error("Failed GCalendar request: "+e.error.code),e))}},{key:"_getRemoteProperty",value:function(e,t){var a;return i.default.Assert(e,"Must provide valid event info"),i.default.Assert(t,"Must provide valid remote prop"),i.default.Assert(this._propConverter[t],"Missing prop converter: ",t),e.extendedProperties&&e.extendedProperties.private&&(a=e.extendedProperties.private["MDCProp_"+t]),this._propConverter[t]&&(a=this._propConverter[t](a)),a}},{key:"_updateAttachFromData",value:function(e,t){var a=[];for(var i in t)t.hasOwnProperty(i)&&e.isFieldDefined(i)&&(e.updateField(i,t[i]),a.push(i));return a}},{key:"_runRemoteUpdate",value:function(e,t,a,n,r,o){var s,l,u,d,c=this,h=arguments;i.default.Assert(this.getSetting(this.Settings.WriteAccess),"Should not be calling _runRemoteUpdate without proper permission"),i.default.Assert(!e.getField("locked"),"Should never try to modify an event that is locked"),i.default.Assert(i.default.isBoolean(t)||i.default.isArray(t),"Must specify a boolean or list of fields for modified value"),i.default.Assert(i.default.isFunction(n),"Must provide a valid localDoneCB"),i.default.Assert(i.default.isFunction(r),"Must provide a valid remoteDoneCB"),i.default.Assert(i.default.isFunction(o),"Must provide a valid allDoneCB");var f=function(e,t,a){i.default.Assert(i.default.isFunction(e),"Must supply a valid CB function"),i.default.Assert(void 0!==t,"Must always pass success back from CB"),e.apply(c,Array.prototype.slice.call(h,1)),e===n?(i.default.Assert(void 0===s,"Local CB called twice"),s=t,u=a):e===r&&(i.default.Assert(void 0===l,"Remote CB called twice"),l=t,d=a),void 0!==s&&void 0!==l&&o(s,l,u,d)},p=this.getCacheData(e.id);i.default.Assert(p,"Performing update on event that does not have local data"),p?(this.addModifiedOffline(p,t),this._eventCache.cacheEntry(e.id,this.serializeExternalData(p),function(i){i||f(n,!1),a(function(a,o){if(a){var s=c.getCacheData(e.id),l=!0!==t&&t;c.removeModifiedOffline(s,l),i&&c._eventCache.cacheEntry(e.id,c.serializeExternalData(s),function(e){f(n,e)}),f(r,!0)}else i&&f(n,!1),f(r,!1,o)})})):(f(n,!1),f(r,!1))}},{key:"_updateEvent",value:function(e,t,a,i,n,r){var o=this,s=this._updateAttachFromData(e,t);this._runRemoteUpdate(e,s,function(i){o._updateRemoteEvent(e.getField("calendarID"),e.id,t,a,i)},i,n,r)}},{key:"_updateRemoteEvent",value:function(e,t,a,r,o){var s=this;i.default.Assert(this.getSetting(this.Settings.WriteAccess),"Should not be calling _updateRemoteEvent without proper permission"),i.default.Assert(this.hasWritePermissionForCalendar(e),"Should not be calling _updateRemoteEvent for a read-only calendar");var l=this._createEventUpdateInfo(a),u=this._getCalendarInfo(e);i.default.Assert(u.accountID,"Should have an accountID on the calendar");var d=Ve.a.fns("calendar").events.patch.packedFn,c={calendarId:e,eventId:t,resource:l};this._queueRemoteRequestMulti(u.accountID,d,c,function(){o(!0)},function(a){if(a&&a.error&&a.error.code===n.a.HTTPStatusCode.NotFound)s._eventCache.removeEntry(t),o(!0);else{var r=Object.keys(l);if(i.default.log("Failed Update: ",e,t,r),i.default.isHTTPStatusCode(a,n.a.HTTPStatusCode.Forbidden)&&!s.isRateLimitError(a)){var u=s.getCacheData(t);u&&(u.locked=!0),s.cacheData(t,u,!0,["locked"])}o(!1,a),s._notifyFailedRequest(a,e)}},void 0,Sn||r)}},{key:"_updateRemoteProperty",value:function(e,t,a,i,n,r){var o=this;e.updateField(t,a);var s={},l=void 0===a?null:a;s["MDCProp_"+t]=l;var u={extendedProperties:{private:s}};this._runRemoteUpdate(e,[t],function(t){o._updateRemoteEvent(e.getField("calendarID"),e.id,u,_n,t)},i,n,r)}},{key:"_getStartEndFromDateInfo",value:function(e,t){var a,n,r,o=!1;return e instanceof Date?(e.hasTimeOfDay()||(o=!0),a=e,n=e.clone().addMilliseconds(t)):e instanceof an?(a=e.getStartDate(),n=e.getEndDate(),r=e.toICal()):i.default.Assert(!1,"Should always have a valid date"),{startTime:a,endTime:n,allDayEvent:o,recurrence:r}}},{key:"deleteCalendarEventForItem",value:function(e,t,a,i,r){var o=this;this.sendEvent("DeleteEvent");this._runRemoteUpdate(t,["status"],function(a){var i=e.getRawText().replace(t.getEmbedString(),"");e.setText(i,!0,n.a.ChangeType.Local),t.isLocalOnlyAttachment()?(t.updateField("status","cancelled"),a(!0)):o.deleteCalendarEvent(t,a)},a,i,r)}},{key:"deleteCalendarEvent",value:function(e,t){var a=this;i.default.Assert(!e.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event");var r=e.getField("calendarID"),o=this._getCalendarInfo(r);i.default.Assert(o.accountID,"Should have an accountID on the calendar");var s=Ve.a.fns("calendar").events.delete.packedFn,l={calendarId:r,eventId:e.id},u=function(){var i=a.getDefaultItemStore();e.updateField("status","cancelled"),e.forEachItem(i,function(e){e.parent()&&(e.parent().removeChild(e),e.setParent(void 0))}),a._eventCache.cacheEntry(e.id,a.serializeExternalData(e.getData())),t(!0)};this._queueRemoteRequestMulti(o.accountID,s,l,function(){u()},function(i){i&&i.error&&i.error.code===n.a.HTTPStatusCode.Gone?u():i&&i.error&&i.error.code===n.a.HTTPStatusCode.NotFound?u():(t(!1,i),a._notifyFailedRequest(i,e.getField("calendarID")))},void 0,Dn)}},{key:"forceRemoteEventSync",value:function(){if(!i.default.isDemoMode()&&this._hasInitializedTasks){if(this.hasRecurringTask("CalendarEventSync"))this.getRecurringTask("CalendarEventSync").forceUpdate();if(this.hasRecurringTask("CalendarListSync"))this.getRecurringTask("CalendarListSync").forceUpdate()}}},{key:"getDefaultExportCalendarID",value:function(){return i.default.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)}},{key:"isExportCalendarID",value:function(e){return this.getSetting(this.Settings.ExportCalendar)===e}},{key:"hasWritePermissionForAttach",value:function(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var a=e.getField("calendarID"),i=this._getCalendarInfo(a);i&&("writer"!==i.accessRole&&"owner"!==i.accessRole||(t=!0))}return t}},{key:"hasWritePermissionForCalendar",value:function(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var a=this._getCalendarInfo(e);a&&("writer"!==a.accessRole&&"owner"!==a.accessRole||(t=!0))}return t}},{key:"getCalendarBackgroundColor",value:function(e){var t="rgba(0, 120, 255, 0.85)",a=this._getCalendarInfo(e);return a&&a.backgroundColor&&(t=a.backgroundColor),t}},{key:"getCalendarForegroundColor",value:function(e){var t="#000000",a=this._getCalendarInfo(e);return a&&a.foregroundColor&&(t=a.foregroundColor),t}},{key:"getCalendarDisplayProps",value:function(e){var t,a=this._getCalendarInfo(e);return a&&"reader"===a.accessRole&&(t={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),t}},{key:"shouldDisplayOverdueInAgenda",value:function(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)}},{key:"createEventForEmail",value:function(e,t,a,n,r,o){var s=this;i.default.Assert(i.default.isString(e),"Must provide a valid calendarID for email"),i.default.Assert(i.default.isString(t),"Must provide a valid subject"),i.default.Assert(i.default.isString(a),"Must provide a valid email url"),i.default.Assert(i.default.isDateValid(n),"Must provide a valid schedule date"),i.default.Assert(i.default.isNumber(r),"Must provide a valid event duration"),this.sendEvent("AddEmailEvent");var l={duration:r,summary:t,date:n,source:{title:t,url:a}};this.createNewCalendarEvent(e,l,function(e){if(e){var t=s.getDefaultItemStore();if(!t.hasItem(e.id)){xo.PaneUpdateBatcher.beginUpdateItems();var a=t.getRoot(),i=s._createItem(t,e,a.id);a.insertItem(i),xo.PaneUpdateBatcher.commitUpdateItems()}}},i.default.newEmptyFn(),o)}},{key:"createEventForItem",value:function(e,t){!e.hasPluginAttachment(this.id)&&e.getNextDate()&&((t=t||this.getDefaultExportCalendarID())?e.getDate()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(t,e,function(t,a,i,r){t||a?a?A.e.miscAction({type:A.c.Misc,misc:A.a.AddToGCal,data:{item:e}}):r&&r.error&&-1===r.error.code?A.e.miscAction({type:A.c.Misc,misc:A.a.AddToGCal,data:{item:e}}):xo.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:n.a.MessageAction.Okay}):i&&!1===i.isValid?xo.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:n.a.MessageAction.Okay}):xo.toasts.pushMessage({text:'There was an error creating your calendar event. There may be a problem with your authorization. Please try toggling your "Save To" calendar off and back on, or try toggling the Google Calendar plugin off and on. Contact support@moo.do if you have questions',action:n.a.MessageAction.OpenCalendarSettings})})):(this.sendEvent("AddRepeatEvent"),xo.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:n.a.MessageAction.Okay})):xo.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:n.a.MessageAction.OpenSettings}))}},{key:"newCalendarEventForItem",value:function(e,t,a){var r=this;i.default.Assert(t,"Must provide a valid item"),i.default.Assert(t.getNextDate(),"Item must have a valid date"),i.default.Assert(!t.hasPluginAttachment(n.a.PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item");var o=t.getDuration()*n.a.MSPerMinute;o||(o=t.allDayDate()?i.default.days(1):Tn);var s={duration:o,summary:t.getCalendarParsedText()};if(t.getDate()&&(s.date=t.getDate()),t.hasNote()&&(s.description=t.getNote().getParsedText()),t.hasAttachmentType(n.a.PluginType.Email)){var l=t.getAttachmentByType(n.a.PluginType.Email);s.source={title:l.getField("subject"),url:l.getPlugin().createURLForThread(l)}}this.createNewCalendarEvent(e,s,function(e){if(e)if(t.isDestroyed()){var a=r.getDefaultItemStore();if(!a.hasItem(e.id)){xo.PaneUpdateBatcher.beginUpdateItems();var i=a.getRoot(),o=r._createItem(a,e,i.id);i.insertItem(o),xo.PaneUpdateBatcher.commitUpdateItems()}}else{t.getMooDate().setGCalId(e.id),t.onMooDateUpdated(n.a.ChangeType.Local);var s=t.getCalendarRawText();t.setText(s,!0,n.a.ChangeType.Local)}},i.default.newEmptyFn(),a)}},{key:"createNewCalendarEvent",value:function(e,t,a,n,r){var o=this;i.default.Assert(t,"Must have valid event info passed in"),i.default.Assert(t.date,"Must have valid date for event"),i.default.Assert(void 0!==t.duration,"Must have a valid event duration"),i.default.Assert(t.summary,"Must have a valid event summary"),i.default.Assert(i.default.isFunction(a),"Must supply a valid local done CB"),i.default.Assert(i.default.isFunction(n),"Must supply a valid remote done CB");var s=i.default.generateTempId(),l=this._getStartEndFromDateInfo(t.date,t.duration),u=this._getCalendarInfo(e);u&&i.default.Assert(u.accountID,"Should have an accountID on the calendar");var d={id:s,calendarID:e,status:"confirmed",summary:t.summary,source:t.source,description:t.description,startTime:l.startTime,endTime:l.endTime,allDayEvent:l.allDayEvent,recurrence:l.recurrence,organizer:u.accountID,modifiedOffline:!0};this.cacheData(s,d),this._eventCache.cacheEntry(s,d,function(t){a(d,t);var s=o.getAttachment(d.id);i.default.isDemoMode()?(n(!0),r(t,!0)):o._runRemoteUpdate(s,!0,function(t){o._createRemoteEventFromCacheData(e,d,i.default.newEmptyFn(),t,r)},i.default.newEmptyFn(),n,function(){o.getDefaultItemStore().updateItems()})})}},{key:"_createRemoteEventFromCacheData",value:function(e,t,a,n,r){var o,s,l,u,d=this,c=arguments;i.default.Assert(!this._pendingCreates[t.id],"Should never try and double create a calendar event"),this._pendingCreates[t.id]=!0;var h=function(e,t,h){i.default.Assert(i.default.isFunction(e),"Must supply a valid CB function"),i.default.Assert(void 0!==t,"Must always pass success back from CB"),e.apply(d,Array.prototype.slice.call(c,1)),e===a?(i.default.Assert(void 0===o,"Local CB called twice"),o=t,l=h):e===n&&(i.default.Assert(void 0===s,"Remote CB called twice"),s=t,u=h),void 0!==o&&void 0!==s&&r(o,s,l,u)};this._createNewRemoteEvent(e,t,function(r,o){delete d._pendingCreates[t.id],xo.PaneUpdateBatcher.beginUpdateItems();var s=d.getAttachment(t.id);if(r){var l=t.id;d.changeID(s,s.id,r.id);var u=d.getDefaultItemStore(),c=u.getRoot();u.hasItem(l)&&u.destroyItem(l),d._eventCache.removeEntry(l,function(e){i.default.Assert(e,"Must always successfully remove the temp cached event: "+t.id)});var f=d._addRemoteEntry(e,r),p=d._createItem(u,f,c.id);c.insertItem(p),d._eventCache.cacheEntry(r.id,d.serializeExternalData(f),h.bind(d,a)),s.updateField("isInvalid",!1),h(n,!0)}else s.updateField("isInvalid",!0),h(a,!1),h(n,!1,o);xo.PaneUpdateBatcher.commitUpdateItems()})}},{key:"_createNewRemoteEvent",value:function(e,t,a){var n=this;i.default.Assert(t,"Must specify valid event info"),i.default.Assert(t.startTime instanceof Date,"Must have a valid start time"),i.default.Assert(t.endTime instanceof Date,"Must have a valid end time"),i.default.Assert(t.summary,"Must have a valid event title");var r,o,s=this._getCalendarInfo(e);i.default.Assert(s.accountID,"Should have an accountID on the calendar"),t.allDayEvent?(r={date:t.startTime.toString("yyyy-MM-dd")},o={date:t.endTime.toString("yyyy-MM-dd")}):(r={dateTime:t.startTime.toISOString()},o={dateTime:t.endTime.toISOString()});var l=Ve.a.fns("calendar").events.insert.packedFn,u={calendarId:e,resource:{start:r,end:o,recurrence:t.recurrence,summary:t.summary,description:t.description,status:t.status,source:t.source}};this._queueRemoteRequestMulti(s.accountID,l,u,function(e){a(e)},function(t){a(void 0,t),n._notifyFailedRequest(t,e)},void 0,wn)}},{key:"getImportCalendarList",value:function(){return this.getSetting(this.Settings.ImportCalendars)||[]}},{key:"getReadableCalendarList",value:function(e){return this._getCalendarList("reader",e)}},{key:"getWritableCalendarList",value:function(e){return this._getCalendarList("writer",e)}},{key:"getWritableCalendarListSync",value:function(e){var t=this.getSetting(this.Settings.ImportCalendars);if(t)return t.filter(function(t){return(!e||t.accountID===e||!t.accountID&&e===i.default.getUserIdentifier())&&("writer"===t.accessRole||"owner"===t.accessRole)})}},{key:"getFullCalendarList",value:function(e){var t=this.getSetting(this.Settings.ImportCalendars);this.getReadableCalendarList(function(a){if(t&&a){var n=t.map(function(e){if(!i.default.isObject(e))return{id:e,accessRole:"none"};var t=i.default.clone(e);return t.accessRole="none",t}).filter(function(e){for(var t=0,i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].id===e.id)return!1}return!0});a.pushArray(n)}e(a)})}},{key:"createCalendar",value:function(e,t){var a=this,i=Ve.a.fns("calendar").calendars.insert.packedFn,n={resource:{summary:e}};this._queueRemoteRequest(i,n,function(e){t(e)},function(e){t(),a._notifyFailedRequest(e,void 0)},void 0,Cn,{}),this.sendEvent("CreateCalendar")}},{key:"_getCalendarList",value:function(e,t){for(var a=0,i=this.getAccounts(),n=i.length,r=[],o=function(e){n--,e&&(r=r.concat(e)),0===n&&t(r)},s=0;s<i.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._getCalendarListForAccount(i[s],e,o)}}},{key:"_getCalendarListForAccount",value:function(e,t,a){var i=this,n=Ve.a.fns("calendar").calendarList.list.packedFn,r={minAccessRole:t,userId:"me"};this._queuePagedRemoteRequestMulti(e,n,r,function(t){t=t.map(function(t){return t.accountID=e,t}),a(t)},function(e){a(),i._notifyFailedRequest(e,void 0)},void 0,bn,{getAllPages:!0,timeoutMS:0})}},{key:"handleEventUpdate",value:function(e,t){this._numEntriesSyncd++;var a=this.getDefaultItemStore();if("cancelled"===t.status){var r=this.getAttachment(t.id);r.getField("calendarID")===e&&(this._eventCache.removeEntry(t.id),this.hasCacheData(t.id)&&(r.updateField("status","cancelled"),r.forEachItem(a,function(e){e.parent()&&(e.parent().removeChild(e,n.a.ChangeType.Remote),e.setParent(void 0))})))}else{var o=this.getCacheData(t.id),s=this._createRemoteEntry(e,t);o&&o.modifiedOffline&&this._mergeEventData(o,s),this.cacheData(s.id,s),this._eventCache.cacheEntry(t.id,this.serializeExternalData(s));var l=a.getRoot(),u=this.getAttachment(t.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(u,o,s)}catch(c){i.default.reportError(c)}if(this._endIgnorePropertyChanges(),!a.hasItem(s.id)&&this._shouldDisplayTime(s.startTime,s.endTime)&&this._eventNeedsItem(s)){var d=this._createItem(a,s,l.id);l.insertItem(d)}}}},{key:"_mergeEventData",value:function(e,t){var a=0;i.default.Assert(e.modifiedOffline,"Should only merge events that were locally modified");var n=e.modifiedOffline;i.default.Assert(i.default.isArray(n),"Should not be receiving an update for an event that was created locally");for(var r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=n[r];0,t[o]=e[o]}t.modifiedOffline=e.modifiedOffline}},{key:"updateVMLIsFromUpdate",value:function(e,t,a){var r=this;if(i.default.Assert(e,"Must provide a valid attachment"),i.default.Assert(a,"Must provide valid new data"),t)e.forEachItem(void 0,function(e){e.getParsedText();t.summary!==a.summary&&(e.hasAttachmentType(n.a.PluginType.Email)||a.summary&&a.summary.replace(/\u2000/g,""));if(t.description!==a.description&&e.belongsToItemStore(r.getDefaultItemStore()))if(e.hasNote())a.description?e.getNote().setText(a.description,!0,n.a.ChangeType.Remote):e.setNote(void 0,n.a.ChangeType.Remote);else if(a.description){var i,o=a.id+"_note";r.getDefaultItemStore().hasItem(o)?(i=r.getDefaultItemStore().getItem(o)).setText(a.description,!0,n.a.ChangeType.Remote):i=r.getDefaultItemStore().createItem(o,a.description,e.id,{isNote:!0},n.a.ChangeType.Remote),e.setNote(i,n.a.ChangeType.Remote)}r.areDatesEqual(t.isComplete,a.isComplete)||e.setComplete(!!a.isComplete,n.a.ChangeType.Remote),t.isArchived!==a.isArchived&&e.isArchived(a.isArchived,n.a.ChangeType.Remote),t.isStarred!==a.isStarred&&e.setStarred(a.isStarred,n.a.ChangeType.Remote),t.priority!==a.priority&&e.setPriority(a.priority,n.a.ChangeType.Remote)});else{var o=this._createItemText(a);e.forEachItem(void 0,function(e){e.setText(o,!0,n.a.ChangeType.Remote)})}}},{key:"setSyncToken",value:function(e,t,a){var n=this;i.default.Assert(i.default.isString(e),"Must provide a valid calendar ID to clear sync token for"),i.default.Assert(i.default.isString(t),"Must provide a valid calendar ID to clear sync token for"),this._eventCache.getMetadata(pn,function(i){i=i||{};var r=Date.now()+n._syncTokenDuration;i[e]={token:t,date:Date.now(),expires:r},n._eventCache.setMetadata(pn,i,a)})}},{key:"clearSyncToken",value:function(e,t){var a=this;i.default.Assert(i.default.isString(e),"Must provide a valid calendar ID to clear sync token for"),i.default.Assert(i.default.isFunction(t),"Must provide valid CB function when clearing sync token"),this._eventCache.getMetadata(pn,function(i){i?(delete i[e],a._eventCache.setMetadata(pn,i,t)):t(!1)})}},{key:"clearCalendarEventCache",value:function(e,t){var a=this;i.default.Assert(i.default.isString(e),"Must provide a valid calendar ID to clear event cache for"),i.default.Assert(i.default.isFunction(t),"Must provide valid CB function when clearing event cache");this._eventCache.getFilterEntries(function(t){return t.calendarID===e},function(e){if(e){for(var i=0,n=0;n<e.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a._eventCache.removeEntry(e[n].id)}t(!0)}else t(!1)})}},{key:"_calendarSyncComplete",value:function(e,t){if(t.length>0){if(Le.a.notifySyncError(t),!f.a.isMobile&&this.isOnline())for(var a=0,i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t[i].result!==n.a.SyncResult.FailureNetwork&&xo.toasts.pushMessage(n.a.MessageID.CalendarSync)}}else Le.a.notifySyncError(void 0),xo.toasts.clearMessage(n.a.MessageID.CalendarSync);var r=this.getSetting(this.Settings.ExportCalendar);if(r){for(var o=0,s=!1,l=0;l<t.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(t[l].id===r){s=!0;break}}s||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}}},{key:"_shouldExpireToken",value:function(e){var t=!0;return e&&(e.expires?t=e.expires<Date.now():e.date&&(t=e.date+this._syncTokenDuration<Date.now())),t}},{key:"_getCalendarInfo",value:function(e){return this._calendarList[e]}},{key:"allowTextEditing",value:function(e,t){var a=!1;if(this.getSetting(this.Settings.WriteAccess)){var i=t.getField("calendarID");(this.hasWritePermissionForCalendar(i)||t.isLocalOnlyAttachment())&&(a=!0)}return a}},{key:"_createCalendarFromRemote",value:function(e){var t={id:e.id,accountID:e.accountID,summary:e.summary,accessRole:e.accessRole};return i.default.isValidColor(e.backgroundColor)&&(t.backgroundColor=e.backgroundColor),i.default.isValidColor(e.foregroundColor)&&(t.foregroundColor=e.foregroundColor),t}},{key:"runCalendarListSync",value:function(e){var t=this;this.getReadableCalendarList(function(a){if(a){var i=0;t._calendarList={};for(var r=0;r<a.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=a[r];t._calendarList[o.id]=t._createCalendarFromRemote(o)}xo.toasts.clearMessage(n.a.MessageID.CalendarSync);var s=t.getDefaultExportCalendarID();s&&!t._calendarList[s]&&(t.setSetting(t.Settings.ExportCalendar,void 0),xo.toasts.pushMessage({text:"Your export calendar no longer exists, please select another.",action:n.a.MessageAction.OpenSettings})),t._eventCache.onCacheMetadataReady(function(){t._eventCache.setMetadata(gn,t._calendarList)})}else!f.a.isMobile&&t.isOnline()&&xo.toasts.pushMessage(n.a.MessageID.CalendarSync);e&&e()})}},{key:"_notifyTokenExpired",value:function(e){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)}},{key:"_notifyCalendarUnsyncd",value:function(e){i.default.log("Detected calendar "+e+" is no longer syncd"),this._clearCachedData(e,function(t){t||i.default.log("Failure unsyncing calendar "+e)}),this._clearCalendarItems(e)}},{key:"_clearCalendarItems",value:function(e){var t=this.getDefaultItemStore();xo.PaneUpdateBatcher.beginUpdateItems(),t.forEach(function(a){a.hasAttachments()&&(a.getAttachment(0).getField("calendarID")===e&&t.destroyItem(a.id))}),xo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_getSyncResultFromResult",value:function(e,t){var a=n.a.SyncResult.Success;if(t&&t.error&&t.error.code){var i=t.error.code;if(i===n.a.HTTPStatusCode.Unauthorized){var r=this._getCalendarInfo(e);a=r&&"owner"===r.accessRole?n.a.SyncResult.FailureOAuth:r&&"writer"===r.accessRole?n.a.SyncResult.FailureNoWrite:n.a.SyncResult.FailureNoRead}else a=i===n.a.HTTPStatusCode.NotFound?n.a.SyncResult.FailureNoRead:i===n.a.HTTPStatusCode.Network?n.a.SyncResult.FailureNetwork:i===n.a.HTTPStatusCode.Forbidden?n.a.SyncResult.FailureNoRead:n.a.SyncResult.FailureUnknown}return a}},{key:"runCalendarSync",value:function(e){var t=this,a=0,r=0,o=[],s=[],l=function(l,u,d){i.default.Assert(r<a,"Should never have more calendars syncd than we tried to sync"),l?o.push({id:u,result:n.a.SyncResult.Success}):s.push({id:u,result:t._getSyncResultFromResult(u,d)}),++r===a&&(t._calendarSyncComplete(o,s),e&&e())};this._eventCache.onCacheMetadataReady(function(){t._eventCache.getMetadata(pn,function(n){t._updateSyncTimes();var r=t.getSetting(t.Settings.ImportCalendars);if(r&&r.length>0){var o=0;a=r.length;for(var s=0;s<r.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=r[s];i.default.isObject(u)||(u={id:r[s]});var d,c=n?n[u.id]:void 0;t._shouldExpireToken(c)?(t._notifyTokenExpired(u.id),d=void 0):d=c.token,t.performCalendarSync(u,d,l)}for(var h in n)if(n.hasOwnProperty(h)){var f=0,p=!1;for(s=0;s<r.length;++s){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;u=r[s];if(i.default.isObject(u)||(u={id:r[s]}),u.id===h){p=!0;break}}p||t._notifyCalendarUnsyncd(h)}}else t._clearAllData(),t._calendarSyncComplete([],[]),e&&e()})})}},{key:"performCalendarSync",value:function(e,t,a){var r=this,o=e.id,s=e.accountID;if(i.default.Assert(i.default.isString(o),"Must provide a valid calendar ID for each sync op"),!s){var l=this._getCalendarInfo(e.id);l&&(s=l.accountID),s||(s=i.default.getUserIdentifier())}var u=Ve.a.fns("calendar").events.list.packedFn,d={calendarId:o,singleEvents:!0};t?d.syncToken=t:(d.timeMin=this._minSyncStartTime.toISOString(),d.timeMax=this._maxSyncStartTime.toISOString());this._queuePagedRemoteRequestMulti(s,u,d,function(e,t,i){var n,s=0;i&&(n=i.nextSyncToken,r.setSyncToken(o,n)),xo.PaneUpdateBatcher.beginUpdateItems();for(var l=0;l<e.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;r.handleEventUpdate(o,e[l])}xo.PaneUpdateBatcher.commitUpdateItems(),a(!0,o)},function(t){t&&t.error&&t.error.code===n.a.HTTPStatusCode.Gone?r._clearCachedData(o,function(i){i?r.performCalendarSync(e,void 0,a):a(!1,o,t)}):(a(!1,o,t),r._notifyFailedRequest(t,o))},void 0,yn,{getAllPages:!0,timeoutMS:0})}},{key:"_createEventUpdateInfo",value:function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&fn.indexOf(a)>=0&&(t[a]=e[a]);return t}},{key:"_notifyOfflineSyncFailures",value:function(e,t,a){t>0&&(Le.a.notifySyncError(a),i.default.log("Failed to sync offlineChanges: ",t))}},{key:"_syncOfflineChanges",value:function(e){var t=this;if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var a=0,r=0,o=0,s=[],l=function(i,l){l===n.a.SyncResult.Success?r++:(o++,s.push({id:i,result:l})),a===r+o&&(t._syncingOfflineChanges=!1,e(r,o,s))};this._eventCache.getFilterEntries(function(e){return!!e.modifiedOffline},function(e){var r=0;a=e.length;for(var o=0;o<e.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=t.createEntryFromLocal(e[o].id,e[o]);s.isInvalid||(i.default.isTempId(s.id)&&!t._pendingCreates[s.id]?t._createRemoteEventFromCacheData(s.calendarID,s,i.default.newEmptyFn(),function(e,t,a){l(e,this._getSyncResultFromResult(e,a))}.bind(t,s.calendarID),i.default.newEmptyFn()):t.hasWritePermissionForCalendar(s.calendarID)?t._updateRemoteEvent(s.calendarID,s.id,s,In,function(e,t,a){t?(delete s.modifiedOffline,this._eventCache.cacheEntry(s.id,s,function(t){l(e,t?n.a.SyncResult.Success:n.a.SyncResult.FailureUnknown)})):l(e,this._getSyncResultFromResult(e,a))}.bind(t,s.calendarID)):(delete s.modifiedOffline,t._eventCache.cacheEntry(s.id,s,function(e,t){l(e,t?n.a.SyncResult.Success:n.a.SyncResult.FailureUnknown)}.bind(t,s.calendarID))))}})}}},{key:"_getEventDuration",value:function(e){i.default.Assert(!e.getField("allDayEvent"),"All day events do not have valid durations");var t=e.getField("startTime"),a=e.getField("endTime");return i.default.Assert(t&&a,"Must always have valid start and end times"),a-t}},{key:"_computeItemDates",value:function(e,t,a){var i,n;t.getDate()&&(n=(i=t.getDate().clone()).clone().addMilliseconds(t.getDuration())),n.getFullYear(),i&&n&&(t.allDayDate()?(e.start={date:i.toString("yyyy-MM-dd"),dateTime:null},e.end={date:n.toString("yyyy-MM-dd"),dateTime:null}):(e.start={dateTime:i.toISOString(),date:null},e.end={dateTime:n.toISOString(),date:null})),e.startTime=i,e.endTime=n}},{key:"_queueEventUpdate",value:function(e,t){if(this._updateAttachFromData(e,t),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!e.isLocalOnlyAttachment()){var a=this._eventUpdateQueue[e.id];if(a)for(var i in t)t.hasOwnProperty(i)&&(a.info[i]=t[i]);else this._eventUpdateQueue[e.id]={attach:e,info:t}}}},{key:"onShutdown",value:function(){}},{key:"_flushEventUpdateQueue",value:function(){this._eventUpdateTimeout=void 0;var e=function(e,t){e||t?xo.toasts.clearMessage(n.a.MessageID.CalendarSaveFail):xo.toasts.pushMessage(n.a.MessageID.CalendarSaveFail)};for(var t in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(t)){var a=this._eventUpdateQueue[t];this._updateEvent(a.attach,a.info,Pn,i.default.newEmptyFn(),i.default.newEmptyFn(),e)}this._eventUpdateQueue={}}},{key:"_handleAttachDeleted",value:function(e,t){var a=this;if(t.belongsToItemStore(this.getDefaultItemStore())){var r=e.getField("status");this.deleteCalendarEvent(e,function(o){if(o){xo.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:function o(){a._updateEvent(e,{status:r},An,i.default.newEmptyFn(),function(e){e||xo.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:o,timeout:1e4})},i.default.newEmptyFn());var s=a._createItemText(e.getData());t.setText(s,!0,n.a.ChangeType.Local),t.parent()||t.setParent(a.getDefaultItemStore().getRoot()),t.getIndex()<0&&t.parent().insertItem(t)},timeout:1e4})}else xo.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:a._handleAttachDeleted.bind(a,e,t),timeout:1e4})})}}},{key:"notifyItemNoteChanged",value:function(e,t){this._queueEventUpdate(e,{description:t.getRawText()})}},{key:"notifyItemDateChanged",value:function(e,t){var a={};this._computeItemDates(a,t,e),this._queueEventUpdate(e,a)}},{key:"notifyItemTextChanged",value:function(e,t,a){if(a)this._handleAttachDeleted(e,t);else if(e.getField("recurringEventId")&&t.getCalendarParsedText()===e.getField("summary"))xo.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!i.default.isDemoMode())if(t.getDate()){var r,o=t.getCalendarParsedText(),s=e.getField("summary"),l=e.getField("source");if(t.hasAttachmentType(n.a.PluginType.Email)){var u=t.getAttachmentByType(n.a.PluginType.Email);r={title:u.getField("subject"),url:u.getPlugin().createURLForThread(u)}}var d={summary:o,start:void 0,end:void 0,source:void 0},c=!1;o!==s&&(c=!0),l&&!r||!l&&r?c=!0:l&&r&&(l.title===r.title&&l.url===r.url||(c=!0));var h=t.getDate(),f=e.getField("startTime");this.areDatesEqual(f,h)||(c=!0);var p=t.getEndDate(),g=e.getField("endTime");this.areDatesEqual(g,p)||(c=!0),c&&(this._computeItemDates(d,t,e),d.source=r,this._queueEventUpdate(e,d)),e.updateField("isInvalid",!1)}else e.updateField("isInvalid",!0)}},{key:"_beginIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!0}},{key:"_endIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!1}},{key:"_isIgnoringPropertyChanges",value:function(){return this._ignoringPropertyChanges}},{key:"notifyItemPropertyChanged",value:function(e,t,a){if(this.getSetting(this.Settings.WriteAccess)&&!e.getField("locked")&&this.hasWritePermissionForCalendar(e.getField("calendarID"))&&(!i.default.isRemoteChange(a)||!this._isIgnoringPropertyChanges())){var r=e.getField("isComplete"),o=e.getField("isArchived"),s=e.getField("isStarred"),l=e.getField("priority"),u=t.dateCompleted,d=t.isArchived(),c=t.isStarred(),h=t.priority(),f=i.default.newEmptyFn(),p=i.default.newEmptyFn(),g=function(e,t,a,i){e||t?xo.toasts.clearMessage(n.a.MessageID.CalendarSaveFail):xo.toasts.pushMessage(n.a.MessageID.CalendarSaveFail)};this.areDatesEqual(r,u)||(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isComplete",u,f,p,g):e.updateField("isComplete",u)),o!==d&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isArchived",d,f,p,g):e.updateField("isArchived",d)),s!==c&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isStarred",c,f,p,g):e.updateField("isStarred",c)),l!==h&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"priority",h,f,p,g):e.updateField("priority",h))}}},{key:"_clearCachedData",value:function(e,t){var a=this;this.clearSyncToken(e,function(i){i?a.clearCalendarEventCache(e,t):t&&t(!1)})}},{key:"_clearAllData",value:function(e){var t=this;this._eventCache.clearMetadata(function(a){a?t._eventCache.clearCache(function(t){e&&e(t)}):e&&e(!1)}),this.getDefaultItemStore().clearStore()}},{key:"getAttachmentClass",value:function(e){var t=["plugin_gcalendar","c-date"];return e.isLoaded()&&(e.getField("isInvalid")&&t.push("invalid"),"cancelled"===e.getField("status")&&t.push("eventDeleted")),t}},{key:"getAttachmentTooltip",value:function(e){var t;return this.isPluginBlocked()?t="Go premium to view calendar events":e.isLoaded()?(e.isLocalOnlyAttachment()?t="Syncing event...":e.getField("isInvalid")&&(t="Item has an invalid date"),"cancelled"===e.getField("status")&&(t="Item was deleted from Google Calendar")):t="Plugin is loading data",t}},{key:"areDatesEqual",value:function(e,t){var a=!1;return e&&t?i.default.isDateValid(e)&&i.default.isDateValid(t)&&(a=e.equals(t)):a=!e&&!t,a}},{key:"parsePriority",value:function(e){var t=i.default.parseInt(e);return isNaN(t)&&(t=n.a.VMLIFlag.None),t}},{key:"fieldsHaveParseEffect",value:function(e){return(!e||1!==e.length||"isComplete"!==e[0])&&on(sn(t.prototype),"fieldsHaveParseEffect",this).call(this,e)}},{key:"changeCalendarForEvent",value:function(e,t){var a=this;i.default.Assert(e.hasField("calendarID"),"Must have a valid calendarID for an event");var r=e.getField("calendarID"),o=this._getCalendarInfo(r),s=o.id;i.default.Assert(o.accountID,"Should have an accountID on the calendar");var l=Ve.a.fns("calendar").events.move.packedFn,u={eventId:e.id,calendarId:r,destination:t};e.updateField("calendarID",t);var d=function(){a._queueEventUpdate(e,{calendarId:t})};this._queueRemoteRequestMulti(o.accountID,l,u,d,function(t){e.updateField("calendarID",s),t&&t.error&&t.error.code===n.a.HTTPStatusCode.Gone?d():(t&&t.error&&(t.error.code,n.a.HTTPStatusCode.NotFound),a._notifyFailedRequest(t,e.getField("calendarID")))},void 0,Mn)}},{key:"getCalendarForAttach",value:function(e){if(e.hasField("calendarID"))return this._getCalendarInfo(e.getField("calendarID"))}}])&&rn(a.prototype,r),o&&rn(a,o),t}();function Ln(e){return(Ln="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xn(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function On(e,t){return!t||"object"!==Ln(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rn(e){return(Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fn(e,t){return(Fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nn(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var Bn=i.default.seconds(30),Un=(Nn((dn=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=On(this,Rn(t).call(this)))._plugins={},e._activePlugins=[],e._loadedDependencies={},e._isOnline=f.a.isPlatformOnline(),e._iteratingPlugins=!1,e._hasAdjustedCacheSizeRatio=!1,e._queueTimeout=void 0,e._forcedLastPossible=!1,e._numOutstandingReqs=0,e._pluginRenderer=new Ue,e}var a,r,s;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fn(e,t)}(t,p["a"]),a=t,(r=[{key:"init",value:function(){this._setupRequestQueues(),this._pluginRenderer.registerDefaultRenderers(),xo.billingManager.hasPremiumFeatures()?(this.notifyDependencyLoad(n.a.PluginDependency.EarlyAccess),this.notifyDependencyLoad(n.a.PluginDependency.PremiumSub)):xo.billingManager.hasEarlyAccess()&&this.notifyDependencyLoad(n.a.PluginDependency.EarlyAccess),i.default.isDemoMode()&&this.notifyDependencyLoad(n.a.PluginDependency.DemoMode),f.a.isMobile||(window.addEventListener("offline",this.goOffline),window.addEventListener("online",this.goOnline)),o.a.listen("resetEverything",this._clearRequestQueues.bind(this)),this.registerPlugins()}},{key:"printStats",value:function(e){if(i.default.log("---- Plugin Stats ----"),void 0!==e){var t=this._plugins[e];i.default.log(t.name),i.default.log(" Stats: ",t.getStats())}else for(var a=0,n=Object.keys(this._plugins),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._plugins[n[r]],s=o.getStats();i.default.log(o.name),i.default.log(" Stats: ",s)}i.default.log("----------------------")}},{key:"dumpQueueState",value:function(){var e=0,t=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._plugins[t[a]];console.log(i.name),i.dumpRequestQueue(!1)}}},{key:"dumpQueueStats",value:function(){for(var e=0,t=Object.keys(this._plugins),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._plugins[t[a]];console.log(i.name),i.dumpQueueStats()}}},{key:"getStats",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getStats();else for(var a=0,i=Object.keys(this._plugins),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._plugins[i[n]];t[r.id]=r.getStats()}return t}},{key:"getCacheStats",value:function(e,t){var a={};if(void 0!==e)this._plugins[e].getCacheStats(t);else for(var i=0,n=Object.keys(this._plugins),r=0,o=0;o<n.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._plugins[n[o]].getCacheStats(function(e,i){i&&(a[e]=i),n.length===++r&&t(a)}.bind(this,n[o]))}}},{key:"getState",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getState();else for(var a=0,i=Object.keys(this._plugins),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._plugins[i[n]];t[r.id]=r.getState()}return t}},{key:"registerPlugins",value:function(){try{this.registerPlugin(new Ji)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new Gt)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new Li)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new En)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new Jt)}catch(e){i.default.reportError(e)}}},{key:"registerPlugin",value:function(e){i.default.Assert(!this._plugins[e.id],"Should never double-register a plguin"),this._plugins[e.id]=e,this.isAuthorized(e.id)&&this.loadPlugin(e.id)}},{key:"getPlugin",value:function(e){return this._plugins[e]}},{key:"getPluginGmail",value:function(){return this._plugins[n.a.PluginID.Gmail]}},{key:"getPluginDrive",value:function(){return this._plugins[n.a.PluginID.Drive]}},{key:"getPluginGCalendar",value:function(){return this._plugins[n.a.PluginID.GCalendar]}},{key:"getPluginFromPreviewCache",value:function(e){for(var t in this._plugins)if(this._plugins.hasOwnProperty(t)){var a=this._plugins[t];if(a._previewCache===e)return a}}},{key:"loadPlugin",value:function(e){var t=this.getPlugin(e);i.default.Assert(t,"Must register a plugin before loading it"),this.activatePlugin(t)}},{key:"unloadPlugin",value:function(e){}},{key:"authorizePlugin",value:function(e,t,a){a(!0)}},{key:"deauthorizePlugin",value:function(e,t){i.default.Assert(t&&i.default.isFunction(t),"Must provide a valid callback fn");var a=this.getPlugin(e);i.default.Assert(a,"Must register a plugin before loading it"),a.setSetting(a.Settings.IsEnabled,!1),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Plugin Deauthorized: ",e),this.deactivatePlugin(a),t(!0)}},{key:"onPluginAuthorized",value:function(e,t){e.setSetting(e.Settings.IsEnabled,t),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Plugin Authorized: ",e.id,t),t&&this.activatePlugin(e)}},{key:"activatePlugin",value:function(e){i.default.Assert(e,"Plugin must be valid to be activated"),e.activate(this._loadedDependencies)&&this._activePlugins.indexOf(e.id)<0&&this._activePlugins.push(e.id),e.ensurePaneTypeIsActive(),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Plugin Activated: ",e.id)}},{key:"deactivatePlugin",value:function(e){(i.default.Assert(e,"Plugin must be valid to be deactivated"),this._activePlugins.indexOf(e.id)>=0)&&(e.deactivate()&&this._activePlugins.remove(e.id),i.default.shouldLog(n.a.LogLevels.Plugin)&&i.default.log("Plugin Deactivated: ",e.id))}},{key:"isOnline",value:function(){return this._isOnline||i.default.isDemoMode()}},{key:"goOnline",value:function(){var e=this;this._isOnline=!0,setTimeout(function(){var t=0;e._setupRequestQueues(!0);for(var a=0;a<e._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e._plugins[e._activePlugins[a]];try{i.goOnline()}catch(n){e._reportPluginError(n)}}},2500)}},{key:"goOffline",value:function(){var e=0;this._isOnline=!1;for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.goOffline()}catch(i){this._reportPluginError(i)}}}},{key:"onDocumentShared",value:function(e){for(var t=0,a=0;a<this._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._plugins[this._activePlugins[a]];try{i.onDocumentShared(e)}catch(n){this._reportPluginError(n)}}}},{key:"writeCaches",value:function(){for(var e=0,t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.saveOfflineCache()}catch(i){this._reportPluginError(i)}}}},{key:"onShutdown",value:function(e){var t=0;e&&this.writeCaches();for(var a=[],i=0;i<this._activePlugins.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._plugins[this._activePlugins[i]];try{var r=n.onShutdown();r&&a.push(r)}catch(o){this._reportPluginError(o)}}return a.length>0?a:void 0}},{key:"onPurgeData",value:function(){for(var e=0,t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.clearOfflineCache(!0)}catch(i){this._reportPluginError(i)}}}},{key:"onClearData",value:function(){for(var e=0,t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.clearData()}catch(i){this._reportPluginError(i)}}}},{key:"getCacheSizeRatio",value:function(){var e=xo.settings.cacheSizeRatio.get()||1;return i.default.Assert(e>=0&&e<=1,"Invalid ratio value: ",e),e}},{key:"hasAdjustedCacheSizeRatio",value:function(){return this._hasAdjustedCacheSizeRatio}},{key:"_adjustCacheSizeRatio",value:function(){var e=this.getCacheSizeRatio();1===e&&i.default.sendEvent("CacheRatioChange","FromDefault");e>.35?e-=.1:i.default.sendEvent("CacheRatioChange","Minimum"),i.default.sendEvent("CacheRatioChange","Change",e),xo.settings.cacheSizeRatio.set(e)}},{key:"onCacheLimitExceeded",value:function(){if(!this._hasAdjustedCacheSizeRatio){var e=0;this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.onCacheLimitExceeded()}catch(i){this._reportPluginError(i)}}}}},{key:"getPluginsForType",value:function(e){var t;switch(e){case n.a.PluginType.Calendar:t=[n.a.PluginID.GCalendar];break;case n.a.PluginType.Email:t=[n.a.PluginID.Gmail];break;case n.a.PluginType.Storage:t=[n.a.PluginID.Drive];break;case n.a.PluginType.Unknown:t=[n.a.PluginID.Mailbird,n.a.PluginID.Moodo]}return t}},{key:"hasAttachmentType",value:function(e,t){var a=!1;if(e.hasAttachments())for(var i=0,n=this.getPluginsForType(t),r=0;r<n.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.hasPluginAttachment(n[r])){a=!0;break}}return a}},{key:"allowTextEditing",value:function(e){var t=!0;if(e&&e.hasAttachments())for(var a=0,i=e.getAttachments(),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!i[n].getPlugin().allowTextEditing(e,i[n])){t=!1;break}}return t}},{key:"validatePlugin",value:function(e){}},{key:"runForEachPlugin",value:function(e){var t=0;this._iteratingPlugins=!0;for(var a=0;a<this._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e(this.getPlugin(this._activePlugins[a]))}catch(n){i.default.reportError(n)}}this._iteratingPlugins=!1}},{key:"getAttachment",value:function(e,t){i.default.Assert(e.p,"Must specify the plugin string to be used: ",e),i.default.Assert(e.id,"Must specify the ID of the data to use from the plugin: ",e);var a=this.getPlugin(e.p);if(i.default.Assert(a,"Must specify a valid plugin: ",e),a)return a.isActive()||this.activatePlugin(a),a.getAttachment(e.id,t?e:void 0)}},{key:"createDisplayElement",value:function(e,t){var a;i.default.Assert(e.p,"Must specify the plugin string to be used"),i.default.Assert(e.id,"Must specify the ID of the data to use from the plugin");var n=this.getPlugin(e.p);if(n){var r=this.getAttachment(e,t);if(r)try{a=n.createDisplayElement(r)}catch(o){this._reportPluginError(o),a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p);return a}},{key:"createUnknownPluginElement",value:function(e){return{attrs:{cls:[],isUnknown:!0,plugin:n.a.PluginID.Moodo,"plugin-id":"Invalid"}}}},{key:"measureAttachment",value:function(e,t){i.default.Assert(t&&t.attrs&&t.attrs.plugin,"Must have a valid plugin ID for measuring");var a=0,n=this.getPlugin(t.attrs.plugin);return i.default.Assert(n,"Should always be able to find a valid plugin: ",t.attrs.plugin),n&&(a=n.measureAttachment(e,t)),a}},{key:"parseAttachmentEmbedString",value:function(e,t){i.default.Assert(e,"Must provide a valid string to parse");var a=e.replace(/&quot;/g,'"').split(","),n={};if(a.forEach(function(e){var t=e.indexOf(":"),a=e.substr(0,t),i=e.substr(t+1,e.length-t-1);n[a]=i}),t){var r=a.length>2;n.displayElement=this.createDisplayElement(n,r)}return n}},{key:"createSimpleAttachment",value:function(e){return e.isSimpleAttachment=!0,e}},{key:"handleDropEvent",value:function(e,t){for(var a=0,i=!1,r=0;r<this._activePlugins.length&&!i;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._activePlugins[r],s=this.getPlugin(o);try{i=s.handleDropEvent(e,t)}catch(l){this._reportPluginError(l)}}return i||(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0||e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0)&&xo.toasts.pushMessage({text:"Attaching files is a Premium feature, using the Drive plugin. Please enable Drive in the settings.",action:n.a.MessageAction.OpenSettings}),i}},{key:"handleTapEvent",value:function(e,t,a,r){var o=!1,s=i.default.getPluginForElement(a.target);if(s){var l=s.getAttribute("plugin"),u=this.getPlugin(l);if(i.default.Assert(u,"Must be able to get a valid plugin from a plugin element"),u.isPluginBlocked())xo.toasts.pushMessage(n.a.MessageID.PremiumRequired),o=!0;else{var d=s.getAttribute("plugin-id");i.default.Assert(d,"Must have a valid item ID for a plugin element");try{o=u[r](e,t,d,a)}catch(c){this._reportPluginError(c)}}}return o}},{key:"handleTapStart",value:function(e,t,a){return this.handleTapEvent(e,t,a,"handleTapStart")}},{key:"handleTapClick",value:function(e,t,a){if(!t.isEditable||f.a.mac&&a.metaKey||!f.a.mac&&a.ctrlKey||i.default.hasClass(a.target,"plugin")||f.a.isMobile&&i.default.findParent(a.target,"plugin"))return this.handleTapEvent(e,t,a,"handleTapClick")}},{key:"handleDoubleTap",value:function(e,t,a){return this.handleTapEvent(e,t,a,"handleDoubleTap")}},{key:"isAuthorized",value:function(e){return!!i.default.isDemoMode()||!!this.getPlugin(e)&&!!this.getSetting(e,this.getPlugin(e).Settings.IsEnabled)}},{key:"getSetting",value:function(e,t){return this.getPlugin(e).getSetting(t)}},{key:"setSetting",value:function(e,t,a){return this.getPlugin(e).setSetting(t,a)}},{key:"onAuthorizedSetting",value:function(e,t,a){this.getPlugin(e).onAuthorizedSetting(t,a)}},{key:"notifyDependencyLoad",value:function(e,t){for(var a in this._loadedDependencies[e]=t||!0,this._plugins)if(this._plugins.hasOwnProperty(a))try{this.getPlugin(a).onDependencyLoaded(e,t)}catch(i){this._reportPluginError(i)}}},{key:"notifyDependencyUnload",value:function(e,t){}},{key:"_handleBatchRequestResponse",value:function(e,t){i.default.Assert(e,"Plugin must be passed to response to know who is handling it"),this._numOutstandingReqs--,i.default.Assert(this._numOutstandingReqs>=0,"Outstanding requests cannot be negative");try{e._handleBatchRequestResponse(t)}catch(a){this._reportPluginError(a)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"_handleRequestResponse",value:function(e,t,a){i.default.Assert(t,"Plugin must be passed to response to know who is handling it"),a||(this._numOutstandingReqs--,i.default.Assert(this._numOutstandingReqs>=0,"Outstanding requests cannot be negative"));try{t._handleRequestResponse(e,a)}catch(n){this._reportPluginError(n)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"notifyNoOutstandingReqs",value:function(){i.default.Assert(0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left"),0===this._numOutstandingReqs&&this._setupRequestQueues(!0)}},{key:"notifyHasPendingRemoteRequest",value:function(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)}},{key:"notifyAuthorizationAdded",value:function(e){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(e)}},{key:"verifyAuthorization",value:function(e,t){for(var a,i,n=0,r=0;r<this._activePlugins.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this._activePlugins[r],s=this.getPlugin(o);if(s.isEnabled())!s.verifyAuthorization(e)&&(i=(i||[]).concat(s.googleScopes())),a=a||!s.verifyAuthorization(e)}}},{key:"_reportInvalidScopes",value:function(e,t){f.a.isMobile?xo.toasts.pushMessage(n.a.MessageID.MissingOfflineMobile):xo.toasts.pushMessage(n.a.MessageID.MissingOffline),xo.toasts.clearMessage(n.a.MessageID.LostPermission),i.default.reportError(new Error("Invalid scopes reported"),{accountID:e,scopes:t})}},{key:"_setupRequestQueues",value:function(e){var t=e?1:Bn;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,t)),this._forcedLastPossible=this._forcedLastPossible||!!e}},{key:"_pumpRequestQueues",value:function(){this._runPumpRequestQueues(n.a.RequestPriority.UserBlocking),this._runPumpRequestQueues(n.a.RequestPriority.Default),this._runPumpRequestQueues(n.a.RequestPriority.Low)}},{key:"_runPumpRequestQueues",value:function(e){var t=0;if(this.isOnline()){var a=0,n=6-this._numOutstandingReqs;i.default.Assert(n>=0,"Should never have more than max outstanding requests at any given point in time");for(var r=0;n>0&&r<this._activePlugins.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._activePlugins[r],s=this.getPlugin(o),l=4-s.getNumOutstandingReqs();i.default.Assert(l>=0,"Must always have a postiive number of available plugin reqs");var u=Math.min(n,l);if(u>0&&s.isReady()){var d=0;try{d=s._pumpRequestQueue(e,u,this._handleRequestResponse,this._handleBatchRequestResponse),i.default.Assert(d>=0,"Number of requests sent can never be negative")}catch(c){this._reportPluginError(c)}i.default.Assert(n-d>=0,"Too Many requests sent"),t+=d,n-=d,this._numOutstandingReqs+=d}}}else 0;return this._forcedLastPossible=!1,this._setupRequestQueues(),t}},{key:"_clearRequestQueues",value:function(){var e=0;this._numOutstandingReqs=0;for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._activePlugins[t],i=this.getPlugin(a);try{i._clearRequestQueue()}catch(n){this._reportPluginError(n)}}}},{key:"useRenderer",value:function(e,t){return this._pluginRenderer.useRenderer(e,t)}},{key:"_reportPluginError",value:function(e){i.default.reportError(e)}},{key:"parseEmailURL",value:function(e){var t={accountID:void 0,threadID:void 0,plugin:void 0},a=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g.exec(e);return a&&(t.accountID=a[1],t.threadID=a[2],t.plugin=this.getPlugin(n.a.PluginID.Gmail)),t}},{key:"isAvailable",value:function(e){return this.getPlugin(e).isAvailable()}},{key:"isActive",value:function(e){return this.getPlugin(e).isActive()}},{key:"isEnabled",value:function(e){return this.getPlugin(e).isEnabled()}},{key:"isGmailPaneEnabled",value:function(){return this.isEnabled(n.a.PluginID.Gmail)}}])&&xn(a.prototype,r),s&&xn(a,s),t}()).prototype,"goOnline",[g.a],Object.getOwnPropertyDescriptor(dn.prototype,"goOnline"),dn.prototype),Nn(dn.prototype,"goOffline",[g.a],Object.getOwnPropertyDescriptor(dn.prototype,"goOffline"),dn.prototype),Nn(dn.prototype,"_handleBatchRequestResponse",[g.a],Object.getOwnPropertyDescriptor(dn.prototype,"_handleBatchRequestResponse"),dn.prototype),Nn(dn.prototype,"_handleRequestResponse",[g.a],Object.getOwnPropertyDescriptor(dn.prototype,"_handleRequestResponse"),dn.prototype),Nn(dn.prototype,"_pumpRequestQueues",[g.a],Object.getOwnPropertyDescriptor(dn.prototype,"_pumpRequestQueues"),dn.prototype),dn),Vn=a(54);function jn(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Hn=["4.95","49.95","5","49"],zn=!0,qn=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._premiumStatus=new X.a(n.a.PremiumStatus.Unknown),zn&&this._premiumStatus.set(n.a.PremiumStatus.Active),this.hasPremiumFeaturesObservable=new Vn.a([this._premiumStatus],function(){return t.hasPremiumFeatures()}),this._lastSignupError=-1,this._earlyAdopter=!1,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._pricingSelected=n.a.Pricing.None,this._billingIdentifier=void 0,this._hasValidBillingData=new X.a(!1),this.daysLeftInTrial=new X.a(-1),this.inviteCodeError=new X.a,this.inviteEmailError=new X.a,this.inviteEmailSuccess=new X.a}var t,a,r;return t=e,(a=[{key:"init",value:function(){var e=this;if(this._premiumStatus.listen(function(t,a){e.hasPremiumFeatures()?(xo.pluginManager.notifyDependencyLoad(n.a.PluginDependency.EarlyAccess),xo.pluginManager.notifyDependencyLoad(n.a.PluginDependency.PremiumSub)):e.hasEarlyAccess()&&xo.pluginManager.notifyDependencyLoad(n.a.PluginDependency.EarlyAccess),t!==a&&a&&xo.DisplaySettings.onSettingChanged()}),!zn){var t=xo.settings.premiumStatus.get();if(void 0!==t){i.default.shouldLog(n.a.LogLevels.Account)&&i.default.log("Premium Status (Local): ",t);var a=xo.settings.trialStart.get()||Date.now(),r=xo.settings.trialDuration.get()||0,o=xo.settings.trialExtended.get()||!1;this._updateTrialDaysLeft(a,r,o);var s=xo.settings.premiumEndDate.get()||Date.now();if(this._premiumEndDate=new Date(s),this.setPremiumStatus(t),!f.a.isMobile){var l=S.a.getURLParam("premium");void 0!==l&&S.a.removeURLParam("premium",!0),l&&setTimeout(function(){xo.menus.openSettings(n.a.SettingsSections.Account)},100)}}this.checkRemotePremiumStatus()}}},{key:"runServerPing",value:function(e){i.default.XHR_PrivateAPI({type:"POST",path:"/user/ping",data:{platformConfig:f.a.getUserPlatformConfig()},requireAuth:!0,cb:function(t){t.status!==n.a.HTTPStatusCode.Success&&i.default.log("Failed to notify server of lastSeen: ",t.status,t.response),e&&e()}})}},{key:"checkRemotePremiumStatus",value:function(){i.default.Assert(!i.default.isDemoMode()||!1,"Should not be querying for premium status in demo mode")}},{key:"setLastSignupError",value:function(e){this._lastSignupError=e}},{key:"_reportRemoteStatusFailure",value:function(){i.default.sendEvent("Billing","RemoteStatusFailure")}},{key:"_updateTrialDaysLeft",value:function(e,t,a){var r=t-Math.ceil((Date.now()-e)/864e5);i.default.Assert(r<=320,"Sanity check on trial length",r),this._trialStart=e,this._trialDuration=t,this._trialExtended=a,this.daysLeftInTrial.set(r),this._premiumStatus.get()===n.a.PremiumStatus.Trial&&r<0?(this.setPremiumStatus(n.a.PremiumStatus.TrialOver),this.notifyTrialOver()):this._premiumStatus.get()===n.a.PremiumStatus.Trial&&r<5&&this.notifyTrialEndSoon()}},{key:"getBillingIdentifier",value:function(){this._billingIdentifier;return this._billingIdentifier}},{key:"onBillingIdentifierAvailable",value:function(e){}},{key:"onConnected",value:function(e){}},{key:"hasPremium",value:function(){return this._premiumStatus.get()===n.a.PremiumStatus.Active||this._premiumStatus.get()===n.a.PremiumStatus.PastDue}},{key:"isTrialState",value:function(){return this._premiumStatus.get()===n.a.PremiumStatus.Trial||this._premiumStatus.get()===n.a.PremiumStatus.TrialOver}},{key:"isCanceledState",value:function(){return this._premiumStatus.get()===n.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===n.a.PremiumStatus.CanceledPastDue}},{key:"canceledUserHasPremiumAccess",value:function(){return this.isCanceledState()&&this.getPremiumEndDate().getTime()>Date.now()}},{key:"isInFreeMonthAndPremium",value:function(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts>=100}},{key:"hasSubscription",value:function(){return!this._premiumCode}},{key:"setBillingData",value:function(e){i.default.Assert(e,"Must have a valid data bundle"),this._earlyAdopter=e.earlyAdopter,this._loginFlags=e.loginFlags||n.a.LoginFlags.None,this._inviteCode=e.inviteCode,this._referredBy=e.referredBy,this._joinDate=e.joinDate?new Date(parseInt(e.joinDate)):new Date,this._premiumStartDate=e.premiumStartDate?new Date(parseInt(e.premiumStartDate)):new Date,this._premiumEndDate=e.premiumEndDate?new Date(parseInt(e.premiumEndDate)):new Date,this._premiumCode=e.premiumCode,this._premiumCodeExpired=e.premiumCodeExpired||!1,this._nextBillingDate=e.nextBillingDate?new Date(parseInt(e.nextBillingDate)):new Date,this._trialStart=e.trialStart?new Date(parseInt(e.trialStart)):new Date,this._trialDuration=e.trialDuration||0,this._trialExtended=e.trialExtended||!1,xo.settings.isUnsubscribed.set(!!e.isUnsubscribed),xo.settings.monthlyInvoice.set(!!e.monthlyInvoice),xo.settings.invoiceEmail.set(e.invoiceEmail),xo.settings.invoiceCompany.set(e.invoiceCompany),xo.settings.invoiceAddress.set(e.invoiceAddress),this.setPremiumStatus(e.premiumStatus),this._hasValidBillingData.set(!0)}},{key:"setPremiumStatus",value:function(e){i.default.Assert(i.default.isNumber(e),"Status must be a valid number",e),i.default.Assert(e>0&&e<8,"Should be a valid status identifier",e),e!==this._premiumStatus.get()&&(this._premiumStatus.set(e),xo.settings.premiumStatus.set(e),i.default.fireCustomEvent("premiumStatusChanged"),i.default.setDimension(n.a.Analytics.Dimensions.PremiumStatus,e))}},{key:"hasValidBillingData",value:function(){return this._hasValidBillingData.get()}},{key:"getPremiumStatus",value:function(){return this._premiumStatus.get()}},{key:"getInviteCode",value:function(){return this._inviteCode}},{key:"getJoinDate",value:function(){return this._joinDate||new Date}},{key:"getPremiumStartDate",value:function(){return this._premiumStartDate||new Date}},{key:"getPremiumEndDate",value:function(){return this._premiumEndDate||new Date}},{key:"hasTrialExtended",value:function(){return this._trialExtended||!1}},{key:"isEligibleForTrialExtension",value:function(){return!1}},{key:"getNextBillingDate",value:function(){return this._nextBillingDate||new Date}},{key:"hasEarlyAccess",value:function(){return this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()}},{key:"onTapCancelSubscription",value:function(e,t){var a=this;i.default.sendEvent("Billing","SubCancelTapped");var r=function(){t&&i.default.isFunction(t)&&t()};return xo.menus.confirm("Are you sure you want to cancel your subscription?",function(e){e?(i.default.sendEvent("Billing","SubCancelYES"),i.default.XHR_PrivateAPI({type:"POST",path:"/billing/cancel",data:{email:a.getBillingIdentifier()},requireAuth:!0,cb:function(e){var t;if(200===e.status&&e.response){var o;try{o=JSON.parse(e.response)}catch(u){i.default.reportError(u)}if(o){var s=o.data,l=new Date(s.premiumEndDate).getTime();a._premiumEndDate=new Date(l),xo.settings.premiumEndDate.set(l),a.setPremiumStatus(n.a.PremiumStatus.CanceledUser),t="Your premium subscription has been canceled. Please contact support@moo.do if you need assistance."}else t="There was a server error, please try again in a few minutes or contact support@moo.do."}else t="There was a server error, please try again in a few minutes or contact support@moo.do.";xo.menus.alert({text:t,actionText:"OKAY"}),r()}})):(r(),i.default.sendEvent("Billing","SubCancelNO"))}),!0}},{key:"getCustomPurchaseURL",value:function(){}},{key:"_openPaymentWindow",value:function(e){var t=this;if(f.a.requireCustomPurchase)i.default.openUrl(this.getCustomPurchaseURL());else if(f.a.requireCustomPaypal){var a="Credit Card";xo.menus.options("If you are using PayPal, a new window will be opened to complete your purchase.",["PayPal",a],function(r){(r===a||"PayPal"===r)&&(r===a?xo.menus.openModal(n.a.Modals.Billing,{isUpdate:e}):"PayPal"===r&&i.default.openUrl(t.getCustomPurchaseURL()))})}else xo.menus.openModal(n.a.Modals.Billing,{isUpdate:e})}},{key:"onTapUpdatePaymentMethod",value:function(){this._openPaymentWindow(!1)}},{key:"onTapViewInvoices",value:function(){i.default.XHR_PrivateAPI({type:"GET",path:"/billing/listTransactions",requireAuth:!0,cb:function(e){var t;try{t=JSON.parse(e.response)}catch(a){i.default.reportError(a)}200===e.status&&t?xo.menus.openModal(n.a.Modals.Invoices,t.data):xo.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do.",callback:i.default.emptyFn})}})}},{key:"onTapDeleteAccount",value:function(e,t){var a=this;i.default.Assert(t&&i.default.isFunction(t),"Delete account cannot be called without a callback"),i.default.sendEvent("Billing","DeleteAccountTapped");var r=function(){t&&i.default.isFunction(t)&&t()};return xo.menus.openModal(n.a.Modals.DeleteAccount,{callback:function(e){e?(i.default.sendEvent("Billing","DeleteAccountYES"),i.default.XHR_PrivateAPI({type:"POST",path:"/tracking/delete",data:{email:a.getBillingIdentifier()},rquireAuth:!0,cb:function(e){200===e.status?xo.menus.alert({text:"Your account has been successfully deleted.",actionTxt:"OKAY",callback:function(){i.default.vmSetup.logout()}}):xo.menus.alert({text:"There was an error removing your email address from our server. Please contact support@moo.do for further assistance with code 3.",actionText:"OKAY"}),r()}})):(xo.menus.alert({text:"There was an error deleting your Moo.do documents. Please contact support@moo.do for further assistance with code 2.",actionText:"OKAY"}),r())}}),!0}},{key:"getInviteUrl",value:function(){return"https://www.moo.do/"}},{key:"getSelectText",value:function(){return"Select and press "+f.a.cmdChar+" + C to copy to clipboard"}},{key:"wasInvited",value:function(){return!!this._referredBy}},{key:"submitInviteCode",value:function(e,t){var a=this;if(e&&e.length>2)return i.default.sendEvent("Billing","EnterRefCode"),i.default.XHR_PrivateAPI({type:"POST",path:"/sharing/setReferral",data:{email:this.getBillingIdentifier(),refCode:e},requireAuth:!0,autoRetry:!0,cb:function(e){if(e.response){try{var r=JSON.parse(e.response)}catch(l){i.default.reportError(l)}if(200===e.status&&r){var o=r.data;a._referredBy=o.referredBy,a._premiumStatus.set(o.premiumStatus);var s=new Date(o.trialStart).getTime();a._updateTrialDaysLeft(s,o.trialDuration,o.trialExtended),a.inviteCodeError.set(""),i.default.sendEvent("Billing","EnterRefCodeSuccess")}else{if(r)switch(r.code){case n.a.PrivateAPIErrorCodes.AlreadyReferred:a.inviteCodeError.set(""),a.checkRemotePremiumStatus();break;case n.a.PrivateAPIErrorCodes.InvalidReferralCode:a.inviteCodeError.set("Referral code not found");break;default:a.inviteCodeError.set("Unable to use referral code")}else a.inviteCodeError.set("Unable to contact server");i.default.sendEvent("Billing","EnterRefCodeFailure")}}else a.inviteCodeError.set("Unable to contact server"),i.default.sendEvent("Billing","EnterRefCodeFailure");t&&t()}}),!0;this.inviteCodeError.set("Please enter a valid code")}},{key:"sendInviteEmail",value:function(e,t){var a=this;if(e&&e.length>0){for(var n=0,r=[],o=/.+@.+\..+/i,s=[],l=0;l<e.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o.lastIndex=0;var u=e[l];u&&(u=u.trim(),null===o.exec(u)?r.push(u):s.push(u))}if(0===r.length)return i.default.sendEvent("Billing","SendReferralEmail",s.length),i.default.XHR_PrivateAPI({type:"POST",path:"/sharing/sendReferral",data:{fromUser:this.getBillingIdentifier(),toEmailList:s},requireAuth:!0,autoRetry:!1,cb:function(e){if(t&&t(),200===e.status&&e.response){var n;try{n=JSON.parse(e.response).data}catch(u){i.default.reportError(u)}if(n&&0!==n.length){for(var r,o=0,s=[];l<n.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;s.push(n[0].email),r||(r=n[0].reason)}"exists"===r?a.inviteEmailError.set("One or more of the users is already a Moo.do user."):a.inviteEmailError.set("One or more of your emails could not be sent.")}else a.inviteEmailSuccess.set("Invite emails sent!"),a.inviteEmailError.set(""),setTimeout(function(){a.inviteEmailSuccess.set("")},4e3)}else a.inviteEmailError.set("Sorry! There was an error sending emails, please try again later.")}}),!0;this.inviteEmailError.set("Please enter a valid email: "+r[0])}}},{key:"joinDateText",value:function(){return this.getJoinDate().toString(xo.International.getFormat(n.a.DFormat.LongStrDate))}},{key:"premiumStartDateText",value:function(){return this.getPremiumStartDate().toString(xo.International.getFormat(n.a.DFormat.LongStrDate))}},{key:"premiumEndDateText",value:function(){return this.getPremiumEndDate().toString(xo.International.getFormat(n.a.DFormat.LongStrDate))}},{key:"nextBillingDateText",value:function(){return this.getNextBillingDate().toString(xo.International.getFormat(n.a.DFormat.LongStrDate))}},{key:"shareTwitter",value:function(){var e="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(e,550,420),i.default.sendEvent("Billing","ShareTwitter")}},{key:"shareFacebook",value:function(){var e="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(e,600,303),i.default.sendEvent("Billing","ShareFacebook")}},{key:"shareGoogle",value:function(){var e="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(e,500,650),i.default.sendEvent("Billing","ShareGoogle")}},{key:"showPopup",value:function(e,t,a){var i=t,n=a,r=window.screen.height,o=window.screen.width,s="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+i+",height="+n+",left="+Math.round(o/2-i/2)+",top="+Math.round(r/2-n/2);window.open(e,null,s)}},{key:"onTapSignupMonth",value:function(){this._pricingSelected=this.getMonthlyPricing(),this._openPaymentWindow(!1),i.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapSignupYear",value:function(){this._pricingSelected=this.getYearlyPricing(),this._openPaymentWindow(!1),i.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapCodeSignup",value:function(){var e=this;xo.menus.openModal(n.a.Modals.EnterCode,{title:"Redeem Code",text:"Enter your code below to redeem",onSelect:function(t){return e.redeemCode(t)}}),i.default.sendEvent("Blling","OpenEnterCodeModal")}},{key:"redeemCode",value:function(e){var t=this;return new Promise(function(a,r){i.default.isString(e)&&e.length>10?i.default.XHR_PrivateAPI({type:"POST",path:"/billing/useCode",requireAuth:!0,autoRetry:!0,data:{code:e},cb:function(o){if(o.status===n.a.HTTPStatusCode.Success)try{var s=JSON.parse(o.response).data;t._premiumStartDate=new Date(i.default.parseInt(s.premiumStartDate)),t._premiumEndDate=new Date(i.default.parseInt(s.premiumEndDate)),t._nextBillingDate=new Date(i.default.parseInt(s.nextBillingDate)),t._premiumCode=e,t._premiumCodeExpired=!1,t.setPremiumStatus(s.premiumStatus),xo.toasts.pushMessage({text:"Success! Thank you for going premium!",timeout:8e3}),a()}catch(l){i.default.reportError(l)}else o.status===n.a.HTTPStatusCode.BadRequest?r("The code that you entered was not valid or has already been used."):r("There was an error processing your request. Please contact support@moo.do for help.")}}):r("The code that you entered was not valid.")})}},{key:"getMonthlyPricing",value:function(){return this._earlyAdopter?n.a.Pricing.EarlyMonthly:n.a.Pricing.RegMonthly}},{key:"getYearlyPricing",value:function(){return this._earlyAdopter?n.a.Pricing.EarlyYearly:n.a.Pricing.RegYearly}},{key:"getMonthlyPrice",value:function(){return Hn[this.getMonthlyPricing()]}},{key:"getYearlyPrice",value:function(){return Hn[this.getYearlyPricing()]}},{key:"getPlanPrice",value:function(e){return Hn[e]}},{key:"notifyTrialOver",value:function(){if(!xo.settings.notifiedTrialOver.get()){if(!xo.toasts)return void setTimeout(this.notifyTrialOver.bind(this),0);xo.toasts.pushMessage(n.a.MessageID.TrialOver),xo.settings.notifiedTrialOver.set(!0)}}},{key:"notifyTrialEndSoon",value:function(){if(!xo.settings.notifiedTrialEndSoon.get()){if(!xo.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);xo.toasts.pushMessage(n.a.MessageID.TrialEndSoon),xo.settings.notifiedTrialEndSoon.set(!0)}}},{key:"isTrialOver",value:function(){var e=!1;return this._premiumStatus.get()===n.a.PremiumStatus.TrialOver?e=!0:this._premiumStatus.get()!==n.a.PremiumStatus.CanceledUser&&this._premiumStatus.get()!==n.a.PremiumStatus.CanceledPastDue||this.canceledUserHasPremiumAccess()||(e=!0),e}},{key:"startTrial",value:function(){var e=this;i.default.Assert(!this.isTrialOver(),"Should never try to start a trial once it is over"),i.default.XHR_PrivateAPI({type:"POST",path:"/billing/startTrial",requireAuth:!0,autoRetry:!0,cb:function(t){if(t.status===n.a.HTTPStatusCode.Success){e._premiumStatus.set(n.a.PremiumStatus.Trial);try{var a=JSON.parse(t.response).data,r=new Date(a.trialStart).getTime();xo.settings.trialStart.set(r),xo.settings.trialDuration.set(a.trialDuration),xo.settings.trialExtended.set(a.trialExtended),e._updateTrialDaysLeft(r,a.trialDuration,a.trialExtended)}catch(o){i.default.reportError(o)}}else if(t.status===n.a.HTTPStatusCode.BadRequest)try{(a=JSON.parse(t.response)).code===n.a.PrivateAPIErrorCodes.TrialOver&&(xo.toasts.pushMessage({text:"Your free trial of Premium has ended. Please contact support@moo.do to extend.",actionText:"OKAY"}),e._premiumStatus.set(n.a.PremiumStatus.TrialOver))}catch(o){i.default.reportError(o)}else i.default.Assert(!1,"Failed to start trial for user"),xo.toasts.pushMessage({text:"There was an error starting your trial. Please contact support@moo.do.",action:n.a.MessageAction.Contact})}})}},{key:"extendTrial",value:function(){var e=this;i.default.XHR_PrivateAPI({type:"POST",path:"/billing/extendTrial",requireAuth:!0,autoRetry:!0,cb:function(t){if(t.status===n.a.HTTPStatusCode.Success){e._premiumStatus.set(n.a.PremiumStatus.Trial);try{var a=JSON.parse(t.response).data,r=new Date(a.trialStart).getTime();xo.settings.trialStart.set(r),xo.settings.trialDuration.set(a.trialDuration),xo.settings.trialExtended.set(a.trialExtended),e._updateTrialDaysLeft(r,a.trialDuration,a.trialExtended)}catch(o){i.default.reportError(o)}}else i.default.Assert(!1,"Failed to extend trial for user"),xo.toasts.pushMessage({text:"There was an error restarting your trial. Please contact support@moo.do.",action:n.a.MessageAction.Contact})}})}},{key:"hasPremiumFeatures",value:function(){return this.hasPremium()||this._premiumStatus.get()===n.a.PremiumStatus.Trial||this.canceledUserHasPremiumAccess()}},{key:"getBillingPeriod",value:function(){return this._pricingSelected}}])&&jn(t.prototype,a),r&&jn(t,r),e}();function Wn(e,t,a){this._id=e,this._name=t,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._metadata={},this._useInMemoryStore=!a||!a.noInMemoryCache,this._useMetadataInMemoryStore=!a||!a.noMetadataInMemoryCache,this._isPerDoc=a&&a.isPerDoc,this.open()}var Gn={getStats:function(e){this.getFilterEntries(function(){return!0},function(t){var a={id:this._id,count:t.length,size:JSON.stringify(t).length};e(a)}.bind(this))},getState:function(){return{isOpen:this._isOpen,isReady:this._isReady,isAllLoaded:this._isAllLoaded,storageError:this._storageError}},enableLogging:function(){this._loggingEnabled=!0},disableLogging:function(){this._loggingEnabled=!1},isLoggingEnabled:function(){return this._loggingEnabled},usesDiskSpace:function(){return this._usesDiskSpace},_cacheInMemory:function(){return this._useInMemoryStore},_cacheMetadataInMemory:function(){return this._useMetadataInMemoryStore},_hasLoadedAll:function(){return this._isAllLoaded},isPerDoc:function(){return this._isPerDoc},getStorageType:function(){i.default.Assert(!1,"SubClass must override")},open:function(){this._isOpen=!0},close:function(){this._isOpen=!1,this._isReady=!1},isOpen:function(){return this._isOpen},isReady:function(){return this._isOpen&&this._isReady},requestPreloadData:function(e){var t=this._preloadConsumed;this._preloadConsumed=!0;var a=window.__preload;if(!(!t&&a&&a.cachePreloads&&a.cachePreloads.indexOf(this._id)>=0))return e(void 0);if(a.cacheResults[this._id]){i.default.Assert(!a.cacheCallbacks[this._id],"Should never have active callbacks and results");var n=a.cacheResults[this._id];return delete a.cacheResults[this._id],a.cachePreloads.remove(this._id),e(n)}a.cacheCallbacks[this._id]||(a.cacheCallbacks[this._id]=[]),a.cacheCallbacks[this._id].push(e)},isMetadataReady:function(){return this._isOpen&&this._isMetadataReady},notifyCacheReady:function(e){if(e){var t=0;this._storageError=!1,this._isReady=!0;for(var a=0;a<this._onReadyFns.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._onReadyFns[a]()}this._onReadyFns=[]}else this._storageError=!0,this._isReady=!1},notifyCacheMetadataReady:function(e){if(e){var t=0;this._isMetadataReady=!0;for(var a=0;a<this._onMetadataReadyFns.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._onMetadataReadyFns[a]()}this._onMetadataReadyFns=[]}else this._isMetadataReady=!1},onCacheReady:function(e){i.default.Assert(e,"Must provide a valid cb"),this._isReady?setTimeout(e,0):(i.default.Assert(this._onReadyFns.indexOf(e)<0,"Must not double register a cache ready fn"),this._onReadyFns.push(e))},onCacheMetadataReady:function(e){i.default.Assert(e,"Must provide a valid cb"),this._isMetadataReady?setTimeout(e,0):(i.default.Assert(this._onMetadataReadyFns.indexOf(e)<0,"Must not double register a cache metadata ready fn"),this._onMetadataReadyFns.push(e))},setMetadata:function(e,t,a){i.default.Assert(!a,"In memory query is sync"),this._cacheMetadataInMemory()&&(this._metadata[e]=t)},removeMetadata:function(e,t){i.default.Assert(!t,"In memory query is sync"),this._cacheMetadataInMemory()&&delete this._metadata[e]},getMetadata:function(e,t){return i.default.Assert(!t,"In memory query is sync"),this._cacheMetadataInMemory()?this._metadata[e]:void 0},_setRawInMemoryMetadata:function(e){i.default.Assert(this._cacheMetadataInMemory(),"Must be running an in-memory cache"),this._metadata=e},_getRawInMemoryMetadata:function(){return this._cacheMetadataInMemory()?this._metadata:void 0},_setRawInMemoryCache:function(e){i.default.Assert(this._cacheInMemory(),"Must be running an in-memory cache"),this._cache=e},_getRawInMemoryCache:function(){return this._cacheInMemory()?this._cache:void 0},count:function(e){return i.default.Assert(!e,"In memory query is sync"),this._cacheInMemory()?Object.keys(this._cache).length:void 0},size:function(e){return i.default.Assert(!e,"In memory query is sync"),this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0},loadAll:function(e){i.default.Assert(!e,"In memory query is sync"),this._isAllLoaded=!0},getEntrySync:function(e){return this._cacheInMemory()?this._cache[e]:void 0},getEntry:function(e,t){return i.default.Assert(!t,"In memory query is sync"),this._cacheInMemory()?this._cache[e]:void 0},getBoundEntries:function(e,t,a,n){var r;if(i.default.Assert(!n,"In memory query is sync"),this._cacheInMemory())for(var o in r=[],this._cache)this._cache[o][e]>=t&&this._cache[o][e]<=a&&r.push(this._cache[o]);return r},getFilterEntries:function(e,t){var a;if(i.default.Assert(!t,"In memory query is sync"),this._cacheInMemory())for(var n in a=[],this._cache)e(this._cache[n])&&a.push(this._cache[n]);return a},removeEntry:function(e,t){i.default.Assert(!t,"In memory query is sync"),this._cacheInMemory()&&delete this._cache[e]},hasEntry:function(e,t){return i.default.Assert(!t,"In memory query is sync"),!!this._cacheInMemory()&&this._cache.hasOwnProperty(e)},cacheEntry:function(e,t,a){i.default.Assert(!a,"In memory query is sync"),this.isLoggingEnabled()&&i.default.log("Cache Entry: ",e,t),this._cacheInMemory()&&t&&(this._cache[e]=t)},clearCache:function(e){i.default.Assert(!e,"In memory query is sync"),this._cache={}},clearMetadata:function(e){i.default.Assert(!e,"In memory query is sync"),this._metadata={}},clearBackingStore:function(e){i.default.Assert(!1,"SubClass must override")},dumpData:function(e){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)},onCacheError:function(e){i.default.reportError(e)}};S.a.defineBase(Wn),S.a.extend(Wn.prototype,Gn);var Kn=Wn;function Yn(e,t,a){a&&(i.default.Assert(!a.noInMemoryCache,"Invalid in-memory cache option"),i.default.Assert(!a.noMetadataInMemoryCache,"Invalid metadata in-memory cache option"),a.noInMemoryCache=!1,a.noMetadataInMemoryCache=!1),this._super.constructor.call(this,e,t,a),this._db=void 0}var Xn={getStorageType:function(){return n.a.StorageType.InMemory},setMetadata:function(e,t,a){this._super.setMetadata.call(this,e,t),a&&a(!0)},removeMetadata:function(e,t){this._super.removeMetadata.call(this,e),t&&t(!0)},getMetadata:function(e,t){var a=this._super.getMetadata.call(this,e)||void 0;t&&t(a)},count:function(e){i.default.Assert(e,"Must provide a valid callback");var t=this._super.count.call(this);e&&e(t)},size:function(e){i.default.Assert(e,"Must provide a valid callback");var t=this._super.size.call(this);e&&e(t)},loadAll:function(e){this._super.loadAll.call(this),e&&e(!0)},getEntrySync:function(e){return i.default.Assert(e,"Must provide a valid ID to get"),this._super.getEntrySync.call(this,e)||void 0},getEntry:function(e,t){i.default.Assert(e,"Must provide a valid ID to get"),i.default.Assert(t,"Must provide a valid entry callback");var a=this._super.getEntry.call(this,e)||void 0;t&&t(a,e)},getBoundEntries:function(e,t,a,n){i.default.Assert(e,"Must specify a valid index"),i.default.Assert(n,"Must provide a valid entry callback");var r=this._super.getBoundEntries.call(this,e,t,a)||[];n&&n(r)},getFilterEntries:function(e,t){i.default.Assert(i.default.isFunction(e),"Must specify a valid filter function"),i.default.Assert(t,"Must provide a valid entry callback");var a=this._super.getFilterEntries.call(this,e)||[];t&&t(a)},removeEntry:function(e,t){i.default.Assert(e,"Must provide valid data id"),this._super.removeEntry.call(this,e),t&&t(!0)},hasEntry:function(e,t){var a=this._super.hasEntry.call(this,e);t&&t(a)},cacheEntry:function(e,t,a){i.default.Assert(e,"Must provide valid data id"),this._super.cacheEntry.call(this,e,t),a&&a(!0)},clearCache:function(e){this._super.clearCache.call(this),e&&e(!0)},clearMetadata:function(e){this._super.clearMetadata.call(this),e&&e(!0)},clearBackingStore:function(e){e&&e(!0)}};S.a.inherit(Kn,Yn),S.a.extend(Yn.prototype,Xn);var Qn=Yn,Jn=a(72);function Zn(e,t,a){this._usesDiskSpace=!0,this._db=void 0,this._cacheTable=void 0,this._metadataTable=void 0,this._version=2,this._schema=this._getDefaultSchema(),this._super.constructor.call(this,e,t,a)}var $n={_makeID:function(e){return e},validID:function(e){return!0},_metadataID:function(e){return e},getStorageType:function(){return n.a.StorageType.IndexedDB},_migrateEntry:function(e,t,a){delete e.cid,this._cacheTable.update(e).done(t).fail(a)},_migrateMetadata:function(e,t,a){delete e.cid,this._super.setMetadata.call(this,e.id,e.value),this._metadataTable.update(e).done(t).fail(a)},open:function(){var e=this;this._super.open.call(this),Jn.default.openCacheDatabase(this._id,this._version,this._schema,function(t){i.default.Assert(!e._db,"Should not open the cache DB twice"),t&&(e._db=t,e._cacheTable=t.cache,e._metadataTable=t.metadata),e.notifyCacheMetadataReady(!!t),e.notifyCacheReady(!!t)})},close:function(){this._super.close.call(this),this._db.close(),this._db=void 0,this._cacheTable=void 0,this._metadataTable=void 0},isReady:function(){return this._super.isReady.call(this)&&this._db&&this._cacheTable},isMetadataReady:function(){return this._super.isReady.call(this)&&this._db&&this._metadataTable},notifyCacheReady:function(e){this._super.notifyCacheReady.call(this,e)},notifyCacheMetadataReady:function(e){this._super.notifyCacheMetadataReady.call(this,e)},setMetadata:function(e,t,a){if(this._super.setMetadata.call(this,e,t),this.isMetadataReady()){var i={id:e,value:t};try{this._metadataTable.update(i).done(function(){a&&a(!0)}).fail(function(e,t){this.onCacheError(t),a&&a(!1)}.bind(this))}catch(n){this.onTransactionError(n),a&&a(!1)}}else a&&a(!1)},removeMetadata:function(e,t){if(this._super.removeMetadata.call(this,e),this.isMetadataReady())try{this._metadataTable.remove(this._metadataID(e)).done(function(){t&&t(!0)}).fail(function(e){i.default.log("IDB removeMetadata Error: ",e),t&&t(!1)})}catch(a){this.onTransactionError(a),t&&t(!1)}else t&&t(!1)},getMetadata:function(e,t){var a=this._super.getMetadata.call(this,e);if(a)t(a);else if(this.isMetadataReady())try{this._metadataTable.query().only(this._metadataID(e)).limit(1).execute().done(function(e){var a;i.default.Assert(!e||0===e.length||1===e.length&&e[0],"Mismatch in metadata value"),e&&1===e.length&&e[0]&&(a=e[0].value),t(a)}).fail(function(e){i.default.log("IDB getMetadata Error: ",e),t(void 0)})}catch(n){this.onTransactionError(n),t(void 0)}else t(void 0)},count:function(e){if(this.isReady())try{this._cacheTable.query().all().count().execute().done(function(t){e(t)}).fail(function(t){e()})}catch(t){this.onTransactionError(t),e()}else e()},size:function(e){if(this.isReady())try{this._cacheTable.query().all().execute().done(function(t){for(var a=0,i=0,n=0;n<t.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i+=this._entrySize(t[n])}e(i)}).fail(function(t){e()})}catch(t){this.onTransactionError(t),e()}else e()},loadAll:function(e){if(this.isReady())try{this._cacheTable.query().all().execute().done(function(t){for(var a=0,i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._super.cacheEntry.call(this,t[i].id,t[i])}this._super.loadAll.call(this),e(!0,t)}.bind(this)).fail(function(t){i.default.log("IDB loadAll Error: ",t),this._super.loadAll.call(this),e(!1)})}catch(t){this.onTransactionError(t),e(!1)}else e(!1)},getEntrySync:function(e){i.default.Assert(!1,"Sync access to IDB is not supported")},getEntry:function(e,t){i.default.Assert(e,"Must provide a valid ID to get"),i.default.Assert(t,"Must provide a valid entry callback");var a=this._super.getEntry.call(this,e);if(a)t(a);else if(this.isReady())try{this._cacheTable.query().only(this._makeID(e)).limit(1).execute().done(function(a){var i;a&&1===a.length&&(i=a[0],this._super.cacheEntry.call(this,e,i)),t(i,e)}.bind(this)).fail(function(e){i.default.log("IDB getEntry Error: ",e),t(void 0)})}catch(n){this.onTransactionError(n),t(void 0)}else t(void 0)},getBoundEntries:function(e,t,a,n){if(i.default.Assert(e,"Must specify a valid index to query"),i.default.Assert(n,"Must provide a valid entry callback"),this.isReady())try{this._cacheTable.query().filter(function(i){return i[e]>=t&&i[e]<=a}).execute().done(function(e){n(e,!0)}.bind(this)).fail(function(e){n([],!1)}.bind(this))}catch(r){this.onTransactionError(r),n([],!1)}else n([],!1)},getFilterEntries:function(e,t){if(i.default.Assert(i.default.isFunction(e),"Must specify a valid filter function"),i.default.Assert(t,"Must provide a valid entry callback"),this.isReady())try{this._cacheTable.query().filter(e).execute().done(function(e){t(e,!0)}.bind(this)).fail(function(e){t([],!1)}.bind(this))}catch(a){this.onTransactionError(a),t(!1)}else t([],!1)},removeEntry:function(e,t){if(i.default.Assert(e,"Must provide valid data id"),this._super.removeEntry.call(this,e),this.isReady())try{this._cacheTable.remove(this._makeID(e)).done(function(){t&&t(!0)}).fail(function(e){i.default.log("IDB removeEntry Error: ",e),t&&t(!1)})}catch(a){this.onTransactionError(a),t&&t(!1)}else t&&t(!1)},hasEntry:function(e,t){if(this._super.hasEntry.call(this,e))t(!0);else if(this.isReady())try{this._cacheTable.query().only(this._makeID(e)).limit(1).execute().done(function(a){var i;a&&1===a.length&&(i=a[0],this._super.cacheEntry.call(this,e,i)),t(!!i)}.bind(this)).fail(function(e){i.default.log("IDB hasEntry Error: ",e),t(!1)})}catch(a){this.onTransactionError(a),t(!1)}else t(!1)},_entrySize:function(e){var t=0;try{t=2*JSON.stringify(e).length}catch(a){i.default.reportError(a)}return t},cacheEntry:function(e,t,a){if(i.default.Assert(e,"Must provide valid data id"),i.default.Assert(t.id,"Data must also contain a valid item id"),this._super.cacheEntry.call(this,e,t),this.isReady())try{this._cacheTable.update(t).done(function(){if(a)try{a(!0)}catch(e){i.default.reportError(e)}}).fail(function(e,t){this.onCacheError(t),a&&a(!1)}.bind(this))}catch(n){this.onTransactionError(n),a&&a(!1)}else a&&a(!1)},clearCache:function(e){if(this._super.clearCache.call(this),this.isReady())try{this._cacheTable.clear().done(function(){e&&e(!0)}).fail(function(t){i.default.log("IDB clearcache Error: ",t),e&&e(!1)})}catch(t){this.onTransactionError(t),e&&e(!1)}else e&&e(!1)},clearMetadata:function(e){if(this._super.clearMetadata.call(this),this.isReady())try{this._metadataTable.clear().done(function(){e&&e(!0)}.bind(this)).fail(function(t){i.default.log("IDB clearMetadata Error: ",t),e&&e(!1)})}catch(t){this.onTransactionError(t),e&&e(!1)}else e&&e(!1)},dumpData:function(e){e?this._super.dumpData.call(this,e):(console.log("-- Cache: ",this._id,"--"),this.isReady()?this._cacheTable.query().all().execute().done(function(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;console.log(e[a])}}).fail(function(e){console.log("Error running IDB query: ",e)}):console.log("Cache not ready"))},_getDefaultSchema:function(){return{cache:{key:{keyPath:"id"}},metadata:{key:{keyPath:"id"}}}},onTransactionError:function(e){Jn.default.notifyDBUnexpectedClose(!1)},onCacheError:function(e){if(e&&e.target)try{var t=e.target.error;t?"QuotaExceededError"===t.name||4===t.code?xo.cacheManager.hasReportedQuotaError()||(xo.cacheManager.reportQuotaExceeded(),xo.pluginManager.onCacheLimitExceeded()):"InvalidStateError"===t.name?Jn.default.notifyDBUnexpectedClose(!1):i.default.reportError(new Error("IDB Cache Transaction Error"),e):i.default.reportError(new Error("IDB Cache Transaction Error [No Target Error]"),e)}catch(a){i.default.reportError(a)}}};S.a.inherit(Kn,Zn),S.a.extend(Zn.prototype,$n);var er=Zn,tr=5e3;function ar(e,t,a){a?(i.default.Assert(!a.noInMemoryCache,"Invalid in-memory cache option"),i.default.Assert(!a.noMetadataInMemoryCache,"Invalid metadata in-memory cache option"),a.noInMemoryCache=!1,a.noMetadataInMemoryCache=!1,this.saveTime=isNaN(a.saveTime)?tr:a.saveTime,a.writeOnUnload&&o.a.listen("onUnload",this.writeCache.bind(this)),a.clearBackingOnLoad&&(this.clearBackingOnLoad=!0,o.a.listen("enterForeground",this.clearBackingStore.bind(this)))):this.saveTime=tr,this._super.constructor.call(this,e,t,a),this._saveTimeout=void 0,S.a.forceBind("writeCache",this)}var ir={_localStorageKey:function(){return"MDC_"+this._id},_onWrite:function(e){e||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))},writeCache:function(){performance.now();var e,t={metadata:this._getRawInMemoryMetadata(),cache:this._getRawInMemoryCache()};try{e=JSON.stringify(t),ye.a.setValue(this._localStorageKey(),e)}catch(a){i.default.reportError(a)}},close:function(){this._onWrite(!0),this._super.close.call(this)},getStorageType:function(){return n.a.StorageType.LocalStorage},setMetadata:function(e,t,a){this._super.setMetadata.call(this,e,t),this._onWrite(),a&&a(!0)},getMetadata:function(e,t){var a=this._super.getMetadata.call(this,e)||void 0;t&&t(a)},count:function(e){i.default.Assert(e,"Must provide a valid callback");var t=this._super.count.call(this);e&&e(t)},size:function(e){i.default.Assert(e,"Must provide a valid callback");var t=this._super.size.call(this);e&&e(t)},loadAll:function(e){try{var t=ye.a.getValue(this._localStorageKey());if(t){var a=JSON.parse(t);this._setRawInMemoryMetadata(a.metadata),this._setRawInMemoryCache(a.cache)}this._super.loadAll.call(this),this.clearBackingOnLoad&&this.clearBackingStore(),e&&e(!0)}catch(n){i.default.reportError(n),this._super.loadAll.call(this),e&&e(!1)}},getEntrySync:function(e){return i.default.Assert(e,"Must provide a valid ID to get"),this._super.getEntrySync.call(this,e)||void 0},getEntry:function(e,t){i.default.Assert(e,"Must provide a valid ID to get"),i.default.Assert(t,"Must provide a valid entry callback");var a=this._super.getEntry.call(this,e)||void 0;t&&t(a,e)},getBoundEntries:function(e,t,a,i){var n=this._super.getBoundEntries.call(this,e,t,a);i&&i(n)},getFilterEntries:function(e,t){var a=this._super.getFilterEntries.call(this,e);t&&t(a)},removeEntry:function(e,t){i.default.Assert(e,"Must provide valid data id"),this._super.removeEntry.call(this,e),this._onWrite(),t&&t(!0)},hasEntry:function(e,t){var a=this._super.hasEntry.call(this,e);t&&t(a)},cacheEntry:function(e,t,a){i.default.Assert(e,"Must provide valid data id"),this._super.cacheEntry.call(this,e,t),this._onWrite(),a&&a(!0)},clearCache:function(e){this._super.clearCache.call(this),this._onWrite(!0),e&&e(!0)},clearMetadata:function(e){this._super.clearMetadata.call(this),this._onWrite(),e&&e(!0)},clearBackingStore:function(e){ye.a.removeValue(this._localStorageKey()),e&&e(!0)}};S.a.inherit(Kn,ar),S.a.extend(ar.prototype,ir);var nr=ar;function rr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var or,sr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[]}var t,a,r;return t=e,(a=[{key:"init",value:function(){this._storageReady[n.a.StorageType.InMemory]=!0,this._storageReady[n.a.StorageType.LocalStorage]=!0}},{key:"getInfo",value:function(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}}},{key:"registerLocalCache",value:function(e,t,a,r){i.default.Assert(e,"Must provide a valid cache ID"),i.default.Assert(t,"Must have a valid cache name");var o,s=this._createCacheId(e,t);switch(i.default.Assert(void 0===this._registeredCaches[s],"Must not have a previously registered cache with the same id"),i.default.shouldWriteLocal()||(a=n.a.StorageType.InMemory,r&&(r.noInMemoryCache=!1,r.noMetadataInMemoryCache=!1)),a){case n.a.StorageType.InMemory:o=new Qn(s,t,r);break;case n.a.StorageType.LocalStorage:o=new nr(s,t,r);break;case n.a.StorageType.IndexedDB:o=new er(s,t,r)}return i.default.Assert(o,"Must have valid cache after creation"),this._registeredCaches[e]=o,this._storageReady[a]&&(o.notifyCacheMetadataReady(!0),o.notifyCacheReady(!0)),o}},{key:"clearLocalCache",value:function(e,t){var a=this._registeredCaches[e];i.default.Assert(a,"Must have valid local cache"),a.clearCache(),t&&a.clearMetadata()}},{key:"clearLocalCaches",value:function(e){for(var t in this._registeredCaches)this.clearLocalCache(t,e)}},{key:"clearPerDocCaches",value:function(e){for(var t in this._registeredCaches){this._registeredCaches[t].isPerDoc()&&this.clearLocalCache(t,e)}}},{key:"_notifyIDBReady",value:function(e){}},{key:"_createCacheId",value:function(e,t){return e}},{key:"notifyMigrationRequired",value:function(){this._migrationRequired=!0}},{key:"needsMigration",value:function(){return this._migrationRequired||1!==xo.settings.localDataVersion.get()}},{key:"hasReportedQuotaError",value:function(){return this._reportedQuotaError}},{key:"reportQuotaExceeded",value:function(){this._reportedQuotaError||(this._reportedQuotaError=!0,i.default.reportError(new Error("Quota exceeded!")))}}])&&rr(t.prototype,a),r&&rr(t,r),e}();function lr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ur(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var dr=(ur((or=function(){function e(t,a,n,r,o,s,l,u,d){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=t,this._remoteID=o,this._type=a,i.default.Assert(i.default.isDateValid(n),"Must specify a valid schedule date for deferred task"),this._scheduleDate=n,this._timeout=void 0,this._data=s,this._cbRun=l,this._cbCancel=u,this._cbPersistRemote=d,this._hasRun=!1,this._isCanceled=r,this._destroyed=!1}var t,a,n;return t=e,(a=[{key:"schedule",value:function(){var e=this;i.default.Assert(!this._timeout,"Should not schedule the same task multiple times"),i.default.Assert(!this._hasRun,"Should not schedule a task once it has already run once"),i.default.Assert(!this._isCanceled,"Should not schedule canceled tasks");var t=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,t),!this._remoteID&&t>0&&Ke.a.onLoaded(function(){try{e._cbPersistRemote(e,e._onPersistedRemote)}catch(t){i.default.reportError(t)}})}},{key:"_onCanceled",value:function(e){e&&(this._destroyed=!0,xo.deferredTaskManager._notifyTaskComplete(this._id))}},{key:"_onPersistedRemote",value:function(e,t){e&&(this._remoteID=t,xo.deferredTaskManager._updateTask(this._id))}},{key:"reschedule",value:function(e){i.default.Assert(!this._hasRun,"Should never reschedule a task that has already run"),i.default.Assert(!this._isCanceled,"Should not reschedule canceled tasks"),i.default.Assert(this._timeout,"Must always have already schedule a task that is being rescheduled"),clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=e,this.schedule()}},{key:"cancel",value:function(){var e=this;i.default.Assert(this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled"),i.default.Assert(!this._hasRun,"Should not cancel tasks that have already been run"),this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&Ke.a.onLoaded(function(){try{e._cbCancel(e,e._onCanceled)}catch(t){i.default.reportError(t)}}),xo.deferredTaskManager._updateTask(this._id)}},{key:"runTask",value:function(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(e){i.default.reportError(e)}xo.deferredTaskManager._notifyTaskComplete(this._id)}},{key:"getData",value:function(){return this._data}},{key:"getType",value:function(){return this._type}},{key:"getScheduleDate",value:function(){return this._scheduleDate}},{key:"getSaveData",value:function(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}}},{key:"isPersistedRemote",value:function(){return!!this._remoteID}}])&&lr(t.prototype,a),n&&lr(t,n),e}()).prototype,"_onCanceled",[g.a],Object.getOwnPropertyDescriptor(or.prototype,"_onCanceled"),or.prototype),ur(or.prototype,"_onPersistedRemote",[g.a],Object.getOwnPropertyDescriptor(or.prototype,"_onPersistedRemote"),or.prototype),ur(or.prototype,"runTask",[g.a],Object.getOwnPropertyDescriptor(or.prototype,"runTask"),or.prototype),or);function cr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var hr,fr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._registeredTypes={},this._deferredTasks={},this._stats={}}var t,a,r;return t=e,(a=[{key:"init",value:function(){var e=this;this._taskCache=xo.cacheManager.registerLocalCache("DeferredTasks","DeferredTasks",n.a.StorageType.LocalStorage),this._taskCache.onCacheReady(function(){e._taskCache.loadAll(function(t){i.default.Assert(t,"Must be able to load task cache"),e._taskCache.getFilterEntries(function(){return!0},function(t){for(var a=0,i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];e.scheduleTask(n.id,n.type,new Date(n.scheduleDate),n.isCanceled,n.remoteID,n.data,!0)}})})})}},{key:"getLastSyncDate",value:function(){var e=xo.settings.lastTaskSync.get();return i.default.Assert(!e||i.default.isString(e),"Must have a valid string sync date"),e}},{key:"getStats",value:function(){return{}}},{key:"notifyRemoteTasks",value:function(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._handleRemoteTask(e[a])}xo.settings.lastTaskSync.set(new Date)}},{key:"_handleRemoteTask",value:function(e){i.default.log("Remote Task: ",e),this.scheduleTask(e.data.threadID,e.type,new Date(e.data.scheduleDate),!1,e.messageID,e.data)}},{key:"registerTaskType",value:function(e,t,a,n){i.default.Assert(!this._registeredTypes[e],"Must not double register task type"),i.default.Assert(i.default.isFunction(t),"Must register a valid run callback"),i.default.Assert(i.default.isFunction(a),"Must register a valid cancel callback"),i.default.Assert(i.default.isFunction(n),"Must register a valid persist callback"),this._registeredTypes[e]={cbRun:t,cbCancel:a,cbPersistRemote:n}}},{key:"_notifyTaskComplete",value:function(e){this._removeTask(e)}},{key:"scheduleTask",value:function(e,t,a,n,r,o,s){i.default.Assert(e,"Must supply a valid task ID"),i.default.Assert(t,"Must supply a valid task type"),i.default.Assert(i.default.isDateValid(a),"Must always have a valid scheduled date available"),this._taskCache.onCacheReady(function(){if(i.default.Assert(this._registeredTypes[t],"Must request a valid registered task type"),this._deferredTasks[e]){var l=this._deferredTasks[e];return i.default.Assert(l.getType()===t,"Task types must match"),void i.default.Assert(l.getScheduleDate().equals(a),"Task schedule dates must match")}var u=this._registeredTypes[t];if(u){var d=new dr(e,t,a,n,r,o,u.cbRun,u.cbCancel,u.cbPersistRemote);this._deferredTasks[e]&&(i.default.log("Overriding existing task"),i.default.Assert(this._deferredTasks[e].type===t,"Should only update deferred tasks of the same type")),this._addTask(e,d,s),n?d.cancel():d.schedule()}}.bind(this))}},{key:"cancelTask",value:function(e,t){this._deferredTasks[e].cancel()}},{key:"_updateTask",value:function(e){var t=this._deferredTasks[e];this._taskCache.cacheEntry(e,t.getSaveData())}},{key:"_addTask",value:function(e,t,a){this._deferredTasks[e]=t,a||this._updateTask(e)}},{key:"_removeTask",value:function(e){this._deferredTasks[e]=void 0,this._taskCache.removeEntry(e)}}])&&cr(t.prototype,a),r&&cr(t,r),e}(),pr=a(64);function gr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mr(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var vr="Suspend",yr="Resume",_r="AsyncSkip",br="SyncSkip",kr="Run",wr="AsyncBegin",Sr="AsyncComplete",Ir="AsyncAbort",Dr="AsyncTimeout",Cr=(mr((hr=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i.default.Assert(a,"Must provide a valid set of task options: "+t),this._id=t,this._iterationID=void 0,this._isAsync=a.async,this._isAsyncRunning=!1,i.default.Assert(a.task&&i.default.isFunction(a.task),"Must provide a valid task function"),this._task=a.task,this._delay=a.delay,i.default.Assert(void 0===a.asyncTimeout||a.async,"Should never specify an async timeout for a non-async task"),this._asyncTimeout=a.asyncTimeout||0,this._pauseWhileIdle=a.pauseWhileIdle||!1,this._minDelayOnResume=a.minDelayOnResume||!1,i.default.Assert(this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume"),this._suspended=!1,this._remainingTime=0,this._lastUpdate=a.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=a.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new pr.a(10),this._actions=new pr.a(20),this.init()}var t,a,n;return t=e,(a=[{key:"init",value:function(){this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()}},{key:"getStats",value:function(){return{numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()}}},{key:"cancel",value:function(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0}},{key:"abortAsync",value:function(){this._numAsyncAborts++,this.performAction(Ir),this._notifyAsyncAborted()}},{key:"performAction",value:function(e){i.default.Assert(e,"Invalid action reported"),this._actions.push({action:e,time:Date.now()})}},{key:"notifyOfSuspend",value:function(){this._pauseWhileIdle&&(this.performAction(vr),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)}},{key:"notifyOfResume",value:function(){if(this._pauseWhileIdle){this.performAction(yr);var e,t=!this._suspended;this._suspended=!1,this._minDelayOnResume?e=Math.max(0,this._minDelay-this._timeSinceLastUpdate()):(i.default.Assert(t||this._remainingTime>=0,"Must have a valid remaining time set for task"),e=this._remainingTime,this._remainingTime=-1),e=Math.max(500,e),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e)}}},{key:"isAsync",value:function(){return this._isAsync}},{key:"isAsyncRunning",value:function(){return this.isAsync()&&this._isAsyncRunning}},{key:"_notifyUpdateAsyncSkipped",value:function(){this._numUpdatesAsyncSkipped++,this.performAction(_r)}},{key:"_notifyUpdateSkipped",value:function(){this._numUpdatesSkipped++,this.performAction(br)}},{key:"_notifyUpdateRun",value:function(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(kr)}},{key:"_timeSinceLastUpdate",value:function(){return Date.now()-this._lastUpdate}},{key:"_asyncRunTime",value:function(){var e=0;return this._asyncStartTime>0&&(e=Date.now()-this._asyncStartTime),e}},{key:"_notifyAsyncBegin",value:function(){return this.performAction(wr),this._isAsyncRunning=!0,this._iterationID=i.default.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID}},{key:"_notifyAsyncComplete",value:function(){this.performAction(Sr),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_notifyAsyncAborted",value:function(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_handleAsyncAbortTimeout",value:function(){this._numAsyncTimeouts++,this.performAction(Dr),this._notifyAsyncAborted()}},{key:"_runUpdate",value:function(e){var t=this,a=arguments;if(i.default.Assert(!this._isCancelled,"Should never run a cancelled task"),i.default.Assert(!this._updateIsRunning,"Should not run another update while already running one: "+this._id),!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,e),0)):this._notifyUpdateAsyncSkipped();else{var n=this._notifyAsyncBegin();try{this._task(function(){i.default.Assert(n===t._iterationID,"Callback is only valid while task is considered running"),t._notifyAsyncComplete(),e&&e.apply(t,a)})}catch(r){i.default.reportError(r),this._notifyAsyncComplete()}}else try{this._task()}catch(r){i.default.reportError(r)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}}},{key:"requestUpdate",value:function(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var e=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e),this._lastSetDelay=this._minDelay}}},{key:"forceUpdate",value:function(e){this._runUpdate(e)}},{key:"breakOnNextUpdate",value:function(){0}}])&&gr(t.prototype,a),n&&gr(t,n),e}()).prototype,"_notifyAsyncComplete",[g.a],Object.getOwnPropertyDescriptor(hr.prototype,"_notifyAsyncComplete"),hr.prototype),mr(hr.prototype,"_handleAsyncAbortTimeout",[g.a],Object.getOwnPropertyDescriptor(hr.prototype,"_handleAsyncAbortTimeout"),hr.prototype),mr(hr.prototype,"_runUpdate",[g.a],Object.getOwnPropertyDescriptor(hr.prototype,"_runUpdate"),hr.prototype),hr);function Pr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ar,Mr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._tasks={}}var t,a,n;return t=e,(a=[{key:"init",value:function(){f.a.isMobile||(window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this)))}},{key:"getStats",value:function(){var e={};for(var t in this._tasks)e[t]=this._tasks[t].getStats();return e}},{key:"createRecurringTask",value:function(e,t){i.default.Assert(!this._tasks[e],"Must not register multiple tasks with the same ID");var a=new Cr(e,t);return this._tasks[e]=a,a}},{key:"getRecurringTask",value:function(e){return i.default.Assert(this._tasks[e],"Must only retreive a valid recurring task"),this._tasks[e]}},{key:"hasRecurringTask",value:function(e){return!!this._tasks[e]}},{key:"cancelRecurringTask",value:function(e){i.default.Assert(this._tasks[e],"Must only cancel a valid recurring task"),this._tasks[e].cancel(),delete this._tasks[e]}},{key:"_handleFocus",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfResume()}},{key:"_handleBlur",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfSuspend()}}])&&Pr(t.prototype,a),n&&Pr(t,n),e}();function Tr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Er(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var Lr,xr=(Er((Ar=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._numTimesItemsUpdated=0,this._itemsUpdateTimeout=void 0,this.itemFlushStacks=[],this.EnableItemFlushStacks=!0,this._isUpdating=!1,this._numFlushesInCommit=0,this._isWaitingUpdateItems=0,this._itemsDirty=!1,this._forceNotify=!1,this._updateSearch=!1,this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0}var t,a,n;return t=e,(a=[{key:"checkItemsUpdated",value:function(){0}},{key:"notifyItemsUpdated",value:function(e,t){this._numTimesItemsUpdated++,this.EnableItemFlushStacks&&this.itemFlushStacks.push({stack:i.default.getCurrentStack("Update Items Stack"),panes:e,forceNotify:t}),this._itemsUpdateTimeout||(this._itemsUpdateTimeout=setTimeout(this.checkItemsUpdated,0))}},{key:"_updateAllItems",value:function(){var e=this._forceNotify;this._forceNotify=!1;var t=this._updateSearch;(this._updateSearch=!1,this._itemsDirty||e)&&(this._itemsDirty=!1,this._isUpdating=!0,xo.PaneManager.runForEachPane(function(a){(e||a.isItemsDirty())&&a.updateItemsImmediate(t,e)}),this._isUpdating=!1)}},{key:"updateWatchdog",value:function(){i.default.log("Last Update Items Stack: "+this._lastUpdateItemsStack),i.default.Assert(!1,"Update Watchdog Triggered - This should never happen.",this._isWaitingUpdateItems),this._isWaitingUpdateItems=1,this.commitUpdateItems()}},{key:"isUpdatingItems",value:function(){return this._isWaitingUpdateItems>0&&this._itemsDirty}},{key:"beginUpdateItems",value:function(){this._isWaitingUpdateItems++,1===this._isWaitingUpdateItems&&(this._lastUpdateItemsStack=i.default.getCurrentStack("Update Items Stack"),this._itemsUpdateWatchdog=setTimeout(this.updateWatchdog,0))}},{key:"commitUpdateItems",value:function(e,t){i.default.Assert(this._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",this._isWaitingUpdateItems),this._isWaitingUpdateItems--,0===this._isWaitingUpdateItems&&(clearTimeout(this._itemsUpdateWatchdog),this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0,this._numFlushesInCommit=0),this._itemsDirty&&this.updateAllItems(e,t)}},{key:"flushItemsUpdate",value:function(e){this.isUpdatingItems()&&(e?e.isItemsDirty()&&(this._itemsDirty||this._forceNotify)&&(this._numFlushesInCommit++,e.updateItemsImmediate(this._updateSearch,this._forceNotify)):(this._numFlushesInCommit++,this._updateAllItems()))}},{key:"updateAllItems",value:function(e,t){i.default.Assert(void 0===e||i.default.isBoolean(e),"Must supply a bool param for updateSearch"),i.default.Assert(void 0===t||i.default.isBoolean(t),"Must supply a bool param for forceNotify"),this._itemsDirty=!0,t&&(this._forceNotify=t),e&&(this._updateSearch=e),0===this._isWaitingUpdateItems&&this._updateAllItems()}}])&&Tr(t.prototype,a),n&&Tr(t,n),e}()).prototype,"checkItemsUpdated",[g.a],Object.getOwnPropertyDescriptor(Ar.prototype,"checkItemsUpdated"),Ar.prototype),Er(Ar.prototype,"updateWatchdog",[g.a],Object.getOwnPropertyDescriptor(Ar.prototype,"updateWatchdog"),Ar.prototype),Ar),Or=a(32);function Rr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fr(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var Nr=0,Br=(Fr((Lr=function(){function e(t,a){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i.default.Assert(t,"Must provide valid message info"),i.default.Assert(a,"Must provide a valid message owner"),this.info=t,this.id=t.id||"Message_"+Nr++,this.owner=a,this.timeout=t.timeout||n.a.ToastTimeoutDefault,this.text=new X.a(t.text),this.action=t.action||n.a.MessageAction.Default,this.isBig=t.big,this.data=t.data,this.hold=!t.timeout&&!1!==t.hold&&(t.hold||this.action!==n.a.MessageAction.Default),this.noIgnore=t.noIgnore,this.onCloseFn=t.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=t.actionText,!this.actionText)switch(this.action){case n.a.MessageAction.Default:this.actionText="";break;case n.a.MessageAction.Reload:case n.a.MessageAction.ResetClient:this.actionText="RELOAD";break;case n.a.MessageAction.Okay:this.actionText="OKAY";break;case n.a.MessageAction.Blog:this.actionText="BLOG";break;case n.a.MessageAction.Undo:this.actionText="UNDO";break;case n.a.MessageAction.LoginScreen:this.actionText="LOGIN";break;case n.a.MessageAction.Contact:this.actionText="CONTACT";break;case n.a.MessageAction.OpenSettings:case n.a.MessageAction.OpenAccountSettings:case n.a.MessageAction.OpenLinkedSettings:case n.a.MessageAction.OpenGeneralSettings:case n.a.MessageAction.OpenCalendarSettings:this.actionText="SETTINGS";break;case n.a.MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case n.a.MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case n.a.MessageAction.StartDemo:this.actionText="START DEMO"}}var t,a,r;return t=e,(a=[{key:"show",value:function(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide,this.timeout)),this.owner.onMessageShow(this))}},{key:"hide",value:function(e){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),e||this.owner.onMessageHide(this))}},{key:"isVisible",value:function(){return this._isVisible}},{key:"doAction",value:function(e){if(this.isVisible()){if(i.default.isFunction(this.action))this.action();else switch(this.action){case n.a.MessageAction.None:case n.a.MessageAction.Okay:case n.a.MessageAction.Default:break;case n.a.MessageAction.Reload:i.default.reload();break;case n.a.MessageAction.LoginScreen:S.a.removeURLParam("demo");break;case n.a.MessageAction.Demo:S.a.insertURLParam("demo","true");break;case n.a.MessageAction.ResetClient:break;case n.a.MessageAction.OpenURL:var t=this.data?this.data.url:void 0;i.default.Assert(t,"Should always have a valid URL to navigate"),t&&i.default.openUrl(t);break;case n.a.MessageAction.Blog:i.default.openUrl("https://www.moo.do/blog/updates");break;case n.a.MessageAction.Undo:Or.a.undo();break;case n.a.MessageAction.LoginScreen:S.a.removeURLParam("demo",!0),S.a.removeURLParam("dmode");break;case n.a.MessageAction.Contact:xo.menus.openModal(n.a.Modals.ReportBug);break;case n.a.MessageAction.OpenSettings:f.a.isMobile?xo.menus.openModal(n.a.Modals.MobileSettings):xo.menus.openSettings(n.a.SettingsSections.Plugins);break;case n.a.MessageAction.OpenGeneralSettings:f.a.isMobile?xo.menus.openModal(n.a.Modals.MobileSettings):xo.menus.openSettings(n.a.SettingsSections.General);break;case n.a.MessageAction.OpenAccountSettings:f.a.isMobile?xo.menus.openModal(n.a.Modals.MobileSettings):xo.menus.openSettings(n.a.SettingsSections.Account);break;case n.a.MessageAction.OpenLinkedSettings:f.a.isMobile||xo.menus.openSettings(n.a.SettingsSections.Linked);break;case n.a.MessageAction.OpenCalendarSettings:f.a.isMobile?xo.menus.openModal(n.a.Modals.MobileSettings):xo.menus.openSettings(n.a.SettingsSections.GoogleCalendar);break;case n.a.MessageAction.OpenGoogleDrive:i.default.openUrl("https://drive.google.com");break;case n.a.MessageAction.OpenDisplaySettings:f.a.isMobile||i.default.vmMain.isDisplaySettingsOpen.set(!0);break;case n.a.MessageAction.StartDemo:window.postMessage("resume","*");break;default:i.default.Assert(!1,"Invalid message action, add a new case here or pass in a function",this.action)}i.default.stopPropagation(e),this.info.holdOnAction||this.hide()}}},{key:"onTapIgnore",value:function(e){this.isVisible()&&!this.noIgnore&&this.hide()}},{key:"setText",value:function(e){this.text.set(e)}}])&&Rr(t.prototype,a),r&&Rr(t,r),e}()).prototype,"hide",[g.a],Object.getOwnPropertyDescriptor(Lr.prototype,"hide"),Lr.prototype),Fr(Lr.prototype,"onTapIgnore",[g.a],Object.getOwnPropertyDescriptor(Lr.prototype,"onTapIgnore"),Lr.prototype),Lr);function Ur(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Vr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.queue=new Q.a,this.defaultMessages=[],this.defaultMessages[n.a.MessageID.Undefined]=void 0}var t,a,r;return t=e,(a=[{key:"getMessageById",value:function(e){return void 0===this.defaultMessages[e]&&this.initMessageById(e),i.default.Assert(void 0!==this.defaultMessages[e],"After init message should always be defined"),this.defaultMessages[e]}},{key:"testMessageById",value:function(e){return!!this.defaultMessages[e]}},{key:"initMessageById",value:function(e){var t;switch(e){case n.a.MessageID.ConnectionError:t={text:"Connection error detected. Please reload to try again.",action:n.a.MessageAction.Reload};break;case n.a.MessageID.OfflineUndo:t={text:"Offline undo/redo has been disabled temporarily.",hold:!0};break;case n.a.MessageID.FatalError:t={text:"There was a fatal error in the application. "+f.a.actionVerbCaps()+" to restart.",action:n.a.MessageAction.Reload};break;case n.a.MessageID.MailbirdClick:t={text:"Sorry, emails can currently only be opened from inside Mailbird.",action:n.a.MessageAction.Okay};break;case n.a.MessageID.ExitDemo:t={text:"Changes are not saved in demo",action:n.a.MessageAction.LoginScreen,hold:!0,noIgnore:!0};break;case n.a.MessageID.ShareFailure:t={text:"There was an error sharing the file you attached.",action:n.a.MessageAction.OpenSettings,timeout:8e3};break;case n.a.MessageID.ThisIsDemo:t={text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:function(){window.parent.postMessage("userInteracted","*")},hold:!0,big:!0};break;case n.a.MessageID.InviteFailure:t={text:"Failed to use referral code. Please try again in your account settings.",action:n.a.MessageAction.OpenAccountSettings};break;case n.a.MessageID.InviteSuccess:t={text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:n.a.MessageAction.Okay};break;case n.a.MessageID.PremiumRequired:t={text:"You must be a premium subscriber to use plugins.",action:n.a.MessageAction.OpenAccountSettings,actionText:"LEARN MORE"};break;case n.a.MessageID.TrialOver:t={text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:n.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case n.a.MessageID.TrialEndSoon:t={text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:n.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case n.a.MessageID.WarnLargeFile:t={text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:n.a.MessageAction.OpenGoogleDrive};break;case n.a.MessageID.InviteInvalid:t={text:"Invalid referral code. Please try again in your account settings.",action:n.a.MessageAction.OpenAccountSettings,actionText:"OKAY"};break;case n.a.MessageID.NoSharingWarning:t={text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:n.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case n.a.MessageID.LostPermission:t={text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:n.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case n.a.MessageID.CalendarSync:t={text:"There was an error syncing your calendars.",action:n.a.MessageAction.OpenCalendarSettings,actionText:"SETTINGS"};break;case n.a.MessageID.EmailSendFail:t={text:"Your email was not sent, there was an error contacting the remote server."};break;case n.a.MessageID.EmailUpdateFail:t={text:"Unable to save draft to Gmail. Your draft is still saved locally."};break;case n.a.MessageID.EmailLabelFail:t={text:"Unable to sync you changes to Gmail. Your changes are still saved locally."};break;case n.a.MessageID.EmailSyncFail:t={text:"There was an error syncing your Gmail data.",action:function(){xo.pluginManager.getPluginGmail().runThreadSync()},actionText:"RETRY"};break;case n.a.MessageID.OldUserNewTrial:t={text:"You have been started on a premium free trial. Enable premium plugins for free!",action:n.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case n.a.MessageID.DemoPluginClick:t={text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3};break;case n.a.MessageID.PromptScriptStart:t={text:"Start demo",hold:!0,big:!0,action:n.a.MessageAction.StartDemo};break;case n.a.MessageID.SnoozeOffline:t={text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:n.a.MessageAction.Okay};break;case n.a.MessageID.NeedDrivePermission:t={text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:n.a.MessageAction.OpenSettings};break;case n.a.MessageID.NeedGmailPermission:t={text:"Sending email requires the Gmail plugin to be enabled in settings.",action:n.a.MessageAction.OpenSettings};break;case n.a.MessageID.LostLinked:t={text:"Moo.do has lost access to one of your linked accounts.",action:n.a.MessageAction.OpenLinkedSettings};break;case n.a.MessageID.GmailDisabled:t={text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:n.a.MessageAction.Okay};break;case n.a.MessageID.LocalWritesDisabled:t={text:"There was an error writing to the local cache. Please restart Moo.do.",action:n.a.MessageAction.Reload};break;case n.a.MessageID.MissingOffline:case n.a.MessageID.MissingOfflineMobile:t={text:"We are missing authorization for your account. Please reauthorize.",actionText:"REAUTHORIZE",action:function(){Le.a.enableOfflineFeatures(!0)}};break;case n.a.MessageID.FlatSearchMultiSelect:t={text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."};break;case n.a.MessageID.FlatSearchEnter:t={text:"Pressing Enter in flat search results is not supported because it would have unpredictable results."};break;case n.a.MessageID.FlatSearchTab:t={text:"Indenting search results while in flat search results is not supported because it would have unpredictable results."};break;case n.a.MessageID.ReadOnlyCalendar:t={text:"You do not have write permission for the calendar you are trying to modify."};break;case n.a.MessageID.CalendarSaveFail:t={text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."};break;case n.a.MessageID.QuotaError:t={text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3};break;case n.a.MessageID.ReselectEmail:t={text:"Please re-select the email item and try again."};break;case n.a.MessageID.ReactError:t={text:"The application has encountered an error. The developers have been notified, but sending a bug report describing what happened would be very helpful!",actionText:"REPORT",action:function(){xo.menus.openModal(n.a.Modals.ReportBug)}};break;default:i.default.Assert(!1,"Invalid MessageID: ",e)}t&&(this.defaultMessages[e]=new Br(t,this))}},{key:"pushMessage",value:function(e){var t;return i.default.Assert(e,"Must supply a valid message to display"),e instanceof Br?t=e:i.default.isObject(e)?this.hasMsgWithText(e.text)||(t=new Br(e,this)):i.default.isString(e)?this.hasMsgWithText(e)||(t=new Br({text:e},this)):(t=this.getMessageById(e))||(i.default.Assert(!1,"Invalid data passed to message creation"),i.default.log("Message not created properly",e)),t&&t.show(),t}},{key:"clearMessage",value:function(e){var t;return e instanceof Br?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t}},{key:"isMessageVisible",value:function(e){var t=!1;e instanceof Br?t=e.isVisible():this.testMessageById(e)&&(t=this.getMessageById(e).isVisible());return t}},{key:"onMessageShow",value:function(e){i.default.Assert(e,"Must pass in a valid message to add to the queue"),i.default.Assert(e&&e.doAction,"Message added to queue must have valid API exposed - doAction"),e instanceof Br?this.queue.push(e):i.default.reportError(new Error("Toast message must be an instance of Toast"),e)}},{key:"onMessageHide",value:function(e){i.default.Assert(e,"Must pass in a valid message to be removed from the queue");var t=this.queue.indexOf(e);t<0?i.default.Assert(!1,"Trying to remove an invalid message from the queue"):this.queue.splice(t,1)}},{key:"hasMsgWithText",value:function(e){return!!this.queue.get().find(function(t){return t.text.get()===e})}}])&&Ur(t.prototype,a),r&&Ur(t,r),e}();function jr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Hr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,r;return t=e,(a=[{key:"init",value:function(){}},{key:"render",value:function(e,t){var a,r=0,o=[],s=t.convertSpaces,l=t.pane,u=t.noPrefix,d=t.suffix,c=t.highlightSearch,h=!1;i.default.Assert(e,"C Item has no els: "),e||(e=[]);for(var f=0;f<e.length;++f){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var p=e[f],g=p.getAttrs(),m="",v="",y=p.getStyledText(l,!0,c);if(!c||g&&p.hasClass("plugin")?p.hasClass("plugin")||(y=i.default.escape(y)):y=this.replaceTextWithSearch(y,l),s&&(y=y&&y.replace(/ /g,"&nbsp;")),!u||!p.hasClass("itemPrefix"))if(g){if(l&&!l.plugin&&p.hasClass("plugin_drive_image_inline")){var _=xo.pluginManager.getPluginDrive(),b=_.getAttachment(p.getAttr("plugin-id")),k=_.getAttachUrl(b);if(k)return{isImage:!0,isDriveImage:!0,maxWidth:_.getAttachWidth(b),src:k,srcDataUrl:_.getAttachDataUrl(b),text:p.getParsedText(),originalText:p.getParsedText(),previousText:o.join(""),attach:b,nextText:f<e.length-1?" ":""}}if(p.hasClass("mdImage"))return{isImage:!0,src:p.getAttr("data-href"),text:p.getParsedText(),maxWidth:p.getAttr("size"),originalText:p.getAttr("data-original-text"),previousText:o.join(""),nextText:f<e.length-1?" ":""};var w="",S="",I=p.getClassString();for(var D in p.getAttr("appLink")&&(h||(w+='<span class="appLink '+((p.hasClass("evernote")?"Evernote":"")||(p.hasClass("onenote")?"OneNote":"")||(p.hasClass("bear")?"Bear":""))+'">',w+='<span contenteditable="false"'+(p.getAttr("appLinkStart")?' class="appLinkStart"':"")+"></span>"),h=!0),p.hasClass("plugin")&&(y="<span>"+y+"</span>"),w+="<span ",S+=">"+y+"</span>",p.hasClass("plugin")&&(w+='contenteditable="false" '),g)g.hasOwnProperty(D)&&("cls"===D?(v='class="'+I+'" ',"itemPrefix"===g[D][0]&&(a=!0)):"appLink"!==D&&(m+=D+'="'+g[D]+'" '));!h||f!==e.length-1&&e[f+1].getAttr("appLink")||(S+="</span>",h=!1),v||m?o.push(w+(v||"")+(m?" "+m:"")+S):o.push(y)}else o.push(y)}return a&&1===e.length&&o.push("<span>"+n.a.TextSpace+"</span>"),d&&o.push(d),o.join("")}},{key:"replaceTextWithSearch",value:function(e,t){for(var a=0,n=t.search.getSearchWords(),r=e.toLowerCase(),o=[],s=e.length+1,l=0;l<n.length;l++){var u=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var d=n[l],c=void 0,h=void 0;(c=r.indexOf(d,h))>=0;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(c>=0)for(var f=0,p=c;p<c+d.length;p++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;(isNaN(s)||p<s)&&(s=p),o[p]=!0}h=c+1}}if(s<=e.length)for(var g=0,m=-1,v=!0,y=e.length-1;y>=s-1;y--){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(m>=0&&(y<0||!o[y])){var _=e.substring(y+1,m+1),b=e.substr(m+1),k=e.substr(0,y+1);y===s&&(k=i.default.escape(k)),v&&(b=i.default.escape(b),v=!1),e=k+'<span class="c-search-highlight">'+i.default.escape(_)+"</span>"+b,m=-1}o[y]&&m<0&&(m=y)}else e=i.default.escape(e);return e}}])&&jr(t.prototype,a),r&&jr(t,r),e}(),zr=a(48);function qr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Wr=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,i;return t=e,(a=[{key:"deriveKey",value:function(e,t){var a=(new TextEncoder).encode(e),i=zr.a.str2ab(t);return crypto.subtle.importKey("raw",a,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then(function(e){return crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:2e5,hash:"SHA-512"},e,{name:"AES-CTR",length:256},f.a.isMobile,["encrypt","decrypt"])}).then(function(e){return e})}},{key:"importKey",value:function(e){return crypto.subtle.importKey("raw",e,"AES-CTR",!0,["encrypt","decrypt"])}},{key:"exportKey",value:function(e){return crypto.subtle.exportKey("raw",e)}},{key:"encrypt",value:function(e,t,a){var i={name:"AES-CTR",counter:a,length:128};return crypto.subtle.encrypt(i,t,e)}},{key:"decrypt",value:function(e,t,a){var i={name:"AES-CTR",counter:a,length:128};return crypto.subtle.decrypt(i,t,e)}}])&&qr(t.prototype,a),i&&qr(t,i),e}());function Gr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Kr=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,i;return t=e,(a=[{key:"key",value:function(e,t){return Wr.deriveKey(e,t)}},{key:"saltToCounter",value:function(e){var t=zr.a.str2ab(e);if(t.length>16)t=t.slice(0,16);else if(t.length<16){for(var a=0,i=new Uint8Array(16),n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n]=t[n]}t=i}return t}},{key:"encrypt",value:function(e,t,a){var i=this.saltToCounter(a),n=zr.a.unicode2ab(e);return Wr.encrypt(n,t,i).then(function(e){return zr.a.ab2str(e)})}},{key:"decrypt",value:function(e,t,a){var i=this.saltToCounter(a),n=zr.a.str2ab(e);return Wr.decrypt(n,t,i).then(function(e){return zr.a.ab2unicode(e)})}}])&&Gr(t.prototype,a),i&&Gr(t,i),e}());function Yr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],i=!0,n=!1,r=void 0;try{for(var o,s=0,l=e[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(a.push(o.value),t&&a.length===t)break}}catch(u){n=!0,r=u}finally{try{i||null==l.return||l.return()}finally{if(n)throw r}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Xr(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Qr="afolaw8klslbsahgbeoiya4pifoqlncduzvxgze60lvk17sevauroatsxm8qqia",Jr=new Uint8Array([76,30,217,70,117,53,119,240,33,22,147,24,106,228,253,86,175,251,159,47,232,124,89,230,19,65,243,211,58,83,88,158]).buffer;function Zr(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,Zr):this.stack=(new Error).stack}function $r(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,$r):this.stack=(new Error).stack}Zr.prototype=Object.create(Error.prototype),Zr.prototype.name="InvalidArgumentError",Zr.prototype.constructor=Zr,$r.prototype=Object.create(Zr.prototype),$r.prototype.name="InvalidPasswordError",$r.prototype.constructor=$r;var eo=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sentinel=t,this.keys={},this.importKeys({})}var t,a,n;return t=e,(a=[{key:"createKeyInfo",value:function(e){var t=this,a=e.name,i=e.password,n=Kr.key(i,Qr),r=n.then(function(e){return Kr.encrypt(t.sentinel,e,Qr)});return Promise.all([n,r]).then(function(e){var t=Yr(e,2),n=t[0],r=t[1];return{name:a,key:n,hasPassword:!!i,sentinel:r,createdAt:new Date}})}},{key:"isPasswordValid",value:function(e,t,a){var i=Kr.encrypt("TEST",t,a),n=Kr.key(e,a).then(function(e){return Kr.encrypt("TEST",e,a)});return Promise.all([i,n]).then(function(e){var t=Yr(e,2);return t[0]===t[1]})}},{key:"importKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.keys.Global||(t.Global=Jr),Promise.all(Object.keys(t).map(function(a){var n=t[a];if(f.a.isMobile||!(n instanceof CryptoKey))return i.default.isString(n)&&(n=zr.a.str2ab(n)),Wr.importKey(n).then(function(t){e.keys[a]=t});e.keys[a]=n})).then(function(){return e.keys}).catch(function(t){return console.log(t),e.keys})}},{key:"setKey",value:function(e){var t=this,a=e.name,i=e.password;return this.createKeyInfo({name:a,password:i}).then(function(e){return t.keys[a]=e.key,e})}},{key:"updateKey",value:function(e){var t=this,a=e.name,i=e.password,n=(e.sentinel,e.now,this.keys[a]);return this.createKeyInfo({name:a,password:i}).then(function(e){return t.keys[a]=e.key,{oldKeyInfo:n,newKeyInfo:e}})}},{key:"deleteKey",value:function(e){var t=e.keys,a=e.name,i=t[a];return delete t[a],{oldKeyInfo:i}}},{key:"canDecrypt",value:function(e){var t=e.source,a=e.target,i=e.key;return Kr.decrypt(t,i.key,i.salt).then(function(e){return e===a})}},{key:"findDecryptKeys",value:function(e){var t=e.source,a=e.target,i=e.keys,n=Object.values(i).map(function(e){return Kr.decrypt(t,e.key,e.salt).then(function(t){return{name:e,text:t}})});return Promise.all(n).then(function(e){return e.filter(function(e){return e.text===a}).map(function(e){return e.name})})}},{key:"validatePassword",value:function(e,t,a){var i=e[t],n=Promise.resolve(!0);return i.hasPassword&&(n=this.isPasswordValid(a,i.key,i.salt)),n}},{key:"addKey",value:function(e){var t=e.name,a=e.password;return"string"!==typeof t?Promise.reject(new Zr("Name must be a string. Saw: ".concat(t))):t in this.keys?Promise.reject(new Zr("".concat(t," exists. Use 'update' to change existing keys."))):this.setKey({name:t,password:a})}},{key:"createKey",value:function(e){var t=e.name,a=e.password;return"string"!==typeof t?Promise.reject(new Zr("Name must be a string. Saw: ".concat(t))):this.createKeyInfo({name:t,password:a})}},{key:"update",value:function(e){var t=this,a=e.name,i=e.oldPassword,n=e.password;return"string"!==typeof a?Promise.reject(new Zr("Name must be a string. Saw: ".concat(a))):a in this.keys?this.validatePassword(this.keys,a,i).then(function(e){if(!e)throw new $r;return t.updateKey({name:a,password:n,sentinel:t.sentinel,now:new Date})}):Promise.reject(new Zr("".concat(a," does not exist. Use 'create' to add new keys.")))}},{key:"forceUpdate",value:function(e){var t=e.name,a=e.password;e.sentinel,e.generateSalt;return"string"!==typeof t?Promise.reject(new Zr("Name must be a string. Saw: ".concat(t))):this.updateKey({name:t,password:a,sentinel:this.sentinel,now:new Date})}},{key:"delete",value:function(e){var t=this,a=e.name,i=e.password;return"string"!==typeof a?Promise.reject(new Zr("Name must be a string. Saw: ".concat(a))):a in this.keys?this.validatePassword(this.keys,a,i).then(function(e){if(!e)throw new $r;t.deleteKey({keys:t.keys,name:a})}):Promise.reject(new Zr("Key not found: ".concat(a)))}},{key:"forceDelete",value:function(e){var t=e.name;return"string"!==typeof t?Promise.reject(new Zr("Name must be a string. Saw: ".concat(t))):t in this.keys?this.deleteKey({keys:this.keys,name:t}):Promise.reject(new Zr("Key not found: ".concat(t)))}},{key:"verify",value:function(e){var t=e.name,a=e.password;return this.validatePassword(this.keys,t,a)}},{key:"exists",value:function(e){return!!(e in this.keys)}},{key:"canEncrypt",value:function(e,t,a){return a||(a=this.sentinel),"string"!==typeof e?Promise.reject(new Zr("Name must be a string. Saw: ".concat(e))):e in this.keys?this.canDecrypt({source:t,target:a,key:this.keys[e]}):Promise.reject(new Zr("Key not found: ".concat(e)))}},{key:"findBySentinel",value:function(e,t){return t||(t=this.sentinel),"string"!==typeof e?Promise.reject(new Zr("encryptedSource must be a string. Saw: ".concat(e))):"string"!==typeof t?Promise.reject(new Zr("Target must be a string. Saw: ".concat(t))):this.findDecryptKeys({source:e,target:t,keys:this.keys})}},{key:"encryptText",value:function(e,t,a){var n="string"===typeof e?this.keys[e]?this.keys[e]:void 0:e;return i.default.Assert(n,"No valid encryption key"),"string"!==typeof t?Promise.reject(new Zr("Text must be a string. Saw: ".concat(t))):Kr.encrypt(t,n,a)}},{key:"decryptText",value:function(e,t,a){var i="string"===typeof e?this.keys[e]?this.keys[e]:void 0:e;return"string"!==typeof t?Promise.reject(new Zr("Text must be a string. Saw: ".concat(t))):Kr.decrypt(t,i,a)}},{key:"exportKey",value:function(e){return Wr.exportKey(e)}}])&&Xr(t.prototype,a),n&&Xr(t,n),e}(),to=a(63);function ao(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var io=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,o;return t=e,(a=[{key:"init",value:function(){this.settings=new r.a,this.International=new h,this.billingManager=new qn,this.pluginManager=new Un,this.DisplaySettings=new w,this.itemStoreManager=new ve,this.PaneUpdateBatcher=new xr,this.PaneManager=new Te,this.DragDrop=new Ee.default,this.timeline=new Ne,this.cacheManager=new sr,this.recurringTaskManager=new Mr,this.deferredTaskManager=new fr,this.toasts=new Vr,this.ElementRenderer=new Hr,this.crypto=new eo(n.a.EncryptionSentinel),this.International.init(),this.billingManager.init(),this.DisplaySettings.init(),this.itemStoreManager.init(),this.cacheManager.init(),this.pluginManager.init(),this.PaneManager.init(),this.recurringTaskManager.init(),this.deferredTaskManager.init(),this.ElementRenderer.init(),T.a.init()}},{key:"searchVMLIArray",value:function(e,t,a){for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(!e.headers||r.showInOverview()){if(!e.comparator||e.comparator(r,e))if(e.each)if(!1===e.each(r,e))return!1;this.searchFromVMLI(r,e,a+1)}}}},{key:"searchFromVMLI",value:function(e,t,a){a=a||0;var i,n=t.noCollapsed,r=t.pane,o=t.overview;t.includeNotes&&!t.headers&&e.hasNote()&&(t.comparator&&!t.comparator(e.getNote(),t)||t.each&&(i=t.each(e.getNote(),t))),!1===i||n&&0!==a&&e.isCollapsed(r,o)||(i=this.searchVMLIArray(t,e.items.get(),a))}},{key:"searchVMLIs",value:function(e){var t=this;i.default.Assert(e,"Must supply a valid options param");try{if(e.itemStoreFilter)this.itemStoreManager.runForEachStore(function(a){var i=e.item,n=i&&i.belongsToItemStore(a)?i:a.getRoot();t.searchFromVMLI(n,e)},e.itemStoreFilter);else e.item?(i.default.Assert(!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter"),this.searchFromVMLI(e.item,e)):e.itemStore?(i.default.Assert(!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter"),this.searchFromVMLI(e.itemStore.getRoot(),e)):i.default.Assert(!1,"Must specify a valid search root, using the default root is deprecated")}catch(a){i.default.reportError(a)}}},{key:"sendFeedback",value:function(e,t){var a={};i.default.vmMain.getAppInfo(a),a.eventStream=void 0;var n={name:e,message:t,appInfo:a,email:i.default.getUserIdentifier(),premiumStatus:this.billingManager.getPremiumStatus()};return to.a.sendFeedback(n)}}])&&ao(t.prototype,a),o&&ao(t,o),e}();function no(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ro,oo,so,lo={" ":!0,"-":!0},uo=(ro={},oo=n.a.AttachChar,so=!0,oo in ro?Object.defineProperty(ro,oo,{value:so,enumerable:!0,configurable:!0,writable:!0}):ro[oo]=so,ro),co={CallCount:{GetCaretOffset:0,GetClassStyles:0,measurePaneObject:0,MeasureLines:0,MeasureWord:0,GetOffsetForPositionInLine:0},Cache:{ItemCacheMiss:0,ItemCacheHit:0,LinesCacheMiss:0,LinesCacheHit:0,CanvasStyleHit:0,CanvasStyleMiss:0,WordCacheHit:0,WordCacheMiss:0}};var ho=100;function fo(e){return Math.round(e*ho)/ho}var po=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),S.a.binder(this,"clearCacheForItem","onDisplaySettingsChanged"),this.fontSize=xo.DisplaySettings.fontSize(),this.isNote=!1,this.isBold=!1,this.needsFontUpdate=!0,this.canvasContext=void 0,this.canvasElement=void 0,this.measureTextItem=new X.a,this.measureTextPane=new X.a,this._paneObjectCache={},this._paneObjectsForItem={}}var t,a,r;return t=e,(a=[{key:"init",value:function(){var e=this;this.registerWordCaches(["Normal","Bold","Note","Header","HeaderTopLevel"]),this._lineCache=xo.cacheManager.registerLocalCache("LineCache","LineCache",n.a.StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0,isPerDoc:!0}),this._imageCache=xo.cacheManager.registerLocalCache("ImageCache","ImageCache",n.a.StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0,isPerDoc:!0}),this._loadCaches(),o.a.listen("clearMeasureCacheItem",this.clearCacheForItem),o.a.listen("clearMeasureCacheAll",function(){e.clearItemCache(),e.clearLineCache()}),xo.DisplaySettings.listen("settingsChanged",this.onDisplaySettingsChanged)}},{key:"registerWordCaches",value:function(e){var t=0;this._wordCaches=[];for(var a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a],r=xo.cacheManager.registerLocalCache("WordCache"+i,"WordCache"+i,n.a.StorageType.LocalStorage,{isPerDoc:!0});this._wordCaches.push(r),this["_wordCache"+i]=r}}},{key:"updateFont",value:function(e){this.needsFontUpdate||this.fontSize!==e.fontSize||e.isBold!==this.isBold||e.isNote!==this.isNote||e.isPrefixHeader!==this.isPrefixHeader||e.isHeaderTopLevel!==this.isHeaderTopLevel?(this.fontSize=e.fontSize,this.isBold=!!e.isBold,this.isNote=!!e.isNote,this.isPrefixHeader=e.isPrefixHeader,this.isHeaderTopLevel=e.isHeaderTopLevel,this.canvasFont=(this.isBold?"bold ":"")+this.fontSize+"px Helvetica Neue, Helvetica, Arial, Sans-serif",co.Cache.CanvasStyleMiss++,this.canvasContext&&(this.canvasContext.font=this.canvasFont),this.needsFontUpdate=!1):co.Cache.CanvasStyleHit++}},{key:"getCanvasElement",value:function(){return this.canvasElement||(this.canvasElement=document.createElement("canvas")),this.canvasElement}},{key:"getCanvasContext",value:function(e){return this.canvasContext||(this.canvasContext=this.getCanvasElement().getContext("2d")),this.updateFont(e),this.canvasContext}},{key:"getMeasureStats",value:function(){return co}},{key:"_getLineOffset",value:function(e,t,a){var r=e.childNodes,o=0;if(r)for(var s=0,l=0;l<r.length;l++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=r[l];if(u===t){o+=a;break}if(i.default.hasClass(u,"plugin")?o+=1:u.nodeType===Node.TEXT_NODE?u.nodeValue!==n.a.TextSpace&&(o+=u.length):u.childNodes.length>0&&(o+=this._getLineOffset(u,t,a)),t&&i.default.isAncestor(t,u))break}return o}},{key:"_getCaretPosition",value:function(e,t,a,r,o){var s=i.default.element("measureTextItem"),l=s.querySelector(".line");if(l){var u,d,c,h,p=l.getBoundingClientRect(),g=s.getBoundingClientRect(),m={left:p.left,top:g.top},v=a.isNote()?i.default.unescape(a.getNotePreviewText()):a.getParsedText(),y=0,_=a.hasPrefix()&&r.isViewProject()&&r.isItemTopLevel(t,a);e>v.length&&(e=v.length);var b=D.default._getSelectionRange();D.default.selectElement(s,e);var k,w=D.default._getSelectionRange();if(w){d=i.default.findParent(w.startContainer,"line");var S=i.default.findParent(w.startContainer,"itemPrefix",2);if(d){var I=0;c=[].indexOf.call(d.parentNode.children,d),h=this._getLineOffset(d,w.startContainer,w.startOffset);var C=0,P=w.startContainer.parentElement,A=P.previousElementSibling;if(A&&!o&&"IMG"===A.nodeName)C=-A.getBoundingClientRect().width;else if(!o&&i.default.hasClass(P,"mdImageMarkup")){var M=P.nextElementSibling;w.startOffset>0&&w.endOffset>0&&"IMG"===M.nodeName&&(C=M.getBoundingClientRect().width+10+(a.hasPrefix()?n.a.PrefixWidth:0))}xo.settings.showMarkdown.get()||i.default.hasClass(P,"mdMarkup")&&(w=this.adjustSelectionForMarkup(w)),i.default.hasClass(w.startContainer,"plugin")?(k=w.startContainer.getBoundingClientRect(),u={left:w.startOffset>0?k.right+12:k.left,top:k.top}):S&&e===a.getPrefixLength()?(k=S.getBoundingClientRect(),u={left:m.left+n.a.PrefixWidth+(f.a.isFirefox?0:5),top:k.top}):o&&h===this._getLineOffset(d)&&d.nextSibling?(u={left:(k=(d=d.nextSibling).getBoundingClientRect()).left+5+(a.hasPrefix()?n.a.PrefixWidth:0),top:k.top},h=0,c++):(k=w.getBoundingClientRect())&&(k.left===k.right&&0===k.left&&(k=w.getClientRects()[0]||d.getBoundingClientRect()),u={left:k.left,top:k.top}),f.a.isFirefox||(u.left=Math.max(u.left-5,0));for(var T=d.parentNode.childNodes,E=0;E<c;E++){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;y+=this._getLineOffset(T[E])}return b&&!i.default.findParent(b.startContainer,"fancyInput")&&D.default.setSelectionRange(b),{left:u.left-m.left-(_?n.a.PrefixWidth:0)+C,top:u.top-m.top,line:c,lineOffset:h,lineLength:this._getLineOffset(d),lineStart:y}}}}return i.default.Assert(!1,"Failed to compute caret position: ",e,a.getParsedText().length,i.default.getElementPath(s)),{left:0,top:0,line:0,lineOffset:0,lineLength:0,lineStart:0}}},{key:"_measureCaretPosition",value:function(e,t,a,r){for(var o=0,s=i.default.element("measureText"),l=i.default.element("measureTextItem"),u=e.item,d=a.getStyledLinesForPaneObject(e,!1,!0),c="",h=0;h<d.length;h++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var f=d[h],p=(0===h?"margin-top:"+xo.DisplaySettings.paddingForItemTop(e,u)+"px;":"")+(f.isImage||h===d.length-1?"margin-bottom:"+xo.DisplaySettings.paddingForItemBottom(e,u,a)+"px;":"");if(f.isImage)c+='<span class="line" style="'+(p+=f.maxWidth?"max-width: "+f.maxWidth+"px;":"")+'">'+f.previousText+'<span class="mdImageMarkup">'+f.originalText+"</span>"+(f.isDriveImage||!xo.settings.showMarkdown.get()?'<img class="inlineImage" src="'+f.src+'"></img>':"")+"<span>"+f.nextText+"</span></span>";else c+='<span class="line" style="'+(p+="font-size:"+xo.DisplaySettings.fontSizeForItem(e,u,a)+"px;line-height:"+xo.DisplaySettings.lineHeightForItem(e,u,a)+"px")+'">'+(d[h]||n.a.TextSpace)+"</span>"}return s.className="pane "+a.paneClass,l.className="item "+u.styleProps(e,a),l.innerHTML=c,this._getCaretPosition(t,e,u,a,r)}},{key:"getCaretOffset",value:function(e,t,a,i){var n=e.item;if(co.CallCount.GetCaretOffset++,isNaN(a)&&(a=n.getParsedText().length),void 0===i){var r=t.caretPosition.get();if(r&&C.a.getStartOffset()===C.a.getEndOffset()&&C.a.getStartIndex()===C.a.getEndIndex())i=r.left-t.getPaddingForPaneObject(e)<30;else{var o=C.a.isArrowSelectInverted(),s=o?C.a.getStartOffset():C.a.getEndOffset(),l=o?C.a.getStartObject():C.a.getEndObject(),u=this._measureCaretPosition(l,s,t,!0),d=this._measureCaretPosition(l,s,t,!1);u.left!==d.left&&(i=!o)}}return this._measureCaretPosition(e,a,t,i)}},{key:"getCaretScreenPosition",value:function(e,t,a){i.default.Assert(t>=0,"Must provide a valid index");var n=e.itemAtIndex(t),r=e.objectAtIndex(t);if(i.default.Assert(n,"Must be able to find a valid item at index"),e.isIndexMounted(t)){var o=e.elementAtIndex(t);i.default.Assert(o,"Must be able to get element for item at index");var s=e.getPaddingForPaneObject(r),l=this.getCaretOffset(r,e,a),u={left:-1,top:-1};if(o){var d=o.getBoundingClientRect();u.left=l.left+d.left+s,u.top=l.top+d.top}return u}return{left:-1,top:-1}}},{key:"_getClassStyles",value:function(e,t,a,n){co.CallCount.GetClassStyles++,i.default.Assert(i.default.isVMLI(t),"Item must be a valid VMLI instance");var r=t.isNote(),o=t.isPrefixHeader(),s=t.isPrefixHeader()&&a.isItemTopLevel(e,t);return{isBold:o||n.hasClass("mdBold")||s&&a.isViewProject()||t.isHeader()&&xo.DisplaySettings.boldHeaders()||n.hasClass("contact")||n.hasClass("date")||n.hasClass("duration")||n.hasClass("tag"),fontSize:t.isNote()?xo.DisplaySettings.noteFontSize():s&&xo.DisplaySettings.fontSizeHeaderTopLevel()||o&&xo.DisplaySettings.fontSizeHeader()||xo.DisplaySettings.fontSize(),isPrefixHeader:o,isHeaderTopLevel:s,isNote:r,attrs:n.getAttrs()}}},{key:"measureLines",value:function(e,t,a,r,o){var s=0;i.default.Assert(i.default.isVMLI(t),"Must provide a valid item to measure lines for"),i.default.Assert(i.default.isPane(a),"Must provide a valid pane to measure lines for"),i.default.Assert(r>=0,"Max width must be greater than 0: ",r),co.CallCount.MeasureLines++;var l=this.getItemDisplayText(t),u=!t.isDestroyed()&&t.requireStoredEls();if(o=o||!u,i.default.Assert(t&&(t.els||!u),"A Item has no els: ",t.__TEMP_InitCalled,t.__TEMP_InitParseCalled,t.__TEMP_ParseCalled,t.__TEMP_SkippedInitParsed),0===l.length||!t||!t.els&&u)return t&&i.default.vmMain.runSingleParse(t,n.a.ChangeType.Auto),[{text:"",start:0,length:0,width:0}];if(!o){var d=this.getLinesFromCache(t,a,r);if(d){for(var c=0,h=l.length,f=0,p=0;p<d.length;p++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;f+=d[p].length}if(h===f)return co.Cache.LinesCacheHit++,d}else co.Cache.LinesCacheMiss++}var g=[],m=t.els,v=0,y="",_=0,b=[],k=0;if(m&&u)for(var w=0,S=0;S<m.length;++S){var I=0;if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;var D=m[S],C=this._getClassStyles(e,t,a,D),P=D.getParsedText(),A=D.getWidth(o),M=!!(C&&C.attrs&&C.attrs.attachSimple),T=void 0;if(D.hasClass("plugin_drive_image_inline")&&(A=r,M=!0,T=!0),void 0===A){var E=P.length;i.default.Assert(!C.plugin||P===n.a.AttachChar,"Plugin should only be set for attachment element");for(var L=0;L<E;++L){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;var x=P[L];if(!lo[x]||v===k||0===L&&S>0&&void 0!==m[S-1].getWidth(o)){var O=0;y+=x;for(var R="",F=v+1;F<l.length;++F){if(O++>5e3&&__infLoop&&__infLoop(O))throw new RangeError;var N=l[F];if(!lo[N])break;R+=N}var B=R||uo[x]||P[L+1]===n.a.AttachChar;if(B&&M&&L+R.length<E)y+=R;else if(B){var U=this.measureWord(a,y,C,o),V=this.measureWord(a,R,C,o);b.push({text:y,delim:R,styles:C,width:U,delimWidth:Math.min(V,r),isAttach:x===n.a.AttachChar,isImage:M,isDriveImage:T}),y=""}}v++}if(y.length>0){var j=this.measureWord(a,y,C,o);b.push({text:y,delim:"",styles:C,width:j,delimWidth:0,isImage:M,isDriveImage:T}),y=""}}else b.push({isPrefix:0===S,text:P,width:S>0||a.shouldRenderPrefix(e)?A:0,styles:C,delimWidth:0,delim:"",isImage:M,isDriveImage:T}),k+=P.length,v+=P.length}else{i.default.Assert(t&&!u,"Items that do not have els must be marked as not requiring them to be cached"),t.els||i.default.vmMain.runSingleParse(t,n.a.ChangeType.Auto),i.default.Assert(t.els&&1===t.els.length,"Should always have a single el for non-measure cached items");var H=this._getClassStyles(e,t,a,t.els[0]);H&&H.attrs?b.push({text:n.a.AttachChar,delim:"",styles:H,width:xo.pluginManager.measureAttachment(a,H),delimWidth:0}):(y=t.els[0].getParsedText(),b.push({text:y,delim:"",styles:H,width:this.measureWord(a,y,H,o),delimWidth:0}))}var z=0,q="",W=0,G=0;v=0;for(var K=0;K<b.length;++K){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if((y=b[K]).isPrefix&&(W=y.width),y.isImage&&1===K&&W){var Y=this.getAttachSimpleLine(y,v,b[0]);if(Y){g.push(Y),v+=Y.length,q="",_=K+1,W=0;continue}}if(K>_&&(y.isImage||z+y.width>r&&!(W&&1===G&&y.width>0))&&(g.push({text:q,start:v,length:q.length,width:fo(z)}),v+=q.length,z=0,q="",_=K,W=0),y.isImage){var X=this.getAttachSimpleLine(y,v);if(X){g.push(X),v+=X.length,q="",_=K+1,W=0;continue}}if(!y.isPrefix&&y.width+y.delimWidth>r&&!y.isAttach){var Q=0,J=0,Z=0;z=0;for(var $=0;$<y.text.length;++$){if(Q++>5e3&&__infLoop&&__infLoop(Q))throw new RangeError;z=Z,(Z+=this.measureChar(y.text[$],y.styles))>r&&$>0&&$-1>J&&(q+=y.text.substring(J,$),g.push({text:q,start:v,length:q.length,width:fo(z)}),v+=q.length,J=$,z=0,W=0,q="",$--,Z=0)}if(J>=0){var ee=y.text.substring(J,y.text.length);ee.length>0&&(y.text=y.text.substr(0,J),q=ee+y.delim,z=this.measureWord(a,ee,y.styles,!0),_=K)}}else y.isPrefix||(z+=y.width+y.delimWidth),q+=y.text+y.delim;K===b.length-1&&(g.push({text:q,start:v,length:q.length,width:fo(z)}),W=0),y.width>0&&G++}return o||this.saveLinesToCache(t,a,r,g),g}},{key:"getPaneObjectFromCache",value:function(e,t){var a,r=e.item,o=e.id,s=this._paneObjectCache[o],l=t,u=this.getItemDisplayText(r);if(s&&s[l]&&s[l].isHeader===r.isHeader()&&u===s.text&&s[l].isNote===r.isNote()&&u.indexOf(n.a.AttachChar)<0){var d=s[l];d.els?(co.Cache.ItemCacheHit++,a=d):i.default.Assert(!1,"Getting item from cache with no els")}return a||co.Cache.ItemCacheMiss++,a}},{key:"savePaneObjectToCache",value:function(e,t){i.default.Assert(t,"Must save a valid measured item to cache"),i.default.Assert(t.els,"Measured item must have els"),i.default.Assert(t.maxWidth,"Measured item must have a valid max width");var a=e.item,n=this.getItemDisplayText(a),r=e.id,o=this._paneObjectCache[r];if(o&&o.text===n){var s,l=0,u=Number.MAX_VALUE;for(var d in o)if(o.hasOwnProperty(d)){l++;var c=o[d].lastAccess;c<u&&(u=c,s=d)}l>=5&&delete o[s]}else o=this._paneObjectCache[r]={text:n},this._paneObjectsForItem[a.id]||(this._paneObjectsForItem[a.id]=[]),this._paneObjectsForItem[a.id].push(r);o[t.maxWidth]=t}},{key:"getLinesFromCache",value:function(e,t,a){if(t.useLineCache){var n,r,o=this._lineCache.getEntrySync(e.id);if(o)for(var s=0,l=0;l<o.length;l++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(n=o[l][a])break}if(n){var u=this.getItemDisplayText(e);if(i.default.isNumber(n))r=[{start:0,length:u.length,text:u}];else{var d=0;r=new Array(n.length);for(var c=0,h=0;h<n.length;h++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=n[h];i.default.Assert(!i.default.isNumber(f),"Cached lines should always be line info rather than a number"),r[h]={start:c,length:f.length,text:u.substr(c,f.length)},f.size&&(r[h].size=f.size),c+=f.length}}}return r}}},{key:"saveLinesToCache",value:function(e,t,a,i){if(t.useLineCache){var n,r=0;if(i.length>1||i[0].size){var o=0;n=i;for(var s=0;s<n.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;delete n[s].imageUrl,delete n[s].originalText}}else n=1;var l=this._lineCache.getEntrySync(e.id)||[];l.length>=5&&l.pop();for(var u=0;u<l.length;u++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;l[u][a]&&(l.splice(u,1),u--)}var d={};d[a]=n,l.splice(0,0,d),this._lineCache.cacheEntry(e.id,l)}}},{key:"measurePaneObject",value:function(e,t,a){co.CallCount.measurePaneObject++;var r,o=e.item,s=t.maxWidthOfPaneObject(e),l=this.getItemDisplayText(o),u=o.isHeader(),d=o.isNote();if(i.default.Assert(i.default.isNumber(s),"Must provide a valid number for maxWidth: ",s),i.default.Assert(s>=0,"Max width must be greater than 0: ",s),0===l.length||s<i.default.MinItemWidth){return{height:xo.DisplaySettings.lineItemHeight(e,o,t,1),maxWidth:s,lineLengths:[0],styledLines:[n.a.TextSpace],els:[{text:"",start:0,length:0,width:0,cls:"line",index:0}],isHeader:u,isNote:d}}if(!(r=!a&&this.getPaneObjectFromCache(e,s))||t.search.shouldHighlightSearch()){for(var c=0,h=this.measureLines(e,o,t,s,a),f=[],p=[],g=0,m=h.length,v=0;v<h.length;++v){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var y=h[v];if(y.size&&!isNaN(y.size.height)){var _=Math.min(y.size.width,s);g+=y.size.height*_/y.size.width+(v>0?xo.DisplaySettings.paddingForItemTop(e,o):0)+(v<h.length-1?xo.DisplaySettings.paddingForItemBottom(e,o,t):0),m--}f.push(y.length),p.push({text:y.text,start:y.start,length:y.length,width:y.width,cls:"line",index:v})}if(i.default.Assert(o&&(o.els||!o.requireStoredEls()),"B Item has no els: ",o.__TEMP_InitCalled,o.__TEMP_InitParseCalled,o.__TEMP_ParseCalled,o.__TEMP_SkippedInitParsed),!o.els&&o.requireStoredEls()){return{height:xo.DisplaySettings.lineItemHeight(e,o,t,1),maxWidth:s,lineLengths:[],styledLines:[],els:[{text:"",start:0,length:0,width:0,cls:"line",index:0}],isHeader:u,isNote:d}}var b=F.a.generateStyledLines(o.els,h,t);r={height:xo.DisplaySettings.lineItemHeight(e,o,t,m)+g,maxWidth:s,lineLengths:f,styledLines:b,els:p,isHeader:u,isNote:d,lastAccess:Date.now()},t.search.shouldHighlightSearch()&&(r.searchHighlightedLines=F.a.generateStyledLines(o.els,h,t,!0)),a||this.savePaneObjectToCache(e,r)}return r}},{key:"measureWord",value:function(e,t,a,r){if(co.CallCount.MeasureWord++,i.default.Assert(void 0!==t,"Must pass in a valid word"),i.default.Assert(a,"Must supply valid styles for word"),i.default.Assert(t.indexOf(n.a.AttachChar)<0||1===t.length,"AttachChar should not be processed with other chars"),t.length>0){if(t===n.a.AttachChar&&a&&a.attrs)return i.default.Assert(!a.attrs||a.attrs.plugin,"Must have a valid plugin: ",a.attrs&&a.attrs.plugin),i.default.Assert(!a.attrs||a.attrs["plugin-id"],"Must have a valid attachment",a.attrs&&a.attrs["plugin-id"]),xo.pluginManager.measureAttachment(e,a);var o=this._selectCache(a),s=o.getEntrySync(t);if(s)return co.Cache.WordCacheHit++,s;for(var l=0,u=0,d=0;d<t.length;d++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;u+=this.measureChar(t[d],a)}var c=fo(u);return r||o.cacheEntry(t,c),c}return 0}},{key:"measureChar",value:function(e,t){var a=this._selectCache(t),i=a.getEntrySync(e);if(i)return i;var n=this.getCanvasContext(t).measureText(e).width;return a.cacheEntry(e,n),n}},{key:"getOffsetForScreenPositionInLine",value:function(e,t,a,r,o){var s,l=t.item;if(a.isIndexMounted(e)){var u=a.elementAtIndex(e).querySelectorAll(".line");if(u.length>r){var d=u[r],c=d.getBoundingClientRect(),h=D.default.getSelectOffsetsForMouseEvent({target:d,clientX:i.default.clamp(o,c.left,c.right-2),clientY:c.top+2+(l.shouldShowParents(t,a)?n.a.HeightAgendaParents:0)+(0===r?xo.DisplaySettings.paddingForItemTop(t,l):0)});h&&(s=h.start)}}if(isNaN(s)){var f=0,p=this.measurePaneObject(t,a,!0).lineLengths;s=0;for(var g=0;g<p.length;g++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;s+=p[g]}}return s}},{key:"clearCacheForItem",value:function(e){this._lineCache.removeEntry(e);var t=this._paneObjectsForItem[e];if(t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];this._paneObjectCache[n]&&delete this._paneObjectCache[n]}delete this._paneObjectsForItem[e]}}},{key:"_loadCaches",value:function(){for(var e=0,t=0;t<this._wordCaches.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._wordCaches[t].loadAll()}this._lineCache.loadAll(),this._imageCache.loadAll()}},{key:"clearWordCaches",value:function(){for(var e=0,t=0;t<this._wordCaches.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._wordCaches[t].clearCache()}}},{key:"clearItemCache",value:function(){this._paneObjectCache={},this._paneObjectsForItem={}}},{key:"clearLineCache",value:function(){this._lineCache.clearCache()}},{key:"_selectCache",value:function(e){var t;return e.isHeaderTopLevel?t=this._wordCacheHeaderTopLevel:e.isPrefixHeader?t=this._wordCacheHeader:e.isBold?(i.default.Assert(!e.isNote,"Currently do not support bold+note"),t=this._wordCacheBold):t=e.isNote?this._wordCacheNote:this._wordCacheNormal,t}},{key:"getItemDisplayText",value:function(e){return e.getParsedText()}},{key:"onDisplaySettingsChanged",value:function(e){this.needsFontUpdate=!0,e&&this.clearWordCaches(),this.clearItemCache(),this.clearLineCache()}},{key:"measureImage",value:function(e){var t=!this._imageCache.getEntrySync(e.src);return this._imageCache.cacheEntry(e.src,{width:e.naturalWidth,height:e.naturalHeight}),t}},{key:"getImageOriginalSize",value:function(e,t){var a=this._imageCache.getEntrySync(e)||t&&this._imageCache.getEntrySync(t);return{width:a.width,height:a.height}}},{key:"getImageSize",value:function(e,t,a){var i,n=this._imageCache.getEntrySync(e)||t&&this._imageCache.getEntrySync(t);return n&&(i=a?{width:a=Math.min(a,n.width),height:n.height*(a/n.width)}:{width:n.width,height:n.height}),i}},{key:"getAttachSimpleLine",value:function(e,t,a){var r,o,s,l=e.styles.attrs,u=(a?a.text+a.delim:"")+e.text+e.delim;if(l.plugin){i.default.Assert(l.plugin===n.a.PluginID.Drive,"Attach simple line with a plugin other than Drive",l.plugin);var d=xo.pluginManager.getPluginDrive(),c=d.getAttachment(l["plugin-id"]);r=d.getAttachUrl(c),o=d.getAttachDataUrl(c),s=d.getAttachWidth(c)}else r=l["data-href"],s=l.size;if(r){var h=this.getImageSize(r,o,s);return{text:u,start:t,length:u.length,size:h}}}},{key:"adjustSelectionForMarkup",value:function(e){var t=!1,a=e.startContainer.parentElement,n=i.default.hasClass(a,"mdMarkupStart"),r=i.default.hasClass(a,"mdMarkupEnd","appLinkStart");if(n||r){var o=n?1:-1,s=this.findNextNonMarkup(a,o);if(s){var l=s.childNodes[0]||s;l&&(e.setStart(l,o<0?l.length:0),t=!0)}else if(o*=-1,s=this.findNextNonMarkup(a,o)){var u=s.childNodes[0];u&&(e.setStart(u,o<0?u.length:0),t=!0)}}return t?this.adjustSelectionForMarkup(e):e}},{key:"findNextNonMarkup",value:function(e,t){for(var a=0;e&&i.default.hasClass(e,"mdMarkup","appLinkStart");){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=t>0?e.nextSibling:e.previousSibling}return e}}])&&no(t.prototype,a),r&&no(t,r),e}(),go=a(65);function mo(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var vo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.openOnPane=void 0,this.messages=new Q.a,this.messagesLoaded=new X.a(!1),this.isLoading=new X.a(!1),this.errorMessage=new X.a(""),this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,S.a.binder(this,"onAttachmentUpdate","reset","_onWindowResizeTimeout")}var t,a,r;return t=e,(a=[{key:"init",value:function(){var e=this;xo.DisplaySettings.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),window.addEventListener("message",function(t){if(i.default.getLocationOrigin()===t.origin&&t.data&&t.data.startsWith&&t.data.startsWith("-")){var a=t.data.indexOf("-",1),n=t.data.indexOf("-",a+1);n<0&&(n=void 0);var r=t.data.substring(1,a),o=t.data.substring(a+1,n),s=n?t.data.substring(n+1):void 0;i.default.batchRenderUpdates(function(){e.handleFrameMessage(o,r,s,t)})}}),o.a.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),f.a.onResize.listen(this._onWindowResize.bind(this))}},{key:"reset",value:function(e,t){if(this.threadAttach){for(var a=0,i=this.threadAttach.getField("messages"),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n].initializedForDisplay&&this._destroyMessageDisplay(i[n])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(t,!1),this.messagesLoaded.set(!1,!1),this.messages.get().length>0&&this.messages.set([],e)}},{key:"_onWindowResizeTimeout",value:function(){if(this.threadAttach)for(var e=0,t=this.threadAttach.getField("messages"),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.updateMessageHeight(t[a].id,!0)}}},{key:"_onWindowResize",value:function(){i.default.timeoutOnce("email resize",this._onWindowResizeTimeout,0)}},{key:"getPlugin",value:function(){return this.threadAttach?this.threadAttach.getPlugin():i.default.vmMain.getDefaultEmailPlugin()}},{key:"_sendReply",value:function(e,t,a){i.default.Assert(e,"Must supply a valid target"),i.default.Assert(t,"Must supply a valid action");try{var n="-"+t+(void 0!==a?"-"+a:"");e.postMessage(n,"*")}catch(r){i.default.reportError(r)}}},{key:"handleFrameMessage",value:function(e,t,a,n){var r=this;switch(t){case"resize":try{var s=JSON.parse(a);this.updateMessageHeight(e,!0===s.canBeShorter,s.scale)}catch(v){i.default.reportError(v)}break;case"click":o.a.fireEvent("tapMain",[]);break;case"keypress":try{var l=JSON.parse(a);f.a.normalizeKeys(l),C.a.fireKeyEvent(document.documentElement,l)}catch(v){i.default.reportError(v)}break;case"href":if(a.startsWith("mailto:")){var u=this.parseMailtoURL(a.replace(/^mailto:/gi,"")),d={to:[{email:u.to}],subject:u.subject&&unescape(u.subject),body:u.body&&unescape(u.body).replace(/\r?\n/g,"<br>")};xo.menus.openComposeEmail(this.getPlugin(),void 0,void 0,d)}else i.default.openUrl(a);break;case"epLoaded":this.onMessageLoaded(e);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(e,this.threadAttach,e);break;case"reqResource":try{if(i.default.Assert(n,"Must provide a valid request event"),this.threadAttach)for(var c=0,h=JSON.parse(a),p=0;p<h.length;++p){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var g=h[p],m=!1;g.startsWith("attach:")&&(g=g.replace(/^attach:/gi,""),m=!0),this.getPlugin().loadResource(this.threadAttach.id,e,g,function(e,t){var a;e&&(a={cid:t,data:m?r._createMessageHTML(r.getPlugin()._decodeEmail(e.data,void 0,{}),{},"text/html").parsed:e.data,mimeType:e.mimeType});try{if(n.source&&a){var o=m?"contentLoad":"resLoad";r._sendReply(n.source,o,a?JSON.stringify(a):void 0)}}catch(s){i.default.reportError(s)}})}}catch(v){i.default.reportError(v)}break;default:i.default.log("Unknown message from child frame: ",e,t,a,n)}}},{key:"isOpen",value:function(){return this.openOnPane&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnPane",value:function(e){return this.openOnPane===e&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnThread",value:function(e){return this.isOpen()&&this.threadAttach===e}},{key:"close",value:function(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),f.a.isMobile?setTimeout(this.reset,n.a.EmailOpenTimeMobile):this.reset(),this.wantsPaneTransition=!1,o.a.fireEvent("EmailPreview","onClosed",[]))}},{key:"setOpenPane",value:function(e,t){this.openOnPane&&this.openOnPane!==e&&this.openOnPane.setExpanded(!1,t),this.openOnPane=e,e&&e.setExpanded(!0,t)}},{key:"_openPane",value:function(e,t){var a=this;i.default.Assert(t,"Must supply a valid cb to openPane"),e!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout(function(){a.wantsPaneTransition=!1,t()},n.a.EmailOpenTime+100)):t(),this.setOpenPane(e)}},{key:"getPane",value:function(){return i.default.Assert(this.openOnPane,"Should not be trying to get pane if email preview is not open"),this.openOnPane}},{key:"startOpenOnLoad",value:function(e){this.setOpenPane(e,!1)}},{key:"open",value:function(e,t,a,i){var n=this;if(t!==this.threadAttach||a!==this.openOnPane){var r=t.getPlugin();this.reset(!0,!0),this.threadAttachLoading=t,f.a.isMobile?C.a.closeKeyboard():xo.PaneManager.ensurePaneInView(a);var o=2,s=!1;if(i){this.messages.listen(function(e){if(e.length>0)return e[e.length-1].labelIds.indexOf("DRAFT")<0&&n.setLastMessageResponseMode(i),!1})}var l=function(){0===--o&&t===n.threadAttachLoading&&(s?(n._setThread(t,e),A.e.miscAction({type:A.c.Misc,misc:A.a.OpenEmail,data:{pane:a}})):n.errorMessage.get()?n.isLoading.set(!1):xo.menus.alert({text:"Unable to load email messages. You may be offline.",actionText:"OKAY"}))};this._openPane(a,function(){l()}),r.loadThread(t,function(e,t,a){s=e,!e&&a?n.errorMessage.set(a):n.errorMessage.set(""),l()})}else i&&this.isOpen()&&this.setLastMessageResponseMode(i)}},{key:"_getReplyToFromMessage",value:function(e){return this._selfSentMessage(e)?e.to:e.replyTo?[e.replyTo]:[e.from]}},{key:"_getSenderFromMessage",value:function(e){var t=this.threadAttachLoading||this.threadAttach;return this._findSelf(t.getField("accountID"),e)}},{key:"_selfSentMessage",value:function(e){return this.getPlugin().isMyAccountID(e.from.email)}},{key:"_removeSelf",value:function(e){if(e){for(var t=0,a=e.slice(0),i=this.getPlugin(),n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i.isMyAccountID(a[n].email)&&(a.splice(n,1),n--)}return a}}},{key:"_findSelf",value:function(e,t){var a,i=this.getPlugin(),n=i.getSendingAccounts(e);if(n.indexOf(t.from.email)>=0)a=t.from.email;else{if(t.to)for(var r=0,o=0;o<t.to.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n.indexOf(t.to[o].email)>=0){a=t.to[o].email;break}}if(!a&&t.cc){var s=0;for(o=0;o<t.cc.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(n.indexOf(t.cc[o].email)>=0){a=t.cc[o].email;break}}}if(!a&&t.bcc){var l=0;for(o=0;o<t.bcc.length;++o){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(n.indexOf(t.bcc[o].email)>=0){a=t.bcc[o].email;break}}}}return a||(a=i.getDefaultSendingAccount(e)),{text:i.getDisplayName(a),email:a}}},{key:"areContactsEqual",value:function(e,t){return e.email===t.email}},{key:"_updateDraftFromMessage",value:function(e,t,a){var r,o,s,l,u=this.getPlugin(),d=e.subject,c=this._getSenderFromMessage(e);i.default.Assert(a!==n.a.EmailResponseMode.Other,"Should never pass Other mode to _updateDraftFromMessage"),a===n.a.EmailResponseMode.Reply?r=this._getReplyToFromMessage(e):a===n.a.EmailResponseMode.ReplyAll?(r=this._removeSelf(this._getReplyToFromMessage(e).concat(e.to)),o=this._removeSelf(e.cc)):a===n.a.EmailResponseMode.Forward&&(l=e.resources.clone()),a&&(s=u.createMessageBody(e,t.from.email,a)),r=i.default.arrayUniques(r||[],this.areContactsEqual),o=i.default.arrayUniques(o||[],this.areContactsEqual),a===n.a.EmailResponseMode.Reply||a===n.a.EmailResponseMode.ReplyAll?(0!==d.toLowerCase().indexOf("re")&&(d="Re: "+d),l=t.resources):a===n.a.EmailResponseMode.Forward&&0!==d.toLowerCase().indexOf("fwd")&&(d="Fwd: "+d);var h={to:r,from:c,cc:o,bcc:void 0,subject:d,body:s,resources:l||new ha};this.getPlugin().updateDraft(this.threadAttach,t.id,t.draftID,h,s,!0,!1,function(e){i.default.Assert(e,"Should always be able to update a draft")})}},{key:"requestAttachment",value:function(e,t,a,i){this.getPlugin().loadResource(e,t,a,i)}},{key:"getAttachmentURL",value:function(e,t,a){return this.getPlugin().getAttachmentURL(e,t,a)}},{key:"getPreviewURL",value:function(e){return this.getPlugin().getPreviewURL(e)}},{key:"reportMessage",value:function(e,t,a,i,n){this.getPlugin().reportMessage(e,t,a,i,n)}},{key:"dumpMessage",value:function(e,t,a){i.default.Assert(!1,"Should not be dumping message in non-__DEV__ modes"),this.getPlugin().dumpMessage(e,t,a)}},{key:"parseMailtoURL",value:function(e){var t={to:void 0,subject:void 0,body:void 0},a=e.split("?");if(t.to=a[0],a[1])for(var i=0,n=a[1].split("&"),r=0;r<n.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=n[r].split("=");switch(o[0].toUpperCase()){case"SUBJECT":t.subject=o[1];break;case"BODY":t.body=o[1]}}return t}},{key:"parseListUnsubscribe",value:function(e){for(var t=0,a={emailData:void 0,url:void 0},n=e.split(","),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=/^<?(http|https|mailto):([^<>]*)>?/gi.exec(n[r]);if(o)switch(o[1]){case"http":case"https":a.url=o[1]+":"+o[2];break;case"mailto":a.emailData=this.parseMailtoURL(o[2]);break;default:i.default.Assert(!1,"Unknown List Unsubscribe Format: "+e)}}return a}},{key:"setMessageResponseMode",value:function(e,t){var a=this.messages.get()[this.messages.indexOfWithProperty("id",e)];if(i.default.Assert(a,"Must be able to find a valid reply message to update response mode for"),a){if(t!==n.a.EmailResponseMode.None){i.default.Assert(a.initializedForDisplay,"Must be initialized for display to set response mode");var r=this.getPlugin().getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,e,this._getSenderFromMessage(a));this._updateDraftFromMessage(a,r,t)}a.responseMode&&a.responseMode.set(t),f.a.isMobile&&t!==n.a.EmailResponseMode.None&&xo.menus.openModal(n.a.Modals.EmailReply,{threadAttach:this.getThreadAttach(),message:r,inReplyToMessage:a,responseMode:t})}}},{key:"setLastMessageResponseMode",value:function(e){if(e){var t=this.messages.get()[this.messages.length()-1];i.default.Assert(t,"Setting message response mode when there are no messages"),t&&this.setMessageResponseMode(t.id,e)}}},{key:"_createErrorHTML",value:function(){return sa.a.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html")}},{key:"_createMessageHTML",value:function(e,t,a,i){var n={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0};if(i)for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);return sa.a.update(e,t,n,a)}},{key:"_generateCSS",value:function(){if(!this._cachedCSS){var e={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};xo.DisplaySettings.isDark()&&(e.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",e.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var t="";Object.keys(e).forEach(function(a){t+=a+"{",Object.keys(e[a]).forEach(function(i){var n=e[a][i];t+=i+":"+n+";"}),t+="}"}),this._cachedCSS="<style>"+t+"</style>"}return this._cachedCSS}},{key:"_createFrameBlob",value:function(e,t,a){var i={isApp:f.a.app,isAndroid:f.a.android},n=this._generateCSS(),r="<script>("+function(e,t){!function(){function a(e){console.log("ERROR: ",e)}var i=window.InjectedJS={postMessage:function(t,i){try{var n;if(void 0!==i)if("string"===typeof i)n="-"+i;else try{n="-"+JSON.stringify(i)}catch(r){a(r),n=""}else n="";window.parent.postMessage("-"+t+"-"+e+n,"*")}catch(r){a(r)}}};function n(e){var a=1;t.isAndroid&&(a=function(e){var t=document.documentElement.clientWidth/e;return Math.max(t,.25)}(document.documentElement.scrollWidth))<1&&(document.documentElement.style.transform="scale("+a+")"),i.postMessage("resize",{canBeShorter:e,scale:a})}var r=!1;function o(){document.removeEventListener("DOMContentLoaded",o,!1),r?n():(r=!0,function(){var e=0,t=0,a=0;document.documentElement.addEventListener("click",function(e){i.postMessage("click")}),document.addEventListener("keydown",function(e){var t={type:e.type,keyCode:e.keyCode,charCode:e.charCode,which:e.which,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey};i.postMessage("keypress",t)},!0);for(var r=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=this.getAttribute("href");return t.startsWith("attach:")?i.postMessage("reqResource",[t]):t.startsWith("moodoAction:")?i.postMessage(t.replace(/^moodoAction:/gi,"")):i.postMessage("href",t),!1},o=document.querySelectorAll("[mlink]"),s=0;s<o.length;++s){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;o[s].addEventListener("click",r)}for(var l=document.querySelectorAll("[place]"),s=0;s<l.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;l[s].addEventListener("click",function(e){for(var t=0,a=this.id,i=this.nextElementSibling,r=!1;i&&i.getAttribute("group")===a;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=i.getAttribute("quote"),s="collapsed"===o?"uncollapsed":"collapsed";"collapsed"===s&&(r=!0),i.setAttribute("quote",s),i=i.nextElementSibling}return setTimeout(function(){n(r)},0),e.stopImmediatePropagation(),e.preventDefault(),!1})}for(var u=[],d=document.querySelectorAll("img"),s=0;s<d.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=d[s].getAttribute("cid");c&&u.push(c),d[s].addEventListener("load",function(){n()})}u.length>0&&i.postMessage("reqResource",u)}(),i.postMessage("epLoaded"))}window.addEventListener("message",function(e){if(e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),i=e.data.substring(1,t),r=e.data.substring(t+1);switch(i){case"resLoad":try{if(r)for(var o=0,s=JSON.parse(r),l=document.querySelectorAll('[cid="'+s.cid+'"]'),u="data:"+s.mimeType+";base64,"+s.data,d=0;d<l.length;++d){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;l[d].src=u}}catch(c){a(c)}break;case"contentLoad":try{if(r){var s=JSON.parse(r);document.open(),document.write(s.data),document.close(),setTimeout(n,0)}}catch(c){a(c)}break;default:a(new Error("Unknown PreviewFrame message: "+i))}}}),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(o):(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1))}()}.toString()+')("'+a+'",'+JSON.stringify(i)+");<\/script>",o="<!DOCTYPE html>";return t='<meta http-equiv="Content-Type" content="'+t+'">',f.a.supportBlobURLIFrame?new Blob([o,"<html>","<head>",t,n,r,"</head>",e,"</html>"],{type:"text/html"}):[o,"<html>","<head>",t,n,r,"</head>",e,"</html>"].join("")}},{key:"onMessageLoaded",value:function(e){this.updateMessageHeight(e),this.messagesLoaded.set(!0)}},{key:"getPreviewIFrame",value:function(e){return document.getElementById("emailPreview_"+e)}},{key:"updateMessageHeight",value:function(e,t,a){var n=this.getPreviewIFrame(e);if(n){var r=this.messages.get()[this.messages.indexOfWithProperty("id",e)];t&&(n.style.height="0px");try{var o=n.contentDocument.documentElement;if(o){var s=a||r.defaultScale.get(),l=Math.ceil(o.scrollWidth*s),u=Math.ceil(o.scrollHeight*s);t&&u===r.height.get()&&(n.style.height=u+"px"),r.width.set(l),r.height.set(u),a&&r.defaultScale.get()!==a&&r.defaultScale.set(a)}}catch(d){i.default.reportError(d)}}}},{key:"_generateAltParts",value:function(e,t){var a=this.getPlugin().getMessageAttachments(t);if(a)for(var n=0,r=0;r<a.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=a[r];"application/ics"===o.mimeType&&this.getPlugin().loadResource(e.id,t.id,o.cid,function(e){if(e){var t=go.a.parseICS(i.default.b64_to_utf8(e.data));i.default.log("Parsed ICS Data: ",t)}})}}},{key:"_computeResponseMode",value:function(e){var t=n.a.EmailResponseMode.None;return e&&e.labelIds.indexOf("DRAFT")>=0&&(t=e.subject.startsWith("Fwd:")?n.a.EmailResponseMode.Forward:e.subject.startsWith("Re:")?1===e.to.length?n.a.EmailResponseMode.Reply:n.a.EmailResponseMode.ReplyAll:n.a.EmailResponseMode.Other),t}},{key:"_createMessageDisplay",value:function(e,t,a){i.default.Assert(!e.initializedForDisplay,"Should only initialize message for display once"),i.default.Assert(e.to,"Must have a valid to object"),i.default.Assert(e.from,"Mus have a valid from object");var n,r=!0;if(e.decoded?(e.isErrorMessage=!1,(n=this._createMessageHTML(e.decoded,e.resources,e.mimeType,a)).missingResourceData&&(r=!1)):(i.default.reportError(!1,"Missing message decoded data: "+i.default.isString(e.decoded)),e.isErrorMessage=!0,n=this._createErrorHTML()),e.listUnsubscribe){var o=this.parseListUnsubscribe(e.listUnsubscribe);i.default.log("Unsub Data: ",o)}return i.default.Assert(n.parsed,"Must have valid parsed data"),e.blob=this._createFrameBlob(n.parsed,e.contentType,e.id),i.default.isString(e.blob)||(e.blobURL&&(f.a.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0),e.blobURL=f.a.URL.createObjectURL(e.blob)),e.specialLinks=n.specialLinks,e.width||(e.width=new X.a(0)),e.height||(e.height=new X.a(0)),e.defaultScale||(e.defaultScale=new X.a(1)),e.responseMode||(e.responseMode=new X.a(this._computeResponseMode(t))),e.initializedForDisplay=!0,r}},{key:"_destroyMessageDisplay",value:function(e){i.default.Assert(e.initializedForDisplay,"Message must first be initialized before being destroyed"),e.initializedForDisplay=!1,e.isErrorMessage=!1,e.width=void 0,e.height=void 0,e.defaultScale=void 0,e.responseMode&&(e.responseMode=void 0),e.specialLinks=void 0,e.blob=void 0,e.blobURL&&(f.a.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0)}},{key:"ensureDisplayMessages",value:function(e){if(e===this.threadAttach)try{for(var t=0,a=e.getField("messages"),n=[],r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=a[r];if(!e.getPlugin().isMessageDraft(o)&&!o.initializedForDisplay){try{this._generateAltParts(e,o)}catch(s){i.default.reportError(s)}(0===r?this._createMessageDisplay(o,a[r+1],{collapseQuotes:!1}):this._createMessageDisplay(o,a[r+1]))||this.getPlugin().reportMessage(e.getField("accountID"),e.id,o.id,"Error creating display",!1)}n.push(o)}n.equals(this.messages.get())||this.messages.set(n)}catch(s){i.default.reportError(s)}}},{key:"_requestMessageReload",value:function(e,t,a){var n=this;t.getPlugin().forceReloadMessage(t,a,function(r){if(i.default.Assert(r,"Must be able to re-load message data"),t===n.threadAttach){var o=t.getField("messages"),s=o.indexOfWithProperty("id",a),l=o[s];if(l){var u=n.getPreviewIFrame(e);if(u)if(l.initializedForDisplay=!1,n.ensureDisplayMessages(t),f.a.supportBlobURLIFrame)u.src=l.blobURL;else{var d=u.contentWindow.document;d.documentElement.innerHTML="",d.open(),d.write(l.blob),d.close()}}}})}},{key:"onAttachmentUpdate",value:function(e,t,a){var n=this;(!t||t.indexOf("messages")>=0)&&e.getPlugin().loadThread(e,function(t,a){i.default.Assert(t,"Must be able to re-load thread data"),a&&e===n.threadAttach&&n.ensureDisplayMessages(e)})}},{key:"getThreadAttach",value:function(){return this.threadAttach}},{key:"_setThread",value:function(e,t){i.default.Assert(e.hasField("messages"),"Must supply valid messages to the email preview"),i.default.Assert(this.errorMessage.get()||e.getField("dataLoaded"),"Must have loaded remote data or have an error"),this.threadAttach&&this.threadAttach.id===e.id||(this.reset(),this.threadAttach=e,this.threadItem=t,e.subscribe(this),this.ensureDisplayMessages(e),e.getPlugin().attachmentHasLabelByID(e,"UNREAD")&&e.getPlugin().performAction(n.a.PluginAction.Gmail.MarkRead,!0,e),o.a.fireEvent("EmailPreview","openThreadChanged",[]))}},{key:"onSelectedIndexChanged",value:function(e,t,a){!f.a.isMobile&&this.isOpen()&&t===this.openOnPane&&(a&&a.hasAttachmentType(n.a.PluginType.Email)?a.getAttachmentByType(n.a.PluginType.Email).getPlugin()===this.getPlugin()&&this.getPlugin().openEmailByItem(a,t):"PaneGmail"===t.type&&this.reset())}},{key:"onDisplaySettingsChanged",value:function(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}}])&&mo(t.prototype,a),r&&mo(t,r),e}();function yo(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sidebarTransitioning=!1,this.isDraggingSidebar=new X.a(!1),this.lightboxPosition=new X.a,this.lightboxSrc=new X.a,this.lightboxElement=void 0,this.sidebarChanged=new J.a}var t,a,r;return t=e,(a=[{key:"init",value:function(){this.showSidebar=new X.a(!f.a.isMailbirdSidebar()&&!i.default.isDemoInIframe()&&xo.settings.showSidebar.get());var e=xo.settings.sidebarWidth.get()||n.a.DesktopMenuWidthDefault;this._savedSidebarWidth=e===n.a.DesktopMenuWidthSmall?n.a.DesktopMenuWidthDefault:e,this.sidebarWidth=new X.a(e)}},{key:"toggleSidebar",value:function(e){this.sidebarTransitioning=!0;var t=void 0!==e?e:!this.showSidebar.get();t&&(!0===e&&this._savedSidebarWidth===n.a.DesktopMenuWidthSmall&&(this._savedSidebarWidth=n.a.DesktopMenuWidthDefault),this.sidebarWidth.set(this._savedSidebarWidth)),this._setSidebarVisible(t),this.sidebarChanged.notify()}},{key:"minimize",value:function(){this.sidebarTransitioning=!0;var e=n.a.DesktopMenuWidthSmall;xo.settings.sidebarWidth.set(e),this.sidebarWidth.set(e),this.sidebarChanged.notify()}},{key:"restore",value:function(){this.toggleSidebar(!0),xo.settings.sidebarWidth.set(this.sidebarWidth.get())}},{key:"getSidebarWidth",value:function(){return f.a.isMailbirdSidebar()||!this.showSidebar.get()?0:this.sidebarWidth.get()}},{key:"setSidebarWidthMoving",value:function(e){this.showSidebar.set(!0),this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarWidth.set(e)}},{key:"setSidebarWidthUp",value:function(){var e=this.sidebarWidth.get();e<20?e=0:e<n.a.DesktopMenuWidthMinBig&&(e=n.a.DesktopMenuWidthSmall),e!==this.sidebarWidth.get()&&(this.sidebarTransitioning=!0,this.sidebarWidth.set(e)),e>0&&(this._savedSidebarWidth=e,xo.settings.sidebarWidth.set(e)),this._setSidebarVisible(e>0),this.isDraggingSidebar.set(!1),this.sidebarChanged.notify()}},{key:"_setSidebarVisible",value:function(e){xo.settings.showSidebar.set(e),this.showSidebar.set(e)}},{key:"shouldShowTopBar",value:function(){return!this.showSidebar.get()||f.a.isNativeMac()&&this.sidebarWidth.get()<n.a.DesktopMenuWidthMinBig}},{key:"topBarHeight",value:function(){return this.shouldShowTopBar()?32:0}}])&&yo(t.prototype,a),r&&yo(t,r),e}();function bo(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ko,wo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modals=[n.a.Modals.Settings,n.a.Modals.Alert,n.a.Modals.Confirm,n.a.Modals.Prompt,n.a.Modals.ExportData,n.a.Modals.ImportData,n.a.Modals.ReportProblem,n.a.Modals.Billing,n.a.Modals.EmailReply,n.a.Modals.EmailCompose,n.a.Modals.MobileSettings,n.a.Modals.DeleteAccount,n.a.Modals.Invoices,n.a.Modals.Options,n.a.Modals.Lightbox,n.a.Modals.EnterCode,n.a.Modals.ShareDoc,n.a.Modals.ReportBug,n.a.Modals.Backups],this.modalStack=new Q.a,this.contextMenuStack=new Q.a,this.emailComposeStack=new Q.a,S.a.forceBind("onClosingSettings",this)}var t,a,r;return t=e,(a=[{key:"toggleContextMenu",value:function(e,t){this.isContextMenuOpen()?this.closeContextMenu():this.openContextMenu(e,t)}},{key:"openAddPaneMenu",value:function(e){e.componentName="ReactContextMenuAddPane",e.onSelected=function(e,t,a){xo.PaneManager.addPaneByButton(e,t,a)},this.openContextMenu(e)}},{key:"openContextMenu",value:function(e,t){e.element&&i.default.findParent(e.element,"desktopSidebar")&&(e.pos={left:xo.DesktopUI.getSidebarWidth()+4},e.side="right",i.default.findParent(e.element,"desktopMenuBottom")&&(e.openFromBottom=!0)),this.contextMenuNoFade=t,this.contextMenuStack.push(e)}},{key:"indexOfContextMenu",value:function(e){var t=this.contextMenuStack.get(),a=t.indexOfWithProperty("fn",e);return a<0&&(a=t.indexOfWithProperty("componentName",e)),a}},{key:"closeContextMenu",value:function(e,t,a){if(e){var n=this.indexOfContextMenu(e);if(i.default.Assert(n>=0,"Tried to close a context menu that was not open"),n>=0){var r=this.contextMenuStack.get()[n];r.onClosed&&r.onClosed(t,a),this.contextMenuStack.removeAt(n)}}else{for(var o=0,s=this.contextMenuStack.get(),l=s.length-1;l>=0;l--){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;s[l].onClosed&&s[l].onClosed(!1,a)}this.contextMenuStack.clear()}f.a.isMobile||0!==this.contextMenuStack.length()||C.a.updateCaret()}},{key:"getTopContextMenu",value:function(){var e=this.contextMenuStack.get();if(e&&e.length){var t=e[e.length-1];return t.componentName||t.fn}}},{key:"isAutocompleteOpen",value:function(){return this.indexOfContextMenu("ReactAutocomplete")>=0}},{key:"isOnlyAutocompleteOpen",value:function(){return this.isAutocompleteOpen()&&1===this.contextMenuStack.get().length}},{key:"isContextMenuOpen",value:function(e){return e?this.indexOfContextMenu(e)>=0:this.contextMenuStack.get().length>0}},{key:"isModalOpen",value:function(e){var t=this.modalStack.get();if(!e)return t.length>0;for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t[i].id===e)return!0}}},{key:"openModal",value:function(e,t){i.default.Assert(void 0===t||i.default.isObject(t),"Must always pass in a valid object for params"),i.default.Assert(this.modals.indexOf(e)>=0,"Modal must be registered as a new modal to use this fn: ",e),this.isModalOpen(e)||(t=t||{},i.default.Assert(void 0===t.id,"Should not already have an ID defined with modal params"),t.id=e,C.a.reset(),this.modalStack.push(t))}},{key:"closeModal",value:function(e,t){var a=this.modalStack.get().indexOfWithProperty("id",e);if(a>=0){var i=this.modalStack.get()[a],n=!0;i.onClosing&&(n=i.onClosing()),n&&(this.modalStack.removeAt(a),i.callback&&i.callback(t))}}},{key:"confirm",value:function(e,t){i.default.Assert(t,"Confirm modals should have callbacks",e),this.openModal(n.a.Modals.Confirm,{text:e,callback:t})}},{key:"prompt",value:function(e,t){i.default.Assert(t,"Prompt modals should have callbacks",e),this.openModal(n.a.Modals.Prompt,{text:e,callback:t})}},{key:"alert",value:function(e){i.default.Assert(!e.action,"Still using an old style alert",e),e.action&&(e.callback=e.action),this.openModal(n.a.Modals.Alert,e)}},{key:"options",value:function(e){function t(t,a,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,a){i.default.Assert(i.default.isArray(t,"Must have valid options array")),i.default.Assert(a,"Options modal must have a callback"),this.openModal(n.a.Modals.Options,{text:e,options:t,callback:a})})},{key:"openSettings",value:function(e){A.e.performAction(A.c.UIAction,{type:A.d.OpenSettingsMenu}),this.openModal(n.a.Modals.Settings,{section:e,onClosing:this.onClosingSettings})}},{key:"onClosingSettings",value:function(){var e=!Le.a.isSaveEnabled.get();return e||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(e){e&&(Le.a.isSaveEnabled.set(!1),this.closeModal(n.a.Modals.Settings))}.bind(this)),e}},{key:"openDisplaySettings",value:function(){C.a.reset(),i.default.vmMain.isDisplaySettingsOpen.set(!0),A.e.performAction(A.c.UIAction,{type:A.d.OpenDisplaySettings})}},{key:"getUserEmail",value:function(){return i.default.getUserIdentifier()}},{key:"getUserName",value:function(){return i.default.isDemoMode()?"Demo":yt.a.getAccountName()}},{key:"openMenuExternalApp",value:function(e,t){this.openContextMenu({componentName:"ReactContextMenuMobileOpenLink",position:"bottom",html:e,onClick:t})}},{key:"_indexOfCompose",value:function(e){for(var t=0,a=this.emailComposeStack.get(),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].draftMsg.id===e)return i}return-1}},{key:"isComposeOpenForEmail",value:function(e){return!f.a.isMobile&&(e?this._indexOfCompose(e)>=0:this.emailComposeStack.length()>0)}},{key:"openComposeEmail",value:function(e,t,a,r){if(i.default.Assert(e,"Must have a valid email plugin"),i.default.Assert(!t||i.default.isString(t),"Must have a string threadID"),i.default.Assert(!a||i.default.isString(a),"Must have a string messageID"),C.a.reset(),this.isComposeOpenForEmail());else{var o=e.getDraftByID(e.getDefaultAccount(),t,a,r);if(i.default.Assert(o,"Must always create a valid draft"),f.a.isMobile){var s={threadAttach:o.attach,message:o.draftMsg};this.openModal(n.a.Modals.EmailCompose,s)}else i.default.Assert(this.emailComposeStack.indexOf(o)<0,"Must not double-open drafts, should re-use"),this.emailComposeStack.get().indexOfWithProperty("attach",o.attach)<0&&this.emailComposeStack.push(o)}A.e.miscAction({type:A.c.Misc,misc:A.a.ComposeEmail})}},{key:"closeComposeEmail",value:function(e,t){var a=this._indexOfCompose(t.id);i.default.Assert(a>=0,"Must have found a valid composing email to remove"),this.emailComposeStack.removeAt(a)}},{key:"openItemEditor",value:function(e){var t=this,a=arguments;if(i.default.Assert(!e.item===!!e.addOnSave,"Must be adding item if no item prop"),!e.item){e.parent||(e.parent=e.pane?e.pane.getRootItem():I.a.getDefaultDocument().getRootItem());var r=I.a.createTempVMLI({text:e.text||xo.settings.getDefaultItemText(),date:e.mooDate},{changeType:n.a.ChangeType.AllLocal});e.item=r;var o=e.endSave;e.endSave=function(){setTimeout(function(){I.a.destroyTempVMLI(r.id)},0),o&&o.apply(t,a)}}e.componentName="ReactItemDetailsPopup",this.openContextMenu(e)}},{key:"openLightbox",value:function(e,t,a){i.default.Assert(!f.a.isMobile,"Should never open lightbox on mobile"),this.openModal(n.a.Modals.Lightbox,{src:e,buttonText:t,buttonAction:a})}}])&&bo(t.prototype,a),r&&bo(t,r),e}(),So=a(27);function Io(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Do=(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((ko=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,r;return t=e,(a=[{key:"setup",value:function(){this.callbacks={},this.nextId=0,this.ipcBridge=window.___electronIPCBridge,this.ipcBridge&&(this.ipcBridge.onElectronMessage=this.handleMessage)}},{key:"handleMessage",value:function(e,t){try{if(isNaN(+e))i.default.Assert(this["onEvent_"+e],"Missing handler for native event"),this["onEvent_"+e](t);else{var a=this.callbacks[+e];a&&a(t)}}catch(n){i.default.reportError(n)}}},{key:"sendMessage",value:function(e,t,a){var n=this.nextId++,r=n+"~"+e;void 0!==t&&(i.default.isObject(t)&&(t=JSON.stringify(t)),r+="~"+t),this.callbacks[n]=a,this.ipcBridge.send("moodo-message",r)}},{key:"saveFile",value:function(e,t,a){this.sendMessage("saveFile",{filename:e,data:t},a)}},{key:"onEvent_features",value:function(e){try{var t=JSON.parse(e);t.version&&f.a.recordAppSubVersion(t.version),!1===t.notifications&&f.a.disallowNativeNotifications()}catch(a){i.default.reportError(a)}}},{key:"onEvent_downloadProgress",value:function(e){i.default.handleNativeDownloadProgress(e)}},{key:"onEvent_reportError",value:function(e){i.default.reportError(new Error("Native Error"),e)}},{key:"onEvent_onMenuClick",value:function(e){if("NewMessage"===e||"NewEmail"===e){var t=i.default.vmMain.getDefaultEmailPlugin();t.isEnabled()?xo.menus.openComposeEmail(t):xo.toasts.pushMessage(n.a.MessageID.NeedGmailPermission)}else"NewPane"===e?So.a.hotkeyAddPane():"NewItem"===e?So.a.hotkeyNewItem():"Preferences"===e?xo.menus.openSettings():"DisplaySettings"===e?xo.menus.openDisplaySettings():"ToggleSidebar"===e?xo.DesktopUI.toggleSidebar():i.default.reportError(new Error("Unknown Native Menu Click: "+e))}}])&&Io(t.prototype,a),r&&Io(t,r),e}()).prototype,"handleMessage",[g.a],Object.getOwnPropertyDescriptor(ko.prototype,"handleMessage"),ko.prototype),ko);function Co(e){return(Co="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Po(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ao(e,t){return!t||"object"!==Co(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mo(e,t,a){return(Mo="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=To(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function To(e){return(To=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Eo(e,t){return(Eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ao(this,To(t).apply(this,arguments))}var a,i,n;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Eo(e,t)}(t,io),a=t,(i=[{key:"init",value:function(){Mo(To(t.prototype),"init",this).call(this),this.Measure=new po,this.Measure.init(),this.EmailPreview=new vo,this.EmailPreview.init(),this.DesktopUI=new _o,this.DesktopUI.init(),this.menus=new wo,this.ElectronBridge=new Do}}])&&Po(a.prototype,i),n&&Po(a,n),t}(),xo=t.default=new Lo},,function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(2),s=a(11),l=a(14),u=a(7),d=a(15),c=a(29),h=a(17),f=a(6);function p(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pane=new u.a}var t,a,n;return t=e,(a=[{key:"setSelectedPaneObject",value:function(e){}},{key:"scrollStartIntoView",value:function(){}},{key:"updateCaret",value:function(){}},{key:"checkValid",value:function(){}},{key:"getPane",value:function(){return i.default.Assert(this.pane.get()===i.default.focusedPane,"Should these always match?"),this.pane.get()}},{key:"setFocusedPane",value:function(e){this.pane.set(e)}},{key:"closeKeyboard",value:function(){}}])&&p(t.prototype,a),n&&p(t,n),e}();function m(e){return(m="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t){return!t||"object"!==m(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e,t,a){return(_="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=b(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w="start",S="end",I=["mdImageResizer","emptyItemAddButton",["itemNotInPane",!0],"itemCheckbox","itemPrefix",["searchWrap",!0],"collapser","itemMenuIcon","itemEditButton",["formattingToolbar",!0],"itemTime"],D=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=y(this,b(t).call(this)))._isValid=!1,e._isInRightClick=!1,e._isDirty=!1,e._isWatchingChange=!0,e._isMouseDown=!1,e.isWindowFocused=new u.a(!0),e.hoveredItem=void 0,e.hoveredReactCell=void 0,e._previousSelectedIndex=void 0,e._previousIsValid=void 0,e._selectedMap=[],e.mousePos={x:-1,y:-1},e.mouseDownPos={x:-1,y:-1},e._lastClickTime=0,e._numClicks=0,e._savedPaneSels={},e._itemHighlightPosition=void 0,e.itemHighlightPosition=new u.a,e.init(),e}var p,m,D;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,g),p=t,(m=[{key:"init",value:function(){this.reset();var e={};e.onMove=this.onMouseMoveMobile.bind(this),document.addEventListener("selectstart",this._onSelectStart.bind(this)),document.addEventListener("selectionchange",this._onSelectionChange.bind(this)),i.default.setupClick(document,this,e),l.a.listen("paneAdded",this.onPaneAdded.bind(this)),l.a.listen("paneRemoved",this.onPaneRemoved.bind(this)),s.a.binder(this,"restore","onScroll","closeKeyboardIfNoSelection","_closeKeyboard")}},{key:"reset",value:function(e,t){if(this._isValid){i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::reset");var r=!t&&this.save();r&&(this._previousSelection=r),this._setIndexSide(w,void 0),this._setIndexSide(S,void 0),this._setOffsetSide(w,void 0),this._setOffsetSide(S,void 0),this._dblClickOffsets=void 0,this.preferLineStart=!1,this._mouseOffset=-1,this._mouseMoved=!1,this._isValid=!1,this._isArrowSelectInverted=!1,this._itemHighlightPosition=void 0;var o=this.getPane();!o||o.isUnloaded()||o.isDestroyed()||(o.caretPosition.set(void 0),this._updateSelection()),i.default.keyboardToolbar&&(h.a.reset(),e||a(38).default.isTyping||l.a.fireEvent("closeKeyboard",[]))}}},{key:"getPreviousSelection",value:function(){return this._previousSelection}},{key:"dumpState",value:function(){var e={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.startIndex,offset:this.startOffset},end:{index:this.endIndex,offset:this.endOffset}};try{var t=!!this.pane.get();e.paneInfo=t?{hasPane:t,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop(),displayCount:this.pane.get().inViewCount()}:"No Pane Set"}catch(a){e.paneInfo="Invalid Pane"}try{void 0!==this.startIndex&&(e.start.item=this.pane.get().items.get()[this.startIndex].id)}catch(a){e.start.item="Invalid Item"}try{void 0!==this.endIndex&&(e.end.item=this.pane.get().items.get()[this.endIndex].id)}catch(a){e.end.item="Invalid Item"}return e}},{key:"setValid",value:function(e){if(e){i.default.Assert(!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex()),i.default.Assert(!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex());try{var t=this.pane.get().items.get()[this.startIndex];i.default.Assert(t&&(i.default.isVMLI(t)||i.default.isVMLI(t.item)),"Valid selection must always be into a VMLI for start item");var a=this.pane.get().items.get()[this.endIndex];i.default.Assert(a&&(i.default.isVMLI(a)||i.default.isVMLI(a.item)),"Valid selection must always be into a VMLI for end item")}catch(n){i.default.reportError(n)}}else this.reset();this._isValid=e}},{key:"isArrowSelectInverted",value:function(){return this._isArrowSelectInverted}},{key:"setArrowSelectInverted",value:function(e){this._isArrowSelectInverted=e}},{key:"getStartItem",value:function(){return this.getPane().itemAtIndex(this.startIndex)}},{key:"getStartObject",value:function(){return this.getPane().objectAtIndex(this.startIndex)}},{key:"getStartOffset",value:function(){var e;return-1===this.startOffset?(e=this.getStartTotal(),this.startOffset=e):e=this.startOffset,e}},{key:"getStartIndex",value:function(){return this.startIndex}},{key:"getStartTotal",value:function(){return this.getStartItem().getParsedText().length}},{key:"getEndItem",value:function(){return this.getPane().itemAtIndex(this.endIndex)}},{key:"getEndObject",value:function(){return this.getPane().objectAtIndex(this.endIndex)}},{key:"getEndOffset",value:function(){var e;return-1===this.endOffset?(e=this.getEndTotal(),this.endOffset=e):e=this.endOffset,e}},{key:"getEndIndex",value:function(){return this.endIndex}},{key:"getEndTotal",value:function(){return this.getEndItem().getParsedText().length}},{key:"isMouseDown",value:function(){return this._isMouseDown}},{key:"_mutateProperty",value:function(e,t){var a=this[e];this[e]=t,a!==t&&(this._isDirty=!0)}},{key:"_setIndexSide",value:function(e,t){this._mutateProperty(e+"Index",t)}},{key:"_setOffsetSide",value:function(e,t){if(r.default.settings.selectFullItems.get()&&this.getStartIndex()!==this.getEndIndex()){var a=e===w?this.getStartIndex():this.getEndIndex(),o=this.getPane().itemAtIndex(a);t=e===w?0:o.getParsedText().length}this._mutateProperty(e+"Offset",t),i.default.shouldLog(n.a.LogLevels.Edit)&&i.default.log(e,t)}},{key:"setSelection",value:function(e,t,a,i){this._setIndexSide(w,e),this._setIndexSide(S,a),this._setOffsetSide(w,t),this._setOffsetSide(S,i),this._downIndex=e,this._downOffset={start:t,end:i}}},{key:"isValid",value:function(){return this._isValid}},{key:"checkValid",value:function(){var e=!1,t=this.getPane();if(t&&this.startIndex>=0&&this.startIndex<t.numItems()&&this.endIndex>=0&&this.endIndex<t.numItems())if(this.getStartItem()&&this.getEndItem()){var a=this.getStartItem().getParsedText(),n=this.getEndItem().getParsedText();this.startOffset>=0&&this.startOffset<=a.length&&this.endOffset>=0&&this.endOffset<=n.length&&(e=!0)}else e=!1;return!e&&this.isValid()&&(i.default.log("Sel is now invalid"),this.reset(void 0,!0)),e}},{key:"clearSelection",value:function(e){this.reset(e)}},{key:"onPaneAdded",value:function(e){}},{key:"onPaneRemoved",value:function(e){this.getPane()===e&&this.setFocusedPane(void 0)}},{key:"onScroll",value:function(e){var t=i.default.getPaneForElement(e.target);if(this._isMouseDown&&t===this.getPane()&&t.isWriteable&&!a(67).default.isDragging){var n=this.getMousePos();this._mouseOffset=n.y+t.getScrollTop();var r=document.elementFromPoint(n.x,n.y),o={clientX:n.x,clientY:n.y,target:r};this._updateFromMouse(o),this._updateSelection()}}},{key:"onRightMouseDown",value:function(e){var t=!i.default.hasClass(e.target,"mdImage"),a=i.default.findParent(e.target,"item")&&i.default.getElementParent(e.target);if(a&&!i.default.findParent(a,"autocompleteItem",2)&&!i.default.hasClass(a,"itemNotInPane")){var n=i.default.getPaneObjectForElement(a);if(n){var r=i.default.getPaneForElement(a),o=n.index;this.isSelected(o,r)&&(t=!1)}}t&&(this._isInRightClick=!0,this.onMouseDown(e,!0),this._isInRightClick=!1)}},{key:"checkDoubleClick",value:function(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0}},{key:"onMouseDown",value:function(e,t){var a=i.default.getPaneForElement(e.target);if(this.isWindowFocused.set(!0),i.default.findParent(e.target,"formattingToolbar")||(this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0)),a){this.setFocusedPane(a);var s=e.target,l=a.getInfiniteList();if(a.supportSel&&!I.some(function(e){return i.default.isArray(e)?i.default.findParent(s,e[0]):i.default.hasClass(s,e)})){t||(this._isMouseDown=!0),this._selectionBeforeBlur=void 0,this.preferLineStart=!1;var u,h=this.mouseDownPos.x,f=this.mouseDownPos.y,p=!1,g=i.default.getElementParent(e.target),m=i.default.findParent(e.target,"line");if(this.mouseDownPos.x=e.pageX,this.mouseDownPos.y=e.pageY,!m&&(m=g&&i.default.findChild(g,"line"))){var v=i.default.offset(m);u=e.clientX>v.left+50||e.clientY>v.top+10?"end":"start"}if(i.default.findParent(s,"paneContent")){if(a&&a.isWriteable&&a.isEditable){if(g&&m){if(t)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var y=Date.now();y-this._lastClickTime<n.a.DoubleClickTime&&Math.abs(e.pageX-this.mouseDownPos.x)<2&&Math.abs(e.pageY-this.mouseDownPos.y)<2&&Math.abs(e.pageX-h)<2&&Math.abs(e.pageY-f)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=y}var _=d.default.getCursorSelectionRange(e);if(_){i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::onMouseDown - Default");var b=i.default.getListCellForElement(e.target);if(b&&!b.props.overview){if(this.preferLineStart=e.clientX-i.default.offset(m).left<30,e.shiftKey&&!(o.a.mac&&e.metaKey||!o.a.mac&&e.ctrlKey))this._mouseMoved=!0,this._mouseOffset=e.eventY+a.getScrollTop(),this._updateFromMouse(e);else if(1===this._numClicks||this._numClicks>3){this._downIndex=b.getIndex(),i.default.Assert(this._downIndex>=0,"Must have a valid index in react item"),this._downIndex<0&&i.default.Assert(this._downIndex>=0,"Dead cell error",i.default.getElementPath(_.getStartElement()),i.default.getElementPath(e.target)),this._downItem=b.getItem(),i.default.Assert(this._downItem,"Must have a valid item in react item");var k=_.getSelectOffsetsInElement(g);if(u){var D="start"===u?this._downItem.getPrefixLength():this._downItem.getTextLength();k.start=D,k.end=D}if(0===this._downItem.getParsedTextWithoutPrefix().length?this._downOffset={start:k.total,end:k.total}:this._downOffset={start:k.start,end:k.start},r.default.settings.showMarkdown.get()&&!this.isSelected(this._downIndex,a)){var C=i.default.findParent(_.getStartContainer(),"mdSpan",2);if(C&&_.getStartOffset()===C.innerHTML.length){for(var P=0,A=C.nextElementSibling,M=0;A&&i.default.hasClass(A,"mdMarkup");){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;M+=A.innerHTML.length,A=A.nextElementSibling}if(!A){var T=Math.min(this._downOffset.start+M,k.total);this._downOffset={start:T,end:T}}}}this.setSelection(this._downIndex,this._downOffset.start,this._downIndex,this._downOffset.end)}else if(2===this._numClicks){var E=this._downItem.getParsedText(),L=c.a.getPreviousWord(this._downItem,E,this._downOffset.start)+1,x=c.a.getNextWord(this._downItem,E,this._downOffset.end);this._setOffsetSide(w,L),this._setOffsetSide(S,x),this._downOffset={start:L,end:x}}else 3===this._numClicks&&(this._setOffsetSide(w,0),this._setOffsetSide(S,this._downItem.getParsedText().length),this._downOffset={start:0,end:this._downItem.getParsedText().length});p=!0}}}else if(!i.default.findParent(e.target,"paneContent")||i.default.findParent(e.target,"addItemButton")||l.disablePointerEvents.get())i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::onMouseDown - Skip");else{var O=a.indexOfLastItem();O>=0&&(e.shiftKey&&this.isValid()&&!t?this.selectIndices(this.getStartIndex(),this.getStartOffset(),O,-1):this.selectIndex(O,-1),p=!0),e.preventDefault()}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}}else i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::onMouseDown - Skip header");this.setValid(p&&this.checkValid()),this.isValid()&&(i.default.setItemAnimationMode(n.a.ItemAnimationMode.None),this._updateSelection(),i.default.resetItemAnimationMode()),l&&l.flushTimeoutPointerEvents()}}}},{key:"getMousePos",value:function(){return this.mousePos}},{key:"onMouseMoveDocument",value:function(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY}},{key:"onMouseMove",value:function(e){if(this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),e.target!==document.documentElement&&e.target.parentElement&&!i.default.isDraggingImage){var t=i.default.getPaneForElement(e.target);if(this._isValid&&this._isMouseDown&&t===this.getPane()&&t.supportSel&&t.isWriteable&&!a(67).default.isDragging)return this._mouseMoved=!0,i.default.setItemAnimationMode(n.a.ItemAnimationMode.None),this._mouseOffset=e.eventY+t.getScrollTop(),this._updateFromMouse(e),this._updateSelection(),e.preventDefault(),!1}}},{key:"onMouseMoveMobile",value:function(e){this.mousePos.x=e.pageX||e.clientX,this.mousePos.y=e.pageY||e.clientY}},{key:"onMouseUp",value:function(e){var t=i.default.isAttachedToDoc(e.target)&&i.default.getPaneForElement(e.target),a=t&&i.default.getElementParent(e.target);t&&t.supportSel&&!I.some(function(t){return i.default.isArray(t)?i.default.findParent(e.target,t[0]):i.default.hasClass(e.target,t)})&&(this._isMouseDown=!1,i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::onMouseDown - onMouseUp"),i.default.vmMain&&i.default.resetItemAnimationMode(),!a||i.default.hasClass(e.target,"contact")||i.default.hasClass(a,"itemNotInPane")||this.updateCaret(),this._itemHighlightPosition&&this.itemHighlightPosition.set(this._itemHighlightPosition),i.default.cancelRepeatScroll())}},{key:"focusPane",value:function(e){this.setFocusedPane(e),this.updateCaret()}},{key:"setFocusedPane",value:function(e){if(!e||!i.default.focusedPane||i.default.focusedPane.id!==e.id){var a=i.default.focusedPane;a&&!a.isUnloaded()&&(a.setFocused(!1),a.isEditable&&this.isValid()&&(this._savedPaneSels[a.id]=this.save())),r.default.PaneUpdateBatcher.beginUpdateItems(),this.reset(),h.a.reset(a),i.default.focusedPane=e,i.default.focusedItem=e?e.getItem():void 0,_(b(t.prototype),"setFocusedPane",this).call(this,e),a&&a.deactivate(),e&&e.activate(),r.default.PaneUpdateBatcher.commitUpdateItems()}}},{key:"_updateWith",value:function(e,t,a){var r=t===w?a.getStartElement():a.getEndElement();if(i.default.Assert(r,"Trying to select in invalid container"),r){var o=i.default.getListCellForElement(r),s=i.default.getElementParent(r),l=i.default.getItemForElement(s),u=a.getSelectOffsetsInElement(s),d=t===w?u.start:u.end;i.default.Assert(o.getItem(),"Should not be updating ReactCells without VMLIs"),i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::_updateWith["+e+"] - ",d,o.index),this._setIndexSide(e,o.getIndex()),this._dblClickOffsets&&o.getIndex()===this._dblClickOffsets.index&&(e===w?d=Math.min(d,this._dblClickOffsets.start):e===S?d=Math.max(d,this._dblClickOffsets.end):i.default.Assert(!1,"Invalid toUpdate value")),this._downOffset.start!==this._downOffset.end&&(d=e===w?c.a.getPreviousWord(l,l.getParsedText(),d)+1:c.a.getNextWord(l,l.getParsedText(),d-1)),this._setOffsetSide(e,d),i.default.Assert(!isNaN(d),"Selection offsets should not be undefined")}}},{key:"_setSelectionOnSide",value:function(e,t,a){var i=e===w?S:w;this._setIndexSide(e,t),this._setIndexSide(i,this._downIndex),this._setOffsetSide(e,a),this._setOffsetSide(i,e===w?this._downOffset.start:this._downOffset.end),this.setArrowSelectInverted(t<this._downIndex||t===this._downIndex&&a<this._downOffset.start)}},{key:"_updateFromMouse",value:function(e){var t=e.target;if(t){var a=i.default.focusedPane;if(!i.default.getElementParent(t)&&e.clientY<a.contentTop()){if(i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::_updateFromMouse - outOfPane"),t=i.default.elementFromPoint(e.clientX,a.contentTop()+1,t),i.default.getElementParent(t)){var r=i.default.getListCellForElement(t),o=i.default.getItemForElement(t);i.default.Assert(o,"If it is an LI it should be an item",t),this._setIndexSide(w,r.getIndex()),this._setOffsetSide(w,0)}}else{var s,l,u,c=i.default.getElementParent(t);if(c){if(i.default.findParent(t,"line")||(t=c.firstElementChild),(u=d.default.getCursorSelectionRange(e))&&u.getStartElement()){var h=i.default.getListCellForElement(t);if(i.default.Assert(h,"Must be able to find a valid reactCell for the start element"),h)if((s=h.getIndex())<0&&i.default.Assert(s>=0,"Dead cell error",i.default.getElementPath(u.getStartElement()),i.default.getElementPath(t)),i.default.findParent(u.getStartContainer(),"line")&&i.default.findParent(u.getEndContainer(),"line"))l=u.getSelectOffsetsInElement(c).start;else s<=this._downIndex?this._setSelectionOnSide(w,s,0):this._setSelectionOnSide(S,s,0)}}else if(a.hasNonVMLIs){var f=i.default.getPaneObjectForElement(t);if(f){var p=f.index;if(p>=0)if(!a.itemAtIndex(p))if(p<this._downIndex){var g=a.indexOfNextVMLI(p);g>=0&&this._setSelectionOnSide(w,g,0)}else{var m=a.indexOfPrevVMLI(p);if(m>=0){var v=a.itemAtIndex(m);this._setSelectionOnSide(S,m,v.getParsedText().length)}}}}else if(i.default.hasClass(t,"paneContent")){i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::_updateFromMouse - paneContent");var y=a.getLastItem();this._setIndexSide(S,a.numItems()-1),this._setOffsetSide(S,y?y.getParsedText().length:0)}if(!isNaN(s)&&!isNaN(l)&&u){var _,b=i.default.findParent(t,"line");if(b)this.preferLineStart=e.clientX-i.default.offset(b).left<30,s<this._downIndex||s===this._downIndex&&l<this._downOffset.start?(_=S,this._updateWith(w,w,u),this.setArrowSelectInverted(!0)):(s>this._downIndex||s===this._downIndex&&l>=this._downOffset.start)&&(_=w,this._updateWith(S,S,u),this.setArrowSelectInverted(!1),l===this._downOffset.start&&(this._isDirty=!0)),void 0!==_&&(i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::_updateFromMouse - RunAfterUpdates"),this._setIndexSide(_,this._downIndex),this._dblClickOffsets?this._setOffsetSide(_,this._dblClickOffsets[_]):this._setOffsetSide(_,_===w?this._downOffset.start:this._downOffset.end),this.setValid(!0))}}}}},{key:"setSelectionFromNativeRange",value:function(e){this._updateWith(w,w,e),this._updateWith(S,S,e),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))}},{key:"_updateSelection",value:function(){var e=this;if(this._isDirty){var t=this.getPane(),a=this.save(),o=this._selectedMap;this.getStartIndex()!==this.getEndIndex()||(this.getStartOffset(),this.getEndOffset());if(this._selectedMap=[],this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex())),this.getStartIndex()===this.getEndIndex()&&void 0!==this.getStartIndex())i.default.Assert(!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined"),this._selectedMap[this.getStartIndex()]={start:this.getStartOffset(),end:this.getEndOffset()};else for(var s=0,u=this.getStartIndex();u<=this.getEndIndex();++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=!0;r.default.settings.selectFullItems.get()||(u===this.getStartIndex()?d={start:this.getStartOffset(),end:-1}:u===this.getEndIndex()&&(i.default.Assert(this.getEndOffset()<=this.getEndItem().getParsedText().length,"Selection is past end of text string"),d={start:0,end:this.getEndOffset()})),this._selectedMap[u]=d}if(t){var c=!1;o.forEach(function(a,i){if(void 0===e._selectedMap[i]&&i<t.numItems()){var n=t.itemAtIndex(i);n&&(n.itemChanged.notify(),c=c||t.checkHeightChanged(n,i),0)}}),this._selectedMap.forEach(function(a,n){var r=o[n],s=e._selectedMap[n];if(void 0===r||r.start!==s.start||r.end!==s.end){var l=t.itemAtIndex(n);l&&((!r||s.start!==s.end||r&&r.start!==r.end||i.default.isObject(r)!==i.default.isObject(s))&&l.itemChanged.notify(),c=c||t.checkHeightChanged(l,n),0)}}),c&&(i.default.setItemAnimationMode(n.a.ItemAnimationMode.Move),t.updateItems(!1,!0),i.default.resetItemAnimationMode())}this.updateCaret(),this._isDirty=!1,l.a.fireEvent("selectionChanged",[a]);var h=this.getStartIndex(),f=this.isValid();if(h===this.getEndIndex()||!f){if(h!==this._previousSelectedIndex||f!==this._previousIsValid){var p=f?this.getStartItem():void 0;l.a.fireEvent("selectedIndexChanged",[h,t,p])}this._previousSelectedIndex=h,this._previousIsValid=f}}}},{key:"_onSelectStart",value:function(e){return!a(67).default.isDragging||(e.preventDefault(),!1)}},{key:"_onSelectionChange",value:function(e){if(d.default.hasSelection()){if(o.a.android&&a(67).default.isDragging)return void d.default.clearSelection();if(this.getPane().isWriteable)if(o.a.android){if(this.isValid()){var t=this.getStartElement();t===document.activeElement&&this.setSelection(this.getStartIndex(),t.selectionStart,this.getEndIndex(),t.selectionEnd)}}else{var n=d.default.getSelectionRange(),r=n.getStartElement(),s=n.getEndElement();if(r&&s){var l=i.default.findParent(r,"item"),u=i.default.findParent(s,"item");l&&u&&!i.default.hasClass(l,"dead")&&!i.default.hasClass(u,"dead")&&this.setSelectionFromNativeRange(n)}}else this.reset()}i.default.timeoutOnce("closeKeyboardIfNoSelection",this.closeKeyboardIfNoSelection,100)}},{key:"closeKeyboardIfNoSelection",value:function(){d.default.hasValidSelection()||this.closeKeyboard()}},{key:"closeKeyboard",value:function(){i.default.batchRenderUpdates(this._closeKeyboard)}},{key:"_closeKeyboard",value:function(){this.reset(),i.default.blurActiveElement()}},{key:"updateCaret",value:function(){var e=this.getPane();if(e&&e.isWriteable){if(this.isValid()){var t=!this._isInRightClick&&this.getStartItem()===this.getEndItem()&&this.getStartItem()&&this.getStartItem().isNote();t?e.openNoteContextMenu():!r.default.menus.isAutocompleteOpen()&&r.default.menus.isContextMenuOpen()&&r.default.menus.closeContextMenu()}if(this.isValid()){0;var a=this.getStartItem(),o=this.getStartObject(),s=e.topOfIndex(this.getStartIndex())+(a&&a.shouldShowParents(o,e)?n.a.HeightAgendaParents:0),l=e.getPaddingForPaneObject(o),u=r.default.Measure.getCaretOffset(o,e,this.getStartOffset(),this.preferLineStart);if(this.getStartItem()&&this.getEndItem()&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()===this.getEndOffset()){this._selectionBeforeUpdate={index:this.getStartIndex(),offset:this.getStartOffset()};var d=e.caretPosition.get();u.left=Math.floor(Math.min(u.left+l,e.getWidth()-10)),u.top+=s,u.isVisible=!0,u.item=a,u.pane=e,u.paneObject=o,this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0),d&&d.isVisible&&d.left===u.left&&d.top===u.top||e.caretPosition.set(u)}else{var c=e.caretPosition.get();c&&c.isVisible&&((c=i.default.clone(c)).isVisible=!1,e.caretPosition.set(c));var h=this.getStartIndex()===this.getEndIndex()?this.getEndOffset():a.getTextLength(),f=r.default.Measure.getCaretOffset(o,e,h,this.preferLineStart);this._itemHighlightPosition={x:l+(u.left+f.left)/2,y:s}}t||!e.hiddenInput||this.isComposing||this.focusHiddenInput()}else e.caretPosition.set(void 0)}}},{key:"focusHiddenInput",value:function(){var e=this.getPane();if(e&&e.isEditable&&e.hiddenInput){var t=d.default.createSelectionRange(),a=e.hiddenInput,r=0,o=1,s=e.scrollElement,l=s.scrollLeft,u=s.scrollTop;if(this.isValid()){var c=this.getStartItem().getParsedText();a.innerHTML=i.default.escape(c),r=this.getStartOffset(),o=this.getStartItem()===this.getEndItem()?this.getEndOffset():this.getStartOffset()}a.firstChild&&0!==a.firstChild.length||(a.innerHTML=n.a.TextSpace);var h=a.firstChild;i.default.Assert(h,"Empty element must have a valid child");try{a.focus(),t.setStart(h,r),t.setEnd(h,o),d.default.setSelectionRange(t)}catch(f){i.default.reportError(f)}s.scrollLeft=l,s.scrollTop=u}}},{key:"isSelected",value:function(e,t){return t===this.getPane()&&!!this._selectedMap[e]}},{key:"getSelectionAtIndex",value:function(e){return this._selectedMap[e]}},{key:"selectIndex",value:function(e,t,a,i){return void 0===a&&(a=t),this.selectIndices(e,t,e,a,i)}},{key:"selectIndices",value:function(e,t,a,r,o){if(i.default.Assert(e>=0,"Must supply a valid start index"),i.default.Assert(a>=0,"Must supply a valid end index"),i.default.Assert(a>e||a===e&&(r>=t||-1===r),"Must not pass reversed selection"),!(e<0||a<0)){var s,l,u=!1,d=this.getPane();if(d&&d.isWriteable&&(s=d.itemAtIndex(e),l=d.itemAtIndex(a),i.default.Assert(s,"Trying to select invalid start index"),i.default.Assert(l,"Trying to select invalid end index"),s&&l&&o!==n.a.SelectOption.AllowPrefix)){var c=s.getPrefixLength(),h=l.getPrefixLength();t>=0&&t<c&&(t=c),r>=0&&r<h&&(r=h)}return!s||!l||this.isValid()&&e===this.getStartIndex()&&t===this.getStartOffset()&&a===this.getEndIndex()&&r===this.getEndOffset()?this.updateCaret():(i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::selectIndices -",t,r),this.setSelection(e,t,a,r),i.default.Assert(!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined"),!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(),u=!0),u}}},{key:"selectItem",value:function(e,t,a){return i.default.Assert(i.default.isNumber(t),"Must pass a valid start offset"),i.default.Assert(i.default.isNumber(a)||void 0===a,"Must pass a valid end offset"),void 0===a&&(a=t),this.selectItems(e,t,e,a)}},{key:"selectItems",value:function(e,t,a,n){i.default.Assert(i.default.isVMLI(e),"Should only be passing VMLIs to start this fn"),i.default.Assert(i.default.isVMLI(a),"Should only be passing VMLIs to end this fn");var r=this.getPane();if(r){var o=r.indexOfItem(e);i.default.Assert(o>=0,"Must be able to find the start item in the pane");var s=r.indexOfItem(a);return i.default.Assert(s>=0,"Must be able to find the end item in the pane"),this.selectIndices(o,t,s,n)}}},{key:"selectElements",value:function(e,t,a,r){i.default.Assert(!i.default.isVMLI(e),"Should not be passing VMLIs to start this fn"),i.default.Assert(!i.default.isVMLI(a),"Should not be passing VMLIs to end this fn"),i.default.shouldLog(n.a.LogLevels.Selection)&&i.default.log("Sel::selectElements -",t,r),this._isWatchingChange=!1;var o=!1,s=d.default.getOffsetChildElement(e,t),l=d.default.getOffsetChildElement(a,r);return i.default.Assert(s&&s.element&&!isNaN(s.offset),"Start element is invalid"),i.default.Assert(l&&l.element&&!isNaN(l.offset),"End element is invalid"),s&&s.element&&l&&l.element&&(d.default.setSelection(s.element,s.offset,l.element,l.offset),o=!0),this._isWatchingChange=!0,o}},{key:"save",value:function(e){if(this._isValid){var t=this.getPane();if(!t.isDestroyed()&&!t.isUnloaded()){i.default.Assert(!isNaN(this.getStartIndex()),"Start index must be valid"),i.default.Assert(!isNaN(this.getEndIndex()),"End index must be valid");var a={pane:t,startIndex:this.getStartIndex(),startOffset:this.getStartOffset(),endIndex:this.getEndIndex(),endOffset:this.getEndOffset()};return e||(a.endItem=this.getEndItem(),a.endObject=this.getEndObject(),a.startItem=this.getStartItem(),a.startObject=this.getStartObject()),this._savedSelection=a,a}}}},{key:"getSavedSelection",value:function(){return this._savedSelection}},{key:"restore",value:function(e,t){var a=!1;if(e&&!e.pane.isDestroyed()){i.default.Assert(e.pane,"Must have a valid pane to restore selection to");var n=i.default.focusedPane;i.default.focusedPane=e.pane,i.default.focusedItem=e.pane.getItem(),n&&!n.isUnloaded()&&n!==e.pane&&n.setFocused(!1),e.pane.setFocused(!0),this.pane.set(e.pane),t||(e=e.pane.adjustSelectionFromPaneObject(e))}return e&&e.startItem&&e.endItem?(this.selectIndices(e.startIndex,e.startOffset,e.endIndex,e.endOffset),a=!0):this.reset(),this._savedSelection=void 0,a}},{key:"scrollStartIntoView",value:function(e){this._isValid&&(i.default.Assert(!isNaN(this.getStartIndex()),"Start index must be valid"),i.default.Assert(!isNaN(this.getEndIndex()),"End index must be valid"),i.default.focusedPane.scrollIndexIntoView(this.getStartIndex(),e?n.a.ScrollDuration.Snap:n.a.ScrollDuration.Default))}},{key:"scrollEndIntoView",value:function(){this._isValid&&(i.default.Assert(!isNaN(this.getStartIndex()),"Start index must be valid"),i.default.Assert(!isNaN(this.getEndIndex()),"End index must be valid"),i.default.focusedPane.scrollIndexIntoView(this.getEndIndex(),n.a.ScrollDuration.Default))}},{key:"onWindowBlur",value:function(e){this.isWindowFocused.set(!1)}},{key:"onWindowFocus",value:function(e){this.isWindowFocused.set(!0)}},{key:"getSelectedObjects",value:function(e){var t=0;if(!this._isValid)return[];for(var a=[],i=this.getPane(),n=this.getStartIndex();n<=this.getEndIndex();++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i.objectAtIndex(n),o=r.item;!o||!e&&o.isNote()||a.push(r)}return a}},{key:"getSelectedItems",value:function(e){var t=0;if(!this._isValid)return[];for(var a=[],i=this.getPane(),n=this.getStartIndex();n<=this.getEndIndex();++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i.itemAtIndex(n);!r||!e&&r.isNote()||a.push(r)}return a}},{key:"getStartElement",value:function(){if(this._isValid&&!isNaN(this.getStartIndex()))return this.getPane().elementAtIndex(this.getStartIndex())}},{key:"getEndElement",value:function(){if(this._isValid&&!isNaN(this.getEndIndex()))return this.getPane().elementAtIndex(this.getEndIndex())}},{key:"setHovered",value:function(e,t,a){if(this.hoveredReactCell!==a){var i=this.hoveredItem;this.hoveredItem=t,this.hoveredReactCell=a,i&&i.itemChanged.notify(),t&&t.itemChanged.notify()}}},{key:"isReactCellHovered",value:function(e){return this.hoveredReactCell===e}},{key:"isItemHovered",value:function(e){return this.hoveredItem===e}},{key:"insertTextAtCaret",value:function(e,t){this.pane.get().updateSelectionAndroid({target:this.getStartElement()}),i.default.Assert(this.getStartIndex()===this.getEndIndex(),"Cannot insert text in multiselect");var a=this.getStartIndex(),r=this.getStartItem(),o=this.getStartOffset(),s=this.getEndOffset(),l=r.getRawText();o!==s&&(l=l.substr(0,o)+l.substr(s,l.length-s)),t&&o>0&&" "!==l[o-1]&&(l=i.default.insertIntoText(l," ",o),o++),l=i.default.insertIntoText(l,e,o),o+=e.length,r.setText(l,!0,n.a.ChangeType.Local),this.selectIndex(a,o)}},{key:"fireKeyEvent",value:function(e,t,a){this.fireKeyEventInternal(e,"keydown",t),this.fireKeyEventInternal(e,"keypress",a||t),this.fireKeyEventInternal(e,"keyup",t)}},{key:"fireKeyEventInternal",value:function(e,t,a){if(i.default.Assert(void 0!==a,"Must pass in valid key data to type"),e||(e=this.getStartElement()),document.createEvent&&e){var n=document.createEvent("Event");n.normCode=a.normCode,n.shiftKey=!!a.shiftKey,n.altKey=!!a.altKey,n.ctrlKey=!!a.ctrlKey,n.metaKey=!!a.metaKey,n.synthetic=!0,n.initEvent(t,!0,!0),e.dispatchEvent(n)}else e?i.default.Assert(!1,"Unable to fire key event"):i.default.Assert(!1,"No element available to fire key event on")}},{key:"fireClickEvent",value:function(e,t){this.fireClickEventInternal(e,"mousedown",t),this.fireClickEventInternal(e,"mouseup",t),this.fireClickEventInternal(e,"mouseclick",t)}},{key:"fireClickEventInternal",value:function(e,t,a,n){if(i.default.Assert(void 0!==a,"Must pass in a valid button to click with"),e||(e=d.default.getSelectionNode()),document.createEvent&&e){var r=document.createEvent("Event");if(r.button=a,r.synthetic=!0,n)for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);r.initEvent(t,!0,!0),e.dispatchEvent(r)}else e?i.default.Assert(!1,"Unable to fire click event"):i.default.Assert(!1,"No element available to fire click event on")}},{key:"fireMouseUp",value:function(e,t){this.fireClickEventInternal(e,"mouseclick",t)}},{key:"editNote",value:function(e){var t=this,a=i.default.focusedPane,n=this.getStartObject();if(e.isNote())this.selectIndex(this.getStartIndex(),0);else{e.hasNote()||(f.e.beginAction(),e.createNote(),f.e.endAction());var r=a.indexOfObject(n);setTimeout(function(){t.selectIndex(r+1,0)},0)}}}])&&v(p.prototype,m),D&&v(p,D),t}();t.a=new D},function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"a",function(){return l}),a.d(t,"b",function(){return u}),a.d(t,"d",function(){return d});var i=a(0),n=a(1),r=a(11),o=a(12),s={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11,Mobile:12},l={ToggleOverview:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,OpenDocumentsMenu:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19,AddToGCal:20,OpenEmail:21,ComposeEmail:22,DriveUpload:23,OpenDisplaySettings:24,DragItem:25,OpenAddPaneMenu:26,SetPrefix:27,OpenCalendarsMenu:28,OpenHelp:29},u={OpenKeyboard:1,CloseKeyboard:2,PaneCalendar:3,PaneOutline:4,OpenAutocomplete:5,CloseAutocomplete:6,AtButton:7,OpenMultiselect:8,CloseMultiselect:9},d={AddPane:1,RemovePane:2,SwitchPaneMode:3,OpenSettingsMenu:4,AddBoard:5,OpenDisplaySettings:6};function c(){this.disabled=!1,this.allowOfflineUndo=!1,this.cursor=-1,this.groupID=0,this.groups=[],this.externalUndoRedo=!1,this.undoRedoActive=!1,this.canRedo=!1,this.canUndo=!1,this._performingActions=!1,this._currentAction=[],this._actionsPreventUndo=!1,this._aggregateActions=0,this._externalStateChanged=[],r.a.binder(this,"stateChangeForUndoRedo"),this.init()}function h(e){var t=e[0],a=o.a.getItem(t.oldItemID),n=i.default.focusedPane;i.default.Assert(a,"Expected model to exist: ",t),t.zoomIn?n.zoomOut(a,!0):t.zoomOut?n.zoomIn(a,!0):i.default.Assert(!1,"Zoom action must define either zoomIn or zoomOut")}function f(e){var t=e[0],a=o.a.getItem(t.itemID),n=i.default.focusedPane;i.default.Assert(a,"Expected model to exist: ",t),t.zoomIn?n.zoomOut(a,!0):t.zoomOut?n.zoomIn(a,!0):i.default.Assert(!1,"Zoom action must define either zoomIn or zoomOut")}function p(e){switch(e[0].type){case d.RemovePane:case d.SwitchPaneMode:break;default:i.default.Assert(!1,"Invalid UIAction")}}function g(e){}c.prototype={init:function(){this.listeners=[]},addListener:function(e){this.listeners.push(e)},removeListener:function(e){this.listeners.remove(e)},_getNextGroupID:function(){return this.groupID+1},_useNextGroupID:function(){return++this.groupID},_getCurrentGroup:function(){return this.groups[this.cursor]},_getCurrentAction:function(){return this.groups[this.cursor].events[this.groups[this.cursor].events.length-1]},_pushGroup:function(){var e=this._useNextGroupID();return this.groups.push({id:e,events:[],persisted:!1}),this.cursor<74&&this.cursor++,this.groups.length>75&&this._handleGroupTrimmed(this.groups.shift()),e},_doAction:function(e,t){var a=this._getCurrentGroup();i.default.Assert(a,"Expected group to exist");var n={type:e,data:t};switch(e){case s.Zoom:n.cb={undo:h,redo:f};break;case s.UIAction:n.cb={undo:p,redo:g}}a.events.push(n)},_handleGroupTrimmed:function(e){for(var t=0,a=0;a<e.events.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.events[a];switch(n.type){case s.Insert:case s.Remove:case s.Create:case s.Delete:case s.Move:case s.Update:case s.Format:case s.Zoom:case s.UIAction:break;default:i.default.Assert(!1,"Expected TrackerType, received: ",n.type)}}},_mergeAction:function(e,t){i.default.log("Tracker Action Merged: ",e,t);var a=this._getCurrentAction();switch(i.default.Assert(a,"Expected action to exist"),e){case s.Insert:case s.Remove:case s.Create:case s.Delete:case s.Move:case s.Update:break;case s.Format:i.default.Assert(!1,"Formats cannot be merged");break;case s.Zoom:i.default.Assert(!1,"Zooms cannot be merged");break;case s.UIAction:i.default.Assert(!1,"UIActions cannot be merged");break;default:i.default.Assert(!1,"Expected TrackerType, received: ",e)}},_canMerge:function(e){var t=!1,a=this._getCurrentGroup();return a&&a.events.length>0&&(a.events[a.events.length-1].type===e?e===s.Insert&&(t=!0):t=!1),t},_canCombine:function(e,t){var a=this._getCurrentGroup();return a&&(a.id===t||0===a.events.length)},performActions:function(e){if(i.default.Assert(!this.disabled||i.default.intro,"Can only perform actions when enabled or during the intro"),i.default.Assert(!this._performingActions,"Can not nest performing actions"),this._performingActions=!0,e&&e.length>0){var t,a=0;if(!this.disabled)this.cursor!==this.groups.length-1?(this.groups.splice(this.cursor+1,this.groups.length-(this.cursor+1)),t=this._pushGroup()):t=this._getNextGroupID();for(var n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n];this.fireActionEvent(r),this.disabled||(this._canCombine(r.type,t)?this._canMerge(r.type)?this._mergeAction(r.type,r.data):this._doAction(r.type,r.data):(t=this._pushGroup(),this._doAction(r.type,r.data)))}}this._performingActions=!1},beginAction:function(e){i.default.Assert(!this._performingActions,"Should never begin an action while replaying old actions"),0===this._aggregateActions?(this._actionsPreventUndo=!!e,i.default.Assert(0===this._currentAction.length,"Current actions should always be empty when starting a new action")):i.default.shouldLog(n.a.LogLevels.Tracker)&&i.default.log("  -- Beginning Nested Action --"),this._aggregateActions++},performAction:function(e,t){i.default.Assert(!this._performingActions,"Should never perform an action while replaying old actions");var a=!i.default.isLoaded||i.default.isLoadingRemote;this.disabled?i.default.intro?a?i.default.shouldLog(n.a.LogLevels.Tracker)&&i.default.log("Skipping Action For Intro: ",e,t):(i.default.shouldLog(n.a.LogLevels.Tracker)&&i.default.log("Performing Action For Intro: ",e,t),this.performActions([{type:e,data:[t]}])):i.default.shouldLog(n.a.LogLevels.Tracker)&&i.default.log("Performing Disabled Action: ",e,t):(i.default.shouldLog(n.a.LogLevels.Tracker)&&i.default.log("Performing Action: ",e,t),this._aggregateActions?this._currentAction.push({type:e,data:[t]}):this.performActions([{type:e,data:[t]}]))},endAction:function(){i.default.Assert(!this._performingActions,"Should never end an action while replaying old actions"),i.default.Assert(0!==this._aggregateActions,"Must have called beginAction before calling endAction"),1===this._aggregateActions?(this.disabled&&!i.default.intro||this.performActions(this._currentAction),this._currentAction.length=0,this._actionsPreventUndo=!1):i.default.shouldLog(n.a.LogLevels.Tracker)&&i.default.log("  -- Ending Nested Action --"),this._aggregateActions=Math.max(0,this._aggregateActions-1)},resetAggregateActionCount:function(){this._aggregateActions=0},notifyStateChangedFromUndoRedo:function(e,t){i.default.Assert(this.undoRedoActive),i.default.shouldLog(n.a.LogLevels.Tracker)&&i.default.log("Tracker notified of state change: ",t),this._externalStateChanged.push({type:e,data:t})},miscAction:function(e){this.fireActionEvent(e)},resetState:function(){this._performingActions=!1,this._externalStateChanged=[],this._currentAction=[],this.undoRedoActive=!1,this.cursor=-1,this.groupID=0,this.groups=[]},_getOrderedGroups:function(){return this.groups.slice(this.cursor).concat(this.groups.slice(0,this.cursor))},stringifyGroups:function(){return"Tracker: "+this._getOrderedGroups().length},stateChangeForUndoRedo:function(e){this.externalUndoRedo=!0,this.disabled=!0,this.canRedo=e.canRedo,this.canUndo=e.canUndo},fireActionEvent:function(e){try{if(e.data||(e.data={}),this.listeners)for(var t=0,a=0;a<this.listeners.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.listeners[a](e)}}catch(n){i.default.reportError(n)}}},t.e=new c},function(e,t,a){"use strict";var i=a(81),n=a(0);function r(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._value=t,this._listeners=a?[a]:void 0}var t,a,o;return t=e,(a=[{key:"get",value:function(){return this._value}},{key:"set",value:function(e,t){var a=this._value;return this._value=e,!1!==t&&this.notify(e,a,t),e}},{key:"onHasValue",value:function(e){if(void 0!==this._value)e(this._value);else var t,a=this.listen(function(i,n){void 0===i||t||(t=!0,e(i,n),setTimeout(function(){a.dispose()},0))})}},{key:"dbgObserve",value:function(){this.listen(function(e,t){n.default.log("Value: ",t,"->",e)})}},{key:"hasListeners",value:function(){return this._listeners&&this._listeners.length>0}},{key:"listen",value:function(e){return this._listeners||(this._listeners=[]),this._listeners.push(e),new i.a(this,e)}},{key:"unlisten",value:function(e){this._listeners&&this._listeners.remove(e)}},{key:"notify",value:function(e,t,a){0===arguments.length&&(e=this._value,t=this._value,a=!0);var i=this._listeners;if(i&&i.length>0&&(e!==t||!0===a)){var n=0;0;for(var r=0;r<i.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;!1===(0===arguments.length?i[r](this._value,void 0,a):i[r](e,t,a))&&(i.splice(r,1),r--)}0}}}])&&r(t.prototype,a),o&&r(t,o),e}();t.a=o},,,function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(2),o=a(27),s=a(4),l=a(51),u=a(13),d=a(57);function c(e){return(c="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==c(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,p(t).apply(this,arguments))}var a,c,m;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,u["a"]),a=t,(c=[{key:"init",value:function(){this.createObservables({isLoading:!1})}},{key:"getElement",value:function(){return l.findDOMNode(this)}},{key:"onClick",value:function(e){this.isLoading.get()||!1===this.props.enabled||(this.props.onClick||this.props.onMouseDown)(e,this.onButtonClickCallback)&&this.isLoading.set(!0)}},{key:"onMouseDown",value:function(e){if(!1!==this.props.enabled&&e.button===n.a.ButtonCode.Left&&this.props.onHold){var t={target:e.target,preventDefault:e.preventDefault};this._holdTimeout=setTimeout(this.onHold,150,t)}}},{key:"onMouseUp",value:function(e){this._clearHoldTimeout(),this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onHold",value:function(e){this._clearHoldTimeout(),this.props.onHold(e)}},{key:"_clearHoldTimeout",value:function(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)}},{key:"onKeyDown",value:function(e){e.keyCode===n.a.KeyCode.Enter&&this.onClick(e)}},{key:"focus",value:function(){this.getElement().focus()}},{key:"onButtonClickCallback",value:function(){this.isLoading.set(!1)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){var e,t=this.state,a=this.props,n=!1===a.enabled;a.color?e=a.color:a.primary?e=a.raised?"c-button-raised-primary":"c-button-primary":a.heavy?a.raised||(e="c-button-heavy"):e=a.cancel?a.raised?"c-button-raised-cancel":"c-button-cancel":a.raised?"c-button-raised":"c-button";var l={display:a.display,lineHeight:a.height?"auto"===a.height?null:a.height+"px":"36px",height:a.height,width:a.width,textAlign:"center",margin:a.margin,paddingLeft:a.paddingLeft,paddingTop:a.paddingTop,paddingRight:a.paddingRight,paddingBottom:a.paddingBottom,fontWeight:a.fontWeight,fontSize:a.fontSize,color:a.color};void 0===a.margin&&(l.marginLeft=a.marginLeft,l.marginTop=a.marginTop,l.marginRight=a.marginRight,l.marginBottom=a.marginBottom),l=i.default.extend(l,this.props.style),a.raised&&!a.children&&a.icon&&!1!==a.round&&(l.borderRadius="50%");var u,c={fontSize:a.fontSize};if(a.icon){var h={height:a.height,fontSize:a.iconSize},f=i.default.classNames("fancyButtonIcon",a.icon,{"c-button":!r.a.isMobile&&!!a.color});a.children?0!==a.padding&&(c.paddingLeft="6px",c.paddingRight=0,l.paddingLeft="16px",l.paddingRight="16px"):(l.width=a.width||36,l.height=a.height||36,l.maxWidth=a.height||36,l.maxHeight=a.height||36,l.textAlign="center"),u=s.createElement("i",{className:f,style:h})}isNaN(a.padding)||(c.padding="0 "+a.padding+"px");var p=a.children&&s.Children.count(a.children)>0,g=i.default.classNames("fancyButtonText"),m=p&&s.createElement("div",{className:g,style:c},a.children),v=i.default.classNames("fancyButton",e,{raised:a.raised},{loading:t.isLoading},{primary:a.primary},{cancel:a.cancel},{hasText:p},{hasIcon:!!a.icon},{disabled:n},{selected:a.selected},a.className),y=t.isLoading&&s.createElement("div",{className:"fancyButtonLoading"},s.createElement("i",{className:"icon-spinner"})),_=a.tooltipHotkey,b=_?i.default.isString(_)?_:o.a.printHotkeyByName(_.name,_.group):void 0;return s.createElement(d.a,{className:v,style:l,enabled:a.enabled,onMouseEnter:r.a.isMobile?void 0:a.onMouseEnter,onMouseLeave:r.a.isMobile?void 0:a.onMouseLeave,onMouseDown:!r.a.isMobile&&a.onMouseDown&&this.onClick||a.onHold&&this.onMouseDown||void 0,onMouseUp:r.a.isMobile||!a.onHold&&!a.onMouseUp?void 0:this.onMouseUp,onClick:a.onClick?this.onClick:void 0,onDoubleClick:a.onDoubleClick,onRightClick:a.onRightClick,onKeyDown:this.onKeyDown,id:a.id,center:a.center||!!a.icon&&!p,ripple:a.ripple,tabIndex:a.tabIndex,"data-tooltip":!n&&a.tooltip?a.tooltip:null,"data-tooltiphotkey":n?null:b},u,m,y)}}])&&h(a.prototype,c),m&&h(a,m),t}();t.a=m},function(e,t,a){"use strict";function i(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage={getItem:function(){console.log("refactor this")},setItem:function(){console.log("refactor this")}}}var t,a,n;return t=e,(a=[{key:"extendPrototype",value:function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e.prototype[a]=t[a])}},{key:"extendClass",value:function(e,t,a){for(var i=0,n=Object.getOwnPropertyNames(t.prototype),r=0;r<n.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=n[r];a&&e[o]||(e.prototype[o]=t.prototype[o])}}},{key:"defineBase",value:function(e){e.prototype.constructor=e}},{key:"extend",value:function(e,t,a,i){if(t)for(var n in t)if(t.hasOwnProperty(n)&&(!i||!e[n])){var r=t[n],o=a&&r&&r.bind?r.bind(e):r;e[n]=o}return e}},{key:"inherit",value:function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype}},{key:"binder",value:function(e){var t=0;for(var a=0;a<(arguments.length<=1?0:arguments.length-1);a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=a+1<1||arguments.length<=a+1?void 0:arguments[a+1];e[i]=e[i].bind(e)}}},{key:"forceBind",value:function(e,t){var a=t[e].bind(t);return t[e]=a,a}},{key:"destroy",value:function(e){}}])&&i(t.prototype,a),n&&i(t,n),e}();function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=a(1).a.URLPart,c={demo:d.Hash,login:d.Hash,user:d.Hash,premium:d.Hash,ispremium:d.Hash,access_token:d.Hash,error:d.Hash,expires_in:d.Hash,expires_at:d.Hash,issued_at:d.Hash,scope:d.Hash,token_type:d.Hash,id_token:d.Hash,data:d.Hash,script:d.Hash,dmode:d.Hash,jasmine:d.Hash,touch:d.Hash,noverify:d.Hash,file:d.Hash,sinfo:d.Hash,panes:d.Hash,offline:d.Hash,live:d.Hash,test:d.Hash,nolocal:d.Hash,nosync:d.Hash,rdebug:d.Hash,rsession:d.Hash,versionError:d.Hash,invite:d.Hash,state:d.Search,swupdate:d.Hash};function h(e,t){e===d.Search?window.location.search=t:e===d.Hash&&(window.location.hash=t)}function f(e){return e===d.Search?window.location.search:e===d.Hash?window.location.hash:void 0}function p(e){return c[e]}var g=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,l(t).call(this))}var i,r,c;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,n),i=t,(r=[{key:"hasURLParam",value:function(e,t){var i=e+"=";t&&(i+=t);var n=p(e);return n||a(0).default.log("Invalid URL Part"),f(n).indexOf(i)>=0}},{key:"getURLParam",value:function(e,t){var i=t||p(e);if(i===d.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp('[\\?&]" + key + "=([^&#]*)').exec(window.location.href);return null===n?void 0:decodeURIComponent(n[1].replace(/\+/g," "))}if(i!==d.Hash)a(0).default.log("Invalid URL part");else for(var r,o=0,s=f(d.Hash).substring(1),l=/([^&=]+)=([^&]*)/g;r=l.exec(s);){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(decodeURIComponent(r[1])===e)return decodeURIComponent(r[2])}}},{key:"insertURLParam",value:function(e,t,a){var i=0;e=encodeURIComponent(e),t=encodeURIComponent(t);for(var n=p(e),r=f(n).substr(1).split("&"),o=r.length-1;o>=0;o--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=r[o].split("=");if(s[0]==e){s[1]=t,r[o]=s.join("=");break}}o<0&&(r[r.length]=[e,t].join("=")),h(n,r.join("&")),n!==d.Hash||a||window.location.reload()}},{key:"removeURLParam",value:function(e,t){for(var a=0,i=p(e=encodeURIComponent(e)),n=f(i).substr(1).split("&"),r=n.length-1;r>=0;r--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(n[r].split("=")[0]==e){n.splice(r,1),h(i,n.join("&")),i!==d.Hash||t||window.location.reload();break}}}},{key:"genPromise",value:function(e){e.then=function(e,t,a){},e.execute=function(e,t,a){}}}])&&o(i.prototype,r),c&&o(i,c),t}();t.a=new g},function(e,t,a){"use strict";var i={};a.r(i),a.d(i,"load",function(){return ae}),a.d(i,"update",function(){return ie}),a.d(i,"_",function(){return ne});var n,r=a(0),o=a(1),s=a(3),l=a(2),u=a(7),d=a(18),c=a(22),h=a(11),f=a(41),p=a(16),g=a(34);function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function v(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=new(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dataCache={},this.itemCache={},this.documents=[],this.isLoaded=!1,this._demoId=1}var t,i,n;return t=e,(i=[{key:"init",value:function(e,t){var i=this,n=a(98).default,s=h.a.getURLParam("data"),l=s.split(","),u=[],d=0;this.loadDemoContacts(["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"]),n.areRemoteFunctionsHooked()||n.hookRemoteFunctions();var p=function(t,n){var r,o;if(n&&(r=n[0],o=n[1]),o&&a(72).default.setPluginData(o),r){!function e(t){t.id||(t.id="demo"+d++),i.dataCache[t.id]=t;var a=t.note;a&&(a.id||(a.id="demo"+d++),e(a),t.note=a.id);var n=t.items;if(n){for(var r=0,o=[],s=0;s<n.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=n[s];l.id||(l.id="demo"+d++),l.index=s,o.push(l.id),e(l)}t.items=o}}(r),i.isLoaded=!0;var s=new f.a({id:t,text:t,dateModified:Date.now(),rootData:r,acl:m({},c.a.getUid(),f.a.AccessRoles.Admin),backing:i});s.createVMLIs(),u.push(s),u.length===l.length&&(i.documents=u,e(u,i.dataCache))}};if(s&&l.length>0)l.forEach(function(e){n.loadRemoteData(e,p.bind(i,e))});else{r.default.Assert(!1,"Test data must be defined using #data=XXX.YYY in URL");var g={text:o.a.RootItemName,items:[]},v=new f.a({id:"Failed",text:"Failed",dateModified:Date.now(),rootData:g,acl:m({},c.a.getUid(),f.a.AccessRoles.Admin),backing:this});p("Failed",[v])}}},{key:"loadDemoContacts",value:function(e){var t=0,a=[],i=0;function n(e){var t="test-"+e.split(" ")[0].toLowerCase()+"@moo.do";a.push({id:"contact_"+i++,name:e,isDemo:!0,emails:[{address:t,primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}for(var r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n(e[r])}g.a.loadContacts(a)}},{key:"getItemData",value:function(e){return this.dataCache[e]}},{key:"saveItem",value:function(e,t,a,i,n){var r=this.dataCache[t.id]||{};return Object.assign(r,a),this.dataCache[t.id]=r,Promise.resolve()}},{key:"deleteItem",value:function(e,t,a){var i=t.parent();this.saveItem(e,i,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop),delete this.dataCache[t.id]}},{key:"addItem",value:function(e,t,a,i){this.saveItem(e,t,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop),this.saveItem(e,a,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop)}},{key:"moveItem",value:function(e,t){this.saveItem(e,t,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop)}},{key:"setNote",value:function(e,t,a,i,n){this.saveItem(e,t,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop),a?this.saveItem(e,a,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop):delete this.dataCache[a.id]}},{key:"addDocument",value:function(e){var t=e.getRootItem();return this.documents.push(e),this.saveItem(e,t,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop)}},{key:"saveDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){}},{key:"setBoard",value:function(e){}},{key:"deleteBoard",value:function(e){}},{key:"generateId",value:function(){return""+this._demoId++}}])&&v(t.prototype,i),n&&v(t,n),e}()).prototype,"generateId",[p.a],Object.getOwnPropertyDescriptor(n.prototype,"generateId"),n.prototype),n),_=a(31);var b=function(e,t,a){return Object.assign(a,function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({},e,t))},k={identity:function(e){return e},true:function(e){return!0},index:function(e,t){return t}},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.identity,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.true,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;return b(e(i,n),t(i,n),a)},S=function(e,t,a){return w(void 0,void 0,e,t,a)},I=function(e){return function(t,a,i){return w(function(e){return function(t){return function(e,t){return t?t[e]:void 0}(e,t)}}(e),k.identity,t,a,i)}},D=function(e,t,a){return"removed"===e||"added"===e?{type:e,value:a}:{type:e,value:t?function(e,t){var a={id:e.id},i=function(i){void 0===t[i]?a[i]=null:e[i]!==t[i]&&(a[i]=t[i])};return Object.keys(e).forEach(i),Object.keys(t).forEach(i),a}(t,a):a}},C=function(e,t){return{type:t,value:e}},P=function(e,t){return function(t){return[t].map((a=e,function(e){return D(e.type,a[e.value.id],e.value)}))[0];var a}},A=function(e,t){var a=t.value;return e=I("id")(e,a),"removed"===t.type&&delete e[a.id],e},M=function(e){return e.changes.map(function(e){return e.value})},T=function(e){var t=e.changes,a=e.prevStore;return t.map(P(a))},E=function(e){var t=e.changes,a=(e.type,e.prevStore,e.api);return a._store=t.reduce(A,a._store),a},L=function(e){var t=e.item,a=e.api,i=e.changeType,n=Object.assign({},a._store),r=C(t,i);E({changes:[r],prevStore:n,api:a})},x=function(e){return function(t,a){return L({item:a,api:t,changeType:e})}},O={load:function(e){var t=e.changes,a=e.api,i=e.prevStore;return E({api:a,type:"update",changes:t,prevStore:i})},normalizeChanges:T,addItem:x("added"),removeItem:x("removed"),modifyItem:x("modified")},R={load:function(e){var t=e.changes,a=e.api,i=e.prevStore;return E({changes:t,api:function(e){return e._store={},e}(a),prevStore:i})},normalizeChanges:M};function F(e){return function(e){if(Array.isArray(e)){for(var t=0,a=0,i=new Array(e.length);a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[a]=e[a]}return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var N=function(e,t,a){return e.push(t),a},B=function(e,t,a){var i=e.indexOf(t);return i>-1&&e.splice(i,1),a},U=function(e,t,a){var i=!0,n=!1,r=void 0;try{for(var o,s=0,l=function(){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var e=o.value;setTimeout(function(){return e.apply(void 0,F(t))},0)},u=e[Symbol.iterator]();!(i=(o=u.next()).done);i=!0)l()}catch(d){n=!0,r=d}finally{try{i||null==u.return||u.return()}finally{if(n)throw r}}return a},V=function(e){return function(t,a){return function(e,t,a){var i=Object.assign({},a._store),n=a._loadingState,r="load"===n?a._loader:a._updater,o="load"===n;o||(e=e.filter(function(e){var t=e.value;return"removed"===e.type||!i[t.id]||t.d!==i[t.id].d})),o&&(a._loadingState="update","load"===n&&a._earlyEdits.length&&(a._earlyEdits.forEach(function(e){U(a._callbacks.update,[e])}),a._earlyEdits=[]));if("update"===a._loadingState){if(o||e.length>0){a=r.load({api:a,changes:e,prevStore:i});var s=r.normalizeChanges({api:a,changes:e,prevStore:i});U(a._callbacks[n],[{responses:s},t]),U(a._callbacks["".concat(n,"Debug")],[{responses:s,changes:e,api:a},t])}}else a._earlyEdits.push({changes:e,api:a});return a}(t,a,e)}},j=function(e){var t=e.store,a=e.sort;return Object.values(t).map(function(e){return Object.assign({},e)}).sort(a)},H=function(e){var t=e.id,a=e.store;return a[t]?Object.assign({},a[t]):void 0},z=[],q=function(e){var t=e.db,a=e.config,i=e.ignore,n=void 0===i?z:i,r=e.backend,o=e.path,s=e.orderBy,l=e.startAt,u=e.extraModifiedPath,d={_config:a,_database:t,_store:{},_callbacks:{update:[],load:[],updateDebug:[],loadDebug:[]},_ignore:n.reduce(S,{}),_loadingState:"load",_earlyEdits:[],_backend:r.create({db:t,path:o,orderBy:s,startAt:l,extraModifiedPath:u}),_loader:R,_updater:O};return d._backend.onUpdate(V(d)),d.all=function(){return j({store:d._store})},d.allFn=function(e){return function(){return j({store:d._store,sort:e})}},d.get=function(e){return H({id:e,store:d._store})},d.getFromRemote=function(e){return d._backend.getFromRemote(e)},d.update=function(e){return function(e){var t=e.item,a=e.backend,i=e.api;console.assert(!!t,"item must exist");var n,r=(n=i._ignore,function(e){return function(e,t){if(!e)return e;var a={};for(var i in e)i in t||(a[i]=e[i]);return a}(e,n)})(t);return i._updater.modifyItem(i,r),a.update(r,function(e){return i._updater.modifyItem(i,e)})}({item:e,backend:d._backend,api:d})},d.getPathForItem=function(e){return function(e){var t=e.item,a=e.backend;e.api,e.batch;return a.getPathForItem(t)}({item:e,backend:d._backend,api:d})},d.remove=function(e){return function(e){var t=e.item,a=e.backend,i=e.api;return console.assert(!!t,"item must exist"),i._updater.removeItem(i,t),console.log("remove",t),a.remove(t)}({item:e,backend:d._backend,api:d})},d.onLoad=function(e){return N(d._callbacks.load,e)},d.offLoad=function(e){return B(d._callbacks.load,e)},d.onUpdate=function(e){return N(d._callbacks.update,e)},d.offUpdate=function(e){return B(d._callbacks.update,e)},d.onLoadDebug=function(e){return N(d._callbacks.loadDebug,e)},d.offLoadDebug=function(e){return B(d._callbacks.loadDebug,e)},d.onUpdateDebug=function(e){return N(d._callbacks.updateDebug,e)},d.offUpdateDebug=function(e){return B(d._callbacks.updateDebug,e)},d.setSent=function(e,t){return d._backend.setSent(e,t)},d},W=a(49),G=(a(235),W);function K(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Y,X=function(){function e(t){var a=t.path,i=t.orderBy,n=t.startAt,r=t.extraModifiedPath;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path=a,this.session=G.database(),this.orderBy=i,this.startAt=n,this.extraModifiedPath=r,this.itemsSent={}}var t,a,i;return t=e,(a=[{key:"update",value:function(e){var t=this,a={},i=(this.session.ref(),Object.assign({},e));delete i.id;var n=this.itemsSent[e.id];if(!n||this.areObjectsDifferent(n.value,i))return n?n.value=Object.assign(n.value||{},i):this.itemsSent[e.id]={value:i},r.default.isObject(i)?Object.keys(i).forEach(function(n){a["".concat(t.path,"/").concat(e.id,"/").concat(n)]=i[n]}):a["".concat(this.path,"/").concat(e.id)]=i,this.extraModifiedPath&&(a[this.extraModifiedPath]=G.database.ServerValue.TIMESTAMP),this.session.ref().update(a).then(function(a){var i=t.itemsSent[e.id].changes;i?t.cbOnUpdate(i,!1):t.itemsSent[e.id].isSaved=!0})}},{key:"getPathForItem",value:function(e){return"".concat(this.path,"/").concat(e.id,"/")}},{key:"remove",value:function(e){var t=this;return this.itemsSent[e.id]={type:o.a.CrudActions.Removed,id:e},this.session.ref("".concat(this.path,"/").concat(e.id)).remove().then(function(){console.log("finished delete",e);var a=t.itemsSent[e.id];if(!a.isDone){var i={type:o.a.CrudActions.Removed,value:{id:e.id}};a.isDone=!0,console.log("removeThen",a),t.cbOnUpdate([i],!1)}})}},{key:"toChangeInternal",value:function(e,t,a){return t.id=e,{type:a,value:t}}},{key:"isChangeRemote",value:function(e,t){var a=e.key,i=e.val(),n=this.itemsSent[a];return!n||(n.changes=t,this.areObjectsDifferent(i,n.value))}},{key:"areObjectsDifferent",value:function(e,t){return delete(e=Object.assign({},e)).d,delete(t=Object.assign({},t)).d,Object.keys(t).some(function(a){return e[a]!==t[a]})}},{key:"onUpdate",value:function(e){var t=this;this.cbOnUpdate=e;var a=!1,i=this.session.ref(this.path);this.orderBy&&this.startAt&&(i=i.orderByChild(this.orderBy).startAt(this.startAt)),i.once("value",function(i){if(!a){a=!0;var n=i.val(),r=Object.keys(n||{}).map(function(e){return t.toChangeInternal(e,n[e],"load")});e(r,!0)}},function(e){console.log("Firebase error",e)}),i.on("child_added",function(i){if(a){var n=[t.toChangeInternal(i.key,i.val(),"added")];if(t.isChangeRemote(i,n))e(n,!0);else t.itemsSent[i.key].isSaved&&e(n,!1)}},function(e){console.log("Firebase error",e)}),i.on("child_changed",function(i){if(a){var n=[t.toChangeInternal(i.key,i.val(),"modified")];if(t.isChangeRemote(i,n))console.log("child changed",i.val()),e(n,!0);else t.itemsSent[i.key].isSaved&&e(n,!1)}},function(e){console.log("Firebase error",e)}),i.on("child_removed",function(i){if(a){var n=[t.toChangeInternal(i.key,i.val(),"removed")],r=i.key,s=t.itemsSent[r];s&&s.type===o.a.CrudActions.Removed?s.isDone||(s.isDone=!0,e(n,!1)):e(n,!0)}},function(e){console.log("Firebase error",e)})}},{key:"setSent",value:function(e,t){this.itemsSent[e]={value:t}}}])&&K(t.prototype,a),i&&K(t,i),e}();function Q(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var Z=new(J((Y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,i;return t=e,(a=[{key:"init",value:function(){return this.session=G.database(),this}},{key:"create",value:function(e){return new X(e)}},{key:"onOnlineChange",value:function(e){this.session.ref(".info/connected").on("value",function(t){e(!0===t.val())})}},{key:"serverTime",value:function(){return G.database.ServerValue.TIMESTAMP}},{key:"generateId",value:function(){return G.database().ref().push().key}}])&&Q(t.prototype,a),i&&Q(t,i),e}()).prototype,"onOnlineChange",[p.a],Object.getOwnPropertyDescriptor(Y.prototype,"onOnlineChange"),Y.prototype),J(Y.prototype,"generateId",[p.a],Object.getOwnPropertyDescriptor(Y.prototype,"generateId"),Y.prototype),Y),$=function(e,t){return e[t.parent]||(e[t.parent]=[]),e[t.parent].push(t.id),e},ee=function(e,t){return e[t.parent]&&e[t.parent].includes(t.id)?e:$(e,t)},te=function(e,t,a){return"removed"!==t.type?e=a(e,t.value):e[t.value.parent]=(e[t.value.parent]||[]).filter(function(e){return e!==t.value.id}),e},ae=function(e,t){return te(e,t,$)},ie=function(e,t){return te(e,t,ee)},ne={loadInternal:te};var re=function(e,t,a){return a[e]-a[t]},oe=function(e){return function(t,a){return re(t,a,e)}};var se=function(e,t,a){return{type:e,value:a}},le=function(e,t){return{type:t,value:e}},ue=function(e,t,a){return function(t){return(a=e,function(e){return se(e.type,a[e.value.id],e.value)})(t);var a}},de=function(e,t,a){var i=t.value;return e=I("id")(e,i),"removed"===t.type&&delete e[i.id],e},ce=function(e){e.api;return e.changes.map(function(e){return e.value})},he=function(e){var t=e.api,a=e.changes,i=e.prevStore;t._localIdxs;return a.map(ue(i))},fe=function(e){var t=e.changes,a=e.type,n=void 0===a?"load":a,r=(e.prevStore,e.api);return r._children=t.reduce(i[n],r._children),r._store=t.reduce((r._localIdxs,function(e,t){return de(e,t)}),r._store),r},pe=function(e){var t=e.item,a=e.api,i=e.changeType,n=Object.assign({},a._store),r=le(t,i);fe({changes:[r],prevStore:n,api:a})},ge=function(e){return function(t,a){return pe({item:a,api:t,changeType:e})}},me={load:function(e){var t=e.changes,a=e.api,i=e.prevStore;return fe({api:a,type:"update",changes:t,prevStore:i})},normalizeChanges:he,addItem:ge("added"),removeItem:ge("removed"),modifyItem:ge("modified")},ve={load:function(e){var t=e.changes,a=e.api,i=e.prevStore;return fe({changes:t,api:function(e){return e._remoteIdxs={},e._children={},e._store={},e._localIdxs={},e._remoteIdxs={},e}(a),prevStore:i})},normalizeChanges:ce},ye=a(70),_e=function(e,t){var a=e.parent>t.parent,i=e.parent===t.parent,n=+e.parentIdx>+t.parentIdx,r=+e.parentIdx===+t.parentIdx,o=+e._index>+t._index;if(a)return-1;if(i){if(n)return-1;if(r&&o)return-1}return 1},be=function(e){e.add;var t=e._backend;t.generateID;return Object.assign(e,{_remoteIdxs:{},_localIdxs:{},_children:{},_loader:ve,_updater:me,all:function(){return e.allFn(_e)},put:function(t){return e.add(t)},allFromRemote:function(){return t.allFromRemote((a=e._remoteIdxs,Object.keys(a)));var a},childIds:function(t){return(e._children[t]||[]).sort(oe(e._remoteIdxs)).concat([])},getAt:function(t,a){return e.get(e.childIds(t)[a])}})};function ke(e){return(ke="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function we(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Se=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path=t,this.firebasePath=new X({path:t}),this.session=G.database(),this.dataCache={},this.isLoaded=!1,this.ignoreLocalChange=!1,this.itemsSent={},this.cbsOnUpdate={}}var t,a,i;return t=e,(a=[{key:"toChangeInternal",value:function(e,t,a){var i=e.ref.path.slice(3),n=e.val(),r={},o=r,s=this.dataCache;if("object"===ke(n)){for(var l=0,u=0;u<i.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=i[u];o[d]={},o=o[d],"removed"!==t&&(s[d]||(s[d]={}),s&&(s=s[d]))}Object.keys(n).forEach(function(e){o[e]=n[e],"removed"!==t?s[e]=n[e]:s&&delete s[e]})}else{var c=e.key;s[a]||(s[a]={}),s=s[a],"removed"!==t?s[c]=n:s&&delete s[c],r[c]=n}return{type:t,value:r}}},{key:"set",value:function(e,t){for(var a=0,i=this,n=e.split("/"),r=this.dataCache,o=n[n.length-1],s="".concat(this.path,"/").concat(e),l=0;l<n.length-1;l++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!r)return!1;n[l]&&(r[n[l]]||(r[n[l]]={}),r=r[n[l]])}r[o]=t;var u=this.session.ref(s);return this.itemsSent[e]={value:t},u.update(t).then(function(){var t=i.itemsSent[e].changes;return t?i.cbsOnUpdate[e[0]](t,!1):i.itemsSent[e].isSaved=!0,t})}},{key:"remove",value:function(e){var t=this.session.ref("".concat(this.path,"/").concat(e)).remove();return this.itemsSent[e]={type:o.a.CrudActions.Removed,id:e},t}},{key:"sendChangeCB",value:function(e,t,a){var i=e.ref.path;r.default.isString(i)&&(i=i.split("/"));var n=i.slice(2).join("/"),o=e.val(),s=this.itemsSent[n],l=!0;if(s){s.changes=t;var u=Object.assign({},o);delete u.d;var d=Object.assign({},s.value);delete d.d,l=Object.keys(d).some(function(e){return u[e]!==d[e]})}s&&!s.isSaved||a(t,l)}},{key:"onLoad",value:function(e){var t=this;this.session.ref(this.path).once("value",function(a){if(!t.isLoaded){t.isLoaded=!0;var i=a.val()||{};t.dataCache=i,e(i)}},function(e){console.log("Firebase error",e)})}},{key:"onUpdate",value:function(e,t){var a=this;this.cbsOnUpdate[e]=t;var i=this.path+"/"+e;this.session.ref(i).on("child_added",function(i){if(a.isLoaded){var n=a.toChangeInternal(i,"added",e);a.sendChangeCB(i,n,t)}},function(e){console.log("Firebase error",e)}),this.session.ref(i).on("child_changed",function(i){if(a.isLoaded){var n=a.toChangeInternal(i,"modified",e);a.sendChangeCB(i,n,t)}},function(e){console.log("Firebase error",e)}),this.session.ref(i).on("child_removed",function(i){if(a.isLoaded){var n=a.toChangeInternal(i,"removed",e);a.sendChangeCB(i,n,t)}},function(e){console.log("Firebase error",e)})}},{key:"offUpdate",value:function(e,t){var a=this.path+"/"+e;this.session.ref(a).off("child_added"),this.session.ref(a).off("child_changed"),this.session.ref(a).off("child_removed")}}])&&we(t.prototype,a),i&&we(t,i),e}();function Ie(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var De=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.db,a=e.docID,i=e.uid,n=e.userDocuments,r=t.session,o=new Se("documents/".concat(a)),s=[],l={onLoad:function(e){o.onLoad(function(t){e(t)})},onUpdate:function(e){s.push(e),o.onUpdate("p",e)},offUpdate:function(e){var t=s.indexOf(e);s.splice(t,1),o.offUpdate("p",e)},create:function(e,t){var o,s=Object.assign({},e),l={d:s.p.d,t:s.p.t};delete s.id;var u=(Ie(o={},"/documents/".concat(a),s),Ie(o,"/userdocuments/".concat(i,"/").concat(a),l),o);if(t)for(var d=0,c=0;c<t.length;c++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h=t[c],f=h.id;delete h.id,u["/items/".concat(a,"/").concat(f)]=h}return n.setSent(a,l),r.ref().update(u)},deleteFully:function(){var e;s.forEach(l.offUpdate),r.ref("/items/".concat(a)).off(),r.ref("/userdocuments/".concat(i,"/").concat(a)).off(),r.ref("/documents/".concat(a)).off();var t=(Ie(e={},"/items/".concat(a),null),Ie(e,"/userdocuments/".concat(i,"/").concat(a),null),Ie(e,"/documents/".concat(a),null),e);return r.ref().update(t)},update:function(e){var t=Object.assign({},e);delete t.id;var n=Ie({},"/documents/".concat(a),t);t.p.d&&(n["/userdocuments/".concat(i,"/").concat(a,"/d")]=t.p.d),t.p.t&&(n["/userdocuments/".concat(i,"/").concat(a,"/t")]=t.p.t),r.ref().update(n)}};return l};function Ce(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Pe(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ae,Me=function(){function e(t){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uid=t,this.session=G.database(),this.treeApi=new Se("users/".concat(t));var i={a:"AuthToken",b:"Board",p:"Property",s:"Setting"};Object.keys(i).forEach(function(e){var t=i[e];a["on"+t+"Update"]=a.treeApi.onUpdate.bind(a.treeApi,e),a["set"+t]=function(t,i){return a.treeApi.set(e+"/"+t,i)},a["remove"+t]=function(t,i){return a.treeApi.remove(e+"/"+t)}})}var t,a,i;return t=e,(a=[{key:"onLoad",value:function(e){this.treeApi.onLoad(function(t){e({properties:t.p,settings:t.s,authTokens:t.a,boards:t.b})})}},{key:"getPathForSettings",value:function(){return"users/".concat(this.uid,"/s/")}},{key:"deleteFully",value:function(e){var t,a=(Ce(t={},"/users/".concat(this.uid,"/a"),null),Ce(t,"/users/".concat(this.uid,"/b"),null),Ce(t,"/users/".concat(this.uid,"/s"),null),t);this.session.ref().update(a)}},{key:"setProperties",value:function(e){return this.session.ref("/users/".concat(this.uid,"/p")).update(e)}}])&&Pe(t.prototype,a),i&&Pe(t,i),e}(),Te=a(84),Ee=a(26),Le=a(37),xe=a(73),Oe=a(63);function Re(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fe(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var Ne,Be=new(Fe((Ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.documents={},this._isLoaded=!1,this.loadState=new u.a(o.a.LoadState.Connecting)}var t,a,i;return t=e,(a=[{key:"init",value:function(e,t,a){this.__DEBUG_FIX_REMOVED=!1,this._timeoutVerify=0,this._fixMismatches=!0,this._seenLocal={},this._coalescedChanges={},this._isLoaded=!1,this.cbOnLoad=e,this.cbOnLoadRemote=t,this.cbOnDocumentsChanged=a,d.a.init(this,this.onLoadLocal)}},{key:"onLoadLocal",value:function(e,t){var a=this,i=t.documentsPending,n=t.itemsPending,r=t.settingsPending,o=t.boardsPending;e||(e=[]),e.forEach(function(e){return a.documents[e.id]=e}),this.documentsPending=i,this.itemsPending=n,this.settingsPending=r,this.boardsPending=o,this.cbOnLoad(e),c.a.onAuthed(function(){a.createStore(e)})}},{key:"onLoadRemoteDocuments",value:function(){var e=this.documents;console.log("Got all docs",e),this._isLoaded=!0,s.default.settings.lastSync.set(Date.now()),this.cbOnDocumentsChanged(e),Le.a.ensureSelected()}},{key:"createStore",value:function(e){var t,a,i=this,n=function(e,t){Z.init(e);var a={firebase:e,session:e.database()},i={};i.user=new Me(t);var n={},r=q({db:a,backend:Z,path:"userdocuments/".concat(t)});return i.loadDocuments=function(e){r.onLoad(function(t){var a=t.responses;e(a)})},i.onDocumentsUpdate=function(e){r.onUpdate(e)},i.document=function(e,i,o){if(!(e in n)){var s=o||De({db:a,docID:e,uid:t,userDocuments:r}),l=be(q({db:a,backend:Z,path:"items/".concat(e),orderBy:"d",startAt:i?i+1:void 0,extraModifiedPath:"documents/".concat(e,"/p/d")}));n[e]={info:s,items:l}}return n[e]},i.addDocument=function(e,o){var s=e.id,l=n[s];if(!l){var u=De({db:a,docID:s,uid:t,userDocuments:r});return u.create(e,o).then(function(){return i.document(s,void 0,u)})}return Promise.resolve(l)},i.forgetDocument=function(e){var t=n[e];return delete n[e],t._callbacks={update:[],load:[],updateDebug:[],loadDebug:[]},!0},i.commitBatch=function(e){return a.session.ref().update(e)},i.onOnlineChange=Z.onOnlineChange,i.serverTime=Z.serverTime(),i.generateId=Z.generateId,i}(G,c.a.getUid());this.api=n;var u=function(){t&&a&&Promise.all(Object.keys(i.documentsPending).map(function(e){var t=i.documents[e];return a.indexOfWithProperty("id",t.id)<0?i.addDocument(t,!1):Promise.resolve()})).then(function(){i.documentsPending={},Promise.all(a.map(function(e){return i.loadDocumentData(e)})).then(function(e){e=e.filter(function(e){return!!e}),i.onLoadRemoteDocuments(),i.cbOnLoadRemote(),i.loadState.set(o.a.LoadState.Connected)})})};n.user.onLoad(function(e){var a=s.default.settings.getSettingAbbrev("userEncryptionSentinel"),n=e.settings;e.properties?i.userProperties=_.a.userIn(e.properties):i.onFirstSync(),i.checkUserEncryption(n&&n[a]&&n[a].v,function(){i.loadState.set(o.a.LoadState.LoadingDocs),d.a.saveUser(e.properties),n&&i.onSettingsChange(o.a.CrudActions.Modified,n,!0),i.settingsPending&&Object.keys(i.settingsPending).forEach(function(e){var t=s.default.settings.getValueFromAbbrev(e);void 0!==t&&i._setSettingRemote(e,t)});var a=e.boards;a?i.onBoardsChange(o.a.CrudActions.Modified,a,!0):console.log("why no boards?"),!l.a.mobile&&i.boardsPending&&Object.keys(i.boardsPending).forEach(function(e){var t=Le.a.getBoardSaveInfo(e);r.default.Assert(t,"Pending board that does not exist"),t&&i._setBoardRemote(t)}),t=!0;var c=e.authTokens;i.onAuthTokensChange(c,!0),u()})}),n.user.onPropertyUpdate(function(e,t){var a=e.type,i=e.value;console.log(a,i,t)}),n.user.onSettingUpdate(function(e,t){var a=e.type,n=e.value;console.log(a,n,t),i.onSettingsChange(a,n,t)}),n.user.onBoardUpdate(function(e,t){var a=e.type,n=e.value;i.onBoardsChange(a,n,t)}),n.user.onAuthTokenUpdate(function(e,t){e.type;var a=e.value;i.onAuthTokensChange(a,t)}),n.loadDocuments(function(e){a=e,u()}),n.onDocumentsUpdate(function(e,t){var a=e.responses;Promise.all(a.map(function(e){var t=e.type,a=e.value;t===o.a.CrudActions.Removed?(We.deleteDocument(i.documents[a.id],!0),delete i.documents[a.id]):i.loadDocumentData(a)})).then(function(){i.cbOnDocumentsChanged(i.documents)})}),n.onOnlineChange(function(e){i.updateOnlineStatus(e)}),this._isLoaded||(this._isLoaded=!0),this._runCoalescedChanges()}},{key:"onFirstSync",value:function(){var e=this,t=function(t){e.userProperties=t;var a={email:t.email,fname:t.given_name,lname:t.family_name,picture:t.picture,displayName:t.name};Oe.a.setUserProperties(_.a.userOut(a))};c.a.userProfile?t(c.a.userProfile):Ee.a.getGoogleUserInfo(function(e){t({email:c.a.user.email,fname:e.given_name,lname:e.family_name,picture:e.picture,displayName:c.a.user.displayName})})}},{key:"loadDocumentData",value:function(e){var t,a=this,i=this.documents[e.id];return i&&(t=i.dateModified.get()),new Promise(function(n){var o=a.api.document(e.id,t);Promise.all([new Promise(function(t){var i=o.info;i.onLoad(function(a){a.id=e.id;var i=_.a.documentIn(a);t(i)}),i.onUpdate(a.onDocInfoChange.bind(a,e))}),new Promise(function(t){var i=o.items;i.onLoad(function(e){var a=e.responses;t(a)}),i.onUpdate(a.onItemsChange.bind(a,e))})]).then(function(e){var t=e[0],n=e[1];return Promise.all(n.map(function(e){return _.a.decryptItemIn(e,s.default.crypto,a.getBestEncryptionOut(t))})).then(function(e){return xe.a.createItemHierarchy(e,d.a.getItemsMap()),i&&a.resolveItemConflicts(i,e),{docProps:t,docItems:e}})}).then(function(e){var t,o=e.docProps,s=e.docItems;if(Object.keys(a.itemsPending).forEach(function(e){var t=d.a.getItemData(e),n=We.getItem(e),o=a.itemsPending[e];if(r.default.Assert(n||t.isDeleted,"Pending update that has no parent"),t.isDeleted)a._deleteItemRemote(i,t.id);else if(n&&!r.default.isEmpty(o)){var s={id:e};Object.keys(o).forEach(function(e){s[e]=t[e]}),a._saveItemRemote(i,s)}}),d.a.ensureMirror(s,!1),i)a.documentsPending[i.id]?(a._saveDocumentRemote(i,i.getSaveInfo()),delete a.documentsPending[i.id]):(d.a.saveDocument(o),i.onRemoteUpdate(o)),t=i;else if(o.root){d.a.saveDocument(o),o.backing=a;var l=r.default.clone(o);l.rootData=a.getItemData(o.root),l.rootData&&((i=a.documents[o.id]=f.a.fromData(l,a)).createVMLIs(),t=i)}t||console.log("Failed to find root item"),n(t)}).catch(function(e){console.log(e)})})}},{key:"getItemData",value:function(e){var t=this._coalescedChanges[e],a=d.a.getItemData(e,!0);return t&&t.type!==o.a.CrudActions.Removed&&(a=Object.assign({},a,t.info)),a}},{key:"getItemSaveData",value:function(e){return e.getFullSaveData()}},{key:"importItem",value:function(e){var t=this,a=e.getDocumentOwner();e.parent();this._saveItem(a,e,this.getItemSaveData(e)),e.hasNote()&&this.importItem(e.getNote()),e.getItems().forEach(function(e,a){e.index=a,t.importItem(e)}),this._seenLocal[e.id]=!0}},{key:"onSettingsChange",value:function(e,t,a){var i=this;Object.keys(t).forEach(function(n){var r=t[n];a&&i.settingsPending[n]?delete t[n]:(delete i.settingsPending[n],r.v=e===o.a.CrudActions.Removed?void 0:i.decodeValue(r.v))}),e===o.a.CrudActions.Removed?d.a.deleteSettings(t):d.a.saveSettings(t),s.default.settings.load(t)}},{key:"onBoardsChange",value:function(e,t,a){var i=this;Object.keys(t).forEach(function(n){if(!a||!i.boardsPending[n]){delete i.boardsPending[n],t[n].id=n,e===o.a.CrudActions.Removed?d.a.deleteBoard(n):d.a.setBoard(t[n]);var r=t[n];Le.a.onRemoteUpdate(e,r)}})}},{key:"onAuthTokensChange",value:function(e,t){if(e){var a={};Object.keys(e).forEach(function(t){var i=t.replace(/,/g,"."),n=e[t],s=n.s?n.s.split(" "):void 0,l={email:i,scopes:s?s.map(function(e){return o.a.GScopeArray[e]}):void 0};r.default.Assert("Have an auth token without scopes"),a[i]=l}),Ee.a.loadWithTokens(a)}}},{key:"onDocInfoChange",value:function(e,t,a){var i=t.type,n=t.value;if(i!==o.a.CrudActions.Removed){if(n){var r=n.t,l=n.d,u=this.documents[e.id],d={text:r,date:l},c=s.default.settings.lastSync;u&&((!c.get()||l>c.get())&&c.set(l),u.onRemoteUpdate(d))}}else 0}},{key:"onItemsChange",value:function(e,t,a){var i=this,n=t.responses,r=[];return Promise.all(n.map(function(t){return _.a.decryptItemIn(t.value,s.default.crypto,i.getBestEncryptionOut(e)).then(function(e){return{type:t.type,value:e}})})).then(function(t){var n=0;a&&s.default.PaneUpdateBatcher.beginUpdateItems();for(var l=0,u=0;u<t.length;u++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=t[u],h=c.type,f=c.value,p=f,g=d.a.getItemData(f.id);f.isDeleted?h=o.a.CrudActions.Removed:h===o.a.CrudActions.Added&&g&&(h=o.a.CrudActions.Modified),h===o.a.CrudActions.Removed&&d.a.deleteItem(f.id),l=Math.max(f.dateModified),delete i.itemsPending[f.id],a&&(p=i.handleRemoteItemChange(i.documents[e.id],h,f.id,f)),h===o.a.CrudActions.Removed?d.a.deleteItem(f.id):r.push(p)}a&&s.default.PaneUpdateBatcher.commitUpdateItems(),d.a.ensureMirror(r);var m=i.documents[e.id];if(m){m.updateModified(l);var v=m.getSaveInfo();d.a.saveDocument(v)}else 0})}},{key:"convertItemUndefineds",value:function(e,t){var a=this,i=this.getItemData(e.id);return Object.keys(t).forEach(function(n){void 0===t[n]&&(void 0===i[n]?delete t[n]:t[n]=a.getAPIForItem(e).props.remove)}),t}},{key:"_coalesceChange",value:function(e,t,a,i){var n=this._coalescedChanges[t.id],s=!n;i.id||(i.id=t.id),n&&(r.default.Assert(n.type!==o.a.CrudActions.Removed,"Should not be modifying an item that was deleted"),r.default.Assert(a!==o.a.CrudActions.Added,"Cannot be existing change on item if adding it"),a===o.a.CrudActions.Modified?n.type===o.a.CrudActions.Modified?n.info=Object.assign(n.info,i):(n.type,o.a.CrudActions.Added):a===o.a.CrudActions.Removed&&(n.type===o.a.CrudActions.Added?delete this._coalescedChanges[t.id]:s=!0)),s&&(n=this._coalescedChanges[t.id]={id:t.id,time:Date.now(),doc:e,type:a,info:i}),this._runCoalescedChanges()}},{key:"_runCoalescedChanges",value:function(){var e=this;if(this._isLoaded){var t=Object.values(this._coalescedChanges);if(t.length>0)t.sort(function(e,t){return e.time-t.time}).forEach(function(t){var a=t.info,i=t.doc,n=We.getItem(t.id);t.type===o.a.CrudActions.Added?e.importItem(n):t.type===o.a.CrudActions.Modified?n.isNote()?e.importItem(n):r.default.isEmpty(a)||e._saveItem(i,n,a):t.type===o.a.CrudActions.Removed&&e._deleteItem(i,n)}),this._coalescedChanges={}}}},{key:"saveItem",value:function(e,t,a,i,n){r.default.isLocalChange(i)&&!r.default.isUndoRedoChange(i)&&this._coalesceChange(e,t,o.a.CrudActions.Modified,a)}},{key:"addItem",value:function(e,t,a,i){var n=this.getItemSaveData(a);this._coalesceChange(e,a,o.a.CrudActions.Added,n)}},{key:"deleteItem",value:function(e,t,a){this._coalesceChange(e,t,o.a.CrudActions.Removed,t)}},{key:"setNote",value:function(e,t,a,i,n){if(r.default.isLocalChange(n))if(a){var s=this.getItemSaveData(a);this._coalesceChange(e,a,o.a.CrudActions.Modified,s)}else i&&this._coalesceChange(e,i,o.a.CrudActions.Removed,i)}},{key:"moveItem",value:function(e,t){var a=t.parent(),i=t.index;this._coalesceChange(e,t,o.a.CrudActions.Modified,{parent:a,index:i})}},{key:"_saveItem",value:function(e,t,a){a.parent&&r.default.isVMLI(a.parent)&&(a.parent=a.parent.id);var i=r.default.extend({id:t.id},this.convertItemUndefineds(t,a)),n=d.a.getItemData(t.id),o=n.pendingSync||{};Object.keys(a).forEach(function(e){"id"!==e&&"dateModified"!==e&&void 0===o[e]&&(o[e]=n[e])});var s=Object.assign({pendingSync:o},i);this.itemsPending[t.id]=!0,d.a.saveItem(t,s),this._saveItemRemote(e,i)}},{key:"_saveItemRemote",value:function(e,t){var a=this;t.dateModified=this.api.serverTime,delete t.pendingSync,delete t.docId,_.a.encryptItemOut(t,s.default.crypto,this.getBestEncryptionOut(e)).then(function(t){_.a.validateOutFields(t,!0)&&a.getAPIForDocumentItems(e).update(t)})}},{key:"_deleteItem",value:function(e,t){this.getItemData(t.id)?(this.itemsPending[t.id]=!0,d.a.saveItem(t,{id:t.id,isDeleted:!0,pendingSync:{isDeleted:!1}}),this._deleteItemRemote(e,t.id)):console.log("Remove Error: Item did not exist",t.getParsedText())}},{key:"_deleteItemRemote",value:function(e,t){this._saveItemRemote(e,{id:t,isDeleted:!0})}},{key:"generateId",value:function(){return G.database().ref().push().key}},{key:"addDocument",value:function(e,t){var a=this,i=e.getSaveInfo(),n=e.getRootItem(),r=this.getItemSaveDataRecursive(n);!1!==t&&(this.documents[e.id]=e,d.a.saveDocument(i),d.a.ensureMirror(r));var o=_.a.documentOut(i);return Promise.all(r.map(function(t){return _.a.encryptItemOut(t,s.default.crypto,a.getBestEncryptionOut(e))})).then(function(e){a.api.addDocument(o,e).then(function(e){e.items.onUpdate(a.onItemsChange.bind(a,i)),e.info.onUpdate(a.onDocInfoChange.bind(a,i))})})}},{key:"saveDocument",value:function(e){var t=e.getSaveInfo(),a=Object.assign({pendingSync:Date.now()},t);this.documentsPending[e.id]=!0,d.a.saveDocument(a),this._saveDocumentRemote(e,t)}},{key:"_saveDocumentRemote",value:function(e,t){t||(t=e.getSaveInfo());var a=_.a.documentOut(t);_.a.validateOutFields(a,!0)&&this.getAPIForDocument(e).update(a)}},{key:"getItemSaveDataRecursive",value:function(e,t){var a=this,i=!t;return t||(t=[]),t.push(e),e.hasNote()&&t.push(e.getNote()),e.hasChildren()&&e.getItems().forEach(function(e){a.getItemSaveDataRecursive(e,t)}),i&&(t=t.map(function(e){return a.getItemSaveData(e)})),t}},{key:"encodeValue",value:function(e){return r.default.isObject(e)||r.default.isArray(e)?JSON.stringify(e):e}},{key:"decodeValue",value:function(e){if("{"===e[0]||"["===e[0])try{e=JSON.parse(e)}catch(t){}return e}},{key:"getSetting",value:function(e){return d.a.getSetting(e)}},{key:"setSetting",value:function(e,t){var a=Date.now();d.a.setSetting(e,{pendingSync:a,v:t}),t=this._setSettingRemote(e,t)}},{key:"_setSettingRemote",value:function(e,t){if(this.api)if(void 0===t||null===t)this.api.user.removeSetting(e);else{var a={v:t=this.encodeValue(t),d:this.api.serverTime};this.api.user.setSetting(e,a)}return t}},{key:"setBoard",value:function(e){var t=Date.now(),a=Object.assign({pendingSync:t},e);d.a.setBoard(a),this._setBoardRemote(e)}},{key:"_setBoardRemote",value:function(e){if(this.api){var t=r.default.cloneDeep(e);delete t.id,delete t.pendingSync,t.d=this.api.serverTime,this.boardsPending[e.id]=!0,this.api.user.setBoard(e.id,t)}}},{key:"deleteBoard",value:function(e){this.api&&this.api.user.removeBoard(e)}},{key:"getAPIForDocument",value:function(e){return this.api.document(e.id).info}},{key:"getAPIForDocumentItems",value:function(e){return this.api.document(e.id).items}},{key:"getAPIForItem",value:function(e){return this.getAPIForDocumentItems(e.getDocumentOwner())}},{key:"clearAllData",value:function(){var e=this;return Promise.all(Object.keys(this.documents).map(function(t){return e.getAPIForDocument({id:t}).deleteFully()})).then(function(){e.api.user.deleteFully()})}},{key:"deleteDocument",value:function(e){this.getAPIForDocument(e).deleteFully()}},{key:"updateOnlineStatus",value:function(e){var t=We.onlineStatus,a=t.get();e||a!==o.a.OnlineStatus.Connecting?(r.default.clearTimeoutOnce("initialOffline"),t.set(e?o.a.OnlineStatus.Online:o.a.OnlineStatus.Offline)):l.a.isPlatformOnline()?r.default.timeoutOnce("initialOffline",function(){return t.set(o.a.OnlineStatus.Offline)},2e3):t.set(o.a.OnlineStatus.Offline)}},{key:"resolveItemConflicts",value:function(e,t){var a=this;s.default.PaneUpdateBatcher.beginUpdateItems(),t.forEach(function(t){var i=a.itemsPending[t.id],n=We.getItem(t.id),s=a.getItemData(t.id);i&&Object.keys(i).forEach(function(e){var a=s[e],r=t[e];if(r===i[e]||r===a)a===r&&delete i[e],delete t[e];else if("text"===e){var o="Sync Conflict: 1 = ".concat(r,"  ;  2 = ").concat(a);t[e]=o,d.a.saveItem(n,{text:o})}else delete t[e]});var l=t.id;r.default.isEmpty(t)||a.handleRemoteItemChange(e,o.a.CrudActions.Modified,l,t)}),s.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"handleRemoteItemChange",value:function(e,t,a,i){var n,r,s=this.getItemData(a);return i.isDeleted&&(t=o.a.CrudActions.Removed),t===o.a.CrudActions.Modified&&s?(r={id:a},Object.keys(i).forEach(function(e){s[e]!==i[e]&&("dateModified"!==e&&"id"!==e&&(n=!0),r[e]=i[e])}),Object.keys(s).forEach(function(e){"items"!==e&&e in i&&void 0!==s[e]&&void 0===i[e]&&(r[e]=void 0,n=!0)})):(n=!0,r=i),n&&Te.a.onRemoteChange(e,t,a,r),r}},{key:"getBestEncryptionOut",value:function(e){return s.default.settings.getBestUserEncryption()}},{key:"_getItemWithText",value:function(e){return{id:e.id,text:e.getRawText()}}},{key:"checkUserEncryption",value:function(e,t){var a=this;if(e){var i=function(){a.loadState.set(o.a.LoadState.NeedPassword),s.default.menus.openModal(o.a.Modals.EnterCode,{text:"Please enter your encryption password to unlock your data.",onSelect:function(a){return new Promise(function(i,n){a&&s.default.crypto.createKey({name:o.a.EncryptionKeys.UserPassword,password:a}).then(function(a){s.default.crypto.decryptText(a.key,e,c.a.getUid()).then(function(e){e===o.a.EncryptionSentinel?(console.log("Correct password"),s.default.settings.addEncryptionKey(o.a.EncryptionKeys.UserPassword,a.key),i(),t()):n("The password was invalid. Please try again.")})})})}})},n=s.default.settings.getEncryptionKey(o.a.EncryptionKeys.UserPassword);n?s.default.crypto.decryptText(n,e,c.a.getUid()).then(function(e){e===o.a.EncryptionSentinel?(console.log("Already has password"),t()):i()}):i()}else console.log("No user password"),t()}},{key:"updateUserEncryption",value:function(e){var t=this,a={},i=s.default.settings.encryptionKeys.get()||{},n=i[e.name];return i[e.name]=e.key,s.default.crypto.encryptText(e.key,o.a.EncryptionSentinel,c.a.getUid()).then(function(e){var i=s.default.settings.getSettingAbbrev("userEncryptionSentinel");a[t.api.user.getPathForSettings()+i]={v:e}}).then(function(){return Promise.all(Object.keys(t.documents).map(function(i){var n=t.documents[i],r=t.getAPIForDocumentItems(n);return Promise.all(n.getAllItems().map(function(t){var i={id:t.id,text:t.getRawText()};return new Promise(function(t){_.a.encryptItemOut(i,s.default.crypto,e.key).then(function(e){if(_.a.validateOutFields(e,!0)){var i=r.getPathForItem(e,a);a[i+"t"]=e.t,t()}})})}))})).then(function(){return s.default.settings.encryptionKeys.set(i),console.log(a),t.api.commitBatch(a).catch(function(){i[e.name]=n,s.default.settings.encryptionKeys.set(i)})})})}}])&&Re(t.prototype,a),i&&Re(t,i),e}()).prototype,"onLoadLocal",[p.a],Object.getOwnPropertyDescriptor(Ae.prototype,"onLoadLocal"),Ae.prototype),Fe(Ae.prototype,"onLoadRemoteDocuments",[p.a],Object.getOwnPropertyDescriptor(Ae.prototype,"onLoadRemoteDocuments"),Ae.prototype),Fe(Ae.prototype,"clearAllData",[p.a],Object.getOwnPropertyDescriptor(Ae.prototype,"clearAllData"),Ae.prototype),Ae),Ue=a(68),Ve=a(32),je=a(24);function He(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ze(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var qe=(ze((Ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isLoaded=new u.a(!1),this._isRemoteEnabled=!r.default.isDemoMode(),this._documentsById={},this._itemCache={},this.documentsArray=new je.a,this._sources=r.default.isDemoMode()?[y]:[Be],this._idProvider=r.default.isDemoMode()?y.generateId:Be.generateId,this.settingProvider=Be,this.loadState=Be.loadState,this.onlineStatus=new u.a(l.a.isPlatformOnline()?o.a.OnlineStatus.Connecting:o.a.OnlineStatus.Offline)}var t,a,i;return t=e,(a=[{key:"init",value:function(){this._emptyDocument=this.createEmptyDocument("Empty"),window.__clearAllData=function(){confirm("Are you sure you want to clear everything?")&&(Le.a.clear(),Promise.all([d.a.clearAllData(),Be.clearAllData()]).then(function(){r.default.reload()}))},window.__clearLocalData=function(){Le.a.clear(),d.a.clearAllData().then(function(){r.default.reload()})},window.__clearFirebase=function(){Be.clearAllData().then(function(){r.default.reload()})}}},{key:"loadLocal",value:function(e){var t=this;this._emptyDocument.createVMLIs(),this._cbOnLoad=e,this._sourcesWaiting=this._sources.length,this._sources.forEach(function(e){return e.init(t.onSourceLoaded,t.onLoadRemote,t.onSourceDocumentsChanged)}),this._isRemoteEnabled&&Ue.a.init()}},{key:"onSourceLoaded",value:function(e){var t=this;this._sourcesWaiting--,e.forEach(function(e){t._documentsById[e.id]=e,t.documentsArray.push(e,!1)}),0===this._sourcesWaiting&&(this.documentsArray.sort(f.a.comparatorModified),s.default.PaneManager.loadInitialState(),this.isLoaded.set(!0),this._cbOnLoad(e))}},{key:"onLoadRemote",value:function(){}},{key:"onSourceDocumentsChanged",value:function(e){var t=this,a=this.documentsArray.get();Object.keys(e).forEach(function(i){var n=e[i];t._documentsById[n.id]||(t._documentsById[n.id]=n,a.push(n))}),a.sort(f.a.comparatorModified),this.documentsArray.set(a)}},{key:"getDefaultBacking",value:function(){return this._sources[0]}},{key:"getDocumentById",value:function(e){return this._documentsById[e]}},{key:"getDefaultDocument",value:function(){return this.documentsArray.get().length>0?this.documentsArray.get()[0]:this.addEmptyDocument("My First Document",!1)}},{key:"getDocumentsArray",value:function(){return this.documentsArray.get()}},{key:"hasDocuments",value:function(){return this.documentsArray.get()}},{key:"runOnAllDocuments",value:function(e){this.documentsArray.get().forEach(function(t){return e(t)})}},{key:"runOnAllDocumentRoots",value:function(e){this.documentsArray.get().forEach(function(t){return e(t.getRootItem())})}},{key:"getItemDataLocal",value:function(e,t){return e.getBacking().getItemData(t)}},{key:"getDocumentBacking",value:function(e){return e.getBacking()}},{key:"getItemBacking",value:function(e){var t=e.getDocumentOwner();return r.default.Assert(t,"Item document must exist"),t.getBacking()}},{key:"_getPreviousState",value:function(e,t){var a=e.getDocumentOwner().getBacking().getItemData(e.id),i={};return Object.keys(t).forEach(function(e){i[e]=a[e]}),i}},{key:"saveItem",value:function(e,t,a,i,n){var o=e.parent()||"Root"===e.getRawText();if(r.default.Assert(o,"Item must have parent unless root"),o){if(t=this._transformChange(e,t),r.default.isLocalChange(a)&&Ve.a.pushModified(e,t,this._getPreviousState(e,t)),e.shouldSave()){var s=e.getDocumentOwner();s.getBacking().saveItem(s,e,r.default.clone(t),a,i)}r.default.isDemoMode()||Ue.a.onDataSaved()}}},{key:"saveItemRemote",value:function(e,t){var a=e.getDocumentOwner();a.getBacking().saveItem(a,e,t,o.a.ChangeType.Local,o.a.SaveFlag.Prop)}},{key:"saveItemLocal",value:function(e,t,a){t||(t=e.getFullSaveData()),d.a.saveItem(e,t)}},{key:"_transformChange",value:function(e,t){return t.dateModified=Date.now(),t.id=e.id,t}},{key:"updateItemIndex",value:function(e){var t=e.parent();if(!e.isNote())if(t.items.length()>1){var a=t.items.get(),i=a.indexOf(e),n=!e.isNote()&&i>0?a[i-1]:null,r=!e.isNote()&&i<a.length-1?a[i+1]:null;0,e.index=Object(ye.a)([n?n.index:null,r?r.index:null])}else e.index=0}},{key:"addItem",value:function(e,t,a){if(!(arguments.length>3&&void 0!==arguments[3]&&arguments[3])){this.updateItemIndex(t),Ve.a.pushAdded(e,t,a);var i=t.getDocumentOwner();i.getBacking().addItem(i,e,t,a)}}},{key:"deleteItem",value:function(e,t,a,i,n){if(r.default.isLocalChange(i)){Ve.a.pushRemoved(e,t,a);var o=t.getDocumentOwner();o.getBacking().deleteItem(o,t,i)}}},{key:"deleteItemLocal",value:function(e,t){}},{key:"moveItem",value:function(e,t,a,i){if(this.updateItemIndex(e),r.default.isLocalChange(i)){var n={parent:e.parent().id,index:e.index},o={parent:t.id,index:a};Ve.a.pushModified(e,n,o);var s=e.getDocumentOwner();s.getBacking().moveItem(s,e)}}},{key:"attachEventsToItem",value:function(e){}},{key:"setNote",value:function(e,t,a,i){var n=e.getDocumentOwner();n.getBacking().setNote(n,e,t,a,i)}},{key:"generateID",value:function(){return this._idProvider()}},{key:"getEmptyDocument",value:function(){return this._emptyDocument}},{key:"addDocument",value:function(e,t){e.createVMLIs();var a=t?Promise.resolve():this._sources[0].addDocument(e);return this._documentsById[e.id]=e,this.documentsArray.push(e,!1),this.documentsArray.sort(f.a.comparatorModified),a}},{key:"createEmptyDocument",value:function(e){var t,a,i,n=this.getDefaultBacking(),r=this.generateID(),o={id:this.generateID(),isRoot:!0,text:"Root",items:[]};return new f.a({id:r,text:e,dateModified:Date.now(),rootData:o,acl:(t={},a=c.a.getUid(),i=f.a.AccessRoles.Admin,a in t?Object.defineProperty(t,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[a]=i,t),backing:n})}},{key:"addEmptyDocument",value:function(e,t,a){var i=this.createEmptyDocument(e);return i.needsSave=!0,this.addDocument(i,t).then(function(){return a&&a()}),i}},{key:"saveDocument",value:function(e){e.getBacking().saveDocument(e)}},{key:"renameDocument",value:function(e,t){e.setText(t),e.needsSave?(e.needsSave=!1,this._sources[0].addDocument(e)):this.saveDocument(e)}},{key:"getSetting",value:function(e,t){return d.a.getSetting(t+"\\"+e)}},{key:"setSetting",value:function(e,t,a){if(a)return this.settingProvider.setSetting(e,t);d.a.setSetting(e,{v:t})}},{key:"setBoard",value:function(e){this.settingProvider.setBoard(e)}},{key:"deleteBoard",value:function(e){return d.a.deleteBoard(e),this.settingProvider.deleteBoard(e)}},{key:"getBoards",value:function(){return d.a.getBoards()}},{key:"setItem",value:function(e){this._itemCache[e.id]=e}},{key:"getItem",value:function(e){return this._itemCache[e]}},{key:"clearItem",value:function(e){delete this._itemCache[e]}},{key:"createVMLI",value:function(e,t){return s.default.itemStoreManager.getDefaultItemStore().createItemRaw(e,t)}},{key:"createTempVMLI",value:function(e,t){return t.noSave=!0,t.canDestroy=!0,t.isTemp=!0,s.default.itemStoreManager.getTempItemStore().createItemRaw(e,t)}},{key:"destroyTempVMLI",value:function(e){s.default.itemStoreManager.getTempItemStore().destroyItem(e)}},{key:"clearLocalData",value:function(){return d.a.clearAllData()}},{key:"deleteDocument",value:function(e,t){delete this._documentsById[e.id],this.documentsArray.remove(e),d.a.deleteDocument(e),t||Be.deleteDocument(e)}},{key:"hasPendingRemoteUpdates",value:function(){return Object.keys(Be.itemsPending).length>0}},{key:"isOnline",value:function(){return this.onlineStatus.get()===o.a.OnlineStatus.Online}}])&&He(t.prototype,a),i&&He(t,i),e}()).prototype,"onSourceLoaded",[p.a],Object.getOwnPropertyDescriptor(Ne.prototype,"onSourceLoaded"),Ne.prototype),ze(Ne.prototype,"onSourceDocumentsChanged",[p.a],Object.getOwnPropertyDescriptor(Ne.prototype,"onSourceDocumentsChanged"),Ne.prototype),Ne),We=t.a=new qe},function(e,t,a){"use strict";var i=a(0),n=a(11),r=a(1),o=a(3),s=a(4),l=a(27),u=a(7),d=a(24),c=a(14),h=a(39),f=a(2),p=a(51),g=a(226),m=a.n(g),v={addTap:function(e,t,a){var n=this.refs[e];i.default.Assert(n,"Invalid refName to add tap to: ",e),n&&i.default.setupClick(n,t,a)},refElement:function(e){var t=this.refs[e];return i.default.isDOMNode(t)?t:p.findDOMNode(t)}},y=function(e){return function(t){i.default.Assert(!t.mixins,"Should not supply separate mixins value"),i.default.Assert(t.displayName,"Must always specify displayName for react components"),t.mixins=[e];var a=!1;return t.componentDisplay?f.a.isMobile&&i.default.isFlagSet(t.componentDisplay,r.a.ComponentDisplay.Mobile)?a=!0:!f.a.isMobile&&i.default.isFlagSet(t.componentDisplay,r.a.ComponentDisplay.Desktop)&&(a=!0):(a=!0,__warn("Unmarked React Create: ",t.displayName)),a?m()(t):void 0}};function _(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}a.d(t,"a",function(){return T});var I={},D=0;function C(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function P(e,t,a){var i=0;if(C(e,t))return!0;if("object"!==S(e)||null===e||"object"!==S(t)||null===t)return!1;var n,r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(var s=0;s<r.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n=void 0,!hasOwnProperty.call(t,r[s]))return!1;if(a&&!1===(n=a(r[s],e[r[s]],t[r[s]])))return!1;if(void 0===n&&!C(e[r[s]],t[r[s]]))return!1}return!0}var A={shouldComponentUpdate:function(e,t){return!P(this.props,e,this.arePropsEqual)||!P(this.state,t,this.areStatesEqual)},getInitialState:function(){this.init&&this.init();var e=this.getState?this.getState(this.props):{};this._observables&&(e=i.default.extend(e,this._observables));var t=null;return e&&(this.setupListeners(e),t=this.transformState(e)),t},createObservables:function(e){for(var t in i.default.Assert(!this._listeners,"You have to run createObservables in init()"),e)if(e.hasOwnProperty(t)){var a=e[t];i.default.isArray(a)?e[t]=new d.a(a):e[t]=new u.a(a),i.default.Assert(!this.hasOwnProperty(t),"Must not multi-define observable properties"),this[t]=e[t]}i.default.Assert(!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables"),this._observables=e},addObservable:function(e,t){t=i.default.isArray(t)?new d.a(t):new u.a(t),this[e]=t,this._observables[e]=t,this._addListener(t.listen(this.onListener))},_addListener:function(e){i.default.Assert(e&&e.target,"Must add a valid listener"),this._ensureListeners(),i.default.Assert(!this._hasListener(e.target),"Must not double register the same observable/trigger"),this._listeners.push(e)},refreshListeners:function(e){this.disposeListeners();var t=this.getState?this.getState(e||this.props):{};this._observables&&(t=i.default.extend(t,this._observables)),t&&this.setupListeners(t)},_ensureListeners:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])},setupListeners:function(e){for(var t in this._ensureListeners(),e||(e=this.getState?this.getState(this.props):{}),e)if(e.hasOwnProperty(t)){var a=e[t];a instanceof u.a&&this._addListener(a.listen(this.onListener))}},disposeListeners:function(e){if(this._listeners){for(var t=0,a=0;a<this._listeners.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._listeners[a].dispose()}if(this._listeners=[],e){var i=0;for(a=0;a<this._permanentListeners.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._permanentListeners[a].dispose()}}}e&&this.disposeDispatcherListeners()},disposeDispatcherListeners:function(){if(this._dispatcherListeners){for(var e=0,t=0;t<this._dispatcherListeners.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._dispatcherListeners[t],i=a[0],n=a.slice(1);i.unlisten.apply(i,n)}this._dispatcherListeners=[]}},listenTo:function(e,t){if(i.default.Assert(e&&(e instanceof h.a||e instanceof u.a),"Can only listen to an Observable or a Trigger object"),e instanceof h.a||e instanceof u.a){var a=e.listen(this.onListener);!1!==t?this._addListener(a):this._permanentListeners.push(a)}},listenToDispatcher:function(){this._dispatcherListeners||(this._dispatcherListeners=[]);var e,t=Array.prototype.slice.call(arguments);i.default.isString(t[0])?e=c.a:(e=t[0],t.splice(0,1)),t.push(this.onListener),e.listen.apply(e,t);var a=[e].concat(t);this._dispatcherListeners.push(a)},_hasListener:function(e){var t=0;i.default.Assert(e,"Must have a valid target");for(var a=!1,n=0;n<this._listeners.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._listeners[n].target===e){a=!0;break}}return a},_getState:function(e){var t=this.getState?this.getState(e||this.props):{};return this._observables&&(t=i.default.extend(t,this._observables)),this.transformState(t)},transformState:function(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];a&&a instanceof u.a&&(e[t]=a.get(),a instanceof d.a&&(e[t+"_arrVer"]=a.version))}return e},onListener:function(){this.updateState()},updateState:function(e){if(i.default.Assert(this._isMounted,"updateState called on a component that is not yet mounted:",this.constructor&&this.constructor.displayName),this._isMounted){var t=this.state,a=this._getState(e);if(this.onBeforeChanged){var n=this.onBeforeChanged(a,t,e);void 0!==n&&(a=n)}!1!==a&&(this.setState(a),this.onAfterChanged&&this.onAfterChanged(a,t))}},componentWillUnmount:function(){this.disposeListeners(!0),this.__hotkeys&&(l.a.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1},getChildByKey:function(e){var t;return s.Children.forEach(this.props.children,function(a){a&&a.key===e&&(t=a)}),t},componentDidMount:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=l.a.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=l.a.pushStackEscape(this.onEscapeKey)),this.onMount&&this.onMount()},getUniqueID:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+D++),this.__id)},componentDidCatch:function(e,t){i.default.reportError(e,t,void 0,"React Component Error: "),o.default.toasts.pushMessage(r.a.MessageID.ReactError)}};v&&n.a.extend(A,v),y&&(I.createClass=y(A));var M={constructor:!0,componentWillMount:!0,render:!0,componentDidMount:!0,componentWillReceiveProps:!0,shouldComponentUpdate:!0,componentWillUpdate:!0,componentDidUpdate:!0,componentWillUnmount:!0},T=function(e){function t(e){var a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=!(o=b(t).call(this,e))||"object"!==S(o)&&"function"!==typeof o?w(r):o;var s=Object.getPrototypeOf(w(w(a))),l=Object.getOwnPropertyNames(s).concat(Object.getOwnPropertyNames(s.__proto__)),u=[w(w(a))].concat(i.default.arrayDifference(l,M));return n.a.binder.apply(n.a,u),a.state=a.getInitialState(),a}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,s["Component"]),a=t,(r=[{key:"getInitialState",value:function(){return{}}}])&&_(a.prototype,r),o&&_(a,o),t}();n.a.extend(T.prototype,A);t.b=I},function(e,t,a){"use strict";var i=a(42);function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,i["a"]),t}();t.a=new l},function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(2);function r(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._range=t,this._range||(this._range=a(15).default._getSelectionRange())}var t,n,o;return t=e,(n=[{key:"isValid",value:function(){return!!this._range}},{key:"getNativeRange",value:function(){return this._range}},{key:"getStartContainer",value:function(){return this._range.startContainer}},{key:"getEndContainer",value:function(){return this._range.endContainer}},{key:"getStartElement",value:function(){return i.default.getElementParent(this.getStartContainer())}},{key:"getEndElement",value:function(){return i.default.getElementParent(this.getEndContainer())}},{key:"getSelectOffsetsInElement",value:function(e){return a(15).default.getSelectOffsetsInElement(e,this._range)}},{key:"getStartOffset",value:function(){return this._range.startOffset}},{key:"getEndOffset",value:function(){return this._range.endOffset}}])&&r(t.prototype,n),o&&r(t,o),e}(),s=a(1);function l(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,r;return t=e,(a=[{key:"createFakeRange",value:function(e,t,a,n){try{var r=this.createSelectionRange();return r.setStart(e,t),r.setEnd(a,n),new o(r)}catch(s){i.default.reportError(s)}}},{key:"createSelectionRange",value:function(){return document.createRange()}},{key:"setSelection",value:function(e,t,a,r,o){if("TEXTAREA"===e.nodeName)i.default.Assert(e===a,"Cannot multiselect textareas"),e.focus(),e.selectionStart=t,e.selectionEnd=r,n.a.isMobile&&!o&&n.a.android&&setTimeout(this.setSelection.bind(this,e,t,a,r,!0),0);else{var s=this.createSelectionRange();this.setSelectionValues(s,e,t,a,r),this.setSelectionRange(s)}}},{key:"setSelectionRange",value:function(e){var t=window.getSelection();i.default.shouldLog(s.a.LogLevels.Selection)&&i.default.log("Set Selection to Range",e),t.removeAllRanges(),e instanceof o&&(e=e.getNativeRange()),t.addRange(e)}},{key:"insertNode",value:function(e){var t=this._getSelectionRange();t&&t.insertNode(e)}},{key:"selectAfterNode",value:function(e){var t=document.createRange();t.setStartAfter(e),this.setSelectionRange(t)}},{key:"setSelectionRangeToWhatItAlreadyIs",value:function(){var e=this._getSelectionRange();i.default.shouldLog(s.a.LogLevels.Selection)&&i.default.log("Set Selection to Same",e),e&&this.setSelectionRange(e)}},{key:"hasValidSelection",value:function(){return this.getSelectionRange(!0).isValid()||n.a.android&&document.activeElement&&"TEXTAREA"===document.activeElement.nodeName}},{key:"getSelectionRange",value:function(e){var t;return e&&(t=this._getSelectionRange()),new o(t)}},{key:"_getSelectionRange",value:function(){var e,t=window.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e}},{key:"getSelectionNode",value:function(){var e=window.getSelection().anchorNode;if(e)return e.nodeType===Node.TEXT_NODE?e.parentNode:e}},{key:"getSelectedText",value:function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!==document.selection.type?document.selection.createRange().text:void 0}},{key:"clearSelection",value:function(){var e=window.getSelection();i.default.shouldLog(s.a.LogLevels.Selection)&&i.default.log("Clear Selection"),e.removeAllRanges()}},{key:"hasSelection",value:function(){var e=this._getSelectionRange();return!(!e||e.startContainer===document.documentElement)&&(i.default.getPaneForElement(e.startContainer)&&i.default.findParent(e.startContainer,"paneContent"))}},{key:"hasRawSelection",value:function(){return!!window.getSelection().anchorNode}},{key:"getCursorSelectionRange",value:function(e){var t,a=e.target,n=i.default.ensureDOMNode(e.target);if(n){var r=i.default.getElementParent(a),l=0,u=i.default.getItemForElement(a),d=i.default.getPaneObjectForElement(a);i.default.Assert(r,"getCursorSelectionRange must only be called when hovered item is item",n),i.default.findParent(a,"line")||(n=r.firstElementChild,l=s.a.LineLeftPad+(!d.isBlockHeader&&u.hasPrefix()?s.a.PrefixWidth:0));var c=n.getBoundingClientRect(),h=i.default.clamp(e.clientY,c.top+9,c.bottom-9),f=i.default.clamp(e.clientX,c.left+l,c.right-1);t=this._getCursorSelectionRange(f,h)}return t?new o(t):void 0}},{key:"_getCursorSelectionRange",value:function(e,t){var a;if(document.caretRangeFromPoint)a=document.caretRangeFromPoint(e,t);else if(document.caretPositionFromPoint){var n=document.caretPositionFromPoint(e,t);n&&((a=document.createRange()).setStart(n.offsetNode,n.offset),a.setEnd(n.offsetNode,n.offset))}else if(document.body.createTextRange){var r=this._getSelectionRange(),o=document.body.createTextRange();try{o.moveToPoint(e,t),o.select(),a=this._getSelectionRange(),this.setSelectionRange(r)}catch(s){}}else i.default.Assert(!1,"Unable to get selection range at cursor");return a}},{key:"_ensureSelectionInElement",value:function(e,t){i.default.Assert(e,"Must have a valid element"),i.default.Assert(t,"Must have a valid range"),i.default.isAncestor(t.startContainer,e)||t.setStart(e,0),i.default.isAncestor(t.endContainer,e)||t.setEnd(e,0),i.default.hasClass(t.startContainer,"textSelected")&&t.setStart(t.startContainer.parentElement.firstElementChild,t.startContainer.innerText.length),i.default.hasClass(t.endContainer,"textSelected")&&t.setEnd(t.endContainer.parentElement.firstElementChild,t.endContainer.innerText.length),i.default.hasClass(t.startContainer,"itemIgnoreText")&&t.setStart(t.startContainer.previousSibling,t.startContainer.previousSibling.length),i.default.hasClass(t.endContainer,"itemIgnoreText")&&t.setEnd(t.endContainer.previousSibling,t.endContainer.previousSibling.length);var a=i.default.getPluginForElement(t.startContainer);if(a){var n=a.textContent.length;!(o=a.nodeType===Node.TEXT_NODE)&&0===t.startOffset||o&&t.startOffset<n/2?t.setStartBefore(a):t.setStartAfter(a)}var r=i.default.getPluginForElement(t.endContainer);if(r){var o,s=r.textContent.length;!(o=r.nodeType===Node.TEXT_NODE)&&0===t.endOffset||o&&t.endOffset<s/2?t.setEndBefore(r):t.setEndAfter(r)}}},{key:"getSelectOffsetsInElement",value:function(e,t){var a={start:0,end:0,total:0};if("TEXTAREA"===e.nodeName){a.start=e.selectionStart,a.end=e.selectionEnd,a.total=e.value.length;var n=e.value.indexOf("\n");n>=0&&a.start>n&&(a.start--,a.end--,a.total--)}else if(e&&(i.default.Assert(t,"Must provide a valid range"),t)){this._ensureSelectionInElement(e,t);var r=this._getComponentNode(t.startContainer),o=t.startOffset,l=this._getComponentNode(t.endContainer),u=t.endOffset;!r||r.textContent!==s.a.TextSpace&&0!==r.textContent.length||(o=0),!l||l.textContent!==s.a.TextSpace&&0!==l.textContent.length||(u=0);var d=0,c=this._getComponentNodesIn(e);if(c.length>0)for(var h=0,f=0;f<c.length;++f){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;c[f]===r&&(a.start=d+o),c[f]===l&&(a.end=d+u),d+=this._getComponentNodeLength(c[f]),void 0===l&&(f===u-1?a.end=d:0===f&&0===u&&(a.end=0)),void 0===r&&(f===o-1?a.start=d:0===f&&0===o&&(a.start=0))}else a.start=0,a.end=0;a.total=d,isNaN(a.end)&&(a.end=d),a.start>a.total&&(a.start=a.total),a.end>a.total&&(a.end=a.total)}return i.default.Assert(!isNaN(a.start)&&!isNaN(a.end),"Must have valid start and end",a),a}},{key:"getSelectOffsetsForMouseEvent",value:function(e){var t=i.default.getElementParent(e.target),a=this.getCursorSelectionRange(e);return a&&a.getSelectOffsetsInElement(t)}},{key:"getOffsetChildElement",value:function(e,t){if(i.default.Assert(e,"Must supply a valid element"),"TEXTAREA"===e.nodeName)return{element:e,offset:t};if(this._isComponentNode(e))return i.default.Assert(this._isComponentSelectable(e),"Component must be selectable"),{element:e,offset:t};for(var a=0,n=0,r=this._getComponentNodesIn(e),o=0;o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._getComponentNodeLength(r[o]);if(n+s>=t)return{element:r[o],offset:t-n};n+=s}i.default.Assert(!1,"Unable to find offset child element")}},{key:"getChildNodeOffset",value:function(e){var t=0;i.default.Assert(e,"Must supply a valid child element");for(var a=0,n=this._getComponentNodesIn(i.default.getElementParent(e)),r=this._getComponentNodesIn(e),o=0;o<n.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(n[o]===r[0])break;a+=this._getComponentNodeLength(n[o])}return a}},{key:"_getComponentNodeLength",value:function(e){return i.default.Assert(this._isComponentNode(e),"Supplied node must be a valid component"),i.default.hasClass(e,"plugin")?1:i.default.hasClass(e,"mdImageWrapper")?0:1===e.length&&e.textContent===s.a.TextSpace?0:e.length}},{key:"_getComponentNodesIn",value:function(e){if(this._isComponentNode(e))return[e];var t=[];return this._getComponentNodes(t,e),t}},{key:"_isComponentNode",value:function(e){var t=!1;return e&&(e.nodeType===Node.TEXT_NODE&&!i.default.getPluginForElement(e)||i.default.hasClass(e,"plugin")||i.default.hasClass(e,"mdImageWrapper"))&&(t=!0),t}},{key:"_isComponentSelectable",value:function(e){i.default.Assert(!e||this._isComponentNode(e),"Must either be an invalid node (not-selectable) or a component");var t=!1;return e&&e.nodeType===Node.TEXT_NODE&&(t=!0),t}},{key:"_getComponentNodes",value:function(e,t){if(t)if(this._isComponentNode(t))e.push(t);else if(!i.default.hasClass(t,"itemTime")&&t.childNodes)for(var a=0,n=0;n<t.childNodes.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t.childNodes[n];this._getComponentNodes(e,r)}}},{key:"_getComponentNode",value:function(e){var t;if(this._isComponentNode(e))t=e;else{var a=i.default.getPluginForElement(e);a&&(t=a)}return t}},{key:"setSelectionValues",value:function(e,t,a,n,r){i.default.Assert(e,"Range must be supplied"),i.default.Assert(this._isComponentNode(t),"Must be selecting a valid component"),i.default.Assert(this._isComponentNode(n),"Must be selecting a valid component"),i.default.Assert(t!==n||a<=r,"Select elements must be different, or selection must start before it ends"),t.nodeType===Node.TEXT_NODE?e.setStart(t,a):(i.default.Assert(i.default.hasClass(t,"plugin"),"Only other valid component is plugin"),i.default.Assert(0===a||1===a,"Must eiter be selecting before or after the plugin"),0===a?this._selectBeforeComponent(e,t,"setStart"):1===a&&this._selectAfterComponent(e,t,"setStart")),n.nodeType===Node.TEXT_NODE?e.setEnd(n,r):(i.default.Assert(i.default.hasClass(n,"plugin"),"Only other valid component is plugin"),i.default.Assert(0===r||1===r,"Must eiter be selecting before or after the plugin"),0===r?this._selectBeforeComponent(e,n,"setEnd"):1===r&&this._selectAfterComponent(e,n,"setEnd")),i.default.shouldLog(s.a.LogLevels.Selection)&&i.default.log("Set Selection: ["+a+","+r+"] - [",t+","+n+"]")}},{key:"_selectBeforeComponent",value:function(e,t,a){var i=this._getPrevComponent(t);if(this._isComponentSelectable(i))e[a](i,this._getComponentNodeLength(i));else{var n=document.createTextNode("");t.parentNode.insertBefore(n,t),e[a](n,0)}}},{key:"_selectAfterComponent",value:function(e,t,a){var i=this._getNextComponent(t);if(this._isComponentSelectable(i))e[a](i,0);else{var n=document.createTextNode("");t.parentNode.insertBefore(n,void 0),e[a](n,0)}}},{key:"_getPrevComponent",value:function(e){i.default.Assert(e,"Must supply a valid node"),i.default.Assert(this._isComponentNode(e),"Supplied node must be a valid component itself");var t=e.previousSibling;return i.default.Assert(!t||this._isComponentNode(t),"Siblings must always be valid components"),t}},{key:"_getNextComponent",value:function(e){i.default.Assert(e,"Must supply a valid node"),i.default.Assert(this._isComponentNode(e),"Supplied node must be a valid component itself");var t=e.nextSibling;return i.default.Assert(!t||this._isComponentNode(t),"Siblings must always be valid components"),t}},{key:"selectElement",value:function(e,t,a){var i;if(isNaN(a)&&(a=t),isNaN(t))(i=this.createSelectionRange()).selectNodeContents(e);else{var n=this.getOffsetChildElement(e,t),r=t!==a?this.getOffsetChildElement(e,a):n;n&&(i=this.createFakeRange(n.element,n.offset,r.element,r.offset))}i&&this.setSelectionRange(i)}},{key:"getSelectionInElement",value:function(e){var t=this._getSelectionRange();if(t&&i.default.isAncestor(t.startContainer,e)&&i.default.isAncestor(t.endContainer,e))return this.getSelectOffsetsInElement(e,t)}},{key:"deleteRangeContents",value:function(){var e=this._getSelectionRange();e&&e.deleteContents()}}])&&l(t.prototype,a),r&&l(t,r),e}();t.default=new u},,function(e,t,a){"use strict";var i,n=a(0),r=a(3),o=a(2),s=a(42),l=a(7),u=a(24),d=a(16);function c(e){return(c="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==c(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((i=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=f(this,p(t).call(this))).selected={},e.numSelected=new l.a(0),e._queueRemoveEditables=[],e}var a,i,d;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,s["a"]),a=t,(i=[{key:"_selectedObjForPane",value:function(e){n.default.Assert(e,"Multiselect should always pass in a pane"),e=e||n.default.focusedPane;var t=this.selected[e.id];return t||(t=this.selected[e.id]={arr:new u.a,isInverted:!1},o.a.isMobile&&t.arr.listen(this.onChanged.bind(this,e))),t}},{key:"_selectedForPaneObs",value:function(e){return this._selectedObjForPane(e).arr}},{key:"_selectedForPane",value:function(e){return this._selectedObjForPane(e).arr.get()}},{key:"onChanged",value:function(e){this.numSelected.set(this.numSelectedInPane(e))}},{key:"isInverted",value:function(e){return this._selectedObjForPane(e).isInverted}},{key:"setInverted",value:function(e,t){this._selectedObjForPane(t).isInverted=e}},{key:"isSelected",value:function(e,t){return this._selectedForPane(t).indexOf(e)>=0}},{key:"getSelected",value:function(e){return this._selectedForPane(e)}},{key:"getSelectedItems",value:function(e,t){for(var a=0,i=this._selectedForPane(e),n=[],r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=i[r];if(e.numItems()>o){var s=e.itemAtIndex(o);!s||!t&&s.isNote()||n.push(s)}}return n}},{key:"numSelectedInPane",value:function(e){for(var t=0,a=0,i=this._selectedForPane(e),n=0;n<i.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e.itemAtIndex(i[n]);!r||r.isNote&&r.isNote()||a++}return a}},{key:"getFirstSelectedIndex",value:function(e){var t=0;e=e||n.default.focusedPane;for(var a=this._selectedForPane(e),i=Number.MAX_VALUE,r=!1,o=0;o<a.length;o++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[o];s<i&&(i=s,r=!0)}return r?i:-1}},{key:"getFirstSelectedItem",value:function(e){e=e||n.default.focusedPane;var t=this.getFirstSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"getLastSelectedIndex",value:function(e){var t=0;e=e||n.default.focusedPane;for(var a=this._selectedForPane(e),i=-1,r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=a[r];o>i&&(i=o)}return i}},{key:"getLastSelectedItem",value:function(e){e=e||n.default.focusedPane;var t=this.getLastSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"_resetPaneID",value:function(e){var t=r.default.PaneManager,a=!0;if(t.isPaneActive(e)){var i=t.getPaneById(e);i.canResetMultiselect()?(this.setSelected([],i),this.selected[e].isInverted=!1):a=!1}else delete this.selected[e];return a}},{key:"reset",value:function(e){var t=!0;if(e)e.canResetMultiselect()?this._resetPaneID(e.id):t=!1;else for(var a in this.selected)this.selected.hasOwnProperty(a)&&(t=t&&this._resetPaneID(a));t&&this.fireEvent("reset",[e])}},{key:"clearEditables",value:function(e){for(var t=0,a=this.getSelectedItems(e),i=1===a.length?a[0]:void 0,n=0;n<this._queueRemoveEditables.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._queueRemoveEditables[n];r!==i&&(r.isEditable.set(!1),r.itemChanged.notify())}this._queueRemoveEditables=[]}},{key:"setSelected",value:function(e,t,a){var i=0;t=t||n.default.focusedPane,console.log("selected",e);var r=this._selectedForPane(t),s=n.default.arrayDiff(r,e);this.setInverted(!1,t),this._selectedForPaneObs(t).set(e);for(var l=0;l<s.length;l++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=s[l];if(u<t.numItems()){var d=t.itemAtIndex(u);if(d){if(o.a.isMobile&&t.isWriteable)1===e.length&&e[0]===u?d.isEditable.set(!0):a?this._queueRemoveEditables.push(d):d.isEditable.set(!1);d.itemChanged.notify()}}}}},{key:"toggleSelected",value:function(e,t,a){t=t||n.default.focusedPane;var i=this._selectedForPaneObs(t),r=t.itemAtIndex(e),o=i.indexOf(e);o>=0&&!0!==a?(i.remove(e),r.itemChanged.notify()):o<0&&!1!==a&&(i.push(e),r.itemChanged.notify())}},{key:"addSelected",value:function(e,t){this.toggleSelected(e,t,!0)}},{key:"removeSelected",value:function(e,t){this.toggleSelected(e,t,!1)}},{key:"selectInOrder",value:function(e,t,a){var i=0;a=a||n.default.focusedPane;for(var r=[],o=e;o<=t;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r.push(o)}this.setSelected(r,a)}},{key:"applyFnToSelected",value:function(e,t){var a=0;r.default.PaneUpdateBatcher.beginUpdateItems(),t=t||n.default.focusedPane;for(var i,o=this.getSelectedItems(t),s=0;s<o.length&&!1!==i;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=e(o[s],s,o.length)}r.default.PaneUpdateBatcher.commitUpdateItems()}}])&&h(a.prototype,i),d&&h(a,d),t}()).prototype,"reset",[d.a],Object.getOwnPropertyDescriptor(i.prototype,"reset"),i.prototype),i);t.a=new m},function(e,t,a){"use strict";var i,n=a(0),r=a(225),o=a(73),s=a(3),l=a(1),u=a(22),d=a(31),c=a(41),h=a(16);function f(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.encryptLocal=!1,this.dataCache={settings:{},items:{},documents:{},boards:[],contacts:[],localStorage:{},user:{}}}var t,a,i;return t=e,(a=[{key:"init",value:function(e,t){this._backing=e,this.cbOnLoad=t,this.onDataReady()}},{key:"transformFieldsDocument",value:function(e){var t=n.default.clone(e);return n.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.archivedItems,t=d.a.documentOut(t)}},{key:"transformFieldsItem",value:function(e){var t=n.default.clone(e);return n.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.archivedItems,this.encryptLocal?d.a.encryptItemOut(t,s.default.crypto,l.a.EncryptionKeys.Global):Promise.resolve(d.a.itemOut(t))}},{key:"getItemData",value:function(e,t){return this.dataCache.items[e]}},{key:"getDocumentData",value:function(e){return this.dataCache.documents[e]}},{key:"getSetting",value:function(e){return this.dataCache.settings[e]}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"getContacts",value:function(){return this.dataCache.contacts}},{key:"saveDocument",value:function(e){this._saveDocumentData(d.a.documentOut(e))}},{key:"setSetting",value:function(e,t){this.dataCache.settings[e]=t}},{key:"saveUser",value:function(e){this.dataCache.user=e}},{key:"saveSettings",value:function(e){Object.assign(this.dataCache.settings,e)}},{key:"setBoard",value:function(e){this.dataCache.boards[e.id]=e}},{key:"saveContacts",value:function(e){this.dataCache.contacts=e}},{key:"clearContacts",value:function(){this.dataCache.contacts=[]}},{key:"saveItem",value:function(e,t){var a=this;var i=this.dataCache.items[e.id]||{};Object.assign(i,t,{docId:e.getDocumentOwner().id}),this.dataCache.items[e.id]=i,this.transformFieldsItem(i).then(function(e){a._saveItemData(e)})}},{key:"deleteItem",value:function(e){var t=this.dataCache.items[e];t&&(delete this.dataCache.items[t.id],this._deleteItemData(t.id))}},{key:"deleteBoard",value:function(e){delete this.dataCache.boards[e]}},{key:"deleteDocument",value:function(e){var t=this;e.getAllItems().forEach(function(e){delete t.dataCache.items[e.id]}),delete this.dataCache.documents[e.id]}},{key:"deleteSettings",value:function(e){var t=this;Object.keys(e).forEach(function(e){delete t.dataCache.settings[e]})}},{key:"clearAllData",value:function(){}},{key:"ensureMirror",value:function(e){for(var t=0,a=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],r=[],o=!this.TEST_DOC_ID,s=e.length>0&&!!e[0].id,l=0;l<e.length;l++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var u=s?e[l]:e[l].value,d=s?"load":e[l].type,c=this.dataCache.items[u.id];c&&c.parent||u.parent;if("removed"===d)r.push(u.id);else if(!c||!this.areObjectsEqual(u,c)){i&&!o&&console.log("THIS IS BAD, document mismatch");var h=Object.assign(c||{},u);delete h.pendingSync,this.dataCache.items[u.id]=h,n.push(h)}}Promise.all(n.map(function(e){return a.transformFieldsItem(e)})).then(function(e){a.bulkSave(e,r)})}},{key:"areObjectsEqual",value:function(e,t){return delete(t=Object.assign({},t)).items,delete t.archivedItems,delete(e=Object.assign({},e)).items,delete e.archivedItems,e.parent===t.parent&&(delete e.parent,delete t.parent,n.default.areObjectsEqual(e,t))}},{key:"onDataReady",value:function(){var e=this;this.dataCache.settings&&s.default.settings.load(this.dataCache.settings),u.a.onActiveUser(function(t){if(n.default.Assert(e.dataCache.documents,"Must be documents in cache at this point"),e.dataCache.documents){var a=Object.values(e.dataCache.documents),i=n.default.filterWithNonMatches(a,e.checkDocHasRoot);if(i.fail.length>0&&(console.log("Failed docs",i.fail),i.fail.forEach(function(t){delete e.dataCache.documents[t.id]})),a=i.match.map(function(t){t.rootData=e.dataCache.items[t.root];var a=c.a.fromData(t,e._backing);return a.createVMLIs(),a}),e._isLoaded=!0,e.cbOnLoad){var r={documentsPending:e.dataCache.documentsPending,itemsPending:e.dataCache.itemsPending,settingsPending:e.dataCache.settingsPending,boardsPending:e.dataCache.boardsPending};e.cbOnLoad(a,r)}e.cbOnLoad=void 0}})}},{key:"checkDocHasRoot",value:function(e){return!!this.dataCache.items[e.root]}},{key:"getValue",value:function(e){return this.dataCache.localStorage[e]}},{key:"setValue",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"removeValue",value:function(e){delete this.dataCache.localStorage[e]}},{key:"onPreload",value:function(e,t){this.dataCache=e,t()}},{key:"saveEncryptionKey",value:function(e,t){}},{key:"bulkSave",value:function(e,t){var a=this;t.length>0&&t.forEach(function(e){delete a.dataCache.items[e]}),e.length>0&&this._bulkSaveItems(e,t,function(e){e&&(a.dataCache=e),a.onDataReady()})}},{key:"getItemsMap",value:function(){return this.dataCache.items}}])&&f(t.prototype,a),i&&f(t,i),e}()).prototype,"checkDocHasRoot",[h.a],Object.getOwnPropertyDescriptor(i.prototype,"checkDocHasRoot"),i.prototype),i);function g(e){for(var t=0,a=1;a<arguments.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=null!=arguments[a]?arguments[a]:{},n=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),n.forEach(function(t){m(e,t,i[t])})}return e}function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function v(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,a){return(y="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=w(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function _(e){return(_="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){return!t||"object"!==_(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var D=function(e){function t(){var e;return b(this,t),(e=k(this,w(t).call(this,"markdone"))).version(1).stores({documents:"id",items:"id",settings:"id",caches:"cid",user:"id",boards:"id",localStorage:"id",contacts:"id"}),e}return S(t,r["a"]),t}(),C=function(e){function t(){var e;return b(this,t),(e=k(this,w(t).call(this))).TEST_DOC_ID="",e.canWrite=!n.default.isDemoMode(),e}var a,i,r;return S(t,p),a=t,(i=[{key:"preload",value:function(e){var t=this;if(this.canWrite){this.db=new D;var a=window.__preload;a?a.data?(console.log("Loading from preload",a.data.items),this.onPreload(a.data,e)):(console.log("Waiting for load"),a.worker.onmessage=function(a){console.log("Loaded after load",a.data.items),t.onPreload(a.data,e)}):(console.log("Skipped preload"),o.a.load(this.db,function(a){t.onPreload(a,e)}))}}},{key:"init",value:function(e,a){y(w(t.prototype),"init",this).call(this,e,a)}},{key:"_saveItemData",value:function(e){this.canWrite&&this.db.items.put(e)}},{key:"_deleteItemData",value:function(e){this.canWrite&&this.db.items.delete(e)}},{key:"_saveDocumentData",value:function(e){this.canWrite&&this.db.documents.put(e)}},{key:"setSetting",value:function(e,a){y(w(t.prototype),"setSetting",this).call(this,e,a),this.canWrite&&(null!=a&&void 0!==a?this.db.settings.put(g({id:e},a)):this.db.settings.delete(e))}},{key:"saveUser",value:function(e){if(e){y(w(t.prototype),"saveUser",this).call(this,e);var a=Object.keys(e).map(function(t){return{id:t,v:e[t]}});this.canWrite&&this.db.user.bulkPut(a)}}},{key:"deleteSettings",value:function(e){var a=this;y(w(t.prototype),"deleteSettings",this).call(this,e),this.canWrite&&Object.keys(e).forEach(function(e){return a.db.settings.delete(e)})}},{key:"saveSettings",value:function(e){y(w(t.prototype),"saveSettings",this).call(this,e);var a=Object.keys(e).map(function(t){return g({id:t},e[t])});this.canWrite&&this.db.settings.bulkPut(a)}},{key:"setBoard",value:function(e){y(w(t.prototype),"setBoard",this).call(this,e),this.canWrite&&this.db.boards.put(e)}},{key:"deleteBoard",value:function(e){y(w(t.prototype),"deleteBoard",this).call(this,e),this.canWrite&&this.db.boards.delete(e)}},{key:"deleteDocument",value:function(e){var a=this;y(w(t.prototype),"deleteDocument",this).call(this,e),this.canWrite&&(e.getAllItems().forEach(function(e){a.db.items.delete(e.id)}),this.db.documents.delete(e.id))}},{key:"saveContacts",value:function(e){y(w(t.prototype),"saveContacts",this).call(this,e),this.canWrite&&this.db.contacts.bulkPut(e)}},{key:"clearContacts",value:function(){y(w(t.prototype),"clearContacts",this).call(this),this.canWrite&&this.db.contacts.clear()}},{key:"_bulkSaveItems",value:function(e,t,a){var i=this;if(t.length>0&&t.forEach(function(e){i.db.items.delete(e)}),e.length>0)if(this.canWrite){var n=this.db.items.bulkPut(e);this.cbOnLoad&&n.then(function(){o.a.load(i.db,function(e){a(e)})})}else this.cbOnLoad&&a()}},{key:"getValue",value:function(e){return localStorage.getItem(e)}},{key:"setValue",value:function(e,a){y(w(t.prototype),"setValue",this).call(this,e,a),n.default.isString(a)||(a=JSON.stringify(a)),localStorage.setItem(e,a)}},{key:"removeValue",value:function(e){return y(w(t.prototype),"removeValue",this).call(this,e),localStorage.getItem(e)}},{key:"clearAllData",value:function(){return Promise.all(this.db.tables.map(function(e){return e.clear()}))}}])&&v(a.prototype,i),r&&v(a,r),t}();t.a=new C},function(e,t,a){"use strict";var i=a(0),n=a(1),r=function(e,t){this._batchConstructor=e,this._batchParams=t,this._batchedRequests={},this._successCB=i.default.emptyFn,this._failureCB=i.default.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=i.default.generateTempId()};r.prototype={add:function(e,t,a){i.default.Assert(e,"Must provide a valid request to add to batch"),i.default.Assert(t,"Must supply a valid group ID when adding to a batch"),i.default.Assert(!this._hasRun,"Should never add new requests to a batch that has already run");var n=this._ensureGroup(t);return this._addRequestToGroup(t,a,e),n},then:function(e,t,a){this._successCB=e||i.default.newEmptyFn(),this._failureCB=t||i.default.newEmptyFn(),this._context=a,this._run()},execute:function(e){this._successCB=e,this._failureCB=e,this._run()},getBatchID:function(){return this._batchID},_ensureGroup:function(e){var t=!1;return this._batchedRequests[e]||(this._batchedRequests[e]={size:0,batch:this._createBatchInternal()},t=!0),t},_addRequestToGroup:function(e,t,a){var r=this._getGroupBatch(e),o=this._getGroupSize(e);i.default.Assert(o<=n.a.MaxBatchSize,"Too many requests for a single batch"),t?r.add(a,{id:t}):r.add(a)},_getGroupBatch:function(e){return i.default.Assert(this._batchedRequests[e],"Must ensure before querying"),this._batchedRequests[e].batch},_getGroupSize:function(e){return i.default.Assert(this._batchedRequests[e],"Must ensure before querying"),this._batchedRequests[e].size},_getBatchURL:function(){return this._baseURL},_run:function(){for(var e in i.default.Assert(!this._hasRun,"Should never run a batch twice"),this._hasRun=!0,this._batchedRequests){this._getGroupBatch(e).then(this._handleSuccess.bind(this),this._handleFailure.bind(this))}},_createBatchInternal:function(){return new this._batchConstructor(this._batchParams)},_handleSuccess:function(e){i.default.Assert(this._hasRun,"Must run batch before success"),this._successCB.call(this._context,e)},_handleFailure:function(e){i.default.Assert(this._hasRun,"Must run batch before failure"),this._failureCB.call(this._context,e)}};var o=r,s=function(){0};s.prototype={fns:function(e){return this._data.gapi.client[e]},generatePackedFns:function(e){var t=this._data.gapi.client[e],a=["gapi","client",e];this._iterateAPI(t,a)},_iterateAPI:function(e,t){if(i.default.isString(e.path))e.packedFn||(i.default.log("WARNING: Missing Pre-Packed Fn: [ '"+t.join("', '")+"' ]"),e.packedFn=t.slice(0));else for(var a in e)i.default.isObject(e[a])&&(t.push(a),this._iterateAPI(e[a],t),t.pop())},_constructPath:function(e,t){var a=i.default.clone(t);return Object.keys(t).forEach(function(i){var n=new RegExp("\\{"+i+"\\}"),r=e.replace(n,encodeURIComponent(t[i]));r!==e&&delete a[i],e=r}),delete a.resource,delete a.timeoutMS,delete a.forceNoDupe,{path:e,fields:a}},_constructHeaders:function(e,t,a){i.default.Assert(t||a,"Must have either accountID or token"),i.default.Assert(a||i.default.isDemoMode(),"Should have a token at this point");var n={Authorization:a?"Bearer "+a.access_token:void 0};return e&&Object.keys(e).forEach(function(t){n[t]=e[t]}),n},canConstruct:function(e){var t=!1;return i.default.isFunction(e)||(t=!!i.default.unpackFn(e,this._data)),t},createBatch:function(e){return new o(window.gapi.client.newBatch,e)},createRequest:function(e,t,a,n){var r,o=i.default.unpackFn(t,this._data);if(o){var s=this._constructPath(o.path,a),l=this._constructHeaders(o.headers,e,n),u={path:s.path,method:o.method||"GET",params:s.fields,body:a.resource,headers:l};i.default.isDemoMode()&&(u.__packedFn=t,u.__rawParams=a),r=window.gapi.client.request(u)}else{var d=i.default.unpackFn(t);d&&(r=d(a))}return r},getAPIForRequest:function(e){return i.default.Assert(i.default.isDemoMode(),"Must only reverse the path in demo mode"),i.default.unpackFn(e.__packedFn)},_data:{gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},export:{path:"/drive/v2/files/{fileId}/export",method:"GET",packedFn:["gapi","client","drive","files","export"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}},realtime:{get:{path:"/drive/v2/files/{fileId}/realtime",method:"GET",packedFn:["gapi","client","drive","realtime","get"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},move:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}/move",method:"POST",packedFn:["gapi","client","calendar","events","move"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}};t.a=new s},,,function(e,t,a){"use strict";var i=a(3),n=a(0),r=a(1);function o(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onAuthedCallbacks=[]}var t,a,s;return t=e,(a=[{key:"getScopes",value:function(){return[r.a.GScope.UserInfoEmail,r.a.GScope.UserInfoProfile]}},{key:"onSignInWithUser",value:function(e){this.user=e,i.default.settings.activeUser.set(e.email),this.runAuthedCallbacks(e)}},{key:"runAuthedCallbacks",value:function(e){this.onAuthedCallbacks.length>0&&this.onAuthedCallbacks.forEach(function(t){return t(e)})}},{key:"onAuthed",value:function(e){this.user?e(this.user):this.onAuthedCallbacks.push(e)}},{key:"onActiveUser",value:function(e){i.default.settings.activeUser.onHasValue(e)}},{key:"getAccountName",value:function(){return this.user.displayName}},{key:"getDefaultAccountID",value:function(){return n.default.isDemoMode()?"demoemail@moo.do":this.user.email}}])&&o(t.prototype,a),s&&o(t,s),e}(),l=a(2),u=a(49);a(232);function d(e){return(d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return!t||"object"!==d(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,f(t).call(this))}var a,o,d;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,s),a=t,(o=[{key:"init",value:function(){var e=this,t={apiKey:r.a.APIKey,authDomain:"markdone-218007.firebaseapp.com",databaseURL:"https://markdone-218007.firebaseio.com",projectId:"markdone-218007",storageBucket:"markdone-218007.appspot.com",messagingSenderId:"661309247798",clientId:r.a.ClientID,scopes:this.getScopes()};u.initializeApp(t),window.firebase=u,u.auth().onAuthStateChanged(function(t){t&&i.default.settings.activeUser.get()?(console.log("auth",t.email),e.onSignInWithUser(t)):i.default.settings.activeUser.set(void 0)})}},{key:"handleNativeOAuthResponse",value:function(e){var t=this;if(e.success){var a=e.token,i=a.access_token,n=a.id_token;if(i&&n){var r=u.auth.GoogleAuthProvider.credential(n,i);u.auth().signInWithCredential(r).then(function(e){console.info(e),t.onSignInWithUser(e)})}}}},{key:"signIn",value:function(){var e=this;if(this._isSigningIn=!0,l.a.mobile&&l.a.app)n.default.nativeBridge.nativeOauth(!1,function(e){console.log(e)});else{var t=new u.auth.GoogleAuthProvider;this.getScopes().forEach(function(e){t.addScope(e)}),u.auth().signInWithPopup(t).then(function(t){t.additionalUserInfo&&(e.userProfile=t.additionalUserInfo.profile),n.default.Assert(t.user,"Somehow signed in without a valid user"),t.user&&e.onSignInWithUser(t.user)}).catch(function(e){"auth/popup-closed-by-user"!==e.code&&n.default.Assert(!1,"Error on signin",e.code,e.message)})}}},{key:"getUid",value:function(){return n.default.isDemoMode()?"demouid":u.auth().getUid()}},{key:"signOut",value:function(e){u.auth().signOut().then(function(){i.default.settings.activeUser.set(void 0),e&&e()}).catch(function(t){e&&e()})}}])&&c(a.prototype,o),d&&c(a,d),t}();t.a=new g},,function(e,t,a){"use strict";var i=a(0),n=a(7);function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,a){return(l="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=u(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(e,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=s(this,u(t).call(this,e,a)))._value=e||[],i.version=0,i}var a,r,c;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,n["a"]),a=t,(r=[{key:"notify",value:function(e,a,i){0===arguments.length&&this.version++,l(u(t.prototype),"notify",this).apply(this,arguments)}},{key:"length",value:function(){return this._value.length}},{key:"set",value:function(e,t){return i.default.Assert(e&&i.default.isArray(e),"Value set on an Observable array must be an array",e),this._value=e,this.version++,!1!==t&&this.notify(this._value),e}},{key:"clear",value:function(e){this.set([],e)}},{key:"remove",value:function(e,t){var a;if(i.default.isFunction(e))for(var n=0,r=0;r<this._value.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e(this._value[r])&&(void 0===a&&(a=r),this._value.splice(r,1),r--)}else a=this._value.remove(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"removeAt",value:function(e,t){var a=this._value.removeAt(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"push",value:function(e,t){var a=this._value.push(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"insertSorted",value:function(e,t,a){var i=this._value.insertSorted(e,t);return this.version++,!1!==a&&this.notify(this._value),i}},{key:"sort",value:function(e,t){return this._value.sort(e),this.version++,!1!==t&&this.notify(this._value),this}},{key:"splice",value:function(e,t,a,i){var n;return n=a?this._value.splice(e,t,a):this._value.splice(e,t),this.version++,!1!==i&&this.notify(this._value),n}},{key:"indexOf",value:function(e){return this._value.indexOf(e)}},{key:"indexOfWithProperty",value:function(e,t){return this._value.indexOfWithProperty(e,t)}}])&&o(a.prototype,r),c&&o(a,c),t}();t.a=c},,function(e,t,a){"use strict";var i,n=a(0),r=a(1),o=a(3),s=a(2),l=a(39),u=a(22),d=a(16),c=a(7),h=a(63);function f(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isLoaded=new c.a(!1),this.isGapiLoaded=new c.a(!1),this._handlersOnLoaded=[],this.authTokens={},this.onAccountsUpdated=new l.a}var t,a,i;return t=e,(a=[{key:"loadWithTokens",value:function(e){var t=this;this.ensureGapi(),Promise.all(Object.keys(e).map(function(e){return t.refreshAuthToken(e)})).then(function(e){t.isLoaded.set(!0),t._runOnSyncHandlers()})}},{key:"authAccount",value:function(e,t,a){var i=this,n=function(n){n&&!n.error?a(n):i.doAuthForAccount({email:e,scopes:t},a)};this.authTokens[e]?this.getAccountAuthToken(e,t,n,!0):n()}},{key:"authAccountTemp",value:function(e,t){this.doAuthForAccount({scopes:e,temp:!0},t)}},{key:"convertScopeToScopes",value:function(e){var t=e.scope?e.scope.split(" "):void 0;return e.scopes=t?t.map(function(e){return r.a.GScopeArray[e]}):void 0,delete e.scope,e}},{key:"refreshAuthToken",value:function(e){var t=this;return new Promise(function(a){console.log("auth tokens at load",t.authTokens[e]),h.a.run("getAccessToken",{query:{email:e}}).then(function(i){if(i.error)console.log(i.error);else{var n=t.convertScopeToScopes(i.value);t.authTokens[e]=n,console.log("Refreshed auth token",n),a(n)}})})}},{key:"redoAuth",value:function(e,t,a){var i=this;o.default.toasts.pushMessage({text:"Error authorizing for account: "+e+". Please reauthorize.",actionText:"REAUTHORIZE",action:function(){i.doAuthForAccount({email:e,scopes:t},a)}})}},{key:"getAccountAuthToken",value:function(e,t,a,i){var o=this;this.onLoaded(function(){var s=o.authTokens[e];n.default.Assert(s,"Should not be getting token for invalid account"),s?o._verifyScopes(t,s)?!s.expires_at||s.expires_at-Date.now()<r.a.MinimumTokenExpireTimeMS?(console.log("Token needs refresh",s.expires_at,s.expires_at-Date.now()),o.refreshAuthToken(e).then(a)):a(s):i?a(void 0):o.redoAuth(e,t,a):o.redoAuth(e,t,a)})}},{key:"isAuthorizedForScopes",value:function(e,t){var a=this.authTokens&&this.authTokens[e];return!!a&&this._verifyScopes(t,a)}},{key:"notifyUnauthorizedRequest",value:function(e){}},{key:"_verifyScopes",value:function(e,t){var a=0;if(!t||!t.scopes)return!1;for(var i=t.scopes,n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!i.includes(e[n]))return!1}return!0}},{key:"_getRedirectURL",value:function(){return window.location.protocol+"//"+window.location.host+"/oauthRelay.html"}},{key:"_createAuthURL",value:function(e){var t=e.email,a=e.scopes,i=e.temp;n.default.Assert(n.default.isArray(a)&&a.length>0,"Must pass in a valid scopes array");var r={email:t,temp:i,scope:a.join(" "),redirect_uri:this._getRedirectURL()};return h.a.createURL("authGoogleAPI",r)}},{key:"doAuthForAccount",value:function(e,t){var a=this,i=e.email,o=e.scopes,s=e.temp;n.default.Assert(i||s,"Must provide a valid email to link if not temp"),n.default.Assert(n.default.isArray(o),"Must always provide a valid scopes array"),o=n.default.arrayUnion([r.a.GScope.UserInfoEmail],o);var l,u=!1;this._createAuthURL({email:i,scopes:o,temp:s}).then(function(e){var r=window.open(e,"googleauth","height=600,width=550"),o=function e(r){if(clearInterval(l),n.default.getLocationOrigin()&&n.default.isObject(r.data)){if(window.removeEventListener("message",e),u=!0,r.data){var o=a.convertScopeToScopes(r.data);a.authTokens[i]=o,t(o)}t(void 0)}};l=setInterval(function(){r&&!r.closed||(clearInterval(l),window.removeEventListener("message",o),u||t(void 0))},1e3),window.addEventListener("message",o)})}},{key:"ensureGapi",value:function(e){var t=this;if(!s.a.isMobile){window.gapi&&window.gapi.client&&e&&e();var a=function(e){};document.getElementById("gapiScript")||n.default.addScript("https://apis.google.com/js/api.js","gapiScript",this.ensureGapi.bind(this,e),a),window.gapi&&!window.gapi.client&&window.gapi.load("client",{callback:function(a){window.gapi.client.init({apiKey:r.a.APIKey,clientId:r.a.ClientID}).then(function(){t.isGapiLoaded.set(!0),o.default.pluginManager.notifyDependencyLoad(r.a.PluginDependency.GoogleLogin)}),e&&e()},onerror:a,timeout:2e4,ontimeout:function(e){}})}}},{key:"onLoaded",value:function(e){this.isLoaded.get()?e():this._handlersOnLoaded.push(e)}},{key:"_runOnSyncHandlers",value:function(){this._handlersOnLoaded.forEach(function(e){return e()}),this._handlersOnLoaded=[]}},{key:"getAccountName",value:function(e){}},{key:"getDefaultAuthToken",value:function(e,t){var a=u.a.getDefaultAccountID();this.getAccountAuthToken(a,e,t)}},{key:"hasError",value:function(){return!1}},{key:"getError",value:function(e){return""}},{key:"getGoogleUserInfo",value:function(e){this.getDefaultAuthToken(["profile"],function(t){fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=".concat(t.access_token)).then(function(t){200===t.status&&t.json().then(function(t){return e(t)})})})}}])&&f(t.prototype,a),i&&f(t,i),e}()).prototype,"refreshAuthToken",[d.a],Object.getOwnPropertyDescriptor(i.prototype,"refreshAuthToken"),i.prototype),i);t.a=new p},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(6),s=a(11),l=a(2),u=a(7),d=a(38),c=a(15);function h(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stack=[]}var t,a,i;return t=e,(a=[{key:"push",value:function(e){this.stack.push(e)}},{key:"pop",value:function(e){this.stack.remove(e)}},{key:"peek",value:function(){return this.stack[this.stack.length-1]}},{key:"contains",value:function(e){return this.stack.indexOf(e)>=0}},{key:"forEach",value:function(e){for(var t=0,a=this.stack.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!1===e(this.stack[a],a))break}}}])&&h(t.prototype,a),i&&h(t,i),e}(),p=a(5),g=a(37),m=a(32);function v(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y={},_={Ctrl:0,Meta:1,Alt:2,Shift:3},b=function(){function e(){var t,a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentArrowsMode=void 0,this.platformPrimaryKey=l.a.mac?_.Meta:_.Ctrl,this.platformSecondaryKey=l.a.mac?_.Ctrl:_.Alt;var o=function(e,t){for(var n,o=0,s=0;s<t.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l,u,d,c,h=t[s],f=!h.mods;if(f||(l=!!h.mods[_.Ctrl]===!!e.ctrlKey,u=!!h.mods[_.Meta]===!!e.metaKey,d=!!h.mods[_.Alt]===!!e.altKey,c=!!h.mods[_.Shift]===!!e.shiftKey),(f||l&&u&&d&&c)&&(h.isGlobal||e.target===document.body&&!r.default.menus.isContextMenuOpen()&&!r.default.menus.isModalOpen()||i.default.findParent(e.target,"paneContent"))){n=h;break}}if(n){a.currentArrowsMode&&!n.isOnPane&&(a._exitingArrowsMode=a.currentArrowsMode,a._exitArrowsMode());var p=n.callback.call(a,e);return n.stopPropagation&&e.stopPropagation(),a._exitingArrowsMode=void 0,!1===p||(e.handled=!0,e.preventDefault(),!1)}},u=function(e){if(i.default.vmSetup&&r.default.settings.activeUser.get()){var s;if(l.a.normalizeKeys(e),t=e.normCode,a.currentArrowsMode&&a._updateArrowsMode(e),a.hotkeyStack.forEach(function(t){if(t&&t[e.normCode]&&(s=o(e,[t[e.normCode]])),void 0!==s)return!1}),void 0===s){var u=y[e.normCode];u&&(s=o(e,u))}if(void 0!==s)return i.default.vmMain&&i.default.vmMain.updateCursorFromEvent(e),s;if(l.a.android&&e.target===document.body){if(function(e){return(l.a.mac&&e.metaKey||!l.a.mac&&e.ctrlKey)&&e.normCode===n.a.KeyCode.A}(e))return e.preventDefault(),!1;d.default.keydown(null,e)}}};this.hotkeyStack=new f,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},s.a.binder(this,"onMouseDownArrowsMode"),document.addEventListener("keydown",u,!0),document.addEventListener("keyup",function(e){i.default.vmSetup&&r.default.settings.activeUser.get()&&(l.a.normalizeKeys(e),i.default.vmMain&&i.default.vmMain.updateCursorFromEvent(e),l.a.windows&&t!==e.normCode&&(e.normCode!==n.a.KeyCode.D1&&e.normCode!==n.a.KeyCode.D2&&e.normCode!==n.a.KeyCode.D3&&e.normCode!==n.a.KeyCode.D8||y[e.normCode]&&(u(e),t=void 0)))},!0),this.loadConfig()}var t,a,h;return t=e,(a=[{key:"loadConfig",value:function(){for(var e in this.config={Pane:{Search:["Pr+F"],Goto:["Se+G"],Overview:["Se+O"],Complete:["Pr+Enter"],ZoomOut:["Se+Sh+Enter","Se+LeftArrow"],ZoomIn:["Se+Enter","Se+RightArrow"],EditNote:["Sh+Enter"],Collapse:["Pr+Period","mac:Se+Space"],CollapseRecursive:["Pr+Sh+Period","mac:Se+Sh+Space"],CollapseAll:["Pr+Se+Period","mac:Pr+Se+Sh+Space"],Unindent:["Sh+Tab","Pr+LBracket","Se+LBracket","Se+Sh+LeftArrow"],Indent:["Tab","Pr+RBracket","Se+RBracket","Se+Sh+RightArrow"],MoveUp:["Se+Sh+UpArrow","mac:Op+UpArrow"],MoveDown:["Se+Sh+DownArrow","mac:Op+DownArrow"],Priority1:["Pr+D1"],Priority2:["Pr+D2"],Priority3:["Pr+D3"],PriorityNone:["Pr+D0","Pr+D4"],Star:["Pr+D8","win:Pr+Tilde"],NextPane:["mac:app:Se+Tilde","mac:app:Pr+Op+RightArrow","win:Se+Tilde"],PreviousPane:["mac:app:Se+Sh+Tilde","mac:app:Pr+Op+LeftArrow","win:Se+Sh+Tilde"],SelectItem:["Se+L"],ClosePane:["Sh+F4"],Bold:["Pr+B"],Italic:["Pr+I"],Underline:["Pr+U"],InsertLink:["Pr+K"],MoveAutocomplete:["Se+M"],JumpAutocomplete:["Se+J"],PrefixHeader:["Pr+Sh+D6","Pr+Sh+P","Pr+Sh+H","win:Pr+Sh+D3"],PrefixTask:["mac:app:Pr+Sh+LBracket","win:Pr+Sh+LBracket","Se+Sh+LBracket","Pr+Sh+D9","Pr+Sh+D0"],PrefixBullet:["Pr+Sh+D8"],PrefixNumList:["Pr+Sh+D1"],AddToCalendar:["Se+C"],DeleteItem:["Pr+Sh+Backspace","Pr+Sh+K"],Date:["Pr+Sh+D"]},Global:{SelectPane1:["app:Se+D1"],SelectPane2:["app:Se+D2"],SelectPane3:["app:Se+D3"],SelectPane4:["app:Se+D4"],SelectPane5:["app:Se+D5"],SelectPane6:["app:Se+D6"],SelectPane7:["app:Se+D7"],SelectPane8:["app:Se+D8"],SelectPane9:["app:Se+D9"],SelectPane10:["app:Se+D0"],Undo:["Pr+Z"],Redo:["Pr+Y","Pr+Sh+Z"],AddPane:["app:Pr+T","Se+T"],NewItem:["app:Pr+N","Se+N"],EmailCompose:["Pr+E"],NextBoard:["mac:app:Se+Tab","win:app:Pr+Tab"],PreviousBoard:["mac:app:Se+Sh+Tab","win:app:Pr+Sh+Tab"],SelectBoard1:["Se+Sh+D1"],SelectBoard2:["Se+Sh+D2"],SelectBoard3:["Se+Sh+D3"],SelectBoard4:["Se+Sh+D4"],SelectBoard5:["Se+Sh+D5"],SelectBoard6:["Se+Sh+D6"],SelectBoard7:["Se+Sh+D7"],SelectBoard8:["Se+Sh+D8"],SelectBoard9:["Se+Sh+D9"],SelectBoard10:["Se+Sh+D0"],HelpHotkeys:["Pr+Slash","Se+Slash"],Help:["Pr+Sh+Slash","Se+Sh+Slash"],Settings:["mac:app:Pr+Comma"],ZoomInApp:["app:Pr+Plus"],ZoomOutApp:["app:Pr+Dash"]},Email:{Down:["DownArrow","J"],Up:["UpArrow","K"],Open:["Enter"],Archive:["E","Slash"],Delete:["Delete","win:Backspace","Sh+D3"],Schedule:["C"],Snooze:["D"],Move:["M","V"],Task:["T"],Label:["L"],MarkRead:["I"],MarkUnread:["U"],Star:["S","D8"],Reply:["R"],ReplyAll:["Sh+R","A"],Forward:["F"],Priority1:["D1"],Priority2:["D2"],Priority3:["D3"],RemoveFromLabel:["Y"],Undo:["Z"],Print:["P"],OpenInGmail:["G"]}},this.config.Pane)this.config.Pane.hasOwnProperty(e)&&this.createHotkeyNew(e,this.config.Pane[e],!1);for(var t in this.config.Global)this.config.Global.hasOwnProperty(t)&&this.createHotkeyNew(t,this.config.Global[t],!0);for(var a in this.config.Email)this.config.Email.hasOwnProperty(a)&&this.createHotkeyNew(a,this.config.Email[a],!1,!0,"Email");this.createHotkeyNew("Noop",["Pr+S"],!0)}},{key:"createHotkeyNew",value:function(e,t,a){var r=0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,l=o?this.callbackOnPane.bind(this,s,e):this["hotkey"+e];i.default.Assert(l&&i.default.isFunction(l),"Missing hotkey handler",e);for(var u=0;u<t.length;u++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var d=t[u],c=d.split(":"),h=c[c.length-1].split("+"),f=n.a.KeyCode[h[h.length-1]];if(i.default.Assert(f,"Key code must be defined",d),this.isValidPlatform(d)){var p={name:u>0?e+u:e,isGlobal:a,keyCode:f,primary:h.indexOf("Pr")>=0,secondary:h.indexOf("Se")>=0,shift:h.indexOf("Sh")>=0,option:h.indexOf("Op")>=0,isOnPane:o,callback:l};this.addHotkeyNew(p)}}}},{key:"isValidPlatform",value:function(e){var t=e.split(":");return 1===t.length||(t.indexOf("win")<0||!l.a.mac)&&(t.indexOf("mac")<0||l.a.mac)&&(t.indexOf("app")<0||l.a.isNativeApp())}},{key:"pushStack",value:function(e){for(var t=0,a={},i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i];a[n.keyCode]=n}return this.hotkeyStack.push(a),a}},{key:"pushStackEscape",value:function(e){return this.pushStack([this.createEscape(e)])}},{key:"popStack",value:function(e){this.hotkeyStack.pop(e)}},{key:"getHotkey",value:function(e){var t,a=y[e.normCode];if(a)for(var i=0,n=0;n<a.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r,o,s,l,u=a[n],d=!u.mods;if(d||(r=!!u.mods[_.Ctrl]===!!e.ctrlKey,o=!!u.mods[_.Meta]===!!e.metaKey,s=!!u.mods[_.Alt]===!!e.altKey,l=!!u.mods[_.Shift]===!!e.shiftKey),d||r&&o&&s&&l){t=u.name;break}}return t}},{key:"create",value:function(e,t,a,r,o,s){i.default.Assert(i.default.isNumber(e),"Invalid keyCode"),i.default.Assert(i.default.isBoolean(t),"Invalid isGlobal"),i.default.Assert(i.default.isFunction(o),"Invalid callback");var u={keyCode:e,mods:{},callback:o,isGlobal:t};return a!==n.a.Primary.Yes&&a!==n.a.Primary.Both&&a!==n.a.Primary.Only||(u.mods[this.platformPrimaryKey]=!0),a!==n.a.Primary.No&&a!==n.a.Primary.Never&&a!==n.a.Primary.Both||(u.mods[this.platformSecondaryKey]=!0),s&&l.a.mac&&(u.mods[_.Alt]=!0),r===n.a.Shift.Yes&&(u.mods[_.Shift]=!0),u}},{key:"addHotkeyNew",value:function(e){e.mods={},e.primary&&(e.mods[this.platformPrimaryKey]=!0),e.secondary&&(e.mods[this.platformSecondaryKey]=!0),e.option&&(e.mods[_.Alt]=!0),e.shift&&(e.mods[_.Shift]=!0);var t=e.keyCode;y[t]||(y[t]=[]),y[t].push(e)}},{key:"createEscape",value:function(e){return this.create(n.a.KeyCode.Escape,!0,n.a.Primary.Either,n.a.Shift.Either,e)}},{key:"addHotkey",value:function(e,t,a,r,o,s,u,d){i.default.Assert(a,"Must supply a valid keycode"),l.a.app&&!isNaN(r)&&r!==n.a.Primary.Both&&r!==n.a.Primary.Never&&r!==n.a.Primary.Only&&(r=n.a.Primary.Either),this._addHotkey(e,t,a,r,o,s,u,d)}},{key:"_addHotkey",value:function(e,t,a,r,o,s,u,d){if(i.default.Assert(a,"Must supply a valid keycode"),!d||!l.a.windows){if(y[a]=y[a]||[],r===n.a.Primary.Either)return this._addHotkey(e,t,a,n.a.Primary.No,o,s,u,d),void this._addHotkey(e,t,a,n.a.Primary.Yes,o,s,u,d);if(o===n.a.Shift.Either)return this._addHotkey(e,t,a,r,n.a.Shift.No,s,u,d),void this._addHotkey(e,t,a,r,n.a.Shift.Yes,s,u,d);i.default.Assert(!l.a.windows||r!==n.a.Primary.Both,"Should never require AltGr combo on windows");var c=this.create(a,t,r,o,s,d);c.stopPropagation=u,c.name=e,y[a].push(c)}}},{key:"registerArrowsMode",value:function(e,t,a,i,n,r){var o=this["arrowsModeIndex"+e]=new u.a(-1);return!0===t?this._enterArrowsMode(e,a,i,n):this._addHotkey(e,!0,t.keyCode,t.primary,t.shift,this._onKeyDownArrowsMode.bind(this,e,a,i,n,r)),o}},{key:"getArrowsModeObs",value:function(e){return this["arrowsModeIndex"+e]}},{key:"isInArrowsMode",value:function(e){return this.currentArrowsMode&&this.currentArrowsMode.name===e}},{key:"exitArrowsMode",value:function(e){this.isInArrowsMode(e)&&this._exitArrowsMode()}},{key:"_onKeyDownArrowsMode",value:function(e,t,a,i,n){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===e||this._enterArrowsMode(e,t,a,i,n)}},{key:"_enterArrowsMode",value:function(e,t,a,i,n){this.currentArrowsMode={name:e,cbGetMax:t,cbSelect:a,cbKey:i,cbOnHotkey:n},n&&n(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+e].set(-1)}},{key:"_exitArrowsMode",value:function(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)}},{key:"onMouseDownArrowsMode",value:function(e){this._exitArrowsMode()}},{key:"_updateArrowsMode",value:function(e){var t=this.currentArrowsMode,a=this.getArrowsModeObs(t.name),i=l.a.getKeyCode(e),r=a.get(),o=t.cbGetMax();if(i===n.a.KeyCode.Enter)r>=0&&t.cbSelect(r),this._exitArrowsMode();else if(i===n.a.KeyCode.Escape)this._exitArrowsMode();else if(i===n.a.KeyCode.UpArrow)r>0&&a.set(r-1);else if(i===n.a.KeyCode.DownArrow)r<o-1&&a.set(r+1);else if(t.cbKey){var s=t.cbKey(i,e);s>=0&&(t.cbSelect(s),this._exitArrowsMode(),e.stopPropagation(),e.preventDefault())}}},{key:"checkToggleSearchFilter",value:function(e){var t=i.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.toggleFilterDefault(e),!0)}},{key:"checkToggleSearchPriority",value:function(e){var t=i.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.getFilterValue("priority")===e&&(e=0),t.search.setFilter("priority",e),!0)}},{key:"hotkeyNewItem",value:function(){r.default.menus.openItemEditor({addOnSave:!0,element:i.default.element("newItemButton")})}},{key:"hotkeyAddPane",value:function(){r.default.menus.openAddPaneMenu({element:i.default.element("addPaneButton")})}},{key:"hotkeySearch",value:function(){var e=i.default.focusedPane||r.default.PaneManager.getPaneAtIndex(0);if(e){var t=e.search;t.isFocused.get()||t.focus()}}},{key:"hotkeyGoto",value:function(){i.default.focusedPane.applyToSelection(function(e){return i.default.scrollToAndHighlightItem(e,i.default.focusedPane),!1})}},{key:"hotkeyOverview",value:function(){i.default.focusedPane&&i.default.focusedPane.toggleOverviewVisibility()}},{key:"hotkeyComplete",value:function(){var e,t=p.a.getSelectedItems();p.a.isValid()&&1===t.length&&!t[0].isComplete()&&(e=!0),i.default.beginCompleteAction(),i.default.focusedPane.applyFnToSelection("setComplete",{toggle:"isComplete",restoreSelection:!0,value2:n.a.ChangeType.Local}),e&&i.default.focusedPane.selectNearestItem(p.a.getStartIndex()),i.default.endCompleteAction(),i.default.sendEvent("Hotkey","Complete")}},{key:"_hotkeyPriorityHelper",value:function(e){i.default.focusedPane&&!this.checkToggleSearchPriority(e)&&i.default.focusedPane.applyPriorityToSelection(e,!0)}},{key:"hotkeyPriority1",value:function(){this._hotkeyPriorityHelper(n.a.VMLIFlag.P0)}},{key:"hotkeyPriority2",value:function(){this._hotkeyPriorityHelper(n.a.VMLIFlag.P1)}},{key:"hotkeyPriority3",value:function(){this._hotkeyPriorityHelper(n.a.VMLIFlag.P2)}},{key:"hotkeyPriorityNone",value:function(){i.default.focusedPane.applyPriorityToSelection(n.a.VMLIFlag.None)}},{key:"hotkeyStar",value:function(){this.checkToggleSearchFilter("starred")||i.default.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",restoreSelection:!0,value2:n.a.ChangeType.Local})}},{key:"selectPaneAtIndex",value:function(e){if(e>=0&&e<r.default.PaneManager.paneCount()){var t=r.default.PaneManager.getPaneAtIndex(e);if(t&&(p.a.focusPane(t),!p.a.isValid()&&t.isEditable)){var a=t.indexOfFirstItem();t.selectIndex(a),t.scrollIndexIntoView(a,n.a.ScrollDuration.Default)}}}},{key:"hotkeySelectPane1",value:function(){this.selectPaneAtIndex(0)}},{key:"hotkeySelectPane2",value:function(){this.selectPaneAtIndex(1)}},{key:"hotkeySelectPane3",value:function(){this.selectPaneAtIndex(2)}},{key:"hotkeySelectPane4",value:function(){this.selectPaneAtIndex(3)}},{key:"hotkeySelectPane5",value:function(){this.selectPaneAtIndex(4)}},{key:"hotkeySelectPane6",value:function(){this.selectPaneAtIndex(5)}},{key:"hotkeySelectPane7",value:function(){this.selectPaneAtIndex(6)}},{key:"hotkeySelectPane8",value:function(){this.selectPaneAtIndex(7)}},{key:"hotkeySelectPane9",value:function(){this.selectPaneAtIndex(8)}},{key:"hotkeySelectPane10",value:function(){this.selectPaneAtIndex(9)}},{key:"hotkeyPreviousPane",value:function(){var e=r.default.PaneManager,t=e.getFocusedPaneIndex()-1;t<0&&(t=e.paneCount()-1),this.selectPaneAtIndex(t)}},{key:"hotkeyNextPane",value:function(){var e=r.default.PaneManager,t=e.getFocusedPaneIndex()+1;t>=e.paneCount()&&(t=0),this.selectPaneAtIndex(t)}},{key:"hotkeyZoomIn",value:function(){i.default.focusedPane&&i.default.focusedPane.applyToSelection(function(e){return e.isNote()||i.default.focusedPane.zoomIn(e),!1})}},{key:"hotkeyZoomOut",value:function(){var e=i.default.focusedItem;e&&e.parent()&&i.default.focusedPane.zoomOut(e.parent())}},{key:"hotkeyCollapse",value:function(){i.default.focusedPane.applyToSelection(function(e){i.default.focusedPane.supportCollapsing&&e.toggleCollapsed(i.default.focusedPane)})}},{key:"hotkeyCollapseAll",value:function(){i.default.focusedItem&&i.default.focusedPane&&i.default.focusedPane.supportCollapsing&&i.default.focusedPane.toggleCollapseAll()}},{key:"hotkeyCollapseRecursive",value:function(){var e,t=i.default.focusedPane;i.default.focusedPane.applyToSelection(function(a,i,n,r){t.supportCollapsing&&(void 0===e&&(e=!t.isPaneObjectCollapsed(r)),t.collapseAll(a,e,!0))})}},{key:"hotkeyIndent",value:function(){d.default.compoundOperation(function(){p.a.isValid()&&d.default.handleTab()})}},{key:"hotkeyUnindent",value:function(){d.default.compoundOperation(function(){p.a.isValid()&&d.default.handleTab(!0)})}},{key:"hotkeyMoveUp",value:function(){d.default.moveUp()}},{key:"hotkeyMoveDown",value:function(){d.default.moveDown()}},{key:"hotkeySelectItem",value:function(){d.default.handleSelectAllItem()}},{key:"hotkeyClosePane",value:function(e){var t=r.default.PaneManager.removeFocusedPane();void 0!==t&&(o.e.performAction(o.c.UIAction,{type:o.d.RemovePane,data:t}),i.default.tooltip.hideTip(),e.stopImmediatePropagation())}},{key:"hotkeyBold",value:function(e){return p.a.isValid()&&i.default.vmMain.applyFormatToSelection("**"),e.preventDefault(),!1}},{key:"hotkeyItalic",value:function(e){return p.a.isValid()&&i.default.vmMain.applyFormatToSelection("*"),e.preventDefault(),!1}},{key:"hotkeyUnderline",value:function(e){return p.a.isValid()&&i.default.vmMain.applyFormatToSelection("__"),e.preventDefault(),!1}},{key:"hotkeyInsertLink",value:function(e){p.a.isValid()&&p.a.getStartItem().insertLinkAtSelection();return e.preventDefault(),!1}},{key:"hotkeyMoveAutocomplete",value:function(){i.default.focusedPane&&p.a.isValid()&&i.default.focusedPane.autocompleteMove()}},{key:"hotkeyJumpAutocomplete",value:function(){var e=i.default.focusedPane;if(e){var t=e.search,a={};t.isFocused.get()?a.elementDisplay=t.getSearchBox():e!==i.default.focusedPane&&(p.a.focusPane(e),a.elementDisplay=t.getSearchBox()),e.autocompleteJump(a)}}},{key:"hotkeyUndo",value:function(){c.default.hasRawSelection()&&i.default.elementInNonPaneEdit(c.default.getSelectionNode())||(i.default.focusedPane?i.default.focusedPane.handleUndo():m.a.undo())}},{key:"hotkeyRedo",value:function(){c.default.hasRawSelection()&&i.default.elementInNonPaneEdit(c.default.getSelectionNode())||(i.default.focusedPane?i.default.focusedPane.handleRedo():m.a.redo())}},{key:"hotkeyPrefixHeader",value:function(){i.default.vmMain.applyPrefixToSelection(n.a.Prefix.Header)}},{key:"hotkeyPrefixTask",value:function(e){i.default.vmMain.applyPrefixToSelection(n.a.Prefix.Task)}},{key:"hotkeyPrefixBullet",value:function(e){i.default.vmMain.applyPrefixToSelection(n.a.Prefix.Bullet)}},{key:"hotkeyPrefixNumList",value:function(e){i.default.vmMain.applyPrefixToSelection(n.a.Prefix.NumList)}},{key:"hotkeyEmailCompose",value:function(){var e=i.default.vmMain.getDefaultEmailPlugin();e.isEnabled()?r.default.menus.openComposeEmail(e):r.default.toasts.pushMessage(n.a.MessageID.NeedGmailPermission)}},{key:"hotkeyPreviousBoard",value:function(){g.a.hotkeyPrevBoard()}},{key:"hotkeyNextBoard",value:function(){g.a.hotkeyNextBoard()}},{key:"hotkeySelectBoard1",value:function(){g.a.selectBoard(0)}},{key:"hotkeySelectBoard2",value:function(){g.a.selectBoard(1)}},{key:"hotkeySelectBoard3",value:function(){g.a.selectBoard(2)}},{key:"hotkeySelectBoard4",value:function(){g.a.selectBoard(3)}},{key:"hotkeySelectBoard5",value:function(){g.a.selectBoard(4)}},{key:"hotkeySelectBoard6",value:function(){g.a.selectBoard(5)}},{key:"hotkeySelectBoard7",value:function(){g.a.selectBoard(6)}},{key:"hotkeySelectBoard8",value:function(){g.a.selectBoard(7)}},{key:"hotkeySelectBoard9",value:function(){g.a.selectBoard(8)}},{key:"hotkeySelectBoard10",value:function(){g.a.selectBoard(9)}},{key:"hotkeyAddToCalendar",value:function(){var e=i.default.vmMain.getDefaultCalendarPlugin();e&&e.isActive()&&!e.isPluginBlocked()&&i.default.focusedPane.applyToSelection(e.createEventForItem)}},{key:"hotkeyEditNote",value:function(){i.default.focusedPane&&(r.default.PaneUpdateBatcher.beginUpdateItems(),i.default.focusedPane.clearPreventUpdate(),i.default.focusedPane.applyToSelection(function(e){e.isNote()||p.a.editNote(e)}),r.default.PaneUpdateBatcher.commitUpdateItems())}},{key:"hotkeyHelp",value:function(){i.default.intro.toggle(n.a.HelpMode.Normal)}},{key:"hotkeyHelpHotkeys",value:function(){i.default.intro.toggle(n.a.HelpMode.Hotkeys)}},{key:"hotkeySettings",value:function(){r.default.menus.openSettings()}},{key:"hotkeyDeleteItem",value:function(){i.default.focusedPane.deleteSelected()}},{key:"hotkeyZoomInApp",value:function(){i.default.nativeBridge.sendToApp("zoomIn")}},{key:"hotkeyZoomOutApp",value:function(){i.default.nativeBridge.sendToApp("zoomOut")}},{key:"hotkeyDate",value:function(){if(p.a.isValid()){var e=p.a.getStartIndex(),t=p.a.getStartItem(),a=p.a.getPane();if(e>=0){var i=a.elementAtIndex(e);i&&r.default.menus.openContextMenu({componentName:"ReactContextMenuDate",element:i,item:t,pane:a})}}}},{key:"hotkeyNoop",value:function(){}},{key:"callbackOnPane",value:function(e,t,a){var n=i.default.focusedPane;return n&&n.onHotkey&&n.onHotkey(e,t,a),!1}},{key:"printHotkeyByName",value:function(e,t){var a=this.config[t||"Pane"][e];if(i.default.Assert(a,"Getting an invalid hotkey"),a)for(var n=0,r=0;r<a.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=a[r];if(this.isValidPlatform(o))return this.printHotkey(o)}}},{key:"printHotkey",value:function(e){for(var t=0,a=e.split(":"),i=a[a.length-1].split("+"),n="",r=0;r<i.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=i[r];r>0&&(n+=l.a.windows?" + ":" "),n+="Pr"===o?l.a.priModKey:"Se"===o?l.a.secModKeyForce:"Sh"===o?l.a.mac?"\u21e7":"Shift":"Op"===o?"\u2325":2===o.length&&"D"===o[0]?o[1]:"Slash"===o?"/":"Tilde"===o?"~":"LeftArrow"===o?"\u2190":"RightArrow"===o?"\u2192":"UpArrow"===o?"\u2191":"DownArrow"===o?"\u2193":"Period"===o?".":"Comma"===o?",":"Equals"===o?"=":"Plus"===o?"+":"Dash"===o?"-":"Backspace"===o?l.a.mac?"Delete":o:o.endsWith("Bracket")?o.startsWith("L")?"[":"]":o}return n}},{key:"__dbgCheckHotkeyOverlap",value:function(e,t){for(var a=0,n=t.mods,r=y[e],o=0;o<r.length;++o){var s=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var l=r[o].mods,u=!0,d=0;d<4;d++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(n[d]!==l[d]){u=!1;break}}u&&(l[this.platformPrimaryKey]&&n[this.platformPrimaryKey]&&i.default.Assert(!1,"Overlapping hotkey: ",t),l[this.platformSecondaryKey]&&n[this.platformSecondaryKey]&&i.default.Assert(!1,"Overlapping hotkey: ",t))}}}])&&v(t.prototype,a),h&&v(t,h),e}();t.a=new b},function(e,t,a){"use strict";var i=a(0),n=a(3),r=a(2),o=a(11),s=a(1),l=a(24),u=a(5);function d(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c,h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.repeatStart=["every"],this.dict=this.repeatStart.concat(this.softDays).concat(this.dayModifiers).concat(this.days).concat(this.months)}var t,a,i;return t=e,(a=[{key:"findMatchLike",value:function(e){for(var t=0,a=e.toLowerCase(),i=[],n=0;n<this.dict.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;0===this.dict[n].indexOf(a)&&i.push({type:"date",text:this.dict[n]})}return i}},{key:"findMatchExact",value:function(e){if(this.dict.indexOf(e)>=0)return{type:"date",text:e}}}])&&d(t.prototype,a),i&&d(t,i),e}(),f=a(16);function p(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g=new(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,r;return t=e,(a=[{key:"tagComparator",value:function(e,t){return e.localeCompare(t)}},{key:"tagComparatorNumber",value:function(e,t){var a=e.count,i=t.count;return a===i?e.text.localeCompare(t.text):a>i?-1:1}},{key:"findMatchExact",value:function(e){return!1}},{key:"findMatchLike",value:function(e,t,a){var r={},o=[],s=e.toLowerCase(),l={comparator:function(e){if(!e.isComplete()){var t=e.getTagsLower();if(t)for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];if(!s||n.startsWith(s)&&n!==s){if(!r[n]){var l=r[n]={type:"tag",text:n,count:0};o.push(l)}r[n].count++}}}}};return a?l.item=a.getRootItem():l.itemStore=n.default.itemStoreManager.getDefaultItemStore(),i.default.searchVMLIs(l),o.sort(this.tagComparatorNumber),o.length>t&&(o=o.slice(0,t)),o}},{key:"printStats",value:function(e){var t=0;i.default.log("--- Tag stats ---",e);for(var a=this.findMatchLike("",100),n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;console.log(a[n].text,a[n].count)}}},{key:"getAll",value:function(){return this.findMatchLike("")}}])&&p(t.prototype,a),r&&p(t,r),e}()).prototype,"tagComparatorNumber",[f.a],Object.getOwnPropertyDescriptor(c.prototype,"tagComparatorNumber"),c.prototype),c);function m(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,n;return t=e,(a=[{key:"findMatchLike",value:function(e,t,a){var n=a.getItem(),r=e.toLowerCase(),o=[];return i.default.searchVMLIs({item:n,comparator:function(e){return!e.isComplete()},each:function(e){var a=!1;r?(e.getPrefix()+e.getSearchText()).indexOf(r)>=0&&(a=!0):a=e.isPrefixHeader();if(a&&o.push({type:"item",text:e.getParsedText(),item:e}),o.length>=t)return!1}}),o}},{key:"findMatchExact",value:function(e,t){}}])&&m(t.prototype,a),n&&m(t,n),e}());function y(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.accountID=void 0}var t,a,n;return t=e,(a=[{key:"setAccountID",value:function(e){this.accountID=e}},{key:"findMatchLike",value:function(e,t){for(var a=0,n=i.default.vmMain.getDefaultEmailPlugin(),r=n.getLabels(this.accountID,e,t),o=[],l=0;l<r.length;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r[l].isSystemLabel()||o.insertSorted(r[l],n.labelSortFn)}return o.map(function(e){return{type:s.a.AutocompleteMode.GmailLabel,text:e.getName(),label:e}})}},{key:"findMatchExact",value:function(e,t){}}])&&y(t.prototype,a),n&&y(t,n),e}()),b=a(34);function k(){this.matches=new l.a,this._isShowing=!1,this._isTempDisabled=!1,this._showNoMatches=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[s.a.ContactPrefix,s.a.TagPrefix,s.a.PrefixItemAutocomplete],this._prefixMap={},this.autocompleteDates=new h,this._prefixMap[s.a.ContactPrefix]=b.a,this._prefixMap[s.a.TagPrefix]=g,this._prefixMap[s.a.PrefixItemAutocomplete]=v,o.a.binder(this,"onClosed","onSelectedFromPane"),this.supportedModes=null}k.prototype={isShowing:function(){return this._isShowing},getText:function(){return this.text},getProviderForPrefix:function(e){return this._prefixMap[e]},_checkPrefixes:function(e,t){for(var a=0,i=e.startsWith("-")?1:0,n=0;n<this._prefixes.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._prefixes[n];if((r!==s.a.PrefixItemAutocomplete||t)&&e[i]===r)return{length:i+1,prefix:r}}},_findClosestWithPrefix:function(e,t,a,n){for(var r,o=0,l=e.split(/\s/),u=0,d=-1,c=-1,h=-1,f=0,p=0;p<l.length&&u<=t;++p){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var g=l[p];l[d]===r&&(f=0);var m=this._checkPrefixes(g,n.canAutocompleteItems);m?(d=p,h=(c=u)+g.length,f=m.length,r=m.prefix):f&&r!==s.a.TagPrefix&&(h+=g.length+1),u+=g.length+1}if(f&&t>=c&&t<=h){var v=e.substr(c+f,h-c-f);return i.default.shouldLog(s.a.LogLevels.Autocomplete)&&i.default.log("closest is",r,"--",v),{mode:a,text:e,prefix:r,searchText:v,start:c+f,end:h}}},_findClosestDelimited:function(e,t,a){var n,r=0;n=a===s.a.AutocompleteMode.Item?[e]:e.split(",");for(var o=!1,l=0,u=-1,d=-1,c=0;c<n.length&&l<=t;++c){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var h=n[c];u=l+this._numStartSpaces(h),d=l+h.length-this._numEndSpaces(h),u<t&&t<=d&&h.length>0?(o=!0,i.default.shouldLog(s.a.LogLevels.Autocomplete)&&i.default.log("phrase",h,h.length),i.default.shouldLog(s.a.LogLevels.Autocomplete)&&i.default.log("start char",u,e[u]),i.default.shouldLog(s.a.LogLevels.Autocomplete)&&i.default.log("end char",d,e[d])):o=!1,l+=h.length+1}if(o||this._showNoMatches){var f=e.substr(u,d-u+1);return i.default.shouldLog(s.a.LogLevels.Autocomplete)&&i.default.log("closest is",f),{mode:a,text:e,searchText:f,start:u,end:d}}},_findClosestVMLIElement:function(e,t,a,i){for(var n,r,o,s=0,l=0,u=!1,d=0;d<t.length&&!1===u;d++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=t[d].getParsedText();if(n=l+this._numStartSpaces(c),r=l+c.length-1-this._numEndSpaces(c),n<a&&a<=r+1&&c.length>0){u=d,o=c.trim();break}l+=c.length}if(!1!==u)return{mode:i,text:e,prefix:"",searchText:o,start:n,end:r,el:t[d]}},_numStartSpaces:function(e){for(var t=0,a=0,i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[i])break;a++}return a},_numEndSpaces:function(e){for(var t=0,a=0,i=e.length-1;i>=0;i--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[i])break;a++}return a},insertMatch:function(e){var t=this._searchInfo,a=t.text,n=a.substr(0,t.start),r=a.substr(t.end,a.length),o=t.start+e.length;" "!==r[0]&&e&&" "!==e[e.length-1]&&(e+=" ",o++);var l=n+e+r;return i.default.shouldLog(s.a.LogLevels.Autocomplete)&&i.default.log(n,n.length,r,r.length),i.default.shouldLog(s.a.LogLevels.Autocomplete)&&i.default.log(l),{text:l,offset:o}},onSelectedFromPane:function(e){e.owner.setText(e.value,!0,s.a.ChangeType.Local),u.a.selectIndex(e.index,e.offset)},prefixForMode:function(e){return"contact"===e&&s.a.ContactPrefix||"tag"===e&&s.a.TagPrefix||void 0},startMobileAutocomplete:function(e){var t=e.mode,a=this.prefixForMode(t),i="date"===t?"Enter date":"Search "+t.capitalize()+"s";this.showPopup({mode:t,text:i,allowCustom:"date"===t,buttonText:"Add",onSelected:function(t){var i=e.owner;if(i){var n=i.getParsedText(),o=i.getDateText();n="date"===e.mode&&o?n.replace(o,t.value):n+(n.endsWith(" ")?"":" ")+a+t.value,i.setText(n,!0,s.a.ChangeType.Local),r.a.isMobile||u.a.selectIndex(e.index,n.length)}}})},updateFromPane:function(e){var t=e.owner.getParsedText()||"";if(!(e.start<=1)||"#"!==t&&"+"!==t){var a=e.element.getBoundingClientRect(),i=n.default.Measure.getCaretScreenPosition(e.pane,e.index,e.start);this.update({mode:"all",text:t,offset:e.start,owner:e.owner,positionOffset:{left:i.left-a.left,top:0},fromPane:!0,indexInPane:e.index,elementDisplay:e.element,position:r.a.isMobile?"full":void 0,onSelected:this.onSelectedFromPane})}},update:function(e){var t=e.mode;if(e.owner===this.owner&&e.elementInput===this.elementInput||(this._isTempDisabled=!1),e.showNoMatches&&(this._showNoMatches=!0),this.text=e.text,this._isTempDisabled||!e.text&&!this._showNoMatches)this.matches.set([]),this._showNoMatches||this.hide();else{this.owner=e.owner,this.elementInput=e.elementInput;var a=e.text,n=null,o=null;this._searchInfo="all"===t?this._findClosestWithPrefix(a,e.offset,e.mode,e):this._findClosestDelimited(a,e.offset,e.mode);if(this._searchInfo){if(this.text=this._searchInfo.searchText,"all"===t)o=this.getProviderForPrefix(this._searchInfo.prefix);else switch(t){case s.a.AutocompleteMode.Move:case s.a.AutocompleteMode.Jump:case s.a.AutocompleteMode.Item:o=v;break;case s.a.AutocompleteMode.Email:n=(o=this._prefixMap[s.a.ContactPrefix]).findEmailsLike(this._searchInfo.searchText.trim(),100);break;case s.a.AutocompleteMode.Contact:o=this._prefixMap[s.a.ContactPrefix];break;case s.a.AutocompleteMode.Tag:o=this._prefixMap[s.a.TagPrefix];break;case s.a.AutocompleteMode.Date:case s.a.AutocompleteMode.Snooze:o=this.autocompleteDates;break;case s.a.AutocompleteMode.GmailLabel:var l=i.default.vmMain.getDefaultEmailPlugin()._getAccountIDFromItem(e.item);(o=_).setAccountID(l);break;default:i.default.Assert(!1,"Unknown autocomplete mode: ",t)}null===n&&(n=o.findMatchLike(this._searchInfo.searchText,100,e.pane||i.default.focusedPane)),r.a.isMobile||1!==n.length||o.findMatchExact(this._searchInfo.searchText,n)&&(n=[])}n=n||[],e.supportSearchItemAutocomplete&&"all"===t&&0===n.length&&e.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(a,e.parsedEls,e.offset,t)),this.matches.set(n),!this._isShowing&&n.length>0&&!this._isTempDisabled&&!e.noShow?this.show(e):0===n.length&&(this._showNoMatches||this.hide(),this._isTempDisabled=!1)}},clearDisabled:function(){this._isTempDisabled=!1},onClosed:function(){this._isShowing=!1,this._owner=null,this.matches.clear()},show:function(e){var t=r.a.isMobile&&"email"===e.mode;this._isShowing=!0,this._showNoMatches=!!e._showNoMatches,this._owner=e.owner,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,n.default.menus.openContextMenu(e,t)},showPopup:function(e){this._isShowing=!0,this._showNoMatches=!0,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,r.a.isMobile&&(e.position="full"),n.default.menus.openContextMenu(e)},hide:function(){this._isShowing&&(this._isShowing=!1,n.default.menus.closeContextMenu("ReactAutocomplete"))}};t.a=new k},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3);function o(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=[" ","-","/","[","]","(",")","*","_","@",".",":"],l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,l;return t=e,(a=[{key:"getPreviousWord",value:function(e,t,a){for(var r=0,o=a-1;o>=0;o--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=t[o];if(i.default.shouldLog(n.a.LogLevels.Edit)&&console.log(o,l),s.indexOf(l)>=0&&!this.isInsideMarkup(e,o))return o}return-1}},{key:"getNextWord",value:function(e,t,a){for(var i=0,n=a+1;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(s.indexOf(r)>=0&&!this.isInsideMarkup(e,n,!0))return n}return t.length}},{key:"moveLeft",value:function(e,t){if(r.default.settings.showMarkdown.get())t--;else{var a=0;do{if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t--}while(t>0&&this.isInsideMarkup(e,t,!1))}return t}},{key:"moveRight",value:function(e,t,a){var i=t;if(r.default.settings.showMarkdown.get())i++;else{var n=0;do{if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i++}while(i<=a&&this.isInsideMarkup(e,i-1,!0))}return t<a-3&&i>a&&(i=a),i}},{key:"isInsideMarkup",value:function(e,t,a,i){if(!r.default.settings.showMarkdown.get())for(var n=0,o=e.getEls(),s=0;s<o.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=o[s],u=l.getOrigTextLength();if(t<u)return(i?l.hasClass(i):l.isMarkdown()||l.isMDImage()||!!a&&l.hasClass("itemPrefix"))?l:void 0;t-=u}}}])&&o(t.prototype,a),l&&o(t,l),e}();t.a=new l},function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(1),r=a(3),o=a(2),s=a(7),l=a(54),u=a(5),d=a(17),c=a(12),h={None:0,Item:1,Multiselect:2,Overview:3};function f(){this.swipeMode=h.None,this.swipeX=0,this.swipePoints=[],this.multiselectAnimate=!1,this.multiselectOffset=new s.a(0),this.topBarMode=new s.a(n.a.TopBarMode.Normal),this.bottomBarHeight=new l.a([c.a.onlineStatus],this.getBottomBarHeight.bind(this)),this._isDisabled=!1}f.prototype={init:function(){},isSwiping:function(){return this._isSwiping},disable:function(){this._isDisabled=!0},enable:function(){this._isDisabled=!1},isDisabled:function(){return this._isDisabled||i.default.isKeyboardOpen},start:function(e){if(this.enable(),i.default.focusedPane.isOverviewVisible()&&e.clientX>this.overviewWidth())return!0},update:function(e){if(!this.isDisabled()){var t=i.default.getItemForElement(e.startSrc);this.swipeMode===h.None&&(i.default.focusedPane.isOverviewVisible()?this.swipeMode=h.Overview:Math.abs(e.distanceY)<i.default.ClickThreshold&&Math.abs(e.diffX)>i.default.ClickThreshold&&(this.isInMultiselect()?this.swipeMode=h.Multiselect:t&&i.default.isVMLI(t)&&!t.isNote()&&(this.swipeMode=h.Item)));var a=e.diffX;if(this.swipePoints.splice(0,0,{time:Date.now(),x:e.xThisFrame}),this.swipePoints.length>20&&this.swipePoints.splice(this.swipePoints.length-1,1),this.swipeMode===h.Multiselect)a=i.default.clamp(-n.a.RightMenuWidth+a,-n.a.RightMenuWidth,0),this.updateMultiselectPosition(a);else if(this.swipeMode===h.Overview)a=i.default.clamp(this.overviewWidth()+a,0,this.overviewWidth()),i.default.focusedPane.updatePosition(a,!1);else if(this.swipeMode===h.Item&&t){var r=i.default.getCellForElement(e.target);i.default.Assert(r,"Expected cell for swipe"),r&&(a=i.default.clamp(a,-o.a.windowWidth(),o.a.windowWidth()),r.isAnimatingOffsetX=!1,r.offsetX.set(a))}this.lastX=e.diffX}return this.swipeMode!==h.None&&e.preventDefault(),this.swipeMode!==h.None},onClickPane:function(e){var t=i.default.focusedPane;!this.isDisabled()&&t.isOverviewVisible()&&(u.a.closeKeyboard(),this.setOverviewVisibility(t,!1))},end:function(e){var t=i.default.focusedPane,a=this.swipeMode!==h.None;if(!this.isDisabled())if(this.swipeMode===h.Item){var r=i.default.getItemForElement(e.startSrc);if(r){var s=i.default.getCellForElement(e.target);if(i.default.Assert(s,"Expected cell and item for swipe"),s){var l=t.getSwipeMenuItem(r,s.offsetX.get());s.isAnimatingOffsetX=!0,s.offsetX.set(0),l.fn&&l.fn(r)}}}else if(this.swipeMode===h.Multiselect||this.swipeMode===h.Overview){for(var d,c,f=0,p=Date.now(),g=0,m=0,v=0;v<this.swipePoints.length;v++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var y=this.swipePoints[v];if(!(p-y.time<300))break;g+=y.x,m=p-y.time}var _=g?g/(m/1e3):0;_<-200?d=0:_>200?d=1:this.swipeMode===h.Overview?d=Math.round((this.overviewWidth()+this.lastX)/o.a.windowWidth()):this.swipeMode===h.Multiselect&&(d=Math.round(this.lastX/n.a.RightMenuWidth)),this.swipeMode===h.Overview?(c=d>0,this.setOverviewVisibility(t,c),c&&u.a.closeKeyboard()):this.swipeMode===h.Multiselect&&(c=0===d,this.setMultiselectVisibility(c))}return this.swipeMode=h.None,this.swipePoints.length=0,a},setOverviewVisibility:function(e,t){e.updatePosition(t?this.overviewWidth():0,!0),e.overview.setVisibility(t)},toggleOverviewVisibility:function(e){var t=!(e=e||i.default.focusedPane).isOverviewVisible();this.setOverviewVisibility(e,t)},overviewWidth:function(){return Math.min(Math.floor(.85*o.a.windowWidth()),400)},isInMultiselect:function(){return 0!==this.multiselectOffset.get()},updateMultiselectPosition:function(e,t){this.multiselectAnimate=t,this.multiselectOffset.set(e),this.topBarMode.set(0!==e?n.a.TopBarMode.Multiselect:n.a.TopBarMode.Normal),0!==e&&u.a.closeKeyboard()},setMultiselectVisibility:function(e){this.updateMultiselectPosition(e?-n.a.RightMenuWidth:0,!0),e||(i.default.focusedPane.search.hideNonMatches(),d.a.reset())},setTopBarMode:function(e){this.topBarMode.set(e)},resetTopBarMode:function(){var e=this.topBarMode.get();e===n.a.TopBarMode.Multiselect?this.setMultiselectVisibility(!1):e===n.a.TopBarMode.Note&&(r.default.menus.closeContextMenu(),u.a.reset()),this.topBarMode.set(n.a.TopBarMode.Normal)},getBottomBarHeight:function(){return n.a.MobileBottomHeight+(c.a.onlineStatus.get()!==n.a.OnlineStatus.Online?14:0)}},t.default=new f},function(e,t,a){"use strict";var i=function(e){var t={};return Object.keys(e).forEach(function(a){t[e[a]]=a}),t},n={billingID:"b",displayName:"n",gid:"g",email:"e",fname:"f",lname:"l",inviteCode:"i",invoiceAddress:"a",invoiceCompany:"c",invoiceEmail:"d",joinDate:"j",monthlyInvoice:"m",nextBillingDate:"o",planID:"h",picture:"p",premiumCode:"k",premiumSignupDate:"q",premiumEndDate:"r",premiumStatus:"s",subscriptionID:"v",trialDuration:"u",trialStart:"t"},r=i(n),o={items:!0},s={dateCreated:"c",dateCompleted:"e",dateModified:"d",date:"b",flags:"f",id:"id",index:"i",isArchived:"r",isDeleted:"x",note:"n",parent:"p",pendingSync:"m",text:"t",docId:"o",isRoot:"q"},l=i(s),u={validateInFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach(function(e){if(e.length<2||"undefined"===e)return!1}),!0)},validateOutFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach(function(e){if(e.length>2||"undefined"===e)return!1}),!0)},itemFieldMapIn:l,itemFieldMapOut:s,documentIn:function(e){return{id:e.id,acl:e.a,dateModified:e.p.d,text:e.p.t,root:e.r,version:e.v,pendingSync:e.m}},documentOut:function(e){var t={id:e.id,a:e.acl,p:{d:e.dateModified,t:e.text},r:e.root,v:e.version};return e.pendingSync&&(t.m=e.pendingSync),t},userIn:function(e){var t={};return Object.keys(e).forEach(function(a){r[a]&&"undefined"!==r[a]&&(t[r[a]]=e[a])}),t},userOut:function(e){var t={};return Object.keys(e).forEach(function(a){n[a]&&void 0!==n[a]&&"undefined"!==n[a]&&(t[n[a]]=e[a])}),t},itemIn:function(e){var t={};return Object.keys(e).forEach(function(a){l[a]&&"undefined"!==l[a]&&(t[l[a]]=e[a])}),t},itemOut:function(e){var t={};return Object.keys(e).forEach(function(a){void 0!==e[a]&&!o[a]&&s[a]&&"undefined"!==s[a]&&(t[s[a]]=e[a])}),t},decryptItem:function(e,t,a){return e.text?t.decryptText(a,e.text,e.id).then(function(t){return e.text=t,e}):Promise.resolve(e)},encryptItem:function(e,t,a){return e.text?t.encryptText(a,e.text,e.id).then(function(t){return e.text=t,e}):Promise.resolve(e)},encryptItemOut:function(e,t,a){return u.encryptItem(e,t,a).then(function(e){return u.itemOut(e)})},decryptItemIn:function(e,t,a){return e=u.itemIn(e),u.decryptItem(e,t,a)}};t.a=u},function(e,t,a){"use strict";var i=a(0),n=a(11),r=a(1),o=a(3),s=a(84),l=a(14),u=a(12);function d(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.undoStack=[],this.redoStack=[],this.isUndoing=!1,this._deleteSelection=void 0,this._batch=[],this._isBatching=!1,this._batchPrevSel=void 0,this._groupTextChanges=!1,this._needsSelection=!1,n.a.binder(this,"_onSelectionChanged"),l.a.listen("selectionChanged",this._onSelectionChanged)}var t,a,c;return t=e,(a=[{key:"_getLastState",value:function(){return this.undoStack[this.undoStack.length-1]}},{key:"_getLastAction",value:function(){var e=this.undoStack[this.undoStack.length-1];if(e&&1===e.actions.length)return e.actions[0]}},{key:"pushModified",value:function(e,t,a){if(i.default.Assert(!this._deleteSelection,"Should not still have delete selection when modifying"),!this.isUndoing){var n=!1;if("text"in t){var o=this._getLastAction(),s=this._getLastState();this._needsSelection=!0,this._groupTextChanges&&s&&o&&o.itemId===e.id&&(o.changes.text=t.text,n=!0)}n||this._doPush(e,{type:r.a.CrudActions.Modified,changes:t,prevState:a})}}},{key:"pushAdded",value:function(e,t,a){i.default.Assert(!this._deleteSelection,"Should not still have delete selection when adding"),this.isUndoing||this._doPush(t,{type:r.a.CrudActions.Added,changes:{parent:e.id,index:a}})}},{key:"pushRemoved",value:function(e,t,a){this.isUndoing||(this._doPush(t,{type:r.a.CrudActions.Removed,prevSel:this._deleteSelection,changes:{parent:e.id,index:a}}),this._isBatching||(this._deleteSelection=void 0))}},{key:"_doAction",value:function(e){if(!this.isUndoing)try{var t=e?this.redoStack:this.undoStack,a=e?this.undoStack:this.redoStack,n=t.pop();if(n){var l=n.actions;i.default.Assert(l.length>0,"Undo state should have some actions"),l.length>0&&(this.isUndoing=!0,o.default.PaneUpdateBatcher.beginUpdateItems(),i.default.focusedPane.clearPreventUpdate(),l.forEach(function(t){var a=t.type,i=a===r.a.CrudActions.Added||a===r.a.CrudActions.Removed?t.changes:e?t.changes:t.prevState;e||(a===r.a.CrudActions.Added?a=r.a.CrudActions.Removed:a===r.a.CrudActions.Removed&&(a=r.a.CrudActions.Added));var n=u.a.getItem(t.itemId);if(n){var o=n.getDocumentOwner();s.a.onRemoteChange(o,a,t.itemId,i)}}),o.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelFromState(e,n),a.push(n))}}finally{this.isUndoing=!1}}},{key:"restoreSelFromState",value:function(e,t){}},{key:"undo",value:function(){this._doAction(!1)}},{key:"redo",value:function(){this._doAction(!0)}},{key:"_onSelectionChanged",value:function(e){var t=this._getLastState();t&&this._needsSelection?(this._needsSelection=!1,t.selection=e,this._groupTextChanges=!0):this._groupTextChanges=!1}},{key:"saveDeleteSelection",value:function(){}},{key:"beginAction",value:function(){this._isBatching=!0}},{key:"endAction",value:function(){this._batch.length>0&&(this.undoStack.push({prevSel:this._batchPrevSel,actions:this._batch}),this._batch=[]),this._isBatching=!1,this._deleteSelection=void 0}},{key:"clearGroupTextChanges",value:function(){this._needsSelection=!1,this._groupTextChanges=!1}}])&&d(t.prototype,a),c&&d(t,c),e}(),h=a(5);function f(e){return(f="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return!t||"object"!==f(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e,t,a){return(m="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=v(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,v(t).apply(this,arguments))}var a,n,r;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,c),a=t,(n=[{key:"_doPush",value:function(e,t){this.redoStack=[];var a=t.prevSel||h.a.getSavedSelection()||h.a.save();t.itemId=e.id,h.a.isValid()&&(t.selection=h.a.save(!0)),this._isBatching?(this._batchPrevSel=a,this._batch.push(t)):this.undoStack.push({prevSel:a,actions:[t]})}},{key:"restoreSelFromState",value:function(e,t){var a=e?t.selection:t.prevSel;a&&h.a.restore(a,!0)}},{key:"saveDeleteSelection",value:function(){this._deleteSelection=h.a.save()}},{key:"pushRemoved",value:function(e,a,n){this.isUndoing||i.default.Assert(this._deleteSelection,"Must have saved delete selection before deleting"),m(v(t.prototype),"pushRemoved",this).call(this,e,a,n)}}])&&p(a.prototype,n),r&&p(a,r),t}();t.a=new _},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(2),s=a(27),l=a(4),u=a.n(l),d=a(13),c=a(10),h=a(57),f=d.b.createClass({displayName:"FancyContextMenuItem",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({isHovered:!1})},getElement:function(){var e=this.refs.element;return e.getElement?e.getElement():e},closeMenu:function(){!1!==this.props.canClose&&r.default.menus.closeContextMenu()},onClick:function(e){var t=this.props;t.hasButtons||this.didClickJustFire||!t.onClick||(!1!==t.clickCloses&&this.closeMenu(),t.onClick(e),this.didClickJustFire=!0,setTimeout(function(){this.didClickJustFire=!1}.bind(this),300))},onClickIcon:function(e){var t=this.props;t.onClickIcon?(this.closeMenu(),t.onClickIcon(e)):this.onClick(e)},onMouseDown:function(e){(this.props.onClickIcon||i.default.hasClass(e.target,"fancyContextMenuIcon"))&&e.preventDefault()},onMouseUp:function(e){var t=this.props;!isNaN(e.button)&&e.button!==n.a.ButtonCode.Left||o.a.mac&&e.ctrlKey||t.onClickIcon&&i.default.hasClass(e.target,"fancyContextMenuIcon")||this.onClick(e)},onMouseEnter:function(e){this.isHovered.set(!0),this.props.onMouseEnter&&this.props.onMouseEnter(e)},onMouseLeave:function(){this.isHovered.set(!1)},render:function(){var e,t=this.props,a=this.state,n=t.onClick||t.hoverEffects,r=i.default.classNames("fancyContextMenuItem",{flexbox:!t.customLayout},{"c-foreground":!t.faded},{"c-foreground-faded":t.faded},{"c-popup-item":n&&!1!==t.hoverEffects},{selected:t.selected||!1!==t.hoverEffects&&a.isHovered},{active:t.active},{disabled:t.disabled},{hasIcon:!!t.icon},{hasContent:!!t.children},{bold:t.bold},{hasHotkey:t.hotkey},{"flex-center":t.center},{hasButtons:t.hasButtons},this.props.className);if(t.icon)if(t.onClickIcon)e=u.a.createElement(c.a,{className:"fancyContextMenuIcon",icon:t.icon,tooltip:t.iconTooltip,width:36,height:t.height||28,onClick:this.onClickIcon});else{var l=i.default.classNames("fancyContextMenuIcon c-foreground-faded",t.icon),d={fontSize:t.iconSize,height:t.height,lineHeight:t.height&&t.height+"px",color:t.iconColor};e=u.a.createElement("span",{className:l,style:d,onClick:this.onClickIcon,"data-tooltip":t.iconTooltip})}var f,p=t.hotkey;if(t.hoverHotkeyIcon&&a.isHovered){var g=i.default.classNames("fancyContextMenuHotkey c-button",t.hoverHotkeyIcon,{centered:t.hotkeyCentered});f=u.a.createElement("span",{className:g,onMouseUp:t.onClickHoverHotkeyIcon})}else if(p){var m=i.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:t.hotkeyCentered}),v=i.default.isString(p)?p:s.a.printHotkeyByName(p.name,p.group);f=u.a.createElement("span",{className:m},v)}var y=t.style||{};y.height=t.height,y.lineHeight=t.height&&t.height+"px",y.cursor=n?"pointer":"";var _={id:t.id,className:r,"data-tooltip":t.tooltip,onMouseOver:t.onMouseOver,style:y,ref:"element"};return n&&(_.onMouseDown=t.onClick&&!o.a.isMobile?this.onMouseDown:void 0,_.onMouseUp=t.onClick&&!t.noMouseUp?this.onMouseUp:void 0,_.onClick=t.onClick&&(t.noMouseUp||o.a.isMobile)?this.onMouseUp:void 0,_.onMouseEnter=o.a.isMobile||!1===t.hoverEffects?void 0:this.onMouseEnter,_.onMouseLeave=o.a.isMobile||!1===t.hoverEffects?void 0:this.onMouseLeave),u.a.createElement(t.onClick?h.a:"div",_,e,f?u.a.createElement("span",{className:"f1"},t.children):t.children,f)}});t.a=f},function(e,t,a){"use strict";var i=a(0),n=a(3),r=a(1);function o(e){i.default.Assert(i.default.isObject(e),"Should always supply a valid object to init a contact"),this.id=e.id,this.type="contact",this.text=e.text||"",this.phoneNumbers=e.phoneNumbers||[],this.emails=e.emails||[],this.init()}o.prototype={init:function(){for(var e=0,t=0,a=0;a<this.phoneNumbers.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this.phoneNumbers[a];i.link=this.formatPhone(i.number),i.type=i.type?i.type[0].toLowerCase():""}for(a=0;a<this.emails.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.emails[a].link="mailto:"+this.emails[a].address}},_phoneRegex:/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/,formatPhone:function(e){if(this._phoneRegex.test(e)){var t=e.match(this._phoneRegex),a="";return t[1]&&(a+="+1-"+t[1]+"-"),"tel:"+(a+=t[2]+"-"+t[3])}var n=e.replace(/\D+/g,"");return i.default.Assert(n&&""!==n,"Invalid phone number format: "+e),e.startsWith("+")&&(n="+"+n),"tel:"+n}};var s,l=o,u=a(26),d=a(24),c=a(18),h=a(16);function f(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._contactCache={},this._contacts=new d.a,this._contactsByName={},this._contactNames={},this.areContactsLoaded=!1}var t,a,o;return t=e,(a=[{key:"init",value:function(){var e=this;n.default.settings.syncContacts.listen(function(t){t&&e.refreshContacts()})}},{key:"loadContacts",value:function(e){var t=!1,a=!!e;if(!this.areContactsLoaded){var n=e||c.a.getContacts();if(i.default.Assert(0===this._contacts.get().length,"Should only load contacts once"),this.areContactsLoaded=!0,n){for(var r=0,o=[],s=0;s<n.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=n[s];if(l.name&&(l.text=l.name,n[s].text=l.name,delete n[s].name,t=!0),!a&&l.isDemo||l.text&&!l.phoneNumbers&&!l.emails)t=!0;else{if(l.text){var u=i.default.escape(l.text);this._contactNames[u]="",this._contactsByName[l.text]=l,o.push(l)}i.default.Assert(l.id,"Each contact must have a valid id")}}this._contacts.set(o)}else this.clearContacts()}return t}},{key:"addContact",value:function(e){i.default.Assert(e.id,"Incoming contacts must have a valid id"),i.default.Assert(e.text,"All contacts are expected to have a text");var t=this._contactsByName[e.text];if(e.emails){for(var a=0,n=[],r=0;r<e.emails.length;r++){var o=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var s=e.emails[r],u=!1,d=0;d<n.length;d++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(n[d].address.toLowerCase()===s.address.toLowerCase()){u=!0;break}}u||n.push(s)}e.emails=n}if(t)e.emails&&(t.emails||(t.emails=[]),t.emails.pushOnlyUniques(e.emails,this.emailComparator)),e.phoneNumbers&&(t.phoneNumbers||(t.phoneNumbers=[]),t.phoneNumbers.pushOnlyUniques(e.phoneNumbers,this.phoneComparator));else if(this._contacts.insertSorted(e,this.contactComparator),e.text){var c=i.default.escape(e.text);this._contactNames[c]="",this._contactsByName[e.text]=e}this._contactCache[e.id]&&(this._contactCache[e.id]=new l(e))}},{key:"updateContact",value:function(e){var t=0;i.default.Assert(e.id,"Incoming contacts must have a valid id"),i.default.Assert(e.text,"All contacts are expected to have a text");for(var a=!1,n=0;n<this._contacts.get().length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._contacts.get()[n];if(r.id===e.id){r.text=e.text,r.emails=r.phoneNumbers=void 0,this.addContact(e),a=!0;break}}if(!a)return this.addContact(e),!0}},{key:"clearContacts",value:function(){this._contactCache={},this._contacts.clear(),this._contactsByName={},this._contactNames={}}},{key:"numContacts",value:function(){return this._contacts.get().length}},{key:"getContacts",value:function(){return this._contactNames}},{key:"getAll",value:function(){return this._contacts.get()}},{key:"contactComparator",value:function(e,t){return e.text&&t.text?e.text.localeCompare(t.text):e.text&&!t.text?1:!e.text&&t.text?-1:void 0}},{key:"emailComparator",value:function(e,t){return e.address.toLowerCase()===t.address.toLowerCase()}},{key:"emailComparatorSort",value:function(e,t){return e.address&&t.address?e.address.toLowerCase().localeCompare(t.address.toLowerCase()):e.address&&!t.address?1:!e.address&&t.address?-1:void 0}},{key:"phoneComparator",value:function(e,t){return e===t||e.number===t.number}},{key:"ensureCacheObject",value:function(e){if(i.default.Assert(e,"Must have valid data to store in cache"),this._contactCache[e.id])return this._contactCache[e.id];var t=new l(e);return this._contactCache[e.id]=t,t}},{key:"findMatchExact",value:function(e){var t=this._contactsByName[e];if(t)return this.ensureCacheObject(t)}},{key:"findMatchLike",value:function(e,t){var a=0;i.default.Assert(void 0!==e,"Must provide a valid contact part");for(var n=e.toUpperCase(),r=[],o=this._contacts.get(),s=0;s<o.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=o[s],u=!1;if(l.text.toUpperCase().indexOf(n)>=0&&(u=!0),l.emails)for(var d=0,c=0;!u&&c<l.emails.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(l.emails[c].address.toUpperCase().indexOf(n)>=0){u=!0;break}}if(l.phoneNumbers){var h=0;for(c=0;!u&&c<l.phoneNumbers.length;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(l.phoneNumbers[c].number.indexOf(n)>=0){u=!0;break}}}if(u&&(r.push(this.ensureCacheObject(l)),r.length>=t))break}return r.sort(this.contactComparator),r}},{key:"findContactByEmail",value:function(e){for(var t=0,a=0;a<this._contacts.get().length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._contacts.get()[a];if(i.emails)for(var n=0,r=0;r<i.emails.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i.emails[r].address===e)return i}}}},{key:"findEmailsLike",value:function(e,t){var a=0;i.default.Assert(void 0!==e,"Must provide a valid email part"),t=t||20;for(var n=[],r=e.toUpperCase(),o=0;o<this._contacts.get().length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._contacts.get()[o];if(s&&s.emails){var l=0,u=!1;s.text&&s.text.toUpperCase().indexOf(r)>=0&&(u=!0);for(var d=0;d<s.emails.length;++d){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var c=s.emails[d].address;(u||c.toUpperCase().indexOf(r)>=0)&&n.push({type:"contact",text:s.text,email:c})}}if(n.length>=t)break}return n.sort(this.emailComparatorSort),n}},{key:"save",value:function(){c.a.saveContacts(this._contacts.get())}},{key:"clearLocalContacts",value:function(){c.a.clearContacts()}},{key:"handleRemoteContactLoad",value:function(e,t){var a=0,o=this.numContacts();i.default.log("Loading Remote Contacts!",e.length);for(var s=0;s<e.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=e[s],u={id:l.resourceName.replace("people/",""),text:""};if(l.names&&l.names.length>0){var d=l.names[0].displayName;u.text=d,"'"===u.text[0]&&(u.text=u.text.substr(1))}if(!u.text&&l.organizations){for(var c=0,h=0;h<l.organizations.length;h++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=l.organizations[h];f.metadata&&f.metadata.primary&&(u.text=f.name)}u.text||(u.text=l.organizations[0].name)}if(l.emailAddresses){var p=0;u.emails=[];for(var g=0;g<l.emailAddresses.length;g++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var m=l.emailAddresses[g],v={address:m.value,type:m.type,isPrimary:m.metadata&&m.metadata.primary};u.emails.push(v),!u.text&&v.isPrimary&&(u.text=v.address)}!u.text&&u.emails.length>0&&(u.text=u.emails[0].address)}if(l.phoneNumbers){var y=0;u.phoneNumbers=[];for(var _=0;_<l.phoneNumbers.length;_++){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;var b=l.phoneNumbers[_],k={number:b.value,type:b.type,isPrimary:b.metadata&&b.metadata.primary};u.phoneNumbers.push(k)}}u.text?0===o?this.addContact(u):this.updateContact(u):i.default.ShouldLog(r.a.LogLevels.Data)&&i.default.log("Contact entry with no name or email address",l)}e.length>0&&(this.save(),n.default.PaneUpdateBatcher.updateAllItems(!1,!0)),t&&t(e.length)}},{key:"syncContactInfo",value:function(e,t){var a=this;u.a.getAccountAuthToken(e,[r.a.GScope.Contacts],function(e){var n,r=[],o=e&&e.access_token,s=function(e){var i;try{i=JSON.parse(e.response)}catch(o){}i&&(r.pushArray(i.connections),i.nextPageToken?n(i.nextPageToken):a.handleRemoteContactLoad(r,t))};n=function(e){var t="https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,phoneNumbers,organizations&access_token=".concat(o)+(e?"&pageToken=".concat(e):"");i.default.XHR({type:"GET",url:t,cb:s})},o&&n()})}},{key:"refreshContacts",value:function(e){return this.clearLocalContacts(),!!n.default.settings.syncContacts.get()&&(this.syncContactInfo(i.default.getUserIdentifier(),function(t){e&&e()}),!0)}}])&&f(t.prototype,a),o&&f(t,o),e}()).prototype,"refreshContacts",[h.a],Object.getOwnPropertyDescriptor(s.prototype,"refreshContacts"),s.prototype),s);t.a=new p},function(e,t,a){"use strict";var i,n=a(0),r=a(1),o=a(3),s=a(14),l=a(5),u=a(6),d=a(16);function c(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var f=(h((i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._batchTimeout=void 0,this.itemsBatchingUpdates={}}var t,a,i;return t=e,(a=[{key:"beginBatch",value:function(e,t){n.default.isEmpty(this.itemsBatchingUpdates)&&(!u.e.undoRedoActive&&t?(this._savedSelectionDrive=l.a.save(),l.a.reset()):this._savedSelectionDrive=void 0,this._batchTimeout=setTimeout(this._runUpdates,500)),this.itemsBatchingUpdates[e.id]||(this.itemsBatchingUpdates[e.id]={item:e})}},{key:"commitBatch",value:function(e){var t=this.itemsBatchingUpdates[e.id];t&&(this._runUpdate(e,t),delete this.itemsBatchingUpdates[e.id])}},{key:"itemItemsChanged",value:function(e){this.updateItem(e,r.a.ItemProp.Items)}},{key:"itemTextChanged",value:function(e){this.updateItem(e,r.a.ItemProp.Text)}},{key:"itemDateChanged",value:function(e){this.updateItem(e,r.a.ItemProp.Date)}},{key:"itemTagsChanged",value:function(e,t){this.updateItem(e,r.a.ItemProp.Tags,t)}},{key:"itemFontChanged",value:function(e){this.updateItem(e,r.a.ItemProp.Font)}},{key:"itemSearchChanged",value:function(e){this.updateItem(e,r.a.ItemProp.Search)}},{key:"updateItem",value:function(e,t,a){if(a=a||!0,this.itemsBatchingUpdates[e.id]){var i=this.itemsBatchingUpdates[e.id];i||(i=this.itemsBatchingUpdates[e.id]={item:e}),i[t]=a,this._batchTimeout&&clearTimeout(this._batchTimeout),this._batchTimeout=setTimeout(this._runUpdates,500)}else this._runUpdate(e,function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({item:e},t,a))}},{key:"_runUpdate",value:function(e,t){s.a.fireEvent("clearMeasureCacheItem",[e.id]),!e.isDestroyed()&&e.getItemStore()&&e.getItemStore().onItemChanged(e,t)}},{key:"_runUpdates",value:function(){var e=this;n.default.batchRenderUpdates(function(){for(var t in o.default.PaneUpdateBatcher.beginUpdateItems(),e.itemsBatchingUpdates)if(e.itemsBatchingUpdates.hasOwnProperty(t)){var a=e.itemsBatchingUpdates[t];e._runUpdate(a.item,a)}e.itemsBatchingUpdates={},o.default.PaneUpdateBatcher.commitUpdateItems(),e._savedSelectionDrive&&l.a.restore(e._savedSelectionDrive)})}}])&&c(t.prototype,a),i&&c(t,i),e}()).prototype,"_runUpdate",[d.a],Object.getOwnPropertyDescriptor(i.prototype,"_runUpdate"),i.prototype),h(i.prototype,"_runUpdates",[d.a],Object.getOwnPropertyDescriptor(i.prototype,"_runUpdates"),i.prototype),i);t.a=new f},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3);function o(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=["data-href","plugin","plugin-id","appLink","tooltip","data-original-text","attachSimple","size"],l=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parsedText=t,this._textLength=t.length,this._attrs=a?i.default.clone(a):{},this._width=void 0}var t,a,n;return t=e,(a=[{key:"setWidth",value:function(e){this._width=e}},{key:"getWidth",value:function(e){return!this.isMarkdown()||r.default.settings.showMarkdown.get()&&e?this._width:this.isAppLinkStart()?20:0}},{key:"getParsedText",value:function(){return this._parsedText}},{key:"getOrigTextLength",value:function(){return this._textLength}},{key:"setParsedText",value:function(e){this._parsedText=e}},{key:"getUnstyledText",value:function(e){var t;if(this.getAttr("plugin")){i.default.Assert(this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well");var a=r.default.pluginManager.getPlugin(this._attrs.plugin),n=a.getAttachment(this.getAttr("plugin-id"));t=a.getUnstyledText(n)}else t=i.default.escape(this._parsedText);return t}},{key:"getStyledText",value:function(e,t,a){var n;if(this.getAttr("plugin")){i.default.Assert(this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well");var o=r.default.pluginManager.getPlugin(this._attrs.plugin),s=o.getAttachment(this.getAttr("plugin-id"));n=o._getDisplayText(s,e,a)}else n=t?this._parsedText:i.default.escape(this._parsedText);return n}},{key:"getAttrs",value:function(){return this._attrs}},{key:"getAttr",value:function(e){var t;return this._attrs&&(t=this._attrs[e]),t}},{key:"hasAttrs",value:function(){return!!this._attrs}},{key:"getClasses",value:function(){var e;return this._attrs&&(e=this._attrs.cls),e}},{key:"hasClasses",value:function(){var e=this.getClasses();return!!e&&e.length>0}},{key:"hasClass",value:function(e){var t=!1,a=this.getClasses();return a&&(t=a.indexOf(e)>=0),t}},{key:"getClassString",value:function(){var e="",t=this.getClasses();return t&&(e=t.join(" ")),e}},{key:"addClass",value:function(e){this._attrs||(this._attrs={}),this._attrs.cls||(this._attrs.cls=[]),this._attrs.cls.push(e)}},{key:"mergeAttrs",value:function(e){if(e)if(this._attrs){var t=0;e.cls&&(this._attrs.cls?this._attrs.cls=this._attrs.cls.concat(e.cls):this._attrs.cls=e.cls),i.default.Assert(void 0===this._attrs.plugin||void 0===e.plugin||this._attrs.plugin===e.plugin,"A single element cannot match multiple plugins"),i.default.Assert(void 0===this._attrs["plugin-id"]||void 0===e["plugin-id"]||this._attrs["plugin-id"]===e["plugin-id"],"A single element cannot match multiple plugins");for(var a=0;a<s.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=s[a],r=this._attrs[n]||e[n];r&&(this._attrs[n]=r)}}else this._attrs=e}},{key:"addAttr",value:function(e,t){this._attrs||(this._attrs={}),this._attrs[e]=t}},{key:"isMarkdown",value:function(){return this.hasClass("mdMarkup")}},{key:"isMDImage",value:function(){return this.hasClass("mdImage")}},{key:"isAppLinkStart",value:function(){return this.hasClass("mdMarkupStart")&&this._attrs.appLink}}])&&o(t.prototype,a),n&&o(t,n),e}(),u=a(34);function d(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=", . ? ! ) ( : ; [ ] ' \"".split(" "),h=0,f=["http","https","evernote","onenote","bear"],p=window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0},g=/(^#|[\(\s-]#)([^\s\),*#]+)/g,m=(n.a.Regexp.Link,n.a.Regexp.LinkExc),v=/(?:^|[\s\(\[])([^\(\[#@\s]+\.(?:com|org|net|io))/gi,y=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,_=n.a.Regexp.Prefix,b=/(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) /gi,k=n.a.Regexp.MDLink,w=/^(-{3,})$/g,S=/^([\*_]*)([^\*_]+)([\*_]*)/g,I=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,D=/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) (-{3,})$/g,C=/(\*\*\*)(.*?)\1/g,P=/(\*\*)(.*?)\1/g,A=/(__)(.*?)\1/g,M=/(\*)(\u2005*?)([^\u2005|\*]+?)\2\1/gi,T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,o;return t=e,(a=[{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"trimPunc",value:function(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}},{key:"generateStyledLines",value:function(e,t,a,i){for(var n=0,o=this.linesToEls(e,t),s=[],l=0;l<o.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;s.push(r.default.ElementRenderer.render(o[l],{convertLines:!1,pane:a,highlightSearch:i}))}return s}},{key:"linesToEls",value:function(e,t){for(var a=0,i=[],n=[],r=!1,o=0;o<t.length;++o){var s=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var u=0,d=t[o].start,c=t[o].length,h=0,f=0;f<e.length;++f){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var p=e[f],g=p.getParsedText().length,m=Math.max(d-u,0);if(m<g){var v=Math.min(g-m,c-h);if(v>0){var y=p.getParsedText().substr(m,v),_=new l(y,p.getAttrs());_.getAttr("appLink")&&!r&&_.addAttr("appLinkStart",!0),n.push(_),r=!!_.getAttr("appLink"),h+=v}}u+=g}i.push(n),n=[]}return i}},{key:"replaceTextInEls",value:function(e,t,a,n){var r=0;i.default.Assert(i.default.isArray(e),"Must supply a valid VMLIElement array"),i.default.Assert(t,"Must be replacing at least one of parsed or styled text");for(var o=0,s=0;s<e.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=e[s],u=l.getParsedText();if(a+n>=o&&a<o+l.getOrigTextLength()){var d=a-o,c=Math.min(n,u.length-d),h=u.substr(0,d),f=u.substr(d+c);t&&l.setParsedText(h+t+f);break}o+=l.getOrigTextLength()}}},{key:"getElAtOffset",value:function(e,t){for(var a=0,i=0,n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n],o=r.getOrigTextLength();if(t>=i&&t<i+o)return r;i+=o}}},{key:"insertEl",value:function(e,t,a,n){var r=0;i.default.Assert(i.default.isArray(t.cls),"Must always pass in a valid classes array"),i.default.Assert(i.default.isNumber(a),"Must have a valid start"),i.default.Assert(i.default.isNumber(n),"Must have a valid length");for(var o,s=0,u=n,d=0;d<e.length;++d){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=e[d],h=c.getParsedText();if(s<a+n&&a<s+c.getOrigTextLength()){var f=0,p=Math.max(a-s,0),g=Math.min(u,h.length),m=p+u,v=h.length-m;if(p>0){var y=h.substr(0,p);e.splice(d,0,new l(y,c.getAttrs())),f++}var _=h.substr(p,g);if((o=new l(_,c.getAttrs())).mergeAttrs(t),e.splice(d+f,1,o),f++,v>0){var b=h.substr(m,v);e.splice(d+f,0,new l(b,c.getAttrs()))}if(d+=f-1,u-=g,v>0)break}s+=c.getOrigTextLength()}return o}},{key:"_notifyParse",value:function(e){p.total++,p[e]++}},{key:"runParseSinglePlugin",value:function(e,t){return this.parseSinglePlugin(e.getRawText(),t)}},{key:"parseSinglePlugin",value:function(e,t){if(this._notifyParse("parseSinglePlugin"),!e||0===e.length)return{parsedText:void 0,els:void 0};var a,o;if(i.default.Assert(!h,"We do not support recursive calls to parse"),h++,"\u2001"===e[0]||"\u2003"===e[0]){var s=!i.default.isFlagSet(t,n.a.ChangeType.ItemLoad),u=r.default.pluginManager.parseAttachmentEmbedString(e.slice(1,-1),s);o=[u],e=n.a.AttachChar,s&&(a=[new l(n.a.AttachChar,u.displayElement.attrs)])}else a=[new l(e)];return h--,{parsedText:e,attachments:o,els:a}}},{key:"parseNote",value:function(e){return this._notifyParse("parseNote"),{parsedText:e.getRawText(),els:[new l(e.getRawText())]}}},{key:"runParseText",value:function(e){return this.parseText(e.getRawText(),u.a.getContacts())}},{key:"parseText",value:function(e,t,a,o,s){var u=0;if(this._notifyParse("parseText"),!e||0===e.length)return{parsedText:void 0,contacts:void 0,tags:void 0,attachments:void 0,els:[]};i.default.Assert(!h,"We do not support recursive calls to parse"),h++;var d,p,b,D,T,E,L,x,O,R=!1,F=e,N=e,B=0,U=!1,V=[new l(F)];o||(_.lastIndex=0,null!==(d=_.exec(F))&&(T=d[1])&&(B=d[0].length,0===T.indexOf("#")||0===T.indexOf("^")?(O="prefixHeader",E="header"):"["===T||"[]"===T||"[ ]"===T||"]"===T||"("===T||"()"===T||"( )"===T||")"===T?(O="prefixTask icon-square-o",E="task"):"*"===T||"-"===T||"+"===T?(O="prefixBullet",E="bullet"):(O="prefixNumList",E="numList"),this.insertEl(V,{cls:["itemPrefix",O]},0,B).setWidth(n.a.PrefixWidth),N=F.substr(B)));var j=0;for(y.lastIndex=0;null!==(d=y.exec(F));){if(j++>5e3&&__infLoop&&__infLoop(j))throw new RangeError;var H=r.default.pluginManager.parseAttachmentEmbedString(d[1],!0),z=this.insertEl(V,H.displayElement.attrs,d.index,d[0].length);this.replaceTextInEls(V,n.a.AttachChar,d.index,d[0].length);var q=V.indexOf(z);q>0&&z.addClass("padB"),q<V.length-1&&z.addClass("padA"),R=!0,D?D.push(H):D=[H]}var W=0,G=0,K=0,Y=0,X=0;for(k.lastIndex=0;null!==(d=k.exec(N));){if(W++>5e3&&__infLoop&&__infLoop(W))throw new RangeError;var Q=d[3],J=Q.indexOf("://")>0?Q:"http://"+Q,Z=!!i.default.parseEvernoteLink(Q),$=i.default.isOneNoteLink(Q),ee=i.default.isBearLink(Q),te=Z||$||ee,ae=["mdMarkup","mdMarkupStart"],ie=B+d.index+d[1].length,ne="!"===d[1],re=d[4]||"",oe=re&&+re.replace(/\s|=|x/g,"");ne?(this.insertEl(V,{attachSimple:"inlineImage",cls:["mdImage"],"data-href":J,"data-original-text":d[0],size:oe},B+d.index,d[0].length),U=!0):d[2]&&(Z?ae.push("evernote"):$?ae.push("onenote"):ee&&ae.push("bear"),this.insertEl(V,{cls:ae,appLink:te},B+d.index,1+d[1].length),this.insertEl(V,{cls:["mdSpan","link","c-link"].concat(i.default.isUrlImage(J)?"linkImage":[]),appLink:te,"data-href":J,"data-original-text":d[0]},ie+1,d[2].length),this.insertEl(V,{cls:["mdMarkup"],appLink:te},ie+1+d[2].length,2),this.insertEl(V,{cls:["mdSpan","link","c-link","mdMarkup"].concat(i.default.isUrlImage(J)?"linkImage":[]),appLink:te,"data-href":J,"data-original-text":d[0]},ie+d[2].length+3,Q.length+re.length),this.insertEl(V,{cls:["mdMarkup","mdMarkupEnd"],appLink:te},ie+d[2].length+re.length+Q.length+3,1),U=!0)}if(!U){var se,le,ue,de;if(m.lastIndex=0,null!==(d=m.exec(N)))ue=f.indexOf(d[3])>=0?d[2]:"http://"+d[2],se=d.index+B,le=d[0].length,de="!"===d[1];else if(v.lastIndex=0,null!==(d=v.exec(N))){var ce=d[0].length-d[1].length;ue=d[1].startsWith("http")?d[1]:"http://"+d[1],se=d.index+ce+B,le=d[1].length}if(ue)if(de)this.insertEl(V,{attachSimple:"inlineImage",cls:["mdImage"],"data-href":ue,"data-original-text":d[0]},B+d.index,d[0].length);else{var he=i.default.parseEvernoteLink(ue),fe=i.default.isOneNoteLink(ue),pe=i.default.isBearLink(ue),ge={cls:["link","c-link"].concat(i.default.isUrlImage(ue)?"linkImage":[]),"data-href":ue};he&&(ge.appLink=!0,ge.cls.push("evernote")),fe&&(ge.appLink=!0,ge.cls.push("onenote")),pe&&(ge.appLink=!0,ge.cls.push("bear")),this.insertEl(V,ge,se,le)}}for(A.lastIndex=0;null!==(d=A.exec(N));){if(G++>5e3&&__infLoop&&__infLoop(G))throw new RangeError;this.isInTag(d)||this.getElAtOffset(V,d.index).hasClass("link")||(this.insertEl(V,{cls:["mdMarkup","mdMarkupStart"]},B+d.index,d[1].length),this.insertEl(V,{cls:["mdSpan","mdUnderline"]},B+d.index+d[1].length,d[2].length),this.insertEl(V,{cls:["mdMarkup","mdMarkupEnd"]},B+d.index+d[1].length+d[2].length,d[1].length))}for(C.lastIndex=0;null!==(d=C.exec(N));){if(K++>5e3&&__infLoop&&__infLoop(K))throw new RangeError;this.isInTag(d)||this.getElAtOffset(V,d.index).hasClass("link")||(this.insertEl(V,{cls:["mdMarkup","mdMarkupStart"]},B+d.index,d[1].length),this.insertEl(V,{cls:["mdSpan","mdBold","mdItalic"]},B+d.index+d[1].length,d[2].length),this.insertEl(V,{cls:["mdMarkup","mdMarkupEnd"]},B+d.index+d[1].length+d[2].length,d[1].length))}var me=N.replace(C,"\u2005\u2005\u2005$2\u2005\u2005\u2005");for(P.lastIndex=0;null!==(d=P.exec(me));){if(Y++>5e3&&__infLoop&&__infLoop(Y))throw new RangeError;this.isInTag(d)||this.getElAtOffset(V,d.index).hasClass("link")||(this.insertEl(V,{cls:["mdMarkup","mdMarkupStart"]},B+d.index,d[1].length),this.insertEl(V,{cls:["mdSpan","mdBold"]},B+d.index+d[1].length,d[2].length),this.insertEl(V,{cls:["mdMarkup","mdMarkupEnd"]},B+d.index+d[1].length+d[2].length,d[1].length))}for(me=me.replace(P,"\u2005\u2005$2\u2005\u2005"),M.lastIndex=0;null!==(d=M.exec(me));){if(X++>5e3&&__infLoop&&__infLoop(X))throw new RangeError;this.isInTag(d)||this.getElAtOffset(V,d.index).hasClass("link")||(this.insertEl(V,{cls:["mdMarkup","mdMarkupStart"]},B+d.index,d[1].length),this.insertEl(V,{cls:["mdSpan","mdItalic"]},B+d.index+d[1].length+d[2].length,d[3].length),this.insertEl(V,{cls:["mdMarkup","mdMarkupEnd"]},B+d.index+d[1].length+d[2].length+d[3].length+d[2].length,d[1].length))}for(w.lastIndex=0,null!==(d=w.exec(N))&&this.insertEl(V,{cls:["mdSpan","mdHR","c-border-heavy"]},0,F.length),I.lastIndex=0;null!==(d=I.exec(F));){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;this.getElAtOffset(V,d.index).hasClass("link")||this.insertEl(V,{cls:["email","c-contact"]},d.index,d[1].length)}if(t&&Object.keys(t).length>0&&F.indexOf(n.a.ContactPrefix)>=0){var ve,ye=0,_e=F.split(/\s/),be=0;for(L=0;L<_e.length;L++){if(ye++>5e3&&__infLoop&&__infLoop(ye))throw new RangeError;var ke=_e[L].replace(S,"$2"),we=_e[L].indexOf(ke);if(0===ke.indexOf(n.a.ContactPrefix)){var Se=0;ve=void 0;var Ie=ke.substring(1);for(x=1;;x++){if(Se++>5e3&&__infLoop&&__infLoop(Se))throw new RangeError;if(""===t[Ie])ve=Ie;else{var De=this.trimPunc(Ie);if(""!==t[De])break;ve=De}if(!(L+x<_e.length))break;Ie+=" "+_e[L+x]}ve&&(b?b.push(ve):b=[ve],this.insertEl(V,{cls:["contact","c-contact"]},be+we,ve.length+1))}be+=_e[L].length+1}}var Ce=0;for(g.lastIndex=0;null!==(d=g.exec(F));){var Pe=0;if(Ce++>5e3&&__infLoop&&__infLoop(Ce))throw new RangeError;for(var Ae=d.index+d[1].length-1,Me=d[2].length+1,Te=d[2];c.indexOf(Te.charAt(Te.length-1))>=0;){if(Pe++>5e3&&__infLoop&&__infLoop(Pe))throw new RangeError;Me--,Te=Te.substr(0,Te.length-1)}Te&&(p?p.push(Te):p=[Te]),this.insertEl(V,{cls:["tag","c-tag"]},Ae,Me)}return D&&(y.lastIndex=0,F=F.replace(y,n.a.AttachChar)),h--,{parsedText:R?F:void 0,durations:void 0,tags:p,attachments:D,contacts:b,prefix:T,prefixType:E,els:V}}},{key:"isInTag",value:function(e){for(var t=0,a=e.index;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "===e.input[a])return!1;if("#"===e.input[a])return!0}return!1}},{key:"checkMultiplePrefixes",value:function(e){var t,a,i=0;for(b.lastIndex=0;null!==(a=b.exec(e));){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t)a.index===t[0].length&&(e=e.substr(a.index));else{if(0!==a.index)break;t=a}}return e=e.replace(D,n.a.TextMDHR)}}])&&d(t.prototype,a),o&&d(t,o),e}();t.a=new T},function(e,t,a){"use strict";var i,n=a(0),r=a(1),o=a(3),s=a(2),l=a(7),u=a(39),d=a(12),c=a(54),h=a(24),f=a(16),p=a(70);function g(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var v=r.a.TaskViewMode,y=1,_=(m((i=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._isSaving=!1,this._isAdding=!1,this._localState=void 0,this._selectionState=void 0,this._boards=new h.a,this.selectedIndex=new l.a,this.selected=new c.a([this.selectedIndex],function(){return t.get()}),this.selectedChanged=new u.a}var t,a,i;return t=e,(a=[{key:"init",value:function(){this.load()}},{key:"setIsAdding",value:function(e){this._isAdding=e}},{key:"isAdding",value:function(){return this._isAdding}},{key:"add",value:function(e){this.setIsAdding(!0);var t={id:this.getNextID(),name:this.getNextName(),panes:e||[],index:this._boards.length()};return this._boards.push(t),this.saveBoard(t),t}},{key:"removeBoard",value:function(e){if(this._boards.length()>1){var t=this._boards.indexOf(e),a=this.selectedIndex.get();this._boards.remove(e),!isNaN(a)&&a>=t&&this.setSelectedIndex(a-1),d.a.deleteBoard(e.id),this._localState&&delete this._localState[e.id]}}},{key:"length",value:function(){return this._boards.length()}},{key:"ensureSelected",value:function(){if(s.a.isMobile)o.default.PaneManager.onLoadRemote();else{var e=this.selectedIndex.get();(void 0===e||e<0||e>=this.length())&&this.setSelectedIndex(0,!0)}}},{key:"setSelectedIndex",value:function(e,t){var a=e!==this.selectedIndex.get();this.selectedIndex.set(e),(t||!1!==t&&a)&&this.selectedChanged.notify(),this._selectionState!==e&&(this._selectionState=e,o.default.settings.selectedBoard.set(this._selectionState))}},{key:"switchTo",value:function(e){var t=this._boards.indexOf(e);this.setSelectedIndex(t)}},{key:"_findMatchingLocalPane",value:function(e,t){var a;if(t)for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t[n].id===e){a=t[n];break}}return a}},{key:"_generateUsablePaneState",value:function(e,t){for(var a=0,i=[],r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e[r],s=this._findMatchingLocalPane(o.id,t)||o;i.push(n.default.cloneWithoutUndefineds({id:o.id,name:o.name,item:o.item,document:o.document||d.a.getDefaultDocument().id,type:o.type,showarch:o.showarch,search:o.search,viewState:o.viewState||(o.viewMode?{viewMode:o.viewMode}:void 0),displayLocalItems:o.displayLocalItems,displayCalendars:o.displayCalendars,blocksCollapsed:o.blocksCollapsed,widthManual:o.widthManual,widthManualExpanded:o.widthManualExpanded,offset:s?s.offset:0,itemState:s?s.itemState:{},isOverviewVisible:!!s&&s.isOverviewVisible,isOverviewShowingContents:!!s&&s.isOverviewShowingContents,isExpanded:!!s&&s.isExpanded,selectedItem:s?s.selectedItem:void 0}))}return i}},{key:"hasLoadedPaneState",value:function(){return!!this._localState}},{key:"getPaneState",value:function(){var e=this.get();return e?this._generateUsablePaneState(e.panes||[],this._localState[e.id]):[]}},{key:"_generateSyncPaneState",value:function(e){for(var t=0,a=[],i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i];a.push({id:n.id,name:n.name,item:n.item,type:n.type,document:n.document,showarch:n.showarch,search:n.search,viewState:n.viewState,displayCalendars:n.displayCalendars,displayLocalItems:n.displayLocalItems,widthManual:n.widthManual,widthManualExpanded:n.widthManualExpanded,blocksCollapsed:n.blocksCollapsed})}return a}},{key:"_generateLocalPaneState",value:function(e){for(var t=0,a=[],i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i];a.push({id:n.id,offset:n.offset,itemState:n.itemState,isOverviewVisible:n.isOverviewVisible,isOverviewShowingContents:n.isOverviewShowingContents,isExpanded:n.isExpanded,selectedItem:n.selectedItem})}return a}},{key:"savePaneState",value:function(e){if(this._boards.length()>0)try{this._saveSyncState(e),this._saveLocalState(e),this.saveBoard()}catch(t){n.default.reportError(t,{numBoards:this._boards.length(),selectedIndex:this.selectedIndex.get()})}}},{key:"_saveLocalState",value:function(e){var t=this.get().id;n.default.Assert(t,"Must have a valid board ID");var a=this._generateLocalPaneState(e);this._localState[t]=a}},{key:"_saveSyncState",value:function(e){var t=this.get();n.default.Assert(t,"Selected board does not exist"),t&&(t.panes=this._generateSyncPaneState(e))}},{key:"renameBoard",value:function(e,t){if(e.name!==t){for(var a=0,i=!1,n=0;n<this._boards.length();n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._boards.get()[n];r!==e&&r.name===t&&(i=!0)}if(!i)return e.name=t,this.saveBoard(e),this.selected.notify(),!0}return!1}},{key:"saveBoardDefault",value:function(e){e.defaultPanes=n.default.clone(e.panes),this.saveBoard(e)}},{key:"restoreBoardDefault",value:function(e){e.panes=n.default.clone(e.defaultPanes),this.selectedChanged.notify()}},{key:"get",value:function(){var e=this.selectedIndex.get();if(void 0!==e)return this._boards.get()[e]}},{key:"createDefaultState",value:function(){var e=d.a.getDefaultDocument(),t=[];if(e){var a=e.getRootItem();t=[{id:d.a.generateID(),name:"Tasks",index:0,panes:[{document:e.id,item:a.id,type:r.a.PaneMode.Task,viewState:{viewMode:v.Outline},isOverviewVisible:!0}]},{id:d.a.generateID(),name:"Today",index:1,panes:[{document:e.id,item:a.id,type:r.a.PaneMode.Task,viewState:{viewMode:v.Agenda_Today},isOverviewVisible:!0}]},{id:d.a.generateID(),name:"Calendar",index:2,panes:[{document:e.id,item:a.id,type:r.a.PaneMode.Task,viewState:{viewMode:v.Calendar_Week}}]}],o.default.pluginManager.isEnabled(r.a.PluginID.Gmail)&&t.splice(2,0,{id:d.a.generateID(),name:"Email",index:1.5,panes:[{type:r.a.PaneMode.Gmail,isOverviewVisible:!0,isExpanded:!0}]})}return this._boards.set(t),this.saveAll(),this.setSelectedIndex(0,!0),t}},{key:"getNextName",value:function(){var e,t,a=0,i=this._boards.get(),n=1;do{var r=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=!1,t="Board "+n,n++;for(var o=0;o<i.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i[o].name===t){e=!0;break}}}while(e);return t}},{key:"getNextID",value:function(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++y}},{key:"cmpSort",value:function(e,t){return e.index-t.index}},{key:"load",value:function(){var e,t;if(n.default.isDemoMode())t=this.createDefaultState(),e={};else if(this.trackPaneState()){var a=d.a.getBoards();(t=Object.keys(a).map(function(e){return a[e]})).sort(this.cmpSort);try{e=o.default.settings.localPaneState.get()||{}}catch(i){e={}}}else e={};this._localState=e,t&&t.length>0&&(this._selectionState=o.default.settings.selectedBoard.get(),void 0===this._selectionState&&(this._selectionState=0),!isNaN(this._selectionState)&&this._selectionState>=t.length&&(this._selectionState=t.length-1),this._boards.set(t),this.setSelectedIndex(this._selectionState,!0))}},{key:"setBoards",value:function(e){this._boards.set(e),this.selectedIndex.get()<0&&this.setSelectedIndex(0)}},{key:"saveAll",value:function(){var e=this;this.trackPaneState()&&this._boards.get().forEach(function(t){e.saveBoard(t)})}},{key:"saveBoard",value:function(e){if(this.trackPaneState()){e||(e=this.get());var t=this.getBoardSaveInfo(e.id);d.a.setBoard(t),o.default.settings.localPaneState.set(n.default.cloneWithoutUndefineds(this._localState))}}},{key:"getBoardSaveInfo",value:function(e){var t=this.getById(e);return t&&((t=n.default.cloneWithoutUndefineds(t)).panes&&(t.panes=t.panes.map(n.default.cloneWithoutUndefineds)),t.defaultPanes&&(t.defaultPanes=t.defaultPanes.map(n.default.cloneWithoutUndefineds))),t}},{key:"trackPaneState",value:function(){return!n.default.isRunningScript()&&!n.default.isDemoMode()}},{key:"onSettingChanged",value:function(){this._isSaving||this.load()}},{key:"moveTo",value:function(e,t){var a=this._boards.get(),i=a[e],n=this.get();this._boards.splice(e,1,void 0,!1);var r=a[t-1],o=a[t],s=Object(p.a)([r?r.index:void 0,o?o.index:void 0]);i.index=s,this._boards.splice(t,0,i);var l=this._boards.indexOf(n);l>=0&&this.setSelectedIndex(l,!1),this.saveBoard(i)}},{key:"cloneBoard",value:function(e,t){var a;(e=e||this.get(),t)?a=[t.getSaveInfoForClone()]:a=e.panes;n.default.Assert(a,"Must have valid panes to clone a board");var i=this.add(a);return this.switchTo(i),i}},{key:"getById",value:function(e){return this._boards.get().find(function(t){return t.id===e})}},{key:"onRemoteUpdate",value:function(e,t){var a=t.id,i=t.name,n=t.panes,o=t.index,s=t.defaultPanes,l=this.getById(a);if(e===r.a.CrudActions.Removed)this.removeBoard(l);else{if(!l)return this._boards.insertSorted({id:a,name:i,panes:n,index:o,defaultPanes:s},this.cmpSort),!0;l.name=i,l.panes=n,l.index=o,l.defaultPanes=s,this.selected.notify()}}},{key:"hotkeyPrevBoard",value:function(){var e=this.selectedIndex.get()-1;e<0&&(e=this.length()-1),this.setSelectedIndex(e)}},{key:"hotkeyNextBoard",value:function(){var e=this.selectedIndex.get()+1;e>=this.length()&&(e=0),this.setSelectedIndex(e)}},{key:"selectBoard",value:function(e){e>=0&&e<this.length()&&this.setSelectedIndex(e)}},{key:"clear",value:function(){this._boards.clear()}}])&&g(t.prototype,a),i&&g(t,i),e}()).prototype,"saveAll",[f.a],Object.getOwnPropertyDescriptor(i.prototype,"saveAll"),i.prototype),m(i.prototype,"saveBoard",[f.a],Object.getOwnPropertyDescriptor(i.prototype,"saveBoard"),i.prototype),m(i.prototype,"hotkeyPrevBoard",[f.a],Object.getOwnPropertyDescriptor(i.prototype,"hotkeyPrevBoard"),i.prototype),m(i.prototype,"hotkeyNextBoard",[f.a],Object.getOwnPropertyDescriptor(i.prototype,"hotkeyNextBoard"),i.prototype),m(i.prototype,"selectBoard",[f.a],Object.getOwnPropertyDescriptor(i.prototype,"selectBoard"),i.prototype),i);t.a=new _},function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(1),r=a(3),o=a(2),s=a(6),l=a(5),u=a(29),d=a(28),c=a(32);function h(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f={None:0,Left:1,Right:2,StartLine:3,EndLine:4,LeftWord:5,RightWord:6,Down:7,Up:8,PageDown:9,PageUp:10,Top:11,Bottom:12,PrevHeader:13,NextHeader:14,All:15},p=[n.a.KeyCode.Tab,n.a.KeyCode.Backspace,n.a.KeyCode.Delete],g=[n.a.KeyCode.UpArrow,n.a.KeyCode.DownArrow,n.a.KeyCode.LeftArrow,n.a.KeyCode.RightArrow,n.a.KeyCode.Home,n.a.KeyCode.End,n.a.KeyCode.A,n.a.KeyCode.E,n.a.KeyCode.F,n.a.KeyCode.B,n.a.KeyCode.PageUp,n.a.KeyCode.PageDown],m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,m;return t=e,(a=[{key:"getNavigationAction",value:function(e){var t=o.a.mac,a=e.ctrlKey&&!e.altKey&&!e.metaKey,i=e.altKey&&!e.ctrlKey&&!e.metaKey,r=e.metaKey&&!e.ctrlKey&&!e.altKey,s=!e.ctrlKey&&!e.altKey&&!e.metaKey,l=e.normCode,u=n.a.KeyCode,d=f;if(l===u.LeftArrow){if(a&&!o.a.mac||i&&o.a.mac)return d.LeftWord;if(r&&t)return d.StartLine;if(s)return d.Left}if(l===u.RightArrow){if(a&&!o.a.mac||i&&o.a.mac)return d.RightWord;if(r&&t)return d.EndLine;if(s)return d.Right}if(l===u.UpArrow){if(t&&r)return d.Top;if(t&&a)return d.PageUp;if(t&&i)return d.StartLine;if(!t&&a)return d.PrevHeader;if(s)return d.Up}if(l===u.DownArrow){if(t&&r)return d.Bottom;if(t&&a)return d.PageDown;if(t&&i)return d.EndLine;if(!t&&a)return d.NextHeader;if(s)return d.Down}if(l===u.A&&a&&t)return d.StartLine;if(l===u.E&&a&&t)return d.EndLine;if(l===u.B&&a&&t)return d.Left;if(l===u.F&&a&&t)return d.Right;if(l===u.Home&&!t){if(a)return d.Top;if(s)return d.StartLine}if(l===u.End&&!t){if(a)return d.Bottom;if(s)return d.EndLine}return l===u.PageUp&&s?d.PageUp:l===u.PageDown&&s?d.PageDown:l===u.A&&r&&t||l===u.A&&a&&!t?d.All:d.None}},{key:"updateAutocomplete",value:function(e){var t=e&&e.normCode&&g.indexOf(e.normCode)>=0&&"#"!==e.key;if(!o.a.isMobile&&!i.default.isDemoRunning&&l.a.isValid()){var a=l.a.getStartIndex(),n=l.a.getStartItem(),r=l.a.getStartOffset(),s=l.a.getPane();l.a.isValid()&&n===l.a.getEndItem()&&r===l.a.getEndOffset()&&s.isIndexMounted(a)?d.a.updateFromPane({owner:n,pane:s,index:a,start:r,element:l.a.getStartElement(),fromArrows:t}):d.a.hide()}}},{key:"stopPropagation",value:function(e){i.default.Assert(e.stopImmediatePropagation,"Should always be defined"),e.stopImmediatePropagation&&e.stopImmediatePropagation()}},{key:"preventDefault",value:function(e){i.default.Assert(e.preventDefault,"Should always be defined"),e.preventDefault&&e.preventDefault()}},{key:"keyup",value:function(e,t){if(o.a.isMobile&&l.a.scrollStartIntoView(o.a.ios),t.normCode===n.a.KeyCode.Space&&c.a.clearGroupTextChanges(),this.stopPropagation(t),this.preventDefault(t),this.isTyping=!1,t.handled)return!0}},{key:"handleSelectAll",value:function(e){var t=e.indexOfFirstItem(),a=e.indexOfLastItem();return l.a.selectIndices(t,0,a,-1,n.a.SelectOption.AllowPrefix),!1}},{key:"handleSelectAllItem",value:function(){if(i.default.focusedPane&&i.default.focusedPane.isWriteable)return l.a.selectIndex(l.a.getStartIndex(),0,-1),!1}},{key:"_move",value:function(e){i.default.Assert(e===n.a.Direction.Up||e===n.a.Direction.Down,"Must move in a direction");var t,a,r=i.default.focusedPane,o=l.a.getStartIndex(),u=l.a.getEndIndex(),d=l.a.getStartItem(),c=l.a.getEndItem(),h=!1;if((d.parent()===c.parent()&&(h=!0),!h)&&!r.getNextItem(l.a.getEndIndex(),!0))for(var f=0;c;){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;if(d.parent()===c.parent()){h=!0;break}c=c.parent()}if(h&&(e===n.a.Direction.Up?(t=r.getPreviousItem(o,!0),a=c.getIndex()+1):(t=r.getNextItem(u,!0),a=d.getIndex()),t)){s.e.beginAction(),r.setIgnoreRestoreScroll();var p=l.a.save();l.a.reset();var g=1+t.numChildrenRecursive();i.default.setItemAnimationMode(n.a.ItemAnimationMode.Move),t.moveTo({parent:t.parent(),index:a},n.a.ChangeType.Local),i.default.resetItemAnimationMode(),e===n.a.Direction.Up?(p.startIndex-=g,p.endIndex-=g):e===n.a.Direction.Down&&(p.startIndex+=g,p.endIndex+=g),l.a.restore(p),e===n.a.Direction.Up?l.a.scrollStartIntoView():l.a.scrollEndIntoView(),s.e.endAction()}}},{key:"moveUp",value:function(){!i.default.focusedPane.isViewAgenda()&&l.a.isValid()&&this._move(n.a.Direction.Up)}},{key:"moveDown",value:function(){!i.default.focusedPane.isViewAgenda()&&l.a.isValid()&&this._move(n.a.Direction.Down)}},{key:"handleArrows",value:function(e,t){var a=i.default.focusedPane;if(!l.a.isValid())return!0;var s=this.getNavigationAction(t),d=f;switch(l.a.preferLineStart=!1,s){case d.Left:case d.Right:case d.StartLine:case d.EndLine:case d.LeftWord:case d.RightWord:var c,h,p,g,m,v,y=s===d.Left||s===d.LeftWord||s===d.StartLine,_=s===d.Right||s===d.RightWord||s===d.EndLine;y&&(!t.shiftKey||l.a.isArrowSelectInverted())||_&&t.shiftKey&&l.a.isArrowSelectInverted()||s===d.StartLine&&l.a.getStartIndex()===l.a.getEndIndex()?(p=l.a.getStartOffset(),g=l.a.getStartIndex(),v=l.a.getStartTotal(),c=l.a.getStartObject()):(p=l.a.getEndOffset(),g=l.a.getEndIndex(),v=l.a.getEndTotal(),c=l.a.getEndObject());var b,k=c.item;if(h=k.getParsedText(),s===d.StartLine)m=r.default.Measure.getCaretOffset(c,a,p).lineStart,g=l.a.isArrowSelectInverted()?l.a.getStartIndex():l.a.getEndIndex(),v=l.a.isArrowSelectInverted()?l.a.getStartTotal():l.a.getEndTotal();else if(s===d.EndLine){var w=r.default.Measure.getCaretOffset(c,a,p);k.metricsInPane(a,g);m=w.lineStart+w.lineLength,g=l.a.isArrowSelectInverted()?l.a.getStartIndex():l.a.getEndIndex()}else if(s===d.LeftWord){var S=u.a.getPreviousWord(k,h,p-1),I=h.prevIndexOf(n.a.AttachChar,p);if(I<0||I<=S)if(-1===S&&0===p)if(r.default.settings.selectFullItems.get()&&t.shiftKey)m=0;else if(g>0){if((g=a.indexOfPrevVMLI(g,!1,!0))>=0){var D=a.itemAtIndex(g).getParsedText();m=u.a.getPreviousWord(k,D,D.length-1)+1,v=D.length}}else m=-1;else m=S+1;else I>S&&(m=I+1,I+1===p&&m--)}else if(s===d.RightWord){var C=u.a.getNextWord(k,h,p+1),P=h.indexOf(n.a.AttachChar,p);if(P<0||P>=C)if(C===v)if(p!==v||t.shiftKey&&r.default.settings.selectFullItems.get())m=v;else if(g<a.numItems()-1){if((g=a.indexOfNextVMLI(g,!1,!0))>=0){var A=(b=a.itemAtIndex(g)).getParsedText();C=u.a.getNextWord(b,A,0),v=A.length,-1===C&&(C=A.length),m=C}}else m=v+1;else m=C;else(C>P||C<0)&&P>=0&&(m=P,P===p&&m++)}else s===d.Left?m=l.a.getStartOffset()===l.a.getEndOffset()||t.shiftKey?u.a.moveLeft(k,p):l.a.getStartOffset():s===d.Right&&(m=l.a.getStartOffset()===l.a.getEndOffset()||t.shiftKey?u.a.moveRight(k,p,v):l.a.getEndOffset());if(l.a.preferLineStart=y,!b&&(!r.default.settings.selectFullItems.get()||!t.shiftKey))if(m<l.a.getStartItem().getPrefixLength()&&s!==d.StartLine)if(l.a.preferLineStart=!1,g>0){g=a.indexOfPrevVMLI(g,!1,!0);var M=a.itemAtIndex(g);m=M.getParsedText().length,u.a.isInsideMarkup(M,m)&&(m=u.a.moveLeft(M,m))}else m=0;else m>v&&(g<a.numItems()-1?(g=a.indexOfNextVMLI(g,!1,!0),m=0):m=v);if(t.shiftKey){var T=l.a.isArrowSelectInverted()?l.a.getEndIndex():l.a.getStartIndex(),E=l.a.isArrowSelectInverted()?l.a.getEndOffset():l.a.getStartOffset();!l.a.isArrowSelectInverted()&&y&&g<=l.a.getStartIndex()&&m>=-1&&m<l.a.getStartOffset()?l.a.setArrowSelectInverted(!0):l.a.isArrowSelectInverted()&&_&&g>=l.a.getEndIndex()&&m>l.a.getEndOffset()&&l.a.setArrowSelectInverted(!1),l.a.isArrowSelectInverted()?l.a.selectIndices(g,m,T,E):l.a.selectIndices(T,E,g,m)}else l.a.selectIndex(g,m);if(o.a.isFirefox)if(t.normCode===n.a.KeyCode.LeftArrow){if(k.getParsedText()[l.a.getStartOffset()-1]===n.a.AttachChar&&!t.shiftKey)return l.a.selectItem(k,l.a.getStartOffset()-1),!1}else if(t.normCode===n.a.KeyCode.RightArrow){if(k.getParsedText()[l.a.getEndOffset()]===n.a.AttachChar&&!t.shiftKey)return l.a.selectItem(k,l.a.getEndOffset()+1),!1}y?l.a.scrollStartIntoView():l.a.scrollEndIntoView();break;case d.Up:case d.Down:case d.Top:case d.Bottom:case d.PageUp:case d.PageDown:case d.PrevHeader:case d.NextHeader:var L,x,O,R=s===d.Up||s===d.Top||s===d.PageUp,F=s===d.Down||s===d.Bottom||s===d.PageDown;R&&(!t.shiftKey||l.a.isArrowSelectInverted())||F&&t.shiftKey&&l.a.isArrowSelectInverted()?(O=l.a.getStartOffset(),x=l.a.getStartIndex(),L=l.a.getStartObject()):(O=l.a.getEndOffset(),x=l.a.getEndIndex(),L=l.a.getEndObject());var N,B=L.item,U=r.default.Measure.getCaretOffset(L,a,O),V=r.default.Measure.getCaretScreenPosition(a,x,O),j=(U.lineOffset,V.left);if(l.a.preferLineStart=U.lineOffset<=2,s===d.Up){var H=U.line-1;if(0===x&&H<0)N=0,H=0;else{if(H<0&&x>0)if((x=a.indexOfPrevVMLI(x,!1,!0))>=0)B=a.itemAtIndex(x),L=a.objectAtIndex(x),H=r.default.Measure.getCaretOffset(L,a).line;H>=0&&(N=r.default.Measure.getOffsetForScreenPositionInLine(x,L,a,H,j))}}else if(s===d.Down){var z=U.line+1;z>B.metricsInPane(a,x).styledLines.length-1&&(x<a.numItems()-1&&(x=a.indexOfNextVMLI(x,!1,!0))>=0?(B=a.itemAtIndex(x),z=0):z=U.line),x>=0&&(L=a.objectAtIndex(x),N=r.default.Measure.getOffsetForScreenPositionInLine(x,L,a,z,j))}else if(s===d.Top)x=a.indexOfFirstItem(),N=0;else if(s===d.Bottom){var q=a.getLastItem(),W=a.numItems();q&&W>0&&(x=a.indexOfLastItem(),N=q.getParsedText().length)}else if(s===d.PageUp){x=a.indexPageUp(l.a.getStartIndex()),N=0}else if(s===d.PageDown){var G=a.indexPageDown(l.a.getStartIndex());x=G,N=a.itemAtIndex(G).getParsedText().length}else{if(s===d.PrevHeader&&a.isViewOutline()){var K=l.a.getStartItem();if(K.parent()===i.default.focusedItem)K.isFirstChild()||(i.default.Assert(K.getIndex()>0,"Should never hit this with the first item in the list"),X=K.parent().getChild(K.getIndex()-1));else{for(var Y=0;K.parent()!==i.default.focusedItem;){if(Y++>5e3&&__infLoop&&__infLoop(Y))throw new RangeError;K=K.parent()}X=K}return void 0!==X&&l.a.selectItem(X,-1),!1}if(s===d.NextHeader&&a.isViewOutline()){var X,Q=l.a.getEndItem();if(Q.parent()===i.default.focusedItem)Q.isLastChild()||(X=Q.parent().getChild(Q.getIndex()+1));else{for(var J=0;Q.parent()!==i.default.focusedItem;){if(J++>5e3&&__infLoop&&__infLoop(J))throw new RangeError;Q=Q.parent()}Q.isLastChild()||(X=Q.parent().getChild(Q.getIndex()+1))}return void 0!==X&&l.a.selectItem(X,-1),!1}}if(x>=0&&!isNaN(N))if(t.shiftKey){T=l.a.isArrowSelectInverted()?l.a.getEndIndex():l.a.getStartIndex(),E=l.a.isArrowSelectInverted()?l.a.getEndOffset():l.a.getStartOffset();!l.a.isArrowSelectInverted()&&R&&(x===l.a.getStartIndex()&&N<l.a.getStartOffset()||x<l.a.getStartIndex())?l.a.setArrowSelectInverted(!0):l.a.isArrowSelectInverted()&&F&&(x===l.a.getEndIndex()&&N>l.a.getEndOffset()||x>l.a.getEndIndex())&&l.a.setArrowSelectInverted(!1),l.a.isArrowSelectInverted()?l.a.selectIndices(x,N,T,E):l.a.selectIndices(T,E,x,N)}else l.a.selectIndex(x,N);R?l.a.scrollStartIntoView():l.a.scrollEndIntoView();break;case d.All:this.handleSelectAll(a)}return s===d.None}},{key:"keydown",value:function(e,t){this.isTyping=!0;var a=!0;if(p.indexOf(t.normCode)>=0?a=this.keypress(e,t,!0):o.a.mac&&t.ctrlKey&&t.normCode===n.a.KeyCode.D?a=this.keypress(e,t,!0):g.indexOf(t.normCode)>=0?(i.default.setItemAnimationMode(n.a.ItemAnimationMode.None),a=this.handleArrows(e,t),i.default.resetItemAnimationMode(),o.a.ios||this.getNavigationAction(t)&&this.updateAutocomplete(t)):o.a.mac&&t.metaKey||!o.a.mac&&t.ctrlKey&&!t.altKey?t.normCode!==n.a.KeyCode.Y&&t.normCode!==n.a.KeyCode.Z||(a=this.keypress(e,t,!0)):o.a.mac&&t.ctrlKey&&t.normCode===n.a.KeyCode.H&&this.preventDefault(t),a&&l.a.getStartIndex()===l.a.getEndIndex()&&l.a.getStartOffset()===l.a.getEndOffset()){var r=l.a.getStartOffset(),s=l.a.getStartItem(),d=s.getParsedText();i.default.shouldLog(n.a.LogLevels.Edit)&&console.log("check markdown",r,d[r]),"]"===d[r]&&u.a.isInsideMarkup(s,r)&&(r=u.a.moveRight(s,r,d.length-1),l.a.selectIndex(l.a.getStartIndex(),r),l.a.focusHiddenInput(),i.default.shouldLog(n.a.LogLevels.Edit)&&console.log("Adjusted to",r))}return!o.a.isMobile&&a&&this.keyWantsScrollIntoView(t,!0)&&l.a.scrollStartIntoView(),a}},{key:"checkKeypressSpecialCases",value:function(e,t){var a;return e.ctrlKey&&e.altKey&&t?a=!0:e.metaKey&&e.normCode===n.a.KeyCode.Tilde&&(a=!1),a}},{key:"isMultiselectDangerous",value:function(){var e=0,t=i.default.focusedPane;if(!t.isViewOutline()&&!t.isViewProject())return"Are you sure you want to delete multiple items?";for(var a=t.indexOfNextVMLI(l.a.getStartIndex()-1),r=t.indexOfPrevVMLI(l.a.getEndIndex()+1),o=a,s=0;!isNaN(o)&&o>=0&&o<=r;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var u=t.itemAtIndex(o);if(t.isSearchedFlat()){if(t.search.isFlatSearchResult(u)&&s++,s>=2)return n.a.MessageID.FlatSearchMultiSelect}else if(++s>=8)return"You have selected a large number of items to delete. Are you sure?";o=t.indexOfNextVMLI(o)}return!1}},{key:"keypress",value:function(e,t,a,u){var d=[n.a.KeyCode.Enter,n.a.KeyCode.D];i.default.Assert(t.stopPropagation,"Should always be defined"),t.stopPropagation&&t.stopPropagation();var c=!0,h=i.default.focusedPane,f=t.normCode>=32||d.indexOf(t.normCode)>=0;if(!(0===t.which)&&(a||f)){if(o.a.mac&&t.metaKey||!o.a.mac&&t.ctrlKey)switch(String.fromCharCode(t.normCode)){case"c":case"C":return t.handled=!0,!0;case"v":case"V":return t.handled=!0,!0;case"x":case"X":return t.handled=!0,!0;case"Y":case"y":case"Z":case"z":return i.default.Assert(!1,"Should not be handled undo/redo hotkeys here"),t.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return t.handled=!0,!0}var p=l.a.getStartItem();s.e.beginAction();var g=[n.a.KeyCode.Tab,n.a.KeyCode.Enter,n.a.KeyCode.Backspace,n.a.KeyCode.Delete,n.a.KeyCode.D];if(l.a.getStartIndex()!==l.a.getEndIndex()&&t.normCode!==n.a.KeyCode.Tab&&(!t.metaKey&&!t.ctrlKey&&!t.altKey||g.indexOf(t.normCode)>=0))if(h.isViewOutline()||h.isViewProject()){var m;if(r.default.PaneUpdateBatcher.beginUpdateItems(),!u&&(m=this.isMultiselectDangerous())){if(h.isSearchedFlat())r.default.toasts.pushMessage(n.a.MessageID.FlatSearchMultiSelect);else{var v=l.a.save();r.default.menus.confirm(m,function(i){l.a.restore(v),i&&this.keypress(e,t,a,!0)}.bind(this))}c=!1}else c=!!h.isEditable&&(c&&this.handleMultiselect(t));r.default.PaneUpdateBatcher.commitUpdateItems()}else r.default.toasts.pushMessage({text:"Editing multiple items from this view is not currently supported. Please edit them individually.",actionText:"OKAY"}),c=!1;c&&g.indexOf(t.normCode)>=0&&(r.default.PaneUpdateBatcher.beginUpdateItems(),t.normCode===n.a.KeyCode.Enter?c=!!h.isEditable&&(c&&this.handleEnter(t)):t.normCode===n.a.KeyCode.Backspace?c=!!(p&&p.allowTextEditing()&&h.isEditable)&&(c&&this.handleBackspace(t)):(t.normCode===n.a.KeyCode.Delete||o.a.mac&&t.ctrlKey&&t.normCode===n.a.KeyCode.D)&&(c=!!(p&&p.allowTextEditing()&&h.isEditable)&&(c&&this.handleDelete(t))),r.default.PaneUpdateBatcher.commitUpdateItems()),s.e.endAction()}return!o.a.isMobile&&this.keyWantsScrollIntoView(t,a)&&l.a.scrollStartIntoView(),c}},{key:"handleMultiselect",value:function(e){var t=0,a=0,r=i.default.focusedPane,o=r.indexOfNextVMLI(l.a.getStartIndex()-1),u=r.indexOfPrevVMLI(l.a.getEndIndex()+1),d=l.a.getStartOffset(),h=l.a.getEndOffset();l.a.selectIndices(o,d,u,h,n.a.SelectOption.AllowPrefix);var f=!0,p=r.objectAtIndex(o),g=l.a.getStartItem(),m=l.a.getEndItem();if(g.isNote()&&(g=g.parent()),m.isNote()&&(m=m.parent()),!r.hasNonVMLIs&&g===m)return!1;if(e.normCode===n.a.KeyCode.Enter&&e.shiftKey)return!0;for(var v=[],y=(u=u,r.indexOfNextVMLI(o));y&&y>=0&&(y<u||y===u&&l.a.getEndOffset()===l.a.getEndTotal());){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;(x=r.itemAtIndex(y)).parent()===i.default.focusedPane.getItem()&&x.isHeader()&&0,v.indexOf(x)<0&&x!==g&&v.push(x),y=r.indexOfNextVMLI(y)}var _,b=l.a.getEndItem().levelsDeep.get()-l.a.getStartItem().levelsDeep.get();if(l.a.getStartOffset()>0||l.a.getEndOffset()<l.a.getEndTotal()){var k=g.splitUsableText(g.getParsedText(),d,d),w=m.splitUsableText(m.getParsedText(),h,h);_=k.before+w.after,s.e.performAction(s.c.Remove,{itemID:g.id,position:l.a.getStartOffset(),text:g.getParsedText().slice(l.a.getStartOffset())}),s.e.performAction(s.c.Insert,{itemID:g.id,position:l.a.getStartOffset(),text:m.getParsedText().substring(l.a.getEndOffset())}),v.indexOf(m)<0&&v.push(m),0===l.a.getStartOffset()&&g.copyProperties(m)}else s.e.performAction(s.c.Remove,{itemID:g.id,position:0,text:g.getParsedText()}),_="";if(e.normCode!==n.a.KeyCode.Backspace&&e.normCode!==n.a.KeyCode.Delete&&e.normCode!==n.a.KeyCode.Enter||(f=!1),g.setText(_,!0,n.a.ChangeType.Local),m.moveChildren(g,0,n.a.ChangeType.Local),b>0){for(var S=0,I=[],D=m.nextSibling();b>0&&D;){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;y=D.getIndex();var C=D.parent().getItems().slice(y);I=I.concat(C),D=D.parent().nextSibling(),b--}if(I.length>0)for(var P=0,A=g,M=(y=0,0);M<I.length;M++){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;var T=(x=I[M]).parent();if(v.indexOf(T)>=0){var E=x.getIndex();x.moveTo({parent:A,index:y},n.a.ChangeType.Local),s.e.performAction(s.c.Move,{itemID:x.id,oldParent:T.id,oldPosition:E,newParent:A.id,newPosition:y}),y++}}}else if(v.indexOf(m.parent())>=0)for(var L=0,x=(A=g.parent(),r.getNextItem(u,!0));x;){if(L++>5e3&&__infLoop&&__infLoop(L))throw new RangeError;y=A.numItems(),E=(T=x.parent()).getChildIndex(x);x.moveTo({parent:A,index:y},n.a.ChangeType.Local),s.e.performAction(s.c.Move,{itemID:x.id,oldParent:T.id,oldPosition:E,newParent:A.id,newPosition:y}),x=r.getNextItem(u,!0)}c.a.saveDeleteSelection(),c.a.beginAction();for(M=0;M<v.length;M++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;x=v[M];i.default.Assert(x,"Item must exist"),x.isDeleted()||x.parent().deleteChild(x,void 0,void 0,n.a.ChangeType.Local)}if(c.a.endAction(),r.hasNonVMLIs){var O=r.closestIndexOfObject(p);i.default.Assert(O>=0,"Could not find item to select"),O>=0&&l.a.selectIndex(O,d)}else l.a.selectIndex(o,d);return f}},{key:"handleTab",value:function(e){var t=0,a=l.a.getPane(),o=l.a.getStartItem(),u=l.a.getStartIndex(),d=l.a.getEndItem(),c=l.a.getStartObject(),h=l.a.getEndObject(),f=l.a.getStartOffset(),p=l.a.getEndOffset(),g=!e,m=g?0:1;if(c.levelsDeep<m)return!1;if(g&&a.isViewAutoBlocks()&&c.levelsDeep===m){var v=a.prevPaneObjectAtSameLevel(u);if(!v||v.block!==c.block||v.item.parent()!==o.parent())return!1}r.default.PaneUpdateBatcher.beginUpdateItems(),o&&o.isNote()&&(o=o.parent()),d&&d.isNote()&&(d=d.parent()),l.a.scrollStartIntoView();var y=o,_={},b=[o],k={},w={};if(w[o.id]=!0,o!==d){var S=0;do{if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;(y=i.default.getNextItem(y,a,{numLevels:0,ignoreSearch:!0}))&&(b.push(y),w[y.id]=!0)}while(y!==d&&void 0!==y)}var I,D,C,P=0;for(e?(I=function(){P=b.length-1},D=function(){return P>=0},C=function(){P--}):(I=function(){P=0},D=function(){return P<b.length},C=function(){P++}),I();D();C()){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var A=b[P];i.default.Assert(A,"Must always be tabbing/untabbing valid items");var M,T,E=A.parent(),L=E.getItems().indexOf(A);if(g){var x=0,O=void 0;if(M=L>0&&!c.isBlockHeader,a.search.isFlatSearchResult(A)&&(M=!1,r.default.toasts.pushMessage(n.a.MessageID.FlatSearchTab)),M)if(c.block){var R=a.prevPaneObjectAtSameLevel(u+P);R&&R.item&&(O=R.item,!0)}else O=E.itemAtIndex(L-1);if(M&&O){for(var F=0;O.isHidden(a);){if(F++>5e3&&__infLoop&&__infLoop(F))throw new RangeError;if(--L<=0)return r.default.PaneUpdateBatcher.commitUpdateItems(),!1;O=E.itemAtIndex(L-1)}k[E.id]||(_[A.parent().id]=A.parent(),_[O.id]=O,A.moveTo({parent:O,fromTab:!0},n.a.ChangeType.Local),O.isCollapsed(a,!1)&&O.setCollapsed(!1,a)),k[A.id]=!0,s.e.performAction(s.c.Move,{itemID:A.id,oldParent:E,oldPosition:L,newParent:O,newPosition:O.numItems()-1})}else O=E,k[A.id]=k[E.id];for(var N=!1,B=A;B;){if(x++>5e3&&__infLoop&&__infLoop(x))throw new RangeError;if(k[B.id]){B.isCollapsed(a,!1)||(N=!0);break}B=B.parent()}var U=A.getIndex()+1;if(N){var V=0,j=A.getItems(),H=0;for(T=0;T<j.length;T++){if(V++>5e3&&__infLoop&&__infLoop(V))throw new RangeError;var z=j[T];if(!w[z.id]){if(z.isHidden(a))continue;_[z.parent().id]=z.parent(),_[A.parent().id]=A.parent();var q=U+H;z.moveTo({parent:A.parent(),index:q,fromTab:!0},n.a.ChangeType.Local),k[z.id]=!0,s.e.performAction(s.c.Move,{itemID:z.id,oldParent:A,oldPosition:T,newParent:A.parent(),newPosition:q}),H++,T--}}}}else if(M=A.parent()!==i.default.focusedItem&&!(a.isViewProject()&&c.block.id!==a.blockNoKey&&A.parent().parent()===i.default.focusedItem),(a.search.isFlatSearchResult(A)||a.search.isFlatSearchResult(A.parent()))&&(M=!1,r.default.toasts.pushMessage(n.a.MessageID.FlatSearchTab)),M){var W=0,G=A.parent().parent(),K=E.getItems();for(T=L+1;K[L+1];){if(W++>5e3&&__infLoop&&__infLoop(W))throw new RangeError;var Y=K[L+1];w[Y.id]||Y.isHidden(a)?L++:(_[Y.parent().id]=Y.parent(),_[A.id]=A,Y.moveTo({parent:A,fromTab:!0},n.a.ChangeType.Local),k[Y.id]=!0,s.e.performAction(s.c.Move,{itemID:Y.id,oldParent:E,oldPosition:T,newParent:A,newPosition:A.numItems()-1})),T++}if(w[E.id]>=0&&(!E.parent()||E.parent()!==i.default.focusedItem))continue;var X=G.getItems().indexOf(E);_[A.parent().id]=A.parent(),_[G.id]=G,A.moveTo({parent:G,index:X+1,fromTab:!0},n.a.ChangeType.Local),k[A.id]=!0,s.e.performAction(s.c.Move,{itemID:A.id,oldParent:E,oldPosition:L,newParent:G,newPosition:X+1})}}a.setIgnoreRestoreScroll(),r.default.PaneUpdateBatcher.commitUpdateItems(!1,!1);var Q=a.indexOfObject(c),J=a.indexOfObject(h);Q>=0&&J>=0?l.a.selectIndices(Q,f,J,p):requestAnimationFrame(function(){return l.a.updateCaret()})}},{key:"handleEnter",value:function(e){var t=i.default.focusedPane,a=l.a.getStartItem(),d=l.a.getStartObject(),c=l.a.getStartIndex(),h=l.a.getStartOffset(),f=l.a.getStartTotal(),p=l.a.getEndItem(),g=l.a.getEndOffset(),m=l.a.getEndTotal();if(!a)return i.default.Assert(!1,"Invalid item in handleEnter"),!1;var v=a.parent();if(!v)return i.default.Assert(!1,"Invalid parent in handleEnter"),!1;var y,_=v.getItems().indexOf(a),b=a.getParsedText(),k=!1,w=v;if(t.clearPreventUpdate(),t.setIgnoreRestoreScroll(),e.shiftKey)return e.preventDefault(),!1;if(a.isNote()){if(!o.a.isMobile)return e.preventDefault(),!1}else{if(t.search.isFlatSearchResult(a))return r.default.toasts.pushMessage(n.a.MessageID.FlatSearchEnter),e.preventDefault(),!1;if(t.isViewProject()&&t.isItemTopLevel(d,a)&&a.hasChildren()&&0===a.getChild(0).getParsedTextWithoutPrefix().length)l.a.selectIndex(c+1,0);else if(a.shouldCopyPrefix()&&b===a.getPrefix())a.setText("",!0,n.a.ChangeType.Local),l.a.selectIndex(c,0);else{if(!a.getPrefix()||h!==a.getPrefixLength()||g!==m){var S,I,D=!0,C=!1,P=!1,A={text:""},M=d.block;if(t.setIgnoreRestoreScroll(),t.isViewTag()&&a.getParsedText().indexOf(d.block.text)>=0&&(S=d.block.text,I=a.getParsedText()[a.getPrefixLength()]===n.a.TagPrefix?0:-1),u.a.isInsideMarkup(a,h)&&(h=u.a.moveRight(a,h,b.length)),!t.isViewAgenda()||0!==d.levelsDeep||a.hasVisibleChildren(t)&&!a.isCollapsed(t))if(a.hasAttachmentType(n.a.PluginType.Calendar));else if(g===p.getPrefixLength()&&""!==b)_--,D=!1,C=!0;else if(h>=f)(k=!a.isCollapsed(t,!1)&&(a.getVisibleChildren(t).length>0||a.isPrefixHeader()))&&(w=a);else if(h===a.getPrefixLength()&&g===m)a.setText(a.getPrefix(),!0,n.a.ChangeType.Local),s.e.performAction(s.c.Remove,{itemID:a.id,position:0,text:b});else{var T=a.splitUsableText(b,h,g);S&&T.before.indexOf(T)<0&&(0===I?T.before=S+" "+T.before:T.before+=" "+S),A.text=T.after,i.default.setItemAnimationMode(n.a.ItemAnimationMode.Move),a.setText(T.before,!0,n.a.ChangeType.Local),s.e.performAction(s.c.Remove,{itemID:a.id,position:0,text:b.substring(0,g)}),P=!0,(k=!a.isCollapsed(t,!1)&&(a.numItems()>0||a.isHeader()))&&(w=a)}else M.isStarred?A.isStarred=!0:M.isImportant?A.priority=a.priority():M.isDate&&M.date&&a.getMooDate()?A.date=a.getMooDate().toData():A.text=" "+M.id,a.shouldSave()||(_=-1);!k&&S&&A.text.indexOf(S)<0&&(0===I?A.text=S+" "+A.text:A.text+=" "+S);var E=r.default.settings.defaultItemPrefix.get();k||!a.shouldCopyPrefix()&&!P?(!k||k&&E&&(a.isPrefixHeader()||a.shouldCopyPrefix()&&a.prefix===E))&&(A.text=(E&&E+" ")+A.text):A.text=a.getPrefix()+A.text,y=t.createVMLI(A,{parent:w,changeType:n.a.ChangeType.AllLocal,isEditable:!0}),P&&y.copyProperties(a),y.parseText(!0,n.a.ChangeType.Local|n.a.ChangeType.All),k?(a.insertItem(y,0),s.e.performAction(s.c.Create,{itemID:y.id,parent:a.id,position:0,text:y.getParsedText()})):(i.default.Assert(!y.isNote(),"Should never be inserting a note here"),w.insertItem(y,_+1),s.e.performAction(s.c.Create,{itemID:y.id,parent:w.id,position:_+1,text:y.getParsedText()})),i.default.resetItemAnimationMode();var L=D?y:a;i.default.Assert(L,"Expected another item to exist");var x=t.closestIndexOfObject(d),O=D?t.indexOfItem(y,M):C?x-1:x,R=L.shouldCopyPrefix()&&L.getPrefixLength()||0;return O>=0&&l.a.selectIndex(O,R,R,o.a.android&&n.a.SelectOption.Delay),i.default.Assert(e.preventDefault,"Should always be defined"),e.preventDefault&&e.preventDefault(),!1}a.setText(a.getPrefix(),!0,n.a.ChangeType.Local),l.a.selectIndex(c,0),s.e.performAction(s.c.Remove,{itemID:a.id,position:0,text:b})}}}},{key:"handleBackspace",value:function(e){var t=l.a.getStartItem(),a=l.a.getStartIndex(),d=l.a.getStartOffset(),h=l.a.getEndOffset(),f=l.a.getStartObject(),p=i.default.focusedPane,g=d===h;if(!t)return i.default.Assert(!1,"Invalid item in handleBackspace"),!1;var m=t.parent();i.default.Assert(m,"Must always have a valid parent for an item"),o.a.ie&&(e.preventDefault(),e.stopImmediatePropagation());var v=t.getParsedText(),y="",_=0,b=!0,k=t.hasAttachmentType(n.a.PluginType.Calendar);if(0===d&&0===h||""===v)if(f.isBlockHeader&&t.hasChildren())b=!1;else if(t.isNote()&&""!==v)b=!1;else if(k)b=!1;else if(l.a.getStartIndex()>0){var w=i.default.focusedPane.indexOfPrevVMLI(l.a.getStartIndex(),!0,!0),S=w>=0&&i.default.focusedPane.itemAtIndex(w);if(S&&S.allowTextEditing()){if((p.isViewAgenda()||p.search.isFlatSearchResult(t))&&0!==v.length&&(b=!1),b){p.setIgnoreRestoreScroll(),c.a.saveDeleteSelection();var I=S.getParsedText(),D=S.isFullscreen()?0:w,C=p.objectAtIndex(D),P=S.isFullscreen()?0:I.length;l.a.selectIndex(D,P),m.deleteChild(t,S,0,n.a.ChangeType.Local),v.length>0&&""!==v&&(0===I.length&&S.copyProperties(t),S.setText(S.generateSaveText(I)+t.generateSaveText(v),!0,n.a.ChangeType.Local),t.hasNote()&&(S.hasNote()||S.moveNote(t,n.a.ChangeType.Local)),s.e.performAction(s.c.Insert,{itemID:S.id,position:I.length,text:v})),D=p.indexOfObject(C),l.a.selectIndex(D,P),b=!1}}else b=!1}else b=!1;else if(g&&d<=t.getPrefixLength())f.isBlockHeader&&t.hasChildren()?b=!1:(s.e.performAction(s.c.Remove,{itemID:t.id,position:0,text:v.slice(0,t.getPrefixLength())}),y=v.substr(t.getPrefixLength()),_=0);else if(0===d&&h===v.length)s.e.performAction(s.c.Remove,{itemID:t.id,position:0,text:t.getParsedText()}),y="",_=0;else if(e.metaKey)if(t.isNote()){var A=v.prevIndexOf("\n",h);A<0?(y=v.substring(h),_=0,s.e.performAction(s.c.Remove,{itemID:t.id,position:0,text:v.slice(0,h)})):(y=v.substring(0,A)+v.substring(h),_=A,s.e.performAction(s.c.Remove,{itemID:t.id,position:0,text:v.slice(A,h)}))}else y=t.getPrefix()+v.substring(h),s.e.performAction(s.c.Remove,{itemID:t.id,position:0,text:v.slice(0,h)}),_=0;else{var M=u.a.isInsideMarkup(t,d-1);if(M&&(d=u.a.moveLeft(t,d-1)+1,M.isMDImage()&&"!"===v[d-1]&&d--),g?h=d:u.a.isInsideMarkup(t,h-1)&&(h=u.a.moveRight(t,h-1,l.a.getStartTotal())-1),g=d===h,(o.a.mac&&e.altKey||!o.a.mac&&e.ctrlKey)&&g){var T=v.substring(d),E=u.a.getPreviousWord(t,v,d-1)+1;i.default.shouldLog(n.a.LogLevels.Edit)&&console.log(E,v[E],T),E>=0?(s.e.performAction(s.c.Remove,{itemID:t.id,position:E,text:v.slice(E,d)}),y=v.substring(0,E)+T,_=E):(d===v.length?0===d&&(y="",s.e.performAction(s.c.Remove,{itemID:t.id,position:0,text:v})):(s.e.performAction(s.c.Remove,{itemID:t.id,position:0,text:v.slice(0,d)}),y=T),_=0)}else if(g){var L=1;v.length>1&&""===v[d-1]&&L++,k&&v.charAt(d-1)===n.a.AttachChar?" "===v.charAt(d-2)?(y=v.substr(0,d-3)+v.substr(d-2),_=d-3):(y=v.substr(0,d-2)+v.substr(d-1),_=d-2):(y=v.substr(0,d-L)+v.substr(d),s.e.performAction(s.c.Remove,{itemID:t.id,position:d-L,text:v.slice(d-L,d)}),_=d-L),!k||y!==" "+n.a.AttachChar&&y!==n.a.AttachChar||(y="",_=0)}else{var x=v.slice(d,h);s.e.performAction(s.c.Remove,{itemID:t.id,position:d,text:x}),y=v.substr(0,d)+v.substr(h),_=d}}if(b){if(!r.default.settings.showMarkdown.get()){var O=y.search(/(_{4,}?|\*{4,}?)/);O>=0&&(y=y.replace(/(_{4,}?|\*{4,}?)/g,""),_>O&&(_-=_-O))}t.setText(y,!0,n.a.ChangeType.Local),l.a.selectIndex(a,_),this.updateAutocomplete(e)}return!1}},{key:"handleDelete",value:function(e){var t=l.a.getStartItem(),a=i.default.focusedPane;if(!t)return!1;var r,d=t.parent(),h=t.getParsedText(),f=l.a.getStartIndex(),p=l.a.getStartOffset(),g=l.a.getEndOffset(),m=p===g,v=!0,y=t.hasAttachmentType(n.a.PluginType.Calendar);if(""===h)if(a.isViewOutline()){if(t.isNote())d.setNote(void 0,n.a.ChangeType.Local),l.a.selectItem(d,-1);else if(f<a.numItems()-1){var _=f;a.setIgnoreRestoreScroll(),c.a.saveDeleteSelection(),a.numItems()>1&&(t.hasChildren()?d.replaceChild(t,t.getFirstChild(),n.a.ChangeType.Local):d.deleteChild(t,d,_,n.a.ChangeType.Local)),l.a.selectIndex(_,0)}}else v=!1;else if(p===l.a.getStartTotal()&&g===l.a.getEndTotal())if(a.isViewOutline())if(t.isNote())v=!1;else{var b=a.indexOfNextVMLI(f,!0,!0),k=b>=0&&a.itemAtIndex(b);if(a.setIgnoreRestoreScroll(),k&&v){h=t.generateSaveText(h);var w=k.generateSaveText(k.getParsedText()),S=k.hasNote()&&k.getNote();if(t.setText(h+w,!0,n.a.ChangeType.Local),S){var I=t.hasNote()&&t.getNote();if(I){var D=I.getRawText()+"\n\n--- merged note ---\n\n"+S.getRawText();I.setText(D,!0,n.a.ChangeType.Local)}else S.setParent(t),t.setNote(S,n.a.ChangeType.Local)}s.e.performAction(s.c.Insert,{itemID:t.id,position:h.length,text:k.getParsedText()}),c.a.saveDeleteSelection(),k.parent().deleteChild(k,t,0,n.a.ChangeType.Local),l.a.selectIndex(l.a.getEndIndex(),g)}}else v=!1;else if(e.metaKey)t.isNote()||(r=h.substring(0,p),t.setText(r,!0,n.a.ChangeType.Local),s.e.performAction(s.c.Remove,{itemID:t.id,position:0,text:h.slice(0,p)}),l.a.selectIndex(f,p));else if((o.a.mac&&e.altKey||!o.a.mac&&e.ctrlKey)&&p===g){var C=u.a.getNextWord(t,h,p+1);C<0&&(C=l.a.getStartTotal()),C>=0&&(r=h.substring(0,p)+h.substring(C),t.setText(r,!0,n.a.ChangeType.Local),s.e.performAction(s.c.Remove,{itemID:t.id,position:C,text:r}),l.a.selectIndex(f,p))}else{if(u.a.isInsideMarkup(t,p-1)&&(p=u.a.moveLeft(t,p-1)+1),u.a.isInsideMarkup(t,g)&&(g=u.a.moveRight(t,g,l.a.getStartTotal())-1),m)y&&h.charAt(p)===n.a.AttachChar||(r=h.substr(0,p)+h.substr(p+1),s.e.performAction(s.c.Remove,{itemID:t.id,position:p,text:h.slice(p,p+1)}));else{h.slice(p,g);r=h.substr(0,p)+h.substr(g),s.e.performAction(s.c.Remove,{itemID:t.id,position:p,text:h.slice(p,g)})}!y||r!==" "+n.a.AttachChar&&r!==n.a.AttachChar&&r!==" "+n.a.AttachChar&&h!==n.a.AttachChar||(r=""),void 0!==r&&(t.setText(r,!0,n.a.ChangeType.Local),l.a.selectIndex(f,p),this.updateAutocomplete(e))}return!1}},{key:"keyWantsScrollIntoView",value:function(e,t){switch(e.normCode){case n.a.KeyCode.LeftMeta:case n.a.KeyCode.RightMeta:case n.a.KeyCode.Alt:case n.a.KeyCode.Shift:case n.a.KeyCode.Ctrl:case n.a.KeyCode.LeftArrow:case n.a.KeyCode.RightArrow:case n.a.KeyCode.UpArrow:case n.a.KeyCode.DownArrow:return!1}return!(o.a.mac&&e.metaKey&&(t&&e.normCode===n.a.KeyCode.Tilde||!t&&"`"===String.fromCharCode(e.normCode)))&&((!(o.a.mac&&e.metaKey||!o.a.mac&&e.ctrlKey)||e.normCode!==n.a.KeyCode.Z&&e.normCode!==n.a.KeyCode.Y)&&!(e.normCode>=n.a.KeyCode.F1&&e.normCode<=n.a.KeyCode.F12))}},{key:"compoundOperation",value:function(e){s.e.beginAction(),r.default.PaneUpdateBatcher.beginUpdateItems(),e(),r.default.PaneUpdateBatcher.commitUpdateItems(),s.e.endAction()}}])&&h(t.prototype,a),m&&h(t,m),e}();t.default=new m},function(e,t,a){"use strict";var i=a(81);function n(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._listeners=[],this._enabled=!0,t&&this._listeners.push(t)}var t,a,r;return t=e,(a=[{key:"listen",value:function(e){return this._addListener(e),new i.a(this,e)}},{key:"_addListener",value:function(e){this._listeners.push(e)}},{key:"_hasListener",value:function(e){return this._listeners.indexOf(e)>=0}},{key:"unlisten",value:function(e){this._listeners.remove(e)}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1}},{key:"notify",value:function(){for(var e=0,t=arguments.length,a=new Array(t),i=0;i<t;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[i]=arguments[i]}if(this._enabled)for(var n=0,r=0;r<this._listeners.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;arguments.length>0?this._listeners[r](arguments[0]):this._listeners[r]()}}}])&&n(t.prototype,a),r&&n(t,r),e}();t.a=r},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(11),s=a(2),l=a(6),u=a(7),d=a(24),c=a(34),h=a(26),f=a(22);function p(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pluginsAvailable=[n.a.PluginID.Contacts,n.a.PluginID.Drive,n.a.PluginID.GCalendar,n.a.PluginID.Gmail],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new u.a(!1),this.GCalendarsAvailable=new d.a,this.GCalendarSyncErrors=new d.a(void 0),this.GCalendarAddFailure=new u.a(!1),this.GCalendarListFailure=new u.a(!1),this.GCalendarListLoading=new u.a(!1),this.GmailNumSyncd=new u.a(0),this.GmailNumTotal=new u.a(0),this.GmailCacheSize=new u.a(0),this.GmailSyncAccounts=new d.a,this.isSaveEnabled=new u.a(!1),this.hasRefreshed=!1,o.a.forceBind("calendarComparator",this)}var t,a,g;return t=e,(a=[{key:"init",value:function(){var e=r.default.pluginManager.getPlugin(n.a.PluginID.GCalendar),t=e.getSetting(e.Settings.ImportCalendars);t&&this.GCalendarsAvailable.set(t)}},{key:"checkRefresh",value:function(){this.hasRefreshed||this.refreshPluginStatus()}},{key:"refreshPluginStatus",value:function(e){var t=0;this.hasRefreshed=!0;for(var a=0;a<this.pluginsAvailable.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i,o=this.pluginsAvailable[a];i=o===n.a.PluginID.Contacts?r.default.settings.syncContacts.get():r.default.pluginManager.isAuthorized(o),this.updatePluginStatus(o,i)}e&&e!==n.a.PluginID.GCalendar||(this.updatePluginOptionStatus(n.a.PluginID.GCalendar,n.a.PluginSettingsID.GCalendar.WriteAccess),this.updatePluginOptionStatus(n.a.PluginID.GCalendar,n.a.PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(n.a.PluginID.GCalendar,n.a.PluginSettingsID.GCalendar.ExportCalendar)),e&&e!==n.a.PluginID.Drive||this.updatePluginOptionStatus(n.a.PluginID.Drive,n.a.PluginSettingsID.Drive.WriteAccess)}},{key:"refresh",value:function(e){this.refreshPluginStatus(),e&&e!==n.a.PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),e&&e!==n.a.PluginID.Gmail||this.updateGmailInfo()}},{key:"calendarComparator",value:function(e,t){return e.summary.localeCompare(t.summary)}},{key:"updateGmailInfo",value:function(){var e=this,t=r.default.pluginManager.getPluginGmail();t.getTotalMessageCount(function(t){e.GmailNumTotal.set(t)}),this.GmailNumSyncd.set(t.getSyncdMessageCount()),this.GmailSyncAccounts.set(t.getSyncAccounts())}},{key:"updateCalendarList",value:function(){if(r.default.pluginManager.isAuthorized(n.a.PluginID.GCalendar)){var e=r.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),e.getFullCalendarList(function(e){this.GCalendarListLoading.set(!1,!1),e?(e.sort(this.calendarComparator),this.GCalendarsAvailable.set(e),this.GCalendarListFailure.set(!1)):this.GCalendarListFailure.set(!0)}.bind(this))}}},{key:"getEnabledPlugins",value:function(){this.checkRefresh();var e=this._pluginEnabledObservables;return Object.keys(e).filter(function(t){return e[t].get()})}},{key:"getPluginEnabledObservable",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e]}},{key:"isPluginEnabled",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e].get()}},{key:"getPluginOptionObservable",value:function(e,t){return this.checkRefresh(),this._pluginOptionObservables[e][t]}},{key:"getPluginOptions",value:function(e){return this.checkRefresh(),this._pluginOptionObservables[e]}},{key:"isPluginAnOption",value:function(e){return e===n.a.PluginID.Mailbird?s.a.embed===n.a.EmbedApps.Mailbird:this.pluginsAvailable.indexOf(e)>=0}},{key:"updatePluginStatus",value:function(e,t,a){this._pluginEnabledObservables[e]?this._pluginEnabledObservables[e].set(t,a):this._pluginEnabledObservables[e]=new u.a(t)}},{key:"updatePluginOptionStatus",value:function(e,t,a){var i=r.default.pluginManager.getSetting(e,t);this._pluginOptionObservables[e]||(this._pluginOptionObservables[e]={}),this._pluginOptionObservables[e][t]?this._pluginOptionObservables[e][t].set(i||a&&[]):this._pluginOptionObservables[e][t]=a?new d.a(i):new u.a(i)}},{key:"onFailedAuthenticate",value:function(e){r.default.toasts.pushMessage({text:"We failed to successfully authenticate you for "+e+", please try again.",actionText:"OKAY"})}},{key:"_wasPluginAuthorized",value:function(e,t){var a;e===n.a.PluginID.Contacts?t.indexOf(n.a.GScope.Contacts)>=0&&(a=!0):a=r.default.pluginManager.getPlugin(e).verifyAuthorization(f.a.user.email);return i.default.Assert(a,"Should always be successful at authorizing plugins"),a}},{key:"setEnabledPlugins",value:function(e,t){for(var a=0,i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e[i],s=o.id,l=o.enable,u=this._pluginEnabledObservables[s].get(),d=r.default.pluginManager.getPlugin(o.id);l?(o.id===n.a.PluginID.GCalendar&&d.setSetting(n.a.PluginSettingsID.GCalendar.WriteAccess,!0),o.id!==n.a.PluginID.Drive||o.shared||d.setSetting(n.a.PluginSettingsID.Drive.WriteAccess,!1)):u&&this.disablePlugin(s)}var c=e.filter(function(e){return e.enable});this.enablePlugins(c,!1,t)}},{key:"enablePlugins",value:function(e,t,a){var o=this,s=e.map(function(e){var t=e.id,a=r.default.pluginManager.getPlugin(e.id);return a?t===n.a.PluginID.Drive?a.googleScopes(e.shared):a.googleScopes():t===n.a.PluginID.Contacts?[n.a.GScope.Contacts]:void 0}).reduce(function(e,t){return e.concat(t)},[]);if(s=i.default.arrayUnion(s,[n.a.GScope.UserInfoEmail]),t||s&&s.length>1){var l=r.default.settings.activeUser.get();h.a.authAccount(l,s,function(t){t&&!t.error?(o.refresh(),e.map(function(e){if(e.id===n.a.PluginID.Contacts)o.enableSyncContacts();else{var a=r.default.pluginManager.getPlugin(e.id);r.default.pluginManager.onPluginAuthorized(a,!0),e.id===n.a.PluginID.Drive&&e.shared&&a.setSetting(n.a.PluginSettingsID.Drive.WriteAccess,!0)}i.default.Assert(o._wasPluginAuthorized(e.id,t.scopes),"Plugin "+e.id+" was not authorized properly.")}),o.refresh(),a(!0)):a(!1)})}else this.refresh(),a(!0)}},{key:"_enablePlugin",value:function(e){var t=this,a=this._pluginEnabledObservables[e];r.default.pluginManager.authorizePlugin(e,!0,function(n){n?(a.set(!0),t.refresh(e),i.default.sendEvent(e,"PluginEnabled")):(t.onFailedAuthenticate(e),i.default.sendEvent(e,"PluginEnableFailed"))})}},{key:"enablePlugin",value:function(e){e===n.a.PluginID.Contacts?this.enableSyncContacts():this._enablePlugin(e)}},{key:"disablePlugin",value:function(e){var t=this._pluginEnabledObservables[e];e===n.a.PluginID.Contacts?(i.default.sendEvent("Settings","DisableContacts"),r.default.settings.syncContacts.set(!1),c.a.clearLocalContacts(),t.set(!1)):r.default.pluginManager.deauthorizePlugin(e,function(){t.set(!1),i.default.sendEvent(e,"PluginDisabled")})}},{key:"togglePlugin",value:function(e){!this._pluginEnabledObservables[e].get()?this.enablePlugin(e):this.disablePlugin(e)}},{key:"togglePluginOption",value:function(e,t){var a=this,n=this._pluginOptionObservables[e][t],o=!n.get();r.default.pluginManager.setSetting(e,t,o),o?r.default.pluginManager.authorizePlugin(e,!0,function(s){s?(r.default.pluginManager.onAuthorizedSetting(e,t,o),n.set(!0),i.default.sendEvent(e,"OptionEnabled_"+t)):(a.onFailedAuthenticate(t),r.default.pluginManager.setSetting(e,t,!o),i.default.sendEvent(e,"OptionEnableFailed_"+t))}):(n.set(!1),i.default.sendEvent(e,"OptionDisabled_"+t))}},{key:"setPluginOption",value:function(e,t,a,n,o){var s=this,l=this._pluginOptionObservables[e][t],u=l.get();r.default.pluginManager.setSetting(e,t,a),a&&n?r.default.pluginManager.authorizePlugin(e,!0,function(n){n?(r.default.pluginManager.onAuthorizedSetting(e,t,a),l.set(a),i.default.sendEvent(e,"OptionSet_"+t+"_"+a),o&&o(!0)):(s.onFailedAuthenticate(t),r.default.pluginManager.setSetting(e,t,u),i.default.sendEvent(e,"OptionEnableFailed_"+t+"_"+a),o&&o(!1))}):(l.set(a),i.default.sendEvent(e,"OptionSet_"+t+"_"+a),o&&o(!0))}},{key:"enableOfflineFeatures",value:function(e,t){var a=this,o=this.getEnabledPlugins().map(function(e){return e===n.a.PluginID.Drive?{id:e,shared:a.getPluginOptionObservable(e,n.a.PluginSettingsID.Drive.WriteAccess).get()}:{id:e}});this.enablePlugins(o,e,function(e){e||(r.default.toasts.pushMessage({text:"We failed to successfully authenticate you for offline access.",actionText:"OKAY"}),i.default.sendEvent("OfflineAccessFailed",!0)),t&&t(e)})}},{key:"isNotificationsEnabled",value:function(){return!r.default.settings.disableNotifications.get()}},{key:"toggleNotifications",value:function(){var e=r.default.settings.disableNotifications.get();r.default.settings.disableNotifications.set(!e),e?r.default.timeline.updateNotifications():r.default.timeline.clearNotifications()}},{key:"enableSyncContacts",value:function(){var e=this;i.default.sendEvent("Settings","EnableContacts");r.default.settings.syncContacts.set(!0),this.updatePluginStatus(n.a.PluginID.Contacts,!0),c.a.refreshContacts(function(t){t<0?r.default.toasts.pushMessage({text:"There was an error syncing your contacts. Please try again.",actionText:"SYNC",action:function(){e.enableSyncContacts()}}):t>0&&i.default.vmMain.parseAll(n.a.ChangeType.Auto)}),l.e.miscAction({type:l.c.Misc,misc:l.a.SyncContacts})}},{key:"onTapRefreshContacts",value:function(e,t){var a=this,n=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),n=c.a.refreshContacts(function(){a.isRefreshingContacts.set(!1),t&&t()}),i.default.sendEvent("Menu","RefreshContacts")),n}},{key:"addCalendar",value:function(e){var t=r.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),t.createCalendar(e,function(e){this.GCalendarListLoading.set(!1),e?this.updateCalendarList():this.GCalendarAddFailure.set(!0)}.bind(this))}},{key:"notifySyncError",value:function(e){this.GCalendarSyncErrors.set(e||[])}}])&&p(t.prototype,a),g&&p(t,g),e}();t.a=new g},function(e,t,a){"use strict";var i,n=a(0),r=a(1),o=a(3),s=a(7),l=a(82),u=a(68),d=a(16),c=a(12);function h(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var p={Read:0,Write:1,Admin:2},g=(f((i=function(){function e(t){var a=t.id,i=t.text,r=t.dateModified,o=t.rootData,l=t.acl,u=t.backing;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.default.Assert(a,"Document must have id"),n.default.Assert(l,"Document must have acl"),this.id=a,this.text=new s.a(i),this.contentPreview=new s.a(""),this._root=o,this._backing=u,this.acl=l,this.dateModified=new s.a(r),o.archivedItems&&(this._archivedItemsData=o.archivedItems,delete o.archivedItems)}var t,a,i;return t=e,i=[{key:"fromData",value:function(t,a){return new e({id:t.id,rootData:t.rootData,text:t.text,acl:t.acl,dateModified:t.dateModified,backing:a})}},{key:"comparatorModified",value:function(e,t){return t.dateModified-e.dateModified}},{key:"AccessRoles",get:function(){return p}}],(a=[{key:"createVMLIs",value:function(){var e=o.default.itemStoreManager.getDefaultItemStore();this._rootItem||(this._rootItem=e.createItemRaw(this._root,{documentOwner:this,changeType:r.a.ChangeType.Auto,isRoot:!0})),this.ensureRootArchivedItem(),this._archivedItemsData&&this._archivedItemsData.forEach(this.createArchivedVMLI),this._rootItem.items.listen(this.updatePreviewTextListener),this.updatePreviewTextListener()}},{key:"ensureRootArchivedItem",value:function(){this._rootArchivedItem||(this._rootArchivedItem=o.default.itemStoreManager.getDefaultItemStore().createItemRaw({text:"Archived Root"},{documentOwner:this,changeType:r.a.ChangeType.Auto,isRoot:!0}))}},{key:"createArchivedVMLI",value:function(e){e.isArchived=!0,this._rootArchivedItem.items.push(o.default.itemStoreManager.getDefaultItemStore().createItemRaw(e,{parent:this._rootArchivedItem,documentOwner:this,changeType:r.a.ChangeType.Auto}))}},{key:"archiveItem",value:function(e,t){e.parent().items.remove(e),e.setParent(this._rootItem),this.ensureRootArchivedItem(),this._rootArchivedItem.items.push(e),this.propagateArchive(e,!0,t,this._rootItem)}},{key:"unArchiveItem",value:function(e,t,a){e.parent()&&e.parent().items.indexOf(e)>=0&&e.parent().items.remove(e),e.setParent(t),t.items.push(e),this._rootArchivedItem.items.remove(e),this.propagateArchive(e,!1,a,this._rootItem)}},{key:"propagateArchive",value:function(e,t,a,i){var n=this;e._isArchived=!0;var o={id:e.id,isArchived:t};i&&(o.parent=this._rootItem.id),c.a.saveItem(e,o,a,r.a.SaveFlag.All),e.items.get()&&e.items.get().forEach(function(e){return n.propagateArchive(e,t,a)})}},{key:"getRootData",value:function(){return this._root}},{key:"getRootItem",value:function(){return this._rootItem}},{key:"getRootArchivedItem",value:function(){return this._rootArchivedItem}},{key:"getBacking",value:function(){return this._backing}},{key:"getSaveInfo",value:function(){return{id:this.id,version:1,root:this._root.id,text:this.text.get(),dateModified:this.dateModified.get(),acl:this.acl}}},{key:"setText",value:function(e,t){this.text.set(e,t)}},{key:"onRemoteUpdate",value:function(e){void 0!==e.text&&this.setText(e.text),void 0!==e.date&&this.updateModified(e.date)}},{key:"toJSON",value:function(e){var t=this,a=this.getRootItem();return new Promise(function(i){o.default.crypto.encryptText(o.default.settings.getBestUserEncryption(),r.a.EncryptionSentinel,t.id).then(function(n){l.a.getItemsData(a,e).then(function(a){var r={moodoVer:o.default.settings.localDataVersion.get(),doc:t.getSaveInfo(),items:a};e.encrypt&&(r.sentinel=n),i(JSON.stringify(r,null,2))})})})}},{key:"delete",value:function(){var e=this;this.getAllItems().length>2?(u.a.backupDocumentLocal(this),u.a.backupDocument(this).then(function(){c.a.deleteDocument(e)})):c.a.deleteDocument(this)}},{key:"getAllItems",value:function(){var e=[];return this._rootItem.getItems().forEach(this._getAllItems.bind(this,e)),e}},{key:"_getAllItems",value:function(e,t){e.push(t),t.hasNote()&&e.push(t.getNote()),t.getItems().forEach(this._getAllItems.bind(this,e))}},{key:"updateModified",value:function(e){this.dateModified.set(e)}},{key:"updatePreviewTextListener",value:function(){var e=this._rootItem.getFirstChild();e!==this._firstChild&&(this._firstChild&&this._firstChild.itemChanged.unlisten(this.onFirstItemChanged),this._firstChild=e,e&&(this._firstChild.itemChanged.listen(this.onFirstItemChanged),this.onFirstItemChanged()))}},{key:"onFirstItemChanged",value:function(){var e=this._firstChild.getParsedText();e!==this.contentPreview.get()&&this.contentPreview.set(e)}},{key:"getBestEncryptionOut",value:function(e){var t=o.default.settings.encryptionKeys.get();return t&&t[r.a.EncryptionKeys.UserPassword]?r.a.EncryptionKeys.UserPassword:r.a.EncryptionKeys.Global}}])&&h(t.prototype,a),i&&h(t,i),e}()).prototype,"createArchivedVMLI",[d.a],Object.getOwnPropertyDescriptor(i.prototype,"createArchivedVMLI"),i.prototype),f(i.prototype,"updatePreviewTextListener",[d.a],Object.getOwnPropertyDescriptor(i.prototype,"updatePreviewTextListener"),i.prototype),f(i.prototype,"onFirstItemChanged",[d.a],Object.getOwnPropertyDescriptor(i.prototype,"onFirstItemChanged"),i.prototype),i);t.a=g},function(e,t,a){"use strict";var i=a(0);function n(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,r;return t=e,(a=[{key:"_ensureListeners",value:function(){return this._listeners||(this._listeners={}),this._listeners}},{key:"clearListeners",value:function(){this._listeners=void 0}},{key:"listen",value:function(){for(var e=0,t=0,a=arguments.length,n=new Array(a),r=0;r<a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}for(var o=this._ensureListeners(),s=0;s<arguments.length-1;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i.default.Assert("callbacks"!==arguments[s],"Invalid event name/grouping"),i.default.Assert(i.default.isString(arguments[s])||i.default.isFunction(arguments[s]),"Only accept string or functions for listen"),o[arguments[s]]||(o[arguments[s]]={callbacks:[]}),o=o[arguments[s]]}var l=arguments[arguments.length-1];i.default.Assert(i.default.isFunction(l),"Listeners must always be valid functions"),i.default.Assert(o.callbacks.indexOf(l)<0,"Should never listen with the same function twice"),o.callbacks.push(l)}},{key:"isListening",value:function(){for(var e=0,t=0,a=arguments.length,n=new Array(a),r=0;r<a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}var o=this._ensureListeners(),s=arguments[arguments.length-1];i.default.Assert(i.default.isFunction(s),"Listeners must always be valid functions");for(var l=0;l<arguments.length-1;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;o[arguments[l]]&&(o=o[arguments[l]])}return o&&o.callbacks&&o.callbacks.indexOf(s)>=0}},{key:"unlisten",value:function(){for(var e=0,t=0,a=arguments.length,n=new Array(a),r=0;r<a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}var o=this._ensureListeners(),s=arguments[arguments.length-1];i.default.Assert(i.default.isFunction(s),"Listeners must always be valid functions");for(var l=0;l<arguments.length-1;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i.default.Assert("callbacks"!==arguments[l],"Invalid event name/grouping"),i.default.Assert(i.default.isString(arguments[l]),"Only accept string for unlisten"),i.default.Assert(o[arguments[l]],"Cannot unlisten something that has never been listened"),o[arguments[l]]&&(o=o[arguments[l]])}i.default.Assert(o&&o.callbacks&&o.callbacks.indexOf(s)>=0,"Cannot unlisten something that has never been listened"),o.callbacks&&o.callbacks.remove(s)}},{key:"fireEvent",value:function(){for(var e=0,t=0,a=arguments.length,n=new Array(a),r=0;r<a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}var o=!0,s=this._ensureListeners(),l=arguments[arguments.length-1];i.default.Assert(void 0===l||i.default.isArray(l),"Last argument to fireEvent must be an array");for(var u=0;u<arguments.length-1;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(i.default.Assert("callbacks"!==arguments[u],"Invalid event name/grouping"),i.default.Assert(i.default.isString(arguments[u])||i.default.isArray(arguments[u]),"Only accept strings for firing event"),!s[arguments[u]])break;var d=0;s=s[arguments[u]];for(var c=0;c<s.callbacks.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;try{o=s.callbacks[c].apply(this,l)&&o}catch(h){i.default.reportError(h)}}}return o}}])&&n(t.prototype,a),r&&n(t,r),e}();t.a=r},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(21),o=a(56);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],i=!0,n=!1,r=void 0;try{for(var o,s=0,l=e[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(a.push(o.value),t&&a.length===t)break}}catch(u){n=!0,r=u}finally{try{i||null==l.return||l.return()}finally{if(n)throw r}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function l(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u={notify:"n",duration:"d",gcalId:"c",completes:"x"},d=i.default.invertObject(u),c={freq:"f",byweekday:"w",byday:"b",byhour:"h",bymonth:"m",bymonthday:"d",byyearday:"y",byweekno:"n",byminute:"o",bysecond:"s",dtstart:"d",until:"u",interval:"i",count:"c"},h=i.default.invertObject(c),f=["notify","duration","gcalId","completes"],p=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof Date?this.date=t:this.rruleset=t,a&&(this.notify=a.notify,this.duration=a.duration,this.gcalId=a.gcalId,this.completes=a.completes)}var t,a,p;return t=e,p=[{key:"fromData",value:function(t){if(t){var a,i;if(isNaN(t)){var n=t.split("\\");if(n.length>1)a={},n[0].split(";").forEach(function(e){var t=s(e.split(":"),2),i=t[0],n=t[1];"completes"===d[i]?n=n.split(",").map(function(e){return new Date(e)}):"duration"===d[i]&&(n*=1e5),a[d[i]]=n}),t=n[1]}if(isNaN(+t))i=new r.c,t.split("n").forEach(function(e){var t={};e.split(";").forEach(function(e){var a=s(e.split(":"),2),i=a[0],n=a[1],o=h[i];i===c.byweekday?n=n.split(",").map(function(e){var t=s(e.split("-"),2),a=t[0],i=t[1];return new r.d(isNaN(a)?void 0:+a,isNaN(i)?void 0:+i)}):n.indexOf(",")>0?n=n.split(",").map(function(e){return+e}):8!==n.length||isNaN(+n)?isNaN(+n)||(n=+n):n=new Date(1e5*+n),t[o]=n}),i.rrule(new r.b(t))});else i=new Date(+t);return new e(i,a)}}},{key:"fromRRuleOptions",value:function(t,a){var i=new r.c;return i.rrule(new r.b(t)),new e(i,{duration:a})}},{key:"fromRange",value:function(t,a){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=(arguments.length>3&&arguments[3],Math.floor(n)),l=60*(n-s);if(t.equals(a))(i=t).setHours(s),i.setMinutes(l);else{var u={freq:r.a.DAILY,dtstart:o.a.toUTCDate(t),until:o.a.toUTCDate(a)};s&&(u.byhour=s?[s]:void 0),l&&(u.byminute=l?[l]:void 0);var d=new r.c;d.rrule(new r.b(u)),i=d}return new e(i)}},{key:"now",value:function(){return new e(new Date)}}],(a=[{key:"getNext",value:function(e,t){if(this.date)return this.date;e||(e=new Date);var a=this.rruleset._rrule[0].options;a.dtstart&&a.dtstart>e?e=a.dtstart:t||!(a.freq<r.a.DAILY)&&(a.freq!==r.a.DAILY||a.byhour&&0!==a.byhour[0])||(e=new Date(e).clearTime());var i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes())),n=this.rruleset.after(i,!0);return n&&(n=new Date(n.getTime()+6e4*n.getTimezoneOffset())),n}},{key:"getStart",value:function(){return this.date?this.date:this.rruleset._rrule[0].options.dtstart}},{key:"getEnd",value:function(){var e=this.getDuration()||n.a.DefaultEventDuration;if(this.date)return new Date(this.date.getTime()+e);var t=this.rruleset._rrule[0].options;return t.until?t.until:new Date(this.getStart().getTime()+e)}},{key:"isOnDate",value:function(e,t){var a=new Date(e).clearTime();return this.date?a.equals(new Date(this.date).clearTime()):a.equals(this.getNext(e).clearTime())}},{key:"getDate",value:function(){return this.date}},{key:"generateDates",value:function(e){return this.date?[this.date]:this.rruleset.all(function(t,a){return a<e})}},{key:"isRange",value:function(){if(this.date)return!1;var e=this.rruleset._rrule[0].options;return 3===e.freq&&!(e.interval>1)||e.freq>3}},{key:"setDate",value:function(e){this.date=e}},{key:"setDuration",value:function(e){this.duration=e}},{key:"getDuration",value:function(){return this.duration}},{key:"setHours",value:function(e){var t=Math.floor(e),a=60*(e-t);if(this.date)this.date.setHours(t),this.date.setMinutes(a);else{var i=this.rruleset._rrule[0];i.options.byhour=[t],i.origOptions.byhour=[t],i.options.byminute=[a],i.origOptions.byminute=[a]}}},{key:"toText",value:function(e){var t;if(this.date)t=o.a.toHumanText(this.date);else{var a=this.rruleset._rrule[0];t=e?a.toTextShort():a.toText()}if(!e&&this.duration){var i=this.duration/n.a.MSPerMinute;t+=" "+(i>=60?i/60+"hr":i+"m")}return t}},{key:"getGCalId",value:function(){return this.gcalId}},{key:"setGCalId",value:function(e){this.gcalId=e}},{key:"clone",value:function(){return e.fromData(this.toData())}},{key:"isRepeatDate",value:function(){return!!this.rruleset}},{key:"getTime",value:function(){if(this.date)return this.date.getTimeOfDay();var e=this.getNext();return e||(e=this.rruleset&&this.rruleset.before(new Date))&&(e=new Date(e.getTime()+6e4*e.getTimezoneOffset())),e?e.getTimeOfDay():void 0}},{key:"copyFrom",value:function(e){e.rruleset?(this.rruleset=e.rruleset,this.date=void 0):e.date&&(this.date=e.date,this.rruleset=void 0)}},{key:"complete",value:function(){if(this.isRepeatDate()){var e=new Date;this.completes?this.completes.push(e):this.completes=[e];var t=this.getNext(e,!0),a=this.getNext(e,!0),i=this.rruleset._rrule[0],n=t.equals(a)?this.getNext(t.addMinutes(1),!0):t;n=o.a.toUTCDate(n),i.origOptions.dtstart=n,i.options.dtstart=n}}},{key:"toData",value:function(){var e=this,t=[],a=[];if(f.forEach(function(t){var i=e[t];i&&("completes"===t?i=i.map(function(e){return+e}).join(","):"duration"===t&&(i/=1e5),a.push("".concat(u[t],":").concat(i)))}),a.length&&t.push(a.join(";")),this.date){var n=+this.date;if(!a.length)return n;t.push(n)}else t.push(this.rruleset._rrule.map(function(e){var t=e.origOptions;return Object.keys(t).map(function(e){var a=t[e];return e=e.toLowerCase(),a instanceof Date?a=+a/1e5:i.default.isArray(a)&&a[0]&&a[0]instanceof r.d&&(a=a.map(function(e){return e.weekday+(e.n?"-"+e.n:"")}).join(",")),"".concat(c[e],":").concat(a)}).join(";")}).join("\n"));return t.join("\\")}}])&&l(t.prototype,a),p&&l(t,p),e}();t.a=p},function(e,t,a){"use strict";var i=a(0),n=/^<(.*)>$/,r=/^[^:]+(?=:)/;function o(){}var s={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}};o.prototype={update:function(e,t,a,n){var r;return i.default.Assert(t,"Must supply a valid resource lib"),i.default.Assert(a,"Must supply a valid options obj"),"text/plain"===n?r=this._parsePlain(e,t,a):"text/html"===n?r=this._parseHTML(e,t,a):i.default.reportError("Unknown email mimeType: "+n),r?r.parsed=this._escapeHTMLEntities(r.parsed):r={parsed:void 0,missingResourceData:!0},r},_escapeHTMLEntities:function(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})},getAttachmentLinks:function(e,t){var a=[],n=this._createDoc(e);if(n){var r=this._findLinkElements(n),o=this._findQuoteElements(n);try{a=this._findSpecialLinks(r,o,t).attachments}catch(s){i.default.reportError(s)}}return a},generatePlaintext:function(e,t){return this._createDoc(e).body.innerText},replaceSignature:function(e,t){var a,n=this._createDoc(e),r=this._findActiveSignature(n);if(r){var o=!!r.innerHTML;if(r.innerHTML=t||"",t)o||(r.parentNode.insertBefore(document.createElement("br"),r),r.parentNode.insertBefore(document.createElement("br"),r),r.parentNode.insertBefore(document.createTextNode("--"),r),r.parentNode.insertBefore(document.createElement("br"),r));else{var s=r.previousSibling;if(s&&"BR"===s.tagName){var l=s.previousSibling;if(l&&i.default.isTextNode(l)&&"--"===l.textContent){var u=l.previousSibling;if(u){var d=u.previousSibling;"BR"===u.tagName&&(u.parentElement.removeChild(u),d&&"BR"===d.tagName&&d.parentElement.removeChild(d))}s.parentElement.removeChild(s),l.parentElement.removeChild(l)}}}a=n.body.outerHTML}else a=e;return a},_ensurePartDoc:function(e){var t;switch(e.mimeType){case"text/plain":t=this._createDoc(this._parsePlain(e.decoded).parsed);break;case"text/html":t=this._createDoc(e.decoded);break;default:i.default.Assert(!1,"Unknown display part mimeType: "+e.mimeType)}return t},_mergeDocs:function(e,t){if(e.body){var a=t.adoptNode(e.body),n=t.createElement("div");try{for(var r=0,o=0;o<a.attributes.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a.attributes[o];n.setAttribute(s.name,s.value)}}catch(u){i.default.reportError(u)}try{for(var l=0;a.childNodes.length>0;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;n.appendChild(a.firstChild)}}catch(u){i.default.reportError(u)}try{t.body.appendChild(n)}catch(u){i.default.reportError(u)}}},combineParts:function(e){i.default.Assert(i.default.isArray(e)&&e.length>0,"Must always supply a valid part list with contents");var t=this._createDoc("<body></body>");if(i.default.Assert(t,"Must always be able to create a valid document for first part in list"),t)for(var a=0,n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._ensurePartDoc(e[n]);if(r)try{this._mergeDocs(r,t)}catch(o){i.default.reportError(o)}}return t?t.body.outerHTML:" "},removeElementById:function(e,t){i.default.Assert(i.default.isString(e),"Must pass in a valid decoded HTML email string"),i.default.Assert(i.default.isString(t),"Must provide a valid item ID");var a=!1;try{var n=this._createDoc(e);n&&(a=this._removeElementById(n,t))}catch(r){i.default.reportError(r)}return a?n.body.outerHTML:e},_removeElementById:function(e,t){var a=!1,i=e.getElementById(t);return i&&(i.parentNode.removeChild(i),a=!0),a},removeElementsByAttribute:function(e,t,a){i.default.Assert(i.default.isString(e),"Must pass in a valid decoded HTML email string"),i.default.Assert(i.default.isString(t),"Must provide a valid item ID");var n=!1;try{var r=this._createDoc(e);r&&(n=this._removeElementsByAttribute(r,t,a))}catch(o){i.default.reportError(o)}return n?r.body.outerHTML:e},_removeElementsByAttribute:function(e,t,a){var i,n=0,r=!1;i=void 0!==a&&null!==a?e.querySelectorAll("["+t+'="'+a+'"]'):e.querySelectorAll("["+t+"]");for(var o=0;o<i.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[o];s.parentNode.removeChild(s),r=!0}return r},_createFragment:function(){return{lines:[],isQuote:!1}},_createPlainFragments:function(e){var t=0,a=[],i=e.split("\n"),n=this._createFragment();a.push(n);for(var r=0;r<i.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=i[r].trim(),s=new RegExp(/^>+/).test(o);n.lines.length>0&&s!==n.isQuote&&""!==o&&(n=this._createFragment(),a.push(n)),n.lines.push(o),n.isQuote=n.isQuote||s}return a},_getFragmentText:function(e){var t,a,i=0,n="";if(e.isQuote){var r=this._generatePlaceholderID();t='<div id="'+r+'" place="true"></div><p quote="collapsed" group="'+r+'">',a="</p>"}else t="",a="";for(var o=0;o<e.lines.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n+=e.lines[o]+"\n"}return t+n+a},_joinPlainFragments:function(e){for(var t=0,a="",i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i];a+=this._getFragmentText(n)}return a},_parsePlain:function(e,t,a){var n,r=this._escapeHTMLEntities(e),o=this._createPlainFragments(r);try{n=this._joinPlainFragments(o);n=n.replace(/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,'<a mlink="true" href="$1">$1</a>')}catch(s){i.default.reportError(s),n="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+n+"</body><html>"}},_parseHTML:function(e,t,a){var n={parsed:void 0},r=this._createDoc(e),o=this._findQuoteElements(r);if(o=this._cleanupDocQuotes(r,o,t),this._isFullQuote(r,o)||this._collapseAndMarkQuotes(r,o,!!a.collapseQuotes),a.createLinksFromText)try{this._createLinksFromText(r)}catch(u){i.default.reportError(u)}var s=this._findLinkElements(r);this._markLinks(s);try{n.specialLinks=this._findSpecialLinks(s,o,a)}catch(u){i.default.reportError(u)}try{n.parsedMetadata=this._parseMetadata(r)}catch(u){i.default.reportError(u)}try{var l=this._updateResourceImages(r,t);n.missingResourceData=l.missingResourceData}catch(u){i.default.reportError(u)}return this._trimTrailingWhitespace(r),this._trimQuoteWhitespace(o),n.parsed=r.body.outerHTML,n},_traverseNode:function(e,t){if(!1!==t(e))for(var a=0,i=e.childNodes.length-1;i>=0;i--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._traverseNode(e.childNodes[i],t)}},_sanitizeInputDoc:function(e,t){var a=s[t];e.body&&this._traverseNode(e.body,function(e){if(e.nodeType===Node.COMMENT_NODE)i.default.Assert(0===e.childNodes.length,"A comment node should never have children"),e.parentNode.removeChild(e);else if(e.nodeType===Node.TEXT_NODE);else if(a.bannedTags.indexOf(e.tagName.toLowerCase())>=0)e.parentNode.removeChild(e);else if(e.attributes.length>0){for(var t=0,n=a.allowedTagAttributes[e.tagName],r=e.attributes.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e.attributes[r].name;if(a.allowedAttributes.indexOf(o)<0&&(!n||n.indexOf(o)<0))e.removeAttribute(o);else{var s=e.getAttribute(o);s&&s.startsWith("javascript:")&&(console.log("Remove Inline JS: ",e.tagName,o),e.removeAttribute(o))}}var l=e.getAttribute("height");l&&l.indexOf("%")>=0&&(e.removeAttribute("height"),console.log("Remove Height: ",e.tagName,l))}})},sanitizeContent:function(e){var t;if(e){var a=this._createDoc(e);try{this._traverseNode(a.body,function(e){e.nodeType===Node.TEXT_NODE?e.textContent=new Array(e.textContent.length+1).join("#"):"A"===e.nodeName&&e.removeAttribute("href")}),t=a.body.outerHTML}catch(n){i.default.reportError(n),t="<<SANITIZED>>"}}else t="<<NO HTML CONTENT>>";return t},sanitizePlaintext:function(e){return e?i.default.isWhiteSpace(e)?"":"<<NonHTML-Sanitized: "+e.length+">>":"<<NO CONTENT>>"},getComposeBody:function(e,t){var a=!1;try{var n=this._createDoc(e);if(n){a=this._removeElementsByAttribute(n,"moodoAttach","true");var r=this._updateResourceImages(n,t);a=a||r.didUpdate}}catch(o){i.default.reportError(o)}return a?n.body.outerHTML:e},_createDoc:function(e){var t,a=new DOMParser;try{if(t=a.parseFromString(e,"text/html")){var n=this._parseJSONLD(t);this._sanitizeInputDoc(t,"Default"),n&&n.length>0&&this._reportMetadata(t,n)}}catch(r){i.default.reportError(r);try{t=a.parseFromString("Error parsing email message","text/html")}catch(o){i.default.reportError(o)}}return t},_updateResourceImages:function(e,t){for(var a=0,i={missingData:!1,didUpdate:!1},n=this._findImageElements(e),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=n[r];if(o.src.startsWith("cid:")){var s=o.src.substr(4);if(s){o.setAttribute("cid",s);var l=t.getByCID(s);if(l&&l.data){var u="data:"+l.mimeType+";base64,"+l.data;o.src=u,i.didUpdate=!0}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",i.didUpdate=!0,l||(i.missingData=!0)}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",i.didUpdate=!0}}return i},_findImageElements:function(e){return e.querySelectorAll("img")},_findLinkElements:function(e){return Array.prototype.slice.call(e.querySelectorAll("a"))},_sanitizeLink:function(e){if(e&&e.hasAttribute("href")){e.setAttribute("mlink",!0);var t=e.getAttribute("href");if(t.startsWith("file:"))e.setAttribute("href","");else r.exec(t)||e.setAttribute("href","https://"+t)}},_createLinksFromText:function(e){this._traverseNode(e.body,function(t){var a=!0;if(t.nodeType===Node.TEXT_NODE){var i=t.textContent;if(i.indexOf("http")>=0||i.indexOf("www.")>=0){var n=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,r=t.textContent.replace(n,'<a href="$1">$1</a>'),o=e.createElement("div");o.innerHTML=r;var s=o.childNodes.length;if(s>1||1===s&&"A"===o.childNodes[0].tagName){for(var l=0;o.firstChild;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;t.parentNode.insertBefore(o.firstChild,t)}t.parentNode.removeChild(t)}}}else"A"===t.tagName&&(a=!1);return a})},_markLinks:function(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._sanitizeLink(e[a])}},_isAttachmentURL:function(e){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(e)},_findSpecialLinks:function(e,t,a){for(var i=0,n={unsubscribe:[],twitter:[],attachments:[]},r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e[r];o.href&&this._isAttachmentURL(o.href)&&(a.ignoreQuotedAttachments&&this._isInsideQuote(o,t)||n.attachments.push({href:o.href,cid:o.id,name:o.innerText,type:"application/octet-stream"}))}return n},_parseMetadata:function(e){var t=this._parseMicrodata(e);return t&&t.length>0&&this._reportMetadata(e,t),t},_reportMetadata:function(e,t){},_parseJSONLD:function(e){for(var t=0,a=[],n=e.getElementsByTagName("script"),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=n[r];if("application/ld+json"===o.getAttribute("type")){var s=o.innerText.trim();if(s)try{var l=JSON.parse(s);a.push(l)}catch(u){i.default.reportError(new Error("Invalid JSONLD Schema String"),s)}}}return a},_parseMicrodata:function(e){var t=e.querySelectorAll("[itemscope]");return Array.prototype.map.call(t,function(e){if(!e.hasAttribute("itemprop"))return this._parseMicrodataScope(e)}.bind(this)).filter(function(e){return!!e})},_parseMicrodataScope:function(e){var t={type:e.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(t,e),t},_recurseMicrodataScope:function(e,t){for(var a=0,i=0;i<t.children.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t.children[i];if(n.hasAttribute("itemprop")){var r,o=n.getAttribute("itemprop");if(n.hasAttribute("itemscope"))r=this._parseMicrodataScope(n);else switch(n.tagName.toLowerCase()){case"a":case"area":case"link":r=n.getAttribute("href");break;case"meta":r=n.getAttribute("content");break;case"img":r=n.getAttribute("src");break;case"data":case"meter":r=n.getAttribute("value");break;case"time":r=n.getAttribute("datetime");break;default:r=n.hasAttribute("content")?n.getAttribute("content"):n.textContent}o&&r&&(e.properties[o]=r)}else this._recurseMicrodataScope(e,n)}},_cleanupDocQuotes:function(e,t,a){return t.filter(function(e){var t=!1;"BLOCKQUOTE"===e.nodeName&&"cite"===e.getAttribute("type")&&(function(e){var t;n.lastIndex=0;var a=n.exec(e);return a&&a[1]&&(t=a[1]),t}(e.innerText)&&e&&e.parentNode&&(e.parentNode.removeChild(e),t=!0));return!t})},_generatePlaceholderID:function(){return i.default.generateTempId()},_createQuotePlaceholder:function(e){var t=e.createElement("div");return t.id=this._generatePlaceholderID(),t.setAttribute("place",!0),t},_findFirstSiblingQuote:function(e,t){for(var a=0,i=e;i.previousElementSibling&&t.indexOf(i.previousElementSibling)>=0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=i.previousElementSibling}return i},_markAdjacentQuotes:function(e,t,a,i){for(var n=0;e&&a.indexOf(e)>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e.setAttribute("quote",i),e.setAttribute("group",t),e=e.nextElementSibling}},_collapseAndMarkQuotes:function(e,t,a){for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(!r.getAttribute("quote")){var o=this._findFirstSiblingQuote(r,t),s=this._createQuotePlaceholder(e),l=0===n&&a?"collapsed":"uncollapsed";this._markAdjacentQuotes(o,s.id,t,l),o.parentNode.insertBefore(s,r)}}},_removeQuote:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},_removeQuotes:function(e,t){for(var a=0,i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._removeQuote(t[i])}},_isFullQuote:function(e,t){for(var a=0,i=!0,n=0;n<e.body.childNodes.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e.body.childNodes[n];if(""!==r.textContent.trim()&&t.indexOf(r)<0&&t.indexOf(r.firstElementChild)<0){i=!1;break}}return i},_findQuoteElements:function(e){var t=this._findGmailQuotes(e),a=this._findOffice365Quotes(e),i=this._findBlockquoteQuotes(e),n=[];return n.pushOnlyUniques(t),n.pushOnlyUniques(a),n.pushOnlyUniques(i),n=this._cleanupGmail(n),n=this._removeEmptyQuotes(n)},_cleanupGmail:function(e){return e.filter(function(t){var a=!1;if("BLOCKQUOTE"===t.nodeName&&i.default.hasClass(t,"gmail_quote"))for(var n=0,r=0;r<e.length;++r){var o=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var s=t.parentNode;s;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(i.default.hasClass(s,"gmail_quote")){"DIV"===s.nodeName&&(a=!0);break}s=s.parentNode}}return!a})},_removeEmptyQuotes:function(e){return e},_findGmailQuotes:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_quote"))},_findOffice365Quotes:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),a=e.getElementById('3D"divRplyFwdMsg"');return a&&t.push(a),t=t.map(function(e){return e.previousElementSibling&&"HR"===e.previousElementSibling.nodeName?e.parentElement:e})},_findBlockquoteQuotes:function(e){return Array.prototype.slice.call(e.querySelectorAll("blockquote"))},_findGmailSignatures:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_signature"))},_findActiveSignature:function(e){for(var t,a=0,n=this._findGmailSignatures(e),r=this._findQuoteElements(e),o=n.length-1;o>=0&&!t;o--){var s=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var l=n[o],u=!0,d=0;d<r.length;++d){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(i.default.isAncestor(l,r[d])){u=!1;break}}u&&(t=l)}return t},_trimTrailingWhitespace:function(e){for(var t=0,a=e.body.childNodes,i=[],n=a.length-1;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[n],o=a[n-1];if(!r||"BR"!==r.nodeName||!o||"BR"!==o.nodeName)break;i.push(r)}this._removeElements(i)},_trimQuoteWhitespace:function(e){for(var t=0,a=[],i=0;i<e.length;++i){var n=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var r=e[i].previousElementSibling;r;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;"BR"===r.nodeName&&r.previousElementSibling&&"BR"===r.previousElementSibling.nodeName&&a.push(r),r=r.previousElementSibling}}this._removeElements(a)},_removeElements:function(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];try{i.parentNode&&i.parentNode.removeChild(i)}catch(n){}}},_isInsideQuote:function(e,t){for(var a=0;e.parentNode;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.indexOf(e.parentNode)>=0)return!0;e=e.parentNode}return!1}},t.a=new o},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(2),s=a(4),l=a.n(s),u=a(13),d=a(27),c=a(53);function h(e){return(h="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(null==e)return{};var a,i,n=function(e,t){var a=0;if(null==e)return{};var i,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=o[n],t.indexOf(i)>=0||(r[i]=e[i])}return r}(e,t);if(Object.getOwnPropertySymbols){var r=0,o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}}return n}function p(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return!t||"object"!==h(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,m(t).apply(this,arguments))}var a,s,h;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,u["a"]),a=t,(s=[{key:"init",value:function(){var e=this.props;this.listenToDispatcher("windowResize"),e.supportArrows&&(this.selectedIndex=d.a.registerArrowsMode("FancyContextMenu",!0,this.getNumItems,this.onArrowsModeSelect,this.onArrowsModeKey),e.fromHotkey&&this.selectedIndex.set(0,!1),e.onSelectedIndexChanged&&this.selectedIndex.listen(e.onSelectedIndexChanged))}},{key:"close",value:function(){i.default.Assert(this.props.name,"Cannot call close on a menu without a name"),r.default.menus.closeContextMenu(this.props.name)}},{key:"getHotkeys",value:function(){var e=this.props,t=[d.a.createEscape(this.onEscapeKey)];return e.hotkeys&&(t=t.concat(e.hotkeys)),t}},{key:"getRefAtIndex",value:function(e){return this.refs["el_"+e]}},{key:"onMount",value:function(){o.a.isMobile||(this.props.noBackdrop&&document.addEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.updateState())}},{key:"onUnmount",value:function(){this.props.supportArrows&&d.a.exitArrowsMode("FancyContextMenu"),!o.a.isMobile&&this.props.noBackdrop&&document.removeEventListener("mousedown",this.onMouseDownNoBackdrop,!0)}},{key:"getState",value:function(){if(!o.a.isMobile||this.props.useElementPosition){var e=this.updatePosition();return{selectedIndex:this.selectedIndex,left:e.left,top:e.top,right:e.right,bottom:e.bottom,maxHeight:e.maxHeight}}return{top:this.isAtPosition("search")&&i.default.topBarHeight+n.a.MobileHeaderRow2Height||this.isAtPosition("top")&&i.default.topBarHeight||null,bottom:this.isAtPosition("bottom")?0:null}}},{key:"onMouseDownNoBackdrop",value:function(e){i.default.findParent(e.target,"fancyContextMenu")||r.default.menus.closeContextMenu()}},{key:"isAtPosition",value:function(e){if(this.props.position&&this.props.position.split("-").indexOf(e)>=0)return!0;return!1}},{key:"getNumItems",value:function(){return this.numItems}},{key:"onArrowsModeSelect",value:function(e){if(e>=0)if(this.props.onEnterKey)this.props.onEnterKey();else{var t=this.refs["el_"+e];t&&t.onClick&&t.onClick()}}},{key:"onArrowsModeKey",value:function(e,t){var a=this.props;a.onKeyPress&&a.onKeyPress(e,t)&&a.supportArrows&&d.a.exitArrowsMode("FancyContextMenu")}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape(),r.default.menus.closeContextMenu()}},{key:"onChildMouseEnter",value:function(e,t){this.selectedIndex.set(e)}},{key:"isOnSide",value:function(e){return this.props.side?this.props.side.indexOf(e)>=0:"bottom"===e}},{key:"updatePosition",value:function(){var e=this.props,t=o.a.windowWidth(),a=o.a.windowHeight();if(i.default.Assert(e.element,"Context menu needs an element to open on",e.id),e.element){var n,r,s=e.element.getBoundingClientRect(),l=e.pos,u=this.refs.menu,d=l?l.left:void 0,c=l?l.top:void 0;isNaN(d)&&(this.isOnSide("right")?d=s.right:this.isOnSide("left")?n=t-("top left"===e.side?s.right:s.left):d=s.left),isNaN(c)&&(this.isOnSide("bottom")?c=s.bottom:this.isOnSide("top")?r=a-s.top:c=s.top);var h=e.positionOffset;h&&(!isNaN(d)&&h.left&&(d+=h.left),!isNaN(n)&&h.right&&(n+=h.right),!isNaN(c)&&h.top&&(c+=h.top),!isNaN(r)&&h.bottom&&(r+=h.bottom));var f={left:d,top:c,right:n,bottom:r};if(o.a.isMobile)f.left=0,f.bottom=o.a.getKBSize();else if(u){var p=d+u.clientWidth,g=c+u.clientHeight,m=t-8,v=a-8;"shrink"===this.props.overflowHeight&&r>a-8&&(f.maxHeight=Math.min(Math.max(a-c,260),500),g=Math.min(g,f.maxHeight+c)),p>m&&(f.left+=m-p),g>v&&(f.top+=v-g),(d<8||d+f.left<8)&&p<t&&(f.left+=8-d)}return f}return{left:0,top:0,maxHeight:400}}},{key:"remapChildren",value:function(e,t){var a=this;return l.a.Children.map(e,function(e){if(e&&"hr"!==e.type){if("leftcol"===e.key){var i=e.props,n=i.children,r=f(i,["children"]);return l.a.createElement("div",r,a.remapChildren(n,t))}if("scroller"===e.key){var s={maxHeight:o.a.isMobile?.6*o.a.windowHeight():400};return l.a.createElement(c.a,{style:s},a.remapChildren(e.props.children,t))}if(!e.props||e.props.onClick||e.props.customLayout){var u=e.props.onMouseEnter?function(i){a.onChildMouseEnter(t.index,i),e.props.onMouseEnter(i)}:a.onChildMouseEnter.bind(a,t.index);return l.a.cloneElement(e,{onMouseEnter:u,ref:"el_"+t.index,selected:!o.a.isMobile&&a.state.selectedIndex===t.index++})}return e}return e})}},{key:"render",value:function(){var e=this.state,t=this.props,a=i.default.classNames("fancyContextMenu popup c-shadow-popup",t.className,t.position,t.background,{"c-bg-menu":!t.background},{loading:t.loading},{openFromBottom:t.openFromBottom},{top:this.isAtPosition("top")},{bottom:this.isAtPosition("bottom")},{left:this.isAtPosition("left")},{right:this.isAtPosition("right")},{fill:this.isAtPosition("fill")},{full:this.isAtPosition("full")}),n={left:e.left,top:e.top,right:e.right,bottom:isNaN(t.bottom)?e.bottom:t.bottom,width:t.width,height:t.height,minWidth:t.minWidth,maxHeight:e.maxHeight||t.maxHeight,maxWidth:t.maxWidth};o.a.isMobile&&this.isAtPosition("fill")&&(n.top=i.default.topBarHeight),n=i.default.extend(n,this.props.style);var r=this.props.children;if(t.supportArrows){var s={index:0};r=this.remapChildren(this.props.children,s),this.numItems=s.index}return l.a.createElement("div",{ref:"menu",id:t.id,className:a,style:n},r)}}])&&p(a.prototype,s),h&&p(a,h),t}();t.a=y},,function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(2),o=a(4),s=a.n(o);function l(){return(l=Object.assign||function(e){for(var t=0,a=1;a<arguments.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=arguments[a];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function u(e,t){if(null==e)return{};var a,i,n=function(e,t){var a=0;if(null==e)return{};var i,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=o[n],t.indexOf(i)>=0||(r[i]=e[i])}return r}(e,t);if(Object.getOwnPropertySymbols){var r=0,o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}}return n}var d=a(13).b.createClass({displayName:"DivX",componentDisplay:n.a.ComponentDisplay.Everywhere,onMount:function(){r.a.isMobile&&(this.props.onClick||this.props.onMouseDown)&&i.default.setupClick(this.refs.element,this,this.onTap)},getElement:function(){return this.refs.element},onMouseDown:function(e){this.lastX=e.clientX,this.lastY=e.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=e.target,this.props.onMouseDown&&this.props.onMouseDown(e),!r.a.isMobile&&this.props.globalEvents&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))},onMouseMove:function(e){if(this.isDown){this.moveX+=Math.abs(e.clientX-this.lastX),this.moveY+=Math.abs(e.clientY-this.lastY),this.lastX=e.clientX,this.lastY=e.clientY;var t={startSrc:this.startSrc,target:e.target,clientX:e.clientX,clientY:e.clientY,eventX:e.clientX,eventY:e.clientY,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(t)}},onClick:function(e){this.moveX<i.default.ClickThreshold&&this.moveY<i.default.ClickThreshold&&this.props.onClick&&this.props.onClick(e)},onMouseUp:function(e){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(e),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},onTap:{onStart:function(e){this.onMouseDown(e),e.stopPropagation()},onClick:function(e){this.props.onClick&&(this.props.onClick(e),e.stopPropagation())},onMove:function(e){this.props.onMouseMove&&this.props.onMouseMove(e),e.stopPropagation()},onEnd:function(e){this.onMouseUp(e),e.stopPropagation()}},render:function(){var e=this.props,t=(e.onClick,e.globalEvents),a=u(e,["onClick","globalEvents"]);return s.a.createElement("div",l({},a,{onMouseDown:r.a.isMobile?void 0:this.onMouseDown,onMouseMove:t?void 0:this.onMouseMove,onClick:r.a.isMobile?void 0:this.onClick,onMouseUp:r.a.isMobile||t?void 0:this.onMouseUp,ref:"element"}),this.props.children)}});t.a=d},function(e,t,a){"use strict";function i(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}a(238);var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,n;return t=e,(a=[{key:"ab2str",value:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"str2ab",value:function(e){for(var t=0,a=new ArrayBuffer(e.length),i=new Uint8Array(a),n=0,r=e.length;n<r;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[n]=e.charCodeAt(n)}return i}},{key:"unicode2ab",value:function(e){return(new TextEncoder).encode(e)}},{key:"ab2unicode",value:function(e){return(new TextDecoder).decode(e)}}])&&i(t.prototype,a),n&&i(t,n),e}();t.a=new n},,function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(2),o=a(3),s=a(4),l=a(13),u=a(27),d=a(36),c=a(28),h=a(15),f=a(34);function p(e){return(p="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return!t||"object"!==p(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=m(this,v(t).call(this,e))).__isInput=!0,a}var a,p,_;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,l["a"]),a=t,(p=[{key:"init",value:function(){var e=this.props,t={isFocused:e.focused,isComposing:!1,value:e.value||"",tokens:e.tokens||[],item:e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0};this.isInput="password"===e.type,this.isInput||(this.html=this.parseHTML(t.value||n.a.TextSpace)),e.buttonText&&(t.isLoading=!1),this.createObservables(t)}},{key:"onMount",value:function(){this.updateHTML(this.state.value,!1),this.props.focused&&(this.focus(),this.props.selectAll?this.selectAll():this.selectEnd())}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur(),r.a.isMobile&&c.a.hide()}},{key:"componentWillReceiveProps",value:function(e){this.state.item!==e.item&&e.item&&this.item.set(e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0),this.props.value!==e.value&&e.value!==this.state.value&&(this.setValue(e.value,this.isFocused.get()),this.forceUpdate()),this.props.tokens!==e.tokens&&e.tokens!==this.state.tokens&&this.tokens.set(e.tokens)}},{key:"componentDidUpdate",value:function(){var e=this._isDirty;if(this._isDirty=void 0,e&&this._dirtyCallbacks){for(var t=0,a=0;a<this._dirtyCallbacks.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._dirtyCallbacks[a]()}this._dirtyCallbacks=void 0}}},{key:"clearValue",value:function(){this.setValue("")}},{key:"isButtonEnabled",value:function(){return void 0!==this.props.buttonEnabled?this.props.buttonEnabled:this.state.value||this.state.tokens.length>0}},{key:"getValue",value:function(){return this.value.get()}},{key:"getTokens",value:function(){var e=this.getValue().trim(),t=this.tokens.get();return e?t.concat([{text:e,email:e,type:"contact"}]):t}},{key:"getItem",value:function(){return this.state.item}},{key:"parseHTML",value:function(e){var t;if(this.props.parse){var a=d.a.parseText(e,f.a.getContacts(),!0,!0,this.props.isSearch);this.parsedEls=a.els;var n=e.match(/(^#|[\(\s]#)([^\s\),#]+)/g);n&&(n=n.map(function(e){return e.trim().slice(1)})),this.tags=a.tags=n,this.contacts=a.contacts,this.props.onParsed&&this.props.onParsed(a),t=o.default.ElementRenderer.render(a.els,{convertSpaces:!0})}else t=e&&i.default.escape(e).replace(/ /g,"&nbsp;");return t}},{key:"addDirtyCallback",value:function(e){this._dirtyCallbacks||(this._dirtyCallbacks=[]),this._dirtyCallbacks.push(e)}},{key:"focus",value:function(){this._isDirty?this.addDirtyCallback(this.focus):this.refs.input.focus()}},{key:"blur",value:function(){this.refs.input.blur()}},{key:"select",value:function(){h.default.selectElement(this.refs.input)}},{key:"selectEnd",value:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectEnd);else{var t=this.refs.input.innerText;t.length>0&&t!==n.a.TextSpace&&h.default.selectElement(this.refs.input,t.length)}}},{key:"selectAll",value:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectAll);else{var t=this.refs.input.innerText;t.length>0&&t!==n.a.TextSpace&&h.default.selectElement(this.refs.input,0,t.length)}}},{key:"handleCut",value:function(e){var t=this.getSelectionOffsets();if(t.start===t.end){var a=r.a.ie?"Text":"text/plain",n=e&&e.clipboardData?e.clipboardData:window.clipboardData,o=this.getValue();n.setData(a,o),this.clearValue(),this.onInput(),i.default.preventDefault(e),i.default.stopPropagation(e)}}},{key:"_getHotkeys",value:function(e){var t=[u.a.create(n.a.KeyCode.L,!0,n.a.Primary.No,n.a.Shift.Either,this.selectAll)];return r.a.app&&t.push(u.a.create(n.a.KeyCode.L,!0,n.a.Primary.Yes,n.a.Shift.Either,this.selectAll)),e&&t.push(u.a.create(n.a.KeyCode.Escape,!0,n.a.Primary.Either,n.a.Shift.Either,this.handleEscapeKey)),t}},{key:"onFocus",value:function(e){this.props.autocompleteMode&&c.a.clearDisabled(),this.props.autocompleteOnClick&&this.updateAutocomplete(),i.default.vmMain.activeInput.set(this),this.isFocused.set(!0),this.___hotkeys=u.a.pushStack(this._getHotkeys(!!this.props.onEscape)),this.refs.input.addEventListener("cut",this.handleCut,!0),this.props.onFocus&&this.props.onFocus(e)}},{key:"onBlur",value:function(e){i.default.vmMain.activeInput.set(null),this.isFocused.set(!1),this.___hotkeys&&(u.a.popStack(this.___hotkeys),this.___hotkeys=void 0),this.refs.input.removeEventListener("cut",this.handleCut,!0),this.props.onBlur&&this.props.onBlur(e)}},{key:"getSelectionOffset",value:function(){return this.getSelectionOffsets().end}},{key:"getSelectionOffsets",value:function(){var e=h.default._getSelectionRange(),t={start:0,end:0};return e&&(t=h.default.getSelectOffsetsInElement(this.refs.input,e)),t}},{key:"_setSelectionOffset",value:function(e){var t,a;if(e>0){var n=h.default.getOffsetChildElement(this.refs.input,e);t=n.element,a=n.offset}else t=this.refs.input,a=0;var r=h.default.createFakeRange(t,a,t,a);i.default.Assert(r,"Range should be valid when setting selection offset"),r&&h.default.setSelectionRange(r)}},{key:"setSelectionOffset",value:function(e){this._setSelectionOffset(e)}},{key:"updateAutocomplete",value:function(e){var t=this.props,a=this.refs.input,i=t.autocompleteMode;if(e=e||this.item.get()||t.autocompleteItem,i){var n=h.default.getSelectionInElement(a);r.a.isMobile&&!n&&(n={start:0,end:0}),(t.autocompleteOnClick||n&&n.start===n.end)&&c.a.update({mode:i,canAutocompleteItems:t.canAutocompleteItems,text:this.value.get(),offset:n?n.start:0,owner:this,item:e,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:t.positionOffset,elementDisplay:t.autocompleteElementDisplay||this.refs.wrapper,elementInput:a,supportSearchItemAutocomplete:t.supportSearchItemAutocomplete,noShow:t.noShowAutocomplete,showNoMatches:t.autocompleteOnClick})}}},{key:"setValue",value:function(e,t,a){this._isDirty=!0,i.default.Assert(void 0!==e,"Should not set FancyInput value to undefined"),e=e||"",this.updateHTML(e,t,a),this.value.set(e)}},{key:"updateHTML",value:function(e,t,a){var i=a;t&&void 0===i&&(i=this.getSelectionOffset());var r=this.parseHTML(e||n.a.TextSpace);r!==this.refs.input.innerHTML&&(this.refs.input.innerHTML=r),t&&(i>e.length&&(i=e.length),this.setSelectionOffset(i))}},{key:"addToken",value:function(e){this.tokens.push(e);var t=this.refs.inner;t.scrollWidth>t.clientWidth&&(t.scrollLeft=t.scrollWidth-t.clientWidth)}},{key:"updateTokens",value:function(e){for(var t=0,a=i.default.parseTokensFromText(this.value.get()),n="",r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=a[r];"contact"===o.type?this.addToken(o):n+=o.text}this.setValue(n,!0)}},{key:"onChange",value:function(){this.value.set(this.refs.input.value)}},{key:"stripBRs",value:function(e){for(var t=0,a=e.children,i=a.length-1;i>=0;i--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=a[i];"BR"===n.nodeName?n.remove():n.children.length>0&&this.stripBRs(n)}}},{key:"onInput",value:function(){if(!this.isComposing.get()){r.a.isMobile&&this.stripBRs(this.refs.input);var e=this.refs.input.textContent.replace(/\u00a0/g," ").replace(new RegExp(n.a.TextSpace,"g"),"").replace(/\n/g,"");this.setValue(e,!0),this.updateAutocomplete(),this.props.onChange&&this.props.onChange(e,this.item.get())}}},{key:"handleEscapeKey",value:function(){this.props.onEscape?this.props.onEscape():this.isInput||this.select(),this.__hotkeyEscape&&(u.a.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0)}},{key:"onMouseDown",value:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(e)}},{key:"onKeyDown",value:function(e){var t=this.props;this.isInput||(t.autocompleteMode&&c.a.isShowing()||t.buttonText&&e.keyCode===n.a.KeyCode.Enter&&this.onButtonClick(),e.keyCode===n.a.KeyCode.Backspace&&(!this.state.value&&this.state.tokens.length>0&&this.removeToken(this.tokens.length()-1),0===this.refs.input.textContent.length&&(this.refs.input.textContent=n.a.TextSpace)),e.keyCode===n.a.KeyCode.Tab&&c.a.isShowing()&&c.a.hide()),e.keyCode===n.a.KeyCode.Enter&&(t.onEnter&&t.onEnter(e),e.preventDefault()),t.onKeyDown&&t.onKeyDown(e)}},{key:"onKeyUp",value:function(e){var t=this.props;!this.isInput&&t.autocompleteMode&&(e.keyCode!==n.a.KeyCode.LeftArrow&&e.keyCode!==n.a.KeyCode.RightArrow||this.updateAutocomplete()),"email"===t.autocompleteMode&&(e.keyCode===n.a.KeyCode.Comma?this.updateTokens(!1):e.keyCode===n.a.KeyCode.Enter&&this.updateTokens(!0)),r.a.isMobile&&e.keyCode===n.a.KeyCode.Enter&&this.selectEnd(!0),t.onKeyUp&&t.onKeyUp(e)}},{key:"onCompositionStart",value:function(){r.a.android||this.isComposing.set(!0)}},{key:"onCompositionEnd",value:function(e){r.a.android||(this.isComposing.set(!1),this.onInput())}},{key:"onAutocompleteSelected",value:function(e){var t=this.props;e.item&&t.isSearch?t.onAutocompleteSelected(e):(e.item&&this.item.set({item:e.item,text:e.item.getStyledTextAsOneLine()}),void 0!==e.value&&(this.setValue(e.value,!0,e.offset),t.onChange&&t.onChange(e.value,this.item.get())),e.token&&this.addToken(e.token),t.onAutocompleteSelected&&t.onAutocompleteSelected(e))}},{key:"onButtonClick",value:function(){var e=this.state;if(this.isButtonEnabled()){if(this.props.onButtonClick)this.props.onButtonClick(e.value,this.onButtonClickCallback)&&this.isLoading.set(!0);c.a.isShowing()&&c.a.hide()}}},{key:"onButtonClickCallback",value:function(){this.value.set(""),this.isLoading.set(!1)}},{key:"removeToken",value:function(e){var t=this.props,a=this.tokens.get()[e];this.tokens.removeAt(e),t.onChange&&t.onChange(this.getValue(),this.item.get()),t.onTokenRemoved&&t.onTokenRemoved(a)}},{key:"removeItem",value:function(){this.item.set(void 0),this.props.onChange&&this.props.onChange(this.getValue(),this.item.get())}},{key:"render",value:function(){var e,t,a=this.state,n=this.props,o=n.margin||{},l=n.padding||{};isNaN(l.left)&&(l.left=8),isNaN(l.right)&&(l.right=8);var u=!1!==n.border,d=u?2:0,c=i.default.classNames("fancyInput",{disabled:n.disabled},{focused:a.isFocused},{hasFloatingText:!!n.floatingText},{hasButton:!!n.buttonText},{hasBorder:u},this.props.className),h=n.height||40,f=(h-40)/2,p=i.default.extend({width:n.width,height:h,display:n.display,fontSize:n.fontSize},n.style);if(n.floatingText)l.bottom=5+Math.min(f,2),l.top=h-16-l.bottom;else{var g=(h-d-16)/2;l.top=g,l.bottom=g}if(n.floatingText){var m={marginBottom:5+f,marginLeft:l.left,marginRight:l.right};a.isFocused||a.value?a.isFocused?m.color=i.default.colorBlue:m.color="#ccc":m.color="#aaa";var v=i.default.classNames("placeholder c-foreground-super-faded","noSelect",{floating:a.isFocused||a.value||a.tokens.length>0});e=s.createElement("div",{className:v,style:m},n.floatingText)}else if(n.placeholder&&!a.value&&!a.isComposing&&0===a.tokens.length&&!a.item){var y={paddingTop:l.top,marginLeft:l.left,marginRight:l.right};e=s.createElement("div",{className:"placeholder c-foreground-super-faded noSelect",style:y},n.placeholder)}var _,b={right:n.buttonText&&50};if(a.isFocused&&!a.item?b[r.a.transform.react]="":b[r.a.transform.react]="scale(0,1)",t=s.createElement("div",{className:"focusUnderline",style:b}),n.buttonText){var k=i.default.classNames("fancyInputButton c-button-raised-primary",{loading:a.isLoading},{disabled:!this.isButtonEnabled()}),w={width:n.buttonWidth,lineHeight:h+"px"};_=s.createElement("span",{className:k,style:w,onClick:this.onButtonClick},n.buttonText)}var S,I={paddingLeft:l.left,paddingRight:l.right,marginLeft:o.left,marginRight:o.right},D={ref:"input",className:"fancyInputInput",style:{paddingTop:l.top,paddingBottom:l.bottom},onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown,autoComplete:"false",tabIndex:n.tabIndex,disabled:a.isLoading};this.isInput?(D.type=n.type,D.onChange=this.onChange,S=s.createElement("input",D)):(D.onInput=this.onInput,D.contentEditable=n.readonly||a.item?null:"true",D.onCompositionStart=this.onCompositionStart,D.onCompositionEnd=this.onCompositionEnd,S=s.createElement("div",D));var C=[];if(a.tokens)for(var P=0,A=0;A<a.tokens.length;A++){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;var M=a.tokens[A],T={marginTop:l.top-4,paddingLeft:n.padding&&!isNaN(n.padding.left)?n.padding.left:8};C.push(s.createElement("div",{key:"token"+A,className:"token c-button-raised c-border",style:T},s.createElement("span",{dangerouslySetInnerHTML:{__html:M.text}}),s.createElement("i",{className:"icon-close c-button",onClick:this.removeToken.bind(this,A)})))}if(a.item){var E={lineHeight:h+"px",marginTop:0,paddingLeft:n.padding&&!isNaN(n.padding.left)?n.padding.left:8};C.push(s.createElement("div",{key:"tokenItem",className:"token flexbox",style:E},s.createElement("span",{className:"f1",dangerouslySetInnerHTML:{__html:a.item.text}}),s.createElement("i",{className:"icon-close c-button",onClick:this.removeItem})))}var L=i.default.classNames("fancyInputWrap c-foreground c-background c-border",{hasTokens:C.length>0},{hasItem:a.item});return s.createElement("div",{className:c,id:this.props.id,style:p,onClick:this.props.onClick},s.createElement("div",{className:"fancyInputContent"},s.createElement("div",{className:L,ref:"wrapper"},e,s.createElement("div",{className:"fancyInputInner",style:I,ref:"inner"},C,s.createElement("div",{className:"fancyInputInner2"},S))),_,t))}}])&&g(a.prototype,p),_&&g(a,_),t}();t.a=_},,function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(58),s=a(5);function l(e){return(l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==l(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i={title:"Archived",paneClass:"paneArchived",contextMenuMode:n.a.ContextMenuMode.Archived,isWriteable:!0,isEditable:!1,isDraggable:!1,isDropTarget:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,isArchiveView:!0,supportPerformArchive:!1,supportIndent:!1,supportClone:!1,hasMoreButtons:!1,searchFilters:["project","task","starred","priority","showOnlyMatches"]};return(a=d(this,c(t).call(this,e,i))).type=n.a.PaneMode.Archived,a._blocks=[],a._blocksById={},a.initArchived(),a}var a,i,r;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,o["a"]),a=t,(i=[{key:"initArchived",value:function(){this.showArchived.set(!0)}},{key:"getItemSearchParams",value:function(){return{item:this.getItem(),comparator:this.search.isMatched,includeArchived:!0,includeNotes:!0,noCollapsed:!0,pane:this}}},{key:"getHeaderSearchParams",value:function(){return{item:this.getItem(),comparator:this.search.isMatched,includeArchived:!0,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}},{key:"getStatusMessage",value:function(){return"No archived items"}},{key:"handleRightSideTap",value:function(e){this.runUnarchive(e)}},{key:"runUnarchive",value:function(e){e.unArchiveIntoItem(e.getDocumentOwner().getRootItem(),n.a.ChangeType.Local),s.a.reset()}},{key:"getRootItem",value:function(){return this.document.get().getRootArchivedItem()}}])&&u(a.prototype,i),r&&u(a,r),t}(),p=a(2),g=a(12),m=a(11);function v(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=n.a.TaskSortMode,_=function(){function e(t){for(var a in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t)t.hasOwnProperty(a)&&(this[a]=t[a]);this.id=t.id,this.text=t.name,this.search=this.pane.search,this.items=[],this.numInstancesOfItem={},m.a.binder(this,"toggleCollapsed","heightOfHeader","compareItemsAgenda","compareItemsCreated","compareItemsCompleted"),i.default.Assert(this.id,"Added an agenda block without an id")}var t,a,n;return t=e,(a=[{key:"shouldShowTime",value:function(){return!this.isOverdue&&this.isDate}},{key:"heightOfHeader",value:function(){return 32}},{key:"heightOfSpaceBetween",value:function(){return 16}},{key:"heightOfAddButton",value:function(){return this.heightOfHeader()+this.heightOfSpaceBetween()}},{key:"numItems",value:function(){return this.items.length}},{key:"getLastItem",value:function(){var e=this.items[this.items.length-1];return e&&e.isNote()&&(e=e.parent()),e}},{key:"comparePriority",value:function(e,t){var a=e.priority(),i=t.priority();return a>i?-1:a<i?1:0}},{key:"compareDate",value:function(e,t){i.default.Assert(this.date,"This block does not have a date",this.text);var a=this.pane,n=e.getDate(a)||e.getNextDate(),r=t.getDate(a)||t.getNextDate();if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(n&&!r)return-1;if(!n&&r)return 1;if(!n&&!r)return 0;e.getDuration(a)>0&&(n=e.getDisplayDateWithDuration(this.date)),t.getDuration(a)>0&&(r=t.getDisplayDateWithDuration(this.date));var o=n.clone().clearTime(),s=r.clone().clearTime();if(!o.equals(s))return o<s?-1:1;if(n.hasTimeOfDay()&&r.hasTimeOfDay()){var l=n.getTimeOfDay(),u=r.getTimeOfDay();return l===u?0:l<u?-1:1}return n.hasTimeOfDay()?1:r.hasTimeOfDay()?-1:0}},{key:"compareOrder",value:function(e,t){return e.index-t.index}},{key:"compareItemsAgenda",value:function(e,t){var a=e.item,n=t.item;i.default.DAssert(a,"Must have a valid left item to compare"),i.default.DAssert(n,"Must have a valid right item to compare"),i.default.DAssert(!a||a.parent(),"Must have a valid left parent item"),i.default.DAssert(!n||n.parent(),"Must have a valid right parent item"),a.isNote()&&(a=a.parent()),n.isNote()&&(n=n.parent());var r=this.isStarred||this.isImportant?0:this.compareDate(a,n);if(0===r){var o=this.isStarred?0:this.comparePriority(a,n);return 0===o?this.compareOrder(e,t):o}return r}},{key:"compareItemsCreated",value:function(e,t){return this.pane.compareDate(e.dateCreated,t.dateCreated)}},{key:"compareItemsCompleted",value:function(e,t){return this.pane.compareDate(e.dateCompleted,t.dateCompleted)}},{key:"addItem",value:function(e){i.default.Assert(e&&i.default.isVMLI(e),"Must be adding a valid item: "+i.default.getObjectInfo(e)),this.items.indexOf(e)<0&&this.items.push(e)}},{key:"toggleCollapsed",value:function(){this.pane.setBlockCollapsed(this,!this.isCollapsed())}},{key:"isCollapsed",value:function(){return this.pane.isBlockCollapsed(this)}},{key:"getItemID",value:function(e){var t=this.numInstancesOfItem[e.id]||0;return this.numInstancesOfItem[e.id]=t+1,e.id+"_"+this.id+(t?"_"+t:"")}},{key:"sort",value:function(){var e;if(this.pane.isViewAgenda()){var t=this.pane.getSortModeBlocks();t===y.Date?e=this.compareItemsAgenda:t===y.Created?e=this.compareItemsCreated:t===y.Completed&&(e=this.compareItemsCompleted)}else this.pane.isViewCalendarMonth()?e=this.compareItemsAgenda:this.sortMode&&this.sortMode!==y.None&&(e=this.pane.getItemComparator());if(e){var a=this.items.map(function(e,t){return{item:e,index:t}});a.sort(e),this.items=a.map(function(e){return e.item})}}}])&&v(t.prototype,a),n&&v(t,n),e}(),b=a(7),k=a(14),w=a(6),S=a(59);function I(e){return(I="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function C(e,t,a){return(C="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=P(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var T=n.a.TaskViewMode,E=n.a.TaskSortMode,L="__block_nokey",x={};x[T.Groups_Project]={Default:E.None,Available:[E.None,E.Alphabetical,E.NumItems,E.Date,E.Priority,E.Created]},x[T.Groups_Tag]=x[T.Groups_Contact]={Default:E.Alphabetical,Available:[E.Alphabetical,E.NumItems]},x[T.Agenda_Today]=x[T.Agenda_Week]=x[T.Agenda_All]={Default:E.Date,Available:[E.Date,E.Created,E.Completed]};var O=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r,o,s={isWriteable:!0,hasNonVMLIs:!0,supportCollapsing:!0,supportCompleting:!0,supportIndent:!1,supportOffline:!0,supportMenuIcon:!0,supportViewMenu:!0,supportMultiselect:!1,supportDataRefresh:!1,supportClickOverviewScroll:!1,isDraggable:!0,overviewTracksScroll:!1,overviewCanTrackScroll:!0,combineOverdue:!0,searchFilters:["project","task","starred","complete","priority","showOnlyMatches","showOnlyAgendaDates","showOnlyMatchingTags","showChildProjects"]};r=this,(a=!(o=P(t).call(this,e,s))||"object"!==I(o)&&"function"!==typeof o?M(r):o).type=n.a.PaneMode.Task,a.paneClass="paneTask",m.a.binder(M(M(a)),"getDayWidth","updateAllDay","scrollToToday","openViewMenu","setViewMode","compareBlockDate","compareBlockName","compareBlockItemPriority","compareBlockItemCreated","compareItemDate","compareItemName","_itemSearchComparator","onScroll","checkFlatListMode","addFnProject","addFnTag","addFnDate","onGCalendarActiveChanged","onGmailActiveChanged","onCalendarCustomDaysChanged","switchToOutline","_onSelectionChanged"),a.dragHoveredBlock=new b.a;var l=e.viewState||{};if(l.viewMode=l.viewMode||T.Groups_Project,l.sortModeBlocks=l.sortModeBlocks||{mode:E.None},l.sortModeItems=l.sortModeItems||{mode:E.None},i.default.isString(l.sortModeBlocks)&&(l.sortModeBlocks={mode:l.sortModeBlocks}),i.default.isString(l.sortModeItems)&&(l.sortModeItems={mode:l.sortModeItems}),a.viewState=new b.a(l,a.onViewStateChanged.bind(M(M(a)))),a._allPaneItems=[],a._isViewHelper={},a.topBoxHeight.set(0,!1),a.blocksCollapsed=e.blocksCollapsed,!a.blocksCollapsed){var u=a.blocksCollapsed={};u[L+"_"+T.Groups_Project]=!0,u[L+"_"+T.Groups_Tag]=!0,u[L+"_"+T.Groups_Contact]=!0,u[L+"_"+T.Groups_Priority]=!0}return a.search.getFilterObs("showOnlyMatches").listen(a.checkFlatListMode),a.dropEffect=function(e){var t=n.a.DropEffect.Move;return this.isCalendarItem(e)&&(t=n.a.DropEffect.Copy),t},a.displayLocalItems=new b.a(void 0===e.displayLocalItems||e.displayLocalItems),a.displayCalendars=new b.a(e.displayCalendars||{}),a.numAllDay=new b.a(0),a.setupViewState(),a.initBlocks(),a}var a,l,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,o["a"]),a=t,u=[{key:"viewModeSupportsSortBlocks",value:function(e){return!!x[e]}},{key:"viewModeSupportsSortBlocksMode",value:function(e,t){return x[t]&&x[t].Available.indexOf(e)>=0}},{key:"viewModeSupportsSortItems",value:function(e){return e===T.Groups_Project||e===T.Groups_Tag||e===T.Groups_Contact||e===T.Groups_Priority}}],(l=[{key:"initBlocks",value:function(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForItem=void 0,this.itemAnimationTimeout=void 0;var e=r.default.pluginManager.getPlugin(n.a.PluginID.GCalendar);e.isActive()&&this.useItemStore(e.getDefaultItemStore());var t=r.default.pluginManager.getPlugin(n.a.PluginID.Gmail);t.isActive()&&this.useItemStore(t.getDefaultItemStore()),r.default.pluginManager.listen("pluginActiveChanged",n.a.PluginID.GCalendar,this.onGCalendarActiveChanged),r.default.pluginManager.listen("pluginActiveChanged",n.a.PluginID.Gmail,this.onGmailActiveChanged),k.a.listen("selectionChanged",this._onSelectionChanged),r.default.settings.dayWeekStart.listen(this.scrollToToday),r.default.settings.calendarCustomDays.listen(this.onCalendarCustomDaysChanged)}},{key:"destroy",value:function(){k.a.unlisten("selectionChanged",this._onSelectionChanged),r.default.settings.dayWeekStart.unlisten(this.scrollToToday),r.default.settings.calendarCustomDays.unlisten(this.onCalendarCustomDaysChanged),this._onAfterLoadedRAF||this.removeScrollListener(this.onScroll),r.default.pluginManager.unlisten("pluginActiveChanged",n.a.PluginID.GCalendar,this.onGCalendarActiveChanged),r.default.pluginManager.unlisten("pluginActiveChanged",n.a.PluginID.Gmail,this.onGmailActiveChanged),C(P(t.prototype),"destroy",this).call(this)}},{key:"getPaneIcon",value:function(){return"icon-calendar"}},{key:"keydown",value:function(e){return s.a.isValid()&&s.a.getStartIndex()===s.a.getEndIndex()&&!w.e.undoRedoActive&&(this.preventUpdateItemsForItem=s.a.getStartObject(),this.search.stickMatch(s.a.getStartObject())),C(P(t.prototype),"keydown",this).call(this,e)}},{key:"handleLeftSideTap",value:function(e,a){return this.clearPreventUpdate(),C(P(t.prototype),"handleLeftSideTap",this).call(this,e,a)}},{key:"clearPreventUpdate",value:function(){var e=this,t=this.preventUpdateItemsForItem;if(t&&r.default.DragDrop.isDragging){k.a.listen("endDrag",function t(){k.a.unlisten("endDrag",t),e.clearPreventUpdate()})}else{var a=!1;t&&(a=a||this.search.unstickMatch(t),this.preventUpdateItemsForItem=void 0),a&&(this.itemsWillBeDirty=void 0,this.setItemsDirty(),r.default.PaneUpdateBatcher.updateAllItems())}}},{key:"_onSelectionChanged",value:function(e){s.a.getPane()===this&&this.preventUpdateItemsForItem&&!w.e.undoRedoActive?s.a.isValid()?s.a.getStartObject().id!==this.preventUpdateItemsForItem.id&&(r.default.PaneUpdateBatcher.beginUpdateItems(),this.clearPreventUpdate(),p.a.isMobile?setTimeout(this.updateItems,0):(i.default.setItemAnimationMode(n.a.ItemAnimationMode.Move),r.default.PaneUpdateBatcher.updateAllItems(),e&&this.restoreSelection(e),clearTimeout(this.itemAnimationTimeout),this.itemAnimationTimeout=setTimeout(function(){i.default.resetItemAnimationMode()},300)),r.default.PaneUpdateBatcher.commitUpdateItems()):(this.clearPreventUpdate(),this.updateItems()):this.clearPreventUpdate()}},{key:"isCalendarItem",value:function(e){return!1}},{key:"isEmailItem",value:function(e){return!1}},{key:"_itemSearchComparator",value:function(e){var t=this.search.isMatched(e)||e.isNote()&&this.search.isMatched(e.parent()),a=!1,i=!1;if(this.isCalendarItem(e)){var o=e.getAttachmentByPlugin(n.a.PluginID.GCalendar);o&&("cancelled"===o.getField("status")?i=!0:o.forEachItem(void 0,function(e){e.belongsToItemStore(r.default.pluginManager.getPlugin(n.a.PluginID.GCalendar).getDefaultItemStore())||(a=!0)}))}else if(this.isEmailItem(e)){var s=e.getAttachmentByPlugin(n.a.PluginID.Gmail);if(s){var l=r.default.pluginManager.getPluginGmail();if(l.isItemArchived(e))t=!1;else l.getAttachmentPriority(s)!==n.a.VMLIFlag.None&&(t=!0)}}return t&&!a&&!i}},{key:"getItemSearchParams",value:function(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.item.get(),comparator:this._itemSearchComparator,noCollapsed:this.isViewOutline(),includeArchived:this.showArchived.get(),includeNotes:!0,pane:this}}},{key:"_setItems",value:function(e,t){this.updateBlockItems()}},{key:"onTapViewArchived",value:function(){r.default.PaneUpdateBatcher.beginUpdateItems(),this.showArchived.set(!this.showArchived.get()),r.default.PaneUpdateBatcher.commitUpdateItems(),r.default.PaneManager.updatePaneStateForPane(this),i.default.sendEvent("Menu","ShowArchivedTimeline")}},{key:"onLoad",value:function(){isNaN(this.initialOffset)&&this.isViewDates()&&(this.initialOffset=this.getScrollOffsetOfToday(),this._infiniteList.setInitialScrollOffset(this.initialOffset)),C(P(t.prototype),"onLoad",this).call(this,{})}},{key:"onAfterLoaded",value:function(){this.orientation.get()===n.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY()),this.setIgnoreRestoreScroll(),C(P(t.prototype),"onAfterLoaded",this).call(this),this.addScrollListener(this.onScroll)}},{key:"getScrollOffsetOfToday",value:function(){var e;this.getViewMode();if(this.isViewCalendarMonth())e=this.heightWeek()*(n.a.CalendarMonthViewNumWeeksPad+1);else if(this.isViewCalendarHoriz())e=this.getDayWidth()*n.a.CalendarDayViewNumDaysPad+1;else if(this.isViewAgenda())for(var t=0,a=this.items.get(),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[i];if((r.isOverdue||r.isToday)&&"blockHeader"===r.type){e=this.topOfIndex(i)-16;break}}return e}},{key:"_getDateInMiddle",value:function(){return(new Date).clearTime()}},{key:"scrollToTop",value:function(e){this.isViewDates()?this.scrollToToday(e):C(P(t.prototype),"scrollToTop",this).call(this,e)}},{key:"scrollToToday",value:function(e){var t=this.getScrollOffsetOfToday();e=isNaN(e)?n.a.ScrollDuration.Default:e,this.setIgnoreRestoreScroll(e+100),this.setScrollOffset(t,e),this.orientation.get()===n.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY(),this.scrollElement.scrollTop=0)}},{key:"weekCount",value:function(e,t,a){var i=new Date(e,t,1),n=a?new Date(e,t,a):new Date(e,t+1,0),r=i.getDay()+n.getDate();return Math.ceil(r/7)}},{key:"scrollJump",value:function(e,t){t=isNaN(t)?n.a.ScrollDuration.Default:t;var a,i,o=this.getViewMode(),s=this._infiniteList.getScrollOffset(),l=this._infiniteList.indexOfTop(),u=this._infiniteList.objectAtIndex(l),d=s-this.topOfIndex(l);if(o===T.Calendar_Month){var c=u.date;if(e<0){var h=c.clone().addMonths(-1);a=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,i=this.weekCount(h.getFullYear(),h.getMonth()),s-=this.heightWeek()*(i+a)+d}else i=this.weekCount(c.getFullYear(),c.getMonth()),a=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,s+=this.heightWeek()*(i-a)-d}else if(o===T.Calendar_Custom){var f=r.default.settings.calendarCustomDays.get();s+=this.getDayWidth()*f*e-d+1}else if(o===T.Calendar_Week){var p,g=u.date.getDay(),m=r.default.settings.dayWeekStart.get();p=e<0?g>m?-g+m:-7:7-g+m,s+=this.getDayWidth()*p-d+1}else o===T.Calendar_Day&&(e<0&&d>200?s-=d:s+=this.getDayWidth()*e-d+1);this.setIgnoreRestoreScroll(),this.setScrollOffset(s,t)}},{key:"compareDate",value:function(e,t){return e||t?e?t?e.compareTo(t):-1:1:0}},{key:"compareText",value:function(e,t){return e.localeCompare(t)}},{key:"comparePriority",value:function(e,t){var a=e.getPriority(this),i=t.getPriority(this);return i>a?1:i<a?-1:0}},{key:"compareBlockBase",value:function(e,t,a){i.default.Assert(e,"Comparator was invalid");var n,r=this.getSortOrderBlocks()||1;if(e&&(n=this.compareNoKey(t,a)*r||e(t,a)),0===n||void 0===n){var o=x[this.getViewMode()].Default,s=this._getBlockSortComparator(o);if(s!==e)return s(t,a)}return n*r}},{key:"compareBlockPriority",value:function(e,t){return t.priority-e.priority}},{key:"compareNoKey",value:function(e,t){return e.id===this.blockNoKey?1:t.id===this.blockNoKey?-1:void 0}},{key:"compareNone",value:function(e,t){return e.originalIndex-t.originalIndex}},{key:"compareBlockDate",value:function(e,t){return this.compareDate(e.date,t.date)}},{key:"compareBlockName",value:function(e,t){return this.compareText(e.name,t.name)}},{key:"compareBlockNumItems",value:function(e,t){return t.items.length-e.items.length}},{key:"compareBlockItemPriority",value:function(e,t){return this.comparePriority(e.item,t.item)}},{key:"compareBlockItemCreated",value:function(e,t){return this.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"_getBlockSortComparator",value:function(e){return e===E.Alphabetical&&this.compareBlockName||e===E.Date&&this.compareBlockDate||e===E.NumItems&&this.compareBlockNumItems||e===E.Priority&&this.compareBlockItemPriority||e===E.Created&&this.compareBlockItemCreated||e===E.None&&this.compareNone}},{key:"getBlockComparator",value:function(){var e=this.getSortModeBlocks();return this.compareBlockBase.bind(this,this._getBlockSortComparator(e))}},{key:"compareItemBase",value:function(e,t,a){i.default.Assert(e,"Comparator was invalid");var n,r=this.getSortOrderItems();return e&&(n=e(t,a)*r),0===n||void 0===n?this.compareItemNone(t,a):n}},{key:"compareItemNone",value:function(e,t){return e.index-t.index}},{key:"compareItemDate",value:function(e,t){return this.compareDate(e.item.getDate(this),t.item.getDate(this))}},{key:"compareItemName",value:function(e,t){return this.compareText(e.item.getSearchText(this),t.item.getSearchText(this))}},{key:"compareItemNumItems",value:function(e,t){return t.item.numItems()-e.item.numItems()}},{key:"_getItemSortComparator",value:function(e){return e===E.Alphabetical&&this.compareItemName||e===E.Date&&this.compareItemDate||e===E.NumItems&&this.compareItemNumItems||e===E.Priority&&this.compareBlockItemPriority||e===E.Created&&this.compareBlockItemCreated||e===E.None&&this.compareItemNone}},{key:"getItemComparator",value:function(){var e=this.getSortModeItems();return this.compareItemBase.bind(this,this._getItemSortComparator(e))}},{key:"getItemsOnDate",value:function(e){for(var t=0,a=[],i=0;i<this._itemsWithDates.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._itemsWithDates[i],r=n.getMooDate();r&&r.isOnDate(e)&&a.push(n)}return a}},{key:"findIndexOfNextBlock",value:function(){for(var e=0,t=new Date,a=this.items.get(),i=0;i<a.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=a[i];if("blockHeader"===n.type){var r=n.block;if(r.isOverdue||r.isNow||r.isToday||r.isStarred||r.isImportant||r.date>=t)return i}}return-1}},{key:"_keyHelper",value:function(e,t){var a=e["get"+t](this);if(a){if(a=a.map(function(e){return{value:e,lower:e.toLowerCase()}}),this.search.showOnlyMatchingTags()){var n=this.search["get"+t]();n&&n.length>0&&(n=n.map(i.default.toLowerCase),a=a.filter(function(e){for(var t=0,a=0;a<n.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.lower===n[a])return!0}}))}return a}if(!e.hasVisibleChildren(this)){for(var r=0,o=!0,s=e.parent();void 0!==s&&s!==this.getItem();){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=s["get"+t](this);if(l)for(var u=0,d=0;d<l.length;d++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(this.blocksByKey[l[d].toLowerCase()]){o=!1;break}}s=s.parent()}if(o)return[this.blockNoKey]}}},{key:"_getKeysForItem",value:function(e){var t=this.getViewMode();if(this.isViewAgenda()||this.isViewCalendar()){var a=!0;if(this.isViewAgenda()&&e.hasAttachmentType(n.a.PluginType.Calendar)&&e.getDate()<Date.today()){var i=e.getAttachmentByType(n.a.PluginType.Calendar);i.getPlugin().shouldDisplayOverdueInAgenda()&&i.getPlugin().hasWritePermissionForAttach(i)||(a=!1)}if(a){var o=this._getDateForItem(e);if(this.isViewAgenda()&&this.getSortModeBlocks()===E.Date&&!this.search.showOnlyAgendaDates()){var s=[];if(!e.isComplete()){if(e.isStarred(this)){var l="starred";r.default.timeline.getDateForKey(l)&&s.push(l)}if(e.isImportant(this)){l="important";r.default.timeline.getDateForKey(l)&&s.push(l)}}var u=e.getTagsLower();if(u)for(var d=0,c=0;u&&c<u.length;c++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h="#"+u[c];r.default.timeline.getDateForKey(h)&&s.push(h)}s.length>0&&(o=o?o.concat(s):s)}return o}}else if(t===T.Groups_Project){var f=e.parent();if(f===this.getItem()&&!e.isPrefixHeader(this))return[this.blockNoKey];if(f&&f.isPrefixHeader()&&f!==this.getItem()&&(this.search.showChildProjects()||f.parent()===this.getItem()))return[f.id]}else{if(t===T.Groups_Tag)return this._keyHelper(e,"Tags");if(t===T.Groups_Contact)return this._keyHelper(e,"Contacts");if(t===T.Groups_Priority){var p=e.getPriority(this);if(p)return[p];if(!e.hasVisibleChildren(this)){for(var g=0,m=(a=!0,e.parent());void 0!==m&&m!==this.getItem();){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(m.getPriority(this)){a=!1;break}m=m.parent()}if(a)return[this.blockNoKey]}}}}},{key:"isOkOnAgenda",value:function(e){return!!this._getKeysForItem(e)||this.search.showHierarchy()&&e.parent()&&this.isOkOnAgenda(e.parent())}},{key:"_getDateForItem",value:function(e){var t,a=this.getSortModeBlocks();if(this.isViewCalendar()||a===E.Date){var i=e.getMooDate();e.getDate(this),e.isRepeatDate();e.isComplete()&&this.isViewAgenda()?e.dateCompleted>=Date.today()&&(t=e.dateCompleted):i&&(t=i.getNext())}else if(a===E.Created||a===E.Completed){var n=a===E.Created?e.dateCreated:e.dateCompleted;(!this.startDate||n>=this.startDate)&&(t=n)}if(t&&this.isDateWithinRange(t))return[t]}},{key:"isDateWithinRange",value:function(e){return e&&(!this.endDate||e<this.endDate)}},{key:"_getKeyForDate",value:function(e){var t=Date.today();if(!(this.combineOverdue&&e<t)){var a=n.a.DFormat.MonthDayYearLong,i=r.default.International.getFormat(a);return e.toString(i)}return"overdue".toLowerCase()}},{key:"updateBlockItems",value:function(){var e,t=this.getViewMode();if(this.isViewOutline())this.updateOutline(this._allPaneItems,this.supportsSortItems()&&this.getItemComparator());else if(this.isViewCalendar()){var a=0;this._itemsWithDates=[];for(var i=0;i<this._allPaneItems.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this._allPaneItems[i];n.getMooDate()&&this._itemsWithDates.push(n)}t===T.Calendar_Month?this.updateCalendarMonth():this.isViewCalendarHoriz()&&(this.updateCalendarWeek(),e=!0)}else this.updateBlocks(),this.updatePaneObjects();e&&this.updateAllDay()}},{key:"updateBlocks",value:function(){var e,t,a,i=0;for(this.blocks=[],this.blocksByKey={},this.isViewAgenda()&&this.getBlock(Date.today()),e=0;e<this._allPaneItems.length;e++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=!(t=this._allPaneItems[e]).isNote();if(r)if(t.hasAttachmentType(n.a.PluginType.Calendar)){var o=t.getAttachmentByType(n.a.PluginType.Calendar),s=o.hasField("calendarID"),l=s&&o.getField("calendarID");r=s&&!1!==this.displayCalendars.get()[l]}else r=this.displayLocalItems.get();r&&this.addToBlock(this._allPaneItems[e])}this.isViewAgenda()?a=this.compareBlockDate:this.isViewPriority()?a=this.compareBlockBase.bind(this,this.compareBlockPriority):this.supportsSortBlocks()&&(a=this.getBlockComparator()),a&&this.blocks.sort(a)}},{key:"addItemToPaneObjects",value:function(e,t,a,i,n){i=i||0;var r=new S.a({type:"blockItem",item:a,id:t.getItemID(a)+(n?"_"+n.id:""),block:t,parentObject:n,index:e.length,levelsDeep:i,sizeInPane:a.sizeInPane});if(this.addPaneObject(e,r),a.hasNote()&&this.addItemToPaneObjects(e,t,a.getNote(),i,n),!a.isCollapsed(this)){var o=a.getVisibleChildren(this);if(o)for(var s=0,l=0;l<o.length;l++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;this.addItemToPaneObjects(e,t,o[l],i+1,r)}}return r}},{key:"updatePaneObjects",value:function(){var e,t,a,i,n=0,r=[];for(a=0;a<this.blocks.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this.blocks[a],s=this.isBlockCollapsed(o)&&(a===this.blocks.length-1||!this.isBlockCollapsed(this.blocks[a+1]));if(o.sort(),o.item?(t=o.item,i=new S.a({type:"blockItem",item:t,id:t.id+"_"+o.id,block:o,index:r.length,levelsDeep:0,sizePad:s?o.heightOfSpaceBetween():o.isCollapsed()?0:4,sizeInPane:t.sizeInPane,isBlockHeader:!0}),this.addPaneObject(r,i),t.hasNote()&&!this.isBlockCollapsed(o)&&this.addItemToPaneObjects(r,o,t.getNote(),0,i)):this.isViewProjectNoBlocks()||this.addPaneObject(r,new S.a({type:"blockHeader",block:o,id:o.id,index:r.length,isToday:o.isToday,isOverdue:o.isOverdue,isFirstCollapsed:e&&o.isCollapsed()&&!e.isCollapsed(),sizePad:s?o.heightOfSpaceBetween():this.isViewProject()||this.isViewAgenda()&&o.isDate?4:0,sizeInPane:o.heightOfHeader})),1===this.blocks.length&&this.isViewProject()||!this.isBlockCollapsed(o)){for(var l=0,u=!1,d=0;d<o.items.length;d++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;t=o.items[d],i=this.addItemToPaneObjects(r,o,t),!u&&this.isViewAgenda()&&this.shouldShowTime(i)&&!t.getTime()&&(i.showAllDay=!0,u=!0)}this.addPaneObject(r,new S.a({type:"blockAddItem",id:o.id+"_add",block:o,index:r.length,sizeInPane:o.noAddButton?o.heightOfSpaceBetween():o.heightOfAddButton(),addFn:o.addItem}))}e=o}this.isViewProject()&&!this.isViewProjectNoBlocks()&&((o=this.getBlock("newProject")).isNewProject=!0,this.addPaneObject(r,new S.a({type:"blockHeader",block:o,id:o.id,index:r.length,sizeInPane:o.heightOfHeader}))),this.items.set(r)}},{key:"addToBlock",value:function(e){this.isViewProject()&&e.isPrefixHeader(this)&&(this.search.showChildProjects()||e.parent()===this.getItem())&&this.getBlock(e.id,e);var t=this._getKeysForItem(e);if(t)for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this.getBlock(t[i],e);n&&n.addItem(e)}}},{key:"_addFnBase",value:function(e,t,a,o,l){var u=this;e=r.default.settings.getDefaultItemText(o)+e,this.clearPreventUpdate(),r.default.PaneUpdateBatcher.beginUpdateItems(),w.e.beginAction();var d={text:e};l&&(d=i.default.extend(d,l));var c=this.createVMLI(d,{parent:a,changeType:n.a.ChangeType.AllLocal,isEditable:!0});a.insertItem(c),w.e.performAction(w.c.Create,{itemID:c.id,parent:a.id,position:a.numItems(),text:e}),w.e.endAction(),r.default.PaneUpdateBatcher.commitUpdateItems();var h=this.indexOfItem(c,t);h>=0&&(s.a.selectIndex(h,0),p.a.isMobile&&i.default.openKeyboardOnIndex(void 0,this,h,function(){u.setFocused(!0)}))}},{key:"addFnProject",value:function(e){return this._addFnBase("",e,e.id===this.blockNoKey?this.getItem():g.a.getItem(e.id))}},{key:"addFnTag",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnDate",value:function(e){var t,a="";return e.isDate?t={date:e.date}:e.isStarred?t={isStarred:!0}:e.isImportant?t={priority:n.a.VMLIFlag.P2}:a=" "+e.id,this._addFnBase(a,e,this.getItem(),void 0,t)}},{key:"addFnContact",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnPriority",value:function(e){return this._addFnBase("",e,this.getItem(),void 0,{priority:e.priority})}},{key:"getDateForSoftDate",value:function(e){var t=r.default.timeline.getDateForKey(e.toLowerCase());if(!isNaN(t)){var a=100*Math.round(t/100),i={days:Math.round(a/100),minutes:Math.round(t-a)};return Date.today().add(i)}}},{key:"getBlock",value:function(e,t){var a,o=this.isViewDates(),s=this.isViewAgenda(),l=e;if(o&&!i.default.isString(e)?(a=e,l=e=this._getKeyForDate(a),"overdue"===e&&(!t.isComplete()&&r.default.timeline.getDateForKey(e)||(e=void 0),a=void 0)):i.default.isObject(e)&&(i.default.Assert(e.value&&e.lower,"If key is object it should have this form"),l=e.lower,e=e.value),e){var u,d=this.isViewAutoBlocks()?void 0:g.a.getItem(e),c=this.getViewMode(),h=this.blocksByKey[l];if(!h)if(void 0!==(u=d?d.getStyledTextAsOneLine(!0):this.isViewPriority()?e===n.a.VMLIFlag.P0?"High":e===n.a.VMLIFlag.P1?"Medium":e===n.a.VMLIFlag.P2?"Low":"(No priority)":e)){var f={pane:this,id:e,name:u,sortMode:this.supportsSortItems()&&this.getSortModeItems(),addFn:this.isViewProject()&&this.addFnProject.bind(this)||this.isViewTag()&&this.addFnTag.bind(this)||this.isViewContact()&&this.addFnContact.bind(this)||this.isViewPriority()&&this.addFnPriority.bind(this)||s&&this.addFnDate};this.isViewTag()?(f.name=e===this.blockNoKey?"(No tag)":"#"+f.name,f.isTag=!0):this.isViewContact()?(f.name=e===this.blockNoKey?"(No contact)":"+"+f.name,f.isContact=!0):this.isViewPriority()&&(f.isPriority=!0,f.priority=e),c===T.Groups_Project&&(f.name=e===this.blockNoKey?"(No project)":f.name,f.item=d,f.isEditable=!0,f.date=d&&d.getDate(this)),e===this.blockNoKey&&(f.isNoKey=!0),o&&(a?(f.date=a.clone().clearTime(),f.isDate=!0,f.date.equals(Date.today())&&(f.isToday=!0)):(f.date=this.getDateForSoftDate(e),f.name=f.name.toUpperCase(),"now"===e?f.isNow=!0:"starred"===e?f.isStarred=!0:"important"===e?f.isImportant=!0:"overdue"===e&&(f.isOverdue=!0,f.noAddButton=!0))),h=new _(f),this.blocksByKey[l]=h,h.originalIndex=this.blocks.length,this.blocks.push(h)}}return h}},{key:"closestIndexOfObject",value:function(e){return this.indexOfItem(e,e.block,e.index)}},{key:"onGCalendarActiveChanged",value:function(e,t){this.supportDataRefresh=t;var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)}},{key:"onGmailActiveChanged",value:function(e,t){var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)}},{key:"refreshPaneData",value:function(){var e=r.default.pluginManager.getPluginGCalendar();e.isActive()&&e.forceRemoteEventSync()}},{key:"viewModeIcon",value:function(){var e=this.getViewMode();return n.a.TaskViewModeIcon[e]}},{key:"viewModeColor",value:function(){return this.isViewOutline()?"#09d":"#a30"}},{key:"isViewDates",value:function(){return this._isViewHelper.dates}},{key:"isViewAgenda",value:function(){return this._isViewHelper.agenda}},{key:"isViewCalendar",value:function(){return this._isViewHelper.calendar}},{key:"isViewCalendarHoriz",value:function(){return this._isViewHelper.calendarHoriz}},{key:"isViewCalendarMonth",value:function(){return this._isViewHelper.calendarMonth}},{key:"isViewProject",value:function(){return this._isViewHelper.project}},{key:"isViewProjectNoBlocks",value:function(){return this._isViewHelper.project&&(0===this.blocks.length||1===this.blocks.length&&this.blocks[0].id===this.blockNoKey)}},{key:"isViewGroups",value:function(){return this._isViewHelper.groups}},{key:"isViewOutline",value:function(){return this._isViewHelper.outline}},{key:"isViewFlatList",value:function(){return this._isViewHelper.flatList}},{key:"isViewTag",value:function(){return this._isViewHelper.tag}},{key:"isViewContact",value:function(){return this._isViewHelper.contact}},{key:"isViewPriority",value:function(){return this._isViewHelper.priority}},{key:"isViewAutoBlocks",value:function(){return this._isViewHelper.autoBlocks}},{key:"isViewText",value:function(){return this._isViewHelper.text}},{key:"isViewPremiumBlocked",value:function(){return!1}},{key:"shouldShowAddBox",value:function(){return this.isViewOutline()||this.isViewProject()}},{key:"isCalFilterActive",value:function(){var e=this.displayCalendars.get(),t=!this.displayLocalItems.get();for(var a in e)if(e.hasOwnProperty(a)&&!1===e[a]){t=!0;break}return t}},{key:"becomeReal",value:function(){C(P(t.prototype),"becomeReal",this).call(this),this.onViewStateChanged()}},{key:"onViewStateChanged",value:function(){var e=this;this.isFakePane?this.setupViewStateMinor():(i.default.setItemAnimationMode(n.a.ItemAnimationMode.None),this.setIgnoreRestoreScroll(void 0,function(){e._infiniteList.saveScrollOfTop()}),this.setupViewState(!0),this._infiniteList.clearCache(),this._infiniteList.alwaysRenderScroll=!0,this.isViewCalendar()||this._infiniteList.setInitialScrollOffset(0),this.updateItemsImmediate(!0,void 0,void 0,!0),r.default.PaneManager.updatePaneStateForPane(this),this.isViewDates()?(this.scrollToToday(n.a.ScrollDuration.Snap),requestAnimationFrame(function(){e.isViewDates()&&(e.scrollToToday(n.a.ScrollDuration.Snap),i.default.resetItemAnimationMode(),requestAnimationFrame(function(){this._infiniteList.alwaysRenderScroll=!1}.bind(e)))})):this.setScrollOffset(0,n.a.ScrollDuration.Snap),i.default.resetItemAnimationMode(),this.hasCollapsedObs.set(this.hasCollapsed()))}},{key:"setupViewStateMinor",value:function(){var e=this.getViewMode(),t=this.getSortModeBlocks(),a={agenda:e===T.Agenda_Today||e===T.Agenda_Week||e===T.Agenda_All,calendar:e===T.Calendar_Day||e===T.Calendar_Week||e===T.Calendar_Month||e===T.Calendar_Custom,calendarHoriz:e===T.Calendar_Day||e===T.Calendar_Week||e===T.Calendar_Custom,calendarMonth:e===T.Calendar_Month,project:e===T.Groups_Project,groups:e===T.Groups_Project||e===T.Groups_Tag||e===T.Groups_Contact||e===T.Groups_Priority,outline:e===T.Outline||e===T.List_Flat,flatList:e===T.List_Flat,tag:e===T.Groups_Tag,contact:e===T.Groups_Contact,priority:e===T.Groups_Priority};a.dates=a.agenda||a.calendar,a.autoBlocks=a.agenda||a.tag||a.contact||a.priority,a.text=!a.calendar,this._isViewHelper=a,this.supportsSortBlocks()&&(this.supportsSortBlocksMode(t)||this.setSortModeBlocks(x[e].Default,1,!1),(t=this.getSortModeBlocks())===E.Completed&&0===this.search.getFilterValue("completeOption")&&this.search.setFilter("completeOption",1)),this.search.setFilterEnabled("showOnlyAgendaDates",this.isViewAgenda()),this.search.setFilterEnabled("showOnlyMatchingTags",this.isViewTag()||this.isViewContact()),this.search.setFilterEnabled("showChildProjects",this.isViewProject()),(this.isViewTag()||this.isViewContact())&&this.search.setFilterTooltip("showOnlyMatchingTags","Show only matching "+(this.isViewTag()?"Tag":"Contact")+" blocks")}},{key:"setupViewState",value:function(e){this.setupViewStateMinor();var t,a=this.getViewMode(),o=this.getSortModeBlocks(),s=this.isViewOutline(),l=this.isViewCalendar()||i.default.activeDisplayMode&n.a.DisplayMode.NoPaneTop?0:(p.a.isMobile||!this.isViewAgenda()&&!this.isViewProject()?!p.a.isMobile&&36:48)||p.a.isMobile&&16;if(this.blockNoKey=L+"_"+a,this.supportIndent=s,this.supportMultiselect=s,this.overviewTracksScroll=s,this.supportSearchFlat=s,this.supportCheckbox=!this.isViewCalendar(),this.topBoxHeight.set(l,!1),this.paneClass=this.getPaneClass(),this.paneEmptyMessage=(this.isViewAgenda()?"Nothing on the agenda":this.isViewOutline()&&"Write some things here to get started")||"",this.collapsedFieldName=n.a.PerPaneStateField.Collapsed+(this.viewState?a:""),this._isSearchedFlat=!(this.isViewCalendar()||!this.search)&&!this.search.showHierarchy(),this.isViewPremiumBlocked()?this.toast.set({text:"The "+n.a.TaskViewModeText[a]+" view is a Premium feature",actionText:"GO TO OUTLINE",doAction:this.switchToOutline}):this.toast.set(void 0),(this.isViewCalendar()||this.isViewAgenda())&&(t=n.a.ItemStoreFilter.Dates,(this.isViewCalendar()||this.getSortModeBlocks()===E.Date)&&(t|=n.a.ItemStoreFilter.Priority)),this.search.itemStoreFilter=t,this.search.onlyMatchDates=this.isViewDates(),this.shouldUpdateOnTextChanged=this.isViewAgenda()||this.isViewTag(),this.combineOverdue=this.isViewAgenda()&&o===E.Date,this.showScrollbars.set(!this.isViewCalendar()),this.isViewAgenda()){var u,d;if(a!==T.Agenda_All)a===T.Agenda_Today?d=1:a===T.Agenda_Week&&(d=7),u=Date.today().addDays(o===E.Date?d:-(d-1));o===E.Date?this.endDate=u:(this.startDate=u,this.endDate=Date.today().addDays(1))}this.isEditable=this.supportSel=!this.isViewCalendar(),this.orientation.set(this.isViewCalendarHoriz()?n.a.Orientation.Horizontal:n.a.Orientation.Vertical),a===T.Calendar_Week||a===T.Calendar_Month?(this.minWidthFlex=700,this.maxWidthFlex=1200,this.maxWidthSingle=1600,this.minWidth=600,this.maxWidth=1600):(this.minWidth=n.a.StdPaneWidthMin,this.minWidthFlex=n.a.StdPaneWidthMin,this.maxWidth=n.a.PaneWidthMax,this.maxWidthFlex=this.maxWidthSingle=n.a.StdPaneWidthMax),this.dateInMiddle=this._getDateInMiddle(),r.default.PaneManager.updatePaneRects()}},{key:"getPaneClass",value:function(){return"paneTask pane"+((this.isViewCalendar()?"Calendar":this.isViewAgenda()&&"Agenda")||this.isViewProject()&&"Project"||this.isViewTag()&&"Tag"||this.isViewContact()&&"Contact"||this.isViewPriority()&&"Priority"||this.isViewOutline()&&"Outline")}},{key:"onScroll",value:function(){this.getViewMode();this.isViewCalendarHoriz()&&(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50))}},{key:"_handleDragOverPane",value:function(e,t,a,n,o,s,l){if(e&&i.default.findParent(a,"paneContent")&&!i.default.hasClass(a,"paneContent")&&!i.default.hasClass(a,"paneTopBox")&&o&&"blockHeader"===o.type&&(this.isViewAgenda()&&e.supportDates||this.isViewAutoBlocks())){var u,d=i.default.getListCellForElement(a);return d&&d.props.cell&&(u=d.props.cell.paneObject.block,this.isViewAgenda()&&u.isOverdue&&(u=void 0)),this.dragHoveredBlock.set(u),r.default.DragDrop.setBlockTarget(u),{block:u}}if(!o||"blockItem"===o.type)return this.dragHoveredBlock.set(void 0),this.isViewCalendar()||r.default.DragDrop.setBlockTarget(void 0),this._handleDragOverTasks(e,t,a,n,o,s,l)}},{key:"_handleDragOverTasks",value:function(e,t,a,r,o,s,l){var u,d,c,h,f,g,m=!1,v=n.a.DragDropPosition.Below,y=!1,_=0;if(o){u=o.item,g=o.index,u.isNote()&&(g--,o=this.objectAtIndex(g),r=this.elementAtIndex(g),u=u.parent()),u.hasNote()&&(_=this.sizeOfItem(u.getNote(),g+1));var b=r.getBoundingClientRect(),k=b.height+_;if(p.a.isMobile)v=l<b.top+k/2?n.a.DragDropPosition.Above:n.a.DragDropPosition.Below;else v=this.isSearchedFlat()&&this.search.isFlatSearchResult(u)||this.isViewAgenda()||this.isViewAutoBlocks()?n.a.DragDropPosition.On:l<b.top+k/3&&(!this.isViewProject()||0!==o.levelsDeep)?n.a.DragDropPosition.Above:l>b.top+2*k/3?n.a.DragDropPosition.Below:n.a.DragDropPosition.On;c=r,m=!0}else if(0===this.numItems())u=this.getItem(),y=!0;else if(p.a.isMobile||!this.isSearchedFlat()&&i.default.findParent(a,"paneScroller")&&!this.isViewProject()){var w=this.indexOfLastItem();if(!m&&w>=0&&this.isIndexMounted(w))if(l>=(f=this.elementAtIndex(w)).getBoundingClientRect().bottom)u=this.getLastItem(),o=this.getLastObject(),c=f,v=n.a.DragDropPosition.Below,m=!0}else u=this.getItem(),y=!0,h=!0;if(!m&&!this.isSearchedFlat()){var S=this&&this.indexOfFirstItem();if(this&&S>=0&&this.isIndexMounted(S))if(l<(f=this.elementAtIndex(S)).getBoundingClientRect().top)u=this.getFirstItem(),o=this.getFirstObject(),c=f,v=this.isViewProject()&&0===o.levelsDeep?n.a.DragDropPosition.On:n.a.DragDropPosition.Above,m=!0}if(m){var I=c.getBoundingClientRect(),D=v!==n.a.DragDropPosition.Below?I.top:I.top+I.height+_,C=v===n.a.DragDropPosition.On?I.height:void 0;if(D>this.contentTop()){var P;v===n.a.DragDropPosition.Below&&g+1<this.numItems()&&u.hasChildren()&&((P=this.objectAtIndex(g+1)).item||(P=void 0)),P=P||o;var A=this.getPaddingForPaneObject(P);d={left:I.left+A,top:D,width:I.right-I.left-A,height:C}}}return this.scrollFromMousePosition(s,l,this.orientation.get()===n.a.Orientation.Horizontal),{position:v,targetElement:c,targetItem:u,linePosition:d,overview:!1,dropOnPane:y,atEnd:h}}},{key:"handleDragDrop",value:function(e,a,i,n){r.default.DragDrop.blockTarget?(r.default.DragDrop.startPane.applyDropOnBlock(r.default.DragDrop.blockTarget,e,this,a.dataTransfer.block),this.revertDrag()):this.isViewAutoBlocks()||C(P(t.prototype),"handleDragDrop",this).call(this,e,a,i,n)}},{key:"revertDrag",value:function(){C(P(t.prototype),"revertDrag",this).call(this),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)}},{key:"getSaveInfo",value:function(){var e=C(P(t.prototype),"getSaveInfo",this).call(this);return e.viewState=this.viewState.get(),e.displayCalendars=this.displayCalendars.get(),e.displayLocalItems=this.displayLocalItems.get(),e.blocksCollapsed=this.blocksCollapsed,e}},{key:"isBlockCollapsed",value:function(e){return e.item?e.item.isCollapsed(this):!0===this.blocksCollapsed[e.id]}},{key:"setBlockCollapsed",value:function(e,t){s.a.reset(),this.blocksCollapsed[e.id]=t,this.hasCollapsedObs.set(this.hasCollapsed()),this.updateBlockItems(),r.default.PaneManager.savePaneState()}},{key:"onInfiniteListLoaded",value:function(){!this.initialOffset&&this.isViewCalendar()&&(this.initialOffset=this.getScrollOffsetOfToday()||0,this._infiniteList.setInitialScrollOffset(this.initialOffset))}},{key:"addProject",value:function(e,t,a){return this.addItemWithPrefix(e,n.a.Prefix.Header,t,a)}},{key:"addItemWithPrefix",value:function(e,t,a,i){e=e||0,r.default.PaneUpdateBatcher.beginUpdateItems(),s.a.reset(),this.setIgnoreRestoreScroll();var o=i?this.getRootItem():this.getItem(),l=(t?t+" ":"")+(a||""),u=r.default.settings.getDefaultItemText(),d=o.addItemAtIndex(l,e,this);this.isViewProject()&&t===n.a.Prefix.Header&&d.addItemAtIndex(u,e,this),r.default.PaneUpdateBatcher.commitUpdateItems();var c=this.indexOfItem(d);return this.scrollIndexIntoView(c),s.a.selectIndex(c,l.length),d}},{key:"setDisplayLocal",value:function(e){this.displayLocalItems.set(e),this.updateItems()}},{key:"setDisplayCalendar",value:function(e,t){var a=i.default.clone(this.displayCalendars.get());a[e.id]=t,this.displayCalendars.set(a),this.updateItems()}},{key:"getCollapsedDefault",value:function(e,t,a){return t?e.parent()!==this.getRootItem():(a=a||this.getViewMode(),!(this.isViewOutline()||this.isViewProject()&&e.isPrefixHeader()&&this.isItemTopLevel(void 0,e)))}},{key:"getWidth",value:function(){var e=C(P(t.prototype),"getWidth",this).call(this);return this.isViewCalendar()&&!this.isViewCalendarMonth()&&(e-=50),e}},{key:"getMonthStart",value:function(e){return e.clone().clearTime().addDays(1-e.getDate())}},{key:"getWeekStart",value:function(e){return e.clone().clearTime().addDays(-e.getDay()+r.default.settings.dayWeekStart.get())}},{key:"doesWeekCrossMonth",value:function(e){if(e.clone().addDays(6).getDate()<e.getDate())return!0}},{key:"updateCalendarMonth",value:function(){var e,t,a,i=0,r=0,o=[],s=this.dateInMiddle,l=this.getWeekStart(s),u=n.a.CalendarMonthViewNumWeeksPad;for(a=-1;o.length<u;a--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e=l.clone().addWeeks(a),t=this.doesWeekCrossMonth(e),o.splice(0,0,this.updateCalendarMonthWeek(e,!1,t)),t&&o.length<u&&o.splice(0,0,this.updateCalendarMonthWeek(e,!0,!1))}for(u=2*n.a.CalendarMonthViewNumWeeksPad+1,a=0;o.length<u;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e=l.clone().addWeeks(a),(t=this.doesWeekCrossMonth(e))&&o.length<u&&o.push(this.updateCalendarMonthWeek(e,!0,!1)),o.push(this.updateCalendarMonthWeek(e,!1,t))}this.items.set(o)}},{key:"updateCalendarMonthWeek",value:function(e,t,a){for(var i,n,r=0,o=[],s=1===e.getDate(),l=0;l<7;l++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=e.clone().addDays(l);i&&u.getDate()<i.getDate()&&(s=!0),!s&&a||s&&t||(o[l]={date:u,items:this.getItemsOnDate(u)},n||(n=u)),i=u}return{type:"calendarWeek",id:"week_"+e+(t?"_end":""),date:n,dates:o,sizeInPane:this.heightWeek()}}},{key:"heightWeek",value:function(){return n.a.CalendarMonthViewWeekHeight}},{key:"updateCalendarWeek",value:function(){for(var e=0,t=[],a=n.a.CalendarDayViewNumDaysPad,i=this.dateInMiddle,r=this.getViewMode(),o=-a;o<a;o++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=i.clone().addDays(o),l=(this._getKeyForDate(s),this.getItemsOnDate(s));t.push({type:"calendarDay",id:r+"_day_"+(o+a),date:s,items:l,sizeInPane:this.getDayWidth})}this.items.set(t)}},{key:"getItemPlacementOnDate",value:function(e,t){var a=!e.getDate(),i=e.getNextDate(t),r=e.getDuration()&&i&&e.getEndDate();if(i&&i.hasTimeOfDay()&&(a||i.isSameDay(t))){var o=i.getHours()+i.getMinutes()/60,s=e.getDuration()?e.getDuration()/n.a.MSPerHour:1;if(s=Math.round(10*Math.min(s,24-i.getHours()))/10,o>0||s<24)return{time:o,duration:s}}else if(i&&i.hasTimeOfDay()&&r&&!i.isSameDay(t)&&r.isSameDay(t)){return{time:0,duration:r.getHours()+r.getMinutes()/60}}return!1}},{key:"updateAllDay",value:function(){if(!this._destroyed){for(var e=0,t=this.indexOfTop(),a=this.inViewCount(),i=1,n=t;n<t+a;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this.items.get()[n];if(r){for(var o=0,s=0,l=r.items||[],u=0;u<l.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=l[u];this.getItemPlacementOnDate(d,r.date)||s++}s>i&&(i=s)}}this.numAllDay.set(i)}}},{key:"getContentHeight",value:function(){return 1224+this.getHeightAllDay()+2}},{key:"getHeightAllDay",value:function(){return Math.min(n.a.CalendarDayViewMaxAllDayHeight,26*this.numAllDay.get())+1}},{key:"getDayViewY",value:function(){return 409}},{key:"getDayWidth",value:function(){var e=this.getWidth(),t=this.getViewMode(),a=(t===T.Calendar_Day?1:t===T.Calendar_Week&&7)||t===T.Calendar_Custom&&r.default.settings.calendarCustomDays.get();return Math.max(e/a,40)}},{key:"getPaddingForPaneObject",value:function(e,a){var i=C(P(t.prototype),"getPaddingForPaneObject",this).call(this,e,a);return a||(i+=this.extraPaddingForPaneObject(e)),i}},{key:"extraPaddingForPaneObject",value:function(e){return this.isViewAgenda()?n.a.PaddingAgendaTime:0}},{key:"shouldShowTime",value:function(e){var t="blockItem"===e.type&&e.item;return t&&!t.isNote()&&0===e.levelsDeep&&e.block&&e.block.shouldShowTime()}},{key:"isSearchedFlat",value:function(){return this._isSearchedFlat}},{key:"isItemTopLevel",value:function(e,a){var i=!0;if(this.isViewProject()){if(e)return e.isBlockHeader;i=a.isPrefixHeader(this)}return this.isViewProject()&&this.search.showChildProjects()||(i=C(P(t.prototype),"isItemTopLevel",this).call(this,e,a)),i}},{key:"openViewMenu",value:function(e){r.default.menus.openContextMenu({componentName:"ReactContextMenuPanes",element:e.target,pane:this,positionOffset:{left:45},subset:n.a.PaneMode.Task})}},{key:"hasCollapsed",value:function(e){if(!e&&this.isViewAutoBlocks()){for(var a=0,i=0;this.blocks&&i<this.blocks.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.isBlockCollapsed(this.blocks[i]))return!0}return!1}return C(P(t.prototype),"hasCollapsed",this).call(this,e)}},{key:"toggleCollapseAll",value:function(){var e=!this.hasCollapsed();if(this.isViewAutoBlocks()){for(var a=0,i=0;i<this.blocks.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.blocksCollapsed[this.blocks[i].id]=e}e||(e=void 0)}C(P(t.prototype),"collapseAll",this).call(this,this.item.get(),e,void 0,this.isViewAutoBlocks())}},{key:"supportsSortBlocks",value:function(e){return e=e||this.getViewMode(),t.viewModeSupportsSortBlocks(e)}},{key:"supportsSortBlocksMode",value:function(e,a){return a=a||this.getViewMode(),t.viewModeSupportsSortBlocksMode(e,a)}},{key:"supportsSortItems",value:function(e){return e=e||this.getViewMode(),t.viewModeSupportsSortItems(e)||this.isViewOutline()&&this.isSearchedFlat()}},{key:"getSortModeBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.mode}},{key:"getSortOrderBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.order||1}},{key:"isSortedBlocks",value:function(){var e=this.getSortModeBlocks();return e&&e!==E.None}},{key:"setSortModeBlocks",value:function(e,t,a){this.setViewProp("sortModeBlocks",{mode:e,order:t},a)}},{key:"getSortModeItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.mode}},{key:"getSortOrderItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.order||1}},{key:"setSortModeItems",value:function(e,t,a){this.setViewProp("sortModeItems",{mode:e,order:t},a)}},{key:"isSortedItems",value:function(){var e=this.getSortModeItems();return e&&e!==E.None}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){this.setViewProp("viewMode",e)}},{key:"setViewProp",value:function(e,t,a){var i=this.viewState.get();i[e]!==t&&(i[e]=t,this.viewState.set(i,!1!==a))}},{key:"createVMLI",value:function(e,a){var i=this.search.getTags();if(!this.isViewTag()&&i)for(var n=0,r=0;r<i.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[r],s="#"+o;if(e.text.indexOf(s)<0){for(var l=0,u=!1,d=a&&a.parent;d;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var c=d.getTags();if(c&&c.indexOf(o)>=0){u=!0;break}d=d.parent()}u||(e.text+=" "+s)}}return C(P(t.prototype),"createVMLI",this).call(this,e,a)}},{key:"getItemDisplayTime",value:function(e){var t=this.getSortModeBlocks(),a=e.item;return t===E.Date?a.getTime()||(e.showAllDay?"All day":""):t===E.Created?a._formatDateTime(a.dateCreated):t===E.Completed?a.dateCompleted?a._formatDateTime(a.dateCompleted):"no time":void 0}},{key:"checkFlatListMode",value:function(){var e=this.getViewMode();e===T.List_Flat&&0===this.search.getFilterValue("showOnlyMatches")&&this.setViewMode(T.Outline),e===T.Outline&&1===this.search.getFilterValue("showOnlyMatches")&&this.setViewMode(T.List_Flat)}},{key:"onCalendarCustomDaysChanged",value:function(){this.getViewMode()===T.Calendar_Custom&&this.onViewStateChanged()}},{key:"switchToOutline",value:function(){this.setViewMode(T.Outline)}},{key:"shouldRenderPrefix",value:function(e){return e.item.hasPrefix()&&!(this.isViewProject()&&e.isBlockHeader)}},{key:"bottomListMessage",value:function(){var e;if(!(this.numItems()>0)){var t=this.search.numUnmatchedItems();t&&(e=this.isSearched()?t+" items hidden by search / filters. Click the search box above to clear your search / filters, or click to add new items.":t+" completed items hidden by filter. Click the search box above and click the checkbox filter to show completed items.")}return{text:e,clickable:!1}}},{key:"needsUpdateForDate",value:function(e){return this.isViewDates()}},{key:"_anyTagHasKey",value:function(e){return e&&e.some(function(e){return r.default.timeline.getDateForKey("#"+e)})}},{key:"needsUpdateForTags",value:function(e,t){return this.isViewAgenda()&&this._anyTagHasKey(t)}},{key:"handleItemChanged",value:function(e,a){var i=!1;return a[n.a.ItemProp.Text]&&(this.isViewTag()||this.isViewContact())&&(i=!0),C(P(t.prototype),"handleItemChanged",this).call(this,e,a,i)}}])&&D(a.prototype,l),u&&D(a,u),t}(),R=a(24),F=n.a.TaskViewMode;function N(){this._inactivePaneTypes={},this.activePaneTypes=new R.a,this._registeredTypes={},this.numInactivePanes=new b.a(0),this.registerPaneType(void 0,n.a.PaneMode.Task,"Task",O,"icon-align-left",99),this.registerPaneType(void 0,n.a.PaneMode.Archived,"Archived",f,"icon-inbox",90)}N.prototype={paneSortCompare:function(e,t){return e.priority<t.priority?1:-1},registerPaneType:function(e,t,a,i,n,r){this._registeredTypes[t]={plugin:e,constructor:i};var o={type:t,name:a,icon:n,text:a,priority:r,tooltip:"Add "+a+" Pane"};!e||e.isActive()?this.activePaneTypes.insertSorted(o,this.paneSortCompare):(this._inactivePaneTypes[t]=o,this.numInactivePanes.set(this.numInactivePanes.get()+1))},activatePaneType:function(e){var t=this._inactivePaneTypes[e];i.default.Assert(t,"Must have previously registered pane type"),this._inactivePaneTypes[e]=void 0,this.activePaneTypes.insertSorted(t,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)},deactivatePaneType:function(e){var t=this.activePaneTypes.remove(function(t){return t.type===e})[0];i.default.Assert(t,"Must have previously activated pane type"),r.default.PaneManager.removePanesByType(e),this._inactivePaneTypes[e]=t,this.numInactivePanes.set(this.numInactivePanes.get()+1)},canCreatePane:function(e){var t=this._registeredTypes[e];return!(t.plugin&&(!t.plugin.isActive()||t.plugin.isPluginBlocked()))},createPane:function(e,t){(t=t||{}).id||(t.id=r.default.PaneManager.getNextPaneID()),"PaneTimeline"===e?(e=n.a.PaneMode.Task,t.viewState={viewMode:F.Agenda_All}):"PaneOutline"===e&&(e=n.a.PaneMode.Task,t.viewState={viewMode:F.Outline});var a=this._registeredTypes[e];if(a){if(!a.plugin||a.plugin.isActive()&&!a.plugin.isPluginBlocked())try{r.default.PaneUpdateBatcher.beginUpdateItems();var o=new a.constructor(t);return r.default.PaneUpdateBatcher.commitUpdateItems(),o}catch(s){return void i.default.reportError(s)}}else i.default.Assert(!1,"Invalid pane type requested")},isPaneTypeActive:function(e){var t=!!this._registeredTypes[e],a=!!this._inactivePaneTypes[e];return t&&!a},getRegisteredPanes:function(){return this.activePaneTypes.get()},_getTaskView:function(e,t,a,i){for(var o=0,s=[],l=0;l<a.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=a[l],d=n.a.TaskViewModeText[u];u===F.Calendar_Custom&&(d=d.replace("#",r.default.settings.calendarCustomDays.get())),s.push({text:d,type:n.a.PaneMode.Task,viewMode:u,icon:n.a.TaskViewModeIcon[u],premium:!!n.a.TaskViewModesPremium[u],canZoom:!0})}e.push({text:t,viewModes:s,border:!i})},getAvailablePanes:function(e){var t=this.activePaneTypes.get(),a=this.numInactivePanes.get(),i=[];if(this._getTaskView(i,"List",[F.Outline,F.List_Flat]),this._getTaskView(i,"Grouped by",[F.Groups_Project,F.Groups_Tag,F.Groups_Contact,F.Groups_Priority]),this._getTaskView(i,"Agenda",[F.Agenda_Today,F.Agenda_Week,F.Agenda_All]),this._getTaskView(i,"Calendar",[F.Calendar_Day,F.Calendar_Custom,F.Calendar_Week,F.Calendar_Month],e),!e){for(var r=0,o=0;o<t.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=t[o];if(s.type!==n.a.PaneMode.Task){var l=s.type===n.a.PaneMode.Gmail;i.push({text:s.text,type:s.type,icon:s.icon,canZoom:l,border:!0})}}i[i.length-1].border=!1,a>0&&i.push({enableMore:!0})}return i}};t.a=new N},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(2),o=a(4),s=a.n(o),l=a(13);function u(){return(u=Object.assign||function(e){for(var t=0,a=1;a<arguments.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=arguments[a];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function d(e,t){if(null==e)return{};var a,i,n=function(e,t){var a=0;if(null==e)return{};var i,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=o[n],t.indexOf(i)>=0||(r[i]=e[i])}return r}(e,t);if(Object.getOwnPropertySymbols){var r=0,o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}}return n}var c=l.b.createClass({displayName:"FancyScroller",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){var e=this.props;if(this.thumbExtraHeight=0,i.default.Assert(!(e.noOwnScroll&&e.onScroll),"FancyScroller can not have onScroll prop if it does not own its own scroll"),!r.a.isMobile){var t={isVisible:!1,isDragging:!1,thumbTop:0,thumbHeight:0};this.props.trackHasScrolled&&(t.hasScrolled=!1),this.createObservables(t)}},onMount:function(){this.refs.thumb&&this.addTap("thumb",this,this.onTapThumb)},onUnmount:function(){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)},getScrollSize:function(){var e=this.props.orientation!==n.a.Orientation.Horizontal?"Height":"Width";return this.props.getScrollSize?this.props.getScrollSize():this.refs.scroller["scroll"+e]},getClientHeight:function(){var e=this.props.orientation!==n.a.Orientation.Horizontal?"Height":"Width";return this.props.getClientHeight?this.props.getClientHeight():this.refs.scroller["client"+e]},getScrollTop:function(){var e=this.props.orientation!==n.a.Orientation.Horizontal?"Top":"Left";return this.props.getScrollTop?this.props.getScrollTop():this.refs.scroller["scroll"+e]},calculateThumb:function(){this.props;var e,t=this.getScrollSize(),a=this.getClientHeight(),i=this.getScrollTop(),n=this.props.thumbHeight;(n||(t===a?n=a:(n=a/t*a,this.thumbExtraHeight=n<30?30-n:0,n=Math.floor(Math.max(n,30)))),t===a)?e=0:e=i/(t-a)*(a-n);e=Math.floor(e);var r=n!==this.thumbHeight.get()||e!==this.thumbTop.get();this.thumbHeight.set(n,!1),this.thumbTop.set(e,r)},onScroll:function(e){this.handleScroll(),this.props.onScroll&&this.props.onScroll(e)},handleScroll:function(){this.isMouseDown||(this.calculateThumb(),this.isVisible.set(!0),this.hideTimeout()),this.props.trackHasScrolled&&this.hasScrolled.set(this.getScrollTop()>0)},onMouseMove:function(e){this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)},onMouseEnter:function(e){var t=this.refs.scroller;t.scrollHeight>t.clientHeight&&(this.timeoutShow&&clearTimeout(this.timeoutShow),this.timeoutShow=setTimeout(this.showScrollbar,100))},onMouseLeave:function(e){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.isMouseDown||this.hideTimeout()},onTapThumb:{onStart:function(e){e.button===n.a.ButtonCode.Left&&(this.isMouseDown=!0,this.lastY=this.props.orientation===n.a.Orientation.Horizontal?e.clientX:e.clientY,i.default.disableMouseMove=!0,this.isDragging.set(!0)),e.stopPropagation()},onMove:function(e){if(this.isMouseDown){var t=this.refs.scroller,a=this.props.orientation===n.a.Orientation.Horizontal,r=a?e.clientX:e.clientY,o=a?"Left":"Top",s=a?"Width":"Height",l=r-this.lastY;this.lastY=r;var u=i.default.clamp(this.thumbTop.get()+l,0,t["client"+s]-this.thumbHeight.get());this.thumbTop.set(u);var d=u/(t["client"+s]-this.thumbExtraHeight)*t["scroll"+s];t["scroll"+o]=d,e.preventDefault()}},onEnd:function(e){this.isMouseDown&&e.button===n.a.ButtonCode.Left&&(this.isMouseDown=!1,i.default.disableMouseMove=!1,this.isDragging.set(!1),this.hideTimeout())}},hideTimeout:function(){this.timeoutHide&&clearTimeout(this.timeoutHide),this.timeoutHide=setTimeout(this.hideScrollbar,500)},hideScrollbar:function(){this.isVisible.set(!1),this.timeoutHide=void 0},showScrollbar:function(){this.calculateThumb(this.refs.scroller),this.isVisible.set(!0),this.timeoutShow=void 0},getElement:function(){return this.refs.element},getScrollElement:function(){return r.a.isMobile?this.getElement():this.refs.scroller},scrollTo:function(e,t,a){isNaN(a)&&(a=n.a.ScrollDuration.Default),i.default.scrollTo(e,t,a,this.refs.scroller)},scrollToBottom:function(){var e=this.getClientHeight();this.scrollTo(0,e)},render:function(){var e=this.state,t=this.props,a=(t.getScrollSize,t.getClientHeight,t.getScrollTop,t.noOwnScroll),o=t.showScrollbars,l=(t.trackHasScrolled,t.scrollable),c=(t.orientation,t.tinyMode),h=d(t,["getScrollSize","getClientHeight","getScrollTop","noOwnScroll","showScrollbars","trackHasScrolled","scrollable","orientation","tinyMode"]),f=t.orientation===n.a.Orientation.Horizontal,p=!1!==l&&!i.default.noScrollbars,g=i.default.classNames("fancyScroller",t.className,{flexbox:!r.a.isMobile},{"flexvert horizontal":f},{vertical:!f},{trackHasScrolled:t.trackHasScrolled},{scrolled:e.hasScrolled},{tinyMode:c}),m=i.default.classNames("fancyScrollbar",{"visible c-border":e.isVisible},{dragging:e.isDragging}),v=i.default.classNames("fancyScrollbarThumb c-bg-scrollthumb",{dragging:e.isDragging}),y={};f?(y.width=e.thumbHeight,y[r.a.transform.react]="translate3d("+e.thumbTop+"px,0,0)"):(y.height=e.thumbHeight,y[r.a.transform.react]="translate3d(0,"+e.thumbTop+"px,0)");var _=i.default.classNames("fancyScrollContent",{hideScrollbar:void 0!==t.showScrollbars},{scrollable:p}),b={};return b[t.orientation===n.a.Orientation.Horizontal?"overflowX":"overflowY"]="auto",r.a.isMobile?s.a.createElement("div",u({},h,{className:g,ref:"element","data-moo-id":this.getUniqueID()}),t.children):s.a.createElement("div",u({},h,{className:g,ref:"element"}),s.a.createElement("div",{className:_,style:b,ref:"scroller",onScroll:a?void 0:this.onScroll,"data-moo-id":this.getUniqueID()},t.children),!r.a.isFirefox&&p&&o&&s.a.createElement("div",{className:m,ref:"scrollbar",onMouseMove:this.onMouseMove,onMouseEnter:this.props.tinyMode?void 0:this.onMouseEnter,onMouseLeave:this.props.tinyMode?void 0:this.onMouseLeave},s.a.createElement("div",{className:v,style:y,ref:"thumb"})))}});t.a=c},function(e,t,a){"use strict";var i,n=a(0),r=a(7),o=a(16);function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=(function(e,t,a,i,n){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null)}((i=function(e){function t(e,a,i){var r,o=0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=u(this,d(t).call(this,void 0,i)))._destroyed=!1;for(var s=0;s<e.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e[s].listen(r.onChanged)}return r._observables=e,a&&n.default.isFunction(a)?r.checkFn=a:r.checkFn="or"===a?r.checkFnOr:r.checkFnAnd,r._value=r.checkFn(),r}var a,i,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r["a"]),a=t,(i=[{key:"checkFnOr",value:function(){for(var e=0,t=!1,a=0;!t&&a<this._observables.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t=t||this._observables[a].get()}return t}},{key:"checkFnAnd",value:function(){for(var e=0,t=!0,a=0;t&&a<this._observables.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t=t&&this._observables[a].get()}return t}},{key:"onChanged",value:function(e,t,a){var i=this._value,n=this.checkFn();(n!==i||a)&&this.set(n,a)}},{key:"destroy",value:function(){var e=0;this._destroyed=!0;for(var t=0;t<this._observables.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._observables[t].unlisten(this.onChanged)}}}])&&l(a.prototype,i),o&&l(a,o),t}()).prototype,"onChanged",[o.a],Object.getOwnPropertyDescriptor(i.prototype,"onChanged"),i.prototype),i);t.a=h},,function(e,t,a){"use strict";var i=a(3),n=a(1),r=a(43),o=a(74),s=a.n(o),l=a(21),u=a(55);function d(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,o;return t=e,(a=[{key:"parseText",value:function(e){var t,a=(e=e.toLowerCase()).substring(e.indexOf("every")),i=l.b.parseText(a,void 0);if(i){var n=i.options,o=i.fromDate,d=i.duration;o||(o=new Date,o=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes())));var c=Object.assign({dtstart:o},n);delete c.interval;var h=new l.b(c).after(o,!0);if(h){var f=n.byhour?n.byhour[0]+o.getTimezoneOffset()/60:0,p=n.byminute?n.byminute[0]:0;h=this.toUTCDate(h,f,p),n.dtstart=h,t=r.a.fromRRuleOptions(n,d)}}else{var g=s.a.parse(e,void 0,{forwardDate:!0})[0];if(g){var m=Date.parse(g.text);if(m){var v,y=e.substring(g.index+g.text.length).trim().match(u.a.tokens.duration);y&&(v=+y[1]*("h"===y[2][0]?60:1)),t=new r.a(m,{duration:v})}}}return t}},{key:"toUTCDate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),t,a))}},{key:"toHumanText",value:function(e,t){var a=+new Date(e).clearTime()-+Date.today(),r="";return t||(a<0&&a>=-864e5?r="Yesterday":e.isToday()?r="Today":a>0&&a<1728e5&&(r="Tomorrow")),r||(r=e.toString(i.default.International.getFormat(e.getFullYear()!==Date.today().getFullYear()?n.a.DFormat.MonthDayYear:n.a.DFormat.MonthDay))),e.hasTimeOfDay()&&(r+=" "+e.toString(i.default.International.getFormat(n.a.DFormat.ShortTime)).toLowerCase()),r}},{key:"testGetNext",value:function(e,t,a){}},{key:"testOnDate",value:function(e,t,a){}},{key:"runTests",value:function(){}}])&&d(t.prototype,a),o&&d(t,o),e}();t.a=new c},function(e,t,a){"use strict";var i=a(0),n=a(4),r=a.n(n),o=a(51),s=a.n(o),l=a(2),u=a(13);function d(e){return(d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(){return(c=Object.assign||function(e){for(var t=0,a=1;a<arguments.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=arguments[a];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function h(e,t){if(null==e)return{};var a,i,n=function(e,t){var a=0;if(null==e)return{};var i,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=o[n],t.indexOf(i)>=0||(r[i]=e[i])}return r}(e,t);if(Object.getOwnPropertySymbols){var r=0,o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}}return n}function f(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==d(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,g(t).apply(this,arguments))}var a,n,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,u["a"]),a=t,(n=[{key:"init",value:function(){this.createObservables({ripples:[]}),this.rippleNum=0}},{key:"onMount",value:function(){l.a.isMobile&&this.props.onClick&&i.default.setupClick(this.refs.element,this,{onStart:this.onTapStart,onClick:this.onTapClick})}},{key:"getElement",value:function(){return s.a.findDOMNode(this)}},{key:"onMouseDown",value:function(e){var t=this.props;if(!1!==t.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(e),this.props.children&&!e.defaultPrevented&&!1!==t.ripple){var a,n,r=this.refs.element,o=r.offsetWidth,s=r.offsetHeight,l=Math.min(o,s);if(this.props.center)a="50%",n="50%";else{var u=i.default.offset(r);a=e.clientX-u.left,n=e.clientY-u.top}var d={id:this.rippleNum++,left:a,top:n,width:l,height:l};this.ripples.push(d),setTimeout(this.removeRipple,1e3)}e.stopPropagation()}}},{key:"onRightClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onRightClick(e)}},{key:"onTapStart",value:function(e){!1===this.props.enabled||i.default.findParent(e.target,"fancyInput")||(this.onMouseDown(e),e.stopPropagation())}},{key:"onTapClick",value:function(e){!1===this.props.enabled||i.default.findParent(e.target,"fancyInput")||(this.props.onClick(e),e.preventDefault(),e.stopPropagation())}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.props,n=[],o=0;o<t.ripples.length;o++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=t.ripples[o],l={left:s.left,top:s.top,width:s.width,height:s.height,marginLeft:-s.width/2,marginTop:-s.height/2};n.push(r.a.createElement("div",{key:"ripple_"+s.id,className:"fancyRipple",style:l}))}var u=i.default.classNames(this.props.className,"fancyRippler",{rippleCenter:this.props.center}),d=(a.center,a.onClick),f=(a.enabled,a.ripple,a.onRightClick),p=h(a,["center","onClick","enabled","ripple","onRightClick"]);return r.a.createElement("div",c({},p,{className:u,onMouseDown:this.onMouseDown,onClick:d,onContextMenu:f?this.onRightClick:void 0,ref:"element"}),this.props.children,n.length>0&&r.a.createElement("div",{className:"fancyRipples"},n))}}])&&f(a.prototype,n),o&&f(a,o),t}();t.a=v},function(e,t,a){"use strict";var i=a(0),n=a(11),r=a(1),o=a(3),s=a(12),l=a(6),u=a(2),d=a(7),c=a(24),h=a(5),f=a(39);function p(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isLive=!1,this.wasLive=!1,this.seenInPass=!1,this.deadNeedsNotify=!1,this.index=-1,this.width=0,this.height=0,this.offset=0,this.paneObject=void 0,this.cellChanged=new f.a,this.offsetX=new d.a(0),this.isAnimatingOffsetX=!1}var t,a,i;return t=e,(a=[{key:"kill",value:function(e){this.isLive=!1,this.index=-1,this.isAnimatingOffsetX=!1,e?(this.deadNeedsNotify=!1,this.cellChanged.notify()):this.deadNeedsNotify=!0}},{key:"update",value:function(e,t,a,i,n,r){this.seenInPass=!0,this.wasLive=this.isLive,this.deadNeedsNotify=!1,this.isAnimatingOffsetX=!1,this.isLive&&e===this.index&&t===this.width&&a===this.height&&i===this.offset&&r===this.paneObject||(this.isLive=!0,this.index=e,this.width=t,this.height=a,this.paneObject=r,this.offset=i,this.prevOffset=n,this.cellChanged.notify())}},{key:"getState",value:function(){return{item:this.paneObject&&this.paneObject.id,index:this.index,height:this.height,offset:this.offset,prevOffset:this.prevOffset,deadNeedsNotify:this.deadNeedsNotify,isLive:this.isLive}}}])&&p(t.prototype,a),i&&p(t,i),e}(),m=a(42),v=a(14);function y(e){return(y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==y(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S={None:0,OnScroll:1},I=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=b(this,k(t).call(this)))._pane=e.pane,a._isOverview=e.isOverview,a._itemsObs=e.itemsObs,a._getItemsList=e.itemsFn,a.getHeight=e.heightFn,a.getWidth=e.widthFn,a.minItemSize=e.minItemSize,a.hasSetHeightOnce=!1,a.scrollHandler=void 0,a._mobilePadBottom=!1,a.contentSize=new d.a(0),a.paddingBottom=new d.a(0),a._timeoutPointerEvents=void 0,a.disablePointerEvents=new d.a(!1),a._direction=r.a.Direction.None,a._scrollTop=0,a._lastProcessedScrollTop=0,a._itemInfoById={},a._savedScrollOfTop={},a._indexOfTop=0,a._inViewCount=0,a._reactList=void 0,a._isMounted=!1,a._panePadding=0,a.useCustomScroller=u.a.useCustomScroller,a.cellsObs=new c.a([]),a.cells=a.cellsObs.get(),a.cellsNew=[],a._tops=[],a.scrollListeners=[],a.offscreenScrollPadding=400,a._phase=S.None,a.init(),a}var a,s,l;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,m["a"]),a=t,(s=[{key:"_validateCells",value:function(){}},{key:"init",value:function(){n.a.binder(this,"_onListChanged","_onSettingChanged","_onResize","_onScroll","_handleScroll","handleItemTextChanged","handleItemNoteSet","_onTimeoutPointerEvents","_computeRenderItemsBatched","_onSetScrollComplete","_onSetScrollCompleteTimeout","_afterSetScrollComplete","reMount","onImageLoaded")}},{key:"getID",value:function(){return this._pane.id+(this._isOverview?"_o":"")}},{key:"notifyInit",value:function(e){this._pane.setIgnoreRestoreScroll(),i.default.Assert(!this._isMounted,"Should not initialize a pane twice"),this.clearCache(),this.allocateCells(),this._onListChanged(),this._isMounted=!0,this._reactList=e,this._listenToItemsList(this._onListChanged),this._pane.rect.listen(this._onResize),o.default.settings.ui.listen(this._onSettingChanged),this._isOverview||(this._pane.topBoxHeight.listen(this._onListChanged),v.a.listen("imageLoaded",this.onImageLoaded))}},{key:"notifyUnmounted",value:function(){n.a.destroy(this),this._isMounted=!1,this.isDelayingMounts=!1,this._unlistenToItemsList(this._onListChanged),this._pane.rect.unlisten(this._onResize),o.default.settings.ui.unlisten(this._onSettingChanged),this._isOverview||(this._pane.topBoxHeight.unlisten(this._onListChanged),v.a.unlisten("imageLoaded",this.onImageLoaded)),clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this.removeNativeScrollListener(this._onScroll),this._reactList=void 0,i.default.clearTimeoutOnce("afterScroll"+this.getID()),i.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),u.a.isMobile||this._isOverview||(this._pane=void 0)}},{key:"allocateCells",value:function(){var e=this.cells.length,t=Math.ceil((u.a.windowHeight()+2*this.offscreenScrollPadding)/this.minItemSize())+4;if(t>e){for(var a=0,i=this.cells,n=e;n<t;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=new g;i.push(r)}this.cellsObs.set(i),this.cells=this.cellsObs.get()}}},{key:"setupScroller",value:function(e,t){this.scrollElement=e,u.a.isMobile&&this.useCustomScroller&&this.setupCustomScroller(e,t),this.addNativeScrollListener(this._onScroll),u.a.isMobile&&this.useCustomScroller&&setTimeout(this.refreshScrollListener.bind(this))}},{key:"setupCustomScroller",value:function(e,t){}},{key:"clearItemInfoForItem",value:function(e){var t=this._pane.getPaneObjectsForItem(e),a=this._itemInfoById;if(t)for(var i=0,n=0;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];a[r.id]&&(a[r.id].needsUpdate=!0)}}},{key:"handleItemNoteSet",value:function(e){this.clearItemInfoForItem(e.item)}},{key:"handleItemTextChanged",value:function(e){i.default.Assert(!this._isOverview,"Overviews should never listen to text changes");var t=this._pane,a=!1;if(t&&t.isViewText())if(t.isItemInPane(e)){var n=this.indexOfItem(e);this.checkHeightChanged(e,n)&&(this.clearItemInfoForItem(e),a=!0)}else this.clearItemInfoForItem(e);return a}},{key:"getElementAtIndex",value:function(e){return this._reactList.getElementAtIndex(e)}},{key:"isIndexMounted",value:function(e){return this._reactList.isIndexMounted(e)}},{key:"hasItems",value:function(){return this._getItemsList().length>0}},{key:"numItems",value:function(){return this._getItemsList().length}},{key:"indexOfTop",value:function(){return this._indexOfTop}},{key:"inViewCount",value:function(){return this._inViewCount}},{key:"objectAtTop",value:function(){var e=this._getItemsList(),t=this.indexOfTop(),a=t>=0&&t<e.length;return i.default.Assert(a,"Item at top is not in range",t,e.length),e[t]}},{key:"itemAtTop",value:function(){var e=this.objectAtTop();return e&&(i.default.isVMLI(e)?e:e.item)}},{key:"indexPageUp",value:function(e){for(var t=0,a=this.size.height,i=0,n=e-1;n>=0;--n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if((i+=this._sizes[n])>a)return n+1}return 0}},{key:"indexPageDown",value:function(e){for(var t=0,a=this.size.height,i=0,n=this._sizes.length,r=e;r<n;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if((i+=this._sizes[r])>a)return r}return Math.max(n-1,0)}},{key:"_listenToItemsList",value:function(e){this._itemsObs.listen(e)}},{key:"_unlistenToItemsList",value:function(e){this._itemsObs.unlisten(e)}},{key:"objectAtIndex",value:function(e){var t=this._getItemsList();return i.default.Assert(e>=0&&e<t.length,"Invalid item index: "+e,t.length,this._pane.type),t[e]}},{key:"itemAtIndex",value:function(e){var t=this._getItemsList();i.default.Assert(e>=0&&e<t.length,"Invalid item index: "+e,t.length,this._pane.type);var a=t[e];return a&&(i.default.isVMLI(a)?a:a.item)}},{key:"sizeAtIndex",value:function(e){return this._pane.sizeAtIndex(e,this._isOverview)}},{key:"addPadding",value:function(){this.useCustomScroller?(this._panePadding=u.a.windowHeight()-2*i.default.topBarHeight,this.refreshScrollListener()):(this._mobilePadBottom=!0,this._computeContentSize(!0))}},{key:"removePadding",value:function(){this._mobilePadBottom=!1,this._computeContentSize(!0)}},{key:"addNativeScrollListener",value:function(e){u.a.addPassiveListener(this.scrollElement,"scroll",e)}},{key:"removeNativeScrollListener",value:function(e){this.scrollElement&&this.scrollElement.removeEventListener("scroll",e)}},{key:"addScrollListener",value:function(e){this.scrollListeners.push(e)}},{key:"removeScrollListener",value:function(e){i.default.Assert(this.hasScrollListener(e),"Removing a listener that does not exist"),this.scrollListeners.remove(e)}},{key:"hasScrollListener",value:function(e){return this.scrollListeners.indexOf(e)>=0}},{key:"refreshScrollListener",value:function(){}},{key:"getScrollOffset",value:function(){if(this._isMounted){if(this.scrollElement){var e=this._pane.orientation.get()===r.a.Orientation.Vertical?"scrollTop":"scrollLeft";return this.scrollElement[e]}return 0}return 0}},{key:"getScrollSize",value:function(){return Math.max(this.contentSize.get()+(u.a.isMobile||i.default.noPanePadding?0:200),0)}},{key:"getMaxScrollOffset",value:function(){var e=this._pane.orientation.get()===r.a.Orientation.Vertical?this.getHeight():this.getWidth();return Math.max(this.getScrollSize()-e,0)}},{key:"setScrollOffset",value:function(e,t,a){var n=this;if(i.default.Assert(this.scrollElement,"Pane must have loaded a scrollable element"),i.default.Assert(i.default.isNumber(e),"Must supply a valid scroll offset"),this.scrollElement&&this._pane){if(this._pane.isFakePane)return;t=t||r.a.ScrollDuration.Snap;var o=this.getScrollOffset(),s=this.getMaxScrollOffset();if(u.a.isMobile&&(s+=u.a.getKBSize()+r.a.KeyboardToolbarHeight),e<0?e=0:e>s&&(e=s),e=Math.floor(e),this._isMounted&&this._scrollingTo!==e){this._scrollingTo=t?e:void 0,this._isSettingScroll=!0;var l,d,c=this._pane.orientation.get()===r.a.Orientation.Vertical;l=c?void 0:e,d=c?e:void 0,i.default.scrollTo(l,d,t,this.scrollElement,function(){n._onSetScrollComplete(),a&&a()})}else i.default.timeoutOnce("setScrollComplete_"+this.getID(),this._onSetScrollComplete,0),a&&a();return e-o}}},{key:"_onSetScrollComplete",value:function(){this._restoringScroll?this._afterSetScrollComplete():i.default.timeoutOnce("scrollCompleteTimeout_"+this.getID(),this._onSetScrollCompleteTimeout,60)}},{key:"_onSetScrollCompleteTimeout",value:function(){this._isMounted&&this.saveScrollOfTop(!0,!0),this._afterSetScrollComplete()}},{key:"_afterSetScrollComplete",value:function(){this._scrollingTo=void 0,this._isSettingScroll=!1}},{key:"_computeContentSize",value:function(e){var t=0,a=this.getPaddingTop(),n=a,r=this._getItemsList(),o=this._pane.getItem().levelsDeep.get();this._sizes=[],this._tops=[];for(var s=0;s<r.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l,d=r[s],c=r[s].item||d,h=i.default.isVMLI(c),f=this._itemInfoById[d.id],p=h?c.levelsDeep.get()-o:void 0;f&&!f.needsUpdate&&f.levelsDeep===p&&void 0===d.sizePad?l=f.size:(l=this.sizeAtIndex(s),f=this._itemInfoById[d.id]={size:l,levelsDeep:p,paneObject:d,needsUpdate:!1}),this._sizes[s]=l,this._tops[s]=s>0?this._tops[s-1]+this._sizes[s-1]:a,f.previousTop=f.top,f.top=this._tops[s],n+=f.size}if(u.a.isMobile){var g=2*this.minItemSize();this._mobilePadBottom&&(g+=u.a.getKBSize()),this.paddingBottom.set(g)}return this.contentSize.set(n,e),this.useCustomScroller&&this.refreshScrollListener(),n}},{key:"flushTimeoutPointerEvents",value:function(){this._timeoutPointerEvents&&(clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this._onTimeoutPointerEvents())}},{key:"_onTimeoutPointerEvents",value:function(){this._pane.isDestroyed()||(this.disablePointerEvents.set(!1),this.killAllDeadCells(),this._isSettingScroll||this._wasSettingScroll||this.saveScrollOfTop(),this._scrollingTo=void 0,this._wasSettingScroll=!1)}},{key:"reMount",value:function(){this.isDelayingMounts=!1,this.fireEvent("reMount",[])}},{key:"_onScroll",value:function(e){var t=0;if(!e||!i.default.findParent(e.target,"preventScrollPropagate")){this._restoringScroll&&!this._isSettingScroll||(this._prevScrollTop=this._scrollTop,this._scrollTop=this.getScrollOffset(),this._handleScroll());for(var a=0;a<this.scrollListeners.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.scrollListeners[a](e)}}}},{key:"_handleScroll",value:function(){if(this._phase=S.OnScroll,u.a.isMobile&&u.a.useCustomScroller||h.a.isMouseDown()||(this._prevScrollTop!==this._scrollTop&&this.disablePointerEvents.set(!0),this._timeoutPointerEvents&&clearTimeout(this._timeoutPointerEvents),this._wasSettingScroll=this._isSettingScroll,this._timeoutPointerEvents=setTimeout(this._onTimeoutPointerEvents,50),0===this._scrollTop&&0!==this._prevScrollTop&&this.saveScrollOfTop()),h.a.isMouseDown()||(this.isDelayingMounts=!0,i.default.timeoutOnce("afterScroll"+this.getID(),this.reMount,150)),u.a.isMobile||i.default.tooltip.hideTip(),h.a.hoveredItem&&h.a.setHovered(this,null,null),this._scrollTop!==this._prevScrollTop){this._direction=this._scrollTop>this._prevScrollTop?r.a.Direction.Down:r.a.Direction.Up;var e=Math.abs(this._scrollTop-this._lastProcessedScrollTop);if(this.alwaysRenderScroll||e>=this.offscreenScrollPadding/2)this._lastProcessedScrollTop=this._scrollTop,this._computeRenderItems();else this.updateTopIndex()}this.scrollHandler&&this.scrollHandler(this._scrollTop),this._phase=S.None}},{key:"_updateSize",value:function(){this.size={width:this._pane.getWidth(),height:this._pane.getHeight()}}},{key:"_onListChanged",value:function(){if(this._needsResize)return this._needsResize=!1,void this._onResize(void 0,void 0,!0);this.rect=this._pane.rect.get(),this._updateSize(),this.killAllDeadCells(),this._computeContentSize(!1),this._computeRenderItems(this._isMounted)}},{key:"_onSettingChanged",value:function(){this._needsResize=!0,i.default.timeoutOnce("listSettingChanged_"+this.getID(),this._onResize,0,void 0,void 0,!0)}},{key:"_onResize",value:function(e,t,a){if(!o.default.PaneManager.isResizingPane){i.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._needsResize=!1;var n=this.rect?this.rect.width:-1,s=this.rect?this.rect.height:-1;a||e&&(e.width!==n||e.height!==s)?(this.saveScrollOfTop(),this._updateSize(),this.clearCache(),this.allocateCells(),i.default.setItemAnimationMode(r.a.ItemAnimationMode.None),this._onListChanged(),i.default.resetItemAnimationMode(),h.a.getPane()===this._pane&&h.a.updateCaret()):this._updateSize()}}},{key:"saveScrollOfTop",value:function(e,t){this._savedScrollOfTop;if(this.numItems()>0&&(t||!this._pane.isIgnoringRestoreScroll())){for(var a,i,n=0,r=[],o=this.numItems(),s=e?this.getScrollOffset():this._scrollTop,l=this._indexOfTop;l<Math.min(this._indexOfTop+this._inViewCount-1,o);l++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a=this.objectAtIndex(l),(i=s-this.topOfIndex(l))-this._sizes[l]<-this.getPaddingTop()&&r.push({index:l,paneObject:a,scrollOffset:i})}this._savedScrollOfTop.inView=r}}},{key:"restoreScrollOfTop",value:function(){var e=this._savedScrollOfTop;if(!this._pane.isIgnoringRestoreScroll()&&this._pane._didInitialScroll){if(e&&!i.default.isEmpty(e)){var t=e.inView;if(t)for(var a=0,n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t[n];if(this.restoreScroll(o))break}this._restoringScroll||this._pane.scrollToTop(r.a.ScrollDuration.Snap)}this._restoringScroll=!1}}},{key:"restoreScroll",value:function(e){var t=this.indexOfItem(e.paneObject);if(t>=0){var a=Math.max(this.topOfIndex(t)+(e.scrollOffset||0),0),n=this.getMaxScrollOffset();return a>n&&(a=n),this._restoringScroll=!0,this._scrollTop=a,this.setScrollOffset(a,r.a.ScrollDuration.Snap),i.default.animFrameOnce("restoreScroll_"+this.getID(),function(){this.setScrollOffset(a,r.a.ScrollDuration.Snap)}.bind(this)),!0}return!1}},{key:"clearCache",value:function(){var e=0;this._itemInfoById={};for(var t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&(a.width=a.height=void 0)}}},{key:"_isInBounds",value:function(e,t){var a=!1;return e>this._getPVRBottom()+this.offscreenScrollPadding||t<this._getPVRTop()-this.offscreenScrollPadding||(a=!0),a}},{key:"getScrollTop",value:function(){return this._scrollTop}},{key:"_getPVRTop",value:function(){return this._scrollTop}},{key:"_getPVRBottom",value:function(){return this._scrollTop+(this._pane.orientation.get()===r.a.Orientation.Vertical?this.size.height:this.size.width)}},{key:"killAllDeadCells",value:function(){for(var e=0,t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];!a.isLive&&a.deadNeedsNotify&&a.kill(!0)}}},{key:"_startCellPassOnCell",value:function(e){e.seenInPass=!1}},{key:"startCellPass",value:function(){var e=0;this.cellsCurrent={};for(var t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&(this.cellsCurrent[a.paneObject.id]=a,this._startCellPassOnCell(a))}}},{key:"_pruneCellPassOnCell",value:function(e,t){if(!e.seenInPass||t){var a,i=e.index;(this._phase!==S.OnScroll||this._isInBounds(this._tops[i],this._tops[i]+this._sizes[i]))&&(a=!0),e.kill(a)}}},{key:"pruneCellPass",value:function(){for(var e=0,t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&this._pruneCellPassOnCell(a)}}},{key:"updateCell",value:function(e){var t=this._pane,a=this._getItemsList()[e],i=a.id,n=this.cellsCurrent[i],o=this._isOverview||this._pane.orientation.get()===r.a.Orientation.Vertical,s=this._sizes[e],l=o?t.getContentWidth():s,u=o?s:t.getContentHeight(),d=this._tops[e],c=this._itemInfoById[i],h=c&&c.previousTop;n&&!n.seenInPass?n.update(e,l,u,d,h,a):!n&&this.cellsNew.indexOfWithProperty("index",e)<0&&this.cellsNew.push({index:e,width:l,height:u,offset:d,paneObject:a,prevOffset:h})}},{key:"_addPassOnCell",value:function(e){for(var t,a=0,n=0;n<this.cells.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!this.cells[n].isLive){t=this.cells[n];break}}i.default.Assert(t,"Must always have additional cells to use",u.a.windowHeight()),t||(t=new g,this.cells.push(t)),t.update(e.index,e.width,e.height,e.offset,e.prevOffset,e.paneObject)}},{key:"addCellPass",value:function(){for(var e=0,t=0;t<this.cellsNew.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cellsNew[t];this._addPassOnCell(a)}this.cellsNew=[]}},{key:"_isIndexSeen",value:function(e){var t=this._getItemsList()[e].id,a=this.cellsCurrent[t];return a&&a.seenInPass}},{key:"_computeRenderItems",value:function(e){i.default.batchRenderUpdates(this._computeRenderItemsBatched,e)}},{key:"_computeRenderItemsBatched",value:function(e){var t,a,n,r,s=0,l=this._getItemsList(),d=0;this.startCellPass(),e&&this.restoreScrollOfTop();for(var c=0;c<l.length;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(t=this._tops[c],a=this._sizes[c],this._isInBounds(t,t+a))isNaN(n)&&t+a>this._getPVRTop()&&(n=c),this.updateCell(c),!isNaN(n)&&Math.round(t)<this._getPVRBottom()-2&&d++;else if(t>this._getPVRBottom())break}isNaN(n)&&(n=0),this._indexOfTop=n,this._inViewCount=d,h.a.isValid()&&(!u.a.isMobile||u.a.isMobile&&i.default.isKeyboardOpen)&&this._pane===h.a.getPane()&&(r=h.a.getStartIndex())<this._sizes.length&&!this._isIndexSeen(r)&&this.updateCell(r),u.a.isMobile&&o.default.DragDrop.isDragging&&(r=this._pane.indexOfItem(o.default.DragDrop.dragItem))>=0&&!this._isIndexSeen(r)&&this.updateCell(r),this.pruneCellPass(),this.addCellPass(),this._isSettingScroll||this._phase===S.OnScroll||this.saveScrollOfTop()}},{key:"updateTopIndex",value:function(){for(var e,t,a=0,i=this._getItemsList(),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e=this._tops[n],t=this._sizes[n],this._isInBounds(e,e+t)&&e+t>this._getPVRTop()){this._indexOfTop=n;break}}}},{key:"getItemInfo",value:function(e){return this._itemInfoById[e]}},{key:"getItemInfosForItem",value:function(e){var t=this._itemInfoById,a=[];if(t[e.id])a.push(t[e.id]);else for(var i in this._itemInfoById)t.hasOwnProperty(i)&&t[i].paneObject.item===e&&a.push(t[i]);return a}},{key:"indexOfItem",value:function(e,t,a){for(var n,r=0,o=i.default.isVMLI(e),s=this._getItemsList(),l=0;l<s.length;l++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=s[l];if(o){if((u===e||u.item===e)&&(!u.type||"blockItem"===u.type)&&(!t||!u.block||u.block.id===t.id))return l}else{if(u.id===e.id)return l;u.item&&u.item===e.item&&(n||(n=[]),n.push({index:l,item:u}))}}if(n){if(a){var d,c,h=0;for(l=0;l<n.length;l++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var f=Math.abs(n[l].index-a);(isNaN(c)||f<d)&&(c=l,d=f)}return n[c].index}return n[0].index}return-1}},{key:"topOfItem",value:function(e){i.default.Assert(e,"Must provide a valid item to measure");var t=this.indexOfItem(e);return i.default.Assert(t>=0,"Must supply a valid item that is in this pane"),this.topOfIndex(t)}},{key:"topOfIndex",value:function(e){return i.default.Assert(e>=0,"Must supply a valid index"),this._tops[e]}},{key:"scrollIndexToTop",value:function(e,t,a){var i=this.topOfIndex(e),n=this.getScrollOffset();if(i<n||i-n>200)return this.setScrollOffset(i-16,t,a);a&&a()}},{key:"scrollItemToTop",value:function(e,t,a){i.default.Assert(i.default.isVMLI(e),"Must be a valid VMLI instance"),i.default.Assert(i.default.isNumber(t),"Must have a valid scroll duration");var n=this.indexOfItem(e);return i.default.Assert(n>=0,"Must supply a valid item that is in this pane"),this.scrollIndexToTop(n,t,a)}},{key:"scrollIndexToMiddle",value:function(e,t,a){if(this._isMounted){var i=this.topOfIndex(e),n=this._sizes[e],r=Math.floor(i+n/2-this.getHeight()/2);return this.setScrollOffset(r,t,a)}a&&a()}},{key:"scrollItemToMiddle",value:function(e,t,a){if(this._isMounted){var i=this.indexOfItem(e);if(i>=0)return this.scrollIndexToMiddle(i,t,a)}else a&&a()}},{key:"scrollItemIntoView",value:function(e,t,a){if(this._isMounted){var i=this.indexOfItem(e);return this.scrollIndexIntoView(i,t,a)}a&&a()}},{key:"scrollIndexIntoView",value:function(e,t,a){t=isNaN(t)?r.a.ScrollDuration.Default:t,i.default.Assert(i.default.isNumber(e),"Must supply a valid index"),i.default.Assert(!a||i.default.isFunction(a),"Must supply a valid callback function");var n=this.itemAtIndex(e);if(i.default.Assert(n,"Item does not exist to scroll to",e,this.numItems()),this._isMounted&&n){var s,l,d,c=u.a.getKBSize(),h=this.topOfIndex(e),f=this.getHeight();u.a.isMobile?s=f-c-r.a.KeyboardToolbarHeight:(s=f,o.default.PaneManager.hasScrollbar()&&(s-=r.a.HorizScrollbarHeight)),d=u.a.isMobile?(l=this.getScrollOffset())+s:(l=this.getScrollOffset())+f;var p=this._sizes[e],g=h+p,m=g>d,v=h<l;v&&p>s&&g>=d&&(v=!1);var y,_=0;return v?y=0===h?0:h:m&&(y=g-s),v||m?(_=y-l,this.setScrollOffset(y,t,function(){a&&setTimeout(a,0)})):a&&a(),_}return!1}},{key:"getPaddingTop",value:function(){return this._isOverview?u.a.isMobile?8:0:this._pane.topBoxHeight.get()+(u.a.isMobile?i.default.topBarHeight:0)}},{key:"notifyDragStart",value:function(){}},{key:"notifyDragEnd",value:function(){}},{key:"notifySwappedIn",value:function(e){isNaN(e)||this.setScrollOffset(e)}},{key:"addScrollDelta",value:function(e){return i.default.Assert(this.scrollElement,"Pane must have loaded a scrollable element"),this.setScrollOffset(this.getScrollOffset()+e)}},{key:"setScrollHandler",value:function(e){this.scrollHandler=e}},{key:"setInitialScrollOffset",value:function(e){this._scrollTop=e||0}},{key:"checkHeightChanged",value:function(e,t){if(u.a.isMobile)return this.clearItemInfoForItem(e),!0;var a=this._pane,i=this.objectAtIndex(t),n=e.sizeInPane(a,t,!1)+(i.sizePad||0),r=this.getItemInfosForItem(e);return r.length>0&&n!==r[0].size?(this.clearItemInfoForItem(e),!0):void 0}},{key:"onImageLoaded",value:function(e){if(this._pane.isItemInPane(e)){var t=this.indexOfItem(e);(t<0||this.checkHeightChanged(e,t))&&(this._pane.setIgnoreRestoreScroll(),this.clearItemInfoForItem(e),this._pane.setItemsDirty(),o.default.PaneUpdateBatcher.updateAllItems())}}}])&&_(a.prototype,s),l&&_(a,l),t}();function D(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}if(u.a.isMobile)var C=a(30).default;var P=function(){function e(t,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pane=t,this.root=t.getRootItem(),this.contentElement=void 0,this._scrollListenerAttached=!1,this.isVisible=new d.a(a),this.isShowingContents=new d.a(i);var n=u.a.isMobile?0:-1;this.transform=new d.a(n),this.cursor=new d.a,this.topItem=void 0,this.dragHoverItem=void 0,this.onTap={onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd},this._infiniteList=new I({pane:t,isOverview:!0,itemsObs:t.headers,itemsFn:t.getHeaders,widthFn:t.getWidth,heightFn:t.getHeight,minItemSize:this.getMinItemSize}),this.init()}var t,a,s;return t=e,(a=[{key:"init",value:function(){u.a.isMobile?n.a.forceBind("refreshScrollListener",this):(n.a.forceBind("onPaneScroll",this),n.a.forceBind("onPaneItemsUpdated",this),v.a.listen("itemsUpdated",this.onPaneItemsUpdated))}},{key:"destroy",value:function(){this.pane=void 0,u.a.isMobile||v.a.unlisten("itemsUpdated",this.onPaneItemsUpdated),n.a.destroy(this)}},{key:"onPaneLoad",value:function(){!u.a.isMobile&&this.pane.overviewCanTrackScroll&&this.isVisible.get()&&this._attachScrollListener()}},{key:"getInfiniteList",value:function(){return this._infiniteList}},{key:"getContentElement",value:function(){return this.contentElement}},{key:"getScrollOffset",value:function(){this._infiniteList.getScrollOffset()}},{key:"refreshScrollListener",value:function(){this._infiniteList.refreshScrollListener()}},{key:"onTapStart",value:function(e){if(u.a.isMobile&&u.a.useCustomScroller&&e.preventDefault(),!i.default.hasClass(e.target,"overviewList")&&i.default.findParent(e.target,"overviewList")){var t=i.default.getItemForElement(e.target);t&&(o.default.DragDrop.startDragItem=t)}}},{key:"onTapMove",value:function(e){if(!u.a.isMobile){var t=o.default.DragDrop.startDragItem||o.default.DragDrop.dragItem;t&&t.checkDragOnMove(e,!0)}}},{key:"onTapClick",value:function(e){var t,a=this.pane,n=i.default.getItemForElement(e.target),r=i.default.getElementParent(e.target);(r&&n!==a&&n!==this&&i.default.findParent(e.target,"overviewList")&&(t=i.default.getPaneObjectForElement(e.target),n=i.default.getItemForElement(e.target),i.default.Assert(n,"Element in overview was text but was not an item")),n)&&(i.default.Assert(r,"Item must have an overview element: "+(n.getRawText?n.getRawText():"not an item")),r&&(e.clientX-i.default.offset(r).left<a.getPaddingForPaneObject(n,!0)?a.setPaneObjectCollapsed(!a.isPaneObjectCollapsed(t,!0),t,!0):i.default.hasClass(e.target,"overviewOptions")?(o.default.menus.openContextMenu({componentName:"ReactContextMenuOverviewOptions",key:"menu"+n.id+e.clientX+e.clientY,element:e.target,item:n,pane:a,pos:{left:e.pageX,top:e.pageY}}),i.default.preventAndStop(e)):this.pane.allowZoom(n)?(this.pane.zoomIn(n),u.a.isMobile&&C.setOverviewVisibility(this.pane,!1),i.default.sendEvent("Menu","OverviewZoom")):this.pane.performOverviewAction(n)));i.default.preventDefault(e)}},{key:"onTapEnd",value:function(e){if(!u.a.isMobile){var t=o.default.DragDrop.startDragItem||o.default.DragDrop.dragItem;t&&t.checkDragOnEnd(e)}}},{key:"scrollItemIntoView",value:function(e){var t=0;this._disablePaneScrollListener=!0;for(var a=e;a&&a!==this.pane.getItem();){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.pane.indexOfItem(a)>=0){this.pane.scrollItemToTop(a,r.a.ScrollDuration.Default);break}a=a.parent()}this.updateTopPaneItem(e),setTimeout(function(){this._disablePaneScrollListener=!1}.bind(this),2*r.a.ScrollDuration.Default)}},{key:"setVisibility",value:function(e){e&&(h.a.reset(),this._infiniteList.setInitialScrollOffset(0)),e!==this.isVisible.get()&&(this.isVisible.set(e),v.a.fireEvent("panesChanged",[]),u.a.isMobile||(o.default.PaneManager.updatePaneStateForPane(this),this.pane.overviewCanTrackScroll&&(e?this._attachScrollListener():this._detachScrollListener()))),u.a.isMobile&&(e&&i.default.isKeyboardOpen&&!i.default.getActiveSearch().isFocused.get()&&i.default.blurActiveElement(),l.e.miscAction({type:l.c.Misc,misc:l.a.ToggleOverview,data:{value:e,pane:this.pane}}),this.pane.onOverviewToggled(e))}},{key:"setShowingContents",value:function(e){this.isShowingContents.set(e),o.default.PaneManager.updatePaneStateForPane(this)}},{key:"_attachScrollListener",value:function(){i.default.Assert(!this._scrollListenerAttached,"Must not double attach scroll listener"),this._scrollListenerAttached||(this.pane.addScrollListener(this.onPaneScroll),this.onPaneScroll(),this._scrollListenerAttached=!0)}},{key:"_detachScrollListener",value:function(){i.default.Assert(this._scrollListenerAttached,"Must only detach overview listener when already attached"),this._scrollListenerAttached&&(this.pane.removeScrollListener(this.onPaneScroll),this._scrollListenerAttached=!1)}},{key:"toggleDesktop",value:function(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),l.e.miscAction({type:l.c.Misc,misc:l.a.ToggleOverview,data:{value:this.isVisible.get(),pane:this.pane}})}},{key:"onPaneScroll",value:function(){if(!this._disablePaneScrollListener){i.default.Assert(this.isVisible.get(),"Should not be tracking scroll if overview is not open");var e=this.findTopPaneItem();e&&(this.updateTopPaneItem(e),this._infiniteList.scrollItemToMiddle(e,r.a.ScrollDuration.Default))}}},{key:"findTopPaneItem",value:function(){var e=this.pane;if(this.pane.numItems()>0){for(var t,a,i=0,n=this.pane.indexOfTop();n>=0&&n<e.numItems()&&!a;){var r=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(t=this.pane.itemAtIndex(n);t&&t!==this.root&&!a;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._infiniteList.indexOfItem(t)<0?t=t.parent():a=t}a||n++}return!a&&this._infiniteList.numItems()>0&&(a=this._infiniteList.itemAtIndex(0)),a}}},{key:"updateTopPaneItem",value:function(e){var t=this.topItem;this.topItem=e,t&&t.itemChanged.notify(),e.itemChanged.notify()}},{key:"updateDragHoverItem",value:function(e){var t=this.dragHoverItem;this.dragHoverItem=e,t&&t.itemChanged.notify(),e&&e.itemChanged.notify()}},{key:"onPaneItemsUpdated",value:function(e){if(e===this.pane&&this.isVisible.get()&&this.pane.overviewTracksScroll){var t=this.findTopPaneItem();t&&this.updateTopPaneItem(t)}}},{key:"isItemAtTop",value:function(e){return e===this.topItem}},{key:"isItemDragHovered",value:function(e){return e===this.dragHoverItem}},{key:"getMinItemSize",value:function(){return o.default.DisplaySettings.itemLineHeight()+2*o.default.DisplaySettings.itemPadding()}}])&&D(t.prototype,a),s&&D(t,s),e}(),A=a(36),M=a(30),T=a(34);function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],i=!0,n=!1,r=void 0;try{for(var o,s=0,l=e[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(a.push(o.value),t&&a.length===t)break}}catch(u){n=!0,r=u}finally{try{i||null==l.return||l.return()}finally{if(n)throw r}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function L(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var x=r.a.MatchState,O=function(){function e(t,a,r){var o=0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.callback=r,this.pane=t,this.searchArr=[],this.matches={},this.previousSearch="",this._stickyMatches={},this._stickyMatchesAwaitingClear=[],this.itemStoreFilter=void 0,this._needsBatchedSearch=!1,this.UI=void 0,this.isFocused=new d.a,this._destroyed=!1,n.a.binder(this,"isMatched","checkChildrenParams","hideNonMatches","handleItemTextChanged","update");var s={priority:{name:"priority",matchFn:this._matchFnPriority.bind(this)},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFn:this._matchFnStarred.bind(this)},project:{name:"project",initialValue:1,icon:"icon-project",tooltip:"projects",matchFn:this._matchFnProject.bind(this)},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFn:this._matchFnTask.bind(this)},complete:{name:"complete",text:"Completed Items",initialValue:-1,defaultValue:-1,icon:"icon-check",tooltip:"completed items",matchFn:this._matchFnComplete.bind(this)},showOnlyMatches:{name:"showOnlyMatches",initialValue:1,icon:"icon-reorder",tooltip:"Flat mode: Show only matching items",canBeNegated:!1,isOption:!0},showOnlyAgendaDates:{name:"showOnlyAgendaDates",initialValue:1,icon:"icon-at",tooltip:"Show only dates on the Agenda",canBeNegated:!1,isOption:!0},showOnlyMatchingTags:{name:"showOnlyMatchingTags",initialValue:1,icon:"icon-short_text",tooltip:"Show only matching tag blocks",canBeNegated:!1,isOption:!0},showChildProjects:{name:"showChildProjects",initialValue:1,icon:"icon-project_half",tooltip:"Show all projects from anywhere in the hierarchy",canBeNegated:!1,isOption:!0}};if(a){!1===a.showHierarchy&&(a.showOnlyMatches=1);var l=a.completeOption;!isNaN(l)&&isNaN(a.complete)&&(a.complete=l<0?1:l-1),0===a.showOnlyTopLevelProjects&&(a.showChildProjects=1)}for(var u=[],c=0;c<t.searchFilters.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var h=t.searchFilters[c];i.default.isString(h)?u.push(s[h]):u.push(h)}if(this.setupFilters(u,a),this.value=a&&a.text||"",this.onChanged=new f.a(r),this._updateSearchArr(),this.value){var p=A.a.parseText(this.value,T.a.getContacts(),!0,!0,!0);p&&this.onParsed(p)}}var t,a,c;return t=e,(a=[{key:"destroy",value:function(){this._destroyed=!0,this.onChanged.unlisten(this.callback),this.pane=void 0,this.UI=void 0,n.a.destroy(this)}},{key:"setFilterTooltip",value:function(e,t){this.getFilter(e).tooltip=t}},{key:"getFilterTooltip",value:function(e){var t=e.value.get();return t?e.isOption?"<b>Click</b> to clear this option":(t>0?"Showing only":"Hiding")+" "+e.tooltip+".\n<b>Click</b> to clear this "+(e.isOption?"option":"filter."):e.isOption?e.tooltip:"<b>Click</b> to "+(e.initialValue>0?"show only ":"hide ")+e.tooltip+(t!==-e.initialValue?".\n<b>"+u.a.priModKey+" + click</b> to "+(e.initialValue<0?"show only ":"hide ")+e.tooltip+".":"")}},{key:"setupFilters",value:function(e,t){for(var a=0,n=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e[r],s=o.name,l=t?t[s]:void 0;o.value=new d.a(isNaN(l)?o.defaultValue||0:l),o.enabled=new d.a(void 0===o.enabled||o.enabled),i.default.Assert(!this.hasOwnProperty("filter_"+s),"Should not double define filter properties"),this["filter_"+s]=o,n.push(o)}this.filters=n}},{key:"setFilterEnabled",value:function(e,t){var a=this.filters.indexOfWithProperty("name",e);a>=0&&this.filters[a].enabled.set(t)}},{key:"getValue",value:function(){return this.value}},{key:"isFiltered",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.filters[t].value.get())return!0}return!1}},{key:"getRemoteValue",value:function(){for(var e=0,t=this.value,a=0;a<this.filters.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this.filters[a];if(i.remoteStringFn&&i.enabled.get()){var n=i.remoteStringFn(i.value.get());n&&(t+=" "+n)}}return t.trim()}},{key:"getState",value:function(){for(var e=0,t={text:this.getValue(),showHierarchy:this.showHierarchy()},a=0;a<this.filters.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this.filters[a];t[i.name]=i.value.get()}return t}},{key:"focus",value:function(){this.UI.focus()}},{key:"blur",value:function(){this.UI.blur()}},{key:"onParsed",value:function(e){this.tags=e.tags,this.contacts=e.contacts}},{key:"setValue",value:function(e){this.updatingValue=this.value!==e,this.updatingValue&&this.pane.clearPerPaneStateSearch(),this.value=e,this._updateSearchArr(),this.pane.getItemStore().numItems>5e3?this._needsBatchedSearch||(setTimeout(this.update,150,!0),this._needsBatchedSearch=!0):this.update(!0),e&&l.e.miscAction({type:l.c.Misc,misc:l.a.SearchChanged,data:this.getState()}),this.updatingValue=!1}},{key:"addToValue",value:function(e){var t=this.getSelectionOffset(),a=this.value;"-"!==a[a.length-1]&&"!"!==a[a.length-1]&&(e=" "+e),a+=e,this.setValue(a),this.setSelectionOffset(t+e.length)}},{key:"toggleText",value:function(e,t){var a=this.value.trim(),n="\\B(-*)("+i.default.escapeRegExp(e.toLowerCase())+")\\b",r=a.toLowerCase().match(n);r?(!r[1]&&t||r[1],a=(a.substr(0,r.index)+a.substr(r.index+r[0].length)).replace(/  +/g," ")):a+=" "+(t?"-":"")+e;a=a.trim(),this.setValue(a),u.a.isMobile&&!i.default.isKeyboardOpen||this.setSelectionOffset(a.length)}},{key:"getSelectionOffset",value:function(){return this.UI.getSelectionOffset()}},{key:"setSelectionOffset",value:function(e){this.UI.setSelectionOffset(e)}},{key:"getSearchBox",value:function(){return this.UI.refs.searchBox}},{key:"isSearched",value:function(){var e=0;if(this.value.length>0)return!0;for(var t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.filters[t];if(a.enabled.get()&&a.value.get())return!0}}},{key:"reset",value:function(){this.setValue("")}},{key:"resetFilters",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.filters[t].value.set(0)}this.update(!0,!0)}},{key:"numUnmatchedItems",value:function(){var e=this,t=0,a={item:this.pane.getItem(),each:function(a){var i=a.id,n=e.matches[i];n!==x.No&&n!==x.Negated||t++}};return o.default.searchVMLIs(a),t}},{key:"isFlatSearchResult",value:function(e){return!this.showHierarchy()&&this.matches[e.id]===x.Yes}},{key:"isMatchStateMatch",value:function(e){return void 0===e||e===x.Yes||e===x.ChildYes||e===x.Unknown}},{key:"isMatched",value:function(e,t){if(this.pane.supportLocalSearch){var a=this.matches[e.id];return t||void 0!==a||!e.hasText()||this.pane.isSettingText||this.pane===i.default.focusedPane||(a=this.checkItem(e)),this.isMatchStateMatch(a)}return x.Yes}},{key:"handleItemChanged",value:function(e){if(o.default.PaneManager.isPaneActive(this.pane.id)){var t=this.isMatched(e,!0);this.checkItem(e);var a=this.isMatched(e);if(!a&&t&&(this.isMatchStuck(e)||this.stickMatchAfterSearch(e,!0)),a!=t)return!0}}},{key:"handleItemTextChanged",value:function(e){if(this.getValue()||this.isFiltered())return this.handleItemChanged(e)}},{key:"_updateSearchArr",value:function(){var e=0,t=this.value.toLowerCase().trim().split(/\s+/);this.searchArr=[],this.searchWords=[];for(var a=0,i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t[i].startsWith("-"),r=n?t[i].substr(1):t[i];r&&"and"!==r&&"-"!==r&&"$"!==r&&(i>0&&("or"===r||"|"===r||"||"===r)?a++:(this.searchArr[a]||(this.searchArr[a]=[]),this.searchArr[a].push({text:r,isNegated:n}),n||this.searchWords.push(r)))}}},{key:"toggleFilterDefault",value:function(e){var t=this["filter_"+e],a=t.value.get();a=a?0:t.initialValue,this.setFilter(e,a)}},{key:"toggleFilter",value:function(e,t){var a=t?-1:1,i=this["filter_"+e].value.get();i=i===a?0:a,this.setFilter(e,i)}},{key:"getFilter",value:function(e){return this["filter_"+e]}},{key:"getFilterObs",value:function(e){var t=this["filter_"+e];return t?t.value:void 0}},{key:"getFilterValue",value:function(e){var t=this["filter_"+e];return t?t.value.get():void 0}},{key:"setFilter",value:function(e,t,a){"showOnlyMatches"===e&&this.clearListCache(),this["filter_"+e].value.set(t,a),this.update(!0,!0),l.e.miscAction({type:l.c.Misc,misc:l.a.SearchChanged,data:this.getState()})}},{key:"update",value:function(e,t,a){var n=this;this._needsBatchedSearch&&(this._needsBatchedSearch=!1),this.isRunningSearch=!0,o.default.PaneUpdateBatcher.beginUpdateItems(),(e||t)&&this.clearStickyMatches(),this.pane.supportLocalSearch&&(this.prevMatches=this.matches,this.matches={},this.isAnimatingSearch=a&&!e&&i.default.focusedPane===this.pane,this.checkChildren(),this.prevMatches={}),this.isUpdatingSearch=!0,this.pane.isLoaded&&e&&this.onChanged.notify(t),o.default.PaneUpdateBatcher.commitUpdateItems(),setTimeout(function(){n.isUpdatingSearch=!1},0),this.isRunningSearch=!1}},{key:"clearStickyMatches",value:function(){this._stickyMatchesAwaitingClear=[],this._stickyMatches={},clearTimeout(this._timeoutHideNonMatches)}},{key:"_checkMatch",value:function(e,t,a){var n=!0;return a===r.a.SearchDates.Overdue||a.startsWith(r.a.SearchDates.Before)||a.startsWith(r.a.SearchDates.After)||a.startsWith(r.a.SearchDates.Date)?n=this._matchDate(e,a):a.length>0&&n&&(n=!1,i.default.isPrefixTask(a)?n=e.isPrefixTask():a!==r.a.Prefix.Bullet&&a!==r.a.Prefix.Bullet2&&a!==r.a.Prefix.Bullet3||(n=e.isPrefixBullet()),n=n||t.indexOf(a)>=0),n}},{key:"_isMatchStateOk",value:function(e){return e===x.Yes||e===x.Unknown||e===x.ChildYes}},{key:"_matchFilter",value:function(e,t){if(e)return t?e>0?x.Unknown:x.Negated:e>0?x.No:x.Unknown}},{key:"_matchFilters",value:function(e){for(var t=0,a=x.Unknown,i=0;i<this.filters.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.filters[i];if(n.matchFn){var r=n.matchFn(n.value.get(),e);r===x.Unknown||r!==x.Negated&&!this._isMatchStateOk(a)||(a=r)}}return a===x.Yes&&(a=x.Unknown),a}},{key:"_matchFnComplete",value:function(e,t){return 1===e?t.isComplete()?x.Unknown:x.No:-1===e&&t.isComplete()?x.Negated:x.Unknown}},{key:"_matchFnStarred",value:function(e,t){return this._matchFilter(e,t.isStarred())}},{key:"_matchFnProject",value:function(e,t){return this._matchFilter(e,t.isPrefixHeader())}},{key:"_matchFnTask",value:function(e,t){return this._matchFilter(e,t.isPrefixTask())}},{key:"_matchFnPriority",value:function(e,t){var a=t.priority();return e>0?a>=e?x.Yes:x.No:x.Unknown}},{key:"_matchFnEmail",value:function(e,t,a){var n=t.getAttachments(),r=n&&n[0],o=r&&r.getPlugin()===i.default.vmMain.getDefaultEmailPlugin();return this._matchFilter(e,o)}},{key:"_matchDate",value:function(e,t){var a=e.getNextDate();if(a){var i=E(t.split(":"),2),n=i[0],r=i[1];if("date"===n&&"overdue"===r)return a<new Date;var o=Date.parse(r);return"before"===n&&a<o||"date"===n&&a.clearTime().equals(o.clearTime())||"after"===n&&a>o}}},{key:"checkItem",value:function(e,t){var a,n=t&&t.searchExtras,o=n?n.root:this.pane.getRootItem(),s=n?n.showHierarchy:this.showHierarchy(),l=this.matches,u=e.isNote(),d=e.parent();if(e.isDestroyed())return a=x.No;if(i.default.Assert(d||e.isRootItem(),"Item parent does not exist while being searched",e===o),this._stickyMatches[e.id])a=x.ChildYes;else if(e.isRootItem())a=x.Yes;else if(d)if(l[d.id]===x.Negated)a=x.Negated;else{var c,h,f,p,g,m,v=[],y=e.getSearchText(this.pane),_=(a=this._matchFilters(e))===x.Negated;if(!_&&this.searchArr.length){var b=0,k=0;for(h=0;h<this.searchArr.length;h++){var w=0;if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;for(m=this.searchArr[h],f=0;f<m.length;f++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;if((g=m[f]).isNegated&&(p=g.text,i.default.Assert(p,"Each value in the search array should be valid at this point"),this._checkMatch(e,y,p))){v[h]=x.Negated,_=!0,k++;break}}}k===this.searchArr.length&&(a=x.Negated)}if(this.isMatchStateMatch(a)){var S=0,I=0;for(h=0;h<this.searchArr.length;h++){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;if(v[h]!==x.Negated){var D=0;for(m=this.searchArr[h],f=0;f<m.length;f++){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;if(p=(g=m[f]).text,i.default.Assert(p,"Each value in the search array should be valid at this point"),!g.isNegated)if(this._checkMatch(e,y,p))v[h]=x.Yes;else if(s){var C=0;for(c=e;c;){if(C++>5e3&&__infLoop&&__infLoop(C))throw new RangeError;if(!(c=c.parent())||c===o){v[h]=x.No;break}if(this._checkMatch(c,c.getSearchText(),p))break}}else v[h]=x.No;if(v[h]===x.No)break}}}var P=!1;for(h=0;h<v.length;h++){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;if(P=v[h]===x.Yes,a===x.Unknown&&v[h]===x.Negated)a=x.Negated;else if(a!==x.Yes&&v[h]===x.No)a=x.No;else if(v[h]===x.Yes||v[h]===x.Unknown){a=x.Yes;break}}if(P&&this.updatingValue&&this.getValue()){var A=0;for(c=d;c;){if(A++>5e3&&__infLoop&&__infLoop(A))throw new RangeError;c.isCollapsed(this.pane,!1,!0)&&this.pane.setPerPaneState(c.id,r.a.PerPaneStateField.CollapsedSearch,!1),c=c.parent()}}a===x.Unknown&&(a=x.Yes)}if(!_&&this.pane.shouldSearchMatchParents&&d!==o&&s&&l[d.id]===x.Yes)return l[e.id]=x.Yes,l[e.id];a===x.No&&u&&(a=l[d.id])}else a=x.No;if(this.isMatchStateMatch(a)&&this.onlyMatchDates&&!this.pane.isOkOnAgenda(e)&&(a=x.No),a===x.Yes){if(s){var M=0;for(c=d;c&&!c.isRootItem()&&l[c.id]!==x.Negated&&l[c.id]!==x.Yes;){if(M++>5e3&&__infLoop&&__infLoop(M))throw new RangeError;l[c.id]=x.ChildYes,c.hasNote()&&(l[c.getNote().id]=x.Yes),c=c.parent()}}u&&(l[d.id]=x.Yes)}return l[e.id]=a,l[e.id]}},{key:"checkChildrenParams",value:function(e,t){return this.checkItem(e,t)!==x.Negated}},{key:"checkChildren",value:function(){var e={includeArchived:this.pane.showArchived.get(),includeNotes:!0,comparator:this.checkChildrenParams,searchExtras:{root:this.pane.getRootItem(),showHierarchy:this.showHierarchy()}};if(this.itemStoreFilter&&(e.itemStoreFilter=this.itemStoreFilter),this.pane.getItemStore()!==o.default.itemStoreManager.getDefaultItemStore()?e.itemStore=this.pane.getItemStore():e.item=this.pane.getItem(),o.default.searchVMLIs(e),this.isAnimatingSearch)for(var t in this.matches)if(this.matches.hasOwnProperty(t)&&void 0!==this.prevMatches[t]&&this.isMatchStateMatch(this.prevMatches[t])&&!this.isMatchStateMatch(this.matches[t])){var a=s.a.getItem(t);a&&!this.isMatchStuck(a)&&this.stickMatchAfterSearch(a,this.prevMatches[a.id])}}},{key:"_getMatchedItem",value:function(e){return this._stickyMatches[e.id]||e}},{key:"getItemDate",value:function(e){var t=this._stickyMatches[e.id];return t&&t.date}},{key:"getItemRepeatDate",value:function(e){var t=this._stickyMatches[e.id];return t&&t.repeatDate}},{key:"getItemDateText",value:function(e){var t=this._stickyMatches[e.id];return t&&t.dateText}},{key:"getItemDuration",value:function(e){var t=this._stickyMatches[e.id];return t&&t.duration}},{key:"getItemTagsLower",value:function(e){var t=this._stickyMatches[e.id];return t&&t.tagsLower}},{key:"getItemContacts",value:function(e){var t=this._stickyMatches[e.id];return t&&t.contacts}},{key:"getItemSearchText",value:function(e){var t=this._stickyMatches[e.id];return t&&t.searchText}},{key:"getItemPrefix",value:function(e){var t=this._stickyMatches[e.id];return t&&t.prefix}},{key:"getItemPriority",value:function(e){var t=this._stickyMatches[e.id];return t&&t.priority}},{key:"getItemStarred",value:function(e){var t=this._stickyMatches[e.id];return t&&t.isStarred}},{key:"stickMatch",value:function(e,t){var a=i.default.isVMLI(e)?e:e.item;if(!this._stickyMatches[a.id]){this.matches[a.id]=x.Yes;var n=a.getStickySearchInfo();t&&(n.isHiding=!0),i.default.isInCompleteAction()&&(n.wasCompleted=!0),this._stickyMatches[a.id]=n}}},{key:"isMatchStuck",value:function(e){var t=i.default.isVMLI(e)?e:e.item;return!!this._stickyMatches[t.id]}},{key:"unstickMatch",value:function(e){var t=i.default.isVMLI(e)?e:e.item,a=this._stickyMatches[t.id];if(a){var n=t.getStickySearchInfo();return delete this._stickyMatches[t.id],!i.default.areObjectsEqual(a,n)}return!1}},{key:"isMatchStuckHiding",value:function(e){var t=i.default.isVMLI(e)?e:e.item,a=this._stickyMatches[t.id];return a&&a.isHiding}},{key:"stickMatchAfterSearch",value:function(e,t){this.stickMatch(e,!0),t&&(this._timeoutHideNonMatches&&clearTimeout(this._timeoutHideNonMatches),this._stickyMatchesAwaitingClear.push(e),u.a.isMobile&&M.default.isInMultiselect()||(this._timeoutHideNonMatches=setTimeout(this.hideNonMatches,1500)))}},{key:"hideNonMatches",value:function(){var e=this;if(!this._destroyed){var t=this.pane,a=this._stickyMatchesAwaitingClear,n=a.length,s=0;if(n>0){for(var l=0,d=0;d<n;d++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var c=a[d],f=this._stickyMatches[c.id];f&&f.wasCompleted&&s++,this.unstickMatch(c)}var p=n+(n>1?" items":" item"),g={hold:!1};this.pane===i.default.focusedPane&&(s!==n?(g.text=p+" hidden because "+(n>1?"they do":"it does")+" not match search",g.actionText="UNHIDE",g.action=function(){if(t&&t.setIgnoreRestoreScroll){var i=0,r=h.a.save();t.setIgnoreRestoreScroll();for(var o=0;o<n;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o];e.stickMatch(s),e._stickyMatchesAwaitingClear.push(s)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),h.a.restore(r)}}):(g.text=p+" completed",g.actionText="UNDO",g.action=function(){var i=0,o=h.a.save();t.setIgnoreRestoreScroll();for(var s=0;s<n;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a[s].isComplete(!1,r.a.ChangeType.Local)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),h.a.restore(o)}),o.default.toasts.pushMessage(g));var m=h.a.save();this._stickyMatchesAwaitingClear=[],t.setIgnoreRestoreScroll(),t.updateItemsImmediate(!0,void 0,void 0,!0),u.a.isMobile||h.a.restore(m)}}}},{key:"showHierarchy",value:function(){return this.pane.type!==r.a.PaneMode.Task||this.pane.getViewMode()!==r.a.TaskViewMode.List_Flat&&1!==this.getFilterValue("showOnlyMatches")}},{key:"setShowHierarchy",value:function(e){this.pane.supportSearchFlat&&this.setFilter("showOnlyMatches",e?0:1)}},{key:"showOnlyAgendaDates",value:function(){return this.pane.type===r.a.PaneMode.Task&&this.getFilterValue("showOnlyAgendaDates")}},{key:"showOnlyMatchingTags",value:function(){return this.pane.type===r.a.PaneMode.Task&&this.getFilterValue("showOnlyMatchingTags")}},{key:"showChildProjects",value:function(){return this.pane.type===r.a.PaneMode.Task&&this.getFilterValue("showChildProjects")}},{key:"clearListCache",value:function(){this.pane.getInfiniteList().clearCache()}},{key:"getTags",value:function(){return this.tags}},{key:"getContacts",value:function(){return this.contacts}},{key:"getSearchWords",value:function(){return this.searchWords}},{key:"shouldHighlightSearch",value:function(){return this.isFocused.get()&&this.getValue()}}])&&L(t.prototype,a),c&&L(t,c),e}(),R=a(17),F=a(28),N=a(59),B=a(32),U=a(82),V=a(38),j=a(15),H=a(29);function z(e){return(z="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function W(e,t){return!t||"object"!==z(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Y=a(26);function X(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}if(u.a.isMobile)var Q=a(30).default;var J=0,Z=["collapser","itemParents","itemCheckbox","agendaTime","itemMenuIcon","vertLines"],$=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__ISPANE=!0,n.a.binder(this,"getItems","getHeaders","updateItems","getWidth","getHeight","compositionStart","compositionEnd","onShowArchivedChanged","onTouchHoldTimeout","zoomInOnSwipe","collapseOnSwipe","deleteOnSwipe","completeOnSwipe","getMinItemSize"),this.bindExtra&&this.bindExtra(),this.title=a.title?a.title:r.a.RootItemName,this.contextMenuMode=a.contextMenuMode?a.contextMenuMode:r.a.ContextMenuMode.Default,this.paneEmptyMessage=a.paneEmptyMessage?a.paneEmptyMessage:"Start typing to get started",this.paneEmptySearchMessage=a.paneEmptySearchMessage?a.paneEmptySearchMessage:"No search results",this.titleContextMenuHeader=a.titleContextMenuHeader?a.titleContextMenuHeader:"Zoom to item",this.searchFilters=a.searchFilters?a.searchFilters:[],this.dropEffect=a.dropEffect?a.dropEffect:function(){return r.a.DropEffect.Move},this.isWriteable=!a.isWriteable||a.isWriteable,this.isEditable=!!a.isEditable&&a.isEditable,this.isDraggable=!a.isDraggable||a.isDraggable,this.isDropTarget=!a.isDropTarget||a.isDropTarget,this.hasNonVMLIs=!!a.hasNonVMLIs&&a.hasNonVMLIs,this.canAddItem=!a.canAddItem||a.canAddItem,this.overrideCopyBehavior=!a.overrideCopyBehavior||a.overrideCopyBehavior,this.supportMenuIcon=!!a.supportMenuIcon&&a.supportMenuIcon,this.supportCollapsing=!a.supportCollapsing||a.supportCollapsing,this.supportCompleting=!a.supportCompleting||a.supportCompleting,this.supportCheckbox=!!a.supportCheckbox&&a.supportCheckbox,this.isArchiveView=!!a.isArchiveView&&a.isArchiveView,this.supportIndent=!a.supportIndent||a.supportIndent,this.supportOffline=!a.supportOffline||a.supportOffline,this.supportPerformArchive=!a.supportPerformArchive||a.supportPerformArchive,this.supportDataRefresh=!!a.supportDataRefresh&&a.supportDataRefresh,this.supportReportError=!!a.supportReportError&&a.supportReportError,this.supportCompose=!!a.supportCompose&&a.supportCompose,this.supportPagination=!!a.supportPagination&&a.supportPagination,this.supportVertLines=!a.supportVertLines||a.supportVertLines,this.supportStarClick=!!a.supportStarClick&&a.supportStarClick,this.supportSearchItemAutocomplete=!a.supportSearchItemAutocomplete||a.supportSearchItemAutocomplete,this.supportSearchListenTextChanges=!a.supportSearchListenTextChanges||a.supportSearchListenTextChanges,this.supportSearchFlat=!a.supportSearchFlat||a.supportSearchFlat,this.supportLocalSearch=!a.supportLocalSearch||a.supportLocalSearch,this.supportClone=!a.supportClone||a.supportClone,this.supportDates=!a.supportDates||a.supportDates,this.supportMultiselect=!a.supportMultiselect||a.supportMultiselect,this.supportDeferredItemLoad=!!a.supportDeferredItemLoad&&a.supportDeferredItemLoad,this.supportCellTransition=!a.supportCellTransition||a.supportCellTransition,this.supportViewMenu=!!a.supportViewMenu&&a.supportViewMenu,this.showRootOnRow2=!!a.showRootOnRow2&&a.showRootOnRow2,this.useLineCache=!a.useLineCache||a.useLineCache,this.supportSel=!a.supportSel||a.supportSel,this.shouldSearchMatchParents=!a.shouldSearchMatchParents||a.shouldSearchMatchParents,this.shouldUpdateOnTextChanged=!a.shouldUpdateOnTextChanged||a.shouldUpdateOnTextChanged,this.noOverviewStyle=!!a.noOverviewStyle&&a.noOverviewStyle,this.supportClickOverviewScroll=a.supportClickOverviewScroll?a.supportClickOverviewScroll:!u.a.isMobile,this.overviewTracksScroll=!a.overviewTracksScroll||a.overviewTracksScroll,this.overviewHasPaneItems=!a.overviewHasPaneItems||a.overviewHasPaneItems,this.overviewPadLevels=a.overviewPadLevels?a.overviewPadLevels:0,this.minWidth=a.minWidth?a.minWidth:r.a.StdPaneWidthMin,this.minWidthFlex=a.minWidthFlex?a.minWidthFlex:r.a.StdPaneWidthMin,this.maxWidth=a.maxWidth?a.maxWidth:r.a.PaneWidthMax,this.maxWidthFlex=a.maxWidthFlex?a.maxWidthFlex:r.a.StdPaneWidthMax,this.maxWidthSingle=a.maxWidthSingle?a.maxWidthSingle:r.a.StdPaneWidthMax,this.widthBiggerInSingle=!a.widthBiggerInSingle||a.widthBiggerInSingle,this.collapsedFieldName=a.collapsedFieldName?a.collapsedFieldName:r.a.PerPaneStateField.Collapsed,this.hasMoreButtons=!a.hasMoreButtons||a.hasMoreButtons,this.supportsDocuments=!("supportsDocuments"in a)||a.supportsDocuments,this._topBoxHeight=void 0!==a._topBoxHeight?a._topBoxHeight:i.default.activeDisplayMode&r.a.DisplayMode.NoPaneTop?0:u.a.isMobile?16:36,this.blockNoKey="",this.topBoxHeight=new d.a(this._topBoxHeight),this.rect=new d.a(t.rect),this.isExpanded=new d.a(!1),i.default.Assert(void 0!==t.id,"Must supply a valid pane id"),this.id=t.id,this.uniquePaneID=J++,this.isFakePane=t.isFakePane,this.plugin=t.plugin,this.document=new d.a(t.document),t.item||(this.supportDeferredItemLoad?(t.item=this.getDefaultDisplayItem(),this.deferredItemState={itemID:t.deferredItemID,search:t.search,offset:0}):(t.item=this.getDefaultDisplayItem(),t.search=t.search||"")),this.name=new d.a(t.name),this.item=new d.a(t.item),this.items=new c.a,this.headers=new c.a,this.paneObjectsByItem={},this.isDefaultPane=t.isDefaultPane,this.initialOffset=t.offset,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.showArchived=new d.a(!1),this._panePadding=0,this.paneTopText=new d.a,this.toast=new d.a,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new d.a(!1),this.isFocused=new d.a(!1),this.caretPosition=new d.a,this.widthManual=t.widthManual,this.widthManualExpanded=t.widthManualExpanded,this.isReady=new d.a(!this.plugin||this.plugin.isReady()),this.isActive=new d.a(!u.a.isMobile),this.hasBeenActive=this.isActive.get(),this.hasCollapsedObs=new d.a,this._infiniteList=new I({pane:this,offset:t.offset||0,isOverview:!1,itemsObs:this.items,itemsFn:this.getItems,widthFn:this.getWidth,heightFn:this.getHeight,intialOffset:this.initialOffset,minItemSize:this.getMinItemSize}),this.useCustomScroller=this._infiniteList.useCustomScroller,this.isLoadingNewPage=new d.a(!1),this.orientation=new d.a(r.a.Orientation.Vertical),this.showScrollbars=new d.a(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},u.a.isMobile?(this.defaultOffset=Math.max(this.topBoxHeight.get()-16,0),this.offsetX=new d.a(0),this.swipeMenuItems=this.getSwipeMenuItems()):(this.defaultOffset=0,this.onTap={onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd,onDoubleClick:this.onTapDoubleClick,onRightClick:this.onTapRightClick}),this.showArchived.listen(this.onShowArchivedChanged),this.search=new O(this,t.search,this.onSearchChanged.bind(this)),this.overview=new P(this,t.isOverviewVisible,t.isOverviewShowingContents)}var t,a,f;return t=e,(a=[{key:"init",value:function(){this.getItem()&&this.setItem(this.getItem(),!1),this.plugin&&this.plugin.notifyPaneCreated()}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"getStats",value:function(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}}},{key:"becomeReal",value:function(){}},{key:"activate",value:function(){i.default.Assert(u.a.isMobile,"Activating panes should only ever happen on mobile devices"),this.isActive.set(!0),this.hasBeenActive=!0,this.updateItemsImmediate(!0,!1)}},{key:"deactivate",value:function(){i.default.Assert(u.a.isMobile,"Deactivating panes should only ever happen on mobile devices"),this.isActive.set(!1)}},{key:"unload",value:function(){this._isUnloaded=!0}},{key:"isUnloaded",value:function(){return this._isUnloaded}},{key:"destroy",value:function(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(),this.showArchived.unlisten(this.onShowArchivedChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this._onAfterLoadedRAF&&(cancelAnimationFrame(this._onAfterLoadedRAF),this._onAfterLoadedRAF=void 0),this.isLoaded&&this.getItemStore()===o.default.itemStoreManager.getDefaultItemStore()&&v.a.unlisten("itemNoteSet",this._infiniteList.handleItemNoteSet),this._infiniteList=void 0,i.default.Assert(i.default.focusedPane!==this,"Globally focused pane should never be the one destroyed"),i.default.Assert(h.a.getPane()!==this,"Selection focused pane should never be the one destroyed"),i.default.Assert(!o.default.PaneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}},{key:"notifyPluginLoaded",value:function(){i.default.Assert(!1,"Plugin load notification not supported by pane type: ",this.type)}},{key:"getContextMenuMode",value:function(){return this.contextMenuMode}},{key:"isItemDraggable",value:function(){return this.isDraggable}},{key:"isOkOnAgenda",value:function(e){return!1}},{key:"getInfiniteList",value:function(e){var t;if(e){var a=this.getOverview();i.default.Assert(a,"Trying to get infinite list for overview that doesnt exist."),a&&(t=a.getInfiniteList())}else t=this._infiniteList;return t}},{key:"getItemStore",value:function(){return this.getRootItem().getItemStore()}},{key:"usesItemStore",value:function(e){return e===this.getItemStore()||!!this._activeItemStores[e.id]}},{key:"useItemStore",value:function(e){i.default.Assert(!this._activeItemStores[e.id],"Should never use the same store twice"),this._activeItemStores[e.id]=e}},{key:"stopUsingItemStore",value:function(e){i.default.Assert(this._activeItemStores[e.id],"Must be using item store to stop using it"),delete this._activeItemStores[e.id]}},{key:"getOverview",value:function(){return this.overview}},{key:"isOverviewVisible",value:function(){return this.overview.isVisible.get()}},{key:"isOverviewShowingContents",value:function(){return this.overview.isShowingContents.get()}},{key:"numItems",value:function(){return this.getItems().length}},{key:"numHeaders",value:function(){return this.getHeaders().length}},{key:"getItems",value:function(){return o.default.PaneUpdateBatcher.flushItemsUpdate(this),this.items.get()}},{key:"getHeaders",value:function(){return this.headers.get()}},{key:"itemAtIndex",value:function(e){return this._infiniteList.itemAtIndex(e)}},{key:"objectAtIndex",value:function(e){return this._infiniteList.objectAtIndex(e)}},{key:"indexOfItem",value:function(e,t,a){return this._infiniteList.indexOfItem(e,t,a)}},{key:"indexOfObject",value:function(e){return this._infiniteList.indexOfItem(e)}},{key:"topOfItem",value:function(e){return this._infiniteList.topOfItem(e)}},{key:"topOfIndex",value:function(e){return this._infiniteList.topOfIndex(e)}},{key:"indexOfTop",value:function(){return this._infiniteList.indexOfTop()}},{key:"inViewCount",value:function(){return this._infiniteList.inViewCount()}},{key:"itemAtTop",value:function(){return this._infiniteList.itemAtTop()}},{key:"elementAtIndex",value:function(e){return this._infiniteList.getElementAtIndex(e)}},{key:"isIndexMounted",value:function(e){return this._infiniteList.isIndexMounted(e)}},{key:"notifyDragStart",value:function(){return this._infiniteList.notifyDragStart()}},{key:"notifyDragEnd",value:function(){return this._infiniteList.notifyDragEnd()}},{key:"notifySwappedIn",value:function(e){return this._infiniteList.notifySwappedIn(e)}},{key:"getScrollOffset",value:function(){return this._infiniteList.getScrollOffset()}},{key:"addScrollListener",value:function(e){return this._infiniteList.addScrollListener(e)}},{key:"removeScrollListener",value:function(e){return this._infiniteList.removeScrollListener(e)}},{key:"refreshScrollListener",value:function(){return this._infiniteList.refreshScrollListener()}},{key:"setScrollOffset",value:function(e,t,a){return this._infiniteList.setScrollOffset(e,t,a)}},{key:"scrollIndexIntoView",value:function(e,t,a){return this._infiniteList.scrollIndexIntoView(e,t,a)}},{key:"scrollItemIntoView",value:function(e,t,a){return this._infiniteList.scrollItemIntoView(e,t,a)}},{key:"scrollIndexToTop",value:function(e,t,a){return this._infiniteList.scrollIndexToTop(e,t,a)}},{key:"scrollItemToTop",value:function(e,t,a){return this._infiniteList.scrollItemToTop(e,t,a)}},{key:"scrollItemToMiddle",value:function(e,t,a){return this._infiniteList.scrollItemToMiddle(e,t,a)}},{key:"scrollIndexToMiddle",value:function(e,t,a){return this._infiniteList.scrollIndexToMiddle(e,t,a)}},{key:"addScrollDelta",value:function(e){return!!this._infiniteList&&this._infiniteList.addScrollDelta(e)}},{key:"addPadding",value:function(){return this._infiniteList.addPadding()}},{key:"removePadding",value:function(){return this._infiniteList.removePadding()}},{key:"getScrollTop",value:function(){return this._infiniteList.getScrollTop()}},{key:"closestIndexOfObject",value:function(e){return this.indexOfObject(e)}},{key:"sizeAtIndex",value:function(e,t){var a=0,n=t?this.overview._infiniteList:this._infiniteList;if(i.default.Assert(n,"Must have a valid owner"),n){var r=n.objectAtIndex(e);i.default.Assert(r,"Must have found a valid item"),r&&(a=this.sizeOfItem(r,e,t))}return a}},{key:"sizeOfItem",value:function(e,t,a){i.default.Assert(e,"Must provide a valid item to measure");var n=0,r=e.sizeInPane;return void 0!==r&&(n=isNaN(r)?e.sizeInPane(this,t,a):r,e.sizePad&&(n+=e.sizePad)),n}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){return"Loading..."}},{key:"getStatusMessage",value:function(e){var t;return e||(this.isLoading.get()?t=this._getLoadingMessage():0===this.numItems()?t=this.isSearched()&&this._allPaneItems.length>0?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(t=this._getNotReadyStatus())),t}},{key:"_getNotReadyStatus",value:function(){return"Pane data is only available while online."}},{key:"getSaveInfoForClone",value:function(){var e=this.getSaveInfo();for(var t in delete e.id,e)e.hasOwnProperty(t)&&i.default.isObject(e[t])&&(e[t]=i.default.clone(e[t]));return e}},{key:"getSaveInfo",value:function(){return{id:this.id,name:this.name.get(),item:this.getItem().id,document:this.document.get().id,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),offset:this.getScrollOffset(),itemState:this.getSaveInfoItemState(),isOverviewVisible:!u.a.isMobile&&this.overview.isVisible.get(),isOverviewShowingContents:!u.a.isMobile&&this.overview.isShowingContents.get(),isExpanded:!u.a.isMobile&&this.isExpanded.get(),widthManual:this.widthManual,widthManualExpanded:this.widthManualExpanded}}},{key:"getSaveInfoItemState",value:function(){var e=this._perPaneState,t={};for(var a in e)if(e.hasOwnProperty(a)){var i=s.a.getItem(a);if(i){var n=e[a];for(var o in n)if(n.hasOwnProperty(o)&&o.startsWith(r.a.PerPaneStateField.Collapsed)){var l=n[o];if(void 0!==l){var u=o.replace(r.a.PerPaneStateField.Collapsed,"");if("Search"===u||l!==this.getCollapsedDefault(i,"Overview"===u,u)||!l&&i.isDemandLoad()){var d=(n[o]?"":"un")+o;t[d]||(t[d]=[]),t[d].push(a)}}}}else delete e[a]}return t}},{key:"getPerPaneState",value:function(e,t){var a=this._perPaneState[e];if(a)return a[t]}},{key:"setPerPaneState",value:function(e,t,a){this._perPaneState[e]||(this._perPaneState[e]={}),this._perPaneState[e][t]=a}},{key:"clearPerPaneStateSearch",value:function(){var e=this._perPaneState;for(var t in e)e.hasOwnProperty(t)&&(e[t][r.a.PerPaneStateField.CollapsedSearch]=void 0)}},{key:"deletePerPaneState",value:function(e){this._perPaneState[e]=void 0}},{key:"isSearched",value:function(){return i.default.Assert(this.search,"Pane must be initialized: ",this._destroyed),!!this.search&&this.search.isSearched()}},{key:"isSearchedText",value:function(){return i.default.Assert(this.search,"Pane must be initialized: ",this._destroyed),!!this.search&&this.search.getValue()}},{key:"isSearchedFlat",value:function(){return!1}},{key:"onSearchChanged",value:function(e){var t=h.a.isValid();if(t&&h.a.reset(),this.updateItems(),t&&this.numItems()>0){var a=this.indexOfFirstItem();a>=0&&h.a.selectIndex(a,0)}o.default.PaneManager.updatePaneStateForPane(this)}},{key:"refreshSearchResults",value:function(){this.updateItems(!0)}},{key:"_applyItemStateArr",value:function(e,t,a){if(e)for(var i=0,n=0;n<e.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e[n];this.setPerPaneState(r,t,a)}}},{key:"applyItemState",value:function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)){var a=t.startsWith("un"+r.a.PerPaneStateField.Collapsed)?t.slice(2):t;if(a.startsWith(r.a.PerPaneStateField.Collapsed)){var i=e[t];this._applyItemStateArr(i,a,!t.startsWith("un"))}}}},{key:"requestDemandLoadData",value:function(e,t){i.default.Assert(!1,"SubClass must override - by default demand load is not supported")}},{key:"requestDataPage",value:function(e){i.default.Assert(!1,"SubClass must override - by default data pagination is not supported")}},{key:"getDefaultDisplayItem",value:function(e){return this.getRootItem()}},{key:"getRootItem",value:function(){return this.document.get().getRootItem()}},{key:"setRootItem",value:function(e,t){i.default.Assert(void 0===e.parent(),"Root should never have a parent"),i.default.Assert(this.getItem()!==e,"Should not be setting root to the same value"),this.setItem(e,t)}},{key:"scrollFromMousePosition",value:function(e,t,a){var n=a?this.getWidth():this.getHeight(),o=i.default.clamp(.1*n,20,40),s=o,l=a?this.getWidth():this.getHeight()-(u.a.isMobile?r.a.MobileBottomHeight:this.headerHeight()),d=l-o,c=a?e-this.scrollElement.getBoundingClientRect().left:t-this.contentTop(),h=0;c<s?h=i.default.computeScrollSpeed(0,s,c,4,-1):c>d&&(h=i.default.computeScrollSpeed(d,l,c,4)),0!==h?i.default.repeatScroll("pane",h,this,!1):i.default.cancelRepeatScroll("pane")}},{key:"getContentElement",value:function(){return this.paneContent}},{key:"getPaneIcon",value:function(){return"icon-align-left"}},{key:"itemHasChildren",value:function(){return this.getItem().numItems()>0}},{key:"getItem",value:function(){return this.item.get()}},{key:"allowZoom",value:function(e){return!0}},{key:"performOverviewAction",value:function(e){}},{key:"setItem",value:function(e,t){this._numItemSets++;var a=this.getItem();this.item.set(e,!1),this.updateItemsImmediate(!0,!1,!0),a&&a.parent()&&a._updateStylePadding(a.parent().levelsDeep.get(),!0),t&&(e.itemChanged.notify(),a&&e!==a&&a.itemChanged.notify(),this.item.notify(e,a))}},{key:"getItemSearchParams",value:function(){return{item:this.getItem(),comparator:this.search.isMatched,noCollapsed:!0,includeNotes:!0,pane:this}}},{key:"getHeaderSearchParams",value:function(){return{item:this.getRootItem(),comparator:this.search.isMatched,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}},{key:"setItemsWillBeDirty",value:function(){this.itemsWillBeDirty=!0}},{key:"setItemsDirty",value:function(){this._setDirtyState(!1,!1)}},{key:"isItemsDirty",value:function(){return!!this.itemsDirtyState}},{key:"_setDirtyState",value:function(e,t){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=e||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=t||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:e,forceNotify:t}}},{key:"updateItems",value:function(e,t){this._setDirtyState(e,t),o.default.PaneUpdateBatcher.updateAllItems()}},{key:"updateItemsImmediate",value:function(e,t,a,n){this.itemsDirtyState&&(!0,t=!0,this.itemsDirtyState=void 0),i.default.shouldLog(r.a.LogLevels.React)&&i.default.log("update items"),this.search.isRunningSearch||this.search.update(void 0,void 0,!n);var o=this.item.get(),s=[],l=this.getItemSearchParams(),u=l.each,d=this.hasCollapsed();l.each=function(e){e.isNote()&&e.parent()===o||(s.push(e),u&&u(e))},this.runItemSearch(l),this._numItemComputes++,this.setItems(s,t),this.updateHeaders(t||a),this.hasCollapsedObs.set(d),this.isInitialized||(this.isInitialized=!0),v.a.fireEvent("itemsUpdated",[this])}},{key:"runItemSearch",value:function(e){o.default.searchVMLIs(e)}},{key:"updateOutline",value:function(e,t){var a,i=0,n=[],r={},o=this.getItem().levelsDeep.get();if(t){var s=0,l=0,u=[];for(a=0;a<e.length;a++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e[a].isNote()||u.push({item:e[a],index:u.length})}for(u.sort(t),e=[],a=0;a<u.length;a++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=u[a].item;e.push(d),d.hasNote()&&e.push(d.getNote())}}for(a=0;a<e.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=e[a],h=new N.a({type:"blockItem",item:c,id:c.id,index:a,parentObject:r[c.parent().id],levelsDeep:(c.isNote()?c.parent():c).levelsDeep.get()-o-1,sizeInPane:c.sizeInPane});r[c.id]=h,this.addPaneObject(n,h)}this.items.set(n)}},{key:"_setItems",value:function(e,t){this.updateOutline(e)}},{key:"setItems",value:function(e,t){!t&&this._searchShowHierarchy===this.search.showHierarchy()&&e.equals(this._allPaneItems)||(this._allPaneItems=e,this.paneObjectsByItem={},this._setItems(e,t),h.a.getPane()===this&&h.a.checkValid())}},{key:"updateHeaders",value:function(e){var t=[],a=this.getHeaderSearchParams();a.each=function(e){t.push(e)},o.default.searchVMLIs(a),this._numHeaderComputes++,this.setHeaders(t,e)}},{key:"setHeaders",value:function(e,t){!t&&e.equals(this.headers.get())||this.headers.set(e)}},{key:"clearItems",value:function(e){this.items.set([],e)}},{key:"onLoad",value:function(e){this.isLoaded=!0,this.getItemStore()===o.default.itemStoreManager.getDefaultItemStore()&&v.a.listen("itemNoteSet",this._infiniteList.handleItemNoteSet),this._onAfterLoadedRAF=requestAnimationFrame(this.onAfterLoaded.bind(this))}},{key:"onInfiniteListLoaded",value:function(){}},{key:"onInfiniteListMounted",value:function(){}},{key:"onAfterLoaded",value:function(){this._onAfterLoadedRAF=void 0,this._didInitialScroll||this.isDestroyed()||(isNaN(this.initialOffset)&&(this.initialOffset=this.defaultOffset),0!==this.initialOffset&&this.setScrollOffset(this.initialOffset),this._didInitialScroll=!0,this._infiniteList.saveScrollOfTop()),this.isFakePane&&(this.isFakePane=!1,this.becomeReal())}},{key:"getSize",value:function(){return{width:this.getWidth(),height:this.getHeight()}}},{key:"getWidth",value:function(){var e=this.rect.get().width;return i.default.Assert(e>100,"Pane width is not set",this.rect.get()),e>100?e:u.a.isMobile?u.a.windowWidth():void 0}},{key:"getHeight",value:function(){return this.rect.get().height-this.headerHeight()}},{key:"getLeft",value:function(){return this.rect.get().left}},{key:"toggleOverviewVisibility",value:function(){this.getOverview().toggleDesktop()}},{key:"notifyDropFrom",value:function(e,t){}},{key:"notifyDropFromToEdit",value:function(e,t){if(!e.hasChildren()&&e.hasAttachmentType(r.a.PluginType.Storage))return e.getAttachmentByType(r.a.PluginType.Storage).getPlugin().notifyDropFromToEdit(e,t);var a=document.createElement("ul");return a.innerHTML=U.a.toDropHtml(e),a}},{key:"dropEffectCopyBehavior",value:function(e,t){return e.clone(t,r.a.ChangeType.Local)}},{key:"_isNodeTextParent",value:function(e){return Z.every(function(t){return!e.classList.contains(t)})}},{key:"convertElementToText",value:function(e){var t="";if("TEXTAREA"===e.nodeName)t+=e.value;else if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=r.a.AttachChar;else if(this._isNodeTextParent(e))for(var a=0,i=0;i<e.childNodes.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.convertElementToText(e.childNodes[i])}return t}},{key:"onFinishedEditingAndroid",value:function(e){setTimeout(this.updateItems,0)}},{key:"setDetectedEnterAndroid",value:function(){var e=this;this._hasDetectedEnterAndroid=!0,setTimeout(function(){e._hasDetectedEnterAndroid=!1},0)}},{key:"compositionStart",value:function(){h.a.isComposing=!0}},{key:"compositionEnd",value:function(e){h.a.isComposing=!1}},{key:"addItemToPane",value:function(e,t){var a=this.getItem();e||(e=""),this.setIgnoreRestoreScroll();var i=a.addItemAtIndex(e,t,this);return R.a.setSelected([t],this),i}},{key:"archiveItem",value:function(e,t){return t.archiveSelf(r.a.ChangeType.Local)}},{key:"archiveSelected",value:function(e){var t=this,a=0,i=this.indexOfPrevVMLI(h.a.getStartIndex(),!0,!0);if(this.applyToSelection(function(e){t.archiveItem(!0,e)&&a++}),a>0){if(i<0&&this.numItems()>0&&(i=this.indexOfFirstItem()),i>=0){var n=this.itemAtIndex(i).getParsedText().length;h.a.selectIndex(i,n)}var s=a>1?" items.":" item.";o.default.toasts.pushMessage({text:"Archived "+a+s,action:r.a.MessageAction.Undo,hold:u.a.isMobile,timeout:u.a.isMobile?void 0:8e3})}}},{key:"deleteSelected",value:function(e,t){var a=this.indexOfPrevVMLI(h.a.getStartIndex(),!0,!0),i=0;if(this.applyToSelection(function(t){e&&!e(t)||(t.deleteSelf(r.a.ChangeType.Local),i++)}),a<0&&this.numItems()>0&&(a=this.indexOfFirstItem()),a>=0){var n=this.itemAtIndex(a);if(n){var s=n.getParsedText().length;h.a.selectIndex(a,s)}else h.a.reset()}var l=i>1?" items.":" item.";o.default.toasts.pushMessage({text:"Deleted "+i+l,action:r.a.MessageAction.Undo,timeout:r.a.ToastTimeoutDefault})}},{key:"handleLeftSideTap",value:function(e,t){var a=e.item;if(this.supportCollapsing)if(u.a.mac&&t.metaKey||!u.a.mac&&t.ctrlKey)this.zoomIn(a);else if(a.isCollapsible()){var i=h.a.save(),n=!this.isPaneObjectCollapsed(e);t.shiftKey?this.collapseAll(a,n,!0):this.setPaneObjectCollapsed(n,e),i&&(u.a.isMobile?i.startItem&&!i.startItem.isDescendantOf(a)||h.a.closeKeyboard():this.restoreSelectionAfterCollapse(i,a))}}},{key:"handleRightSideTap",value:function(e,t){this.supportCompleting&&(i.default.beginCompleteAction(),e.setComplete(!e.isComplete(),r.a.ChangeType.Local),i.default.endCompleteAction())}},{key:"onClickTitle",value:function(e){this.zoomOut(e),i.default.sendEvent("Menu","Title")}},{key:"onDoubleClickTitle",value:function(){this.toggleCollapseAll()}},{key:"onTapStart",value:function(e){if(!i.default.findParent(e.target,"itemNotInPane")&&!i.default.hasClass(e.target,"androidInput")){var t,a;if(this.getInfiniteList(!1).reMount(),this.getInfiniteList(!0).reMount(),u.a.isMobile&&(u.a.useCustomScroller&&i.default.preventDefault(e),i.default.touchHoldTimeout&&clearTimeout(i.default.touchHoldTimeout),Q.isInMultiselect()||this.isOverviewVisible()||(a=i.default.getItemForElement(e.target))&&(i.default.touchHoldTimeout=setTimeout(this.onTouchHoldTimeout,i.default.isKeyboardOpen?i.default.iOSDragTimeKeyboardOpen:i.default.iOSDragTime,e))),!u.a.isMobile||!Q.start(e)){h.a.setFocusedPane(this),a=i.default.getItemForElement(e.target);var n=i.default.getIndexForElement(e.target);if(u.a.isMobile&&!a)i.default.getPaneForElement(e.target)===this&&this.indexOfLastItem()>=0&&(a=this.getLastItem(),n=this.indexOfLastItem());if(a&&a.onStart&&a&&a.onStart){var r=this.objectAtIndex(n);(t=a.onStart(n,r,e))&&i.default.preventAndStop(e)}}this._startPrevented=t}}},{key:"onTapMove",value:function(e){if(i.default.isAttachedToDoc(e.target)&&!i.default.findParent(e.target,"itemNotInPane")&&!i.default.hasClass(e.target,"androidInput")){if(u.a.isMobile&&i.default.touchHoldTimeout&&(clearTimeout(i.default.touchHoldTimeout),i.default.touchHoldTimeout=void 0),u.a.isMobile&&F.a.hide(),!u.a.isMobile||!Q.update(e)){var t=i.default.getItemForElement(e.startSrc),a=!1;if(u.a.isMobile&&!t)i.default.getPaneForElement(e.target)===this&&this.indexOfLastItem()>=0&&(t=this.getLastItem(),a=!0);o.default.DragDrop.isDragging&&(t=o.default.DragDrop.dragItem),t&&t.onMove&&t.onMove(e,a)}return!1}}},{key:"onTapClick",value:function(e){if(!i.default.findParent(e.target,"itemNotInPane")&&!i.default.hasClass(e.target,"androidInput")&&(!u.a.isMobile||!Q.onClickPane(e))&&!this._startPrevented){var t,a=i.default.getItemForElement(e.startSrc);if(u.a.isMobile&&!a&&i.default.hasClass(e.startSrc,"paneScroller")&&(a=this.getLastItem(),t=this.numItems()-1,(a&&e.clientX<a.getPadding(this)||e.clientX>this.getWidth()-i.default.SPThresholdRight)&&(a=void 0)),a&&(e.targetItem=a),a&&a.onClick){void 0===t&&(t=i.default.getIndexForElement(e.startSrc));var n=this.objectAtIndex(t);this.onClickItem(t,a,n,e)}else i.default.hasClass(e.startSrc,"paneDataPageLoad")||e.startSrc.parentElement&&i.default.hasClass(e.startSrc.parentElement,"paneDataPageLoad")?this.getItem().hasPaginationToken()&&this.requestDataPage(this.getItem()):i.default.hasClass(e.startSrc,"agendaCollapser")||u.a.isMobile&&i.default.hasClass(e.startSrc,"dateHeader")||(this.isWriteable&&0===this.numItems()&&this.canAddItem&&!i.default.hasClass(this.paneContent,"loading")?this.addItem(e):i.default.preventDefault(e))}}},{key:"onTapEnd",value:function(e){h.a._isMouseDown=!1,u.a.isMobile&&i.default.touchHoldTimeout&&(clearTimeout(i.default.touchHoldTimeout),i.default.touchHoldTimeout=void 0),u.a.isMobile&&!this.isOverviewVisible()&&Q.end(e);var t=e.targetItem||i.default.getItemForElement(e.startSrc);u.a.isMobile&&!t&&this.indexOfLastItem()>=0&&(t=this.getLastItem()),o.default.DragDrop.isDragging&&(t=o.default.DragDrop.dragItem),t&&("paneContent"===e.startSrc.id&&i.default.preventDefault(e),t&&t.onEnd&&t.onEnd(e))}},{key:"onTapDoubleClick",value:function(e){if(!i.default.findParent(e.target,"itemNotInPane")){var t=i.default.getItemForElement(e.startSrc);if(t&&t.onDoubleClick){var a=i.default.getIndexForElement(e.startSrc);this.onDoubleClickItem(a,t,e)}}}},{key:"onTapRightClick",value:function(e){if(!i.default.findParent(e.target,"itemNotInPane")&&!i.default.isDisplayModeActive(r.a.DisplayMode.NoRightClick)){h.a.setFocusedPane(this);var t=i.default.getItemForElement(e.target);if(t&&t.onRightClick){var a=i.default.getIndexForElement(e.target);this.onRightClickItem(a,t,e)}l.e.miscAction({type:l.c.Misc,misc:l.a.RightClick,data:{element:void 0,pane:this}})}}},{key:"onClickItem",value:function(e,t,a,i){!u.a.isMobile&&t.isNote()||t.onClick(e,a,i)}},{key:"onRightClickItem",value:function(e,t,a){t.onRightClick(e,a)}},{key:"onDoubleClickItem",value:function(e,t,a){t.onDoubleClick(e,a)}},{key:"addItem",value:function(e,t){var a=this;o.default.PaneUpdateBatcher.beginUpdateItems(),t=o.default.settings.getDefaultItemText()+(t||""),h.a.reset();var n=this.addItemToPane(t,0),r=this.indexOfItem(n);if(u.a.isMobile&&R.a.setSelected([0],this),this.paneContent&&(h.a.focusPane(this),r>=0)){var s=u.a.isMobile?0:t.length;h.a.selectIndex(r,s)}o.default.PaneUpdateBatcher.commitUpdateItems(),u.a.isMobile&&e&&setTimeout(function(){i.default.openKeyboardOnIndex(e,a,r,function(){a.setFocused(!0)},function(){})},0),i.default.sendEvent("Menu","AddItemButton")}},{key:"onClose",value:function(){}},{key:"onTapAddItem",value:function(e){var t=this;if(u.a.isMobile){if(!this.isOverviewVisible())if(h.a.setFocusedPane(this),this.getScrollOffset()>this.topBoxHeight.get())this.setScrollOffset(0,r.a.ScrollDuration.Default,function(){t._infiniteList.saveScrollOfTop(),t.onTapAddItem(e)});else{var a=this.isViewAgenda()?" @today":"";this.addItem(e,a)}}else this.addItem(e)}},{key:"onTapOverviewButton",value:function(){this.toggleOverviewVisibility(),this.isOverviewVisible()?i.default.sendEvent("Menu","OpenOverview"):i.default.sendEvent("Menu","CloseOverview")}},{key:"onTapClosePane",value:function(){var e=o.default.PaneManager.removePane(this);e&&(i.default.Assert(e===this.id,"Pane IDs must match"),l.e.performAction(l.c.UIAction,{type:l.d.RemovePane,data:e}),i.default.sendEvent("Menu","ClosePane"),i.default.tooltip.hideTip(),this.onClose())}},{key:"onClickArchiveCompleted",value:function(e){this.archiveCompleted(),i.default.preventAndStop(e),i.default.sendEvent("Menu","ArchiveCompleted")}},{key:"onClickRefreshData",value:function(e){i.default.Assert(this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type),this.refreshPaneData(),i.default.sendEvent("Menu","PaneDataRefresh"),i.default.preventAndStop(e)}},{key:"onClickReportError",value:function(e){i.default.Assert(this.supportReportError,"Pane does not support error reporting"),this.reportPaneError(),i.default.sendEvent("Menu","PaneReportError"),i.default.preventAndStop(e)}},{key:"refreshPaneData",value:function(){}},{key:"reportPaneError",value:function(){}},{key:"getItemsToArchive",value:function(){var e=[];return o.default.searchVMLIs({item:this.getItem(),each:function(t){t.isComplete()&&!t.isNote()&&e.push(t)}}),e}},{key:"archiveCompleted",value:function(){var e,t,a,n=0;if(h.a.isValid()){var s=0;for(t=h.a.getEndIndex();t<this.items.length();){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if((a=this.itemAtIndex(t))&&!this.itemAtIndex(t).hasCompletedAncestor()){e=this.objectAtIndex(t);break}t++}}var d=this.getItemsToArchive();for(l.e.beginAction(),o.default.PaneUpdateBatcher.beginUpdateItems(),t=d.length-1;t>=0;t--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a=d[t],i.default.shouldLog(r.a.LogLevels.Data)&&i.default.log("Archive Item: ",a.getParsedText()),a.archiveSelf(r.a.ChangeType.Local)}if(o.default.PaneUpdateBatcher.commitUpdateItems(),l.e.endAction(),d.length>0){var c=d.length>1?" items.":" item.";o.default.toasts.pushMessage({text:"Archived "+(d.length+c),action:r.a.MessageAction.Undo,hold:u.a.isMobile,timeout:u.a.isMobile?void 0:8e3})}else o.default.toasts.pushMessage({text:"No completed items to archive"});if(!u.a.isMobile&&e){var f=this.indexOfObject(e);if(f>=0&&(a=this.itemAtIndex(f),i.default.Assert(a,"Could not restore selection to item"),a)){var p=a.getParsedText().length;h.a.selectIndex(f,p)}}else h.a.reset()}},{key:"updatePosition",value:function(e,t){this.isAnimatingOffset=t,e=Math.round(e),this.offsetX.set(e)}},{key:"updatePositionMobile",value:function(){u.a.isMobile&&this.updatePosition(this.isOverviewVisible()?Q.overviewWidth():0)}},{key:"bottomListMessage",value:function(){}},{key:"isSearchingRemote",value:function(){return!1}},{key:"getTitleList",value:function(){return this.getItem().parents().concat(this.getItem())}},{key:"itemTitle",value:function(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem()}},{key:"titleOfFirstItem",value:function(){return this.title}},{key:"onShowArchivedChanged",value:function(){this.showArchived.get()&&v.a.fireEvent("showArchived",[]),this.updateItems()}},{key:"indexOfFirstItem",value:function(){return this.indexOfNextVMLI(-1)}},{key:"indexOfLastItem",value:function(){return this.indexOfPrevVMLI(this.numItems(),!1,!0)}},{key:"getFirstItem",value:function(){var e=this.indexOfFirstItem();if(e>=0){var t=this.getItems()[e];return t?t.item:void 0}}},{key:"getFirstObject",value:function(){return this.objectAtIndex(this.indexOfFirstItem())}},{key:"getLastItem",value:function(){return this.itemAtIndex(this.indexOfLastItem())}},{key:"getLastObject",value:function(){return this.objectAtIndex(this.indexOfLastItem())}},{key:"setFocused",value:function(e){e&&this.paneContent&&this.paneContent.focus(),this.isFocused.set(e)}},{key:"headerHeight",value:function(){return u.a.isMobile?0:this.shouldShowSecondHeaderRow()?68:36}},{key:"shouldShowSecondHeaderRow",value:function(){return this.showRootOnRow2||this.getTitleList().length>1}},{key:"handleUndo",value:function(){B.a.undo()}},{key:"handleRedo",value:function(){B.a.redo()}},{key:"contentTop",value:function(){return o.default.DesktopUI.topBarHeight()+this.headerHeight()}},{key:"indexPageUp",value:function(e){return e=this._infiniteList.indexPageUp(e),this.itemAtIndex(e)||(e=this.indexOfNextVMLI(e)),e}},{key:"indexPageDown",value:function(e){return e=this._infiniteList.indexPageDown(e),this.itemAtIndex(e)||(e=this.indexOfPrevVMLI(e)),e}},{key:"adjustSelectionFromPaneObject",value:function(e){i.default.Assert(e,"Must pass in a valid saved selection");var t=e;return e.startItem&&e.endItem&&(e.startIndex=this.indexOfObject(e.startObject),e.endIndex=this.indexOfObject(e.endObject),(e.startIndex<0||e.endIndex<0)&&(t=void 0)),t}},{key:"restoreSelection",value:function(e){if(i.default.Assert(e,"Must always have a valid saved selection"),e){var t=this.indexOfObject(e.startObject),a=this.indexOfObject(e.endObject);if(t>=0&&a>=0){var n=e.startOffset,r=e.endOffset,o=e.startItem.getParsedText(),s=e.endItem.getParsedText();(n<0||n>o.length||r<0||r>s.length)&&(n=-1,r=-1),h.a.selectIndices(t,n,a,r)}else h.a.reset()}else h.a.reset()}},{key:"restoreSelectionAfterCollapse",value:function(e,t){if(e){var a,n,o=e.startItem,s=this.indexOfItem(e.startItem),l=this.indexOfItem(e.endItem);if(s>=0&&l>=0)h.a.selectIndices(s,e.startOffset,l,e.endOffset),a=e.startItem;else if(s>=0)h.a.selectIndex(s,e.startOffset),a=e.startItem,n=!0;else if(l>=0)h.a.selectIndex(l,e.endOffset),a=e.endItem,n=!0;else if(!0===t){var u=0;for(a=o;a;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var d=a.parent();if(d===i.default.focusedPane.item.get()){h.a.selectItem(a,a===o?h.a.getStartOffset():-1),n=!0;break}a=d}}else h.a.reset();a&&n&&i.default.focusedPane.scrollItemToMiddle(a,r.a.ScrollDuration.Snap)}}},{key:"setCollapsedRecursive",value:function(e,t,a){var i=0,n=e.numChildren(),r=e.getItems();!a||this.isSearchedFlat()&&!this.search.isMatched(e)||e.setCollapsed(t,this,!1,!1);for(var o=0;o<n;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=r[o];s.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(s))&&this.setCollapsedRecursive(s,t,!0)}}},{key:"collapseAll",value:function(e,t,a,n){i.default.Assert(this.supportCollapsing,"Should not be collapsing all");var r=e||this.item.get(),s=h.a.save();this.setIgnoreRestoreScroll(),o.default.PaneUpdateBatcher.beginUpdateItems(),void 0!==t&&this.setCollapsedRecursive(r,t,!!a),o.default.PaneManager.updatePaneStateForPane(this),(n||this.isSearchedFlat())&&this.updateItems(),o.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelectionAfterCollapse(s,t)}},{key:"toggleCollapseAll",value:function(){if(this.supportCollapsing){var e=!this.hasCollapsed();this.collapseAll(this.item.get(),e)}}},{key:"hasCollapsed",value:function(e){for(var t=0,a=(e=e||this.item.get()).numChildren(),i=e.getItems(),n=0;n<a;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[n];if(r.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(r))){if(r.isCollapsed(this,!1))return!0;if(this.hasCollapsed(r))return!0}}return!1}},{key:"onOverviewToggled",value:function(e){}},{key:"onTouchHoldTimeout",value:function(e){u.a.isMobile&&(i.default.touchHoldTimeout=void 0,Q.disable(),v.a.fireEvent("touchHoldTimeout",[e]))}},{key:"getPaddingForPaneObject",value:function(e,t){var a=e.levelsDeep,n=t?e:e.item,r=!t&&this.isSearchedFlat()?o.default.DisplaySettings.itemIndentStart():n.getPadding(this,t,a);return r>this.getWidth()-i.default.SPThresholdRight&&(r=this.getWidth()-i.default.SPThresholdRight-8),r}},{key:"maxWidthOfPaneObject",value:function(e){var t=this.getPaddingForPaneObject(e,!1);return this.getWidth()-t-i.default.SPThresholdRight-(e.item.hasPrefix()?this.shouldRenderPrefix(e)?r.a.PrefixWidth:5:0)}},{key:"prevPaneObjectAtSameLevel",value:function(e){var t=0;i.default.Assert(e>=0,"Must supply a valid selection index: "+e),i.default.Assert(e<this.numItems()+1,"Must supply a valid selection index: "+e);for(var a=this.objectAtIndex(e),n=e-1;n>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.objectAtIndex(n),o=this.itemAtIndex(n);if(o&&a.item!==o&&!o.isNote()&&r.levelsDeep===a.levelsDeep)return r;n--}}},{key:"indexOfPrevVMLI",value:function(e,t,a){var n=0;i.default.Assert(e>=0,"Must supply a valid selection index: "+e),i.default.Assert(e<this.numItems()+1,"Must supply a valid selection index: "+e);for(var r=t?this.itemAtIndex(e):void 0,o=e-1;o>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=this.itemAtIndex(o);if(s&&r!==s&&(!a||!s.isNote()))return o;o--}return-1}},{key:"indexOfNextVMLI",value:function(e,t,a){var n=0;i.default.Assert(e>=-1,"Must supply a valid selection index: "+e),i.default.Assert(e<this.numItems(),"Must supply a valid selection index: "+e);for(var r=t?this.itemAtIndex(e):void 0,o=e+1;o<this.numItems();){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=this.itemAtIndex(o);if(s&&r!==s&&(!a||!s.isNote()))return o;o++}return-1}},{key:"indexOfNextSibling",value:function(e){var t=0;i.default.Assert(e>=-1,"Must supply a valid selection index: "+e),i.default.Assert(e<this.numItems(),"Must supply a valid selection index: "+e);var a=this.itemAtIndex(e);for(e=this.indexOfNextVMLI(e);e>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.itemAtIndex(e).isDescendantOf(a))break;e=this.indexOfNextVMLI(e)}return e>=0?e:-1}},{key:"_getPrevNextItem",value:function(e,t,a){var i=a?this.indexOfNextVMLI:this.indexOfPrevVMLI,n=i.call(this,e);if(t)for(var r=0,o=this.itemAtIndex(e);n>=0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=this.itemAtIndex(n);if(o.parent()===s.parent())return s;if(o.parent()===s||s.parent()===o.parent().parent()){n=-1;break}n=i.call(this,n)}else if(n>=0)return this.itemAtIndex(n)}},{key:"getPreviousItem",value:function(e,t){return this._getPrevNextItem(e,t,!1)}},{key:"getNextItem",value:function(e,t){return this._getPrevNextItem(e,t,!0)}},{key:"getFirstSelectedItem",value:function(){var e;return this.applyToSelection(function(t){return e=t,!1}),e}},{key:"getFirstSelectedIndex",value:function(){return h.a.getStartIndex()}},{key:"applyToSelection",value:function(e,t){if(u.a.isMobile&&Q.isInMultiselect())R.a.applyFnToSelected(e,this);else{var a=0;i.default.Assert(!t||!t.restoreSelection,"restoreSelection is no longer a valid option"),l.e.beginAction(),B.a.beginAction();var n=h.a.getSelectedObjects();o.default.PaneUpdateBatcher.beginUpdateItems();for(var r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!1===e(n[r].item,r,n.length,n[r]))break}o.default.PaneUpdateBatcher.commitUpdateItems(),B.a.endAction(),l.e.endAction()}}},{key:"applyFnToSelection",value:function(e,t){var a=h.a.save(),i=t&&t.toggle,n=!t||void 0===t.value||t.value,r=t&&void 0!==t.value2?t.value2:void 0;if(this.applyToSelection(function(t){i&&t[i]()!==n&&(i=void 0),i||t[e](n,r)}),i){var o=o=!(!t||void 0===t.emptyValue)&&t.emptyValue;this.applyToSelection(function(t){t[e](o,r)})}a&&!t.noRestoreSel&&this.restoreSelection(a)}},{key:"applyPriorityToSelection",value:function(e,t){t?this.applyFnToSelection("setPriority",{toggle:"priority",value:e,value2:r.a.ChangeType.Local,emptyValue:r.a.VMLIFlag.None}):this.applyFnToSelection("setPriority",{value:e,value2:r.a.ChangeType.Local})}},{key:"autocompleteTag",value:function(){this._autocompletePopup({mode:"tag",text:"Add tag",buttonText:"Add"},function(e,t){var a=t.value.trim(),i=e.getParsedText()+" "+r.a.TagPrefix+a;e.setText(i,!0,r.a.ChangeType.Local)})}},{key:"autocompleteMove",value:function(e,t){var a=this;(e=e||{}).mode=r.a.AutocompleteMode.Move,e.text="Select item to move to",e.buttonText="MOVE",this._autocompletePopup(e,function(e,t){var i;t.subItemText?(i=a.createVMLI({text:t.subItemText},{parent:t.item,changeType:r.a.ChangeType.AllLocal}),t.item.insertItem(i,0)):t.item===e||t.item.isDescendantOf(e)||(i=t.item),i&&a.moveItem(e,i)},function(){t&&t(),h.a.updateCaret()})}},{key:"autocompleteJump",value:function(e,t){var a=this;(e=e||{}).mode=r.a.AutocompleteMode.Jump,e.text="Select item to jump to",e.buttonText="JUMP",this._autocompletePopup(e,function(){},function(e){e.item&&a.indexOfItem(e.item)>=0&&(h.a.selectItem(e.item,0,0),a.scrollItemToTop(e.item,r.a.ScrollDuration.Default)),t&&t(),h.a.updateCaret()})}},{key:"autocompleteSnooze",value:function(e,t,a){var n,s=this,l=o.default.pluginManager.getPlugin(r.a.PluginID.Gmail);if(!t){var u=e&&e.item||this.getFirstSelectedItem();u&&(n=u.getAttachmentByPlugin(l.id))&&(t=n.getField("accountID"))}Y.a.isLoaded?(o.default.toasts.clearMessage(r.a.MessageID.SnoozeOffline),(e=e||{}).mode="snooze",e.text="Snooze until date",e.buttonText="SNOOZE",e.allowCustom=!0,this._autocompletePopup(e,function(t,a){l.beginAction();var u=a.value.trim(),d=o.default.International.parseDateDefaultFormat(u);if(n=t.getAttachmentByPlugin(l.id))if(i.default.isDateValid(d))if(Y.a.isAuthorizedForScopes(n.getField("accountID"),[r.a.GScope.GmailModify])){var c=d.getTime()-Date.now();c<i.default.weeks(1)?l.performAction(r.a.PluginAction.Gmail.Snooze,!1,n,c):o.default.toasts.pushMessage({text:"Maximum snooze delay is one week. Please enter a date less than a week from now.",action:r.a.MessageAction.Okay})}else o.default.menus.closeContextMenu(),function(){var t=e&&e.elementDisplay;if(!t){var a=s.getFirstSelectedIndex();t=s.elementAtIndex(a)}o.default.menus.openContextMenu({componentName:"ReactContextMenuAuthorize",element:t,message:"Your account needs additional authorization to Snooze. Please update your authorization to enable Snooze."})}();else o.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:r.a.MessageAction.Okay});else o.default.toasts.pushMessage(r.a.MessageID.ReselectEmail);l.endAction()},a)):o.default.toasts.pushMessage(r.a.MessageID.SnoozeOffline)}},{key:"autocompleteSchedule",value:function(e,t){(e=e||{}).mode="date",e.text="Add event on date",e.buttonText="Add",e.allowCustom=!0;var a=o.default.pluginManager.getPlugin(r.a.PluginID.Gmail);this._autocompletePopup(e,function(e,t){l.e.beginAction();var n=t.value.trim(),s=o.default.International.parseDateDefaultFormat(n);i.default.isDateValid(s)?a.scheduleEmail(e,s):o.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:r.a.MessageAction.Okay}),l.e.endAction()},t)}},{key:"autocompleteLabel",value:function(e,t){var a,n=this,s=o.default.pluginManager.getPlugin(r.a.PluginID.Gmail),l=function(e){var t=e.getAttachmentByPlugin(s.id),n=t.getPlugin().getDisplayTags(t);a=a?i.default.arrayIntersection(a,n):n};(e=e||{}).item?l(e.item):this.applyToSelection(l),e.tokens=(a||[]).map(function(e){return{text:e}}),e.mode=r.a.AutocompleteMode.GmailLabel,e.text="Select a label",e.buttonText="LABEL",e.allowCustom=!0,e.allowEmpty=!0,e.onTokenRemoved=function(a){var l=a.text;s.beginAction();var u=function(e){var t=e.getAttachmentByPlugin(s.id);t?s.attachmentHasLabel(t,l)?s.performAction(r.a.PluginAction.Gmail.RemoveLabel,!1,t,l):i.default.Assert(!1,"Tried to remove a tag from an attachment without a tag"):o.default.toasts.pushMessage(r.a.MessageID.ReselectEmail)};e.item?u(e.item):n.applyToSelection(u),s.endAction(),t&&t(a)},this._autocompletePopup(e,function(e,t){var a=t.value.trim();i.default.Assert(e.hasPluginAttachment(s.id),"Must have valid plugin attachment");var n=e.getAttachmentByPlugin(s.id);if(n){if(a){var l=s.createLabelString(a);l?s.attachmentHasLabel(n,l)||s.performAction(r.a.PluginAction.Gmail.AddLabel,!1,n,l):o.default.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:r.a.MessageAction.Okay})}}else o.default.toasts.pushMessage(r.a.MessageID.ReselectEmail)})}},{key:"_autocompletePopup",value:function(e,t,a){var i=this;if(!u.a.isMobile&&!e.elementDisplay){var n=h.a.getStartIndex(),r=this.elementAtIndex(n);e.elementDisplay=r}e.onSelected=function(n){e.item?t(e.item,n):i.applyToSelection(function(e){t(e,n)}),a&&a(n)},F.a.showPopup(e)}},{key:"moveItem",value:function(e,t,a){if(l.e.beginAction(),o.default.PaneUpdateBatcher.beginUpdateItems(),t.belongsToSameItemStore(e))e.moveTo({parent:t,index:0},r.a.ChangeType.Local);else{var i=this.dropEffectCopyBehavior(e,t);i.setParent(t),t.insertItem(i)}o.default.PaneUpdateBatcher.commitUpdateItems(),l.e.endAction()}},{key:"setPropDefault",value:function(e,t){void 0===this[e]&&(this[e]=t)}},{key:"setExpanded",value:function(e,t){var a=this.isExpanded.get()!==e;this.isExpanded.set(e),a&&!1!==t&&(v.a.fireEvent("panesChanged",[]),o.default.PaneManager.updatePaneStateForPane(this),o.default.PaneManager.ensurePaneInView(this))}},{key:"modifyTextOnDropBasedOnSearch",value:function(e,t,a,i,n,r){var o=0;if(!a||!a.search)return e;var s,l,u=a.search,d=this.search,c=t[r](),h=u[r](),f=d[r](),p=[],g=[];for(s=0;f&&s<f.length;s++){var m=0;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;l=f[s];for(var v=i,y=!c||c.indexOf(l)<0;y&&v;){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var _=v[r]();_&&_.indexOf(l)>=0&&(y=!1),v=v.parent()}y&&p.push(n+l)}if(p.length){var b=0;for(s=0;c&&h&&s<h.length;s++){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;l=h[s],c.indexOf(l)>=0&&f.indexOf(l)<0&&g.push(n+l)}var k=p.join(" ");if(g.length>0){var w=0;for(s=0;s<g.length;s++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;l=g[s],e=0===s?e.replace(l,k):e.replace(l,"")}}else e=e+" "+k;e=e.replace(/  +/g," ")}return e}},{key:"canAcceptDragOver",value:function(e,t,a,i){return this.isDropTarget}},{key:"handleDragOver",value:function(e,t,a,n,r){var o=i.default.getElementParent(a),s=o&&i.default.getItemForElement(o),l=(o||i.default.findParent(a,"blockHeader"))&&i.default.getPaneObjectForElement(a),u={};return o&&i.default.findParent(o,"overviewList")?(this.overview.updateDragHoverItem(s),u={overview:!0,targetItem:s,targetElement:o}):(this.overview.updateDragHoverItem(null),u=this._handleDragOverPane(e,t,a,o,l,n,r)),u}},{key:"_handleDragOverPane",value:function(e,t,a,i,n,r,o){}},{key:"handleDragDrop",value:function(e,t,a,i){a&&e!==a.targetItem&&a.targetItem&&this._handleDragDrop(e,t.dataTransfer,a,t,i),this.revertDrag()}},{key:"_handleDragDrop",value:function(e,t,a,n,o){for(var s=0,d=a.overview,c=!0,h=t.pane,f=e,p=a.targetItem,g=p.parent();g&&c;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;g===e&&(c=!1),g=g.parent()}if(c){var m,y=-1;if(d)y=(m=p).numChildren();else if(a.dropOnPane)m=p,y=a.atEnd?p.numItems():0;else if(a.position===r.a.DragDropPosition.Above)m=p.parent(),y=p.getIndex();else if(a.position===r.a.DragDropPosition.On){m=p,y=u.a.mac&&n.ctrlKey||!u.a.mac&&n.altKey?0:p.numItems()}else{var _=this.indexOfItem(p),b=this.getNextItem(_);b&&b.parent()===p&&!b.isNote()?(m=p,y=0):(m=p.parent(),y=p.getIndex()+1)}l.e.beginAction(),i.default.Assert(m,"Trying to move without a target"),i.default.Assert(!isNaN(y),"Trying to move without a target index");var k=!0;if(t.dropEffect===r.a.DropEffect.Move){var w=e.parent();if(w){var S=e.getIndex();if(w.belongsToSameItemStore(m)){e.moveTo({parent:m,index:y},r.a.ChangeType.Local),l.e.performAction(l.c.Move,{itemID:e.id,oldParent:w.id,oldPosition:S,newParent:m.id,newPosition:y});var I=e.getRawText();I=this.modifyTextOnDropBasedOnSearch(I,e,h,m,r.a.TagPrefix,"getTags"),(I=this.modifyTextOnDropBasedOnSearch(I,e,h,m,r.a.ContactPrefix,"getContacts"))!==e.getRawText()&&e.setText(I,!0,r.a.ChangeType.Local)}else e=e.clone(m,r.a.ChangeType.Local),m.insertItem(e,y),w.removeChildAtIndex(S,r.a.ChangeType.Local)}else e=e.clone(m,r.a.ChangeType.Local),m.insertItem(e,y)}else o||(e=t.pane?t.pane.dropEffectCopyBehavior(e,m):e.clone(m,r.a.ChangeType.Local)),e?(e.setParent(m),m.insertItem(e,y)):k=!1;k&&(v.a.fireEvent("droppedItem",[f,this,t.pane]),l.e.miscAction({type:l.c.Misc,misc:l.a.DropItem,data:{itemID:e.id,toPane:this,fromPane:t.pane}})),l.e.endAction(),k&&t.pane&&t.pane.notifyDropFrom(e,this)}}},{key:"revertDrag",value:function(){this.overview&&this.overview.updateDragHoverItem(null)}},{key:"isItemHeader",value:function(e,t){return t?e.hasHeaderChildren():e.hasVisibleChildren(this)}},{key:"onNotePopupClosed",value:function(){}},{key:"openNoteContextMenu",value:function(){var e=h.a.getStartItem(),t=h.a.getStartIndex(),a=t-1,n=h.a.getStartOffset(),s=h.a.getEndOffset(),l=this.elementAtIndex(t);if(l){i.default.Assert(l.firstChild,"Opening a note should have a firstChild",i.default.getElementPath(l)),l.firstChild&&(l=l.firstChild),void 0!==n&&void 0===s&&(s=n);var d={componentName:"ReactNotePopup",onClosed:this.onNotePopupClosed.bind(this),element:l,item:e.parent(),note:e,pane:this,noBackdrop:u.a.isMobile,index:t,position:"fill",selectionStart:n,selectionEnd:s};if(o.default.menus.isContextMenuOpen()&&o.default.menus.closeContextMenu(),u.a.isMobile){this._editingNote={note:e,index:t,itemIndex:a};var c=e.parent();d.bottom=u.a.getKBSize(),d.positionOffset={top:-12},this.scrollItemToTop(c,0,function(){o.default.menus.openContextMenu(d),Q.setTopBarMode(r.a.TopBarMode.Note)})}else h.a.clearSelection(!0),d.positionOffset={left:-4,top:-18},o.default.menus.openContextMenu(d)}}},{key:"closeNoteContextMenu",value:function(){if(o.default.menus.isContextMenuOpen()){if(u.a.isMobile&&u.a.ios){var e=this._editingNote,t=e.note,a=e.itemIndex,i=t.parent().getParsedText().length;h.a.selectIndex(a,i),this._editingNote=void 0}o.default.menus.closeContextMenu()}}},{key:"canResetMultiselect",value:function(){return!0}},{key:"replaceTextOnDropOnBlock",value:function(e,t,a,i){var n=t.isNoKey?"":t.name,o=a&&a.name.replace(i,""),s=e.getRawText();(""===n||s.indexOf(n)<0)&&(o?s=s.replace(i+o,n):s+=" "+n,e.setText(s,!0,r.a.ChangeType.Local))}},{key:"applyDropOnBlock",value:function(e,t,a,n){var s,l=e;if(h.a.setFocusedPane(a),l.isStarred||l.isImportant)l.isStarred?t.setStarred(!0,r.a.ChangeType.Local):l.p0||l.isImportant?s=r.a.VMLIFlag.P0:l.p1?s=r.a.VMLIFlag.P1:l.p2&&(s=r.a.VMLIFlag.P2),s&&t.setPriority(s,r.a.ChangeType.Local);else if(e.isTag)this.replaceTextOnDropOnBlock(t,e,n&&n.isTag?n:void 0,"#");else if(e.isContact)this.replaceTextOnDropOnBlock(t,e,n&&n.isContact?n:void 0,"+");else if(e.isPriority)t.setPriority(e.priority,r.a.ChangeType.Local);else{var u=i.default.vmMain.getDefaultCalendarPlugin(),d=!0;if(t.hasAttachmentType(r.a.PluginType.Calendar)){var c=t.getAttachmentByType(r.a.PluginType.Calendar);c&&c.getField("recurringEventId")&&t.getCalendarParsedText()===c.getField("summary")?(o.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),d=!1):u.hasWritePermissionForAttach(c)||(o.default.toasts.pushMessage({text:"This event is on a read-only calendar",actionText:"OKAY"}),d=!1)}if(d)if(i.default.Assert(e.duration>1e3,"Block duration was in wrong format"),t.setDate(e.date,e.duration,r.a.ChangeType.Local),i.default.isDateValid(l.date)&&u&&a!==this&&!t.hasAttachmentType(r.a.PluginType.Calendar))if(u.getDefaultExportCalendarID()){var f=o.default.pluginManager,p=r.a.PluginSettingsID.GCalendar.SyncDraggedEvents,g=function(){f.getSetting(r.a.PluginID.GCalendar,p)&&u.createEventForItem(t)};o.default.settings.shouldShowHelp("syncNewEvents")?o.default.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",function(e){o.default.settings.closeHelp("syncNewEvents"),f.setSetting(r.a.PluginID.GCalendar,p,e),g()}):g()}}if(a.isEditable){var m=a.indexOfItem(t,e);m>=0&&h.a.selectIndex(m,t.getParsedText().length)}}},{key:"setIgnoreRestoreScroll",value:function(e,t){var a=this;this._ignoreRestoreScroll=!0,this._ignoreRestoreScrollTimeout&&clearTimeout(this._ignoreRestoreScrollTimeout),this._ignoreRestoreScrollTimeout=setTimeout(function(){a._ignoreRestoreScroll=!1,t&&t()},e||100)}},{key:"isIgnoringRestoreScroll",value:function(){return this._ignoreRestoreScroll}},{key:"zoomInOnSwipe",value:function(e){var t=this,a=this.item.get();this.zoomIn(e),o.default.toasts.pushMessage({text:"<b>Zoomed in to:</b><br>"+e.getParsedText(),action:function(){t.zoomIn(a)},hold:!1,actionText:"UNDO"})}},{key:"collapseOnSwipe",value:function(e){this.supportCollapsing&&e.isCollapsible()&&e.toggleCollapsed(this)}},{key:"deleteOnSwipe",value:function(e){var t;(e.deleteSelf(r.a.ChangeType.Local),e.hasAttachmentType(r.a.PluginType.Email))?t=e.getAttachmentByType(r.a.PluginType.Email).getField("subject"):t=e.getParsedText();o.default.toasts.pushMessage({text:"<b>Deleted:</b><br>"+t,action:function(){l.e.undoAction()},hold:!1,actionText:"UNDO"})}},{key:"completeOnSwipe",value:function(e){this.supportCompleting&&(i.default.beginCompleteAction(),e.setComplete(!e.isComplete(),r.a.ChangeType.Local),i.default.endCompleteAction())}},{key:"getSwipeMenuItems",value:function(){var e=this;return{leftOuter:{text:"Zoom",icon:"icon-zoom-in",color:"#09d",fn:this.zoomInOnSwipe},leftInner:{text:function(t){return e.supportCollapsing&&t.isCollapsible()?t.isCollapsed(e,!1)?"Expand":"Collapse":"Zoom"},icon:function(t){return e.supportCollapsing&&t.isCollapsible()?"icon-"+(t.isCollapsed(e,!1)?"caret-down":"caret-right"):"icon-zoom-in"},color:function(t){return e.supportCollapsing&&t.isCollapsible()?"#777":"#09d"},fn:function(t){e.supportCollapsing&&t.isCollapsible()?(t.toggleCollapsed(e),h.a.closeKeyboard()):e.zoomInOnSwipe(t)}},rightInner:{text:function(e){return e.isComplete()?"Uncomplete":"Complete"},icon:"icon-check",color:"#0c0",fn:function(t){e.supportCompleting&&(i.default.beginCompleteAction(),t.setComplete(!t.isComplete(),r.a.ChangeType.Local),i.default.endCompleteAction())}},rightOuter:{text:"Delete",icon:"icon-delete",color:"#a30",fn:function(e){var t;(e.deleteSelf(r.a.ChangeType.Local),e.hasAttachmentType(r.a.PluginType.Email))?t=e.getAttachmentByType(r.a.PluginType.Email).getField("subject"):t=e.getParsedText();o.default.toasts.pushMessage({text:"<b>Deleted:</b><br>"+t,action:function(){l.e.undoAction()},hold:!1,actionText:"UNDO"})}}}}},{key:"getSwipeMenuItem",value:function(e,t){var a=u.a.windowWidth(),i=.16*a,n=.45*a,r=this.swipeMenuItems;return t>n?r.leftOuter:t>i?r.leftInner:t<-n?r.rightOuter:t<-i?r.rightInner:{color:"#ddd"}}},{key:"getSwipeMenuItemsNew",value:function(e){return{left:{text:e.isComplete()?"Uncomplete":"Complete",color:"#0c0",cb:this.completeOnSwipe},right:[{text:"Collapse",icon:e.isCollapsed(this)?"keyboard-arrow-up":"keyboard-arrow-down",color:"#777",cb:this.collapseOnSwipe},{text:"Zoom",icon:"zoom-in",color:"#09d",cb:this.zoomInOnSwipe},{text:"Delete",icon:"delete",color:"#a30",cb:this.deleteOnSwipe}]}}},{key:"_openSelectedInMode",value:function(e){var t=h.a.getStartItem();t&&this.openEmailByItem(t,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(r.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(r.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(r.a.EmailResponseMode.Forward)}},{key:"openEmailByItem",value:function(e,t){if(e){var a=e.getAttachmentByPlugin(r.a.PluginID.Gmail);(a&&a!==o.default.EmailPreview.getThreadAttach()||!o.default.EmailPreview.isOpenOnPane(this)||t)&&a.getPlugin().openEmailByItem(e,this,t)}}},{key:"markItemRead",value:function(e,t){var a=i.default.vmMain.getDefaultEmailPlugin(),n=t.getAttachmentByPlugin(a.id),o=e?r.a.PluginAction.Gmail.MarkRead:r.a.PluginAction.Gmail.MarkUnread;i.default.Assert(n,"Must be able to get a valid attachment"),(e&&a.isItemUnread(t)||!e&&!a.isItemUnread(t))&&a.performAction(o,!1,n)}},{key:"markReadSelected",value:function(e){var t=i.default.vmMain.getDefaultEmailPlugin();t.beginAction(),this.applyToSelection(this.markItemRead.bind(this,e)),t.endAction()}},{key:"toggleStarSelected",value:function(){var e,t=i.default.vmMain.getDefaultEmailPlugin();t.beginAction(),this.applyToSelection(function(a){var n=a.getAttachmentByPlugin(t.id);i.default.Assert(n,"Must be able to get a valid attachment");var o=t.isItemStarred(a);void 0===e&&(e=o?r.a.PluginAction.Gmail.Unstar:r.a.PluginAction.Gmail.Star),(o&&e===r.a.PluginAction.Gmail.Unstar||!o&&e===r.a.PluginAction.Gmail.Star)&&t.performAction(e,!1,n)}),t.endAction()}},{key:"selectIndex",value:function(e,t){h.a.selectIndex(e,t||0)}},{key:"onAdded",value:function(){this.isEditable&&this.isWriteable&&setTimeout(this.selectFirstItem.bind(this),0)}},{key:"selectFirstItem",value:function(){var e=this.indexOfFirstItem();e>=0&&h.a.selectIndex(e,0)}},{key:"isOverviewVisibleInPane",value:function(e){var t=this.item.get();return e===t||e.isDescendantOf(t)}},{key:"getContentWidth",value:function(){return this.getWidth()}},{key:"getContentHeight",value:function(){return this.getHeight()}},{key:"getMinItemSize",value:function(){return Math.ceil(o.default.DisplaySettings.itemLineHeight()+2*o.default.DisplaySettings.itemPadding()+(o.default.DisplaySettings.noteLineHeight()+o.default.DisplaySettings.itemPadding()))/2}},{key:"onZoom",value:function(){this.setScrollOffset(this.defaultOffset)}},{key:"widthOfDrag",value:function(e){}},{key:"getSubItems",value:function(e,t){var a=[],i={item:e,comparator:this.search.isMatched,pane:this,each:function(e){t&&e.isComplete()||a.push(e)}};return this.runItemSearch(i),a}},{key:"getMetricsForPaneObject",value:function(e,t,a){var n;try{n=o.default.Measure.measurePaneObject(e,this,o.default.settings.showMarkdown.get()&&a)}catch(r){i.default.reportError(r)}return n}},{key:"getStyledLinesForPaneObject",value:function(e,t,a){var i=e.item;if(i.isNote())return[i.getNotePreviewText()];var n=this.getMetricsForPaneObject(e,t,a);return n?n.styledLines:[i.getParsedText()]}},{key:"isItemInPane",value:function(e){return this.indexOfItem(e)>=0}},{key:"isItemTopLevel",value:function(e,t){return t.levelsDeep.get()-this.item.get().levelsDeep.get()===1}},{key:"checkHeightChanged",value:function(e,t){return this._infiniteList.checkHeightChanged(e,t)}},{key:"getCollapsedDefault",value:function(e,t,a){return!1}},{key:"isViewProject",value:function(){return!1}},{key:"isViewDates",value:function(){return!1}},{key:"isViewAgenda",value:function(){return!1}},{key:"isViewCalendar",value:function(){return!1}},{key:"isViewOutline",value:function(){return!1}},{key:"isViewGroups",value:function(){return!1}},{key:"isViewText",value:function(){return!0}},{key:"isViewFlatList",value:function(){return!1}},{key:"shouldShowAddBox",value:function(){return!1}},{key:"isViewAutoBlocks",value:function(){return!1}},{key:"getSortModeBlocks",value:function(){}},{key:"getSortModeItems",value:function(){}},{key:"isCalFilterActive",value:function(){return!1}},{key:"viewModeIcon",value:function(){return""}},{key:"viewModeColor",value:function(){return""}},{key:"extraPaddingForPaneObject",value:function(e){return 0}},{key:"createVMLI",value:function(e,t){t.documentOwner=this.getDocument();var a=s.a.createVMLI(e,t);return this.search.stickMatch(a),a}},{key:"createTempVMLI",value:function(e,t){t.documentOwner=this.getDocument();var a=s.a.createVMLI(e,t);return this.search.stickMatch(a),a}},{key:"selectNearestItem",value:function(e){var t=this.indexOfNextSibling(e);t>=0&&h.a.selectIndex(t,0)}},{key:"supportsSortBlocks",value:function(){return!1}},{key:"supportsSortBlocksMode",value:function(e,t){return!1}},{key:"supportsSortItems",value:function(){return!1}},{key:"getViewMode",value:function(){return""}},{key:"scrollToTop",value:function(e){this.setScrollOffset(0,e)}},{key:"setName",value:function(e){this.name.set(e),o.default.PaneManager.savePaneState()}},{key:"setWidthManual",value:function(e,t){isNaN(e)?this.widthManual=this.widthManualExpanded=e:t?(e=i.default.clamp(e,r.a.EmailPreviewSizeMin,r.a.EmailPreviewSizeMax),this.widthManualExpanded=e):(e=i.default.clamp(e,this.minWidth,this.maxWidth),this.widthManual=e),o.default.PaneManager.updatePaneStateForPane(this),o.default.PaneManager.updatePaneRects(!isNaN(e))}},{key:"isPaneObjectCollapsed",value:function(e,t){return(i.default.isVMLI(e)?e:e.item).isCollapsed(this,t)}},{key:"setPaneObjectCollapsed",value:function(e,t,a,n){return(i.default.isVMLI(t)?t:t.item).setCollapsed(e,this,a,n)}},{key:"shouldRenderPrefix",value:function(e){return!0}},{key:"needsUpdateForDate",value:function(e){return!1}},{key:"needsUpdateForTags",value:function(e,t){return!1}},{key:"handleItemChanged",value:function(e,t,a){var i=this.getInfiniteList();if(a=a||!1,t[r.a.ItemProp.Items]&&(o.default.DisplaySettings.boldHeaders()&&i.clearItemInfoForItem(e),a=!0),t[r.a.ItemProp.Text]){var n=i.handleItemTextChanged(e);if(a=a||n,this.supportSearchListenTextChanges){var s=this.search.handleItemTextChanged(e);a=a||s}}if(t[r.a.ItemProp.Search]){var l=this.search.handleItemChanged(e);a=a||l}if(t[r.a.ItemProp.Date]&&(a=a||this.needsUpdateForDate(e)),t[r.a.ItemProp.Tags]&&(a=a||this.needsUpdateForTags(e,t[r.a.ItemProp.Tags])),a)return this.preventUpdateItemsForItem&&this.preventUpdateItemsForItem.item===e?this.setItemsWillBeDirty():this.setItemsDirty(),!0}},{key:"addPaneObject",value:function(e,t){var a=t.item;e.push(t),a&&(this.paneObjectsByItem[a.id]?this.paneObjectsByItem[a.id].push(t):this.paneObjectsByItem[a.id]=[t])}},{key:"getPaneObjectsForItem",value:function(e){return this.paneObjectsByItem[e.id]}},{key:"_zoom",value:function(e,t){i.default.Assert(e,"Must supply a valid item to zoom to");var a=this.item.get();a&&a.id===e.id||(h.a.reset(),this.setItem(e,!0),i.default.focusedItem=e,t||o.default.PaneManager.updatePaneStateForPane(this))}},{key:"zoomIn",value:function(e,t,a,n){var r=this;i.default.Assert(e,"Must supply a valid item to zoom to");var s=this.item.get();if(this._zoom(e,t),e.isDemandLoad()&&e.notifyDemandLoadUpdate(!0,this),t||i.default.sendEvent("Menu","ZoomIn"),!u.a.isMobile&&this.paneContent&&this.isWriteable&&!n){var d=this.indexOfFirstItem();d>=0?h.a.selectIndex(d,0,0):h.a.reset()}this.isLoaded&&this.onZoom(),t||l.e.performAction(l.c.Zoom,{itemID:e.id,oldItemID:s&&s.id,zoomIn:!0,time:i.default.zoomTime,pane:this}),a&&o.default.toasts.pushMessage({text:"Zoomed into "+e.getParsedTextWithoutPrefix(),actionText:"UNDO",hold:!1,action:function(){r.zoomIn(s)}})}},{key:"zoomOut",value:function(e,t){i.default.Assert(e,"Must supply a valid item to zoom to");var a=this.item.get(),n=h.a.save()||h.a.getPreviousSelection();if(this._zoom(e,!1),i.default.sendEvent("Menu","ZoomOut"),!u.a.isMobile&&this.isWriteable&&n){for(var o=0,s=n.startItem,d=n.startOffset,c=n.endItem,f=n.endOffset;s&&this.indexOfItem(s)<0;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;s=s.parent(),d=0}s&&(this.indexOfItem(n.endItem)<0&&(c=s,f=d),h.a.selectItems(s,d,c,f),this.scrollItemToMiddle(s,r.a.ScrollDuration.Snap))}t||l.e.performAction(l.c.Zoom,{itemID:e.id,oldItemID:a.id,zoomOut:!0,time:i.default.zoomTime,pane:this})}},{key:"getDocument",value:function(){return this.document.get()}},{key:"setDocument",value:function(e,t){e!==this.document.get()&&(this.document.set(e),this.zoomIn(e?e.getRootItem():void 0,t))}},{key:"openItemEditor",value:function(e){e.pane=this,o.default.menus.openItemEditor(e)}}])&&X(t.prototype,a),f&&X(t,f),e}();n.a.extendClass($,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee;return function(t){function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),W(this,G(a).apply(this,arguments))}var s,l,d;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(a,e),s=a,(l=[{key:"bindExtra",value:function(){n.a.binder(this,"onInputAndroid","onInput","onInputSetText")}},{key:"onInputAndroid",value:function(e){if(e.target&&i.default.findParent(e.target,"item")===h.a.getStartElement()){var t=this.convertElementToText(e.target),a=j.default.getSelectOffsetsInElement(e.target),n=h.a.getStartIndex(),o=t.indexOf("\n");if(!this._hasDetectedEnterAndroid)if(o>=0)o===a.start&&(i.default.clearTimeoutOnce("androidInputSetText"),this.setDetectedEnterAndroid(),h.a.fireKeyEvent(void 0,{normCode:r.a.KeyCode.Enter}));else{var s=h.a.getStartItem();i.default.timeoutOnce("androidInputSetText",this.onInputSetText,0,s,t,n,a.start,a.end)}}}},{key:"onInput",value:function(e){if(h.a.isValid()){var t=h.a.getStartItem(),a=this.convertElementToText(e.target),n=j.default._getSelectionRange(),r=i.default.getElementParent(e.target),o=j.default.getSelectOffsetsInElement(r,n),s=h.a.getStartIndex();this.onInputSetText(t,a,s,o.start,o.end,e)}}},{key:"onInputSetText",value:function(e,t,a,n,s,l){if(!this._hasDetectedEnterAndroid){t=t.replace(new RegExp(r.a.TextSpace,"g"),"");var d=A.a.checkMultiplePrefixes(t);if(d!==t){var c=t.length-d.length;n-=c,s-=c,t=d}o.default.settings.showMarkdown.get()||(i.default.shouldLog(r.a.LogLevels.Edit)&&console.log("check end",n-2,t[n-2]),n===s&&n>2&&")"===t[n-2]&&H.a.isInsideMarkup(e,n-2,!1,"mdMarkupEnd")&&(t=t.substr(0,n-1)+" "+t.substr(n-1),n++,s++,i.default.shouldLog(r.a.LogLevels.Edit)&&console.log("spacing eend",n)),i.default.shouldLog(r.a.LogLevels.Edit)&&console.log("check start",n,t[n]),n===s&&"["===t[n]&&H.a.isInsideMarkup(e,n-1,!1,"mdMarkupStart")&&(t=t.substr(0,n)+" "+t.substr(n),i.default.shouldLog(r.a.LogLevels.Edit)&&console.log("spacing start",n))),this.isSettingText=!0,e.setText(t,!0,r.a.ChangeType.Local),t.length>0&&(u.a.ios?h.a.selectIndex(a,n,s):u.a.android||h.a.selectIndex(a,s)),this.isSettingText=!1,V.default.updateAutocomplete(l)}this._hasDetectedEnterAndroid=!1}},{key:"updateSelectionAndroid",value:function(e){if(u.a.isMobile&&u.a.android&&!this._hasDetectedEnterAndroid){var t=i.default.hasClass(e.target,"item")&&e.target.firstElementChild||i.default.hasClass(e.target,"androidInput")&&e.target;if(t){var a=h.a.getStartIndex(),n=j.default.getSelectOffsetsInElement(t);h.a.setSelection(a,n.start,a,n.end)}}}},{key:"keydown",value:function(e){if(e.handled)return!0;if(this.updateSelectionAndroid(e),i.default.tooltip.hideTip(),this.isWriteable&&0===this.numItems()&&this.canAddItem&&!i.default.hasClass(this.paneContent,"loading")&&r.a.KeyCodesModifiers.indexOf(e.normCode)<0&&r.a.KeyCodesArrows.indexOf(e.normCode)<0&&this.addItem(e),h.a.isValid()){this.getInfiniteList(!1).reMount(),u.a.isMobile||0!==this.numItems()||i.default.hasClass(this.paneContent,"loading")||this.addItem(e);try{V.default.keydown(this,e)||(i.default.preventDefault(e),i.default.stopPropagation(e))}catch(t){i.default.reportError(t,e)}}}},{key:"keypress",value:function(e){if(h.a.isValid()){u.a.isMobile&&u.a.android&&e.normCode===r.a.KeyCode.Enter&&this.setDetectedEnterAndroid();try{V.default.keypress(this,e)||(i.default.preventDefault(e),i.default.stopPropagation(e))}catch(t){i.default.reportError(t,e)}}}},{key:"keyup",value:function(e){if(i.default.vmMain.notifyActivity(),h.a.isValid())try{V.default.keyup(this,e)||(i.default.preventDefault(e),i.default.stopPropagation(e))}catch(t){i.default.reportError(t,e)}}}])&&q(s.prototype,l),d&&q(s,d),a}()}($),!0);var ee=t.a=$},function(e,t,a){"use strict";var i=a(0);function n(e){for(var t in i.default.Assert(e.id&&e.type&&e.sizeInPane,"Pane object missing properties"),e)e.hasOwnProperty(t)&&(this[t]=e[t])}n.prototype={},t.a=n},,,function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(2),s=a(4),l=a.n(s),u=a(13),d=a(15),c=a(28),h=a(47),f=a(34);function p(e){return(p="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return!t||"object"!==p(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,v(t).apply(this,arguments))}var a,s,p;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,u["a"]),a=t,(s=[{key:"init",value:function(){var e=this.props,t=e.item;e.renderLikePane&&!isNaN(e.paneObject.index)&&(this.styleProps=t.styleProps(e.paneObject,e.pane),this.metrics=e.pane.getMetricsForPaneObject(e.paneObject))}},{key:"onMount",value:function(){var e=this.props,t=e.item;this.listenTo(t.itemChanged),i.default.Assert(e.pane||!e.renderLikePane&&!e.padded,"Should not use these props if no pane"),this.props.editable&&(this._needsSelect=isNaN(e.selectIndex)?t.getParsedText().length:e.selectIndex,d.default.selectElement(this.getEditable(),this._needsSelect))}},{key:"getEditable",value:function(){return this.refs.editable}},{key:"getElement",value:function(){return this.refs.element.getElement()}},{key:"getState",value:function(){var e=this.props,t=e.pane,a=e.item,n={flags:a.flags,renderLikePane:e.renderLikePane&&!isNaN(e.paneObject.index),styleProps:this.styleProps,priorityProps:e.showPriority&&a.getPriorityProps(),isComplete:a.isComplete(),hasPrefix:a.hasPrefix(),date:a.getMooDate()};return e.allowDrag&&(n.draggedInPane=a.draggedInPane,n.isBeingDragged=a.draggedInPane.get()===t||o.a.isMobile&&t===i.default.focusedPane&&i.default.vmMain.dropBucket.hasItemEntry(a)),n.renderLikePane?(n.metrics=this.metrics,n.lines=n.metrics.styledLines):n.lines=[a.getStyledTextAsOneLine()],n}},{key:"focus",value:function(){var e=this.props.item.getParsedText().length;d.default.selectElement(this.getEditable(),e)}},{key:"onKeyDown",value:function(e){var t=this.props,a=t.item;e.keyCode===n.a.KeyCode.Backspace&&this.state.hasPrefix&&""===a.getParsedTextWithoutPrefix()&&a.setText("",!0,!1!==t.shouldSave?n.a.ChangeType.Local:n.a.ChangeType.Auto),t.onKeyDown&&t.onKeyDown(e)}},{key:"onKeyPress",value:function(e){var t=this.props;if(t.onKeyPress&&(t.onKeyPress(e),!e.defaultPrevented)){var a=this.props.item,i=d.default._getSelectionRange(),r=d.default.getSelectOffsetsInElement(e.target,i);if(this._needsSelect=void 0,r.start!==r.end){var o=a.getParsedText(),s=o.substr(0,r.start)+o.substr(r.end);a.setText(s,!0,!1!==t.shouldSave?n.a.ChangeType.Local:n.a.ChangeType.Auto),this._needsSelect=r.start}}}},{key:"componentDidUpdate",value:function(){if(!isNaN(this._needsSelect)){var e=this.getEditable(),t=e.innerHTML;(t.indexOf("<br")>=0||t.indexOf("></span>")>0||""===t)&&(e.innerHTML=this.getRenderedHtml()),d.default.selectElement(e,Math.min(e.textContent.length,this._needsSelect)),this._needsSelect=void 0}}},{key:"convertElementToText",value:function(e){var t="";if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=n.a.AttachChar;else for(var a=0,i=0;i<e.childNodes.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.convertElementToText(e.childNodes[i])}return t}},{key:"stopResizing",value:function(){this.isResizing=!1}},{key:"onInput",value:function(e){e.target.innerHTML.indexOf("<br")>=0&&(e.target.innerHTML=e.target.innerHTML.replace("<br/>","").replace("<br>",""));var t=this.props.item,a=this.convertElementToText(e.target).replace(new RegExp(n.a.TextSpace,"g"),""),i=d.default._getSelectionRange();if(i){var r=d.default.getSelectOffsetsInElement(e.target,i);this._needsSelect=r.start}t.setText(a,!0,n.a.ChangeType.Local),this.updateAutocomplete(),e.preventDefault()}},{key:"updateAutocomplete",value:function(){var e=this.getEditable(),t=this.props.autocompleteMode;if(t&&(!o.a.isMobile||"snooze"===t||"move"===t||"email"===t||"gmailLabel"===t||"item"===t)){var a=d.default.getSelectionInElement(e);o.a.isMobile&&!a&&(a={start:0,end:0}),a&&a.start===a.end&&c.a.update({mode:t,text:this.convertElementToText(e).replace(new RegExp(n.a.TextSpace,"g"),""),offset:a.start,owner:this,parsedEls:this.parsedEls,positionOffset:this.props.positionOffset,elementDisplay:e,elementInput:e,supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}}},{key:"onAutocompleteSelected",value:function(e){var t=this;void 0!==e.value&&(this.props.item.setText(e.value,!0,n.a.ChangeType.Local),d.default.selectElement(this.getEditable(),e.offset),setTimeout(function(){d.default.selectElement(t.getEditable(),e.offset)},0))}},{key:"onClick",value:function(e){if(!this.isResizing){var t=this.props;if(r.default.menus.isContextMenuOpen("ReactContextMenuContactDetails")&&r.default.menus.closeContextMenu("ReactContextMenuContactDetails"),t.editOnClick)e.preventDefault(),e.stopPropagation(),r.default.menus.isContextMenuOpen()&&r.default.menus.closeContextMenu(),r.default.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:e.target,item:t.item,pane:t.pane});else{var a=!0;if((t.editable||t.inItemDetails)&&t.pane&&(a=!r.default.pluginManager.handleTapClick(t.item,t.pane,e)),a&&!t.inItemDetails&&i.default.hasClass(e.target,"contact")){var o=e.target.textContent,s=f.a.findMatchExact(o[0]===n.a.ContactPrefix?o.substr(1):o);s&&r.default.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:e.target,contact:s})}}}}},{key:"onMouseDown",value:function(e){if(!o.a.isMobile&&e.button===n.a.ButtonCode.Left){var t=this.props,a=t.item,i=t.resizable;if(i){var r=this.getEditable().getBoundingClientRect(),s=Math.min(n.a.CalendarResizeHandleHeight,r.height/3);i=e.clientY-r.top<s?t.onItemResizeStart(a,this,!1):r.bottom-e.clientY<s&&t.onItemResizeStart(a,this,!0)}this.isResizing=i,!i&&t.allowDrag&&a.checkDragOnStart(e)}}},{key:"onMouseMove",value:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnMove(e,!1)}},{key:"onMouseUp",value:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnEnd(e)}},{key:"onClickDate",value:function(){r.default.menus.openContextMenu({componentName:"ReactContextMenuDate",element:this.getEditable(),item:this.props.item,pane:this.props.pane})}},{key:"onRightClick",value:function(e){var t=this.props;t.pane&&!1!==t.allowDrag&&(r.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"contextMenuItem"+this.props.item.id,element:e.target,item:this.props.item,pane:this.props.pane,pos:{left:e.clientX,top:e.clientY}}),e.preventDefault(),e.stopPropagation())}},{key:"getRenderedHtml",value:function(){for(var e,t=0,a=this.props,i=a.paneObject,o=this.props.item,s=this.state.lines,l="",u=0;u<s.length;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=a.renderLikePane?"padding-top: "+(0===u?r.default.DisplaySettings.paddingForItemTop(i,o)+"px":0)+"; padding-bottom: "+(u===s.length-1?(a.noNotes?r.default.DisplaySettings.paddingForItemTop(i,o):r.default.DisplaySettings.paddingForItemBottom(i,o))+"px":0)+";":"padding-top: 2px; padding-bottom: 2px",l+='<span class="line'+(u===s.length-1?" last":"")+'" style="'+e+'">'+(s[u]||n.a.TextSpace)+"</span>"}return l}},{key:"render",value:function(){var e=this.props,t=e.item,a=this.state,n=(a.lines,e.editable&&r.default.pluginManager.allowTextEditing(t)),s=i.default.classNames("reactItemWrapper flexbox",e.className,e.coloredInCalendar&&"colored"),u=i.default.classNames("item itemNotInPane f1",a.styleProps,a.priorityProps,{hasPrefix:a.hasPrefix},{"itemBeingDragged c-bg-light":a.isBeingDragged},{autoSelect:n},{complete:a.isComplete},{"c-bg-dark":a.isComplete&&e.coloredInCalendar}),d={};a.renderLikePane&&e.padding&&(d.paddingLeft=e.padding);var c,f=this.getRenderedHtml();if(e.style&&(d=i.default.extend(e.style,d)),e.coloredInCalendar&&!a.isBeingDragged){a.isComplete||(d.backgroundColor=t.getCalendarColor());var p=t.getCalendarDisplayProps();if(p)for(var g in p.style)p.hasOwnProperty(g)&&(i.default.Assert(!d[g],"Calendar display prop overwriting default styling"),d[g]=p.style[g])}if(this.state.date&&e.inItemDetails){var m=this.state.date,v=m.isRepeatDate(),y=m.toText(!0),_=i.default.classNames("itemTime c-date pointer");c=l.a.createElement("div",{className:_,style:{},onClick:this.onClickDate},m.getGCalId()&&l.a.createElement("i",{className:"icon-calendar"}),v&&l.a.createElement("i",{className:"icon-spinner"}),y)}return l.a.createElement(h.a,{"data-moo-id":this.getUniqueID(),className:s,ref:"element"},l.a.createElement("span",{className:u,style:d,contentEditable:n,onClick:e.editOnClick||n||e.inItemDetails?this.onClick:void 0,onKeyDown:n?this.onKeyDown:void 0,onKeyPress:n?this.onKeyPress:void 0,onInput:n?this.onInput:void 0,onMouseDown:o.a.isMobile||n?void 0:this.onMouseDown,onMouseMove:o.a.isMobile||n?void 0:this.onMouseMove,onMouseUp:o.a.isMobile||n?void 0:this.onMouseUp,onContextMenu:o.a.isMobile?void 0:this.onRightClick,tabIndex:e.tabIndex,dangerouslySetInnerHTML:{__html:f},ref:"editable"}),c)}}])&&g(a.prototype,s),p&&g(a,p),t}();t.a=_},function(e,t,a){"use strict";var i=a(1),n=a(22);function r(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,o;return t=e,(a=[{key:"run",value:function(e,t){var a=t.query,i=t.body;return this.createURL(e,a).then(function(t){var a=i?{method:"POST",body:JSON.stringify(i)}:void 0;return fetch(t,a).then(function(t){return 200===t.status?t.json().then(function(t){return console.log(e,t),{value:t,errorCode:void 0,error:void 0}}):(console.log(t.statusText),t.json().then(function(e){return console.log(e),{value:void 0,errorCode:t.status,error:e}}))})})}},{key:"createURL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.a.user.getIdToken().then(function(a){t.id_token=a;var n=i.a.CloudFunctionsURL+e+"?",r=[];for(var o in t)t.hasOwnProperty(o)&&t[o]&&r.push(o+"="+encodeURIComponent(t[o]));return n+r.join("&")})}},{key:"sendFeedback",value:function(e){return this.run("sendFeedback",{body:e})}},{key:"setUserProperties",value:function(e){return this.run("setUserProperties",{body:e})}}])&&r(t.prototype,a),o&&r(t,o),e}();t.a=new o},function(e,t,a){"use strict";function i(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._limit=t,this._offset=0,this._buffer=[]}var t,a,n;return t=e,(a=[{key:"get",value:function(e){return this._buffer[e]}},{key:"push",value:function(e){this._buffer[this._offset]=e,this._offset=(this._limit+this._offset+1)%this._limit}},{key:"peek",value:function(){var e=(this._limit+this._offset-1)%this._limit;return this._buffer[e]}},{key:"pop",value:function(){var e=(this._limit+this._offset-1)%this._limit,t=this._buffer[e];return t&&(this._buffer[e]=void 0,this._offset=e),t}},{key:"hasData",value:function(){return!!this.peek()}},{key:"reset",value:function(){this._offset=0,this._buffer=[]}},{key:"buffer",value:function(){return this._buffer}},{key:"limit",value:function(e){this._limit=e}},{key:"ordered",value:function(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))}},{key:"entries",value:function(){for(var e=0,t=this.ordered(),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;console.log("---- Entry ["+a+"] ----"),console.log(t[a])}}}])&&i(t.prototype,a),n&&i(t,n),e}();t.a=n},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(6),o=a(12),s=a(31);function l(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,u;return t=e,(a=[{key:"_setSectionValue",value:function(e,t,a){e.hasOwnProperty(t)||(e[t]=a)}},{key:"_parseSection",value:function(e,t){for(var a=0,n={},r=t;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e[r];if(o){var s=o.indexOf(":"),l=[o.substr(0,s),o.substr(s+1)],u=l[0].split(";");switch(u[0]){case"BEGIN":var d=this._parseSection(e,r+1);r+=d.size,n[l[1]]=d.section;break;case"END":return{section:n,size:r-t+1};default:if(u.length>1){for(var c=0,h={value:l[1]},f=1;f<u.length;++f){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var p=u[f].split("=");i.default.Assert(!h.hasOwnProperty(p[0]),"Should never overwrite line values"),h[p[0]]=p[1]}this._setSectionValue(n,u[0],h)}else this._setSectionValue(n,u[0],l[1]);break;case void 0:case null:i.default.Assert(!1,"Invalid ICS format: "+o)}}}return n}},{key:"parseICS",value:function(e){for(var t=0,a=e.split("\n"),i=[],n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[n];r.startsWith(" ")?i[i.length-1]+=r.trim():i.push(r.trim())}return this._parseSection(i,0)}},{key:"parseHead",value:function(e){for(var t=0,a={},i=0;i<e.childElementCount;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.children[i],r=n.nodeName;if(n.firstChild){var o=n.firstChild.textContent;a[r]=o}}return a}},{key:"parseOPML",value:function(e,t){var a=function(e,r){var s,l=!0;switch(e.nodeName){case"#document":case"body":case"opml":break;case"head":l=!1;this.parseHead(e);break;case"outline":r||t&&(r=t);var u=e.attributes.text,d=u?u.value:"",c=e.attributes.complete||e.attributes._complete,h=!(!c||"true"!==c.value),f=e.attributes.note||e.attributes._note||e.attributes.Notes,p={text:i.default.stripFormattingTags(d).replace(/[\r\n\t]/g," "),isComplete:h};if(s=o.a.createVMLI(p,{parent:r,changeType:n.a.ChangeType.AllLocal}),r.insertItem(s),f){var g={text:f.value,isNote:!0},m=o.a.createVMLI(g,{parent:s,changeType:n.a.ChangeType.AllLocal});s.setNote(m,n.a.ChangeType.AllLocal)}break;default:i.default.log("Unknown OPML Node: ",e)}if(l)for(var v=0,y=0;y<e.childElementCount;++y){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;a(e.children[y],s)}return s}.bind(this);return r.e.beginAction(),a(e),r.e.endAction(),!0}},{key:"parseJSON",value:function(e,t,a){var l={},u={},d={},c=function(e){var a=s.a.itemIn(e);if(a.parent){var i=l[a.id];if(i||(i=o.a.generateID(),l[a.id]=i),a.id=i,a.note){var r=o.a.generateID();l[a.note]=r,d[i]=r,delete a.note}a.parent=l[a.parent];var c=a.parent&&o.a.getItem(a.parent)||t.getRootItem(),h=o.a.createVMLI(a,{parent:c,changeType:n.a.ChangeType.AllLocal,documentOwner:t});h.isNote()?c.setNote(h,n.a.ChangeType.AllLocal):c.insertSorted(h,h.sortComparatorIndex),u[i]=h}},h=function e(t,i){var r=i||a,s={text:t.text,dateCompleted:t.dateCompleted,dateFormat:t.dateFormat,priority:t.priority,isComplete:t.isComplete,isStarred:t.isStarred},l=o.a.createVMLI(s,{parent:r,changeType:n.a.ChangeType.AllLocal});if(r.insertItem(l),t.note){var u={text:t.note.text,isNote:!0},d=o.a.createVMLI(u,{parent:l,changeType:n.a.ChangeType.AllLocal});l.setNote(d,n.a.ChangeType.AllLocal)}if(t.items)for(var c=0,h=0;h<t.items.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;e(t.items[h],l)}};if(void 0===e.moodoVer||void 0===e.moodoRoot&&void 0===e.items){if(void 0!==e.text&&void 0!==e.items)try{return r.e.beginAction(),c(e),r.e.endAction(),!0}catch(m){}}else try{i.default.parseInt(e.moodoVer),r.e.beginAction();var f=e.items||e.moodoRoot&&e.moodoRoot.items;if(f)for(var p=0,g=0;g<f.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;e.doc?c(f[g]):h(f[g])}return r.e.endAction(),!0}catch(m){i.default.reportError(m)}return!1}},{key:"_findLineParent",value:function(e,t,a){for(var i,n=0,r=Math.min(e.length-1,t-1);r>=0;--r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e[r];if(o&&o.indentLevel===a-1){i=o;break}}return i}},{key:"parseText",value:function(e){for(var t=0,a={items:[]},i=[],n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._parseTextLine(e[n]);if(r){i.push(r);var o=this._findLineParent(i,n,r.indentLevel)||a;r.parent=o,o.items.push(r)}}return a}},{key:"_parseTextLine",value:function(e){if(e&&e.length>0)return{indentLevel:Math.floor(e.search(/\S|$/)/4),text:i.default.trimString(e.replace(/[\ud800-\udfff]+/g,"")),items:[]}}},{key:"_addMulti",value:function(e,t,a){return e[t]||(e[t]=a),e[t]}},{key:"_getReference",value:function(e,t){var a;return"Evernote"!==t.type&&(a=e[t.value]),a}},{key:"_hasReference",value:function(e,t){var a=!0;return"Evernote"!==t.type&&(a=!!e[t.value]),a}},{key:"_lookupNode",value:function(e,t){return e[i.default.hashString(t)]}},{key:"_storeNode",value:function(e,t,a){e[i.default.hashString(t)]=a}},{key:"_beginImport",value:function(e){this._reportedImportError=!1,this._rawImportData=e}},{key:"_endImport",value:function(){this._reportedImportError=!1,this._rawImportData=void 0}},{key:"_reportRecursiveImport",value:function(){this._reportRecursiveImport||i.default.reportError(new Error("Recursive import failure"),this._rawImportData)}},{key:"_parseEntries",value:function(e){var t=[];if(e){for(var a=0,i=0,n=e.split(", "),r=["Organization","Contact","Prospect","Email","Evernote","Project","Sub-Project","Subtask","Action"],o=[],s=n.length-1;s>=0;s--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=n[s],u=/^([^:]*):\s(.*)/.exec(l);(!u||!u[1]||r.indexOf(u[1])<0)&&s>0?(n[s-1]+=", "+n[s],n.removeAt(s)):o.push(l)}for(s=0;s<o.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var d=o[s],c=d.indexOf(":");if(c>0){var h=d.substr(0,c),f=d.substr(c+2);t.push({type:h,value:f})}}}return t}},{key:"stripParents",value:function(e){if(e.parent=void 0,e.items)for(var t=0,a=0;a<e.items.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.stripParents(e.items[a])}}},{key:"parseClassName",value:function(e,t){if(e)return e.indexOf("high")>=0?t.priority=n.a.VMLIFlag.P0:e.indexOf("medium")>=0?t.priority=n.a.VMLIFlag.P1:e.indexOf("low")>=0&&(t.priority=n.a.VMLIFlag.P2),e.indexOf("complete")>=0&&(t.isComplete=!0),e.indexOf("starred")>=0&&(t.isStarred=!0),e.indexOf("note")>=0&&(t.isNote=!0),t}},{key:"traverseDOM",value:function(e){var t,a=0,n=e.root,r=e.stripParents,o=e.shouldPrint,s=e.preserveWhitespace,l=n.firstChild,u={items:[]},d={text:"",parent:u};u.items.push(d);var c,h,f,p,g=!1,m=!1,v=this;function y(e){var a=e;if(e.nodeType===Node.TEXT_NODE){(m||g)&&(s||(d.text=d.text.replace(/^ +/g,"").replace(/ +$/g,"")),""!==d.text&&(t={text:"",parent:d.parent,date:h},v.parseClassName(c,t),i.default.hasClass(e.parentNode,"note")?(t.isNote=!0,d._note=t):d.parent.items.push(t),d=t)),m=!1,g=!1;var n=e.nodeValue.replace(/[\ud800-\udfff]+/g,"");""===d.text&&(n=s?n.replace(/^[\r\n\t]+/g,""):n.replace(/^[ \r\n\t]+/g,"")),v.parseClassName(c,d),h&&(d.date=h),d.text+=i.default.stripFormattingTags(n)}else e.nodeType===Node.COMMENT_NODE||("BR"===a.tagName||"P"===a.tagName||"LI"===a.tagName||"DIV"===a.tagName?(g=!0,c=a.className,h=a.getAttribute("data-date")):"A"===a.tagName?d.text+="[":"UL"!==a.tagName&&"OL"!==a.tagName||(d.text=d.text.replace(/^ +/g,"").replace(/ +$/g,""),t={text:"",parent:d,date:h},v.parseClassName(c,t),d.items?d.items.push(t):d.items=[t],d=t,g=!1,c="",h=void 0))}function _(e){e.nodeType!==Node.TEXT_NODE&&("UL"===e.tagName||"OL"===e.tagName?(d=d.parent,m=!0):"DIV"===e.tagName||"P"===e.tagName?(g=!0,c=""):"A"===e.tagName&&(d.text+="]("+e.getAttribute("href")+")"))}do{if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(y(l),"note"===l.className?(p=l,d.text=p.innerHTML,d.parent._note=d,d.isNote=!0,d={text:"",parent:d.parent},m=!0,g=!0,f=void 0):f=l.firstChild,f)l=f;else if(f=l.nextSibling)l=f;else{var b=0;do{if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;(f=l.parentNode.nextSibling)?(_(l.parentNode),l=f):_(l=l.parentNode)}while(!f&&l&&l.parentNode);if(!f)break}}while(l);return r&&this.stripParents(u),o&&function e(t,a){var i=0;isNaN(a)&&(a=0);for(var n="",r=0;r<a;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n+="--"}if(a&&console.log(n,t.text),t.items){var o=0;for(r=0;r<t.items.length;r++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e(t.items[r],a+1)}}}(u),u.items[u.items.length-1].text||u.items.splice(u.items.length-1,1),u}}])&&l(t.prototype,a),u&&l(t,u),e}();t.a=new u},,function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(1),r=a(3),o=a(2),s=a(6),l=a(11),u=a(27),d=a(7),c=a(5),h=a(14);function f(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.dragItem=void 0,this.draggingItems=[],this.position=void 0,this.isVisible=new d.a(!1),this.isInDrag=new d.a(!1),this.transform=new d.a({left:0,top:0}),this.linePosition=new d.a,this.isDraggingPane=new d.a(!1),this.draggingToOutline=new d.a,this.dragTargetHovered=new d.a,l.a.binder(this,"handleEscapeKey"),i.default.dragDrop=this}var t,a,p;return t=e,(a=[{key:"stop",value:function(){var e=0;this.__hotkeyEscape&&(u.a.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0),this.activePane&&!this.activePane.isDestroyed()?this.activePane.notifyDragEnd():r.default.PaneManager.runForEachPane(function(e){e.notifyDragEnd()});for(var t=this.draggingItems,a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t[a].item.draggedInPane.set(!1)}this.draggingItems=[],this.isDragging=!1,this.dragItem=void 0,this.position=void 0,this.externalData=void 0}},{key:"finish",value:function(){this.isVisible.set(!1),this.isInDrag.set(!1),this.blockTarget=void 0,h.a.fireEvent("endDrag",[])}},{key:"start",value:function(e,t,a,r,o,l,d,h){var f=0;this.isDragging&&(this.stop(),this.finish()),this.__hotkeyEscape=u.a.pushStackEscape(this.handleEscapeKey),i.default.setItemAnimationMode(n.a.ItemAnimationMode.None),this.isDragging=!0,this.activePane=o,this.dragInfo=null,this.startPane=o,this.startInfo=l,this.dataTransfer=d,this.dragItem=e,this.startDragitem=e,this.fromOverview=h,this.externalData=void 0,this.draggingItems=t,this.position={left:a,top:r},this.transform.set({left:0,top:0},!1),c.a.reset();for(var p=0;p<t.length;++p){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;t[p].item.draggedInPane.set(i.default.focusedPane)}this.isInDrag.set(!0),this.isVisible.set(!0),this.activePane.notifyDragStart(),s.e.miscAction({type:s.c.Misc,misc:s.a.DragItem,data:{itemID:e.id,fromPane:o}})}},{key:"startExternal",value:function(e){this.isDragging=!0,this.activePane=e,this.startPane=e,this.draggingItems=[],this.isVisible.set(!0),this.isInDrag.set(!0),this.activePane.notifyDragStart()}},{key:"setExternalData",value:function(e){this.externalData=e}},{key:"setTransform",value:function(e,t){this.isVisible.set(!0,!1),this.isInDrag.set(!0,!1),this.transform.set({left:e,top:t})}},{key:"handleDragOver",value:function(e){var t=i.default.elementFromPoint(e.clientX,e.clientY),a=i.default.getPaneForElement(t);if(this.activePane&&a!==this.activePane&&this.revertDrag(),o.a.isMobile){var n=i.default.findParent(t,"dragTarget",3);n&&(n=n.id),this.dragTargetHovered.set(n)}if(i.default.vmMain.checkDragForScroll(e),a){this.isDragging||this.startExternal(a),this.activePane=a;var r=!!i.default.findParent(t,"paneOverviewWrapper");a.canAcceptDragOver(e.dataTransfer.pane,e.item,t,r)?this.dragInfo=a.handleDragOver(e.dataTransfer.pane,e.item,t,e.clientX,e.clientY):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||i.default.cancelRepeatScroll(),!1}},{key:"revertDrag",value:function(){this.dragInfo=null,this.activePane.revertDrag()}},{key:"handleDropItem",value:function(e,t,a){var s,l=e,u=this.activePane;this.isDropping=!0,i.default.cancelRepeatScroll();var d=o.a.isMobile?document.elementFromPoint(t.clientX,t.clientY):t.target;return d&&i.default.findParent(d,"mobileDropBucket")?(i.default.vmMain.dropBucket.addItemEntry(e,u),this.dragTargetHovered.set(void 0),s=l):o.a.isMobile&&d&&i.default.findParent(d,"mobileDragToOutline")?(this.draggingToOutline.set({item:e,pane:this.activePane}),i.default.vmMain.switchPaneMobile(n.a.PaneMode.Task,n.a.TaskViewMode.Outline,!0),this.dragTargetHovered.set(void 0),s=l):this.dragInfo&&u&&(r.default.PaneUpdateBatcher.beginUpdateItems(),this.startInfo&&0===this.startInfo.items[0].index&&this.startPane.setIgnoreRestoreScroll(),u.handleDragDrop(e,t,this.dragInfo,a),r.default.PaneUpdateBatcher.commitUpdateItems(),s=l),this.isDropping=!1,s}},{key:"handleDrop",value:function(e){var t=this,a=this.activePane;if(a&&(i.default.elementInPane(e.target)||e.fromDropBucket)){var o=e.dataTransfer.item;return this.isDragging=!1,this.isVisible.set(!1),o?(this.handleDropItem(o,e),!0):r.default.pluginManager.handleDropEvent(e,function(i,r){s.e.beginAction();var o=a.createVMLI({text:i},{changeType:n.a.ChangeType.AllLocal,noParentOkay:!0});return o=t.handleDropItem(o,e,r),s.e.endAction(),!!o})}i.default.isNonPaneDropTarget(e.target)&&e.dataTransfer.item&&this.handleDropItem(e.dataTransfer.item,e),this.isInDrag.set(!1),i.default.resetItemAnimationMode(),e.stopPropagation(),e.preventDefault()}},{key:"handleDragLeave",value:function(e){e.clientX||e.clientY||(this.isDragging=!1,this.isVisible.set(!1),this.isInDrag.set(!1))}},{key:"setBlockTarget",value:function(e){this.blockTarget=e}},{key:"stopDraggingToOutline",value:function(){var e=this.draggingToOutline.get();e&&e.pane&&setTimeout(function(){i.default.vmMain.switchPaneMobile(e.pane.type,n.a.TaskViewMode.Outline,!0)},300),this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}},{key:"handleEscapeKey",value:function(){this.escapedDragging=!0,this.dragItem.dragEnd()}}])&&f(t.prototype,a),p&&f(t,p),e}(),g=a(15);function m(e){return(m="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,a){return(y="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var i=function(e,t){var a=0;for(;!Object.prototype.hasOwnProperty.call(e,t);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(null===(e=_(e)))break}return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var w=function(e){function t(){var e,a,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,e=!(i=_(t).call(this))||"object"!==m(i)&&"function"!==typeof i?k(a):i,window.addEventListener("dragover",e.handleDragOver.bind(k(k(e)))),window.addEventListener("dragleave",e.handleDragLeave.bind(k(k(e)))),window.addEventListener("drop",e.handleDrop.bind(k(k(e)))),e}var r,l,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,p),r=t,(l=[{key:"handleDrop",value:function(e){if(!y(_(t.prototype),"handleDrop",this).call(this,e)){var r=this.activePane;if(e.dataTransfer.getData(o.a.ie?"Text":"text/plain")||e.dataTransfer.getData("text/html")){var l=g.default.getCursorSelectionRange(e);i.default.Assert(l,"Range should always be properly set"),c.a.setFocusedPane(r),s.e.beginAction();var u=r.createVMLI({text:""},{changeType:n.a.ChangeType.AllLocal,noParentOkay:!0});return u=this.handleDropItem(u,e,!0),c.a.selectItem(u,0),a(91).default.insert(e.dataTransfer,e,n.a.DataSource.Drop),s.e.endAction(),!0}if(this.externalData){var d=this.externalData;this.externalData=void 0;var h=d.split(":"),f=(h.removeAt(0),"["+h.removeAt(0)+"]("+h.join(":")+")");s.e.beginAction();u=r.createVMLI({text:f},{changeType:n.a.ChangeType.AllLocal});return u=this.handleDropItem(u,e,!0),s.e.endAction(),!0}}}},{key:"handleDropItem",value:function(e,a,n){var r=y(_(t.prototype),"handleDropItem",this).call(this,e,a,n);if(!r&&i.default.isNonPaneDropTarget(a.target)){var o,s=a.dataTransfer.pane;if(s&&(o=s.notifyDropFromToEdit(e,a.target),i.default.Assert(!o||i.default.isDOMNode(o),"Must always return DOM elements to insert")),o){var l=g.default._getCursorSelectionRange(a.clientX,a.clientY);g.default.setSelectionRange(l),g.default.insertNode(o)}}return r}}])&&v(r.prototype,l),u&&v(r,u),t}();t.default=w},function(e,t,a){"use strict";var i,n=a(0),r=a(1),o=a(3),s=a(2),l=a(83),u=a(71),d=a(12),c=a(16),h=a(26),f=a(22);function p(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var m=10*r.a.MSPerMinute,v=(g((i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,i;return t=e,(a=[{key:"init",value:function(){this.timeoutCheckBackup=0,o.default.settings.backupFrequency.listen(this.onTimeChanged),o.default.settings.needsBackup.get()&&h.a.onLoaded(this.checkBackup)}},{key:"setNeedsBackup",value:function(e){o.default.settings.needsBackup.set(e)}},{key:"setLastBackup",value:function(e){o.default.settings.lastBackup.set(e)}},{key:"onTimeChanged",value:function(){this.setNeedsBackup(!1),this.timeoutCheckBackup&&clearTimeout(this.timeoutCheckBackup)}},{key:"onDataSaved",value:function(){!o.default.settings.needsBackup.get()&&o.default.settings.backupFrequency.get()>0&&(n.default.log("Scheduling backup in",o.default.settings.backupFrequency.get()/1e3,"seconds"),s.a.isMobile||(this.timeoutCheckBackup=setTimeout(this.checkBackup,o.default.settings.backupFrequency.get())),this.setNeedsBackup(!0)),!this.timeoutCheckBackupLocal&&s.a.isNativeApp()&&(this.timeoutCheckBackupLocal=setTimeout(this.checkBackupLocal,m))}},{key:"checkBackupLocal",value:function(){this.timeoutCheckBackupLocal=void 0,this.backupLocal()}},{key:"checkBackup",value:function(){if(o.default.settings.needsBackup.get()&&o.default.settings.backupFrequency.get()>0){var e=o.default.settings.lastBackup.get();if(!isNaN(e)&&Date.now()-e>o.default.settings.backupFrequency.get())return this.backup(),!0;if(!s.a.isMobile){var t=isNaN(e)?o.default.settings.backupFrequency.get():e+o.default.settings.backupFrequency.get()-Date.now();this.timeoutCheckBackup=setTimeout(this.checkBackup,t)}}}},{key:"backup",value:function(e){var t=this;clearTimeout(this.timeoutCheckBackup);var a=d.a.getDocumentsArray();Promise.all(a.map(this.backupDocument)).then(function(){n.default.log("Backup complete",Date.now()),t.setLastBackup(Date.now()),t.setNeedsBackup(!1),e&&e()})}},{key:"backupLocal",value:function(){s.a.isNativeApp()&&(clearTimeout(this.timeoutCheckBackupLocal),d.a.getDocumentsArray().forEach(this.backupDocumentLocal))}},{key:"backupDocumentLocal",value:function(e){s.a.isNativeApp()&&e.toJSON({exportArchived:!0,includeNotes:!0,encrypt:!1}).then(function(t){var a=(new Date).toString("yy-MM-dd h-mm tt"),i=e.text.get()+" "+a+".json";o.default.ElectronBridge.saveFile("backups/".concat(i),t,function(e){1!==+e&&n.default.reportError("Backup error",e)})})}},{key:"backupDocument",value:function(e){return e.toJSON({exportArchived:!0,includeNotes:!0,encrypt:o.default.settings.encryptBackup.get()}).then(function(t){var a=new Blob([t],{type:"application/json"}),i=(new Date).toString("yy/MM/dd h:mm tt");return a.name=e.text.get()+" "+i,new Promise(function(t){new l.a(a,"me",r.a.DriveFolder.Backup,{docId:e.id},function(){},function(){t()},function(e){n.default.log("on error",e)}).upload()})})}},{key:"downloadBackup",value:function(e,t){n.default.vmMain.remoteAPI().driveFilesGet(e,function(e){t(e)},function(e){t()},{props:{alt:"media"}})}},{key:"getBackup",value:function(e,t,a){var i=function(){var i="'".concat(a,"' in parents and properties has {key='docId' and value='").concat(e,"' and visibility='PRIVATE'} and trashed=false");n.default.vmMain.remoteAPI().driveFilesList(i,function(e){t(e)},function(e){t()},{getAllPages:!0,maxResults:30,props:{orderBy:"createdDate desc"}})};a?i():u.a.getFolder(r.a.DriveFolder.Backup,function(e){a=e,i()})}},{key:"getBackups",value:function(e){var t=this,a=d.a.getDocumentsArray().map(function(e){return{id:e.id,text:e.text.get(),backups:[]}});u.a.getFolder(r.a.DriveFolder.Backup,function(i){Promise.all(a.map(function(e){return new Promise(function(a){t.getBackup(e.id,function(t){e.backups=t,a()},i)})})).then(function(){return e(a)})})}},{key:"isDriveBackupAuthorized",value:function(){return h.a.isAuthorizedForScopes(f.a.getDefaultAccountID(),[r.a.GScope.Drive])}},{key:"authorize",value:function(e){h.a.authAccount(f.a.getDefaultAccountID(),[r.a.GScope.Drive],function(t){e(t)})}},{key:"enable",value:function(){var e=this;this.authorize(function(t){t&&(o.default.settings.backupFrequency.set(r.a.DefaultBackupFrequency),e.backup())})}}])&&p(t.prototype,a),i&&p(t,i),e}()).prototype,"onTimeChanged",[c.a],Object.getOwnPropertyDescriptor(i.prototype,"onTimeChanged"),i.prototype),g(i.prototype,"checkBackupLocal",[c.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupLocal"),i.prototype),g(i.prototype,"checkBackup",[c.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackup"),i.prototype),g(i.prototype,"backupDocumentLocal",[c.a],Object.getOwnPropertyDescriptor(i.prototype,"backupDocumentLocal"),i.prototype),g(i.prototype,"backupDocument",[c.a],Object.getOwnPropertyDescriptor(i.prototype,"backupDocument"),i.prototype),i);t.a=new v},,function(e,t,a){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],i=!0,n=!1,r=void 0;try{for(var o,s=0,l=e[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(a.push(o.value),t&&a.length===t)break}}catch(u){n=!0,r=u}finally{try{i||null==l.return||l.return()}finally{if(n)throw r}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}a.d(t,"a",function(){return l});var n=function(e){var t=0;if(!isFinite(e))return 0;for(var a=1,i=0;Math.round(e*a)/a!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a*=10,i++}return i},r=function(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a},o=function(e,t){return(r(e,t)+"").split("").reverse()[0]},s=function(e,t){for(var a=0,i=n(e),s=n(t),l=Math.min(i,s),u=Math.max(i,s),d=r((e+t)/2,u+1),c=l,h=100;(o(e,c)===o(d,c)||o(d,c)===o(t,c))&&h>0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;c++,h--}return r(d,c)},l=function(e){var t=i(e,2),a=t[0],n=t[1],r=0;return"number"===typeof a&&"number"===typeof n?r=s(a,n):"number"===typeof a?r=a+1:"number"===typeof n&&(r=n-1),r}},function(e,t,a){"use strict";var i=a(1),n=a(0),r=a(3),o=a(19);function s(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.FOLDER_MIMETYPE="application/vnd.google-apps.folder",this.folders={root:{title:"_Moo.do Files (Do not delete)",id:void 0,prop:"MooDoDefaultRoot",setting:"rootFolderId"},attach:{title:"Shared Attachments",id:void 0,prop:"MooDoDefaultAttach",setting:"attachFolderId"},backup:{title:"Moo.do Backups",id:void 0,prop:"MooDoDefaultBackup",setting:"backupFolderId"}}}var t,a,l;return t=e,(a=[{key:"createFolderStructure",value:function(e,t){var a=this.folders[e];n.default.Assert(!n.default.isDemoMode(),"Should not be creating "+e+"folder in demo mode"),n.default.Assert(void 0===a.id,"Must not already have a "+e+"folder"),"root"!==e&&n.default.Assert(this.folders.root.id,"Must have already created and found the root folder"),n.default.Assert(t,"Must supply a valid callback when done creating the "+e+" file structure");var r=o.a.fns("drive").files.insert.packedFn,s={resource:{mimeType:this.FOLDER_MIMETYPE,title:a.title,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:a.prop,value:"TRUE",visibility:"PRIVATE"}]}};"root"!==e&&(s.resource.parents=[{id:this.folders.root.id}]);n.default.vmMain.remoteAPI().runRemoteSingleRequest(r,s,function(a){return n.default.shouldLog(i.a.LogLevels.Folders)&&n.default.log("Successfully created "+e+" folder",a),t(a.id)},function(a){return n.default.shouldLog(i.a.LogLevels.Folders)&&n.default.log("Error creating "+e+" folder",a),t()})}},{key:"getFolder",value:function(e,t){var a=this,o=this.folders[e];if(n.default.Assert(o,"Trying to get invalid folder"),n.default.Assert(!n.default.isDemoMode(),"Should not be creating file structure in demo mode"),n.default.Assert(t,"Must provide a valid callback when getting the root folder"),o.id)return t(o.id);var s=function(){var s=r.default.settings[o.setting].get(),l=function(){a.createFolderStructure(e,function(e){return e?(o.id=e,r.default.settings[o.setting].set(e),t(e)):t()})};if(s){n.default.vmMain.remoteAPI().driveFilesGet(s,function(e){if(e)return o.id=s,t(s);l()},function(e){if(r.default.settings[o.setting].set(void 0),!e||!e.error||404!==e.error.code)return t();l()})}else{var u="properties has {key='"+o.prop+"' and value='TRUE' and visibility='PRIVATE'} and 'me' in owners and trashed=false";n.default.vmMain.remoteAPI().driveFilesList(u,function(e){if(e.length>0)return n.default.Assert(1===e.length,"Must have a single root folder present"),n.default.shouldLog(i.a.LogLevels.Folders)&&n.default.log("Successfully found root folder",e),o.id=e[0].id,r.default.settings[o.setting].set(o.id),t(o.id);l()},function(e){return n.default.shouldLog(i.a.LogLevels.Folders)&&n.default.log("Error getting root folder",e),t()},{getAllPages:!0})}};"root"!==e?this.getFolder("root",s):s()}},{key:"getAttachFolder",value:function(e){return this.getFolder(i.a.DriveFolder.Attach,e)}},{key:"getRootFolder",value:function(e){return this.getFolder(i.a.DriveFolder.Root,e)}},{key:"getBackupFolder",value:function(e){return this.getFolder(i.a.DriveFolder.Backup,e)}}])&&s(t.prototype,a),l&&s(t,l),e}();t.a=new l},function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(11),r=a(1),o=a(3),s=a(75),l=a.n(s),u=a(2),d=a(34),c=a(12);function h(e){return(h="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f={pendingRemoteUpdates:{},itemCache:{},dbDataCache:{},loadedItemCount:0,hasLocalData:!1,freezeUpdates:!1,hasMadeInMemoryOnlyUpdate:!1,dbClosed:!1,overQuota:!1,dbi:void 0};function p(e,t){var a=i.default.fieldMapValidators[e];return a&&a(t)||void 0===t||null===t}f.forEachModel=function(e){for(var t in i.default.Assert(e,"Must pass a valid function to iterate on"),f.itemCache)f.itemCache[t]&&e(f.itemCache[t])},f.getModel=function(e){return i.default.Assert(i.default.isString(e),function(){return"ID must be a valid string: "+i.default.getObjectInfo(e)}),i.default.Assert(e,"Tried to get a model with an invalid id"),f.itemCache[e]},f.setModel=function(e){i.default.Assert(e,"Tried to set an invalid model"),i.default.Assert(e.id,"Tried to set a model with an invalid id"),i.default.Assert(i.default.isString(e.id),function(){return"ID must be a valid string: "+i.default.getObjectInfo(e.id)}),i.default.Assert(void 0===f.itemCache[e.id],"Must not be replacing a model with another copy"),f.itemCache[e.id]=e},f.clearModel=function(e){i.default.Assert(i.default.isString(e),function(){return i.default.getObjectInfo(e)}),i.default.Assert(void 0!==f.itemCache[e],"Must not clear a model that does not exist"),f.itemCache[e]=void 0},f.getItem=function(e){return i.default.Assert(i.default.isString(e),function(){return"ID must be a valid string:"+i.default.getObjectInfo(e)}),i.default.Assert(e,"Tried to get an item that doesn't exist"),f.dbDataCache[e]},f.setItem=function(e,t){i.default.Assert(i.default.isString(e),function(){return"ID must be a valid string: "+i.default.getObjectInfo(e)}),i.default.Assert(e,"Tried to set an item with an invalid id"),i.default.Assert(void 0===f.dbDataCache[e]||void 0===t,"Must not be replacing an item with another copy"),f.dbDataCache[e]=t},f.validateItemData=function(e){try{for(var t in e){var a=p(t,e[t])||!1;i.default.Assert(a,"Invalid data set in item: ",t,"=",e[t],h(e[t])),a||f.fixItemData(e,t)}}catch(n){f.reportError(n)}},f.fixItemData=function(e,t){var a=!1,n=i.default.fieldMapFixer[t];if(n){var r=n(e[t]);i.default.log("Value Fixed: ",e[t],"->",r),e[t]=r,i.default.Assert(p(t,r),"Fixed field must always be valid"),a=!0}return a},f.clearItems=function(){f.dbDataCache={},f.itemCache={}},f.clearPlugins=function(){o.default.pluginManager.onClearData()},f.getRootItem=function(){return f.rootId?f.getItem(f.rootId):void 0},f.getRootModel=function(){return f.rootId?f.getModel(f.rootId):void 0},f.createVMLI=function(e,t){return o.default.itemStoreManager.getDefaultItemStore().createItemRaw(e,t)},f.createTempVMLI=function(e,t){return t.noSave=!0,t.canDestroy=!0,o.default.itemStoreManager.getTempItemStore().createItemRaw(e,t)},f.destroyTempVMLI=function(e){o.default.itemStoreManager.getTempItemStore().destroyItem(e)},f.initializeIndexedDB=function(e){var t=3;function a(a){a&&l.a?l.a.open({server:"duchess",version:t,schema:{items:{key:{keyPath:"id"}},settings:{},caches:{key:{keyPath:"cid"}}}}).done(function(t){f.dbi=t;try{t.handleDisconnect(function(e){i.default.log("DB Disconnect Event: ",e)})}catch(n){i.default.reportError(n)}for(var a=0;a<g.length;++a)g[a](!0);g=[],e()}).fail(function(t){try{i.default.log("Error loading local DB client - "+t.target.error.name+": "+t.target.error.message)}catch(a){i.default.log("Error loading local DB client - Invalid Error Message")}i.default.preventLocalWrites(r.a.LocalWriteReason.Generic),"Firefox"===u.a.browser?t.target&&t.target.error&&"InvalidStateError"===t.target.error.name||i.default.reportError(new Error("DB Load Failure"),t):"Safari"===u.a.browser&&t.target&&t.target.error&&"DBOpenError"===t.target.error.name||i.default.reportError(new Error("DB Load Failure"),t),"VersionError"===t.target.error.name&&(n.a.hasURLParam("versionError")||i.default.AppCache.runOnFinish(function(){n.a.insertURLParam("versionError",!0)},!0)),e()}):(i.default.preventLocalWrites(r.a.LocalWriteReason.Generic),e())}window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?window.indexedDB.onIsReady(a):setTimeout(function(){a(!0)},0)},f.getDBState=function(e){e.dbClosedUnexpected=f.dbClosed,e.hasLocalData=f.hasLocalData,e.hasMadeInMemoryOnlyUpdate=f.hasMadeInMemoryOnlyUpdate};var g=[];f.onCachesAvailable=function(e){f.dbi?e(!0):i.default.shouldWriteLocal()?g.push(e):e(!1)},f.openCacheDatabase=function(e,t,a,i){var n=function(){l.a?l.a.open({server:e,version:t,schema:a}).done(function(e){i(e)}).fail(function(e){i(void 0)}):i(void 0)};window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?n():setTimeout(n,0)};var m={};f.openCacheTable=function(e){if(f.dbi)return m[e]=void 0===m[e]?1:m[e]+1,f.dbi.caches},f.closeCacheTable=function(e){i.default.Assert(m[e]>0,"Must have previously opened the cache to close it"),m[e]--};var v,y=!1;function _(){}function b(e,t){if(t&&t.target){var a=t.target.error;if(a){i.default.log("Transaction Error Info: ",a.type,a.name,a.code,a.message);var n="QuotaExceededError"===a.name||4===a.code;"InvalidStateError"===a.name||n?f.notifyDBUnexpectedClose(n):i.default.reportError(new Error("IDB Transaction Error"),a)}else i.default.reportError(new Error("Unexpected transaction error A"),t)}else i.default.reportError(new Error("Unexpected transaction error B"),t)}f.localDataLoaded=function(){return y},f.loadFromIndexedDB=function(e){if(i.default.Assert(!y,"Should never load local data twice"),i.default.shouldLog(r.a.LogLevels.Timing)&&i.default.log("Loading DB: ",log.now()),f.dbDataCache={},i.default.shouldWriteLocal())if(f.dbi&&f.dbi.items){var t,a,n=!1,o=!1,s=window.__preload,l=function(t){i.default.Assert(!o,"Should only process load results once"),o=!0,i.default.shouldLog(r.a.LogLevels.Timing)&&i.default.log("Loaded DB: ",log.now()),f.loadedItemCount=0;for(var a=0;a<t.length;++a){var l=n?t[a]:i.default.translateObjOut(t[a]);t[a]&&t[a].id&&l&&(f.setItem(t[a].id,l),f.loadedItemCount++)}if(f.dbi.settings){var u=function(t){i.default.criticalErrorReported()||(y=!0,t&&(i.default.Assert(f.getItem(t.root),"If there is a root item defined there should be a corresponding local item"),f.rootId=t.root),e&&e())};s.settingsPreload&&s.settingsPreload.root?u(s.settingsPreload.root):f.dbi.settings.get("root").done(u).fail(e)}else i.default.log("Unable to load local settings DB"),e&&e()};s?s.mainLoaded=!0:s=window.__preload={mainLoaded:!0};var u=function(e){a=Date.now(),t&&i.default.log("Time preload blocked: ",a-t),clearTimeout(s.mainTimeout),s.mainTimeout=void 0,s.dataResults=void 0,e?l(e):(n=!1,s.onDataLoaded=void 0,f.dbi.items.query().all().fastExecute().done(l))};s.runDataLoad?(n=!0,s.dataResults?(console.log("Preload data available"),u(s.dataResults)):(console.log("Blocked on preload"),t=Date.now(),s.onDataLoaded=u,s.mainTimeout=setTimeout(function(){i.default.reportError(new Error("Preload timeout")),i.default.Assert(!s.dataResults,"Should not have results defined"),n=!1,s.onDataLoaded=void 0,f.dbi.items.query().all().fastExecute().done(l)},15e3))):(console.log("Preload skipped"),f.dbi.items.query().all().fastExecute().done(l))}else i.default.log("Unable to load local items DB - db not connected"),y=!0,i.default.preventLocalWrites(r.a.LocalWriteReason.Generic),e&&e();else i.default.log("Unable to load local items DB - already disabled"),y=!0,e&&e()},f.beginTransaction=function(){i.default.shouldWriteLocal()&&(v={})},f.transactionUpdate=function(e,t){if(i.default.Assert(i.default.shouldWriteLocal(),"Should never be writing during a transaction if local writes are disabled"),v[e])for(var a in t)v[e][a]=t[a];else v[e]=t},f.notifyDBUnexpectedClose=function(e){var t;e?(o.default.toasts.pushMessage(r.a.MessageID.QuotaError),f.overQuota=!0,t=r.a.LocalWriteReason.QuotaError):(o.default.toasts.pushMessage(r.a.MessageID.LocalWritesDisabled),t=r.a.LocalWriteReason.Generic),i.default.preventLocalWrites(t),f.dbClosed=!0,i.default.Assert(i.default.vmMain&&o.default.pluginManager,"Should always have a plugin manager when reporting DB quota error"),i.default.vmMain&&o.default.pluginManager&&e&&o.default.pluginManager.onCacheLimitExceeded()},f.endTransaction=function(){if(i.default.shouldWriteLocal()&&f.dbi&&f.dbi.items)try{f.dbi.items.updateObject(v).done(_).fail(b)}catch(e){i.default.reportError(e),b()}else void 0!==v&&i.default.reportError(new Error("Started a transaction and stopped writes halfway through"));v=void 0},f.hasPendingDBTransaction=function(){return!!v},f.dbUpdateItem=function(e){if(!f.freezeUpdates){f.hasLocalData||i.default.isLoadingRemote||e.skipLocalModification||(f.hasLocalData=!0);var t=e.changes||{},a=e.id?e.id:t.id,n=e.callback,o=e.saveFlags;i.default.Assert(o===r.a.SaveFlag.None||o===r.a.SaveFlag.Prop||o===r.a.SaveFlag.Text||o===r.a.SaveFlag.All);var s=f.getItem(a);if(i.default.shouldWriteLocal()){var l,u;if(i.default.Assert(!o||void 0===t.modifiedOffline&&void 0===t.modifiedOfflineText,"Shouldn't be setting a modified flag while passing them in with changes"),i.default.isFlagSet(o,r.a.SaveFlag.Prop))i.default.Assert(void 0===t.modifiedOffline,"Shouldnt be passing in a value and assigning "+t.modifiedOffline),i.default.shouldLog(r.a.LogLevels.Verbose|r.a.LogLevels.Data)&&i.default.log("Marking Item Modified Offline:",s?s.text:t.text),t.modifiedOffline=!0,(u=f.getModel(a))&&(u.modifiedOffline=!0);if(i.default.isFlagSet(o,r.a.SaveFlag.Text))i.default.Assert(void 0===t.modifiedOfflineText,"Shouldnt be passing in a value and assigning "+t.modifiedOfflineText),i.default.shouldLog(r.a.LogLevels.Verbose|r.a.LogLevels.Data)&&i.default.log("Marking Text Modified Offline:",s?s.text:t.text),t.modifiedOfflineText=!0,(u=f.getModel(a))&&(u.modifiedOfflineText=!0);if(s){for(var d in t){if(t.hasOwnProperty(d))s[d]=t[d]}f.validateItemData(s),l=i.default.translateObjIn(s)}else{i.default.Assert(t.id,"Item being modified does not already exist as expected",t),f.setItem(a,t),l=i.default.translateObjIn(t)}if(i.default.shouldLog(r.a.LogLevels.Verbose)&&i.default.log("Local Update: ",JSON.stringify(t,null,4)),v)i.default.Assert(!n,"Callbacks not supported for updates inside of a transaction"),f.transactionUpdate(a,l);else try{n?f.dbi.items.update(l).done(n).fail(n):f.dbi.items.update(l)}catch(c){"InvalidStateError"===c.name?f.notifyDBUnexpectedClose(!1):i.default.reportError(c)}}else{if(s)for(var d in t)t.hasOwnProperty(d)&&(s[d]=t[d]);else f.setItem(a,t);f.hasMadeInMemoryOnlyUpdate=!0,n&&n()}}},f.dbDeleteItem=function(e,t){if(!f.freezeUpdates&&(f.setItem(e,void 0),i.default.shouldWriteLocal()))try{t?f.dbi.items.remove(e).done(t).fail(t):f.dbi.items.remove(e)}catch(a){i.default.reportError(a)}},f.setRoot=function(e){if(!f.freezeUpdates){if(i.default.shouldWriteLocal())try{f.dbi.settings.update({key:"root",item:{root:e}})}catch(t){i.default.reportError(t)}return f.rootId=e,f.getRootItem()}},f.setPluginData=function(e){var t=Object.keys(e),i=a(98).default;i.clearGapiData();for(var n=0;n<t.length;++n){var r=t[n],s=o.default.pluginManager.getPlugin(r),l=e[r].data;l&&(i.setGapiData(r,l),s&&s.forceLoad())}};var k=!1;function w(e){var t=f.getItem(e);if(t){var a=t.items;if(a)for(var i=0;i<a.length;++i)w(a[i]);f.dbDeleteItem(t.id)}}function S(e,t,a,n){i.default.Assert(e,"Must provide a valid item"),i.default.Assert(e.shouldSave(),"Item must be marked as saveable");var o=i.default.isLocalChange(n)?r.a.SaveFlag.Prop:r.a.SaveFlag.None;c.a.saveItemLocal(e,{items:e.getItemsArrayForSave()},o),c.a.saveItemLocal(t,{isArchived:a},o)}function I(e,t,a){var i=e[t];return i?',"'+t+'":'+(a?a(i):i):""}f.initData=function(e){if(k)return!1;k=!0,i.default.shouldLog(r.a.LogLevels.Timing)&&i.default.log("Initializing User Item Data",log.now());try{i.default.isDemoMode()?setTimeout(function(){var t=n.a.getURLParam("data");f.loadDemoData(t,!1,e)},0):(i.default.checkpoint(r.a.Checkpoint.InitData),f.initializeIndexedDB(function(){f.loadFromIndexedDB(function(){i.default.checkpoint(r.a.Checkpoint.DBLoaded),f.checkLocalIntegrity(function(t){d.a.loadContacts(),t&&t.error&&i.default.reportError(new Error("Error during local integrity check")),e()})})}))}catch(t){i.default.reportError(t)}return!0},f.initializeItem=function(e){i.default.Assert(e.shouldSave(),"Item must be marked as saveable");var t=e.id,a=!t||i.default.isLocalItem(e)||!e.data;if(a){var n=gdata.createNewItem(e,e.hasChildren(),e.hasArchivedChildren());i.default.shouldLog(r.a.LogLevels.Data)&&i.default.log("Initializing",e.id,e.getParsedText()),t&&t!==n&&f.modifyItemId(t,n);for(var o=!1,s=e.numItems(),l=0;l<s;++l){var u=f.initializeItem(e.itemAtIndex(l));o=o||u}if(e.hasArchivedChildren()){var d=e.archivedItems(!0);for(l=0;l<d.length;++l){u=f.initializeItem(d[l]);o=o||u}}if(e.hasNote()){u=f.initializeItem(e.getNote());o=o||u}if(gdata.initializeNewItem(e),t&&t!==n){var h=e.parent();h&&c.a.saveItemLocal(h,null,r.a.SaveFlag.None)}}return a},f.checkLocalIntegrity=function(e){i.default.shouldLog(r.a.LogLevels.Timing)&&i.default.log("Checking Local: ",log.now());var t=!1;f.ensureLocalCache(function(){i.default.shouldLog(r.a.LogLevels.Timing)&&i.default.log("Verifying Local Data",log.now());var a=!1,n={};for(var o in f.dbDataCache)if(f.dbDataCache.hasOwnProperty(o)&&f.getItem(o)){((g=f.getItem(o)).i||g.t)&&(i.default.log("%cInvalid local properties on item: ","color: red",g),t=!0),n[g.id]?n[g.id].exist?(i.default.log(g.id,": Duplicated IDs in the local database",g),t=!0):(n[g.id].exist=!0,n[g.id].del=!!g.isDeleted):n[g.id]={exist:!0,ref:!1,del:!!g.isDeleted},g.id===f.rootId&&(a&&(i.default.log(g.id,": Multiple roots present locally",g),t=!0),a=!0,n[g.id].isRoot=!0),void 0===g.text&&(i.default.log("Found item with no text",g.id),g.text="",f.dbUpdateItem({id:o,changes:{text:""},saveFlags:r.a.SaveFlag.None})),g.note&&(n[g.note]?n[g.note].ref?(i.default.log(g.id,": Item note is used twice - ",g.note),t=!0):n[g.note].ref=g.id:n[g.note]={exist:!1,ref:g.id});for(var s=0;g.items&&s<g.items.length;++s){var l=-1;if(g.items[s]){var u=g.items[s],d=f.getItem(u);if(d){if(d.isArchived&&(l=s),l>=0&&!d.isArchived){i.default.log(u,": Unarchived child found after an archived one"),i.default.log("   ",g.id,": Parent with incorrectly ordered children"),t=!0;var c=g.items.removeAt(l);g.items.insert(s,c),l=s,f.dbUpdateItem({id:g.id,changes:{items:g.items},saveFlags:r.a.SaveFlag.None})}}else i.default.log(u,": Child does not have a valid reference on our local database"),t=!0;if(n[u])if(n[u].ref)i.default.log(u,": Item is referenced locally multiple times: ",d?f.getItem(u).id:"UNDEFINED"),i.default.log("   ",n[u].ref,": ",f.getItem(n[u].ref).id),i.default.log("   ",g.id,": <CLIENTDATA>"),t=!0,(m=g.items).removeAt(s),f.dbUpdateItem({id:o,changes:{items:m},saveFlags:r.a.SaveFlag.None});else n[u].ref=g.id;else n[u]={exist:!1,ref:g.id}}else i.default.log(g.id,": Invalid item in local items array"),t=!0}}for(var h in!a&&f.hasLocalData&&(i.default.log("No root present"),t=!0),n){var p=n[h];if(!p.exist){i.default.log(h,": Item is referenced locally as a child but does not exist in the database");var g=f.getItem(p.ref);if(i.default.Assert(g,"Parent of item must exist"),g)(m=g.items)?m.remove(h):m=[],f.dbUpdateItem({id:g.id,changes:{items:m},saveFlags:r.a.SaveFlag.None})}if(p.ref||p.isRoot||p.del||(i.default.log(h,": Item exists locally but is not referenced by a parent"),w(h)),p.ref&&p.del){i.default.log(h,": Item is referenced locally by a parent but has been deleted");var m;g=f.getItem(p.ref);i.default.Assert(g),(m=g.items)?m.remove(h):m=[],f.dbUpdateItem({id:g.id,changes:{items:m},saveFlags:r.a.SaveFlag.None})}if(p.isRoot&&p.ref&&(i.default.log(h,": Local root has a parent"),t=!0),p.del&&!p.ref){g=f.getItem(h);i.default.isLocalItem(g)&&(i.default.log("Deleting Unreferenced Local Item: ",h),f.dbDeleteItem(h))}}i.default.shouldLog(r.a.LogLevels.Timing)&&i.default.log("Done Verifying Local Data",log.now()),e({error:t,local:!1})})},f.removeDeletedItems=function(e){for(var t in f.dbDataCache){var a=f.getItem(t);a&&a.isDeleted&&(e[t]||(i.default.shouldLog(r.a.LogLevels.Verbose)&&i.default.log("Deleting Removed Local Item: ",t),f.dbDeleteItem(t)))}},f.addDefaultSkipSetting=function(e,t){f.defaultSkipSettings[t]||(f.defaultSkipSettings[t]=[]),f.defaultSkipSettings[t].push(e)},f.clearDataAndReload=function(e){n.a.hasURLParam("sinfo")&&n.a.removeURLParam("sinfo"),f.clearData(function(){setTimeout(i.default.reload,0)},f.defaultSkipSettings,e)},f.clearData=function(e,t,a){f.freezeUpdates=!0,i.default.shouldWriteLocal()||i.default.isLocalWriteReason(r.a.LocalWriteReason.QuotaError)?setTimeout(function(){if(i.default.pageDataCleared(),f.dbi)if(f.dbi.settings)try{f.dbi.settings.clear().done(function(){r()}).fail(function(){i.default.log("Failed to reset settings!"+arguments),r()})}catch(l){i.default.reportError(l),r()}else r();else f.initializeIndexedDB(function(){f.clearData(e,t)});function n(){a||(d.a.clearLocalContacts(),i.default.isArray(t),i.default.vmMain&&o.default.pluginManager&&o.default.pluginManager.onPurgeData());i.default.vmMain&&o.default.cacheManager&&(a?o.default.cacheManager.clearPerDocCaches(!0):o.default.cacheManager.clearLocalCaches(!0)),setTimeout(function(){e&&e()},0)}function r(){if(f.dbi.items)try{f.dbi.items.clear().done(function(){s()}).fail(function(){i.default.log("Failed to reset items!"+arguments),s()})}catch(l){i.default.reportError(l),s()}else s()}function s(){if(f.dbi.caches)try{f.dbi.caches.clear().done(function(){n()}).fail(function(){i.default.log("Failed to reset items!"+arguments),n()})}catch(l){i.default.reportError(l),n()}else n()}},0):e&&setTimeout(e,0)},f.archiveItem=function(e,t,a,n){i.default.Assert(e,"Must provide a valid item"),i.default.Assert(e.shouldSave(),"Item must be marked as saveable"),i.default.Assert(t>=0,"Must have a valid index to remove from"),S(e,a,!0,n),i.default.isLocalChange(n)&&gdata.itemArchived(e,a,t)},f.unarchiveItem=function(e,t,a,n){i.default.Assert(e,"Must provide a valid item"),i.default.Assert(e.shouldSave(),"Item must be marked as saveable"),i.default.Assert(t>=0,"Must have a valid index to remove from"),S(e,a,!1,n),i.default.isLocalChange(n)&&gdata.itemUnarchived(e,a,t,e.numItems()-1)},f.modifyItemId=function(e,t,a){i.default.shouldLog(r.a.LogLevels.Data)&&i.default.log("modifying",e,"into",t);var n=f.getItem(e),s=f.getModel(e);if(i.default.Assert(s.shouldSave(),"Item must be marked as saveable"),o.default.itemStoreManager.getDefaultItemStore().manualModifyItemID(e,t),n.id=t,s.id=t,f.pendingRemoteUpdates[e]&&(f.pendingRemoteUpdates[e]=void 0,f.pendingRemoteUpdates[t]=!0),n.version=-1,n.versionText=-1,"root"===e)for(var l=n.items.length-1;l>=0;l--){var u=f.getItem(n.items[l]);!i.default.isLocalItem(u)||u.modifiedOffline||u.modifiedOfflineText||(n.items.removeAt(l),i.default.Assert(s.itemAtIndex(l).id===u.id,"Item arrays should match"),s.getItems().removeAt(l))}i.default.Assert(!f.itemCache[t],"Should not be overwriting an item in the d.itemCache"),i.default.Assert(!f.dbDataCache[t],"Should not be overwriting an item in the d.dbDataCache"),f.itemCache[t]=f.itemCache[e],f.dbDataCache[t]=n,f.dbDeleteItem(e),f.dbUpdateItem({changes:n,callback:a,skipLocalModification:!0,saveFlags:r.a.SaveFlag.None}),f.dbDataCache[e]=void 0,delete f.dbDataCache[e],f.itemCache[e]=void 0,delete f.itemCache[e]},f.deleteItem=function(e,t){i.default.Assert(e,"Must provide a valid item"),i.default.Assert(e.shouldSave(),"Item must be marked as saveable"),i.default.Assert(!e.isDeleted(),"Should never try to delete an item that has already been deleted"),i.default.shouldLog(r.a.LogLevels.Data)&&i.default.log("Deleting item",e.id,e.getParsedText()),f.getItem(e.id)?(e.isDeleted(!0,t),f.dbUpdateItem({id:e.id,changes:{isDeleted:!0},saveFlags:r.a.SaveFlag.Prop})):i.default.Assert("Expected local item, didnt find one",e.id)},f.undeleteItem=function(e,t){f.getItem(e.id)?(e.isDeleted(!1,t),f.dbUpdateItem({id:e.id,changes:{isDeleted:void 0},saveFlags:r.a.SaveFlag.Prop})):i.default.Assert("Expected local item, didnt find one",e.id)},f.saveChanges=function(e,t,a){if(!e)return i.default.log("Incoming item to save has no item!",e,t),void i.default.Assert(!1,"Incoming item to save has no item!");i.default.Assert(e.shouldSave(),"Item must be marked as saveable"),t||(t={}),f.dbUpdateItem({id:e.id,changes:t,saveFlags:a})},f.addPendingUpdate=function(e){i.default.Assert(e,"Invalid ID"),i.default.Assert(i.default.isString(e),"Must provide a valid id string"),i.default.shouldLog(r.a.LogLevels.Version)&&i.default.log("Add Pending Update: ",e),f.pendingRemoteUpdates[e]||(f.pendingRemoteUpdates[e]=!0)},f.clearPendingUpdate=function(e){delete f.pendingRemoteUpdates[e]},f.clearPendingUpdates=function(){for(var e in f.pendingRemoteUpdates){i.default.Assert(f.pendingRemoteUpdates.hasOwnProperty(e)),(i.default.shouldLog(r.a.LogLevels.Version)||i.default.shouldLog(r.a.LogLevels.Data))&&i.default.log("Clear Pending Update: ",e);var t=f.getModel(e),a=f.getItem(e);if(a&&a.isDeleted)i.default.shouldLog(r.a.LogLevels.Data)&&i.default.log("%cDB delete item","color: red",e,a.text),f.dbDeleteItem(e);else if(t&&t.data){var n={id:e,modifiedOffline:!1};t.modifiedOffline=!1,gdata.hasDeferredAction(t.id)||(t.modifiedOfflineText=!1,n.modifiedOfflineText=!1);var o=gdata.getVersion(t.data,r.a.VersionType.Structure),s=gdata.getVersion(t.data,r.a.VersionType.Text);o!=t.getVersion(r.a.VersionType.Structure)&&(n.version=o,t.setVersion(r.a.VersionType.Structure,o)),s!=t.getVersion(r.a.VersionType.Text)&&(n.versionText=s,t.setVersion(r.a.VersionType.Text,s)),f.dbUpdateItem({id:e,changes:n,saveFlags:r.a.SaveFlag.None})}}f.pendingRemoteUpdates={},setTimeout(function(){!function e(t){i.default.Assert(t&&t.data,"Item must have valid remote data associated with it to be in the tree");if(!t||!t.data)return;if(!f.pendingRemoteUpdates[t.id]){var a=t.getVersion(r.a.VersionType.Structure)===gdata.getVersion(t.data,r.a.VersionType.Structure),n=t.getVersion(r.a.VersionType.Text)===gdata.getVersion(t.data,r.a.VersionType.Text),o={};a||(o.version=gdata.getVersion(t.data,r.a.VersionType.Structure),t.setVersion(r.a.VersionType.Structure,gdata.getVersion(t.data,r.a.VersionType.Structure))),n||(o.versionText=gdata.getVersion(t.data,r.a.VersionType.Text),t.setVersion(r.a.VersionType.Text,gdata.getVersion(t.data,r.a.VersionType.Text))),i.default.isEmpty(o)||(o.id=t.id,f.dbUpdateItem({id:t.id,changes:o,saveFlags:r.a.SaveFlag.None}))}var s=t.getItems();for(var l=0;l<s.length;++l)e(s[l]);if(t.hasArchivedChildren())for(var u=t.archivedItems(!0),l=0;l<u.length;++l)e(u[l])}(this.getRootModel())}.bind(this),0)},f.toDropHtml=function(e){var t="";if(!e.isArchived()&&(t+="<li>"+i.default.escape(e.getParsedText())+"</li>",e.hasChildren())){t+="<ul>";for(var a=0;a<e.numChildren();++a)t+=f.toDropHtml(e.getChild(a));t+="</ul>"}return t},f.toHtml=function(e,t,a,n){var r="<ul>";if(e.items)for(var o=0;o<e.items.length;o++){var s=f.getItem(e.items[o]),l=f.getModel(s.id),u=i.default.escape((n?l.getPrefix():"")+l.generateTitleText());if(!s.isArchived||s.isArchived&&t){if(r+="<li>"+u,s.note&&a){r+="<li>";var d=f.getModel(s.note);r+=i.default.escape(d.getParsedText()),r+="</li>"}s.items&&s.items.length>0&&(r+=f.toHtml(s,t,a,n)),r+="</li>"}}return r+="</ul>"},f.toPlainText=function(e,t,a,n,r){isNaN(t)&&(t=0);var o="";if(e.items)for(var s=0;s<e.items.length;s++){var l=f.getItem(e.items[s]),u=f.getModel(l.id);if(!l.isArchived||l.isArchived&&a){for(var d=0;d<t;d++)o+="\t";if(o+=i.default.escape((r?u.getPrefix():"")+u.generateTitleText())+"\n",l.note&&n)o+=f.getModel(l.note).getParsedText()+"\n";l.items&&l.items.length>0&&(o+=f.toPlainText(l,t+1,a,n,r))}}return o};var D=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,C={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function P(e){var t;try{var a=new Date(e);i.default.isDateValid(a)&&(t=a.getTime())}catch(n){i.default.reportError(n)}return t}function A(e,t,a,n,r){var o="";t&&(o+=",");var s=f.getModel(e.id);if(o+='{"text":"'+function(e){return D.lastIndex=0,D.test(e)?e.replace(D,function(e){var t=C[e];return i.default.isString(t)?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}):e}(s.generateExportText(r?s.getParsedText():s.getParsedTextWithoutPrefix()))+'"'+I(e,"date",P)+I(e,"dateCompleted",P)+I(e,"priority")+I(e,"isComplete")+I(e,"isStarred")+I(e,"isArchived")+I(e,"isNote"),(e=f.getItem(e.id)).note&&n&&(o+=',"note":'+A(f.getItem(e.note),!1,a,n,r)),e.items&&e.items.length>0){o+=',"items":[';for(var l=0;l<e.items.length;l++){var u=f.getItem(e.items[l]);(!u.isArchived||u.isArchived&&a)&&(o+=A(u,l>0,a,n,r))}o+="]"}return o+="}"}f.toJSON=function(e,t,a,n,r){var s=A(e,t,a,n,r),l='{"moodoVer":'+(o.default.settings.localDataVersion.get()||gdata.currentVersion())+',"moodoRoot":'+s+"}";try{var u=JSON.parse(l),d=JSON.stringify(u);i.default.Assert(d===l,l),l=JSON.stringify(u,null,2)}catch(c){i.default.reportError(c)}return l},f.createRootItem=function(e){f.setRoot(e),f.dbUpdateItem({changes:{id:e,text:r.a.RootItemName,items:[]},skipLocalModification:!0,saveFlags:r.a.SaveFlag.None,callback:function(){}})},f.ensureLocalCache=function(e){f.getRootItem()?(f.loadedItemCount>1&&(f.hasLocalData=!0),e()):e()},f.printIndexedDB=function(){if(i.default.shouldLog(r.a.LogLevels.Data|r.a.LogLevels.Verbose)){i.default.Assert(f.dbi,"Must have connected to local indexeddb");for(var e=Array.prototype.slice.call(arguments),t=0;t<e.length;t++)e[t]=i.default.translateFieldIn(e[t]);var a=0===e.length;f.dbi.items.query().all().execute().done(function(t){i.default.log("---- Local DB ----");for(var n=0;n<t.length;n++)if(a)i.default.log(t[n]);else{for(var r=[],o=0;o<e.length;o++)r[o]=t[n][e[o]];log.apply(this,r)}i.default.log("------------------")})}},t.default=f},function(e,t,a){"use strict";var i=a(31),n=function(e,t,a){var i=function(e,t,a){for(var i=0,n=0,r=e.length-1;n<=r;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=n+r>>1,s=a(e[o],t);if(s<0)n=o+1;else{if(!(s>0))return o;r=o-1}}return n}(e,t,a);return e.splice.apply(e,[i,0,t]),i},r=function(e,t){return e.index-t.index},o=function(e){for(var t=0,a=0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o={},s={},l=0;l<e.length;l++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var u=e[l];o[u.id]=u,u.isRoot&&(s[u.docId]=u)}for(var d=0;d<e.length;d++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=e[d],h=c.parent,f=o[h]||i[h];if(!f&&!c.isRoot){console.log("Item without a parent",c.text,c.parent);var p=s[c.docId];if(!p){console.log("Uh oh, can't find root",c.text),e.splice(d,1),d--;continue}c.parent=p.id,f=p}0,f&&!c.isDeleted&&(32===(32&c.flags)?f.note=c.id:c.isArchived&&f.isRoot?(f.archivedItems||(f.archivedItems=[]),f.archivedItems.push(c)):(f.items||(f.items=[]),n(f.items,c,r)))}return o},s=function(e){for(var t=0,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e[a]=i.a.itemIn(e[a])}return o(e)};t.a={load:function(e,t){var a={documents:void 0,items:void 0,settings:void 0,caches:void 0,boards:void 0,localStorage:void 0,user:void 0},n=Object.keys(a).length,r=function(e,r){if(a[e]=r,"documents"===e){for(var o=0,l=a.documents,u={},d={},c=0;c<l.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var h=i.a.documentIn(l[c]);u[l[c].id]=h,h.pendingSync&&(d[h.id]=!0)}a.documentsPending=d,a.documents=u}else if("items"===e){var f=function(e){var t={};return e=s(e),Object.keys(e).forEach(function(a){var i=e[a],n=i.items;if(i.pendingSync&&(t[i.id]=i.pendingSync),n){var r=Number.NEGATIVE_INFINITY;if(n.find(function(e){if(32!==(32&e.flags)){if(void 0===e.index||!(e.index>r))return!0;r=e.index}}))for(var o=0,s=0;s<n.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=n[s];l.pendingSync={index:l.index},l.index=s,t[l.id]=!0}}}),{items:e,itemsPending:t}}(a.items),p=f.items,g=f.itemsPending;a.items=p,a.itemsPending=g}else if("settings"===e||"boards"===e||"user"===e){var m=function(e){var t={},a={};return e.forEach(function(e){t[e.id]=e,e.pendingSync&&(a[e.id]=e.pendingSync)}),{values:t,pending:a}}(a[e]),v=m.values,y=m.pending;a[e]=v,a[e+"Pending"]=y}0===--n&&t(a)};for(var o in a)e[o]&&e[o].toArray(r.bind(e[o],o))},transformItems:s,createItemHierarchy:o}},,,,,,function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(2),s=a(4),l=a.n(s),u=a(13),d=a(5),c=a(44),h=a(15),f=a(27),p=a(85),g=a(50),m=a(222),v=a(10),y=a(26),_=u.b.createClass({displayName:"ReactEmailCompose",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){var e=this.props;this._dragEnterCounter=0,this._escapedFromDrag=!1,this.to=this._createTokensFromAddressText(e.message.to),this.cc=this._createTokensFromAddressText(e.message.cc);var t=!!e.message.cc&&e.message.cc.length>0;if(this.createObservables({showSubject:e.showSubject||o.a.isMobile,showCc:t,showBcc:!1,isSending:!1,isDragOver:!1}),this.listenTo(y.a.onAccountsUpdated),this.props.message.inReplyTo){var a=this.props.threadAttach.getData().messages,n=a.indexOfWithProperty("messageID",this.props.message.inReplyTo);if(n>=0){var r=a[n];i.default.Assert(r.initializedForDisplay,"Message must be ready to display if being replied to"),r&&r.responseMode&&(this.modeListener=r.responseMode.listen(this.onReplyModeChanged))}}i.default.isDemoMode()&&(i.default.reactEmailCompose=this)},onReplyModeChanged:function(){this.to=this._createTokensFromAddressText(this.props.message.to),this.cc=this._createTokensFromAddressText(this.props.message.cc),this.cc&&this.cc.tokens&&this.cc.tokens.length>0&&this.showCc.set(!0),this.updateState()},_getHotkeys:function(){return[f.a.create(n.a.KeyCode.Escape,!0,n.a.Primary.Either,n.a.Shift.Either,this.onEscape),f.a.create(n.a.KeyCode.Enter,!0,n.a.Primary.Yes,n.a.Shift.Either,this.send),f.a.create(n.a.KeyCode.K,!0,n.a.Primary.Yes,n.a.Shift.No,this.insertLinkHotkey)]},getState:function(){return{attachments:this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message),fromAccounts:this.getSendingAccounts()}},onMount:function(){var e=this._getComposeBody(this.props.message);e&&this.refs.body.setValue(e),this.refs.container.addEventListener("cdrop",this.onItemDrop);var t=this;this.refs.picker.addEventListener("change",function(){return t.props.threadAttach.getPlugin().notifyAttachFiles(t.props.threadAttach,t.props.message,this.files,t.onAttachUpdated),this.value=null,!1},!1),this.refs.container.addEventListener("paste",function(e){var a=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;if(a&&a.items&&a.items.length>0){for(var i=0,n=[],r=0;r<a.items.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;"file"===a.items[r].kind&&n.push(a.items[r].getAsFile())}if(n.length>0)return t.props.threadAttach.getPlugin().notifyAttachFiles(t.props.threadAttach,t.props.message,n,t.onAttachUpdated),!1}},!1),o.a.isMobile||(document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown))},onUnmount:function(){this.modeListener&&(this.modeListener.dispose(),this.modeListener=void 0),this._clearDraftDebounce(!0,!0),o.a.isMobile||document.removeEventListener("mouseup",this.onMouseUp)},discard:function(){this.close(!1,!0,!0)},onEscape:function(){this.isDragOver.get()||(this.refs.to.getTokens().length>0||this.refs.body.getValue()||this.state.attachments.length>0?r.default.menus.confirm("Do you want to discard this draft?",function(e){e&&this.discard()}.bind(this)):this.discard())},send:function(){this.onClickSend()},onFocus:function(){this.__hotkeys||(this.__hotkeys=f.a.pushStack(this._getHotkeys())),d.a.clearSelection()},onBlur:function(){this.__hotkeys&&(f.a.popStack(this.__hotkeys),this.__hotkeys=void 0)},onClickAttach:function(){this.refs.picker.click()},onAttachUpdated:function(e){this._isMounted&&(this.onDraftChanged(),e&&this._clearDraftDebounce(!0,!0),this.updateState())},onDragEnter:function(e){e.preventDefault(),this._escapedFromDrag||(this._dragEnterCounter++,this.isDragOver.set(!0))},onDragLeave:function(){this._dragEnterCounter--,0===this._dragEnterCounter&&this.isDragOver.set(!1)},onMouseUp:function(){this._escapedFromDrag=!1,this.isDragOver.set(!1)},onKeyDown:function(e){e.keyCode===n.a.KeyCode.Escape&&this.isDragOver.get()&&(this._escapedFromDrag=!0,this.isDragOver.set(!1))},onFileDrop:function(e){if(!this._escapedFromDrag){this.isDragOver.set(!1);var t=e.dataTransfer;if(t.files&&t.files.length>0)this.props.threadAttach.getPlugin().notifyAttachFiles(this.props.threadAttach,this.props.message,t.files,this.onAttachUpdated.bind(this)),e.preventDefault(),e.stopPropagation(),r.default.DragDrop.stop(),r.default.DragDrop.finish()}},onItemDrop:function(e){if(e.item&&e.item.hasAttachmentType(n.a.PluginType.Storage)){var t=e.item.getAttachmentByType(n.a.PluginType.Storage);this.props.threadAttach.getPlugin().notifyAttachLinkedFile(this.props.threadAttach,this.props.message,t,this.onAttachUpdated.bind(this))}},close:function(e,t,a){i.default.Assert(i.default.isBoolean(e),"Must supply a valid value for sendDraft"),i.default.Assert(i.default.isBoolean(t),"Must supply a valid value for discardDraft"),i.default.Assert(i.default.isBoolean(a),"Must supply a valid value for forceFlush"),i.default.shouldLog(n.a.LogLevels.Compose)&&i.default.log("Compose Close: ",e,t,a),this._clearDraftDebounce(e,a),this.props.onClose(),!e&&t&&this._discardDraftUpdates()},_clearDraftDebounce:function(e,t){this._draftUpdateDebounce&&(clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._saveDraftUpdates(e,t))},openSubject:function(){this.showSubject.set(!0),setTimeout(function(){this._setFocus(this.refs.subject),this.refs.subject.selectEnd()}.bind(this),0)},openCc:function(){this.showCc.set(!0),setTimeout(function(){this._setFocus(this.refs.cc)}.bind(this),0)},openBcc:function(){this.showBcc.set(!0),setTimeout(function(){this._setFocus(this.refs.bcc)}.bind(this),0)},focusTo:function(){this._setFocus(this.refs.to)},focusBody:function(){this._setFocus(this.refs.body)},_setFocus:function(e){e.isFocused.get()||e.focus()},_createTokensFromAddressText:function(e){var t=[];if(e)for(var a=0,i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e[i];n.text?t.push(n):n.email&&t.push({email:n.email,text:n.email})}return{tokens:t}},onClickSend:function(){var e=this.props,t=this.refs,a=function(t,a){t?this.close(!1,!1,!0):(i.default.isHTTPStatusCode(a,n.a.HTTPStatusCode.Network)?r.default.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:n.a.MessageAction.Okay,hold:!0}):a&&r.default.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:n.a.MessageAction.Okay}),this.isSending.set(!1)),r.default.EmailPreview.ensureDisplayMessages(e.threadAttach)}.bind(this),o=function(t){t&&(this._clearDraftDebounce(!1,!1),h.default.clearSelection(),this.isSending.set(!0),e.threadAttach.getPlugin().sendDraft(e.threadAttach,e.message.id,e.message.draftID,void 0,a)||this.isSending.set(!1))}.bind(this);t.subject&&!t.subject.getValue()?r.default.menus.confirm("There is no email subject, send anyway?",o):t.body.getValue()?o(!0):r.default.menus.confirm("There is no email body, send anyway?",o)},onDraftChanged:function(){clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._isMounted&&(this._draftUpdateDebounce=setTimeout(this._saveDraftUpdates.bind(this,!0,!1),1e3))},_saveDraftUpdates:function(e,t){if(i.default.shouldLog(n.a.LogLevels.Compose)&&i.default.log("Queue Save Draft: ",this.props.threadAttach.id,this.props.message.id,this.props.message.draftID,this._isMounted),this._isMounted){var a=this.refs,r=this.props,o=a.to.getTokens(),s=a.cc&&a.cc.getTokens(),l=a.bcc&&a.bcc.getTokens(),u=a.subject&&a.subject.getValue()||this.props.message.subject,d=a.body.getValue()||"(no text)",c=a.body.getTextValue()||"(no text)",h={to:o,cc:s,bcc:l,subject:u,body:d};r.threadAttach.getPlugin().updateDraft(r.threadAttach,r.message.id,r.message.draftID,h,c,e,t,function(e){i.default.Assert(e,"Should always be able to update a draft")}),clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0}},_discardDraftUpdates:function(){this.props.threadAttach.getPlugin().discardDraft(this.props.threadAttach,this.props.message.id,this.props.message.draftID,function(e){i.default.Assert(e,"Should always be able to delete a draft")})},_getComposeBody:function(e){var t;return e&&e.decoded&&(t=c.a.getComposeBody(e.decoded,e.resources)),t},onChangeFrom:function(){var e=this.refs.from.value,t=this.props.threadAttach,a=t.getPlugin(),i=a.getSyncAccount(e),n=a.getSendingAccountInfo(e),o=!!this.props.message.inReplyTo;o?this._clearDraftDebounce(!1,!1):this.close(!1,!1,!1);var s=a.changeMessageAccount(t,this.props.message.id,this.props.message.draftID,i,e,n),l=s?s.threadID:t.id;o||r.default.menus.openComposeEmail(a,l),this.refs.body.setValue(this._getComposeBody(this.props.message))},getSendingAccounts:function(){var e,t=this.props.threadAttach.getPlugin();return this.props.message.inReplyTo&&(e=this.props.threadAttach.getField("accountID")),t.getSendingAccounts(e)},getFromAccount:function(){var e=this.state.fromAccounts;return e.length<2?e[0]:this.refs.from.value},insertLinkHotkey:function(){this.refs.body.hasFocus()&&this.insertLink()},insertLink:function(){var e=h.default.getSelectedText(),t=this.refs.buttonLink.getElement();this.savedSel=h.default.getSelectionRange(),r.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:t,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:e})},onInsertLinkClosed:function(){this.savedSel&&(this.refs.body.focus(),h.default.setSelectionRange(this.savedSel))},onInsertLink:function(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.refs.body.insertNode(t)},render:function(){var e=this.state,t=this.props,a=this.to,n=this.cc,r="(no subject)"===t.message.subject?"":t.message.subject,s=this.state.showCc||this.cc&&this.cc.length>0,u=(o.a.isMobile?16:8)+(s?0:28)+(e.showBcc?0:34),d=t.message.from.email,c=e.fromAccounts.slice(0),h=e.fromAccounts.length>1,f={},y=i.default.classNames("emailCompose validDropTarget flexbox flexvert",t.className);c.remove(d),c.unshift(d);var _,b=i.default.classNames("composeHeader c-border-heavy",{showingFrom:e.fromAccounts.length>1});return o.a.isMobile&&(_={paddingBottom:o.a.getKBSize()}),t.hidden&&(f.height=0,f.paddingTop=0,f.overflow="hidden"),l.a.createElement("div",{className:y,style:f,ref:"container",onFocus:this.onFocus,onBlur:this.onBlur,onDrop:this.onFileDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave},l.a.createElement("div",{className:b},l.a.createElement("div",{className:"composeButtons"},!e.showSubject&&l.a.createElement(v.a,{height:24,padding:6,onClick:this.openSubject},"Subject"),!s&&l.a.createElement(v.a,{height:24,padding:6,onClick:this.openCc},"Cc"),!e.showBcc&&l.a.createElement(v.a,{height:24,padding:6,onClick:this.openBcc},"Bcc")),l.a.createElement(g.a,{className:"toBox",height:50,floatingText:"To",display:"block",ref:"to",tokens:a.tokens,focused:"to"===this.props.focus,autocompleteMode:"email",padding:{right:0},margin:{right:u},onChange:this.onDraftChanged,onEscape:t.onEscape}),s&&l.a.createElement(g.a,{height:50,floatingText:"Cc",display:"block",ref:"cc",tokens:n.tokens,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showBcc&&l.a.createElement(g.a,{height:50,floatingText:"Bcc",display:"block",ref:"bcc",autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showSubject&&l.a.createElement(g.a,{height:50,floatingText:"Subject",display:"block",ref:"subject",value:r,padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),h&&l.a.createElement("div",{className:"composeFrom"},l.a.createElement("span",null,"From"),l.a.createElement("select",{ref:"from",onChange:this.onChangeFrom},c.map(function(e){return l.a.createElement("option",{key:e,value:e},e)})))),l.a.createElement(m.a,{className:"emailComposeTextarea c-border-heavy f1",ref:"body",style:_,onChange:this.onDraftChanged,spellCheck:!0,onEscape:t.onEscape,editable:!e.isSending,richText:!0}),l.a.createElement(p.a,{onUpdate:this.onAttachUpdated,threadAttach:t.threadAttach,message:t.message,editable:!0}),!o.a.isMobile&&l.a.createElement("div",{className:"composeFooter"},l.a.createElement(v.a,{className:"discardDraft",icon:"icon-delete",iconSize:20,onClick:this.discard,tooltip:"Discard Draft"}),l.a.createElement(v.a,{className:"attachFile",icon:"icon-attach_file",iconSize:20,marginLeft:8,onClick:this.onClickAttach,tooltip:"Attach File"}),l.a.createElement(v.a,{className:"insertLink",icon:"icon-link",iconSize:20,marginLeft:8,onClick:this.insertLink,ref:"buttonLink",tooltip:"Insert Link"}),l.a.createElement(v.a,{className:"buttonSend",primary:!0,marginLeft:16,onClick:this.onClickSend},"SEND")),l.a.createElement("input",{type:"file",ref:"picker",className:"hidden",multiple:!0}),e.isDragOver&&l.a.createElement("div",{className:"dropNotice flexbox flex-center"},l.a.createElement("div",{className:"dropBg absFull"}),l.a.createElement("div",{className:"f1 center"},l.a.createElement("div",{className:"icon-attach_file"}),l.a.createElement("div",null,"Drop to attach"))),e.isSending&&l.a.createElement("div",{className:"clickBlocker flexbox flex-center c-bg-faded"},l.a.createElement("div",{className:"f1 center c-foreground"},"Sending...")))}});t.a=_},function(e,t,a){"use strict";var i=a(1),n=a(0),r=a(4),o=a.n(r),s=a(13).b.createClass({displayName:"FancyContextMenuHeader",componentDisplay:i.a.ComponentDisplay.Desktop,render:function(){var e=this.props,t=n.default.classNames("fancyContextMenuItem fancyContextMenuHeader flexbox c-foreground-very-faded",e.className,{"border c-border-light":!1!==e.border},{topHeader:e.topHeader}),a=n.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:e.hotkeyCentered}),i={padding:isNaN(e.padding)?void 0:e.padding};return o.a.createElement("div",{className:t,style:i},o.a.createElement("span",{className:"f1"},e.children),e.hotkey&&o.a.createElement("span",{className:a},e.hotkey))}});t.a=s},function(e,t,a){"use strict";function i(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.cb=a,this._disposed=!1}var t,a,n;return t=e,(a=[{key:"dispose",value:function(){this._disposed=!0,this.target.unlisten(this.cb)}},{key:"isDisposed",value:function(){return this._disposed}}])&&i(t.prototype,a),n&&i(t,n),e}();t.a=n},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(31);function s(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,d;return t=e,(a=[{key:"makePropString",value:function(e,t,a){return t?',"'+e+'":'+(a?a(t):t):""}},{key:"safeJSONText",value:function(e){return l.lastIndex=0,l.test(e)?e.replace(l,function(e){var t=u[e];return i.default.isString(t)?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}):e}},{key:"_addItemToArray",value:function(e,t,a,i){var n=t.getFullSaveData();if(!i&&n.note&&delete n.note,e.push(n),t.hasChildren())for(var r=0,o=t.getItems(),s=0;s<o.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=o[s];this._addItemToArray(e,l,a,i)}i&&t.hasNote()&&e.push(t.getNote().getFullSaveData())}},{key:"getBestEncryptionOut",value:function(){var e=r.default.settings.encryptionKeys.get();return e&&e[n.a.EncryptionKeys.UserPassword]?n.a.EncryptionKeys.UserPassword:n.a.EncryptionKeys.Global}},{key:"getItemsData",value:function(e,t){var a=this,i=t.exportArchived,n=t.includeNotes,s=t.encrypt,l=[];return this._addItemToArray(l,e,i,n),s?Promise.all(l.map(function(e){return o.a.encryptItemOut(e,r.default.crypto,a.getBestEncryptionOut())})):Promise.resolve(l.map(function(e){return o.a.itemOut(e)}))}},{key:"toDropHtml",value:function(e){var t="";if(!e.isArchived()&&(t+="<li>"+i.default.escape(e.getParsedText())+"</li>",e.hasChildren())){var a=0;t+="<ul>";for(var n=0;n<e.numChildren();++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.toDropHtml(e.getChild(n))}t+="</ul>"}return t}},{key:"toHtml",value:function(e,t,a,n){var r="<ul>",o=e.getItems();if(o)for(var s=0,l=0;l<o.length;l++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=o[l],d=i.default.escape((n?u.getPrefix():"")+u.generateTitleText());if(!u.isArchived()||u.isArchived()&&t){if(r+="<li>"+d,a){var c=u.hasNote()&&u.getNote();c&&(r+="<li>",r+=i.default.escape(c.getParsedText()),r+="</li>")}u.numItems()>0&&(r+=this.toHtml(u,t,a,n)),r+="</li>"}}return r+="</ul>"}},{key:"toPlainText",value:function(e,t,a,n,r){isNaN(t)&&(t=0);var o="",s=e.getItems();if(s)for(var l=0,u=0;u<s.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=s[u];if(!d.isArchived()||d.isArchived()&&a){for(var c=0,h=0;h<t;h++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;o+="\t"}if(o+=i.default.escape((r?d.getPrefix():"")+d.generateTitleText())+"\n",n){var f=d.hasNote()&&d.getNote();f&&(o+=f.getParsedText()+"\n")}d.numItems()>0&&(o+=this.toPlainText(d,t+1,a,n,r))}}return o}}])&&s(t.prototype,a),d&&s(t,d),e}();t.a=new d},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(71),o=a(26);function s(e,t,a,n,r,o,s){this.file=e,this.properties=n,this.contentType=e.type,this.accountID=t,this.folder=a,this.onComplete=o||i.default.emptyFn,this.onError=s||i.default.emptyFn,this.onProgress=r||i.default.emptyFn,this._callbacks=[],this.offset=0,this.chunkSize=1048576,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;this.url=this._buildURL(void 0,{uploadType:"resumable"}),this._percent=0}s.prototype={upload:function(){var e=this;this._hasStarted=!0,i.default.isDemoMode()?setTimeout(function(){e.onComplete()},2e3):o.a.getDefaultAuthToken([n.a.GScope.Drive],function(t){if(t){var a={Authorization:"Bearer "+t.access_token,"Content-Type":"application/json","X-Upload-Content-Length":e.file.size,"X-Upload-Content-Type":e.contentType};r.a.getFolder(e.folder,function(t){var r,o={title:e.file.name,mimeType:e.contentType,parents:t?[{id:t}]:[]};e.properties&&(o.properties=Object.keys(e.properties).map(function(t){return{key:t,value:e.properties[t],visibility:"PRIVATE"}}));try{r=JSON.stringify(o)}catch(s){i.default.reportError(s)}r?i.default.XHR({url:e.url,type:"POST",headers:a,data:r,autoRetry:!0,cb:function(t){if(t.status<n.a.HTTPStatusCode.BadRequest){var a=t.getResponseHeader("Location");e.url=a,e._runUpload()}else e._onError(t)}}):e._onError()})}})},_runUpload:function(){i.default.Assert(this.url,"Must have a valid remote URL to run upload"),this._isRunning=!0;var e=Math.min(this.offset+this.chunkSize,this.file.size),t=this.file.slice(this.offset,e),a={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(e-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};i.default.XHR({url:this.url,type:"PUT",headers:a,data:t,autoRetry:!0,cb:function(e){if(e.status===n.a.HTTPStatusCode.Success||e.status===n.a.HTTPStatusCode.Created)this.isCanceled()||this._onComplete(e);else if(e.status===n.a.HTTPStatusCode.PermRedirect){var t=this._extractRange(e.getResponseHeader("Range"));this.offset=t,this._onProgress(this.offset/this.file.size),this.isCanceled()||this._runUpload()}else this._onError(e)}.bind(this)})},resume:function(){if(i.default.Assert(!this.isDone(),"Should not resume a completed upload"),i.default.Assert(this._hasStarted,"Must have started an upload to resume it"),i.default.Assert(this.url,"Must have a valid remote URL to resume upload"),this._hasError=!1,this._isCanceled=!1,this._isRunning)0;else if(this._isRunning=!0,this._hasStarted&&this.url){var e={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};i.default.XHR({url:this.url,type:"PUT",headers:e,autoRetry:!0,cb:function(e){if(e.status===n.a.HTTPStatusCode.PermRedirect){var t=this._extractRange(e.getResponseHeader("Range"));this.offset=t,this._onProgress(this.offset/this.file.size),this._runUpload()}else this._onError(e)}.bind(this)})}else this.upload()},cancel:function(){i.default.Assert(!this._isDone,"Cannot cancel an upload that is already complete"),this._isCanceled=!0,this._isRunning=!1},_onError:function(e){this._hasError=!0,this._isRunning=!1,this.onError()},_onComplete:function(e){var t=0;i.default.Assert(!this._isDone,"Should not call the complete CB twice"),i.default.Assert(!this._isCanceled,"Should not be able to complete a canceled upload"),this._isDone=!0,this._isRunning=!1;var a={};if(e&&e.response)try{a=JSON.parse(e.response)}catch(r){i.default.reportError(r)}this._onProgress(1),this.onComplete(a);for(var n=0;n<this._callbacks.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._callbacks[n](a)}catch(r){i.default.reportError(r)}}this._callbacks=[]},_onProgress:function(e){i.default.Assert(!this._hasError,"Should not make forward progress when an error has occurred"),this._percent=e,this.onProgress(e)},_extractRange:function(e){return i.default.parseInt(e.match(/\d+/g).pop())+1},_buildQueryString:function(e){return e=e||{},Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},_buildURL:function(e,t){var a="https://www.googleapis.com/upload/drive/v2/files/";e&&(a+=e);var i=this._buildQueryString(t);return i&&(a+="?"+i),a},notifyOnComplete:function(e){i.default.Assert(this._callbacks.indexOf(e)<0,"Should not include fn twice"),i.default.Assert(!this.isDone(),"Should not notify on complete after done"),i.default.Assert(!this.hasError(),"Should not notify on complete after error"),this._callbacks.push(e)},isCanceled:function(){return this._isCanceled},isDone:function(){return this._isDone},isRunning:function(){return this._isRunning},hasError:function(){return this._hasError},getPercent:function(){return this._percent}},t.a=s},function(e,t,a){"use strict";var i=a(0),n=a(12),r=a(6),o=a(1),s=a(18);function l(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,u;return t=e,(a=[{key:"onRemoteChange",value:function(e,t,a,l){var u=n.a.getItem(a),d=o.a.ChangeType.Remote;if(i.default.Assert(t!==o.a.CrudActions.Modified||u,"Item should not be modified if it does not exist"),u||t!==o.a.CrudActions.Modified||(t=o.a.CrudActions.Added),t===o.a.CrudActions.Added){r.e.beginAction();var c=n.a.getItem(l.parent);if(u?(u.isDeleted()?u.isDeleted(!1,d):u.isArchived(),u.setParent(c)):u=n.a.createVMLI(l,{parent:c,changeType:d,documentOwner:e}),i.default.Assert(c,"Added item must have a parent"),c){var h=c.items.get().findIndex(function(e){return e.index>l.index});c.insertItem(u,h,!0)}r.e.endAction()}else t===o.a.CrudActions.Removed?(u&&(u.isDeleted()||u.deleteSelf(d)),s.a.deleteItem(a)):u.onChangeRemote(t,l,d)}}])&&l(t.prototype,a),u&&l(t,u),e}();t.a=new u},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(2),s=a(4),l=a.n(s),u=a(13),d=u.b.createClass({displayName:"FancyProgressBar",componentDisplay:n.a.ComponentDisplay.Desktop,render:function(){var e=this.props,t={height:e.height},a={};a[o.a.transform.react]="scale("+e.percent+", 1)";var i={lineHeight:e.height-2+"px"};return l.a.createElement("div",{className:"fancyProgressBar",style:t},!e.error&&l.a.createElement("div",{className:"fancyProgressInside",style:a}),e.error&&l.a.createElement("div",{className:"fancyProgressError",style:i},e.errorMsg))}}),c=a(10),h=u.b.createClass({displayName:"ReactMessageAttachments",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){this.props.threadAttach.subscribe(this)},onUnmount:function(){this.props.threadAttach.unsubscribe(this)},onAttachmentUpdate:function(){this.updateState()},onAttachmentIDChange:function(){},getState:function(){return{attachments:this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message)}},isAttachImage:function(e){var t=e.mimeType;return"image/png"===t||"image/jpg"===t||"image/jpeg"===t||"image/gif"===t},onClickAttach:function(e,t){if(e.error)e.uploader&&!e.uploader.isDone()&&e.uploader.resume();else if(!e.uploader||e.uploader.isDone()){var a=this._getURL(e);this.props.editable?i.default.openUrl(a):e.attID?o.a.mac&&t.metaKey||!o.a.mac&&t.ctrlKey||!this.isAttachImage(e)||o.a.isMobile?i.default.downloadFile(a,e.cid):r.default.menus.openLightbox(a,"Download",function(){i.default.downloadFile(a,e.cid)}):i.default.openUrl(a)}t.stopPropagation()},onClickDelete:function(e,t){var a=this.props.threadAttach.getPlugin().removeAttachFiles(this.props.threadAttach,this.props.message,e);this.props.onUpdate&&this.props.onUpdate(a),t.stopPropagation()},onAttachDragStart:function(e){var t=e.target.getAttribute("data-downloadurl");e.stopPropagation(),e.dataTransfer.setData("DownloadURL",t),r.default.DragDrop.setExternalData(t)},_getURL:function(e){return this.props.editable||!e.attID?r.default.EmailPreview.getPreviewURL(e):r.default.EmailPreview.getAttachmentURL(this.props.threadAttach.getField("accountID"),this.props.message.id,e.attID)},_renderAttachment:function(e){var t=e.mimeType+":"+e.cid+":"+this._getURL(e),a=e.uploader?i.default.clamp(e.uploader.getPercent(),.05,1):1,n=this.isAttachImage(e)?"Click to open image.\n"+o.a.priModKey+" click to download image.":"Click to download image";return l.a.createElement("div",{key:e.id,className:"messageAttachment flexbox c-button-raised",draggable:!0,"data-downloadurl":t,onClick:this.onClickAttach.bind(this,e),onDragStart:this.onAttachDragStart,"data-tooltip":n},l.a.createElement("div",{className:"attachmentIcon icon-drive-file"}),l.a.createElement("div",{className:"attachmentText"},e.cid),l.a.createElement("div",{className:"f1"}),a<1&&l.a.createElement(d,{percent:a,height:22,error:e.error,errorMsg:"Click to retry"}),1===a&&e.error&&l.a.createElement("div",null,"ERROR"),l.a.createElement("div",{className:"attachmentSize"},i.default.toFileSize(e.size)),this.props.editable&&l.a.createElement(c.a,{className:"attachmentClose",icon:"icon-close",onClick:this.onClickDelete.bind(this,e),tooltip:"Remove"}))},render:function(){var e=null,t=this.state.attachments;if(t.length>0){for(var a=0,i=[],n=0;n<t.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t[n];i.push(this._renderAttachment(r))}e=l.a.createElement("div",{className:"messageAttachments c-border"},i)}return e}});t.a=h},,,,,function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(2),s=a(42),l=a(12),u=a(7),d=a(48);function c(e){return(c="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==c(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=f(this,p(t).call(this))).init(),e}var a,c,m;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,s["a"]),a=t,(c=[{key:"init",value:function(){var e=this;this._groupAbbrevs={},this._groupAbbrevsIn={},this.registerGroup(this,""),this.registerGroup("ui","u");var t=[["agendaSort","a"],["attachFolderId","aA"],["backupFolderId","c"],["backupFrequency","d"],["calendarCustomDays","e",3],["closedImport","f"],["closedHelps","g"],["closedVideo","h"],["dateFormat","i",n.a.DateFormat.MDY],["dayWeekStart","j",0],["defaultItemPrefix","k",""],["helpPaneState","l"],["helpState","m"],["inTooltipIntro","n"],["lastBackup","o"],["needsBackup","p"],["notificationDelay","q",30],["openEvernoteApp","r"],["panesMobile","s"],["selectFullItems","t",!1],["rootFolderId","u"],["showFormattingToolbar","v",1],["showMarkdown","w"],["showImagesInline","x",!0],["shownTutorial","y"],["syncContacts","z"],["trialOverHidden","A"],["userEncryptionSentinel","aE"],["encryptBackup","aG"]],a=[["activeUser","b"],["cacheSizeRatio","B",1],["disableNotifications","C"],["displayName","D"],["invoiceEmail","E"],["invoiceCompany","F"],["invoiceAddress","G"],["isUnsubscribed","H"],["lastContactSync","I"],["lastServerVersion","J"],["lastTaskSync","K"],["lastQuickAddSync","L"],["localDataVersion","M",1],["localIntegrity","N"],["localPaneState","O"],["localRecoverVersion","P"],["monthlyInvoice","Q"],["notifiedTrialOver","R"],["notifiedTrialEndSoon","S"],["premiumEndDate","T"],["premiumStatus","U"],["selectedBoard","V"],["showSidebar","W",!1],["sidebarWidth","X",n.a.DesktopMenuWidthDefault],["trialDuration","Y"],["trialExtended","Z"],["trialStart","aa"],["userId","ab"],["encryptionKeys","aD"],["lastSync","aF"]],o=[["boldHeaders","ac",!1],["bulletOpacity","ad",30],["checkboxOpacity","ae",30],["checkboxBackgroundOpacity","af",0],["contactColor","ag","#22AA66"],["dateColor","ag","#AA3300"],["displayPrefixes","ai",n.a.DisplayTheme.PrefixesFaded],["displaySpacing","aj",n.a.DisplayTheme.SpacingComfortable],["fontSize","ak",14],["fontSizeHeader","al",16],["fontSizeHeaderTopLevel","am",18],["grayscale","an",!1],["itemIndentSize","ao",30],["itemLineHeight","ap",18],["itemPadding","aq",5],["linkColor","ar","#3333BB"],["noteFontSize","as",12],["noteLineHeight","at",18],["notePadding","au",0],["projectOpacity","av",30],["showVerticalLines","aw",!0],["tagColor","ax","#0099DD"],["theme","ay","light"],["underlineP","az",!1],["verticalLinesOpacity","aC",6]];this.registerSettings(t,this,!0),this.registerSettings(a,this,!1),this.registerSettings(o,this.ui,!0),this.activeUser.set(i.default.isDemoMode()?"demo":void 0),this.encryptionKeys.listen(function(t){e._encryptionKeyInfo={};var a={};Object.keys(t).forEach(function(e){a[e]=t[e]}),r.default.crypto.importKeys(a).then(function(t){e._encryptionKeyInfo=t})})}},{key:"load",value:function(e){var t=this;this._isLoading=!0,Object.keys(e).forEach(function(a){var i=t.getSettingInfoFromAbbrev(a),n=i.group,r=i.key,o=e[a].v;n&&n[r]&&n[r].set(o||n._settingsDefault[r])}),r.default.DisplaySettings.init(),this._isLoading=!1}},{key:"registerGroup",value:function(e,t){var a,r=this,o=[];i.default.isString(e)&&(i.default.shouldLog(n.a.LogLevels.Settings)&&i.default.log("SETTINGS: Registered Group - ",e),a=e,this[e]={},e=this[e]),e.listen=function(e){o.push(e)},e.unlisten=function(e){o.remove(e)},e.onChange=function(e,t,i){var n=0;r._isLoading||r._save(e,a,t);for(var s=0;s<o.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o[s](t,i)}},e._settingsDefault||(e._settingsRemote={},e._settingsDefault={},e._settingsAbbrevs={},e._settingsAbbrevsIn={}),a&&(this._groupAbbrevs[a]=t,this._groupAbbrevsIn[t]=a)}},{key:"registerSettings",value:function(e,t,a){for(var i=0,n=0;n<e.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e[n],o=r[0],s=r[1],l=r[2];this.registerSetting(o,s,t,a,l)}}},{key:"registerSetting",value:function(e,t,a,n,r){i.default.isString(a)&&(a=this[a]),n&&(a._settingsRemote[e]=!0),void 0!==r&&(a._settingsDefault[e]=r),a._settingsAbbrevs[e]=t,a._settingsAbbrevsIn[t]=e,a.onChange&&(a[e]=new u.a(r,a.onChange.bind(this,e)))}},{key:"getDefaultItemText",value:function(e){return(e=e||this.defaultItemPrefix.get())?e+" ":""}},{key:"getSettingAbbrev",value:function(e,t){return(t?this[t]:this)._settingsAbbrevs[e]}},{key:"getSettingInfoFromAbbrev",value:function(e){var t,a,n=e.split("\\");return n.length>1?(a=this[a=this._groupAbbrevsIn[n[0]]],t=n[1]):(a=this,t=n[0]),t=a._settingsAbbrevsIn[t],i.default.Assert(a&&a[t],"Missing group for setting",e),{group:a,key:t}}},{key:"getValueFromAbbrev",value:function(e){var t=this.getSettingInfoFromAbbrev(e),a=t.group,i=t.key;if(a&&a[i])return a[i].get()}},{key:"_save",value:function(e,t,a){var i=t?this[t]:this,n=i._settingsRemote[e],r=i._settingsDefault[e],o=i._settingsAbbrevs[e];a===r&&(a=null);var s=(t?this._groupAbbrevs[t]+"\\":"")+o;l.a.setSetting(s,a,n)}},{key:"getEncryptionKey",value:function(e){return this._encryptionKeyInfo?this._encryptionKeyInfo[e]:void 0}},{key:"addEncryptionKey",value:function(e,t){var a=r.default.settings.encryptionKeys.get()||{};a[e]=t,o.a.isMobile?r.default.crypto.exportKey(t).then(function(t){a[e]=d.a.ab2str(t),r.default.settings.encryptionKeys.set(a)}):r.default.settings.encryptionKeys.set(a)}},{key:"shouldShowHelp",value:function(e){var t=this.closedHelps.get();return!t||!t[e]}},{key:"closeHelp",value:function(e){var t=i.default.clone(this.closedHelps.get())||{};t[e]=!0,this.closedHelps.set(t)}},{key:"uncloseHelp",value:function(e){var t=i.default.clone(this.closedHelps.get())||{};delete t[e],this.closedHelps.set(t)}},{key:"isBackupEnabled",value:function(){return this.backupFrequency.get()>0}},{key:"getBestUserEncryption",value:function(){var e=r.default.settings.encryptionKeys.get();return e&&e[n.a.EncryptionKeys.UserPassword]?n.a.EncryptionKeys.UserPassword:n.a.EncryptionKeys.Global}}])&&h(a.prototype,c),m&&h(a,m),t}();t.a=m},function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(1),r=a(3),o=a(2),s=a(38),l=a(6),u=a(65),d=a(5);function c(e){return function(e){if(Array.isArray(e)){for(var t=0,a=0,i=new Array(e.length);a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[a]=e[a]}return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(){}var f=n.a.Regexp.Prefix;h.prototype={init:function(){i.default.Assert("complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early"),document.body.addEventListener("paste",this.handlepaste.bind(this),!1),document.body.addEventListener("cut",this.handlecut.bind(this),!1),document.body.addEventListener("copy",this.handlecopy.bind(this),!1)},killEvent:function(e){i.default.Assert(e.preventDefault,"Should always be defined"),i.default.Assert(e.stopPropagation,"Should always be defined"),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},parseTextForPrefix:function(e){var t,a;return f.lastIndex=0,null!==(t=f.exec(e))&&(a=t[1],e=e.substr(t[0].length)),{prefix:a,text:e}},insertToNote:function(e,t,a){i.default.Assert(e,"Must have a valid start item"),i.default.Assert(t,"Must have a valid end item");var r,o=e.getParsedText();l.e.beginAction(),r=t===e?o.substring(0,d.a.getStartOffset())+a+o.substring(d.a.getEndOffset()):o.substring(0,d.a.getStartOffset())+a,e.setText(r,!0,n.a.ChangeType.Local),l.e.endAction()},insert:function(e,t,a){if(!d.a.isValid()||i.default.elementInNonPaneEdit(t.target))return!1;var c,h,f,p="",g=i.default.focusedPane,m=o.a.ie?"Text":"text/plain";if(a===n.a.DataSource.Plugin)f={items:[{text:e}]};else if(e&&e.getData){if(l.e.miscAction({type:l.c.Misc,misc:l.a.Paste}),this.killEvent(t),p=o.a.ie?void 0:e.getData("moodo/html")||e.getData("text/html"),!o.a.ie&&p){if(i.default.shouldLog(n.a.LogLevels.Input)&&i.default.log(p),!p)return void(i.default.shouldLog(n.a.LogLevels.Input)&&i.default.log("Paste buffer is empty"));var v,y=document.createElement("div"),_=p.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/[ ]+/g," ").replace(/\u2022/g,"").replace(/onload/gi,"never");if((v=/<body(.|\s)*?\/body>/g.exec(_))&&(_=v[0]),y.innerHTML=_,d.a.isValid()&&d.a.getStartItem().isNote())this.insertToNote(d.a.getStartItem(),d.a.getEndItem(),y.innerText);else{var b=y.children[0];2===y.children.length&&"A"===b.nodeName&&i.default.isOneNoteLink(b.href)&&(y.innerHTML=b.outerHTML),1===(f=u.a.traverseDOM({root:y,shouldPrint:!1,stripParents:!0,preserveWhitespace:!o.a.ie&&e.getData("moodo/html")})).items.length&&""===f.items[0].text&&(f=f.items[0])}}else if(p=e.getData(m)){i.default.shouldLog(n.a.LogLevels.Input)&&i.default.log(p);var k,w=p.startsWith("<?xml "),S=p.startsWith("<?opml ")||p.startsWith("<opml ")||w&&p.indexOf("<opml ")>=0;if((w||S)&&(k=i.default.loadXML(p)),k){if(w&&!S)return r.default.toasts.pushMessage({text:"We currently do not support pasting XML, please contact support@moo.do.",action:n.a.MessageAction.Contact,hold:!0}),!1;if(S){var I=d.a.getStartItem(),D=I.parent(),C=g.createVMLI({text:"OPML Import"},{parent:D,changeType:n.a.ChangeType.AllLocal});return D.insertItem(C,I.getIndex()+1),u.a.parseOPML(k,C),!1}}else{if(p.startsWith("{")&&p.endsWith("}"))try{var P=JSON.parse(p);if(u.a.parseJSON(P,d.a.getStartItem().getDocumentOwner(),d.a.getStartItem().parent()))return!1}catch(Z){}var A=i.default.parseEvernoteLink(p),M=i.default.isBearLink(p);if(A||M){var T=d.a.save(),E="Enter title of "+(A?"Evernote":M&&"Bear")+" document";return void r.default.menus.prompt(E,function(e){e&&(p="["+e+"]("+p+")"),d.a.restore(T),this.insert(p,t,n.a.DataSource.Plugin)}.bind(this))}i.default.isUrlImage(p)&&r.default.settings.showImagesInline.get()&&(p="!"+p);_=p.replace(/[\t]/g,"    ");if(d.a.getStartItem().isNote())this.insertToNote(d.a.getStartItem(),d.a.getEndItem(),_);else{var L=_.split("\n");f=u.a.parseText(L)}}}else{if(e&&e.items&&e.items.length>0)return r.default.pluginManager.handleDropEvent(t,function(e){l.e.beginAction();var t=d.a.getStartItem(),a=t.parent(),i=g.createVMLI({text:e},{parent:a,changeType:n.a.ChangeType.AllLocal});a.insertItem(i,t.getIndex()+1),l.e.endAction()}),!1;i.default.shouldLog(n.a.LogLevels.Input)&&i.default.log("Paste buffer is empty"),i.default.Assert(!1,"Paste with unexpected data type",e.types)}if(!f||!f.items||0===f.items.length)return!1}if(f){l.e.beginAction(),r.default.PaneUpdateBatcher.beginUpdateItems();var x=!0,O=d.a.getStartOffset(),R=d.a.getStartItem(),F=d.a.getEndItem(),N=d.a.getStartItem().parent(),B=d.a.getStartItem().getIndex(),U=d.a.getStartItem().getParsedText(),V=d.a.getEndItem().getParsedText();if(R!==F&&(F.isNote()&&(F=F.parent()),R!==F&&s.default.handleMultiselect({normCode:n.a.KeyCode.Backspace,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn})),c=R,1!==f.items.length||f.items[0].items&&0!==f.items[0].items.length)if(g.isViewAgenda())r.default.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),x=!1;else{var j=0,H=0;i.default.shouldLog(n.a.LogLevels.Timing)&&console.time("paste"),g.clearPreventUpdate(),d.a.getStartOffset()>0&&B++;for(var z=[],q=0;f&&q<f.items.length;++q){if(j++>5e3&&__infLoop&&__infLoop(j))throw new RangeError;var W=f.items[q];this.parseTextForPrefix(W.text);if(""!==W.text||W.items){var G=void 0;W.isNote?(G=g.createVMLI({text:W.text,isNote:!0},{parent:N,changeType:n.a.ChangeType.AllLocal}),N.setNote(G,n.a.ChangeType.Local)):(G=g.createVMLI(W,{parent:N,changeType:n.a.ChangeType.AllLocal}),N.insertItem(G,B++,!1),c=G),z.indexOf(N)<0&&z.push(N),l.e.performAction(l.c.Create,{itemID:G.id,parent:N.id,position:B-1,text:G.getParsedText()})}}for(;c.hasChildren();){if(H++>5e3&&__infLoop&&__infLoop(H))throw new RangeError;c=c.getLastChild()}h=c.getParsedText().length}else{var K=f.items[0].text,Y=O>0?this.parseTextForPrefix(K).text:K,X=U.substring(0,O),Q=V.substring(d.a.getEndOffset());!X.length||X.endsWith(" ")||Y.startsWith(" ")||(Y=" "+Y),!Q.length||Y.endsWith(" ")||Q.startsWith(" ")||(Y+=" ");var J=X+Y+Q;l.e.performAction(l.c.Remove,{itemID:R.id,position:0,text:R.getParsedText()}),R.setText(J,!0,n.a.ChangeType.Local),l.e.performAction(l.c.Insert,{itemID:R.id,position:0,text:J}),h=d.a.getStartOffset()+Y.length}r.default.PaneUpdateBatcher.commitUpdateItems(),l.e.endAction(),i.default.shouldLog(n.a.LogLevels.Timing)&&console.timeEnd("paste")}return x&&c&&(d.a.selectItem(c,h),i.default.focusedPane.scrollItemIntoView(c,n.a.ScrollDuration.Snap)),!1},handlepaste:function(e){var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;return this.insert(t,e,n.a.DataSource.Paste)},handlecut:function(e){var t=!0;if(d.a.isValid()){var a=d.a.getStartIndex(),o=d.a.getStartItem(),l=a===d.a.getEndIndex()&&d.a.getStartOffset()===d.a.getEndOffset();r.default.PaneUpdateBatcher.beginUpdateItems(),l&&d.a.setSelection(a,0,a,o.getParsedText().length),!this.handlecopy(e)&&(l?i.default.focusedPane.deleteSelected():s.default.keydown(void 0,{normCode:n.a.KeyCode.Backspace,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn}),t=!1),r.default.PaneUpdateBatcher.commitUpdateItems()}return t},padText:function(e,t){for(var a=0,i=0;i<t;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e="    "+e}return e},printLI:function(e,t,a){var i,r=e.getParsedText(),o=e.getPrefix(),s=[],l=e.priority();if(t=t||0,r=isNaN(a)?r.substring(t):r.substr(t,a-t),t>=o.length&&(r=o+r),e.hasAttachments()){var u=0;if(!isNaN(t)&&t>0)for(var d=0,c=e.getParsedText(),h=0;h<t;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;c[h]===n.a.AttachChar&&u++}i=e.generateExportText(r,u),r=e.generateTitleText()}else e.isNote()?(s.push("note"),i=r):i=r;l&&(l===n.a.VMLIFlag.P0?s.push("high"):l===n.a.VMLIFlag.P1?s.push("medium"):l===n.a.VMLIFlag.P2&&s.push("low")),e.isComplete()&&s.push("complete"),e.isStarred()&&s.push("starred");var f,p=e.getMooDate();p&&(f=p.toData());var g=o.length?r.substr(o.length):r,m=function(e){return"<li"+(s.length>0?' class="'+s.join(" ")+'"':"")+(f?' data-date="'.concat(f,'"'):"")+">"+e+"</li>"};return{html:m(g),plain:g,moodo:m(i)}},handlecopy:function(e){var t=i.default.focusedPane,a=o.a.ie?"Text":"text/plain",n=e&&e.clipboardData?e.clipboardData:window.clipboardData;if(n){var r=i.default.findParent(e.target,"exportedArea",10);if(!o.a.isMobile&&r)return!0;var s=0,u=0,h=0;if(!d.a.isValid())return!0;if(!d.a.getPane().overrideCopyBehavior)return!0;var f=d.a.getStartItem(),p=d.a.getStartIndex(),g=d.a.getEndItem(),m=d.a.getEndIndex();i.default.Assert(f&&g,"Must have valid item selections"),i.default.Assert(i.default.isVMLI(f)&&i.default.isVMLI(g),"Items must be valid VMLIs");var v,y,_=!o.a.ie,b="<ul>",k="",w="<ul>",S=1,I=[],D=f,C=p,P=f;do{if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(P!==y&&(I.push({index:C,item:P}),C!==m&&P.isCollapsed(t))){var A=0;P.hasNote()&&(y=P.getNote(),I.push({item:y,index:C+1}));for(var M=P.getItems().slice(0);M.length>0;){if(A++>5e3&&__infLoop&&__infLoop(A))throw new RangeError;var T=M.shift(),E=T.getItems();I.push({item:T}),T.hasNote()&&I.push({item:T.getNote()}),M.splice.apply(M,[0,0].concat(c(E)))}}(C=t.indexOfNextVMLI(C))>=0&&(P=t.itemAtIndex(C))}while(C>=0&&C<=m);for(var L=0;L<I.length;L++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var x=I[L],O=(x.index,x.item);if(O){var R,F,N=0;if(D){var B=O.levelsDeep.get()-D.levelsDeep.get();O.parent()===D&&B>0&&(b+="<ul>",w+="<ul>",S++)}for(var U=0;U<Math.min(S,-B);U++){if(N++>5e3&&__infLoop&&__infLoop(N))throw new RangeError;b+="</ul>",w+="</ul>",S--}S<=0&&(b+="<ul>",w+="<ul>",S++),(I.length>1||d.a.getStartOffset()!==d.a.getEndOffset())&&(R=0===L?d.a.getStartOffset():0,F=L===I.length-1?d.a.getEndOffset():void 0),v=this.printLI(O,R,F),k+=(k?"\r\n":"")+this.padText(v.plain,S-1),b+=v.html,w+=v.moodo}D=O}for(b+="</ul>",w+="</ul>",S--;S>0;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;b+="</ul>",w+="</ul>",S--}_&&b&&n.setData("text/html",b),_&&w&&n.setData("moodo/html",w),n.setData(a,k)}return o.a.ios||this.killEvent(e),l.e.miscAction({type:l.c.Misc,misc:l.a.Copy}),!1}},t.default=new h},function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(1),r=a(3),o=a(4),s=a.n(o),l=a(13),u=a(10),d=l.b.createClass({displayName:"ReactMobileFilterBar",componentDisplay:n.a.ComponentDisplay.Everywhere,onMount:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){for(var e=0,t=this.props.pane.search,a={},i=0;i<t.filters.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t.filters[i];a[n.name]=n.value}return a},openMobileFilterMenu:function(){r.default.menus.toggleContextMenu({componentName:"ReactContextMenuMobileFilter",position:"search-right",pane:this.props.pane})},renderSearchButton:function(e){var t=this.state[e.name],a=i.default.classNames("searchFilterButton selected",e.icon,{yes:t>0},{no:t<0});return s.a.createElement("div",{key:e.name,className:a})},renderSearchPriorityButton:function(e){var t=this.state[e.name],a=i.default.classNames("searchPriorityButton",{p0:t===n.a.VMLIFlag.P0},{p1:t===n.a.VMLIFlag.P1},{p2:t===n.a.VMLIFlag.P2}),r={height:n.a.PaneHeaderRow2ButtonHeight,lineHeight:n.a.PaneHeaderRow2ButtonHeight+"px"};return s.a.createElement("div",{key:e.name,className:a,style:r})},render:function(){for(var e=0,t=this.props.pane.search,a=[],i=0;i<t.filters.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.filters[i];r.enabled.get()&&this.state[r.name]&&(r.icon?a.push(this.renderSearchButton(r)):"priority"===r.name&&a.push(this.renderSearchPriorityButton(r)))}var o=a.length>0;return s.a.createElement("div",{className:"mobileFilterBar flexbox"},s.a.createElement(u.a,{icon:o?null:"icon-filter_list",iconSize:17,fontSize:14,height:n.a.PaneHeaderRow2ButtonHeight,paddingLeft:0,paddingRight:0,onClick:this.openMobileFilterMenu,ripple:!o},a))}});t.default=d},,,,,,function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(14),r=a(19),o=function(){},s=function(){return{}},l=function(){return{then:o,execute:o}};function u(){this.cache={},this.loadedGapiData={},this._isRemoteHooked=!1,this.resetListener=void 0}u.prototype={setGapiData:function(e,t){for(var a in i.default.Assert(i.default.isObject(t)&&!i.default.isArray(t),"Setting malformed data",e),this.loadedGapiData[e]=[],t)t[a].id=a,this.loadedGapiData[e].push(t[a])},setGapiDataDirect:function(e,t){i.default.Assert(i.default.isArray(t),"Setting malformed data",e),this.loadedGapiData[e]||(this.loadedGapiData[e]=t)},clearGapiData:function(){this.loadedGapiData={}},loadRemoteData:function(e,t){var a=this;i.default.Assert(e&&t,"Must supply valid remote load info as well as a cb when data is loaded");var n=e.split(":");if(this.cache[n[0]])t(JSON.parse(JSON.stringify(this.cache[n[0]][n[1]])));else{var r=!n[0].endsWith(".txt"),o=r?n[0]+".json":n[0];i.default.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+o,cb:function(e){if(200===e.status)if(r){var o=JSON.parse(e.responseText);a.cache[n[0]]=o,n[1]||(n[1]="0");var s=o[n[1]];if(s){var l=JSON.parse(JSON.stringify(s));t(l)}else i.default.log("Invalid data slot")}else{var u=e.responseText.split("\n");u="tags"===n[1]?u.map(function(e){if(e.length>0){for(var t=0,a=e.split(" "),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;Math.random()<.8&&(a[i]="#"+a[i])}e=a.join(" ")}return{text:e}}):u.map(function(e){return{text:e}}),t([{text:"Outline",items:u}])}else i.default.log("Error getting demo data",e.status,e.responseText)}})}},stubGapi:function(){i.default.Assert(!window.gapi,"Should not have loaded gapi when stubbing");var e=[];n.a.listen("resetEverything",function(){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;clearTimeout(e[a])}e=[]});var t=function(t,a){var i=setTimeout(function(){e.remove(i),t({success:!0})},0);e.push(i)};window.gapi={auth:{getToken:function(){return{expires_in:3600,expires_at:Math.floor((Date.now()+i.default.minutes(60))/1e3),access_token:"InvalidToken",id_token:"InvalidIDToken",scope:[C.GScope.UserInfoEmail,C.GScope.Calendar,C.GScope.GmailCompose,C.GScope.GmailModify]}}},client:{request:function(e){return{then:function(t,a,i){return r.a.getAPIForRequest(e)(e.__rawParams).then(t,a,i)},execute:function(){}}},load:o,setApiKey:o,newBatch:function(){return{add:o,then:t}},drive:{files:{get:l,list:l,trash:l,insert:l,patch:l},permissions:{list:l,insert:l,delete:l},properties:{insert:l},parents:{insert:l},changes:{list:l}},gmail:{users:{threads:{list:l,get:l,modify:l,trash:l,untrash:l},labels:{list:l,create:l},history:{list:l},messages:{get:l,send:l,trash:l,untrash:l},drafts:{create:l,update:l,send:l,delete:l,list:l},settings:{sendAs:{list:l}}}},calendar:{settings:{list:l},events:{get:l,list:l,patch:l,insert:l,delete:l},calendars:{insert:l},calendarList:{list:l}}}}},areRemoteFunctionsHooked:function(){return this._isRemoteHooked},hookRemoteFunctions:function(){function e(e,t){var a=0;i.default.Assert(e,"Must load local or remote data to perform queries");for(var n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e[n].id===t)return e[n]}}function t(e,t,a){i.default.Assert(e,"Must load local or remote data to perform queries");var n=[];if(i.default.isArray(a));else if(e)for(var r=0,o=0;o<e.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e[o][t]===a&&n.push(e[o])}return n}function a(e,t,a){var n=0;i.default.Assert(e,"Must load local or remote data to perform queries");for(var r=[],o=0;o<e.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e[o][t].indexOf(a)>=0&&r.push(e[o])}return r}i.default.Assert(!this._isRemoteHooked,"Should not hook remote functions more than once"),this.stubGapi(),this._isRemoteHooked=!0;var r=0,o=[],l=this;function u(e){return{then:function(e){return function(t,a,n){var s;try{s=e(n)}catch(u){i.default.reportError(u)}var l=setTimeout(function(){o.remove(l),s?t.call(n,{result:s}):a.call(n,{error:!0})},r);o.push(l)}}(e),execute:function(e){return function(t,a,i){var n=e(i),s=setTimeout(function(){o.remove(s),n?t(n):a({error:!0})},r);o.push(s)}}(e)}}n.a.listen("resetEverything",function(){for(var e=0,t=0;t<o.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;clearTimeout(o[t])}o=[]}),gapi.client.drive.files.get=function(t){return u(function(a){return e(l.loadedGapiData.Drive,t.fileId)})},gapi.client.drive.files.list=function(e){return u(function(t){if("mimeType='application/vnd.google-apps.drive-sdk.597847337936' and trashed=false"===e.q)return{items:l.loadedGapiData.documents};var n=/\'(.*)\' in parents/g.exec(e.q),r=/title contains \'([^\']*)\'/g.exec(e.q),o=/mimeType contains \'([^\']*)\'/g.exec(e.q),s=l.loadedGapiData.Drive;return n&&(s=function(e,t){var a=0;i.default.Assert(e,"Must load local or remote data to perform queries");for(var n=[],r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;(e[r].parents[0].id===t||"root"===t&&e[r].parents[0].isRoot)&&n.push(e[r])}return n}(s,n[1])),r&&(s=a(s,"title",r[1])),o&&(s=a(s,"mimeType",o[1])),{items:s}})},gapi.client.drive.files.trash=function(e){return u(s)},gapi.client.drive.files.insert=function(e){return u(s)},gapi.client.drive.files.patch=function(e){return u(s)},gapi.client.drive.permissions.list=function(e){return u(function(e){return{items:l.loadedGapiData.permissions}})},gapi.client.drive.permissions.insert=function(e){return u(s)},gapi.client.drive.permissions.delete=function(e){return u(s)},gapi.client.drive.properties.insert=function(e){return u(s)},gapi.client.gmail.users.threads.list=function(e){return u(function(a){return{threads:t(l.loadedGapiData.Gmail,"hideInPane",void 0).filter(function(t){return"me"===e.userId||t.accountID===e.userId})}})},gapi.client.gmail.users.threads.modify=function(t){return u(function(a){var i=e(l.loadedGapiData.Gmail,t.id)[0];if(!i)return{};if(i.labelIds||(i.labelIds=[]),t.removeLabelIds)for(var n=0,r=0;r<t.removeLabelIds.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i.labelIds.remove(t.removeLabelIds[r])}t.addLabelIds&&i.labelids.pushOnlyUniques(t.addLabelIds)})},gapi.client.gmail.users.threads.get=function(t){return u(function(a){return e(l.loadedGapiData.Gmail,t.id)})},gapi.client.gmail.users.messages.get=function(e){return u(function(t){return function(e,t){var a=0;i.default.Assert(e,"Must load local or remote data to perform queries");for(var n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t(e[n]);if(r)return r}}(l.loadedGapiData.Gmail,function(t){for(var a=0,i=0;i<t.messages.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.messages[i].id===e.id)return t.messages[i]}})})},gapi.client.gmail.users.messages.send=function(e){return u(function(t){return{id:i.default.generateTempId(),threadId:e.resource.threadId||i.default.generateTempId().substr(3),labelIds:["SENT","UNREAD"]}})},gapi.client.gmail.users.labels.list=function(e){return u(function(e){return{labels:l.loadedGapiData.Gmail_Labels}})},gapi.client.gmail.users.labels.create=function(e){return u(function(a){var n=t(l.loadedGapiData.Gmail_Labels,"name",e.resource.name)[0];if(n)return n;var r=i.default.generateTempId().substr(3);return n={name:e.resource.name,id:r},l.loadedGapiData.Gmail_Labels||(l.loadedGapiData.Gmail_Labels=[]),l.loadedGapiData.Gmail_Labels.push(n),n})},gapi.client.gmail.users.settings.sendAs.list=function(e){return u(function(e){return{sendAs:[{displayName:"Demo User",isDefault:!0,isPrimary:!0,replyToAddress:"",sendAsEmail:"demo@moo.do",signature:""}]}})},gapi.client.calendar.calendarList.list=function(e){return u(function(e){return{items:l.loadedGapiData.calendarList}})},gapi.client.calendar.events.get=function(t){return u(function(a){return e(l.loadedGapiData.GCalendar,t.eventId)})}}},t.default=new u},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t);var i=a(22),n=a(0),r=a(11),o=a(1),s=a(3),l=(a(90),a(12)),u=a(2),d=a(14),c=a(18),h=a(91),f=a(6),p=a(52),g=a(5),m=a(7);function v(){this.isVisible=new m.a(!1),this.mode=new m.a,this.aboutToShow=void 0,this.bottomPosition=new m.a(0),this.scrollVal=0,this.topBarHidden=!1,this.init()}v.prototype={init:function(){d.a.listen("closeKeyboard",this.hide.bind(this))},preShow:function(){n.default.shouldLog(o.a.LogLevels.Toolbar)&&n.default.log("Pre-Show Keyboard Menu"),this.aboutToShow=!0,setTimeout(function(){this.aboutToShow=!1}.bind(this),100)},show:function(e){this.aboutToShow=!1,n.default.shouldLog(o.a.LogLevels.Toolbar)&&n.default.log("Show Keyboard Menu"),this.updatePosition(),this.mode.set(e),n.default.isKeyboardOpen=!0,(!u.a.ie||u.a.ie&&(u.a.mobro||u.a.winphone))&&this.isVisible.set(!0),setTimeout(function(){f.e.miscAction({type:f.c.Mobile,misc:f.b.OpenKeyboard})},0)},hide:function(){!this.aboutToShow&&n.default.isKeyboardOpen?(n.default.shouldLog(o.a.LogLevels.Toolbar)&&n.default.log("Hide Keyboard Menu"),n.default.isKeyboardOpen=!1,n.default.focusedPane.removePadding(),n.default.onCloseKeyboard(),this.hideTopBarIfLandscape(),this.isVisible.set(!1),f.e.miscAction({type:f.c.Mobile,misc:f.b.CloseKeyboard})):n.default.shouldLog(o.a.LogLevels.Toolbar)&&n.default.log("Hide Keyboard Menu [SKIPPED]")},shouldHideTopBar:function(){return u.a.orientation===o.a.Orientation.Landscape&&(n.default.isKeyboardOpen||this.aboutToShow)&&!n.default.getActiveSearch().UI.isFocused},hideTopBarIfLandscape:function(){this.shouldHideTopBar()?(n.default.setTransform(n.default.element("outerWrapper"),0,-n.default.topBarHeight),this.topBarHidden=!0):this.topBarHidden&&(this.topBarHidden=!1,n.default.setTransform(n.default.element("outerWrapper"),0,0))},updatePosition:function(){var e=u.a.getKBSize()-(this.shouldHideTopBar()?n.default.topBarHeight:0);e!==this.bottomPosition.get()&&this.bottomPosition.set(e),n.default.isKeyboardOpen&&n.default.focusedPane.addPadding()},getScroll:function(){return this.scrollVal},setScroll:function(e){this.scrollVal=e}};var y=new v,_=a(4),b=a.n(_),k=a(24),w=a(54);function S(e,t,a){this.isComplete=new m.a(!1),this.id=e,this.text=t,this.noRender=a,this.items=[],this.inOrder=!1,this.enforceOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0}S.prototype={defaultShow:function(){this.isDisabled.set(!1)},loadFromSaveData:function(e){var t=0;this.numComplete=0;for(var a=0,i=0;i<this.items.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.items[i];e[r.id]&&(r.isComplete.set(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,i+1))),r.hiddenObservable&&r.hiddenObservable.get()||r.visibleObservable&&!r.visibleObservable.get()||a++}if((this.numComplete===a||e[this.id])&&this.isComplete.set(!0),this.inOrder&&0!==this.next&&this.next<a){var o=this.items[this.next];o&&(o.show(),!n.default.isKeyboardOpen&&this.owner.needsKeyboardOpen&&n.default.tooltip.hideTip())}},saveData:function(e,t){for(var a=0,i=0;i<this.items.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this.items[i];n.default.Assert(r,"Item entries must exist"),r.isComplete.get()&&(e[r.id]=1)}t&&this.isComplete.get()&&(e[this.id]=1)},addStep:function(e){n.default.Assert(!!e.id===!!e.check,"Invalid help step"),!1!==e.if&&(e.isComplete||(e.isComplete=new m.a(!1)),this.inOrder&&!u.a.isMobile?e.isDisabled||(e.isDisabled=new m.a(this.items.length>0)):e.isDisabled=new m.a(!1),e.isHotkeyOr=e.isHotkeyOr,e.show||(e.show=this.defaultShow.bind(e)),this.items.push(e))},complete:function(e){e.isComplete.get()||(e.isComplete.set(!0),this.numComplete++,this.numComplete===this.items.length&&this.isComplete.set(!0),this.owner.notifyOfChange(e))},forceComplete:function(){this.isComplete.set(!0),this.numComplete=this.items.length,this.owner.notifyOfChange()},check:function(e){var t=0;n.default.Assert(!this.isComplete.get(),"Should never be checking items in a completed section");for(var a=0;a<this.items.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.items[a];if(!i.isComplete.get()&&((!0===e||i.check&&i.check(e))&&(this.complete(i),this.inOrder&&a===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].show())),this.enforceOrder))break}}};var I=S,D=a(10),C={display:"inline-block",height:"24px"};function P(){s.default.menus.openSettings(o.a.SettingsSections.Plugins)}function A(){u.a.isMobile||(n.default.intro=this)}A.prototype={init:function(){var e=this;this.mode=new m.a(o.a.HelpMode.None),this.position=new m.a,this.sections=new k.a,this.isVisible=new w.a([this.mode],function(){return this.isHelpShowing()}.bind(this)),this.priKey=u.a.priModKey,this.secKey=u.a.secModKey,this.secKeyForce=u.a.secModKeyForce,this.tooltipIntroSection=void 0;var t=s.default.settings.helpPaneState.get();void 0===t&&(t=o.a.HelpMode.None),this.initItemsDesktop(),n.default.isDemoMode()||(this.initState(t),!u.a.isMobile&&s.default.settings.inTooltipIntro.get()&&this.tooltipIntroSection.isComplete.get()&&s.default.settings.inTooltipIntro.set(!1)),s.default.settings.helpPaneState.listen(function(t,a){void 0!==t&&t!==a&&e.initState(t)}),s.default.settings.helpState.listen(function(t,a){t&&t!==a&&e.loadState()}),f.e.addListener(this.onAction.bind(this))},isHelpShowing:function(){return this.mode.get()!==o.a.HelpMode.None},initState:function(e){n.default.Assert(void 0!==e,"Must pass in a valid intro mode"),this.sections.clear(),this.mode.set(e),this.isHotkeyMode()||this.initHelp(),!u.a.isMobile&&s.default.settings.inTooltipIntro.get()&&this.initTooltipIntro(),this.loadStateLegacy(),this.loadState()},initItemsDesktop:function(){this.itemIndent={id:"458052715",text:'Press <span class="hHotkey">Tab</span> to indent an item into a list and <span class="hHotkey">Shift + Tab</span> to unindent out of a list',check:this.checkIndent},this.itemDateTime={id:"321249113",text:"Add a date/time by typing @ in the text of an item",check:this.checkDate},this.itemRightClick={id:"3288459206",text:"Right click an item to explore more options",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.RightClick}};var e=n.default.vmMain.getDefaultEmailPlugin(),t=s.default.pluginManager.getPlugin(o.a.PluginID.GCalendar),a=s.default.pluginManager.getPlugin(o.a.PluginID.Drive);this.itemPluginSettings={id:"ep",jsx:b.a.createElement("span",null,b.a.createElement("span",{style:C},b.a.createElement(D.a,{raised:!0,primary:!0,marginRight:8,onClick:P},"Enable plugins")),"to connect to your other services"),hiddenObservable:new w.a([e.isActiveObs,t.isActiveObs,a.isActiveObs]),check:function(){}},this.itemOpenEmail={id:"dblE",text:"Double click an email to open it",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.OpenEmail&&e.data.pane.type===o.a.PaneMode.Gmail}},this.itemDragEmail={id:"drgEm",text:"Drag an email to your Tasks to organize it",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===o.a.PaneMode.Gmail}},this.itemRightClickEmail={id:"rcE",text:"Right click an email to explore more options",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.RightClick&&e.data.pane.type===o.a.PaneMode.Gmail}},this.itemGmailLabels={id:"lbls",text:'Click <i class="overviewButtonNormal icon-menu g"></i> in the top left to access your labels',check:function(e){return e.type===f.c.Misc&&e.misc===f.a.ToggleOverview&&e.data.pane.type===o.a.PaneMode.Gmail}},this.itemGmailCompose={id:"cmp",text:'Click <i class="icon-edit2 g"></i> in the sidebar to compose a new email',check:function(e){return e.type===f.c.Misc&&e.misc===f.a.ComposeEmail}}},setMode:function(e){this.mode.set(e),s.default.settings.helpPaneState.set(e)},show:function(e){this.setMode(e||o.a.HelpMode.Normal)},toggle:function(e){!this.isHelpShowing()||e&&this.mode.get()!==e?this.show(e):this.close()},close:function(){n.default.tooltip.hideTip(),this.setMode(o.a.HelpMode.None),n.default.sendEvent("Menu","CloseHelp")},isHotkeyMode:function(){return this.mode.get()===o.a.HelpMode.Hotkeys},loadStateLegacy:function(){if(n.default.shouldWriteLocal())try{var e=c.a.getValue("help");if(e){var t=JSON.parse(e);if(t){for(var a=0,i=0;i<this.sections.get().length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.sections.get()[i].loadFromSaveData(t)}console.log("found old data and migrating it"),this.saveState(),c.a.removeValue("help")}}}catch(r){n.default.reportError(r)}},_getHelpStateObj:function(){var e={},t=s.default.settings.helpState.get();if(n.default.isString(t)){if(t)try{(e=JSON.parse(t))&&!n.default.isString(e)||(e={})}catch(a){n.default.reportError(a)}}else e=t;return e||{}},loadState:function(){var e=this._getHelpStateObj();if(e)for(var t=0,a=0;a<this.sections.get().length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.sections.get()[a].loadFromSaveData(e)}},saveState:function(){if(n.default.shouldWriteLocal())try{var e=this.getState();0,s.default.settings.helpState.set(JSON.stringify(e))}catch(t){n.default.reportError(t)}},getState:function(){for(var e=0,t=this._getHelpStateObj(),a=0;a<this.sections.get().length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sections.get()[a].saveData(t)}return t},notifyOfChange:function(){this.saveState()},createSection:function(e,t,a,i){var n=0,r=new I(e,t,i);r.owner=this;for(var o=0;o<a.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r.addStep(a[o])}return r},addSection:function(e,t,a,i){var n=this.createSection(e,t,a,i);return this.sections.push(n),n},checkAddItem:function(e){if(e.type===f.c.Create){l.a.getItem(e.data[0].itemID);return!1}},checkIndent:function(e){if(e.type===f.c.Move){var t=e.data[0].oldParent;if(t&&t.items.get().indexOf(e.data[0].newParent)>=0)return!0}},checkSearch:function(e){return e.type===f.c.Misc&&e.misc===f.a.SearchChanged},checkComplete:function(e){if(e.type===f.c.Update){var t=e.data[0];return"isComplete"===t.field&&t.newValue}},checkOverview:function(e){return e.type===f.c.Misc&&e.misc===f.a.ToggleOverview},checkZoom:function(e){return e.type===f.c.Zoom&&!e.data[0].zoomOut&&n.default.focusedPane.overview.isVisible.get()},checkPriority:function(e){var t=e.data[0];return e.type===f.c.Update&&"priority"===t.field&&t.newValue>0},checkDate:function(e){return e.type===f.c.Insert&&"@"===e.data[0].text},checkGoogleCalendar:function(e){return e.type===f.c.Misc&&e.misc===f.a.AddToGCal},checkGoogleDrive:function(){},initHelp:function(){function e(){s.default.menus.openContextMenu({componentName:"ReactContextMenuOptions",element:"optionsButton"})}this.sections.clear(),this.addSection("2102025841","Organization",[this.itemIndent,{id:"3825397189",text:"Click and drag on the left edge of an item to move it",check:function(e){if(e.type===f.c.Misc&&e.misc===f.a.DropItem&&n.default.isLoaded)return!0}},{id:"441256378",text:'Click the left edge of a list or press <span class="hHotkey">'+this.secKey+" + ,</span> to collapse its subitems",check:function(e){if(e.type===f.c.Update){var t=e.data[0];return"isCollapsed"===t.field&&t.newValue}}}]),this.addSection("prefixes","Item Prefixes",[{id:"header",text:"Start a line with "+o.a.Prefix.Header+" to create a project",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.SetPrefix&&e.data.prefix===o.a.Prefix.Header}},{id:"task",text:"Start a line with [ to create a task",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.SetPrefix&&e.data.prefix===o.a.Prefix.Task}},{id:"bullet",text:"Start a line with - to create a bullet",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.SetPrefix&&(e.data.prefix===o.a.Prefix.Bullet||e.data.prefix===o.a.Prefix.Bullet2||e.data.prefix===o.a.Prefix.Bullet3)}},{id:"numlist",text:"Start a line with 1. to create a numbered list",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.SetPrefix&&e.data.prefix===o.a.Prefix.NumList}}]),this.addSection("cal","Google Calendar (Premium)",[{id:"enableCalendar",jsx:b.a.createElement("span",null,b.a.createElement(D.a,{raised:!0,primary:!0,marginRight:8,onClick:P},"Enable Google Calendar"),"to sync Google Calendar."),hiddenObservable:s.default.pluginManager.getPlugin(o.a.PluginID.GCalendar).isActiveObs,check:function(){}},{id:"adc2",text:'Add an item with a date to Google Calendar by pressing <span class="hHotkey">'+this.secKeyForce+' + C</span> or right clicking the date.<span style="color: #777;"></span>',check:this.checkGoogleCalendar}]),this.addSection("3971635305","Priority",[this.itemRightClick,{id:"215510164",text:'Set a priority with the right click menu or <span class="hHotkey">'+this.secKey+" + 1|2|3</span>",check:this.checkPriority},{id:"2165585377",text:'Click the right edge of an item or <span class="hHotkey">'+this.secKey+" + /</span> to complete it",check:this.checkComplete},{id:"4286506454",text:'Press <span class="hHotkey">'+this.secKey+" + 8</span> to star an item and highlight it in yellow",check:function(e){if(e.type===f.c.Update){var t=e.data[0];return"isStarred"===t.field&&t.newValue}}}]),this.addSection("4240025947","Contacts",[{id:"9158366",text:"Add a contact by typing + in the text of an item",check:function(e){return e.type===f.c.Insert&&"+"===e.data[0].text}},{id:"1594166733",text:'Click on a <span class="contact c-contact">+contact</span> to start a call or email',check:function(e){return e.type===f.c.Misc&&e.misc===f.a.OpenContact}}]),this.addSection("1493247039","Zooming",[{id:"1829655333",text:'To zoom in on an item, right click it and select Zoom In, press <span class="hHotkey">'+this.priKey+' + Enter</span>, or hold <span class="hHotkey">'+this.priKey+"</span> and click its left edge",check:function(e){return e.type===f.c.Zoom&&!e.data[0].zoomOut}},{id:"3440644647",text:"To zoom back out, click the title of the list in the top of the pane",check:function(e){return e.type===f.c.Zoom&&e.data[0].zoomOut}},{id:"801492595",text:'Press <i class="overviewButtonNormal icon-menu g"></i> in the top left of a pane to open the overview',check:this.checkOverview},{id:"1720747864",text:'Click an item in the Overview to scroll to it or click <i class="icon-zoom-in g"></i> to zoom into it',check:this.checkZoom}]),this.addSection("1393893782","Search",[{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function(e){return e.type===f.c.Insert&&e.data[0].text===o.a.TagPrefix}},{id:"2783340419",text:'Filter by priority by clicking the <span class="searchPriority searchP0 hovered"></span> <span class="searchPriority searchP1 hovered"></span> <span class="searchPriority searchP2 hovered"></span> buttons',check:function(e){return e.type===f.c.Misc&&e.misc===f.a.SearchChanged&&0!==e.data.priority}},{id:"923656242",text:'Show only starred items by clicking the <span class="c-foreground-faded icon-star"></span> button',check:function(e){return e.type===f.c.Misc&&e.misc===f.a.SearchChanged&&0!==e.data.starred}},{id:"2227925102",text:'Hide completed items by clicking the <span class="c-foreground-faded icon-check"></span> button',check:function(e){return e.type===f.c.Misc&&e.misc===f.a.SearchChanged&&0!==e.data.complete}},{id:"457209713",text:"Hide items you're not interested in by starting a search with - (dash)",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.SearchChanged&&e.data.text.indexOf("-")>=0}}]),this.addSection("gm","Gmail",[{id:"eG",jsx:b.a.createElement("span",null,b.a.createElement(D.a,{raised:!0,primary:!0,marginRight:8,onClick:P},"Enable Gmail"),"to sync Gmail."),hiddenObservable:s.default.pluginManager.getPlugin(o.a.PluginID.Gmail).isActiveObs,check:function(){}},this.itemOpenEmail,this.itemDragEmail,this.itemRightClickEmail,this.itemGmailLabels]),this.addSection("formatting","Formatting",[{id:"format",text:"Format text like <i>*italic*</i>, <b>**bold**</b>, or <b><i>***both***</i></b>",check:function(e){}},{id:"link",text:"Insert links like [title](http://address.com)",check:function(e){}},{id:"hr",text:"--- to insert a horizontal line",check:function(e){}}]),this.addSection("327865517","Collaboration",[{id:"3453735943",jsx:b.a.createElement("span",null,b.a.createElement("span",{style:C},"Click the ",b.a.createElement(D.a,{icon:"icon-folder",iconSize:18},"File"))," in the options button to open the Files menu"),check:function(e){return e.type===f.c.Misc&&e.misc===f.a.OpenDocumentsMenu}},{id:"4176091097",text:'Click <i class="icon-settings f18 g"></i> to change the sharing settings',check:function(e){return e.type===f.c.Misc&&e.misc===f.a.OpenDocSharing}}]),this.addSection("drv","Google Drive (Premium)",[{id:"eD",jsx:b.a.createElement("span",null,b.a.createElement(D.a,{raised:!0,primary:!0,marginRight:8,onClick:P},"Enable Google Drive"),"to sync Google Drive."),hiddenObservable:s.default.pluginManager.getPlugin(o.a.PluginID.Drive).isActiveObs,check:function(){}},{id:"drL",text:"Drag a file from the Google Drive Pane to an Task Pane to add it to a list",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===o.a.PaneMode.Drive}},{id:"drDr",text:"Drag a file from your "+(u.a.mac?"Finder":"Explorer")+" to your Tasks to upload it to Drive and add it to a list",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.DriveUpload}}]),this.addSection("set","Settings",[{id:"oS",jsx:b.a.createElement("span",null,"Click ",b.a.createElement("span",{style:C},b.a.createElement(D.a,{icon:"icon-settings",iconSize:18,onClick:e}))," in the sidebar, then Settings, to access plugin and account settings."),check:function(e){return e.type===f.c.UIAction&&e.data[0].type===f.d.OpenSettingsMenu}},{id:"oDS",jsx:b.a.createElement("span",null,"Click ",b.a.createElement("span",{style:C},b.a.createElement(D.a,{icon:"icon-settings",iconSize:18,onClick:e}))," in the sidebar, then Display Settings, to change display settings."),check:function(e){return e.type===f.c.UIAction&&e.data[0].type===f.d.OpenDisplaySettings}}]),this.addSection("3926176240","Data",[{id:"1927292896",jsx:b.a.createElement("span",null,"Click on Import Data in the options menu in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please ",b.a.createElement(D.a,{primary:!0,onClick:function(){s.default.menus.openModal(o.a.Modals.ReportBug)}},"contact us")," and tell us what app you want to import from."),check:function(e){return e.type===f.c.Misc&&e.misc===f.a.OpenImport}},{id:"67562060",text:"Click on Export Data in the options menu in the sidebar, then choose the format you'd like.",check:function(e){return e.type===f.c.Misc&&e.misc===f.a.OpenExport}}])},onAction:function(e){if(!s.default.menus.isModalOpen(o.a.Modals.ImportData))try{for(var t=0,a=this.sections.get(),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[i].isComplete.get()||a[i].check(e)}}catch(r){n.default.reportError(r)}},runTooltipIntro:function(){s.default.settings.inTooltipIntro.set(!0),this.initTooltipIntro()},initTooltipIntro:function(){function e(){return s.default.pluginManager.isGmailPaneEnabled()}function t(e){n.default.Assert(e,"Must supply a valid tooltip descriptor"),n.default.Assert(!e||e.element,"Must specify a valid target tooltip element"),n.default.tooltip.hideSticky(e.text),e.blue=!0,"top"===e.arrowDirection&&(e.offset={top:15}),n.default.tooltip.displayTipSticky(e)}var a,i,r,l=[];function c(e){var a=!1;l.push({id:e.id,check:function(i){return!(!e.check2Invalidates1||!e.check2(i))||(e.check1(i)?(setTimeout(function(){var i=n.default.isFunction(e.element)?e.element():e.element,r=n.default.isFunction(e.text)?e.text():e.text;i&&(a=!0,t({text:r,element:i,arrowDirection:e.arrowDirection,onRight:e.onRight}))},1e3),!0):void 0)}}),l.push({id:e.id+"_complete",check:function(t){if(e.check2(t)){if(a){var i=n.default.isFunction(e.text)?e.text():e.text;n.default.tooltip.hideSticky(i)}return!0}}})}if(c({id:"tipAddPaneMenu",text:"Click here to add a new pane",element:function(){return n.default.element("addPaneButton")},arrowDirection:"left",check2Invalidates1:!0,check1:this.checkAddItem,check2:function(e){return e.type===f.c.Misc&&e.misc===f.a.OpenAddPaneMenu}}),c({id:"tipAddPane",text:function(){return e()?"Add a Gmail pane to organize your email":"Add another Task pane to get another view on your tasks."},element:function(){return e()?n.default.element("addPane_PaneGmail"):n.default.element("addPane_PaneTask")},arrowDirection:"left",check2Invalidates1:!0,onRight:!0,check1:function(e){return e.type===f.c.Misc&&e.misc===f.a.OpenAddPaneMenu},check2:function(t){return t.type===f.c.UIAction&&t.data[0].type===f.d.AddPane&&t.data[0].data.type===(e()?o.a.PaneMode.Gmail:o.a.PaneMode.Task)}}),c({id:"tipNewTaskPane",text:"Each Task pane is a unique view on the same data. Customize your view by searching and filtering.",element:function(){if(a){var e=a.element;if(e)return e.getElementsByClassName("searchWrap")[0]}},arrowDirection:"top",check1:function(e){if(e.type===f.c.UIAction&&e.data[0].type===f.d.AddPane&&e.data[0].data.type===o.a.PaneMode.Task)return a=e.data[0].data.pane,!0},check2:function(e){return e.type===f.c.Misc&&e.misc===f.a.SearchChanged}}),c({id:"tipNewGmailPane",text:"Try dragging an email to your Task Pane",element:function(){if(i){var e=i.element;if(e)return e.getElementsByClassName("paneContent")[0]}},arrowDirection:"bottom",check2Invalidates1:!0,check1:function(e){if(e.type===f.c.UIAction&&e.data[0].type===f.d.AddPane&&e.data[0].data.type===o.a.PaneMode.Gmail&&s.default.PaneManager.getPanesByType(o.a.PaneMode.Task).length>0)return i=e.data[0].data.pane,!0},check2:function(e){return e.type===f.c.Misc&&e.misc===f.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===o.a.PaneMode.Gmail}}),c({id:"tipNewGmailPane",text:"Each board is a different set of panes. Add a new pane to start setting up your new board.",element:function(){return n.default.element("addPaneButton")},arrowDirection:"left",onRight:!0,check1:function(e){return e.type===f.c.UIAction&&e.data[0].type===f.d.AddBoard},check2:function(e){return e.type===f.c.UIAction&&e.data[0].type===f.d.AddPane}}),c({id:"tipAddToCalendar",text:function(){return"Sync items with dates to Google Calendar by pressing "+u.a.secModKeyForce+" + C"},element:function(){var e=g.a.getStartElement();if(e)return e.getElementsByClassName("date")[0]},arrowDirection:"top",check1:function(e){if(e.type===f.c.Misc&&e.misc===f.a.ChangeDate&&n.default.isLoaded&&s.default.pluginManager.getPlugin(o.a.PluginID.GCalendar).isActive())return!0},check2:function(e){return e.type===f.c.Misc&&e.misc===f.a.AddToGCal}}),c({id:"tipOverviewButton",text:"Toggle the Overview open and closed",element:function(){var e=r.element;if(e)return e.getElementsByClassName("overviewButton")[0]},arrowDirection:"top",check1:function(e){if(e.type===f.c.Zoom)return r=e.data[0].pane,!0},check2:this.checkOverview,check2Invalidates1:!0}),s.default.settings.shouldShowHelp("helpTooltip")){setTimeout(function e(){if(n.default.tooltip.isOpenSticky())setTimeout(e,5e3);else if(s.default.settings.closeHelp("helpTooltip"),n.default.element("helpButton")){var a={text:"See the Help to learn more",element:n.default.element("helpButton"),arrowDirection:"left",onRight:!0};d.a.listen("helpOpened",function e(){n.default.tooltip.hideSticky(a.text),d.a.unlisten("helpOpened",e)}),t(a)}},9e4)}this.tooltipIntroSection=this.addSection("tooltipIntro","Tooltip Intro",l,!0)}};new A;var M=a(15),T=a(26);function E(){var e=this;this._items=new k.a,this._remoteItems=void 0,this._localLoaded=!1,this._cache=s.default.cacheManager.registerLocalCache("QuickAdd","QuickAdd",o.a.StorageType.IndexedDB),this._itemStore=s.default.itemStoreManager.registerItemStore("QuickAdd",this,{isReadonly:!0}),this._itemStore.createRoot("QuickAddRoot","Quick Add"),this._cache.onCacheReady(function(){e._cache.loadAll(function(t,a){t&&e._notifyLocalItems(a)})})}E.prototype={notifyRemoteItems:function(e){s.default.settings.lastQuickAddSync.set(new Date),this._localLoaded?(this._remoteItems=void 0,this._cache.onCacheReady(function(){var t=0;s.default.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];if(i.dateConsumed)!!this.removeTextEntry(i.quickAddID)&&this._cache.removeEntry(i.quickAddID);else this.addTextEntry(i.quickAddID,i.text,i.note)&&this._cache.cacheEntry(i.quickAddID,{id:i.quickAddID,isPersisted:!0,text:i.text,note:i.note})}s.default.PaneUpdateBatcher.commitUpdateItems()}.bind(this))):this._remoteItems=e},_notifyLocalItems:function(e){var t=0;s.default.PaneUpdateBatcher.beginUpdateItems();for(var a=0;e&&a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];this.addTextEntry(i.id,i.text,i.note),i.isPersisted||this.persistTextEntry(i.id,!0)}this._localLoaded=!0,this._remoteItems&&this.notifyRemoteItems(this._remoteItems),s.default.PaneUpdateBatcher.commitUpdateItems()},runQuickAddSync:function(e){n.default.XHR_PrivateAPI({type:"POST",path:"/quick/list",data:{lastQuickAddSync:this.getLastSyncDate()},requireAuth:!0,cb:function(t){if(t.status===o.a.HTTPStatusCode.Success)try{var a=JSON.parse(t.response).data;a.quickAddItems&&(n.default.Assert(n.default.isArray(a.quickAddItems),"Must be an array of items"),this.notifyRemoteItems(a.quickAddItems))}catch(i){n.default.reportError(i)}e&&e()}.bind(this)})},getLastSyncDate:function(){var e=s.default.settings.lastQuickAddSync.get();return n.default.Assert(!e||n.default.isString(e),"Must have a valid string sync date"),e},addItemEntry:function(e,t){this.hasItemEntry(e)||this._items.push({id:e.id,item:e,pane:t})},addTextEntry:function(e,t,a){var i=!1;if(!this.hasTextEntry(e)){var n=this._itemStore.getRoot(),r=this._itemStore.createItem(e,t,n.id,o.a.ChangeType.Local);n.insertItem(r,0),this._items.push({id:e,isText:!0,item:r,text:t,note:a}),i=!0}return i},removeItemEntry:function(e){var t=this._items.indexOfWithProperty("id",e.id);if(t>=0)return this._items.splice(t,1)[0]},removeTextEntry:function(e){var t=this._items.indexOfWithProperty("id",e);if(t>=0)return this._items.splice(t,1)[0]},hasItemEntry:function(e){var t=this.getItemEntry(e);return!(!t||t.isText)},hasTextEntry:function(e){var t=this.getTextEntry(e);return!(!t||!t.isText)},getItemEntry:function(e){var t=this._items.indexOfWithProperty("id",e.id);return this._items.get()[t]},getTextEntry:function(e){var t=this._items.indexOfWithProperty("id",e);return this._items.get()[t]},getItems:function(){return this._items},_notifyPersisted:function(e){var t=this.getTextEntry(e);t&&this._cache.onCacheReady(function(){this._cache.cacheEntry(e,{id:e,text:t.text,note:t.note,isPersisted:!0})}.bind(this))},_notifyConsumed:function(e){this._cache.onCacheReady(function(){this._cache.removeEntry(e)}.bind(this))},persistTextEntry:function(e,t){var a=this;T.a.onLoaded(function(){a._persistTextEntry(e,t)})},_persistTextEntry:function(e,t){n.default.Assert(this.hasTextEntry(e),"Must be persisting a valid text entry");var a=this.getTextEntry(e);if(a){t||this._cache.onCacheReady(function(){this._cache.cacheEntry(e,{id:e,text:a.text,note:a.note,isPersisted:!1})}.bind(this));var i={quickAddID:e,text:a.text};a.note&&(i.note=a.note),n.default.XHR_PrivateAPI({type:"POST",path:"/quick/add",data:i,requireAuth:!0,cb:function(t){if(t.status===o.a.HTTPStatusCode.Success)this._notifyPersisted(e);else if(t.status===o.a.HTTPStatusCode.BadRequest)try{JSON.parse(t.responseText).code===o.a.PrivateAPIErrorCodes.AlreadyExists&&this._notifyPersisted(e)}catch(a){n.default.reportError(a)}}.bind(this)})}},consumeTextEntry:function(e){n.default.Assert(this.hasTextEntry(e),"Must be persisting a valid text entry"),this.removeTextEntry(e),this._cache.onCacheReady(function(){this._cache.removeEntry(e)}.bind(this));var t={quickAddID:e};n.default.XHR_PrivateAPI({type:"POST",path:"/quick/consume",data:t,requireAuth:!0,cb:function(t){t.status===o.a.HTTPStatusCode.Success&&this._notifyConsumed(e)}.bind(this)})},hasItems:function(){return this._items.get().length>0}};var L=E,x=a(40),O=a(35),R=a(32),F=a(34),N=function(){var e={isLoaded:!1,isRendered:new m.a(!1),isInit:!1,_hasDisplayedArchivedItems:!1,isPhone:u.a.phone,help:void 0,lastActivity:Date.now(),paneFactory:p.a,_itemAnimationMode:o.a.ItemAnimationMode.Normal,isDisplaySettingsOpen:new m.a(!1),failedInitialDocLoad:new m.a(!1),activeInput:new m.a(null),_isShowingTrashedDocumentError:new m.a(!1),cursor:new m.a,loadedImages:{}};n.default.vmMain=e,e.getUserEmail=function(){},Rollbar.configure({payload:{environment:u.a.getDeployVar(o.a.DeployVariable.Environment),person:{id:n.default.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:o.a.__jsVersion,guess_uncaught_frames:!0}}},maxItems:o.a.__MAX_ERRORS_REPORTED,checkIgnore:n.default.rollbarIgnoreFn}),e.remoteAPI=function(){return s.default.pluginManager.getPlugin(o.a.PluginID.Moodo)},e.loadPlugins=function(){},e.getDefaultCalendarPlugin=function(){var e,t=s.default.pluginManager.getPlugin(o.a.PluginID.GCalendar);return(n.default.isDemoMode()||t.getSetting(t.Settings.IsEnabled))&&(e=t),e},e.showTrashedDocumentError=function(){e._isShowingTrashedDocumentError.set(!0),s.default.PaneManager.clearLoadTimeout()},e.clearTrashedDocumentError=function(){e._isShowingTrashedDocumentError.set(!1)},e.notifyFailedLoad=function(){w||e.failedInitialDocLoad.set(!0)},e.notifySuccessfulLoad=function(){e.failedInitialDocLoad.set(!1),r.a.hasURLParam("sinfo")&&r.a.removeURLParam("sinfo")},e.getDefaultEmailPlugin=function(){return s.default.pluginManager.getPlugin(o.a.PluginID.Gmail)},e.isOnline=function(){},e.isReconnecting=function(){},e.isLocal=function(){return"localhost"===window.location.hostname},e.canRunUndoRedo=function(){return e.isOnline()||f.e.allowOfflineUndo},e.getUserDomain=function(){},e.getUserID=function(){},e.isDemoMode=function(){return n.default.isDemoMode()},e.onlineText=function(){var e=l.a.onlineStatus.get();return(n.default.isDemoMode()?"DEMO":e===o.a.OnlineStatus.Connecting&&"Syncing")||e===o.a.OnlineStatus.Offline&&"OFFLINE"||e===o.a.OnlineStatus.Online&&!u.a.isMobile&&"Online"||""},e.init=function(){n.default.Assert(!e.isInit,"Should never double init VMMain, may cause severe issues"),e.isInit=!0,h.default.init(),x.a.init(),e.loadPlugins(),e.dropBucket=new L,u.a.isMobile||n.default.intro.init(),d.a.fireEvent("VMMainLoaded",[]),u.a.demo||(window.onbeforeunload=e.onUnload)},e.hasDisplayedArchivedItems=function(){return e._hasDisplayedArchivedItems};var t={},a=!1,i=void 0;e.addParseItem=function(e,r){n.default.Assert(a,"Must be marked as queueing items"),n.default.Assert(r===i,"ChangeType of queue must match"),t[e.id]=e},e.beginQueuedParseItems=function(e){n.default.Assert(!a,"Should not be already queueing parse items"),a||(a=!0,i=e)},e.flushParseItems=function(){if(n.default.Assert(a,"Must be marked as queueing items before flushing"),a){a=!1;try{for(var r in t){var o=t[r];e.runSingleParse(o,i)}}catch(s){n.default.reportError(s)}t={},i=void 0}},e.parseAll=function(t){l.a.runOnAllDocumentRoots(function(a){e.parseSubtree(a,t)})},e.parseSubtree=function(t,a){var i=0;n.default.Assert(t,"Must supply a valid item to parse"),e.runSingleParse(t,a);for(var r=t.getItems(),o=0;o<r.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.parseSubtree(r[o],a)}},e.runFnOnSubtree=function(t,a){var i=0;a(t);for(var n=t.getItems(),r=0;r<n.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.runFnOnSubtree(n[r],a)}},e.runSingleParse=function(e,t){n.default.Assert(e,"Must have a valid item to parse"),n.default.Assert(!a,"Should not run single parse while queueing item parses");var i={};e.parseText(!0,t,i)&&l.a.saveItemLocal(e,i,o.a.SaveFlag.None)},e.createWorkerFromObj=function(e,t,a){var i;try{(i=new Worker(e)).onmessage=t,i.onerror=a}catch(r){n.default.reportError(r)}return i},e.createWorkerFromFnList=function(t,a,i){n.default.Assert(!u.a.ie,"IE does not support creating workers from blob URLs");var r=[];try{for(var o=0,s=0;s<t.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;r.push(window[t[s]].toString()),r.push(t[s]+"();")}}catch(l){n.default.reportError(l)}return e.createWorkerFromStrings(r,a,i)},e.createWorkerFromStrings=function(t,a,i){var n=u.a.URL.createObjectURL(new Blob(t,{type:"text/javascript"}));return e.createWorkerFromObj(n,a,i)};var v,_=0,b=0;e.runDateRollover=function(){n.default.Assert(n.default.isLoaded,"Expect that we have fully loaded the page before performing rollover");var t=_-new Date;function a(){s.default.Measure.clearItemCache(),s.default.Measure.clearLineCache(),s.default.PaneUpdateBatcher.updateAllItems(!1,!0),s.default.timeline.updateNotifications(),n.default.log("-------------------------------")}if(n.default.log("---- Running Date Rollover: "+t+" ----"),b=new Date,_=0,clearTimeout(v),v=void 0,e.setupDateRollover(),Date.Parsing.Normalizer.buildReplaceData(),s.default.timeline.clearDailyCaches(),s.default.settings.syncContacts.get()){var i=setTimeout(function(){a()},1e4);F.a.loadContacts(function(){clearTimeout(i),i=void 0,a()})}else a();d.a.fireEvent("dateChanged",[])},e.setupDateRollover=function(){n.default.Assert(!v,"Should never reschedule a date rollover over another one");var t=new Date,a=t.clone().addDays(1).clearTime();n.default.Assert(a>t,"Rollover time must be in the future"),n.default.Assert(a>b,"Rollover time must be after the last rollover"),v=setTimeout(e.runDateRollover,a-t),_=a},e.ensureDateRollover=function(){setTimeout(function(){var t=new Date;_-t<0&&e.runDateRollover()},1e4)};var k,w=!1;e.notifyDriveDisconnect=function(){w=!1,f.e.resetAggregateActionCount()},e.notifyDriveOperationError=function(){f.e.resetAggregateActionCount()},e.loadData=function(){if(n.default.shouldLog(o.a.LogLevels.Timing))var t=log.now();n.default.shouldLog(o.a.LogLevels.Profile)&&console.profile("Load Local Data"),n.default.checkpoint(o.a.Checkpoint.LocalDocLoad),n.default.shouldLog(o.a.LogLevels.Profile)&&console.profileEnd(),n.default.isLoaded=!0,n.default.vmSetup.initDemo(),e.isDemoMode()&&setTimeout(function(){u.a.script&&n.default.vmSetup.runScript(r.a.getURLParam("script")),window.parent.postMessage("loaded","*")},0),e.afterLoaded(),n.default.shouldLog(o.a.LogLevels.Profile)&&console.profile("Apply Bindings"),e.isRendered.set(!0),e.isDemoMode()&&u.a.script&&n.default.setupClick(document.getElementById("container"),e,e.onTapMain),n.default.shouldLog(o.a.LogLevels.Profile)&&console.profileEnd(),u.a.app&&n.default.nativeBridge.sendToApp("localLoaded"),n.default.shouldLog(o.a.LogLevels.Timing)&&(n.default.log("DONE LOCALLY",log.now()),setTimeout(function(){var e=log.now();n.default.log("time react:",e-t,e)},0))},e.resetScrollOffsets=function(){s.default.PaneManager.runForEachPane(function(e){e.setScrollOffset(e.defaultOffset)})},e.onTapMain={onStart:function(){d.a.fireEvent("tapMain",[])},onClick:function(){n.default.Assert(e.isDemoMode()&&u.a.script,"Tap handler should only be active on demo page"),window.parent.postMessage("click","*")}},e.afterLoaded=function(){u.a.isMobile&&(n.default.keyboardToolbar=y),u.a.app&&(document.onreadystatechange=function(){u.a.isMobile&&n.default.nativeBridge.sendToApp("kbsize"),n.default.nativeBridge.sendToApp("loaded")},document.onreadystatechange()),s.default.timeline.updateNotifications()},u.a.isMobile&&(e.switchPaneMobile=function(e,t,a){M.default.clearSelection(),s.default.DragDrop.stop(),s.default.DragDrop.finish(),s.default.PaneUpdateBatcher.beginUpdateItems();var i=s.default.PaneManager.swapToPane(e,t,a);n.default.keyboardToolbar.hide(),g.a.setFocusedPane(i),s.default.PaneUpdateBatcher.commitUpdateItems()}),e.applyFormatToSelection=function(e){var t,a,i=!1;n.default.setItemAnimationMode(o.a.ItemAnimationMode.None),n.default.focusedPane.applyToSelection(function(n,r,s){var l=0===r?g.a.getStartOffset():0,u=r===s-1?g.a.getEndOffset():n.getParsedText().length,d=n.applyFormatToSelection(e,l,u,0===r?o.a.SetMode.Toggle:i?o.a.SetMode.Yes:o.a.SetMode.No);0===r&&(i=d.didSet,t=d.selStart),r===s-1&&(a=d.selEnd)}),g.a.selectIndices(g.a.getStartIndex(),t,g.a.getEndIndex(),a),n.default.resetItemAnimationMode()},e.applyPrefixToSelection=function(e,t){var a,i;if(g.a.isValid()&&(a=g.a.getStartItem().getPrefixLength(),i=g.a.getEndItem().getPrefixLength()),t)e=t.prefix===e?null:e,t.setPrefix(e);else{var r=!0;n.default.focusedPane.applyToSelection(function(t){if(t.prefix!==e)return r=!1,!1}),r&&(e=null),n.default.focusedPane.applyFnToSelection("setPrefix",{value:e,noRestoreSel:!0})}if(!isNaN(a)){var o=g.a.getStartItem().getPrefixLength()-a,s=g.a.getEndItem().getPrefixLength()-i;o||s?g.a.selectIndices(g.a.getStartIndex(),g.a.getStartOffset()+o,g.a.getEndIndex(),g.a.getEndOffset()+s):g.a.updateCaret()}},e.updateCursorFromEvent=function(t){if(k){var a=k.target;if(a&&n.default.isAttachedToDoc(a)){var i=n.default.getPaneForElement(a);if(i){var r=n.default.elementFromPoint(k.clientX,k.clientY,k.target);if(r){var o=n.default.getItemForElement(r);e.updateCursor(t,i,r,o)}}}}},e.getCursorForClass=function(e,t,a){for(var i=0,n=e.classList,r=0;r<n.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(n[r]){case"link":case"date":case"plugin":return u.a.mac&&t.metaKey||!u.a.mac&&t.ctrlKey?"cursor-pointer":null}}if(a)return"cursor-pointer"},e.updateCursor=function(t,a,i,r){var s;if(a&&i){if(r&&n.default.isVMLI(r)){var l=n.default.findParentInItem(i,"plugin");l&&(i=l)}var u=!!n.default.findParent(i,"paneOverviewScroller");if(!g.a.isMouseDown()&&!(s=e.getCursorForClass(i,t,u))){var d=n.default.findParent(i,"itemInCalendarResizable");if(d){var c=d.getBoundingClientRect(),h=Math.min(o.a.CalendarResizeHandleHeight,c.height/3);(t.clientY-c.top<h||c.bottom-t.clientY<h)&&(s="cursor-row-resize")}}}e.cursor.set(s)},u.a.touch||(e.redoLastMouseMove=function(){var t=k,a={target:document.elementFromPoint(t.clientX,t.clientY),clientX:t.clientX,clientY:t.clientY};e.mousemove(a,!0)},e.mousemove=function(t,a){if(e.notifyActivity(),!(n.default.disableMouseMove&&!t.target||s.default.PaneManager.isResizingPane||!a&&k&&t.clientX===k.clientX&&t.clientY===k.clientY||s.default.DragDrop.isDragging)){var i,r,o,l=n.default.ensureDOMNode(t.target);l?((n.default.findParent(l,"paneRoot")||n.default.findParent(l,"paneOverviewScroller"))&&(o=n.default.getPaneForElement(l))&&(i=n.default.getItemForElement(l))&&(r=n.default.getListCellForElement(l)),e.updateCursor(t,o,l,i),g.a.setHovered(o,i,r),k&&k.target===l||(k&&k.target&&d.a.fireEvent("mouseout",[{target:k.target}]),l&&d.a.fireEvent("mouseover",[{clientX:t.clientX,clientY:t.clientY,target:l}])),k={clientX:t.clientX,clientY:t.clientY,target:l}):n.default.Assert(!l,"Target should be defined",n.default.getElementPath(t.target))}},n.default.element("outerWrapper").addEventListener("mousemove",e.mousemove)),e.showHelp=function(e){n.default.intro.show(e)},e.runAfterWelcome=function(){n.default.intro.runTooltipIntro()},e.runFirstRun=function(){},e.oldUserNewTrial=function(){s.default.toasts.pushMessage(o.a.MessageID.OldUserNewTrial)};var S=void 0;var I=void 0,D=n.default.seconds(5);e.notifyActivity=function(){e.lastActivity=Date.now(),I||(I=setTimeout(e.checkLowActivity,2*D)),e.whenLowImpactEnd()},e.checkLowActivity=function(){Date.now()-e.lastActivity>D&&e.whenLowImpactBegin(),I=void 0};var C=!1;if(e.whenLowImpactBegin=function(){C||(C=!0,d.a.fireEvent("lowImpactBegin",[]))},e.whenLowImpactEnd=function(){C&&(d.a.fireEvent("lowImpactEnd",[]),C=!1)},e.isLowImpact=function(){return C},e.isDemoMode()||(u.a.pageVisibilityChange&&document.addEventListener(u.a.pageVisibilityChange,function(){u.a.isPageVisible()?(S&&(clearTimeout(S),S=void 0),e.whenLowImpactEnd()):S=setTimeout(function(){n.default.AppCache.checkForUpdate(!1,!0),s.default.pluginManager.writeCaches(),e.whenLowImpactBegin()},5e3)}),!u.a.isMobile&&window.applicationCache&&setTimeout(function t(){Date.now()>e.lastActivity+n.default.minutes(90)&&n.default.AppCache.checkForUpdate(!1,!0),setTimeout(t,n.default.minutes(90))},n.default.minutes(90)),e.checkLowActivity()),s.default.PaneManager.onResize(),n.default.shouldWriteLocal()){var P="version"+(u.a.isMobile?"Mobile":"Desktop"),A=+c.a.getValue(P),T=u.a[P];if(!n.default.isFirstRun&&!n.default.isDemoMode()&&(!A||T>A))for(var E=0,R=u.a.getUpdateMessages(A),N=0;N<R.length;++N){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;if(n.default.isString(R[N]))s.default.toasts.pushMessage({text:R[N],hold:!0,action:o.a.MessageAction.Blog});else{n.default.Assert(n.default.isFunction(R[N]),"Must supply a valid getter fn for the message");var B=R[N]();B.isPremiumOnly&&!s.default.billingManager.hasPremium()||s.default.toasts.pushMessage({text:B.text,hold:!0,action:B.action||o.a.MessageAction.Blog,actionText:B.actionText})}}c.a.setValue(P,T)}return e.getScrollOffset=function(){return e.panesContainer.scrollLeft},e.setScrollOffset=function(t,a){n.default.scrollTo(t,0,a||o.a.ScrollDuration.Default,e.panesContainer)},e.onUnload=function(){n.default.log("Unloading the page");try{var t,a=n.default.getAggregateEvents();for(var i in a)if(a.hasOwnProperty(i)){var r=a[i];n.default.sendEvent(r.category,r.action,r.count),r.count=0}if(n.default.failedGapiLoad?n.default.sendEvent("ScriptLoad","GapiFailed"):window.gapiCalled||n.default.sendEvent("ScriptLoad","GapiNotLoaded"),d.a.fireEvent("onUnload",[]),n.default.hasPageDataBeenCleared()?s.default.pluginManager&&(t=s.default.pluginManager.onShutdown(!1)):e&&s.default.pluginManager&&(t=s.default.pluginManager.onShutdown(!0)),n.default.UIAction("PageUnload"),n.default.isLoadingRemote)return"We are still syncing your changes. Do you still want to quit?";if(n.default.isSendingEmail)return"Some emails have not been sent. Closing Moo.do will stop them from sending. Do you still want to quit?";if(n.default.isSavingDrafts)return"Your drafts are still being saved. Do you still want to quit?";if(t)return t[0]}catch(o){n.default.reportError(o)}},e.getAppInfo=function(t){var a="Loaded";n.default.failedGapiLoad?a="ErrorLoading":window.gapiCalled||(a="NotLoaded");var i=Date.now();t.gapiStatus=a,t.gapiTimeout=window.gapiTimeout,t.sessionID=window.__SESSION_ID,t.sessionStart=window.__SESSION_BEGIN,t.reportTime=i,t.runningTime=i-window.__SESSION_BEGIN,t.appCacheUpdated=n.default.wasAppCacheUpdated,t.realtimeLoadStatus=this.computeRealtimeLoadStatus(),u.a.getPlatformInfo(t),e.getRunningState(t),e.getAppStats(t),e.getPremiumInfo(t);try{if(window.gapi&&window.gapi.auth){var r=gapi.auth.getToken();r?(t.tokenScope=r.scope,t.hasIDToken=!!r.id_token):(t.tokenScope="NO TOKEN",t.hasIDToken="NO TOKEN")}else t.tokenScope="NOT LOADED"}catch(o){t.tokenScope="ERROR"}try{t.cacheState=s.default.CacheManager.getInfo()}catch(o){t.cacheState="ERROR"}},e.getRunningState=function(t){var a;try{s.default.PaneManager.hasLoadedPaneState()&&(a=s.default.PaneManager.getPaneState())}catch(i){n.default.log("Failed to get paneState")}t.isDebug=!1,t.isDemo=n.default.isDemoMode(),t.localWrites=n.default.shouldWriteLocal(),t.authUserLoggedIn=n.default.authUserLoggedIn,t.isReconnected=n.default.isReconnected,t.url=n.default.sanitizeURL(window.location.href),t.paneState=a?n.default.sanitizePaneState(a):"Missing Pane State",t.checkpoints=window.__checkpoints,t.gapiLoadError=window.gapiLoadError,t.gapiTimeout=window.gapiTimeout,t.gapiClientLoadError=window.gapiClientLoadError,t.gapiClientTimeout=window.gapiClientTimeout,t.DOMReadyState=document.readyState,t.isKeyboardOpen=n.default.isKeyboardOpen,t.localStorageQuotaError=r.a.localStorageQuotaError,t.jsVersion=o.a.__jsVersion,t.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",t.windowWidth=window.innerWidth,t.windowHeight=window.innerHeight,t.eventStream=n.default.getEventStream(),t.trackerStream=f.e.stringifyGroups(),t.criticalErrorReported=n.default.criticalErrorReported(),n.default.getLoadedScripts(t);try{t.nativesel=n.default.parseExtra(window.getSelection())}catch(i){t.nativesel="Error: "+i.message}try{t.apiStats=n.default.getGoogleAPIStats()}catch(i){t.apiStats="Error: "+i.message}try{t.customsel=g.a.dumpState()}catch(i){t.customsel="Error: "+i.message}try{t.errorPlatformInfo=JSON.stringify(n.default.errorPlatformInfo)}catch(i){t.errorPlatformInfo="Error: "+i.message}try{t.validScreens=JSON.stringify(window.Screens)}catch(i){t.validScreens="Error: "+i.message}t.lastActivity=e.lastActivity},e.getPremiumInfo=function(e){if(s.default.billingManager){var t={premiumStatus:s.default.billingManager.getPremiumStatus(),billingIdentifier:s.default.billingManager.getBillingIdentifier(),btRequested:s.default.billingManager._braintreeRequested,btLoaded:s.default.billingManager._braintreeLoaded,ctRequested:s.default.billingManager._clientTokenRequested,ctLoaded:s.default.billingManager._clientTokenLoaded,lastSignupError:s.default.billingManager._lastSignupError};e.premiumInfo=t}else e.premiumInfo="Billing Manager Not Loaded"},e.computeRealtimeLoadStatus=function(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&n.default.isFunction(window.gapi.drive.realtime.load))}},e.getAppStats=function(t){if(t.numPanes=window.__TOTAL_PANES,t.numItems=n.default.totalItems,t.numArchivedItems=n.default.totalArchivedItems,t.numArchiveParents=n.default.totalArchivedParents,t.parseTextCalls=window.__PARSE_STATS,t.notificationUpdatesFull=n.default.__FULL_NOTIFICATION_UPDATES,t.notificationUpdatesSingle=n.default.__SINGLE_NOTIFICATION_UPDATES,t.XHRStats=n.default.getXHRStats(),s.default.pluginManager){try{t.pluginStats=s.default.pluginManager.getStats()}catch(a){t.pluginStats="Error: "+a.message}try{t.pluginState=s.default.pluginManager.getState()}catch(a){t.pluginState="Error: "+a.message}}if(e.recurringTaskManager)try{t.taskStats=e.recurringTaskManager.getStats()}catch(a){t.taskStats="Error: "+a.message}o.a.DETAILED_STATS;try{t.measureStats=s.default.Measure.getMeasureStats()}catch(a){t.measureStats="Error: "+a.message}},e.XHR_PrivateAPI=function(e){console.log("private api temporarily disabled")},e.onImageLoaded=function(t,a,i){var r=t.id+n.default.hashCode(a);e.loadedImages[r]||(e.loadedImages[r]=!0,s.default.Measure.measureImage(i.target),O.a.beginBatch(t),s.default.Measure.clearCacheForItem(t.id),d.a.fireEvent("imageLoaded",[t]))},e.checkDragForScroll=function(e){var t=n.default.element("panes"),a=t.scrollLeft,i=t.clientWidth,r=i-80,o=0;e.clientX<80&&a>0?o=n.default.computeScrollSpeed(0,80,e.clientX,4,-1):e.clientX>=r&&a<t.scrollWidth-t.clientWidth&&(o=n.default.computeScrollSpeed(r,i,e.clientX,4)),0!==o?n.default.repeatScroll("panes",o,void 0,!0):n.default.cancelRepeatScroll("panes")},e.init(),e},B=a(28);function U(){var e=this;this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.isPaused=!1,this.stoppedFromPause=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.lastLoadedData=void 0,this.savedItems={},this.typingSpeed=30,this._scriptQueue=[],this.startText={},this.demoCaption=new m.a,n.default.isDemoMode()&&window.addEventListener("message",function(e){if(e.data&&n.default.isString(e.data)&&e.data.indexOf("{")<0)for(var t=0,a=e.data.split("&"),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[i].split("=");switch(n.default.Assert(r.length>=0,"Invalid number of params in message"),r[0]){case"script":this.runScript(r[1]);break;case"start":this.start();break;case"stop":this.stop();break;case"pause":this.pause();break;case"resume":this.resume();break;case"restart":this.restart();break;case"alertDemo":s.default.menus.alert({text:'Click anywhere to try this <b class="blue">live demo</b>',callback:n.default.emptyFn});break;case"help":"1"===r[1]?n.default.vmMain.showHelp(o.a.HelpMode.Normal):n.default.intro.close();break;case"panes":this.loadPanes(r[1])}}}.bind(this),!1),window.pauseScript=function(){e.isDisabled||(n.default.log("pause script"),e.isDisabled=!0)}}var V=function(e,t,a,i,n,r){this.queue.apply(this,arguments)},j=function(e,t,a,i){if(V("createItemAfter",void 0,t),void 0!==a&&0!==a)for(var n=0,r=0;r<Math.abs(a);r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;V("indent",a<0)}V(i?"setText":"typeString",void 0,e)},H=function(e){V("delay",e)};U.prototype={runScript:function(e){if(!this.isDisabled){0;var t=this.createScript(e);switch(this.activeScript=t,e){case"wait":this.demoEmpty(t);break;case"introEmail":this.demoEmail(t);break;case"introStyle":this.demoStyle(t);break;case"press":this.demoPress(t);break;case"none":return void this.notify("demoReady")}0,t.runQueue.length>0?this._scriptQueue.push(t):n.default.Assert(!1,"Invalid script request: ",e),this.repeat=!1,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&this.start()}},start:function(){s.default.toasts.clearMessage(o.a.MessageID.ThisIsDemo),this.onScriptStart(this.activeScript),this.run()},restart:function(){this.activeScript=this._scriptQueue[0],this.activeScript.index=0,this.start()},stop:function(){this._scriptQueue=[],this.isRunning=!1,this.activeScript=void 0,clearTimeout(this.timeoutDelay),this.timeoutDelay=void 0,clearTimeout(this.timeout),this.timeout=void 0,clearTimeout(this.timeoutMessage),this.timeoutMessage=void 0,B.a.hide(),s.default.DragDrop.stop(),s.default.DragDrop.finish()},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1,this.wasResumed=!0,this.stoppedFromPause&&(this.stoppedFromPause=!1,this.run())},demoReady:function(e){this.wasResumed||this.pause(),this.notify("demoReady"),e()},switchDemo:function(e){this.stop(),n.default.isDemoRunning=!0;var t=this[e]();this.resetData(function(){this._scriptQueue.push(t),this.activeScript=t,this.start()}.bind(this))},loadPanes:function(e){n.default.vmMain.loadDemoPanes(e.split(":"))},onScriptStart:function(e){e&&window.parent.postMessage(e.getName(),"*")},createScript:function(){var e={_nextId:0,owner:this,index:0,_repeat:!1,noDelay:!1,runQueue:[],_activeQueue:function(){return this.runQueue},queue:function(e){var t=Array.prototype.slice.call(arguments,1),a=this.runQueue;return a.push({id:this._nextId++,name:e,args:t}),a},repeat:function(e){this._repeat=e},nextStep:function(){return this.runQueue[this.index++]},getName:function(){return this._name}};return V=V.bind(e),j=j.bind(e),e},run:function(){if(!this.isDisabled&&this.activeScript)if(this.isPaused)this.stoppedFromPause=!0;else{n.default.Assert(this.activeScript,"Must have a script active to be running");var e=this.activeScript.nextStep();if(e){var t=e.args;t.push(this.run.bind(this)),this.isRunning=!0,clearTimeout(this.timeout),this.timeout=setTimeout(function(){try{this[e.name].apply(this,t)}catch(a){n.default.reportError(a),this.onDisable()}}.bind(this),0)}}},onDisable:function(){this.isDisabled=!0},setSelection:function(e,t,a,i,r){(n.default.Assert(e,"Must provide a valid item to select"),n.default.isNumber(e))&&(e=s.default.PaneManager.getPaneAtIndex(t).itemAtIndex(e));e=this.getItemIfString(e);var o=t>=0?s.default.PaneManager.getPaneAtIndex(t):n.default.focusedPane;n.default.focusedPane&&n.default.focusedPane.id===o.id||g.a.focusPane(o),void 0===a||null===a?a=0:a<0&&(a=e.getParsedText().length+a+1),g.a.selectItem(e,a,a+i),this.hasSelection=!0,this.selectedItem=e,r&&r()},clearSelection:function(e){g.a.reset(),this.hasSelection=!1,this.selectedItem=void 0,e&&e()},scrollTo:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(e);n.default.Assert(i,"Must have selected a valid pane"),i.setScrollOffset(t),a&&a()},scrollMain:function(e,t,a){n.default.vmMain.setScrollOffset(e,t),setTimeout(a,t)},setText:function(e,t,a){(e=e||this.selectedItem).setText(t,!0,o.a.ChangeType.Local),a&&a()},appendText:function(e,t,a){e.setText(e.getParsedText()+t,!0),a&&a()},setPriority:function(e,t,a){(e=this.getItemIfString(e)||this.selectedItem).setPriority(t,o.a.ChangeType.Local),a&&a()},setStarred:function(e,t,a){(e=e||this.selectedItem).setStarred(t,o.a.ChangeType.Local),a&&a()},setComplete:function(e,t,a,i){(e=this.getItemIfString(e)||this.selectedItem).dateCompleted=a,e.isComplete(t,o.a.ChangeType.Local),i&&i()},removeItem:function(e,t){(e=this.getItemIfString(e)||this.selectedItem).deleteSelf(o.a.ChangeType.Local),t()},setStarredEmail:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(e),n=i.itemAtIndex(t);i.toggleStar(n),a()},setPriorityEmail:function(e,t,a,i){var n=s.default.PaneManager.getPaneAtIndex(e).itemAtIndex(t),r=s.default.pluginManager.getPluginGmail();n&&r.setAttachmentPriority(n.getAttachmentByPlugin(o.a.PluginID.Gmail),a),i()},indent:function(e,t){var a={normCode:o.a.KeyCode.Tab,shiftKey:e};g.a.fireKeyEvent(void 0,a),t&&t()},collapse:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(t);(e=this.getItemIfString(e)||this.selectedItem).setCollapsed(!0,i),a&&a()},backspace:function(e,t,a,i){var r=this;n.default.Assert(i,"typeString should always have a callback"),e=this.getItemIfString(e)||this.selectedItem,n.default.Assert(e,"Must be an item"),n.default.Assert(this.hasSelection,"Must set selection before typing"),n.default.Assert(!this.isTyping,"Must wait until previous typing is finished");var s=0,l=function(){r.intervalTyping&&(clearInterval(r.intervalTyping),r.intervalTyping=void 0),r.isTyping=!1},u=this.activeScript,d=e.getParsedText();function c(){this.isTyping=!0,this.activeScript===u?(d=d.substr(0,a-1)+d.substr(a,d.length-a),a--,e.setText(d,!0,o.a.ChangeType.Local),++s>=t&&(l(),i&&i())):l()}c.apply(this),t>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(c.bind(this),this.typingSpeed))},typeString:function(e,t,a){n.default.Assert(a,"typeString should always have a callback"),e=this.getItemIfString(e)||this.selectedItem,n.default.Assert(e,"Must be an item"),n.default.Assert(this.hasSelection,"Must set selection before typing"),n.default.Assert(!this.isTyping,"Must wait until previous typing is finished"),n.default.Assert(void 0!==t,"Must supply a string to be typed");var i=0,r=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),s=this.activeScript;function l(){if(this.isTyping=!0,this.activeScript===s){var n=t.charCodeAt(i);if(n===o.a.KeyCode.Delete&&(n=o.a.KeyCode.Period),n===o.a.KeyCode.End){var l=g.a.getStartOffset(),u=e.getParsedText(),d=u.substr(0,l)+t.charAt(i)+u.substr(l);e.setText(d,!0,o.a.ChangeType.Local),g.a.selectItem(e,l+1)}else g.a.fireKeyEvent(void 0,{normCode:n});++i>=t.length&&(r(),a&&a())}else r()}t&&(l.apply(this),t.length>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(l.bind(this),this.typingSpeed)))},typeIntoEmail:function(e,t,a){var i=n.default.reactEmailCompose.refs.body,r=0,o=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),s=this.activeScript;clearInterval(this.intervalTyping),this.intervalTyping=setInterval(function(){if(this.activeScript===s){var t=e[r];i.insertCharAtIndex(t,r),++r>=e.length&&(o(),a&&a())}else o()}.bind(this),t)},setSearch:function(e,t,a){s.default.PaneManager.getPaneAtIndex(t).search.setValue(e),a&&a()},createItemAfter:function(e,t,a){var i=this;e=e||this.selectedItem,this.setSelection(e,void 0,e.getParsedText().length,0),g.a.fireKeyEvent(void 0,{normCode:o.a.KeyCode.Enter}),requestAnimationFrame(function(){i.clearSelection(function(){var r;r=e.isHeader()?e.getChild(0):e.parent().getChild(e.getIndex()+1),n.default.Assert(r,"Error getting new item: ",t),t&&(i.savedItems[t]=r),i.selectedItem=r,i.setSelection(r,void 0,-1,0,a)})})},zoomPane:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(e);t=this.getItemIfString(t),i.setItem(t,!0),a&&a()},zoomGmailPane:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(e),r=s.default.pluginManager.getPluginGmail(),o=r._getLabelByName("me",t);n.default.Assert(o,"Must be able to get a valid label if clicking a valid label");var l=r.getVMLIForLabel("me",o);i.setItem(l,!0),i.selectIndex(-1),a&&a()},delay:function(e,t){var a=this;t&&(0===e?t&&t():(this.delayCb=t,clearTimeout(this.timeoutDelay),this.timeoutDelay=setTimeout(function(){a.delayCb=a.timeoutDelay=void 0,t()},e)))},addPane:function(e,t,a,i,n,r){var o={};if(a)o.item=this.getItemIfString(a);else{var u=l.a.getDefaultDocument();o.item=u.getRootItem()}i&&(o.search=i);s.default.PaneManager.createPaneAtIndex(e,t,o,n);r()},removePane:function(e,t,a){s.default.PaneManager.removePaneAtIndex(e,t),a&&a()},cullPanes:function(e,t){var a=s.default.PaneManager.paneCount();a>e?(this.removePane(a-1),setTimeout(this.cullPanes.bind(this,e,t),60)):t()},selectItemInPane:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(e).itemAtIndex(t);this.selectedItem=i,a()},dragTo:function(e,t,a,i,r,l){var u=s.default.PaneManager.getPaneAtIndex(e),d=s.default.PaneManager.getPaneAtIndex(t),c=u.itemAtIndex(a),h=u.elementAtIndex(a),f=-1===i;f&&(i=d.numItems()-1);var p,m,v=d.elementAtIndex(i),y=d.itemAtIndex(i),_=d.objectAtIndex(i),b=h.getBoundingClientRect(),k=v.getBoundingClientRect(),w=u.dragMarginTop||0,S=b.top+(w||10),I=k.left-b.left,D=k.top-S+(f?s.default.DisplaySettings.lineItemHeight(_,y,1):0);g.a.focusPane(u);var C=null;var P=this,A=this.activeScript;s.default.DragDrop.startDragItem=c,c.dragStart({startSrc:h,eventX:b.left+10,eventY:S}),requestAnimationFrame(function e(t){if(P.activeScript===A){C||(C=t);var a,i=(a=(t-C)/r)<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1;if(p=I*i+b.left+10,m=D*i+S,i>=1){var s,u=document.getElementById("preventInteraction");u&&(s=u.parentElement).removeChild(u)}c.dragMove({eventX:p,eventY:m,diffY:D>b.top?1:-1,preventDefault:n.default.emptyFn,stopPropagation:n.default.emptyFn}),u&&s.appendChild(u),i>=1?(c.dragEnd({clientX:p,clientY:m,target:h}),l&&l()):requestAnimationFrame(e)}else g.a.fireMouseUp(h,o.a.ButtonCode.Left)})},getItemIfString:function(e){var t;return n.default.isString(e)?(t=l.a.getItem(e)||this.savedItems[e],n.default.Assert(t,"Item was not saved correctly")):e&&(n.default.Assert(n.default.isVMLI(e),"Must supply a valid VMLI: ",n.default.getObjectInfo(e)),t=e),t},pushMessage:function(e,t){if(this._currentToast)return s.default.toasts.clearMessage(this._currentToast),this._currentToast=void 0,void setTimeout(this.pushMessage.bind(this),100,e,t);var a;if(a=n.default.isString(e)?s.default.toasts.pushMessage({text:e,hold:!0}):s.default.toasts.pushMessage(e),this._currentToast=a,e===o.a.MessageID.ThisIsDemo){d.a.listen("tapMain",function e(){s.default.toasts.clearMessage(a),d.a.unlisten("tapMain",e)})}t&&t()},notify:function(e,t){window.parent.postMessage(e,"*"),t&&t()},demoDone:function(e){g.a.reset(),this.notify("done"),n.default.isDemoRunning=!1,B.a.isEnabled=!0;var t=document.getElementById("preventInteraction");t&&t.parentElement.removeChild(t),e()},addClass:function(e,t){n.default.addClass(document.documentElement||document.body,e),t&&t()},removeClass:function(e,t){n.default.removeClass(document.documentElement||document.body,e),t&&t()},switchClass:function(e,t,a){this.removeClass(e),this.addClass(t),a()},selectEmail:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(e);n.default.Assert(i,"Must have selected a valid pane"),g.a.focusPane(i),i.selectIndex(t),a&&a()},openEmail:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(e);n.default.Assert(i,"Must have selected a valid pane"),i.selectIndex(t);var r=i.itemAtIndex(t);i.openEmailByItem(r),a&&a()},closeEmail:function(e){s.default.EmailPreview.close(),e&&e()},sendEmail:function(e){n.default.reactEmailCompose.onClickSend(),e()},toggleMessageExpanded:function(e,t){n.default.reactEmailPreview.toggleExpanded(e),t()},replyToMessage:function(e){s.default.EmailPreview.setLastMessageResponseMode(o.a.EmailResponseMode.Reply),e()},archiveEmail:function(e,t,a){var i=s.default.PaneManager.getPaneAtIndex(e),n=i.itemAtIndex(t);i.archiveItem(!0,n),a()},addEmail:function(e,t){s.default.pluginManager.getPluginGmail().refreshThreadCacheData("me",e,void 0,function(){},t)},waitPaneItems:function(e,t){var a=s.default.PaneManager.getPaneAtIndex(e);if(n.default.Assert(a,"Must have selected a valid pane"),a.items.length()>0)t();else{a.items.listen(function e(i){i.length>0&&(a.items.unlisten(e),t())})}},displaySetting:function(e,t){s.default.DisplaySettings.changeTheme(e,e),t()},caption:function(e,t,a){this.demoCaption.set({text:e,opacity:1,center:t,light:e.indexOf("<b>")>=0}),a()},captionFade:function(e){var t=this.demoCaption.get();this.demoCaption.set({text:t.text,opacity:0,center:t.center,light:t.light}),e()},waitAction:function(e,t){this._waitTracker={check:e,cb:t}},onTrackerAction:function(e){var t=this._waitTracker;t&&t.check(e)&&t.cb()},demoEmail:function(e){return n.default.isDemoRunning=!0,V("waitPaneItems",0),V("zoomGmailPane",1,"Needs Reply"),V("zoomGmailPane",2,"Starred"),V("removeClass","invisible"),V("demoReady"),H(1e3),V("dragTo",0,1,0,-1,1e3),H(200),V("dragTo",0,1,0,-1,1e3),H(800),V("setStarredEmail",0,1),H(500),V("setStarredEmail",0,3),H(800),V("setPriorityEmail",2,0,o.a.VMLIFlag.P0),H(500),V("setPriorityEmail",2,2,o.a.VMLIFlag.P2),H(1200),V("selectEmail",0,0),H(200),V("openEmail",0,0),V("pushMessage",o.a.MessageID.ThisIsDemo),V("demoDone"),e},demoStyle:function(e){var t=0,a=0;n.default.isDemoRunning=!0,B.a.isEnabled=!1,this.collapse("ideas",0),this.collapse("todo",0),this.collapse("testing",0),V("removeClass","invisible"),V("demoReady"),H(500),V("dragTo",0,1,1,1,1e3),H(1e3),V("setSelection","tracking",0,-1,0),V("typeString",void 0," #Android"),H(800),V("typeString",void 0," @tomorrow "),H(800),V("setSelection","tracking",0,0,0),V("typeString",void 0,"+Grant "),H(1500),V("zoomPane",1,"release"),H(1500);for(var i="#Android",r=i.length;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;V("setSearch",i.substr(0,r),2),H(40)}H(800),i="+Grant";for(r=0;r<=i.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;V("setSearch",i.substr(0,r),2),H(40)}V("pushMessage",o.a.MessageID.ThisIsDemo),V("demoDone")},demoPress:function(e){f.e.addListener(this.onTrackerAction.bind(this)),V("pushMessage",{text:"Try dragging an email onto the Outline.",hold:!0,big:!0}),V("waitAction",function(e){return e.type===f.e.TrackerType.Misc&&e.misc===f.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===o.a.PaneMode.Gmail}),V("pushMessage",{text:"Schedule an item by typing @ then a date.<br><br>Or drag it right onto the Agenda.",hold:!0,big:!0}),V("waitAction",function(e){return e.type===f.c.Misc&&e.misc===f.a.ChangeDate||e.type===f.c.Insert&&"@"===e.data[0].text}),V("pushMessage",{text:"Learn more on our homepage.",hold:!0,action:o.a.MessageAction.OpenURL,actionText:"https://moo.do",data:{url:"https://www.moo.do"}})},demoEmpty:function(e){n.default.isDemoRunning=!0,V("demoReady"),V("pushMessage",o.a.MessageID.ThisIsDemo),V("demoDone")}};var z,q=U;function W(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}!function(e){e.Normal="Sign in with Google",e.Connecting="Connecting...",e.LoggingIn="Logging In...",e.Loading="Loading...",e.Offline="Offline"}(z||(z={}));var G=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=navigator.onLine?z.Normal:z.Offline,this.loginStatus=new m.a(t),this.popupClosedError=new m.a(!1),this.gapiFailedToLoad=new m.a,this.loggedOutByAuthFailure=new m.a,this.downloadIcon=this.getDownloadIcon(),this.downloadText="Download "+this.getDownloadText()+" app",this.showDownload=u.a.mobile&&!u.a.app||u.a.canDownloadNativeApp(),this.showLogin=!u.a.mobile||u.a.app||u.a.isDevURL,this.loginRequested=!1,this.loginRequestTimer=void 0}var t,a,d;return t=e,(a=[{key:"getDownloadIcon",value:function(){return u.a.getPlatformIcon()}},{key:"getDownloadText",value:function(){return u.a.getPlatformName()}},{key:"userLogin",value:function(){var e=this;i.a.onAuthed(function(){n.default.authUserLoggedIn=!0,e.loginRequested=!1,e.loginStatus.set(z.Normal),s.default.settings.localIntegrity.set(!0),e.popupClosedError.set(!1),s.default.PaneManager.setupInitialTimeout()}),this.loginStatus.set(z.LoggingIn),i.a.signIn()}},{key:"shouldShowLogin",value:function(){return this.loginStatus.get()===z.Normal||this.loginStatus.get()===z.LoggingIn}},{key:"logout",value:function(){s.default.settings.activeUser.get()&&(n.default.log("Logging out"),l.a.clearLocalData().then(function(){i.a.signOut(function(){n.default.log("Logged out",u.a.app),setTimeout(function(){r.a.hasURLParam("login")?r.a.removeURLParam("login"):r.a.hasURLParam("user")&&r.a.removeURLParam("user"),u.a.app?(n.default.nativeBridge.sendToApp("logout"),u.a.isFeatureEnabled(o.a.Feature.OAuth)&&n.default.reload()):n.default.reload()},0)})}))}},{key:"logoutClicked",value:function(){var e=this;n.default.isDemoMode()?r.a.removeURLParam("demo"):l.a.hasPendingRemoteUpdates()?s.default.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",function(t){t&&e.logout()}):this.logout()}},{key:"isLocal",value:function(){return"localhost"===window.location.hostname}},{key:"initDemo",value:function(){n.default.AScript||(n.default.AScript=new q)}},{key:"runScript",value:function(e){n.default.AScript.runScript(e)}},{key:"onTapLogin",value:function(e){this.userLogin()}},{key:"_reportLoginTapSkip",value:function(e){}},{key:"closeConnectionError",value:function(){n.default.tooltip.hideSticky(this.textErrorConnecting)}}])&&W(t.prototype,a),d&&W(t,d),e}();function K(e){return(K="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Y=o.a.TooltipDelay;function X(){this.tooltip=new m.a,this.tooltipsSticky=new k.a,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,this.init()}X.prototype={init:function(){u.a.touch||(d.a.listen("mouseover",this.handleEleOver.bind(this)),d.a.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))},windowOut:function(e){(e.pageX>=u.a.windowWidth()||e.pageY>=u.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.hideTip()},register:function(e,t){this.update(e,t)},update:function(e,t){e.setAttribute("tooltip",t)},displayTipSticky:function(e){e.sticky=!0,this.displayTip(e)},displayTip:function(e){n.default.Assert(e,"When display a tooltip, must pass in some info"),clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var t=this.displayElement=e.element;if(e&&t&&t.offsetWidth>0&&t.offsetHeight>0){var a=e.text;if(this.isSticky=e.sticky,n.default.Assert(a,"When display a tooltip, elements should always have valid data set"),a){var i={text:a,hotkey:e.hotkey,element:t,blue:e.blue,sticky:e.sticky,maxWidth:e.maxWidth,onRight:e.onRight,arrowClass:e.arrowDirection||"hidden"};e.sticky?this.tooltipsSticky.push(i):this.tooltip.set(i)}}},tipOut:function(e){var t=!0;e.target&&(t=n.default.isAttachedToDoc(e.target)&&!n.default.findParent(e.target,"tooltip")),t&&this.hideTip()},getAttr:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltip")||e.getAttribute("data-tooltip"))},getAttrHotkey:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltipHotkey")||e.getAttribute("data-tooltiphotkey"))},getByClassName:function(e,t){var a,i=u.a.priModKey,r=e.parentElement,o=e.textContent;if(!n.default.findParent(e,"fancyInputInner"))if(n.default.hasClass(e,"linkImage"))a="<b>Click</b> to open image.<br><b>"+i+" + Click</b> to open in "+(u.a.app?"browser":"new tab")+".";else if(r&&n.default.hasClass(r,"appLink")){a="<b>"+i+" + Click</b> to open in "+((n.default.hasClass(r,"Evernote")?"Evernote":"")||(n.default.hasClass(r,"OneNote")?"OneNote":"")||(n.default.hasClass(r,"Bear")?"Bear":""))}else if(n.default.hasClass(e,"link")&&e.getAttribute("data-href")){var s=e.getAttribute("data-href");a=(s!==o?s+"<br>":"")+"<b>"+i+" + Click</b> to open"}else if(n.default.hasClass(e,"tag")||n.default.hasClass(e,"date")||n.default.hasClass(e,"duration")){a="<b>"+i+"+ Click</b> to show only "+o+"<br><b>"+i+" + Shift + Click</b> to hide "+o+"<br><b>"+(u.a.mac?"Option":"Alt")+" + Click</b> to remove "+o}else n.default.hasClass(e,"email")?a="<b>"+i+"+ Click</b> to email "+o:n.default.hasClass(e,"prefixHeader")||n.default.hasClass(e,"prefixBullet")?a="<b>Click</b> to zoom in":n.default.hasClass(e,"prefixTask")?a="<b>Click</b> to toggle complete.<br><b>"+u.a.priModKey+" + Click</b> to zoom in.":n.default.hasClass(e,"prefixNumList")?a="<b>"+u.a.priModKey+" + Click</b> to zoom in":n.default.hasClass(e,"plugin")&&(a=(t>0?"<b>"+u.a.priModKey+" + Click</b>":"<b>Click icon</b>")+" to open");return a},getTooltipText:function(e,t){return this.getAttr(e)||this.getByClassName(e,t)},handleEleOver:function(e){if(n.default.Assert(n.default.isDOMNode(e.target),"Must have a valid DOM node: ",K(e.target)),e.target){for(var t,a,i=0,r=e.target,o=0;!t&&r&&o<3;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t=this.getTooltipText(r,o),a=this.getAttrHotkey(r),t||a||(r=r.parentElement)}if(r&&(!t&&a&&(t=a,a=void 0),t&&this.displayElement!==r&&!s.default.DragDrop.isDragging&&!g.a.isMouseDown())){clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),Y,{element:r,offset:{y:5},text:t,hotkey:a})}}},handleEleOut:function(e){this.tipOut(e)},isOpenSticky:function(){return this.tooltipsSticky.get().length>0},hideSticky:function(e){for(var t=0,a=this.tooltipsSticky.get(),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].text===e){this.tooltipsSticky.removeAt(i);break}}},hideTip:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}};var Q=X;function J(){this.useServiceWorker="serviceWorker"in navigator,this.updateWaitTime=n.default.minutes(120),this.notifiedOfNew=!1,this.isFinished=!1,this.downloadingTimeout=0,this.lastUpdate=0,this.startStatus=window.applicationCache?window.applicationCache.status:-2,this.continuedUpdate=!1,this.updateActionDone=!1,this.fnToRun=[],this.requiredUpdate=!1,this.appUpdatePending=!1,this.runUpdate=!1,this.init()}J.prototype={init:function(){this.startStatus===window.applicationCache.OBSOLETE&&this.onCacheObsolete(),this.useServiceWorker?(navigator.serviceWorker.addEventListener("message",function(e){"ServiceWorker_Activated"===e.data?this.onUpdateReady():"ServiceWorker_Installed"===e.data&&setTimeout(this.onUpdateReady.bind(this),2e3)}.bind(this)),r.a.hasURLParam("swupdate")&&setTimeout(function(){r.a.hasURLParam("swupdate")&&r.a.removeURLParam("swupdate",!0)},2e3)):n.default.log("Cache Status: "+this.startStatus),window.applicationCache?(window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheObsolete.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()):this.onCacheLoadFinished()},update:function(){if(Date.now()-this.lastUpdate>this.updateWaitTime){this.lastUpdate=Date.now();try{this.useServiceWorker?window.__registeredServiceWorker&&window.__registeredServiceWorker.update():window.applicationCache&&window.applicationCache.status===window.applicationCache.IDLE&&window.applicationCache.update()}catch(e){}}},checkForUpdate:function(e,t){this.requiredUpdate=!!e,this.runUpdate=!!t,this.appUpdatePending?this.appUpdatePending&&this.runUpdate&&n.default.reload(!this.useServiceWorker):this.update()},endRunUpdate:function(){this.runUpdate=!1},runOnFinish:function(e){n.default.Assert(0===this.fnToRun.length,"Only a single callback is allowed to be run at this point."),this.isFinished?setTimeout(e,0):this.fnToRun.push(e)},onUpdateReady:function(){this.appUpdatePending||(n.default.log("Cache: New version available"),this.appUpdatePending=!0,r.a.hasURLParam("swupdate")||r.a.insertURLParam("swupdate",!0,!0),this.useServiceWorker?n.default.log("Service worker has update"):window.applicationCache&&this.startStatus===window.applicationCache.UNCACHED&&n.default.log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction())},onFirstUpdateReady:function(){n.default.log("Cache: first update")},onUpdateError:function(e){u.a.demo||n.default.vmMain&&!n.default.vmMain.isOnline()||(n.default.log("Update Error: ",e),"quota"===e.reason&&s.default.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"})),this.onCacheLoadFinished()},onUpdateDownloading:function(){n.default.log("Cache: New version downloading")},onCacheObsolete:function(){this.onUpdateReady()},onCacheLoadFinished:function(){if(!this.isFinished){var e=0;this.isFinished=!0;for(var t=0;t<this.fnToRun.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.fnToRun[t]()}}},notifyOfUpdate:function(){this.notifiedOfNew||(this.notifiedOfNew=!0,n.default.setAppCacheUpdateState(!0))},updateAction:function(){this.runUpdate||!u.a.isPageVisible()?n.default.reload(!this.useServiceWorker):this.requiredUpdate&&s.default.menus.alert({text:"A software update is required to continue. Please reload to update.",actionText:"RELOAD",callback:n.default.reload}),n.default.sendEvent("AppCache","Update")}};var Z=J,$=a(38);function ee(e){n.default.Assert(void 0===window.__MoodoBridge[e],"Registering an Inbound API that already exists on the window object",e),this._name=e,this._publicObj={},this._privateObj={},window.__MoodoBridge[e]=this._publicObj,this.init()}ee.prototype={init:function(){},_createWrapper:function(e){return function(){try{return e.apply(this,arguments)}catch(t){n.default.reportError(t)}}},registerFunction:function(e,t,a){n.default.Assert(e,"Name must be provided to register function"),n.default.Assert(t,"A valid function must be provided to register"),n.default.Assert(void 0===this._privateObj[e],"Re-registering an api function on private obj",e),n.default.Assert(void 0===this._publicObj[e],"Re-registering an api function on public obj",e),this._privateObj[e]=t.bind(this._privateObj),a&&(this._publicObj[e]=this._createWrapper(this._privateObj[e]))},registerVariable:function(e,t,a){n.default.Assert(e,"Name must be provided to register variable"),n.default.Assert(!a,"Public variables are not currently supported"),n.default.Assert(void 0===this._privateObj[e],"Re-registering an api variable on private obj"),n.default.Assert(void 0===this._publicObj[e],"Re-registering an api variable on public obj"),this._privateObj[e]=t}},r.a.defineBase(ee);var te=ee;function ae(e){this._name=e,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}ae.prototype={init:function(){n.default.isObject(window[this._name])?this.onAPILoaded():(r.a.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){n.default.Assert(!this._apiLoaded,"Should not be checking for API load if already loaded"),n.default.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){var e=0;this._apiLoaded=!0;for(var t=0;t<this._requiredFns.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n.default.isFunction(window[this._name][name])||(this._apiError=!0,this._addMissingFn(name))}this.notifyListeners()},requestNotification:function(e){this._apiLoaded?setTimeout(e,0):this._listeners?this._listeners.push(e):this._listeners=[e]},notifyListeners:function(){if(n.default.Assert(this._apiLoaded,"API must be loaded to notify listeners"),this._listeners)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._listeners[t]()}this._listeners=void 0},requireFunction:function(e,t){n.default.Assert(this._requiredFns.indexOf(e)<0,"Should not double require a single function"),this._requiredFns.push(e),this._apiLoaded&&(n.default.isFunction(window[this._name][e])||t||(this._apiError=!0,this._addMissingFn(e)))},_addMissingFn:function(e){this._missingFns?(n.default.Assert(this._missingFns.indexOf(e)<0,"Should not be missing the same function multiple times"),this._missingFns.push(e)):this._missingFns=[e]},hasOptionalFunction:function(e){return n.default.Assert(this._requiredFns.indexOf(e)>=0,"Must be querying for a registered function"),!!window[this._name]&&!!window[this._name][e]},call:function(e){if(n.default.Assert(this._apiLoaded,"Trying to call an API function before it is loaded",e),this._apiLoaded){var t=Array.prototype.slice.call(arguments,1);try{return window[this._name][e].apply(window[this._name],t)}catch(a){n.default.reportError(a)}}}},r.a.defineBase(ae);var ie=ae,ne=a(17),re=0,oe={};function se(){if(u.a.app)try{this.backlog=[],this._iOS7Queue=[],this._iOS7QueueTimeout=void 0,this.flushingBacklog=!1,this.isPokingBackground=!1,this.setupFns=[],this.setupFns[o.a.AppPlatform.iOS]=this.setupiOS.bind(this),this.setupFns[o.a.AppPlatform.Android]=this.setupAndroid.bind(this),this.setupFns[o.a.AppPlatform.Electron]=this.setupElectron.bind(this),this.sendFns=[],this.sendFns[o.a.AppPlatform.iOS]=this.sendToAppiOS.bind(this),this.sendFns[o.a.AppPlatform.Android]=this.sendToAppAndroid.bind(this),this.sendFns[o.a.AppPlatform.Electron]=this.sendToAppElectron.bind(this),this.setupFn=this.setupFns[u.a.appPlatform],this.sendFn=this.sendFns[u.a.appPlatform],this.init(),this._isEnabled=!0}catch(e){n.default.log("Native API Bridge Disabled"),n.default.reportError(e)}else this._isEnabled=!1;this._embedBridge=void 0,(u.a.app||u.a.embed)&&(n.default.Assert(void 0===window.__MoodoBridge,"Must not have a previous bridge in place"),window.__MoodoBridge={},this._canRegisterAPIs=!0,this._inboundAPIs={},this._outboundAPIs={})}se.prototype={init:function(){n.default.Assert(this.setupFn,"Must have a valid setup function"),n.default.Assert(this.sendFn,"Must have a valid send function"),this.setupFn&&this.sendFn&&(this.initAppEvents(),this.setupFn(),this.backlog=n.default.nativeBacklog,this.flushBacklog())},isEnabled:function(){return this._isEnabled},flushBacklog:function(){var e=0;this.flushingBacklog=!0;for(var t=0;t<this.backlog.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.backlog[t];this.sendToApp(a.method,a.data)}this.flushingBacklog=!1},addToBacklog:function(e,t){n.default.Assert(!this.flushingBacklog,"Should never be adding to backload while flushing it"),this.flushingBacklog||this.backlog.push({method:e,data:t})},registerEmbedBridge:function(e){n.default.Assert(e,"Must supply a valid embed bridge"),n.default.Assert(u.a.embed,"Must be embedded"),this._embedBridge=e},hasEmbedBridge:function(){return!!this._embedBridge},sendToEmbed:function(e,t){n.default.Assert(this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",e),this._embedBridge.handleEmbedMessage(e,t)},registerInboundAPI:function(e){if(n.default.Assert(!this._inboundAPIs[e],"Should not have already registered an outbound API with this name"),this._canRegisterAPIs){var t=new te(e);return this._inboundAPIs[e]=t,t}},registerOutboundAPI:function(e){if(n.default.Assert(!this._outboundAPIs[e],"Should not have already registered an outbound API with this name"),this._canRegisterAPIs){var t=new ie(e);return this._outboundAPIs[e]=t,t}},initAppEvents:function(){window.appEvents=this.appEvents,window.reportLowMemory=this.appEvents.reportLowMemory,window._SENDJSMESSAGE_=this.handleNativeMessage},setupAndroid:function(){},setupiOS:function(){this.setupiOSUI()},setupiOSUI:function(){this.iframeApp=document.createElement("IFRAME"),this.iframeApp.setAttribute("height","1px"),this.iframeApp.setAttribute("width","1px"),this.iframeApp.id="appComm",document.documentElement.appendChild(this.iframeApp)},setupElectron:function(){s.default.ElectronBridge.setup()},onSaveChange:function(e){this.isPokingBackground&&(this.sendToApp("pokeChanged",e>0?"true":"false"),this.isPokingBakground=!1)},sendToApp:function(e,t){n.default.Assert(u.a.app,"Only use native bridge when creating an app"),n.default.Assert(this.sendFn,"Must have a valid send method for the native bridge");var a=!1;try{var i;t&&(i=n.default.isString(t)?t:JSON.stringify(t)),this.sendFn&&(this.sendFn(e,i),a=!0)}catch(r){n.default.reportError(r)}return a},sendToAppiOS:function(e,t){u.a.ioswk?this.sendToAppiOS8(e,t):this.sendToAppiOS7(e,t)},sendToAppiOS7:function(e,t){if(this.iframeApp){var a="duchess://"+e;void 0!==t&&(a+="//"+t),this._addiOS7Queue(a)}else this.addToBacklog(e,t)},_addiOS7Queue:function(e){this._iOS7Queue.push(e),this._iOS7QueueTimeout||(this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue.bind(this),17))},_pumpiOS7Queue:function(){var e=this._iOS7Queue.shift();n.default.Assert(e,"Must have a valid href",e),this.iframeApp.src=e,this._iOS7Queue.length>0?this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue.bind(this),17):this._iOS7QueueTimeout=void 0},sendToAppiOS8:function(e,t){var a=window.webkit;if(a.messageHandlers&&a.messageHandlers.MoodoEvents){var i=e;void 0!==t&&(i+="//"+t),a.messageHandlers.MoodoEvents.postMessage(i)}else this.addToBacklog(e,t)},sendToAppAndroid:function(e,t){var a=window.AppInterface;a&&void 0!==a.sendAppMessage&&null!==a.sendAppMessage?a.sendAppMessage(e,t):this.addToBacklog(e,t)},sendToAppElectron:function(e,t){s.default.ElectronBridge.sendMessage(e,t)},handleNativeMessage:function(e,t){try{window.appEvents[e]?window.appEvents[e](t):e.startsWith("-")||n.default.reportError(new Error("Calling invalid JS method from native: "+e))}catch(a){n.default.reportError(a)}},nativeOauth:function(e,t){var a=++re,r={id:a,scope:i.a.getScopes().join(" "),immediate:e,offline:!1,state:"Dchs"+(new Date).getTime(),include_granted_scopes:!0,redirect_uri:window.location.protocol+"//"+window.location.host+"/oauthRelay.html"};this.sendToApp("getOAuth",r)?n.default.shouldLog(o.a.LogLevels.NativeAuth)&&n.default.log("Native OAuth Request: "+a):n.default.shouldLog(o.a.LogLevels.NativeAuth)&&n.default.log("Native OAuth Request: Failed to send."),oe[a]=t},appEvents:{undo:function(){n.default.log("Native Undo"),n.default.sendEvent("Hotkey","ShakeUndo"),R.a.undo()},redo:function(){n.default.log("Native Redo"),n.default.sendEvent("Hotkey","ShakeRedo"),R.a.redo()},selectAll:function(){n.default.focusedPane&&$.default.handleSelectAll(n.default.focusedPane)},kbsize:function(e){e>0&&+e!==u.a.getKBSize()&&(u.a.setKBSize(e),n.default.keyboardToolbar&&n.default.keyboardToolbar.updatePosition())},closeKeyboard:function(){!u.a.isMobile||s.default.menus&&s.default.menus.isModalOpen(o.a.Modals.EmailCompose)||(g.a.closeKeyboard(),ne.a.reset())},enterBackground:function(){n.default.AppCache&&n.default.AppCache.checkForUpdate(!1,!0),n.default.vmMain.onUnload()},enterForeground:function(){n.default.checkForRemoteChanges(),n.default.AppCache&&n.default.AppCache.endRunUpdate(),d.a.fireEvent("enterForeground",[])},backButtonPressed:function(){g.a.fireKeyEvent(document.documentElement,{normCode:o.a.KeyCode.Escape})},quickAddItems:function(e){try{for(var t=0,a=e.replace(/\r/g," ").replace(/\n/g," "),i=JSON.parse(a),r=0;r<i.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=i[r];n.default.log("Quick Add Item: ",o),n.default.vmMain.dropBucket.addTextEntry(o.key,o.value),n.default.vmMain.dropBucket.persistTextEntry(o.key)}n.default.nativeBridge.sendToApp("quickAddConsumed",[])}catch(s){n.default.reportError(s,e)}},pokeBackground:function(){n.default.nativeBridge.isPokingBackground=!0},reportLowMemory:function(e){n.default.handleLowMemory(e)},statusBarTap:function(){n.default.focusedPane&&n.default.focusedPane.setScrollOffset(0,o.a.ScrollDuration.Default)},features:function(e){try{var t=JSON.parse(e);t.version&&u.a.recordAppSubVersion(t.version),!1===t.notifications&&u.a.disallowNativeNotifications()}catch(a){n.default.reportError(a)}},notifyOAuth:function(e){try{n.default.isString(e)&&(e=JSON.parse(e)),i.a.handleNativeOAuthResponse(e)}catch(t){n.default.reportError(t)}},reportError:function(e){n.default.reportError(new Error("Native Error"),e)},downloadProgress:function(e){n.default.handleNativeDownloadProgress(e)}}};var le=se,ue=a(51),de=a.n(ue),ce=a(61),he=a(13),fe=a(30),pe=a(47),ge=he.b.createClass({displayName:"ReactWrapper",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){return n.default.clone(this.props.observe)},render:function(){var e=this.props,t=this.state;if(e.render)return e.render(t,e);var a=e.component||"div";return e=n.default.extend({style:e.renderStyle(t,e)},e),b.a.createElement(a,e,e.children)}}),me=a(37),ve=a(27),ye=he.b.createClass({displayName:"ReactSearchButton",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){var e=this.props.filter;this.firstValue=this.props.filterValue||e.initialValue},onMouseDown:function(e){n.default.preventAndStop(e)},onClickIcon:function(e){var t=this.props.filter,a=this.props.filterValue;a=!1!==t.canBeNegated&&(!u.a.mac&&e.ctrlKey||u.a.mac&&e.metaKey)&&!isNaN(t.initialValue)&&a!==-t.initialValue?-t.initialValue:a?0:t.initialValue,this.props.search.setFilter(t.name,a,!0)},render:function(){var e=this.props,t=e.filter,a=e.filterValue,i=this.firstValue===a,r=e.noClick?void 0:this.props.search.getFilterTooltip(t),o=n.default.classNames("searchButton",{"c-border-super-light":e.hasBorder},{"c-button":!a},{selected:!!a},t.icon,t.isOption&&(1===a?"yes":-1===a?"only":""),!t.isOption&&((a?this.firstValue>0&&i||this.firstValue<0&&!i:this.firstValue>0)?"yes":"no"));return b.a.createElement("div",{className:o,"data-tooltip":r,onMouseDown:this.onMouseDown,onClick:e.noClick?void 0:this.onClickIcon})}}),_e=a(50),be=he.b.createClass({displayName:"ReactSearch",componentDisplay:o.a.ComponentDisplay.Everywhere,onMount:function(){this.props.pane.search.UI=this,this.listenTo(this.props.pane.search.onChanged),u.a.isMobile?this.addTap("searchInnerWrap",this,this.onTapBox):this.forceUpdate()},getState:function(){for(var e=0,t=this.props.pane,a=t.search,i={search:a.value,calendars:x.a.GCalendarsAvailable,displayCalendars:t.displayCalendars,displayLocalItems:t.displayLocalItems},n=0;n<a.filters.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=a.filters[n];i[r.name]=r.value,i[r.name+"Enabled"]=r.enabled}return i},onChange:function(e){this.props.pane.search.setValue(e)},onParsed:function(e){this.props.pane.search.onParsed(e)},setSearch:function(e,t){this.props.pane.search.setValue(e),u.a.isMobile||!1===t||this.setSelectionOffset(e.length)},getSelectionOffset:function(){return this.refs.input.getSelectionOffset()},setSelectionOffset:function(e){this.refs.input.setSelectionOffset(e)},onFocus:function(){var e=this.props.pane,t=e.search;t&&(this._selectionBeforeBlur=g.a.save(),g.a.reset(),t.isFocused.set(!0),B.a.hide(),u.a.isMobile?(n.default.keyboardToolbar.show(o.a.KeyboardToolbarMode.Search),n.default.sendEvent("SearchFocus","Mobile")):(n.default.sendEvent("SearchFocus","Desktop"),t.filters.length>0&&!s.default.menus.isContextMenuOpen("ReactContextMenuSearch")&&s.default.menus.openContextMenu({componentName:"ReactContextMenuSearch",key:"search"+e.id+(e.viewMode?e.getViewMode():""),element:this.refs.searchBox,positionOffset:{top:4},noBackdrop:!0,pane:e,showFilters:this.props.showFilters,onClosed:this.blur})))},onBlur:function(){var e=this.props.pane.search;e&&e.isFocused.set(!1),u.a.isMobile&&n.default.keyboardToolbar.hide()},focus:function(){this.refs.input.focus(),this.refs.input.selectEnd()},blur:function(){this.refs.input&&this.refs.input.blur()},onTapBox:function(e){u.a.isMobile&&(n.default.keyboardToolbar.preShow(),this.focus()),u.a.isMobile&&(n.default.keyboardToolbar.show(o.a.KeyboardToolbarMode.Search),e.preventDefault())},onTapX:function(e){var t=this.props.pane,a=u.a.isMobile;if(this.state.search.length>0){if(!a)var i=g.a.save();this.setSearch("",!1),!a&&i&&t.restoreSelection(i),n.default.preventDefault(e),n.default.sendEvent("Menu","ClearSearch")}else a?this.onTapBox(e):this.focus(),n.default.sendEvent("Menu","FocusSearch")},onKeyDown:function(e){if(this.saveScrollOfTop(),!u.a.isMobile){if(u.a.mac&&e.ctrlKey&&e.keyCode===o.a.KeyCode.T)return n.default.preventDefault(e),this.blur(),void ve.a.hotkeyAddPane();var t=this.props.pane;if(e.keyCode===o.a.KeyCode.Enter)t.search.update(!0,!0),this.setSelectionOffset(this.state.search.length);if(e.keyCode===o.a.KeyCode.Tab||e.keyCode===o.a.KeyCode.Enter){var a=t.indexOfFirstItem();if(a>=0){var i=a,r=this._selectionBeforeBlur;r&&(g.a.restore(r)?(this._selectionBeforeBlur=void 0,i=r.startIndex):r=null),r||(this.blur(),t.selectIndex(a,0),setTimeout(function(){t.selectIndex(a,0)},0)),g.a.focusPane(t),i>=0&&n.default.focusedPane.scrollIndexIntoView(i,o.a.ScrollDuration.Default)}else t.type===o.a.PaneMode.Task&&t.addItem(e);e.preventDefault(),e.stopPropagation()}}},onAutocompleteSelected:function(e){if(e.item){var t=this.props.pane.search,a=t.getValue(),i=a.indexOf(o.a.PrefixItemAutocomplete);a=a.substr(0,i),t.setValue(a),this.props.pane.zoomIn(e.item,!1,!1,!0),this.setSelectionOffset(a.length)}this.refs.input.updateAutocomplete(),this.focus()},onClickFilters:function(){this.focus()},onClickPriority:function(){this.props.pane.search.setFilter("priority",0)},onClickText:function(e){if(e.altKey){var t,a,i;if(n.default.hasClass(e.target,"fancyInputInput")){var r=M.default.getSelectionRange().getNativeRange();if(r){var o=(t=r.cloneRange()).startContainer.nodeValue;if(n.default.isString(o)){for(var l=0,u=0,d=0,c=o.length,h=t.startOffset;h>=0;h--){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(" "===o[h]||160===o.charCodeAt(h)){d=h+1;break}}for(h=t.endOffset;h<o.length;h++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(" "===o[h]||160===o.charCodeAt(h)){c=h;break}}a=c-d,i=d}}}else(t=M.default.createSelectionRange()).selectNodeContents(e.target),i=t.startOffset,a=t.toString().length;if(t&&!isNaN(i)&&a){t.setEnd(t.startContainer,i),t.setStart(t.startContainer.parentNode,0);var f=t.toString().length,p=this.props.pane.search,g=p.getValue();s.default.PaneUpdateBatcher.beginUpdateItems(),g=(g.substr(0,f)+g.substr(f+a)).replace(/  +/g," ").trim(),p.setValue(g),s.default.PaneUpdateBatcher.commitUpdateItems(),this.setSelectionOffset(f)}}},saveScrollOfTop:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)},renderSearchButton:function(e){var t=this.props.pane;return b.a.createElement(ye,{key:e.name,filter:e,filterValue:e.value.get(),search:t.search})},renderSearchPriority:function(){var e=this.props.pane.search.filter_priority.value.get(),t=e===o.a.VMLIFlag.P0?0:e===o.a.VMLIFlag.P1?1:e===o.a.VMLIFlag.P2&&2,a=n.default.classNames("searchPriority searchP"+t+" selected");return b.a.createElement("span",{key:"priority",className:a,onClick:this.onClickPriority})},render:function(){var e=this.props,t=this.state,a=e.pane,i=a.search,n=t.search,r=n.length>0?"icon-close":"",s=u.a.isMobile?40:o.a.SearchHeight,l=[];if(!u.a.isMobile&&!1!==e.showFilters){for(var d=0,c=0;c<i.filters.length;c++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h=i.filters[c];h.enabled.get()&&h.value.get()&&(h.icon?l.push(this.renderSearchButton(h)):"priority"===h.name&&l.push(this.renderSearchPriority()))}a.isViewDates()&&a.isCalFilterActive()&&l.push(b.a.createElement("div",{className:"searchButton icon-calendar selected yes",onClick:this.onClickFilters}))}var f=b.a.createElement(D.a,{className:"searchX c-button noShrink",width:24,height:s,icon:r,onClick:this.onTapX}),p=b.a.createElement("div",{className:"searchInnerWrap",ref:"searchInnerWrap"},b.a.createElement(_e.a,{ref:"input",className:"search",id:"search",height:u.a.isMobile?30:s,value:n,onClick:this.onClickText,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,onParsed:this.onParsed,parse:!0,placeholder:"Search",autocompleteMode:"all",border:!1,autocompleteElementDisplay:this.refs.searchBox,padding:{left:0,right:0},onAutocompleteSelected:this.onAutocompleteSelected,supportSearchItemAutocomplete:a.supportSearchItemAutocomplete,canAutocompleteItems:a.type===o.a.PaneMode.Task,noShowAutocomplete:!0,isSearch:!0}));return u.a.isMobile?b.a.createElement("div",{className:"searchWrap c-background flexbox f1"},p,f):b.a.createElement(b.a.Fragment,null,b.a.createElement("div",{className:"searchWrap"},b.a.createElement("div",{className:"searchBox c-bg-light flexbox",ref:"searchBox"},b.a.createElement("div",{className:"searchBoxInner flexbox"},p,f),l.length>0&&b.a.createElement("div",{className:"searchButtons noShrink"},l))))}}),ke=a(80),we=a(45),Se=a(33),Ie=a(57);if(u.a.isMobile)var De=a(30).default;var Ce=he.b.createClass({displayName:"ReactTitle",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(e){var t=e.item,a=e.pane,i={customName:a.name,rootText:a.titleOfFirstItem,viewState:a.viewState,viewMode:a.getViewMode(),siblingMode:a.showRootOnRow2};if(e.viewMode)if(a.name.get())i.text=a.name.get();else{i.text=o.a.TaskViewModeTextSimple[i.viewMode];var n=a.getSortModeBlocks(),r=a.getSortModeItems(),s=n&&n!==o.a.TaskSortMode.None;s&&(i.text+=": "+o.a.TaskSortModeText[n]),r&&r!==o.a.TaskSortMode.None&&(i.text+=(s?", ":": ")+o.a.TaskSortModeText[r])}else e.paneName?i.text=a.title:(i.text=this.getTextForItem(t),i.jsx=this.getJSXForItem(t),i.html=this.getHTMLForItem(t));return i},init:function(){this._onMount()},_onMount:function(e){(e=e||this.props).viewMode||this.listenTo(e.item.itemChanged)},componentWillReceiveProps:function(e){e.viewMode===this.props.viewMode&&this.props.item===e.item||(this.refreshListeners(),this._onMount(e),this.updateState(e))},onMouseDown:function(e){u.a.isMobile||(this._holdTimeout=setTimeout(this.openContextMenu,150,{target:e.target}))},onMouseUp:function(){this.clearHoldTimeout()},onClick:function(e){if(u.a.isMobile)De.toggleOverviewVisibility(this.props.pane);else{var t=this.props;n.default.isString(t.item)||(t.last?this.openContextMenu(e):t.pane.onClickTitle(t.item))}},onRightClick:function(e){e.preventDefault(),this.openContextMenu(e)},onDoubleClick:function(e){var t=this.props.pane;n.default.isString(this.props.item)||t.onDoubleClickTitle()},onClickMenuItem:function(e){this.props.pane.onClickTitle(e)},clearHoldTimeout:function(){clearTimeout(this._holdTimeout),this._holdTimeout=void 0},getTextForItem:function(e){return e.generateTitleText(this.props.pane)},getHTMLForItem:function(e){return e.getStyledTextAsOneLine(!1,!1)},getJSXForItem:function(e){var t=this.getTextForItem(e),a=s.default.pluginManager.getPluginGmail();if(a.isLabelItem(e)){var i=a.getIconForLabel(e),r=n.default.classNames("labelText",{hasIcon:!!i});return b.a.createElement("span",{className:r},b.a.createElement("i",{className:i&&"c-foreground-light icon-"+i}),t)}return t},openContextMenu:function(e){var t=this.props,a=t.pane,i=t.item,n=this.state.siblingMode?i.parent()?i.parent().items.get():i.items.get():a.getTitleList();this.clearHoldTimeout(),s.default.menus.openContextMenu({fn:this.renderContextMenuHold,element:e.target,item:a.getItem(),pane:a,titles:n})},renderContextMenuHold:function(e){var t=this;return b.a.createElement(we.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},b.a.createElement(ke.a,{topHeader:!0},this.props.pane.titleContextMenuHeader),e.titles.map(function(a){var i=t.getJSXForItem(a);return b.a.createElement(Se.a,{key:a.id,active:a===e.item,onClick:t.onClickMenuItem.bind(t,a)},i)}))},render:function(){var e,t=this.props,a=this.state,i=t.item,r=(!t.viewMode&&i.parent(),a.text,n.default.classNames("titleWrapper",t.className,{"c-foreground":t.last},{"c-foreground-very-faded c-color-hover":!u.a.isMobile&&!t.last&&!t.viewMode&&!t.paneName},{last:t.last},{firstRow:t.viewMode||t.paneName},{viewMode:t.viewMode})),o=n.default.classNames("title");return e=t.viewMode?"<b>Click</b> to change view mode or name this pane":"<b>Click</b> to zoom to item\n<b>Press and hold</b> to zoom to select a "+(a.siblingMode?"sibling":"parent")+" to zoom to",b.a.createElement(Ie.a,{className:r,"data-tooltip":e,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:t.viewMode?t.pane.openViewMenu:this.onMouseDown,onMouseUp:this.onMouseUp,onContextMenu:this.onRightClick,ripple:!1},(a.jsx||!a.html)&&b.a.createElement("span",{className:o},a.jsx||a.text),!(a.jsx||!a.html)&&b.a.createElement("span",{className:o,dangerouslySetInnerHTML:{__html:a.html}}),t.row1&&b.a.createElement("span",{className:"icon-angle-down c-foreground-super-faded"}))}});if(u.a.isMobile)var Pe=a(30).default;if(u.a.isMobile)var Ae=a(92).default;var Me=he.b.createClass({displayName:"ReactPaneHeader",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){u.a.isMobile&&(this.paneScrollOffset=0,this.createObservables({headerRow2Position:0}))},getState:function(){var e=this.props.pane,t={isOverviewVisible:e.overview.isVisible,item:e.item,showingArchived:e.showArchived,isSearchFocused:e.search.isFocused,isFocused:e.isFocused,titles:e.getTitleList()};return u.a.isMobile&&(t.topBarMode=Pe.topBarMode,t.numSelected=ne.a.numSelected),t},onMount:function(e){u.a.isMobile&&(this.props.pane.addScrollListener(this.onPaneScroll),setTimeout(function(){var e=this.props.pane.getScrollOffset();this.paneScrollOffset=e}.bind(this),0))},onUnmount:function(e){u.a.isMobile&&this.props.pane.removeScrollListener(this.onPaneScroll)},onBeforeChanged:function(e,t){this.refs;u.a.isMobile&&e.item!==t.item&&(this.headerRow2Position.set(0,!1),e.headerRow2Position=0)},onPaneScroll:function(e){var t=this.props.pane.getScrollOffset();if(void 0===this.paneScrollOffset&&(this.paneScrollOffset=t),t!==this.paneScrollOffset&&t>0){var a=this.headerRow2Position.get()+this.paneScrollOffset-t;this.headerRow2Position.set(n.default.clamp(a,-o.a.PaneHeaderRow2Height,0))}this.paneScrollOffset=t},onMouseDown:function(e){u.a.isMobile||e.button!==o.a.ButtonCode.Left||this.props.startDragging(e)},onMouseDownMore:function(e){s.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})},numComplete:function(){return this.props.pane.getItemsToArchive().length},cloneBoard:function(e){me.a.cloneBoard(void 0,e)},_clonePane:function(e,t){var a=s.default.PaneManager.getPaneIndex(t),i=t.getSaveInfoForClone();s.default.PaneManager.createPaneAtIndex(e,a+1,i)},onClickClonePane:function(e){this._clonePane(e,this.props.pane)},onTapOverviewButtonMobile:function(){u.a.isMobile&&Pe.toggleOverviewVisibility(this.props.pane)},onTapMoreButtonMobile:function(){u.a.isMobile&&s.default.menus.toggleContextMenu({fn:this.renderContextMenuMobile})},onTapMultiselectMobile:function(){u.a.isMobile&&Pe.setMultiselectVisibility(!0)},onTapCloseTopStatus:function(){u.a.isMobile&&Pe.resetTopBarMode()},onTapClearMultiselect:function(){ne.a.setSelected([],this.props.pane)},onTapUndoMobile:function(){f.e.undoAction()},onClickStar:function(){this.cloneBoard(this.props.pane)},onClickArchiveCompleted:function(){var e=this.props.pane,t=this.numComplete();s.default.menus.confirm("Are you sure you want to archive "+t+" completed item"+(t>1?"s":"")+"?",function(t){t&&e.archiveCompleted()})},onDoubleClickHeader:function(e){n.default.hasClass(e.target,"paneDraggable")&&this.props.pane.scrollToTop(o.a.ScrollDuration.Default)},onClickCollapseAll:function(){var e=this.props.pane;e.collapseAll(void 0,!0),e.setScrollOffset(e.defaultOffset)},onClickExpandAll:function(){var e=this.props.pane;e.collapseAll(void 0,!1),e.setScrollOffset(e.defaultOffset)},renderContextMenuMobile:function(){if(u.a.isMobile){this.state;var e=this.props.pane;return _.createElement(we.a,{key:"contextMenuMobileOptions",position:"top-right",className:"contextMenuMobile"},e.supportMultiselect&&_.createElement(Se.a,{icon:"icon-done_all",onClick:this.onTapMultiselectMobile},"Multiselect"),_.createElement(Se.a,{icon:"icon-reply",onClick:this.onTapUndoMobile},"Undo"),e.supportCollapsing&&_.createElement(Se.a,{icon:"icon-minus",onClick:this.onClickCollapseAll},"Collapse All Items"),e.supportCollapsing&&_.createElement(Se.a,{icon:"icon-add",onClick:this.onClickExpandAll},"Expand All Items"),e.supportPerformArchive&&_.createElement(Se.a,{icon:"icon-task",disabled:0===this.numComplete(),onClick:e.onClickArchiveCompleted},"Archive Completed"),e.supportDataRefresh&&_.createElement(Se.a,{icon:"icon-spinner",onClick:e.onClickRefreshData},"Force refresh"))}},renderContextMenu:function(e){var t=this.props.pane,a=t.supportDataRefresh||t.supportReportError;return _.createElement(we.a,{key:"contextMenuPaneHeader",element:e.element},_.createElement(_.Fragment,null,_.createElement(Se.a,{icon:"icon-close",onClick:t.onTapClosePane.bind(t)},"Close"),_.createElement("hr",null)),_.createElement(Se.a,{icon:"icon-star_border",onClick:this.onClickStar},"Open pane in new board"),t.supportClone&&u.a.isFeatureEnabled(o.a.Feature.ClonePane)&&_.createElement(Se.a,{icon:"icon-align-left",onClick:this.onClickClonePane.bind(this,o.a.PaneMode.Task)},"Clone Pane"),t.supportPerformArchive&&_.createElement(Se.a,{icon:"icon-task",disabled:0===this.numComplete(),onClick:this.onClickArchiveCompleted},"Archive Completed Items"),a&&_.createElement("hr",null),t.supportDataRefresh&&_.createElement(Se.a,{icon:"icon-spinner",onClick:t.onClickRefreshData},"Force refresh"),t.supportReportError&&_.createElement(Se.a,{icon:"icon-warning",onClick:t.onClickReportError},"Report Error"),t.widthManual&&_.createElement("hr",null),t.widthManual&&_.createElement(Se.a,{icon:"icon-arrows-h",onClick:t.setWidthManual.bind(t,void 0)},"Auto-size pane"))},renderTopStatus:function(e,t){if(u.a.isMobile){return _.createElement("div",{className:"paneHeader"},_.createElement(D.a,{className:"topLeftButton",icon:"icon-close",color:"#444",iconSize:24,width:n.default.topBarHeight,height:n.default.topBarHeight,onClick:this.onTapCloseTopStatus}),_.createElement("div",{className:"topStatus"},e),t)}},render:function(){var e=this.state,t=this.props.pane,a=this.getChildByKey("headerButtons");if(u.a.isMobile){if(e.topBarMode===o.a.TopBarMode.Normal){var i=n.default.classNames("titles f1",{multiline:e.titles.length>1}),r={};return r[u.a.transform.react]="translate3d(0,"+e.headerRow2Position+"px,0)",_.createElement("div",{className:"paneHeader"},_.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox"},_.createElement("div",{className:"leftButtons"},_.createElement(D.a,{icon:"icon-menu",iconSize:24,width:n.default.topBarHeight,height:n.default.topBarHeight,onClick:this.onTapOverviewButtonMobile})),_.createElement("span",{className:i},e.titles.length>1&&_.createElement("div",{className:"titlesParents"},e.titles.map(function(a,i){if(i<e.titles.length-1)return _.createElement(Ce,{key:"title_"+i,isLast:!1,pane:t,item:a})})),_.createElement(Ce,{className:"currentTitle",isLast:!0,pane:t,item:e.titles[e.titles.length-1]})),_.createElement("div",{className:"rightButtons"},_.createElement(D.a,{icon:"icon-more_horiz",color:"#666",iconSize:24,width:n.default.topBarHeight,height:n.default.topBarHeight,onClick:this.onTapMoreButtonMobile}))),_.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox",style:r},a&&_.Children.map(a.props.children,function(e){return e}),!e.isOverviewVisible&&_.createElement(be,{pane:t}),u.a.isMobile&&!e.isOverviewVisible&&_.createElement(Ae,{pane:t})))}return e.topBarMode===o.a.TopBarMode.Multiselect?this.renderTopStatus(e.numSelected+" Selected",_.createElement(D.a,{className:"abs",style:{right:0},enabled:e.numSelected>0,height:44,fontSize:16,primary:!0,fontWeight:"normal",onClick:this.onTapClearMultiselect},"Clear")):this.renderTopStatus(e.topBarMode)}var s=o.a.PaneHeaderButtonWidth,l=o.a.PaneHeaderButtonHeight,d=n.default.classNames("paneHeader c-background c-border",{focused:e.isFocused},{oneRow:1===e.titles.length&&!t.showRootOnRow2},{twoRows:e.titles.length>1||t.showRootOnRow2});return _.createElement("div",{className:d,onDoubleClick:this.onDoubleClickHeader},_.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox",onMouseDown:this.onMouseDown},_.createElement(D.a,{className:"overviewButton",icon:"icon-menu",iconSize:15,width:s,height:l,onClick:t.onTapOverviewButton.bind(t),tooltip:(e.isOverviewVisible?"Close":"Open")+" Overview"}),_.createElement("div",{className:"f1",style:{maxWidth:4}}),_.createElement("span",{className:"titles titlesRow1"},t.supportViewMenu&&_.createElement(Ce,{pane:t,item:e.titles[e.titles.length-1],viewMode:!0,row1:!0}),!t.supportViewMenu&&_.createElement(Ce,{pane:t,item:e.titles[0],paneName:!0,row1:!0})),_.createElement("div",{className:"f1",style:{maxWidth:4}}),_.createElement(be,{pane:t}),_.createElement("div",{className:"f1 paneDraggable"}),a&&_.Children.map(a.props.children,function(e){return e}),_.createElement(D.a,{className:"paneCloseButton",icon:"icon-more_vert",iconSize:17,width:s,height:l,onMouseDown:this.onMouseDownMore,tooltip:"Pane Options"})),(e.titles.length>1||t.showRootOnRow2)&&_.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox paneDraggable",onMouseDown:this.onMouseDown},_.createElement(Ce,{key:"title_0",pane:t,item:e.titles[0],first:!0,last:1===e.titles.length}),_.createElement("div",{className:"paneHeaderRow2Inner f1"},_.createElement("div",{className:"paneHeaderRow2Inner2 paneDraggable"},e.titles.map(function(a,i){if(i>0)return _.createElement(Ce,{key:"title_"+i,pane:t,item:a,last:i===e.titles.length-1})})))))}}),Te=he.b.createClass({displayName:"ReactHiddenInput",componentDisplay:o.a.ComponentDisplay.Desktop,getState:function(){return{position:this.props.pane.caretPosition}},getElement:function(){return this.refs.hiddenInput},render:function(){this.state;var e=this.state.position,t={};return e&&(t.left=e.left,t.top=e.top),b.a.createElement("div",{style:t,contentEditable:!0,className:"paneHiddenInput",ref:"hiddenInput",suppressContentEditableWarning:!0},o.a.TextSpace)}}),Ee=he.b.createClass({displayName:"ReactInfiniteList",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.props.pane.onInfiniteListLoaded(),this.props.owner.notifyInit(this)},onMount:function(){this.props.hiddenInput&&(this.props.pane.hiddenInput=this.refs.hiddenInput.getElement())},onUnmount:function(){this.props.owner.notifyUnmounted()},getState:function(){var e=this.props,t=e.pane,a=e.owner,i=e.overview;return{cells:a.cellsObs,paddingBottom:a.paddingBottom,contentSize:a.contentSize,bottomListMessage:!i&&t.bottomListMessage(),isLoadingNewPage:t.isLoadingNewPage,isLoading:t.isLoading,statusMessage:t.getStatusMessage(this.props.overview),disablePointerEvents:a.disablePointerEvents,rect:this.props.pane.rect,items:a._itemsObs}},isIndexMounted:function(e){return e>=0&&!!this._getElementAtIndex(e)},_getElementAtIndex:function(e){for(var t,a=0,i=this.props,n=this.state,r=0;r<n.cells.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(n.cells[r].index===e){t=r;break}}var o=this.getChildByKey("topBox"),s=t+(i.hiddenInput?1:0)+(o?1:0);return this.refs.contentElement.children[s]},getElementAtIndex:function(e){var t=this._getElementAtIndex(e);return n.default.Assert(t,"Must have a valid mounted item at index",e),t},handleClick:function(){this.props.pane.isLoading.get()&&this.state.statusMessage&&this.props.pane.handleStatusClick()},renderItems:function(){for(var e=0,t=[],a=this.state.cells,i=0;i<a.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(this.props.renderCell(i,a[i]))}return t},render:function(){var e,t=this.state,a=this.props,i=a.pane,r=n.default.classNames(a.contentClass,{noClickItems:t.disablePointerEvents}),s=t.statusMessage,l=t.contentSize+t.paddingBottom;if(!a.isLoading)if(t.bottomListMessage&&t.bottomListMessage.text&&!a.overview){var d=t.bottomListMessage,c={};c[u.a.transform.react]="translateY("+t.contentSize+"px)",e=b.a.createElement("div",{className:"paneBottomMessage c-border-light",style:c},d.clickable?b.a.createElement(D.a,{className:"paneDataPageLoad"},d.text):b.a.createElement("div",{className:"paneDataPageLoad c-foreground-very-faded"},d.text)),l+=40}else a.owner.hasItems()||(r+=" noItems"+(s?" displayStatus":""));var h={};a.orientation===o.a.Orientation.Horizontal?(h.width=(l||200)+"px",h.height="100%"):(h.height=(l||200)+"px",h.width="100%");var f=null;return a.hiddenInput&&(f=b.a.createElement(Te,{ref:"hiddenInput",pane:i})),b.a.createElement("ul",{className:r,style:h,onClick:this.handleClick,spellCheck:!1,draggable:!1,ref:"contentElement","data-pane-status":s},f,this.getChildByKey("topBox"),this.renderItems(),e)}}),Le=he.b.createClass({displayName:"ReactCaret",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isOn:!1})},onMount:function(){document.addEventListener("mousedown",this.startAnim),document.addEventListener("mouseup",this.startAnim)},onUnmount:function(){document.removeEventListener("mouseup",this.startAnim),document.removeEventListener("mousedown",this.startAnim),clearTimeout(this.animTimeout)},getState:function(){var e=this.props.pane;return{info:e.caretPosition,isWindowFocused:g.a.isWindowFocused,activePane:g.a.pane,contextMenus:s.default.menus.contextMenuStack,isPaneActive:g.a.isWindowFocused.get()&&g.a.getPane()===e&&0===s.default.menus.contextMenuStack.get().length}},onAfterChanged:function(e,t){e.isPaneActive&&e.info&&(e.isPaneActive!==t.isPaneActive||e.info!==t.info)&&this.startAnim(e)},startAnim:function(e){this.animTick(!0,e)},animTick:function(e,t){(t=t||this.state).isPaneActive&&t.info&&(clearTimeout(this.animTimeout),this.isOn.set(e||!this.isOn.get()),this.animTimeout=setTimeout(this.animTick,500))},render:function(){var e=this.state,t=this.state.info,a=t&&t.item,i=t&&t.pane,n=t&&t.paneObject,r={height:"18px"};return t&&e.isPaneActive&&g.a.isValid()&&g.a.getStartItem()?(t.isVisible&&(r.height=a&&i&&s.default.DisplaySettings.lineHeightForItem(n,a,i)+"px",r.opacity=e.isOn?1:0),r[u.a.transform.react]="translate3d("+t.left+"px, "+t.top+"px, 0)"):r[u.a.transform.react]="translate3d(-1000px, -1000px, 0)",b.a.createElement("div",{className:"caret c-bg-caret",style:r})}}),xe=he.b.createClass({displayName:"ReactInlineImage",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({draggedWidth:void 0})},onMouseDownResize:function(e){var t=this.props,a=t.line,i=this.refs.image.getBoundingClientRect(),r=s.default.Measure.getImageOriginalSize(a.src,a.srcDataUrl);this.maxWidth=Math.min(r.width,t.pane.maxWidthOfPaneObject(t.paneObject)+(t.item.hasPrefix()?o.a.PrefixWidth:0)),this.draggedWidth.set(t.line.maxWidth||i.width,!1),this.leftPos=i.left,this.rightOffset=i.right-e.clientX,t.onStartResize(),n.default.preventAndStop(e),n.default.isDraggingImage=!0},onMouseMoveResize:function(e){var t=e.clientX-this.leftPos+this.rightOffset;this.draggedWidth.set(n.default.clamp(t,40,this.maxWidth)),n.default.preventAndStop(e)},onMouseUpResize:function(){var e=this.draggedWidth.get();this.props.onEndResize(e),n.default.isDraggingImage=!1},render:function(){var e=this.props,t=e.line,a=e.style,i=e.isHovered,r=e.item,o=e.hasSelection,l=t.srcDataUrl&&t.src!==t.srcDataUrl,u=t.isDriveImage||!s.default.settings.showMarkdown.get()||!o,d=n.default.classNames({mdImage:!t.isDriveImage},{driveImage:t.isDriveImage}),c=n.default.classNames(d,{none:l}),h=n.default.classNames("mdMarkup",{driveImageMarkup:t.isDriveImage}),f={maxWidth:!this.state.draggedWidth&&u&&t.maxWidth,width:this.state.draggedWidth};return b.a.createElement("span",{className:"line",style:a},t.previousText&&b.a.createElement("span",{dangerouslySetInnerHTML:{__html:t.previousText}}),b.a.createElement("span",{className:h},t.originalText),u&&b.a.createElement("div",{className:"mdImageWrapper rel ib",style:f},b.a.createElement("img",{key:n.default.hashCode(t.src),className:c,src:t.src,onLoad:n.default.vmMain.onImageLoaded.bind(n.default.vmMain,r,t.src),"data-original-text":t.originalText,ref:"image"}),l&&b.a.createElement("img",{key:n.default.hashCode(t.srcDataUrl),className:d,src:t.srcDataUrl,onLoad:n.default.vmMain.onImageLoaded.bind(n.default.vmMain,r,t.srcDataUrl),"data-original-text":t.originalText}),i&&b.a.createElement(pe.a,{className:"mdImageResizer flexbox flexvert",onMouseDown:this.onMouseDownResize,onMouseMove:this.onMouseMoveResize,onMouseUp:this.onMouseUpResize,globalEvents:!0})),t.nextText&&b.a.createElement("span",{dangerouslySetInnerHTML:{__html:t.nextText}}))}});if(u.a.isMobile)var Oe=a(30).default;var Re=function(e,t,a){var i=t.overview,n=t.pane;return a.isHeader&&(n.supportCollapsing||i)&&(i||!n.isSearchedFlat())&&!e.isNote()&&!(i&&0===a.levelsDeep)},Fe=function(e,t,a,i){return e=e||o.a.TextSpace},Ne=function(e,t){var a=e.item||e;return!t.isViewAgenda()&&a.isNote()&&a.parent().getPrefix()&&(!e.block||e.block.item!==a.parent())&&o.a.PrefixWidth+o.a.LineLeftPad},Be=function(){this.setState({draggingImage:!0})},Ue=function(e,t,a){var i=this;if(e.isDriveImage){var n=e.attach;n.getPlugin().setAttachWidth(n,a)}else{var r,s=t.getRawText();o.a.Regexp.MDLink.lastIndex=0,null!==(r=o.a.Regexp.MDLink.exec(s))&&(s="!["+r[2]+"]("+r[3]+" ="+a+"x)"),t.setText(s,!0,o.a.ChangeType.Local)}setTimeout(function(){i.setState({draggingImage:!1})},o.a.ItemTransitionTime)},Ve=function(e,t,a,i,r){var l=[],d=a.pane,c=a.cell.paneObject,h=d.maxWidthOfPaneObject(c)+(t.hasPrefix()?o.a.PrefixWidth:0);if(i.selected||t.isNote()){var f={top:0,width:h,height:i.height};f[u.a.transform.react]="translateX("+r+"px)",l.push(b.a.createElement("span",{key:"selStart",className:"textSelected",style:f}))}else if(void 0!==i.selectedStart){var p,m=i.lines.reduce(function(e,t){return e+n.default.unescape(t).length},0),v=i.selectedStart,y=i.selectedEnd;v<0&&(v=0),y<0&&(y=m,p=!0);var _=s.default.Measure.getCaretOffset(c,d,v,!0),k=s.default.Measure.getCaretOffset(c,d,y,g.a.preferLineStart),w=s.default.DisplaySettings.paddingForItemTop(c,t),S=s.default.DisplaySettings.paddingForItemBottom(c,t,d),I=s.default.DisplaySettings.lineHeightForItem(c,t,d),D=!t.isNote()&&k.line>_.line,C=t.shouldShowParents(c,d)?o.a.HeightAgendaParents:0,P=I+(0===_.line?w:0)+(_.line===i.lines.length-1?S:0),A=function(e,t,a,i,n){var r=n.refs.li,o=0;if(r){for(var s=0,l=r.getElementsByClassName("line"),u=0;u<e&&u<l.length;u++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;o+=l[u].getBoundingClientRect().height}0===o&&(o+=i)}return o}(_.line,0,0,C,e);if(_.lineOffset<_.lineLength||!D){var M=D||p?h-_.left:k.left-_.left,T=_.left<0?_.left:0,E={top:A,width:Math.min(M+T,h),height:P,marginLeft:Ne(c,d)};A+=P,E[u.a.transform.react]="translateX("+(_.left-T+r)+"px)",l.push(b.a.createElement("span",{key:"selStart",className:"textSelected textSelectedStart",style:E}))}if(D){var L=k.line-_.line,x=I+(k.line===i.lines.length-1?S:0),O=p?h:k.left;if(L>1){var R=I*(L-1),F={top:A,width:h,height:R};A+=R,F[u.a.transform.react]="translateX("+r+"px)",l.push(b.a.createElement("span",{key:"selMid",className:"textSelected textSelectedMid",style:F}))}var N={top:A,width:O,height:x};N[u.a.transform.react]="translateX("+r+"px)",l.push(b.a.createElement("span",{key:"selEnd",className:"textSelected textSelectedEnd",style:N}))}}return l},je=function(e,t,a){return s.default.DisplaySettings.paddingForItemTop(t,e)+(e.shouldShowParents(t,a)?o.a.HeightAgendaParents:0)},He=function(e){return e.overview||e.cell.paneObject.levelsDeep>0?s.default.DisplaySettings.itemIndentSize()-1:20},ze={onMount:function(e,t,a,i,n){var r=i.pane,o=i.overview;e.listenTo(t.itemChanged),e.listenToDispatcher("numListChanged"),e.listenToDispatcher("EmailPreview","onClosed"),e.listenToDispatcher("EmailPreview","openThreadChanged"),r&&!o&&t.onLoad(r)},onUnmount:function(e){e.disposeDispatcherListeners()},onBeforeChanged:function(e,t,a){if(u.a.isMobile&&u.a.android)if(t.isEditable===a.isEditable||t.isEditable){if(t.isEditable===a.isEditable&&t.isEditable)return!1}else e.props.pane.onFinishedEditingAndroid()},onUpdate:function(e,t,a,i,n,r){if(u.a.isMobile&&i.isEditable&&r.lines!==i.lines)if(u.a.android)e.refs.androidInput.value=t.getParsedText();else for(var o=0,s=e.state.lines,l=e.refs.li.getElementsByClassName("line"),d=0;d<l.length;d++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;l[d].innerHTML=Fe(s[d])}},getState:function(e,t,a,i){var r=i.pane,l=i.cell.paneObject,d=i.overview;if(r.isDestroyed())return{};var c=g.a.isSelected(a,r),h={flags:t.flags,levelsDeep:t.levelsDeep,styleProps:t.styleProps(l,r),isHovered:g.a.isReactCellHovered(e),showVerticalLines:!u.a.isMobile&&!d&&r.supportVertLines&&s.default.settings.ui.showVerticalLines.get(),isSelected:!d&&r===n.default.focusedPane&&ne.a.isSelected(a,r),hasSelection:!!c,hasNote:t.hasNote(),isCollapsed:r.isPaneObjectCollapsed(l,d),isHighlighted:t.isHighlighted,dropBucketItems:u.a.isMobile&&!i.isInDragDrop&&r===n.default.focusedPane&&n.default.vmMain.dropBucket.getItems(),numListNumber:t.isPrefixNumList()&&t.numListNumber(),draggedInPane:t.draggedInPane,isSearchFocused:r.search.isFocused,isBeingDragged:t.draggedInPane.get()===r||u.a.isMobile&&r===n.default.focusedPane&&n.default.vmMain.dropBucket.hasItemEntry(t),isMatchStuckHiding:r.search.isMatchStuckHiding(t)};if(d){if(h.paneItem=r.item,h.lines=[t.getStyledTextAsOneLine(!1,!1)],r.type===o.a.PaneMode.Gmail){var f=s.default.pluginManager.getPluginGmail(),p=t.getParsedText(),m=f.getIconForLabel(t);m&&(h.lines[0]='<span class="labelText hasIcon"><i class="c-foreground-light icon-'+m+'"></i>'+p+"</span>")}u.a.isMobile||(h.isOverviewAtTop=r.getOverview().isItemAtTop(t),h.isOverviewDragHover=r.getOverview().isItemDragHovered(t)),h.isOverviewVisibleInPane=r.type===o.a.PaneMode.Task?r.getItem()!==r.getRootItem()&&r.isOverviewVisibleInPane(t):t===r.getItem(),h.isOverviewFocused=r.getItem()===t,h.isOverviewRoot=r.getRootItem()===t}else{var v=t.getAttachmentByPlugin(o.a.PluginID.Gmail);if(h.isEmailOpen=v&&(r.type===o.a.PaneMode.Gmail&&h.isSelected||v===s.default.EmailPreview.getThreadAttach()&&s.default.EmailPreview.isOpenOnPane(r)),t.isNote())h.lines=r.getStyledLinesForPaneObject(l,d,h.hasSelection);else{var y=r.getMetricsForPaneObject(l,d,h.hasSelection);h.lines=r.search.shouldHighlightSearch()&&y.searchHighlightedLines||y.styledLines}if(u.a.isMobile)u.a.isMobile&&(h.isEditable=t.isEditable,h.isMultiselected=h.isSelected&&Oe.isInMultiselect());else if(h.selected=h.selectedText=h.selectedStart=h.selectedEnd=void 0,c){var _=g.a.getSelectionAtIndex(a);!0===_?h.selected=!0:_.start!==_.end&&(h.selectedStart=_.start,h.selectedEnd=_.end)}else h.selectedText=void 0;t.isNote()&&(h.parentFlags=t.parent().flags,h.parentStyleProps=t.parent().styleProps(l,r))}return h.isHeader=r.isItemHeader(t,d),h},render:function(e,t,a,i,r,l,d,c,h){var f=r.pane,p=r.cell.paneObject,g=r.overview,m=!!(f.isWriteable&&u.a.isMobile&&l.isEditable)||null,v=f.getPaddingForPaneObject(p,g),y=n.default.classNames("item c-foreground",c,l.styleProps,{"c-border-light ":!g},{"c-background":!g&&!a.isNote()},{"overviewItem c-button-overview":g},{overviewAncestor:g&&l.isOverviewAncestor},{overviewFocused:g&&l.isOverviewFocused},{"c-background-overview-selected":g&&l.isOverviewVisibleInPane},{overviewRoot:g&&l.isOverviewRoot},{overviewAtTop:g&&l.isOverviewAtTop},{overviewDragHover:g&&l.isOverviewDragHover},{collapsed:l.isCollapsed},{itemBeingDragged:l.isBeingDragged},{faded:l.faded},{selected:u.a.isMobile&&l.isSelected&&l.isMultiselected},{"c-background-item-selected":!u.a.isMobile&&l.isEmailOpen},{editable:m},{highlighted:l.isHighlighted&&f!==n.default.focusedPane},{"c-bg-faded":!g&&l.isHovered},{firstItem:0===i},{hasSelection:l.hasSelection},{hasNote:l.hasNote},{hasPrefix:!!a.getPrefixLength()},{blockHeader:p.isBlockHeader},{"c-foreground-very-faded":p.isBlockHeader&&l.isCollapsed},{stuckMatch:l.isMatchStuckHiding},{checked:a.isComplete()},{swiping:!!h});if(g||(d=n.default.extend({fontSize:s.default.DisplaySettings.fontSizeForItem(p,a,f),lineHeight:s.default.DisplaySettings.lineHeightForItem(p,a,f)+"px",zIndex:l.draggingImage?1:void 0},d)),u.a.isMobile&&u.a.android&&m){var _={paddingLeft:v,height:d.height,paddingTop:s.default.DisplaySettings.paddingForItemTop(p,a),paddingRight:u.a.windowWidth()-f.maxWidthOfPaneObject(p)-v};return b.a.createElement("li",{"data-moo-id":t,className:y,style:d,ref:"li",contentEditable:m,suppressContentEditableWarning:!0},b.a.createElement("textarea",{className:"androidInput",ref:"androidInput",style:_,defaultValue:a.getParsedText(),onInput:f.onInputAndroid,onChange:n.default.emptyFn}))}return b.a.createElement("li",{"data-moo-id":t,className:y,style:d,ref:"li",contentEditable:m,suppressContentEditableWarning:!0},function(e,t,a,i,r){var l=i.lines,d=a.pane,c=a.overview,h=a.cell.paneObject,f=!c&&d.maxWidthOfPaneObject(h),p=[];if(n.default.Assert(l,"If an item is being rendered it must have styled lines"),l){var g=0;n.default.Assert(!isNaN(r),"Should always have a valid number for padding");var m={width:f};u.a.isFirefox||a.padInsteadOfTransformLines?m.marginLeft=r:c?m.paddingLeft=r:m[u.a.transform.react]="translateX("+r+"px)",c||t.isNote()?l=[l[0]||o.a.TextSpace]:f<n.default.MinItemWidth&&(l=["..."]);for(var v=0;v<l.length;++v){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var y=l[v];if(y.isImage){var _=n.default.extend({paddingTop:!c&&(0===v?je(t,h,d):s.default.DisplaySettings.paddingForItemTop(h,t)),paddingBottom:!c&&s.default.DisplaySettings.paddingForItemBottom(h,t,d)},m);c?p.push(b.a.createElement("span",{className:"line",style:_,key:"line_"+v},y.originalText)):p.push(b.a.createElement(xe,{line:y,item:t,paneObject:h,pane:d,key:"line_"+v,style:_,isHovered:i.isHovered,hasSelection:i.hasSelection,onStartResize:Be.bind(e),onEndResize:Ue.bind(e,y,t)}))}else{var k=n.default.classNames("line",{"c-bg-light":i.isBeingDragged},{first:0===v},{blockHeaderText:v===l.length-1&&h.isBlockHeader},{last:v===l.length-1}),w=n.default.extend({paddingTop:!c&&0===v&&je(t,h,d),paddingBottom:!c&&v===l.length-1&&s.default.DisplaySettings.paddingForItemBottom(h,t,d),height:!c&&s.default.DisplaySettings.lineHeightForItem(h,t,d)+"px",paddingLeft:Ne(h,d)},m);y=Fe(y),!u.a.isMobile&&!a.overview&&d.isViewOutline()&&i.isHovered&&t.isPrefixHeader()&&!d.isSearchedFlat()&&v===l.length-1&&(y+='<span data-tooltip="Add new item to project" class="itemAddButton itemIgnoreText icon-add c-button" />'),!u.a.isMobile&&d.isViewProject()&&h.isBlockHeader&&v===l.length-1&&(y+='<span class="blockHeaderNumItems itemIgnoreText ns c-foreground-faded" data-num-items="'+h.block.items.length+'" />'),p.push(b.a.createElement("span",{className:k,key:"line_"+v,style:w,dangerouslySetInnerHTML:{__html:y}}))}}}return p}(e,a,r,l,v),function(e,t,a,i,n){if(t.hasPrefix()){var r=t.els[0],o=a.cell.paneObject,s=n-5,l={paddingTop:je(t,o,a.pane)};return u.a.isFirefox||a.padInsteadOfTransformLines||a.overview?l.marginLeft=s:l[u.a.transform.react]="translateX("+s+"px)",b.a.createElement("div",{className:r.getClassString(),style:l,"data-listnum":t.isPrefixNumList()?i.numListNumber:void 0})}}(0,a,r,l,v),function(e,t,a,i,n){var r=a.pane;if(!a.overview&&t.shouldShowParents(a.cell.paneObject,r)){var o=t.parents(r.getItem()),l=a.cell.paneObject,u=o.map(function(e,t){return e.generateTitleText()}).join(" > "),d={paddingTop:s.default.DisplaySettings.paddingForItemTop(l,t),marginLeft:n};return u&&b.a.createElement("div",{className:"itemParents c-foreground-very-faded",style:d,"data-tooltip":u},u)}}(0,a,r,0,v),function(e,t,a,i,n){if(i.showVerticalLines&&n>s.default.DisplaySettings.itemIndentStart()){var r=a.pane.extraPaddingForPaneObject(a.cell.paneObject),o=s.default.DisplaySettings.itemIndentStart()+r+6,l=n-o;if(l>0){var u={left:o,width:l};return b.a.createElement("div",{className:"vertLines",style:u})}}}(0,0,r,l,v),function(e,t,a,i,r){var o=a.pane,l=a.cell.paneObject,d=He(a);if(!a.overview&&o.supportMenuIcon&&i.isHovered&&!t.isNote()&&""!==t.getParsedText()&&(!o.isViewAgenda()||!o.shouldShowTime(a.cell.paneObject))){var c={width:r-5-(Re(t,a,i)?d:0),paddingRight:d-20,height:s.default.DisplaySettings.lineHeightForItem(l,t,o)+"px",marginTop:je(t,l,o)+"px"},h=n.default.classNames("itemMenuIcon",{"c-foreground-super-faded c-color-hover":u.a.isMobile||!i.isEmailOpen},{"c-background-item-selected":!u.a.isMobile&&i.isEmailOpen}),f="<b>Drag</b> to move.<br><b>Click</b> to open menu.<br><b>"+u.a.priModKey+" + Click</b> to zoom in.";return b.a.createElement("div",{className:h,style:c,"data-tooltip":f},b.a.createElement("i",{className:"icon-drag-handle"}))}}(0,a,r,l,v),function(e,t,a,i,r){var o=a.overview,l=a.cell.paneObject,d=a.pane;if(i.isHovered&&""===t.getParsedText()&&!t.hasChildren()){var c=n.default.classNames("emptyItemAddButton icon-add c-background c-shadow-light"),h={marginLeft:1===i.levelsDeep?-4:-12};return h[u.a.transform.react]="translateX("+(r-24)+"px)",b.a.createElement("div",{className:c,style:h})}if(Re(t,a,i)){var f=n.default.classNames("collapser c-foreground-super-faded c-color-hover",{"collapsed icon-angle-right":i.isCollapsed},{"icon-angle-down":!i.isCollapsed}),p={left:Math.max(r-5-He(a),0),lineHeight:!o&&s.default.DisplaySettings.lineHeightForItem(l,t,d)+"px",paddingTop:!o&&je(t,l,d)+"px"},g=(u.a.secModKey,"<b>Click</b> to "+(i.isCollapsed?"expand":"collapse")+" item.<br><b>Shift + Click</b> to "+(i.isCollapsed?"expand":"collapse")+" item recursively.<br><b>"+u.a.priModKey+" + Click</b> to zoom in.");return b.a.createElement("div",{className:f,style:p,"data-tooltip":g})}}(0,a,r,l,v),function(e,t,a){var i=a.pane,r=a.cell.paneObject,o=t.getMooDate();if(o){var s=o.isRepeatDate(),l=o.toText(!0),u=n.default.classNames("itemTime c-date pointer"),d={paddingTop:je(t,r,i)+"px"};return b.a.createElement("div",{className:u,style:d},o.getGCalId()&&b.a.createElement("i",{className:"icon-calendar"}),s&&b.a.createElement("i",{className:"icon-spinner"}),l)}}(0,a,r),function(e,t,a,i){var r=a.overview,o=a.cell.paneObject,s=a.pane;if(!u.a.isMobile){var l,d,c={paddingTop:je(t,o,s)};return r||t.isNote()?r&&i.isHovered&&s.supportClickOverviewScroll&&i.isOverviewVisibleInPane&&!i.isOverviewFocused&&(l=n.default.classNames("itemCheckbox c-button","itemOverviewZoom","icon-unfold_less"),d="Scroll to item"):s.supportCheckbox&&i.isHovered?l=n.default.classNames("itemCheckbox c-button","icon-check",{checked:t.isComplete()}):s.isArchiveView&&(l=n.default.classNames("itemCheckbox c-button","itemUnarchive","icon-task"),d="Unarchive"),l&&b.a.createElement("div",{"data-tooltip":d,className:l,style:c})}}(0,a,r,l),g&&l.isHovered&&function(e,t,a,i){if(!u.a.isMobile)return b.a.createElement("div",{className:"overviewOptions icon-more_horiz c-button"})}(),!g&&f.isViewAgenda()&&function(e,t,a){var i=a.pane,r=a.cell.paneObject;if(i.shouldShowTime(r)){var o=i.getItemDisplayTime(r),s=o.indexOf("<div")>=0,l=n.default.classNames("agendaTime cursor-grab",{twoLines:s},{allDay:"All day"===o},{hasParents:t.shouldShowParents(a.cell.paneObject,i)}),u={paddingTop:je(t,r,i)+"px"};return b.a.createElement("div",{className:l,style:u,dangerouslySetInnerHTML:{__html:o}})}}(0,a,r),!g&&(l.selected||void 0!==l.selectedStart)&&Ve(e,a,r,l,v),h)}},qe={onMount:function(e,t,a,i){e.listenTo(i.pane.dragHoveredBlock)},getState:function(e,t,a,i){return{isHovered:i.cell.paneObject.block===i.pane.dragHoveredBlock.get()}},onClickNewProject:function(e,t){var a=t.pane,i=a.getItem().numItems(),n=a.addItemToPane(o.a.Prefix.Header+" ",i),r=a.indexOfItem(n);g.a.selectIndex(r,0)},render:function(e,t,a,i,r,o,l,d){var c,h=a.block,f=h.isCollapsed(),p=n.default.classNames(d,"blockHeader noItem c-border-light flexbox",{blockHeaderDate:h.isDate},{"c-tag":r.pane.isViewTag()},{"c-contact":r.pane.isViewContact()},{agendaBlockRed:!f&&h.isOverdue},{dragHovered:o.isHovered},{"collapsed c-foreground-very-faded":f},{firstBlock:0===i}),g=n.default.classNames("blockCollapser c-foreground-super-faded",{"icon-angle-down":!f&&!h.isNewProject},{"icon-angle-right":f&&!h.isNewProject}),m={paddingBottom:s.default.DisplaySettings.paddingForBlockHeader()},v=b.a.createElement("span",{className:"blockHeaderNumItems c-foreground-faded"},h.numItems());if(h.isDate){var y,_=h.date,k=Date.today(),w=_.isToday()?"Today":_.isSameDay((new Date).clearTime().addDays(1))?"Tomorrow":_.toString("dddd"),S=n.default.classNames("blockHeaderText blockHeaderDayName f1 ib",{"c-foreground-light":!f});_.getMonth()===k.getMonth()&&_.getYear()===k.getYear()||(y=_.toString("MMMM"),S+=" diffMonth"),_.getYear()!==k.getYear()&&(y+=", "+_.toString("yyyy")),c=b.a.createElement(b.a.Fragment,null,b.a.createElement("span",{className:"blockHeaderDateNum"},_.getDate()),b.a.createElement("span",{className:S,style:m},w&&b.a.createElement("div",null,w,v),y&&b.a.createElement("div",{className:"blockHeaderMonth"},y)))}else if(h.isNewProject)c=b.a.createElement("span",{className:"blockHeaderText pointer f1 c-foreground-very-faded",style:m,onClick:this.onClickNewProject.bind(this,e,r)},"New project");else{var I=h.isStarred&&b.a.createElement("i",{className:"icon-star"})||h.isImportant&&b.a.createElement("i",null,"!");c=b.a.createElement("span",{className:"blockHeaderText f1",style:m},I,h.text,v)}return u.a.isMobile?b.a.createElement(pe.a,{ref:"li","data-moo-id":t,className:p,style:l,onClick:h.toggleCollapsed},b.a.createElement("span",{className:g}),c):b.a.createElement("li",{ref:"li","data-moo-id":t,className:p,style:l},b.a.createElement("span",{className:g,onClick:h.toggleCollapsed}),c)}},We={render:function(e,t,a,i,r,o,s){var l=n.default.classNames("hr c-border-heavy",r.className);return b.a.createElement("li",{"data-moo-id":t,className:l,style:s},a.text)}},Ge={onClick:function(e,t){var a=t.block;a.addFn(a)},render:function(e,t,a,i,r,o,s,l){l=n.default.classNames(l,"taskAddButton");var d=a.block,c=n.default.classNames(u.a.isMobile?"c-foreground-faded":"c-foreground-ultra-faded");return b.a.createElement("li",{ref:"li","data-moo-id":t,className:l,style:s},!d.noAddButton&&b.a.createElement(pe.a,{className:c,onClick:this.onClick.bind(this,e,a,i)},b.a.createElement("i",{className:"icon-add"}),"Add item"))}},Ke=a(62),Ye=he.b.createClass({displayName:"ReactMonthDay",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){d.a.listen("endDrag",this.onDragEnd),this.createObservables({isHovered:!1}),this.listenToDispatcher("dateChanged")},arePropsEqual:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0},areStatesEqual:function(e,t,a){if("items"===e){var i=0;if(!t||!a||t.length!==a.length)return!1;for(var n=0;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t[n].time!==a[n].time||t[n].item!==a[n].item)return!1}return!0}},componentWillReceiveProps:function(e){e.items!==this.props.items&&this.updateState(e)},getState:function(e){var t={};if(e.items){for(var a=0,i=[],n=[],r=0;r<e.items.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=e.items[r];if(!l.isNote()){var u=l.getNextDate(this.props.date),d=u.hasTimeOfDay()&&u.toString(s.default.International.getFormat(o.a.DFormat.ShortTime));d?n.push({time:d,item:l}):i.push({item:l})}}t.items=i.concat(n)}return t},onMouseDown:function(e){e.preventDefault()},onMouseEnter:function(){if(s.default.DragDrop.isDragging){this.isHovered.set(!0);var e=s.default.DragDrop.dragItem.date();s.default.DragDrop.setBlockTarget({date:this.props.date,dateTime:e&&e.hasTimeOfDay()&&e,isDate:!0})}},onDragEnd:function(){this.isHovered.set(!1)},onMouseLeave:function(){this.isHovered.set(!1)},onDoubleClick:function(e){var t=this.props,a=t.pane,i=t.date,n=a.item.get(),r=s.default.International.getAppendDateText(i);a.openItemEditor({element:e.target,text:" @"+r,parent:n,selectIndex:0,pos:{top:e.clientY},showCalendarButtons:!0,addOnSave:!0})},render:function(){var e,t=this.props,a=this.state,i=t.date,r=0===i.getDay()||6===i.getDay(),s=i.getDate(),l=Date.getDaysInMonth(i.getFullYear(),i.getMonth()),u=n.default.classNames("dateBlock c-border",{firstDay:1===i.getDate()},{lastDay:i.getDate()===l},{"weekend c-bg-faded":r},{"c-background":!r},{hoveredInDrag:a.isHovered},{today:i.isToday()}),d={left:t.left-1,width:t.width+1},c=n.default.classNames("dateBlockDay");if(a.items){for(var h=0,f=0,p=[],g=!1,m=0;m<a.items.length;m++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var v=a.items[m];v.time&&v.item.hasAttachmentType(o.a.PluginType.Calendar)&&(g=!0)}for(var y=0;y<a.items.length;y++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var _=a.items[y],k=_.time,w=_.item,S=g&&k,I=n.default.classNames("dateBlockItem flexbox",{hasCircle:S}),D=null;if(S){var C={background:w.hasAttachmentType(o.a.PluginType.Calendar)&&w.getCalendarColor()};D=b.a.createElement("div",{className:"monthItemColorCircle",style:C})}p.push(b.a.createElement("div",{className:I,key:w.id},D,b.a.createElement(Ke.a,{className:"itemInCalendar",item:w,pane:t.pane,coloredInCalendar:!k&&w.getCalendarColor(),showPriority:!0,allowDrag:!0,editOnClick:!0}),k&&t.width>100&&b.a.createElement("span",{className:"itemTime"},k)))}e=(t.items||a.isHovered)&&b.a.createElement("div",{className:"dateBlockItems"},p)}return b.a.createElement("div",{className:u,style:d,onMouseDown:this.onMouseDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onDoubleClick:this.onDoubleClick},b.a.createElement("div",{className:c},s),e)}}),Xe={getState:function(e,t,a,i){return{paneRect:i.pane.rect}},render:function(e,t,a,i,r,o,s){var l,u=0,d=r.pane,c=n.default.classNames("calendarWeek c-bg-app","flexbox",r.className),h=d.getWidth()+1,f=Math.floor(h/7),p=h-7*f,g=0,m=0;p>0&&(g=Math.ceil(p/2),m=p-g),s.height+=1;for(var v=0;v<a.dates.length;v++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var y=a.dates[v];y&&1===(y=y.date).getDate()&&(l=y.toString("MMMM"),y.getYear()!==Date.today().getYear()&&(l+=y.toString(" yyyy")))}return b.a.createElement("li",{"data-moo-id":t,className:c,style:s},a.dates.map(function(e,t){var a=f+(0===t?g:0)+(6===t?m:0);return b.a.createElement(Ye,{key:e.date.getTime(),pane:d,date:e.date,items:e.items,index:t,left:t*f+(t>0?g:0),width:a})}),l&&b.a.createElement("div",{className:"calendarMonthTitle c-bg-app"},l))}},Qe=a(43);function Je(e){return(Je="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ze(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $e(e,t){return!t||"object"!==Je(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tt(e,t){return(tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var at=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),$e(this,et(t).apply(this,arguments))}var a,i,r;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(t,he["a"]),a=t,(i=[{key:"init",value:function(){this.createObservables({hoveredTime:void 0,hoveredDuration:void 0,isResizing:!1}),this.listenToDispatcher("dateChanged"),this.listenToDispatcher("endDrag")}},{key:"arePropsEqual",value:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0}},{key:"areStatesEqual",value:function(e,t,a){if("items"===e){var i=0;if(!t||!a||t.length!==a.length)return!1;for(var n=0;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!t[n].date.equals(a[n].date)||t[n].item!==a[n].item||t[n].duration!==a[n].duration)return!1}return!0}}},{key:"componentWillReceiveProps",value:function(e){e.date.equals(this.props.date)&&e.items===this.props.items||this.updateState(e)}},{key:"getState",value:function(e){var t=e.date.isToday(),a={isToday:t,todayTime:t&&new Date,numAllDay:e.pane.numAllDay};if(a.heightHeader=e.pane.getHeightAllDay(),e.items){var i=0;a.items=[];for(var n=0;n<e.items.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e.items[n];if(!r.isNote()){var o=r.getNextDate(this.props.date);a.items.push({date:o,duration:r.getDuration(),item:r})}}}return a}},{key:"onMount",value:function(){this.state.isToday&&this.runTimeTimer()}},{key:"onUnmount",value:function(){clearTimeout(this.timeTimeout)}},{key:"componentDidUpdate",value:function(e){this.props.date.equals(e.date)||(this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0))}},{key:"onBeforeChanged",value:function(e,t){return e.isToday?this.runTimeTimer():t.isToday&&!e.isToday&&clearTimeout(this.timeTimeout),!t.hoveredTime||s.default.DragDrop.isDragging||this.resizing||(this.hoveredTime.set(void 0,!1),this.hoveredDuration.set(void 0,!1),e.hoveredTime=void 0,e.hoveredDuration=void 0),e}},{key:"runTimeTimer",value:function(){clearTimeout(this.timeTimeout),this.timeTimeout=setTimeout(this.updateState,3e5)}},{key:"resetHovered",value:function(){this.resizing&&(this.resizing.component&&this.resizing.component.stopResizing(),this.resizing=void 0,this.isResizing.set(!1)),this.mouseDownAtTime=void 0,this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0)}},{key:"onMouseUp",value:function(e){document.removeEventListener("mouseup",this.onMouseUp),this.resizing&&this.resizing.placeholder?this.addTime(this.hoveredTime.get(),this.hoveredDuration.get(),e):this.resetHovered()}},{key:"onMouseLeave",value:function(){this.resizing||this.resetHovered()}},{key:"getTimeFromMouseEvent",value:function(e){var t=e.clientY;return s.default.DragDrop.isDragging&&s.default.DragDrop.startPane&&s.default.DragDrop.startPane.isViewDates()&&s.default.DragDrop.startInfo&&(t+=12-(s.default.DragDrop.startInfo.y-s.default.DragDrop.position.top)),t-=n.default.findParent(e.target,"calendarDayTimes").getBoundingClientRect().top,Math.floor(t/(o.a.CalendarDayViewBlockHeight+1)*4)/4}},{key:"onMouseDown",value:function(e){document.addEventListener("mouseup",this.onMouseUp),n.default.hasClass(e.target,"calendarDayTimes")&&(this.mouseDownAtTime=this.getTimeFromMouseEvent(e)),e.preventDefault()}},{key:"onMouseMove",value:function(e){if(void 0!==this.mouseDownAtTime&&(this.resizing={placeholder:!0,pivot:this.mouseDownAtTime},this.mouseDownAtTime=void 0),s.default.DragDrop.isDragging){var t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var a=1,i=s.default.DragDrop.dragItem;i&&i.getDuration()&&(a=i.getDuration()/o.a.MSPerHour),this.hoveredDuration.set(a,!1),this.hoveredTime.set(t),(d=this.props.date.clone()).setHours(Math.floor(t)),d.setMinutes(60*(t-Math.floor(t))),s.default.DragDrop.setBlockTarget({date:d,dateTime:d,duration:1!==a?a*o.a.MSPerHour:null,isDate:!0})}}else if(this.resizing){t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var n=this.resizing,r=n.pivot,l=t>=r?r:t,u=Math.floor(4*(t>=r?t-r+.5:r-t))/4;if(!isNaN(l)&&u>=.25)if(n.item){var d,c={isDate:!0};(d=this.props.date.clone()).setHours(Math.floor(l)),d.setMinutes(Math.round(60*(l-Math.floor(l)))),c.duration=u*o.a.MSPerHour,c.date=c.dateTime=d,s.default.PaneUpdateBatcher.beginUpdateItems();var h=this.props.pane;h.applyDropOnBlock(c,n.item,h),s.default.PaneUpdateBatcher.commitUpdateItems()}else n.placeholder&&(u===this.hoveredDuration.get()&&l===this.hoveredTime.get()||(this.hoveredDuration.set(u,!1),this.hoveredTime.set(l,!0)))}}}},{key:"onMouseEnterAllDay",value:function(){if(s.default.DragDrop.isDragging){var e=this.props.date;this.hoveredDuration.set(1,!1),this.hoveredTime.set(-1),s.default.DragDrop.setBlockTarget({date:e,isDate:!0,allDay:!0})}}},{key:"onDoubleClickTimes",value:function(e){var t=this.getTimeFromMouseEvent(e);this.addTime(t,1,e)}},{key:"addTime",value:function(e,t,a){var i=this.props,n=i.pane,r=i.date,s=n.item.get();e&&(r=r.addHours(e));var l=new Qe.a(r,{duration:t*o.a.MSPerHour});n.openItemEditor({element:a.target,text:"",parent:s,selectIndex:0,mooDate:l,pos:{left:a.clientX,top:a.clientY},addOnSave:!0,onClosed:this.resetHovered})}},{key:"onItemResizeStart",value:function(e,t,a){if(e.hasTime()){var i=e.getTimeOfDay(),r=e.getDuration()/o.a.MSPerHour||1,s=n.default.round(i/o.a.MSPerHour,4),l=a?s:s+r;return this.resizing={item:e,component:t,pivot:l},this.isResizing.set(!0),!0}}},{key:"addToDay",value:function(e,t,a,i){e.push({t:t,dur:a,item:i,top:t,bottom:t+a,obj:i})}},{key:"packItems",value:function(e){var t=0;e=e.sort(function(e,t){return e.top<t.top?-1:e.top>t.top?1:e.bottom<t.bottom?-1:e.bottom>t.bottom?1:0});for(var a=[],i=[],n=null,r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e[r];if(o.isPlaceholder)i=i.concat.apply(i,this.packEvents([[o]]));else{var s=0;null!==n&&o.top>=n&&(this.packEvents(a),i=i.concat.apply(i,a),a=[],n=null);for(var l=!1,u=0;u<a.length;u++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=a[u];if(!this.collidesWith(d[d.length-1],o)){d.push(o),l=!0;break}}l||a.push([o]),(null===n||o.bottom>n)&&(n=o.bottom)}}return a.length>0&&(this.packEvents(a),i=i.concat.apply(i,a)),i}},{key:"packEvents",value:function(e){for(var t=0,a=e.length,i=0;i<a;i++){var n=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var r=e[i],o=0;o<r.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=r[o],l=this.expandEvent(s,i,e);s.pos=i/a*100,s.width=100*l/a}}return e}},{key:"collidesWith",value:function(e,t){return e.bottom>t.top&&e.top<t.bottom}},{key:"expandEvent",value:function(e,t,a){for(var i=0,n=1,r=t+1;r<a.length;r++){var o=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var s=a[r],l=0;l<s.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=s[l];if(this.collidesWith(e,u))return n}n++}return n}},{key:"renderItems",value:function(){var e,t=0,a=this.props,i=this.state,r=i.items,s=[],l=i.hoveredTime,u=i.hoveredDuration;for(e=0;e<r.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var d=r[e].item,c=a.pane.getItemPlacementOnDate(d,a.date);c&&this.addToDay(s,c.time,c.duration,d)}isNaN(l)||isNaN(u)||s.push({t:l,dur:u,top:l,bottom:l+u,isPlaceholder:!0});var h,f=this.packItems(s);if(f.length){var p=0;for(h=[],e=0;e<f.length;e++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var g=f[e],m=g.isPlaceholder,v=this.props.pane,y={height:g.dur*o.a.CalendarDayViewBlockHeight+Math.ceil(g.dur)-1,left:m?0:g.pos+"%",width:m?"95%":g.width+"%",top:Math.floor(g.t*(o.a.CalendarDayViewBlockHeight+1))},_=n.default.classNames("dayTimeBlock abs",{placeholder:m});h.push(b.a.createElement("div",{className:_,key:m?"placeholder":g.item.id,style:y},g.item&&b.a.createElement(Ke.a,{className:"itemInCalendar itemInCalendarResizable",item:g.item,pane:v,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}}return h}},{key:"renderItemsAllDay",value:function(){for(var e=0,t=this.props,a=this.state,i=a.items,n=t.pane,r=[],o=a.hoveredTime,s={},l=0;l<i.length;l++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var u=i[l].item;t.pane.getItemPlacementOnDate(u,t.date)||r.push(b.a.createElement("div",{className:"dayTimeBlock",key:u.id,style:s},b.a.createElement(Ke.a,{className:"itemInCalendar",item:u,pane:n,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}return!isNaN(o)&&o<0&&r.push(b.a.createElement("div",{className:"dayTimeBlock placeholder",key:"placeholder"})),r}},{key:"render",value:function(){var e,t,a,i,r,s,l=this.props,d=this.state,c=(l.pane,l.date),h=0===c.getDay()||6===c.getDay(),f=this.renderItemsAllDay();if(d.isToday){var p=d.todayTime,g={top:Math.floor((p.getHours()+p.getMinutes()/60)*(o.a.CalendarDayViewBlockHeight+1))};s=b.a.createElement("div",{className:"calendarDayTimeLine",style:g})}e={width:l.width},t={top:d.heightHeader+30+3,height:l.height-d.heightHeader,width:l.width},a={height:d.heightHeader,minHeight:d.heightHeader},e[u.a.transform.react]=t[u.a.transform.react]=l.transform;var m=n.default.classNames("allDay c-border-heavy f1 preventScrollPropagate",{"c-bg-faded weekend":h}),v=n.default.classNames("calendarDayTimes c-border-heavy",{"c-bg-faded":h});i=b.a.createElement("ul",{className:m,style:a,onMouseEnter:this.onMouseEnterAllDay,onDoubleClick:this.addTime.bind(this,void 0,void 0),onMouseLeave:this.onMouseLeave},f),r=b.a.createElement("div",{className:v,style:t,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},b.a.createElement("div",{className:"calendarDayGradient"}),b.a.createElement("div",{className:"calendarDayItems"},this.renderItems()),s);var y,_={className:n.default.classNames("calendarDay",{"weekend c-bg-faded":h},{today:d.isToday},{resizing:d.isResizing},l.className),"data-moo-id":l["data-moo-id"]};return c.getYear()!==Date.today().getYear()&&(y=c.toString(", yyyy")),b.a.createElement(l.component,_,b.a.createElement("div",{className:"calendarDayHeader c-background c-border-heavy flexbox flexvert",style:e},b.a.createElement("div",{className:"dayTitle"},b.a.createElement("span",null,c.toString("ddd MMM ")),b.a.createElement("span",{className:"dayTitleDay"},c.getDate()),y&&b.a.createElement("span",null,y)),i),r)}}])&&Ze(a.prototype,i),r&&Ze(a,r),t}(),it={getState:function(e,t,a,i){return{numAllDay:i.pane.numAllDay}},render:function(e,t,a,i,r,o,s){var l=r.pane,d=n.default.classNames("calendarDay",r.className);return b.a.createElement(at,{"data-moo-id":t,component:"li",className:d,date:a.date,items:a.items,pane:l,height:s.height,transform:s[u.a.transform.react],width:l.getDayWidth()})}},nt=he.b.createClass({displayName:"ReactCell",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.DISABLE_LISTENER_ASSERT=!0,this.allowTransition=this.props.pane.supportCellTransition&&this.props.cell.isLive,this.createObservables({isHoveredLong:!1}),this.props.list.listen("reMount",this.reMount)},areStatesEqual:function(e,t,a){var i=this.props.cell.isLive&&this._getRenderer();if(i&&i.areStatesEqual)return i.areStatesEqual(e,t,a)},getState:function(e){var t,a=e.cell,i=a.paneObject,r=i;a.isLive&&(t=this._getRenderer(),r=this._getRenderObj());var o={isLive:a.isLive,item:r,id:i&&i.id,index:a.index,height:a.height,offset:a.offset,prevOffset:a.prevOffset,renderer:t,offsetX:a.offsetX,isAnimatingOffsetX:a.isAnimatingOffsetX,faded:!1};return a.isLive&&t&&t.getState&&(o=n.default.extend(o,t.getState(this,r,a.index,this.props))),o},onMount:function(){this.listenTo(this.props.cell.cellChanged,!1),this._onMount()},onBeforeChanged:function(e,t){var a=this;if(this.allowTransition=this.props.pane.supportCellTransition&&e.isLive&&this.props.cell.wasLive,u.a.isMobile&&u.a.android){if(e.renderer===t.renderer&&e.renderer.onBeforeChanged)return e.renderer.onBeforeChanged(this,e,t)}else u.a.isMobile||this.props.pane.isViewDates()&&e.isHovered!==t.isHovered&&(e.isHovered?setTimeout(function(){a.state.isHovered&&a.isHoveredLong.set(!0)},o.a.TooltipDelay):(this.isHoveredLong.set(!1,!1),e.isHoveredLong=!1))},componentDidUpdate:function(e,t){var a=this.state.item,i=t.item,n=this.state.renderer;n!==t.renderer&&t.renderer&&t.renderer.onUnmount&&t.renderer.onUnmount(this,i),a!==i&&(this.needsRefresh={prevState:t},this.props.list.isDelayingMounts||this.reMount()),n&&n.onUpdate&&n.onUpdate(this,a,this.props,this.state,e,t)},_onMount:function(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onMount&&t.onMount(this,e,this.state.index,this.props,this.state)},onUnmount:function(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onUnmount&&t.onUnmount(this,e,this.state.index,this.props,this.state)},reMount:function(){if(this.needsRefresh){var e=this.needsRefresh.prevState,t=e.item;this.refreshListeners(),t&&e.renderer&&e.renderer.onUnmount&&e.renderer.onUnmount(this,t),this._onMount(),this.needsRefresh=void 0}},_getRenderer:function(){var e,t=this.props.cell.paneObject;return n.default.isVMLI(t)?e=ze:"blockItem"===t.type?e=ze:"blockHeader"===t.type?e=qe:"hr"===t.type?e=We:"calendarWeek"===t.type?e=Xe:"calendarDay"===t.type?e=it:"blockAddItem"===t.type&&(e=Ge),e},_getRenderObj:function(){var e=this.props.cell.paneObject;return"blockItem"===e.type?e.item:e},_getCellState:function(){var e=this.state,t={cell:this.props.cell.getState(),reactCell:{item:e.item.id,index:e.index,height:e.height,offset:e.offset,prevOffset:e.prevOffset,isLive:e.isLive}};return this.refs.li&&(t.element=n.default.getElementPath(this.refs.li)),t},getIndex:function(){return n.default.Assert(this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState()),this.state.index},getItem:function(){return n.default.Assert(this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState()),this.state.item},getCell:function(){return this.props.cell},getPaneObject:function(){return this.props.cell.paneObject},renderSwipeMenu:function(e,t,a){var i=this.props.pane,r={left:(a>0?"-":"")+"100%"},o={},s=i.sizeOfItem(e,t),l=i.getSwipeMenuItem(e,a);if(l){o[a>0?"right":"left"]=16;var u=n.default.isFunction(l.icon)?l.icon(e):l.icon,d=n.default.isFunction(l.color)?l.color(e):l.color,c=n.default.isFunction(l.text)?l.text(e):l.text;r.background=d,s<44&&(r.height=44,r.marginTop=-(44-s)/2);var h={float:a<0?"right":"left",padding:a<0?"0 0 0 16px":"0 16px 0 0"};return b.a.createElement("div",{className:"itemSwipeMenu",style:r},u&&b.a.createElement("div",{className:"itemSwipeIcon",style:o},b.a.createElement("i",{className:u}),b.a.createElement("span",{style:h},c)))}},onClick:function(){},render:function(){var e=this.props,t=this.state,a=t.isLive?t.offset:-1e3,i=this.getUniqueID(),r=t.renderer,s=n.default.getItemAnimationMode(),l={height:t.height},d=n.default.classNames("cell",{transition:this.allowTransition&&s!==o.a.ItemAnimationMode.None});if(t.offsetX?l[u.a.transform.react]="translate3d("+t.offsetX+"px,"+a+"px,0)":(t.isAnimatingOffsetX&&(l[u.a.transition.react]=u.a.transform.style+" 0.15s"),e.orientation===o.a.Orientation.Horizontal?l[u.a.transform.react]="translate("+a+"px,0)":l[u.a.transform.react]="translate(0,"+a+"px)"),r&&t.isLive){var c=!!t.offsetX;return r.render(this,i,t.item,t.index,e,t,l,d,c&&this.renderSwipeMenu(t.item,t.index,t.offsetX))}return b.a.createElement("li",{"data-moo-id":i,className:"itemdead",style:l})}}),rt=he.b.createClass({displayName:"ReactToast",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(e){return{text:e.toast.text}},componentWillReceiveProps:function(e){this.updateState(e)},render:function(){var e=this.props.toast,t=this.state.text,a=n.default.classNames("toast noSelect",{hasAction:!!e.actionText},{big:e.isBig});return b.a.createElement("div",{className:a,onClick:e.onTapIgnore},b.a.createElement(D.a,{width:40,height:40,icon:"icon-close",className:"messageClose",onClick:e.onTapIgnore&&e.onTapIgnore}),b.a.createElement("span",{className:"messageText f1",dangerouslySetInnerHTML:{__html:t}}),b.a.createElement(D.a,{primary:!0,className:"messageAction",onClick:e.doAction.bind(e)},e.actionText))}}),ot=he.b.createClass({displayName:"ReactFormattingToolbar",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){},getState:function(){return{showFormattingToolbar:s.default.settings.showFormattingToolbar,position:g.a.itemHighlightPosition,pane:g.a.getPane(),numSelected:g.a.getSelectedItems().length,isCollapsed:0===s.default.settings.showFormattingToolbar.get()}},onClickFormat:function(e){n.default.vmMain.applyFormatToSelection(e)},onClickPrefix:function(e){n.default.vmMain.applyPrefixToSelection(e)},onClickNote:function(){var e=g.a.getStartItem();e&&g.a.editNote(e)},onClickLink:function(){g.a.getStartItem().insertLinkAtSelection()},onClickToggleShow:function(){var e=s.default.settings.showFormattingToolbar.get();e=0===e?1:0,s.default.settings.showFormattingToolbar.set(e)},render:function(){var e=this.state,t=this.props,a=e.position,i=e.position&&e.pane===t.pane,n=e.isCollapsed;if(i){var r=n?24:32,s=n?24:36,l=n?24:329,d=Math.min(Math.max(Math.floor(a.x),l/2+4),e.pane.getWidth()-l/2-4),c={height:s,width:l,marginLeft:-l/2,marginTop:-s-4};return c[u.a.transform.react]="translate3d("+d+"px,"+Math.floor(a.y)+"px,0)",n?b.a.createElement("div",{className:"formattingToolbar collapsed c-popup c-bg-sidebar c-shadow-popup",style:c},b.a.createElement(D.a,{icon:"icon-more_horiz",width:l,height:l,iconSize:14,tooltip:"Show formatting toolbar",onClick:this.onClickToggleShow})):b.a.createElement("div",{className:"formattingToolbar c-popup c-bg-sidebar c-shadow-popup",style:c},b.a.createElement(D.a,{icon:"icon-format_bold",width:r,height:s,iconSize:19,onClick:this.onClickFormat.bind(this,"**"),tooltip:"Bold",tooltipHotkey:{name:"Bold"}}),b.a.createElement(D.a,{icon:"icon-format_italic",width:r,height:s,iconSize:19,onClick:this.onClickFormat.bind(this,"*"),tooltip:"Italic",tooltipHotkey:{name:"Italic"}}),b.a.createElement(D.a,{icon:"icon-format_underlined",width:r,height:s,iconSize:18,onClick:this.onClickFormat.bind(this,"__"),tooltip:"Underline",tooltipHotkey:{name:"Underline"}}),b.a.createElement("div",{className:"divider"}),b.a.createElement(D.a,{icon:"icon-project",width:r,height:s,iconSize:18,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Header),tooltip:"Project",tooltipHotkey:o.a.Prefix.Header+"&nbsp;&nbsp; Space"}),b.a.createElement(D.a,{icon:"prefixTask",width:r,height:s,iconSize:20,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Task),tooltip:"Task",tooltipHotkey:o.a.Prefix.Task+"&nbsp;&nbsp; Space"}),b.a.createElement(D.a,{icon:"icon-bullet",width:r,height:s,iconSize:22,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Bullet),tooltip:"Bulleted list",tooltipHotkey:o.a.Prefix.Bullet+"&nbsp;&nbsp; Space"}),b.a.createElement(D.a,{icon:"icon-numlist",width:r,height:s,iconSize:14,onClick:this.onClickPrefix.bind(this,o.a.Prefix.NumList),tooltip:"Numbered list",tooltipHotkey:o.a.Prefix.NumList+"&nbsp;&nbsp; Space"}),b.a.createElement("div",{className:"divider"}),b.a.createElement(D.a,{icon:"icon-link",enabled:1===e.numSelected,width:r,height:s,iconSize:18,onClick:this.onClickLink,tooltip:"Create link",tooltipHotkey:{name:"InsertLink"}}),b.a.createElement(D.a,{icon:"icon-sticky-note-o",enabled:1===e.numSelected,width:r,height:s,iconSize:14,onClick:this.onClickNote,tooltip:"Add note",tooltipHotkey:{name:"EditNote"}}),b.a.createElement("div",{className:"divider"}),b.a.createElement(D.a,{icon:"icon-minus",width:r,height:s,iconSize:10,tooltip:"Hide formatting toolbar",onClick:this.onClickToggleShow}))}return null}}),st=a(53);if(u.a.isMobile)var lt=a(30).default;var ut=he.b.createClass({displayName:"ReactPane",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({dragOffset:0,isDragging:!1})},onMount:function(){var e=this.props.pane,t=e.scrollElement=this.refs.scroller.getScrollElement(),a=e.rootElement=this.refElement("rootElement"),i=e.paneContent=this.refElement("contentElement"),r=e.getInfiniteList(!1);e.element=this.refs.pane,r.setupScroller(t,i),u.a.isMobile||r.setScrollHandler(this.onScroll),a.addEventListener("compositionstart",e.compositionStart),a.addEventListener("compositionend",e.compositionEnd),u.a.android||a.addEventListener("input",e.onInput),n.default.setupClick(this.refs.scroller.getElement(),e,{onStart:e.onTapStart,onMove:e.onTapMove,onClick:e.onTapClick,onEnd:e.onTapEnd,onDoubleClick:e.onTapDoubleClick,onRightClick:e.onTapRightClick}),e.onLoad(),e.getOverview().onPaneLoad(),d.a.fireEvent("paneAdded",[e])},getState:function(){var e,t=this.props.pane;return t.isDestroyed()?e={}:(e={rect:t.rect,left:t.getLeft(),isExpanded:!u.a.isMobile&&t.isExpanded,isActive:t.isActive,isOverviewVisible:t.overview.isVisible,isHelpVisible:!!n.default.intro&&n.default.intro.isVisible,item:t.item,paneTopText:t.paneTopText,orientation:t.orientation,titles:t.getTitleList(),showScrollbars:t.showScrollbars,toast:t.toast,_showFormattingToolbar:s.default.settings.showFormattingToolbar,showFormattingToolbar:s.default.settings.showFormattingToolbar.get()>0},u.a.isMobile?e.bottomBarHeight=lt.bottomBarHeight:e.parents=t.getItem().parents()),e},getPane:function(){return this.props.pane},itemsObs:function(){return this.props.pane.items},getScrollSize:function(){return this.props.pane.getInfiniteList(!1).getScrollSize()},getClientHeight:function(){return this.props.pane.getHeight()},getScrollTop:function(){return this.props.pane.getInfiniteList(!1).getScrollTop()},onScroll:function(){this.refs.scroller&&this.refs.scroller.handleScroll()},startDragging:function(e){n.default.hasClass(e.target,"paneDraggable")&&s.default.PaneManager.paneCount()>1&&(this.hasMovedDrag=!1,this.dragStartX=e.clientX-this.props.pane.rect.get().left,document.addEventListener("mousemove",this.onDragMove),document.addEventListener("mouseup",this.onDragUp))},onDragMove:function(e){this.hasMovedDrag||(this.hasMovedDrag=!0,s.default.DragDrop.isDraggingPane.set(!0),this.isDragging.set(!0));var t=this.props.pane.rect.get(),a=e.clientX-this.dragStartX-t.left;this.updateDragOffset(a),s.default.PaneManager.dragPaneTo(this.props.pane,t.left+a,t.right+a)&&this.updateDragOffset(e.clientX-this.dragStartX-this.props.pane.rect.get().left)},onDragUp:function(){this.isDragging.set(!1),s.default.DragDrop.isDraggingPane.set(!1),document.removeEventListener("mousemove",this.onDragMove),document.removeEventListener("mouseup",this.onDragUp),this.updateDragOffset(0)},updateDragOffset:function(e){this.dragOffset.set(e)},renderScrollerWrapper:function(e,t){if(u.a.isMobile){var a={position:"relative"},i=e.offsetX;return i&&(a[u.a.transform.react]="translate3d("+i+"px,0,0)"),this.props.pane.isAnimatingOffset&&(a[u.a.transition.react]=u.a.transform.style+" 0.15s"),b.a.createElement("div",{className:"paneScrollerWrapper f1 flexbox flexvert",style:a},t.children)}return b.a.createElement(b.a.Fragment,null,t.children)},onTouchMove:function(e){},onMouseMovePaneBlocker:function(e){u.a.isMobile&&lt.update(e)},onMouseUpPaneBlocker:function(e){u.a.isMobile&&lt.end(e)},onClickPaneBlocker:function(e){u.a.isMobile&&lt.onClickPane(e)},onMouseDownDrag:function(e){this._onMouseDownDrag(e,!1)},onMouseDownDragExpanded:function(e){this._onMouseDownDrag(e,!0)},_onMouseDownDrag:function(e,t){var a=this.state.rect;this.resizingInfo={startPos:e.clientX,startOffset:e.clientX-n.default.offset(this.refs.pane).left-a.width-(t?a.widthExpanded:0),startWidth:this.state.rect.width,isExpanded:t},document.addEventListener("mousemove",this.onMouseMoveResize),document.addEventListener("mouseup",this.onMouseUpResize),n.default.preventDefault(e)},onMouseMoveResize:function(e){var t=this.resizingInfo;if(t){var a=n.default.offset(this.refs.pane),i=e.clientX-a.left-t.startOffset;t.isExpanded&&(i-=this.state.rect.width),this.props.pane.setWidthManual(i,t.isExpanded)}},onMouseUpResize:function(){this.resizingInfo=void 0,s.default.PaneManager.updatePaneRects(),document.removeEventListener("mousemove",this.onMouseMoveResize),document.removeEventListener("mouseup",this.onMouseUpResize)},onDoubleClickDrag:function(e,t){this.props.pane.widthManual&&this.props.pane.setWidthManual(void 0,t)},onDoubleClickDragExpanded:function(e){this.onDoubleClickDrag(e,!0)},renderCell:function(e,t){var a=this.props.pane;return b.a.createElement(nt,{key:e,list:a.getInfiniteList(!1),pane:a,orientation:this.state.orientation,cell:t})},render:function(){var e,t=this.props,a=this.state,i=t.pane,r=n.default.classNames("pane c-border",i.paneClass,t.className,{overviewOpen:a.isOverviewVisible},{expanded:a.isExpanded},{none:!a.isActive},{hasTitles:!u.a.isMobile&&a.parents.length>0},{horizontal:a.orientation===o.a.Orientation.Horizontal},{vertical:a.orientation!==o.a.Orientation.Horizontal},{oneRow:1===a.titles.length&&!i.showRootOnRow2},{"flexbox flexvert":u.a.isMobile},{firstPane:a.rect.isFirst},{transition:!s.default.PaneManager.isResizingPane&&!a.isDragging},{dragging:a.isDragging}),l=n.default.classNames("paneScroller belowHeader c-background",{overviewOpen:a.isOverviewVisible},{customScroller:i.useCustomScroller},"f1"),d=n.default.classNames("paneRoot"),c=n.default.classNames("paneContent",{editable:i.isWriteable});i.topBoxHeight.get()>0&&(e=a.paneTopText?b.a.createElement("span",{className:"loadingText"},a.paneTopText):this.getChildByKey("topBox"));var h,f=b.a.createElement(Ee,{owner:i.getInfiniteList(!1),pane:i,overview:!1,renderCell:this.renderCell,itemsObs:t.itemsObs,hiddenInput:!u.a.isMobile,contentClass:c,orientation:a.orientation,ref:"contentElement"},i.topBoxHeight.get()>0&&b.a.createElement("div",{key:"topBox",className:"paneTopBox c-background"},e)),p=!u.a.isMobile&&i.isWriteable?b.a.createElement(Le,{pane:i}):null,g=a.rect,m={width:g.width},v={left:g.width},y={left:g.width+g.widthExpanded};if(u.a.isMobile)m.left=a.left,h={marginBottom:a.bottomBarHeight};else{var _="translate3d("+Math.round(a.left+(a.dragOffset||0))+"px,0,0)";u.a.isFirefox&&!n.default.isRunningScript()?(m.left=a.left,a.dragOffset&&(m[u.a.transform.react]="translate3d("+a.dragOffset+"px,0,0)")):m[u.a.transform.react]=_,v[u.a.transform.react]=_,y[u.a.transform.react]=_}var k={};return u.a.isMobile&&(k.offsetX=i.offsetX),b.a.createElement(b.a.Fragment,null,b.a.createElement("div",{key:"pane","data-moo-id":this.getUniqueID(),ref:"pane",className:r,style:m},b.a.createElement(ge,{observe:k,render:this.renderScrollerWrapper},b.a.createElement(Me,{pane:i,startDragging:this.startDragging},this.getChildByKey("headerButtons")),b.a.createElement(st.a,{className:l,style:h,getScrollSize:this.getScrollSize,getClientHeight:this.getClientHeight,getScrollTop:this.getScrollTop,noOwnScroll:!0,orientation:a.orientation,showScrollbars:a.showScrollbars,ref:"scroller"},b.a.createElement("div",{className:d,ref:"rootElement",onTouchMove:this.onTouchMove},f,p,!u.a.isMobile&&a.showFormattingToolbar&&b.a.createElement(ot,{pane:i}))),u.a.isMobile&&a.isOverviewVisible&&b.a.createElement(pe.a,{className:"paneClickBlocker",onMouseMove:this.onMouseMovePaneBlocker,onClick:this.onClickPaneBlocker,onMouseUp:this.onMouseUpPaneBlocker})),this.getChildByKey("overlay"),a.toast&&b.a.createElement("div",{className:"paneToasts"},b.a.createElement(rt,{toast:a.toast}))),!u.a.isMobile&&b.a.createElement("div",{className:"paneDragHandle cursor-ew-resize",onMouseDown:this.onMouseDownDrag,style:v,onDoubleClick:this.onDoubleClickDrag}),!u.a.isMobile&&a.isExpanded&&b.a.createElement("div",{className:"paneDragHandle cursor-ew-resize",onMouseDown:this.onMouseDownDragExpanded,style:y,onDoubleClick:this.onDoubleClickDragExpanded}))}}),dt=he.b.createClass({displayName:"ReactPaneList",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){var e=this.props.pane;return{rect:e.rect,hasCollapsed:e.hasCollapsedObs,_allowCollapsingObs:e.search.getFilterObs("showOnlyMatches"),allowCollapsing:!e.search.getFilterValue("showOnlyMatches")}},render:function(){var e=this.state,t=this.props.pane,a=e.hasCollapsed,i=(a?"Expand":"Collapse")+" all items in view",n=u.a.isMobile?44:o.a.PaneHeaderButtonWidth,r=(u.a.isMobile,o.a.PaneHeaderButtonHeight);return b.a.createElement(ut,{pane:t},b.a.createElement("div",{className:"f1",key:"headerButtons"},t.supportCollapsing&&!u.a.isMobile&&b.a.createElement(D.a,{icon:a?"icon-angle-down":"icon-angle-right",iconSize:16,width:n,height:r,onClick:t.toggleCollapseAll.bind(t),tooltip:i,tooltipHotkey:{name:"CollapseAll",group:"Pane"},enabled:e.allowCollapsing})))}}),ct=he.b.createClass({displayName:"ReactCalendarTimes",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){this.scrollTop=void 0},getState:function(){var e=this.props.pane;return{numAllDay:e.numAllDay,heightAllDay:e.getHeightAllDay()}},onMount:function(){this.props.trackPane&&setTimeout(function(){var e=this.props.pane.paneContent;e&&e.addEventListener("scroll",this.onPaneScroll)}.bind(this),0)},onUnmount:function(){var e=this.props.pane.paneContent;e&&e.removeEventListener("scroll",this.onPaneScroll)},onPaneScroll:function(e){var t=e.target.scrollTop;t!==this.scrollTop&&this.refs.scroller&&(this.scrollTop=this.refs.scroller.scrollTop=t)},render:function(){for(var e=0,t=this.props,a=this.state,i={height:t.height},n={height:a.heightAllDay+2},r={top:a.heightAllDay+30+2},o=[],s=0;s<24;s++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var l;12===s?l="Noon":(l=0===s?12:s%12,l+=" "+(s>=12?"pm":"am")),o.push(b.a.createElement("div",{key:s,className:"time"},l))}return b.a.createElement("div",{className:"calendarTimes belowHeader c-background",style:i},b.a.createElement("div",{className:"calendarTimesInner hideScrollbar c-border-heavy",style:r,ref:"scroller"},o),t.showAllDay&&b.a.createElement("div",{className:"calendarTimesAllDay c-border-heavy",style:n},"All day"))}});function ht(){return(ht=Object.assign||function(e){for(var t=0,a=1;a<arguments.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=arguments[a];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}var ft=he.b.createClass({displayName:"FancyCalendarDayButton",componentDisplay:o.a.ComponentDisplay.Desktop,render:function(){return b.a.createElement(D.a,ht({},this.props,{className:"fancyCalendarDayButton",iconSize:16,padding:0,tooltip:"Jump to Today",icon:"icon-calendar-o",center:!0}),this.props.day)}}),pt=o.a.TaskViewMode,gt=he.b.createClass({displayName:"ReactPaneTask",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("dateChanged");var e=s.default.pluginManager.getPlugin(o.a.PluginID.GCalendar);e.onSettingChanged(e.Settings.IsEnabled,this.onSettingChanged)},getState:function(){var e=this.props.pane,t=s.default.pluginManager.getPlugin(o.a.PluginID.GCalendar);return{item:e.item,rect:e.rect,hasCollapsed:e.hasCollapsedObs,_allowCollapsingObs:e.search.getFilterObs("showOnlyMatches"),allowCollapsing:!e.search.getFilterValue("showOnlyMatches"),viewState:e.viewState,viewMode:e.getViewMode(),isCalendarView:e.isViewCalendar(),hasPremiumFeatures:s.default.billingManager.hasPremiumFeaturesObservable,date:(new Date).getDate(),isGCalEnabled:t.isEnabled(),calendarCustomDays:s.default.settings.calendarCustomDays,dayWeekStart:s.default.settings.dayWeekStart}},onSettingChanged:function(){this._isMounted&&this.updateState()},onClickToday:function(){this.props.pane.scrollToToday(o.a.ScrollDuration.Default)},onClickJumpBack:function(){this.props.pane.scrollJump(-1,o.a.ScrollDuration.Default)},onClickJumpForward:function(){this.props.pane.scrollJump(1,o.a.ScrollDuration.Default)},onClickAddItem:function(e){this.props.pane.addItemWithPrefix(0,e)},onClickAddFile:function(e,t){var a=this.props,i=a.pane,n=a.paneObject;s.default.menus.openContextMenu({componentName:"ReactContextMenuDropZone",element:t.target,pane:i,itemParent:i.getItem(),insertIndex:0,image:e,paneObject:n})},onClickAddItemPopup:function(e){this.props.pane.openItemEditor({element:e.target,addOnSave:!0})},onClickViewMode:function(e){this.props.pane.setViewMode(e)},renderPaneBox:function(){var e=this.props.pane,t=e.isViewOutline()||e.isViewProjectNoBlocks();return b.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-faded"},b.a.createElement(D.a,{icon:"icon-project",iconSize:16,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Header),tooltip:"Add project"}),t&&b.a.createElement(D.a,{icon:"icon-edit",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,""),tooltip:"Add item"}),t&&b.a.createElement(D.a,{icon:"icon-check",iconSize:14,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Task),tooltip:"Add task"}),t&&b.a.createElement(D.a,{icon:"icon-bullet",iconSize:22,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Bullet),tooltip:"Add bullet"}),t&&b.a.createElement(D.a,{icon:"icon-numlist",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.NumList),tooltip:"Add numbered list"}),t&&b.a.createElement(D.a,{icon:"icon-drive-file",iconSize:14,width:44,onClick:this.onClickAddFile.bind(this,!1),tooltip:"Add file"}),t&&b.a.createElement(D.a,{icon:"icon-image",iconSize:14,width:44,onClick:this.onClickAddFile.bind(this,!0),tooltip:"Add image"}))},render:function(){var e,t,a,i=this.state,r=this.props.pane,s=this.state.viewMode,l=o.a.TaskViewModeText[s],d=i.rect.width>550,c=o.a.PaneHeaderButtonWidth,h=o.a.PaneHeaderButtonHeight,f=n.default.classNames(i.isCalendarView?"calendar"+o.a.TaskViewModeText[s]+"View c-background":"",{showingButtons:i.isCalendarView},{premiumBlocked:r.isViewPremiumBlocked()});if(!u.a.isMobile){var p=i.hasCollapsed,g=o.a.SearchHeight,m=(p?"Expand":"Collapse")+" all items in view",v=r.isViewAgenda()&&[pt.Agenda_Today,pt.Agenda_Week,pt.Agenda_All]||r.isViewCalendar()&&[pt.Calendar_Day,pt.Calendar_Custom,pt.Calendar_Week,pt.Calendar_Month],y=b.a.createElement(ft,{day:this.state.date,height:g,width:g,onClick:this.onClickToday});a=b.a.createElement("div",{key:"headerButtons"},r.isViewDates()&&b.a.createElement("div",{className:"calendarButtons"},r.isViewCalendar()&&b.a.createElement("div",{className:"borderButtons ib c-border-light"},b.a.createElement(D.a,{icon:"icon-caret-left",width:d?20:14,height:g,onClick:this.onClickJumpBack,enabled:i.isCalendarView,tooltip:"Previous "+l}),y,b.a.createElement(D.a,{icon:"icon-caret-right",width:d?20:14,height:g,onClick:this.onClickJumpForward,enabled:i.isCalendarView,tooltip:"Next "+l})),r.isViewAgenda()&&y,d&&b.a.createElement("div",{className:"viewModeButtons borderButtons ib c-border-light"},v.map(function(e){var t=o.a.TaskViewModeText[e];return e===pt.Calendar_Custom&&(t=t.replace("#",i.calendarCustomDays)),b.a.createElement(D.a,{height:g,selected:i.viewMode===e,onClick:this.onClickViewMode.bind(this,e),key:e},t)}.bind(this)))),r.supportCollapsing&&!r.isViewCalendar()&&b.a.createElement(D.a,{icon:p?"icon-angle-down":"icon-angle-right",iconSize:16,width:c,height:h,onClick:r.toggleCollapseAll.bind(r),tooltip:m,tooltipHotkey:{name:"CollapseAll",group:"Pane"},enabled:i.allowCollapsing})),r.isViewCalendar()?e=s===pt.Calendar_Month?b.a.createElement("div",{className:"calendarMonthDays belowHeader c-background c-border-heavy flexbox",key:"overlay"},0===i.dayWeekStart&&b.a.createElement("div",null,"SUN"),b.a.createElement("div",null,"MON"),b.a.createElement("div",null,"TUE"),b.a.createElement("div",null,"WED"),b.a.createElement("div",null,"THU"),b.a.createElement("div",null,"FRI"),b.a.createElement("div",null,"SAT"),1===i.dayWeekStart&&b.a.createElement("div",null,"SUN")):b.a.createElement(ct,{pane:r,key:"overlay",trackPane:!0,showAllDay:!0}):r.isViewAgenda()?t=b.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-faded"},b.a.createElement(D.a,{onClick:this.onClickAddItemPopup},"Add Item")):r.shouldShowAddBox()&&(t=this.renderPaneBox("top"))}return b.a.createElement(ut,{pane:r,itemsObs:this.itemsObs,className:f},e,t&&b.a.createElement("div",{key:"topBox"},t),a)}}),mt=he.b.createClass({displayName:"ReactPaneGmail",componentDisplay:o.a.ComponentDisplay.Everywhere,onMount:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){var e=this.props.pane;return e.isDestroyed()?{}:{rootItem:e.item,messages:s.default.EmailPreview.messages,isActivePane:s.default.EmailPreview.activePane===e,viewState:e.viewState,viewMode:e.getViewMode()}},onHoldViewButton:function(e){s.default.menus.openContextMenu({fn:this.renderContextMenuSort,element:e.target})},onClickViewButton:function(){var e=this.state.viewMode===o.a.GmailViewMode.Priority?o.a.GmailViewMode.Date:o.a.GmailViewMode.Priority;this.setViewMode(e),s.default.menus.closeContextMenu()},renderContextMenuSort:function(e){return b.a.createElement(we.a,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:e.element},b.a.createElement(ke.a,null,"Sort by"),b.a.createElement(Se.a,{icon:"icon-access_time",onClick:this.setViewMode.bind(this,o.a.GmailViewMode.Date)},o.a.GmailViewMode.Date),b.a.createElement(Se.a,{icon:"icon-exclamation",onClick:this.setViewMode.bind(this,o.a.GmailViewMode.Priority)},o.a.GmailViewMode.Priority))},setViewMode:function(e){this.props.pane.setViewMode(e)},renderViewButton:function(){var e=this.state.viewMode===o.a.GmailViewMode.Date?"icon-access_time":"icon-exclamation";return b.a.createElement(D.a,{key:"sort",className:"emailViewButton",tooltip:"Sort Order",icon:e,iconSize:14,width:o.a.PaneHeaderButtonWidth,height:o.a.PaneHeaderButtonHeight,onClick:this.onClickViewButton,onHold:this.onHoldViewButton})},render:function(){this.props.pane;return b.a.createElement(ut,{key:"pane",pane:this.props.pane},b.a.createElement("div",{key:"headerButtons"},this.renderViewButton()))}}),vt=he.b.createClass({displayName:"ReactDragDrop",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){var e=s.default.DragDrop;s.default.PaneManager;return{items:e.draggingItems,activePane:e.activePane,pane:e.startPane,position:e.position,transform:e.transform,isDragging:e.isInDrag,linePosition:e.linePosition,fromOverview:e.fromOverview,dropBucketItems:n.default.vmMain.dropBucket.getItems(),onlineText:n.default.vmMain.onlineText(),contextMenus:s.default.menus.contextMenuStack}},onBeforeChanged:function(e,t){if(e.items!==t.items){var a=0;this.paddings=[];for(var i=0;i<e.items.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.paddings[i]=e.pane.getPaddingForPaneObject(e.items[i])-8}}},onClickDropBucket:function(){this.state.dropBucketItems.length>0&&s.default.menus.toggleContextMenu({componentName:"ReactContextMenuDropBucket",position:"bottom",pane:n.default.focusedPane})},onClickCancelDragToOutline:function(){s.default.DragDrop.stopDraggingToOutline()},render:function(){var e,t,a,i,r=this.state,l=r.pane,d=r.items;if(l&&r.isDragging){if(d&&d.length>0&&r.position&&r.transform){for(var c=0,h=[],f=Math.min(d.length,10),p=0;p<f;++p){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var g=this.paddings[p];h.push(b.a.createElement(Ke.a,{key:"drag_"+p,pane:l,item:d[p].item,paneObject:d[p],renderLikePane:!0,noNotes:r.fromOverview,padding:g}))}var m=d.length-f;m>0&&h.push(b.a.createElement("div",{className:"dotdotdot",key:"dotdotdot"},"... plus "+m+" more ..."));var v=r.position,y={left:u.a.isMobile?0:v.left+8,top:v.top,width:l.widthOfDrag(d[0]),maxWidth:l.getWidth()},_=r.transform;y[u.a.transform.react]="translate3d("+_.left+"px, "+_.top+"px, 0)",e=b.a.createElement("ul",{id:"dragUL",style:y,className:"popup c-shadow-popup c-background"},h)}if(r.linePosition&&r.activePane){var k=r.linePosition,w={width:k.width,height:k.height},S=n.default.classNames({isLine:!k.height});w[u.a.transform.react]="translate("+k.left+"px, "+k.top+"px)",t=b.a.createElement("div",{id:"dragLine",style:w,className:S})}i=n.default.classNames("from_"+l.type,r.activePane.paneClass)}var I,C,P=u.a.isMobile&&r.isDragging&&!s.default.menus.isContextMenuOpen(),A=r.pane===n.default.focusedPane,M=r.dropBucketItems,T=r.onlineText?60:44,E={top:r.dropBucketTop,bottom:!r.dropBucketTop&&T+24},L=n.default.classNames("dragTarget mobileDropBucket",{showIcon:!P},{hovered:"dragToSave"===r.dragTargetHovered}),x=n.default.classNames("dragTarget mobileDragToOutline",{hovered:"dragToOutline"===r.dragTargetHovered});P?A&&(I=b.a.createElement(D.a,{id:"dragToSave",width:50,height:50,color:"white",iconSize:20,style:E,key:"bucket",className:L,onClick:this.onClickDropBucket},b.a.createElement("span",{className:"buttonText"},"Drag",b.a.createElement("br",null),"here",b.a.createElement("br",null),"to",b.a.createElement("br",null),"save")),l.type===o.a.PaneMode.Gmail&&(C=b.a.createElement("div",{id:"dragToOutline",className:x,style:E},"Drag",b.a.createElement("br",null),"to",b.a.createElement("br",null),"outline"))):M.length>0&&!s.default.menus.isContextMenuOpen()&&(I=b.a.createElement(D.a,{width:50,height:50,color:"white",iconSize:20,style:E,key:"bucket",className:L,onClick:this.onClickDropBucket,enabled:n.default.focusedPane&&n.default.focusedPane.type===o.a.PaneMode.Task},b.a.createElement("span",{className:"bucketIcon"},b.a.createElement("i",{className:"icon-content_paste"}),M.length>0&&b.a.createElement("div",null,M.length)))),a=b.a.createElement("div",{className:"dragTargets"},I,C);var O=r.draggingToOutline&&b.a.createElement("div",{className:"draggingToOutlineArea flexbox"},b.a.createElement("div",{className:"f1"},"Tap a destination for this email"),b.a.createElement(D.a,{color:"white",height:60,onClick:this.onClickCancelDragToOutline},"CANCEL"));return b.a.createElement("div",{id:"dragdrop",className:i},e,t,O,a)}}),yt=a(79);function _t(){return(_t=Object.assign||function(e){for(var t=0,a=1;a<arguments.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=arguments[a];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function bt(e,t){if(null==e)return{};var a,i,n=function(e,t){var a=0;if(null==e)return{};var i,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=o[n],t.indexOf(i)>=0||(r[i]=e[i])}return r}(e,t);if(Object.getOwnPropertySymbols){var r=0,o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}}return n}var kt=he.b.createClass({displayName:"FancyOverlayPopup",componentDisplay:o.a.ComponentDisplay.Desktop,render:function(){var e=this.props,t=e.className,a=e.minimized,i=e.minimize,r=e.close,o=e.title,s=e.children,l=bt(e,["className","minimized","minimize","close","title","children"]),u=n.default.classNames(t,"fancyOverlayPopup popup c-shadow-popup c-background",{minimized:a}),d=i&&n.default.classNames("popupMinimize",{minimized:a});return b.a.createElement("div",_t({},l,{className:u}),b.a.createElement("div",{className:"overlayTitleBar c-foreground c-border-heavy c-bg-popup-title flexbox"},b.a.createElement("div",{className:"displayTitle f1"},o),i&&b.a.createElement(D.a,{className:d,icon:"icon-minus",iconSize:14,width:36,height:36,onClick:i,tooltip:a?"Restore":"Minimize"}),b.a.createElement(D.a,{icon:"icon-close",width:36,height:36,onClick:r,tooltip:"Close"})),s)}}),wt=he.b.createClass({displayName:"ReactEmailComposeWindow",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize"),this.createObservables({minimized:!1})},getState:function(){var e=u.a.windowWidth(),t=u.a.windowHeight();return{width:Math.min(Math.max(Math.min(.4*e,800),500),e-20),height:Math.min(Math.max(Math.min(.4*t,800),500),t)}},minimize:function(){this.minimized.set(!this.minimized.get())},close:function(){this.refs.compose.close(!0,!1,!0)},onClose:function(){d.a.fireEvent("EmailCompose","onClosed",[]),s.default.menus.closeComposeEmail(this.props.threadAttach,this.props.message)},onMouseDown:function(){g.a.reset()},openCc:function(){this.cc.set(!0)},openBcc:function(){this.bcc.set(!0)},onMount:function(){var e=this.refs.compose;e.focusTo(),requestAnimationFrame(function(){e.focusTo()})},render:function(){var e=this.state,t={height:e.minimized?36:e.height,width:e.width};return b.a.createElement(kt,{title:"New Message",minimized:e.minimized,minimize:this.minimize,close:this.close,className:"composeEmail flexbox flexvert",ref:"element",style:t,onMouseDown:this.onMouseDown},b.a.createElement(yt.a,{className:"f1",threadAttach:this.props.threadAttach,message:this.props.message,showSubject:!0,onClose:this.onClose,ref:"compose",focus:"to",hidden:e.minimized}))}}),St=he.b.createClass({displayName:"ReactEmailComposes",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){return{emailComposes:s.default.menus.emailComposeStack}},render:function(){for(var e=0,t=this.state,a=[],i=0;i<t.emailComposes.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t.emailComposes[i];a.push(b.a.createElement(wt,{key:n.draftMsg.id,threadAttach:n.attach,message:n.draftMsg}))}return b.a.createElement("div",{className:"emailComposes flexbox"},a)}}),It=a(92),Dt=he.b.createClass({displayName:"ReactOverview",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({addingItem:void 0})},onMount:function(){var e=this.props.pane,t=e.getOverview(),a=t.scrollElement=this.refs.overviewScroller.getScrollElement(),i=t.contentElement=this.refElement("overviewContentElement");e.getInfiniteList(!0).setupScroller(a,i),n.default.setupClick(a,e.getOverview(),e.getOverview().onTap)},getState:function(){var e=this.props.pane,t=e.getOverview(),a={isVisible:t.isVisible,selectedView:"documents",zoomed:e.item};return u.a.isMobile?a.offsetX=e.offsetX:(a.cursor=t.cursor,a.isAtRoot=e.getItem()===e.getRootItem(),e.type===o.a.PaneMode.Gmail&&(a.overviewAccount=e._overviewAccount)),a},getPane:function(){return this.props.pane},renderCell:function(e,t){var a=this.props.pane;return b.a.createElement(nt,{key:e,list:a.getInfiniteList(!0),pane:a,cell:t,overview:!0})},sizeAtIndex:function(e){var t=this.props.pane;return t.headers.get()[e].sizeInPane(t,!0)},itemsObs:function(){return this.props.pane.headers},onClickAddTop:function(){this.addingItem.set("top")},onClickAddBottom:function(){this.addingItem.set("bottom"),this.refs.overviewScroller.scrollToBottom()},onClickAll:function(){var e=this.props.pane;e.zoomOut(e.getRootItem()),u.a.isMobile&&fe.default.setOverviewVisibility(e,!1)},onAddItem:function(e){var t=this.refs.inputAddItem.getValue();this.addingItem.set(void 0);var a=this.props.pane,i=a.getRootItem(),n="top"===e?0:i.numItems(),r=a.addProject(n,t,!0);setTimeout(function(){a.getItem()!==i&&a.zoomOut(i),a.scrollItemToTop(r,o.a.ScrollDuration.Default)},0),u.a.isMobile&&fe.default.setOverviewVisibility(a,!1)},onClickCancel:function(){this.addingItem.set(void 0)},onClickGmailAccount:function(e){var t=this.props.pane;t.setOverviewAccount(e),t.zoomIn(t.getDefaultDisplayItem(e))},renderAddProjectInput:function(e){var t=this.onAddItem.bind(this,e),a=this.onClickCancel.bind(this,e);return b.a.createElement("div",{className:"addProjectInput"},b.a.createElement(_e.a,{ref:"inputAddItem",focused:!0,height:32,placeholder:"Name project",onEscape:a,onEnter:t}),b.a.createElement("div",{className:"addProjectButtons"},b.a.createElement(D.a,{primary:!0,onClick:t},"Add Project"),b.a.createElement(D.a,{onClick:a},"Cancel")))},renderShowAllButton:function(e){return b.a.createElement(D.a,{className:"overviewHeaderButton",icon:"icon-visibility",height:30,iconSize:15,onClick:this.onClickAll,enabled:!this.state.isAtRoot},"Show all "+e)},renderHeader:function(){var e=this.state,t=this.props.pane;switch(t.type){case o.a.PaneMode.Task:var a=t.isViewOutline()||t.isViewProject();return b.a.createElement("div",{className:"overviewHeader"},this.renderShowAllButton("projects"),a&&"top"!==e.addingItem&&b.a.createElement(D.a,{className:"overviewHeaderButton",icon:"icon-project",iconSize:15,height:30,onClick:this.onClickAddTop},"Add project"),a&&"top"===e.addingItem&&this.renderAddProjectInput("top"),b.a.createElement("hr",null));case o.a.PaneMode.Archived:return b.a.createElement("div",{className:"overviewHeader"},this.renderShowAllButton("projects"),b.a.createElement("hr",null));case o.a.PaneMode.Drive:return b.a.createElement("div",{className:"overviewHeader"},b.a.createElement("div",{className:"overviewHeaderTitle"}),this.renderShowAllButton("folders"),b.a.createElement("hr",null));case o.a.PaneMode.Gmail:var i=s.default.pluginManager.getPluginGmail(),r=e.overviewAccount,l=i.getSyncAccounts(),u=n.default.classNames("overviewHeader",{"c-border":l.length>1});return b.a.createElement("div",{className:u},l.length>1&&l.map(function(e){return b.a.createElement(D.a,{className:"overviewHeaderButton",key:e,selected:e===r,height:30,onClick:this.onClickGmailAccount.bind(this,e)},e)}.bind(this)))}},renderFooter:function(){var e=this.state,t=this.props.pane;switch(t.type){case o.a.PaneMode.Task:return(t.isViewOutline()||t.isViewProject())&&t.numHeaders()>0?b.a.createElement("div",{className:"overviewFooter"},b.a.createElement("hr",null),"bottom"===e.addingItem&&this.renderAddProjectInput("bottom"),"bottom"!==e.addingItem&&b.a.createElement(D.a,{className:"overviewHeaderButton",icon:"icon-project",iconSize:15,height:30,onClick:this.onClickAddBottom},"Add project")):null}},render:function(){this.state;var e=this.props.pane,t=n.default.classNames("paneOverview",e.type+"Overview"),a=n.default.classNames(this.props.className,"paneOverviewScroller f1 scroller",{customScroller:e.useCustomScroller},{transition:!s.default.PaneManager.isResizingPane}),i=this.renderHeader(),r=this.renderFooter();return b.a.createElement(st.a,{className:a,ref:"overviewScroller",showScrollbars:!0,"data-moo-id":this.getUniqueID()},b.a.createElement("div",{className:t,ref:"overview"},i,b.a.createElement(Ee,{owner:e.getInfiniteList(!0),pane:e,overview:!0,renderCell:this.renderCell,itemsObs:this.itemsObs,contentClass:"overviewList noSelect mat-list",ref:"overviewContentElement"}),r))}}),Ct=a(56);function Pt(e){return(Pt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function At(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Mt(e,t){return!t||"object"!==Pt(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Mt(this,Tt(t).apply(this,arguments))}var a,i,r;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(t,he["a"]),a=t,(i=[{key:"init",value:function(){this.createObservables({isEditing:""===this.props.doc.text.get()})}},{key:"getState",value:function(){var e=this.props.doc;return{text:e.text,contentPreview:e.contentPreview,docTimeText:Ct.a.toHumanText(new Date(e.dateModified.get()),!0),docTime:e.dateModified}}},{key:"onBeforeChanged",value:function(e,t){e.text&&!t.text&&e.isEditing&&(e.isEditing=!1,this.isEditing.set(!1,!1))}},{key:"onEscape",value:function(){this.isEditing.set(!1)}},{key:"onFinishEdit",value:function(){l.a.renameDocument(this.props.doc,this.refs.inputAddDocument.getValue()),this.isEditing.set(!1)}},{key:"onClick",value:function(){this.props.onSelectDocument(this.props.doc)}},{key:"onClickOverview",value:function(){this.props.onSelectDocument(this.props.doc,!0)}},{key:"onRightClick",value:function(e){s.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}},{key:"onClickRename",value:function(){this.isEditing.set(!0)}},{key:"onClickDelete",value:function(){var e=this;l.a.getDocumentsArray().length>1?s.default.menus.confirm("Are you sure you want to delete this document?",function(t){if(t){var a=e.props,i=a.pane,n=a.doc;n.delete(),i.document.get()===n&&i.setDocument(l.a.getDefaultDocument())}}):s.default.menus.alert({text:"Unable to delete the only document",actionText:"OKAY"})}},{key:"renderContextMenu",value:function(e){return _.createElement(we.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:e.element},_.createElement(Se.a,{onClick:this.onClickRename},"Rename"),_.createElement(Se.a,{onClick:this.onClickDelete},"Delete"))}},{key:"render",value:function(){var e=this.props.isSelected,t=this.state,a=t.text,i=t.isEditing,r=t.contentPreview,o=t.docTimeText,s=n.default.classNames("paneSidebarDocument flexbox borderBottom borderLeft c-background c-border noSelect",{selected:e});return _.createElement(Ie.a,{className:s,onClick:this.onClick,onRightClick:this.onRightClick},e&&_.createElement("div",{className:"selectedIndicator c-border-blue"}),i?_.createElement(_e.a,{ref:"inputAddDocument",focused:!0,height:32,placeholder:"Name document",buttonText:"SAVE",onButtonClick:this.onFinishEdit,onEscape:this.onEscape}):_.createElement(_.Fragment,null,_.createElement("div",{className:"mw0 f1"},_.createElement("div",{className:"documentName f1 bold",onClick:this.onClick},a),_.createElement("div",{className:"documentExtra c-foreground-faded"},r),_.createElement("div",{className:"documentExtra documentTime c-foreground-faded"},o)),!u.a.isMobile&&_.createElement(D.a,{className:"buttonDocumentOverview",icon:"icon-format_list_bulleted",onClick:this.onClickOverview})))}}])&&At(a.prototype,i),r&&At(a,r),t}();function xt(e){return(xt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e,t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Rt(e,t){return!t||"object"!==xt(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ft(e){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Nt(e,t){return(Nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Rt(this,Ft(t).apply(this,arguments))}var a,i,n;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nt(e,t)}(t,he["a"]),a=t,(i=[{key:"init",value:function(){this.createObservables({view:"Overview",addingDoc:void 0})}},{key:"getState",value:function(){var e=this.props.pane;return{rect:e.rect,documents:l.a.documentsArray,paneDoc:e.document}}},{key:"getPane",value:function(){return this.props.pane}},{key:"onClickAdd",value:function(){var e=l.a.addEmptyDocument("",!0);u.a.isMobile||this.props.onSelectDocument(e,!1)}},{key:"renderDocument",value:function(e){return b.a.createElement(Lt,{key:e.id,doc:e,pane:this.props.pane,isSelected:e===this.state.paneDoc,onSelectDocument:this.props.onSelectDocument})}},{key:"render",value:function(){var e=this.state;return b.a.createElement("div",{className:"paneSidebarDocuments f1"},!u.a.isMobile&&b.a.createElement(D.a,{onClick:this.onClickAdd},"Add Document"),b.a.createElement("div",{className:"borderTop c-border"},e.documents.map(this.renderDocument)),u.a.isMobile&&b.a.createElement(D.a,{onClick:this.onClickAdd,height:50},"Add Document"))}}])&&Ot(a.prototype,i),n&&Ot(a,n),t}(),Ut=he.b.createClass({displayName:"ReactMobileOverview",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){this.createObservables({mode:"overview"})},getState:function(){var e=this.props.pane,t={documentName:"DOCUMENT NAME CHANGE THIS",mounted:this._isMounted};return u.a.isMobile&&(t.rect=e.rect,t.left=e.rect.get().left,t.overviewWidth=fe.default.overviewWidth()),t},onTapSettings:function(){s.default.menus.openModal(o.a.Modals.MobileSettings)},onClickDocuments:function(){this.mode.set("documents")},onClickOverview:function(){this.mode.set("overview")},onSelectDocument:function(e,t){var a=this.props.pane;a.setDocument(e),fe.default.setOverviewVisibility(a,!1)},render:function(){var e=this.state,t=this.props.pane,a=o.a.MobileBottomHeight,i={left:e.left,width:Math.floor(e.overviewWidth)},n={height:a,lineHeight:a+"px"};return b.a.createElement("div",{className:"mobileOverview flexbox flexvert",style:i},b.a.createElement("div",{className:"mobileOverviewSearchBar flexbox"},b.a.createElement(be,{pane:t}),b.a.createElement(It.default,{pane:t})),b.a.createElement("div",{className:"overviewSelectButtons flexbox"},b.a.createElement(D.a,{selected:"documents"===e.mode,className:"f1",onClick:this.onClickDocuments},"DOCUMENTS"),b.a.createElement(D.a,{selected:"overview"===e.mode,className:"f1",onClick:this.onClickOverview},"OVERVIEW")),"documents"===e.mode&&b.a.createElement(Bt,{pane:t,onSelectDocument:this.onSelectDocument}),"overview"===e.mode&&b.a.createElement(Dt,{pane:t,className:"f1"}),b.a.createElement("div",{className:"mobileOverviewBottom flexbox",style:n},b.a.createElement(D.a,{icon:"icon-settings",iconSize:24,height:a,onClick:this.onTapSettings},"Settings")))}}),Vt=a(85),jt=he.b.createClass({displayName:"ReactMessagePreview",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this._initializedFrame=!1,this.createObservables({hovered:!1})},onMount:function(){this.props.isLastMessage&&this.props.index>0&&(this.needsScrollIntoView=!0),this.checkIsHovered(),this._initializeFrame()},_initializeFrame:function(){if(!this._initializedFrame&&this.refs.frame){this._initializedFrame=!0;var e=this.refs.frame.contentWindow.document;u.a.supportBlobURLIFrame||(e.open(),e.write(this.props.message.blob),e.close())}},getState:function(){var e=this.props.message;return{responseMode:e.responseMode,height:e.height,width:e.width}},onAfterChanged:function(e,t){this._initializeFrame(),e.height!==t.height&&e.height>0&&(this.checkIsHovered(),this.needsScrollIntoView&&(this.needsScrollIntoView=!1,this.scrollIntoView()))},checkIsHovered:function(){if(!u.a.isMobile){var e=g.a.getMousePos(),t=document.elementFromPoint(e.x,e.y);if(t)n.default.findParent(t,"emailMessageWrapper")===this.refs.message&&this.hovered.set(!0)}},scrollIntoView:function(){var e=this.refs.message,t=n.default.findParent(e,u.a.isMobile?"fancyScroller":"fancyScrollContent"),a=0;a=e.clientHeight>t.clientHeight?e.offsetTop:t.scrollHeight-t.clientHeight,n.default.scrollTo(0,a,o.a.ScrollDuration.Snap,t)},onClickHeader:function(){this.props.toggleExpanded()},onMouseEnterMessage:function(){this.hovered.set(!0)},onMouseLeaveMessage:function(){this.hovered.set(!1)},onClickReply:function(e){s.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.Reply),e.stopPropagation()},onClickReplyAll:function(e){s.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.ReplyAll),e.stopPropagation()},onClickForward:function(e){s.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.Forward),e.stopPropagation()},onClickReport:function(){s.default.menus.openModal(o.a.Modals.ReportProblem,{accountID:this.props.threadAttach.getField("accountID"),threadID:this.props.threadAttach.id,msgID:this.props.message.id})},_generateParticipantText:function(e){return e.text?e.text:e.email},isExpanded:function(){return this.props.expanded||this.props.isLastMessage||this.state.responseMode!==o.a.EmailResponseMode.None},openEmailDetails:function(e){var t=this.refs.messageHeaderText;s.default.menus.openContextMenu({componentName:"ReactContextMenuEmailDetails",element:t,message:this.props.message,accountID:this.props.threadAttach.getField("accountID")}),e.stopPropagation()},render:function(){var e,t=this.props,a=this.state,i=t.message,r=this.isExpanded(),l={height:a.height},d=s.default.International.formatDate(i.date,o.a.DFormat.MonthDay),c=s.default.International.formatDate(i.date,o.a.DFormat.ShortTime),h=!u.a.isMobile&&(t.isLastMessage||a.responseMode!==o.a.EmailResponseMode.None),f=!u.a.isMobile||r,p=u.a.windowWidth()>1080&&!u.a.isMobile&&!n.default.isDemoMode(),g={},m={},v={};if(u.a.isMobile||r||(g.opacity=a.hovered?"1":"0"),p&&(m.opacity=a.hovered?"1":"0"),u.a.ios){var y=Math.max(o.a.MinEmailScale,(u.a.windowWidth()-32)/a.width);y<1&&(l[u.a.transform.react]="scale("+y+")",v.height=a.height*y,v.overflow="hidden")}var _,k,w={cursor:r?"pointer":null};if(_=b.a.createElement("span",{className:"from",onClick:r&&!u.a.isMobile?this.openEmailDetails:void 0,style:w},this._generateParticipantText(i.from)),r){var S=(i.to?i.to:[]).concat(i.cc?i.cc:[]).map(this._generateParticipantText).join(", ");k=b.a.createElement("span",{className:"to c-foreground-faded",onClick:u.a.isMobile?void 0:this.openEmailDetails,style:{cursor:"pointer"}},u.a.isMobile&&"To ",!u.a.isMobile&&b.a.createElement("i",{className:"icon-long-arrow-right"}),b.a.createElement("span",null,S))}else k=b.a.createElement("span",{className:"snippet",dangerouslySetInnerHTML:{__html:i.snippet}});var I,C=b.a.createElement("span",{className:"emailDate c-foreground-faded"},b.a.createElement("div",{className:"emailDateDate"},d),b.a.createElement("div",{className:"emailDateTime"},c)),P=u.a.isMobile?22:16,A=u.a.isMobile?50:40;e=b.a.createElement(pe.a,{className:"messageHeader flexbox",onClick:this.onClickHeader},b.a.createElement("span",{className:"messageHeaderText f1",ref:"messageHeaderText"},_,k,u.a.isMobile&&r&&C),f&&b.a.createElement("span",{className:"headerButtons",style:g},p&&b.a.createElement(D.a,{height:40,className:"reportEmail",style:m,onClick:this.onClickReport},"Report Problem"),b.a.createElement(D.a,{iconSize:P,width:A,height:A,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply}),b.a.createElement(D.a,{iconSize:P,width:A,height:A,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll}),b.a.createElement(D.a,{iconSize:P,width:A,height:A,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward})),!u.a.isMobile&&C),I=u.a.supportBlobURLIFrame?b.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:"frame",sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",src:i.blobURL,style:l,scrolling:"no"}):b.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:"frame",sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",style:l,scrolling:u.a.ios?"no":void 0});var M=n.default.classNames("emailMessage emailBox c-border",{collapsed:!r},{prevCollapsed:!t.prevExpanded},{nextCollapsed:!t.nextExpanded}),T=n.default.classNames("emailMessageWrapper",{replying:a.responseMode!==o.a.EmailResponseMode.None});return b.a.createElement("div",{className:T,onMouseEnter:this.onMouseEnterMessage,onMouseLeave:this.onMouseLeaveMessage,ref:"message"},b.a.createElement("div",{className:M},e,r&&b.a.createElement("div",{className:"messageContent",style:v},I,b.a.createElement(Vt.a,{threadAttach:t.threadAttach,message:t.message,editable:!1}))),h&&b.a.createElement("div",{className:"replyPlaceholder flexbox flex-center",ref:"placeholder"},b.a.createElement("div",{className:"replyPlaceholderInner c-background c-shadow-light"},b.a.createElement(D.a,{iconSize:P,width:A,height:A,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply,selected:a.responseMode===o.a.EmailResponseMode.Reply,padding:24}),b.a.createElement(D.a,{iconSize:P,width:A,height:A,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll,selected:a.responseMode===o.a.EmailResponseMode.ReplyAll,padding:24}),b.a.createElement(D.a,{iconSize:P,width:A,height:A,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward,selected:a.responseMode===o.a.EmailResponseMode.Forward,padding:24}))))}}),Ht=he.b.createClass({displayName:"ReactEmailReplyBox",componentDisplay:o.a.ComponentDisplay.Everywhere,componentDidUpdate:function(){this._updateFocus()},onMount:function(){this.refs.message&&(this.scrollIntoView(),this._updateFocus())},getState:function(){var e=this.props.inReplyToMessage;return{responseMode:e.responseMode,replytoMessageHeight:e.height}},onAfterChanged:function(e,t){e.replytoMessageHeight!==t.replytoMessageHeight&&this.scrollIntoView()},scrollIntoView:function(){var e=this.refs.message;if(e){var t=n.default.findParent(e,u.a.isMobile?"fancyScroller":"fancyScrollContent"),a=e.offsetTop+e.offsetHeight-t.clientHeight+16;n.default.scrollTo(0,a,o.a.ScrollDuration.Default,t)}},_updateFocus:function(){var e=this.state.responseMode;switch(e){case o.a.EmailResponseMode.None:break;case o.a.EmailResponseMode.Reply:case o.a.EmailResponseMode.ReplyAll:case o.a.EmailResponseMode.Other:this.focusBody();break;case o.a.EmailResponseMode.Forward:this.focusTo();break;default:n.default.Assert(!1,"Unknown response mode for reply box",e)}},focusTo:function(){this.refs.compose.focusTo()},focusBody:function(){this.refs.compose.focusBody()},onClose:function(){s.default.EmailPreview.setMessageResponseMode(this.props.inReplyToMessage.id,o.a.EmailResponseMode.None)},render:function(){return this.state.responseMode!==o.a.EmailResponseMode.None?b.a.createElement("div",{className:"emailReplyBox emailBox c-shadow-popup",ref:"message"},b.a.createElement(yt.a,{threadAttach:this.props.threadAttach,message:this.props.message,ref:"compose",onClose:this.onClose,responseMode:this.state.responseMode,closeOnEscape:!0})):null}}),zt=function(e){var t={},a=e.size||20,i=e.size||20,r={fontSize:a,height:i,width:i,lineHeight:i+"px"};(e.top||e.left)&&(t.position="absolute",t.left=e.left||"50%",t.top=e.top||"50%",r.marginLeft=-a/2,r.marginTop=-a/2+20);var o=n.default.classNames("fancyLoader",{center:e.center},{inline:e.inline});return b.a.createElement("div",{className:o,style:t},b.a.createElement("div",{className:"icon-spinner",style:r}),e.children&&b.a.createElement("div",{className:"fancyLoaderText"},e.children))};if(u.a.isMobile)var qt=a(30).default;var Wt,Gt,Kt=he.b.createClass({displayName:"ReactEmailPreview",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize"),this.createObservables({expandedMessages:[]}),n.default.isDemoMode()&&(n.default.reactEmailPreview=this)},onBeforeChanged:function(e,t){if(e.thread!==t.thread){var a=e.messages,i=[];if(a.length>0)for(var n=0,r=this.getLastMessage(e),o=0;o<a.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=a[o];(s===r||this.isMessageUnread(s))&&i.push(s.id)}this.expandedMessages.set(i,!1),e.expandedMessages=i}},getState:function(){return{rect:this.props.pane.rect,pane:s.default.EmailPreview.openOnPane,isLoading:s.default.EmailPreview.isLoading,thread:s.default.EmailPreview.threadAttach,threadItem:s.default.EmailPreview.threadItem,messages:s.default.EmailPreview.messages,errorMessage:s.default.EmailPreview.errorMessage,messagesLoaded:s.default.EmailPreview.messagesLoaded,bottomBarHeight:u.a.isMobile&&qt.bottomBarHeight}},getLastMessage:function(e){var t=(e=e||this.state).messages,a=e.thread,i=t.length-1;return this.isMessageDraft(t[i])&&!a.getPlugin().getAttachField(a,"pendingSend")&&i--,t[i]},onEscapeKey:function(){s.default.EmailPreview.close()},isMessageDraft:function(e){return e.labelIds.indexOf("DRAFT")>=0},isMessageUnread:function(e){return e.labelIds.indexOf("UNREAD")>=0},onClickClose:function(){s.default.EmailPreview.close()},onClickArchive:function(){this.state.pane.archiveItem(!0,this.state.threadItem)},onClickLabel:function(e){this.state.pane.autocompleteLabel({elementDisplay:e.target,item:this.state.threadItem})},onClickMove:function(e){this.state.pane.autocompleteMove({elementDisplay:e.target,item:this.state.threadItem})},onClickSchedule:function(e){this.state.pane.autocompleteSchedule({elementDisplay:e.target,item:this.state.threadItem})},onClickSnooze:function(e){var t=this.state.thread.getField("accountID");this.state.pane.autocompleteSnooze({elementDisplay:e.target,item:this.state.threadItem},t)},onClickUnread:function(){this.state.pane.markItemRead(!1,this.state.threadItem)},onClickDelete:function(){var e,t=this.state,a=t.pane,i=n.default.vmMain.getDefaultEmailPlugin();if(a.type===o.a.PaneMode.Gmail)this.state.pane.deleteSelected(i.isGmailItem,!0);else if(g.a.getStartItem()===t.threadItem&&(e=a.indexOfPrevVMLI(g.a.getStartIndex(),!0,!0)),t.threadItem.deleteSelf(o.a.ChangeType.Local),s.default.EmailPreview.reset(),e){var r=a.itemAtIndex(e);if(r){var l=r.getParsedText().length;g.a.selectIndex(e,l)}}},onClickPrint:function(){var e=n.default.vmMain.getDefaultEmailPlugin().createPrintURLForThread(this.state.thread);n.default.printPage(e)},onClickViewInGmail:function(){var e=n.default.vmMain.getDefaultEmailPlugin().createURLForThread(this.state.thread);n.default.openUrl(e)},onClickReply:function(e){var t=this.getLastMessage();s.default.EmailPreview.setMessageResponseMode(t.id,o.a.EmailResponseMode.Reply)},onClickReplyAll:function(e){var t=this.getLastMessage();s.default.EmailPreview.setMessageResponseMode(t.id,o.a.EmailResponseMode.ReplyAll)},onClickForward:function(e){var t=this.getLastMessage();s.default.EmailPreview.setMessageResponseMode(t.id,o.a.EmailResponseMode.Forward)},toggleExpanded:function(e){var t=this.state.messages,a=t[e];this.expandedMessages.indexOf(a.id)>=0?!(t.length>1&&e<t.length-1)||t[e+1]&&this.isMessageDraft(t[e+1])||this.expandedMessages.remove(a.id):this.expandedMessages.push(a.id)},onClickDown:function(){this.props.pane.keyMoveDown()},onClickUp:function(){this.props.pane.keyMoveUp()},onClickMobileReply:function(){s.default.menus.openContextMenu({fn:this.renderContextMenuReply})},renderContextMenuReply:function(e){return b.a.createElement(we.a,{key:"contextMenuGmailReply",id:"contextMenuGmailReply",className:"contextMenuMobile",element:e.element,position:"bottom"},b.a.createElement(Se.a,{icon:"icon-reply",onClick:this.onClickReply},"Reply"),b.a.createElement(Se.a,{icon:"icon-reply-all",onClick:this.onClickReplyAll},"Reply All"),b.a.createElement(Se.a,{icon:"icon-forward",onClick:this.onClickForward},"Forward"))},render:function(){var e,t=this.state,a=this.props.pane.type===o.a.PaneMode.Gmail,i=t.thread,r=t.messages||[];if(r.length>0){for(var l=0,d=r[0],c=(i.getPlugin().getDisplayParticipants(i),d.subject||"(no subject)"),h=[],f=this.expandedMessages.get(),p=this.getLastMessage(),g=0;g<r.length;++g){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var m,v=r[g];if(this.isMessageDraft(v)){n.default.Assert(g>0,"Should never have a draft as the first message in the list");var y=r[g-1];m=u.a.isMobile?null:b.a.createElement(Ht,{key:y.id+"_draft",threadAttach:i,message:v,inReplyToMessage:y})}else{var _=f.indexOf(v.id)>=0,k=r[g-1],w=r[g+1],S=0===g||f.indexOf(k.id)>=0||this.isMessageDraft(k),I=g>=r.length-2||f.indexOf(w.id)>=0||this.isMessageDraft(w);m=b.a.createElement(jt,{key:v.id,index:g,threadAttach:i,message:v,toggleExpanded:this.toggleExpanded.bind(this,g),expanded:_,isLastMessage:v===p,prevExpanded:S,nextExpanded:I})}h.push(m)}e=b.a.createElement("div",{className:"emailMessages c-background c-border c-foreground",style:{opacity:t.messagesLoaded?1:0}},h)}else e=t.isLoading?b.a.createElement(zt,{center:!0},"Loading messages..."):t.errorMessage?b.a.createElement("div",{className:"noMessages center"},t.errorMessage):b.a.createElement("div",{className:"noMessages center"},"No conversation selected");var C=n.default.classNames("emailPreview c-background c-border",{noClick:s.default.PaneManager.isResizingPane},{transition:!s.default.PaneManager.isResizingPane}),P={};u.a.isMobile?P.left=t.rect.left:(P.width=t.rect.widthExpanded,P[u.a.transform.react]="translate("+(t.rect.left+t.rect.width)+"px,0)");var A=u.a.isMobile?"#444":void 0,M=n.default.classNames("emailPreviewTop c-foreground c-background c-border-light",{hasBorder:r.length>0});return u.a.isMobile?b.a.createElement("div",{className:C,style:P},b.a.createElement("div",{className:"emailPreviewTop c-border c-foreground"},b.a.createElement(D.a,{className:"closeButton",icon:"icon-angle-left",iconSize:24,width:n.default.topBarHeight,height:n.default.topBarHeight,color:A,onClick:this.onClickClose,tooltip:"Close"}),a&&b.a.createElement(D.a,{icon:"icon-angle-up",iconSize:24,width:n.default.topBarHeight,height:n.default.topBarHeight,onClick:this.onClickUp}),a&&b.a.createElement(D.a,{icon:"icon-angle-down",iconSize:24,width:n.default.topBarHeight,height:n.default.topBarHeight,onClick:this.onClickDown})),b.a.createElement(st.a,{className:"emailMessagesScroller"},b.a.createElement("div",{className:"emailHeaderMobile"},b.a.createElement("div",{className:"emailSubject bold"},c)),e),b.a.createElement("div",{className:"emailPreviewBottom flexbox",style:{height:o.a.MobileBottomHeight}},b.a.createElement(D.a,{icon:"icon-tag",iconSize:19,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickLabel}),b.a.createElement(D.a,{icon:"icon-align-left",iconSize:19,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickMove}),b.a.createElement(D.a,{icon:"icon-access_time",iconSize:21,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickSnooze}),b.a.createElement(D.a,{icon:"icon-check",iconSize:24,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickArchive}),b.a.createElement(D.a,{icon:"icon-delete",iconSize:24,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickDelete})),b.a.createElement(D.a,{className:"mobileAddButton emailReply",icon:"icon-reply",iconSize:24,width:50,height:50,style:{bottom:t.bottomBarHeight+24},onClick:this.onClickMobileReply})):b.a.createElement("div",{className:C,style:P},b.a.createElement("div",{className:M},r.length>0&&b.a.createElement(b.a.Fragment,null,b.a.createElement("div",{className:"emailHeaderRow"},b.a.createElement("div",{className:"emailButtons"},b.a.createElement(D.a,{icon:"icon-check",iconSize:17,width:36,height:36,tooltip:"Archive (E)",onClick:this.onClickArchive}),b.a.createElement(D.a,{icon:"icon-access_time",iconSize:17,width:36,height:36,tooltip:"Snooze (D)",onClick:this.onClickSnooze}),b.a.createElement(D.a,{icon:"icon-unread icon-unread-header",iconSize:15,width:36,height:36,tooltip:"Mark Unread (U)",onClick:this.onClickUnread}),b.a.createElement(D.a,{icon:"icon-tag",iconSize:15,width:36,height:36,tooltip:"Label (L)",onClick:this.onClickLabel}),b.a.createElement(D.a,{icon:"icon-align-left",iconSize:15,width:36,height:36,tooltip:"Add to Outline (M)",onClick:this.onClickMove}),b.a.createElement(D.a,{icon:"icon-calendar",iconSize:15,width:36,height:36,tooltip:"Add to Calendar (C)",onClick:this.onClickSchedule}),b.a.createElement(D.a,{icon:"icon-delete",iconSize:18,width:36,height:36,tooltip:"Delete (Backspace)",onClick:this.onClickDelete}),!u.a.app&&b.a.createElement(D.a,{icon:"icon-print",iconSize:18,width:36,height:36,tooltip:"Print (P)",onClick:this.onClickPrint}),b.a.createElement(D.a,{icon:"icon-gmail",iconSize:15,width:36,height:36,tooltip:"Open in Gmail (G)",onClick:this.onClickViewInGmail}))),b.a.createElement("div",{className:"emailHeaderRow emailSubject"},c)),b.a.createElement(D.a,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,color:A,onClick:this.onClickClose,tooltip:"Close"})),b.a.createElement(st.a,{className:"emailMessagesScroller"},e))}}),Yt=he.b.createClass({displayName:"ReactToasts",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){return{toasts:s.default.toasts.queue}},render:function(){for(var e=0,t=this.state,a=[],i=0;i<t.toasts.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.toasts[i];n.default.classNames("toast noSelect",{hasAction:!!r.actionText},{big:r.isBig});a.push(b.a.createElement(rt,{key:r.id,toast:r}))}return b.a.createElement(ce.CSSTransitionGroup,{id:"toasts",transitionName:"reactFade",transitionEnterTimeout:800,transitionLeaveTimeout:100},a)}}),Xt=he.b.createClass({displayName:"ReactMobileKeyboardToolbar",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){this.createObservables({isPriorityVisible:!1})},getState:function(){var e=y;return{panes:s.default.PaneManager.displayPanes,position:e.bottomPosition,mode:e.mode,pane:n.default.focusedPane}},onMount:function(){this.refs.toolbarButtons&&(this.refs.toolbarButtons.scrollLeft=y.getScroll())},onUnmount:function(){this.refs.toolbarButtons&&y.setScroll(this.refs.toolbarButtons.scrollLeft)},openAutocomplete:function(e){g.a.isValid()&&B.a.startMobileAutocomplete({owner:g.a.getStartItem(),pane:g.a.getPane(),index:g.a.getStartIndex(),start:g.a.getStartOffset(),element:g.a.getStartElement(),mode:e})},insertCharacter:function(e,t){s.default.menus.isContextMenuOpen()||g.a.isValid()&&g.a.insertTextAtCaret(e,t)},onClickOutdent:function(){s.default.menus.isContextMenuOpen()||g.a.fireKeyEvent(void 0,{normCode:o.a.KeyCode.Tab,shiftKey:!0})},onClickIndent:function(){s.default.menus.isContextMenuOpen()||g.a.fireKeyEvent(void 0,{normCode:o.a.KeyCode.Tab,shiftKey:!1})},onClickOpenPriority:function(){this.state.mode===o.a.KeyboardToolbarMode.Search?n.default.getActiveSearch().addToValue("!"):this.isPriorityVisible.set(!this.isPriorityVisible.get())},onClickNote:function(){if(g.a.isValid()){var e=g.a.getStartItem();u.a.ios&&s.default.menus.isContextMenuOpen()&&n.default.focusedPane.closeNoteContextMenu(),e&&(f.e.beginAction(),(e.hasNote()||e.isNote())&&s.default.menus.isContextMenuOpen()&&s.default.menus.closeContextMenu(),g.a.editNote(e),f.e.endAction())}},onClickDate:function(){this.state.mode===o.a.KeyboardToolbarMode.Search||(this.openAutocomplete("date"),f.e.miscAction({type:f.c.Mobile}))},onClickContact:function(){this.state.mode===o.a.KeyboardToolbarMode.Search?n.default.getActiveSearch().addToValue(o.a.ContactPrefix):this.openAutocomplete("contact")},onClickTag:function(){this.state.mode===o.a.KeyboardToolbarMode.Search?n.default.getActiveSearch().addToValue(o.a.TagPrefix):this.openAutocomplete("tag")},onClickPrefix:function(e){if(!s.default.menus.isContextMenuOpen()&&g.a.isValid()){var t=g.a.getStartItem();e=t.prefix===e?null:e,t.setPrefix(e)}},onClickClose:function(){g.a.closeKeyboard(),y.hide()},onClickMove:function(){this.state.pane.autocompleteMove({position:"autocomplete"})},onClickClosePriority:function(){this.isPriorityVisible.set(!1)},onClickP0:function(){this.state.pane.applyPriorityToSelection(o.a.VMLIFlag.P0,!0)},onClickP1:function(){this.state.pane.applyPriorityToSelection(o.a.VMLIFlag.P1,!0)},onClickP2:function(){this.state.pane.applyPriorityToSelection(o.a.VMLIFlag.P2,!0)},onClickStar:function(){n.default.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",value2:o.a.ChangeType.Local})},render:function(){var e=this.state,t=e.mode,a=o.a.KeyboardToolbarMode,i=this.state.pane,r=o.a.KeyboardToolbarHeight,l={bottom:e.position},d=u.a.windowWidth()-r,c=Math.floor(d/r),h=d-c*r,f=c<12?r-Math.round((r/2-h)/c):r,p=t!==a.Modal?b.a.createElement("div",{id:"mobileToolbarButtons",className:"flexbox"},b.a.createElement("div",{className:"f1"}),b.a.createElement("div",{className:"toolbarButtonsLeft",ref:"toolbarButtons"},t===a.Item&&i.type===o.a.PaneMode.Task&&i.isViewOutline()&&b.a.createElement(D.a,{icon:"icon-format_indent_decrease",width:f,height:r,iconSize:18,onClick:this.onClickOutdent}),t===a.Item&&i.type===o.a.PaneMode.Task&&i.isViewOutline()&&b.a.createElement(D.a,{icon:"icon-format_indent_increase",width:f,height:r,iconSize:18,onClick:this.onClickIndent}),t!==a.Search&&b.a.createElement(D.a,{id:"keyboardButtonHeader",icon:"icon-project",width:f,height:r,iconSize:20,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Header)}),t!==a.Search&&b.a.createElement(D.a,{icon:"prefixTask",width:f,height:r,iconSize:24,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Task)}),t!==a.Search&&b.a.createElement(D.a,{icon:"icon-bullet",width:f,height:r,iconSize:30,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Bullet)}),t!==a.Search&&b.a.createElement(D.a,{icon:"icon-numlist",width:f,height:r,iconSize:16,onClick:this.onClickPrefix.bind(this,o.a.Prefix.NumList)}),t!==a.Search&&b.a.createElement(D.a,{icon:"icon-align-left",color:n.default.colorBlue,width:f,height:r,iconSize:18,onClick:this.onClickMove}),t!==a.Search&&b.a.createElement(D.a,{icon:"icon-sticky-note-o",width:f,height:r,iconSize:18,onClick:this.onClickNote}),b.a.createElement(D.a,{icon:"icon-calendar",color:s.default.DisplaySettings.dateColor(),width:f,height:r,iconSize:20,onClick:this.onClickDate}),b.a.createElement(D.a,{icon:"icon-user",color:s.default.DisplaySettings.contactColor(),width:f,height:r,iconSize:24,onClick:this.onClickContact}),b.a.createElement(D.a,{className:"tagIcon",color:s.default.DisplaySettings.tagColor(),width:f,height:r,fontSize:22,onClick:this.onClickTag},"#"),t!==a.Search&&b.a.createElement(D.a,{className:"exclamationIcon",width:f,height:r,fontSize:22,onClick:this.onClickOpenPriority},"!")),b.a.createElement("div",{className:"toolbarButtonsRight"},b.a.createElement("div",{className:"keyboardButtonSkew"}),u.a.isMobile&&(u.a.iphone||u.a.android)&&b.a.createElement(D.a,{id:"closeKeyboardButton",icon:"icon-angle-down",width:r,height:r,iconSize:24,onClick:this.onClickClose}))):b.a.createElement("div",{id:"mobileToolbarButtons",className:"flexbox"},b.a.createElement("div",{className:"f1"}),b.a.createElement(D.a,{icon:"icon-angle-down",width:r,height:r,iconSize:26,onClick:this.onClickClose}));return!(t===a.Modal&&u.a.ipad)&&b.a.createElement("div",{id:"mobileKeyboardToolbar",style:l},e.isPriorityVisible&&b.a.createElement("div",{id:"priorityMenu"},b.a.createElement(D.a,{className:"priorityButton",width:r,height:r,onClick:this.onClickP2},b.a.createElement("div",{className:"p2Button"})),b.a.createElement(D.a,{className:"priorityButton",width:r,height:r,onClick:this.onClickP1},b.a.createElement("div",{className:"p1Button"})),b.a.createElement(D.a,{className:"priorityButton",width:r,height:r,onClick:this.onClickP0},b.a.createElement("div",{className:"p0Button"})),b.a.createElement(D.a,{icon:"icon-star",width:r,height:r,iconSize:22,onClick:this.onClickStar}),b.a.createElement(D.a,{icon:"icon-angle-down",width:r,height:r,iconSize:24,onClick:this.onClickClosePriority})),p)}}),Qt=he.b.createClass({displayName:"ReactMobileMultiselect",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){this.createObservables({inc:0})},getState:function(){var e=fe.default;return{offset:e.multiselectOffset,isAnimating:e.multiselectAnimate,isOpen:e.isInMultiselect(),numSelected:ne.a.numSelected}},applyFn:function(e,t,a){var i=this.props.pane;"gmailDelete"===t?i.deleteSelected(i.plugin.isGmailItem,!0):"gmailUndelete"===t?i.deleteSelected(i.plugin.isGmailItem,!1):"gmailArchive"===t?i.archiveSelected(!0):"gmailUnarchive"===t?i.archiveSelected(!1):"markRead"===t?i.markReadSelected(!0):"markUnread"===t?i.markReadSelected(!1):"gmailStar"===t?i.toggleStarSelected():"move"===t?i.autocompleteMove({position:"autocomplete"},ne.a.reset):"snooze"===t?i.autocompleteSnooze({position:"autocomplete"}):"label"===t?i.autocompleteLabel({position:"autocomplete"}):(s.default.PaneUpdateBatcher.beginUpdateItems(),f.e.beginAction(),ne.a.applyFnToSelected(function(e){e.isNote()||(void 0!==a?e[t](a,o.a.ChangeType.Local):e[t](o.a.ChangeType.Local))},this.props.pane),f.e.endAction(),s.default.PaneUpdateBatcher.commitUpdateItems(),"deleteSelf"===t&&ne.a.reset())},checkComplete:function(e){return!e.isComplete()},checkStarred:function(e){return!e.isStarred()},checkP0:function(e){return e.priority()===o.a.VMLIFlag.P0?o.a.VMLIFlag.None:o.a.VMLIFlag.P0},checkP1:function(e){return e.priority()===o.a.VMLIFlag.P1?o.a.VMLIFlag.None:o.a.VMLIFlag.P1},checkP2:function(e){return e.priority()===o.a.VMLIFlag.P2?o.a.VMLIFlag.None:o.a.VMLIFlag.P2},onClick:function(e,t){var a=this.props.pane;if(ne.a.getSelected(a).length>0){var i,n=ne.a.getFirstSelectedItem(a);if(n)e&&this[e]&&(i=this[e](n)),this.applyFn(n,t,i),this.inc.set(this.inc.get()+1)}},renderButton:function(e,t,a,i,n){return b.a.createElement("div",{key:t,className:"f1 multiselectButton flexbox"},b.a.createElement(D.a,{icon:t,width:o.a.RightMenuWidth,enabled:this.state.numSelected>0&&!1!==n,iconSize:24,onClick:this.onClick.bind(this,i,a)},e))},renderPriorityButton:function(){var e=n.default.classNames("f1 priorityButtons flexbox flexvert",{disabled:this.state.numSelected<1});return b.a.createElement("div",{key:"priority",className:e,style:{justifyContent:"center"}},b.a.createElement("div",null,b.a.createElement(D.a,{icon:"priorityButton p0Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP0","priority")}),b.a.createElement(D.a,{icon:"priorityButton p1Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP1","priority")}),b.a.createElement(D.a,{icon:"priorityButton p2Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP2","priority")})),b.a.createElement("div",{className:"fancyButtonText"},"Priority"))},render:function(){var e,t=this.state,a=this.props.pane,i=t.numSelected,r=n.default.classNames("flexbox flexvert",{open:t.isOpen}),s={top:n.default.topBarHeight,bottom:this.props.bottom},l=[];if(t.isAnimating||(s[u.a.transform.react]="translate3d("+(t.offset+100)+"px,0,0)"),i&&(e=ne.a.getFirstSelectedItem(a)),a.type===o.a.PaneMode.Gmail){var d=a.plugin,c=e&&d.isItemUnread(e),h=e&&d.isItemStarred(e),f=e&&d.isItemArchived(e),p=e&&d.isItemFullTrashed(e),g=e&&e.getAttachmentByPlugin(d.id),m=e&&g&&T.a.isAuthorizedForScopes("accountID",[o.a.GScope.GmailModify]);l=[this.renderButton(f?"Unarchive":"Archive","icon-check",f?"gmailUnarchive":"gmailArchive"),this.renderButton("Mark "+(c?"Read":"Unread"),"icon-unread",c?"markRead":"markUnread"),this.renderButton(h?"Unstar":"Star","icon-star","gmailStar"),this.renderPriorityButton(),this.renderButton("Label","icon-tag","label"),this.renderButton("Move","icon-align-left","move"),this.renderButton("Snooze","icon-access_time","snooze",null,m),this.renderButton(p?"Undelete":"Delete","icon-delete",p?"gmailUndelete":"gmailDelete")]}else{var v=e&&e.isComplete();h=e&&e.isStarred();l=[this.renderButton(v?"Uncomplete":"Complete","icon-check","isComplete","checkComplete"),this.renderButton(h?"Unstar":"Star","icon-star","isStarred","checkStarred"),this.renderPriorityButton(),this.renderButton("Move","icon-align-left","move"),this.renderButton("Delete","icon-delete","deleteSelf")]}return b.a.createElement(ce.CSSTransitionGroup,{id:"mobileUIMultiselectWrapper",transitionName:"reactAnimMultiselect",transitionEnterTimeout:150,transitionLeaveTimeout:150},t.isOpen&&b.a.createElement("div",{id:"mobileUIMultiselect",className:r,style:s},l))}}),Jt=he.b.createClass({displayName:"ReactMobileUI",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){this.DISABLE_LISTENER_ASSERT=!0,this.listenToDispatcher(s.default.pluginManager,"pluginActiveChanged");var e=s.default.pluginManager.getPlugin(o.a.PluginID.Gmail);e.onSettingChanged(e.Settings.IsEnabled,this.updateState)},getState:function(){var e=n.default.vmMain,t=g.a.pane.get(),a={pane:g.a.pane,paneExpanded:t.isExpanded,hasPremiumFeatures:s.default.billingManager.hasPremiumFeaturesObservable,gdriveStatus:e.gdriveStatusObs,canAddItem:t.canAddItem,multiselectOffset:fe.default.multiselectOffset,isGmailPaneEnabled:s.default.pluginManager.isGmailPaneEnabled(),isDragging:s.default.DragDrop.isVisible,bottomBarHeight:fe.default.bottomBarHeight};return a.showAddButton=t.canAddItem&&!fe.default.isInMultiselect()&&!s.default.DragDrop.isVisible.get()&&!s.default.menus.isContextMenuOpen()&&!t.isExpanded.get(),a.onlineText=e.onlineText(),a},switchPane:function(e,t){var a=this.state.pane;a.type===e&&a.getViewMode()===t||(n.default.vmMain.switchPaneMobile(e,t),s.default.menus.closeContextMenu(),fe.default.setMultiselectVisibility(!1)),this.refreshListeners()},onClickAdd:function(e){this.state.pane.onTapAddItem(e)},renderButton:function(e,t,a,i,n){var r=this.state.pane;return b.a.createElement(D.a,{className:"f1",icon:i,primary:r.type===e&&(e!==o.a.PaneMode.Task||r.getViewMode()===t),iconSize:n,width:o.a.MobileBottomHeight,height:o.a.MobileBottomHeight,ripple:!1,onClick:this.switchPane.bind(this,e,t)},a)},render:function(){var e=this.state,t=this.state.pane,a=e.bottomBarHeight,i={bottom:a&&a+24},r=n.default.classNames("mobileAddButton",{outline:t.type===o.a.PaneMode.Task},{email:t.type===o.a.PaneMode.Gmail}),s={height:a,display:e.paneExpanded?"none":void 0};return b.a.createElement("div",{id:"mobileUI"},b.a.createElement(Qt,{pane:t,bottom:a}),b.a.createElement("div",{id:"mobileUIBottom",className:"mobileUIBottom",style:s},e.onlineText&&b.a.createElement("div",{className:"mobileOnlineStatus"},e.onlineText),b.a.createElement("div",{id:"mobileBottomBar",className:"flexbox"},e.isGmailPaneEnabled&&this.renderButton(o.a.PaneMode.Gmail,void 0,"Gmail","icon-mail_outline",18),this.renderButton(o.a.PaneMode.Task,o.a.TaskViewMode.Outline,"Tasks","icon-align-left",19),this.renderButton(o.a.PaneMode.Task,o.a.TaskViewMode.Agenda_All,"Agenda","icon-calendar",20))),e.showAddButton&&b.a.createElement(D.a,{icon:"icon-add",className:r,width:50,height:50,color:"white",iconSize:24,style:i,onClick:this.onClickAdd}))}}),Zt=he.b.createClass({displayName:"ReactTooltip",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize")},getState:function(){var e=this.updatePosition();return{left:e.left,top:e.top}},onMount:function(){u.a.isMobile||this.updateState()},updatePosition:function(){var e,t=this.props.tip,a=document.documentElement.getBoundingClientRect(),i=this.refs.element;if(t.element?e=t.element.getBoundingClientRect():n.default.Assert(!1,"Adjust bounds had no valid tip for determining an offset",t),e){if(i){var r,o,l=n.default.width(i),u=n.default.height(i),d=e.left+e.width/2-l/2,c=t&&t.offset;return t&&(t.onRight||n.default.findParentID(t.element,"desktopMenu",8))&&(o=!0,c={left:8+s.default.DesktopUI.getSidebarWidth()+((c?c.left:0)||0)}),r=o?e.top+(e.height-u)/2:t&&t.above||e.bottom+u>a.bottom?e.top-u:e.bottom,c?(c.x?d+=c.x:c.right?d=a.right-l-c.right:c.left&&(d=c.left),c.y?r+=c.y:c.top&&(r+=c.top)):t&&t.above?r-=5:r+=5,d+l>a.right?d=a.right-l-4:d<0&&(d=4),r<0&&(r=4),{left:d=Math.round(d),top:r=Math.round(r)}}return{left:e.left,top:e.top}}},onClick:function(){n.default.tooltip.hideSticky(this.props.tip.text)},render:function(){var e=this.state,t=this.props.tip,a=t.text+(t.hotkey?'<div class="tooltipHotkey">'+t.hotkey+"</div>":""),i=n.default.classNames("tooltip flexbox flexvert",{blue:t.blue},{sticky:t.sticky},{hasHotkey:t.hotkey},{noFormat:a.indexOf("<b>")<0},{arrowDirection:t.arrowDirection}),r=n.default.classNames("tooltipArrow c-tooltip c-shadow-popup",t.arrowClass),o={maxWidth:t.maxWidth};return o[u.a.transform.react]="translate3d("+e.left+"px,"+e.top+"px,0)",b.a.createElement("div",{className:i,style:o,onClick:this.onClick,ref:"element"},b.a.createElement("div",{className:r}),b.a.createElement("div",{className:"tooltipText c-tooltip c-shadow-popup",dangerouslySetInnerHTML:{__html:a}}))}}),$t=he.b.createClass({displayName:"ReactTooltips",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){return{tooltip:n.default.tooltip.tooltip,tooltipsSticky:n.default.tooltip.tooltipsSticky}},render:function(){var e=this.state,t=e.tooltip?e.tooltipsSticky.concat(e.tooltip):e.tooltipsSticky;return t.length>0?b.a.createElement("div",{className:"tooltips"},t.map(function(e){return b.a.createElement(Zt,{key:e.text,tip:e})})):null}}),ea=he.b.createClass({displayName:"ReactSetup",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.useFirebaseLogin=!u.a.isMobile},getState:function(){var e=n.default.vmSetup;return{loginStatus:e.loginStatus,popupClosedError:e.popupClosedError,shouldShowLogin:e.shouldShowLogin(),gapiFailedToLoad:e.gapiFailedToLoad,loggedOutByAuthFailure:e.loggedOutByAuthFailure}},onClickLogin:function(){n.default.vmSetup.onTapLogin()},onClickLanding:function(e){(u.a.isMobile||n.default.hasClass(e.target,"link"))&&n.default.openUrl("https://www.moo.do",e)},onClickDownloadApp:function(){n.default.openUrl(u.a.getAppDownloadURL())},onClickPrivacy:function(e){(u.a.isMobile||n.default.hasClass(e.target,"link"))&&n.default.openUrl("https://www.moo.do/privacy/",e)},render:function(){var e=this.state,t=n.default.vmSetup;n.default.classNames("signInText",{errorConnecting:e.gapiFailedToLoad&&e.loggedOutByAuthFailure});return b.a.createElement("div",{id:"setupWrapper",className:"flexbox flexvert"},b.a.createElement("div",{id:"setupInner"},b.a.createElement("div",{id:"loginInfo"},b.a.createElement("div",{id:"setupLogo"})),b.a.createElement("div",{id:"setupBox"},b.a.createElement("div",{id:"login"},t.showLogin&&b.a.createElement("div",{id:"loginArea"},b.a.createElement("div",{className:"loginButton google",onClick:this.onClickLogin}),!u.a.ios&&b.a.createElement("div",{id:"learnButton",onClick:this.onClickLanding},"Learn more at ",b.a.createElement("b",{className:"link"},"https://moo.do"))),e.popupClosedError&&b.a.createElement("div",{className:"popupClosedError red"},"Error signing in. Please try again."),e.loggedOutByAuthFailure&&b.a.createElement("div",{className:"popupClosedError"},"Logged out due to an error connecting to Google. If you are using a privacy plugin such as Ghostery or Privacy Badger, please disable them or download the app below."),t.showLogin&&t.showDownload&&b.a.createElement("div",{className:"textInLine"},b.a.createElement("div",null,"or")),t.showDownload&&b.a.createElement("div",{id:"setupDownloadArea"},b.a.createElement("div",{className:"loginButton black",onClick:this.onClickDownloadApp},b.a.createElement("span",{className:u.a.getPlatformIcon()}),b.a.createElement("span",{className:"signInText"},t.downloadText)))))))}}),ta=he.b.createClass({displayName:"ReactMainMobile",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){var e=this;this.createObservables({modulesLoaded:!1,disablePointerEvents:!1}),setTimeout(function(){var t=2;a.e(1).then(a.bind(null,322)).then(function(a){Wt=a.default,0===--t&&e.modulesLoaded.set(!0)}),a.e(1).then(a.bind(null,321)).then(function(a){Gt=a.default,0===--t&&e.modulesLoaded.set(!0)})},100);var t=u.a.blockClient();if(void 0!==t){n.default.errorPlatformInfo=t;var i,r=t.platform;r?t.update?"iOS App"===r?i="Please update your iOS app to the latest version in the App Store.":"Android App"===r?i="Please update your Android app to the latest version in the Play Store.":"Native Android"===r?i="Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"===r?i='Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"===r&&u.a.isMobile&&(i="Please update your "+u.a.OSName+" to use Moo.do. Moo.do requires at least iOS 6."):i="Sorry, we don't support "+r+" yet. Please let us know that you're interested in using "+r+" and we will make it a higher priority. Thanks!":!t.needsApp||n.default.isDemoMode()||u.a.isDevURL?t.version?i="Please update your app to the latest version of Moo.do.":t.cacheUpdate&&(i="There was an issue while updating the app, "+u.a.actionVerb()+" to try again.",n.default.AppCache.update()):i="Moo.do cannot be run inside the browser. Please download the Moo.do app from the "+(u.a.ios?"App":"Play")+" store.",u.a.app&&n.default.nativeBridge.sendToApp("localLoaded"),i&&(this.platformError=i)}},onMount:function(){fe.default.init(),this.setPanesContainer(),document.addEventListener("keydown",this.keydown),document.addEventListener("keypress",this.keypress),document.addEventListener("keyup",this.keyup),this.listenToDispatcher("panesChanged")},componentDidUpdate:function(){this.setPanesContainer()},setPanesContainer:function(){var e=this.props.main;e.panesContainer||(e.panesContainer=this.refs.panes)},_isOkToSendKey:function(e){return!e.defaultPrevented&&g.a.getPane()&&!(s.default.menus.isContextMenuOpen()&&!s.default.menus.isAutocompleteOpen())&&!s.default.menus.isModalOpen()&&!this.props.main.activeInput.get()},keydown:function(e){if(this._isOkToSendKey(e)&&g.a.getPane().keydown(e),e.target===document.body&&e.normCode===o.a.KeyCode.Backspace)return e.handled=!0,e.preventDefault(),!1},keypress:function(e){this._isOkToSendKey(e)&&g.a.getPane().keypress(e)},keyup:function(e){this._isOkToSendKey(e)&&g.a.getPane().keyup(e)},onMouseDownPanes:function(e){"panes"===e.target.id&&g.a.reset()},getState:function(){var e=this.props.main,t=s.default.PaneManager;return{panes:t.displayPanes,failedInitialDocLoad:e.failedInitialDocLoad,isDragging:s.default.DragDrop.isVisible,isDraggingPane:s.default.DragDrop.isDraggingPane,isLoading:t.isLoading,isKeyboardOpen:y.isVisible,activeUser:s.default.settings.activeUser,isMainRendered:e.isRendered,showMarkdown:s.default.settings.showMarkdown}},onClickErrorRefresh:function(){n.default.AppCache.runOnFinish(function(){n.default.reload(!n.default.AppCache.useServiceWorker)},!0)},onClickErrorDownload:function(){n.default.openUrl(u.a.getAppDownloadURL())},render:function(){for(var e,t=0,a=this.state,i=[],r=0;r<a.panes.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l=a.panes[r],d=l.type,c=l.pane;if(c.hasBeenActive)if("overview"===d)i.push(b.a.createElement(Ut,{key:"overview"+c.id,pane:c})),c.isActive.get()&&(e=!0);else if("pane"===d)switch(c.type){case o.a.PaneMode.Task:i.push(b.a.createElement(gt,{key:"pane"+c.id,pane:c}));break;case o.a.PaneMode.Archived:case o.a.PaneMode.Drive:i.push(b.a.createElement(dt,{key:"pane"+c.id,pane:c}));break;case o.a.PaneMode.Gmail:i.push(b.a.createElement(mt,{key:"pane"+c.id,pane:c}));break;default:n.default.Assert(!1,"Invalid pane mode requested"+c.type)}else"emailPreview"===d&&i.push(b.a.createElement(Kt,{key:"emailPreview"+c.id,pane:c}))}var h,f,p,g=n.default.classNames("renderedContent c-foreground",{draggingItems:!!a.isDragging||a.isDraggingPane},{draggingPane:a.isDraggingPane},{overviewOpen:e},{hideMDMarkup:!a.showMarkdown});if(s.default.settings.activeUser.get()){if(this.platformError)f=b.a.createElement("div",{className:"centerVHFlex",style:{width:"100%",lineHeight:1.5}},b.a.createElement("div",null,b.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.platformError}}),b.a.createElement("br",null),b.a.createElement("br",null),b.a.createElement(D.a,{display:"block",onClick:this.onClickErrorRefresh},"Reload"),b.a.createElement("br",null),b.a.createElement(D.a,{display:"block",onClick:this.onClickErrorDownload},"Download app")));else if(a.isMainRendered)if(!a.isLoading||n.default.isDemoMode()||a.failedInitialDocLoad){var m={},v=n.default.classNames("panes",{transition:a.animatePaneSwap});m[u.a.transform.react]="translate("+-a.mobilePaneOffset+"px,0)",p=b.a.createElement(ce.CSSTransitionGroup,{className:v,id:"panes",ref:"panes","data-moo-id":"panes",transitionName:"reactMobilePaneAnim",transitionEnterTimeout:o.a.EmailOpenTimeMobile,transitionLeaveTimeout:o.a.EmailOpenTimeMobile,style:m},i),f=b.a.createElement("div",{id:"container",key:"renderedContent",className:g},b.a.createElement("div",{id:"measureText"},b.a.createElement("div",{id:"measureTextItem"})),p,this.props.main.getDefaultEmailPlugin()&&b.a.createElement(St,null),Wt&&b.a.createElement(Wt,null),Gt&&b.a.createElement(Gt,null),b.a.createElement(vt,null),b.a.createElement(Yt,null),b.a.createElement($t,null),a.panes.length>0&&b.a.createElement(Jt,null),a.isKeyboardOpen&&b.a.createElement(Xt,null))}else h=b.a.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"centerVH"},b.a.createElement("div",{className:"loading loading20"}),b.a.createElement("div",{className:"loadingText"},"Loading file"))}else f=b.a.createElement(ea,null);return b.a.createElement(ce.CSSTransitionGroup,{transitionName:"reactFadeMain",transitionEnterTimeout:800,transitionLeaveTimeout:100},f,h)}});t.default=function(){var e,t,a,r,c,h;n.default.checkpoint(o.a.Checkpoint.RequireLoaded),n.default.isDemoMode()||i.a.init(),s.default.init(),l.a.init();try{var f=function(){u.a.updateOrientation(),u.a.isMobile&&(n.default.keyboardToolbar&&n.default.keyboardToolbar.isVisible.get()&&n.default.keyboardToolbar.updatePosition(!0),document.body.scrollTop=0,n.default.keyboardToolbar&&n.default.keyboardToolbar.hideTopBarIfLandscape())};if(n.default.vmSetup=new G,window.__ERRORINMAINHEADER&&n.default.reportError(window.__ERRORINMAINHEADER),n.default.nativeBridge=new le,n.default.Assert(-1===navigator.userAgent.indexOf("Electron")||u.a.appPlatform===o.a.AppPlatform.Electron,"Electron app missing app platform set"),n.default.checkpoint(o.a.Checkpoint.PageLoad),n.default.Assert("loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState),"loading"===document.readyState){var p="ERROR: MainJS running before document load! "+document.readyState;n.default.shouldLog(o.a.LogLevels.Error)&&n.default.log(p),n.default.reportError(new Error(p))}for(var g in window.scriptErrors)window.scriptErrors.hasOwnProperty(g)&&n.default.fireCustomEvent("scriptLoadError",{src:g,id:window.scriptErrors[g],firstChance:!0});if(window.scriptErrors=window.scriptErrors||{},window.handleLoadError=function(e){try{window.scriptErrors[e.target.src]=e.target.id,n.default.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(t){n.default.reportError(t)}},window.oncontextmenu=function(e){n.default.isKeyboardInputElement(e.target)||e.preventDefault()},n.default.isDemoMode()||u.a.offline);else e=window,t=document,a="script",r="ga",e.GoogleAnalyticsObject=r,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=t.createElement(a),h=t.getElementsByTagName(a)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",h.parentNode.insertBefore(c,h),ga("create","UA-37740918-2",{cookieDomain:"auto"}),ga("send","pageview");u.a.updateBodyClass();var m=function(e){document.documentElement.addEventListener(e,function(e){n.default.reportEvent(e)},!0)};0,m("keydown"),m("keyup"),m("keypress"),m("MSPointerDown"),m("MSPointerUp"),m("MSPointerHover"),m("MSPointerCancel"),m("mousedown"),m("mouseup"),m("touchstart"),m("touchend"),n.default.tooltip=new Q,n.default.AppCache=new Z,n.default.localDocChangeRequested=!1;var v=function e(t){var a=u.a.getActualWindowWidth(),r=u.a.getActualWindowHeight();n.default.Assert(0!==a&&!isNaN(a)&&0!==r&&!isNaN(r),"Window size is 0",a,r);var o=u.a.windowWidth(!0),s=u.a.windowHeight(!0);u.a.ipad&&!u.a.app&&!0!==t&&!1!==t&&setTimeout(e,0,!0),a===o&&r===s||(u.a.setWindowSize(a,r),u.a.onResize.notify(),n.default.documentHeight=r,i.a.onActiveUser(function(){var e=r-s,i=(u.a.android||u.a.mobileie)&&r>s&&(!u.a.app||e<=u.a.getKBSize())&&n.default.vmMain&&n.default.isLoaded;i&&n.default.blurActiveElement(),i&&B.a.hide(),o!==a&&t&&u.a.isMobile&&n.default.focusedPane&&(u.a.isMobile&&n.default.focusedPane&&n.default.focusedPane.updatePositionMobile(),n.default.isKeyboardOpen&&n.default.focusedPane.addPadding()),u.a.isMobile||d.a.fireEvent("windowResize",[])}))};v(!1),f(),n.default.shouldLog(o.a.LogLevels.Timing)&&n.default.log("Running main.js: ",log.now()),window.onblur=function(){n.default.hasFocus=!1},window.onfocus=function(){n.default.hasFocus=!0};new N;if(u.a.isMobile&&!u.a.android){window.addEventListener("resize",function(){n.default.animFrameOnce("windowResize",v)})}else window.addEventListener("resize",v);window.addEventListener("orientationchange",f),window.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),window.addEventListener("dragover",function(e){return e.preventDefault(),!1});var y=!1;l.a.loadLocal(function(e){y||(y=!0,n.default.checkpoint(o.a.Checkpoint.InitializeMain),n.default.registerEvent("ItemCreated","ItemAction","Create"),n.default.registerEvent("ItemCompleted","ItemAction","Complete"),function(){try{!0,n.default.checkpoint(o.a.Checkpoint.OnInitializedData),n.default.isDemoMode()||(n.default.vmMain.setupDateRollover(),window.addEventListener("focus",n.default.vmMain.ensureDateRollover)),n.default.vmMain.loadData(),n.default.shouldLog(o.a.LogLevels.Timing)&&n.default.log("Data done loading: ",log.now())}catch(e){n.default.reportError(e)}}())}),!n.default.isDemoMode()&&u.a.app&&n.default.nativeBridge.sendToApp("loaded"),de.a.render(b.a.createElement(ta,{main:n.default.vmMain}),document.getElementById("outerWrapper"))}catch(_){console.log(_),n.default.handleCriticalError(),n.default.reportError(_,"Critical Error")}}},function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(3),o=a(2),s=a(4),l=a.n(s),u=a(13),d=a(15),c=a(10),h=a(5),f=a(45),p=["#4D4D4D","#999999","#CCCCCC","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#BBBBBB","#EEEEEE","#D33115","#E27300","#FCC400","#22AA66","#16A5A5","#0099DD","#7B64FF","#FA28FF","#000000","#666666","#AAAAAA","#DDDDDD","#AA3300","#C45100","#FB9E00","#194D33","#0C797D","#0062B1","#653294","#AB149E"],g={hex3:/^(#)([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^(#)([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},m=u.b.createClass({displayName:"FancyColorPickerContextMenu",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({color:this.props.color,value:this.props.color,isValid:!0}),h.a.reset()},parseColor:function(e){var t;return(t=g.hex3.exec(e))?"#"+t[2]+t[2]+t[3]+t[3]+t[4]+t[4]:(t=g.hex6.exec(e))?e:void 0},onClickColor:function(e){this.color.set(e),this.value.set(e),this.props.onChange(e)},onChangeInputColor:function(e){var t=e.target.value.toUpperCase();0!==t.indexOf("#")&&(t="#"+t);var a=this.parseColor(t);a&&(this.color.set(a),this.props.onChange(a)),t.length<8&&this.value.set(t),this.isValid.set(!!this.parseColor(this.value.get()))},onChangeInputComponent:function(){var e=this.refs,t=e.r.value,a=e.g.value,n=e.b.value;if(t>=0&&t<=255&&a>=0&&a<=255&&n>=0&&n<=255){var r="#"+i.default.rgbToHex(t,a,n);this.value.set(r),this.color.set(r),this.props.onChange(r)}},render:function(){for(var e=0,t=this.state,a=this.state.color,n=i.default.hexToRgb(a),r=[],o=0;o<p.length;o++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=p[o],u=i.default.classNames("fancyColor",{selected:s===a},{isWhite:"#FFFFFF"===s.toUpperCase()}),d={background:s};r.push(l.a.createElement("div",{key:s,className:u,style:d,onClick:this.onClickColor.bind(this,s)}))}var c=i.default.classNames("fancyColorInputColor",{invalid:!t.isValid});return l.a.createElement(f.a,{id:"fancyColorPicker",element:this.props.element,positionOffset:{left:-120,top:4}},l.a.createElement("div",{className:"fancyColors"},r),l.a.createElement("div",{className:"fancyColorText"},l.a.createElement("div",{key:a,className:"fancyColor",style:{background:a}}),l.a.createElement("input",{type:"text",className:c,value:t.value,onChange:this.onChangeInputColor}),l.a.createElement("span",null,"R"),l.a.createElement("input",{type:"text",ref:"r",className:"fancyColorInputComponent",value:n.r,onChange:this.onChangeInputComponent}),l.a.createElement("span",null,"G"),l.a.createElement("input",{type:"text",ref:"g",className:"fancyColorInputComponent",value:n.g,onChange:this.onChangeInputComponent}),l.a.createElement("span",null,"B"),l.a.createElement("input",{type:"text",ref:"b",className:"fancyColorInputComponent",value:n.b,onChange:this.onChangeInputComponent})))}}),v=u.b.createClass({displayName:"FancyColorPicker",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({color:this.props.color})},componentWillReceiveProps:function(e){e.color!==this.props.color&&this.color.set(e.color)},openMenu:function(e){r.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})},onChange:function(e){this.color.set(e),this.props.onChange(e)},renderContextMenu:function(e){return l.a.createElement(m,{key:"fancyColorPicker",color:this.state.color,onChange:this.onChange,element:e.element})},render:function(){var e=i.default.extend({background:this.state.color,border:"1px solid #666"},this.props.style),t=i.default.classNames("fancyColor",{isWhite:"#FFFFFF"===this.state.color.toUpperCase()});return l.a.createElement("div",{className:t,style:e,onClick:this.openMenu})}}),y=/(^|\s|&nbsp;|<div>|<span>|<p>)((?:(?:((https?|ftps?):\/\/)|www)[^"<\s]+)(?![^<>]*>|[^"]*?<\/a))/gi,_=[n.a.KeyCode.LeftArrow,n.a.KeyCode.RightArrow,n.a.KeyCode.UpArrow,n.a.KeyCode.DownArrow,n.a.KeyCode.Enter,n.a.KeyCode.Escape,n.a.KeyCode.PageUp,n.a.KeyCode.PageDown],b=u.b.createClass({displayName:"FancyContenteditable",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({isFocused:this.props.focused||!1})},onMount:function(){var e=this,t=this.props;if(t.value){var a=this.replaceHTMLLinks(t.value.replace(/\r?\n/g,"<br>"));this.setValue(a)}t.focused&&requestAnimationFrame(function(){e.refs.div&&e.refs.div.focus()})},onUnmount:function(){this.isFocused.get()&&this.onBlur()},focus:function(){i.default.isDemoRunning||this.refs.div.focus()},blur:function(){this.refs.div.blur()},setValue:function(e){this.refs.div.innerHTML=e},getValue:function(){return this.refs.div.textContent.length>0?this.refs.div.innerHTML:""},getTextValue:function(){return this.refs.div.textContent},getElement:function(){return this.refs.div},insertCharAtIndex:function(e,t){var a=this.refs.div,i=a.innerHTML;i=i.substr(0,t)+e+i.substr(t,i.length),a.innerHTML=i,d.default.selectElement(a,t+1),this.props.onChange&&this.props.onChange()},onFocus:function(e){i.default.vmMain.activeInput.set(this),this.isFocused.set(!0),this.props.onFocus&&this.props.onFocus(e)},onBlur:function(e){i.default.vmMain.activeInput.set(null),this.isFocused.set(!1),this.props.onBlur&&this.props.onBlur(e)},hasFocus:function(){return this.isFocused.get()},onEscapeKey:function(){this.props.onEscape&&this.props.onEscape()},onDrop:function(e){this.props.onDrop&&this.props.onDrop(e.dataTransfer)},onDragEnter:function(){this.props.onDrop&&i.default.addClass(this.refs.div,"dragTarget")},onDragLeave:function(){this.props.onDrop&&i.default.removeClass(this.refs.div,"dragTarget")},onKeyDown:function(e){if(o.a.mac&&e.metaKey||!o.a.mac&&e.ctrlKey)e.keyCode===n.a.KeyCode.U?this.onClickToolbarButton("underline"):e.keyCode===n.a.KeyCode.K?this.insertLink({target:this.refs.link.getElement()}):e.keyCode===n.a.KeyCode.H?(this.makeHeading(),i.default.preventDefault(e)):e.keyCode===n.a.KeyCode.V&&(this.__pasteWithShift=e.shiftKey);else if(!_.includes(e.keyCode)){var t=d.default._getSelectionRange();if(t){var a=t.startContainer,r=a.parentElement;"A"===r.nodeName&&r.textContent===r.getAttribute("href")&&t.startOffset===t.endOffset&&t.startOffset===r.textContent.length&&(r.replaceWith(a),d.default.selectAfterNode(a))}}this.props.onKeyDown&&this.props.onKeyDown(e)},insertNode:function(e){this.focus(),d.default.deleteRangeContents(),d.default.insertNode(e),d.default.selectAfterNode(e)},insertLink:function(e){var t=d.default.getSelectedText(),a=e.target;this.savedSel=d.default.getSelectionRange(),r.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:a,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:t})},onInsertLinkClosed:function(){this.savedSel&&(this.focus(),d.default.setSelectionRange(this.savedSel))},onInsertLink:function(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.insertNode(t)},makeHeading:function(e){for(var t,a,i=0,n=window.getSelection(),r=n.rangeCount;r--;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=n.getRangeAt(r),s=o.startContainer,l=o.startContainer.parentElement,u=d.default.getSelectOffsetsInElement(this.refs.div,o);if("H2"===l.nodeName)a=void 0,l.parentElement.replaceChild(s,l),d.default.selectElement(s,0,s.textContent.length);else if(u){if(!e&&u.start===u.end)return d.default.selectElement(s,0,s.textContent.length),this.makeHeading(!0);(a=document.createElement("h2")).appendChild(o.extractContents()),o.insertNode(a),t=a.textContent.length}}a&&t&&d.default.selectElement(a,0,t)},onClickToolbarButton:function(e,t){i.default.isString(e)?"heading"===e?this.makeHeading():document.execCommand(e):e(t),i.default.preventAndStop(t)},onClick:function(e){"A"===e.target.nodeName?i.default.openUrl(e.target.href):this.props.onClick&&this.props.onClick(e)},onPaste:function(e){if(this.__pasteWithShift){var t=document.queryCommandSupported("insertText"),a=document.queryCommandSupported("paste");if(t||a){e.preventDefault();var i="";e.clipboardData||e.originalEvent.clipboardData?i=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(i=window.clipboardData.getData("Text")),i=i.trim();var n=t?"insertText":"paste";document.execCommand(n,!1,i)}}},replaceHTMLLinks:function(e){return e.replace(y,function(e,t,a){return t+'<a href="'+a+'">'+a+"</a>"})},onSetColor:function(e){document.execCommand("forecolor",!1,e)},onChange:function(e){var t=e.target.innerHTML,a=this.replaceHTMLLinks(t);if(t!==a){var i=d.default._getSelectionRange(),n={start:0,end:0};i&&(n=d.default.getSelectOffsetsInElement(e.target,i)),e.target.innerHTML=a,d.default.selectElement(e.target,n.start,n.end)}this.props.onChange&&this.props.onChange(e)},renderToolbarButton:function(e,t,a,i,n,r){var s=o.a.priModKey;return n="Escape"===n?n:s+" + "+n,l.a.createElement(c.a,{className:"button_"+i,icon:e,width:36,height:36,iconSize:t,onClick:this.onClickToolbarButton.bind(this,a),tooltip:i,tooltipHotkey:n,ref:r})},render:function(){var e,t=this.props,a=i.default.classNames("fancyContenteditableWrapper flexbox flexvert",t.className),n=i.default.classNames("fancyContenteditable f1 c-background",{richText:t.richText}),r=!!t.spellCheck||null;return t.richText&&(e=l.a.createElement("div",{className:"fancyContenteditableToolbar c-bg-faded c-border-light"},this.renderToolbarButton("icon-format_bold",19,"bold","Bold","B"),this.renderToolbarButton("icon-format_italic",19,"italic","Italic","I"),this.renderToolbarButton("icon-format_underlined",18,"underline","Underline","U"),this.renderToolbarButton("icon-header",14,"heading","Heading","H","H1"),l.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),this.renderToolbarButton("icon-numlist",14,"insertOrderedList","Numbered list","L"),this.renderToolbarButton("icon-bullet",26,"insertUnorderedList","Bulleted list","Option + L"),l.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),l.a.createElement(v,{color:"#000000",onChange:this.onSetColor,style:{marginTop:11,verticalAlign:"top"}}),this.renderToolbarButton("icon-link",18,this.insertLink,"Link","K","link"),!o.a.isMobile&&t.onClickClose&&this.renderToolbarButton("icon-close",18,t.onClickClose,"Close","Escape"))),l.a.createElement("div",{className:a},e,l.a.createElement("div",{contentEditable:!1!==t.editable,className:n,style:this.props.style,ref:"div",spellCheck:r,onInput:this.onChange,onClick:this.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyPress:this.props.onKeyPress,onKeyUp:this.onKeyUp,onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onPaste:this.onPaste}))}});t.a=b},,,,,function(e,t,a){"use strict";a.r(t);a(228);var i=a(18),n=a(2);function r(){document.removeEventListener("DOMContentLoaded",r,!1),window.removeEventListener("load",r,!1),n.a.demo?a(221).default():i.a.preload(function(){a(221).default()})}window.__isLoaded=!0,"complete"===document.readyState||"interactive"===document.readyState?r():(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1))},function(e,t,a){"http:"===window.location.protocol&&(window.location.hash.indexOf("state=")<0||window.location.hash.indexOf("app")<0&&window.location.hash.indexOf("appv")<0)&&(window.location=window.location.href.replace(/^http:/,"https:"));try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.__SESSION_BEGIN=Date.now();var i=function(){};window.appEvents=window.appEvents||{kbsize:i,enterBackground:i,enterForeground:i,statusBarTap:i,closeKeyboard:i,undo:i,redo:i,notifyOAuth:i,features:i,reportLowMemory:i,pokeBackground:i},window.console||(window.console={log:function(){},error:function(){}});window.log=window.console.log.bind(window.console),window.__log=window.console.log.bind(window.console),window.__warn=window.console.warn.bind(window.console),window.__error=window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){})}catch(n){console.log("Error in main header",n),window.__ERRORINMAINHEADER=n}},,,,,,,,,,,,,,function(e,t,a){var i={"./af":99,"./af.js":99,"./ar":100,"./ar-dz":101,"./ar-dz.js":101,"./ar-kw":102,"./ar-kw.js":102,"./ar-ly":103,"./ar-ly.js":103,"./ar-ma":104,"./ar-ma.js":104,"./ar-sa":105,"./ar-sa.js":105,"./ar-tn":106,"./ar-tn.js":106,"./ar.js":100,"./az":107,"./az.js":107,"./be":108,"./be.js":108,"./bg":109,"./bg.js":109,"./bm":110,"./bm.js":110,"./bn":111,"./bn.js":111,"./bo":112,"./bo.js":112,"./br":113,"./br.js":113,"./bs":114,"./bs.js":114,"./ca":115,"./ca.js":115,"./cs":116,"./cs.js":116,"./cv":117,"./cv.js":117,"./cy":118,"./cy.js":118,"./da":119,"./da.js":119,"./de":120,"./de-at":121,"./de-at.js":121,"./de-ch":122,"./de-ch.js":122,"./de.js":120,"./dv":123,"./dv.js":123,"./el":124,"./el.js":124,"./en-au":125,"./en-au.js":125,"./en-ca":126,"./en-ca.js":126,"./en-gb":127,"./en-gb.js":127,"./en-ie":128,"./en-ie.js":128,"./en-il":129,"./en-il.js":129,"./en-nz":130,"./en-nz.js":130,"./eo":131,"./eo.js":131,"./es":132,"./es-do":133,"./es-do.js":133,"./es-us":134,"./es-us.js":134,"./es.js":132,"./et":135,"./et.js":135,"./eu":136,"./eu.js":136,"./fa":137,"./fa.js":137,"./fi":138,"./fi.js":138,"./fo":139,"./fo.js":139,"./fr":86,"./fr-ca":140,"./fr-ca.js":140,"./fr-ch":141,"./fr-ch.js":141,"./fr.js":86,"./fy":142,"./fy.js":142,"./gd":143,"./gd.js":143,"./gl":144,"./gl.js":144,"./gom-latn":145,"./gom-latn.js":145,"./gu":146,"./gu.js":146,"./he":147,"./he.js":147,"./hi":148,"./hi.js":148,"./hr":149,"./hr.js":149,"./hu":150,"./hu.js":150,"./hy-am":151,"./hy-am.js":151,"./id":152,"./id.js":152,"./is":153,"./is.js":153,"./it":154,"./it.js":154,"./ja":155,"./ja.js":155,"./jv":156,"./jv.js":156,"./ka":157,"./ka.js":157,"./kk":158,"./kk.js":158,"./km":159,"./km.js":159,"./kn":160,"./kn.js":160,"./ko":161,"./ko.js":161,"./ky":162,"./ky.js":162,"./lb":163,"./lb.js":163,"./lo":164,"./lo.js":164,"./lt":165,"./lt.js":165,"./lv":166,"./lv.js":166,"./me":167,"./me.js":167,"./mi":168,"./mi.js":168,"./mk":169,"./mk.js":169,"./ml":170,"./ml.js":170,"./mn":171,"./mn.js":171,"./mr":172,"./mr.js":172,"./ms":173,"./ms-my":174,"./ms-my.js":174,"./ms.js":173,"./mt":175,"./mt.js":175,"./my":176,"./my.js":176,"./nb":177,"./nb.js":177,"./ne":178,"./ne.js":178,"./nl":179,"./nl-be":180,"./nl-be.js":180,"./nl.js":179,"./nn":181,"./nn.js":181,"./pa-in":182,"./pa-in.js":182,"./pl":183,"./pl.js":183,"./pt":184,"./pt-br":185,"./pt-br.js":185,"./pt.js":184,"./ro":186,"./ro.js":186,"./ru":187,"./ru.js":187,"./sd":188,"./sd.js":188,"./se":189,"./se.js":189,"./si":190,"./si.js":190,"./sk":191,"./sk.js":191,"./sl":192,"./sl.js":192,"./sq":193,"./sq.js":193,"./sr":194,"./sr-cyrl":195,"./sr-cyrl.js":195,"./sr.js":194,"./ss":196,"./ss.js":196,"./sv":197,"./sv.js":197,"./sw":198,"./sw.js":198,"./ta":199,"./ta.js":199,"./te":200,"./te.js":200,"./tet":201,"./tet.js":201,"./tg":202,"./tg.js":202,"./th":203,"./th.js":203,"./tl-ph":204,"./tl-ph.js":204,"./tlh":205,"./tlh.js":205,"./tr":206,"./tr.js":206,"./tzl":207,"./tzl.js":207,"./tzm":208,"./tzm-latn":209,"./tzm-latn.js":209,"./tzm.js":208,"./ug-cn":210,"./ug-cn.js":210,"./uk":211,"./uk.js":211,"./ur":212,"./ur.js":212,"./uz":213,"./uz-latn":214,"./uz-latn.js":214,"./uz.js":213,"./vi":215,"./vi.js":215,"./x-pseudo":216,"./x-pseudo.js":216,"./yo":217,"./yo.js":217,"./zh-cn":218,"./zh-cn.js":218,"./zh-hk":219,"./zh-hk.js":219,"./zh-tw":220,"./zh-tw.js":220};function n(e){var t=r(e);return a(t)}function r(e){var t=i[e];if(!(t+1)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return t}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id=242}]);
