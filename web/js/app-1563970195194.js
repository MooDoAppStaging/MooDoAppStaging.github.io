!function(e){function t(t){for(var i,n,o=t[0],l=t[1],d=t[2],c=0,u=[];c<o.length;c++)n=o[c],r[n]&&u.push(r[n][0]),r[n]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(h&&h(t);u.length;)u.shift()();return s.push.apply(s,d||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],i=!0,o=1;o<a.length;o++){var l=a[o];0!==r[l]&&(i=!1)}i&&(s.splice(t--,1),e=n(n.s=a[0]))}return e}var i={},r={1:0},s=[];function n(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.e=function(e){var t=[],a=r[e];if(0!==a)if(a)t.push(a[2]);else{var i=new Promise(function(t,i){a=r[e]=[t,i]});t.push(a[2]=i);var s,o=document.createElement("script");o.charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.src=function(e){return n.p+""+({2:"delayedUI",3:"dimport"}[e]||e)+"-1563970195194.js"}(e);var l=new Error;s=function(t){o.onerror=o.onload=null,clearTimeout(d);var a=r[e];if(0!==a){if(a){var i=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+i+": "+s+")",l.name="ChunkLoadError",l.type=i,l.request=s,a[1](l)}r[e]=void 0}};var d=setTimeout(function(){s({type:"timeout",target:o})},12e4);o.onerror=o.onload=s,document.head.appendChild(o)}return Promise.all(t)},n.m=e,n.c=i,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="js/",n.oe=function(e){throw console.error(e),e};var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var d=0;d<o.length;d++)t(o[d]);var h=l;s.push([481,0]),a()}({0:function(e,t,a){"use strict";a.r(t);var i=a(7),r=a.n(i),s=a(1);function n(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}function o(){}n.prototype={tokenize:function(){for(var e,t=0,a=[],i=0,r=this.str.length;i<r;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=this.str.charAt(i),this.checkChar(e)}return this.list.forEach(function(e){e.value=(e.value||"").toString().trim(),e.value&&a.push(e)}),a},checkChar:function(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}this.escaped||"\\"!==e?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1):this.escaped=!0}},o.prototype={_handleAddress:function(e){var t,a,i,r,s=0,n=!1,o="text",l=[],d={address:[],comment:[],group:[],text:[]};for(i=0,r=e.length;i<r;i++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if("operator"===(t=e[i]).type)switch(t.value){case"<":o="address";break;case"(":o="comment";break;case":":o="group",n=!0;break;default:o="text"}else t.value&&("address"===o&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),d[o].push(t.value))}if(!d.text.length&&d.comment.length&&(d.text=d.comment,d.comment=[]),n)d.text=d.text.join(" "),l.push({name:d.text||a&&a.name,group:d.group.length?this.parse(d.group.join(",")):[]});else{if(!d.address.length&&d.text.length){var h=0;for(i=d.text.length-1;i>=0;i--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(d.text[i].match(/^[^@\s]+@[^@\s]+$/)){d.address=d.text.splice(i,1);break}}var c=function(e){return d.address.length?e:(d.address=[e.trim()]," ")};if(!d.address.length){var u=0;for(i=d.text.length-1;i>=0;i--){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(d.text[i]=d.text[i].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,c).trim(),d.address.length)break}}}if(!d.text.length&&d.comment.length&&(d.text=d.comment,d.comment=[]),d.address.length>1&&(d.text=d.text.concat(d.address.splice(1))),d.text=d.text.join(" "),d.address=d.address.join(" "),!d.address&&n)return[];(a={address:d.address||d.text||"",name:d.text||d.address||""}).address===a.name&&((a.address||"").match(/@/)?a.name="":a.address=""),l.push(a)}return l},parse:function(e){var t=0,a=new n(e).tokenize(),i=[],r=[],s=[];a.forEach(e=>{"operator"!==e.type||","!==e.value&&";"!==e.value?r.push(e):(r.length&&i.push(r),r=[])}),r.length&&i.push(r),i.forEach(e=>{let t=this._handleAddress(e);t.length&&(s=s.concat(t))});for(var o=[],l=0;l<s.length;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;o.push({type:"contact",text:s[l].name||s[l].address,email:s[l].address})}return o}};var l=new o,d=a(92);var h,c=()=>{if("function"!==typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(e){try{L.PAssert(661,L.isArray(e),"Must only supply array to pushArray")}catch(t){L.reportError(t)}return this.push.apply(this,e)}),"function"!==typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(e){try{L.PAssert(662,L.isArray(e),"Must only supply array to removeArray")}catch(t){L.reportError(t)}return this.filter(function(t){return!e||e.indexOf(t)<0})}),"function"!==typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(e){return this.splice(e,1)[0]}),"function"!==typeof Array.prototype.remove&&(Array.prototype.remove=function(e,t){var a=this.indexOf(e,t);return a>=0&&this.removeAt.call(this,a),a}),"function"!==typeof Array.prototype.equals){function e(t,a,i){return t&&a&&"object"===typeof t&&"object"===typeof a?Object.keys(t).length===Object.keys(a).length&&Object.keys(t).reduce(function(r,s){return r&&(i?e(t[s],a[s],i):t[s]===a[s])},!0):t===a}Array.prototype.equals=function(t,a){var i=0;if(!t)return!1;if(this.length!==t.length)return!1;for(var r=0,s=this.length;r<s;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this[r]instanceof Array&&t[r]instanceof Array){if(!this[r].equals(t[r]))return!1}else if(this[r]!==t[r]&&!e(this[r],t[r],a))return!1}return!0}}"function"!==typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(e,t){for(var a=0,i=0;i<this.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this[i][e]===t)return i}return-1}),"function"!==typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(e,t){var a=0;try{L.PAssert(664,void 0!==e&&null!==e,"Require a valid element to insert")}catch(o){L.reportError(o)}try{L.PAssert(665,t,"Require a valid comparison function")}catch(o){L.reportError(o)}for(var i=0,r=this.length-1;i<=r;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i+r>>1,n=t(this[s],e);if(n<0)i=s+1;else{if(!(n>0))return s;r=s-1}}return i}),"function"!==typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(e,t){var a=this.findInsertIndex(e,t);if(0===t(this[a],e))return this[a]}),"function"!==typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(e,t){var a=this.findInsertIndex(e,t);return this.splice.apply(this,[a,0,e]),a}),"function"!==typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(e,t){var a=0;if(!e)return this;for(var i=0,r=e.length;i<r;++i){var s=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var n=!0,o=0,l=this.length;o<l;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(t&&t(e[i],this[o])||!t&&e[i]===this[o]){n=!1;break}}n&&this.push(e[i])}return this}),"function"!==typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}):String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!==typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(e,t){for(var a=0,i=-1,r=t-1;r>=0;--r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this[r]===e){i=r;break}}return i}),"function"!==typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)})},u=a(17),p=a(9),g=a(8),f=a(464),m=a.n(f),v=(a(485),{"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"}),y=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g,_=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"];var S,P,I=(h=class{constructor(){c(),this.SESSION_BEGIN=Date.now(),this.LogLevel=s.a.LogLevels.Error|s.a.LogLevels.Warning,this.noLocalWrites=!1,this.totalItems=0,this.totalArchivedItems=0,this.totalArchivedParents=0,this.totalPanes=0,this.tempIndex=0,this.__FULL_NOTIFICATION_UPDATES=0,this.__SINGLE_NOTIFICATION_UPDATES=0,this.TEMP_PREFIX="~T^",this._itemAnimationMode=void 0,this.fnRegex=/function\s+([^(]*?)\s*\(([^)]*)\)/,this.supportSimpleStack=!0,this.__LOG_BUFFER=new d.a(50),this.isLoaded=!1,this.aggregateEvents={},this.anonID=void 0,this.defaultSeed=129831293,this._isInCompleteAction=!1,this.timeouts={},this.lastActivity=Date.now(),this.activityThreshold=this.seconds(5),this.activeInput=new p.a(null),this.lastDateRollover=0,this.__xhrRequests={},this.isRollbarConfigured=!1,this.lastErrorsReported={},this.timeouts={},this.numReported=0,this.isReporting=!1}Assert(...e){}isFlagSet(e,t){return(e&t)===t}isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}isString(e){return"string"===typeof e}isObject(e){return"object"===typeof e&&null!==e&&!this.isArray(e)}isNumber(e){return"number"===typeof e&&!isNaN(e)}isBoolean(e){return!0===e||!1===e}isAnything(){return!0}isValidColor(e){return this.isString(e)&&null!==/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.exec(e)}parseBoolean(e){return!0===e||"true"===e}parseDate(e){var t=new Date(e);return this.isDateValid(t)?t:void 0}clone(e,t){let a;if(this.isArray(e))return this.cloneDeep(e);if(t)for(var i in a={},e)e.hasOwnProperty(i)&&(t&&void 0===e[i]||(a[i]=e[i]));else a=Object.assign({},e);return a}cloneWithoutUndefineds(e){return this.clone(e,!0)}cloneDeep(e){return JSON.parse(JSON.stringify(e))}arrayDifference(e,t){for(var a=0,i=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t[e[r]]||i.push(e[r])}return i}emptyFn(){}newEmptyFn(){return function(){}}weeks(e){return 6048e5*e}days(e){return 864e5*e}hours(e){return 36e5*e}minutes(e){return 6e4*e}seconds(e){return 1e3*e}parseInt(e){return parseInt(e,10)}shouldLog(e){return this.__DEV__===e}shouldWriteLocal(){return!this.noLocalWrites}isLocalWriteReason(e){return this.noLocalWritesReason===e}isValidChangeType(e){if(void 0!==e&&null!==e){var t=e&~s.a.ChangeType.All;if(this.inMaskOnly(e,s.a.ChangeType.Valid))return(t&s.a.ChangeType.Locations)===s.a.ChangeType.None||this.isOneFlagSet(t,s.a.ChangeType.Local|s.a.ChangeType.Remote|s.a.ChangeType.Auto)}return!1}isRemoteChange(e){try{this.PAssert(476,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~s.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,s.a.ChangeType.Remote)}isUndoRedoChange(e){try{this.PAssert(477,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~s.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,s.a.ChangeType.UndoRedo)}isLocalChange(e){try{this.PAssert(478,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~s.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,s.a.ChangeType.Local)}isAutoChange(e){try{this.PAssert(479,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~s.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,s.a.ChangeType.Auto)}inMaskOnly(e,t){return 0===(~t&e)}isOneFlagSet(e,t){var a=e&t;return 0!==a&&0===(a&a-1)}isAtLeastOneFlagSet(e,t){return 0!==(e&t)}forEachFlagSet(e,t){for(var a=0;0!==e;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t(Math.abs(e&-e)),e&=e-1}}generateTempId(){return this.TEMP_PREFIX+Date.now()+ ++this.tempIndex}toLowerCase(e){return e.toLowerCase()}numberComparator(e,t){return e-t}insertIntoText(e,t,a){try{this.PAssert(480,a<=e.length)}catch(i){this.reportError(i)}return e.substr(0,a)+t+e.substr(a,e.length-a)}arrayUnion(e,t){for(var a=0,i=0,r=[],s=0;s<e.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r.indexOf(e[s])<0&&r.push(e[s])}for(s=0;s<t.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r.indexOf(t[s])<0&&r.push(t[s])}return r}arrayUnionByKey(e,t,a){for(var i=0,r=0,s=[],n=0;n<e.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;s.indexOfWithProperty(a,e[n])<0&&s.push(e[n])}for(n=0;n<t.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;s.indexOfWithProperty(a,t[n])<0&&s.push(t[n])}return s}arrayDiff(e,t){for(var a=0,i=0,r=[],s=0;s<e.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(e[s])<0&&r.push(e[s])}for(s=0;s<t.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.indexOf(t[s])<0&&r.push(t[s])}return r}arrayIntersection(e,t){for(var a=0,i=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(e[r])>=0&&i.push(e[r])}return i}arrayIntersectionByKey(e,t,a){for(var i=0,r=[],s=0;s<e.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t.indexOfWithProperty(a,e[s][a])>=0&&r.push(e[s])}return r}arrayUniques(e,t){return t?e.filter((a,i)=>e.findIndex(e=>e[t]===a[t])===i):e.filter((t,a)=>e.indexOf(t)===a)}removeNullUndefined(e){var t;return Object.keys(e).forEach(a=>{null!=e[a]&&void 0!==e[a]||delete(t=t||Object.assign({},e))[a]}),t||e}deepEqual(e,t,a){return a&&(this.isObject(e)&&(e=this.removeNullUndefined(e)),this.isObject(t)&&(t=this.removeNullUndefined(t))),m()(e,t)}extend(e,t){if(t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e}classNames(...e){for(var t=0,a=arguments,i=[],r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[r];if(s)if(this.isString(s)||this.isNumber(s))i.push(s);else if("object"===typeof s)for(var n in s)s.hasOwnProperty(n)&&s[n]&&i.push(n)}return i.join(" ")}isPrefixTask(e){return e&&(e===s.a.Prefix.Task||e===s.a.Prefix.Task2||e===s.a.Prefix.Task3||e===s.a.Prefix.Task4||e===s.a.Prefix.Task5||e===s.a.Prefix.Task6||e===s.a.Prefix.Task7||e===s.a.Prefix.Task8)}escape(e){return String(e).replace(/[&\"<>]/g,function(e){return v[e]})}unescape(e){return String(e).replace(/&lt;|&gt;|&amp;|&quot;/g,function(e){for(var t in v)if(v.hasOwnProperty(t)&&v[t]===e)return t;try{this.PAssert(481,!1,"Should have found a character to replace")}catch(a){this.reportError(a)}return e})}escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}stripTagsBasic(e){return e.replace(/<.*>/g,"")}stripFormattingTags(e){return e.replace(/<\/?[biu]>/g,"")}invertObject(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[e[a]]=a);return t}filterWithNonMatches(e,t){var a=0;let i={match:[],fail:[]};for(let r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let s=e[r];t(s)?i.match.push(s):i.fail.push(s)}return i}isUrlImage(e){return(e=e.toLowerCase()).endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".gif")}isDateSoft(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}isDateValid(e){return e&&e instanceof Date&&!isNaN(e.getTime())}getItemAnimationMode(){return this._itemAnimationMode}setItemAnimationMode(e){this._itemAnimationMode=e}resetItemAnimationMode(){this._itemAnimationMode=s.a.ItemAnimationMode.Normal}parseEmailAddresses(e){return l.parse(e)}isTempId(e){return e&&e[0]===this.TEMP_PREFIX[0]&&e[1]===this.TEMP_PREFIX[1]&&e[2]===this.TEMP_PREFIX[2]}isLocalItem(e){try{this.PAssert(482,e.id,"All items should have an ID even if it is a temp one")}catch(t){this.reportError(t)}return this.isTempId(e.id)}getCurrentStack(e){var t;if(this.supportSimpleStack)try{t=JSON.stringify(e)}catch(a){this.log("Error stringifying stack message",a,e)}if(this.supportSimpleStack){var a=new Error(t||e);if(a.stack)return a.stack}this.supportSimpleStack=!1;try{for(var i=0,r=["GenError: "+(t||e)],s=arguments.callee.caller,n=0;s&&n++<75;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o,l=s.toString(),d=this.fnRegex.exec(l);o=d&&3===d.length&&""!==d[1]&&void 0!==d[1]?"at "+d[1]+"("+d[2].replace(/[\r\n]/g,"")+")":d&&3===d.length?"at <anonymous> ("+d[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",r.push(o),s=s.caller}return r.join("\n")}catch(h){this.log("Error generating stack trace",h)}return""}isVMLI(e){return e&&e.__ISVMLI}isPane(e){return e&&e.__ISPANE}log(...e){try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(t){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(a){console.log("Error adding to __LOG_BUFFER: ",arguments)}}console.log.apply(console,arguments)}registerEvent(e,t,a){try{this.PAssert(483,!this.aggregateEvents.hasOwnProperty(e),"Should only register an event once")}catch(r){this.reportError(r)}try{this.PAssert(484,void 0!==e,"Must specify a name for the event")}catch(r){this.reportError(r)}try{this.PAssert(485,void 0!==t,"Must specify a category for the event")}catch(r){this.reportError(r)}try{this.PAssert(486,void 0!==a,"Must specify an action for the event")}catch(r){this.reportError(r)}var i={category:t,action:a,label:this.getAnonUserIdentifier(),count:0};this.aggregateEvents[e]=i}aggregateEvent(e,t){try{this.PAssert(487,this.aggregateEvents.hasOwnProperty(e),"Must register an event before using it")}catch(a){this.reportError(a)}void 0===t&&(t=1),this.aggregateEvents[e]&&(this.aggregateEvents[e].count+=t)}UIAction(e){this.sendEvent("UIAction",e)}getAggregateEvents(){return this.aggregateEvents}getAnonUserIdentifier(){if(!this.anonID){var e=this.getUserIdentifier();this.anonID=e?e[0]+e[1]+e[2]+this.murmurhash3_32_gc(e,17124123):"loggedout"}return this.anonID}murmurhash3_32_gc(e,t){var a,i,r,s,n,o,l,d,h=0;for(a=3&e.length,i=e.length-a,r=t,n=3432918353,o=461845907,d=0;d<i;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;l=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24,++d,r=27492+(65535&(s=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*n+(((l>>>16)*n&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16)}switch(l=0,a){case 3:l^=(255&e.charCodeAt(d+2))<<16;case 2:l^=(255&e.charCodeAt(d+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(d)))*n+(((l>>>16)*n&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}hashString(e){try{this.PAssert(488,this.isString(e),"Must always be passing a string to hash")}catch(t){this.reportError(t)}return this.murmurhash3_32_gc(e,this.defaultSeed)}isDemoMode(){return!1}getUserIdentifier(){var e=this.getToolbox();return this.isDemoMode()?"demouser":e?e.settings.activeUser.get():"Missing toolbox"}beginCompleteAction(){this._isInCompleteAction=!0}isInCompleteAction(){return this._isInCompleteAction}endCompleteAction(){this._isInCompleteAction=!1}getObjectInfo(e){try{if(e&&e.constructor)return e.constructor.name}catch(t){this.reportError(t)}return typeof e}hasTimeoutOnce(e){return!!this.timeouts[e]}timeoutOnce(e,t,a,i,r,s,n,o){try{this.PAssert(489,e,"Must supply a valid name")}catch(d){this.reportError(d)}try{this.PAssert(490,this.isFunction(t),"must supply a valid cb fn")}catch(d){this.reportError(d)}try{this.PAssert(491,arguments.length<=8,"Too many args passed in")}catch(d){this.reportError(d)}var l=this.timeouts[e];l&&clearTimeout(l),this.timeouts[e]=setTimeout(()=>{delete this.timeouts[e],t(i,r,s,n,o)},a)}clearTimeoutOnce(e){var t=this.timeouts[e];t&&(clearTimeout(t),delete this.timeouts[e])}sendEvent(e,t,a){}objectValues(e){return Object.keys(e).map(t=>e[t])}trimRight(e){for(var t=0,a=e.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[a])break;e=e.substr(0,a)}return e}getToolbox(){return a(3).default}searchVMLIArray(e,t,a){for(var i=0,r=0;r<t.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t[r];if(!e.headers||s.showInOverview()){if(!e.comparator||e.comparator(s,e))if(e.each)if(!1===e.each(s,e))return!1;this.searchFromVMLI(s,e,a+1)}}}searchFromVMLI(e,t,a){a=a||0;var i,r=t.noCollapsed,s=t.pane,n=t.overview;t.includeNotes&&!t.headers&&e.hasNote()&&(t.comparator&&!t.comparator(e.getNote(),t)||t.each&&(i=t.each(e.getNote(),t))),!1===i||r&&0!==a&&e.isCollapsed(s,n)||(i=this.searchVMLIArray(t,e.items.get(),a))}searchVMLIs(e){try{this.PAssert(492,e,"Must supply a valid options param")}catch(a){this.reportError(a)}let t=this.getToolbox();try{if(e.itemStoreFilter)t.itemStoreManager.runForEachStore(t=>{var a=e.item,i=a&&a.belongsToItemStore(t)?a:t.getRoot();this.searchFromVMLI(i,e)},e.itemStoreFilter);else if(e.item){try{this.PAssert(493,!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(a){this.reportError(a)}this.searchFromVMLI(e.item,e)}else if(e.itemStore){try{this.PAssert(494,!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(a){this.reportError(a)}this.searchFromVMLI(e.itemStore.getRoot(),e)}else{try{this.PAssert(495,!1,"Must specify a valid search root, using the default root is deprecated")}catch(a){this.reportError(a)}t.itemStoreManager.getDefaultItemStore().getRoot()}}catch(i){this.reportError(i)}}clamp(e,t,a){return Math.max(t,Math.min(a,e))}pad2(e){return 1===(e=""+e).length?"0"+e:""+e}parseSubtree(e,t){var a=0;try{this.PAssert(496,e,"Must supply a valid item to parse")}catch(s){this.reportError(s)}this.runSingleParse(e,t);for(var i=e.getItems(),r=0;r<i.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.parseSubtree(i[r],t)}}runSingleParse(e,t){try{this.PAssert(497,e,"Must have a valid item to parse")}catch(a){this.reportError(a)}e.parseText("",t)}notifyActivity(){this.lastActivity=Date.now(),this.lowActivityTimer||(this.lowActivityTimer=setTimeout(this.checkLowActivity,2*this.activityThreshold)),this.whenLowImpactEnd()}checkLowActivity(){Date.now()-this.lastActivity>this.activityThreshold&&this.whenLowImpactBegin(),this.lowActivityTimer=void 0}whenLowImpactBegin(){this._isLowImpact||(this._isLowImpact=!0,u.a.fireEvent("lowImpactBegin",[]))}whenLowImpactEnd(){this._isLowImpact&&(u.a.fireEvent("lowImpactEnd",[]),this._isLowImpact=!1)}isLowImpact(){return this._isLowImpact}parseEvernoteLink(e){return e.startsWith("evernote:///view/")?{viewUrl:e}:(y.lastIndex=0,null!==(t=y.exec(e))?{shardId:t[1],userId:t[2],noteGuid:t[3]}:void 0);var t}isOneNoteLink(e){return e.startsWith("onenote:https://")}isBearLink(e){return e.startsWith("bear://x-callback-url/")}runDateRollover(){var e=this.getToolbox();try{this.PAssert(498,this.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(r){this.reportError(r)}var t=+this.scheduledDateRollover-Date.now();this.log("---- Running Date Rollover: "+t+" ----"),this.lastDateRollover=Date.now(),this.scheduledDateRollover=0,clearTimeout(this.dateRolloverTimeout),this.dateRolloverTimeout=void 0,this.setupDateRollover();let a=()=>{e.Measure.clearItemCache(),e.Measure.clearLineCache(),e.PaneUpdateBatcher.updateAllItems(!1,!0),e.timeline.updateNotifications(),this.log("-------------------------------")};if(Date.Parsing.Normalizer.buildReplaceData(),e.timeline.clearDailyCaches(),e.settings.syncContacts.get()){var i=setTimeout(()=>{a()},1e4);clearTimeout(i),i=void 0,a()}else a();u.a.fireEvent("dateChanged",[])}setupDateRollover(){try{this.PAssert(499,!this.dateRolloverTimeout,"Should never reschedule a date rollover over another one")}catch(a){this.reportError(a)}var e=new Date,t=+e.clone().addDays(1).clearTime();try{this.PAssert(500,t>+e,"Rollover time must be in the future")}catch(a){this.reportError(a)}try{this.PAssert(501,t>this.lastDateRollover,"Rollover time must be after the last rollover")}catch(a){this.reportError(a)}this.dateRolloverTimeout=setTimeout(this.runDateRollover,t-+e),this.scheduledDateRollover=t}ensureDateRollover(){setTimeout(()=>{var e=Date.now();this.scheduledDateRollover-e<0&&this.runDateRollover()},1e4)}ensureStatsXHR(e){var t=this.sanitizeURL(e).split("?")[0];return this.__xhrRequests[t]||(this.__xhrRequests[t]={requests:0,successes:0,retries:0,failures:0}),this.__xhrRequests[t]}notifyStatsXHRRequest(e){this.ensureStatsXHR(e).requests++}notifyStatsXHRSuccess(e){this.ensureStatsXHR(e).successes++}notifyStatsXHRRetry(e){this.ensureStatsXHR(e).retries++}notifyStatsXHRFailure(e){this.ensureStatsXHR(e).failures++}getXHRStats(){return this.__xhrRequests}sanitizeURL(e){return e.replace(/&?access_token=[^&]*/g,"")}generateQueryString(e){var t="";if("object"===typeof e){t=Object.keys(e).map(t=>void 0!==e[t]?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):"").join("&").replace(/%20/g,"+")}else{try{this.PAssert(502,"string"===typeof e,"Only Objects or Strings are currently supported")}catch(a){this.reportError(a)}t=e}return t}packedFnToString(e){for(var t=0,a="",i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a+=e[i]+"."}return a}unpackFn(e,t){try{this.PAssert(503,this.isFunction(e)||this.isArray(e),"Must supply either a valid function or packed function")}catch(s){this.reportError(s)}var a=NaN;if(this.isFunction(e))a=e;else if(e)try{var i=0;0,a=t||window;for(var r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;try{this.PAssert(504,this.isString(e[r]),"Packed fns must only contain strings: "+r)}catch(s){this.reportError(s)}try{this.PAssert(505,a,"Must be able to unpack each step in object chain: "+e[r]+" in "+this.packedFnToString(e))}catch(s){this.reportError(s)}if(!a){a=NaN;break}a=a[e[r]]}}catch(n){this.reportError(n),a=NaN}return a}encodeMIMEHeader(e){return"=?UTF-8?B?"+this.btoa(unescape(encodeURIComponent(e)))+"?="}utf8_to_b64(e){var t;try{t=this.btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_")}catch(a){this.reportError(a,e)}return t}b64_to_utf8(e){var t;try{t=decodeURIComponent(escape(this.atob(e.replace(/-/g,"+").replace(/_/g,"/"))))}catch(a){this.reportError(a,e)}return t}qp_to_utf8(e){var t;try{t=e.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,(e,t)=>{var a=parseInt(t,16);return String.fromCharCode(a)})}catch(a){this.reportError(a,e)}return t}isTextNode(e){return e&&3===e.nodeType}isWhiteSpace(e){return/^\s*$/.test(e)}isAncestor(e,t){var a=0;try{this.PAssert(506,e,"Must have a valid element")}catch(i){this.reportError(i)}try{this.PAssert(507,t,"Must have a valid candidate")}catch(i){this.reportError(i)}for(;e&&e!==t;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=e.parentNode}return!!e}isEmail(e){var t=!1;e&&((t=!!new RegExp(/\S+@\S+\.\S+/i).exec(e))&&(t=e.indexOf('"')<0));return t}intervalUntil(e){let t=0;if(!e()){let a=setInterval(()=>{t++,(e()||t>100)&&clearInterval(a)},0)}return!0}hasGoogleError(e,t,a){try{this.PAssert(508,e,"Must specify a valid result object")}catch(l){this.reportError(l)}try{this.PAssert(509,t,"Must specify a valid error domain")}catch(l){this.reportError(l)}try{this.PAssert(510,a,"Must specify a valid error reason")}catch(l){this.reportError(l)}var i=!1;if(e&&e.error&&e.errors)for(var r=0,s=e.error.errors,n=0;n<s.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=s[n];if(o.domain===t&&o.reason===a){i=!0;break}}return i}handleJSError(e,t,i,r){if(!e.message||!e.message.startsWith("Firebase Storage: Max retry time"))if(e){r||(r=s.a.LogLevels.Error);let i=this.getToolbox();if(i&&i.rollbar)try{var n=this.lastErrorsReported[e.stack];if(!n||n<Date.now()-5e3){var o=this.__LOG_BUFFER.ordered().join("\r\n"),l=i.settings?i.settings.getUserIdentifier():"No User Identifier";this.isRollbarConfigured||(i&&i.settings&&"me"!==l&&(this.isRollbarConfigured=!0),i.rollbar.configure({payload:{person:{id:l}},maxItems:s.a.__MAX_ERRORS_REPORTED,checkIgnore:this.rollbarIgnoreFn}));var d=this.parseExtra(t);if(this.numReported++,this.numReported<=s.a.__MAX_ERRORS_REPORTED){var h=a(187).default,c={};if(!this.isReporting){this.isReporting=!0;try{h.getAppInfo(c)}catch(p){}this.isReporting=!1}c.numReported=this.numReported;var u=Object.assign(this.getRollbarData(),{logs:o,info:c,user:l,extra:d});this.sendRollbar(e,u,r)}}this.lastErrorsReported[e.stack]=Date.now()}catch(e){this.log("Badness happened reporting errors to server: ",e);try{i.rollbar.error(e)}catch(g){this.log("More badness happened reporting errors to rollbar: ",g)}}}else console.log(e)}reportError(e,t,a,i){this.handleJSError(e,t,!1,a)}rollbarIgnoreFn(e,t,a){return!!(a&&a.body&&a.body.trace&&a.body.trace.frames&&a.body.trace.frames[0]&&_.indexOf(a.body.trace.frames[0].filename)>=0)}parseExtra(e){return e?this.safeStringify(e):void 0}isVowel(e){let t=e.toLowerCase();return"a"===t||"e"===t||"i"===t||"o"===t||"u"===t}forEachValue(e,t){Object.keys(e).forEach(a=>t(e[a]))}isHTTPStatusCode(e,t){return e&&e.error&&e.error.code===t}safeStringify(e){try{return JSON.stringify(e)}catch(t){0}}makeString(e){for(var t=0,a="",i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a+=" "+this.safeStringify(e[i])}return a}decodeHtmlEntity(e){return e.replace(/&#(\d+);/g,(e,t)=>String.fromCharCode(t)).replace(/<[^>]*>/g,"")}deepFreeze(e){return e}},r()(h.prototype,"parseBoolean",[g.a],Object.getOwnPropertyDescriptor(h.prototype,"parseBoolean"),h.prototype),r()(h.prototype,"parseDate",[g.a],Object.getOwnPropertyDescriptor(h.prototype,"parseDate"),h.prototype),r()(h.prototype,"cloneWithoutUndefineds",[g.a],Object.getOwnPropertyDescriptor(h.prototype,"cloneWithoutUndefineds"),h.prototype),r()(h.prototype,"checkLowActivity",[g.a],Object.getOwnPropertyDescriptor(h.prototype,"checkLowActivity"),h.prototype),r()(h.prototype,"runDateRollover",[g.a],Object.getOwnPropertyDescriptor(h.prototype,"runDateRollover"),h.prototype),h),b=a(16),D=a(5),w=a(71),E=a.n(w),C=a(469);!function(e){e[e.None=0]="None",e[e.Item=1]="Item",e[e.Element=2]="Element"}(P||(P={}));var A=[0,5,15,35,80,170,400,1200],M=[0,408,429,500,502,503,504];let T=(S=class extends I{constructor(){super(),window.__infLoop=this.infLoop,this.vmMain=void 0,this.isShowingLogin=new p.a(!1),this.archivedPadding=34,this.itemTransitionTime=100,this.scrollbarWidth=12,this.hasFocus=!0,this.demoMode=!1,this.focusedPane=void 0,this.focusedItem=void 0,this.ClickThreshold=5,this.isReconnected=!1,this.isBlocked=!1,this.blockedMessage="",this.authImmediateFailed=!1,this.authUserLoggedIn=!1,this.noLocalWritesReason=s.a.LocalWriteReason.Enabled,this.isLoadingRemote=!1,this.isSendingEmail=!1,this.isSavingDrafts=!1,this.isKeyboardOpen=!1,this.itemMenuOpenedOn=void 0,this.errorPlatformInfo=void 0,this.elements={},this.MobileSideTapThreshold=40,this.MobileSideTapThresholdKeyboardOpen=15,this.colorBlue="#09d",this.colorLightBlue="#02b1ff",this.colorRed="#d43",this.colorLightRed="#f34433",this.MinItemWidth=50,this.paneTop=D.a.app?20:0,this.activeDisplayMode=s.a.DisplayMode.Default,this.eventStream=new d.a(25),this.currentFindPass=0,this.scrollTimeouts={},this.scrollState={speedPane:0,pane:void 0,speedPanes:0,panes:!1},this.keyboardDestination=P.None,this.keyboardOpenedOn=void 0,this.keyboardBlurFn=void 0,this.keyboardStartScrollOffset=0,this.downloadToasts=[],this.numLastLoop=-1,this.timeLastLoop=void 0,window.onerror=this.onWindowError,this.wrapAsyncCallbacks(),this.wrapXHR(),D.a.demo&&this.enableDemoMode()}addDevFunctions(){let e=window;e.__globals=()=>this;var t=1;this.shouldLog(s.a.LogLevels.Input)&&(e.__eventBuffer=new d.a(100)),this.tagEvent=(a,i,r)=>{a.id||(a.id=t++,this.shouldLog(s.a.LogLevels.Input)&&e.__eventBuffer.push(a)),this.shouldLog(s.a.LogLevels.Input)&&(a.activeHandler={owner:i,fn:r},a.handlers?a.handlers.push(a.activeHandler):a.handlers=[a.activeHandler])},this.Assert=(...t)=>{if(!t[0])try{t.length>1?e.__error.apply(console,t.slice(1)):e.__error("Assert Failure!")}catch(a){e.__error("Problem reporting Assert!")}},this.DAssert=e=>{e||this.log("Debug ONLY assert was hit.")},e.__getXHRStats=this.getXHRStats}_dbgCatch(e){var t=Array.prototype.slice.call(arguments,1);try{if(e)return e.apply(void 0,t)}catch(a){this.reportError(a,t)}}fnCatch(e){try{this.PAssert(28,e,"Must specify a callback")}catch(t){this.reportError(t)}return this._dbgCatch.bind(this,e)}getTransitionClass(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t}setTransformStyle(e,t,a){try{this.PAssert(29,e,"Must provide a valid element")}catch(i){this.reportError(i)}if(e){try{this.PAssert(30,void 0!==t,"Must supply a valid X offset")}catch(i){this.reportError(i)}try{this.PAssert(31,void 0!==a,"Must supply a valid Y offset")}catch(i){this.reportError(i)}D.a.ie?e.style[D.a.transform.style]="translate("+t+"px, "+a+"px)":e.style[D.a.transform.style]="translate3d("+t+"px, "+a+"px, 0px)"}}setTransitionStyle(e,t,a,i){try{this.PAssert(32,e,"Must provide a valid element")}catch(r){this.reportError(r)}e&&(i=i||"ease",e.style[D.a.transition.style]=t+" "+a+"ms "+i,setTimeout(()=>{e.style[D.a.transition.style]=""},a))}setTransform(e,t,a,i,r){i>0?(this.setTransitionStyle(e,D.a.transform.prop,i,r),this.setTransformStyle(e,t,a)):t||a?this.setTransformStyle(e,t,a):e.style[D.a.transform.style]="none"}reload(e){window.location.reload(e)}parseTokensFromText(e){for(var t,a=0,i=[],r=/(?:(?:[\"]([^\"<>]*)[\"]\s))|(?:([^\",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,s=0;null!==(t=r.exec(e));){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e.substring(s,t.index),o=t[1]||t[2],l=t[3]||t[5];s=r.lastIndex,n&&n.trim().length>0&&i.push({text:n,type:"text"}),i.push({text:o||l,email:l,type:"contact"})}var d=e.substring(s,e.length);return d&&d.length>0&&i.push({text:d,type:"text"}),i}isRunningScript(){return this.AScript&&this.AScript.isRunning}preventLocalWrites(e){try{this.PAssert(33,!this.noLocalWrites,"Should only disable local writes once")}catch(t){this.reportError(t)}try{this.PAssert(34,e>=0,"Must provide a valid reason for disabling local writes")}catch(t){this.reportError(t)}this.isDemoMode()||this.shouldLog(s.a.LogLevels.Warning)&&this.log("---- WARNING: Local Writes Disabled ----"),this.noLocalWrites=!0,this.noLocalWritesReason=e}enableDemoMode(){this.demoMode=!0;var e=b.a.getURLParam("dmode");e&&this.enableMinMode(e),this.preventLocalWrites(s.a.LocalWriteReason.DemoMode)}isDemoMode(){return this.demoMode}isDisplayModeActive(e){return(this.activeDisplayMode&e)===e}isDemoInIframe(){return this.isDisplayModeActive(s.a.DisplayMode.InIframe)}enableMinMode(e){let t=this.getToolbox();try{if(this.addClass(document.body,"minMode"),this.isMinMode=!0,e=this.parseInt(e),D.a.touch||(e&s.a.DisplayMode.InIframe&&this.addClass(document.documentElement,"inIframe"),e&s.a.DisplayMode.Invisible&&this.addClass(document.documentElement,"invisible"),e&s.a.DisplayMode.NoPaneHeaders&&this.addClass(document.body,"noPaneHeaders"),e&s.a.DisplayMode.NoMinPaneSize&&(this.minPaneWidth=0),e&s.a.DisplayMode.NoPaneStyle&&this.addClass(document.body,"noPaneStyle")),e&s.a.DisplayMode.NoPanePadding&&(this.addClass(document.body,"noPanePadding"),this.noPanePadding=!0),e&s.a.DisplayMode.NoScrollbars&&(this.noScrollbars=!0),e&s.a.DisplayMode.NoBackground&&this.addClass(document.documentElement,"noBackground"),e&s.a.DisplayMode.NoInteraction){var a=document.getElementById("outerWrapper"),i=document.createElement("div");i.id="preventInteraction",a.appendChild(i),e&s.a.DisplayMode.PromptStart&&this.setupClick(i,i,()=>{var e=t.toasts.getMessageById(s.a.MessageID.PromptScriptStart);e&&(e.doAction(),e.hide())})}e&s.a.DisplayMode.ShowDemoExit&&setTimeout(()=>{t.toasts.pushMessage(s.a.MessageID.ExitDemo)},0),e&s.a.DisplayMode.PromptStart&&setTimeout(()=>{t.toasts.pushMessage(s.a.MessageID.PromptScriptStart)},0),this.activeDisplayMode=e}catch(r){this.reportError(r)}}hasClass(e,t,a){try{this.PAssert(35,e,"Must pass in a valid element")}catch(n){this.reportError(n)}if(e.classList)for(var i=0,r=Array.prototype.slice.call(arguments,1),s=0;s<r.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.classList.contains(r[s]))return!0}return!1}removeClass(e,t){try{this.PAssert(36,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.remove(t)}addClass(e,t){try{this.PAssert(37,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.add(t)}toggleClass(e,t){try{this.PAssert(38,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.toggle(t)}findChild(e,t){try{this.PAssert(39,e,"Must pass in a valid element")}catch(n){this.reportError(n)}if(e)for(var a=0,i=0;i<e.childElementCount;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e.children[i];if(this.hasClass(r,t))return r;var s=this.findChild(r,t);if(s)return s}}setupClick(e,t,a){try{this.PAssert(40,e,"Expecting an object to bind the click handlers to.")}catch(k){this.reportError(k)}try{this.PAssert(41,t,"Must specify a valid owner for click handlers")}catch(k){this.reportError(k)}this.shouldLog(s.a.LogLevels.Input)&&this.log("SetupClick: "+this.elementToString(e)),t||(t=e);var i=this,r=!1;let n,o,l,d,h,c,u,p,g,f,m,v,y,_;this.isFunction(a)?a={onClick:a}:a&&a.useCapture&&(r=a.useCapture);var S=(e,r)=>{try{i.PAssert(42,!t.isDestroyed||!t.isDestroyed()||"onMove"===e||"onEnd"===e,"Owner must not be destroyed to handle a click")}catch(k){i.reportError(k)}return a[e].call(t,r)},P=e=>{i.shouldLog(s.a.LogLevels.Input)&&this.log("Move: ",e.id);var t=e.eventX-n,r=e.eventY-o;if(0!==t||0!==r){var m=!h;if(n=e.eventX,o=e.eventY,e.distanceX=l+=Math.abs(t),e.distanceY=d+=Math.abs(r),(h||e.distanceX>this.ClickThreshold||e.distanceY>this.ClickThreshold)&&(h=!0,e.moved=h),a.onMove||a.onFirstMove)if(e.diffX=e.eventX-c,e.diffY=e.eventY-u,e.xThisFrame=t,e.yThisFrame=r,e.startX=c,e.startY=u,e.startClientX=p,e.startClientY=g,e.startSrc=f,m&&a.onFirstMove&&S("onFirstMove",e),a.onMove)S("onMove",e)&&e.stopImmediatePropagation()}},I=t=>{i.shouldLog(s.a.LogLevels.Input)&&i.log("End: ",t.id,i.elementToString(t.target),i.elementToString(e));var r=Date.now();m=m||r;var l=Math.max(0,r-m);v?v++:v=1,t.moved=h,t.timeDelta=l,t.diffX=n-c,t.diffY=o-u,t.startX=c,t.startY=u,t.startSrc=f,f=void 0,l<s.a.DoubleClickTime&&l>0&&a.onDoubleClick&&!h&&S("onDoubleClick",t),isNaN(t.button)||t.button===s.a.ButtonCode.Left?(m=r,!a.onClick||h||D.a.mac&&t.ctrlKey||S("onClick",t),a.onEnd&&S("onEnd",t)):t.button===s.a.ButtonCode.Middle&&a.onMiddleClick&&!h&&S("onMiddleClick",t),setTimeout(()=>{m=void 0,v=void 0},s.a.DoubleClickTime)},b=t=>{i.shouldLog(s.a.LogLevels.Input)&&i.log("Start: ",t.id,i.elementToString(t.target),i.elementToString(e)),t.timeStart=y=Date.now(),f=t.target,t.startSrc=t.target,h=!1,t.startX=c=t.eventX,t.startY=u=t.eventY,t.startClientX=p=t.clientX,t.startClientY=g=t.clientY,n=t.eventX,o=t.eventY,l=0,d=0,(isNaN(t.button)||t.button===s.a.ButtonCode.Left||t.button===s.a.ButtonCode.Right)&&((isNaN(t.button)||t.button===s.a.ButtonCode.Left)&&a.onStart?S("onStart",t):t.button===s.a.ButtonCode.Right&&a.onRightStart&&S("onRightStart",t)),isNaN(t.changeLastY)||(o+=t.changeLastY)},w=this.fnCatch(t=>{if(!t.handled){i.shouldLog(s.a.LogLevels.Input)&&i.log("TouchStart: ",t.id,i.elementToString(t.target),i.elementToString(e)),_=!0;var a=D.a.ie?t:t.touches[0];return t.eventX=a.pageX,t.eventY=a.pageY,t.clientX=a.clientX,t.clientY=a.clientY,b.call(e,t),t.ignore||(document.addEventListener(D.a.touchMoveEvent,E,r),document.addEventListener(D.a.touchEndEvent,C,r),document.addEventListener(D.a.touchCancelEvent,A,r)),!t.returnFalse&&void 0}}),E=this.fnCatch(t=>{var a=D.a.ie?t:t.touches[0];if(t.eventX=a.pageX,t.eventY=a.pageY,t.clientX=a.clientX,t.clientY=a.clientY,P.call(e,t),t.returnFalse)return!1}),C=this.fnCatch(t=>{i.shouldLog(s.a.LogLevels.Input)&&i.log("TouchUp: ",t.id,i.elementToString(t.target),i.elementToString(e)),document.removeEventListener(D.a.touchMoveEvent,E,r),document.removeEventListener(D.a.touchEndEvent,C,r),document.removeEventListener(D.a.touchCancelEvent,A,r);var a=D.a.ie?t:t.changedTouches[0];if(t.eventX=a.pageX,t.eventY=a.pageY,t.clientX=a.clientX,t.clientY=a.clientY,I.call(e,t),t.returnFalse)return!1}),A=this.fnCatch(t=>{if(i.shouldLog(s.a.LogLevels.Input)&&i.log("TouchCancel: ",t.id,i.elementToString(t.target),i.elementToString(e)),document.removeEventListener(D.a.touchMoveEvent,E,r),document.removeEventListener(D.a.touchEndEvent,C,r),document.removeEventListener(D.a.touchCancelEvent,A,r),(t=>{i.shouldLog(s.a.LogLevels.Input)&&i.log("Cancel: ",t.id,i.elementToString(t.target),i.elementToString(e)),a.onCancel&&S("onCancel",t)}).call(e,t),t.returnFalse)return!1}),M=this.fnCatch(t=>{if(!t.handled&&!_)return i.shouldLog(s.a.LogLevels.Input)&&i.log("MouseDown: ",t.id,i.elementToString(t.target),i.elementToString(e)),_=!1,t.eventX=t.pageX,t.eventY=t.pageY,b.call(e,t),t.ignore||(t.button===s.a.ButtonCode.Left&&document.addEventListener(D.a.moveEvent,T,r),document.addEventListener(D.a.upEvent,L,r)),!t.returnFalse&&void 0}),T=this.fnCatch(t=>{if(!_)return t.eventX=t.pageX,t.eventY=t.pageY,P.call(e,t),!t.returnFalse&&void 0}),L=this.fnCatch(t=>{if(!t.handled&&!_)return i.shouldLog(s.a.LogLevels.Input)&&i.log("MouseUp: ",t.id,i.elementToString(t.target),i.elementToString(e)),document.removeEventListener(D.a.moveEvent,T,r),document.removeEventListener(D.a.upEvent,L,r),t.button===s.a.ButtonCode.Left&&I.call(e,t),!t.returnFalse&&void 0}),x=this.fnCatch(t=>{t.handled||_||(i.shouldLog(s.a.LogLevels.Input)&&i.log("ContextMenu: ",t.id,i.elementToString(t.target),i.elementToString(e)),a.onRightClick&&S("onRightClick",t))});return D.a.isTouchDevice?e.addEventListener(D.a.touchStartEvent,w,r):e.addEventListener(D.a.downEvent,M,r),a.onRightClick&&e.addEventListener("contextmenu",x,r),this}isDOMNode(e){return"HTMLElement"in window?e instanceof HTMLElement:e&&e.tagName&&e.nodeType===Node.ELEMENT_NODE}ensureDOMNode(e){var t;return this.isDOMNode(e)?t=e:this.isTextNode(e)&&(t=e.parentElement),t}enumToString(e,t){for(var a in e)if(e[a]===t)return a;return null}elementToString(e,t){if(e){var a=e.nodeName;return e.id&&(a+="#"+e.id),e.className&&(a+="."+e.className.replace(/ /g,".")),t&&e.innerText&&(a+=":"+e.innerText.length),a}return"UNDEFINED"}getElementPath(e,t){var a=!0,i="";try{for(var r=0;e&&"container"!==e.id&&e!==document.documentElement&&e!==document.body;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i+=a?this.elementToString(e,t)+" ":this.elementToString(e)+" ",a=!1,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e.parentElement}}catch(s){i+=s.message}return i}setDimension(e,t){window.ga&&!this.isDemoMode()&&ga("set",e,t)}sendEvent(e,t,a){try{this.PAssert(44,void 0===a||this.isNumber(a),"Values must be numeric")}catch(i){this.reportError(i)}if(window.ga&&!this.isDemoMode())try{ga("send","event",e,t,this.getAnonUserIdentifier(),a)}catch(r){this.reportError(r,"Category: "+e+" Action: "+t+" Value: "+a)}}sendToGoogle(e,t){var a="//www.googleadservices.com/pagead/conversion/976910954/?label="+e+"&guid=ON";t&&(a+="&value="+t+"&currency_code=USD"),new Image(1,1).src=a}sendToFacebook(e,t){new Image(1,1).src="//www.facebook.com/tr?id=118704468840748&ev=PageView"}reportAdConversion(e,t){try{this.sendToGoogle(e,t)}catch(a){this.reportError(a)}try{this.sendToFacebook(e,t)}catch(a){this.reportError(a)}}pageDataCleared(){this.isPageDataCleared=!0}hasPageDataBeenCleared(){return this.isPageDataCleared}findFirstDiff(e,t,a,i){var r=0;if(!e)return i?0:t.length;if(!t)return i?e.length:0;for(var s=Math.min(e.length,t.length),n=0;n<s;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a){if(e.charAt(n).toLowerCase()!==t.charAt(n).toLowerCase())return n}else if(e.charAt(n)!==t.charAt(n))return n}return i?e.length:t.length}lerp(e,t,a){return e+(t-e)*a}hashCode(e){var t,a=0,i=0;if(0===e.length)return i;for(t=0;t<e.length;t++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=(i<<5)-i+e.charCodeAt(t),i|=0}return i}sanitizePaneState(e){try{for(var t=0,a=JSON.parse(JSON.stringify(e)),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;""!==a[i].search&&(a[i].search="HasSearch")}return JSON.stringify(a)}catch(r){return"Failed to sanitize pane state"}}sanitizeLocalSettings(e){try{var t=JSON.parse(e);return delete t.values.Default.paneState,delete t.values.Default.localPaneState,delete t.values.Default.gdocTitle,t}catch(a){return"Failed to parse settings"}}sanitizeKey(e){switch(e){case s.a.KeyCode.Backspace:return"BACKSPACE";case s.a.KeyCode.Delete:return"DELETE";case s.a.KeyCode.Enter:return"ENTER";case s.a.KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}getLoadedScripts(e){try{for(var t=0,a=document.getElementsByTagName("script"),i=[],r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[r];s.src&&i.push(s.src)}e.loadedScripts=i}catch(n){e.loadedScripts="ERROR: "+n.message}}getExtraReportData(e){e.platformConfig=D.a.getUserPlatformConfig()}criticalErrorReported(){return this.hasCriticalError}handleCriticalError(){this.hasCriticalError=!0;try{this.isDemoMode()?this.reload():(document.body.innerHTML=`<div class="centerVHFlex">There was a critical error while loading Moo.do. ${D.a.actionVerb().capitalize()} to reload.</div>`,D.a.isTouchDevice?document.body.addEventListener(D.a.touchStartEvent,()=>{this.reload()},!0):document.body.addEventListener(D.a.upEvent,()=>{this.reload()},!0))}catch(e){this.reportError(e)}}reportEvent(e){if(!this.isDemoMode()){var t=this.parseExtra(e);t&&this.eventStream.push(t)}}getEventStream(){return this.eventStream.ordered()}parseExtra(e){var t;if(e)try{var a;if(e instanceof KeyboardEvent){var i=this.elementToString(e.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(i)<0&&(a={type:e.type,currentTarget:this.elementToString(e.currentTarget),target:i,keyCode:this.sanitizeKey(e.keyCode),normCode:this.sanitizeKey(e.normCode),ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()})}else if(e instanceof MouseEvent)a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof TouchEvent){a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};var r=e.touches[0];r&&(a.clientX=r.clientX,a.clientY=r.clientY)}else if(window.PointerEvent&&e instanceof PointerEvent)a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof Event)a={type:e.type,name:e.name,code:e.code,message:e.message,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};else if(e instanceof Selection)if(0===e.rangeCount)a={rangeCount:0};else{var s=e.getRangeAt(0),n=s.startContainer,o=!1,l=s.endContainer,d=!1;n.nodeType===Node.TEXT_NODE&&(n=n.parentNode,o=!0),l.nodeType===Node.TEXT_NODE&&(l=l.parentNode,d=!0),a={rangeCount:e.rangeCount,startContainer:this.getElementPath(n),startWasTextNode:o,startOffset:s.startOffset,endContainer:this.getElementPath(l),endWasTextNode:d,endOffset:s.endOffset}}else a=e;t=a?this.safeStringify(a):void 0}catch(h){this.log("Error parsing extra "+h.message)}return t}handleJSError(e,t,a,i){!a&&window.__error&&window.__error("JS Error: "+e.message,"  Stack: ",e.stack,"  Extra: ",t),super.handleJSError(e,t,a,i)}onWindowError(e,t,a,i,r){r?(this.log("Reported Global OnError: "+e+" Script: "+t+" Line: "+a+" Column: "+i),this.reportError(r)):(this.log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+a+" Column: "+i),this.reportError(e))}checkpoint(e){window.__checkpoints|=e}wrapFn(e,t){let a=this;return function(){try{return e.apply(this,arguments)}catch(i){i&&"auth/network-request-failed"===i.code||(a.reportError(i),t&&t(i))}}}wrapAsyncCallbacks(){var e=this,t=function(t){var a=window[t];window[t]=function(){let t=Array.prototype.slice.call(arguments);var i=t[0];return"function"===typeof i&&(t[0]=e.wrapFn(i)),a.apply?a.apply(this,t):a(t[0],t[1])}};t("setTimeout"),t("setInterval")}mergeObjects(e,t){var a;return Array.isArray(t)?(a=(a=[]).concat(e=e||[]),t.forEach((t,i)=>{"undefined"===typeof a[i]?a[i]=t:"object"===typeof t?a[i]=this.mergeObjects(e[i],t):-1===e.indexOf(t)&&a.push(t)})):(a={},e&&"object"===typeof e&&Object.keys(e).forEach(t=>{a[t]=e[t]}),Object.keys(t).forEach(i=>{"object"===typeof t[i]&&t[i]&&e[i]?a[i]=this.mergeObjects(e[i],t[i]):a[i]=t[i]})),a}readyStateCallback(e,t,a){e.onloadDone=!1,e.onload=()=>{e.onloadDone=!0,t&&t()},e.onreadystatechange=()=>{"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())},a&&(e.onerror=a)}createPath(e){return window.location.protocol+"//"+window.location.host+"/"+e}addScript(e,t,a,i){try{this.PAssert(45,!t||null===document.getElementById(t),"Should never include the same script ID multiple times")}catch(s){this.reportError(s)}var r=document.createElement("script");r.src=e,t&&(r.id=t),a&&this.readyStateCallback(r,a,i);try{this.PAssert(46,"undefined"!==typeof r,"Should always be able to create a valid script object")}catch(s){this.reportError(s)}"undefined"!==typeof r&&document.getElementsByTagName("head")[0].appendChild(r)}addScriptHack(e,t,a,i){window.define||(window.define={}),this.addScript(e,t,()=>{window.define.amd={jQuery:!0},a&&a()},()=>{window.define.amd={jQuery:!0},i&&i()})}addStylesheet(e,t,a){var i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,t&&this.readyStateCallback(i,t,a),"undefined"!==typeof i&&document.getElementsByTagName("head")[0].appendChild(i)}DAssert(e,t){}PAssert(e,t){if(!t){var a={isAssert:!0,tag:e};try{let t=Array.prototype.slice.call(arguments,2),r=this.makeString(t.map(e=>this.isFunction(e)?e():e));arguments.length>2?this.log("Assert Failure "+e+": "+r):this.log("Assert Failure "+e),this.reportError(new Error("Assert Failure: "+r),a,s.a.LogLevels.Warning)}catch(i){this.log("Exception in PAssert "+e+": ",i),this.reportError(i,a)}}}getElementParent(e){var t=0;for(0;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"item")||this.hasClass(e,"paneHiddenInput"))return e;e=e.parentNode}}isItemValidForPass(e,t){return!!e&&(t?e.lastFindPass===this.currentFindPass:e.lastFindPass<this.currentFindPass)}markItemForPass(e,t){if(e){var a=this.isItemValidForPass(e,t);try{this.PAssert(48,a,"Item should always be valid")}catch(i){this.reportError(i)}return e.lastFindPass=this.currentFindPass,a}return!1}getPreviousItem(e,t,a){return this.currentFindPass++,this._getPreviousItem(e,t,a)}_getPreviousItem(e,t,a){var i;var r=a&&a.isTest,s=a&&a.ignoreSearch,n=a&&a.sameLevel,o=a&&a.includeNotes;if(this.markItemForPass(e,r)){var l=e.parent();if(l){if(e.isNote())return e.parent();var d=l.getChildIndex(e);if(d>0)for(var h=0;!i;){var c=0;if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;for(var u=!1,p=d-1;p>=0;p--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var g=l.getChild(p);if(!this.markItemForPass(g,r)){try{this.PAssert(50,!1,"Invalid child found during findPreviousItem")}catch(f){this.reportError(f)}return}if(n||!g.hasChildren()||t&&g.isCollapsed(t,!1)){if(s||!t||!g.isHidden(t,!1)){i=g,u=!0;break}}else if(s||!t||!g.isHidden(t,!1)){l=g,d=g.numChildren(),u=!0;break}}if(n)break;u||(i=l)}else n||(i=e.parent());o&&i&&i.hasNote()&&(i=i.getNote());try{this.PAssert(51,!n||!i||i.parent()===e.parent(),"Previous item must share the same parent")}catch(f){this.reportError(f)}try{this.PAssert(52,r||!i||t&&i.isCollapsed(t,!1)||e===this._getNextItem(i,t,{isTest:!0,ignoreSearch:s,sameLevel:n}),"Previous/Next should always match")}catch(f){this.reportError(f)}return i}}}getNextItem(e,t,a){return this.currentFindPass++,this._getNextItem(e,t,a)}_getNextItem(e,t,a){var i,r=0;var s=a&&a.isTest,n=a&&a.ignoreSearch,o=a&&a.sameLevel,l=a&&a.includeNotes;if(e){if(l&&e.hasNote())return e.getNote();if(e.isNote()&&(e=e.parent()),!o&&e.hasChildren()&&(!t||!e.isCollapsed(t,!1))){var d=0,h=e.numChildren();for(let r=0;r<h;++r){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var c=e.getChild(r);if(!this.markItemForPass(c,s)){try{this.PAssert(54,!1,"Invalid child found during findNextItem A")}catch(m){this.reportError(m)}return}if(n||!t||!c.isHidden(t,!1)){i=c,a&&a.numLevels++;break}}}for(var u=e;!i;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!this.markItemForPass(u,s)){try{this.PAssert(55,!1,"Invalid parent found during findNextItem B")}catch(m){this.reportError(m)}break}var p=u.parent();if(!p)break;var g=p.getChildIndex(u);h=p.numChildren();if(!t||!p.isCollapsed(t,!1)){var f=0;for(let e=g+1;e<h;++e){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;c=p.getChild(e);if(!this.markItemForPass(c,s)){try{this.PAssert(57,!1,"Invalid child found during findNextItem C")}catch(m){this.reportError(m)}return}if(n||!t||!c.isHidden(t,!1)){i=c;break}}}if(u=p,a&&!i&&a.numLevels--,o||t&&u===t.getItem())break}try{this.PAssert(58,!o||!i||i.parent()===e.parent(),"Next item must share the same parent")}catch(m){this.reportError(m)}try{this.PAssert(59,s||!i||e===this._getPreviousItem(i,t,{isTest:!0,ignoreSearch:n,sameLevel:o}),"Previous/Next should always match")}catch(m){this.reportError(m)}return i}}easeOut(e,t,a){return-a*e*(e-2)+t}scrollTo(e,t,a,i,r){try{this.PAssert(60,void 0!==e||void 0!==t,"Must be scrolling something")}catch(u){this.reportError(u)}try{this.PAssert(61,void 0===e||this.isNumber(e),"Must provide a valid scrollPosX")}catch(u){this.reportError(u)}try{this.PAssert(62,void 0===t||this.isNumber(t),"Must provide a valid scrollPosY")}catch(u){this.reportError(u)}try{this.PAssert(63,this.isNumber(a),"Must provide a valid duration")}catch(u){this.reportError(u)}try{this.PAssert(64,this.isDOMNode(i),"Must provide a valid element to scroll")}catch(u){this.reportError(u)}try{this.PAssert(65,!r||this.isFunction(r),"Must provide a valid scrollDone callback")}catch(u){this.reportError(u)}var s=i.getAttribute("data-moo-id")||i.id;try{this.PAssert(66,s,"Should only scroll elements with ids")}catch(u){this.reportError(u)}if(this.scrollTimeouts[s]&&(cancelAnimationFrame(this.scrollTimeouts[s]),delete this.scrollTimeouts[s]),i)if(a>0){if(void 0!==e)var n=i.scrollLeft,o=e-n;if(void 0!==t)var l=i.scrollTop,d=t-l;var h;if(Math.abs(o)>0||Math.abs(d)>0){0;var c=u=>{h||(h=u-20);var p=Math.min((u-h)/a,1);if(void 0!==e){var g=this.easeOut(p,n,o);i.scrollLeft=g}if(void 0!==t){var f=this.easeOut(p,l,d);i.scrollTop=f}1===p?(delete this.scrollTimeouts[s],r&&r()):this.scrollTimeouts[s]=requestAnimationFrame(c)};this.scrollTimeouts[s]=requestAnimationFrame(c)}}else i&&(void 0!==e&&(i.scrollLeft=e),void 0!==t&&(i.scrollTop=t)),r&&r();else this.reportError(new Error("Must specify an element to scroll to"))}computeScrollSpeed(e,t,a,i,r){var s=(t-e-(t-(a=this.clamp(a,e,t))))/(t-e);return r<0&&(s-=1),s*i}performScroll(){if(this.scrollState.pane||this.scrollState.panes){var e;if(this.scrollState.pane){let t=6*this.scrollState.speedPane;e=this.scrollState.pane.addScrollDelta(t)}else{let t=6*this.scrollState.speedPanes,a=this.element("panes"),i=a.scrollLeft;a.scrollLeft+=t,e=i!==a.scrollLeft}e?requestAnimationFrame(this.performScroll):this.cancelRepeatScroll(this.scrollState.pane?"pane":"panes")}}repeatScroll(e,t,a,i){try{this.PAssert(67,i||a&&!this.isString(a),"Must pass a valid pane object to repeatScroll")}catch(r){this.reportError(r)}this.scrollState["speed"+(a?"Pane":"Panes")]=t,(this.scrollState.pane||this.scrollState.panes)&&a===this.scrollState.pane||(this.scrollState.pane=a,this.scrollState.panes=i,requestAnimationFrame(this.performScroll))}cancelRepeatScrolls(){this.scrollState.pane=void 0,this.scrollState.panes=void 0}cancelRepeatScroll(e){this.scrollState[e]=void 0}elementInPane(e){if(e){var t=0;for(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"pane")||this.hasClass(e,"paneOverview"))return!!e;e=e.parentElement}}return!1}elementInPaneEdit(e){var t=!1,a=this.getPaneForElement(e);return a&&this.isAncestor(e,a.getContentElement())&&(t=!0),t}elementInNonPaneEdit(e){var t=!1;if(e&&(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),!this.elementInPaneEdit(e)))for(var a=0;e;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.isKeyboardInputElement(e)){t=!0;break}e=e.parentElement}return t}isNonPaneDropTarget(e){var t=!1;return this.elementInNonPaneEdit(e)?t=!0:this.findParent(e,"validDropTarget")&&(t=!0),t}scrollIntoView(e,t,a){try{this.PAssert(68,this.isDOMNode(e),"Must supply a valid DOM node to scroll into view")}catch(c){this.reportError(c)}try{this.PAssert(69,this.isNumber(t)&&t>=0,"Must supply a valid scroll duration")}catch(c){this.reportError(c)}try{this.PAssert(70,!a||this.isFunction(a),"Callback must be a function")}catch(c){this.reportError(c)}try{this.PAssert(71,!this.getListCellForElement(e),"Use methods on VMPane to scroll VMLIs")}catch(c){this.reportError(c)}var i=!1;if(e){var r=this.findParent(e,"scroller")||this.findParent(e,"fancyScrollContent")||this.findParent(e,"fancyScroller");try{this.PAssert(72,r,"Every element must be a child of a scroller to be able to scroll it into view")}catch(c){this.reportError(c)}try{this.PAssert(73,!this.hasClass(r,"customScroller"),"Must not be scrolling this way, use methods on VMPane instead")}catch(c){this.reportError(c)}if(r){var s,n=r.getBoundingClientRect(),o=n.bottom,l=e.getBoundingClientRect(),d=Math.min(l.bottom,l.top+80),h=r.scrollTop;l.top<n.top?s=h+l.top-n.top:d>o&&l.top>n.top&&(s=h+d-o),void 0!==s&&(this.scrollTo(void 0,s,t,r,a),i=!0)}}return i}isKeyboardInputElement(e){if(e){if("checkbox"===e.type)return!1;if("INPUT"===e.nodeName||"textarea"===e.type||this.findParentAttr(e,"contenteditable","true"))return!0}return!1}blurActiveElement(e){this.ignoreSelectionChange=!!e,this.shouldLog(s.a.LogLevels.Selection)&&this.log("Blur Active Element"),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),setTimeout(()=>{this.ignoreSelectionChange=!1},100)}trimString(e){for(var t=0,a=/\s/,i=(e=e.replace(/^\s\s*/,"")).length;a.test(e.charAt(--i));)if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;return e.slice(0,i+1)}preventAndStop(e){this.preventDefault(e),this.stopPropagation(e)}preventDefault(e){if(e&&e.preventDefault)e.preventDefault();else try{this.PAssert(74,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}stopPropagation(e){if(e&&e.stopPropagation)e.stopPropagation();else try{this.PAssert(75,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}preventClick(){this.addClass(this.element("outerWrapper"),"noClick"),window.ontouchstart=this.preventDefault,requestAnimationFrame(()=>{window.ontouchstart=void 0,this.removeClass(this.element("outerWrapper"),"noClick")})}loadXML(e){try{let r=window;if("undefined"!==typeof r.DOMParser)return(new r.DOMParser).parseFromString(e,"text/xml");if("undefined"!==typeof r.ActiveXObject&&new r.ActiveXObject("Microsoft.XMLDOM")){var t=new r.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}try{this.PAssert(76,!1,"No XML parser found")}catch(a){this.reportError(a)}return}catch(i){return void this.reportError(i)}}getPluginForElement(e){return this.findParent(e,"plugin",4)}findParentInItem(e,t){for(var a=0;e&&!this.hasClass(e,"item");){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.hasClass(e,t))return e;e=e.parentNode}}findParent(e,t,a){try{this.PAssert(77,e,"Must pass in a valid element")}catch(n){this.reportError(n)}if(a||(a=1e3),e)for(var i=0,r=e,s=0;s<a&&r;++s,r=r.parentNode){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this.hasClass(r,t))return r}}findParentID(e,t,a){try{this.PAssert(79,e,"Must pass in a valid element")}catch(n){this.reportError(n)}if(a||(a=1e4),e)for(var i=0,r=e,s=0;s<a&&r;++s,r=r.parentNode){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r.id===t)return r}}findParentAttr(e,t,a){try{this.PAssert(80,e,"Must pass in a valid element")}catch(s){this.reportError(s)}if(e)for(var i=0,r=e;r&&r.getAttribute;r=r.parentNode){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r.getAttribute(t)===a)return r}}prependChild(e,t){try{this.PAssert(81,e,"Must pass in a valid element")}catch(a){this.reportError(a)}try{this.PAssert(82,t,"Must pass in a valid element")}catch(a){this.reportError(a)}e.insertBefore(t,e.firstChild)}getAncestorChain(e){var t=0;for(var a=e;a;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a.push(a),a=a.parentNode}return[]}isAttachedToDoc(e){try{this.PAssert(84,e,"Must supply a valid element to check")}catch(t){this.reportError(t)}try{this.PAssert(85,e.ownerDocument,"Checked element must have a valid owner document")}catch(t){this.reportError(t)}return!!e.ownerDocument&&(e.ownerDocument.body.contains(e)||e.ownerDocument.documentElement===e)}offset(e){try{this.PAssert(86,e,"Must pass in a valid element")}catch(s){this.reportError(s)}var t=e.getBoundingClientRect(),a=e.ownerDocument,i=e.ownerDocument.documentElement,r=a.defaultView;return{top:t.top+r.pageYOffset-i.clientTop,left:t.left+r.pageXOffset-i.clientLeft}}position(e){var t=e.offsetParent,a=e.getBoundingClientRect(),i=t.getBoundingClientRect();return{left:a.left-i.left,top:a.top-i.top}}height(e){try{this.PAssert(88,e,"Must pass in a valid element")}catch(i){this.reportError(i)}var t=e.offsetHeight,a=window.getComputedStyle(e);return a?("border-box"!==a.boxSizing&&(t-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom)),t-=parseFloat(a.borderTopWidth)+parseFloat(a.borderBottomWidth)):this.shouldLog(s.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::height"),t}width(e){try{this.PAssert(90,e,"Must pass in a valid element")}catch(i){this.reportError(i)}var t=e.offsetWidth,a=window.getComputedStyle(e);return a?("border-box"!==a.boxSizing&&(t-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight)),t-=parseFloat(a.borderLeftWidth)+parseFloat(a.borderRightWidth)):this.shouldLog(s.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::width"),t}wrapXHR(){try{let t=window,a=t.XMLHttpRequest.prototype.open,i=t.XMLHttpRequest.prototype.send,r=this;t.XMLHttpRequest.prototype.open=function(e,t,i,s,n){this.url=t,void 0===i&&(i=!0);try{a.call(this,e,t,i,s,n)}catch(o){throw r.reportError(o),o}},t.XMLHttpRequest.prototype.send=function(e){this.timeout||(this.timeout=r.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&i.call(this,e)}catch(t){throw r.reportError(t),t}}}catch(e){this.reportError(e)}}element(e,t){try{this.PAssert(92,e,"Tried to get an element without an id")}catch(a){this.reportError(a)}this.elements[e]&&!t||(this.elements[e]=document.getElementById(e));try{this.PAssert(93,this.elements[e],"Tried to get an element that doesn't exist",e)}catch(a){this.reportError(a)}return this.elements[e]}openUrl(e,t,a){try{this.PAssert(94,e,"Must always provide a valid URL to open")}catch(l){this.reportError(l)}if(!e)return!1;let i=this.getToolbox();var r=this.parseEvernoteLink(e);if(r){i&&i.settings.getUserIdentifier();var s=!!i&&i.settings.openEvernoteApp.get();if(void 0===s)return void i.menus.confirm("Open Evernote links in Evernote app?",r=>{i&&i.settings.openEvernoteApp.set(r),this.openUrl(e,t,a)});s&&(r.viewUrl?e=r.viewUrl:(e="evernote:///view/"+r.userId+"/"+r.shardId+"/"+r.noteGuid+"/"+r.noteGuid+"/",console.log(e)))}if(D.a.standalone){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("target","_blank"),n.setAttribute("rel","noopener noreferrer");var o=document.createEvent("HTMLEvents");o.initEvent("click",!0,!0),n.dispatchEvent(o)}else if(D.a.app){D.a.isChrome||!e.startsWith("http://")&&!e.startsWith("https://")?e.startsWith("/")&&(e=window.location.host+e):e=e.replace("http://","").replace("https://",""),e.startsWith("callto:")&&(e=e.replace("callto:","tel:")),i.nativeBridge.sendToApp("openURL",e),t&&(this.preventAndStop(t),t.returnFalse=!0)}else(a=a||e.startsWith("evernote:///")||e.startsWith("onenote:")||e.startsWith("bear:"))?open(e,"_this"):open(e,"_blank");return!0}getLocationOrigin(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}isSpellcheckEnabled(){return!1}fFalse(){return!1}fTrue(){return!0}round(e,t){return t=t||2,Number(Math.round(e+"e"+t)+"e-"+t)}toFileSize(e){if(e){var t=Math.log(e)/Math.log(1024)|0;return(e/Math.pow(1024,t)).toFixed(2)+" "+(0===t?"bytes":"KMGTPEZY"[t-1]+"B")}return null}saveFile(e,t){var a=new Blob([e],{type:"text/plain;charset=utf-8"});Object(C.saveAs)(a,t)}downloadFile(e,t){let a=this.getToolbox();if(D.a.supportsNativeDownload()){try{this.PAssert(96,!this.downloadToasts[e],"Should not double create a download for the same file")}catch(s){this.reportError(s)}this.downloadToasts[e]=a.toasts.pushMessage({text:"Downloading "+t+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),a.nativeBridge.sendToApp("downloadURL",{url:e,name:t})}else if(document.createEvent){var i=document.createElement("a");i.href=e;var r=document.createEvent("MouseEvents");r.initEvent("click",!0,!0),i.dispatchEvent(r)}else window.open(e,"_this")}handleNativeDownloadProgress(e){var t=e.url,a=e.name,i=e.progress,r=this.downloadToasts[t];if(r)if(1===i)r.hide(),delete this.downloadToasts[t];else{var s=isNaN(i)?"...":Math.round(100*i)+"%";r.setText("Downloading "+a+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+s)}}printPage(e){D.a.app||window.open(e).print()}reactNodeForElement(e){var t=e;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode),t=this.getParentWithMooKey(t))for(const a in t)if(a.startsWith("__reactInternalInstance$")){let e=t[a],i=e&&e.return&&e.return.stateNode;if(i&&i.props)return i}}getParentWithMooKey(e){for(var t=0;e&&e!==document;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.getAttribute("data-moo-id"))return e;e=e.parentNode}}getItemForElement(e){var t=this.reactNodeForElement(e),a=t&&t.getPaneObject&&t.getPaneObject(),i=a&&(this.isVMLI(a)?a:a.item);try{this.PAssert(97,!i||this.isVMLI(i),"Must always find a valid VMLI for a given element: "+this.elementToString(e))}catch(r){this.reportError(r)}if(i)return i}getIndexForElement(e){var t=-1,a=this.findParent(e,"item");if(a){var i=this.reactNodeForElement(a);i&&(t=i.getIndex())}return t}getPaneForElement(e){let t=this.findParent(e,"pane")||this.findParent(e,"paneOverviewScroller");if(t){let e=this.reactNodeForElement(t);return e&&e.getPane&&e.getPane()}}getPaneObjectForElement(e){var t=this.reactNodeForElement(e);if(t&&t.getPaneObject)return t.getPaneObject()}getCellForElement(e){var t=this.reactNodeForElement(e);if(t&&t.getCell)return t.getCell()}getListCellForElement(e){var t=this.reactNodeForElement(e);if(t&&t.getCell)return t}btoa(e){return window.btoa(e)}atob(e){return window.atob(e)}animFrameOnce(e,t){var a=this.timeouts[e];a&&cancelAnimationFrame(a),this.timeouts[e]=requestAnimationFrame(t)}elementFromPoint(e,t){return document.elementFromPoint(e,t)}parentTextForItem(e){for(var t=0,a=e.parents(),i="",r=1;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r>1&&(i+="  |  "),i+=a[r].generateTitleText()}return i}batchRenderUpdates(e,t,a,i,r,s){return E.a.unstable_batchedUpdates(e,t,a,i,r,s)}hexToRgb(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}hexToRgbStr(e){return parseInt(e.substr(1,2),16)+","+parseInt(e.substr(3,2),16)+","+parseInt(e.substr(5,2),16)}rgbToHex(e,t,a){return[this.pad2(Math.round(e).toString(16)),this.pad2(Math.round(t).toString(16)),this.pad2(Math.round(a).toString(16))].join("")}infLoop(e){if(!this.timeLastLoop||e<this.numLastLoop)this.timeLastLoop=Date.now();else if(e>this.numLastLoop&&e>3e4&&e%200===0&&Date.now()-this.timeLastLoop>1e4){0;try{this.PAssert(99,!1,"Infinite loop!",e)}catch(t){this.reportError(t)}let a=this.getToolbox();return a.toasts&&a.toasts.pushMessage(s.a.MessageID.ReactError),!0}this.numLastLoop=e}XHR_PrivateAPI(e){var t=D.a.getDeployVar(s.a.DeployVariable.APIHost);e.url=`https:${t}${e.path}`,this.XHR(e)}getRollbarData(){return{url:this.sanitizeURL(window.location.href),jsVersion:s.a.jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"}}sendRollbar(e,t,a){window.Rollbar&&(a===s.a.LogLevels.Error?(Rollbar.error(e,t),this.sendEvent("ErrorReport","Error")):a===s.a.LogLevels.Warning?(Rollbar.warning(e,t),this.sendEvent("ErrorReport","Warning")):(Rollbar.error(e,t),this.sendEvent("ErrorReport","Unknown")))}textToJSONPromise(e){try{return Promise.resolve(JSON.parse(e))}catch{}}textToTextPromise(e){return Promise.resolve(e)}async XHR({url:e,type:t,data:a,headers:i,autoRetry:r,timeout:s,maxRetries:n,username:o,password:l}){var d=this;try{d.PAssert(100,e,"Must specify a valid URL to use")}catch(h){d.reportError(h)}try{d.PAssert(101,t,"Must specify a valid request type")}catch(h){d.reportError(h)}return new Promise(c=>{var u=0;n=Math.min(n||2,6),this.notifyStatsXHRRequest(e);var p=()=>{try{d.PAssert(102,u<n,"Should not be calling retry once retries have been exhausted")}catch(h){d.reportError(h)}u<n?(u++,this.notifyStatsXHRRetry(e),setTimeout(g,1e3*A[u])):(this.notifyStatsXHRFailure(e),this.reportError(new Error("XHR Failed: "+e)))},g=()=>{var d,h=new XMLHttpRequest;(void 0===s||isNaN(s)||(h.timeout=s),h.onreadystatechange=()=>{if(4!==h.readyState)return;let t=h;t.json=this.textToJSONPromise.bind(this,h.response),t.text=this.textToTextPromise.bind(this,h.response),200!==h.status?u<n?(h.retry=p,r&&M.indexOf(h.status)>=0?h.retry():c(t)):(this.notifyStatsXHRFailure(e),c(t)):(this.notifyStatsXHRSuccess(e),c(t))},o&&l?h.open(t.toUpperCase(),e,!0,o,l):h.open(t.toUpperCase(),e,!0),i&&Object.keys(i).forEach(e=>h.setRequestHeader(e,i[e])),a)?(h.setRequestHeader("Accept","*/*"),i&&i["Content-Type"]||h.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),d=a instanceof Blob?a:this.generateQueryString(a),h.send(d)):h.send()};g()})}scheduleIdleTask(e){setTimeout(e,100)}},r()(S.prototype,"onWindowError",[g.a],Object.getOwnPropertyDescriptor(S.prototype,"onWindowError"),S.prototype),r()(S.prototype,"performScroll",[g.a],Object.getOwnPropertyDescriptor(S.prototype,"performScroll"),S.prototype),r()(S.prototype,"infLoop",[g.a],Object.getOwnPropertyDescriptor(S.prototype,"infLoop"),S.prototype),S);var L=t.default=new T},1:function(e,t,a){"use strict";Error.stackTraceLimit=1/0;var i={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,Minus:109,F1:112,F4:115,F12:123,Equals:187,Plus:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222};const r={None:0,Note:32,Archived:128,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},s={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",DriveFull:"https://www.googleapis.com/auth/drive",DriveReadOnly:"https://www.googleapis.com/auth/drive.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",Plus:"",DriveInstall:"https://www.googleapis.com/auth/drive.install",Email:"email",Profile:"Profile"};var n={FirebaseAppID:"597847337936",FirebaseProjectID:"api-project-597847337936",APIKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50",ClientID:"597847337936-ridipp5ac5bulesmmjici7rtjces027t.apps.googleusercontent.com",CloudFunctionsURL:"https://api-project-597847337936.firebaseapp.com/appapi/v1/",EmailOpenTime:250,ItemTransitionTime:150,DoubleClickTime:500,EmailPreviewSizeMin:600,EmailPreviewSizeMaxFlex:800,EmailPreviewSizeMax:1200,PremiumMaxBoards:5,PremiumMaxPanes:3,ExpandedPaneWidth:400,HelpWidth:360,StdPaneWidthMin:400,StdPaneWidthMax:900,PaneWidthMax:1400,EmailOpenTimeMobile:150,OverviewWidth:260,OverviewItemHeightDesktop:26,OverviewItemHeightMobile:36,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,PaneSpaceSize:0,MSPerMinute:6e4,MSPerHour:36e5,MSPerDay:864e5,DefaultEventDuration:36e5,MaxBatchSize:45,TooltipDelay:400,MobileBottomHeight:50,HorizScrollbarHeight:18,DesktopToolbarHeight:32,PaneHeaderButtonWidth:32,PaneHeaderButtonHeight:36,PaneHeaderRow2ButtonHeight:30,PaneHeaderRow2Height:36,MobileHeaderRow2Height:36,CalendarResizeHandleHeight:8,DesktopMenuWidthDefault:120,DesktopMenuWidthMax:240,DesktopMenuWidthMinBig:66,DesktopMenuWidthSmall:36,RootItemName:"Home",MinEmailScale:.25,SidebarDragHandleSize:16,SearchHeight:22,PaneAddItemBoxHeight:36,DateFormat:{DMY:"dmy",DMYDot:"dmydot",MDY:"mdy",YMD:"ymd",YMDDot:"ymddot"},SettingsSections:{General:"General",Dates:"Dates",Plugins:"Enable Plugins",Account:"Moo.do Account",EarlyAccess:"Send Feedback",Linked:"Sync Accounts",Invite:"Invite Friends",DesktopApp:"Desktop App",GoogleCalendar:"Google Calendar",Contacts:"Contacts",Gmail:"Gmail",Agenda:"Agenda",Backups:"Backups",Security:"Security",Debug:"Debug"},ItemAnimationMode:{None:0,Normal:1,Move:2,Search:3},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:"None",Reply:"Reply",ReplyAll:"Reply All",Forward:"Forward",Compose:"New Message"},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},TaskViewMode:{Outline:"Outline",List_Flat:"List_Flat",Groups_Project:"Groups_Project",Groups_Tag:"Groups_Tag",Groups_Contact:"Groups_Contact",Groups_Priority:"Groups_Priority",Agenda_Today:"Agenda_Today",Agenda_Week:"Agenda_Week",Agenda_All:"Agenda_All",Calendar_Day:"Calendar_Day",Calendar_Custom:"Calendar_Custom",Calendar_Week:"Calendar_Week",Calendar_Month:"Calendar_Month",Archived:"Archived",Deleted:"Deleted"},TaskViewModesPremium:{Groups_Tag:!0,Groups_Contact:!0,Groups_Priority:!0},TaskViewModeText:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Project",Groups_Tag:"Tag",Groups_Contact:"Contact",Groups_Priority:"Priority",Agenda_Today:"Today",Agenda_Week:"Week",Agenda_All:"All",Calendar_Day:"Day",Calendar_Custom:"# Days",Calendar_Week:"Week",Calendar_Month:"Month",Archived:"Archive",Deleted:"Deleted"},TaskViewModeTextSimple:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priorities",Agenda_Today:"Agenda",Agenda_Week:"Agenda",Agenda_All:"Agenda",Calendar_Day:"Calendar",Calendar_Custom:"Calendar",Calendar_Week:"Calendar",Calendar_Month:"Calendar",Archived:"Archived Items",Deleted:"Deleted Items"},TaskViewModeIcon:{Outline:"icon-format_list_bulleted",List_Flat:"icon-reorder",Groups_Project:"icon-project",Groups_Tag:"icon-hash",Groups_Contact:"icon-user",Groups_Priority:"icon-exclamation",Agenda_Today:"icon-today",Agenda_Week:"icon-view-groups",Agenda_All:"icon-format_align_justify",Calendar_Day:"icon-view_carousel",Calendar_Custom:"icon-view_week",Calendar_Week:"icon-cal-week",Calendar_Month:"icon-view_comfy",Archived:"icon-inbox",Deleted:"icon-delete"},TaskSortMode:{None:"None",Alphabetical:"Alphabetical",NumItems:"NumItems",Priority:"Priority",Date:"Date",Created:"Created",Completed:"Completed"},TaskSortModeText:{None:"None",Alphabetical:"A-Z",NumItems:"# Items",Priority:"!!!",Date:"Date",Created:"Created",Completed:"Completed"},DocumentSortMode:{Alphabetical:"Alphabetical",Modified:"Modified"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:52,CalendarDayViewNumDaysPad:364,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,CalendarMaxSyncWeeks:52,CalendarMinSyncWeeks:-52,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},DFormat:{LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},HelpMode:{None:0,Normal:1,Hotkeys:3},Pricing:{None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailViewMode:{Date:"Date",Priority:"Priority"},MaxGmailSyncTime:{Premium:120,Free:5},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},AutocompleteMode:{All:"all",Move:"move",Jump:"jump",Item:"item",Email:"email",Contact:"contact",Tag:"tag",Date:"date",Snooze:"snooze",GmailLabel:"gmailLabel"},ContextMenuMode:{Default:0,Archived:1,Drive:2,Gmail:3},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1,Portrait:0,Landscape:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown",SpacingCompact:"SpacingCompact",SpacingComfortable:"SpacingComfortable",PrefixesFaded:"PrefixesFaded",PrefixesStrong:"PrefixesStrong"},ColorTheme:{Light:"light",Dark:"dark"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Header2:"^",Bullet:"*",Bullet2:"-",Bullet3:"+",Task:"[",Task2:"[]",Task3:"]",Task4:"[ ]",Task5:"(",Task6:"()",Task7:")",Task8:"( )",NumList:"1."},MinimumTokenExpireTimeMS:6e4,MinimumTokenExpireTime:60,ToastTimeoutDefault:5e3,PrefixWidth:20,PrefixOffsetFromItem:2,PaddingAgendaTime:30,HeightAgendaParents:18,LineLeftPad:5,TextSpace:"\ufeff",AttachChar:"\u2000",EmbedAttachChar:"\u2001",RNSpace:"\u2002",CharDate:"\ufefe",PerPaneStateField:{Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},ItemStoreFilter:{None:0,Dates:1,Contacts:2,Priority:4},NumKeys:[i.D1,i.D2,i.D3,i.D4,i.D5,i.D6,i.D7,i.D8,i.D9,i.D0],ContactPrefix:"+",TagPrefix:"#",PrefixDate:"!",PrefixItemAutocomplete:"$",TextMDHR:"---",DisplaySettings:{bulletOpacity:"bulletOpacity",projectOpacity:"projectOpacity",checkboxOpacity:"checkboxOpacity",checkboxBackgroundOpacity:"checkboxBackgroundOpacity",showVerticalLines:"showVerticalLines",verticalLinesOpacity:"verticalLinesOpacity",boldHeaders:"boldHeaders",itemPadding:"itemPadding",notePadding:"notePadding",itemLineHeight:"itemLineHeight",noteLineHeight:"noteLineHeight",itemIndentSize:"itemIndentSize",fontSize:"fontSize",fontSizeHeader:"fontSizeHeader",fontSizeHeaderTopLevel:"fontSizeHeaderTopLevel",noteFontSize:"noteFontSize",tagColor:"tagColor",dateColor:"dateColor",contactColor:"contactColor",linkColor:"linkColor",underlineP:"underlineP",displaySpacing:"displaySpacing",displayPrefixes:"displayPrefixes",grayscale:"grayscale"},KeyCode:i,KeyCodesModifiers:[i.LeftMeta,i.RightMeta,i.Ctrl,i.Alt,i.Shift],KeyCodesArrows:[i.UpArrow,i.DownArrow,i.LeftArrow,i.RightArrow],PrivateAPIErrorCodes:{Success:0,UnknownFailure:1,Unexpected:2,DatabaseReadError:3,DatabaseWriteError:4,MissingParameter:5,InvalidParameter:6,UnauthorizedUser:7,ErrorSendingEmail:8,AlreadyReferred:9,ErrorContactingRemote:10,BraintreeUnknown:11,InvalidToken:12,InvalidReferralCode:13,NoSignupFound:14,TrialOver:15,RemoteServerError:16,TokenMissing:17,BraintreePaypalBlock:18,BraintreeInvalidCCN:19,AlreadyExists:20,DomainPolicy:21,InvalidCode:22,RejectedEmail:23,AlreadyPremium:24,MissingIDToken:25},SearchDates:{Overdue:"@overdue",Before:"before:",After:"after:",Date:"date:"},Regexp:{Link:/\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/g,LinkExc:/(!?)\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/g,MDLink:/(!?)\[([^\[]*)\]\((\S+)(\s=\d{0,3}x)?(?=\))\)/g,Prefix:/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) /gi},ItemProp:{Date:"date",Items:"items",Tags:"tags",Text:"text",Font:"font",Search:"search"},DefaultBackupFrequency:36e5,DriveFolder:{Root:"root",Attach:"attach",Backup:"backup"},CrudActions:{Added:"Added",Modified:"Modified",Removed:"Removed"},TestDocName:"demo",LocalStoreMode:{Mirror:"mirror"},LogLevels:{Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Edit:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},URLPart:{Search:1,Hash:2},PremiumStatus:{Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},UninitializedVersion:-1,DETAILED_STATS:!1,DEBUG_DATE:!1,OAuthSchemeType:{Invalid:-1,None:0,Web:1,Native:2,Count:2},RepeatFreq:{Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},ChangeType:{None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},DataChangeType:{Add:1,Remove:2,Change:3},VMLIFlag:r,VersionType:{Structure:1,Text:2},SearchResultStatus:{Done:1,TooMany:2,None:3,Error:4},PaneMode:{Task:"PaneTask",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail"},ScrollDuration:{Snap:0,Default:200,Slow:500},LoadState:{Connecting:0,NeedPassword:1,LoadingDocs:2,Connected:3},LoginState:{NONE:0,LOGGED_OUT:1,LOGGED_IN:2},ButtonCode:{None:-1,Left:0,Middle:1,Right:2},Direction:{Up:-1,None:0,Down:1},MessageAction:{Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenLinkedSettings:17,OpenGeneralSettings:18,OpenCalendarSettings:19},MessageType:{Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},MessageID:{Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,NeedGmailPermission:37,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,MissingOffline:41,MissingOfflineMobile:42,FlatSearchMultiSelect:43,FlatSearchEnter:44,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49,ReactError:50,PaneLoadTimeout:51},SaveFlag:{None:0,Prop:1,Text:2,All:3},DateType:{Once:1,Repeat:2},StorageType:{InMemory:1,LocalStorage:2,IndexedDB:3},DataSource:{Paste:1,Drop:2,Plugin:3},PluginID:{Date:"Date",Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar"},PluginSettingsID:{Date:{IsEnabled:"isEnabled"},Moodo:{IsEnabled:"isEnabled"},Mailbird:{IsEnabled:"isEnabled"},Gmail:{IsEnabled:"isEnabled",ArchiveOnSchedule:"archiveOnSchedule",ArchiveOnOrganize:"archiveOnOrganize",InsertSignatureAboveReplies:"insertSignatureAboveReplies",WriteAccess:"writeAccess",SyncTime:"syncTime",SyncAccounts:"syncAccounts"},Drive:{IsEnabled:"isEnabled",WriteAccess:"writeAccess",LastChangeId:"lastChangeId",DriveRootId:"driveRootId"},GCalendar:{IsEnabled:"isEnabled",WriteAccess:"writeAccess",ImportCalendars:"importCalendars",ExportCalendar:"exportCalendar",WeeksPast:"weeksPast",WeeksFuture:"weeksFuture",DisplayOverdueInAgenda:"displayOverdueInAgenda",SyncNewEvents:"syncNewEvents",SyncDraggedEvents:"syncDraggedEvents",CreateLocalEvents:"createLocalEvents"}},PluginLoad:{None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},PluginDependency:{DemoMode:"DemoMode",GoogleLogin:"GoogleLogin",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess"},PluginRenderTypes:{Generic:0,StyledText:1,UnstyledText:2,Measure:3,RichText:4},PluginRenderers:{Unknown:-1,DriveFile:0,EmailThread:1,CalendarEvent:2},Modals:{ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode",Backups:"backups",ImportMoodo:"importMoodo",ConfirmEncrypt:"confirmEncrypt",Date:"date",Note:"note",AutocompleteList:"autocompleteList",Contact:"contact",ExternalLink:"ExternalLink",DropBucket:"dropBucket"},DisplayMode:{Default:0,InIframe:1,NoPaneHeaders:2,Invisible:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,PromptStart:4096,FullMin:8191},Checkpoint:{MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},PlatformOS:{Unknown:0,iPhone:1,iPad:2,iPod:3,Android:4,Mac:5,Windows:6,Linux:7,ChromeOS:8},PlatformBrowser:{Unknown:0,Electron:1,Mailbird:2,Chrome:3,Firefox:4,Safari:5,IE:6,Edge:7,Opera:8},PlatformConfig:{DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},AppPlatform:{iOS:0,Android:1,Embed:2,Electron:3},EmbedApps:{Mailbird:"mailbird"},DeployVariable:{Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},GScope:s,GScopeArray:[s.Calendar,s.CalendarRO,s.Contacts,s.Drive,s.DriveMetadataRO,s.DriveFull,s.DriveReadOnly,s.GmailCompose,s.GmailModify,s.TasksRO,s.UserInfoEmail,s.UserInfoProfile,s.DriveAppData,s.Plus,s.Email,s.Profile,s.DriveInstall],jsVersion:"1563970195194",__devServerURL:"##DEV_SERVER_URL##",__MAX_ERRORS_REPORTED:50,ProductName:"Moo.do",EncryptionSentinel:"MDsentinel",EncryptionKeys:{Global:"Global",UserPassword:"UserPassword"},PCMask:r.P0|r.P1|r.P2|r.Complete,PMask:r.P0|r.P1|r.P2,PriorityClass:{[r.None]:" ",[r.P0]:" p0",[r.P1]:" p1",[r.P2]:" p2"},OverviewPaddingStartMobile:12,OverviewPaddingStart:32,OverviewPaddingIncrement:18,MobileItemIndentStart:30,ColorBrand:"#0099dd",DocumentAccessRoles:{Read:0,Write:1,Admin:2},Colors:{Brand:"#0099dd",Red:"#C9302C",P0:"#f30",P1:"#fa0",P2:"#fc3",Star:"#ffb",Complete:"#d6d6d6",Mobile:{Header:"#f6f6f6"}},BlockType:{Item:"blockItem",Header:"blockHeader",AddItem:"blockAddItem",HR:"hr"},SPThresholdRight:42};t.a=n},103:function(e,t,a){"use strict";var i=a(7),r=a.n(i),s=a(0),n=a(1),o=a(3),l=a(13),d=a(55),h=a(26),c=a(5),u=a(27),p=a(54),g=a(53);const f=n.a.DEBUG_DATE;if(f)var m=function(e,t){for(var a in e)if(e[a]===t)return a;return null};var v,y,_,S=864e5,P=new Date(9e12).getTime(),I=new Date(1401606e6),b=", . ? ! ) ( : ; [ ] ' \"".split(" "),D=/^(next|today|tomorrow|yesterday|(?:sun|mon|tue(?:s)?|wed(?:nes)?|thu(?:rs)?|fri|sat(?:ur)?)(?:day)?)/i,w=/^(?:(?:([0]?[1-9]|1[0-2])(?::([0-5]\d))?(?:\s)?(am?|pm?|\b))|(?:([0]?\d|1\d|2[0-3]):([0-5]\d)))$/i,E=/(?:^(?:[\*_]*?)@|[\(\s](?:[\*_]*?)@)([^\s\)\*_]{2,})(\s[^\s\)@\u2001\u2003\*_]{1,})?(\s[^\s\)@\u2001\u2003\*_]{1,})?/g,C={repeat:/^(ev(ery)?|after)\b/i,recur:/^(other|first|second|third|fourth|1st|2nd|3rd|4th|last)$/i,day:/^(((sun|mon|tue(s)?|wed(nes)?|thu(rs)?|fri|sat(ur)?)(day)?)(?:,|\sand\s)?)$/i,daysOfWeek:/^(weekday|weekend)$/i,len:/^(day|week|month|year|morning|afternoon|night)$/i,count:/^((\d{1,2})|one|two|three|four|five|six|seven|eight|nine|ten)$/i,month:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(l|n|ly|ne)|aug(ust)?|oct(ober)?|(sep(t)?|nov|dec)(ember)?)$/i,at:/^at$/i,of:/^of$/i,in:/^in$/i,delim:/^and$/i,date:/^((\d{1,2})|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?)(?:,|\sand\s)?)$/i,year:/^((\d\d)|(\d\d\d\d))$/i,time:w,from:/^(from|starting)$/i,until:/^(until)$/i,measure:/^(days|weeks|months|years)$/i},A={"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,fou:4,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,days:n.a.RepeatFreq.Daily,weeks:n.a.RepeatFreq.Weekly,months:n.a.RepeatFreq.Monthly,years:n.a.RepeatFreq.Yearly},M={h:1,hr:1,hrs:1,hour:1,hours:1,Hours:1,m:2,min:2,mins:2,Minutes:2,d:3,day:3,days:3,Days:3,"-":1,until:1,to:1,till:1,EndDate:1,for:2,Duration:2},T={duration:/^(-\s|(?:for|until|to|till)\b)/i,len:/^(\d{0,3}(?:\.\d{1,2})?)(h(?:(?:ou)?r(?:s)?)?|m(?:in(?:s)?)?|d(?:ay(?:s)?)?)$/i},L=0,x=0,k=1,R="@";var O,F=new class{translateItemDate(e){let t,a,i,r=e.text,l=e.date,d=e.repeatDate,h=e.dateFormat||o.default.settings.dateFormat.get(),c=e.completedTime;var u=0,p=E;for(p.lastIndex=0;null!==(t=p.exec(r));){var g=0;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;let e=t[0].indexOf(R);t[1];var f=!1;for(let a=1;a<t.length&&t[a];++a){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(f)t[a]=void 0;else{var m=t[a][t[a].length-1];b.indexOf(m)>=0&&(t[a]=t[a].slice(0,-1),f=!0)}}var v,y=this.parseRepeatDate(d,void 0,h,c,0,r.substr(t.index+e+1));if(y||t[1].startsWith("every")||"in"===t[1]){if(y){v=t.index+e,y.replacedDate&&(r=r.substr(0,v+1)+y.text+r.substr(v+y.repLength+1)),a?a.push(y):a=[y];var _=new Date(y.startDate);_.hasTimeOfDay()&&(w=v+y.text.length+1,C=r.substr(w),(D=this.parseDuration(_,C,h))&&(y.oldText.length,i?i.push(D):i=[D]));break}}else{var S=[t[1]?t[1]:"",t[2]?t[2]:"",t[3]?t[3]:""],P=this.computeDateInfo(l,void 0,h,o.default.International.getCurrentDateFormat(),0,S);if(P.isValid){var I;v=t.index+e,P.replacedDate?(r=r.substr(0,v+1)+P.text+r.substr(v+P.oldText.length+1),I={type:n.a.DateType.Once,date:P.date,dateFormat:P.format,origText:P.oldText,text:P.text,explicitTime:P.date.hasTimeOfDay()}):I={type:n.a.DateType.Once,date:P.date,dateFormat:P.format,origText:P.oldText,text:P.text,explicitTime:P.date.hasTimeOfDay()},a?a.push(I):a=[I];var D,w=v+P.text.length+1,C=r.substr(w);(D=this.parseDuration(P.date,C,h))&&(I.explicitTime||D.duration%s.default.days(1)===0||(I.explicitTime=!0),i?i.push(D):i=[D]);break}}}return{date:a?a[0]:void 0,duration:i?i[0]:void 0}}getDurationLength(e){var t=T.len.exec(e),a=parseFloat(t[1]),i=0;switch(M[t[2].toLowerCase()]){case M.Hours:i=s.default.hours(a);break;case M.Minutes:i=s.default.minutes(a);break;case M.Days:i=s.default.days(a);break;default:try{s.default.PAssert(870,!1,"Invalid duration length: "+t[2])}catch(r){s.default.reportError(r)}}return i}parseDuration(e,t,a){this.setDateTokens(t);var i,r=0;if(this.checkAndParse(T.duration)){if(M[v.toLowerCase()]===M.EndDate)if(this.checkAndParse(w,2)){var s=this.getTimeFromString(v),n=e.clone();n.setHours(s.hour),n.setMinutes(s.min),r=+n-+e}else this.checkAndParseDate(a)&&(r=_?+_-+e:0);else if(M[v.toLowerCase()]===M.Duration){for(var o=0;this.checkAndParse(T.len);){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;r+=this.getDurationLength(v)}r--}}else{for(var l=0;this.checkAndParse(T.len);){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;r+=this.getDurationLength(v)}r--}return r>0&&(i={durationText:t.substr(1,L).trim(),duration:r}),i}getSoftText(e,t){return t<0?t>=-S?"yesterday":e.toString(o.default.International.getFormat(n.a.DFormat.MonthDayYear)):t<=S&&e.isToday()?"today":t<2*S?"tomorrow":void 0}runDateParse(e,t){var a=e.join(""),i=o.default.International.parseDate(a,t);return!i&&e[1]&&(a=e[0]+e[1],i=o.default.International.parseDate(a,t)),!i&&e[0]&&(a=e[0],i=o.default.International.parseDate(a,t)),{dt:i,dateString:a}}computeDateInfo(e,t,a,i,r,l){var d,h,c,u,p=new Date(e).clearTime(),g=(new Date).clearTime(),v=+p-+g,y=t||l.join(""),_=y,P=!1;if(f&&(s.default.log("Prev Date Time: ",p),s.default.log("Curr Date Time: ",g),s.default.log("RawDiff: ",v),s.default.log("DiffDays: ",v/S)),this.isFlagSet(r,n.a.ChangeType.Auto)||this.isFlagSet(r,n.a.ChangeType.Remote)&&this.isFlagSet(r,n.a.ChangeType.DocLoad))d=new Date(e),void 0!==e&&(v<0||v>=0&&v<2*S)?(D.lastIndex=0,null!==(c=D.exec(y))?"NEXT"!==y.toUpperCase()&&(h=this.getSoftText(d,v))&&!y.toUpperCase().startsWith(h.toUpperCase())&&(void 0===t&&(y=(I=this.runDateParse(l,a)).dateString),_=y.replace(c[0],h),P=!0):null!==(c=w.exec(y))?(h=this.getSoftText(d,v))&&"today"!==h&&(void 0===t&&(y=(I=this.runDateParse(l,a)).dateString),_=h+" "+y,P=!0):void 0!==e&&void 0!==t||(I=this.runDateParse(l,a)).dateString!==t&&(d=I.dt,y=I.dateString,_=I.dateString)):void 0!==e&&void 0!==t||(s.default.isDemoMode()||!this.isFlagSet(r,n.a.ChangeType.Auto)?(d=(I=this.runDateParse(l,a)).dt,_=I.dateString,y=I.dateString):void 0===e&&(d=void 0));else if(this.isFlagSet(r,n.a.ChangeType.Local)||this.isFlagSet(r,n.a.ChangeType.Remote))this.isFlagSet(r,n.a.ChangeType.PluginLoad)?d=e?new Date(e):void 0:(d=(I=this.runDateParse(l,a)).dt,y=I.dateString,_=I.dateString);else{var I;d=(I=this.runDateParse(l,a)).dt,y=I.dateString,_=I.dateString}f&&(s.default.log(">>> Date Rollver <<<"),s.default.log(">>> Change Type:  ",m(n.a.ChangeType,r)),s.default.log(">>> Prev Date:    ",new Date(e)),s.default.log(">>> New Date:     ",d),s.default.log(">>> Prev String:  ",y),s.default.log(">>> Trans String: ",h),s.default.log(">>> New String:   ",_),s.default.log("--------------------"));try{s.default.PAssert(871,!d||!isNaN(d.getTime()),"Must be a valid parsed date")}catch(b){s.default.reportError(b)}return a!==i?(u=o.default.International.convertDateFormat(_,a,i),P=!0):u=_,{isValid:!!d,oldText:y,text:u,date:d,format:a,replacedDate:P}}getRepeatStartDate(e){if(e&&"string"===typeof e){var t=e.split("|");if(t.length>3&&"1"===t[0])return new Date(parseInt(t[1]))}}setDateTokens(e){v="",y=e.split(" "),k=1,L=y[0].length,x=0,_=void 0}checkAndParse(e,t){var a=!1;if(f&&void 0===e&&s.default.log("INVALID TOKEN TYPE"),void 0===(t=void 0!==t&&t>1?Math.min(y.length-k,t):t)||1===t)k<y.length&&(a=y[k].match(e))&&(v=y[k],k++,L+=v.length+1);else if(t>1&&k+t<=y.length)for(var i=0,r=t;r>0;r--){var n=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o="",l=0;l<r;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o+=y[k+l],l+1!==r&&(o+=" ")}if(a=!!o.match(e)){v=o,k+=r,L+=o.length+1;break}}return a}checkAndParseDate(e){var t=!1;if(k+1<y.length&&!y[k+1].match(C.at)){var a=o.default.International.parseDate(y[k]+" "+y[k+1],e);a&&(t=!0,v=y[k]+y[k+1],_=a,k+=2,L+=v.length+2)}if(!t&&k<y.length){var i=o.default.International.parseDate(y[k],e);i&&(t=!0,v=y[k],_=i,k++,L+=v.length+1)}return t}computeStartDate(e,t,a,i,r,s){var n=s||new Date,o=(s?new Date(s):new Date).clearTime();return void 0!==i&&o.setMonth(i),void 0!==a&&a>0&&a<=31&&((Date.getDaysInMonth(o.getFullYear(),o.getMonth())<a||a<o.getDate())&&void 0===i&&o.addMonths(1),o.setDate(a)),void 0!==t?(o.moveToNthOccurrence(e,t),o.isBefore(n)&&(o.addMonths(1),o.moveToNthOccurrence(e,t))):void 0!==e&&o.getDay()!==e&&(o.moveToDayOfWeek(e,-1),o.isBefore(n)&&o.moveToDayOfWeek(e)),void 0!==i&&o.isBefore(n)&&(o.addYears(1),o.setMonth(i)),r&&this.updateDateWithTime(o,r),o}updateDateWithTime(e,t){var a=this.getTimeFromString(t);e.setHours(a.hour),e.setMinutes(a.min),e.setMilliseconds(1)}getTimeFromString(e){var t,a,i,r,n=w.exec(e),o=0;void 0!==n[1]?(a=(t=n[3].toUpperCase())===Date.CultureInfo.pmDesignator[0]||t===Date.CultureInfo.pmDesignator,o=s.default.parseInt(n[1])+(a?12:0),i=n[2]?s.default.parseInt(n[2]):0,r=n[1]):void 0!==n[4]&&void 0!==n[5]&&(o=s.default.parseInt(n[4]),i=s.default.parseInt(n[5]),r=n[4]);var l=!1;if(r){var d=s.default.parseInt(r);(r.startsWith("0")||0===d||d>12)&&(l=!0)}return t||l?t&&!l&&(a||12!==o?a&&24===o&&(o=12):o=0):o<8&&(o+=12),{hour:o,min:i}}parseRepeatDate(e,t,a,i,r,l){var d,h,c,u,p,g,m,y,S=!1,b=Date.today(),D=n.a.RepeatFreq.Daily,w=1;if(l.match(C.repeat)){this.setDateTokens(l);var E=!1;if(this.checkAndParse(C.recur)){switch(v){case"other":w=2;break;case"last":D=n.a.RepeatFreq.NthMonthInst,g=-1;break;default:D=n.a.RepeatFreq.NthMonthInst,g=A[v.substr(0,3).toLowerCase()]}E=!0,f&&s.default.log("Parse Recur: ",v)}if(E&&"other"!==v||!this.checkAndParse(C.date))if(!E&&this.checkAndParse(C.count)){var M=s.default.parseInt(v);isNaN(M)&&(M=A[v]),this.checkAndParse(C.measure)&&(D=A[v.toLowerCase()],w=M,S=!0,f&&s.default.log("Parse Measure: ",v))}else if(this.checkAndParse(C.day)){var T,k=0;for(D!==n.a.RepeatFreq.NthMonthInst&&(D=n.a.RepeatFreq.Weekly),p=A[v.substr(0,3).toLowerCase()],f&&s.default.log("Parse Day: ",v);(v.endsWith(",")||this.checkAndParse(C.delim))&&this.checkAndParse(C.day);){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;var R=A[v.substr(0,3).toLowerCase()];T?T.push(R):T=[p,R],f&&s.default.log("Parse Day: ",v)}T&&(T.sort(),c=T),S=!0}else if(this.checkAndParse(C.daysOfWeek))D=n.a.RepeatFreq.Weekly,"weekday"===v?c=[1,2,3,4,5]:"weekend"===v&&(c=[0,6]),S=!0;else if(this.checkAndParse(C.month)){var O=v;if(f&&s.default.log("Parse Month: ",v),this.checkAndParse(C.date)){var F=parseInt(v);F>0&&F<=31&&(m=F,y=A[O.substr(0,3).toLowerCase()],D=n.a.RepeatFreq.Yearly,S=!0,f&&s.default.log("Parse Date: ",v))}}else if(E&&"other"!==v||!this.checkAndParse(C.len))if(E&&"last"!==v||!this.checkAndParse(C.len))E&&"other"!==v&&(D=n.a.RepeatFreq.DayOfMonth,m=g,g=void 0,S=!0);else switch(v){case"day":S=!0,D=n.a.RepeatFreq.EndOfMonthOffset}else{switch(v){case"day":D=n.a.RepeatFreq.Daily;break;case"week":D=n.a.RepeatFreq.Weekly;break;case"month":D=n.a.RepeatFreq.Monthly;break;case"year":D=n.a.RepeatFreq.Yearly;break;case"morning":D=n.a.RepeatFreq.Daily,u="9:00am";break;case"afternoon":D=n.a.RepeatFreq.Daily,u="2:00pm";break;case"night":D=n.a.RepeatFreq.Daily,u="7:00pm"}S=!0,f&&s.default.log("Parese Length: ",v)}else{var N,B=0,U=s.default.parseInt(this.trimPunc(v));for(f&&s.default.log("Parse Date: ",v);(v.endsWith(",")||this.checkAndParse(C.delim))&&this.checkAndParse(C.date);){if(B++>5e3&&__infLoop&&__infLoop(B))throw new RangeError;var H=s.default.parseInt(this.trimPunc(v));H>0&&H<=31&&(N?N.push(H):N=[U,H],f&&s.default.log("Parse Date: ",v))}N&&N.length>1?(N.sort(s.default.numberComparator),D=n.a.RepeatFreq.DayOfMonth,m=N[0],c=N,S=!0):U>0&&U<=31&&(isNaN(U)||(D=n.a.RepeatFreq.DayOfMonth,m=U,S=!0),this.checkAndParse(C.measure)?(D=A[v.toLowerCase()],w=U,m=void 0,S=!0,f&&s.default.log("Parse Measure: ",v)):(this.checkAndParse(C.of),this.checkAndParse(C.month)&&(m=U,y=A[v.substr(0,3).toLowerCase()],D=n.a.RepeatFreq.Yearly,S=!0,f&&s.default.log("Parse Month: ",v))))}var V=!1;this.checkAndParse(C.at)&&(V=!0,f&&s.default.log("Parse At: ",v)),this.checkAndParse(C.time,2)&&(u=v,S=!0,f&&s.default.log("Parse Time: ",v));var j,z,q,W=!1,G=!1;this.checkAndParse(C.in)&&(G=!0,this.checkAndParse(C.month)&&(z=A[v.substr(0,3).toLowerCase()]),this.checkAndParse(C.year)&&(q=parseInt(v)),void 0===z&&void 0===q||(h=new Date,j=new Date,W=!0,q&&(h.setYear(q),h.setMonth(11),j.setYear(q),j.setMonth(0)),void 0!==z&&(void 0!==q&&(h.getMonth()>z&&h.addYears(1),j.getMonth()>z&&j.addYears(1)),h.setMonth(z),j.setMonth(z)),h.moveToLastDayOfMonth(),j.setDate(1)));var K=L+1,Y=L;this.checkAndParse(C.from)?(K=L+1,this.checkAndParseDate(a)&&(W&&!_.isAfter(j)||(j=_),W=!1,x=L,f&&s.default.log("Parse From: ",v))):x=L;var X=!1;V||u||(this.checkAndParse(C.at)&&(V=!0,X=!0,f&&s.default.log("Parse Post-At: ",v)),this.checkAndParse(C.time,2)&&(u=v,X=!0,f&&s.default.log("Parse Post-Time: ",v))),G||this.checkAndParse(C.until)&&this.checkAndParseDate(a)&&(h=_,X=!0,f&&s.default.log("Parse until: ",v)),h&&h.isBefore(j)&&(S=!1)}else"everyday"===l&&(this.setDateTokens(l),S=!0,D=n.a.RepeatFreq.Daily,w=1);if(S){var Q=this.getRepeatStartDate(e),$=this.isFlagSet(r,n.a.ChangeType.Remote)?Q:j;if(c&&D===n.a.RepeatFreq.Weekly)for(var J=0,Z=($||new Date).getDay(),ee=0;ee<c.length;++ee){if(J++>5e3&&__infLoop&&__infLoop(J))throw new RangeError;if(c[ee]>=Z){p=c[ee];break}}var te=!!(b=this.computeStartDate(p,g,m,y,u,$));if(b&&(b.isBefore(I)&&(te=!1),h&&h.isBefore(b)&&(te=!1)),te){var ae,ie,re=!1,se=l.substr(0,L);if(!i&&j&&e&&!W){ie=l.substr(K,x);var ne=this.computeDateInfo(Q,void 0,a,a,r,[ie]);ne.replacedDate&&(ie=ne.text)}else i&&i!==P&&(this.isFlagSet(r,n.a.ChangeType.Text)||(ie=o.default.International.formatDate(new Date(i),n.a.DFormat.MonthDayYear,a)));if(ie){var oe=l.substr(K,x);if(oe.toUpperCase()!==ie.toUpperCase()){f&&s.default.log("Replaced From Date: ",oe,"->",ie);var le=o.default.International.parseDate(ie,a);le&&(u&&this.updateDateWithTime(le,u),se=se.substr(0,Y)+" from "+ie+(X?se.substr(x):""),ae=le.getTime(),re=!0)}}var de,he=l.substr(0,L),ce=o.default.International.getCurrentDateFormat();a!==ce?(de=o.default.International.convertDateFormat(se,a,ce),re=!0):de=se,d={type:n.a.DateType.Repeat,repLength:L,oldText:he,text:de,dateFormat:a,startDate:ae||b,endDate:h,frequency:D,separation:w,offsets:c,replacedDate:re},f&&(s.default.log("Start: ",ae||b),s.default.log("End: ",h),s.default.log("Freq: ",D),s.default.log("Sep: ",w),s.default.log("Offsets: ",c?c.toString():void 0))}}return d}getNowRelativeDate(e){var t;switch(e.toUpperCase()){case"NOW":t=Date.today().add({hours:11});break;case"NEXT":t=Date.today().add({hours:12});break;case"SOON":t=Date.today().add({days:2});break;case"LATER":t=Date.today().add({days:5});break;case"SOMEDAY":t=Date.today().add({days:14});break;default:try{s.default.PAssert(872,!1,"Must supply a valid now relative date string")}catch(a){s.default.reportError(a)}}return t}isDateSoft(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}trimPunc(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}isFlagSet(e,t){return!1}},N=a(48),B=a(49),U=a(9),H=a(31),V=a(56),j=a(8);const z=s.default.invertObject({isArchived:"a",dateCreated:"c",date:"d",duration:"e",formats:"f",durationText:"g",favorites:"h",items:"i",isNote:"k",modifiedOffline:"l",isCollapsed:"m",note:"n",modifiedOfflineText:"o",priority:"p",dateFormat:"q",repeatDate:"r",dateText:"s",text:"t",versionText:"u",version:"v",isDeleted:"x",isComplete:"z",archivedItems:"ai",allDayDate:"ad",id:"id",isStarred:"*",dateCompleted:"^"}),q={docSharing:"docSharing",paneState:"paneState",noSounds:"noSounds",lastMessageSync:"lastMessageSync",shownInstallInfo:"shownInstall",lastCalendarSync:"lastCalendarSync",lastEventSync:"lastEventSync",lastEventFullSync:"lastEventFullySync",calendarsImport:"calendarsImport",calendarExport:"calendarExport",syncGoogle:"syncGoogle",searchExpandsCollapsed:"searchExpandsCollapsed",pluginDrive:"pluginDrive",pluginGmail:"pluginGmail",layoutTheme:"layoutTheme",bulletColor:"bulletColor",bullerColor:"bullerColor",showBullets:"showBullets",verticalLinesColor:"verticalLinesColor",boards:"boards",enableOfflineAuth:"enableOfflineAuth"},W={grayscale:"grayscale",boldHeaders:"boldHeaders",indentSize:"indentSize",itemPadding:"itemPadding",itemIndentSize:"itemIndentSize",showVerticalLines:"showVerticalLines",fontSize:"fontSize",itemLineHeight:"itemLineHeight",paneHistoryMobile:"paneHistoryMobile"},G=s.default.invertObject({theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",lastTaskSync:"lastTaskSync",lastQuickAddSync:"lastQuickAddSync",disableNotifications:"disableNotifications",notificationDelay:"notificationTime",rootFolderId:"rootFolderId",attachFolderId:"attachFolderId",backupFolderId:"backupFolderId",authScopes:"authScopes",localIntegrity:"localIntegrity",localDataVersion:"localDataVersion",localRecoverVersion:"localRecoverVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",userId:"userId",displayName:"displayName",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",closedImport:"closedImport",closedHelps:"closedHelps",oauthScheme:"oauthScheme",premiumStatus:"zzp",enableOfflineAuth:"enableOfflineAuth",trialStart:"pzs",trialDuration:"pzd",trialExtended:"pze",premiumEndDate:"ped",notifiedTrialOver:"notifiedTrialOver",notifiedTrialEndSoon:"notifiedTrialEndSoon",inTooltipIntro:"inTooltipIntro",keyboardToolbarScroll:"keyboardToolbarScroll",defaultItemPrefix:"defaultItemPrefix",showMarkdown:"showMarkdown",calendarCustomDays:"calendarCustomDays",selectFullItems:"selectFullItems",showFormattingToolbar:"showFormattingToolbar",showImagesInline:"showImagesInline",dayWeekStart:"dayWeekStart",trialOverHidden:"trialOverHidden",bulletOpacity:"bulletOpacity",projectOpacity:"projectOpacity",checkboxOpacity:"checkboxOpacity",checkboxBackgroundOpacity:"checkboxBackgroundOpacity",showVerticalLines:"showVerticalLines",verticalLinesOpacity:"verticalLinesOpacity",boldHeaders:"boldHeaders",itemPadding:"itemPadding",notePadding:"notePadding",itemLineHeight:"itemLineHeight",noteLineHeight:"noteLineHeight",itemIndentSize:"itemIndentSize",fontSize:"fontSize",fontSizeHeader:"fontSizeHeader",fontSizeHeaderTopLevel:"fontSizeHeaderTopLevel",noteFontSize:"noteFontSize",tagColor:"tagColor",dateColor:"dateColor",contactColor:"contactColor",linkColor:"linkColor",underlineP:"underlineP",displaySpacing:"displaySpacing",displayPrefixes:"displayPrefixes",grayscale:"grayscale",helpState:"helpState",localPaneState:"localPaneState",selectedBoard:"selectedBoard",paneHistoryMobile:"paneHistoryMobile",cacheSizeRatio:"cacheSizeRatio",monthlyInvoice:"monthlyInvoice",invoiceEmail:"invoiceEmail",invoiceCompany:"invoiceCompany",invoiceAddress:"invoiceAddress",isUnsubscribed:"isUnsubscribed",showSidebar:"showSidebar",sidebarWidth:"sidebarWidth",openEvernoteApp:"openEvernoteApp",closedVideo:"closedVideo",agendaSort:"agendaSort",dateFormat:"dateFormat",lastBackup:"lastBackup",needsBackup:"needsBackup",backupFrequency:"backupFrequency",encryptionKey:"encryptionKey",DefaultGroup:"Default",UISettingsGroup:"UISettings"});let K=(O=class{constructor(){this.backing=p.a,this.waitingText=new U.a,this.documentsObs=new U.a({}),this.errorGapiImport=new U.a,this.showTryAgain=new U.a(!0)}authAndImportDocuments(){this.authAndOpenModal(!0,this.listDocuments)}authAndImportServer(e){this.authAndOpenModal(!1,()=>{this.doAuth().then(t=>{this.showTryAgain.set(!1),this.importServer(t,t=>{o.default.menus.closeModal(n.a.Modals.ImportMoodo),e(t)})})})}authAndOpenModal(e,t){this.waitingText.set("Waiting for authentication...<br><br>You should see a popup window asking you to sign into your Moo.do account. If the popup doesn't open, please try again or contact support if it doesn't work."),t(),o.default.menus.openModal(n.a.Modals.ImportMoodo,{importer:this,backdropClose:!1,withDocuments:e,tryAgain:t})}doAuth(){return new Promise((e,t)=>{H.a.ensureGapi(()=>{if(window.gapi&&window.gapi.auth){var a={client_id:"597847337936.apps.googleusercontent.com",scope:[n.a.GScope.Drive,"https://www.googleapis.com/auth/drive.appdata"].join(" "),immediate:!1,include_granted_scopes:!0,response_type:"token id_token",authuser:-1,prompt:"consent"};window.gapi.client.init({apiKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50"}).then(()=>{window.gapi.auth.authorize(a,a=>{a&&!a.error?e(a):t("Error authorizing Google: "+a.error)})})}else t("Could not load Google APIs")})})}listDocuments(){this.doAuth().then(e=>{this.showTryAgain.set(!1),this.importServer(e,t=>{!0===t?(this.dateTime=Date.now(),this.waitingText.set("Getting documents list..."),this.getDataFromGapi(e,(t,a)=>{window.gapi.client.init({client_id:"597847337936.apps.googleusercontent.com"}).then(()=>{this.token=e,this.settings=t,this.documents=a,this.waitingText.set("",!1),this.documentsObs.set(a)})})):o.default.toasts.pushMessage({text:`Error importing: ${t}`,hold:!0})})}).catch(e=>this.errorGapiImport.set(e))}importWithDocuments(e){let t={};e.forEach(e=>{t[e]=this.documents[e]});try{s.default.PAssert(624,this.settings,"No settings")}catch(a){s.default.reportError(a)}this.settings&&this.importSettings(),o.default.DisplaySettings.init(),this.importDocuments(t),this.boards&&(this.importBoardsToFirebase(this.boards,t),h.a.setSelectedIndex(0,!0))}getDataFromGapi(e,t){var a={maxPageResults:999,maxPages:12,token:e};o.default.remoteAPI().driveFilesList("mimeType='application/vnd.google-apps.drive-sdk.597847337936'",a=>{let i,r={};Promise.all(a.map(t=>new Promise(a=>{this.getDocument(e,t,e=>{if(e&&e.data)if(t.appDataContents){i=this.parseNode(e.data.value.settings);try{s.default.PAssert(625,i,"Failed to parse settings",e.data.value.settings)}catch(n){s.default.reportError(n)}}else if(!t.labels.trashed){let a=this.translateDocument(this.parseNode(e.data),!0);a.id=t.id,a.text=t.title,a.date=new Date(t.createdDate),r[t.id]=a}a()})}))).then(()=>{t(i,r)}).catch(e=>s.default.reportError(e))},e=>{t()},a)}parseNode(e){let t;if("Map"===e.type){let a=e.value;t={id:e.id},Object.keys(a).forEach(e=>{t[e]=this.parseNode(a[e])})}else"List"===e.type?(t=[],e.value.forEach((e,a)=>{t[a]=this.parseNode(e)})):e.json&&(t=void 0!==e.json.value||e.json.ver?e.json.value:e.json);return t}getDocument(e,t,a){let i={token:e};o.default.remoteAPI().realtimeFileGet(t.id,e=>{a(e)},e=>{a()},i)}importDocuments(e){Object.keys(e).forEach(t=>{let a=e[t],i=d.a.create({id:t,text:a.text,rootData:a.root,backing:this.backing});l.a.addDocument(i)})}importSettings(){Object.keys(this.settings).forEach(e=>{let t=this.settings[e];"id"!==e&&Object.keys(t).forEach(a=>{let i=("UISettings"===e?"ui":"Default"!==e&&e)||"";"theme"===a&&(i="ui");let r=t[a];if("workspaces"===a)this.boards=JSON.parse(r);else if("id"!==a){let t="Default"===e||"UISettings"===e?G[a]:a;if(!q[a]&&("Default"!==e||!W[a])&&t){let a=i?o.default.settings[i]:o.default.settings;if(a){let s=a[t];0,s&&(("syncContacts"===t||"syncAccounts"===t||e.startsWith("plugin")&&"isEnabled"===t)&&(r=!1),s.set(r,!1),o.default.settings._save(t,i,r))}}}})})}importBoardsToFirebase(e,t){let a=[],i=0;Object.keys(e).forEach(r=>{if(t[r]){e[r].workspaces.forEach(e=>{e.index=i++,e.panes.forEach(e=>{e.document=r}),l.a.saveBoard(e),a.push(e)})}}),h.a.setBoards(a)}translateDocument(e,t){let a=e.root||e.docRoot;return e.root=this.translateItem(a,t,a,!1),e}translateItem(e,t,a,i,r){let o=n.a.VMLIFlag.None,l={index:r};if(e===a&&(l.isRoot=!0,a=l),Object.keys(e).forEach(r=>{let n=e[r],o=t?z[r]:r;s.default.isArray(n)?n=n.length>0?n.map((e,i)=>this.translateItem(e,t,a,"archivedItems"===o,i)):void 0:s.default.isObject(n)&&(n=this.translateItem(n,t,a,!1)),"archivedItems"===o&&n&&(i?o="items":(a.archivedItems||(a.archivedItems=[]),n.forEach(e=>{e.isArchived=!0,e.parent=a.id}),a.archivedItems.pushArray(n),n=void 0)),o&&n&&(l[o]=n),l.undefined}),l.isComplete&&(o|=n.a.VMLIFlag.Complete,delete l.isComplete),l.isStarred&&(o|=n.a.VMLIFlag.Starred,delete l.isStarred),l.priority&&(o|=l.priority,delete l.priority),l.isNote)o|=n.a.VMLIFlag.Note,delete l.isNote;else try{this.translateItemDate(l)}catch(d){s.default.reportError(d,l.text)}return l.dateFormat||(l.dateFormat="mdy"),delete l.version,delete l.versionText,l.flags=o,l}replaceText(e,t,a){return t&&(t="@"+t+(a?" "+a.durationText:""),e=e.replace(t,n.a.CharDate)),e}translateItemDate(e){if(e.text&&(e.date||e.repeatDate)){let{date:a,duration:i}=F.translateItemDate(e);if(a){let r;if(e.text=e.text.replace(/@(next|soon|later|someday|now)/i,"#$1"),e.text=this.replaceText(e.text,a.text,i),e.text=this.replaceText(e.text,a.origText,i),e.text=this.replaceText(e.text,a.oldText,i),e.text=s.default.trimRight(e.text.replace(/  /g," ")),F.isDateSoft(a.text))delete e.date;else{if(a.type===n.a.DateType.Repeat){let e=a.text||a.origText;r=g.a.parseText(e)}else r=new N.a(new Date(e.date));if(i){let e=Math.round(i.duration);r.setDuration(e)}if(e.text.indexOf("p:GCalendar")>=0){let{attachments:t,parsedText:a}=B.a.parseText(e.text);if(t.length>0){let a=t[0];r.gcalId=a.id;let i="\u2001p:"+a.p+",id:"+a.id+(a.calendarID?"(?:,calendarID:"+a.calendarID+")":"")+"\u2001";e.text=e.text.replace(new RegExp(i),"")}}try{s.default.PAssert(626,r,"Was not able to import date",a)}catch(t){s.default.reportError(t)}r&&(e.date=r.toData())}delete e.dateText,delete e.dateFormat,delete e.repeatDate}}}importServer(e,t){var a,i;if(this.waitingText.set("Importing user data..."),e&&e.id_token){var r=e.id_token,o=r.split(".");try{s.default.PAssert(627,o&&3===o.length&&o[0]&&o[1]&&o[2],"A valid JWT should always have three parts: "+r)}catch(p){s.default.reportError(p)}try{let t=JSON.parse(s.default.b64_to_utf8(o[1]));a=t.email.toLowerCase(),i=t.sub}catch(g){s.default.reportError(g,e.id_token)}}if(a&&i){var l={email:a,gid:i},d={gid:i,id_token:e.id_token,token:e},h=c.a.getDeployVar(n.a.DeployVariable.APIHost);let r=["billingID","gid","inviteCode","invoiceAddress","invoiceCompany","invoiceEmail","joinDate","monthlyInvoice","nextBillingDate","planID","premiumCode","premiumSignupDate","premiumEndDate","premiumStatus","subscriptionID","trialDuration","trialStart","earlyAdopter","isUnsubscribed"];s.default.XHR({type:"POST",url:`https://${h}/private/v1/billing/getFullInfo`,data:l,headers:d,autoRetry:!0,maxRetries:6}).then(async e=>{if(200===e.status){let a=await e.json();if(a){let e=a.data;Object.keys(e).forEach(t=>{r.indexOf(t)<0&&delete e[t]}),e=u.a.userOut(e),V.a.createURL("user/migrateUser",{}).then(a=>{fetch(a,{method:"POST",body:JSON.stringify(e)}).then(e=>{200===e.status?t(!0):t(e.status)})})}else{let a=await e.text();t(!1,a)}}else t(e.status)})}}},r()(O.prototype,"listDocuments",[j.a],Object.getOwnPropertyDescriptor(O.prototype,"listDocuments"),O.prototype),O);t.a=K},105:function(e,t,a){"use strict";t.a=class{constructor(e){this.isLocalOnly=e,this.documents={}}renameDocument(e,t){}}},106:function(e,t,a){"use strict";var i=a(13),r=a(6),s=a(1);t.a=new class{onRemoteChange(e,t,a,n){let o=i.a.getItem(a),l=s.a.ChangeType.Remote;n.parent||t&&(n.parent=t.parent);let d=i.a.getItem(n.parent);if(d){if(r.d.beginAction(),o)32===(32&n.flags)&&!!(o.isDeleted()||n.isDeleted?void 0:o)!==d.hasNote()&&d.setNote(o.isDeleted()||n.isDeleted?void 0:o,l),o.onChangeRemote(n,l);else if(!t||!t.isDeleted){let a=Object.assign({},t,n);(o=i.a.createVMLI(a,{parent:d,changeType:l,documentOwner:e})).onChangeRemoteParentOrIndex({id:a.id,parent:a.parent,index:a.index,flags:a.flags})}r.d.endAction()}}}},107:function(e,t,a){"use strict";var i=a(7),r=a.n(i),s=a(0),n=a(16),o=a(1),l=a(3),d=a(13),h=a(6),c=a(5),u=a(9),p=a(32),g=a(4),f=a(40);var m,v=class{constructor(){this.isLive=!1,this.wasLive=!1,this.seenInPass=!1,this.deadNeedsNotify=!1,this.index=-1,this.width=0,this.height=0,this.offset=0,this.paneObject=void 0,this.cellChanged=new f.a}kill(e){this.isLive=!1,this.index=-1,e?(this.deadNeedsNotify=!1,this.cellChanged.notify()):this.deadNeedsNotify=!0}update(e,t,a,i,r,s){this.seenInPass=!0,this.wasLive=this.isLive,this.deadNeedsNotify=!1,this.isLive&&e===this.index&&t===this.width&&a===this.height&&i===this.offset&&s===this.paneObject||(this.isLive=!0,this.index=e,this.width=t,this.height=a,this.paneObject=s,this.offset=i,this.prevOffset=r,this.cellChanged.notify())}getState(){return{item:this.paneObject&&this.paneObject.id,index:this.index,height:this.height,offset:this.offset,prevOffset:this.prevOffset,deadNeedsNotify:this.deadNeedsNotify,isLive:this.isLive}}},y=a(17),_=a(66),S=a(8);var P=(m=class extends _.a{constructor(e){super(),this._pane=e.pane,this._isOverview=e.isOverview,this._itemsObs=e.itemsObs,this._getItemsList=e.itemsFn,this.minItemSize=e.minItemSize}objectAtIndex(e){var t=this._getItemsList();try{s.default.PAssert(1624,e>=0&&e<t.length,"Invalid item index: "+e,t.length,this._pane.type)}catch(a){s.default.reportError(a)}return t[e]}itemAtIndex(e){var t=this._getItemsList();try{s.default.PAssert(1625,e>=0&&e<t.length,"Invalid item index: "+e,t.length,this._pane.type)}catch(i){s.default.reportError(i)}var a=t[e];return a&&a.item}indexOfItem(e,t,a){for(var i,r=0,n=s.default.isVMLI(e),o=this._getItemsList(),l=0;l<o.length;l++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var d=o[l];if(n){if((d===e||d.item===e)&&(!d.type||"blockItem"===d.type)&&(!t||!d.block||d.block.id===t.id))return l}else{if(d.id===e.id)return l;d.item&&d.item===e.item&&(i||(i=[]),i.push({index:l,item:d}))}}if(i){if(a){var h,c,u=0;for(l=0;l<i.length;l++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var p=Math.abs(i[l].index-a);(isNaN(c)||p<h)&&(c=l,h=p)}return i[c].index}return i[0].index}return-1}handleItemNoteSet(e){this.clearItemInfoForItem(e.item)}},r()(m.prototype,"handleItemNoteSet",[S.a],Object.getOwnPropertyDescriptor(m.prototype,"handleItemNoteSet"),m.prototype),m),I=200,b={None:0,OnScroll:1};var D=class extends P{constructor(e){super(e),this.getHeight=e.heightFn,this.getWidth=e.widthFn,this.hasSetHeightOnce=!1,this.scrollHandler=void 0,this._mobilePadBottom=!1,this.contentSize=new u.a(0),this.paddingBottom=new u.a(0),this._timeoutPointerEvents=void 0,this.disablePointerEvents=new u.a(!1),this._direction=o.a.Direction.None,this._scrollTop=0,this._lastProcessedScrollTop=0,this._itemInfoById={},this._savedScrollOfTop={},this._indexOfTop=0,this._inViewCount=0,this._reactList=void 0,this._isMounted=!1,this._panePadding=0,this.cellsObs=new p.a([]),this.cells=this.cellsObs.get(),this.cellsNew=[],this._tops=[],this.scrollListeners=[],this.offscreenScrollPadding=400,this._phase=b.None,this.init()}_validateCells(){}init(){n.a.binder(this,"onListChanged","_onSettingChanged","_onResize","_onScroll","_handleScroll","handleItemTextChanged","_onTimeoutPointerEvents","_computeRenderItemsBatched","_onSetScrollComplete","_onSetScrollCompleteTimeout","_afterSetScrollComplete","reMount","onImageLoaded")}getID(){return this._pane.id+(this._isOverview?"_o":"")}notifyInit(e){this._pane.setIgnoreRestoreScroll();try{s.default.PAssert(1589,!this._isMounted,"Should not initialize a pane twice")}catch(t){s.default.reportError(t)}this.clearCache(),this.allocateCells(),this.onListChanged(),this._isMounted=!0,this._reactList=e,this._listenToItemsList(this.onListChanged),this._pane.rect.listen(this._onResize),l.default.settings.ui.listen(this._onSettingChanged),this._isOverview||(this._pane.topBoxHeight.listen(this.onListChanged),y.a.listen("imageLoaded",this.onImageLoaded))}notifyUnmounted(){n.a.destroy(this),this._isMounted=!1,this.isDelayingMounts=!1,this._unlistenToItemsList(this.onListChanged),this._pane.rect.unlisten(this._onResize),l.default.settings.ui.unlisten(this._onSettingChanged),this._isOverview||(this._pane.topBoxHeight.unlisten(this.onListChanged),y.a.unlisten("imageLoaded",this.onImageLoaded)),clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this.removeNativeScrollListener(this._onScroll),this._reactList=void 0,s.default.clearTimeoutOnce("afterScroll"+this.getID()),s.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._isOverview||(this._pane=void 0)}allocateCells(){var e=this.cells.length,t=Math.ceil((c.a.windowHeight()+2*this.offscreenScrollPadding)/this.minItemSize())+4;if(t>e){for(var a=0,i=this.cells,r=e;r<t;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=new v;i.push(s)}this.cellsObs.set(i),this.cells=this.cellsObs.get()}}setupScroller(e,t){this.scrollElement=e,this.addNativeScrollListener(this._onScroll)}clearItemInfoForItem(e){var t=this._pane.getPaneObjectsForItem(e),a=this._itemInfoById;if(t)for(var i=0,r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t[r];a[s.id]&&(a[s.id].needsUpdate=!0)}}handleItemTextChanged(e){try{s.default.PAssert(1590,!this._isOverview,"Overviews should never listen to text changes")}catch(r){s.default.reportError(r)}var t=this._pane,a=!1;if(t&&t.isViewText())if(t.isItemInPane(e)){var i=this.indexOfItem(e);this.checkHeightChanged(e,i)&&(this.clearItemInfoForItem(e),a=!0)}else this.clearItemInfoForItem(e);return a}getElementAtIndex(e){return this._reactList.getElementAtIndex(e)}isIndexMounted(e){return this._reactList.isIndexMounted(e)}hasItems(){return this._getItemsList().length>0}numItems(){return this._getItemsList().length}indexOfTop(){return this._indexOfTop}inViewCount(){return this._inViewCount}objectAtTop(){var e=this._getItemsList(),t=this.indexOfTop(),a=t>=0&&t<e.length;try{s.default.PAssert(1591,a,"Item at top is not in range",t,e.length)}catch(i){s.default.reportError(i)}return e[t]}itemAtTop(){var e=this.objectAtTop();return e&&e.item}indexPageUp(e){for(var t=0,a=this.size.height,i=0,r=e-1;r>=0;--r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if((i+=this._sizes[r])>a)return r+1}return 0}indexPageDown(e){for(var t=0,a=this.size.height,i=0,r=this._sizes.length,s=e;s<r;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if((i+=this._sizes[s])>a)return s}return Math.max(r-1,0)}_listenToItemsList(e){this._itemsObs.listen(e)}_unlistenToItemsList(e){this._itemsObs.unlisten(e)}sizeAtIndex(e){return this._pane.sizeAtIndex(e,this._isOverview)}addNativeScrollListener(e){c.a.addPassiveListener(this.scrollElement,"scroll",e)}removeNativeScrollListener(e){this.scrollElement&&this.scrollElement.removeEventListener("scroll",e)}addScrollListener(e){this.scrollListeners.push(e)}removeScrollListener(e){try{s.default.PAssert(1592,this.hasScrollListener(e),"Removing a listener that does not exist")}catch(t){s.default.reportError(t)}this.scrollListeners.remove(e)}hasScrollListener(e){return this.scrollListeners.indexOf(e)>=0}refreshScrollListener(){}getScrollOffset(){if(this._isMounted){if(this.scrollElement){var e=this._pane.orientation.get()===o.a.Orientation.Vertical?"scrollTop":"scrollLeft";return this.scrollElement[e]}return 0}return 0}getScrollSize(){var e=this._pane.orientation.get()===o.a.Orientation.Vertical?this.getHeight():this.getWidth();return Math.max(Math.max(this.contentSize.get(),e)+(s.default.noPanePadding?0:I),0)}getMaxScrollOffset(){var e=this._pane.orientation.get()===o.a.Orientation.Vertical?this.getHeight():this.getWidth();return Math.max(this.getScrollSize()-e,0)}setScrollOffset(e,t,a){try{s.default.PAssert(1593,this.scrollElement,"Pane must have loaded a scrollable element")}catch(h){s.default.reportError(h)}try{s.default.PAssert(1594,s.default.isNumber(e),"Must supply a valid scroll offset")}catch(h){s.default.reportError(h)}if(this.scrollElement&&this._pane){if(this._pane.isFakePane)return;t=t||o.a.ScrollDuration.Snap;var i=this.getScrollOffset(),r=this.getMaxScrollOffset();if(e<0?e=0:e>r&&(e=r),e=Math.floor(e),this._isMounted&&this._scrollingTo!==e){this._scrollingTo=t?e:void 0,this._isSettingScroll=!0;var n,l,d=this._pane.orientation.get()===o.a.Orientation.Vertical;n=d?void 0:e,l=d?e:void 0,s.default.scrollTo(n,l,t,this.scrollElement,()=>{this._onSetScrollComplete(),a&&a()})}else s.default.timeoutOnce("setScrollComplete_"+this.getID(),this._onSetScrollComplete,0),a&&a();return e-i}}_onSetScrollComplete(){this._restoringScroll?this._afterSetScrollComplete():s.default.timeoutOnce("scrollCompleteTimeout_"+this.getID(),this._onSetScrollCompleteTimeout,60)}_onSetScrollCompleteTimeout(){this._isMounted&&this.saveScrollOfTop(!0,!0),this._afterSetScrollComplete()}_afterSetScrollComplete(){this._scrollingTo=void 0,this._isSettingScroll=!1}_computeContentSize(e){var t=0,a=this.getPaddingTop(),i=a,r=this._getItemsList(),n=this._pane.getItem().levelsDeep.get();this._sizes=[],this._tops=[];for(var o=0;o<r.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l,d=r[o],h=r[o].item,c=s.default.isVMLI(h),u=this._itemInfoById[d.id],p=c?h.levelsDeep.get()-n:void 0;u&&!u.needsUpdate&&u.levelsDeep===p&&void 0===d.sizePad?l=u.size:(l=this.sizeAtIndex(o),u=this._itemInfoById[d.id]={size:l,levelsDeep:p,paneObject:d,needsUpdate:!1}),this._sizes[o]=l,this._tops[o]=o>0?this._tops[o-1]+this._sizes[o-1]:a,u.previousTop=u.top,u.top=this._tops[o],i+=u.size}return this.contentSize.set(i,e),i}flushTimeoutPointerEvents(){this._timeoutPointerEvents&&(clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this._onTimeoutPointerEvents())}_onTimeoutPointerEvents(){this._pane.isDestroyed()||(this.disablePointerEvents.set(!1),this.killAllDeadCells(),this._isSettingScroll||this._wasSettingScroll||this.saveScrollOfTop(),this._scrollingTo=void 0,this._wasSettingScroll=!1)}reMount(){this.isDelayingMounts=!1,this.fireEvent("reMount",[])}_onScroll(e){var t=0;if(!e||!s.default.findParent(e.target,"preventScrollPropagate")){this._restoringScroll&&!this._isSettingScroll||(this._prevScrollTop=this._scrollTop,this._scrollTop=this.getScrollOffset(),this._handleScroll());for(var a=0;a<this.scrollListeners.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.scrollListeners[a](e)}}}_handleScroll(){if(this._phase=b.OnScroll,g.a.isMouseDown()||(this._prevScrollTop!==this._scrollTop&&this.disablePointerEvents.set(!0),this._timeoutPointerEvents&&clearTimeout(this._timeoutPointerEvents),this._wasSettingScroll=this._isSettingScroll,this._timeoutPointerEvents=setTimeout(this._onTimeoutPointerEvents,50),0===this._scrollTop&&0!==this._prevScrollTop&&this.saveScrollOfTop()),g.a.isMouseDown()||(this.isDelayingMounts=!0,s.default.timeoutOnce("afterScroll"+this.getID(),this.reMount,150)),l.default.tooltip.hideTip(),g.a.hoveredItem&&g.a.setHovered(this,null,null),this._scrollTop!==this._prevScrollTop){this._direction=this._scrollTop>this._prevScrollTop?o.a.Direction.Down:o.a.Direction.Up;var e=Math.abs(this._scrollTop-this._lastProcessedScrollTop);this.alwaysRenderScroll||e>=this.offscreenScrollPadding/2?(this._lastProcessedScrollTop=this._scrollTop,this._computeRenderItems()):this.updateTopIndex()}this.scrollHandler&&this.scrollHandler(this._scrollTop),this._phase=b.None}_updateSize(){this.size={width:this._pane.getWidth(),height:this._pane.getHeight()}}onListChanged(){if(this._needsResize)return this._needsResize=!1,void this._onResize(void 0,void 0,!0);this.rect=this._pane.rect.get(),this._updateSize(),this.killAllDeadCells(),this._computeContentSize(!1),this._computeRenderItems(this._isMounted)}_onSettingChanged(){this._needsResize=!0,s.default.timeoutOnce("listSettingChanged_"+this.getID(),this._onResize,0,void 0,void 0,!0)}_onResize(e,t,a){if(!l.default.PaneManager.isResizingPane){s.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._needsResize=!1;var i=this.rect?this.rect.width:-1,r=this.rect?this.rect.height:-1;a||e&&(e.width!==i||e.height!==r)?(this.saveScrollOfTop(),this._updateSize(),this.clearCache(),this.allocateCells(),s.default.setItemAnimationMode(o.a.ItemAnimationMode.None),this.onListChanged(),s.default.resetItemAnimationMode(),g.a.getPane()===this._pane&&g.a.updateCaret()):this._updateSize()}}saveScrollOfTop(e,t){if(this._savedScrollOfTop,!this._pane.isViewCalendar()&&this.numItems()>0&&(t||!this._pane.isIgnoringRestoreScroll())){for(var a,i,r=0,s=[],n=this.numItems(),o=e?this.getScrollOffset():this._scrollTop,l=this._indexOfTop;l<Math.min(this._indexOfTop+this._inViewCount-1,n);l++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a=this.objectAtIndex(l),(i=o-this.topOfIndex(l))-this._sizes[l]<-this.getPaddingTop()&&s.push({index:l,paneObject:a,scrollOffset:i})}this._savedScrollOfTop.inView=s}}restoreScrollOfTop(){var e=this._savedScrollOfTop;if(!this._pane.isViewCalendar()&&!this._pane.isIgnoringRestoreScroll()&&this._pane._didInitialScroll){if(e&&!s.default.isEmpty(e)){var t=e.inView;if(t)for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t[i];if(this.restoreScroll(r))break}this._restoringScroll||this._pane.scrollToTop(o.a.ScrollDuration.Snap)}this._restoringScroll=!1}}restoreScroll(e){var t=this.indexOfItem(e.paneObject);if(t>=0){var a=Math.max(this.topOfIndex(t)+(e.scrollOffset||0),0),i=this.getMaxScrollOffset();return a>i&&(a=i),this._restoringScroll=!0,this._scrollTop=a,this.setScrollOffset(a,o.a.ScrollDuration.Snap),s.default.animFrameOnce("restoreScroll_"+this.getID(),()=>{this.setScrollOffset(a,o.a.ScrollDuration.Snap)}),!0}return!1}clearCache(){var e=0;this._itemInfoById={};for(var t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&(a.width=a.height=void 0)}}_isInBounds(e,t){var a=!1;return e>this._getPVRBottom()+this.offscreenScrollPadding||t<this._getPVRTop()-this.offscreenScrollPadding||(a=!0),a}getScrollTop(){return this._scrollTop}_getPVRTop(){return this._scrollTop}_getPVRBottom(){return this._scrollTop+(this._pane.orientation.get()===o.a.Orientation.Vertical?this.size.height:this.size.width)}killAllDeadCells(){for(var e=0,t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];!a.isLive&&a.deadNeedsNotify&&a.kill(!0)}}_startCellPassOnCell(e){e.seenInPass=!1}startCellPass(){var e=0;this.cellsCurrent={};for(var t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&(this.cellsCurrent[a.paneObject.id]=a,this._startCellPassOnCell(a))}}_pruneCellPassOnCell(e,t){if(!e.seenInPass||t){var a,i=e.index;(this._phase!==b.OnScroll||this._isInBounds(this._tops[i],this._tops[i]+this._sizes[i]))&&(a=!0),e.kill(a)}}pruneCellPass(){for(var e=0,t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&this._pruneCellPassOnCell(a)}}updateCell(e){var t=this._pane,a=this._getItemsList()[e],i=a.id,r=this.cellsCurrent[i],s=this._isOverview||this._pane.orientation.get()===o.a.Orientation.Vertical,n=this._sizes[e],l=s?t.getContentWidth():n,d=s?n:t.getContentHeight(),h=this._tops[e],c=this._itemInfoById[i],u=c&&c.previousTop;r&&!r.seenInPass?r.update(e,l,d,h,u,a):!r&&this.cellsNew.indexOfWithProperty("index",e)<0&&this.cellsNew.push({index:e,width:l,height:d,offset:h,paneObject:a,prevOffset:u})}_addPassOnCell(e){for(var t,a=0,i=0;i<this.cells.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!this.cells[i].isLive){t=this.cells[i];break}}try{s.default.PAssert(1595,t,"Must always have additional cells to use",c.a.windowHeight())}catch(r){s.default.reportError(r)}t||(t=new v,this.cells.push(t)),t.update(e.index,e.width,e.height,e.offset,e.prevOffset,e.paneObject)}addCellPass(){for(var e=0,t=0;t<this.cellsNew.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cellsNew[t];this._addPassOnCell(a)}this.cellsNew=[]}_isIndexSeen(e){var t=this._getItemsList()[e].id,a=this.cellsCurrent[t];return a&&a.seenInPass}_computeRenderItems(e){s.default.batchRenderUpdates(this._computeRenderItemsBatched,e)}_computeRenderItemsBatched(e){var t,a,i,r,s=0,n=this._getItemsList(),o=0;this.startCellPass(),e&&this.restoreScrollOfTop();for(var l=0;l<n.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(t=this._tops[l],a=this._sizes[l],this._isInBounds(t,t+a))isNaN(i)&&t+a>this._getPVRTop()&&(i=l),this.updateCell(l),!isNaN(i)&&Math.round(t)<this._getPVRBottom()-2&&o++;else if(t>this._getPVRBottom())break}isNaN(i)&&(i=0),this._indexOfTop=i,this._inViewCount=o,g.a.isValid()&&this._pane===g.a.getPane()&&(r=g.a.getStartIndex())<this._sizes.length&&!this._isIndexSeen(r)&&this.updateCell(r),this.pruneCellPass(),this.addCellPass(),this._isSettingScroll||this._phase===b.OnScroll||this.saveScrollOfTop()}updateTopIndex(){for(var e,t,a=0,i=this._getItemsList(),r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e=this._tops[r],t=this._sizes[r],this._isInBounds(e,e+t)&&e+t>this._getPVRTop()){this._indexOfTop=r;break}}}getItemInfo(e){return this._itemInfoById[e]}getItemInfosForItem(e){var t=this._itemInfoById,a=[];if(t[e.id])a.push(t[e.id]);else for(var i in this._itemInfoById)t.hasOwnProperty(i)&&t[i].paneObject.item===e&&a.push(t[i]);return a}topOfItem(e){try{s.default.PAssert(1596,e,"Must provide a valid item to measure")}catch(a){s.default.reportError(a)}var t=this.indexOfItem(e);try{s.default.PAssert(1597,t>=0,"Must supply a valid item that is in this pane")}catch(a){s.default.reportError(a)}return this.topOfIndex(t)}topOfIndex(e){try{s.default.PAssert(1598,e>=0,"Must supply a valid index")}catch(t){s.default.reportError(t)}return this._tops[e]}scrollIndexToTop(e,t,a){var i=this.topOfIndex(e),r=this.getScrollOffset();if(i<r||i-r>200)return this.setScrollOffset(i-16,t,a);a&&a()}scrollItemToTop(e,t,a){try{s.default.PAssert(1599,s.default.isVMLI(e),"Must be a valid VMLI instance")}catch(r){s.default.reportError(r)}try{s.default.PAssert(1600,s.default.isNumber(t),"Must have a valid scroll duration")}catch(r){s.default.reportError(r)}var i=this.indexOfItem(e);try{s.default.PAssert(1601,i>=0,"Must supply a valid item that is in this pane")}catch(r){s.default.reportError(r)}return this.scrollIndexToTop(i,t,a)}scrollIndexToMiddle(e,t,a){if(this._isMounted){var i=this.topOfIndex(e),r=this._sizes[e],s=Math.floor(i+r/2-this.getHeight()/2);return this.setScrollOffset(s,t,a)}a&&a()}scrollItemToMiddle(e,t,a){if(this._isMounted){var i=this.indexOfItem(e);if(i>=0)return this.scrollIndexToMiddle(i,t,a)}else a&&a()}scrollItemIntoView(e,t,a){if(this._isMounted){var i=this.indexOfItem(e);return this.scrollIndexIntoView(i,t,a)}a&&a()}scrollIndexIntoView(e,t,a){t=isNaN(t)?o.a.ScrollDuration.Default:t;try{s.default.PAssert(1602,s.default.isNumber(e),"Must supply a valid index")}catch(y){s.default.reportError(y)}try{s.default.PAssert(1603,!a||s.default.isFunction(a),"Must supply a valid callback function")}catch(y){s.default.reportError(y)}var i=this.itemAtIndex(e);try{s.default.PAssert(1604,i,"Item does not exist to scroll to",e,this.numItems())}catch(y){s.default.reportError(y)}if(this._isMounted&&i){var r=this.topOfIndex(e),n=this.getHeight(),d=n;l.default.PaneManager.hasScrollbar()&&(d-=o.a.HorizScrollbarHeight);var h=this.getScrollOffset(),c=h+n,u=this._sizes[e],p=r+u,g=p>c,f=r<h;f&&u>d&&p>=c&&(f=!1);var m,v=0;return f?m=0===r?0:r:g&&(m=p-d),f||g?(v=m-h,this.setScrollOffset(m,t,function(){a&&setTimeout(a,0)})):a&&a(),v}return!1}getPaddingTop(){return this._isOverview?0:this._pane.topBoxHeight.get()}notifyDragStart(){}notifyDragEnd(){}notifySwappedIn(e){isNaN(e)||this.setScrollOffset(e)}addScrollDelta(e){try{s.default.PAssert(1605,this.scrollElement,"Pane must have loaded a scrollable element")}catch(t){s.default.reportError(t)}return this.setScrollOffset(this.getScrollOffset()+e)}setScrollHandler(e){this.scrollHandler=e}setInitialScrollOffset(e){this._scrollTop=e||0}checkHeightChanged(e,t){try{var a=this._pane,i=this.objectAtIndex(t),r=e.sizeInPane(a,t,!1)+(i.sizePad||0),n=this.getItemInfosForItem(e);if(n.length>0&&r!==n[0].size)return this.clearItemInfoForItem(e),!0}catch(o){s.default.reportError(o)}}onImageLoaded(e){if(this._pane.isItemInPane(e)){var t=this.indexOfItem(e);(t<0||this.checkHeightChanged(e,t))&&(this._pane.setIgnoreRestoreScroll(),this.clearItemInfoForItem(e),this._pane.setItemsDirty(),l.default.PaneUpdateBatcher.updateAllItems())}}};var w=class{constructor(e,t,a){this.pane=e,this.contentElement=void 0,this._scrollListenerAttached=!1,this.isVisible=new u.a(t),this.isShowingContents=new u.a(a),this.transform=new u.a(-1),this.cursor=new u.a,this.topItem=void 0,this.dragHoverItem=void 0,this.onTap={onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd},this._infiniteList=new D({pane:e,isOverview:!0,itemsObs:e.headerPaneObjects,itemsFn:e.getHeaders,widthFn:e.getWidth,heightFn:e.getHeight,minItemSize:this.getMinItemSize}),this.init()}init(){n.a.forceBind("onPaneScroll",this),n.a.forceBind("onPaneItemsUpdated",this),y.a.listen("itemsUpdated",this.onPaneItemsUpdated)}destroy(){this.pane=void 0,y.a.unlisten("itemsUpdated",this.onPaneItemsUpdated),n.a.destroy(this)}onPaneLoad(){this.pane.overviewCanTrackScroll&&this.isVisible.get()&&this._attachScrollListener()}getInfiniteList(){return this._infiniteList}getContentElement(){return this.contentElement}getScrollOffset(){this._infiniteList.getScrollOffset()}refreshScrollListener(){this._infiniteList.refreshScrollListener()}onTapStart(e){if(!s.default.hasClass(e.target,"overviewList")&&s.default.findParent(e.target,"overviewList")){var t=s.default.getItemForElement(e.target);t&&(l.default.DragDrop.startDragItem=t)}}onTapMove(e){var t=l.default.DragDrop.startDragItem||l.default.DragDrop.dragItem;t&&t.checkDragOnMove(e,!0)}onTapClick(e){var t=this.pane,a=s.default.getPaneObjectForElement(e.target),i=s.default.getItemForElement(e.target),r=s.default.getElementParent(e.target);if(r&&i!==t&&i!==this&&s.default.findParent(e.target,"overviewList"))try{s.default.PAssert(1562,i,"Element in overview was text but was not an item")}catch(n){s.default.reportError(n)}if(i){try{s.default.PAssert(1563,r,"Item must have an overview element: "+(i.getRawText?i.getRawText():"not an item"))}catch(n){s.default.reportError(n)}r&&(e.clientX-s.default.offset(r).left<t.getPaddingForPaneObject(a,!0)?t.setPaneObjectCollapsed(!t.isPaneObjectCollapsed(a,!0),a,!0):s.default.hasClass(e.target,"overviewOptions")?(l.default.menus.openContextMenu({componentName:"ReactContextMenuOverviewOptions",key:"menu"+i.id+e.clientX+e.clientY,element:e.target,item:i,pane:t,pos:{left:e.pageX,top:e.pageY}}),s.default.preventAndStop(e)):this.pane.allowZoom(i)?(!this.pane.canScrollToItem()||c.a.mac&&e.metaKey||!c.a.mac&&e.ctrlKey||!this.pane.isOverviewVisibleInPane(i)?this.pane.zoomIn(i):this.scrollItemIntoView(i),s.default.sendEvent("Menu","OverviewZoom")):this.pane.performOverviewAction(i))}s.default.preventDefault(e)}onTapEnd(e){var t=l.default.DragDrop.startDragItem||l.default.DragDrop.dragItem;t&&t.checkDragOnEnd(e)}scrollItemIntoView(e){var t=0;this._disablePaneScrollListener=!0;for(var a=e;a&&a!==this.pane.getItem();){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.pane.indexOfItem(a)>=0){this.pane.scrollItemToTop(a,o.a.ScrollDuration.Default);break}a=a.parent()}this.updateTopPaneItem(e),setTimeout(()=>{this._disablePaneScrollListener=!1},2*o.a.ScrollDuration.Default)}setVisibility(e){e&&(g.a.reset(),this._infiniteList.setInitialScrollOffset(0)),e!==this.isVisible.get()&&(this.isVisible.set(e),y.a.fireEvent("panesChanged",[]),l.default.PaneManager.updatePaneStateForPane(this),this.pane.overviewCanTrackScroll&&(e?this._attachScrollListener():this._detachScrollListener()))}setShowingContents(e){this.isShowingContents.set(e),l.default.PaneManager.updatePaneStateForPane(this)}_attachScrollListener(){try{s.default.PAssert(1564,!this._scrollListenerAttached,"Must not double attach scroll listener")}catch(e){s.default.reportError(e)}this._scrollListenerAttached||(this.pane.addScrollListener(this.onPaneScroll),this.onPaneScroll(),this._scrollListenerAttached=!0)}_detachScrollListener(){try{s.default.PAssert(1565,this._scrollListenerAttached,"Must only detach overview listener when already attached")}catch(e){s.default.reportError(e)}this._scrollListenerAttached&&(this.pane.removeScrollListener(this.onPaneScroll),this._scrollListenerAttached=!1)}toggleDesktop(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),h.d.miscAction({type:h.b.Misc,misc:h.a.ToggleOverview,data:{value:this.isVisible.get(),pane:this.pane}})}onPaneScroll(){if(!this._disablePaneScrollListener){try{s.default.PAssert(1566,this.isVisible.get(),"Should not be tracking scroll if overview is not open")}catch(t){s.default.reportError(t)}var e=this.findTopPaneItem();e&&(this.updateTopPaneItem(e),this._infiniteList.scrollItemToMiddle(e,o.a.ScrollDuration.Default))}}findTopPaneItem(){var e=this.pane;if(this.pane.numItems()>0){for(var t,a,i=0,r=this.pane.indexOfTop(),s=e.getRootItem();r>=0&&r<e.numItems()&&!a;){var n=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(t=this.pane.itemAtIndex(r);t&&t!==s&&!a;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._infiniteList.indexOfItem(t)<0?t=t.parent():a=t}a||r++}return!a&&this._infiniteList.numItems()>0&&(a=this._infiniteList.itemAtIndex(0)),a}}updateTopPaneItem(e){var t=this.topItem;this.topItem=e,t&&t.itemChanged.notify(),e.itemChanged.notify()}updateDragHoverItem(e){var t=this.dragHoverItem;this.dragHoverItem=e,t&&t.itemChanged.notify(),e&&e.itemChanged.notify()}onPaneItemsUpdated(e){if(e===this.pane&&this.isVisible.get()&&this.pane.overviewTracksScroll){var t=this.findTopPaneItem();t&&this.updateTopPaneItem(t)}}isItemAtTop(e){return e===this.topItem}isItemDragHovered(e){return e===this.dragHoverItem}getMinItemSize(){return l.default.DisplaySettings.itemLineHeight()+2*l.default.DisplaySettings.itemPadding()}},E=a(49),C=a(47),A=o.a.MatchState;var M,T=class{constructor(e,t,a){var i=0;this.callback=a,this.pane=e,this.searchArr=[],this.matches={},this.previousSearch="",this._stickyMatches={},this._stickyMatchesAwaitingClear=[],this.itemStoreFilter=void 0,this.UI=void 0,this.isFocused=new u.a,this._destroyed=!1,n.a.binder(this,"isMatched","checkChildrenParams","hideNonMatches","handleItemTextChanged","update");var r={priority:{name:"priority",matchFn:this._matchFnPriority.bind(this)},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFn:this._matchFnStarred.bind(this)},project:{name:"project",initialValue:1,icon:"icon-project",tooltip:"projects",matchFn:this._matchFnProject.bind(this)},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFn:this._matchFnTask.bind(this)},complete:{name:"complete",text:"Completed Items",initialValue:-1,defaultValue:-1,icon:"icon-check",tooltip:"completed items",matchFn:this._matchFnComplete.bind(this)},showOnlyMatches:{name:"showOnlyMatches",initialValue:1,icon:"icon-reorder",tooltip:"Flat mode: Show only matching items",canBeNegated:!1,isOption:!0},showOnlyAgendaDates:{name:"showOnlyAgendaDates",initialValue:1,icon:"icon-at",tooltip:"Show only dates on the Agenda",canBeNegated:!1,isOption:!0},showOnlyMatchingTags:{name:"showOnlyMatchingTags",initialValue:1,icon:"icon-short_text",tooltip:"Show only matching tag blocks",canBeNegated:!1,isOption:!0},showChildProjects:{name:"showChildProjects",initialValue:1,icon:"icon-project_half",tooltip:"Show all projects from anywhere in the hierarchy",canBeNegated:!1,isOption:!0}};if(t){!1===t.showHierarchy&&(t.showOnlyMatches=1);var o=t.completeOption;!isNaN(o)&&isNaN(t.complete)&&(t.complete=o<0?1:o-1),0===t.showOnlyTopLevelProjects&&(t.showChildProjects=1)}for(var l=[],d=0;d<e.searchFilters.length;d++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var h=e.searchFilters[d];s.default.isString(h)?l.push(r[h]):l.push(h)}if(this.setupFilters(l,t),this.value=t&&t.text||"",this.onChanged=new f.a(a),this._updateSearchArr(),this.value){var c=E.a.parseText(this.value,C.a.getContacts(),!0,!0,!0);c&&this.onParsed(c)}}destroy(){this._destroyed=!0,this.onChanged.unlisten(this.callback),this.pane=void 0,this.UI=void 0,n.a.destroy(this)}setFilterTooltip(e,t){this.getFilter(e).tooltip=t}getFilterTooltip(e){var t=e.value.get();return t?e.isOption?"<b>Click</b> to clear this option":(t>0?"Showing only":"Hiding")+" "+e.tooltip+".\n<b>Click</b> to clear this "+(e.isOption?"option":"filter."):e.isOption?e.tooltip:"<b>Click</b> to "+(e.initialValue>0?"show only ":"hide ")+e.tooltip+(t!==-e.initialValue?".\n<b>"+c.a.priModKey+" + click</b> to "+(e.initialValue<0?"show only ":"hide ")+e.tooltip+".":"")}setupFilters(e,t){for(var a=0,i=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e[r],o=n.name,l=t?t[o]:void 0,d=n;d.value=new u.a(isNaN(l)?n.defaultValue||0:l),d.enabled=new u.a(void 0===n.enabled||n.enabled);try{s.default.PAssert(1606,!this.hasOwnProperty("filter_"+o),"Should not double define filter properties")}catch(h){s.default.reportError(h)}this["filter_"+o]=d,i.push(d)}this.filters=i}setFilterEnabled(e,t){var a=this.filters.indexOfWithProperty("name",e);a>=0&&this.filters[a].enabled.set(t)}getValue(){return this.value}isFiltered(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.filters[t].value.get())return!0}return!1}getRemoteValue(){for(var e=0,t=this.value,a=0;a<this.filters.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this.filters[a];if(i.remoteStringFn&&i.enabled.get()){var r=i.remoteStringFn(i.value.get());r&&(t+=" "+r)}}return t.trim()}getState(){for(var e=0,t={text:this.getValue(),showHierarchy:this.showHierarchy()},a=0;a<this.filters.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this.filters[a];t[i.name]=i.value.get()}return t}focus(){this.UI.focus()}blur(){this.UI.blur()}onParsed(e){this.tags=e.tags,this.contacts=e.contacts}setValue(e){this.updatingValue=this.value!==e,this.updatingValue&&this.pane.clearPerPaneStateSearch(),this.value=e,this._updateSearchArr(),this.pane.getItemStore().numItems>5e3?s.default.timeoutOnce("searchDebounce",this.update,150,!0):this.update(!0),e&&h.d.miscAction({type:h.b.Misc,misc:h.a.SearchChanged,data:this.getState()}),this.updatingValue=!1}addToValue(e){var t=this.getSelectionOffset(),a=this.value;a.length>0&&"-"!==a[a.length-1]&&"!"!==a[a.length-1]&&(e=" "+e),a+=e,this.setValue(a),this.setSelectionOffset(t+e.length)}toggleText(e,t){var a=this.value.trim(),i="\\B(-*)("+s.default.escapeRegExp(e.toLowerCase())+")\\b",r=a.toLowerCase().match(i);r?(!r[1]&&t||r[1],a=(a.substr(0,r.index)+a.substr(r.index+r[0].length)).replace(/  +/g," ")):a+=" "+(t?"-":"")+e,a=a.trim(),this.setValue(a),this.setSelectionOffset(a.length)}getSelectionOffset(){return this.UI.getSelectionOffset()}setSelectionOffset(e){this.UI.setSelectionOffset(e)}getSearchBox(){return this.UI.refs.searchBox}isSearched(){var e=0;if(this.value.length>0)return!0;for(var t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.filters[t];if(a.enabled.get()&&a.value.get())return!0}}reset(){this.setValue("")}resetFilters(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.filters[t].value.set(0)}this.update(!0,!0)}numUnmatchedItems(){var e=0,t={item:this.pane.getItem(),each:t=>{let a=t.id,i=this.matches[a];i!==A.No&&i!==A.Negated||e++}};return l.default.searchVMLIs(t),e}isFlatSearchResult(e){return!this.showHierarchy()&&this.matches[e.id]===A.Yes}isMatchStateMatch(e){return void 0===e||e===A.Yes||e===A.ChildYes||e===A.Unknown}isMatched(e,t,a){if(this.pane.supportLocalSearch){var i=this.matches[e.id];return a||void 0!==i||!e.hasText()||this.pane.isSettingText||this.pane===s.default.focusedPane||(i=this.checkItem(e)),this.isMatchStateMatch(i)}return A.Yes}handleItemChanged(e){if(l.default.PaneManager.isPaneActive(this.pane.id)){let t,a=this.isMatched(e,!0);if(e.parent()?(this.checkItem(e),t=this.isMatched(e)):t=!1,!t&&a&&(this.isMatchStuck(e)||this.stickMatchAfterSearch(e,!0)),t!=a)return!0}}handleItemTextChanged(e){if(this.getValue()||this.isFiltered())return this.handleItemChanged(e)}_updateSearchArr(){var e=0,t=this.value.toLowerCase().trim().split(/\s+/);this.searchArr=[],this.searchWords=[];for(var a=0,i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i].startsWith("-"),s=r?t[i].substr(1):t[i];s&&"and"!==s&&"-"!==s&&"$"!==s&&(i>0&&("or"===s||"|"===s||"||"===s)?a++:(this.searchArr[a]||(this.searchArr[a]=[]),this.searchArr[a].push({text:s,isNegated:r}),r||this.searchWords.push(s)))}}toggleFilterDefault(e){var t=this["filter_"+e],a=t.value.get();a=a?0:t.initialValue,this.setFilter(e,a)}toggleFilter(e,t){var a=t?-1:1,i=this["filter_"+e].value.get();i=i===a?0:a,this.setFilter(e,i)}getFilter(e){return this["filter_"+e]}getFilterObs(e){var t=this["filter_"+e];return t?t.value:void 0}getFilterValue(e){var t=this["filter_"+e];return t?t.value.get():void 0}setFilter(e,t,a){"showOnlyMatches"===e&&this.clearListCache(),this["filter_"+e].value.set(t,a),this.update(!0,!0),h.d.miscAction({type:h.b.Misc,misc:h.a.SearchChanged,data:this.getState()})}update(e,t,a){this.isRunningSearch=!0,l.default.PaneUpdateBatcher.beginUpdateItems(),(e||t)&&this.clearStickyMatches(),this.pane.supportLocalSearch&&(this.prevMatches=this.matches,this.matches={},this.isAnimatingSearch=a&&!e&&s.default.focusedPane===this.pane,this.checkChildren(),this.prevMatches={}),this.isUpdatingSearch=!0,this.pane.isLoaded&&e&&(s.default.setItemAnimationMode(o.a.ItemAnimationMode.None),this.onChanged.notify(t)),l.default.PaneUpdateBatcher.commitUpdateItems(),setTimeout(()=>{this.isUpdatingSearch=!1,s.default.resetItemAnimationMode()},0),this.isRunningSearch=!1}clearStickyMatches(){this._stickyMatchesAwaitingClear=[],this._stickyMatches={},clearTimeout(this._timeoutHideNonMatches)}_checkMatch(e,t,a){var i=!0;return a===o.a.SearchDates.Overdue||a.startsWith(o.a.SearchDates.Before)||a.startsWith(o.a.SearchDates.After)||a.startsWith(o.a.SearchDates.Date)?i=this._matchDate(e,a):a.length>0&&i&&(i=!1,s.default.isPrefixTask(a)?i=e.isPrefixTask():a!==o.a.Prefix.Bullet&&a!==o.a.Prefix.Bullet2&&a!==o.a.Prefix.Bullet3||(i=e.isPrefixBullet()),i=i||t.indexOf(a)>=0),i}_isMatchStateOk(e){return e===A.Yes||e===A.Unknown||e===A.ChildYes}_matchFilter(e,t){if(e)return t?e>0?A.Unknown:A.Negated:e>0?A.No:A.Unknown}_matchFilters(e){for(var t=0,a=A.Unknown,i=0;i<this.filters.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.filters[i];if(r.matchFn&&r.enabled.get()){var s=r.matchFn(r.value.get(),e);s===A.Unknown||s!==A.Negated&&!this._isMatchStateOk(a)||(a=s)}}return a===A.Yes&&(a=A.Unknown),a}_matchFnComplete(e,t){return 1===e?t.isComplete()?A.Unknown:A.No:-1===e&&t.isComplete()?A.Negated:A.Unknown}_matchFnStarred(e,t){return this._matchFilter(e,t.isStarred())}_matchFnProject(e,t){return this._matchFilter(e,t.isPrefixHeader())}_matchFnTask(e,t){return this._matchFilter(e,t.isPrefixTask())}_matchFnPriority(e,t){var a=t.getPriority();return e>0?a>=e?A.Yes:A.No:A.Unknown}_matchFnEmail(e,t,a){var i=t.getAttachments(),r=i&&i[0],s=r&&r.getPlugin()===l.default.pluginManager.getPluginGmail();return this._matchFilter(e,s)}_matchDate(e,t){var a=e.getNextDate();if(a){let[i,r]=t.split(":"),s="date"===i&&"overdue"===r,n=e.getMooDate(),o=s?new Date:Date.parse(r);if(n.isRepeatDate()){if(s||"before"===i)return n.getFirstDate()<o;if("date"===i)return n.isOnDate(o);if("after"===i)return!!n.getNext(o)}return!o||("before"===i||s)&&a<o||"date"===i&&a.clearTime().equals(o.clearTime())||"after"===i&&a>=o}}checkItem(e,t){var a,i=t&&t.searchExtras,r=i?i.root:this.pane.getRootItem(),n=i?i.showHierarchy:this.showHierarchy(),l=this.matches,d=e.isNote(),h=e.parent();if(e.isDestroyed())return a=A.No;try{s.default.PAssert(1607,h||e.isRootItem(),"Item parent does not exist while being searched",e===r)}catch(L){s.default.reportError(L)}if(this._stickyMatches[e.id])a=A.ChildYes;else if(e.isRootItem())a=A.Yes;else if(h)if(l[h.id]===A.Negated)a=A.Negated;else{var c,u,p,g,f,m,v=[],y=e.getSearchText(this.pane),_=(a=this._matchFilters(e))===A.Negated;if(!_&&this.searchArr.length){var S=0,P=0;for(u=0;u<this.searchArr.length;u++){var I=0;if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;for(m=this.searchArr[u],p=0;p<m.length;p++){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;if((f=m[p]).isNegated){g=f.text;try{s.default.PAssert(1608,g,"Each value in the search array should be valid at this point")}catch(L){s.default.reportError(L)}if(this._checkMatch(e,y,g)){v[u]=A.Negated,_=!0,P++;break}}}}P===this.searchArr.length&&(a=A.Negated)}if(this.isMatchStateMatch(a)){var b=0,D=0;for(u=0;u<this.searchArr.length;u++){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;if(v[u]!==A.Negated){var w=0;for(m=this.searchArr[u],p=0;p<m.length;p++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;g=(f=m[p]).text;try{s.default.PAssert(1609,g,"Each value in the search array should be valid at this point")}catch(L){s.default.reportError(L)}if(!f.isNegated)if(this._checkMatch(e,y,g))v[u]=A.Yes;else if(n){var E=0;for(c=e;c;){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;if(!(c=c.parent())||c===r){v[u]=A.No;break}if(this._checkMatch(c,c.getSearchText(),g))break}}else v[u]=A.No;if(v[u]===A.No)break}}}var C=!1;for(u=0;u<v.length;u++){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;if(C=v[u]===A.Yes,a===A.Unknown&&v[u]===A.Negated)a=A.Negated;else if(a!==A.Yes&&v[u]===A.No)a=A.No;else if(v[u]===A.Yes||v[u]===A.Unknown){a=A.Yes;break}}if(C&&this.updatingValue&&this.getValue()){var M=0;for(c=h;c;){if(M++>5e3&&__infLoop&&__infLoop(M))throw new RangeError;c.isCollapsed(this.pane,!1,!0)&&this.pane.setPerPaneState(c.id,o.a.PerPaneStateField.CollapsedSearch,!1),c=c.parent()}}a===A.Unknown&&(a=A.Yes)}if(!_&&this.pane.shouldSearchMatchParents&&h!==r&&n&&l[h.id]===A.Yes)return l[e.id]=A.Yes,l[e.id];a===A.No&&d&&(a=l[h.id])}else a=A.No;if(this.isMatchStateMatch(a)&&this.onlyMatchDates&&!this.pane.isOkOnAgenda(e)&&(a=A.No),a===A.Yes){if(n){var T=0;for(c=h;c&&!c.isRootItem()&&l[c.id]!==A.Negated&&l[c.id]!==A.Yes;){if(T++>5e3&&__infLoop&&__infLoop(T))throw new RangeError;l[c.id]=A.ChildYes,c.hasNote()&&(l[c.getNote().id]=A.Yes),c=c.parent()}}d&&(l[h.id]=A.Yes)}return l[e.id]=a,l[e.id]}checkChildrenParams(e,t){return this.checkItem(e,t)!==A.Negated}checkChildren(){let e={includeNotes:!0,comparator:this.checkChildrenParams,searchExtras:{root:this.pane.getRootItem(),showHierarchy:this.showHierarchy()}};if(this.itemStoreFilter&&(e.itemStoreFilter=this.itemStoreFilter),this.pane.getItemStore()!==l.default.itemStoreManager.getDefaultItemStore()?e.itemStore=this.pane.getItemStore():e.item=this.pane.getItem(),l.default.searchVMLIs(e),this.isAnimatingSearch)for(var t in this.matches)if(this.matches.hasOwnProperty(t)&&void 0!==this.prevMatches[t]&&this.isMatchStateMatch(this.prevMatches[t])&&!this.isMatchStateMatch(this.matches[t])){var a=d.a.getItem(t);a&&!this.isMatchStuck(a)&&this.stickMatchAfterSearch(a,this.prevMatches[a.id])}}_getMatchedItem(e){return this._stickyMatches[e.id]||e}getItemDate(e){var t=this._stickyMatches[e.id];return t&&t.date}getItemRepeatDate(e){var t=this._stickyMatches[e.id];return t&&t.repeatDate}getItemDateText(e){var t=this._stickyMatches[e.id];return t&&t.dateText}getItemDuration(e){var t=this._stickyMatches[e.id];return t&&t.duration}getItemTagsLower(e){var t=this._stickyMatches[e.id];return t&&t.tagsLower}getItemContacts(e){var t=this._stickyMatches[e.id];return t&&t.contacts}getItemSearchText(e){var t=this._stickyMatches[e.id];return t&&t.searchText}getItemPrefix(e){var t=this._stickyMatches[e.id];return t&&t.prefix}getItemPriority(e){var t=this._stickyMatches[e.id];return t&&t.priority}getItemStarred(e){var t=this._stickyMatches[e.id];return t&&t.isStarred}stickMatch(e,t){var a=s.default.isVMLI(e)?e:e.item;if(!this._stickyMatches[a.id]){this.matches[a.id]=A.Yes;var i=a.getStickySearchInfo();t&&(i.isHiding=!0),s.default.isInCompleteAction()&&(i.wasCompleted=!0),this._stickyMatches[a.id]=i}}isMatchStuck(e){var t=s.default.isVMLI(e)?e:e.item;return!!this._stickyMatches[t.id]}unstickMatch(e){var t=s.default.isVMLI(e)?e:e.item,a=this._stickyMatches[t.id];if(a){var i=t.getStickySearchInfo();return delete this._stickyMatches[t.id],!s.default.deepEqual(a,i)}return!1}isMatchStuckHiding(e){var t=s.default.isVMLI(e)?e:e.item,a=this._stickyMatches[t.id];return a&&a.isHiding}stickMatchAfterSearch(e,t){this.stickMatch(e,!0),t&&(this._timeoutHideNonMatches&&clearTimeout(this._timeoutHideNonMatches),this._stickyMatchesAwaitingClear.push(e),this._timeoutHideNonMatches=setTimeout(this.hideNonMatches,1500))}hideNonMatches(){if(!this._destroyed){var e=this.pane,t=this._stickyMatchesAwaitingClear,a=t.length,i=0;if(a>0){for(var r=0,n=0;n<a;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var d=t[n],h=this._stickyMatches[d.id];h&&h.wasCompleted&&i++,this.unstickMatch(d)}var c=a+(a>1?" items":" item"),u={hold:!1};this.pane===s.default.focusedPane&&(i!==a?(u.text=c+" hidden because "+(a>1?"they do":"it does")+" not match search",u.actionText="UNHIDE",u.action=()=>{if(e&&e.setIgnoreRestoreScroll){var i=0;let n=g.a.save();e.setIgnoreRestoreScroll();for(var r=0;r<a;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t[r];this.stickMatch(s),this._stickyMatchesAwaitingClear.push(s)}this.pane.updateItemsImmediate(!0,void 0,void 0,!0),g.a.restore(n)}}):(u.text=c+" completed",u.actionText="UNDO",u.action=()=>{var i=0;let r=g.a.save();e.setIgnoreRestoreScroll();for(var s=0;s<a;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t[s].setComplete(!1,o.a.ChangeType.Local)}this.pane.updateItemsImmediate(!0,void 0,void 0,!0),g.a.restore(r)}),l.default.toasts.pushMessage(u));let p=g.a.save();this._stickyMatchesAwaitingClear=[],e.setIgnoreRestoreScroll(),e.updateItemsImmediate(!0,void 0,void 0,!0),p&&p.pane===this.pane&&g.a.restore(p)}}}showHierarchy(){return this.pane.type!==o.a.PaneMode.Task||this.pane.getViewMode()!==o.a.TaskViewMode.List_Flat&&1!==this.getFilterValue("showOnlyMatches")}setShowHierarchy(e){this.pane.supportSearchFlat&&this.setFilter("showOnlyMatches",e?0:1)}showOnlyAgendaDates(){return this.pane.type===o.a.PaneMode.Task&&this.getFilterValue("showOnlyAgendaDates")}showOnlyMatchingTags(){return this.pane.type===o.a.PaneMode.Task&&this.getFilterValue("showOnlyMatchingTags")}showChildProjects(){return this.pane.type===o.a.PaneMode.Task&&this.getFilterValue("showChildProjects")}clearListCache(){this.pane.getInfiniteList().clearCache()}getTags(){return this.tags}getContacts(){return this.contacts}getSearchWords(){return this.searchWords}shouldHighlightSearch(){return this.isFocused.get()&&this.getValue()}},L=a(25),x=a(44),k=a(62),R=a(39),O=a(147),F=a(61),N=a(19),B=a(36),U=a(31),H=0,V=["collapser","itemParents","itemCheckbox","agendaTime","itemMenuIcon","vertLines","itemTime"];let j=(M=class{constructor(e,t={}){this.__ISPANE=!0,n.a.binder(this,"getItems","getHeaders","updateItems","getWidth","getHeight","compositionStart","compositionEnd","onShowArchivedChanged","zoomInOnSwipe","collapseOnSwipe","deleteOnSwipe","completeOnSwipe","onClickRefreshData","getSwipeMenuItemsNew","getMinItemSize"),this.title=t.title,this._createProps(t,{contextMenuMode:o.a.ContextMenuMode.Default,paneEmptyMessage:"Start typing to get started",paneEmptySearchMessage:"No search results",titleContextMenuHeader:"Zoom to item",searchFilters:[],dropEffect:function(){return o.a.DropEffect.Move},isWriteable:!0,isEditable:!1,isDraggable:!0,isDropTarget:!0,hasNonVMLIs:!1,canAddItem:!0,overrideCopyBehavior:!0,supportMenuIcon:!1,supportCollapsing:!0,supportCompleting:!0,supportCheckbox:!1,supportIndent:!0,supportOffline:!0,supportPerformArchive:!0,supportDataRefresh:!1,supportReportError:!1,supportCompose:!1,supportPagination:!1,supportVertLines:!0,supportStarClick:!1,supportSearchItemAutocomplete:!0,supportSearchListenTextChanges:!0,supportSearchFlat:!0,supportLocalSearch:!0,supportClone:!0,supportDates:!0,supportMultiselect:!0,supportDeferredItemLoad:!1,supportCellTransition:!0,supportViewMenu:!1,useLineCache:!0,supportSel:!0,shouldSearchMatchParents:!0,shouldUpdateOnTextChanged:!0,noOverviewStyle:!1,supportClickOverviewScroll:!0,overviewTracksScroll:!0,overviewHasPaneItems:!0,overviewPadLevels:0,minWidth:o.a.StdPaneWidthMin,minWidthFlex:o.a.StdPaneWidthMin,maxWidth:o.a.PaneWidthMax,maxWidthFlex:o.a.StdPaneWidthMax,maxWidthSingle:o.a.StdPaneWidthMax,widthBiggerInSingle:!0,collapsedFieldName:o.a.PerPaneStateField.Collapsed,hasMoreButtons:!0,supportsDocuments:!0,_topBoxHeight:s.default.activeDisplayMode&o.a.DisplayMode.NoPaneTop?0:36}),this.blockNoKey="",this.topBoxHeight=new u.a(this._topBoxHeight),this.rect=new u.a(e.rect),this.isExpanded=new u.a(!1);try{s.default.PAssert(1234,void 0!==e.id,"Must supply a valid pane id")}catch(a){s.default.reportError(a)}this.id=e.id,this.uniquePaneID=H++,this.isFakePane=e.isFakePane,this.plugin=e.plugin,e.document&&s.default.isString(e.document)&&(e.document=d.a.getDocumentById(e.document)),this.document=new u.a(e.document),this.documentSortMode=new u.a(e.documentSortMode||o.a.DocumentSortMode.Modified,this.saveState),e.item||(this.supportDeferredItemLoad?(e.item=this.getDefaultDisplayItem(),this.deferredItemState={itemID:e.deferredItemID,search:e.search,offset:0}):(e.item=this.getDefaultDisplayItem(),e.search=e.search||"")),this.name=new u.a(e.name),this.item=new u.a(e.item),this.items=new p.a,this.headersArr=[],this.headerPaneObjects=new p.a,this.paneObjectsByItem={},this.isDefaultPane=e.isDefaultPane,this.initialOffset=e.offset,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.onDestroyed=new f.a,this.showArchived=new u.a(!1),this.onItemTextChanged=new f.a,this._panePadding=0,this.paneTopText=new u.a,this.toast=new u.a,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new u.a(!1),this.isFocused=new u.a(!1),this.caretPosition=new u.a,this.widthManual=e.widthManual,this.widthManualExpanded=e.widthManualExpanded,this.isReady=new u.a(!this.plugin||this.plugin.isReady()),this.isActive=new u.a(!0),this.hasBeenActive=this.isActive.get(),this.hasCollapsedObs=new u.a,this._infiniteList=new D({pane:this,offset:e.offset||0,isOverview:!1,itemsObs:this.items,itemsFn:this.getItems,widthFn:this.getWidth,heightFn:this.getHeight,intialOffset:this.initialOffset,minItemSize:this.getMinItemSize}),this.isLoadingNewPage=new u.a(!1),this.orientation=new u.a(o.a.Orientation.Vertical),this.showScrollbars=new u.a(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},this.defaultOffset=0,this.onTap={onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd,onDoubleClick:this.onTapDoubleClick,onRightClick:this.onTapRightClick},this.showArchived.listen(this.onShowArchivedChanged),this.search=new T(this,e.search,this.onSearchChanged.bind(this)),this.overview=new w(this,e.isOverviewVisible,e.isOverviewShowingContents),this.constructorExtra&&this.constructorExtra()}_createProps(e,t){Object.keys(t).forEach(a=>{this[a]=void 0!==e[a]?e[a]:t[a]})}init(){let e=this.getItem(!0);e&&this.setItem(e,!1),this.plugin&&this.plugin.notifyPaneCreated()}isDestroyed(){return this._destroyed}getStats(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}}becomeReal(){}activate(){try{s.default.PAssert(1235,!1,"Activating panes should only ever happen on mobile devices")}catch(e){s.default.reportError(e)}this.isActive.get()||(this.isActive.set(!0),this.hasBeenActive=!0,this.updateItemsImmediate(!0,!1))}deactivate(){try{s.default.PAssert(1236,!1,"Deactivating panes should only ever happen on mobile devices")}catch(e){s.default.reportError(e)}this.isActive.set(!1)}unload(){this._isUnloaded=!0}isUnloaded(){return this._isUnloaded}destroy(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(),this.showArchived.unlisten(this.onShowArchivedChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this._onAfterLoadedRAF&&(cancelAnimationFrame(this._onAfterLoadedRAF),this._onAfterLoadedRAF=void 0),this.isLoaded&&this.getItemStore()===l.default.itemStoreManager.getDefaultItemStore()&&y.a.unlisten("itemNoteSet",this._infiniteList.handleItemNoteSet),this._infiniteList=void 0;try{s.default.PAssert(1237,s.default.focusedPane!==this,"Globally focused pane should never be the one destroyed")}catch(e){s.default.reportError(e)}try{s.default.PAssert(1238,g.a.getPane()!==this,"Selection focused pane should never be the one destroyed")}catch(e){s.default.reportError(e)}try{s.default.PAssert(1239,!l.default.PaneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}catch(e){s.default.reportError(e)}this.onDestroyed.notify()}notifyPluginLoaded(){try{s.default.PAssert(1240,!1,"Plugin load notification not supported by pane type: ",this.type)}catch(e){s.default.reportError(e)}}getContextMenuMode(){return this.contextMenuMode}isItemDraggable(){return this.isDraggable}isOkOnAgenda(e){return!1}getInfiniteList(e){var t;if(e){var a=this.getOverview();try{s.default.PAssert(1241,a,"Trying to get infinite list for overview that doesnt exist.")}catch(i){s.default.reportError(i)}a&&(t=a.getInfiniteList())}else t=this._infiniteList;return t}getItemStore(){return this.getRootItem().getItemStore()}usesItemStore(e,t){return(!this.supportsDocuments||!t||t.getDocumentOwner()===this.getDocument())&&(e===this.getItemStore()||!!this._activeItemStores[e.id])}useItemStore(e){try{s.default.PAssert(1242,!this._activeItemStores[e.id],"Should never use the same store twice")}catch(t){s.default.reportError(t)}this._activeItemStores[e.id]=e}stopUsingItemStore(e){try{s.default.PAssert(1243,this._activeItemStores[e.id],"Must be using item store to stop using it")}catch(t){s.default.reportError(t)}delete this._activeItemStores[e.id]}getOverview(){return this.overview}isOverviewVisible(){return this.overview.isVisible.get()}isOverviewShowingContents(){return this.overview.isShowingContents.get()}numItems(){return this.getItems().length}numHeaders(){return this.headersArr.length}getItems(){return l.default.PaneUpdateBatcher.flushItemsUpdate(this),this.items.get()}getHeaders(){return this.headerPaneObjects.get()}itemAtIndex(e){return this._infiniteList.itemAtIndex(e)}objectAtIndex(e){return this._infiniteList.objectAtIndex(e)}indexOfItem(e,t,a){return this._infiniteList.indexOfItem(e,t,a)}indexOfObject(e){return this._infiniteList.indexOfItem(e)}topOfItem(e){return this._infiniteList.topOfItem(e)}topOfIndex(e){return this._infiniteList.topOfIndex(e)}indexOfTop(){return this._infiniteList.indexOfTop()}inViewCount(){return this._infiniteList.inViewCount()}itemAtTop(){return this._infiniteList.itemAtTop()}elementAtIndex(e){return this._infiniteList.getElementAtIndex(e)}isIndexMounted(e){return this._infiniteList.isIndexMounted(e)}notifyDragStart(){return this._infiniteList.notifyDragStart()}notifyDragEnd(){return this._infiniteList.notifyDragEnd()}notifySwappedIn(e){return this._infiniteList.notifySwappedIn(e)}getScrollOffset(){return this._infiniteList.getScrollOffset()}addScrollListener(e){return this._infiniteList.addScrollListener(e)}removeScrollListener(e){return this._infiniteList.removeScrollListener(e)}refreshScrollListener(){return this._infiniteList.refreshScrollListener()}setScrollOffset(e,t,a){return this._infiniteList.setScrollOffset(e,t,a)}scrollIndexIntoView(e,t,a){return this._infiniteList.scrollIndexIntoView(e,t,a)}scrollItemIntoView(e,t,a){return this._infiniteList.scrollItemIntoView(e,t,a)}scrollIndexToTop(e,t,a){return this._infiniteList.scrollIndexToTop(e,t,a)}scrollItemToTop(e,t,a){return this._infiniteList.scrollItemToTop(e,t,a)}scrollItemToMiddle(e,t,a){return this._infiniteList.scrollItemToMiddle(e,t,a)}scrollIndexToMiddle(e,t,a){return this._infiniteList.scrollIndexToMiddle(e,t,a)}addScrollDelta(e){return!!this._infiniteList&&this._infiniteList.addScrollDelta(e)}getScrollTop(){return this._infiniteList.getScrollTop()}closestIndexOfObject(e){return this.indexOfObject(e)}sizeAtIndex(e,t){var a=0,i=t?this.overview._infiniteList:this._infiniteList;try{s.default.PAssert(1245,i,"Must have a valid owner")}catch(n){s.default.reportError(n)}if(i){var r=i.objectAtIndex(e);try{s.default.PAssert(1246,r,"Must have found a valid item")}catch(n){s.default.reportError(n)}r&&(a=this.sizeOfItem(r,e,t))}return a}sizeOfItem(e,t,a){try{s.default.PAssert(1247,e,"Must provide a valid item to measure")}catch(n){s.default.reportError(n)}var i=0,r=e.sizeInPane;return void 0!==r&&(i=isNaN(r)?e.sizeInPane(this,t,a):r,e.sizePad&&(i+=e.sizePad)),i}handleStatusClick(){}_getLoadingMessage(){return"Loading..."}getStatusMessage(e){var t;return e||(this.isLoading.get()?t=this._getLoadingMessage():0===this.numItems()?t=this.isSearched()&&this._allPaneItems.length>0?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(t=this._getNotReadyStatus())),t}_getNotReadyStatus(){return"Pane data is only available while online."}getSaveInfoForClone(){var e=this.getSaveInfo();for(var t in delete e.id,e)e.hasOwnProperty(t)&&s.default.isObject(e[t])&&(e[t]=s.default.clone(e[t]));return e}getSaveInfo(){let e=this.document.get();return{id:this.id,name:this.name.get(),item:this.item.get().id,document:e?e.id:void 0,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),offset:this.getScrollOffset(),itemState:this.getSaveInfoItemState(),isOverviewVisible:this.overview.isVisible.get(),isOverviewShowingContents:this.overview.isShowingContents.get(),isExpanded:this.isExpanded.get(),widthManual:this.widthManual,widthManualExpanded:this.widthManualExpanded,documentSortMode:this.documentSortMode.get()}}getSaveInfoItemState(){var e=this._perPaneState,t={};for(var a in e)if(e.hasOwnProperty(a)){var i=d.a.getItem(a);if(i){var r=e[a];for(var s in r)if(r.hasOwnProperty(s)&&s.startsWith(o.a.PerPaneStateField.Collapsed)){var n=r[s];if(void 0!==n){var l=s.replace(o.a.PerPaneStateField.Collapsed,"");if("Search"===l||n!==this.getCollapsedDefault(i,"Overview"===l,l)||!n&&i.isDemandLoad()){var h=(r[s]?"":"un")+s;t[h]||(t[h]=[]),t[h].push(a)}}}}else delete e[a]}return t}saveState(){l.default.PaneManager.updatePaneStateForPane(this)}getPerPaneState(e,t){let a=this._perPaneState[e];if(a)return a[t]}setPerPaneState(e,t,a){this._perPaneState[e]||(this._perPaneState[e]={}),this._perPaneState[e][t]=a}clearPerPaneStateSearch(){var e=this._perPaneState;for(var t in e)e.hasOwnProperty(t)&&(e[t][o.a.PerPaneStateField.CollapsedSearch]=void 0)}deletePerPaneState(e){this._perPaneState[e]=void 0}isSearched(){try{s.default.PAssert(1248,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){s.default.reportError(e)}return!!this.search&&this.search.isSearched()}isSearchedText(){try{s.default.PAssert(1249,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){s.default.reportError(e)}return!!this.search&&this.search.getValue()}isSearchedFlat(){return!1}onSearchChanged(e){var t=g.a.isValid();if(t&&g.a.reset(),this.updateItems(),t&&this.numItems()>0){var a=this.indexOfFirstItem();a>=0&&g.a.selectIndex(a,0)}this.saveState()}refreshSearchResults(){this.updateItems(!0)}_applyItemStateArr(e,t,a){if(e)for(var i=0,r=0;r<e.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=e[r];this.setPerPaneState(s,t,a)}}applyItemState(e){if(e)for(var t in e)if(e.hasOwnProperty(t)){var a=t.startsWith("un"+o.a.PerPaneStateField.Collapsed)?t.slice(2):t;if(a.startsWith(o.a.PerPaneStateField.Collapsed)){var i=e[t];this._applyItemStateArr(i,a,!t.startsWith("un"))}}}requestDemandLoadData(e){try{s.default.PAssert(1250,!1,"SubClass must override - by default demand load is not supported")}catch(t){s.default.reportError(t)}}requestDataPage(e){try{s.default.PAssert(1251,!1,"SubClass must override - by default data pagination is not supported")}catch(t){s.default.reportError(t)}}getDefaultDisplayItem(e){return this.getRootItem()}getRootItem(){return this.document.get().getRootItem()}setRootItem(e,t){try{s.default.PAssert(1252,void 0===e.parent(),"Root should never have a parent")}catch(a){s.default.reportError(a)}try{s.default.PAssert(1253,this.getItem()!==e,"Should not be setting root to the same value")}catch(a){s.default.reportError(a)}this.setItem(e,t)}scrollFromMousePosition(e,t,a){var i=a?this.getWidth():this.getHeight(),r=s.default.clamp(.1*i,20,40),n=r,o=a?this.getWidth():this.getHeight()-this.headerHeight(),l=o-r,d=a?e-this.scrollElement.getBoundingClientRect().left:t-this.contentTop(),h=0;d<n?h=s.default.computeScrollSpeed(0,n,d,4,-1):d>l&&(h=s.default.computeScrollSpeed(l,o,d,4)),0!==h?s.default.repeatScroll("pane",h,this,!1):s.default.cancelRepeatScroll("pane")}getContentElement(){return this.paneContent}getPaneIcon(){return"icon-align-left"}itemHasChildren(){return this.getItem().numItems()>0}getItem(e){return this.item.get()}allowZoom(e){return!0}performOverviewAction(e){}setItem(e,t,a){this._numItemSets++;var i=this.getItem();this.item.set(e,!1),a||this.updateItemsImmediate(!0,!1,!0),i&&i.parent()&&i._updateStylePadding(i.parent().levelsDeep.get(),!0),t&&(e.itemChanged.notify(),i&&e!==i&&i.itemChanged.notify(),this.item.notify(e,i))}getItemSearchParams(){return{item:this.getItem(),comparator:this.search.isMatched,noCollapsed:!0,includeNotes:!0,pane:this}}getHeaderSearchParams(){return{item:this.getRootItem(),comparator:this.search.isMatched,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}setItemsDirty(){this._setDirtyState(!1,!1)}isItemsDirty(){return!!this.itemsDirtyState}isItemsHeightDirty(){return this.itemsHeightDirty}_setDirtyState(e,t){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=e||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=t||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:e,forceNotify:t}}updateItems(e,t){this._setDirtyState(e,t),l.default.PaneUpdateBatcher.updateAllItems()}updateItemsImmediate(e,t,a,i){if(!this.isFakePane&&this.isActive.get()){this.itemsDirtyState&&(e=e||this.itemsDirtyState.updateSearch,t=t||this.itemsDirtyState.forceNotify,this.itemsDirtyState=void 0),s.default.shouldLog(o.a.LogLevels.React)&&s.default.log("update items"),this.search.isRunningSearch||this.search.update(void 0,void 0,!i);var r=this.getItem(),n=[],l=this.getItemSearchParams(),d=l.each,h=this.hasCollapsed();l.each=e=>{e.isNote()&&e.parent()===r||(n.push(e),d&&d(e))},this.runItemSearch(l),this._numItemComputes++,this.setItems(n,t),this.updateHeaders(t||a),this.hasCollapsedObs.set(h),this.isInitialized||(this.isInitialized=!0),this.itemsHeightDirty=!1,y.a.fireEvent("itemsUpdated",[this])}}updateItemHeights(){this.plugin||this._infiniteList.onListChanged()}runItemSearch(e){l.default.searchVMLIs(e)}updateOutline(e,t){var a,i=0,r=[],s={},n=this.getItem().levelsDeep.get();if(t){var o=0,l=0,d=[];for(a=0;a<e.length;a++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e[a].isNote()||d.push({item:e[a],index:d.length})}for(d.sort(t),e=[],a=0;a<d.length;a++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;let t=d[a].item;e.push(t),t.hasNote()&&e.push(t.getNote())}}for(a=0;a<e.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;let t=e[a],o=new k.a({type:"blockItem",item:t,id:t.id,pane:this,index:a,parentObject:s[t.parent().id],levelsDeep:(t.isNote()?t.parent():t).levelsDeep.get()-n-1,sizeInPane:t.sizeInPane});s[t.id]=o,this.addPaneObject(r,o)}this.items.set(r)}_setItems(e,t){this.updateOutline(e)}setItems(e,t){!t&&this._searchShowHierarchy===this.search.showHierarchy()&&e.equals(this._allPaneItems)||(this._allPaneItems=e,this.paneObjectsByItem={},this._setItems(e,t),g.a.getPane()===this&&g.a.checkValid())}updateHeaders(e){var t=[],a=this.getHeaderSearchParams();a.each=function(e){t.push(e)},l.default.searchVMLIs(a),this._numHeaderComputes++,this.setHeaders(t,e)}setHeaders(e,t){if(t||!e.equals(this.headersArr)){this.headersArr=e;let t=e.map((e,t)=>new k.a({type:"blockItem",item:e,id:e.id,pane:this,index:t,levelsDeep:e.levelsDeep.get(),sizeInPane:o.a.OverviewItemHeightDesktop}));this.headerPaneObjects.set(t)}}clearItems(e){this.items.set([],e)}onLoad(){this.isLoaded=!0,this.getItemStore()===l.default.itemStoreManager.getDefaultItemStore()&&y.a.listen("itemNoteSet",this._infiniteList.handleItemNoteSet),this._onAfterLoadedRAF=requestAnimationFrame(this.onAfterLoaded.bind(this))}onInfiniteListLoaded(){}onInfiniteListMounted(){}onAfterLoaded(){this._onAfterLoadedRAF=void 0,this._didInitialScroll||this.isDestroyed()||(isNaN(this.initialOffset)&&(this.initialOffset=this.defaultOffset),0!==this.initialOffset&&this.setScrollOffset(this.initialOffset),this._didInitialScroll=!0,this._infiniteList.saveScrollOfTop(),setTimeout(()=>{this._infiniteList&&this._infiniteList.addScrollListener(()=>{s.default.timeoutOnce("onScrollSave"+this.id,l.default.PaneManager.savePaneState,1e3)})},1e3)),this.isFakePane&&(this.isFakePane=!1,this.becomeReal())}getSize(){return{width:this.getWidth(),height:this.getHeight()}}getWidth(){var e=this.rect.get().width;try{s.default.PAssert(1254,e>100,"Pane width is not set",this.rect.get())}catch(t){s.default.reportError(t)}if(e>100)return e}getHeight(){return this.rect.get().height-this.headerHeight()}getItemHeight(){}getLeft(){return this.rect.get().left}toggleOverviewVisibility(){this.overview.toggleDesktop()}notifyDropFrom(e,t){}notifyDropFromToEdit(e,t){if(!e.hasChildren()&&e.hasAttachmentType(o.a.PluginType.Storage))return e.getAttachmentByType(o.a.PluginType.Storage).getPlugin().notifyDropFromToEdit(e,t);var a=document.createElement("ul");return a.innerHTML=O.a.toDropHtml(e),a}dropEffectCopyBehavior(e,t){return e.clone(t,o.a.ChangeType.Local)}_isNodeTextParent(e){return V.every(t=>!e.classList.contains(t))}convertElementToText(e){var t="";if("TEXTAREA"===e.nodeName)t+=e.value;else if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=o.a.AttachChar;else if(this._isNodeTextParent(e))for(var a=0,i=0;i<e.childNodes.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.convertElementToText(e.childNodes[i])}return t}compositionStart(){g.a.isComposing=!0}compositionEnd(e){g.a.isComposing=!1}addItemToPane(e,t){var a=this.getItem();e.text||(e.text=""),this.setIgnoreRestoreScroll();var i=a.addItemAtIndex(e,t,this);return L.a.setSelected([t],this),i}archiveItem(e,t){return t.archiveSelf(o.a.ChangeType.Local)}archiveSelected(e){var t=0,a=this.indexOfPrevVMLI(g.a.getStartIndex(),!0,!0);if(this.applyToSelection(e=>{this.archiveItem(!0,e),t++}),t>0){if(a<0&&this.numItems()>0&&(a=this.indexOfFirstItem()),a>=0){var i=this.itemAtIndex(a).getParsedText().length;g.a.selectIndex(a,i)}var r=t>1?" items.":" item.";l.default.toasts.pushMessage({text:"Archived "+t+r,action:o.a.MessageAction.Undo,hold:!1,timeout:8e3})}}deleteSelected(e,t){var a=this.indexOfPrevVMLI(g.a.getStartIndex(),!0,!0),i=0;if(R.a.saveDeleteSelection(),this.applyToSelection(t=>{e&&!e(t)||t.isDeleted()||(i+=t.numChildrenRecursive()+1,t.deleteSelf(o.a.ChangeType.Local))}),a<0&&this.numItems()>0&&(a=this.indexOfFirstItem()),a>=0){var r=this.itemAtIndex(a);if(r){var s=r.getParsedText().length;g.a.selectIndex(a,s)}else g.a.reset()}var n=i>1?" items.":" item.";l.default.toasts.pushMessage({text:"Deleted "+i+n,action:o.a.MessageAction.Undo,timeout:o.a.ToastTimeoutDefault})}handleLeftSideTap(e,t){var a=e.item;if(this.supportCollapsing)if(c.a.mac&&t.metaKey||!c.a.mac&&t.ctrlKey)this.zoomIn(a);else if(a.isCollapsible()){var i=g.a.save(),r=!this.isPaneObjectCollapsed(e);t.shiftKey?this.collapseAll(a,r,!0):this.setPaneObjectCollapsed(r,e),i&&this.restoreSelectionAfterCollapse(i,a)}}handleRightSideTap(e,t){this.supportCompleting&&(s.default.beginCompleteAction(),e.setComplete(!e.isComplete(),o.a.ChangeType.Local),s.default.endCompleteAction())}onClickTitle(e){let t=this.getItem();return this.zoomOut(e),s.default.sendEvent("Menu","Title"),t!==this.getItem()}onDoubleClickTitle(){this.toggleCollapseAll()}onTapStart(e){if(s.default.findParent(e.target,"itemNotInPane")||s.default.hasClass(e.target,"androidInput"))return;var t,a;this.getInfiniteList(!1).reMount(),this.getInfiniteList(!0).reMount(),g.a.setFocusedPane(this),a=s.default.getItemForElement(e.target);let i=s.default.getIndexForElement(e.target);if(a&&a.onStart&&a&&a.onStart){let r=this.objectAtIndex(i);(t=a.onStart(i,r,e))&&s.default.preventAndStop(e)}this._startPrevented=t}onTapMove(e){if(s.default.isAttachedToDoc(e.target)&&!s.default.findParent(e.target,"itemNotInPane")&&!s.default.hasClass(e.target,"androidInput")){var t=s.default.getItemForElement(e.startSrc);return l.default.DragDrop.isDragging&&(t=l.default.DragDrop.dragItem),t&&t.onMove&&t.onMove(e,!1),!1}}onTapClick(e){if(!s.default.findParent(e.target,"itemNotInPane")&&!s.default.hasClass(e.target,"androidInput")&&!this._startPrevented){var t,a=s.default.getItemForElement(e.startSrc);if(a&&(e.targetItem=a),a&&a.onClick){void 0===t&&(t=s.default.getIndexForElement(e.startSrc));var i=this.objectAtIndex(t);this.onClickItem(t,a,i,e)}else s.default.hasClass(e.startSrc,"paneDataPageLoad")||e.startSrc.parentElement&&s.default.hasClass(e.startSrc.parentElement,"paneDataPageLoad")?this.getItem().hasPaginationToken()&&this.requestDataPage(this.getItem()):s.default.hasClass(e.startSrc,"agendaCollapser")||(this.isWriteable&&0===this.numItems()&&this.canAddItem&&!s.default.hasClass(this.paneContent,"loading")?this.addItem({e}):s.default.preventDefault(e))}}onTapEnd(e){g.a._isMouseDown=!1;var t=e.targetItem||s.default.getItemForElement(e.startSrc);l.default.DragDrop.isDragging&&(t=l.default.DragDrop.dragItem),t&&("paneContent"===e.startSrc.id&&s.default.preventDefault(e),t&&t.onEnd&&t.onEnd(e))}onTapDoubleClick(e){if(!s.default.findParent(e.target,"itemNotInPane")){var t=s.default.getItemForElement(e.startSrc);if(t&&t.onDoubleClick){var a=s.default.getIndexForElement(e.startSrc);this.onDoubleClickItem(a,t,e)}}}onTapRightClick(e){if(!s.default.findParent(e.target,"itemNotInPane")&&!s.default.isDisplayModeActive(o.a.DisplayMode.NoRightClick)){g.a.setFocusedPane(this);var t=s.default.getItemForElement(e.target);if(t&&t.onRightClick){var a=s.default.getIndexForElement(e.target);this.onRightClickItem(a,t,e)}h.d.miscAction({type:h.b.Misc,misc:h.a.RightClick,data:{element:void 0,pane:this}})}}onClickItem(e,t,a,i){t.isNote()||t.onClick(e,a,i)}onRightClickItem(e,t,a){t.onRightClick(e,a)}onDoubleClickItem(e,t,a){t.onDoubleClick(e,a)}addItem({index:e,prefix:t,text:a,toRoot:i,date:r,e:s}){}onClose(){}onTapAddItem(e){this.addItem({e})}onTapOverviewButton(){this.toggleOverviewVisibility(),this.isOverviewVisible()?s.default.sendEvent("Menu","OpenOverview"):s.default.sendEvent("Menu","CloseOverview")}onTapClosePane(){var e=l.default.PaneManager.removePane(this);if(e){try{s.default.PAssert(1255,e===this.id,"Pane IDs must match")}catch(t){s.default.reportError(t)}h.d.performAction(h.b.UIAction,{type:h.c.RemovePane,data:e}),s.default.sendEvent("Menu","ClosePane"),l.default.tooltip.hideTip(),this.onClose()}}onClickArchiveCompleted(e){this.archiveCompleted(),s.default.preventAndStop(e),s.default.sendEvent("Menu","ArchiveCompleted")}onClickRefreshData(e){try{s.default.PAssert(1256,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(t){s.default.reportError(t)}this.refreshPaneData(),s.default.sendEvent("Menu","PaneDataRefresh"),s.default.preventAndStop(e)}onClickReportError(e){try{s.default.PAssert(1257,this.supportReportError,"Pane does not support error reporting")}catch(t){s.default.reportError(t)}this.reportPaneError(),s.default.sendEvent("Menu","PaneReportError"),s.default.preventAndStop(e)}refreshPaneData(e){d.a.isConnected()||l.default.toasts.pushMessage({text:"Your connection appears to be offline. Data will refresh when you go online."}),this._refreshPaneData(e)}_refreshPaneData(e){}reportPaneError(){}getItemsToArchive(){var e=[];return l.default.searchVMLIs({item:this.getItem(),each:t=>{t.isComplete()&&!t.isNote()&&e.push(t)}}),e}archiveCompleted(){var e,t,a,i=0;if(g.a.isValid()){var r=0;for(t=g.a.getEndIndex();t<this.items.length();){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if((a=this.itemAtIndex(t))&&!this.itemAtIndex(t).hasCompletedAncestor()){e=this.objectAtIndex(t);break}t++}}var n=this.getItemsToArchive();for(h.d.beginAction(),l.default.PaneUpdateBatcher.beginUpdateItems(),t=n.length-1;t>=0;t--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a=n[t],s.default.shouldLog(o.a.LogLevels.Data)&&s.default.log("Archive Item: ",a.getParsedText()),a.archiveSelf(o.a.ChangeType.Local)}if(l.default.PaneUpdateBatcher.commitUpdateItems(),h.d.endAction(),n.length>0){var d=n.length>1?" items.":" item.";l.default.toasts.pushMessage({text:"Archived "+(n.length+d),action:o.a.MessageAction.Undo,hold:!1,timeout:8e3})}else l.default.toasts.pushMessage({text:"No completed items to archive"});if(e){var c=this.indexOfObject(e);if(c>=0){a=this.itemAtIndex(c);try{s.default.PAssert(1258,a,"Could not restore selection to item")}catch(p){s.default.reportError(p)}if(a){var u=a.getParsedText().length;g.a.selectIndex(c,u)}}}else g.a.reset()}bottomListMessage(){}isSearchingRemote(){return!1}getTitleList(){return this.getItem().parents().concat(this.getItem())}itemTitle(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem()}titleOfFirstItem(){return this.getDocument().text.get()}onShowArchivedChanged(){this.showArchived.get()&&y.a.fireEvent("showArchived",[]),this.updateItems()}indexOfFirstItem(){return this.indexOfNextVMLI(-1)}indexOfLastItem(){return this.indexOfPrevVMLI(this.numItems(),!1,!0)}getFirstItem(){var e=this.indexOfFirstItem();if(e>=0){var t=this.getItems()[e];return t?t.item:void 0}}getFirstObject(){return this.objectAtIndex(this.indexOfFirstItem())}getLastItem(){return this.itemAtIndex(this.indexOfLastItem())}getLastObject(){return this.objectAtIndex(this.indexOfLastItem())}setFocused(e){e&&this.paneContent&&this.paneContent.focus(),this.isFocused.set(e)}headerHeight(){return 68}handleUndo(){R.a.undo()}handleRedo(){R.a.redo()}contentTop(){return l.default.DesktopUI.topBarHeight()+this.headerHeight()}indexPageUp(e){return e=this._infiniteList.indexPageUp(e),this.itemAtIndex(e)||(e=this.indexOfNextVMLI(e)),e}indexPageDown(e){return e=this._infiniteList.indexPageDown(e),this.itemAtIndex(e)||(e=this.indexOfPrevVMLI(e)),e}adjustSelectionFromPaneObject(e){try{s.default.PAssert(1259,e,"Must pass in a valid saved selection")}catch(a){s.default.reportError(a)}var t=e;return e.startItem&&e.endItem&&(e.startIndex=this.indexOfObject(e.startObject),e.endIndex=this.indexOfObject(e.endObject),(e.startIndex<0||e.endIndex<0)&&(t=void 0)),t}restoreSelection(e){try{s.default.PAssert(1260,e,"Must always have a valid saved selection")}catch(l){s.default.reportError(l)}if(e){var t=this.indexOfObject(e.startObject),a=this.indexOfObject(e.endObject);if(t>=0&&a>=0){var i=e.startOffset,r=e.endOffset,n=e.startItem.getParsedText(),o=e.endItem.getParsedText();(i<0||i>n.length||r<0||r>o.length)&&(i=-1,r=-1),g.a.selectIndices(t,i,a,r)}else g.a.reset()}else g.a.reset()}restoreSelectionAfterCollapse(e,t){if(e){var a,i,r=e.startItem,n=this.indexOfItem(e.startItem),l=this.indexOfItem(e.endItem);if(n>=0&&l>=0)g.a.selectIndices(n,e.startOffset,l,e.endOffset),a=e.startItem;else if(n>=0)g.a.selectIndex(n,e.startOffset),a=e.startItem,i=!0;else if(l>=0)g.a.selectIndex(l,e.endOffset),a=e.endItem,i=!0;else if(!0===t){var d=0;for(a=r;a;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h=a.parent();if(h===s.default.focusedPane.item.get()){g.a.selectItem(a,a===r?g.a.getStartOffset():-1),i=!0;break}a=h}}else g.a.reset();a&&i&&s.default.focusedPane.scrollItemToMiddle(a,o.a.ScrollDuration.Snap)}}setCollapsedRecursive(e,t,a){var i=0,r=e.numChildren(),s=e.getItems();!a||this.isSearchedFlat()&&!this.search.isMatched(e)||e.setCollapsed(t,this,!1,!1);for(var n=0;n<r;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=s[n];o.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(o))&&this.setCollapsedRecursive(o,t,!0)}}collapseAll(e,t,a,i){try{s.default.PAssert(1261,this.supportCollapsing,"Should not be collapsing all")}catch(o){s.default.reportError(o)}var r=e||this.item.get(),n=g.a.save();this.setIgnoreRestoreScroll(),l.default.PaneUpdateBatcher.beginUpdateItems(),void 0!==t&&this.setCollapsedRecursive(r,t,!!a),this.saveState(),(i||this.isSearchedFlat())&&this.updateItems(),l.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelectionAfterCollapse(n,t)}toggleCollapseAll(){if(this.supportCollapsing){var e=!this.hasCollapsed();this.collapseAll(this.item.get(),e)}}hasCollapsed(e){for(var t=0,a=(e=e||this.item.get()).numChildren(),i=e.getItems(),r=0;r<a;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i[r];if(s.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(s))){if(s.isCollapsed(this,!1))return!0;if(this.hasCollapsed(s))return!0}}return!1}onOverviewToggled(e){}getPaddingForPaneObject(e,t){var a=e.levelsDeep,i=e.item,r=!t&&this.isSearchedFlat()?l.default.DisplaySettings.itemIndentStart():i.getPadding(this,t,a);return r>this.getWidth()-o.a.SPThresholdRight&&(r=this.getWidth()-o.a.SPThresholdRight-8),r}maxWidthOfPaneObject(e){var t=this.getPaddingForPaneObject(e,!1);return this.getWidth()-t-o.a.SPThresholdRight-(e.item.hasPrefix()?this.shouldRenderPrefix(e)?o.a.PrefixWidth:5:0)}prevPaneObjectAtSameLevel(e){var t=0;try{s.default.PAssert(1262,e>=0,"Must supply a valid selection index: "+e)}catch(o){s.default.reportError(o)}try{s.default.PAssert(1263,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(o){s.default.reportError(o)}for(var a=this.objectAtIndex(e),i=e-1;i>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.objectAtIndex(i),n=this.itemAtIndex(i);if(n&&a.item!==n&&!n.isNote()&&r.levelsDeep===a.levelsDeep)return r;i--}}indexOfPrevVMLI(e,t,a){var i=0;try{s.default.PAssert(1264,e>=0,"Must supply a valid selection index: "+e)}catch(l){s.default.reportError(l)}try{s.default.PAssert(1265,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(l){s.default.reportError(l)}for(var r=t?this.itemAtIndex(e):void 0,n=e-1;n>=0;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this.itemAtIndex(n);if(o&&r!==o&&(!a||!o.isNote()))return n;n--}return-1}indexOfNextVMLI(e,t,a){var i=0;try{s.default.PAssert(1266,e>=-1,"Must supply a valid selection index: "+e)}catch(l){s.default.reportError(l)}try{s.default.PAssert(1267,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(l){s.default.reportError(l)}for(var r=t?this.itemAtIndex(e):void 0,n=e+1;n<this.numItems();){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this.itemAtIndex(n);if(o&&r!==o&&(!a||!o.isNote()))return n;n++}return-1}indexOfNextSibling(e){var t=0;try{s.default.PAssert(1268,e>=-1,"Must supply a valid selection index: "+e)}catch(i){s.default.reportError(i)}try{s.default.PAssert(1269,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(i){s.default.reportError(i)}var a=this.itemAtIndex(e);for(e=this.indexOfNextVMLI(e);e>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.itemAtIndex(e).isDescendantOf(a))break;e=this.indexOfNextVMLI(e)}return e>=0?e:-1}_getPrevNextItem(e,t,a){var i=a?this.indexOfNextVMLI:this.indexOfPrevVMLI,r=i.call(this,e);if(t)for(var s=0,n=this.itemAtIndex(e);r>=0;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var o=this.itemAtIndex(r);if(n.parent()===o.parent())return o;if(n.parent()===o||o.parent()===n.parent().parent()){r=-1;break}r=i.call(this,r)}else if(r>=0)return this.itemAtIndex(r)}getPreviousItem(e,t){return this._getPrevNextItem(e,t,!1)}getNextItem(e,t){return this._getPrevNextItem(e,t,!0)}getFirstSelectedItem(){var e;return this.applyToSelection(t=>(e=t,!1)),e}getFirstSelectedIndex(){return g.a.getStartIndex()}applyToSelection(e,t){var a=0;try{s.default.PAssert(1270,!t||!t.restoreSelection,"restoreSelection is no longer a valid option")}catch(n){s.default.reportError(n)}h.d.beginAction(),R.a.beginAction();var i=g.a.getSelectedObjects();l.default.PaneUpdateBatcher.beginUpdateItems();for(var r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!1===e(i[r].item,r,i.length,i[r]))break}l.default.PaneUpdateBatcher.commitUpdateItems(),R.a.endAction(),h.d.endAction()}applyFnToSelection(e,t){var a=g.a.save(),i=t&&t.toggle,r=!t||void 0===t.value||t.value,s=t&&void 0!==t.value2?t.value2:void 0;if(this.applyToSelection(function(t){i&&t[i]()!==r&&(i=void 0),i||t[e](r,s)}),i){var n=n=!(!t||void 0===t.emptyValue)&&t.emptyValue;this.applyToSelection(function(t){t[e](n,s)})}a&&!t.noRestoreSel&&this.restoreSelection(a)}applyPriorityToSelection(e,t){t?this.applyFnToSelection("setPriority",{toggle:"getPriority",value:e,value2:o.a.ChangeType.Local,emptyValue:o.a.VMLIFlag.None}):this.applyFnToSelection("setPriority",{value:e,value2:o.a.ChangeType.Local})}autocompleteTag(){this._autocompletePopup({mode:"tag",text:"Add tag",buttonText:"Add"},(e,t)=>{var a=t.value.trim(),i=e.getParsedText()+" "+o.a.TagPrefix+a;e.setText(i,o.a.ChangeType.Local)})}autocompleteMove(e,t){(e=e||{}).mode=o.a.AutocompleteMode.Move,e.text="Select item to move to",e.documentSelector=!this.supportsDocuments,e.buttonText="MOVE",this._autocompletePopup(e,(e,t)=>{var a;t.subItemText?(a=this.createVMLI({text:t.subItemText},{parent:t.item,changeType:o.a.ChangeType.AllLocal}),t.item.insertItem(a,0)):t.item===e||t.item.isDescendantOf(e)||(a=t.item),a&&this.moveItem(e,a)},()=>{t&&t(),g.a.updateCaret()})}autocompleteJump(e,t){(e=e||{}).mode=o.a.AutocompleteMode.Jump,e.text="Select item to jump to",e.buttonText="JUMP",this._autocompletePopup(e,()=>{},e=>{e.item&&this.indexOfItem(e.item)>=0&&(g.a.selectItem(e.item,0,0),this.scrollItemToTop(e.item,o.a.ScrollDuration.Default)),t&&t(),g.a.updateCaret()})}autocompleteSnooze(e,t,a){var i,r=l.default.pluginManager.getPlugin(o.a.PluginID.Gmail);if(!t){var n=e&&e.item||this.getFirstSelectedItem();n&&(i=n.getAttachmentByPlugin(r.id))&&(t=i.getField("accountID"))}var d=()=>{var t=e&&e.elementDisplay;if(!t){var a=this.getFirstSelectedIndex();t=this.elementAtIndex(a)}l.default.menus.openContextMenu({componentName:"ReactContextMenuAuthorize",element:t,message:"Your account needs additional authorization to Snooze. Please update your authorization to enable Snooze."})};U.a.isLoaded?(l.default.toasts.clearMessage(o.a.MessageID.SnoozeOffline),(e=e||{}).mode="snooze",e.text="Snooze until date",e.buttonText="SNOOZE",e.allowCustom=!0,this._autocompletePopup(e,(e,t)=>{r.beginAction();var a=t.value.trim(),n=l.default.International.parseDateDefaultFormat(a);if(i=e.getAttachmentByPlugin(r.id))if(s.default.isDateValid(n))if(U.a.isAuthorizedForScopes(i.getField("accountID"),[o.a.GScope.GmailModify])){var h=n.getTime()-Date.now();h<s.default.weeks(1)?r.performAction(o.a.PluginAction.Gmail.Snooze,!1,i,h):l.default.toasts.pushMessage({text:"Maximum snooze delay is one week. Please enter a date less than a week from now.",action:o.a.MessageAction.Okay})}else l.default.menus.closeContextMenu(),d();else l.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:o.a.MessageAction.Okay});else l.default.toasts.pushMessage(o.a.MessageID.ReselectEmail);r.endAction()},a)):l.default.toasts.pushMessage(o.a.MessageID.SnoozeOffline)}autocompleteSchedule(e,t){(e=e||{}).mode="date",e.text="Add event on date",e.buttonText="Add",e.allowCustom=!0;var a=l.default.pluginManager.getPlugin(o.a.PluginID.Gmail);this._autocompletePopup(e,(e,t)=>{h.d.beginAction();var i=t.value.trim(),r=l.default.International.parseDateDefaultFormat(i);s.default.isDateValid(r)?a.scheduleEmail(e,r):l.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:o.a.MessageAction.Okay}),h.d.endAction()},t)}autocompleteLabel(e,t){var a,i=l.default.pluginManager.getPlugin(o.a.PluginID.Gmail),r=e=>{var t=e.getAttachmentByPlugin(i.id),r=t.getPlugin().getDisplayTags(t);a=a?s.default.arrayIntersection(a,r):r};(e=e||{}).item?r(e.item):this.applyToSelection(r),e.tokens=(a||[]).map(e=>({text:e})),e.mode=o.a.AutocompleteMode.GmailLabel,e.text="Select a label",e.buttonText="LABEL",e.allowCustom=!0,e.allowEmpty=!0,e.onTokenRemoved=a=>{var r=a.text;i.beginAction();var n=e=>{var t=e.getAttachmentByPlugin(i.id);if(t)if(i.attachmentHasLabel(t,r))i.performAction(o.a.PluginAction.Gmail.RemoveLabel,!1,t,r);else try{s.default.PAssert(1271,!1,"Tried to remove a tag from an attachment without a tag")}catch(a){s.default.reportError(a)}else l.default.toasts.pushMessage(o.a.MessageID.ReselectEmail)};e.item?n(e.item):this.applyToSelection(n),i.endAction(),t&&t(a)},this._autocompletePopup(e,(e,t)=>{var a=t.value.trim();try{s.default.PAssert(1272,e.hasPluginAttachment(i.id),"Must have valid plugin attachment")}catch(d){s.default.reportError(d)}var r=e.getAttachmentByPlugin(i.id);if(r){if(a){var n=i.createLabelString(a);n?i.attachmentHasLabel(r,n)||i.performAction(o.a.PluginAction.Gmail.AddLabel,!1,r,n):l.default.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:o.a.MessageAction.Okay})}}else l.default.toasts.pushMessage(o.a.MessageID.ReselectEmail)})}_autocompletePopup(e,t,a){if(!e.elementDisplay){var i=g.a.getStartIndex(),r=this.elementAtIndex(i);e.elementDisplay=r}let s=e.item,n=e;n.pane=this,n.item||(n.item=this.getRootItem()),n.onSelected=e=>{s?t(s,e):this.applyToSelection(a=>{t(a,e)}),a&&a(e)},x.a.showPopup(n)}moveItem(e,t,a){if(h.d.beginAction(),l.default.PaneUpdateBatcher.beginUpdateItems(),t.belongsToSameItemStore(e))e.moveTo({parent:t,index:0},o.a.ChangeType.Local);else{let a=this.dropEffectCopyBehavior(e,t);a.setParent(t),t.insertItem(a)}l.default.PaneUpdateBatcher.commitUpdateItems(),h.d.endAction()}setPropDefault(e,t){void 0===this[e]&&(this[e]=t)}setExpanded(e,t){var a=this.isExpanded.get()!==e;this.isExpanded.set(e),a&&!1!==t&&(y.a.fireEvent("panesChanged",[]),this.saveState(),l.default.PaneManager.ensurePaneInView(this))}modifyTextOnDropBasedOnSearch(e,t,a,i,r,s){var n=0;if(!a||!a.search)return e;var o,l,d=a.search,h=this.search,c=t[s](),u=d[s](),p=h[s](),g=[],f=[];for(o=0;p&&o<p.length;o++){var m=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;l=p[o];for(var v=i,y=!c||c.indexOf(l)<0;y&&v;){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var _=v[s]();_&&_.indexOf(l)>=0&&(y=!1),v=v.parent()}y&&g.push(r+l)}if(g.length){var S=0;for(o=0;c&&u&&o<u.length;o++){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;l=u[o],c.indexOf(l)>=0&&p.indexOf(l)<0&&f.push(r+l)}var P=g.join(" ");if(f.length>0){var I=0;for(o=0;o<f.length;o++){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;l=f[o],e=0===o?e.replace(l,P):e.replace(l,"")}}else e=e+" "+P;e=e.replace(/  +/g," ")}return e}canAcceptDragOver(e,t,a,i){return this.isDropTarget}handleDragOver(e,t,a,i,r){var n=s.default.getElementParent(a),o=n&&s.default.getItemForElement(n),l=(n||s.default.findParent(a,"blockHeader"))&&s.default.getPaneObjectForElement(a),d={};return n&&s.default.findParent(n,"overviewList")?(this.overview.updateDragHoverItem(o),d={overview:!0,targetItem:o,targetElement:n}):(this.overview.updateDragHoverItem(null),d=this._handleDragOverPane(e,t,a,n,l,i,r)),d}_handleDragOverPane(e,t,a,i,r,s,n){}handleDragDrop(e,t,a,i){let r=!1;return a&&e!==a.targetItem&&a.targetItem&&(r=this._handleDragDrop(e,t.dataTransfer,a,t,i)),this.revertDrag(),r}_handleDragDrop(e,t,a,i,r){for(var n=0,d=a.overview,u=!0,p=t.pane,g=e,f=a.targetItem,m=!1,v=f.parent();v&&u;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;v===e&&(u=!1,l.default.toasts.pushMessage({text:"Cannot drop an item into its own children",action:o.a.MessageAction.Okay})),v=v.parent()}if(u){var _,S=-1;if(d)S=(_=f).numChildren();else if(a.dropOnPane)_=f,S=a.atEnd?f.numItems():0;else if(a.position===o.a.DragDropPosition.Above)_=f.parent(),S=f.getIndex();else if(a.position===o.a.DragDropPosition.On){_=f,S=c.a.mac&&i.ctrlKey||!c.a.mac&&i.altKey?0:f.numItems()}else{var P=this.indexOfItem(f),I=this.getNextItem(P);I&&I.parent()===f&&!I.isNote()?(_=f,S=0):(_=f.parent(),S=f.getIndex()+1)}h.d.beginAction();try{s.default.PAssert(1273,_,"Trying to move without a target")}catch(E){s.default.reportError(E)}try{s.default.PAssert(1274,!isNaN(S),"Trying to move without a target index")}catch(E){s.default.reportError(E)}if(m=!0,t.dropEffect===o.a.DropEffect.Move){var b=e.parent();if(b){var D=e.getIndex();if(b.belongsToSameItemStore(_)){e.moveTo({parent:_,index:S},o.a.ChangeType.Local),h.d.performAction(h.b.Move,{itemID:e.id,oldParent:b.id,oldPosition:D,newParent:_.id,newPosition:S});var w=e.getRawText();w=this.modifyTextOnDropBasedOnSearch(w,e,p,_,o.a.TagPrefix,"getTags"),(w=this.modifyTextOnDropBasedOnSearch(w,e,p,_,o.a.ContactPrefix,"getContacts"))!==e.getRawText()&&e.setText(w,o.a.ChangeType.Local)}else e=e.clone(_,o.a.ChangeType.Local),_.insertItem(e,S),b.removeChildAtIndex(D,o.a.ChangeType.Local)}else e=e.clone(_,o.a.ChangeType.Local),_.insertItem(e,S)}else r||(e=t.pane?t.pane.dropEffectCopyBehavior(e,_):e.clone(_,o.a.ChangeType.Local)),e?(e.setParent(_),_.insertItem(e,S)):m=!1;m&&(y.a.fireEvent("droppedItem",[g,this,t.pane]),h.d.miscAction({type:h.b.Misc,misc:h.a.DropItem,data:{itemID:e.id,toPane:this,fromPane:t.pane}})),h.d.endAction(),m&&t.pane&&t.pane.notifyDropFrom(e,this)}return m}revertDrag(){this.overview&&this.overview.updateDragHoverItem(null)}isItemHeader(e,t){return t?e.hasHeaderChildren():e.hasVisibleChildren(this)}onNotePopupClosed(){}openNoteContextMenu(){var e=g.a.getStartItem(),t=g.a.getStartIndex(),a=g.a.getStartOffset(),i=g.a.getEndOffset(),r=this.elementAtIndex(t);if(r){try{s.default.PAssert(1275,r.firstChild,"Opening a note should have a firstChild",s.default.getElementPath(r))}catch(o){s.default.reportError(o)}r.firstChild&&(r=r.firstChild),void 0!==a&&void 0===i&&(i=a);var n={componentName:"ReactNotePopup",onClosed:this.onNotePopupClosed.bind(this),element:r,item:e.parent(),note:e,pane:this,noBackdrop:!1,index:t,position:"fill",selectionStart:a,selectionEnd:i};l.default.menus.isContextMenuOpen()&&l.default.menus.closeContextMenu(),g.a.clearSelection(!0),n.positionOffset={left:-4,top:-18},l.default.menus.openContextMenu(n)}}closeNoteContextMenu(){l.default.menus.isContextMenuOpen()&&l.default.menus.closeContextMenu()}canResetMultiselect(){return!0}replaceTextOnDropOnBlock(e,t,a,i){var r=t.isNoKey?"":t.name,s=a&&a.name.replace(i,""),n=e.getRawText();(""===r||n.indexOf(r)<0)&&(s?n=n.replace(i+s,r):n+=" "+r,e.setText(n,o.a.ChangeType.Local))}applyDropOnBlock(e,t,a,i){var r,n=e;if(g.a.setFocusedPane(a),n.isStarred||n.isImportant)n.isStarred?t.setStarred(!0,o.a.ChangeType.Local):n.isImportant&&(r=o.a.VMLIFlag.P0),r&&t.setPriority(r,o.a.ChangeType.Local);else if(e.isTag)this.replaceTextOnDropOnBlock(t,e,i&&i.isTag?i:void 0,"#");else if(e.isContact)this.replaceTextOnDropOnBlock(t,e,i&&i.isContact?i:void 0,"+");else if(e.isPriority)t.setPriority(e.priority,o.a.ChangeType.Local);else{let i=l.default.pluginManager.getPluginGCalendar(),r=!0;if(t.hasAttachmentType(o.a.PluginType.Calendar)){let e=t.getAttachmentByType(o.a.PluginType.Calendar);e&&e.getField("recurringEventId")&&t.getCalendarParsedText()===e.getField("summary")?(l.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),r=!1):i.isEnabled()?i.hasWritePermissionForAttach(e)||(l.default.toasts.pushMessage({text:"This event is on a read-only calendar",actionText:"OKAY"}),r=!1):(l.default.toasts.pushMessage({text:"Cannot modify this event if the calendar plugin is disabled. Please enable the Google Calendar plugin.",action:o.a.MessageAction.OpenSettings}),r=!1)}if(r)if(t.setDate(e.date,e.duration||o.a.DefaultEventDuration,o.a.ChangeType.Local),s.default.isDateValid(n.date)&&i&&a!==this&&!t.hasAttachmentType(o.a.PluginType.Calendar))if(i.getDefaultExportCalendarID()){var d=l.default.pluginManager,h=o.a.PluginSettingsID.GCalendar.SyncDraggedEvents,c=()=>{d.getSetting(o.a.PluginID.GCalendar,h)&&i.createEventForItem(t)};l.default.settings.shouldShowHelp("syncNewEvents")?l.default.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",e=>{l.default.settings.closeHelp("syncNewEvents"),d.setSetting(o.a.PluginID.GCalendar,h,e),c()}):c()}}if(a.isEditable){var u=a.indexOfItem(t,e);u>=0&&g.a.selectIndex(u,t.getParsedText().length)}}setIgnoreRestoreScroll(e,t){this._ignoreRestoreScroll=!0,this._ignoreRestoreScrollTimeout&&clearTimeout(this._ignoreRestoreScrollTimeout),this._ignoreRestoreScrollTimeout=setTimeout(()=>{this._ignoreRestoreScroll=!1,t&&t()},e||100)}isIgnoringRestoreScroll(){return this._ignoreRestoreScroll}zoomInOnSwipe(e){var t=this.item.get();this.zoomIn(e),l.default.toasts.pushMessage({text:"<b>Zoomed in to:</b>"+e.getParsedText(),action:()=>{this.zoomIn(t)},hold:!1,actionText:"UNDO"})}collapseOnSwipe(e){this.supportCollapsing&&e.isCollapsible()&&e.toggleCollapsed(this)}deleteOnSwipe(e){var t;(e.deleteSelf(o.a.ChangeType.Local),e.hasAttachmentType(o.a.PluginType.Email))?t=e.getAttachmentByType(o.a.PluginType.Email).getField("subject"):t=e.getParsedTextWithoutPrefix();l.default.toasts.pushMessage({text:"<b>Deleted:</b>"+t,action:()=>{R.a.undo()},hold:!1,actionText:"UNDO"})}completeOnSwipe(e){this.supportCompleting&&(s.default.beginCompleteAction(),e.setComplete(!e.isComplete(),o.a.ChangeType.Local),s.default.endCompleteAction())}getSwipeMenuItemsNew(e){let{item:t}=e;return{left:[{icon:"check",text:t.isComplete()?"Uncomplete":"Complete",backgroundColor:"#0c0",onActivated:this.completeOnSwipe.bind(this,t)}],right:[{icon:t.isCollapsed(this)?"keyboard-arrow-up":"keyboard-arrow-down",backgroundColor:"#777",onActivated:this.collapseOnSwipe.bind(this,t)},{icon:"zoom-in",backgroundColor:"#09d",onActivated:this.zoomInOnSwipe.bind(this,t)},{icon:"delete",backgroundColor:"#a30",onActivated:this.deleteOnSwipe.bind(this,t)}]}}_openSelectedInMode(e){var t=g.a.getStartItem();t&&this.openEmailByItem(t,e)}replySelected(){this._openSelectedInMode(o.a.EmailResponseMode.Reply)}replyAllSelected(){this._openSelectedInMode(o.a.EmailResponseMode.ReplyAll)}forwardSelected(){this._openSelectedInMode(o.a.EmailResponseMode.Forward)}openEmailByItem(e,t){if(e){var a=e.getAttachmentByPlugin(o.a.PluginID.Gmail);(a&&a!==l.default.EmailPreview.getThreadAttach()||!l.default.EmailPreview.isOpenOnPane(this)||t)&&a.getPlugin().openEmailByItem(e,this,t)}}markItemRead(e,t){var a=l.default.pluginManager.getPluginGmail(),i=t.getAttachmentByPlugin(a.id),r=e?o.a.PluginAction.Gmail.MarkRead:o.a.PluginAction.Gmail.MarkUnread;try{s.default.PAssert(1277,i,"Must be able to get a valid attachment")}catch(n){s.default.reportError(n)}(e&&a.isItemUnread(t)||!e&&!a.isItemUnread(t))&&a.performAction(r,!1,i)}markReadSelected(e){var t=l.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection(this.markItemRead.bind(this,e)),t.endAction()}toggleStarSelected(){var e,t=l.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection(a=>{var i=a.getAttachmentByPlugin(t.id);try{s.default.PAssert(1278,i,"Must be able to get a valid attachment")}catch(n){s.default.reportError(n)}var r=t.isItemStarred(a);void 0===e&&(e=r?o.a.PluginAction.Gmail.Unstar:o.a.PluginAction.Gmail.Star),(r&&e===o.a.PluginAction.Gmail.Unstar||!r&&e===o.a.PluginAction.Gmail.Star)&&t.performAction(e,!1,i)}),t.endAction()}selectIndex(e,t){g.a.selectIndex(e,t||0)}onAdded(){this.isEditable&&this.isWriteable&&setTimeout(this.selectFirstItem.bind(this),0)}selectFirstItem(){var e=this.indexOfFirstItem();e>=0&&g.a.selectIndex(e,0)}isOverviewVisibleInPane(e){var t=this.item.get();return e===t||e.isDescendantOf(t)}getContentWidth(){return this.getWidth()}getContentHeight(){return this.getHeight()}getMinItemSize(){return Math.ceil(l.default.DisplaySettings.itemLineHeight()+2*l.default.DisplaySettings.itemPadding()+(l.default.DisplaySettings.noteLineHeight()+l.default.DisplaySettings.itemPadding()))/2}onZoom(){this.setScrollOffset(this.defaultOffset)}widthOfDrag(e){}getSubItems(e,t){var a=[],i={item:e,comparator:this.search.isMatched,pane:this,each:e=>{t&&e.isComplete()||a.push(e)}};return this.runItemSearch(i),a}getMetricsForPaneObject(e,t,a){var i;try{i=l.default.Measure.measurePaneObject(e,this,l.default.settings.showMarkdown.get()&&a)}catch(r){s.default.reportError(r)}return i}getStyledLinesForPaneObject(e,t,a){var i=e.item;if(i.isNote())return[i.getNotePreviewText()];var r=this.getMetricsForPaneObject(e,t,a);return r?r.styledLines:[i.getParsedText()]}isItemInPane(e){return this.indexOfItem(e)>=0}isItemTopLevel(e,t){return t.levelsDeep.get()-this.item.get().levelsDeep.get()===1}checkHeightChanged(e,t){return this._infiniteList.checkHeightChanged(e,t)}getCollapsedDefault(e,t,a){return!1}isViewProject(){return!1}isViewDates(){return!1}isViewAgenda(){return!1}isViewCalendar(){return!1}isViewOutline(){return!1}isViewGroups(){return!1}isViewText(){return!0}isViewFlatList(){return!1}shouldShowAddBox(){return!1}isViewAutoBlocks(){return!1}isViewTag(){return!1}canScrollToItem(){return!1}getSortModeBlocks(){}getSortModeItems(){}isCalFilterActive(){return!1}isViewItems(){return!1}isViewArchived(){return!1}isViewDeleted(){return!1}viewModeIcon(){return""}viewModeColor(){return""}extraPaddingForPaneObject(e){return 0}createVMLI(e,t){t.documentOwner=this.getDocument();var a=d.a.createVMLI(e,t);return this.search.stickMatch(a),a}createTempVMLI(e,t){t.documentOwner=this.getDocument();var a=d.a.createVMLI(e,t);return this.search.stickMatch(a),a}selectNearestItem(e){var t=this.indexOfNextSibling(e);t>=0&&g.a.selectIndex(t,0)}supportsSortBlocks(){return!1}supportsSortBlocksMode(e,t){return!1}supportsSortItems(){return!1}getViewMode(){return""}scrollToTop(e){this.setScrollOffset(0,e)}setName(e){this.name.set(e),l.default.PaneManager.savePaneState()}setWidthManual(e,t){isNaN(e)?this.widthManual=this.widthManualExpanded=e:t?(e=s.default.clamp(e,o.a.EmailPreviewSizeMin,o.a.EmailPreviewSizeMax),this.widthManualExpanded=e):(e=s.default.clamp(e,this.minWidth,this.maxWidth),this.widthManual=e),this.saveState(),l.default.PaneManager.updatePaneRects(!isNaN(e))}isPaneObjectCollapsed(e,t){return(s.default.isVMLI(e)?e:e.item).isCollapsed(this,t)}setPaneObjectCollapsed(e,t,a,i){return(s.default.isVMLI(t)?t:t.item).setCollapsed(e,this,a,i)}shouldRenderPrefix(e){return!0}needsUpdateForDate(e){return!1}needsUpdateForTags(e,t){return!1}handleItemChanged(e,t,a){var i=this.getInfiniteList();if(a=a||!1,t[o.a.ItemProp.Items]&&(l.default.DisplaySettings.boldHeaders()&&i.clearItemInfoForItem(e),a=!0),t[o.a.ItemProp.Text]){if(i.handleItemTextChanged(e)&&(this.itemsHeightDirty=!0),this.supportSearchListenTextChanges){let t=this.search.handleItemTextChanged(e);a=a||t}this.onItemTextChanged.notify(e)}if(t[o.a.ItemProp.Search]){let t=this.search.handleItemChanged(e);a=a||t}if(t[o.a.ItemProp.Date]&&(a=a||this.needsUpdateForDate(e)),t[o.a.ItemProp.Tags]&&(a=a||this.needsUpdateForTags(e,t[o.a.ItemProp.Tags])),a)return this.preventUpdateItemsForItem&&this.preventUpdateItemsForItem.item===e||this.setItemsDirty(),!0}addPaneObject(e,t){var a=t.item;e.push(t),a&&(this.paneObjectsByItem[a.id]?this.paneObjectsByItem[a.id].push(t):this.paneObjectsByItem[a.id]=[t])}getPaneObjectsForItem(e){return this.paneObjectsByItem[e.id]}_zoom(e,t,a){try{s.default.PAssert(1279,e,"Must supply a valid item to zoom to")}catch(r){s.default.reportError(r)}var i=this.item.get();i&&i.id===e.id||(g.a.reset(),this.setItem(e,!0,a),s.default.focusedItem=e,t||this.saveState())}zoomIn(e,t={}){try{s.default.PAssert(1280,e,"Must supply a valid item to zoom to")}catch(c){s.default.reportError(c)}let{forLoad:a,showToast:i,noSel:r,noUpdateItems:n}=t;var o=this.item.get();if(this._zoom(e,a,n),e.isDemandLoad()&&e.notifyDemandLoadUpdate(!0,this),a||s.default.sendEvent("Menu","ZoomIn"),this.paneContent&&this.isWriteable&&!r){var d=this.indexOfFirstItem();d>=0?g.a.selectIndex(d,0,0):g.a.reset()}this.isLoaded&&this.onZoom(),a||h.d.performAction(h.b.Zoom,{itemID:e.id,oldItemID:o&&o.id,zoomIn:!0,time:0,pane:this}),i&&l.default.toasts.pushMessage({text:"Zoomed into "+e.getParsedTextWithoutPrefix(),actionText:"UNDO",hold:!1,action:()=>{this.zoomIn(o)}})}zoomOut(e,t){try{s.default.PAssert(1281,e,"Must supply a valid item to zoom to")}catch(u){s.default.reportError(u)}var a=this.item.get(),i=g.a.save()||g.a.getPreviousSelection();if(this._zoom(e,!1),s.default.sendEvent("Menu","ZoomOut"),this.isWriteable&&i){for(var r=0,n=i.startItem,l=i.startOffset,d=i.endItem,c=i.endOffset;n&&this.indexOfItem(n)<0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n=n.parent(),l=0}n&&(this.indexOfItem(i.endItem)<0&&(d=n,c=l),g.a.selectItems(n,l,d,c),this.scrollItemToMiddle(n,o.a.ScrollDuration.Snap))}t||h.d.performAction(h.b.Zoom,{itemID:e.id,oldItemID:a.id,zoomOut:!0,time:0,pane:this})}getDocument(){return this.document.get()}setDocument(e,t,a){e!==this.document.get()&&(this.setIgnoreRestoreScroll(1e3),this.document.set(e),this.zoomIn(e?this.getRootItem():void 0,{forLoad:t,noUpdateItems:a}))}openItemEditor(e){e.pane=this,l.default.menus.openItemEditor(e)}clearPreventUpdate(){}getVisibleChildren(e){var t=0;let a=e.item,i=this.items.get(),r=[];for(let s=e.index;s<i.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let e=i[s],n=e.item;n&&n.isDescendantOf(a)&&r.push(e)}return r}isItemBold(e){return e.isPrefixHeader()||e.isHeader()&&l.default.DisplaySettings.boldHeaders()}},r()(M.prototype,"saveState",[S.a],Object.getOwnPropertyDescriptor(M.prototype,"saveState"),M.prototype),r()(M.prototype,"onClickReportError",[S.a],Object.getOwnPropertyDescriptor(M.prototype,"onClickReportError"),M.prototype),r()(M.prototype,"archiveCompleted",[S.a],Object.getOwnPropertyDescriptor(M.prototype,"archiveCompleted"),M.prototype),M);n.a.extendClass(j,((e=z)=>{return class extends e{constructorExtra(){n.a.binder(this,"onInput","onInputSetText")}onInput(e){if(g.a.isValid()){var t=g.a.getStartItem(),a=this.convertElementToText(e.target),i=N.default._getSelectionRange(),r=s.default.getElementParent(e.target),n=N.default.getSelectOffsetsInElement(r,i),o=g.a.getStartIndex();this.onInputSetText(t,a,o,n.start,n.end,e)}}onInputSetText(e,t,a,i,r,n){if(!this._hasDetectedEnterAndroid){t=t.replace(new RegExp(o.a.TextSpace,"g"),"");var d=E.a.checkMultiplePrefixes(t);if(d!==t){var h=t.length-d.length;i-=h,r-=h,t=d}l.default.settings.showMarkdown.get()||(s.default.shouldLog(o.a.LogLevels.Edit)&&console.log("check end",i-2,t[i-2]),i===r&&i>2&&")"===t[i-2]&&B.a.isInsideMarkup(e,i-2,!1,"mdMarkupEnd")&&(t=t.substr(0,i-1)+" "+t.substr(i-1),i++,r++,s.default.shouldLog(o.a.LogLevels.Edit)&&console.log("spacing eend",i)),s.default.shouldLog(o.a.LogLevels.Edit)&&console.log("check start",i,t[i]),i===r&&"["===t[i]&&B.a.isInsideMarkup(e,i-1,!1,"mdMarkupStart")&&(t=t.substr(0,i)+" "+t.substr(i),s.default.shouldLog(o.a.LogLevels.Edit)&&console.log("spacing start",i))),this.isSettingText=!0,e.setText(t,o.a.ChangeType.Local),t.length>0&&g.a.selectIndex(a,r),this.isSettingText=!1,F.a.updateAutocomplete(n)}this._hasDetectedEnterAndroid=!1}keydown(e){if(e.handled)return!0;if(l.default.tooltip.hideTip(),this.isWriteable&&0===this.numItems()&&this.canAddItem&&!s.default.hasClass(this.paneContent,"loading")&&o.a.KeyCodesModifiers.indexOf(e.normCode)<0&&o.a.KeyCodesArrows.indexOf(e.normCode)<0&&this.addItem({e}),g.a.isValid()){this.getInfiniteList(!1).reMount(),0!==this.numItems()||s.default.hasClass(this.paneContent,"loading")||this.addItem({e});try{F.a.keydown(this,e)||(s.default.preventDefault(e),s.default.stopPropagation(e))}catch(t){s.default.reportError(t,e)}}}keypress(e){if(g.a.isValid())try{F.a.keypress(this,e)||(s.default.preventDefault(e),s.default.stopPropagation(e))}catch(t){s.default.reportError(t,e)}}keyup(e){if(s.default.notifyActivity(),g.a.isValid())try{F.a.keyup(this,e)||(s.default.preventDefault(e),s.default.stopPropagation(e))}catch(t){s.default.reportError(t,e)}}}})(j),!0);var z=t.a=j},108:function(e,t,a){"use strict";var i=a(1),r=a(0),s=a(3),n=a(21);t.a=new class{constructor(){this.FOLDER_MIMETYPE="application/vnd.google-apps.folder",this.folders={root:{type:"root",title:"_Moo.do Files (Do not delete)",id:void 0,prop:"MooDoDefaultRoot"},attach:{type:"attach",title:"Shared Attachments",id:void 0,prop:"MooDoDefaultAttach",parent:"root"},backup:{type:"backup",title:"Moo.do Backups",id:void 0,prop:"MooDoDefaultBackup",parent:"root"}}}createFolderStructure(e,t){let a=e.type;try{r.default.PAssert(1001,!r.default.isDemoMode(),"Should not be creating "+a+"folder in demo mode")}catch(d){r.default.reportError(d)}try{r.default.PAssert(1002,void 0===e.id,"Must not already have a "+a+"folder")}catch(d){r.default.reportError(d)}e.parent&&(this.folders[e.parent].id||this.getFolder(this.folders[e.parent],this.createFolderStructure.bind(this,e)));try{r.default.PAssert(1004,t,"Must supply a valid callback when done creating the "+a+" file structure")}catch(d){r.default.reportError(d)}var o=n.a.fns("drive").files.insert.packedFn,l={resource:{mimeType:this.FOLDER_MIMETYPE,title:e.title,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:e.prop,value:"TRUE",visibility:"PRIVATE"}]}};e.parent&&(l.resource.parents=[{id:this.folders[e.parent].id}]),s.default.remoteAPI().runRemoteSingleRequest(o,l,e=>(r.default.shouldLog(i.a.LogLevels.Folders)&&r.default.log("Successfully created "+a+" folder",e),t(e.id)),e=>(r.default.shouldLog(i.a.LogLevels.Folders)&&r.default.log("Error creating "+a+" folder",e),t()))}getSetting(e){let t=s.default.settings.driveFolders.get();return t?t[e]:void 0}setSetting(e,t){let a=Object.assign({},s.default.settings.driveFolders.get(),{[e]:t});s.default.settings.driveFolders.set(a)}getFolderByType(e,t){return this.getFolder(this.folders[e],t)}getFolder(e,t){r.default.isString(e)&&(e=this.folders[e]);try{r.default.PAssert(1005,e,"Trying to get invalid folder")}catch(n){r.default.reportError(n)}try{r.default.PAssert(1006,!r.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(n){r.default.reportError(n)}try{r.default.PAssert(1007,t,"Must provide a valid callback when getting the root folder")}catch(n){r.default.reportError(n)}if(e){if(e.id)return t(e.id);var a=()=>{let a=this.getSetting(e.type),o=()=>{this.createFolderStructure(e,a=>a?(e.id=a,this.setSetting(e.type,a),t(a)):t(void 0))};if(a){let i=function(i){if(i)return e.id=a,t(a);o()},r=a=>{if(this.setSetting(e.type,void 0),!a||!a.error||404!==a.error.code)return t(void 0);o()};s.default.remoteAPI().driveFilesGet(a,i,r)}else{let a="properties has {key='"+e.prop+"' and value='TRUE' and visibility='PRIVATE'} and 'me' in owners and trashed=false",l={getAllPages:!0},d=a=>{if(a.length>0){try{r.default.PAssert(1008,1===a.length,"Must have a single root folder present")}catch(n){r.default.reportError(n)}return r.default.shouldLog(i.a.LogLevels.Folders)&&r.default.log("Successfully found root folder",a),e.id=a[0].id,this.setSetting(e.type,e.id),t(e.id)}o()},h=e=>(r.default.shouldLog(i.a.LogLevels.Folders)&&r.default.log("Error getting root folder",e),t(void 0));s.default.remoteAPI().driveFilesList(a,d,h,l)}};e.parent?this.getFolderByType(e.parent,a):a()}else t(void 0)}copyFileToFolder(e,t,a){s.default.remoteAPI().driveParentsInsert(e,t,function(e){r.default.shouldLog(i.a.LogLevels.Folders)&&r.default.log("Error sharing file ",e),a(!0,e)},function(e){r.default.shouldLog(i.a.LogLevels.Folders)&&r.default.log("Successfully shared file ",e),a(!1,e)})}getAttachFolder(e){return this.getFolderByType(i.a.DriveFolder.Attach,e)}getRootFolder(e){return this.getFolderByType(i.a.DriveFolder.Root,e)}getBackupFolder(e){return this.getFolderByType(i.a.DriveFolder.Backup,e)}getDocumentFolder(e,t){let a={type:e,title:e,id:void 0,parent:i.a.DriveFolder.Root,prop:e};this.getFolder(a,t)}}},109:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(1),l=a(3),d=a(5),h=a(148),c=a(13),u=a(8),p=a(31),g=a(20),f=a(54);const m=10*o.a.MSPerMinute;let v=(i=class{init(){l.default.settings.backupFrequency.listen(this.onTimeChanged),n.default.isBoolean(l.default.settings.needsBackup.get())&&l.default.settings.needsBackup.set({}),this.needsBackupDrive=Object.assign({},l.default.settings.needsBackup.get()||{}),g.a.onAuthed(this.checkBackup),setInterval(this.checkBackup,m)}docNeedsBackup(e){let t=l.default.settings.needsBackup.get();return t&&t[e.id]&&Date.now()-t[e.id]>m}setNeedsBackup(e,t){let a=Date.now();if(t){if(!e.isLocalOnly()||l.default.settings.backupLocal.get()){let t=l.default.settings.needsBackup.get();t&&t[e.id]||l.default.settings.needsBackup.set(Object.assign({[e.id]:a},t))}}else{let t=n.default.clone(l.default.settings.needsBackup.get());delete t[e.id],l.default.settings.needsBackup.set(t)}}onTimeChanged(){this.needsBackupDrive={},p.a.onLoaded(this.checkBackupDrive)}onDataSaved(e){this.setNeedsBackup(e,!0)}checkBackup(){this.checkBackupAuto(),l.default.settings.backupFrequency.get()>0&&p.a.onLoaded(this.checkBackupDrive)}checkBackupAutoDoc(e){this.docNeedsBackup(e)&&this.backupDocumentAuto(e)}checkBackupAuto(){c.a.getDocumentsArray().forEach(this.checkBackupAutoDoc)}checkBackupDriveDoc(e){let t=l.default.settings.backupsDrive.get(),a=t&&t[e.id];if(isNaN(a)||Date.now()-a>l.default.settings.backupFrequency.get())return this.backupDocumentDrive(e),!0}checkBackupDrive(){l.default.settings.backupFrequency.get()>0&&c.a.getDocumentsArray().forEach(this.checkBackupDriveDoc)}async backupDrive(){return Promise.all(c.a.getDocumentsArray().map(this.backupDocumentDrive))}async backupAuto(){return Promise.all(c.a.getDocumentsArray().map(this.backupDocumentAuto))}async backupAll(){return Promise.all([this.backupAuto(),this.backupDrive()])}async backupDocumentAll(e){return Promise.all([this.backupDocumentAuto(e),this.backupDocumentDrive(e)])}async backupDocumentStorage(e){if(!e.isLocalOnly()){let a=Date.now(),i=this.getCloudBackupFilename(e,a),r=await e.toJSON({exportArchived:!0,includeNotes:!0,encrypt:!0});try{await l.default.cloudStorage.uploadString(i,r)&&(e.addBackup(a),f.a.getAPIForDocument(e).addBackup(a),this.setNeedsBackup(e,!1))}catch(t){n.default.reportError(t)}}}async backupDocumentAuto(e){return d.a.isNativeApp()&&l.default.settings.backupLocal.get()&&e.toJSON({exportArchived:!0,includeNotes:!0,encrypt:l.default.settings.encryptLocalFiles.get()}).then(t=>{let a=(new Date).toString("yy-MM-dd h-mm tt"),i=e.text.get()+" "+a+".json";l.default.ElectronBridge.saveBackup(i,t,t=>{t?n.default.reportError(t,"Backup error"):e.isLocalOnly()&&this.setNeedsBackup(e,!1)})}),this.backupDocumentStorage(e)}async backupDocumentDrive(e){l.default.settings.backupFrequency.get()>0&&!e.isLocalOnly()&&(await e.toJSON({exportArchived:!0,includeNotes:!0,encrypt:!1}).then(t=>{let a=new Blob([t],{type:"application/json"}),i=(new Date).toString("yy/MM/dd h:mm tt");return a.name=e.text.get()+" "+i,new Promise(t=>{new h.a(a,"me",o.a.DriveFolder.Backup,{docId:e.id},()=>{},()=>{let a=l.default.settings.backupsDrive.get();a&&n.default.isObject(a)||(a={}),l.default.settings.backupsDrive.set(Object.assign({},a,{[e.id]:Date.now()})),t()},e=>{n.default.reportError(e,"Backup error"),t()}).upload()})}),delete this.needsBackupDrive[e.id])}async downloadBackup(e,t){let a=this.getCloudBackupFilename(e,t),i=await l.default.cloudStorage.getString(a);if(i)try{return JSON.parse(i)}catch(r){n.default.reportError(r)}}getCloudBackupFilename(e,t){return`users/${g.a.getUid()}/documents/${e.id}/${t}.json`}isDriveBackupAuthorized(){return p.a.isAuthorizedForScopes(g.a.getDefaultAccountID(),[o.a.GScope.Drive])}authorize(e){p.a.authAccount(g.a.getDefaultAccountID(),[o.a.GScope.Drive],t=>{e(t)})}enable(){this.authorize(e=>{e&&(l.default.settings.backupFrequency.set(o.a.DefaultBackupFrequency),this.backupDrive())})}getLastBackup(){return c.a.getDocumentsArray().reduce((e,t)=>Math.max(e,t.getLastBackup()),0)}},s()(i.prototype,"onTimeChanged",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"onTimeChanged"),i.prototype),s()(i.prototype,"checkBackup",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackup"),i.prototype),s()(i.prototype,"checkBackupAutoDoc",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupAutoDoc"),i.prototype),s()(i.prototype,"checkBackupAuto",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupAuto"),i.prototype),s()(i.prototype,"checkBackupDriveDoc",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupDriveDoc"),i.prototype),s()(i.prototype,"checkBackupDrive",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupDrive"),i.prototype),s()(i.prototype,"backupDocumentStorage",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"backupDocumentStorage"),i.prototype),s()(i.prototype,"backupDocumentAuto",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"backupDocumentAuto"),i.prototype),s()(i.prototype,"backupDocumentDrive",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"backupDocumentDrive"),i.prototype),i);t.a=new v},13:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(1),l=a(3),d=a(5),h=a(9),c=a(18),u=a(20),p=a(16),g=a(55),f=a(105),m=a(8),v=a(47);var y,_=new(i=class extends f.a{constructor(){super(!0),this.dataCache={},this.itemCache={},this.isLoaded=!1,this._demoId=1}init(e,t){let i=a(680).default,r=p.a.getURLParam("data"),s=r.split(","),l={},d=0,h={[u.a.getUid()]:{e:u.a.getDefaultAccountID(),t:u.a.getAccountName(),r:o.a.DocumentAccessRoles.Admin}};this.loadDemoContacts(["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"]),i.areRemoteFunctionsHooked()||i.hookRemoteFunctions();var c=e=>{e.id||(e.id="demo"+d++),this.dataCache[e.id]=e;var t=e.note;t&&(t.id||(t.id="demo"+d++),c(t),e.note=t.id);var a=e.items;if(a){for(var i=0,r=[],s=0;s<a.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;let e=a[s];e.id||(e.id="demo"+d++),e.index=s,r.push(e.id),c(e)}e.items=r}},f=(t,a)=>{let i;if(a&&(i=a[0]),i){c(i),this.isLoaded=!0;let a=new g.a({id:t,text:t,dateModified:Date.now(),rootData:i,acl:h,backing:this});a.createVMLIs(),l[a.id]=a,Object.keys(l).length===s.length&&(this.documents=l,e(l,this.dataCache))}};if(r&&s.length>0)s.forEach(e=>{i.loadRemoteData(e,f.bind(this,e))});else{try{n.default.PAssert(137,!1,"Test data must be defined using #data=XXX.YYY in URL")}catch(v){n.default.reportError(v)}let e={id:void 0,text:o.a.RootItemName,items:[]};var m=new g.a({id:"Failed",text:"Failed",dateModified:Date.now(),rootData:e,acl:h,backing:this});f("Failed",[m])}}loadDemoContacts(e){var t=0,a=[],i=0;function r(e){var t="test-"+e.split(" ")[0].toLowerCase()+"@moo.do";a.push({id:"contact_"+i++,name:e,isDemo:!0,emails:[{address:t,primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}for(var s=0;s<e.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r(e[s])}v.a.loadContacts(a)}getItemData(e){return this.dataCache[e]}saveItem(e,t,a,i,r){let s=this.dataCache[t.id]||{};return Object.assign(s,a),this.dataCache[t.id]=s,Promise.resolve()}deleteItem(e,t,a){let i=t.parent();this.saveItem(e,i,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop),delete this.dataCache[t.id]}addItem(e,t){this.saveItem(e,t.parent(),void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop),this.saveItem(e,t,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop)}moveItem(e,t){let a=e.getDocumentOwner();this.saveItem(a,e,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop)}setNote(e,t,a,i,r){this.saveItem(e,t,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop),a?this.saveItem(e,a,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop):delete this.dataCache[a.id]}addDocument(e){let t=e.getRootItem();return this.documents[e.id]=e,this.saveItem(e,t,void 0,o.a.ChangeType.Local,o.a.SaveFlag.Prop)}saveDocument(e){}deleteDocument(e){}unlistenDocument(e){}getSetting(e){return""}setSetting(e,t){}saveBoard(e){}deleteBoard(e){}getBoards(){return[]}async clearAllData(){}generateId(){return""+this._demoId++}},s()(i.prototype,"generateId",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"generateId"),i.prototype),i),S=a(54),P=a(109),I=a(39),b=a(26),D=a(32),w=a(146),E=a(183);let C=(y=class{constructor(){this.isLoaded=new h.a(!1),this._isRemoteEnabled=!n.default.isDemoMode(),this._documentsById={},this._itemCache={},this.documentsArray=new D.a,this.documentsEncryptedArray=new D.a,this._sources=[],this._idProvider=n.default.isDemoMode()?_.generateId:S.a.generateId,this.settingProvider=S.a,this.loadState=S.a.loadState,this.onlineStatus=new h.a(u.a.isOnline()?"Connecting":"Offline"),this.isLoadedLocal=new h.a(!1),this.isLoadedRemote=new h.a(!1),n.default.isDemoMode()?this._sources=[_]:(this._sources.push(S.a),d.a.supportLocalFiles()&&this._sources.push(E.a))}init(){this._emptyDocument=this.createEmptyDocument("Empty",_),window.__clearLocalData=this.clearLocalData}loadLocal(e){this._cbOnLoad=e,this._sourcesWaiting=this._sources.length,this._sources.forEach(e=>e.init(this.onSourceLoaded,this.onSourceDocumentsChanged)),this._isRemoteEnabled&&P.a.init(),n.default.registerEvent("ItemCreated","ItemAction","Create"),n.default.registerEvent("ItemCompleted","ItemAction","Complete"),this.isLoadedLocal.set(!0)}onSourceLoaded(e){setTimeout(()=>l.default.timeline.updateNotifications(),1e3),this._sourcesWaiting--,e.forEach(e=>{e.canDecrypt()&&(this._documentsById[e.id]=e,this.documentsArray.includes(e)||this.documentsArray.push(e,!1))}),0===this._sourcesWaiting&&(this.documentsArray.sort(g.a.comparatorModified),l.default.PaneManager.loadInitialState(),this.isLoaded.set(!0),this._cbOnLoad(e))}onSourceDocumentsChanged(e,t){let a=this.documentsArray.get();Object.keys(e).forEach(t=>{let i=e[t];this._documentsById[i.id]&&a.includes(i)?i.canDecrypt()||a.remove(i):i.canDecrypt()&&(this._documentsById[i.id]=i,a.push(i))}),(a=a.filter(e=>e.canDecrypt())).sort(g.a.comparatorModified),this.documentsArray.set(a),t&&this.documentsEncryptedArray.set(Object.keys(t).map(e=>t[e])),this.isLoadedRemote.set(!0)}getDefaultBacking(){return this._sources[0]}getDocumentById(e){return this._documentsById[e]}getDefaultDocument(){return this.documentsArray.get().length>0?this.documentsArray.get()[0]:this.addEmptyDocument("My First Document",this.getDefaultBacking(),!1)}getDocumentsArray(){return this.documentsArray.get()}hasDocuments(){return this.documentsArray.get().length>0}runOnAllDocuments(e){this.documentsArray.get().forEach(t=>e(t))}parseAll(e){this.runOnAllDocuments(t=>{t.parseAll(e)})}runOnAllDocumentRoots(e){this.documentsArray.get().forEach(t=>e(t.getRootItem()))}getItemDataLocal(e,t){return e.getBacking().getItemData(t)}getDocumentBacking(e){return e.getBacking()}getItemBacking(e){let t=e.getDocumentOwner();try{n.default.PAssert(11,t,"Item document must exist")}catch(a){n.default.reportError(a)}return t.getBacking()}_getPreviousState(e,t){try{n.default.PAssert(12,e.getDocumentOwner(),"Missing document owner",e.getRawText())}catch(r){n.default.reportError(r)}var a=e.getDocumentOwner().getBacking().getItemData(e.id),i={};return a&&Object.keys(t).forEach(e=>{i[e]=a[e]}),i}saveItem(e,t,a,i,r){let s=e.parent()||e.isRoot;try{n.default.PAssert(13,s,"Item must have parent unless root")}catch(o){n.default.reportError(o)}if(s&&(e.index||e.isNote()||(this.updateItemIndex(e),t.index=e.index),t.id=e.id,n.default.isLocalChange(a)&&I.a.pushModified(e,t,this._getPreviousState(e,t)),e.shouldSave())){let r=e.getDocumentOwner();r.getBacking().saveItem(r,e,n.default.clone(t),a,i),n.default.isDemoMode()||P.a.onDataSaved(r)}}saveItemRemote(e,t){let a=e.getDocumentOwner();a.getBacking().saveItem(a,e,t,o.a.ChangeType.Local,o.a.SaveFlag.Prop)}updateItemIndex(e){let t=e.parent();if(!e.isNote())if(t&&t.items.length()>1){let a=t.items.get(),i=a.indexOf(e),r=!e.isNote()&&i>0?a[i-1]:null,s=!e.isNote()&&i<a.length-1?a[i+1]:null;0,e.index=Object(w.a)(r?r.index:null,s?s.index:null)}else e.index="0"}addItem(e,t,a,i=!1){if(!i){this.updateItemIndex(t),I.a.pushAdded(e,t);let a=t.getDocumentOwner();a.getBacking().addItem(a,t)}}deleteItem(e,t,a){if(n.default.isLocalChange(a)){I.a.pushRemoved(e,t);let i=t.getDocumentOwner();i.getBacking().deleteItem(i,t,a)}}moveItem(e,t,a,i){if(this.updateItemIndex(e),n.default.isLocalChange(i)){let i=e.getDocumentOwner(),r={parent:e.parent().id,index:e.index},s={parent:t.id,index:a};I.a.pushModified(e,r,s),i.getBacking().moveItem(e,t)}}setNote(e,t,a,i){let r=e.getDocumentOwner();r.getBacking().setNote(r,e,t,a,i)}generateID(){return this._idProvider()}getEmptyDocument(){return this._emptyDocument}addDocument(e,t){e.createVMLIs();let a=t?Promise.resolve():this._sources[0].addDocument(e);return this._documentsById[e.id]=e,this.documentsArray.push(e,!1),this.documentsArray.sort(g.a.comparatorModified),a}createEmptyDocument(e,t){t=t||this.getDefaultBacking();let a=this.generateID(),i={id:this.generateID(),isRoot:!0,text:"Root",items:[]},r=new g.a({id:a,text:e,dateModified:Date.now(),rootData:i,acl:{[u.a.getUid()]:{t:u.a.getAccountName(),e:u.a.getDefaultAccountID(),r:o.a.DocumentAccessRoles.Admin}},backing:t});return r.createVMLIs(),r}addEmptyDocument(e,t,a,i){let r=this.createEmptyDocument(e,t);return r.needsSave=!0,this.addDocument(r,a).then(()=>i&&i()),r}saveDocument(e){e.getBacking().saveDocument(e)}renameDocument(e,t){e.setText(t),e.needsSave?(e.needsSave=!1,e.getBacking().addDocument(e)):this.saveDocument(e)}setSetting(e,t,a){a?this.settingProvider.setSetting(e,t):c.a.setSetting(e,{v:t})}saveBoard(e){this.settingProvider.saveBoard(e)}deleteBoard(e){return this.settingProvider.deleteBoard(e)}getBoards(){return this.settingProvider.getBoards()}setItem(e){this._itemCache[e.id]=e}getItem(e){return this._itemCache[e]}clearItem(e){delete this._itemCache[e]}createVMLI(e,t){return l.default.itemStoreManager.getDefaultItemStore().createItemRaw(e,t)}createTempVMLI(e,t){return t.noSave=!0,t.canDestroy=!0,t.isTemp=!0,l.default.itemStoreManager.getTempItemStore().createItemRaw(e,t)}destroyTempVMLI(e){l.default.itemStoreManager.getTempItemStore().destroyItem(e)}clearLocalData(){return b.a.clear(),c.a.clearAllData().then(()=>{n.default.reload()})}deleteDocument(e,t){delete this._documentsById[e.id],this.documentsArray.remove(e),e.needsSave||(t?e.getBacking().unlistenDocument(e):e.getBacking().deleteDocument(e,t))}hasPendingRemoteUpdates(){return Object.keys(S.a.itemsPending).length>0}isConnected(){return"Online"===this.onlineStatus.get()}__clearAllData(){confirm("Are you sure you want to clear everything?")&&(b.a.clear(),Promise.all(this._sources.map(e=>e.clearAllData())).then(()=>{n.default.reload()}))}getBackingRemote(){return S.a}getBackingLocal(){return d.a.supportLocalFiles()?E.a:void 0}onlineText(){var e=this.onlineStatus.get();return n.default.isDemoMode()?"DEMO":e}},s()(y.prototype,"onSourceLoaded",[m.a],Object.getOwnPropertyDescriptor(y.prototype,"onSourceLoaded"),y.prototype),s()(y.prototype,"onSourceDocumentsChanged",[m.a],Object.getOwnPropertyDescriptor(y.prototype,"onSourceDocumentsChanged"),y.prototype),s()(y.prototype,"clearLocalData",[m.a],Object.getOwnPropertyDescriptor(y.prototype,"clearLocalData"),y.prototype),s()(y.prototype,"__clearAllData",[m.a],Object.getOwnPropertyDescriptor(y.prototype,"__clearAllData"),y.prototype),y);t.a=new C},14:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(35),n=a(2),o=a(71),l=a(15),d=a(77);t.a=class extends l.a{init(){this.createObservables({isLoading:!1})}getElement(){return o.findDOMNode(this)}onClick(e){this.isLoading.get()||!1===this.props.enabled||(this.props.onClick||this.props.onMouseDown)(e,this.onButtonClickCallback)&&this.isLoading.set(!0)}onMouseDown(e){if(!1!==this.props.enabled&&e.button===r.a.ButtonCode.Left&&this.props.onHold){var t={target:e.target,preventDefault:e.preventDefault};this._holdTimeout=setTimeout(this.onHold,150,t)}}onMouseUp(e){this._clearHoldTimeout(),this.props.onMouseUp&&this.props.onMouseUp(e)}onHold(e){this._clearHoldTimeout(),this.props.onHold(e)}_clearHoldTimeout(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)}onKeyDown(e){e.keyCode===r.a.KeyCode.Enter&&this.onClick(e)}focus(){this.getElement().focus()}onButtonClickCallback(){this.isLoading.set(!1)}removeRipple(){this.ripples.removeAt(0)}render(){var e,t=this.state,a=this.props,r=!1===a.enabled;a.color?e=a.color:a.primary?e=a.raised?"c-button-raised-primary":"c-button-primary":a.heavy?a.raised||(e="c-button-heavy"):e=a.cancel?a.raised?"c-button-raised-cancel":"c-button-cancel":a.raised?"c-button-raised":"c-button";var o={display:a.display,lineHeight:a.height?"auto"===a.height?null:a.height+"px":"36px",height:a.height,width:a.width,textAlign:"center",margin:a.margin,paddingLeft:a.paddingLeft,paddingTop:a.paddingTop,paddingRight:a.paddingRight,paddingBottom:a.paddingBottom,fontWeight:a.fontWeight,fontSize:a.fontSize,color:a.color};void 0===a.margin&&(o.marginLeft=a.marginLeft,o.marginTop=a.marginTop,o.marginRight=a.marginRight,o.marginBottom=a.marginBottom),o=i.default.extend(o,this.props.style),a.raised&&!a.children&&a.icon&&!1!==a.round&&(o.borderRadius="50%");var l,h={fontSize:a.fontSize};if(a.icon){var c={height:a.height,fontSize:a.iconSize,color:a.color},u=i.default.classNames("fancyButtonIcon",a.icon,{"c-button":!!a.color});a.children?0!==a.padding&&(h.paddingLeft="6px",h.paddingRight=0,o.paddingLeft="16px",o.paddingRight="16px"):(o.width=a.width||36,o.height=a.height||36,o.maxWidth=a.height||36,o.maxHeight=a.height||36,o.textAlign="center"),l=n.createElement("i",{className:u,style:c})}isNaN(a.padding)||(h.padding="0 "+a.padding+"px");var p=a.children&&n.Children.count(a.children)>0,g=i.default.classNames("fancyButtonText"),f=p&&n.createElement("div",{className:g,style:h},a.children),m=i.default.classNames("fancyButton",e,{raised:a.raised},{loading:t.isLoading},{primary:a.primary},{cancel:a.cancel},{hasText:p},{hasIcon:!!a.icon},{disabled:r},{selected:a.selected},a.className),v=t.isLoading&&n.createElement("div",{className:"fancyButtonLoading"},n.createElement("i",{className:"icon-spinner"})),y=a.tooltipHotkey,_=y?i.default.isString(y)?y:s.a.printHotkeyByName(y.name,y.group):void 0;return n.createElement(d.a,{className:m,style:o,enabled:a.enabled,onMouseEnter:a.onMouseEnter,onMouseLeave:a.onMouseLeave,onMouseDown:a.onMouseDown&&this.onClick||a.onHold&&this.onMouseDown||void 0,onMouseUp:a.onHold||a.onMouseUp?this.onMouseUp:void 0,onClick:a.onClick?this.onClick:void 0,onDoubleClick:a.onDoubleClick,onRightClick:a.onRightClick,onKeyDown:this.onKeyDown,id:a.id,center:a.center||!!a.icon&&!p,ripple:a.ripple,tabIndex:a.tabIndex,"data-tooltip":!r&&a.tooltip?a.tooltip:null,"data-tooltiphotkey":r?null:_},l,f,v)}}},142:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(5),n=a(2),o=a.n(n),l=a(15).b.createClass({displayName:"ReactSearchButton",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){var e=this.props.filter;this.firstValue=this.props.filterValue||e.initialValue},onMouseDown:function(e){i.default.preventAndStop(e)},onClickIcon:function(e){var t=this.props.filter,a=this.props.filterValue;a=!1!==t.canBeNegated&&(!s.a.mac&&e.ctrlKey||s.a.mac&&e.metaKey)&&!isNaN(t.initialValue)&&a!==-t.initialValue?-t.initialValue:a?0:t.initialValue,this.props.search.setFilter(t.name,a,!0)},render:function(){var e=this.props,t=e.filter,a=e.filterValue,r=this.firstValue===a,s=e.noClick?void 0:this.props.search.getFilterTooltip(t),n=i.default.classNames("searchButton",{"c-border-super-light":e.hasBorder},{"c-button":!a},{selected:!!a},t.icon,t.isOption&&(1===a?"yes":-1===a?"only":""),!t.isOption&&((a?this.firstValue>0&&r||this.firstValue<0&&!r:this.firstValue>0)?"yes":"no"));return o.a.createElement("div",{className:n,"data-tooltip":s,onMouseDown:this.onMouseDown,onClick:e.noClick?void 0:this.onClickIcon})}});t.a=l},143:function(e,t,a){"use strict";a.r(t);var i=a(0),r=a(1),s=a(3),n=a(6),o=a(16),l=a(35),d=a(9),h=a(4),c=a(17);var u=class{constructor(){this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.dragItem=void 0,this.draggingItems=[],this.position=void 0,this.isVisible=new d.a(!1),this.isInDrag=new d.a(!1),this.transform=new d.a({left:0,top:0}),this.linePosition=new d.a,this.isDraggingPane=new d.a(!1),this.draggingToOutline=new d.a,this.dragTargetHovered=new d.a,o.a.binder(this,"handleEscapeKey")}stop(){var e=0;this.__hotkeyEscape&&(l.a.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0),this.activePane&&!this.activePane.isDestroyed()?this.activePane.notifyDragEnd():s.default.PaneManager.runForEachPane(e=>{e.notifyDragEnd()});var t=this.draggingItems;let a=e=>e.draggedInPane.set(void 0);for(var i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t[i].item.forEachChildRecursive(a,!0,!0)}this.draggingItems=[],this.isDragging=!1,this.dragItem=void 0,this.position=void 0,this.externalData=void 0}finish(){this.isVisible.set(!1),this.isInDrag.set(!1),this.blockTarget=void 0,c.a.fireEvent("endDrag",[])}start(e,t,a,s,o,d,c,u){var p=0;this.isDragging&&(this.stop(),this.finish()),this.__hotkeyEscape=l.a.pushStackEscape(this.handleEscapeKey),i.default.setItemAnimationMode(r.a.ItemAnimationMode.None),this.isDragging=!0,this.activePane=o,this.dragInfo=null,this.startPane=o,this.startInfo=d,this.dataTransfer=c,this.dragItem=e,this.startDragitem=e,this.fromOverview=u,this.externalData=void 0,this.draggingItems=t,this.position={left:a,top:s},this.transform.set({left:0,top:0},!1),h.a.reset();let g=e=>e.draggedInPane.set(i.default.focusedPane);for(var f=0;f<t.length;++f){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;t[f].item.forEachChildRecursive(g,!0,!0)}this.isInDrag.set(!0),this.isVisible.set(!0),this.activePane.notifyDragStart(),n.d.miscAction({type:n.b.Misc,misc:n.a.DragItem,data:{itemID:e.id,fromPane:o}})}startExternal(e){this.isDragging=!0,this.activePane=e,this.startPane=e,this.draggingItems=[],this.isVisible.set(!0),this.isInDrag.set(!0),this.activePane.notifyDragStart()}setExternalData(e){this.externalData=e}setTransform(e,t){this.isVisible.set(!0,!1),this.isInDrag.set(!0,!1),this.transform.set({left:e,top:t})}handleDragOver(e){var t=i.default.elementFromPoint(e.clientX,e.clientY),a=i.default.getPaneForElement(t);if(this.activePane&&a!==this.activePane&&this.revertDrag(),i.default.vmMain.checkDragForScroll(e),a){this.isDragging||this.startExternal(a),this.activePane=a;var r=!!i.default.findParent(t,"paneOverviewScroller");a.canAcceptDragOver(e.dataTransfer.pane,e.item,t,r)?this.dragInfo=a.handleDragOver(e.dataTransfer.pane,e.item,t,e.clientX,e.clientY):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||i.default.cancelRepeatScrolls(),!1}revertDrag(){this.dragInfo=null,this.activePane.revertDrag()}handleDropItem(e,t,a){var r,n=e,o=this.activePane;this.isDropping=!0,i.default.cancelRepeatScrolls();var l=t.target;return l&&i.default.findParent(l,"mobileDropBucket")?(s.default.dropBucket.addItemEntry(e,o),this.dragTargetHovered.set(void 0),r=n):this.dragInfo&&o&&(s.default.PaneUpdateBatcher.beginUpdateItems(),this.startInfo&&0===this.startInfo.items[0].index&&this.startPane.setIgnoreRestoreScroll(),o.handleDragDrop(e,t,this.dragInfo,a),s.default.PaneUpdateBatcher.commitUpdateItems(),r=n),this.isDropping=!1,r}handleDrop(e){var t=this.activePane;if(t&&(i.default.elementInPane(e.target)||e.fromDropBucket)){var a=e.dataTransfer.item;if(this.isDragging=!1,this.isVisible.set(!1),a)return this.handleDropItem(a,e),!0;s.default.pluginManager.handleDropEvent(e,(a,i)=>{n.d.beginAction();var s=t.createVMLI({text:a},{changeType:r.a.ChangeType.AllLocal,noParentOkay:!0});return s=this.handleDropItem(s,e,i),n.d.endAction(),!!s})}else i.default.isNonPaneDropTarget(e.target)&&e.dataTransfer.item&&this.handleDropItem(e.dataTransfer.item,e);this.isInDrag.set(!1),i.default.resetItemAnimationMode(),e.stopPropagation(),e.preventDefault()}handleDragLeave(e){e.clientX||e.clientY||(this.isDragging=!1,this.isVisible.set(!1),this.isInDrag.set(!1))}setBlockTarget(e){this.blockTarget=e}stopDraggingToOutline(){this.draggingToOutline.get(),this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}handleEscapeKey(){this.escapedDragging=!0,this.dragItem.dragEnd()}},p=a(19),g=a(5);t.default=class extends u{constructor(){super(),window.addEventListener("dragover",this.handleDragOver.bind(this)),window.addEventListener("dragleave",this.handleDragLeave.bind(this)),window.addEventListener("drop",this.handleDrop.bind(this))}handleDrop(e){if(!super.handleDrop(e)){var t=this.activePane;if(e.dataTransfer.getData&&(e.dataTransfer.getData(g.a.ie?"Text":"text/plain")||e.dataTransfer.getData("text/html"))){var s=p.default.getCursorSelectionRange(e);try{i.default.PAssert(338,s,"Range should always be properly set")}catch(u){i.default.reportError(u)}h.a.setFocusedPane(t),n.d.beginAction();var o=t.createVMLI({text:""},{changeType:r.a.ChangeType.AllLocal,noParentOkay:!0});return o=this.handleDropItem(o,e,!0),h.a.selectItem(o,0),a(182).default.insert(e.dataTransfer,e,r.a.DataSource.Drop),n.d.endAction(),!0}if(this.externalData){var l=this.externalData;this.externalData=void 0;var d=l.split(":"),c=(d.removeAt(0),"["+d.removeAt(0)+"]("+d.join(":")+")");return n.d.beginAction(),o=t.createVMLI({text:c},{changeType:r.a.ChangeType.AllLocal}),o=this.handleDropItem(o,e,!0),n.d.endAction(),!0}}}handleDropItem(e,t,a){let r=super.handleDropItem(e,t,a);if(!r&&i.default.isNonPaneDropTarget(t.target)){var s,n=t.dataTransfer.pane;if(n){s=n.notifyDropFromToEdit(e,t.target);try{i.default.PAssert(339,!s||i.default.isDOMNode(s),"Must always return DOM elements to insert")}catch(l){i.default.reportError(l)}}if(s){var o=p.default._getCursorSelectionRange(t.clientX,t.clientY);p.default.setSelectionRange(o),p.default.insertNode(s)}}return r}}},144:function(e,t,a){"use strict";var i=a(57),r=a.n(i),s=a(0),n=a(2),o=a.n(n),l=a(15),d=a(5);var h=class extends l.a{init(){this.amtMoved=void 0,this.prevPos=void 0,this.isDragging=!1,this.createObservables({dragPosition:void 0})}getElement(){return this.refs.element}getDraggingElement(){return this.refs.draggingElement}getDragPosition(){return this.state.dragPosition}onMouseDown(e){var t=this.props.horizontal,a=t?e.clientX:e.clientY;this.amtMoved=0,this.prevPos={left:e.clientX,top:e.clientY},this.dragOffset=s.default.offset(this.refs.element)[t?"left":"top"]-a,this.props.allowDragOut&&(this.startPos={left:e.clientX,top:e.clientY}),document.addEventListener("mousemove",this.onMouseMoveDragging),document.addEventListener("mouseup",this.onMouseUpDragging)}onMouseMoveDragging(e){var t=this.props,a=t.horizontal,i=a?e.clientX:e.clientY;if(this.amtMoved+=Math.abs(e.clientX-this.prevPos.left)+Math.abs(e.clientY-this.prevPos.top),this.amtMoved>3){this.isDragging||(this.isDragging=!0,t.onDragStart(this)),t.onDragMove(this,e);var r=a?"left":"top",n=this.refs.element.parentElement,o=s.default.offset(n),l=i+this.dragOffset-o[r],d={};a?(d.left=l,t.allowDragOut&&(d.top=e.clientY-this.startPos.top)):(d.top=l,t.allowDragOut&&(d.left=e.clientX-this.startPos.left)),this.dragPosition.set(d)}this.prevPos={left:e.clientX,top:e.clientY}}onMouseUpDragging(e){this.isDragging&&this.props.onDragEnd(this,e),this.amtMoved=void 0,this.prevPos=void 0,this.dragOffset=void 0,this.isDragging=!1,this.dragPosition.set(void 0),document.removeEventListener("mousemove",this.onMouseMoveDragging),document.removeEventListener("mouseup",this.onMouseUpDragging)}render(){var e=this.state,t=this.props,a=e.dragPosition,i=!s.default.isEmpty(a),r=s.default.classNames(t.className,"fancySortableItem",{noClick:t.noDrag},{dragging:i||t.isDragging}),n=s.default.classNames((i||t.isDragging)&&t.classDragging),l={};return a&&(l[d.a.transform.react]="translate3d("+(a.left||0)+"px,"+(a.top||0)+"px,0)"),o.a.createElement("div",{className:r,onMouseDownCapture:this.onMouseDown,ref:"element"},o.a.createElement("span",{className:n},t.children),i&&o.a.createElement("div",{className:"draggingElement",style:l,ref:"draggingElement"},t.children))}};t.a=class extends l.a{init(){this.createObservables({draggingChild:void 0})}getElement(){return this.refs.element}onDragStart(e){this.isDraggingInside=!0,this.dragDidMove=!1,this.draggingChild.set(e)}findTargetIndex(e){for(var t=0,a=o.a.Children.count(this.props.children),i=this.props.horizontal?"left":"top",r=this.props.horizontal?"width":"height",n=e.props.owner===this?e.props.index:-1,l=e.getDraggingElement(),d=s.default.offset(l)[i],h=l.getBoundingClientRect()[r],c=-1,u=!1,p=0;p<a;p++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var g=this.refs["el_"+p];if(g!==this.draggingChild.get()){var f=g.getElement(),m=s.default.offset(f)[i],v=f.getBoundingClientRect()[r],y=Math.min(v,h)/2;if(p>n)d+y>=m&&(c=p,p===a-1&&!u&&d>m+y&&(c=a));else if(d<=m+y)return p}else u=!0}return c}onDragMove(e,t){if(e.getDraggingElement()){var a=this,i=e.props.index,r=e.props.owner;this.props.getDragTargetFromElement&&!(a=this.props.getDragTargetFromElement(t.target))&&this.isDraggingInside&&(this.isDraggingInside=!1,this.props.onDragOut(i,r)),a&&(this.isDraggingInside=!0,a.handleDragMove(e,t))}}handleDragMove(e,t){var a=e.props.index,i=e.props.owner,r=this.findTargetIndex(e);r>=0&&(r!==a||this!==i)&&(this.dragDidMove=!0,this.props.moveChild(a,r,i,this))}onDragEnd(e,t){if(this.draggingChild.set(void 0),this.props.onDragEnd){var a=!1;if(this.props.getDragTargetFromElement){var i=this.props.getDragTargetFromElement(t.target);a=i&&i!==this}this.props.onDragEnd(e,a,this.dragDidMove||a)}}render(){var e=this,t=this.props,{moveChild:a,horizontal:i,getDragTargetFromElement:n,onDragOut:l,classDragging:d,onDragEnd:c,...u}=t,p=s.default.classNames("fancySortableList",t.className,{dragging:!!this.state.draggingChild},{flexbox:i}),g=o.a.Children.map(t.children,function(a,r){return o.a.createElement(h,{owner:e,onDragStart:e.onDragStart,onDragMove:e.onDragMove,onDragEnd:e.onDragEnd,ref:"el_"+r,index:r,horizontal:i,noDrag:a.props["data-nodrag"],isDragging:a.props["data-isdragging"],allowDragOut:!!t.getDragTargetFromElement,classDragging:t.classDragging},a)});return o.a.createElement("div",r()({},u,{className:p,ref:"element"}),g)}}},145:function(e,t,a){"use strict";t.a=class{constructor(e,t){this.target=e,this.cb=t,this._disposed=!1}dispose(){this._disposed=!0,this.target.unlisten(this.cb)}isDisposed(){return this._disposed}}},146:function(e,t,a){"use strict";a.d(t,"a",function(){return s});var i=a(0);const r=(e,t)=>("string"===typeof e&&(e=e.split(",")),e[e.length-1]=""+(+e[e.length-1]+t),e.join(",")),s=(e,t)=>{"number"===typeof e&&(e=""+e),"number"===typeof t&&(t=""+t);let a="0";if("string"===typeof e&&"string"===typeof t)a=((e,t)=>{let a=e.split(","),i=t.split(","),s=a.length,n=i.length;if(s<n){let e=a[s-1],t=i[s-1];return+e+1<+t?r(a,1):r(i,-1)}if(s>n)return r(a,1);{let e=a[s-1],t=i[n-1];return+e+1<+t?r(a,1):(a.push("0"),a.join(","))}})(e,t);else if("string"===typeof e){let t=+e.split(",")[0];try{i.default.PAssert(140,!isNaN(t),"Index is not valid string",e)}catch(s){i.default.reportError(s)}a=""+Math.floor(t+1)}else if("string"===typeof t){let e=+t.split(",")[0];try{i.default.PAssert(141,!isNaN(e),"Index is not valid string",t)}catch(s){i.default.reportError(s)}a=""+Math.ceil(e-1)}return a}},147:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(27);const o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.a=new class{makePropString(e,t,a){return t?',"'+e+'":'+(a?a(t):t):""}safeJSONText(e){return o.lastIndex=0,o.test(e)?e.replace(o,function(e){var t=l[e];return i.default.isString(t)?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}):e}_addItemToArray(e,t,a,i){let r=t.getFullSaveData();if(!i&&r.note&&delete r.note,e.push(r),t.hasChildren()){var s=0;let r=t.getItems();for(var n=0;n<r.length;n++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;let t=r[n];this._addItemToArray(e,t,a,i)}}i&&t.hasNote()&&e.push(t.getNote().getFullSaveData())}getBestEncryptionOut(){const e=s.default.settings.encryptionKeys.get();return e&&e[r.a.EncryptionKeys.UserPassword]?r.a.EncryptionKeys.UserPassword:r.a.EncryptionKeys.Global}async getItemsData(e,{exportArchived:t,includeNotes:a,encrypt:r,encryptionKey:o}){let l=[];if(this._addItemToArray(l,e,t,a),r){try{i.default.PAssert(849,o,"getItemsData missing encryptionKey")}catch(d){i.default.reportError(d)}return Promise.all(l.map(e=>n.a.encryptItemOut(e,s.default.crypto,o)))}return Promise.resolve(l.map(e=>n.a.itemOut(e)))}toDropHtml(e){var t="";if(!e.isArchived()&&(t+="<li>"+i.default.escape(e.getParsedText())+"</li>",e.hasChildren())){var a=0;t+="<ul>";for(var r=0;r<e.numChildren();++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.toDropHtml(e.getChild(r))}t+="</ul>"}return t}toHtml(e,t,a,r){var s="<ul>",n=e.getItems();if(n)for(var o=0,l=0;l<n.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=n[l],h=i.default.escape((r?d.getPrefix():"")+d.generateTitleText());if(!d.isArchived()||d.isArchived()&&t){if(s+="<li>"+h,a){let e=d.hasNote()&&d.getNote();e&&(s+="<li>",s+=i.default.escape(e.getParsedText()),s+="</li>")}d.numItems()>0&&(s+=this.toHtml(d,t,a,r)),s+="</li>"}}return s+="</ul>"}toPlainText(e,t,a,r,s){isNaN(t)&&(t=0);var n="",o=e.getItems();if(o)for(var l=0,d=0;d<o.length;d++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=o[d];if(!h.isArchived()||h.isArchived()&&a){for(var c=0,u=0;u<t;u++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;n+="\t"}if(n+=i.default.escape((s?h.getPrefix():"")+h.generateTitleText())+"\n",r){let e=h.hasNote()&&h.getNote();e&&(n+=e.getParsedText()+"\n")}h.numItems()>0&&(n+=this.toPlainText(h,t+1,a,r,s))}}return n}}},148:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(108),n=a(31);function o(e,t,a,r,s,n,o){this.file=e,this.properties=r,this.contentType=e.type,this.accountID=t,this.folder=a,this.onComplete=n||i.default.emptyFn,this.onError=o||i.default.emptyFn,this.onProgress=s||i.default.emptyFn,this._callbacks=[],this.offset=0,this.chunkSize=1048576,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;this.url=this._buildURL(void 0,{uploadType:"resumable"}),this._percent=0}o.prototype={upload:function(){this._hasStarted=!0,i.default.isDemoMode()?setTimeout(()=>{this.onComplete()},2e3):n.a.getDefaultAuthToken([r.a.GScope.Drive],e=>{if(e){var t={Authorization:"Bearer "+e.access_token,"Content-Type":"application/json","X-Upload-Content-Length":this.file.size,"X-Upload-Content-Type":this.contentType};s.a.getFolder(this.folder,e=>{var a,s={title:this.file.name,mimeType:this.contentType,parents:e?[{id:e}]:[]};this.properties&&(s.properties=Object.keys(this.properties).map(e=>({key:e,value:this.properties[e],visibility:"PRIVATE"})));try{a=JSON.stringify(s)}catch(n){i.default.reportError(n)}a?i.default.XHR({url:this.url,type:"POST",headers:t,data:a,autoRetry:!0}).then(e=>{if(e.status<r.a.HTTPStatusCode.BadRequest){var t=e.getResponseHeader("Location");this.url=t,this._runUpload()}else this._onError(e)}):this._onError()})}})},_runUpload:function(){try{i.default.PAssert(857,this.url,"Must have a valid remote URL to run upload")}catch(s){i.default.reportError(s)}this._isRunning=!0;var e=Math.min(this.offset+this.chunkSize,this.file.size),t=this.file.slice(this.offset,e),a={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(e-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};i.default.XHR({url:this.url,type:"PUT",headers:a,data:t,autoRetry:!0}).then(e=>{if(e.status===r.a.HTTPStatusCode.Success||e.status===r.a.HTTPStatusCode.Created)this.isCanceled()||this._onComplete(e);else if(e.status===r.a.HTTPStatusCode.PermRedirect){var t=this._extractRange(e.getResponseHeader("Range"));this.offset=t,this._onProgress(this.offset/this.file.size),this.isCanceled()||this._runUpload()}else this._onError(e)})},resume:function(){try{i.default.PAssert(858,!this.isDone(),"Should not resume a completed upload")}catch(t){i.default.reportError(t)}try{i.default.PAssert(859,this._hasStarted,"Must have started an upload to resume it")}catch(t){i.default.reportError(t)}try{i.default.PAssert(860,this.url,"Must have a valid remote URL to resume upload")}catch(t){i.default.reportError(t)}if(this._hasError=!1,this._isCanceled=!1,this._isRunning)0;else if(this._isRunning=!0,this._hasStarted&&this.url){var e={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};i.default.XHR({url:this.url,type:"PUT",headers:e,autoRetry:!0}).then(e=>{if(e.status===r.a.HTTPStatusCode.PermRedirect){var t=this._extractRange(e.getResponseHeader("Range"));this.offset=t,this._onProgress(this.offset/this.file.size),this._runUpload()}else this._onError(e)})}else this.upload()},cancel:function(){try{i.default.PAssert(861,!this._isDone,"Cannot cancel an upload that is already complete")}catch(e){i.default.reportError(e)}this._isCanceled=!0,this._isRunning=!1},_onError:function(e){this._hasError=!0,this._isRunning=!1,this.onError()},_onComplete:function(e){var t=0;try{i.default.PAssert(862,!this._isDone,"Should not call the complete CB twice")}catch(s){i.default.reportError(s)}try{i.default.PAssert(863,!this._isCanceled,"Should not be able to complete a canceled upload")}catch(s){i.default.reportError(s)}this._isDone=!0,this._isRunning=!1;var a={};if(e&&e.response)try{a=JSON.parse(e.response)}catch(n){i.default.reportError(n)}this._onProgress(1),this.onComplete(a);for(var r=0;r<this._callbacks.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._callbacks[r](a)}catch(n){i.default.reportError(n)}}this._callbacks=[]},_onProgress:function(e){try{i.default.PAssert(864,!this._hasError,"Should not make forward progress when an error has occurred")}catch(t){i.default.reportError(t)}this._percent=e,this.onProgress(e)},_extractRange:function(e){return i.default.parseInt(e.match(/\d+/g).pop())+1},_buildQueryString:function(e){return e=e||{},Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},_buildURL:function(e,t){var a="https://www.googleapis.com/upload/drive/v2/files/";e&&(a+=e);var i=this._buildQueryString(t);return i&&(a+="?"+i),a},notifyOnComplete:function(e){try{i.default.PAssert(865,this._callbacks.indexOf(e)<0,"Should not include fn twice")}catch(t){i.default.reportError(t)}try{i.default.PAssert(866,!this.isDone(),"Should not notify on complete after done")}catch(t){i.default.reportError(t)}try{i.default.PAssert(867,!this.hasError(),"Should not notify on complete after error")}catch(t){i.default.reportError(t)}this._callbacks.push(e)},isCanceled:function(){return this._isCanceled},isDone:function(){return this._isDone},isRunning:function(){return this._isRunning},hasError:function(){return this._hasError},getPercent:function(){return this._percent}},t.a=o},149:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(2),o=a.n(n),l=a(15),d=a(5),h=a(44),c=a(52),u=a(4),p=a(19),g=a(35),f=a(142),m=a(51),v=a(14),y=l.b.createClass({displayName:"ReactSearch",componentDisplay:r.a.ComponentDisplay.Everywhere,onMount:function(){this.props.pane.search.UI=this,this.listenTo(this.props.pane.search.onChanged),this.forceUpdate()},getState:function(){for(var e=0,t=this.props.pane,a=t.search,i={search:a.value,calendars:c.a.GCalendarsAvailable,displayCalendars:t.displayCalendars,displayLocalItems:t.displayLocalItems},r=0;r<a.filters.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=a.filters[r];i[s.name]=s.value,i[s.name+"Enabled"]=s.enabled}return i},onChange:function(e){this.props.pane.search.setValue(e)},onParsed:function(e){this.props.pane.search.onParsed(e)},setSearch:function(e,t){this.props.pane.search.setValue(e),!1!==t&&this.setSelectionOffset(e.length)},getSelectionOffset:function(){return this.refs.input.getSelectionOffset()},setSelectionOffset:function(e){this.refs.input.setSelectionOffset(e)},onFocus:function(){var e=this.props.pane,t=e.search;t&&(this._selectionBeforeBlur=u.a.save(),u.a.reset(),t.isFocused.set(!0),h.a.hide(),i.default.sendEvent("SearchFocus","Desktop"),t.filters.length>0&&!s.default.menus.isContextMenuOpen("ReactContextMenuSearch")&&s.default.menus.openContextMenu({componentName:"ReactContextMenuSearch",key:"search"+e.id+(e.viewMode?e.getViewMode():""),element:this.refs.searchBox,positionOffset:{top:4},noBackdrop:!0,pane:e,showFilters:this.props.showFilters,onClosed:this.blur}))},onBlur:function(){var e=this.props.pane.search;e&&e.isFocused.set(!1)},focus:function(){this.refs.input.focus(),this.refs.input.selectEnd()},blur:function(){this.refs.input&&this.refs.input.blur()},onTapX:function(e){var t=this.props.pane;if(this.state.search.length>0){var a=u.a.save();this.setSearch("",!1),a&&t.restoreSelection(a),i.default.preventDefault(e),i.default.sendEvent("Menu","ClearSearch")}else this.focus(),i.default.sendEvent("Menu","FocusSearch")},onKeyDown:function(e){if(this.saveScrollOfTop(),d.a.mac&&e.ctrlKey&&e.keyCode===r.a.KeyCode.T)return i.default.preventDefault(e),this.blur(),void g.a.hotkeyAddPane();var t=this.props.pane;e.keyCode===r.a.KeyCode.Enter&&(t.search.update(!0,!0),this.setSelectionOffset(this.state.search.length));if(e.keyCode===r.a.KeyCode.Tab||e.keyCode===r.a.KeyCode.Enter){var a=t.indexOfFirstItem();if(a>=0){var s=a,n=this._selectionBeforeBlur;n&&(u.a.restore(n)?(this._selectionBeforeBlur=void 0,s=n.startIndex):n=null),n||(this.blur(),t.selectIndex(a,0),setTimeout(function(){t.selectIndex(a,0)},0)),u.a.focusPane(t),s>=0&&i.default.focusedPane.scrollIndexIntoView(s,r.a.ScrollDuration.Default)}else t.type===r.a.PaneMode.Task&&t.addItem({e});e.preventDefault(),e.stopPropagation()}},onAutocompleteSelected:function(e){if(e.item){var t=this.props.pane.search,a=t.getValue(),i=a.indexOf(r.a.PrefixItemAutocomplete);a=a.substr(0,i),t.setValue(a),this.props.pane.zoomIn(e.item,{forLoad:!1,showToast:!1,noSel:!0}),this.setSelectionOffset(a.length)}this.refs.input.updateAutocomplete(),this.focus()},onClickFilters:function(){this.focus()},onClickPriority:function(){this.props.pane.search.setFilter("priority",0)},onClickText:function(e){if(e.altKey){let n,o,l;if(i.default.hasClass(e.target,"fancyInputInput")){let e=p.default.getSelectionRange().getNativeRange();if(e){let s=(n=e.cloneRange()).startContainer.nodeValue;if(i.default.isString(s)){var t=0,a=0;let e=0,i=s.length;for(var r=n.startOffset;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "===s[r]||160===s.charCodeAt(r)){e=r+1;break}}for(r=n.endOffset;r<s.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(" "===s[r]||160===s.charCodeAt(r)){i=r;break}}o=i-e,l=e}}}else(n=p.default.createSelectionRange()).selectNodeContents(e.target),l=n.startOffset,o=n.toString().length;if(n&&!isNaN(l)&&o){n.setEnd(n.startContainer,l),n.setStart(n.startContainer.parentNode,0);let e=n.toString().length,t=this.props.pane.search,a=t.getValue();s.default.PaneUpdateBatcher.beginUpdateItems(),a=(a.substr(0,e)+a.substr(e+o)).replace(/  +/g," ").trim(),t.setValue(a),s.default.PaneUpdateBatcher.commitUpdateItems(),this.setSelectionOffset(e)}}},saveScrollOfTop:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)},renderSearchButton:function(e){var t=this.props.pane;return o.a.createElement(f.a,{key:e.name,filter:e,filterValue:e.value.get(),search:t.search})},renderSearchPriority:function(){var e=this.props.pane.search.filter_priority.value.get(),t=e===r.a.VMLIFlag.P0?0:e===r.a.VMLIFlag.P1?1:e===r.a.VMLIFlag.P2&&2,a=i.default.classNames("searchPriority searchP"+t+" selected");return o.a.createElement("span",{key:"priority",className:a,onClick:this.onClickPriority})},render:function(){var e=this.props,t=this.state,a=e.pane,i=a.search,s=t.search,n=s.length>0?"icon-close":"",l=r.a.SearchHeight,d=[];if(!1!==e.showFilters){for(var h=0,c=0;c<i.filters.length;c++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var u=i.filters[c];u.enabled.get()&&u.value.get()&&(u.icon?d.push(this.renderSearchButton(u)):"priority"===u.name&&d.push(this.renderSearchPriority()))}a.isViewDates()&&a.isCalFilterActive()&&d.push(o.a.createElement("div",{key:"dateFilter",className:"searchButton icon-calendar selected yes",onClick:this.onClickFilters}))}var p=o.a.createElement(v.a,{className:"searchX c-button noShrink",width:24,height:l,icon:n,onClick:this.onTapX}),g=o.a.createElement("div",{className:"searchInnerWrap",ref:"searchInnerWrap"},o.a.createElement(m.a,{ref:"input",className:"search",id:"search",height:l,value:s,onClick:this.onClickText,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,onParsed:this.onParsed,parse:!0,placeholder:"Search",autocompleteMode:"all",border:!1,autocompleteElementDisplay:this.refs.searchBox,padding:{left:0,right:0},onAutocompleteSelected:this.onAutocompleteSelected,supportSearchItemAutocomplete:a.supportSearchItemAutocomplete,canAutocompleteItems:a.type===r.a.PaneMode.Task,noShowAutocomplete:!0,isSearch:!0,pane:a}));return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"searchWrap"},o.a.createElement("div",{className:"searchBox c-bg-light flexbox",ref:"searchBox"},o.a.createElement("div",{className:"searchBoxInner flexbox"},g,p),d.length>0&&o.a.createElement("div",{className:"searchButtons noShrink"},d))))}});t.a=y},15:function(e,t,a){"use strict";var i=a(0),r=a(16),s=a(1),n=a(3),o=a(2),l=a(35),d=a(9),h=a(32),c=a(17),u=a(40),p=a(71),g=a(468),f=a.n(g);const m={addTap:function(e,t,a){var r=this.refs[e];try{i.default.PAssert(516,r,"Invalid refName to add tap to: ",e)}catch(s){i.default.reportError(s)}r&&i.default.setupClick(r,t,a)},refElement:function(e){var t=this.refs[e];return i.default.isDOMNode(t)?t:p.findDOMNode(t)}},v=e=>t=>{try{i.default.PAssert(517,!t.mixins,"Should not supply separate mixins value")}catch(a){i.default.reportError(a)}try{i.default.PAssert(518,t.displayName,"Must always specify displayName for react components")}catch(a){i.default.reportError(a)}t.mixins=[e];return!0,f()(t)};a.d(t,"a",function(){return D});var y={},_=0;function S(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function P(e,t,a){var i=0;if(S(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r,s=Object.keys(e),n=Object.keys(t);if(s.length!==n.length)return!1;for(var o=0;o<s.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r=void 0,!hasOwnProperty.call(t,s[o]))return!1;if(a&&!1===(r=a(s[o],e[s[o]],t[s[o]])))return!1;if(void 0===r&&!S(e[s[o]],t[s[o]]))return!1}return!0}let I={shouldComponentUpdate:function(e,t){return!P(this.props,e,this.arePropsEqual)||!P(this.state,t,this.areStatesEqual)},getInitialState:function(){this.init&&this.init();var e=this.getState?this.getState(this.props):{};this._observables&&(e=i.default.extend(e,this._observables));var t=null;return e&&(this.setupListeners(e),t=this.transformState(e)),t},createObservables:function(e){try{i.default.PAssert(164,!this._listeners,"You have to run createObservables in init()")}catch(r){i.default.reportError(r)}for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];i.default.isArray(a)?e[t]=new h.a(a):e[t]=new d.a(a);try{i.default.PAssert(165,!this.hasOwnProperty(t),"Must not multi-define observable properties")}catch(r){i.default.reportError(r)}this[t]=e[t]}try{i.default.PAssert(166,!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables")}catch(r){i.default.reportError(r)}this._observables=e},addObservable:function(e,t){t=i.default.isArray(t)?new h.a(t):new d.a(t),this[e]=t,this._observables[e]=t,this._addListener(t.listen(this.onListener))},_addListener:function(e){try{i.default.PAssert(167,e&&e.target,"Must add a valid listener")}catch(t){i.default.reportError(t)}this._ensureListeners();try{i.default.PAssert(168,!this._hasListener(e.target),"Must not double register the same observable/trigger")}catch(t){i.default.reportError(t)}this._listeners.push(e)},refreshListeners:function(e){this.disposeListeners();var t=this.getState?this.getState(e||this.props):{};this._observables&&(t=i.default.extend(t,this._observables)),t&&this.setupListeners(t)},_ensureListeners:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])},setupListeners:function(e){for(var t in this._ensureListeners(),e||(e=this.getState?this.getState(this.props):{}),e)if(e.hasOwnProperty(t)){var a=e[t];a instanceof d.a&&this._addListener(a.listen(this.onListener))}},disposeListeners:function(e){if(this._listeners){for(var t=0,a=0;a<this._listeners.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._listeners[a].dispose()}if(this._listeners=[],e){var i=0;for(a=0;a<this._permanentListeners.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._permanentListeners[a].dispose()}}}e&&this.disposeDispatcherListeners()},disposeDispatcherListeners:function(){if(this._dispatcherListeners){for(var e=0,t=0;t<this._dispatcherListeners.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._dispatcherListeners[t],i=a[0],r=a.slice(1);i.unlisten.apply(i,r)}this._dispatcherListeners=[]}},listenTo:function(e,t){try{i.default.PAssert(169,e&&(e instanceof u.a||e instanceof d.a),"Can only listen to an Observable or a Trigger object")}catch(r){i.default.reportError(r)}if(e instanceof u.a||e instanceof d.a){var a=e.listen(this.onListener);!1!==t?this._addListener(a):this._permanentListeners.push(a)}},listenToDispatcher:function(){this._dispatcherListeners||(this._dispatcherListeners=[]);var e,t=Array.prototype.slice.call(arguments);i.default.isString(t[0])?e=c.a:(e=t[0],t.splice(0,1)),t.push(this.onListener),e.listen.apply(e,t);var a=[e].concat(t);this._dispatcherListeners.push(a)},_hasListener:function(e){var t=0;try{i.default.PAssert(170,e,"Must have a valid target")}catch(s){i.default.reportError(s)}for(var a=!1,r=0;r<this._listeners.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._listeners[r].target===e){a=!0;break}}return a},_getState:function(e){var t=this.getState?this.getState(e||this.props):{};return this._observables&&(t=i.default.extend(t,this._observables)),this.transformState(t)},transformState:function(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];a&&a instanceof d.a&&(e[t]=a.get(),a instanceof h.a&&(e[t+"_arrVer"]=a.version))}return e},onListener:function(){this.updateState()},updateState:function(e){try{i.default.PAssert(172,this._isMounted,"updateState called on a component that is not yet mounted:",this.constructor&&this.constructor.displayName)}catch(t){i.default.reportError(t)}if(this._isMounted){let t=this.state,a=this._getState(e);if(this.onBeforeChanged){let i=this.onBeforeChanged(a,t,e);void 0!==i&&(a=i)}!1!==a&&(this.setState(a),this.onAfterChanged&&this.onAfterChanged(a,t))}},componentWillUnmount:function(){this.disposeListeners(!0),this.__hotkeys&&(l.a.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1},getChildByKey:function(e){var t;return o.Children.forEach(this.props.children,a=>{a&&a.key===e&&(t=a)}),t},componentDidMount:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=l.a.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=l.a.pushStackEscape(this.onEscapeKey)),this.onMount&&this.onMount()},getUniqueID:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+_++),this.__id)},componentDidCatch:function(e,t){this.onComponentError&&this.onComponentError(e,t),i.default.reportError(e,t,void 0,"React Component Error: "),n.default.toasts.pushMessage(s.a.MessageID.ReactError)}};if(m&&r.a.extend(I,m),v){let e=Object.assign({shouldComponentUpdate:function(e,t){return!P(this.props,e,this.arePropsEqual)||!P(this.state,t,this.areStatesEqual)}},I);y.createClass=v(e)}let b={constructor:!0,componentWillMount:!0,render:!0,componentDidMount:!0,componentWillReceiveProps:!0,shouldComponentUpdate:!0,componentWillUpdate:!0,componentDidUpdate:!0,componentWillUnmount:!0};class D extends o.Component{constructor(e){super(e);const t=Object.getPrototypeOf(this),a=Object.getOwnPropertyNames(t).concat(Object.getOwnPropertyNames(t.__proto__)),s=[this].concat(i.default.arrayDifference(a,b));r.a.binder.apply(r.a,s),this.state=this.getInitialState()}getInitialState(){return{}}}r.a.extend(D.prototype,I);t.b=y},151:function(e,t,a){"use strict";var i=a(0),r=a(3),s=a(2),n=a.n(s),o=a(15),l=a(4),d=a(50),h=["#4D4D4D","#999999","#CCCCCC","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#BBBBBB","#EEEEEE","#D33115","#E27300","#FCC400","#22AA66","#16A5A5","#0099DD","#7B64FF","#FA28FF","#000000","#666666","#AAAAAA","#DDDDDD","#AA3300","#C45100","#FB9E00","#194D33","#0C797D","#0062B1","#653294","#AB149E"],c={hex3:/^(#)([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^(#)([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};var u=class extends o.a{init(){this.createObservables({color:this.props.color,value:this.props.color,isValid:!0}),l.a.reset()}parseColor(e){var t;return(t=c.hex3.exec(e))?"#"+t[2]+t[2]+t[3]+t[3]+t[4]+t[4]:(t=c.hex6.exec(e))?e:void 0}onClickColor(e){this.color.set(e),this.value.set(e),this.props.onChange(e)}onChangeInputColor(e){var t=e.target.value.toUpperCase();0!==t.indexOf("#")&&(t="#"+t);var a=this.parseColor(t);a&&(this.color.set(a),this.props.onChange(a)),t.length<8&&this.value.set(t),this.isValid.set(!!this.parseColor(this.value.get()))}onChangeInputComponent(){var e=this.refs,t=+e.r.value,a=+e.g.value,r=+e.b.value;if(t>=0&&t<=255&&a>=0&&a<=255&&r>=0&&r<=255){var s="#"+i.default.rgbToHex(t,a,r);this.value.set(s),this.color.set(s),this.props.onChange(s)}}render(){for(var e=0,t=this.state,a=this.state.color,r=i.default.hexToRgb(a),s=[],o=0;o<h.length;o++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var l=h[o],c=i.default.classNames("fancyColor",{selected:l===a},{isWhite:"#FFFFFF"===l.toUpperCase()}),u={background:l};s.push(n.a.createElement("div",{key:l,className:c,style:u,onClick:this.onClickColor.bind(this,l)}))}var p=i.default.classNames("fancyColorInputColor",{invalid:!t.isValid});return n.a.createElement(d.a,{id:"fancyColorPicker",element:this.props.element,positionOffset:{left:-120,top:4}},n.a.createElement("div",{className:"fancyColors"},s),n.a.createElement("div",{className:"fancyColorText"},n.a.createElement("div",{key:a,className:"fancyColor",style:{background:a}}),n.a.createElement("input",{type:"text",className:p,value:t.value,onChange:this.onChangeInputColor}),n.a.createElement("span",null,"R"),n.a.createElement("input",{type:"text",ref:"r",className:"fancyColorInputComponent",value:r.r,onChange:this.onChangeInputComponent}),n.a.createElement("span",null,"G"),n.a.createElement("input",{type:"text",ref:"g",className:"fancyColorInputComponent",value:r.g,onChange:this.onChangeInputComponent}),n.a.createElement("span",null,"B"),n.a.createElement("input",{type:"text",ref:"b",className:"fancyColorInputComponent",value:r.b,onChange:this.onChangeInputComponent})))}};t.a=class extends o.a{init(){this.createObservables({color:this.props.color})}componentWillReceiveProps(e){e.color!==this.props.color&&this.color.set(e.color)}openMenu(e){r.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}onChange(e){this.color.set(e),this.props.onChange(e)}renderContextMenu(e){return n.a.createElement(u,{key:"fancyColorPicker",color:this.state.color,onChange:this.onChange,element:e.element})}render(){var e=i.default.extend({background:this.state.color,border:"1px solid #666"},this.props.style),t=i.default.classNames("fancyColor",{isWhite:"#FFFFFF"===this.state.color.toUpperCase()});return n.a.createElement("div",{className:t,style:e,onClick:this.openMenu})}}},16:function(e,t,a){"use strict";var i=class{constructor(){this.storage={getItem:()=>{console.log("refactor this")},setItem:()=>{console.log("refactor this")}}}extendPrototype(e,t){for(var a in t)t.hasOwnProperty(a)&&(e.prototype[a]=t[a])}extendClass(e,t,a){var i=0;let r=Object.getOwnPropertyNames(t.prototype);for(var s=0;s<r.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;let n=r[s];a&&e[n]||(e.prototype[n]=t.prototype[n])}}defineBase(e){e.prototype.constructor=e}extend(e,t,a,i){if(t)for(var r in t)if(t.hasOwnProperty(r)&&(!i||!e[r])){let i=t[r],s=a&&i&&i.bind?i.bind(e):i;e[r]=s}return e}inherit(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype}binder(e,...t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t[i];e[r]=e[r].bind(e)}}forceBind(e,t){var a=t[e].bind(t);return t[e]=a,a}destroy(e){}};let r=a(1).a.URLPart;function s(e,t){e===r.Search?window.location.search=t:e===r.Hash&&(window.location.hash=t)}function n(e){return e===r.Search?window.location.search:e===r.Hash?window.location.hash:void 0}function o(e){return"state"===e?r.Search:r.Hash}t.a=new class extends i{constructor(){super()}hasURLParam(e,t){var a=e+"=";return t&&(a+=t),n(o(e)).indexOf(a)>=0}getURLParam(e,t){var i=t||o(e);if(i===r.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var s=new RegExp('[\\?&]" + key + "=([^&#]*)').exec(window.location.href);return null===s?void 0:decodeURIComponent(s[1].replace(/\+/g," "))}if(i!==r.Hash)a(0).default.log("Invalid URL part");else{var l=0,d=n(r.Hash).substring(1);let t=/([^&=]+)=([^&]*)/g;for(var h;h=t.exec(d);){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(decodeURIComponent(h[1])===e)return decodeURIComponent(h[2])}}}insertURLParam(e,t,a){var i=0;e=encodeURIComponent(e),t=encodeURIComponent(t);for(var l=o(e),d=n(l).substr(1).split("&"),h=d.length-1;h>=0;h--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=d[h].split("=");if(c[0]==e){c[1]=t,d[h]=c.join("=");break}}h<0&&(d[d.length]=[e,t].join("=")),s(l,d.join("&")),l!==r.Hash||a||window.location.reload()}removeURLParam(e,t){for(var a=0,i=o(e=encodeURIComponent(e)),l=n(i).substr(1).split("&"),d=l.length-1;d>=0;d--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(l[d].split("=")[0]==e){l.splice(d,1),s(i,l.join("&")),i!==r.Hash||t||window.location.reload();break}}}genPromise(e){e.then=function(e,t,a){},e.execute=function(e,t,a){}}}},17:function(e,t,a){"use strict";var i=a(66);t.a=new class extends i.a{}},18:function(e,t,a){"use strict";var i,r=a(0),s=a(96),n=a(7),o=a.n(n),l=a(3),d=a(5),h=a(20),c=a(27),u=a(55),p=a(8),g=a(47);var f=(i=class{constructor(){this.documentsPreloaded=[],this.dataCache={settings:{},items:{},documents:{},boards:[],contacts:[],localStorage:{},user:{}}}init(e,t){this._backing=e,this.cbOnLoad=t,this.onDataReady()}transformFieldsDocument(e){let t=r.default.clone(e);return r.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.archivedItems,delete t.deletedItems,t=c.a.documentOut(t,{forLocal:!0})}transformFieldsItem(e){let t=r.default.clone(e);return r.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.archivedItems,delete t.deletedItems,c.a.itemOut(t)}getItemData(e,t){return this.dataCache.items[e]}getDocumentData(e){return this.dataCache.documents[e]}getSetting(e){return this.dataCache.settings[e]}getBoards(){return this.dataCache.boards}getBoard(e){return this.dataCache.boards[e]}getContacts(){return this.dataCache.contacts}saveDocument(e,t){let a=e.getSaveInfo();t&&(a=Object.assign(a,t)),this.dataCache.documents[e.id]=a,this._saveDocumentDataToDB(c.a.documentOut(a,{forLocal:!0}))}setSetting(e,t){this.dataCache.settings[e]=t}saveSettings(e){Object.assign(this.dataCache.settings,e)}saveBoard(e){this.dataCache.boards[e.id]=Object.assign(this.dataCache.boards[e.id]||{},e)}saveContacts(e,t){this.dataCache.contacts=e}clearContacts(){this.dataCache.contacts=[]}cacheItem(e){this.dataCache.items[e.id]=e}saveItem(e,t){let a=this.dataCache.items[e.id];if(a)e.docId=e.docId||a.docId,e.docId||t&&(e.docId=t.getDocumentOwner().id),Object.assign(a,e);else if(t){let e=t.getFullSaveData(),i=t.getItems().map(e=>e.getFullSaveData());a=Object.assign(e,{items:i})}else 0;try{r.default.PAssert(18,a.id,"Saved item must have id")}catch(s){r.default.reportError(s)}try{r.default.PAssert(19,a.isRoot||a.parent,"Saved item must have parent or be root")}catch(s){r.default.reportError(s)}try{r.default.PAssert(20,a.docId,"Saved item must have docId")}catch(s){r.default.reportError(s)}if((!a.docId||!a.isRoot&&!a.parent)&&t){let i=t.getItems().map(e=>e.getFullSaveData());a=Object.assign(t.getFullSaveData(),{items:i},e);try{r.default.PAssert(21,a.isRoot||a.parent,"Saved item had root or parent overridden")}catch(s){r.default.reportError(s)}try{r.default.PAssert(22,a.docId,"Saved item had docId overridden")}catch(s){r.default.reportError(s)}}this.dataCache.items[a.id]=a;let i=this.transformFieldsItem(a);this._saveItemDataToDB(i)}deleteItem(e){let t=this.dataCache.items[e.id];if(t){this.dataCache.items[t.id].isDeleted=!0,t.isDeleted=!0;let e=this.transformFieldsItem(t);this._saveItemDataToDB(e)}else{0,e.isDeleted=!0;let t=this.transformFieldsItem(e);this._saveItemDataToDB(t)}}deleteBoard(e){delete this.dataCache.boards[e]}deleteDocument(e){e.getAllItems().forEach(e=>{delete this.dataCache.items[e.id]}),delete this.dataCache.documents[e.id]}deleteSettings(e){Object.keys(e).forEach(e=>{delete this.dataCache.settings[e]})}async clearAllData(){}async ensureMirror(e,t,a=!1){var i=0;let s=[],n=[],o=!this.TEST_DOC_ID,l=e.length>0&&!!e[0].id;for(var d=0;d<e.length;d++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;let c=l?e[d]:e[d].value,u=l?"load":e[d].type,p=this.dataCache.items[c.id];if("Removed"===u)n.push(c.id);else if(!p||!this.areObjectsEqual(c,p)){a&&!o&&console.log("THIS IS BAD, document mismatch");let e=Object.assign(p||{},c);t&&delete e.pendingSync;try{r.default.PAssert(23,e.id,"Saved item must have id")}catch(h){r.default.reportError(h)}try{r.default.PAssert(24,e.isRoot||e.parent,"Saved item must have parent or be root")}catch(h){r.default.reportError(h)}try{r.default.PAssert(25,e.docId,"Saved item must have docId")}catch(h){r.default.reportError(h)}this.dataCache.items[c.id]=e,s.push(e)}}return this.bulkSave(s,n)}areObjectsEqual(e,t){return delete(t=Object.assign({},t)).items,delete t.archivedItems,delete t.deletedItems,delete(e=Object.assign({},e)).items,delete e.archivedItems,delete e.deletedItems,e.parent===t.parent&&(delete e.parent,delete t.parent,r.default.deepEqual(e,t))}onDataReady(){this.dataCache.settings&&l.default.settings.load(this.dataCache.settings,!1),this.dataCache.contacts&&g.a.loadContacts(),this.fireLocalLoaded()}fireLocalLoaded(){h.a.onActiveUser(()=>{try{r.default.PAssert(26,this.dataCache.documents,"Must be documents in cache at this point")}catch(e){r.default.reportError(e)}if(this.dataCache.documents){let e=r.default.objectValues(this.dataCache.documents),t=r.default.filterWithNonMatches(e,this.checkDocHasRoot);if(t.fail.length>0&&(console.log("Failed docs",t.fail),t.fail.forEach(e=>{delete this.dataCache.documents[e.id]})),e=t.match.map(e=>{let t=!1,a=this.dataCache.items[e.root];return t?t.createVMLIs(a):(e.rootData=a,(t=u.a.fromData(e,this._backing)).createVMLIs()),t}),this.cbOnLoad){let t={documentsPending:this.dataCache.documentsPending,itemsPending:this.dataCache.itemsPending,settingsPending:this.dataCache.settingsPending,boardsPending:this.dataCache.boardsPending,isPreload:this.isPreload};this.cbOnLoad(e,t)}this.isPreload?this.documentsPreloaded=e:this.cbOnLoad=void 0}})}checkDocHasRoot(e){return!!this.dataCache.items[e.root]}getLegacyLocalStorage(e){return this.dataCache.localStorage[e]}setLegacyLocalStorage(e,t){this.dataCache.localStorage[e]=t}deleteLegacyLocalStorage(e){delete this.dataCache.localStorage[e]}getValue(e){return this.dataCache.localStorage[e]}setValue(e,t){this.dataCache.localStorage[e]=t}deleteValue(e){delete this.dataCache.localStorage[e]}onPreload(e,t){if(e&&e.error){try{r.default.PAssert(27,"OpenFailedError"===e.error.name,"Unknown error in Dexie",e.error)}catch(a){r.default.reportError(a)}d.a.blockedReason.set("Moo.do cannot run because it is unable to access data storage in your browser. This could be because you are in Private mode, you have disabled history, or your hard drive is full. Please try Moo.do in a normal browsing session or download the app.")}else this.dataCache=e;t()}saveEncryptionKey(e,t){}async bulkSave(e,t){t&&t.length>0&&t.forEach(e=>{delete this.dataCache.items[e]}),e.forEach(e=>{this.dataCache.items[e.id]=e});let a=e.map(this.transformFieldsItem);return this._bulkSaveItems(a,t)}getItemsMap(){return this.dataCache.items}savePluginUsage(e,t){this.dataCache.plugins[e]||(this.dataCache.plugins[e]={}),this.dataCache.plugins[e][t.id]=t}getPluginTableUsage(e){return this.dataCache.plugins[e]}getPluginUsage(e,t){if(this.dataCache.plugins[e])return this.dataCache.plugins[e][t]}deletePluginUsage(e,t){this.dataCache.plugins[e]&&delete this.dataCache.plugins[e][t]}getTableData(e){return this.dataCache[e]}getTableValue(e,t){let a=this.getTableData(e);if(a){let e=a[t];if(void 0!==e)return e}}setTableValue(e,t,a){let i=this.getTableData(e);i&&(i[t]=a)}ensureTableLoaded(e,t){return t(),!0}beginBatch(){}commitBatch(){}},o()(i.prototype,"checkDocHasRoot",[p.a],Object.getOwnPropertyDescriptor(i.prototype,"checkDocHasRoot"),i.prototype),i);t.a=new class extends f{constructor(){super(),this.TEST_DOC_ID="",this.canWrite=!r.default.isDemoMode(),this.clearOldDatabases()}clearOldDatabases(){window.indexedDB&&(this.deleteDatabase("Drive"),this.deleteDatabase("GCalendar"),this.deleteDatabase("Gmail"),this.deleteDatabase("Gmail_RawCache"),this.deleteDatabase("QuickAdd"))}deleteDatabase(e){window.indexedDB.deleteDatabase(e)}preload(e){if(this.canWrite){this.db=s.a.createDB();let t=window.__preload;t?t.data?this.onPreload(t.data,e):t.worker.onmessage=t=>{this.onPreload(t.data,e)}:s.a.load(this.db,t=>{this.onPreload(t,e)})}}_saveItemDataToDB(e){this.canWrite&&this.db.items.put(e)}_deleteItemData(e){this.canWrite&&this.db.items.delete(e)}_saveDocumentDataToDB(e){this.canWrite&&this.db.documents.put(e)}setSetting(e,t){super.setSetting(e,t),this.canWrite&&(null!=t&&void 0!==t?this.db.settings.put({id:e,...t}):this.db.settings.delete(e))}deleteSettings(e){super.deleteSettings(e),this.canWrite&&Object.keys(e).forEach(e=>this.db.settings.delete(e))}saveSettings(e){super.saveSettings(e);let t=Object.keys(e).map(t=>({id:t,...e[t]}));this.canWrite&&this.db.settings.bulkPut(t)}saveBoard(e){if(super.saveBoard(e),this.canWrite){let t=c.a.boardOut(e);this.db.boards.put(t)}}deleteBoard(e){super.deleteBoard(e),this.canWrite&&this.db.boards.delete(e)}deleteDocument(e){super.deleteDocument(e),this.canWrite&&(e.getAllItems().forEach(e=>{this.db.items.delete(e.id)}),this.db.documents.delete(e.id))}saveContacts(e,t){if(super.saveContacts(e,t),this.canWrite){let e=t.map(e=>c.a.contactOut(e));this.db.contacts.bulkPut(e)}}clearContacts(){super.clearContacts(),this.canWrite&&this.db.contacts.clear()}async _bulkSaveItems(e,t){let a=[];return t&&t.length>0&&a.push(this.db.items.bulkDelete(t)),e.length>0&&this.canWrite&&a.push(this.db.items.bulkPut(e)),a.length>0?Promise.all(a):Promise.resolve()}getLegacyLocalStorage(e){let t=super.getLegacyLocalStorage(e);return t||(t=localStorage.getItem(e))&&super.setLegacyLocalStorage(e,t),t}setLegacyLocalStorage(e,t){super.setLegacyLocalStorage(e,t),r.default.isString(t)||(t=JSON.stringify(t)),localStorage.setItem(e,t)}deleteLegacyLocalStorage(e){super.deleteLegacyLocalStorage(e),localStorage.removeItem(e)}setValue(e,t){let a=this.getValue(e);a===t||r.default.deepEqual(a,t)||(super.setValue(e,t),this.db.localStorage.put({id:e,value:t}))}async clearAllData(){return Promise.all(this.db.tables.map(e=>e.clear()))}deletePluginUsage(e,t){super.deletePluginUsage(e,t),this.db.plugins.delete(t)}savePluginUsage(e,t){super.savePluginUsage(e,t),this.db.plugins.put(t)}tablePut(e,t){return this.db[e].put(t)}tableClear(e){return this.db[e].clear()}tableFilter(e,t){return this.db[e].filter(t).toArray()}tableGet(e,t){return this.db[e].get(t)}tableDelete(e,t){return this.db[e].delete(t)}}},181:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(5),o=a(66),l=a(13),d=a(9);a(73);t.a=class extends o.a{constructor(){super(),this.oldSettings={c:!0,u:!0,aA:!0},this.onLoadCbs=[],this.init()}init(){this._allSettings=[],this._allGroups=[],this._groupAbbrevs={},this._groupAbbrevsIn={},this.registerGroup(this,""),this.registerGroup("ui","u");let e=[["agendaSort","a",this.createDefaultAgendaSort()],["backupFrequency","d",0],["calendarCustomDays","e",3],["closedImport","f"],["closedHelps","g"],["closedVideo","h"],["dateFormat","i",r.a.DateFormat.MDY],["dayWeekStart","j",0],["defaultItemPrefix","k",""],["helpPaneState","l"],["helpState","m"],["inTooltipIntro","n"],["backupsDrive","o"],["needsBackup","p"],["notificationDelay","q",30],["openEvernoteApp","r"],["panesMobile","s"],["selectFullItems","t",!1],["showFormattingToolbar","v",1],["showMarkdown","w"],["showImagesInline","x",!0],["shownTutorial","y"],["syncContacts","z"],["trialOverHidden","A"],["userEncryptionSentinel","aE"],["encryptBackup","aH"],["driveFolders","aI"],["fixedMissingCalendars","aJ"],["platforms","aK"],["encryptLocalFiles","aM"],["syncAccounts","aN",{}],["panesRN","aO"]],t=[["activeUser","b"],["cacheSizeRatio","B",1],["disableNotifications","C"],["displayName","D"],["lastContactSync","I"],["lastServerVersion","J"],["lastTaskSync","K"],["lastQuickAddSync","L"],["localDataVersion","M",7],["localIntegrity","N"],["localPaneState","O"],["localRecoverVersion","P"],["notifiedTrialOver","R"],["notifiedTrialEndSoon","S"],["selectedBoard","V"],["showSidebar","W",!1],["sidebarWidth","X",r.a.DesktopMenuWidthDefault],["userId","ab"],["encryptionKeys","aD"],["lastSync","aF"],["userProperties","aG"],["backupLocal","aL",!0]],a=[["boldHeaders","ac",!1],["bulletOpacity","ad",30],["checkboxOpacity","ae",30],["checkboxBackgroundOpacity","af",0],["contactColor","ag","#22AA66"],["dateColor","ah","#AA3300"],["displayPrefixes","ai",r.a.DisplayTheme.PrefixesFaded],["displaySpacing","aj",r.a.DisplayTheme.SpacingComfortable],["fontSize","ak",14],["fontSizeHeader","al",16],["fontSizeHeaderTopLevel","am",18],["grayscale","an",!1],["itemIndentSize","ao",30],["itemLineHeight","ap",18],["itemPadding","aq",5],["linkColor","ar","#3333BB"],["noteFontSize","as",12],["noteLineHeight","at",18],["notePadding","au",0],["projectOpacity","av",30],["showVerticalLines","aw",!0],["tagColor","ax","#0099DD"],["theme","ay","light"],["underlineP","az",!1],["verticalLinesOpacity","aC",6]];this.registerSettings(e,this,!0),this.registerSettings(t,this,!1),this.registerSettings(a,this.ui,!0),i.default.isDemoMode()&&this.activeUser.set("demo"),this.encryptionKeys.listen(e=>{this._encryptionKeyInfo={};let t={};Object.keys(e).forEach(a=>{t[a]=e[a]}),s.default.crypto.importKeys(t).then(e=>{this._encryptionKeyInfo=e})})}load(e,t){this._isLoading=!0;let a=[];Object.keys(e).forEach(t=>{let{group:r,key:s}=this.getSettingInfoFromAbbrev(t),n=e[t].v;if(r&&r[s])if("isEnabled"===s)a.push({group:r,key:s,value:n});else{let e=r[s].get();void 0===n||null===n?(void 0!==n&&null!==n||(n=r._settingsDefault[s]),r[s].set(n)):i.default.isObject(e)&&i.default.isObject(n)&&i.default.deepEqual(e,n)||r[s].set(n)}}),a.forEach(({group:e,key:t,value:a})=>{e[t].set(a)});let o=()=>JSON.stringify({uid:this.userId.get(),name:this.displayName.get(),email:this.activeUser.get()});try{i.default.PAssert(15,!this.userId.get()||this.userId.get().length>4,"Bad UID",o)}catch(l){i.default.reportError(l)}t&&(this._allSettings.forEach(t=>{if(!e[t.path]){let e=t.group._settingsDefault[t.key];t.setting.get()!==e&&t.setting.set(e)}}),!this.userEncryptionSentinel.get()&&s.default.crypto.getKeyInfo(r.a.EncryptionKeys.UserPassword)&&this.removeEncryptionKey(r.a.EncryptionKeys.UserPassword),setTimeout(()=>{let e=Object.assign({},this.platforms.get());e[n.a.getUserPlatformConfig()]={d:Date.now(),v:r.a.jsVersion},this.platforms.set(e)},0)),s.default.DisplaySettings.init(),this._isLoading=!1,this._isLoaded=!0,this.onLoadCbs.forEach(e=>e()),this.onLoadCbs=[]}registerGroup(e,t,a){var s,n=[];i.default.isString(e)&&(i.default.shouldLog(r.a.LogLevels.Settings)&&i.default.log("SETTINGS: Registered Group - ",e),s=e,this[e]={oldSettings:a},e=this[e]),e.listen=e=>{n.push(e)},e.unlisten=e=>{n.remove(e)},e.onChange=(e,t,a)=>{if(this._isLoaded&&(i.default.isObject(t)?!i.default.deepEqual(t,a):t!==a)){var r=0;this._save(e,s,t);for(var o=0;o<n.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n[o](t,a)}}},e._settingsDefault||(e._settingsRemote={},e._settingsDefault={},e._settingsAbbrevs={},e._settingsAbbrevsIn={}),this._allGroups.push({id:t,group:e}),s&&(this._groupAbbrevs[s]=t,this._groupAbbrevsIn[t]=s)}registerSettings(e,t,a){for(var i=0,r=0;r<e.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;let s=e[r],n=s[0],o=s[1],l=s[2];this.registerSetting(n,o,t,a,l)}}registerSetting(e,t,a,r,s){if(i.default.isString(a)&&(a=this[a]),r&&(a._settingsRemote[e]=!0),void 0!==s&&(a._settingsDefault[e]=s),a._settingsAbbrevs[e]=t,a._settingsAbbrevsIn[t]=e,a[e]=new d.a(s,a.onChange.bind(this,e),!0),r){let i=this._allGroups.indexOfWithProperty("group",a);if(i>=0){let r=this._allGroups[i].id;this._allSettings.push({path:(r?r+"\\":"")+t,group:a,key:e,abbrev:t,setting:a[e]})}}}getDefaultItemText(e){return(e=e||this.defaultItemPrefix.get())?e+" ":""}getSettingAbbrev(e,t){return(t?this[t]:this)._settingsAbbrevs[e]}getSettingInfoFromAbbrev(e){let t,a,r=e.split("\\");if(r.length>1?(a=this[a=this._groupAbbrevsIn[r[0]]],t=r[1]):(a=this,t=r[0]),!a.oldSettings||!a.oldSettings[t]){t=a._settingsAbbrevsIn[t];try{i.default.PAssert(16,a&&a[t],"Missing group for setting",e)}catch(s){i.default.reportError(s)}}return{group:a,key:t}}getValueFromAbbrev(e){let{group:t,key:a}=this.getSettingInfoFromAbbrev(e);if(t&&t[a])return t[a].get()}_save(e,t,a){let i=t?this[t]:this,r=!this._isLoading&&i._settingsRemote[e],s=i._settingsAbbrevs[e],n=(t?this._groupAbbrevs[t]+"\\":"")+s;l.a.setSetting(n,a,r)}getEncryptionKey(e){let t=this._encryptionKeyInfo;return t&&t[e]?t[e].key:void 0}removeEncryptionKey(e){let t=Object.assign({},s.default.settings.encryptionKeys.get());s.default.crypto.removeKey(e),delete t[e],s.default.settings.encryptionKeys.set(t)}addEncryptionKey(e,t){let a=Object.assign({},s.default.settings.encryptionKeys.get());a[e]=t,s.default.settings.encryptionKeys.set(a)}shouldShowHelp(e){var t=this.closedHelps.get();return!t||!t[e]}closeHelp(e){var t=i.default.clone(this.closedHelps.get())||{};t[e]=!0,this.closedHelps.set(t)}uncloseHelp(e){var t=i.default.clone(this.closedHelps.get())||{};delete t[e],this.closedHelps.set(t)}isBackupEnabled(){return this.backupFrequency.get()>0}hasUserPassword(){const e=s.default.settings.encryptionKeys.get();return e&&!!e[r.a.EncryptionKeys.UserPassword]}getBestUserEncryption(){const e=s.default.settings.encryptionKeys.get();return e&&e[r.a.EncryptionKeys.UserPassword]?r.a.EncryptionKeys.UserPassword:r.a.EncryptionKeys.Global}createDefaultAgendaSort(){return{overdue:-2,"#now":-1,starred:1,important:2,"#next":3,"#soon":101,"#later":301,"#someday":1401}}getUserIdentifier(){return i.default.isDemoMode()?"demouser":this.activeUser.get()}onLoaded(e){this._isLoaded?e():this.onLoadCbs.push(e)}}},182:function(e,t,a){"use strict";a.r(t);var i,r=a(7),s=a.n(r),n=a(0),o=a(1),l=a(3),d=a(5),h=a(61),c=a(6),u=a(88),p=a(4),g=a(48),f=a(39),m=a(8),v=a(53),y=a(36),_=o.a.Regexp.Prefix;let S=(i=class{init(){try{n.default.PAssert(158,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(e){n.default.reportError(e)}document.body.addEventListener("paste",this.handlepaste,!1),document.body.addEventListener("cut",this.handlecut,!1),document.body.addEventListener("copy",this.handlecopy,!1)}parseTextForPrefix(e){var t,a;return _.lastIndex=0,null!==(t=_.exec(e))&&(a=t[1],e=e.substr(t[0].length)),{prefix:a,text:e}}insertToNote(e,t,a){try{n.default.PAssert(159,e,"Must have a valid start item")}catch(s){n.default.reportError(s)}try{n.default.PAssert(160,t,"Must have a valid end item")}catch(s){n.default.reportError(s)}var i,r=e.getParsedText();c.d.beginAction(),i=t===e?r.substring(0,p.a.getStartOffset())+a+r.substring(p.a.getEndOffset()):r.substring(0,p.a.getStartOffset())+a,e.setText(i,o.a.ChangeType.Local),c.d.endAction()}processItem(e){if(!e.date){let i=e.text.indexOf("!");if(i>=0){var t=0;let r,s,n=e.text.slice(i+1).split(" "),l="";for(var a=0;a<n.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(n[a]){l+=(a>0?" ":"")+n[a];let e=v.a.parseText(l);e&&(s&&e.toData()===s.toData()||(r=l),s=e)}}s&&(e.date=s.toData(),e.text=e.text.replace("!"+r,o.a.CharDate))}}return e}insert(e,t,a){if(!p.a.isValid()||n.default.elementInNonPaneEdit(t.target))return!1;var i,r,s,f="",m=n.default.focusedPane,v=d.a.ie?"Text":"text/plain";if(a===o.a.DataSource.Plugin)s={items:[{text:e}]};else if(e&&e.getData){if(c.d.miscAction({type:c.b.Misc,misc:c.a.Paste}),n.default.preventAndStop(t),f=d.a.ie?void 0:e.getData("moodo/html")||e.getData("text/html"),!d.a.ie&&f){if(n.default.shouldLog(o.a.LogLevels.Input)&&n.default.log(f),!f)return void(n.default.shouldLog(o.a.LogLevels.Input)&&n.default.log("Paste buffer is empty"));var y,_=document.createElement("div"),S=f.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/[ ]+/g," ").replace(/\u2022/g,"").replace(/onload/gi,"never");if((y=/<body(.|\s)*?\/body>/g.exec(S))&&(S=y[0]),_.innerHTML=S,p.a.isValid()&&p.a.getStartItem().isNote())this.insertToNote(p.a.getStartItem(),p.a.getEndItem(),_.innerText);else{var P=_.children[0];2===_.children.length&&"A"===P.nodeName&&n.default.isOneNoteLink(P.href)&&(_.innerHTML=P.outerHTML),1===(s=u.a.traverseDOM({root:_,shouldPrint:!1,stripParents:!0,preserveWhitespace:!d.a.ie&&e.getData("moodo/html")})).items.length&&""===s.items[0].text&&(s=s.items[0])}}else if(f=e.getData(v)){n.default.shouldLog(o.a.LogLevels.Input)&&n.default.log(f);var I,b=f.startsWith("<?xml "),D=f.startsWith("<?opml ")||f.startsWith("<opml ")||b&&f.indexOf("<opml ")>=0;if((b||D)&&(I=n.default.loadXML(f)),I){if(b&&!D)return l.default.toasts.pushMessage({text:"We currently do not support pasting XML, please contact support@moo.do.",action:o.a.MessageAction.Contact,hold:!0}),!1;if(D){let e=p.a.getStartItem(),t=e.parent(),a=m.createVMLI({text:"OPML Import"},{parent:t,changeType:o.a.ChangeType.AllLocal});return t.insertItem(a,e.getIndex()+1),u.a.parseOPML(I,a),!1}}else{var w=n.default.parseEvernoteLink(f),E=n.default.isBearLink(f);if(w||E){var C=p.a.save(),A="Enter title of "+(w?"Evernote":E&&"Bear")+" document";return void l.default.menus.prompt(A,function(e){e&&(f="["+e+"]("+f+")"),p.a.restore(C),this.insert(f,t,o.a.DataSource.Plugin)}.bind(this))}n.default.isUrlImage(f)&&l.default.settings.showImagesInline.get()&&(f="!"+f);S=f.replace(/[\t]/g,"    ");if(p.a.getStartItem().isNote())this.insertToNote(p.a.getStartItem(),p.a.getEndItem(),S);else{var M=S.split("\n");s=u.a.parseText(M)}}}else{if(e&&e.items&&e.items.length>0)return l.default.pluginManager.handleDropEvent(t,function(e){c.d.beginAction();var t=p.a.getStartItem(),a=t.parent(),i=m.createVMLI({text:e},{parent:a,changeType:o.a.ChangeType.AllLocal});a.insertItem(i,t.getIndex()+1),c.d.endAction()}),!1;n.default.shouldLog(o.a.LogLevels.Input)&&n.default.log("Paste buffer is empty");try{n.default.PAssert(161,!1,"Paste with unexpected data type",e.types)}catch(Y){n.default.reportError(Y)}}if(!s||!s.items||0===s.items.length)return!1}if(s){c.d.beginAction(),l.default.PaneUpdateBatcher.beginUpdateItems();var T=!0,L=p.a.getStartOffset(),x=p.a.getStartItem(),k=p.a.getEndItem(),R=p.a.getStartItem().parent(),O=p.a.getStartItem().getIndex(),F=p.a.getStartItem().getParsedText(),N=p.a.getEndItem().getParsedText();if(x!==k&&(k.isNote()&&(k=k.parent()),x!==k&&h.a.handleMultiselect({normCode:o.a.KeyCode.Backspace,preventDefault:n.default.emptyFn,stopPropagation:n.default.emptyFn,stopImmediatePropagation:n.default.emptyFn})),i=x,1!==s.items.length||s.items[0].items&&0!==s.items[0].items.length)if(m.isViewAgenda())l.default.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),T=!1;else{var B=0,U=0;n.default.shouldLog(o.a.LogLevels.Timing)&&console.time("paste"),m.clearPreventUpdate(),p.a.getStartOffset()>0&&O++;for(var H=0;s&&H<s.items.length;++H){if(B++>5e3&&__infLoop&&__infLoop(B))throw new RangeError;var V=this.processItem(s.items[H]);this.parseTextForPrefix(V.text);if(""===V.text&&!V.items)continue;let e;V.isNote?(e=m.createVMLI({text:V.text,isNote:!0},{parent:R,changeType:o.a.ChangeType.AllLocal}),R.setNote(e,o.a.ChangeType.Local)):(0===H&&0===x.getRawText().length&&0===x.numChildren()&&x.parent().removeChild(x,o.a.ChangeType.Local),e=m.createVMLI(V,{parent:R,changeType:o.a.ChangeType.AllLocal}),R.insertItem(e,O++,!1),i=e),e&&c.d.performAction(c.b.Create,{itemID:e.id,parent:R.id,position:O-1,text:e.getParsedText()})}for(;i.hasChildren();){if(U++>5e3&&__infLoop&&__infLoop(U))throw new RangeError;i=i.getLastChild()}r=i.getParsedText().length}else{var j=this.processItem(s.items[0]),z=j.text,q=L>0?this.parseTextForPrefix(z).text:z,W=F.substring(0,L),G=N.substring(p.a.getEndOffset());!W.length||W.endsWith(" ")||q.startsWith(" ")||(q=" "+q),!G.length||q.endsWith(" ")||G.startsWith(" ")||(q+=" ");var K=W+q+G;if(c.d.performAction(c.b.Remove,{itemID:x.id,position:0,text:x.getParsedText()}),j.date)try{x.setMooDate(g.a.fromData(j.date),o.a.ChangeType.Local)}catch(X){n.default.reportError(X,"Error parsing MooDate in paste")}x.setText(K,o.a.ChangeType.Local),c.d.performAction(c.b.Insert,{itemID:x.id,position:0,text:K}),r=p.a.getStartOffset()+q.length}l.default.PaneUpdateBatcher.commitUpdateItems(),c.d.endAction(),n.default.shouldLog(o.a.LogLevels.Timing)&&console.timeEnd("paste")}return T&&i&&(p.a.selectItem(i,r),n.default.focusedPane.scrollItemIntoView(i,o.a.ScrollDuration.Snap)),!1}handlepaste(e){var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;f.a.saveDeleteSelection(),f.a.beginAction();let a=this.insert(t,e,o.a.DataSource.Paste);return f.a.endAction(),a}handlecut(e){let t=!0;if(p.a.isValid()){var a=p.a.getStartIndex(),i=p.a.getStartItem(),r=a===p.a.getEndIndex()&&p.a.getStartOffset()===p.a.getEndOffset();l.default.PaneUpdateBatcher.beginUpdateItems(),r&&p.a.setSelection(a,0,a,i.getParsedText().length),!this.handlecopy(e)&&(r?n.default.focusedPane.deleteSelected():h.a.keydown(void 0,{normCode:o.a.KeyCode.Backspace,preventDefault:n.default.emptyFn,stopPropagation:n.default.emptyFn,stopImmediatePropagation:n.default.emptyFn}),t=!1),l.default.PaneUpdateBatcher.commitUpdateItems()}return t}padText(e,t){for(var a=0,i=0;i<t;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e="    "+e}return e}printLI(e,t,a){var i=e.getParsedText(),r=i,s=e.getPrefix(),n=[],l=e.getPriority();t=t||0,isNaN(a)?(a=a||i.length,r=r.substring(t)):r=r.substr(t,a-t),r=r.replace(/\[([^\[]*)\]\(\1\)/g,(e,t)=>t),t>=s.length&&(r=s+r);let d=r;if(e.hasAttachments()){for(var h=0,c=0,u=e.getNumAttachments()-1,p=i.length-1;p>=a&&u>=0;p--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;i[p]===o.a.AttachChar&&u--}for(p=r.length-1;p>=0&&u>=0;p--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(r[p]===o.a.AttachChar){if(p<a){let t=e.getAttachment(u);r=r.substr(0,p)+t.getTitleString()+r.substr(p+1),d=d.substr(0,p)+t.getEmbedString()+d.substr(p+1)}u--}}}else e.isNote()&&n.push("note");var g;if(l&&(l===o.a.VMLIFlag.P0?n.push("high"):l===o.a.VMLIFlag.P1?n.push("medium"):l===o.a.VMLIFlag.P2&&n.push("low")),e.isComplete()&&n.push("complete"),e.isStarred()&&n.push("starred"),d.includes(o.a.CharDate)){var f=e.getMooDate();f&&(g=f.toData())}var m=s.length?r.substr(s.length):r;let v=e=>"<li"+(n.length>0?' class="'+n.join(" ")+'"':"")+(g?` data-date="${g}"`:"")+">"+e+"</li>";return{html:v(m),plain:m,moodo:v(d)}}handlecopy(e){var t=n.default.focusedPane,a=d.a.ie?"Text":"text/plain",i=e&&e.clipboardData?e.clipboardData:window.clipboardData;if(i){if(n.default.findParent(e.target,"exportedArea",10))return!0;{var r=0,s=0,o=0;if(!p.a.isValid())return!0;if(!p.a.getPane().overrideCopyBehavior)return!0;let e=p.a.getStartItem(),c=p.a.getStartIndex(),x=p.a.getEndItem(),k=p.a.getEndIndex(),R=p.a.getStartOffset(),O=p.a.getEndOffset(),F=p.a.getEndTotal();try{n.default.PAssert(162,e&&x,"Must have valid item selections")}catch(L){n.default.reportError(L)}try{n.default.PAssert(163,n.default.isVMLI(e)&&n.default.isVMLI(x),"Items must be valid VMLIs")}catch(L){n.default.reportError(L)}var l,h,u=!d.a.ie,g="<ul>",f="",m="<ul>",v=1,_=[],S=e;let N=c,B=e,U=()=>{g+="<ul>",m+="<ul>",v++},H=()=>{g+="</ul>",m+="</ul>",v--};do{if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(B!==h){if(_.push(B),(N!==k||O===B.getTextLength())&&B.isCollapsed(t)){var P=0;B.hasNote()&&(h=B.getNote(),_.push(h));for(var I=B.getItems().slice();I.length>0;){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;var b=I.shift(),D=b.getItems();_.push(b),b.hasNote()&&_.push(b.getNote()),I.splice(0,0,...D)}}}(N=t.indexOfNextVMLI(N))>=0&&(B=t.itemAtIndex(N))}while(N>=0&&N<=k);for(var w=0;w<_.length;w++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;let e=_[w];if(e){var E=0;if(S){var C=e.levelsDeep.get()-S.levelsDeep.get();e.parent()===S&&C>0&&U()}let t=Math.min(v,-C);for(var A=0;A<t;A++){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;H()}var M,T;v<=0&&U(),(_.length>1||R!==O)&&(M=0===w?R:0,T=w===_.length-1?O:void 0,y.a.isInsideMarkup(x,T)&&(T=y.a.moveRight(x,T,F))),l=this.printLI(e,M,T),f+=(f?"\r\n":"")+this.padText(l.plain,v-1),g+=l.html,m+=l.moodo}S=e}for(H();v>0;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;H()}u&&g&&i.setData("text/html",g),u&&m&&i.setData("moodo/html",m),i.setData(a,f)}}return n.default.preventAndStop(e),c.d.miscAction({type:c.b.Misc,misc:c.a.Copy}),!1}},s()(i.prototype,"handlepaste",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"handlepaste"),i.prototype),s()(i.prototype,"handlecut",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"handlecut"),i.prototype),s()(i.prototype,"handlecopy",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"handlecopy"),i.prototype),i);t.default=new S},183:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(1),o=a(3),l=a(0),d=a(88),h=a(55),c=a(105),u=a(8),p=a(17),g=a(106);let f=(i=class extends c.a{constructor(){super(!0),this.dataCache={},this.dirtyDocs={},p.a.listen("onUnload",this.writeDocuments)}async init(e,t){this.cbOnDocumentsChanged=t;let a=window.___electronAllDocs;o.default.ElectronBridge.listenToDocChanges(this.onFileChanged),o.default.crypto.onLoad(()=>{o.default.crypto.onUpdated.listen(this.reload);let t=async t=>{if(t){let a=(await Promise.all(t.map(async e=>{let t=await this.parseJSON(e);if(t)return t.items&&t.items.forEach(e=>{this.dataCache[e.id]=e}),this.createDoc(t)}))).filter(e=>void 0!==e);e(a)}else e([])};a?a.value?t(a.value):(o.default.toasts.pushMessage({text:"Error loading local files. Please check that the directory is correct in the settings.",actionText:"SETTINGS",action:()=>o.default.menus.openSettings(n.a.SettingsSections.DesktopApp),hold:!0}),e([])):o.default.ElectronBridge.getAllDocs(t)})}createDoc(e){let t=h.a.create(e);return t.createVMLIs(),this.documents[t.id]=t,t}async parseJSON(e){try{let a=JSON.parse(e);if(a.moodoVer&&a.doc&&a.doc.root&&a.doc.id){var t=await d.a.parseJSON(a);if(t)return t.id=a.doc.id,t.backing=this,t;console.log("No data for",a)}}catch{}}reload(){var e={};Object.keys(this.documents).forEach(t=>e[t]=!0),o.default.ElectronBridge.getAllDocs(async(t,a)=>{a=a||[],await Promise.all(a.map(async t=>{let a=await this.onFileChanged(n.a.CrudActions.Modified,t);a&&delete e[a.id]})),Object.keys(e).forEach(e=>this.onFileChanged(n.a.CrudActions.Removed,e)),this.cbOnDocumentsChanged(this.documents)})}async onFileChanged(e,t){if(e===n.a.CrudActions.Removed){let e=t,a=this.documents[e];a&&(a.delete(!0),delete this.documents[e])}else{let e=await this.parseJSON(t);if(e){let t=this.documents[e.id];if(t){let a=e.items;t.text.set(e.text),this.checkFileItems(t,a)}else t=this.createDoc(e),this.cbOnDocumentsChanged(this.documents);return e.items&&e.items.forEach(e=>{this.dataCache[e.id]=e}),t}}}checkFileItems(e,t){var a=0;let i={};e.getAllItems().forEach(e=>i[e.id]=!0);for(var r=0;r<t.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let i=t[r];if(!i.isRoot){let a,s=this.getItemData(t[r].id),o=!1,l={id:i.id};s?(a=n.a.CrudActions.Modified,Object.keys(i).forEach(e=>{s[e]!==i[e]&&("id"!==e&&(o=!0),l[e]=i[e])})):(a=n.a.CrudActions.Added,l=i,o=!0),o&&g.a.onRemoteChange(e,a,i.id,l)}}}writeDocuments(){Object.keys(this.dirtyDocs).forEach(e=>{let t=this.dirtyDocs[e];delete this.dirtyDocs[e],t.dateModified.set(Date.now()),t.toJSON({exportArchived:!0,includeNotes:!0,encrypt:o.default.settings.encryptLocalFiles.get()}).then(e=>{o.default.ElectronBridge.saveDoc(`${t.id}.json`,e,e=>{e&&(console.log(e),o.default.toasts.pushMessage(`Error saving ${t.text.get()}. Please check that the destination file is writeable.`))})})})}setDocNeedsWrite(e){this.dirtyDocs[e.id]=e,clearTimeout(this.timeoutWrite),this.timeoutWrite=setTimeout(this.writeDocuments,1e3)}getItemData(e){return this.dataCache[e]}saveItem(e,t,a,i,r){let s=new Date,n=this.dataCache[t.id]||{};Object.assign(n,a,{dateModified:+s}),t.dateModified=s,this.dataCache[t.id]=n,l.default.isLocalChange(i)&&!l.default.isUndoRedoChange(i)&&this.setDocNeedsWrite(e)}deleteItem(e,t,a){delete this.dataCache[t.id],l.default.isLocalChange(a)&&!l.default.isUndoRedoChange(a)&&this.setDocNeedsWrite(e)}addItem(e,t){t.forEachChildRecursive(t=>{this.saveItem(e,t,void 0,n.a.ChangeType.Local,n.a.SaveFlag.Prop)},!0,!0)}moveItem(e,t){let a=e.getDocumentOwner(),i=t.getDocumentOwner();a===i?this.saveItem(e.getDocumentOwner(),e,void 0,n.a.ChangeType.Local,n.a.SaveFlag.Prop):(e.forEachChildRecursive(e=>{this.saveItem(a,e,void 0,n.a.ChangeType.Local,n.a.SaveFlag.Prop)},!0,!0),this.setDocNeedsWrite(i))}setNote(e,t,a,i,r){this.saveItem(e,t,void 0,n.a.ChangeType.Local,n.a.SaveFlag.Prop),a?this.saveItem(e,a,void 0,n.a.ChangeType.Local,n.a.SaveFlag.Prop):delete this.dataCache[a.id]}async addDocument(e){let t=e.getRootItem();this.documents[e.id]=e,this.saveItem(e,t,void 0,n.a.ChangeType.Local,n.a.SaveFlag.Prop)}saveDocument(e){this.setDocNeedsWrite(e)}deleteDocument(e,t){o.default.ElectronBridge.deleteDoc(`${e.id}.json`)}renameDocument(e,t){this.setDocNeedsWrite(e)}unlistenDocument(e){}getSetting(e){return""}setSetting(e,t){0}saveBoard(e){0}deleteBoard(e){0}getBoards(){return[]}clearAllData(){return Promise.resolve()}generateId(){return l.default.generateTempId()}numDocuments(){return Object.keys(this.documents).length}},s()(i.prototype,"reload",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"reload"),i.prototype),s()(i.prototype,"onFileChanged",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"onFileChanged"),i.prototype),s()(i.prototype,"writeDocuments",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"writeDocuments"),i.prototype),i);t.a=new f},184:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(1),l=a(3),d=a(13),h=a(5),c=a(9),u=a(8);let p=(i=class{constructor(){this.useServiceWorker="serviceWorker"in navigator,this.notifiedOfNew=!1,this.isFinished=!1,this.startStatus=window.applicationCache?window.applicationCache.status:-2,this.fnToRun=[],this.hasUpdate=new c.a,this.ignoreUpdate=new c.a,setInterval(this.update,o.a.MSPerHour)}init(){window.applicationCache&&this.startStatus===window.applicationCache.OBSOLETE&&this.onCacheObsolete(),this.useServiceWorker?navigator.serviceWorker.addEventListener("message",e=>{"ServiceWorker_Activated"===e.data?this.onUpdateReady():"ServiceWorker_Installed"===e.data&&setTimeout(this.onUpdateReady,2e3)}):n.default.log("Cache Status: "+this.startStatus),window.applicationCache?(window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheObsolete.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()):this.onCacheLoadFinished()}update(e){if(!this.hasUpdate.get())try{if(this.useServiceWorker){let t=window.__registeredServiceWorker;t&&t.update().then(()=>{e&&e(!!t.installing)})}else window.applicationCache&&window.applicationCache.status===window.applicationCache.IDLE&&window.applicationCache.update()}catch(t){}}onUpdateReady(){n.default.log("Cache: New version available"),this.useServiceWorker?n.default.log("Service worker has update"):window.applicationCache&&this.startStatus===window.applicationCache.UNCACHED&&n.default.log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction()}onFirstUpdateReady(){n.default.log("Cache: first update")}onUpdateError(e){!h.a.demo&&d.a.isConnected()&&(n.default.log("Update Error: ",e),"quota"===e.reason&&l.default.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"})),this.onCacheLoadFinished()}onUpdateDownloading(){n.default.log("Cache: New version downloading")}onCacheObsolete(){this.onUpdateReady()}onCacheLoadFinished(){if(!this.isFinished){var e=0;this.isFinished=!0;for(var t=0;t<this.fnToRun.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.fnToRun[t]()}}}updateAction(){this.hasUpdate.set(!0)}},s()(i.prototype,"update",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"update"),i.prototype),s()(i.prototype,"onUpdateReady",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"onUpdateReady"),i.prototype),i);t.a=p},187:function(e,t,a){"use strict";a.r(t);var i=a(1),r=a(3),s=a(0),n=a(6),o=a(4),l=a(5);var d=class{getAppInfo(e){var t=Date.now();e.user={name:r.default.settings.displayName.get(),email:r.default.settings.activeUser.get()},e.sessionStart=s.default.SESSION_BEGIN,e.reportTime=t,e.runningTime=t-s.default.SESSION_BEGIN,l.a.getPlatformInfo(e),e.jsVersion=i.a.jsVersion}};t.default=new class extends d{getAppInfo(e){super.getAppInfo(e);let t=window;e.user={name:r.default.settings.displayName.get(),email:r.default.settings.activeUser.get()},e.gapiTimeout=t.gapiTimeout,e.sessionID=t.__SESSION_ID,e.appCacheUpdated=s.default.wasAppCacheUpdated,e.realtimeLoadStatus=this.computeRealtimeLoadStatus(),this.getRunningState(e),this.getAppStats(e),this.getPremiumInfo(e);try{e.cacheState=r.default.cacheManager.getInfo()}catch(a){e.cacheState="ERROR"}}getRunningState(e){let t,a=window;try{r.default.PaneManager.hasLoadedPaneState()&&(t=r.default.PaneManager.getPaneState())}catch(i){s.default.log("Failed to get paneState")}e.isDebug=!1,e.isDemo=s.default.isDemoMode(),e.localWrites=s.default.shouldWriteLocal(),e.authUserLoggedIn=s.default.authUserLoggedIn,e.isReconnected=s.default.isReconnected,e.url=s.default.sanitizeURL(window.location.href),e.paneState=t?s.default.sanitizePaneState(t):"Missing Pane State",e.checkpoints=a.__checkpoints,e.gapiLoadError=a.gapiLoadError,e.gapiTimeout=a.gapiTimeout,e.gapiClientLoadError=a.gapiClientLoadError,e.gapiClientTimeout=a.gapiClientTimeout,e.DOMReadyState=document.readyState,e.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.eventStream=s.default.getEventStream(),e.trackerStream=n.d.stringifyGroups(),e.criticalErrorReported=s.default.criticalErrorReported(),s.default.getLoadedScripts(e);try{e.nativesel=s.default.parseExtra(window.getSelection())}catch(i){e.nativesel="Error: "+i.message}try{e.customsel=o.a.dumpState()}catch(i){e.customsel="Error: "+i.message}try{e.errorPlatformInfo=JSON.stringify(s.default.errorPlatformInfo)}catch(i){e.errorPlatformInfo="Error: "+i.message}try{e.validScreens=JSON.stringify(a.Screens)}catch(i){e.validScreens="Error: "+i.message}e.lastActivity=s.default.lastActivity}getPremiumInfo(e){if(r.default.billingManager){var t={premiumStatus:r.default.billingManager.getPremiumStatus(),billingIdentifier:r.default.billingManager.getBillingIdentifier(),lastSignupError:r.default.billingManager._lastSignupError};e.premiumInfo=t}else e.premiumInfo="Billing Manager Not Loaded"}computeRealtimeLoadStatus(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&s.default.isFunction(window.gapi.drive.realtime.load))}}getAppStats(e){let t=window;if(e.numPanes=t.__TOTAL_PANES,e.numItems=s.default.totalItems,e.numArchivedItems=s.default.totalArchivedItems,e.numArchiveParents=s.default.totalArchivedParents,e.parseTextCalls=t.__PARSE_STATS,e.notificationUpdatesFull=s.default.__FULL_NOTIFICATION_UPDATES,e.notificationUpdatesSingle=s.default.__SINGLE_NOTIFICATION_UPDATES,e.XHRStats=s.default.getXHRStats(),r.default.pluginManager){try{e.pluginStats=r.default.pluginManager.getStats()}catch(a){e.pluginStats="Error: "+a.message}try{e.pluginState=r.default.pluginManager.getState()}catch(a){e.pluginState="Error: "+a.message}}if(r.default.recurringTaskManager)try{e.taskStats=r.default.recurringTaskManager.getStats()}catch(a){e.taskStats="Error: "+a.message}i.a.DETAILED_STATS;try{e.measureStats=r.default.Measure.getMeasureStats()}catch(a){e.measureStats="Error: "+a.message}}}},188:function(e,t,a){"use strict";var i=a(0),r=a(3),s=a(16),n=a(5),o=a(20),l=a(1),d=a(13),h=a(6),c=a(4),u=a(17),p=a(9),g=a(44);function f(){this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.isPaused=!1,this.stoppedFromPause=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.lastLoadedData=void 0,this.savedItems={},this.typingSpeed=30,this._scriptQueue=[],this.startText={},this.demoCaption=new p.a,i.default.isDemoMode()&&window.addEventListener("message",function(e){if(e.data&&i.default.isString(e.data)&&e.data.indexOf("{")<0)for(var t=0,a=e.data.split("&"),s=0;s<a.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=a[s].split("=");try{i.default.PAssert(173,n.length>=0,"Invalid number of params in message")}catch(o){i.default.reportError(o)}switch(n[0]){case"script":this.runScript(n[1]);break;case"start":this.start();break;case"stop":this.stop();break;case"pause":this.pause();break;case"resume":this.resume();break;case"restart":this.restart();break;case"alertDemo":r.default.menus.alert({text:'Click anywhere to try this <b class="blue">live demo</b>',callback:i.default.emptyFn});break;case"help":"1"===n[1]?i.default.vmMain.showHelp(l.a.HelpMode.Normal):r.default.intro.close();break;case"panes":this.loadPanes(n[1])}}}.bind(this),!1),window.pauseScript=()=>{this.isDisabled||(i.default.log("pause script"),this.isDisabled=!0)}}var m=function(e,t,a,i,r,s){this.queue.apply(this,arguments)},v=function(e,t,a,i){if(m("createItemAfter",void 0,t),void 0!==a&&0!==a)for(var r=0,s=0;s<Math.abs(a);s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;m("indent",a<0)}m(i?"setText":"typeString",void 0,e)},y=function(e){m("delay",e)};f.prototype={runScript:function(e){if(!this.isDisabled){0;var t=this.createScript(e);switch(this.activeScript=t,e){case"wait":this.demoEmpty(t);break;case"introEmail":this.demoEmail(t);break;case"introStyle":this.demoStyle(t);break;case"press":this.demoPress(t);break;case"none":return void this.notify("demoReady")}if(t.runQueue.length>0)this._scriptQueue.push(t);else try{i.default.PAssert(174,!1,"Invalid script request: ",e)}catch(a){i.default.reportError(a)}this.repeat=!1,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&this.start()}},start:function(){r.default.toasts.clearMessage(l.a.MessageID.ThisIsDemo),this.onScriptStart(this.activeScript),this.run()},restart:function(){this.activeScript=this._scriptQueue[0],this.activeScript.index=0,this.start()},stop:function(){this._scriptQueue=[],this.isRunning=!1,this.activeScript=void 0,clearTimeout(this.timeoutDelay),this.timeoutDelay=void 0,clearTimeout(this.timeout),this.timeout=void 0,clearTimeout(this.timeoutMessage),this.timeoutMessage=void 0,g.a.hide(),r.default.DragDrop.stop(),r.default.DragDrop.finish()},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1,this.wasResumed=!0,this.stoppedFromPause&&(this.stoppedFromPause=!1,this.run())},demoReady:function(e){this.wasResumed||this.pause(),this.notify("demoReady"),e()},switchDemo:function(e){this.stop(),i.default.isDemoRunning=!0;var t=this[e]();this.resetData(function(){this._scriptQueue.push(t),this.activeScript=t,this.start()}.bind(this))},loadPanes:function(e){r.default.PaneManager.loadDemoPanes(e.split(":"))},onScriptStart:function(e){e&&window.parent.postMessage(e.getName(),"*")},createScript:function(){var e={_nextId:0,owner:this,index:0,_repeat:!1,noDelay:!1,runQueue:[],_activeQueue:function(){return this.runQueue},queue:function(e){var t=Array.prototype.slice.call(arguments,1),a=this.runQueue;return a.push({id:this._nextId++,name:e,args:t}),a},repeat:function(e){this._repeat=e},nextStep:function(){return this.runQueue[this.index++]},getName:function(){return this._name}};return m=m.bind(e),v=v.bind(e),e},run:function(){if(!this.isDisabled&&this.activeScript)if(this.isPaused)this.stoppedFromPause=!0;else{try{i.default.PAssert(176,this.activeScript,"Must have a script active to be running")}catch(a){i.default.reportError(a)}var e=this.activeScript.nextStep();if(e){var t=e.args;t.push(this.run.bind(this)),this.isRunning=!0,clearTimeout(this.timeout),this.timeout=setTimeout(function(){try{this[e.name].apply(this,t)}catch(a){i.default.reportError(a),this.onDisable()}}.bind(this),0)}}},onDisable:function(){this.isDisabled=!0},setSelection:function(e,t,a,s,n){try{i.default.PAssert(177,e,"Must provide a valid item to select")}catch(l){i.default.reportError(l)}i.default.isNumber(e)&&(e=r.default.PaneManager.getPaneAtIndex(t).itemAtIndex(e));e=this.getItemIfString(e);var o=t>=0?r.default.PaneManager.getPaneAtIndex(t):i.default.focusedPane;i.default.focusedPane&&i.default.focusedPane.id===o.id||c.a.focusPane(o),void 0===a||null===a?a=0:a<0&&(a=e.getParsedText().length+a+1),c.a.selectItem(e,a,a+s),this.hasSelection=!0,this.selectedItem=e,n&&n()},clearSelection:function(e){c.a.reset(),this.hasSelection=!1,this.selectedItem=void 0,e&&e()},scrollTo:function(e,t,a){var s=r.default.PaneManager.getPaneAtIndex(e);try{i.default.PAssert(178,s,"Must have selected a valid pane")}catch(n){i.default.reportError(n)}s.setScrollOffset(t),a&&a()},scrollMain:function(e,t,a){i.default.vmMain.setScrollOffset(e,t),setTimeout(a,t)},setText:function(e,t,a){(e=e||this.selectedItem).setText(t,l.a.ChangeType.Local),a&&a()},appendText:function(e,t,a){e.setText(e.getParsedText()+t,!0),a&&a()},setPriority:function(e,t,a){(e=this.getItemIfString(e)||this.selectedItem).setPriority(t,l.a.ChangeType.Local),a&&a()},setStarred:function(e,t,a){(e=e||this.selectedItem).setStarred(t,l.a.ChangeType.Local),a&&a()},setComplete:function(e,t,a,i){(e=this.getItemIfString(e)||this.selectedItem).dateCompleted=a,e.isComplete(t,l.a.ChangeType.Local),i&&i()},removeItem:function(e,t){(e=this.getItemIfString(e)||this.selectedItem).deleteSelf(l.a.ChangeType.Local),t()},setStarredEmail:function(e,t,a){var i=r.default.PaneManager.getPaneAtIndex(e),s=i.itemAtIndex(t);i.toggleStar(s),a()},setPriorityEmail:function(e,t,a,i){var s=r.default.PaneManager.getPaneAtIndex(e).itemAtIndex(t),n=r.default.pluginManager.getPluginGmail();s&&n.setAttachmentPriority(s.getAttachmentByPlugin(l.a.PluginID.Gmail),a),i()},indent:function(e,t){var a={normCode:l.a.KeyCode.Tab,shiftKey:e};c.a.fireKeyEvent(void 0,a),t&&t()},collapse:function(e,t,a){var i=r.default.PaneManager.getPaneAtIndex(t);(e=this.getItemIfString(e)||this.selectedItem).setCollapsed(!0,i),a&&a()},backspace:function(e,t,a,r){try{i.default.PAssert(183,r,"typeString should always have a callback")}catch(c){i.default.reportError(c)}e=this.getItemIfString(e)||this.selectedItem;try{i.default.PAssert(184,e,"Must be an item")}catch(c){i.default.reportError(c)}try{i.default.PAssert(185,this.hasSelection,"Must set selection before typing")}catch(c){i.default.reportError(c)}try{i.default.PAssert(186,!this.isTyping,"Must wait until previous typing is finished")}catch(c){i.default.reportError(c)}var s=0,n=()=>{this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1},o=this.activeScript,d=e.getParsedText();function h(){this.isTyping=!0,this.activeScript===o?(d=d.substr(0,a-1)+d.substr(a,d.length-a),a--,e.setText(d,l.a.ChangeType.Local),++s>=t&&(n(),r&&r())):n()}h.apply(this),t>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(h.bind(this),this.typingSpeed))},typeString:function(e,t,a){try{i.default.PAssert(187,a,"typeString should always have a callback")}catch(d){i.default.reportError(d)}e=this.getItemIfString(e)||this.selectedItem;try{i.default.PAssert(188,e,"Must be an item")}catch(d){i.default.reportError(d)}try{i.default.PAssert(189,this.hasSelection,"Must set selection before typing")}catch(d){i.default.reportError(d)}try{i.default.PAssert(190,!this.isTyping,"Must wait until previous typing is finished")}catch(d){i.default.reportError(d)}try{i.default.PAssert(191,void 0!==t,"Must supply a string to be typed")}catch(d){i.default.reportError(d)}var r=0,s=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),n=this.activeScript;function o(){if(this.isTyping=!0,this.activeScript===n){var i=t.charCodeAt(r);if(i===l.a.KeyCode.Delete&&(i=l.a.KeyCode.Period),i===l.a.KeyCode.End){var o=c.a.getStartOffset(),d=e.getParsedText(),h=d.substr(0,o)+t.charAt(r)+d.substr(o);e.setText(h,l.a.ChangeType.Local),c.a.selectItem(e,o+1)}else c.a.fireKeyEvent(void 0,{normCode:i});++r>=t.length&&(s(),a&&a())}else s()}t&&(o.apply(this),t.length>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(o.bind(this),this.typingSpeed)))},typeIntoEmail:function(e,t,a){var r=i.default.reactEmailCompose.refs.body,s=0,n=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),o=this.activeScript;clearInterval(this.intervalTyping),this.intervalTyping=setInterval(function(){if(this.activeScript===o){var t=e[s];r.insertCharAtIndex(t,s),++s>=e.length&&(n(),a&&a())}else n()}.bind(this),t)},setSearch:function(e,t,a){r.default.PaneManager.getPaneAtIndex(t).search.setValue(e),a&&a()},createItemAfter:function(e,t,a){e=e||this.selectedItem,this.setSelection(e,void 0,e.getParsedText().length,0),c.a.fireKeyEvent(void 0,{normCode:l.a.KeyCode.Enter}),requestAnimationFrame(()=>{this.clearSelection(()=>{var r;r=e.isHeader()?e.getChild(0):e.parent().getChild(e.getIndex()+1);try{i.default.PAssert(196,r,"Error getting new item: ",t)}catch(s){i.default.reportError(s)}t&&(this.savedItems[t]=r),this.selectedItem=r,this.setSelection(r,void 0,-1,0,a)})})},zoomPane:function(e,t,a){var i=r.default.PaneManager.getPaneAtIndex(e);t=this.getItemIfString(t),i.setItem(t,!0),a&&a()},zoomGmailPane:function(e,t,a){var s=r.default.PaneManager.getPaneAtIndex(e),n=r.default.pluginManager.getPluginGmail(),o=n._getLabelByName("me",t);try{i.default.PAssert(201,o,"Must be able to get a valid label if clicking a valid label")}catch(d){i.default.reportError(d)}var l=n.getVMLIForLabel("me",o);s.setItem(l,!0),s.selectIndex(-1),a&&a()},delay:function(e,t){t&&(0===e?t&&t():(this.delayCb=t,clearTimeout(this.timeoutDelay),this.timeoutDelay=setTimeout(()=>{this.delayCb=this.timeoutDelay=void 0,t()},e)))},addPane:function(e,t,a,i,s,n){var o={};if(a)o.item=this.getItemIfString(a);else{let e=d.a.getDefaultDocument();o.item=e.getRootItem()}i&&(o.search=i);r.default.PaneManager.createPaneAtIndex(e,t,o,s);n()},removePane:function(e,t,a){r.default.PaneManager.removePaneAtIndex(e,t),a&&a()},cullPanes:function(e,t){var a=r.default.PaneManager.paneCount();a>e?(this.removePane(a-1),setTimeout(this.cullPanes.bind(this,e,t),60)):t()},selectItemInPane:function(e,t,a){var i=r.default.PaneManager.getPaneAtIndex(e).itemAtIndex(t);this.selectedItem=i,a()},dragTo:function(e,t,a,s,n,o){var d=r.default.PaneManager.getPaneAtIndex(e),h=r.default.PaneManager.getPaneAtIndex(t),u=d.itemAtIndex(a),p=d.elementAtIndex(a),g=-1===s;g&&(s=h.numItems()-1);var f,m,v=h.elementAtIndex(s),y=h.itemAtIndex(s),_=h.objectAtIndex(s),S=p.getBoundingClientRect(),P=v.getBoundingClientRect(),I=d.dragMarginTop||0,b=S.top+(I||10),D=P.left-S.left,w=P.top-b+(g?r.default.DisplaySettings.lineItemHeight(_,y,1):0);c.a.focusPane(d);var E=null;var C=this,A=this.activeScript;r.default.DragDrop.startDragItem=u,u.dragStart({startSrc:p,eventX:S.left+10,eventY:b}),requestAnimationFrame(function e(t){if(C.activeScript===A){E||(E=t);var a,r=(a=(t-E)/n)<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1;if(f=D*r+S.left+10,m=w*r+b,r>=1){var s,d=document.getElementById("preventInteraction");d&&(s=d.parentElement).removeChild(d)}u.dragMove({eventX:f,eventY:m,diffY:w>S.top?1:-1,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn}),d&&s.appendChild(d),r>=1?(u.dragEnd({clientX:f,clientY:m,target:p}),o&&o()):requestAnimationFrame(e)}else c.a.fireMouseUp(p,l.a.ButtonCode.Left)})},getItemIfString:function(e){var t;if(i.default.isString(e)){t=d.a.getItem(e)||this.savedItems[e];try{i.default.PAssert(208,t,"Item was not saved correctly")}catch(a){i.default.reportError(a)}}else if(e){try{i.default.PAssert(209,i.default.isVMLI(e),"Must supply a valid VMLI: ",i.default.getObjectInfo(e))}catch(a){i.default.reportError(a)}t=e}return t},pushMessage:function(e,t){if(this._currentToast)return r.default.toasts.clearMessage(this._currentToast),this._currentToast=void 0,void setTimeout(this.pushMessage.bind(this),100,e,t);var a;if(a=i.default.isString(e)?r.default.toasts.pushMessage({text:e,hold:!0}):r.default.toasts.pushMessage(e),this._currentToast=a,e===l.a.MessageID.ThisIsDemo){var s=function(){r.default.toasts.clearMessage(a),u.a.unlisten("tapMain",s)};u.a.listen("tapMain",s)}t&&t()},notify:function(e,t){window.parent.postMessage(e,"*"),t&&t()},demoDone:function(e){c.a.reset(),this.notify("done"),i.default.isDemoRunning=!1;var t=document.getElementById("preventInteraction");t&&t.parentElement.removeChild(t),e()},addClass:function(e,t){i.default.addClass(document.documentElement||document.body,e),t&&t()},removeClass:function(e,t){i.default.removeClass(document.documentElement||document.body,e),t&&t()},switchClass:function(e,t,a){this.removeClass(e),this.addClass(t),a()},selectEmail:function(e,t,a){var s=r.default.PaneManager.getPaneAtIndex(e);try{i.default.PAssert(210,s,"Must have selected a valid pane")}catch(n){i.default.reportError(n)}c.a.focusPane(s),s.selectIndex(t),a&&a()},openEmail:function(e,t,a){var s=r.default.PaneManager.getPaneAtIndex(e);try{i.default.PAssert(211,s,"Must have selected a valid pane")}catch(o){i.default.reportError(o)}s.selectIndex(t);var n=s.itemAtIndex(t);s.openEmailByItem(n),a&&a()},closeEmail:function(e){r.default.EmailPreview.close(),e&&e()},sendEmail:function(e){i.default.reactEmailCompose.onClickSend(),e()},toggleMessageExpanded:function(e,t){i.default.reactEmailPreview.toggleExpanded(e),t()},replyToMessage:function(e){r.default.EmailPreview.setLastMessageResponseMode(l.a.EmailResponseMode.Reply),e()},archiveEmail:function(e,t,a){var i=r.default.PaneManager.getPaneAtIndex(e),s=i.itemAtIndex(t);i.archiveItem(!0,s),a()},addEmail:function(e,t){r.default.pluginManager.getPluginGmail().refreshThreadCacheData("me",e,void 0,function(){},t)},waitPaneItems:function(e,t){var a=r.default.PaneManager.getPaneAtIndex(e);try{i.default.PAssert(212,a,"Must have selected a valid pane")}catch(n){i.default.reportError(n)}if(a.items.length()>0)t();else{var s=function(e){e.length>0&&(a.items.unlisten(s),t())};a.items.listen(s)}},displaySetting:function(e,t){r.default.DisplaySettings.changeTheme(e,e),t()},caption:function(e,t,a){this.demoCaption.set({text:e,opacity:1,center:t,light:e.indexOf("<b>")>=0}),a()},captionFade:function(e){var t=this.demoCaption.get();this.demoCaption.set({text:t.text,opacity:0,center:t.center,light:t.light}),e()},waitAction:function(e,t){this._waitTracker={check:e,cb:t}},onTrackerAction:function(e){var t=this._waitTracker;t&&t.check(e)&&t.cb()},demoEmail:function(e){return i.default.isDemoRunning=!0,m("waitPaneItems",0),m("zoomGmailPane",1,"Needs Reply"),m("zoomGmailPane",2,"Starred"),m("removeClass","invisible"),m("demoReady"),y(1e3),m("dragTo",0,1,0,-1,1e3),y(200),m("dragTo",0,1,0,-1,1e3),y(800),m("setStarredEmail",0,1),y(500),m("setStarredEmail",0,3),y(800),m("setPriorityEmail",2,0,l.a.VMLIFlag.P0),y(500),m("setPriorityEmail",2,2,l.a.VMLIFlag.P2),y(1200),m("selectEmail",0,0),y(200),m("openEmail",0,0),m("pushMessage",l.a.MessageID.ThisIsDemo),m("demoDone"),e},demoStyle:function(e){var t=0,a=0;i.default.isDemoRunning=!0,this.collapse("ideas",0),this.collapse("todo",0),this.collapse("testing",0),m("removeClass","invisible"),m("demoReady"),y(500),m("dragTo",0,1,1,1,1e3),y(1e3),m("setSelection","tracking",0,-1,0),m("typeString",void 0," #Android"),y(800),m("typeString",void 0," @tomorrow "),y(800),m("setSelection","tracking",0,0,0),m("typeString",void 0,"+Grant "),y(1500),m("zoomPane",1,"release"),y(1500);for(var r="#Android",s=r.length;s>=0;s--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;m("setSearch",r.substr(0,s),2),y(40)}y(800),r="+Grant";for(s=0;s<=r.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;m("setSearch",r.substr(0,s),2),y(40)}m("pushMessage",l.a.MessageID.ThisIsDemo),m("demoDone")},demoPress:function(e){h.d.addListener(this.onTrackerAction.bind(this)),m("pushMessage",{text:"Try dragging an email onto the Outline.",hold:!0,big:!0}),m("waitAction",function(e){return e.type===h.d.TrackerType.Misc&&e.misc===h.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===l.a.PaneMode.Gmail}),m("pushMessage",{text:"Schedule an item by typing @ then a date.<br><br>Or drag it right onto the Agenda.",hold:!0,big:!0}),m("waitAction",function(e){return e.type===h.b.Misc&&e.misc===h.a.ChangeDate||e.type===h.b.Insert&&"@"===e.data[0].text}),m("pushMessage",{text:"Learn more on our homepage.",hold:!0,action:l.a.MessageAction.OpenURL,actionText:"https://moo.do",data:{url:"https://www.moo.do"}})},demoEmpty:function(e){i.default.isDemoRunning=!0,m("demoReady"),m("pushMessage",l.a.MessageID.ThisIsDemo),m("demoDone")}};var _,S=f;!function(e){e.Normal="Sign in with Google",e.Connecting="Connecting...",e.LoggingIn="Logging In...",e.Loading="Loading...",e.Offline="Offline"}(_||(_={}));t.a=class{constructor(){var e;e=navigator.onLine?_.Normal:_.Offline,this.loginStatus=new p.a(e),this.popupClosedError=new p.a,this.gapiFailedToLoad=new p.a,this.loggedOutByAuthFailure=new p.a,this.downloadIcon=this.getDownloadIcon(),this.downloadText="Download "+this.getDownloadText()+" app",this.showDownload=n.a.canDownloadNativeApp(),this.loginRequested=!1,this.loginRequestTimer=void 0}getDownloadIcon(){return n.a.getPlatformIcon()}getDownloadText(){return n.a.getPlatformName()}userLogin(){o.a.onAuthed(()=>{i.default.authUserLoggedIn=!0,this.loginRequested=!1,this.loginStatus.set(_.Normal),r.default.settings.localIntegrity.set(!0),this.popupClosedError.set(void 0),r.default.PaneManager.setupInitialTimeout()}),this.loginStatus.set(_.LoggingIn),o.a.signIn()}shouldShowLogin(){return this.loginStatus.get()===_.Normal||this.loginStatus.get()===_.LoggingIn}logout(){r.default.settings.activeUser.get()&&(i.default.log("Logging out"),o.a.signOut().then(()=>{d.a.clearLocalData()}))}logoutClicked(){i.default.isDemoMode()?s.a.removeURLParam("demo"):d.a.hasPendingRemoteUpdates()?r.default.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",e=>{e&&this.logout()}):this.logout()}initDemo(){i.default.AScript||(i.default.AScript=new S)}runScript(e){i.default.AScript.runScript(e)}_reportLoginTapSkip(e){}closeConnectionError(){r.default.tooltip.hideSticky(this.textErrorConnecting)}}},19:function(e,t,a){"use strict";a.r(t);var i=a(0);var r=class{constructor(e){this._range=e,this._range||(this._range=a(19).default._getSelectionRange())}isValid(){return!!this._range}getNativeRange(){return this._range}getStartContainer(){return this._range.startContainer}getEndContainer(){return this._range.endContainer}getStartElement(){return i.default.getElementParent(this.getStartContainer())}getEndElement(){return i.default.getElementParent(this.getEndContainer())}getSelectOffsetsInElement(e){return a(19).default.getSelectOffsetsInElement(e,this._range)}getStartOffset(){return this._range.startOffset}getEndOffset(){return this._range.endOffset}},s=a(1);t.default=new class{createFakeRange(e,t,a,s){try{var n=this.createSelectionRange();return n.setStart(e,t),n.setEnd(a,s),new r(n)}catch(o){i.default.reportError(o)}}createSelectionRange(){return document.createRange()}setSelection(e,t,a,r,s){if("TEXTAREA"===e.nodeName){try{i.default.PAssert(546,e===a,"Cannot multiselect textareas")}catch(o){i.default.reportError(o)}e.focus(),e.selectionStart=t,e.selectionEnd=r}else{var n=this.createSelectionRange();this.setSelectionValues(n,e,t,a,r),this.setSelectionRange(n)}}setSelectionRange(e){var t=window.getSelection();i.default.shouldLog(s.a.LogLevels.Selection)&&i.default.log("Set Selection to Range",e),t.removeAllRanges(),e instanceof r&&(e=e.getNativeRange()),t.addRange(e)}insertNode(e){var t=this._getSelectionRange();t&&t.insertNode(e)}selectAfterNode(e){var t=document.createRange();t.setStartAfter(e),this.setSelectionRange(t)}setSelectionRangeToWhatItAlreadyIs(){var e=this._getSelectionRange();i.default.shouldLog(s.a.LogLevels.Selection)&&i.default.log("Set Selection to Same",e),e&&this.setSelectionRange(e)}hasValidSelection(){return this.getSelectionRange(!0).isValid()}getSelectionRange(e){var t;return e&&(t=this._getSelectionRange()),new r(t)}_getSelectionRange(){var e,t=window.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e}getSelectionNode(){var e=window.getSelection().anchorNode;if(e)return e.nodeType===Node.TEXT_NODE?e.parentNode:e}getSelectedText(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!==document.selection.type?document.selection.createRange().text:void 0}clearSelection(){var e=window.getSelection();i.default.shouldLog(s.a.LogLevels.Selection)&&i.default.log("Clear Selection"),e.removeAllRanges()}hasSelection(){var e=this._getSelectionRange();return!(!e||e.startContainer===document.documentElement)&&i.default.getPaneForElement(e.startContainer)&&i.default.findParent(e.startContainer,"paneContent")}hasRawSelection(){return!!window.getSelection().anchorNode}getCursorSelectionRange(e){var t,a=e.target,n=i.default.ensureDOMNode(e.target);if(n){var o=i.default.getElementParent(a),l=0,d=i.default.getItemForElement(a),h=i.default.getPaneObjectForElement(a);try{i.default.PAssert(547,o,"getCursorSelectionRange must only be called when hovered item is item",n)}catch(g){i.default.reportError(g)}i.default.findParent(a,"line")||(n=o.firstElementChild,l=s.a.LineLeftPad+(!h.isBlockHeader&&d.hasPrefix()?s.a.PrefixWidth:0));var c=n.getBoundingClientRect(),u=i.default.clamp(e.clientY,c.top+9,c.bottom-9),p=i.default.clamp(e.clientX,c.left+l,c.right-1);t=this._getCursorSelectionRange(p,u)}return t?new r(t):void 0}_getCursorSelectionRange(e,t){var a;if(document.caretRangeFromPoint)a=document.caretRangeFromPoint(e,t);else if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(e,t);r&&((a=document.createRange()).setStart(r.offsetNode,r.offset),a.setEnd(r.offsetNode,r.offset))}else if(document.body.createTextRange){var s=this._getSelectionRange(),n=document.body.createTextRange();try{n.moveToPoint(e,t),n.select(),a=this._getSelectionRange(),this.setSelectionRange(s)}catch(o){}}else try{i.default.PAssert(548,!1,"Unable to get selection range at cursor")}catch(l){i.default.reportError(l)}return a}_getPreviousComponentNode(e){let t=e.previousSibling;return t&&!this._isComponentNode(t)&&1===t.childNodes.length&&this._isComponentNode(t.childNodes[0])&&(t=t.childNodes[0]),t}_ensureSelectionInElement(e,t){try{i.default.PAssert(549,e,"Must have a valid element")}catch(l){i.default.reportError(l)}try{i.default.PAssert(550,t,"Must have a valid range")}catch(l){i.default.reportError(l)}if(i.default.isAncestor(t.startContainer,e)||t.setStart(e,0),i.default.isAncestor(t.endContainer,e)||t.setEnd(e,0),i.default.hasClass(t.startContainer,"textSelected")&&t.setStart(t.startContainer.parentElement.firstElementChild,t.startContainer.textContent.length),i.default.hasClass(t.endContainer,"textSelected")&&t.setEnd(t.endContainer.parentElement.firstElementChild,t.endContainer.textContent.length),i.default.hasClass(t.startContainer,"itemIgnoreText")){let e=this._getPreviousComponentNode(t.startContainer);e&&t.setStart(e,e.textContent.length)}if(i.default.hasClass(t.endContainer,"itemIgnoreText")){let e=this._getPreviousComponentNode(t.endContainer);e&&t.setEnd(e,e.textContent.length)}var a=i.default.getPluginForElement(t.startContainer);if(a){var r=a.textContent.length;!(n=a.nodeType===Node.TEXT_NODE)&&0===t.startOffset||n&&t.startOffset<r/2?t.setStartBefore(a):t.setStartAfter(a)}var s=i.default.getPluginForElement(t.endContainer);if(s){var n,o=s.textContent.length;!(n=s.nodeType===Node.TEXT_NODE)&&0===t.endOffset||n&&t.endOffset<o/2?t.setEndBefore(s):t.setEndAfter(s)}}getSelectOffsetsInElement(e,t){var a={start:0,end:0,total:0};if("TEXTAREA"===e.nodeName){a.start=e.selectionStart,a.end=e.selectionEnd,a.total=e.value.length;var r=e.value.indexOf("\n");r>=0&&a.start>r&&(a.start--,a.end--,a.total--)}else if(e){try{i.default.PAssert(551,t,"Must provide a valid range")}catch(g){i.default.reportError(g)}if(t){this._ensureSelectionInElement(e,t);var n=this._getComponentNode(t.startContainer),o=t.startOffset,l=this._getComponentNode(t.endContainer),d=t.endOffset;!n||n.textContent!==s.a.TextSpace&&0!==n.textContent.length||(o=0),!l||l.textContent!==s.a.TextSpace&&0!==l.textContent.length||(d=0);var h=0,c=this._getComponentNodesIn(e);if(c.length>0)for(var u=0,p=0;p<c.length;++p){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;c[p]===n&&(a.start=h+o),c[p]===l&&(a.end=h+d),h+=this._getComponentNodeLength(c[p]),void 0===l&&(p===d-1?a.end=h:0===p&&0===d&&(a.end=0)),void 0===n&&(p===o-1?a.start=h:0===p&&0===o&&(a.start=0))}else a.start=0,a.end=0;a.total=h,isNaN(a.end)&&(a.end=h),a.start>a.total&&(a.start=a.total),a.end>a.total&&(a.end=a.total)}}try{i.default.PAssert(552,!isNaN(a.start)&&!isNaN(a.end),"Must have valid start and end",a)}catch(g){i.default.reportError(g)}return a}getSelectOffsetsForMouseEvent(e){var t=i.default.getElementParent(e.target),a=this.getCursorSelectionRange(e);return a&&a.getSelectOffsetsInElement(t)}getOffsetChildElement(e,t){try{i.default.PAssert(553,e,"Must supply a valid element")}catch(l){i.default.reportError(l)}if("TEXTAREA"===e.nodeName)return{element:e,offset:t};if(this._isComponentNode(e)){try{i.default.PAssert(555,this._isComponentSelectable(e),"Component must be selectable")}catch(l){i.default.reportError(l)}return{element:e,offset:t}}for(var a=0,r=0,s=this._getComponentNodesIn(e),n=0;n<s.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._getComponentNodeLength(s[n]);if(r+o>=t)return{element:s[n],offset:t-r};r+=o}try{i.default.PAssert(554,!1,"Unable to find offset child element")}catch(l){i.default.reportError(l)}}getChildNodeOffset(e){var t=0;try{i.default.PAssert(556,e,"Must supply a valid child element")}catch(o){i.default.reportError(o)}for(var a=0,r=this._getComponentNodesIn(i.default.getElementParent(e)),s=this._getComponentNodesIn(e),n=0;n<r.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(r[n]===s[0])break;a+=this._getComponentNodeLength(r[n])}return a}_getComponentNodeLength(e){try{i.default.PAssert(557,this._isComponentNode(e),"Supplied node must be a valid component")}catch(t){i.default.reportError(t)}return i.default.hasClass(e,"plugin")?1:i.default.hasClass(e,"mdImageWrapper")?0:1===e.length&&e.textContent===s.a.TextSpace?0:e.length}_getComponentNodesIn(e){if(this._isComponentNode(e))return[e];var t=[];return this._getComponentNodes(t,e),t}_isComponentNode(e){var t=!1;return e&&(e.nodeType===Node.TEXT_NODE&&!i.default.getPluginForElement(e)||i.default.hasClass(e,"plugin")||i.default.hasClass(e,"mdImageWrapper"))&&(t=!0),t}_isComponentSelectable(e){try{i.default.PAssert(558,!e||this._isComponentNode(e),"Must either be an invalid node (not-selectable) or a component")}catch(a){i.default.reportError(a)}var t=!1;return e&&e.nodeType===Node.TEXT_NODE&&(t=!0),t}_getComponentNodes(e,t){if(t)if(this._isComponentNode(t))e.push(t);else if(!i.default.hasClass(t,"itemTime")&&t.childNodes)for(var a=0,r=0;r<t.childNodes.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t.childNodes[r];this._getComponentNodes(e,s)}}_getComponentNode(e){var t;if(this._isComponentNode(e))t=e;else{var a=i.default.getPluginForElement(e);a&&(t=a)}return t}setSelectionValues(e,t,a,r,n){try{i.default.PAssert(559,e,"Range must be supplied")}catch(o){i.default.reportError(o)}try{i.default.PAssert(560,this._isComponentNode(t),"Must be selecting a valid component")}catch(o){i.default.reportError(o)}try{i.default.PAssert(561,this._isComponentNode(r),"Must be selecting a valid component")}catch(o){i.default.reportError(o)}try{i.default.PAssert(562,t!==r||a<=n,"Select elements must be different, or selection must start before it ends")}catch(o){i.default.reportError(o)}if(t.nodeType===Node.TEXT_NODE)e.setStart(t,a);else{try{i.default.PAssert(563,i.default.hasClass(t,"plugin"),"Only other valid component is plugin")}catch(o){i.default.reportError(o)}try{i.default.PAssert(564,0===a||1===a,"Must eiter be selecting before or after the plugin")}catch(o){i.default.reportError(o)}0===a?this._selectBeforeComponent(e,t,"setStart"):1===a&&this._selectAfterComponent(e,t,"setStart")}if(r.nodeType===Node.TEXT_NODE)e.setEnd(r,n);else{try{i.default.PAssert(565,i.default.hasClass(r,"plugin"),"Only other valid component is plugin")}catch(o){i.default.reportError(o)}try{i.default.PAssert(566,0===n||1===n,"Must eiter be selecting before or after the plugin")}catch(o){i.default.reportError(o)}0===n?this._selectBeforeComponent(e,r,"setEnd"):1===n&&this._selectAfterComponent(e,r,"setEnd")}i.default.shouldLog(s.a.LogLevels.Selection)&&i.default.log("Set Selection: ["+a+","+n+"] - [",t+","+r+"]")}_selectBeforeComponent(e,t,a){var i=this._getPrevComponent(t);if(this._isComponentSelectable(i))e[a](i,this._getComponentNodeLength(i));else{var r=document.createTextNode("");t.parentNode.insertBefore(r,t),e[a](r,0)}}_selectAfterComponent(e,t,a){var i=this._getNextComponent(t);if(this._isComponentSelectable(i))e[a](i,0);else{var r=document.createTextNode("");t.parentNode.insertBefore(r,void 0),e[a](r,0)}}_getPrevComponent(e){try{i.default.PAssert(567,e,"Must supply a valid node")}catch(a){i.default.reportError(a)}try{i.default.PAssert(568,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(a){i.default.reportError(a)}var t=e.previousSibling;try{i.default.PAssert(569,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(a){i.default.reportError(a)}return t}_getNextComponent(e){try{i.default.PAssert(570,e,"Must supply a valid node")}catch(a){i.default.reportError(a)}try{i.default.PAssert(571,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(a){i.default.reportError(a)}var t=e.nextSibling;try{i.default.PAssert(572,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(a){i.default.reportError(a)}return t}selectElement(e,t,a){var i;if(isNaN(a)&&(a=t),isNaN(t))(i=this.createSelectionRange()).selectNodeContents(e);else{var r=this.getOffsetChildElement(e,t),s=t!==a?this.getOffsetChildElement(e,a):r;r&&(i=this.createFakeRange(r.element,r.offset,s.element,s.offset))}i&&this.setSelectionRange(i)}getSelectionInElement(e){var t=this._getSelectionRange();if(t&&i.default.isAncestor(t.startContainer,e)&&i.default.isAncestor(t.endContainer,e))return this.getSelectOffsetsInElement(e,t)}deleteRangeContents(){var e=this._getSelectionRange();e&&e.deleteContents()}}},192:function(e,t,a){"use strict";var i=a(0),r=a(2),s=a.n(r),n=a(15),o=a(4);t.a=class extends n.a{init(){var e={value:this.props.value||0,tempValue:void 0};this.createObservables(e)}componentWillReceiveProps(e){e.value!==this.state.value&&this.value.set(e.value)}getValue(){return this.value.get()}setValue(e){try{i.default.PAssert(666,i.default.isNumber(e),"Must only report a numerical value")}catch(t){i.default.reportError(t)}e=i.default.clamp(e,this.props.minValue||0,this.props.maxValue||1/0),this.value.get()!==e&&(this.tempValue.set(void 0),this.value.set(e),this.props.onChange&&this.props.onChange(e))}focus(){this.refs.input.focus()}blur(){this.refs.input.blur()}onFocus(){i.default.activeInput.set(this)}onBlur(){i.default.activeInput.set(null),void 0!==this.tempValue.get()&&(this.refs.input.value=""+this.value.get(),this.tempValue.set(void 0))}onMouseDown(){o.a.reset()}interval(){return this.props.interval||1}onClickUp(){if(!this.props.readonly){var e=this.value.get()+this.interval();this.setValue(e)}}onClickDown(){if(!this.props.readonly){var e=this.value.get()-this.interval();this.setValue(e)}}onChange(){var e=this.props.parseFn||i.default.parseInt,t=+this.refs.input.value,a=e(t);isNaN(a)?this.tempValue.set(t):this.setValue(a)}render(){var e=this.state,t=this.props,a=void 0!==e.tempValue?e.tempValue:e.value,r=i.default.classNames("fancyInputNumber c-border",t.className);return s.a.createElement("div",{className:r,id:t.id,style:{}},s.a.createElement("input",{className:"c-foreground",readOnly:t.readonly,onMouseDown:this.onMouseDown,onChange:this.onChange,value:a,ref:"input",onFocus:this.onFocus,onBlur:this.onBlur}),s.a.createElement("div",{className:"fancyInputNumberButton up icon-caret-up",onClick:this.onClickUp}),s.a.createElement("div",{className:"fancyInputNumberButton down icon-caret-down",onClick:this.onClickDown}))}}},20:function(e,t,a){"use strict";var i=a(3),r=a(0),s=a(1);var n=class{constructor(){this.onAuthedCallbacks=[]}getScopes(){return[s.a.GScope.UserInfoEmail,s.a.GScope.UserInfoProfile]}onSignInWithUser(e){this.user=e,i.default.settings.onLoaded(()=>{i.default.settings.userId.set(e.uid),i.default.settings.activeUser.set(e.email),i.default.settings.displayName.set(e.displayName);try{r.default.PAssert(122,e.uid===this._getUid())}catch(t){r.default.reportError(t)}this.runAuthedCallbacks()})}runAuthedCallbacks(){this.onAuthedCallbacks.length>0&&this.onAuthedCallbacks.forEach(e=>e())}getUserSync(){return this.user}async getUser(){return this.user?Promise.resolve(this.user):new Promise(e=>{this.onAuthedCallbacks.push(()=>{e(this.user)})})}onAuthed(e){this.user?e():this.onAuthedCallbacks.push(e)}onActiveUser(e){i.default.settings.activeUser.onHasValue(e)}getAccountName(){return r.default.isDemoMode()?"Demo User":i.default.settings.displayName.get()}getDefaultAccountID(){return r.default.isDemoMode()?"demoemail@moo.do":i.default.settings.activeUser.get()}getUid(){return i.default.settings.userId.get()}getEncryptionUid(){return i.default.settings.userId.get()}},o=a(42);t.a=new class extends n{constructor(){super()}init(){var e={clientId:s.a.ClientID,apiKey:s.a.APIKey,authDomain:`${s.a.FirebaseProjectID}.firebaseapp.com`,databaseURL:`https://${s.a.FirebaseProjectID}.firebaseio.com`,projectId:s.a.FirebaseProjectID,storageBucket:`${s.a.FirebaseProjectID}.appspot.com`,messagingSenderId:s.a.FirebaseAppID,scopes:this.getScopes()};o.a.initializeApp(e),window.firebase=o.a,o.a.auth().onAuthStateChanged(e=>{e&&i.default.settings.activeUser.get()?this.onSignInWithUser(e):(i.default.settings.userId.set(void 0),i.default.settings.activeUser.set(void 0),i.default.settings.displayName.set(void 0))}),this._isOnline=navigator.onLine,window.addEventListener("online",()=>{this._isOnline=navigator.onLine})}signIn(){this._isSigningIn=!0;let e=new o.a.auth.GoogleAuthProvider,t=this.getScopes();e.setCustomParameters({prompt:"select_account"}),t.forEach(t=>{e.addScope(t)}),o.a.auth().signInWithPopup(e).then(e=>{e.additionalUserInfo&&(this.userProfile=e.additionalUserInfo.profile);try{r.default.PAssert(5,e.user,"Somehow signed in without a valid user")}catch(t){r.default.reportError(t)}e.user&&this.onSignInWithUser(e.user)}).catch(e=>{if("auth/popup-closed-by-user"===e.code)i.default.setup.popupClosedError.set("Error signing in. Please try again.");else if("auth/network-request-failed"===e.code)i.default.setup.popupClosedError.set("Connection error. Please try again.");else try{r.default.PAssert(6,!1,"Error on signin",e.code,e.message)}catch(t){r.default.reportError(t)}})}_getUid(){return r.default.isDemoMode()?"demouid":o.a.auth().getUid()}async signOut(){return i.default.settings.activeUser.set(void 0),o.a.auth().signOut()}isOnline(){return navigator.onLine}}},207:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(3),l=a(8);let d=(i=class{tagComparator(e,t){return e.localeCompare(t)}tagComparatorNumber(e,t){var a=e.count,i=t.count;return a===i?e.text.localeCompare(t.text):a>i?-1:1}findMatchExact(e){return!1}findMatchLike(e,t,a,i){var r={},s=[],l=e.toLowerCase(),d={comparator:e=>{if(!e.isComplete()){var t=e.getTagsLower();if(t)for(var a=0,n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t[n];if(!l||o.startsWith(l)&&(i||o!==l)){if(!r[o]){var d=r[o]={type:"tag",text:o,count:0};s.push(d)}r[o].count++}}}}};return a?d.item=a:d.itemStore=o.default.itemStoreManager.getDefaultItemStore(),n.default.searchVMLIs(d),s.sort(this.tagComparatorNumber),s.length>t&&(s=s.slice(0,t)),s}printStats(e){var t=0;n.default.log("--- Tag stats ---",e);for(var a=this.findMatchLike("",100),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;console.log(a[i].text,a[i].count)}}getAll(){return this.findMatchLike("")}getRNList(e){let t=[];return this.findMatchLike(e,void 0,void 0,!0).forEach(e=>{t.push({text:e.text,rightText:e.count})}),t.sort(this.tagComparatorNumber),t}},s()(i.prototype,"tagComparatorNumber",[l.a],Object.getOwnPropertyDescriptor(i.prototype,"tagComparatorNumber"),i.prototype),s()(i.prototype,"getRNList",[l.a],Object.getOwnPropertyDescriptor(i.prototype,"getRNList"),i.prototype),i);t.a=new d},21:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(8),o=a(0),l=a(1);var d=(i=class{constructor(e,t){this._batchConstructor=e,this._batchParams=t,this._batchedRequests={},this._successCB=o.default.emptyFn,this._failureCB=o.default.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=o.default.generateTempId()}add(e,t,a){try{o.default.PAssert(737,e,"Must provide a valid request to add to batch")}catch(r){o.default.reportError(r)}try{o.default.PAssert(738,t,"Must supply a valid group ID when adding to a batch")}catch(r){o.default.reportError(r)}try{o.default.PAssert(739,!this._hasRun,"Should never add new requests to a batch that has already run")}catch(r){o.default.reportError(r)}var i=this._ensureGroup(t);return this._addRequestToGroup(t,a,e),i}then(e,t,a){this._successCB=e||o.default.newEmptyFn(),this._failureCB=t||o.default.newEmptyFn(),this._context=a,this._run()}execute(e){this._successCB=e,this._failureCB=e,this._run()}getBatchID(){return this._batchID}_ensureGroup(e){var t=!1;return this._batchedRequests[e]||(this._batchedRequests[e]={size:0,batch:this._createBatchInternal()},t=!0),t}_addRequestToGroup(e,t,a){var i=this._getGroupBatch(e),r=this._getGroupSize(e);try{o.default.PAssert(740,r<=l.a.MaxBatchSize,"Too many requests for a single batch")}catch(s){o.default.reportError(s)}t?i.add(a,{id:t}):i.add(a)}_getGroupBatch(e){try{o.default.PAssert(741,this._batchedRequests[e],"Must ensure before querying")}catch(t){o.default.reportError(t)}return this._batchedRequests[e].batch}_getGroupSize(e){try{o.default.PAssert(742,this._batchedRequests[e],"Must ensure before querying")}catch(t){o.default.reportError(t)}return this._batchedRequests[e].size}_run(){try{o.default.PAssert(743,!this._hasRun,"Should never run a batch twice")}catch(t){o.default.reportError(t)}for(var e in this._hasRun=!0,this._batchedRequests){this._getGroupBatch(e).then(this._handleSuccess,this._handleFailure)}}_createBatchInternal(){return new this._batchConstructor(this._batchParams)}_handleSuccess(e){try{o.default.PAssert(744,this._hasRun,"Must run batch before success")}catch(t){o.default.reportError(t)}this._successCB.call(this._context,e)}_handleFailure(e){try{o.default.PAssert(745,this._hasRun,"Must run batch before failure")}catch(t){o.default.reportError(t)}this._failureCB.call(this._context,e)}},s()(i.prototype,"_handleSuccess",[n.a],Object.getOwnPropertyDescriptor(i.prototype,"_handleSuccess"),i.prototype),s()(i.prototype,"_handleFailure",[n.a],Object.getOwnPropertyDescriptor(i.prototype,"_handleFailure"),i.prototype),i);var h=class{constructor(){this._data={gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},export:{path:"/drive/v2/files/{fileId}/export",method:"GET",packedFn:["gapi","client","drive","files","export"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}},realtime:{get:{path:"/drive/v2/files/{fileId}/realtime",method:"GET",packedFn:["gapi","client","drive","realtime","get"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},move:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}/move",method:"POST",packedFn:["gapi","client","calendar","events","move"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}}fns(e){return this._data.gapi.client[e]}_iterateAPI(e,t){if(o.default.isString(e.path))e.packedFn||(o.default.log("WARNING: Missing Pre-Packed Fn: [ '"+t.join("', '")+"' ]"),e.packedFn=t.slice(0));else for(var a in e)o.default.isObject(e[a])&&(t.push(a),this._iterateAPI(e[a],t),t.pop())}_constructPath(e,t){var a=o.default.clone(t);return Object.keys(t).forEach(i=>{var r=new RegExp("\\{"+i+"\\}"),s=e.replace(r,encodeURIComponent(t[i]));s!==e&&delete a[i],e=s}),delete a.resource,delete a.timeoutMS,delete a.forceNoDupe,{path:e,fields:a}}_constructHeaders(e,t,a){try{o.default.PAssert(853,t||a,"Must have either accountID or token")}catch(r){o.default.reportError(r)}try{o.default.PAssert(854,a||o.default.isDemoMode(),"Should have a token at this point")}catch(r){o.default.reportError(r)}var i={Authorization:a?"Bearer "+a.access_token:void 0};return e&&Object.keys(e).forEach(t=>{i[t]=e[t]}),i}canConstruct(e){var t=!1;return o.default.isFunction(e)||(t=!!o.default.unpackFn(e,this._data)),t}createRequest(e,t,a,i){var r,s=o.default.unpackFn(t,this._data);try{o.default.PAssert(855,s,"Function should always be unpackable")}catch(h){o.default.reportError(h)}if(s){var n=this._constructPath(s.path,a),l=this._constructHeaders(s.headers,e,i),d={path:n.path,method:s.method||"GET",params:n.fields,body:a.resource,headers:l};o.default.isDemoMode()&&(d.__packedFn=t,d.__rawParams=a),r=this._sendRequest(d)}return r}getAPIForRequest(e){try{o.default.PAssert(856,o.default.isDemoMode(),"Must only reverse the path in demo mode")}catch(t){o.default.reportError(t)}return o.default.unpackFn(e.__packedFn)}};t.a=new class extends h{_sendRequest(e){let t;try{o.default.PAssert(623,window.gapi&&window.gapi.client,"Trying to make a request with no gapi")}catch(a){o.default.reportError(a)}return window.gapi&&window.gapi.client&&(t=window.gapi.client.request(e)),t}createBatch(e){return new d(window.gapi.client.newBatch,e)}}},25:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(3),l=a(66),d=a(9),h=a(32),c=a(8);let u=(i=class extends l.a{constructor(){super(),this.selected={},this.numSelected=new d.a(0),this._queueRemoveEditables=[]}_selectedObjForPane(e){try{n.default.PAssert(579,e,"Multiselect should always pass in a pane")}catch(a){n.default.reportError(a)}e=e||n.default.focusedPane;var t=this.selected[e.id];return t||(t=this.selected[e.id]={arr:new h.a,isInverted:!1}),t}_selectedForPaneObs(e){return this._selectedObjForPane(e).arr}_selectedForPane(e){return this._selectedObjForPane(e).arr.get()}onChanged(e){this.numSelected.set(this.numSelectedInPane(e))}isInverted(e){return this._selectedObjForPane(e).isInverted}setInverted(e,t){this._selectedObjForPane(t).isInverted=e}isSelected(e,t){return this._selectedForPane(t).indexOf(e)>=0}getSelected(e){return this._selectedForPane(e)}getSelectedItems(e,t){for(var a=0,i=this._selectedForPane(e),r=[],s=0;s<i.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=i[s];if(e.numItems()>n){var o=e.itemAtIndex(n);!o||!t&&o.isNote()||r.push(o)}}return r}numSelectedInPane(e){for(var t=0,a=0,i=this._selectedForPane(e),r=0;r<i.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e.itemAtIndex(i[r]);!s||s.isNote&&s.isNote()||a++}return a}getFirstSelectedIndex(e){var t=0;e=e||n.default.focusedPane;for(var a=this._selectedForPane(e),i=Number.MAX_VALUE,r=!1,s=0;s<a.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=a[s];o<i&&(i=o,r=!0)}return r?i:-1}getFirstSelectedItem(e){e=e||n.default.focusedPane;var t=this.getFirstSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}getLastSelectedIndex(e){var t=0;e=e||n.default.focusedPane;for(var a=this._selectedForPane(e),i=-1,r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[r];s>i&&(i=s)}return i}getLastSelectedItem(e){e=e||n.default.focusedPane;var t=this.getLastSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}_resetPaneID(e){var t=o.default.PaneManager,a=!0;if(t.isPaneActive(e)){var i=t.getPaneById(e);i.canResetMultiselect()?(this.setSelected([],i),this.selected[e].isInverted=!1):a=!1}else delete this.selected[e];return a}reset(e){var t=!0;if(e)e.canResetMultiselect()?this._resetPaneID(e.id):t=!1;else for(var a in this.selected)this.selected.hasOwnProperty(a)&&(t=t&&this._resetPaneID(a));t&&this.fireEvent("reset",[e])}clearEditables(e){for(var t=0,a=this.getSelectedItems(e),i=1===a.length?a[0]:void 0,r=0;r<this._queueRemoveEditables.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=this._queueRemoveEditables[r];s!==i&&(s.isEditable.set(!1),s.itemChanged.notify())}this._queueRemoveEditables=[]}setSelected(e,t,a){var i=0;t=t||n.default.focusedPane;var r=this._selectedForPane(t),s=n.default.arrayDiff(r,e);this.setInverted(!1,t),this._selectedForPaneObs(t).set(e);for(var o=0;o<s.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=s[o];if(l<t.numItems()){var d=t.itemAtIndex(l);if(d)d.itemChanged.notify()}}}toggleSelected(e,t,a){t=t||n.default.focusedPane;var i=this._selectedForPaneObs(t),r=t.itemAtIndex(e),s=i.indexOf(e);s>=0&&!0!==a?(i.remove(e),r.itemChanged.notify()):s<0&&!1!==a&&(i.push(e),r.itemChanged.notify())}addSelected(e,t){this.toggleSelected(e,t,!0)}removeSelected(e,t){this.toggleSelected(e,t,!1)}selectInOrder(e,t,a){var i=0;a=a||n.default.focusedPane;for(var r=[],s=e;s<=t;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r.push(s)}this.setSelected(r,a)}applyFnToSelected(e,t){var a=0;o.default.PaneUpdateBatcher.beginUpdateItems(),t=t||n.default.focusedPane;for(var i,r=this.getSelectedItems(t),s=0;s<r.length&&!1!==i;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=e(r[s],s,r.length)}o.default.PaneUpdateBatcher.commitUpdateItems()}},s()(i.prototype,"reset",[c.a],Object.getOwnPropertyDescriptor(i.prototype,"reset"),i.prototype),i);t.a=new u},26:function(e,t,a){"use strict";var i=a(7),r=a.n(i),s=a(0),n=a(1),o=a(3),l=a(9),d=a(40),h=a(13),c=a(97),u=a(32),p=a(8);var g,f=class{constructor(e){this.id=e.id,this.name=new l.a(e.name),this.panes=e.panes,this.index=e.index,this.defaultPanes=e.defaultPanes}getSaveInfo(){let e={id:this.id,name:this.name.get(),index:this.index};return this.panes&&(e.panes=this.panes.map(s.default.cloneWithoutUndefineds)),this.defaultPanes&&(e.defaultPanes=this.defaultPanes.map(s.default.cloneWithoutUndefineds)),e}},m=a(146),v=a(27),y=n.a.TaskViewMode,_=1;let S=(g=class{constructor(){this._isSaving=!1,this._isAdding=!1,this._localState=void 0,this._selectionState=void 0,this._boards=new u.a,this.selectedIndex=new l.a,this.selected=new c.a([this.selectedIndex],()=>this.get()),this.selectedChanged=new d.a}init(){this.load()}setIsAdding(e){this._isAdding=e}isAdding(){return this._isAdding}add(e){this.setIsAdding(!0);var t=new f({id:this.getNextID(),name:this.getNextName(),panes:e||[],index:""+this._boards.length()});return this._boards.push(t),this.saveBoard(t),t}removeBoard(e){if(this._boards.length()>1){var t=this._boards.indexOf(e),a=this.selectedIndex.get();this._boards.remove(e),!isNaN(a)&&a>=t&&this.setSelectedIndex(a-1),h.a.deleteBoard(e.id),this._localState&&delete this._localState[e.id]}}length(){return this._boards.length()}ensureSelected(){{let e=this.selectedIndex.get();(void 0===e||e<0||e>=this.length())&&this.setSelectedIndex(0,!0),o.default.PaneManager.updateDisplayPanes()}}setSelectedIndex(e,t){var a=e!==this.selectedIndex.get();this.selectedIndex.set(e),(t||!1!==t&&a)&&this.selectedChanged.notify(),this._selectionState!==e&&(this._selectionState=e,o.default.settings.selectedBoard.set(this._selectionState))}switchTo(e,t){var a=this._boards.indexOf(e);this.setSelectedIndex(a,t)}_findMatchingLocalPane(e,t){var a;if(t)for(var i=0,r=0;r<t.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t[r].id===e){a=t[r];break}}return a}_generateUsablePaneState(e,t){for(var a=0,i=[],r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e[r],o=this._findMatchingLocalPane(n.id,t)||n;i.push(s.default.cloneWithoutUndefineds({id:n.id,name:n.name,item:n.item,document:n.document||h.a.getDefaultDocument().id,type:n.type,showarch:n.showarch,search:n.search,viewState:n.viewState||(n.viewMode?{viewMode:n.viewMode}:void 0),displayLocalItems:n.displayLocalItems,displayCalendars:n.displayCalendars,blocksCollapsed:n.blocksCollapsed,documentSortMode:n.documentSortMode,widthManual:n.widthManual,widthManualExpanded:n.widthManualExpanded,offset:o?o.offset:0,itemState:o?o.itemState:{},isOverviewVisible:!!o&&o.isOverviewVisible,isOverviewShowingContents:!!o&&o.isOverviewShowingContents,isExpanded:!!o&&o.isExpanded,selectedItem:o?o.selectedItem:void 0}))}return i}hasLoadedPaneState(){return!!this._localState}getPaneState(){var e=this.get();return e?this._generateUsablePaneState(e.panes||[],this._localState[e.id]):[]}_generateSyncPaneState(e){for(var t=0,a=[],i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[i];a.push({id:r.id,name:r.name,item:r.item,type:r.type,document:r.document,showarch:r.showarch,search:r.search,viewState:r.viewState,displayCalendars:r.displayCalendars,displayLocalItems:r.displayLocalItems,widthManual:r.widthManual,widthManualExpanded:r.widthManualExpanded,blocksCollapsed:r.blocksCollapsed,documentSortMode:r.documentSortMode})}return a}_generateLocalPaneState(e){for(var t=0,a=[],i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[i];a.push({id:r.id,offset:r.offset,itemState:r.itemState,isOverviewVisible:r.isOverviewVisible,isOverviewShowingContents:r.isOverviewShowingContents,isExpanded:r.isExpanded,selectedItem:r.selectedItem})}return a}savePaneState(e){if(this._boards.length()>0)try{this._saveSyncState(e),this._saveLocalState(e),this.saveBoard()}catch(t){s.default.reportError(t,{numBoards:this._boards.length(),selectedIndex:this.selectedIndex.get()})}}_saveLocalState(e){var t=this.get().id;try{s.default.PAssert(144,t,"Must have a valid board ID")}catch(i){s.default.reportError(i)}var a=this._generateLocalPaneState(e);s.default.deepEqual(a,this._localState[t])||(this._localState=s.default.clone(this._localState),this._localState[t]=a)}_saveSyncState(e){var t=this.get();try{s.default.PAssert(145,t,"Selected board does not exist")}catch(a){s.default.reportError(a)}t&&(t.panes=this._generateSyncPaneState(e))}renameBoard(e,t){if(e.name.get()!==t){var a=0;let i=!1;for(let r=0;r<this._boards.length();r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let s=this._boards.get()[r];s!==e&&s.name.get()===t&&(i=!0)}if(!i)return e.name.set(t),this.saveBoard(e),this.selected.notify(),!0}return!1}saveBoardDefault(e){e.defaultPanes=s.default.clone(e.panes),this.saveBoard(e)}restoreBoardDefault(e){e.panes=s.default.clone(e.defaultPanes),this.selectedChanged.notify()}get(){var e=this.selectedIndex.get();if(void 0!==e)return this._boards.get()[e]}createDefaultState(){if(0===this._boards.length()){let e=h.a.getDefaultDocument(),t=[];if(e){let a=e.getRootItem();t=[new f({id:h.a.generateID(),name:"Tasks",index:"0",panes:[{document:e.id,item:a.id,type:n.a.PaneMode.Task,viewState:{viewMode:y.Outline},isOverviewVisible:!0}]}),new f({id:h.a.generateID(),name:"Today",index:"1",panes:[{document:e.id,item:a.id,type:n.a.PaneMode.Task,viewState:{viewMode:y.Agenda_Today},isOverviewVisible:!0}]}),new f({id:h.a.generateID(),name:"Calendar",index:"2",panes:[{document:e.id,item:a.id,type:n.a.PaneMode.Task,viewState:{viewMode:y.Calendar_Week}}]})],o.default.pluginManager.isEnabled(n.a.PluginID.Gmail)&&t.splice(2,0,new f({id:h.a.generateID(),name:"Email",index:"1,0",panes:[{type:n.a.PaneMode.Gmail,isOverviewVisible:!0,isExpanded:!0}]}))}return this._boards.set(t),this.saveAll(),this.setSelectedIndex(0,!0),t}}getNextName(){var e,t,a=0,i=this._boards.get(),r=1;do{var s=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=!1,t="Board "+r,r++;for(var n=0;n<i.length;n++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(i[n].name.get()===t){e=!0;break}}}while(e);return t}getNextID(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++_}load(){var e,t;if(s.default.isDemoMode())t=this.createDefaultState(),e={};else if(this.trackPaneState()){let i=h.a.getBoards();(t=Object.keys(i).map(e=>new f(i[e]))).sort(v.a.compareItemIndex);try{e=o.default.settings.localPaneState.get()||{}}catch(a){e={}}}else e={};this._localState=e,t&&t.length>0&&(this._selectionState=o.default.settings.selectedBoard.get(),void 0===this._selectionState&&(this._selectionState=0),!isNaN(this._selectionState)&&this._selectionState>=t.length&&(this._selectionState=t.length-1),this._boards.set(t),this.setSelectedIndex(this._selectionState,!0))}setBoards(e){this._boards.set(e),this.ensureSelected()}saveAll(){this.trackPaneState()&&this._boards.get().forEach(e=>{this.saveBoard(e)})}saveBoard(e){if(this.trackPaneState()&&(e||(e=this.get()),e)){let t=e.getSaveInfo();h.a.saveBoard(t),o.default.settings.localPaneState.set(s.default.cloneWithoutUndefineds(this._localState))}}trackPaneState(){return!s.default.isRunningScript()&&!s.default.isDemoMode()}onSettingChanged(){this._isSaving||this.load()}moveTo(e,t){var a=this._boards.get(),i=a[e],r=this.get();this._boards.splice(e,1,void 0,!1);let s=a[t-1],n=a[t],o=Object(m.a)(s?s.index:void 0,n?n.index:void 0);i.index=o,this._boards.splice(t,0,i);var l=this._boards.indexOf(r);l>=0&&this.setSelectedIndex(l,!1),this.saveBoard(i)}cloneBoard(e,t){var a;(e=e||this.get(),t)?a=[t.getSaveInfoForClone()]:a=e.panes;try{s.default.PAssert(146,a,"Must have valid panes to clone a board")}catch(r){s.default.reportError(r)}var i=this.add(a);return this.switchTo(i),i}getById(e){return this._boards.get().find(t=>t.id===e)}onRemoteUpdate(e,{id:t,name:a,panes:i,index:r,defaultPanes:o}){let l=this.getById(t),d=this.get();if(e===n.a.CrudActions.Removed)l&&this.removeBoard(l);else if(l){let e=l.index!==r||!l.panes.equals(i,!0);try{l.name.set(a),l.index=r,l.panes=i,l.defaultPanes=o,e&&(this._boards.sort(v.a.compareItemIndex),this.switchTo(d,l===d))}catch(h){s.default.reportError(h,l.name)}}else this._boards.insertSorted(new f({id:t,name:a,panes:i,index:r,defaultPanes:o}),v.a.compareItemIndex),this.switchTo(d)}hotkeyPrevBoard(){var e=this.selectedIndex.get()-1;e<0&&(e=this.length()-1),this.setSelectedIndex(e)}hotkeyNextBoard(){var e=this.selectedIndex.get()+1;e>=this.length()&&(e=0),this.setSelectedIndex(e)}selectBoard(e){e>=0&&e<this.length()&&this.setSelectedIndex(e)}clear(){this._boards.clear()}},r()(g.prototype,"saveAll",[p.a],Object.getOwnPropertyDescriptor(g.prototype,"saveAll"),g.prototype),r()(g.prototype,"saveBoard",[p.a],Object.getOwnPropertyDescriptor(g.prototype,"saveBoard"),g.prototype),r()(g.prototype,"hotkeyPrevBoard",[p.a],Object.getOwnPropertyDescriptor(g.prototype,"hotkeyPrevBoard"),g.prototype),r()(g.prototype,"hotkeyNextBoard",[p.a],Object.getOwnPropertyDescriptor(g.prototype,"hotkeyNextBoard"),g.prototype),r()(g.prototype,"selectBoard",[p.a],Object.getOwnPropertyDescriptor(g.prototype,"selectBoard"),g.prototype),g);t.a=new S},27:function(e,t,a){"use strict";const i=e=>{var t={};return Object.keys(e).forEach(a=>{t[e[a]]=a}),t},r=e=>"string"===typeof e;let s={billingID:"b",displayName:"n",gid:"g",earlyAdopter:"x",email:"e",fname:"f",lname:"l",inviteCode:"i",invoiceAddress:"a",invoiceCompany:"c",invoiceEmail:"d",joinDate:"j",monthlyInvoice:"m",nextBillingDate:"o",planID:"h",picture:"p",premiumCode:"k",premiumSignupDate:"q",premiumEndDate:"r",premiumStatus:"s",subscriptionID:"v",trialDuration:"u",trialExtended:"w",trialStart:"t",isUnsubscribed:"y"},n=i(s),o={items:!0},l={dateCreated:"c",dateCompleted:"e",dateModified:"d",date:"b",flags:"f",id:"id",index:"i",isArchived:"r",isDeleted:"x",note:"n",parent:"p",pendingSync:"m",text:"t",docId:"o",isRoot:"q"},d=i(l),h={id:"id",text:"t",emails:"e",phoneNumbers:"p"},c=i(h);let u={validateInFields:(e,t)=>!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach(e=>{if(e.length<2||"undefined"===e)return!1}),!0),validateOutFields:(e,t)=>!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach(e=>{if(e.length>2||"undefined"===e)return!1}),!0),itemFieldMapIn:d,itemFieldMapOut:l,documentIn:e=>({id:e.id,acl:e.a,dateModified:e.p.d,text:e.p.t,encryptionSentinel:e.p.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c}),documentOut:(e,t)=>{let a={id:e.id,p:{t:e.text}};return e.dateModified&&(a.p.d=e.dateModified),e.encryptionSentinel&&(a.p.s=e.encryptionSentinel),t&&t.onlyUpdate||(a.a=e.acl,a.r=e.root,a.v=e.version),t&&t.forLocal&&e.pendingSync&&(a.m=e.pendingSync),a},documentInFlat:(e,t)=>({id:e.id,acl:e.a,dateModified:e.d,text:e.t,encryptionSentinel:e.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c}),documentOutFlat:(e,t)=>{let a={id:e.id,d:e.dateModified,t:e.text};return e.encryptionSentinel&&(a.s=e.encryptionSentinel),t||(a.a=e.acl,a.r=e.root,a.v=e.version),e.pendingSync&&(a.m=e.pendingSync),a},userIn:e=>{let t={};return Object.keys(e).forEach(a=>{n[a]&&"undefined"!==n[a]&&(t[n[a]]=e[a])}),t},userOut:e=>{let t={};return Object.keys(e).forEach(a=>{s[a]&&void 0!==s[a]&&"undefined"!==s[a]&&(t[s[a]]=e[a])}),t},itemIn:e=>{let t={};return Object.keys(e).forEach(a=>{d[a]&&"undefined"!==d[a]&&(t[d[a]]=e[a])}),t},itemOut:e=>{let t={};return Object.keys(e).forEach(a=>{void 0!==e[a]&&!o[a]&&l[a]&&"undefined"!==l[a]&&(t[l[a]]=e[a])}),t},decryptItem:(e,t,a)=>e.text?t.decryptText(a,e.text,e.id).then(t=>(e.text=t,e)):Promise.resolve(e),encryptItem:(e,t,a)=>e.text?t.encryptText(a,e.text,e.id).then(t=>(e.text=t,e)):Promise.resolve(e),encryptItemOut:(e,t,a)=>u.encryptItem(e,t,a).then(e=>u.itemOut(e)),decryptItemIn:(e,t,a)=>(e=u.itemIn(e),u.decryptItem(e,t,a)),boardIn:e=>{let t=Object.assign({},e);return r(e.panes)&&(t.panes=JSON.parse(e.panes)),r(e.defaultPanes)&&(t.defaultPanes=JSON.parse(e.defaultPanes)),t},boardOut:e=>{let t=Object.assign({},e);return e.panes&&(t.panes=JSON.stringify(e.panes)),e.defaultPanes&&(t.defaultPanes=JSON.stringify(e.defaultPanes)),t},compareItemIndex:(e,t)=>{var a=0;let i=null!==e.index?e.index:0,r=null!==t.index?t.index:0;if(void 0===i||void 0===r)return 0;"number"===typeof i&&(i=""+i),"number"===typeof r&&(r=""+r);let s=i.split(","),n=r.split(",");for(var o=0;o<s.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(void 0===n[o])return 1;let e=+s[o],t=+n[o];if(e!==t)return e-t}return-1},contactIn:e=>{if(e.t){let t={};return Object.keys(e).forEach(a=>{c[a]&&"undefined"!==c[a]&&(t[c[a]]=e[a])}),t}return e},contactOut:e=>{let t={};return Object.keys(e).forEach(a=>{h[a]&&void 0!==h[a]&&"undefined"!==h[a]&&(t[h[a]]=e[a])}),t}};t.a=u},3:function(e,t,a){"use strict";a.r(t);var i=a(0),r=a(1),s=a(181),n=a(17),o=a(13);var l,d=/([\s]|^)(\d{1,2})[-\/.](\d{1,2})(?:[-\/.](\d{2,4}))?/g,h=/([\s]|^)(?:(\d{2,4})[-\/.])?(\d{1,2})(?:[-\/.](\d{1,2}))/g,c=class{constructor(){this._localized=[],this._loadedDateFormat=void 0}init(){var e=Wr.settings.dateFormat.get()||r.a.DateFormat.MDY;this._loadLocalized(e),Wr.settings.dateFormat.listen(e=>{this._loadLocalized(e||r.a.DateFormat.MDY),o.a.parseAll(r.a.ChangeType.Auto),n.a.fireEvent("clearMeasureCacheAll",[]),Wr.PaneUpdateBatcher.updateAllItems(!1,!0)})}parseDate(e,t){return Date.parse(this.normalizeDateString(e,t))}parseDateDefaultFormat(e){return Date.parse(this.normalizeDateString(e,this.getCurrentDateFormat()))}getFormat(e){try{i.default.PAssert(355,this._localized[e],"Invalid format request")}catch(t){i.default.reportError(t)}return this._localized[e]}getCurrentDateFormat(){return this._loadedDateFormat||r.a.DateFormat.MDY}_loadLocalized(e){if(this._loadedDateFormat=e,this._localized[r.a.DFormat.LongDayTime]="dddd h:mm tt",this._localized[r.a.DFormat.ShortTime]="h:mm tt",this._localized[r.a.DFormat.MonthDay]="MMM d",this._localized[r.a.DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[r.a.DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[r.a.DFormat.MonthDayLong]="MMMM d",this._localized[r.a.DFormat.MonthDayYearLong]="MMMM d, yyyy",e===r.a.DateFormat.MDY)this._localized[r.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[r.a.DFormat.ShortDate]="MM/dd",this._localized[r.a.DFormat.MonthDayYear]="MM/dd/yy",this._localized[r.a.DFormat.MonthDayYearShort]="M/d/yy",this._localized[r.a.DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[r.a.DFormat.DayDate]="ddd M/d",this._localized[r.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[r.a.DFormat.MonthDayShort]="M/d";else if(e===r.a.DateFormat.DMY)this._localized[r.a.DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[r.a.DFormat.ShortDate]="dd/MM",this._localized[r.a.DFormat.MonthDayYear]="dd/MM/yy",this._localized[r.a.DFormat.MonthDayYearShort]="d/M/yy",this._localized[r.a.DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[r.a.DFormat.DayDate]="ddd d/M",this._localized[r.a.DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[r.a.DFormat.MonthDayShort]="d/M";else if(e===r.a.DateFormat.DMYDot)this._localized[r.a.DFormat.ShortDayTime]="dd.MM h:mm tt",this._localized[r.a.DFormat.ShortDate]="dd.MM",this._localized[r.a.DFormat.MonthDayYear]="dd.MM.yy",this._localized[r.a.DFormat.MonthDayYearShort]="d.M.yy",this._localized[r.a.DFormat.DayYearTime]="dd.MM.yy h:mm tt",this._localized[r.a.DFormat.DayDate]="ddd d.M",this._localized[r.a.DFormat.NoPadShortDayTime]="dd.M h:mm tt",this._localized[r.a.DFormat.MonthDayShort]="d.M";else if(e===r.a.DateFormat.YMD)this._localized[r.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[r.a.DFormat.ShortDate]="MM/dd",this._localized[r.a.DFormat.MonthDayYear]="yy/MM/dd",this._localized[r.a.DFormat.MonthDayYearShort]="yy/M/d",this._localized[r.a.DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[r.a.DFormat.DayDate]="ddd M/d",this._localized[r.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[r.a.DFormat.MonthDayShort]="M/d";else if(e===r.a.DateFormat.YMDDot)this._localized[r.a.DFormat.ShortDayTime]="MM.dd h:mm tt",this._localized[r.a.DFormat.ShortDate]="MM.dd",this._localized[r.a.DFormat.MonthDayYear]="yy.MM.dd",this._localized[r.a.DFormat.MonthDayYearShort]="yy.M.d",this._localized[r.a.DFormat.DayYearTime]="yy.MM.dd h:mm tt",this._localized[r.a.DFormat.DayDate]="ddd M.d",this._localized[r.a.DFormat.NoPadShortDayTime]="M.dd h:mm tt",this._localized[r.a.DFormat.MonthDayShort]="M.d";else try{i.default.PAssert(356,!1,"Unsupport date format requested: "+e)}catch(t){i.default.reportError(t)}}formatDate(e,t,a){try{i.default.PAssert(357,i.default.isDateValid(e),"Must provide a valid date to format")}catch(n){i.default.reportError(n)}try{i.default.PAssert(358,t,"Must provide a valid format for the date")}catch(n){i.default.reportError(n)}var r;if(i.default.isDateValid(e)){var s=e.toString(this.getFormat(t));r=a&&a!==this._loadedDateFormat?this.convertDateFormat(s,this._loadedDateFormat,a):s}return r}_isParsedDateValid(e,t,a){var r=!0,s=i.default.parseInt(e),n=i.default.parseInt(t),o=i.default.parseInt(a);return void 0!==e&&s<13?r=!1:n<=0||n>12?r=!1:(o<=0||o>31)&&(r=!1),r}_detectDelim(e){var t="/";return e.indexOf("-")>=0?t="-":e.indexOf(".")>=0&&(t="."),t}convertDateFormat(e,t,a){try{i.default.PAssert(359,t,"Must provide a date format to convert from")}catch(m){i.default.reportError(m)}try{i.default.PAssert(360,a,"Must provide a date format to convert to")}catch(m){i.default.reportError(m)}var s=e;if(t!==a){var n,o,l=0;for(h.lastIndex=0,d.lastIndex=0,n=t===r.a.DateFormat.YMD||t===r.a.DateFormat.YMDDot?h:d;null!==(o=n.exec(s));){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var c,u,p,g,f=this._detectDelim(s);if(t===r.a.DateFormat.DMYDot?t=r.a.DateFormat.DMY:t===r.a.DateFormat.YMDDot&&(t=r.a.DateFormat.YMD),a===r.a.DateFormat.MDY)switch(t){case r.a.DateFormat.DMY:o[4]?(u=o[4],c=(p=o[3])+f+(g=o[2])+f+u):o[2]&&o[3]&&(c=(p=o[3])+f+(g=o[2]));break;case r.a.DateFormat.YMD:o[2]?(u=o[2],c=(p=o[3])+f+(g=o[4])+f+u):o[3]&&o[4]&&(c=(p=o[3])+f+(g=o[4]));break;default:try{i.default.PAssert(361,!1,"Invalid date format requested from MDY: ",t)}catch(m){i.default.reportError(m)}}else if(a===r.a.DateFormat.DMY)switch(t){case r.a.DateFormat.MDY:o[4]?(u=o[4],p=o[2],c=(g=o[3])+f+p+f+u):o[2]&&o[3]&&(p=o[2],c=(g=o[3])+f+p);break;case r.a.DateFormat.YMD:o[2]?(u=o[2],p=o[3],c=(g=o[4])+f+p+f+u):o[3]&&o[4]&&(p=o[3],c=(g=o[4])+f+p);break;default:try{i.default.PAssert(362,!1,"Invalid date format requested from DMY: ",t)}catch(m){i.default.reportError(m)}}else if(a===r.a.DateFormat.YMD)switch(t){case r.a.DateFormat.MDY:o[4]?c=(u=o[4])+f+(p=o[2])+f+(g=o[3]):o[2]&&o[3]&&(c=(p=o[2])+f+(g=o[3]));break;case r.a.DateFormat.DMY:o[4]?c=(u=o[4])+f+(p=o[3])+f+(g=o[2]):o[2]&&o[3]&&(c=(p=o[3])+f+(g=o[2]));break;default:try{i.default.PAssert(363,!1,"Invalid date format requested from YMD: ",t)}catch(m){i.default.reportError(m)}}else try{i.default.PAssert(364,!1,"Invalid date format requested: ",a)}catch(m){i.default.reportError(m)}c&&this._isParsedDateValid(u,p,g)&&(s=s.substr(0,o.index)+o[1]+c+s.substr(o.index+o[0].length))}}return s}normalizeDateString(e,t){var a=e;return this.convertDateFormat(a,t,r.a.DateFormat.MDY)}getAppendDateText(e,t,a){var s,n=Date.today();s=e<n||e.getFullYear()!==n.getFullYear()?this.getFormat(r.a.DFormat.MonthDayYearShort):this.getFormat(r.a.DFormat.MonthDayShort);var o=e.toString(s);if(t instanceof Date)s=0===t.getMinutes()?" htt":" h:mmtt",o+=t.toString(s);else if(i.default.isNumber(t)){var l=Math.floor(t),d=l%12;0===d&&(d=12),o+=" "+d+":"+i.default.pad2(60*(t-l))+(l>11?"pm":"am")}return isNaN(a)||(o+=" "+i.default.round(a,2)+"hr"),o}},u=a(7),p=a.n(u),g=a(66),f=a(8);var m=(l=class extends g.a{constructor(){super(),this.styles={},this.stylesheet={},this.Themes={SpacingCompact:{itemLineHeight:18,itemPadding:3,itemIndentSize:20,fontSizeHeader:16,fontSizeHeaderTopLevel:16},SpacingComfortable:{itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSizeHeader:16,fontSizeHeaderTopLevel:18},PrefixesFaded:{projectOpacity:30,bulletOpacity:30,checkboxOpacity:25,checkboxBackgroundOpacity:0},PrefixesStrong:{projectOpacity:80,bulletOpacity:80,checkboxOpacity:80,checkboxBackgroundOpacity:20}},this.Defaults={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,boldHeaders:!1,fontSize:14,showVerticalLines:!0,verticalLinesOpacity:6,Colors:{light:{bulletColor:"#222222",projectColor:"#222222",verticalLinesColor:32,tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{bulletColor:"#F6F6F6",projectColor:"#F6F6F6",verticalLinesColor:255,tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}},this.timeoutSettingChanged=void 0}init(){this.updateSettingValues(),Wr.settings.ui.listen(this.onSettingChanged),this.updateStyles()}getSettingValue(e,t=!1){var a=Wr.settings.ui[e].get();return a===this.Defaults.Desktop.Colors.light[e]?this.Defaults.Desktop.Colors[this._colorTheme][e]:a}getThemeValue(e){var t=this.Themes.SpacingComfortable[e];return void 0===t&&(t=this.Themes.PrefixesFaded[e]),void 0===t&&(t=this.Defaults.Desktop[e]),void 0===t&&(t=this.Defaults.Desktop.Colors[this._colorTheme][e]),t}setFromThemeValue(e,t){Wr.settings.ui[t].set(this.getThemeValue(t))}updateSettingValues(){this._colorTheme=Wr.settings.ui.theme.get()||"Light",this._bulletColor=this.Defaults.Desktop.Colors[this._colorTheme].bulletColor,this._projectColor=this.Defaults.Desktop.Colors[this._colorTheme].projectColor,this._verticalLinesColor=this.Defaults.Desktop.Colors[this._colorTheme].verticalLinesColor,this._boldHeaders=this.getSettingValue(r.a.DisplaySettings.boldHeaders),this._showVerticalLines=this.getSettingValue(r.a.DisplaySettings.showVerticalLines),this._fontSize=this.getSettingValue(r.a.DisplaySettings.fontSize,!0),this._fontSizeHeader=this.getSettingValue(r.a.DisplaySettings.fontSizeHeader,!0),this._fontSizeHeaderTopLevel=this.getSettingValue(r.a.DisplaySettings.fontSizeHeaderTopLevel,!0),this._noteFontSize=this.getSettingValue(r.a.DisplaySettings.noteFontSize,!0),this._itemPadding=this.getSettingValue(r.a.DisplaySettings.itemPadding,!0),this._notePadding=this.getSettingValue(r.a.DisplaySettings.notePadding,!0),this._itemLineHeight=this.getSettingValue(r.a.DisplaySettings.itemLineHeight,!0),this._noteLineHeight=this.Defaults.Desktop.noteLineHeight,this._itemIndentSize=this.getSettingValue(r.a.DisplaySettings.itemIndentSize,!0),this._bulletOpacity=this.getSettingValue(r.a.DisplaySettings.bulletOpacity,!0),this._projectOpacity=this.getSettingValue(r.a.DisplaySettings.projectOpacity,!0),this._checkboxOpacity=this.getSettingValue(r.a.DisplaySettings.checkboxOpacity,!0),this._checkboxBackgroundOpacity=this.getSettingValue(r.a.DisplaySettings.checkboxBackgroundOpacity,!0),this._verticalLinesOpacity=this.getSettingValue(r.a.DisplaySettings.verticalLinesOpacity,!0),this._tagColor=this.getSettingValue(r.a.DisplaySettings.tagColor,!0),this._dateColor=this.getSettingValue(r.a.DisplaySettings.dateColor,!0),this._contactColor=this.getSettingValue(r.a.DisplaySettings.contactColor,!0),this._linkColor=this.getSettingValue(r.a.DisplaySettings.linkColor,!0),this._grayscale=this.getSettingValue(r.a.DisplaySettings.grayscale)}onSettingChanged(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))}_updateSettings(){var e=this._fontSize,t=this._fontSizeHeader,a=this._fontSizeHeaderTopLevel,i=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var r=this._fontSize!==e||this._fontSizeHeader!==t||this._fontSizeHeaderTopLevel!==a||this._noteFontSize!==i;this.fireEvent("settingsChanged",[r]),Wr.PaneManager&&Wr.PaneManager.clearPaneCaches(),this.updateStyles(),Wr.PaneUpdateBatcher.updateAllItems(!1,!0)}fontSize(){return this._fontSize}fontSizeHeader(){return this._fontSizeHeader}fontSizeHeaderTopLevel(){return this._fontSizeHeaderTopLevel}fontSizeHeaderProjectView(){return 17}noteFontSize(){return this._noteFontSize}itemPadding(){return this._itemPadding}notePadding(){return this._notePadding}itemLineHeight(){return this._itemLineHeight}noteLineHeight(){return this._noteLineHeight}itemIndentSize(){return this._itemIndentSize}itemIndentStart(){return 45}paddingForBlockHeader(){return 0}paddingForItemBottom(e,t,a){return t.hasNote()?a&&a.isViewProject()&&a.isItemTopLevel(e,t)?this.itemPadding():0:this.itemPadding()}paddingForItemTop(e,t){return t.isNote()?this.notePadding():this.itemPadding()}fontSizeForItem(e,t,a){if(t.isPrefixHeader()){if(a.isItemTopLevel(e,t))return this.fontSizeHeaderTopLevel();if(a.isViewOutline())return this.fontSizeHeader()}else if(t.isNote())return this.noteFontSize();return this.fontSize()}lineHeightForItem(e,t,a){var i=this.itemLineHeight()-this.fontSize();return t.isNote()?this.noteLineHeight():this.fontSizeForItem(e,t,a)+i}boldHeaders(){return this._boldHeaders}createSheet(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.rel="stylesheet",e.appendChild(t),this.sheet=t.sheet}changeColorTheme(e){e!==this._colorTheme&&(this._colorTheme=e,Wr.settings.ui.theme.set(e),this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))}changeTheme(e,t){this.isChangingTheme=!0;var a=this.Themes[t];for(var i in a)a.hasOwnProperty(i)&&Wr.settings.ui[i].set(a[i]);e.set(t),this.isChangingTheme=!1,this._updateSettings()}updateStyles(){var e=0;if(this.sheet){var t=this.sheet.ownerNode;t.parentNode.removeChild(t)}this.createSheet();var a=[];if(this.boldHeaders()&&a.push(".item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var r=this.itemIndentSize(),s=this._verticalLinesColor,n="rgba("+s+","+s+","+s+",",o=n+.01*this._verticalLinesOpacity+")",l=n+"0)";a.push(".vertLines { background: repeating-linear-gradient(to right, "+l+" 0, "+o+" 1px, "+l+" 2px, "+l+" "+r+"px) }")}a.push(".item:not(.hasNote) .line.last .itemPrefix:not(.prefixTask):before { bottom: "+this.itemPadding()+"px; }"),a.push(".item:not(.hasNote) .line.last .prefixTask:before { bottom: "+(this.itemPadding()+(this.itemLineHeight()-18)/2)+"px; }"),a.push(".item .prefixTask:before { margin-top: "+(this.itemLineHeight()-14)/2+"px; }");var d="rgba("+i.default.hexToRgbStr(this._bulletColor)+","+.01*this._bulletOpacity+")";a.push(".prefixBullet:before { color: "+d+"; }");var h="rgba("+i.default.hexToRgbStr(this._projectColor)+","+.01*this._projectOpacity+")";a.push(".prefixHeader:before { color: "+h+"; }"),a.push(".collapser { color: "+d+"; }");var c="rgba("+i.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxOpacity+")";a.push(".prefixTask { border-color: "+c+"; }");var u="rgba("+i.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxBackgroundOpacity+")";a.push(".prefixTask:not(.searchButton):before { background-color: "+u+"; }"),a.push(".c-tag { color: "+this._tagColor+";}"),a.push(".c-date { color: "+this._dateColor+";}"),a.push(".c-contact { color: "+this._contactColor+";}"),a.push(".c-link, .fancyContenteditable a    { color: "+this._linkColor+";}"),a.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+this.Defaults.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }"),Wr.settings.ui.underlineP.get()?i.default.addClass(document.body,"underlineTags"):i.default.removeClass(document.body,"underlineTags"),this._grayscale?i.default.addClass(document.body,"grayscale"):i.default.removeClass(document.body,"grayscale"),i.default.removeClass(document.body,"theme-light"),i.default.removeClass(document.body,"theme-dark"),i.default.addClass(document.body,"theme-"+this._colorTheme);for(var p=0;p<a.length;p++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sheet.insertRule(a[p],0)}}tagColor(){return this._tagColor}dateColor(){return this._dateColor}contactColor(){return this._contactColor}noteColor(){return""}isDark(){return"dark"===this._colorTheme}lineItemHeight(e,t,a,r){return i.default.isNumber(r)&&!t.isNote()||(r=1),this.paddingForItemTop(e,t)+this.paddingForItemBottom(e,t,a)+this.lineHeightForItem(e,t,a)*r}},p()(l.prototype,"onSettingChanged",[f.a],Object.getOwnPropertyDescriptor(l.prototype,"onSettingChanged"),l.prototype),p()(l.prototype,"_updateSettings",[f.a],Object.getOwnPropertyDescriptor(l.prototype,"_updateSettings"),l.prototype),p()(l.prototype,"updateStyles",[f.a],Object.getOwnPropertyDescriptor(l.prototype,"updateStyles"),l.prototype),l),v=a(16),y=a(5),_=a(4),S=a(25),P=a(6),I=a(44),b=a(47),D=a(49),w=a(41),E=a(27),C=a(48),A=a(9),M=a(32),T=a(40);function L(){this._favMap={}}L.prototype={_ensureGroup:function(e){var t=[];return this._favMap[e]||(this._favMap[e]=t),t},notifyAdd:function(e,t){var a=this._ensureGroup(t);try{i.default.PAssert(1149,a.indexOf(e)<0,"Should not double add item to group")}catch(r){i.default.reportError(r)}a.push(e)},notifyRemove:function(e,t){var a=this._ensureGroup(t);try{i.default.PAssert(1150,a.indexOf(e)>=0,"Must have been added to group before removing")}catch(r){i.default.reportError(r)}a.remove(e)},getItems:function(e){return this._favMap[e]},hasItems:function(e){var t=this.getItems(e);return t&&t.length>0}};var x,k=new L,R=a(53),O=new Date(9e12);let F=(x=class e{constructor(e,t){v.a.binder(this,"sizeInPane","onInsertLink"),"dragScroll"in this&&v.a.binder(this,"dragScroll"),this.__ISVMLI=!0,this.isInitialized=!1;try{i.default.PAssert(875,t,"Each VMLI must be given a set of additional info")}catch(s){i.default.reportError(s)}try{i.default.PAssert(876,i.default.isValidChangeType(t.changeType),"Must specify a valid change type when creating a VMLI")}catch(s){i.default.reportError(s)}try{i.default.PAssert(877,t.store,"Must supply a valid itemStore for each VMLI")}catch(s){i.default.reportError(s)}try{i.default.PAssert(878,!t.parent||t.parent._store===t.store,"All VMLIs in a tree must share the same owner")}catch(s){i.default.reportError(s)}this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1;try{i.default.PAssert(879,void 0===e.v,"We should never be passing in 'v'")}catch(s){i.default.reportError(s)}try{i.default.PAssert(880,void 0===e.extern,"We should never be passing in 'extern'")}catch(s){i.default.reportError(s)}try{i.default.PAssert(881,t.store,"Must specify a valid item store this item belongs to")}catch(s){i.default.reportError(s)}this._store=t.store,this._parent=t.parent,this._documentOwner=t.documentOwner,this._rawText=e.text||"",this._searchText=e.text?e.text.toLowerCase():"",this._parsedText=void 0,this._notePreviewText=void 0,this.els=void 0,this.id=void 0,this.index=e.index,this._isArchived=e.isArchived||!1,this.items=new M.a([],this.itemsHasMutated),this._note=void 0,this.itemChanged=new T.a,this._demandLoadChildren=e.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=t.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._attachments=void 0,this.draggedInPane=new A.a;var a=e.flags;e.isNote&&(a|=r.a.VMLIFlag.Note),e.isComplete&&(a|=r.a.VMLIFlag.Complete),e.isStarred&&(a|=r.a.VMLIFlag.Starred),e.priority&&(a|=e.priority),this.flags=new A.a(a),this.prefix=void 0,this._favorites=void 0,this.dateCreated=e.dateCreated?new Date(e.dateCreated):new Date,this.dateCompleted=e.dateCompleted?new Date(e.dateCompleted):void 0,this.dateModified=e.dateModified?new Date(e.dateModified):this.dateCreated,this._activeTags=void 0,this.isRoot=e.isRoot||t.isRoot,this._isDeleted=e.isDeleted||!1,this.highlightTimeout=void 0,this._version=r.a.UninitializedVersion,this._versionText=r.a.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new A.a(t.isEditable||!1),this.levelsDeep=new A.a(this._parent?this._parent.levelsDeep.get()+1:0),this.isHighlighted=new A.a,i.default.totalItems++,e.isArchived&&i.default.totalArchivedItems++,this._needsParse=!1,this.isLoaded=void 0,this.init(e,t),this.isInitialized=!0}getReactKey(){return this._store.id+this.id}notifyDemandLoadUpdate(e,t){e&&!this._loadedOnDemandData&&(t.requestDemandLoadData(this),this.notifyLoadedData())}notifyLoadedData(){this._loadedOnDemandData=!0}notifyLoadDataFailed(e){this.setCollapsed(!1,e,!1),this._loadedOnDemandData=!1}isDemandLoad(){return this._demandLoadChildren}isDemandNotYetLoaded(){return this._demandLoadChildren&&!this._loadedOnDemandData}showInOverview(){return this.numItems()>0||this._demandLoadChildren}paginationTokenInUse(){try{i.default.PAssert(882,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){i.default.reportError(e)}return this._paginationToken.isInUse()}hasPaginationToken(){return!!(this.flags.get()&r.a.VMLIFlag.HasPageToken)}needsPaginationToken(){return!this.hasPaginationToken()&&!this._paginationToken}setPaginationToken(e){try{i.default.PAssert(883,e,"Should never be setting an undefined token - use clear instead")}catch(t){i.default.reportError(t)}try{i.default.PAssert(884,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(t){i.default.reportError(t)}this._paginationToken=e,this.setFlags(this.flags.get()|r.a.VMLIFlag.HasPageToken)}clearPaginationToken(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0,this.setFlags(this.flags.get()&~r.a.VMLIFlag.HasPageToken)}beginDataPageLoad(){try{i.default.PAssert(886,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){i.default.reportError(e)}try{i.default.PAssert(887,!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load")}catch(e){i.default.reportError(e)}return this._paginationToken.notifyBeginUse(),this._paginationToken}endDataPageLoad(e){try{i.default.PAssert(889,this._paginationToken,"Should always have a valid pagination token when done loading a data page")}catch(t){i.default.reportError(t)}try{i.default.PAssert(890,this._paginationToken.isInUse(),"Token should always be in use when running a request")}catch(t){i.default.reportError(t)}e?this._paginationToken.notifyEndUse():this.setFlags(this.flags.get()&~r.a.VMLIFlag.HasPageToken)}notifyPaginationUpdate(){try{i.default.PAssert(891,this._paginationToken,"Must have a valid token to get next page of data")}catch(e){i.default.reportError(e)}this._paginationToken&&i.default.focusedPane.requestDataPage(this)}canHaveNote(){var e=this.belongsToItemStore(Wr.itemStoreManager.getDefaultItemStore()),t=this.belongsToItemStore(Wr.itemStoreManager.getTempItemStore());return e||t}createNote(){try{i.default.PAssert(892,!this.isNote(),"Should never create a note on a note item")}catch(t){i.default.reportError(t)}var e;return this.hasNote()?e=this.getNote():(e=this._store.createItemRaw({id:void 0,text:"",isNote:!0},{parent:this,documentOwner:this._documentOwner,changeType:r.a.ChangeType.AllLocal}),this.setNote(e,r.a.ChangeType.Local)),e}hasNote(){return void 0!==this._note}getNote(){try{i.default.PAssert(893,this.hasNote(),"Must have a note to get one")}catch(e){i.default.reportError(e)}return this._note}setNote(t,a){try{i.default.PAssert(894,i.default.isValidChangeType(a),"Must supply a valid changeType")}catch(s){i.default.reportError(s)}try{i.default.PAssert(895,!t||this.belongsToSameItemStore(t),"Note must belong to the same item store")}catch(s){i.default.reportError(s)}try{i.default.PAssert(896,!this.isNote(),"Should never set a note on a note")}catch(s){i.default.reportError(s)}try{i.default.PAssert(897,!this._note||!t,"Should never set a note multiple times on a single item")}catch(s){i.default.reportError(s)}try{i.default.PAssert(898,!t||t.isNote(),"Should only set items that are notes as notes")}catch(s){i.default.reportError(s)}try{i.default.PAssert(899,!t||!t.isDeleted(),"Should note set a deleted note")}catch(s){i.default.reportError(s)}try{i.default.PAssert(900,!t||t instanceof e,"Note must be a valid VMLI")}catch(s){i.default.reportError(s)}try{i.default.PAssert(901,!t||t.parent()===this,"Should always have a valid parent set before setting note on item")}catch(s){i.default.reportError(s)}var r=this._note;this._note=t,this.shouldSave()&&(P.d.beginAction(),o.a.setNote(this,t,r,a),P.d.endAction()),n.a.fireEvent("itemNoteSet",[{item:this}]),this.itemsHasMutated()}isNote(e){if(void 0===e)return this._isFlagHelper(r.a.VMLIFlag.Note);if(e!==this._isFlagHelper(r.a.VMLIFlag.Note)){var t=e?this.flags.get()|r.a.VMLIFlag.Note:this.flags.get()&~r.a.VMLIFlag.Note;this.setFlags(t)}}addFavorite(e,t){this._favorites||(this._favorites=[]);try{i.default.PAssert(902,this._favorites.indexOf(e)>=0,"Must not already be in the favorites group")}catch(s){i.default.reportError(s)}if(this._favorites.push(e),k.notifyAdd(this,e),this.shouldSave()){var a={favorites:this._favorites};o.a.saveItem(this,a,t,r.a.SaveFlag.Prop)}}removeFavorite(e,t){try{i.default.PAssert(903,this._favorites,"Must always have favorites defined before removing from item")}catch(s){i.default.reportError(s)}try{i.default.PAssert(904,this._favorites.indexOf(e)>=0,"Must already be in the favorites group")}catch(s){i.default.reportError(s)}if(this._favorites.remove(e),k.notifyRemove(this,e),this.shouldSave()){var a={favorites:this._favorites};o.a.saveItem(this,a,t,r.a.SaveFlag.Prop)}}setFavorites(e,t){for(var a=0,s=0,n=(e||[]).removeArray(this._favorites),l=(this._favorites||[]).removeArray(e),d=0;d<l.length;++d){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;k.notifyRemove(this,l[d])}for(d=0;d<n.length;++d){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;k.notifyAdd(this,n[d])}if(this._favorites=e,this.shouldSave()){var h=0,c=[];for(d=0;d<e.length;d++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;c[d]=i.default.clone(e[d])}var u={favorites:c};o.a.saveItem(this,u,t,r.a.SaveFlag.Prop)}}getFavorites(){return this._favorites}shouldSave(){return this._shouldSave}canDestroy(){return this._canDestroy}getPadding(e,t=!1,a){try{i.default.PAssert(905,e&&e.getItem(),"Invalid pane")}catch(n){i.default.reportError(n)}if(this.isNote())return this.parent().getPadding(e,t,a);if(isNaN(a)){var r;if(t)r=1;else if(e.isSearchedFlat()){var s=0;let t=this;for(;t;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(e.search.isFlatSearchResult(t)){r=t.levelsDeep.get()-1;break}t=t.parent()}try{i.default.PAssert(906,!isNaN(r),"Item has no root depth",!!this.parent())}catch(n){i.default.reportError(n)}isNaN(r)&&(r=1)}else r=e.getItem().levelsDeep.get();a=this.levelsDeep.get()-r-(t?e.overviewPadLevels:1)}return this.getPaddingForLevel(a,e,t)}getPaddingForLevel(e,t,a){var s;e=Math.max(e,0),s=a?r.a.OverviewPaddingStart+e*r.a.OverviewPaddingIncrement:Wr.DisplaySettings.itemIndentStart()+e*Wr.DisplaySettings.itemIndentSize();try{i.default.PAssert(907,i.default.isNumber(s),"Must have a valid padding")}catch(n){i.default.reportError(n)}return s}_updateStylePadding(e,t){try{i.default.PAssert(908,this._parent,"Must have a valid parent to update padding, root should never change")}catch(l){i.default.reportError(l)}var a=e+(this.isNote()?0:1),r=this.levelsDeep.get()!==a;if(r||t){var s=0;r&&this.levelsDeep.set(a);for(var n=this.getItems(),o=0;o<n.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;n[o]._updateStylePadding(a,t)}}}setFlags(e){this.flags.set(e)}getPriorityProps(){var e=this.flags.get();return r.a.PriorityClass[e&r.a.PMask]+" "}styleProps(e,t){var a=this.flags.get(),i=this.isHeader()&&!t.isSearchedFlat()?"pHeader ":"";this.isPrefixHeader()?i+="itemHeader ":this.isPrefixTask()?i+="itemTask ":this.isPrefixBullet()?i+="itemBullet ":this.isPrefixNumList()&&(i+="itemNumList "),this.prefix&&(i+="hasPrefix "),t.isItemTopLevel(e,this)&&(i+="topLevel ");var s=!1;if(a&r.a.VMLIFlag.Complete?s=!0:!(a&r.a.VMLIFlag.Note)&&a&r.a.VMLIFlag.DisplayComplete&&(s=!0),s?(i+="pComplete ",t.search.isMatchStuckHiding(this)||(i+="pDisplayComplete c-foreground-super-faded c-before-super-faded ")):a&r.a.PMask?i+=r.a.PriorityClass[a&r.a.PMask]+" ":i+="pNormal ",a&r.a.VMLIFlag.Starred&&!(a&r.a.VMLIFlag.Complete||a&r.a.VMLIFlag.DisplayComplete)&&(i+="pStar c-star "),a&r.a.VMLIFlag.Note){i+="pNote c-foreground-faded ";var n=this.parent().flags.get();(n&r.a.VMLIFlag.Complete||n&r.a.VMLIFlag.DisplayComplete)&&(i+="pComplete c-foreground-super-faded c-before-super-faded "),n&r.a.PMask&&(i+=r.a.PriorityClass[n&r.a.PMask]+" "),n&r.a.VMLIFlag.Starred&&!(n&r.a.VMLIFlag.Complete||n&r.a.VMLIFlag.DisplayComplete)&&(i+="pStar c-star ")}var o=this.getAttachments();if(o)for(var l=0,d=0;d<o.length;++d){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=o[d];if(h.isLoaded()){var c=h.getPlugin().getCssClass(h,t);c&&(i+=c)}}return i}onAttachmentIDChange(e,t){if(e.getPlugin().id===r.a.PluginID.GCalendar){let t=this.getMooDate();t&&(t.setGCalId(e.id),this.onMooDateUpdated(r.a.ChangeType.Local,!0))}this.setTextToWhatItAlreadyIs(r.a.ChangeType.Local)}onAttachmentUpdate(e,t,a){let i=e.getPlugin();if(i===Wr.pluginManager.getPluginGCalendar()){let t=this.getMooDate();if(t&&!t.getGCalCalendar()&&e.hasField("calendarID")){let a=e.getField("calendarID");if(t.setGCalCalendar(a),this.shouldSave()){let e={date:this._date?this._date.toData():null};o.a.saveItem(this,e,r.a.ChangeType.Local,r.a.SaveFlag.Text)}}}else i===Wr.pluginManager.getPluginGmail()&&t&&t.includes("accountID")&&this.onAttachInlineUpdate();t&&e.fieldsHaveParseEffect(t)&&(n.a.fireEvent("clearMeasureCacheItem",[this.id]),this.parseText(this.getRawText(),a),w.a.beginBatch(this),w.a.itemTextChanged(this))}setAttachments(e,t,a){var i=!1;if(!this._attachments&&e&&(this._attachments=[]),this._attachments){for(var s=0,n=0,o=this._attachments,l=0;l<o.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e.indexOf(o[l])<0&&(o[l].unsubscribe(this),o[l].notifyItemTextChanged(this,!0),this.shouldSave()&&o[l].markUnused(t),i=!0)}for(l=0;l<e.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var d=e[l];if(o.indexOf(d)<0){if(d.shouldBeDeleted()){var h=d.getEmbedString(),c=this.getRawText().replace(h,"File failed to upload");return void this.setText(c,r.a.ChangeType.Local)}d.subscribe(this),this.shouldSave()&&d.markInUse(t),i=!0}}i&&(this._attachments=e)}i&&!1!==a&&this.itemChanged.notify()}getAttachment(e){try{i.default.PAssert(909,this._attachments,"Must have valid attachments in order to query")}catch(t){i.default.reportError(t)}if(this._attachments)return this._attachments[e]}hasAttachment(e){if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[a].id===e)return!0}return!1}hasPluginAttachment(e){try{i.default.PAssert(910,e,"Must provide a valid plugin type to query")}catch(r){i.default.reportError(r)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[a].getPlugin().id===e)return!0}return!1}getAttachmentByType(e){try{i.default.PAssert(911,e,"Must provide a valid plugin type to query")}catch(s){i.default.reportError(s)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._attachments[a];if(r.isType(e))return r}}getAttachmentByPlugin(e){try{i.default.PAssert(912,e,"Must provide a valid plugin type to query")}catch(r){i.default.reportError(r)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let i=this._attachments[a];if(i.isPlugin(e))return i}}getAttachments(){if(this._attachments&&this._attachments.length>0)return this._attachments}hasAttachments(){return this._attachments&&this._attachments.length>0}getNumAttachments(){return this._attachments?this._attachments.length:0}hasAttachmentType(e){return Wr.pluginManager.hasAttachmentType(this,e)}copyProperties(e){this.setStarred(e.isStarred(),r.a.ChangeType.Auto),this.setComplete(e.isComplete(),r.a.ChangeType.Auto),this.setPriority(e.getPriority(),r.a.ChangeType.Auto)}moveNote(e,t){try{i.default.PAssert(913,e.hasNote(),"Must have a note to move")}catch(r){i.default.reportError(r)}try{i.default.PAssert(914,!this.hasNote(),"Must not already have a note")}catch(r){i.default.reportError(r)}var a=e.getNote();e.setNote(void 0,t),a&&(a.setParent(this),this.setNote(a,t))}parent(){return this._parent}setParent(e){let t=this._parent;return this._parent=e,e&&e!==t&&this._updateStylePadding(this._parent.levelsDeep.get(),!1),this._parent}getParser(){var e,t=this.getItemStore();return t&&(e=t.getParser()),e}requireStoredEls(){var e=this.getItemStore();return!!e&&e.requireStoredEls()}getItemStore(){try{i.default.PAssert(915,this._store,"Should never be getting the item store from a destroyed VMLI")}catch(e){i.default.reportError(e)}return this._store}belongsToSameItemStore(e){return this.getItemStore()===e.getItemStore()}belongsToItemStore(e){return this.getItemStore()===e}notifyItemPropertyChanged(e,t){if(this.hasAttachments())for(var a=0,i=this.getAttachments(),r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[r].notifyItemPropertyChanged(this,e,t)}}unArchive(e){this._documentOwner.unArchiveItem(this,e)}archiveSelf(e){this._documentOwner.archiveItem(this,e)}isArchived(){return this._isArchived}setArchived(e,t){this._isArchived=e}isHidden(e){try{i.default.PAssert(916,e,"Must specify the pane for the item being checked")}catch(t){i.default.reportError(t)}try{i.default.PAssert(917,!e||e.search,"Pane search obj must exist: ",e.isDestroyed())}catch(t){i.default.reportError(t)}return!(!e||!e.search)&&!e.search.isMatched(this)}getRawText(){return this._rawText}getParsedText(){try{i.default.PAssert(918,!1===this._needsParse,"Text should be parsed before calling get")}catch(e){i.default.reportError(e)}return void 0!==this._parsedText?this._parsedText:this._rawText}getSearchText(e){if(e){var t=e.search.getItemSearchText(this);if(t)return t}try{i.default.PAssert(919,void 0!==this._searchText,"Item should always have search text")}catch(a){i.default.reportError(a)}return this._searchText}setRawText(e){void 0!==e&&null!==e||(e="");try{i.default.PAssert(920,e.indexOf(r.a.AttachChar)<0,"Should never have an AttachChar present in raw text")}catch(t){i.default.reportError(t)}this._rawText=e,this._searchText=this.generateSearchText(),this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0}setParsedText(e){this._parsedText=e,this._needsParse=!1,this._searchText=this.generateSearchText()}generateSearchText(){var e=this.getParsedTextWithoutPrefix().toLowerCase();return this.hasAttachments()?this._generateUsableText(e,"getTitleString").replace(/[\*_]/g,"").toLowerCase():e}getPriority(e){if(e){var t=e.search.getItemPriority(this);if(void 0!==t)return t}return this.flags.get()&r.a.PMask}setPriority(e,t){try{i.default.PAssert(922,i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(d){i.default.reportError(d)}try{i.default.PAssert(923,null===e||r.a.PriorityClass[e],"Priority must be defined in globals")}catch(d){i.default.reportError(d)}var a=this.getPriority();if(e!==a){var s=this.flags.get(),n=s&~r.a.PCMask|e;if(s&r.a.VMLIFlag.Complete&&(n&=~r.a.VMLIFlag.Complete),this.setFlags(n),this.shouldSave()){var l={flags:n};o.a.saveItem(this,l,t,r.a.SaveFlag.Text)}this.notifyItemPropertyChanged(t,"priority"),w.a.itemSearchChanged(this),w.a.itemDateChanged(this),P.d.performAction(P.b.Update,{itemID:this.id,field:"priority",newValue:e,oldValue:a})}}isScheduled(){return!!this._date}getDuration(e,t){if(e){var a=e.search.getItemDuration(this);if(a)return a}if(this._date)return this._date.duration||r.a.DefaultEventDuration}setDuration(e){this._date?this._date.setDuration(e):this._date=new C.a(void 0,{duration:e})}getEndDate(e){if(this._date)return this._date.getEnd()}isMultidayEvent(){var e=!1;if(this.getDate()&&this.getDuration()>0){var t=this.getEndDate();this.getDate().isSameDay(t)||(e=!0)}return e}getStickySearchInfo(){return{prefix:this.getPrefix(),date:this.getDate(),duration:this.getDuration(),tagsLower:this.getTagsLower(),contacts:this.getContacts(),searchText:this.getSearchText(),priority:this.getPriority(),isComplete:this.isComplete(),isStarred:this.isStarred()}}onMooDateUpdated(e,t){if(Wr.timeline.updateNotifications(this),t||i.default.isFlagSet(e,r.a.ChangeType.ItemLoad)||w.a.itemDateChanged(this),this.itemChanged.notify(),this.shouldSave()||this._attachments){let a={date:this._date?this._date.toData():null};i.default.timeoutOnce("setMooDate",()=>{this.shouldSave()&&o.a.saveItem(this,a,e,r.a.SaveFlag.Text),!t&&this._attachments&&i.default.isLocalChange(e)&&this._attachments.forEach(e=>{e.getPlugin().id===r.a.PluginID.GCalendar&&e.notifyItemDateChanged(this)})},500)}}setMooDate(e,t,a){if(this._date&&e?this._date.copyFrom(e):this._date=e,!1!==a){let a=this.getRawText();this.onMooDateUpdated(t),!e&&a.includes(r.a.CharDate)&&(a=i.default.trimRight(a.replace(new RegExp(r.a.CharDate,"g"),"").replace(/'  '/g," ")),this.setText(a,t)),i.default.isLocalChange(t)&&P.d.miscAction({type:P.b.Misc,misc:P.a.ChangeDate,data:{itemID:this.id,date:this._date}})}}setDate(e,t,a){if(this._date)e!==this._date.getDate()&&(this._date.setDate(e),this._date.setDuration(t),this.onMooDateUpdated(a));else if(this.setMooDate(new C.a(e),a),this.getRawText().indexOf(r.a.CharDate)<0){this.getParsedText();this.setText(this.getParsedText()+" "+r.a.CharDate,r.a.ChangeType.Local)}}getMooDate(){return this._date}getNextDate(e){return this._date?this._date.getNext(e):void 0}getDate(e){if(e){var t=e.search.getItemDate(this);if(t)return t}return this._date?this._date.getDate():void 0}allDayDate(){return!!this._date&&!this._date.getTime()}_isFlagHelper(e,t){if(void 0===t)return!!(this.flags.get()&e);var a=t?this.flags.get()|e:this.flags.get()&~e;this.setFlags(a)}isDeleted(){return this._isDeleted}setDeleted(e,t){try{i.default.PAssert(924,i.default.isValidChangeType(t),"Must supply a valid changetype to delete an item: "+t)}catch(d){i.default.reportError(d)}if(this._isDeleted=e,e){var a=0;e!==this._isDeleted&&this.shouldSave()&&o.a.deleteItem(this.parent(),this,t);for(var r=0;this._favorites&&r<this._favorites.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._favorites[r];e?k.notifyRemove(this,s):k.notifyAdd(this,s)}if(this._attachments){var n=0,l=this._attachments;for(r=0;r<l.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e?(l[r].unsubscribe(this),this.shouldSave()&&l[r].markUnused(t)):(l[r].subscribe(this),this.shouldSave()&&l[r].markInUse(t))}}}}isImportant(e){return this.getPriority(e)}forceComplete(e,t){return this.setComplete(e,t,!0)}isDisplayComplete(){return this._isFlagHelper(r.a.VMLIFlag.DisplayComplete)}computeDisplayComplete(){var e=this.parent(),t=e&&!this.isComplete()&&(e.isComplete()||e._isFlagHelper(r.a.VMLIFlag.DisplayComplete));this._isFlagHelper(r.a.VMLIFlag.DisplayComplete,t)}propagateDisplayComplete(){var e=0;this.computeDisplayComplete();for(var t=0;t<this.numItems();t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.itemAtIndex(t);a.isComplete()||a.propagateDisplayComplete()}}isComplete(){return this._isFlagHelper(r.a.VMLIFlag.Complete)&&(!this.isRepeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===O.getTime())}setComplete(e,t,a){let s=e,n={};try{i.default.PAssert(925,i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(l){i.default.reportError(l)}e?(this.isRepeatDate()?(this._date.complete(),this.onMooDateUpdated(t),s=!1,Wr.toasts.pushMessage({text:"Completed. Next occurrence: "+R.a.toHumanText(this._date.getNext()),action:r.a.MessageAction.Undo,hold:!1})):this.dateCompleted||(this.dateCompleted=new Date,n.dateCompleted=this.getDateCompletedTime()),i.default.isLocalChange(t)&&i.default.aggregateEvent("ItemCompleted")):(this.dateCompleted=void 0,n.dateCompleted=null),this._isFlagHelper(r.a.VMLIFlag.Complete,s),i.default.isRemoteChange(t)||(n.flags=this.flags.get(),this.shouldSave()&&o.a.saveItem(this,n,t,r.a.SaveFlag.Text),P.d.performAction(P.b.Update,{itemID:this.id,field:"isComplete",newValue:e,oldValue:!e})),this.notifyItemPropertyChanged(t,"isComplete"),this.propagateDisplayComplete(),Wr.timeline.updateNotifications(this),w.a.itemSearchChanged(this)}setStarred(e,t){if(void 0!==e){try{i.default.PAssert(926,i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(l){i.default.reportError(l)}if(e!==this._isFlagHelper(r.a.VMLIFlag.Starred)){var a=this.flags.get();e&&a&r.a.VMLIFlag.Complete&&(a&=~r.a.VMLIFlag.Complete);var s=e?a|r.a.VMLIFlag.Starred:a&~r.a.VMLIFlag.Starred;this.setFlags(s);var n={flags:s};this.shouldSave()&&o.a.saveItem(this,n,t,r.a.SaveFlag.Text),this.notifyItemPropertyChanged(t,"isStarred"),w.a.itemSearchChanged(this),P.d.performAction(P.b.Update,{itemID:this.id,field:"isStarred",newValue:e,oldValue:!e})}}}isStarred(e){if(e){var t=e.search.getItemStarred(this);if(void 0!==t)return t}return this._isFlagHelper(r.a.VMLIFlag.Starred)}isHeader(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}getVisibleChildren(e){if(!this.isNote()){for(var t=0,a=this.getItems(),i=[],r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[r].isHidden(e)||i.push(a[r])}return i}}hasVisibleChildren(e){if(this.isNote())return!1;for(var t=0,a=this.getItems(),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!a[i].isHidden(e))return!0}return!1}hasHeaderChildren(){if(this.isNote())return!1;for(var e=0,t=this.getItems(),a=0;a<t.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t[a].isHeader())return!0}return!1}getCollapsedField(e,t){return t?r.a.PerPaneStateField.CollapsedOverview:e.collapsedFieldName}isCollapsed(e,t=!1,a){try{i.default.PAssert(927,e,"Must specify the pane for the item being checked for collapsed")}catch(n){i.default.reportError(n)}if(!e||!t&&e.isSearchedFlat())return!1;var s=!a&&e.isSearchedText()?e.getPerPaneState(this.id,r.a.PerPaneStateField.CollapsedSearch):void 0;return void 0===s&&void 0===(s=e.getPerPaneState(this.id,this.getCollapsedField(e,t)))&&(s=this.isDemandLoad()?0===this.numItems()||!e.isSearched()&&!t:e.getCollapsedDefault(this,t)),!!s}setCollapsed(e,t,a=!1,s){try{i.default.PAssert(928,t,"Must specify the pane for the item being checked for collapsed")}catch(o){i.default.reportError(o)}if(!t)return!1;var n=this.isCollapsed(t,a);void 0!==e&&(e&&!this.isCollapsible()||(t.isSearchedText()&&t.setPerPaneState(this.id,r.a.PerPaneStateField.CollapsedSearch,void 0),t.setPerPaneState(this.id,this.getCollapsedField(t,a),e),!1!==s&&Wr.PaneManager.updatePaneStateForPane(t),P.d.performAction(P.b.Update,{itemID:this.id,field:"isCollapsed",pane:t,newValue:e,oldValue:n}),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!e,i.default.focusedPane),e!==n&&t.updateItems())),this.itemChanged.notify()}setCollapsedQuiet(e,t){t.setPerPaneState(this.id,this.getCollapsedField(t,!1),e)}toggleCollapsed(e){try{i.default.PAssert(929,e,"Must specify the pane that this item is being collapsed in")}catch(t){i.default.reportError(t)}n.a.fireEvent("clearMeasureCacheItem",[this.id]),this.setCollapsed(!this.isCollapsed(e,!1),e,!1)}isCollapsible(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}isDraggable(){return!this.isNote()}setTags(e,t){var a=this._activeTags&&!e&&this._activeTags||!this._activeTags&&e&&e||i.default.arrayDiff(this._activeTags,e);this._activeTags=e,this._activeTagsLower=e?e.map(e=>e.toLowerCase()):void 0,a&&a.length>0&&!i.default.isFlagSet(t,r.a.ChangeType.ItemLoad)&&w.a.itemTagsChanged(this,a)}getTags(){return this._activeTags}getTagsLower(e){if(e){var t=e.search.getItemTagsLower(this);if(t)return t}return this._activeTagsLower}setContacts(e,t){var a=!(this._activeContacts&&e&&this._activeContacts.equals(e));this._activeContacts=e,a&&!i.default.isFlagSet(t,r.a.ChangeType.ItemLoad)&&w.a.itemSearchChanged(this)}getContacts(e){if(e){var t=e.search.getItemContacts(this);if(t)return t}return this._activeContacts}hasCompletedAncestor(){for(var e=0,t=this.parent();t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t.isComplete())return!0;t=t.parent()}}hasTime(){return this._date&&!!this._date.getTime()}getTimeOfDay(){return this._date?this._date.getTime():this.dateCompleted?this.dateCompleted.getTimeOfDay():0}_formatDateTime(e){return e.toString(Wr.International.getFormat(r.a.DFormat.ShortTime))}getDisplayDateWithDuration(e,t){var a=this.getDate(t);if(a){var r=this.getEndDate(t);a=a.clone().clearTime().equals(a)?a:r.clone().clearTime().equals(a)?r:a}else if(this.isRepeatDate()){let t=this.getMooDate();t&&(a=t.getNext(e))}try{i.default.PAssert(930,a,"No display date with duration",()=>this.getMooDate()&&this.getMooDate().toData())}catch(s){i.default.reportError(s)}return a}getTime(){var e="",t=this.getNextDate();if(this.dateCompleted&&this.isComplete())e=this._formatDateTime(this.dateCompleted);else if(t){var a;if(t.hasTimeOfDay())this.getDuration()>0&&(a=this.getDisplayDateWithDuration()),a?a.equals(t)?e=[this._formatDateTime(t),this._formatDateTime(this.getEndDate())]:a.equals(this.getEndDate())&&(e="Ends "+this._formatDateTime(this.getEndDate())):e=this._formatDateTime(t)}return e}createDateString(e){return e.isBefore(Date.today().addWeeks(1))?e.toString(Wr.International.getFormat(r.a.DFormat.LongDayTime)):e.toString(Wr.International.getFormat(r.a.DFormat.ShortDayTime))}fullTime(){var e=this.getDate();if(!e)return"";this.createDateString(e)}init(e,t){this._shouldSave=!(t&&t.noSave);try{i.default.PAssert(931,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(n){i.default.reportError(n)}if(this.id=e.id||o.a.generateID(),e.date){var a=e.date instanceof C.a?e.date.clone():C.a.fromData(e.date);a?this._date=a:i.default.reportError(new Error("Initial invalid date: "+e.date))}e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),e.favorites&&this.setFavorites(e.favorites,t.changeType),this.computeDisplayComplete(),(e.items&&e.items.length>0||e.note)&&this.initItems(e.items,e.note,t.changeType),this.__TEMP_InitCalled=!0;try{i.default.PAssert(932,t,"Missing required properties in extraInfo")}catch(n){i.default.reportError(n)}var s=t?t.changeType:r.a.ChangeType.Auto;try{i.default.PAssert(933,i.default.isValidChangeType(s),"Must supply a valid changetype to VMLIs")}catch(n){i.default.reportError(n)}(this.__TEMP_InitParseCalled=!0,this.shouldSave()&&!i.default.isAutoChange(t.changeType))?(i.default.isLocalChange(t.changeType)?r.a.SaveFlag.All:r.a.SaveFlag.None,this.getItemStore().trackGlobally()&&o.a.setItem(this)):this.getItemStore().trackGlobally()&&o.a.setItem(this);this.parseText(this.getRawText(),t.changeType|r.a.ChangeType.ItemLoad),i.default.isLocalChange(t.changeType)&&i.default.aggregateEvent("ItemCreated")}onLoad(e){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(e,!1)||e.isSearched()||this.notifyDemandLoadUpdate(!0,e),this.isLoaded=!0)}destroy(e){try{i.default.PAssert(934,this._canDestroy||e,"VMLI must be explicitly marked as destroyable")}catch(n){i.default.reportError(n)}try{i.default.PAssert(935,e||!this.shouldSave()||i.default.isDemoMode(),"Should never destroy a saveable VMLI")}catch(n){i.default.reportError(n)}var t=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var a=0,r=this._attachments,s=0;s<r.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r[s].unsubscribe(this)}this._attachments=void 0}t.trackGlobally()&&o.a.clearItem(this.id),this.items.unlisten(this.itemsHasMutated),w.a.itemSearchChanged(this),this._store=void 0,v.a.destroy(this)}isDestroyed(){return this._destroyed}isFullscreen(){return i.default.focusedItem===this}findItem(e){var t=this.getIndexOf(e.id);if(t>=0)return{index:t,arr:this.items,isArchived:!1}}setItems(e){var t=0;let a=this.items.get(),i=a.length>0,s=!1;for(var n=0;n<e.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let i=e[n],o=a.indexOfWithProperty("id",i.id);if(o>=0){let e=a[o];i.items&&e.setItems(i.items)}else a.push(this._store.createItemRaw(i,{documentOwner:this._documentOwner,parent:this,changeType:r.a.ChangeType.Auto})),s=!0}s&&(i&&a.sort(E.a.compareItemIndex),this.items.set(a),this.itemsHasMutated())}initItems(t,a,r){var s=!1;if(t&&t.length>0){var n=0;try{i.default.PAssert(936,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(u){i.default.reportError(u)}for(var l=0;l<t.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;let p=t[l],g=void 0;if(p instanceof e?g=p:i.default.isString(p)&&(g=o.a.getItem(p)),g){var d=o.a.getItem(g.parent().id);if(d&&d.id!==this.id){var h=d.items.indexOf(g.id);try{i.default.PAssert(939,-1===h,"Expect that the old parent has been notified")}catch(u){i.default.reportError(u)}var c=g.getIndex();c>-1&&g.parent().removeChildAtIndex(c,r)}g.setParent(this)}else if("object"!==typeof p){let e=o.a.getItemDataLocal(this._documentOwner,p);try{i.default.PAssert(937,e,"Referenced item doesn't exist",p)}catch(u){i.default.reportError(u)}e&&(g=this._store.createItemRaw(e,{documentOwner:this._documentOwner,parent:this,changeType:r}))}else{try{i.default.PAssert(938,p,"Item must exist otherwise we arent creating anything")}catch(u){i.default.reportError(u)}p&&(g=this._store.createItemRaw(p,{documentOwner:this._documentOwner,parent:this,changeType:r}))}try{i.default.PAssert(940,g,"There must be a model at this point")}catch(u){i.default.reportError(u)}if(g){if(g.isNote()){a=g.id;continue}s=!0,this.items.push(g)}}}if(a){try{i.default.PAssert(941,!this._note,"Must not already have a valid note set")}catch(u){i.default.reportError(u)}try{i.default.PAssert(942,i.default.isString(a)||i.default.isObject(a),"Note must be a valid ID")}catch(u){i.default.reportError(u)}let e;if(i.default.isString(a)){if(!(e=o.a.getItem(a))){let t=o.a.getItemDataLocal(this._documentOwner,a);try{i.default.PAssert(943,t,"Referenced note doesn't exist",a)}catch(u){i.default.reportError(u)}t&&(t.isDeleted?e=null:(t=Object.assign({isNote:!0},t),e=this._store.createItemRaw(t,{documentOwner:this._documentOwner,parent:this,changeType:r})))}}else i.default.isObject(a)&&(e=this._store.createItemRaw(a,{documentOwner:this._documentOwner,parent:this,changeType:r}));try{i.default.PAssert(944,void 0!==e,"Must have a valid note VM at this point")}catch(u){i.default.reportError(u)}e&&(this._note=e,s=!0)}s&&this.itemsHasMutated()}addItemAtIndex(e,t,a){try{i.default.PAssert(945,a,"Must pass pane when adding item at index")}catch(n){i.default.reportError(n)}P.d.beginAction();var s=a.createVMLI(e,{documentOwner:this._documentOwner,parent:this,changeType:r.a.ChangeType.AllLocal,isEditable:!0});return this.insertItem(s,t),P.d.performAction(P.b.Create,{itemID:s.id,parent:this.id,position:isNaN(t)?this.numItems()-1:t,text:e.text}),this.isCollapsed(a,!1)&&this.setCollapsed(!1,a),P.d.endAction(),s}insertItem(e,t,a){try{i.default.PAssert(946,!this.isNote(),"Notes cannot use this function")}catch(r){i.default.reportError(r)}try{i.default.PAssert(947,e,"Must specify a valid item to be inserted")}catch(r){i.default.reportError(r)}try{i.default.PAssert(948,this!==e,"Should not insert an item into itself")}catch(r){i.default.reportError(r)}try{i.default.PAssert(949,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(r){i.default.reportError(r)}this!==e&&(isNaN(t)||t<0?this.items.push(e):this.items.splice(t,0,e),this.shouldSave()&&o.a.addItem(this,e,t,a))}insertSorted(e,t,a){try{i.default.PAssert(950,!this.isNote(),"Notes cannot use this function")}catch(s){i.default.reportError(s)}try{i.default.PAssert(951,e,"Must specify a valid item to be inserted")}catch(s){i.default.reportError(s)}try{i.default.PAssert(952,t,"Must supply a valid comparator")}catch(s){i.default.reportError(s)}try{i.default.PAssert(953,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(s){i.default.reportError(s)}var r=this.items.insertSorted(e,t,a);this.shouldSave()&&o.a.addItem(this,e,r)}moveTo(t,a){var r=t.parent,s=t.index,n=t.shouldBeArchived;try{i.default.PAssert(954,r instanceof e,"New parent must be a valid VMLI")}catch(p){i.default.reportError(p)}void 0===s&&(s=-1),void 0===n&&(n=!1);var l=this.parent(),d=l.findItem(this);let h=this.index;if(d)if(r.getDocumentOwner().getBacking()!==l.getDocumentOwner().getBacking())Wr.toasts.pushMessage({text:"Moving items between local and synced documents is not yet supported. Please copy and paste these items for now."});else{var c=s;if(l===r){if(d.index===c)return;d.index<c&&c--}Wr.PaneUpdateBatcher.beginUpdateItems(),d.arr.splice(d.index,1),w.a.itemSearchChanged(this);var u=r.items;c<0?u.push(this,!1):u.splice(c,0,this,!1);let e=r.getDocumentOwner();e!==this.getDocumentOwner()&&this.forEachChildRecursive(t=>t.setDocumentOwner(e),!0,!0),this.setParent(r),u.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),Wr.PaneUpdateBatcher.commitUpdateItems();try{i.default.PAssert(955,this.shouldSave(),"Item must be marked as saveable")}catch(p){i.default.reportError(p)}try{i.default.PAssert(956,l.shouldSave(),"Old parent must be marked as saveable")}catch(p){i.default.reportError(p)}try{i.default.PAssert(957,this.parent().shouldSave(),"New parent must be marked as saveable")}catch(p){i.default.reportError(p)}this.shouldSave()&&o.a.moveItem(this,l,h,a),l.propagateDisplayComplete(),r.propagateDisplayComplete()}else Wr.toasts.pushMessage({text:"Error moving item"})}getItemsArrayForSave(){var e=0;try{i.default.PAssert(958,!this.isNote(),"Notes cannot use this function")}catch(s){i.default.reportError(s)}for(var t=[],a=this.getItems(),r=0;r<a.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(a[r].id)}return t}getDateTime(){if(this.getDate())return this.getDate().getTime()}getDateCompletedTime(){if(this.dateCompleted)return this.dateCompleted.getTime()}isForceCompleted(){return!(!this.dateCompleted||!this.dateCompleted.equals(O))}getMetaTextSaveData(){this.getDate();return{date:this._date?this._date.toData():void 0,dateCompleted:this.getDateCompletedTime()}}_generateNotificationEntry(e){var t=new Date(e);try{i.default.PAssert(959,i.default.isDateValid(t),"Must provide a valid alert date: "+e)}catch(a){i.default.reportError(a)}return t=e.hasTimeOfDay()?t.addMinutes(-Wr.settings.notificationDelay.get()):t.addDays(-1).clearTime().addHours(17),{id:this.id,text:this.generateTitleText(void 0,!0),date:e,alertDate:t}}getNotificationEntry(){try{i.default.PAssert(960,this.getNextDate(),"Must have a valid date")}catch(e){i.default.reportError(e)}try{i.default.PAssert(961,!this.allDayDate(),"All day dates should not be scheduled")}catch(e){i.default.reportError(e)}if(!this.allDayDate())try{let e=this.getNextDate();if(e&&e>new Date)return this._generateNotificationEntry(e)}catch(t){return void i.default.reportError(t)}}getDebugData(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isDeleted:this.isDeleted()}}getFullSaveData(){try{i.default.PAssert(962,this.shouldSave(),"Item must be marked as saveable")}catch(a){i.default.reportError(a)}let e=this.flags.get();try{i.default.PAssert(963,this._documentOwner,"Item has no document")}catch(a){i.default.reportError(a)}var t={id:this.id,index:this.index,text:this.getRawText(),date:this._date?this._date.toData():void 0,dateCreated:this.dateCreated.getTime(),dateModified:this.dateModified.getTime(),dateCompleted:this.getDateCompletedTime(),flags:e||void 0,isRoot:this.isRoot,docId:this._documentOwner?this._documentOwner.id:void 0,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,parent:this.parent()?this.parent().id:void 0};return Object.keys(t).forEach(e=>{void 0===t[e]&&delete t[e]}),t}highlight(){var e=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout(()=>{e.isHighlighted.set(!0)},0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout(()=>{e.isHighlighted.set(!1)},2e3)}removeChild(e,t){try{i.default.PAssert(964,!this.isNote(),"Notes cannot use this function")}catch(a){i.default.reportError(a)}try{i.default.PAssert(965,!e.isNote(),"Do not use remove child to remove notes from items")}catch(a){i.default.reportError(a)}return this.items.remove(e)}removeChildAtIndex(e,t){try{i.default.PAssert(966,!this.isNote(),"Notes cannot use this function")}catch(a){i.default.reportError(a)}try{i.default.PAssert(967,!this.itemAtIndex(e).isArchived())}catch(a){i.default.reportError(a)}this.items.removeAt(e)}_moveChildrenHelper(e,t){var a=e.newParent,r=e.index,s=e.isArchived;try{i.default.PAssert(968,void 0!==a&&void 0!==s,"_moveChildrenHelper is missing parameters")}catch(c){i.default.reportError(c)}var n=this.getItems();if(n.length>0){var o=0,l=a.getItems();!s&&(isNaN(r)||r<0)&&(r=l.length);for(var d=0;n.length>0;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;try{i.default.PAssert(969,n[d]!==a,"Should never be reparenting to a child")}catch(c){i.default.reportError(c)}var h=n[0].id;n[0].moveTo({parent:a,index:r+d,shouldBeArchived:s},t),P.d.performAction(P.b.Move,{itemID:h,oldParent:this.id,oldPosition:d,newParent:a.id,newPosition:r+d}),d++}}}moveChildren(e,t,a){try{i.default.PAssert(970,!this.isNote(),"Notes cannot use this function")}catch(s){i.default.reportError(s)}try{i.default.PAssert(971,this.id!==e.id,"Do not use moveChildren to move a child to the same parent")}catch(s){i.default.reportError(s)}if(e.parent()===this){var r=this.removeChild(e,a);P.d.performAction(P.b.Delete,{itemID:e.id,parent:this.id,position:r})}Wr.PaneUpdateBatcher.beginUpdateItems(),this._moveChildrenHelper({newParent:e,index:t,isArchived:!1},a),this._moveChildrenHelper({newParent:e,index:t,isArchived:!0},a),Wr.PaneUpdateBatcher.commitUpdateItems()}deleteSelf(e){this.parent().deleteChild(this,void 0,void 0,e)}deleteChild(e,t,a,r,s){try{i.default.PAssert(972,e,"Must provide a valid child to delete")}catch(h){i.default.reportError(h)}try{i.default.PAssert(973,!this.isNote(),"Notes cannot use this function")}catch(h){i.default.reportError(h)}if(P.d.beginAction(),Wr.PaneUpdateBatcher.beginUpdateItems(),e.isNote())this.setNote(void 0,r);else if(e.hasChildren())if(t)e.moveChildren(t,a,r);else for(var n=0,o=e.getItems(),l=o.length-1;l>=0;l--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e.deleteChild(o[l],void 0,void 0,r,!0)}if(e.hasNote()&&e.setNote(void 0,r),!e.isDeleted()){if(!e.isNote()&&!s){var d=this.removeChild(e,r);d>=0&&P.d.performAction(P.b.Delete,{itemID:e.id,parent:this.id,position:d})}this._documentOwner&&this._documentOwner.deleteItem(e,r,s)}e.notifyItemPropertyChanged(r,"isDeleted"),w.a.itemItemsChanged(this),Wr.timeline.updateNotifications(e),Wr.PaneUpdateBatcher.commitUpdateItems(),P.d.endAction()}unDelete(e){this._documentOwner.unDeleteItem(this,e)}replaceChild(e,t,a){try{i.default.PAssert(974,!this.isNote(),"Notes cannot use this function")}catch(l){i.default.reportError(l)}try{i.default.PAssert(975,!e.isNote(),"Old child should not be a note")}catch(l){i.default.reportError(l)}try{i.default.PAssert(976,!t.isNote(),"New child should not be a note")}catch(l){i.default.reportError(l)}var r=e.getIndex();this.items.removeAt(r),P.d.performAction(P.b.Delete,{itemID:e.id,parent:this.id,position:r}),o.a.deleteItem(this,e,a),t.moveTo({parent:this,index:r},a),e.moveChildren(t,t.numChildren(),a);var s=t.parent().id;if(s!==this.id){var n=t.parent().items.remove(t);P.d.performAction(P.b.Move,{itemID:t.id,oldParent:s,oldPosition:n,newParent:this.id,newPosition:r})}}forEachChildRecursive(e,t,a){a&&e(this),t&&this.hasNote()&&e(this.getNote()),this.items.get().forEach(a=>a.forEachChildRecursive(e,t,!0))}getChildren(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()}getChild(e){try{i.default.PAssert(977,!this.isNote(),"Notes cannot use this function")}catch(t){i.default.reportError(t)}try{i.default.PAssert(978,e>=0,"Child index is out of range: ",e)}catch(t){i.default.reportError(t)}try{i.default.PAssert(979,e<this.numItems(),"Child index out of range: ",e,this.numItems())}catch(t){i.default.reportError(t)}return this.itemAtIndex(e)}getFirstChild(){try{i.default.PAssert(980,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(0):void 0}isFirstChild(){try{i.default.PAssert(981,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return!!this.parent()&&this.parent().getFirstChild()===this}getLastChild(){try{i.default.PAssert(982,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0}isLastChild(){try{i.default.PAssert(983,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return!!this.parent()&&this.parent().getLastChild()===this}isDescendantOf(e){for(var t=0,a=this.parent();a&&a!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a=a.parent()}return void 0!==a}hasChild(e){return this.getIndexOf(e.id)>=0}getChildIndex(e){try{i.default.PAssert(984,!this.isNote(),"Notes cannot use this function")}catch(t){i.default.reportError(t)}try{i.default.PAssert(985,!e.isNote(),"Should not get the index of an item note")}catch(t){i.default.reportError(t)}return this.getIndexOf(e.id)}getIndexOf(e){try{i.default.PAssert(986,!this.isNote(),"Notes cannot use this function")}catch(n){i.default.reportError(n)}try{i.default.PAssert(987,i.default.isString(e),()=>"ID must be a valid string: "+i.default.getObjectInfo(e))}catch(n){i.default.reportError(n)}var t=-1,a=this.getItems();if(a)for(var r=0,s=0;s<a.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a[s].id===e){t=s;break}}return t}getIndex(){try{i.default.PAssert(988,!this.isNote(),"Should never be getting a child index of a note")}catch(e){i.default.reportError(e)}return this.parent().getChildIndex(this)}indexInItemFromStringIndex(e){let t={index:e},a=this.items.get(),i=a.findIndex(e=>E.a.compareItemIndex(e,t)>0);return i>=0?i:a.length}hasChildren(){return!this.isNote()&&this.numItems()>0}numChildren(){try{i.default.PAssert(989,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return this.numItems()}canZoom(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)}parents(e){for(var t=0,a=[],i=this.parent();i&&i!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a.splice(0,0,i),i=i.parent()}return a}getSiblings(e){try{i.default.PAssert(990,!this.isNote(),"Notes cannot use this function")}catch(o){i.default.reportError(o)}e=e||0;var t=[];if(this.parent())for(var a=0,r=this.parent().getItems(),s=e,n=r.length;s<n;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r[s]!==this&&t.push(r[s])}return t}nextSibling(){var e=this.getIndex();return this.parent().getItems()[e+1]}isRootItem(){var e=this.getItemStore();return!!e&&e.isRoot(this)}clone(e,t){var a=0;try{i.default.PAssert(991,!i.default.isAutoChange(t),"Cloning should always be a user action")}catch(l){i.default.reportError(l)}for(var r=e.getItemStore().createItemRaw({id:void 0,text:this.getRawText(),isComplete:this.isComplete(),date:this._date?this._date.clone():void 0,priority:this.getPriority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:e,documentOwner:e.getDocumentOwner()||this._documentOwner,changeType:t}),s=0;s<this.numItems();++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this.itemAtIndex(s).clone(r,t);r.insertItem(n)}if(this.hasNote()){var o=this.getNote().clone(r,t);r.setNote(o,t)}return r}getItems(){return this.items.get()}itemAtIndex(e){return this.items.get()[e]}numItems(){return this.items.length()}itemsHasMutated(){try{i.default.PAssert(992,!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id)}catch(e){i.default.reportError(e)}!this._destroyed&&this.isInitialized&&w.a.itemItemsChanged(this)}numChildrenRecursive(){var e=0,t={item:this,each:t=>{e++}};return i.default.searchVMLIs(t),e}isOnDate(e){return!!this._date&&this._date.isOnDate(e)}getCalendarColor(){var e,t=Wr.pluginManager.getPluginGCalendar();if(this.isComplete())return"#ddd";if(this.hasAttachmentType(r.a.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var a=this.getAttachmentByType(r.a.PluginType.Calendar);e=t.getCalendarBackgroundColor(a.getField("calendarID"))}else e="rgba(0, 153, 221, 0.85)";return e}getCalendarDisplayProps(){var e,t=Wr.pluginManager.getPluginGCalendar();if(this.hasAttachmentType(r.a.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var a=this.getAttachmentByType(r.a.PluginType.Calendar);e=t.getCalendarDisplayProps(a.getField("calendarID"))}return e}allowTextEditing(){return!0}getPreviousItem(){var e=this.parent(),t=e.getChildIndex(this);if(t>0)return e.getChild(t-1)}isRepeatDate(){return this._date&&this._date.isRepeatDate()}getEls(){return this.els}getDocumentOwner(){return this._documentOwner}setDocumentOwner(e){this._documentOwner=e}onAttachInlineUpdate(){this.setText(this.getParsedText(),r.a.ChangeType.Local)}renderRichText(e,t){return this.els||i.default.runSingleParse(this,r.a.ChangeType.Auto),Wr.ElementRenderer.renderRichText(this.els,{pane:e,item:this,overview:t})}},p()(x.prototype,"itemsHasMutated",[f.a],Object.getOwnPropertyDescriptor(x.prototype,"itemsHasMutated"),x.prototype),x);v.a.extendClass(F,((e=B)=>{return class extends e{_runAndGetSaveData(e,t){if(this.shouldSave())var a=this.getMetaTextSaveData();let i=this.getRawText();if(this.setRawText(this.generateSaveText(e)),this.parseText(i,t),this.shouldSave()){var r=this.getMetaTextSaveData(),s={};for(var n in r)a[n]!==r[n]&&(s[n]=r[n])}return s}setText(e,t){try{i.default.PAssert(1214,i.default.isLocalChange(t)||!e||e.indexOf(r.a.AttachChar)<0,"Should never be setting text with an attach char in it")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1215,this.isNote()||!e||e.indexOf("\n")<0,"Non-notes should never have newlines")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1216,!e||i.default.isRemoteChange(t)||e.indexOf(r.a.TextSpace)<0,"Should never insert text space into item when editing locally")}catch(l){i.default.reportError(l)}t|=r.a.ChangeType.Text;var a=this.isPrefixHeader();!this.isNote()&&e&&e.indexOf("\n")>=0&&(e=e.replace(/\n/g," ")),this.isInitialized&&n.a.fireEvent("clearMeasureCacheItem",[this.id]),w.a.beginBatch(this);var s=this._runAndGetSaveData(e,t);this.shouldSave()&&(s.text=this.generateSaveText(e),o.a.saveItem(this,s,t,r.a.SaveFlag.Text)),w.a.itemTextChanged(this),this.isPrefixHeader()!==a&&w.a.itemFontChanged(this),w.a.commitBatch(this)}metricsInPane(e,t){var a;try{var r=t>=0&&_.a.isSelected(t,e),s=e.objectAtIndex(t);a=e.getMetricsForPaneObject(s,!1,r)}catch(n){i.default.reportError(n)}return a}sizeInPane(e,t,a){if(a)return r.a.OverviewItemHeightDesktop;if(this.isNote()){let a=e.objectAtIndex(t);return Wr.DisplaySettings.lineItemHeight(a,this,e,1)}{let a=e.objectAtIndex(t),i=this.metricsInPane(e,t).height;return this.shouldShowParents(a,e)&&(i+=r.a.HeightAgendaParents),i}}shouldShowParents(e,t){return t.type===r.a.PaneMode.Task&&e.item&&!t.isSearchedFlat()&&(t.isViewTag()||t.isViewAgenda()||t.isViewContact()||t.isViewPriority())&&!e.item.isNote()&&0===e.levelsDeep&&e.item.getItemStore()===Wr.itemStoreManager.getDefaultItemStore()&&e.item.parent()!==t.getItem()}generateSaveText(e,t){return void 0!==e&&null!==e?this._generateUsableText(e,"getEmbedString",t):null}generateTitleText(e,t){var a="";if(e&&!this.parent())return e.titleOfFirstItem();if(e&&this.els&&this.els.length>0)for(var r=0,s=0;s<this.els.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=this.els[s];n.hasClass("mdMarkup")||n.hasClass("itemPrefix")||n.hasClass("inlineDate")||(a+=i.default.unescape(n.getUnstyledText(e)))}else a=this.getParsedTextWithoutPrefix();return(this.hasAttachments()?this._generateUsableText(a,"getTitleString",void 0,t):a).replace(/[\*_]/g,"").trim()}_generateUsableText(e,t,a,s){try{i.default.PAssert(1217,this.hasAttachments()||e.indexOf(r.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(d){i.default.reportError(d)}var n=e;if(this.hasAttachments()&&e.indexOf(r.a.AttachChar)>=0){var o=a||0,l=this.getNumAttachments();n=e.replace(new RegExp(r.a.AttachChar,"g"),()=>{if(o<l){var e=this.getAttachment(o);return o++,!e.isLoaded()||s&&e.getPlugin().id===r.a.PluginID.Date?"":e[t]()}try{i.default.PAssert(1218,!1,"Unable to find valid attachment for AttachChar")}catch(d){i.default.reportError(d)}return""});try{i.default.PAssert(1219,n.indexOf(r.a.AttachChar)<0,"Should convert all attachments to their string form")}catch(d){i.default.reportError(d)}}return n}splitUsableText(e,t,a){try{i.default.PAssert(1220,this.hasAttachments()||e.indexOf(r.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(d){i.default.reportError(d)}var s=e.substring(0,t)+e.substring(a),n=t;if(this.hasAttachments()&&e.indexOf(r.a.AttachChar)>=0){var o=0,l=this.getNumAttachments();s=e.replace(/\u2000/g,(e,a)=>{if(o<l){var i=this.getAttachment(o);o++;var s=i.getEmbedString();return a<t&&(n+=Math.max(s.length-1,0)),s}return r.a.AttachChar});try{i.default.PAssert(1221,s.indexOf(r.a.AttachChar)<0,"Should convert all attachments to their string form")}catch(d){i.default.reportError(d)}}return{before:s.substring(0,n),after:s.substring(n)}}parseText(e,t){if(!this._isParsing){try{i.default.PAssert(1222,!this.isDestroyed(),"Must not parse a destroyed VMLI")}catch(d){i.default.reportError(d)}try{i.default.PAssert(1223,i.default.isValidChangeType(t),"Must specify a valid changetype")}catch(d){i.default.reportError(d)}var a;this._isParsing=!0;try{var s;if(this.__TEMP_ParseCalled=!0,this.isNote())s=D.a.parseNote(this);else{var o=this.getParser();try{i.default.PAssert(1224,o,"Must be able to get valid parse function for item")}catch(d){i.default.reportError(d)}if(!o)return;s=o(this,t)}i.default.isFlagSet(t,r.a.ChangeType.Local)&&s.numContacts>0&&P.d.miscAction({type:P.b.Misc,misc:P.a.AddContact,data:[{itemID:this.id}]});var l=this.isPrefixNumList();a=this.styleText(s,e,t),this.itemChanged.notify(),this.isInitialized&&this.isPrefixNumList()!==l&&n.a.fireEvent("numListChanged",[])}catch(h){i.default.reportError(h)}return this._isParsing=!1,a}}styleText(e,t,a){try{i.default.PAssert(1225,i.default.isValidChangeType(a),"Must specify a valid changetype")}catch(u){i.default.reportError(u)}var s=!1,n=[];if(e){this.prefix=e.prefix;let h=(!t.includes(r.a.CharDate)||this.getRawText().includes(r.a.CharDate))&&this.getMooDate();if(h&&""!==e.parsedText){let t=h.getGCalId();if(t){let a=h.getGCalCalendar();e.attachments||(e.attachments=[]),e.attachments.push({p:r.a.PluginID.GCalendar,id:t,calendarID:a,hasInlineData:!0})}}if(e.attachments||this.hasAttachments()){for(var o=0,l=[],d=0;e.attachments&&d<e.attachments.length;++d){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;let t=e.attachments[d];t.p===r.a.PluginID.Date&&(t.id=this.id);let s=Wr.pluginManager.getAttachment(t,t.hasInlineData);s&&(l.push(s),i.default.isLocalChange(a)&&!s.getOldID()&&n.push(s))}s=!0,this.setAttachments(l,a,!1)}this.setParsedText(e.parsedText);try{i.default.PAssert(1226,e.els||i.default.isFlagSet(a,r.a.ChangeType.ItemLoad),"Must always return an els list")}catch(u){i.default.reportError(u)}e.els&&(this.els=e.els),this.prefix&&P.d.miscAction({type:P.b.Misc,misc:P.a.SetPrefix,data:{itemID:this.id,prefix:this.prefix}}),(e.tags||this._activeTags)&&this.setTags(e.tags,a),(e.contacts||this._activeContacts)&&this.setContacts(e.contacts,a);let c=this.getRawText();!(t&&this.getMooDate()&&t.includes(r.a.CharDate))||c&&c.includes(r.a.CharDate)||this.setMooDate(void 0,a)}if(this.isInitialized){if(n.length>0){var h=0;for(d=0;d<n.length;d++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;n[d].notifyItemTextChanged(this,!1)}}if(i.default.isLocalChange(a)&&this.isNote()&&this.parent().hasAttachments()){var c=0;let e=this.parent().getAttachments();for(d=0;d<e.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;e[d].notifyItemNoteChanged(this)}}s&&this.itemChanged.notify()}return!1}getCalendarRawText(){return this.getRawText().replace(/^ +/g,"").replace(/ +$/g,"")}getCalendarParsedText(){return(this.hasAttachmentType(r.a.PluginType.Email)?this.getAttachmentByType(r.a.PluginType.Email).getField("subject"):this.getParsedTextWithoutPrefix().replace(/\u2000/g,"")).trim()}getStyledTextAsOneLine(e,t){var a;return t&&(a='<span class="numChildren c-foreground-super-faded">'+this.numItems()+"</span>"),Wr.ElementRenderer.render(this.els,{convertSpaces:!1,noPrefix:e,suffix:a,item:this})}hasText(){var e=this.getParsedText();return(e=e.replace(/ /g,"")).length>0}setPrefix(e){var t=this.getRawText(),a=this.getPrefix();a&&(t=t.substr(a.length)),this.prefix=e,t=(e?e+" ":"")+t,this.setText(t,r.a.ChangeType.Local)}getPrefix(){return this.prefix?this.prefix+" ":""}getPrefixLength(){return this.prefix?this.prefix.length+1:0}isPrefixHeader(e){var t;return e&&(t=e.search.getItemPrefix(this)),void 0===t&&(t=this.prefix),t&&(t[0]===r.a.Prefix.Header||t[0]===r.a.Prefix.Header2)}isPrefixTask(){return this.prefix&&i.default.isPrefixTask(this.prefix)}isPrefixBullet(){return this.prefix&&this.prefix===r.a.Prefix.Bullet||this.prefix===r.a.Prefix.Bullet2||this.prefix===r.a.Prefix.Bullet3}isPrefixNumList(){return!!(this.prefix&&+this.prefix[0]>=0&&+this.prefix[0]<10)}hasPrefix(){return!!this.prefix}numListNumber(){if(this.isPrefixNumList()){for(var e=0,t=1,a=this.parent(),i=this.getIndex()-1;i>=0;--i,++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=a.getChild(i);if(!r||!r.isPrefixNumList())break}return t}}shouldCopyPrefix(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()}getParsedTextWithoutPrefix(){var e=this.getPrefix(),t=this.getParsedText();return e?t.substr(e.length):t}applyFormatToSelection(e,t,a,i){var s,n,o,l=0,d=0,h=this.getParsedText(),c=t,u=a,p=!1;for(t===a&&(t=0,a=h.length),t<this.getPrefixLength()&&(t=this.getPrefixLength()),a<this.getPrefixLength()&&(a=this.getPrefixLength()),o=t;o>=Math.max(t-e.length,0);o--){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(h.substr(o,e.length)===e){s=o;break}}for(o=a-e.length;o<=a;o++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(h.substr(o,e.length)===e){n=o;break}}return isNaN(s)||isNaN(n)||i===r.a.SetMode.Yes?i!==r.a.SetMode.No&&(c+=e.length,u+=e.length,h=h.substr(0,t)+e+h.substr(t,a-t)+e+h.substr(a),p=!0):(c-=e.length,u-=e.length,h=h.substr(0,s)+h.substr(s+e.length,n-s-e.length)+h.substr(n+e.length)),this.setText(h,r.a.ChangeType.Local),{didSet:p,selStart:c,selEnd:u}}insertLinkAtSelection(){var e=_.a.getStartIndex();if(_.a.isValid()&&e===_.a.getEndIndex()){var t,a=_.a.getStartOffset(),i=_.a.getEndOffset(),r=this.getRawText();if(a!==i)t=r.substr(a,i-a);else if(a>0&&i<r.length){for(var s,n,o=0,l=this.getEls(),d=0,h=-1,c=0;c<l.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(l[c].hasClass("mdMarkupStart")&&"["===l[c].getParsedText())h=d;else if(l[c].hasClass("mdMarkupEnd")&&")"===l[c].getParsedText()&&h>=0){var u=d+l[c].getOrigTextLength();if(a>=h&&i<=u){s=h,n=u;break}h=-1}d+=l[c].getOrigTextLength()}s||n||" "===r[a-1]||" "===r[a]||(s=r.prevIndexOf(" ",a)+1,(n=r.indexOf(" ",i))<0&&(n=r.length)),isNaN(s)||isNaN(n)||s===a||n===i||(t=r.substr(s,n-s),_.a.selectIndices(e,s,e,n))}Wr.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:_.a.getEndElement(),onInsertLink:this.onInsertLink,text:t})}}onInsertLink(e,t){if(_.a.isValid()&&_.a.getStartIndex()===_.a.getEndIndex()){t&&!e.text&&(e.text=e.url);var a=_.a.getStartOffset(),i=_.a.getEndOffset(),s=this.getRawText(),n=s.substr(a,i-a),o=e.url?e.text?(t?"!":"")+"["+e.text+"]("+e.url+")":e.url:e.text,l=i+o.length-n.length;s=s.substr(0,a)+o+s.substr(i),this.setText(s,r.a.ChangeType.Local),_.a.selectIndex(_.a.getStartIndex(),l)}}getTextLength(){return this.getParsedText().length}getNotePreviewText(){var e=this.getParsedText();if(e){var t=(e=e.substr(0,Math.min(e.length,400))).match(/[^\r\n]+/);if(t){var a=0,r=(e=t[0]).split(/<\/?(?:div|p|br)[^>]*>\s*/im);for(let t=0;t<r.length;t++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r[t]){var s=document.createElement("div");if(s.innerHTML=r[t],e=i.default.escape(s.textContent||s.innerText))break}}e=e.substr(0,Math.min(e.length,200))}}return e}setTextToWhatItAlreadyIs(e){var t=this.getParsedText();this.setText(t,r.a.ChangeType.Local)}}})(F),!0),v.a.extendClass(F,((e=B)=>{return class extends e{dragStart(e,t=!1){var a=e.pane||i.default.focusedPane;try{i.default.PAssert(1210,a.isItemDraggable(this),"Pane must be draggable in order to start a drag")}catch(I){i.default.reportError(I)}try{i.default.PAssert(1211,Wr.DragDrop.startDragItem,"Should always have a valid item to start dragging from")}catch(I){i.default.reportError(I)}var r=i.default.getElementParent(e.startSrc||e.target);try{i.default.PAssert(1212,r,"Must have a valid target node")}catch(I){i.default.reportError(I)}if(r){var s,n;if(Wr.DragDrop.startDragItem=void 0,Wr.DragDrop.dragItem=this,a.isViewCalendar()||t||i.default.findParent(r,"itemNotInPane"))s=[{item:this,levelsDeep:0}];else{var o=i.default.getPaneObjectForElement(r),l=this.levelsDeep.get(),d=o.levelsDeep;if(s=[o],n=o.block,!this.isCollapsed(a)){var h=0,c=this.getVisibleChildren(a),u={},p=[];u[this.id]=o;for(var g=0;g<c.length;g++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var f=c[g],m={item:f,levelsDeep:f.levelsDeep.get()-l+d,index:o.index+g+1,parentObject:u[f.parent().id]};u[f.id]=m,p.push(m)}s=s.concat(p)}}var v=i.default.offset(r),y=v.left,_=v.top;Wr.PaneManager.runForEachPane(e=>{e.addScrollListener(this.dragScroll)});var S={x:e.clientX,y:e.clientY,items:s},P={dropEffect:a.dropEffect(this),item:this,element:r,block:n,pane:a};Wr.DragDrop.start(this,s,y,_,a,S,P,t),i.default.disableMouseMove=!0}}dragMove(e){try{i.default.PAssert(1213,Wr.DragDrop.startInfo,"Must have started a drag to be valid")}catch(s){i.default.reportError(s)}if(Wr.DragDrop.startInfo){"touchmove"===e.type&&(e.returnValue=!1,e.returnFalse=!0,i.default.preventAndStop(e));var t=e.clientX-Wr.DragDrop.startInfo.x,a=e.clientY-Wr.DragDrop.startInfo.y,r=i.default.elementFromPoint(e.clientX,e.clientY);Wr.DragDrop.setTransform(t,a),r&&Wr.DragDrop.handleDragOver({item:this,target:r,dataTransfer:Wr.DragDrop.dataTransfer,diffY:e.diffY,clientX:e.clientX,clientY:e.clientY,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn})}}dragScroll(e){if(Wr.DragDrop.isDragging&&!isNaN(_.a.mousePos.x)&&!isNaN(_.a.mousePos.y)){var t={clientX:_.a.mousePos.x,clientY:_.a.mousePos.y,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,diffY:0};this.dragMove(t)}}dragEnd(e){i.default.disableMouseMove=!1,Wr.DragDrop.stop(),e&&e.target!==document.documentElement&&Wr.DragDrop.handleDrop({target:e.target,clientX:e.clientX,clientY:e.clientY,dataTransfer:Wr.DragDrop.dataTransfer,fromDropBucket:e.fromDropBucket,ctrlKey:e.ctrlKey,altKey:e.altKey,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn}),Wr.DragDrop.finish(),Wr.PaneManager.runForEachPane(e=>{e.getInfiniteList().hasScrollListener(this.dragScroll)&&e.removeScrollListener(this.dragScroll)}),i.default.disableMouseMove=!1}checkDragOnStart(e){Wr.DragDrop.escapedDragging=!1,Wr.DragDrop.startDragItem=this,i.default.preventDefault(e),i.default.stopPropagation(e)}checkDragOnMove(e,t){if(Wr.DragDrop.startDragItem&&!Wr.DragDrop.escapedDragging&&(!y.a.touch||Math.abs(e.distanceY)>i.default.ClickThreshold&&Math.abs(e.distanceX)<i.default.ClickThreshold)){var a=e.pane||i.default.focusedPane;Wr.DragDrop.startDragItem===this&&this.isDraggable()&&a.isItemDraggable(this)&&this.dragStart(e,t)}Wr.DragDrop.isDragging&&(this.dragMove(e),i.default.preventAndStop(e))}checkDragOnEnd(e){Wr.DragDrop.startDragItem=void 0,Wr.DragDrop.isDragging&&this.dragEnd(e)}onStart(e,t,a){let r=i.default.focusedPane,s=!1;if(i.default.hasClass(a.target,"paneScroller"));else if(i.default.hasClass(a.target,"prefixNumList")||i.default.hasClass(a.target,"mdImage"))s=!0;else if(i.default.hasClass(a.target,"emptyItemAddButton"))Wr.menus.openContextMenu({componentName:"ReactContextMenuAddItem",element:a.target,item:this,paneObject:t,pane:r}),s=!0;else if(i.default.hasClass(a.target,"link")){var n=a.target.getAttribute("data-href"),o=_.a.isSelected(e,r);o||y.a.mac&&a.metaKey||!y.a.mac&&a.ctrlKey||!i.default.isUrlImage(n)?(y.a.mac&&a.metaKey||!y.a.mac&&a.ctrlKey||i.default.findParent(a.target,"appLink",2)&&!o)&&(i.default.openUrl(n,a),i.default.preventAndStop(a)):(Wr.menus.openLightbox(n),i.default.preventAndStop(a))}else this.isDraggable()&&r.isItemDraggable()&&(i.default.hasClass(a.target,"collapser")||i.default.hasClass(a.target,"itemMenuIcon")||i.default.findParent(a.target,"agendaTime")||i.default.hasClass(a.target,"itemEditButton")||i.default.hasClass(a.target,"itemPrefix")||i.default.findParent(a.target,"plugin")&&!r.isEditable)?(this.checkDragOnStart(a),i.default.vmMain.updateCursorFromEvent(a)):i.default.hasClass(a.target,"itemCheckbox")||(i.default.hasClass(a.target,"blockHeaderNumItems")?s=!0:Wr.pluginManager.handleTapStart(this,r,a));return s}onMove(e,t){this.checkDragOnMove(e,!1)}onClick(e,t,a){var s=i.default.focusedPane;if(i.default.hasClass(a.target,"blockCollapser"))t.block.toggleCollapsed();else if(i.default.hasClass(a.target,"prefixHeader")||i.default.hasClass(a.target,"prefixBullet"))s.zoomIn(this,{forLoad:!1,showToast:!0}),i.default.preventAndStop(a);else if((i.default.hasClass(a.target,"itemPrefix")||i.default.hasClass(a.target,"collapser")||i.default.hasClass(a.target,"itemMenuIcon"))&&(y.a.mac&&a.metaKey||!y.a.mac&&a.ctrlKey))s.zoomIn(this,{forLoad:!1,showToast:!0}),i.default.preventAndStop(a);else if(i.default.hasClass(a.target,"collapser"))s.handleLeftSideTap(t,a),i.default.preventAndStop(a);else if(i.default.hasClass(a.target,"itemMenuIcon"))this.openItemMenu(a),i.default.preventAndStop(a);else if(i.default.hasClass(a.target,"itemTime"))Wr.menus.openContextMenu({componentName:"ReactContextMenuDate",element:a.target,item:this,pane:s}),i.default.preventAndStop(a);else if(i.default.hasClass(a.target,"link")){var n=a.target.getAttribute("data-href");i.default.openUrl(n,a),i.default.preventAndStop(a)}else if(i.default.hasClass(a.target,"itemCheckbox"))s.handleRightSideTap(this,a),i.default.preventAndStop(a);else if(i.default.hasClass(a.target,"prefixTask"))s.supportCompleting&&(i.default.beginCompleteAction(),this.setComplete(!this.isComplete(),r.a.ChangeType.Local),s.selectNearestItem(e),i.default.endCompleteAction()),i.default.preventAndStop(a);else if(i.default.hasClass(a.target,"itemAddButton")){let t=Wr.settings.getDefaultItemText();this.addItemAtIndex({text:t},0,s);var o=s.indexOfNextVMLI(e,!1,!0);_.a.selectIndex(o,0),i.default.preventAndStop(a)}else if(i.default.hasClass(a.target,"itemEditButton"))_.a.reset(),Wr.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:i.default.findParent(a.target,"item"),item:this,pane:s,selectIndex:0}),i.default.preventAndStop(a);else if("SPAN"===a.target.tagName&&i.default.hasClass(a.target,"itemDataPageLoad"))this.notifyPaginationUpdate();else if(i.default.hasClass(a.target,"tag")||i.default.hasClass(a.target,"date")||i.default.hasClass(a.target,"duration")){let e=a.target.textContent,t=y.a.mac&&a.metaKey||!y.a.mac&&a.ctrlKey,n=a.altKey;if((t||n)&&(_.a.reset(),S.a.reset()),t)s.search.toggleText(e,a.shiftKey);else if(n){P.d.beginAction(),Wr.PaneUpdateBatcher.beginUpdateItems();let t=this.getRawText();i.default.hasClass(a.target,"date")||i.default.hasClass(a.target,"duration")?this.setMooDate(void 0,r.a.ChangeType.Local):(t=t.replace(new RegExp(e,"g"),"").replace(/  +/g," "),this.setText(t,r.a.ChangeType.Local)),Wr.PaneUpdateBatcher.commitUpdateItems(),P.d.endAction()}}else if(i.default.hasClass(a.target,"contact"))if(y.a.mac&&a.metaKey||!y.a.mac&&a.ctrlKey){_.a.reset();let e=a.target.textContent;a.shiftKey?s.search.setValue(e):s.search.addToValue(e)}else{let e=a.target.textContent,t=b.a.findMatchExact(e[0]===r.a.ContactPrefix?e.substr(1):e);t&&Wr.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:a.target,contact:t})}else if(i.default.hasClass(a.target,"email")){if(y.a.mac&&a.metaKey||!y.a.mac&&a.ctrlKey){var l=Wr.pluginManager.getPluginGmail();if(l.isActive()){_.a.reset();var d={to:[{text:"",email:a.target.textContent}]};Wr.menus.openComposeEmail(l,void 0,void 0,d)}}}else Wr.pluginManager.handleTapClick(this,s,a)?Wr.DragDrop.isDragging&&this.dragEnd(a):I.a.hide()}onEnd(e){this.checkDragOnEnd(e),this.isLoupeOpen=!1,i.default.vmMain.updateCursorFromEvent(e)}onCancel(e){Wr.DragDrop.isDragging&&this.dragEnd(e)}openItemMenu(e){Wr.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"menu"+this.id+e.clientX+e.clientY,element:e.target,item:this,pane:i.default.focusedPane,pos:{left:e.pageX,top:e.pageY}})}onRightClick(e,t){this.openItemMenu(t),i.default.preventDefault(t),i.default.stopPropagation(t)}onDoubleClick(e,t){var a=i.default.focusedPane;Wr.pluginManager.handleDoubleTap(this,a,t)&&Wr.DragDrop.isDragging&&this.dragEnd(t)}}})(F),!0),v.a.extendClass(F,((e=B)=>{return class extends e{onChangeRemote(e,t){var a=!1,s=this.getRawText();Object.keys(e).map(n=>{let o,l=e[n];switch(n){case"text":this.onChangeRemoteText(l,t);break;case"parent":a||this.parent()&&this.parent().id===l&&(this.parent().hasChild(this)||this.isNote())||(this.onChangeRemoteParentOrIndex(e),a=!0);break;case"index":a||this.index===l||(this.onChangeRemoteParentOrIndex(e),a=!0);break;case"priority":this.setPriority(l||0,t);break;case"isComplete":this.setComplete(l||!1,t);break;case"isStarred":this.setStarred(l||!1,t);break;case"dateCompleted":this.dateCompleted=l?new Date(l):null,o=!0;break;case"date":this.setMooDate(C.a.fromData(l),t);break;case"note":l?this.addRemoteNote(l,t):this.hasNote()&&this.removeRemoteNote(t);break;case"dateModified":this.dateModified=new Date(l);break;case"flags":let s=i.default.isFlagSet(l,r.a.VMLIFlag.Complete);this.isComplete()!==s?this.setComplete(s,t):this.setFlags(l),w.a.itemSearchChanged(this);break;case"isArchived":l!==this.isArchived()&&(l?this.archiveSelf(t):this.unArchive(t));break;case"isDeleted":l!==this.isDeleted()&&(l?this.deleteSelf(t):this.unDelete(t))}o&&this.parseText(s,t)})}onChangeRemoteText(e,t){this.setText(e,t)}onChangeRemoteParentOrIndex(e){let t=this.parent(),a=e.parent?o.a.getItem(e.parent):t;try{i.default.PAssert(1151,a,"Must have a new parent")}catch(s){i.default.reportError(s)}if(a){if(Wr.PaneUpdateBatcher.beginUpdateItems(),32===(32&e.flags)||this.isNote())this.setParent(a),a.hasNote()&&a.getNote()===this||this.isDeleted()||a.setNote(this,r.a.ChangeType.Remote);else{if(void 0===e.index){let t=o.a.getItemDataLocal(this.getDocumentOwner(),e.id);t&&(e.index=t.index)}try{i.default.PAssert(1152,void 0!==e.index,"Index is undefined")}catch(s){i.default.reportError(s)}if(void 0!==e.index&&(this.index=e.index),!0!==e.isDeleted&&!this.isDeleted()&&!0!==e.isArchived&&!this.isArchived())if(t===a&&a.hasChild(this))a.items.sort(E.a.compareItemIndex);else{this.setParent(a);let i=void 0!==e.index?e.index:this.index,r=a.indexInItemFromStringIndex(i);a.items.splice(r,0,this),t&&t!==a&&t.items.remove(this)}}w.a.itemSearchChanged(this),Wr.PaneUpdateBatcher.commitUpdateItems()}}addRemoteNote(e,t){}removeRemoteNote(e){}}})(F),!0);var N,B=F;var U=(N=class{constructor(e,t,a,r,s,n,o,l,d){this.id=e,this.numItems=0;try{i.default.PAssert(604,i.default.isFunction(l),"Must supply a valid parser")}catch(h){i.default.reportError(h)}this._readonly=!!t,this._isDestructible=!!a,this._enabledFilters=o,this._trackGlobally=!!r,this._requireStoredEls=!!s,this._parser=l,this._owner=d,this._root=void 0,this._data={},this._destroyed=!1}getParser(){return this._parser}areFiltersEnabled(e){return i.default.isAtLeastOneFlagSet(this._enabledFilters,e)}getEnabledFilters(){return this._enabledFilters}isOwner(e){return this._owner===e}destroy(){try{i.default.PAssert(605,this._isDestructible,"Item store must be destructible to destroy")}catch(e){i.default.reportError(e)}this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0}checkDestroyed(){try{i.default.PAssert(606,!this._destroyed,"Should not be using a destroyed item store")}catch(e){i.default.reportError(e)}}trackGlobally(){return this._trackGlobally}requireStoredEls(){return this._requireStoredEls}clearStore(){if(this._isDestructible){for(var e in Wr.PaneUpdateBatcher.beginUpdateItems(),this._data)this._root&&e===this._root.id||this._data[e].destroy();Wr.PaneUpdateBatcher.commitUpdateItems()}this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)}createRoot(e,t){return this.checkDestroyed(),this._root=this.createItem(e,t,void 0,{isRoot:!0},r.a.ChangeType.None),this._root}createItem(e,t,a,s,n,o){try{i.default.PAssert(607,a||s&&s.isRoot,"Must always specify a valid parentID when creating a new item")}catch(u){i.default.reportError(u)}this.checkDestroyed();try{i.default.PAssert(608,!this._data[e],"Should never double-create for the same item, should use update instead")}catch(u){i.default.reportError(u)}var l;if(void 0===n&&(n=r.a.ChangeType.None),a){l=this._data[a];try{i.default.PAssert(609,l,"Parent must be valid if defined")}catch(u){i.default.reportError(u)}}var d={id:e,text:t};if(s)for(var h in s)s.hasOwnProperty(h)&&(d[h]=s[h]);var c=new B(d,{store:this,parent:l,changeType:n,canDestroy:this._isDestructible,noSave:this._readonly,documentOwner:o});return this.numItems++,this._data[c.id]=c,c}createItemRaw(e,t){try{i.default.PAssert(610,t.parent||t&&(t.isRoot||t.noSave||t.noParentOkay),"Must always specify a valid parentID when creating a new item")}catch(r){i.default.reportError(r)}this.checkDestroyed();try{i.default.PAssert(611,!!t.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(r){i.default.reportError(r)}try{i.default.PAssert(612,!!t.noSave===this._readonly,"When creating raw items, noSave must match")}catch(r){i.default.reportError(r)}t.store=this;var a=new B(e,t);try{i.default.PAssert(613,!this._data[a.id],"Should not create an item that already exists in this store",()=>i.default.safeStringify(e))}catch(r){i.default.reportError(r)}return this._data[a.id]=a,this.numItems++,a}destroyItem(e){try{i.default.PAssert(614,this._isDestructible,"ItemStore must be destructible to destroy items")}catch(a){i.default.reportError(a)}var t=this._data[e];try{i.default.PAssert(615,t,"Must always destroy a valid item")}catch(a){i.default.reportError(a)}try{i.default.PAssert(616,!t.isDestroyed(),"Should never destroy an item twice")}catch(a){i.default.reportError(a)}t.parent()&&(t.parent().getChildIndex(t)>=0&&t.parent().removeChild(t,r.a.ChangeType.Local),t.setParent(void 0)),t.destroy(),delete this._data[e]}removeItemFromStore(e){this._data[e].destroy(!0),delete this._data[e]}modifyItemID(e,t){try{i.default.PAssert(617,e.belongsToItemStore(this),"Item must belong to this item store")}catch(a){i.default.reportError(a)}try{i.default.PAssert(618,e.id!==t,"Must actually be modifying the item ID")}catch(a){i.default.reportError(a)}try{i.default.PAssert(619,this._data[e.id],"Must have a valid item stored under the current ID: "+e.id+" - "+t+" - "+e.isDestroyed())}catch(a){i.default.reportError(a)}try{i.default.PAssert(620,!this._data[t],"Must not be overwriting an existing item"+e.id+" - "+t+" - "+e.isDestroyed())}catch(a){i.default.reportError(a)}delete this._data[e.id],this._data[t]=e}manualModifyItemID(e,t){try{i.default.PAssert(621,!this._data[t],"Must not be overwriting an existing item"+e+" - "+t)}catch(r){i.default.reportError(r)}var a=this._data[e];try{i.default.PAssert(622,a,"Must have valid item to change its ID")}catch(r){i.default.reportError(r)}a&&(delete this._data[e],this._data[t]=a)}addItemToRoot(e){this._root.items.push(e)}removeItemFromRoot(e){this._root.items.remove(e)}getItem(e){return this.checkDestroyed(),this._data[e]}hasItem(e){return this.checkDestroyed(),!!this._data[e]}getRoot(){return this.checkDestroyed(),this._root}isRoot(e){return this.checkDestroyed(),this._root===e}getCount(){return this.checkDestroyed(),Object.keys(this._data).length}forEach(e){for(var t in this.checkDestroyed(),this._data)this._data[t]&&e(this._data[t])}_markPaneDirty(e){e.usesItemStore(this)&&e!==i.default.focusedPane&&e.setItemsDirty()}updateItems(e){e&&!e.belongsToItemStore(this)||(Wr.PaneManager.runForEachPane(t=>{t.usesItemStore(this,e)&&(t.preventUpdateItemsForItem&&t.preventUpdateItemsForItem.item===e||t.setItemsDirty())}),Wr.PaneUpdateBatcher.updateAllItems())}onItemChanged(e,t){var a;e&&!e.belongsToItemStore(this)||(Wr.PaneManager.runForEachPane(i=>{if(i.usesItemStore(this,e)){let r=i.handleItemChanged(e,t);a=a||r}}),Wr.PaneUpdateBatcher.updateAllItemHeights()),a&&Wr.PaneUpdateBatcher.updateAllItems()}},p()(N.prototype,"_markPaneDirty",[f.a],Object.getOwnPropertyDescriptor(N.prototype,"_markPaneDirty"),N.prototype),p()(N.prototype,"updateItems",[f.a],Object.getOwnPropertyDescriptor(N.prototype,"updateItems"),N.prototype),N),H="DefaultStore",V="TempStore";var j,z=class extends g.a{constructor(){super(),this._itemStores={},this._iteratingStores=!1,this.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"}}init(){var e=r.a.ItemStoreFilter.Dates|r.a.ItemStoreFilter.Priority;this.registerItemStore(H,void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:e}).createRoot("Item store root","Item store root"),this._tempItemStore=this.registerItemStore(V,void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})}registerItemStore(e,t,a){try{i.default.PAssert(305,!this._itemStores[e],"Should only register a single item store per plugin: ",e)}catch(p){i.default.reportError(p)}try{i.default.PAssert(306,!this._iteratingStores,"Should never add a store while iterating")}catch(p){i.default.reportError(p)}var s=!0,n=!0,o=!0,l=!0,d=!1,h=r.a.ItemStoreFilter.None,c=D.a.runParseText;a&&(void 0!==a.isReadonly&&(s=a.isReadonly),void 0!==a.isDestructible&&(n=a.isDestructible),void 0!==a.enabledFilters&&(h=a.enabledFilters),void 0!==a.parserFn&&(c=a.parserFn),void 0!==a.trackGlobally&&(o=a.trackGlobally),void 0!==a.requireStoredEls&&(l=a.requireStoredEls),void 0!==a.listenToItemStateChanged&&(d=a.listenToItemStateChanged));var u=new U(e,s,n,o,l,d,h,c,t);return a&&a.noRegister||(this._itemStores[e]=u,this.fireEvent(this.Events.StoreAdded,u.getEnabledFilters(),[u])),u}unregisterItemStore(e){try{i.default.PAssert(307,this._itemStores[e],"Must register an item store before destroying it")}catch(a){i.default.reportError(a)}try{i.default.PAssert(308,!this._iteratingStores,"Should never remove a store while iterating")}catch(a){i.default.reportError(a)}var t=this._itemStores[e];delete this._itemStores[e],t.destroy(),this.fireEvent(this.Events.StoreRemoved,t.getEnabledFilters(),[t])}getItemStore(e){try{i.default.PAssert(309,this._itemStores[e],"Must register an item store before using it")}catch(t){i.default.reportError(t)}return this._itemStores[e]}getDefaultItemStore(){return this._itemStores[H]}getTempItemStore(){return this._tempItemStore}runForEachStore(e,t){for(var a in t=t||r.a.ItemStoreFilter.None,this._iteratingStores=!0,this._itemStores)if(this._itemStores.hasOwnProperty(a)){var s=this._itemStores[a];if(t===r.a.ItemStoreFilter.None||s.areFiltersEnabled(t))try{e(s)}catch(n){i.default.reportError(n)}}this._iteratingStores=!1}},q=a(46);var W,G=(j=class{constructor(){this.enableTempPanePosition=!1,this.totalWidth=new A.a(0),this._panesById={},this._panes=new M.a,this.displayPanes=new M.a,this.isLoading=new A.a(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0}init(){}load(){Wr.settings.activeUser.get()&&this.setupInitialTimeout(),this.isLoaded||(this._panes.listen(this.updateDisplayPanes),y.a.onResize.listen(this.onResize),n.a.listen("panesChanged",this.updateDisplayPanes),this.onResize(),this.isLoaded=!0)}getStats(e){var t={};return void 0===e?this.runForEachPane(e=>{t[e.id]=e.getStats()}):t=this.getPaneById(e).getStats(),t}setupInitialTimeout(){0===this._panes.length()&&(clearTimeout(this._initialTimeout),this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))}notifyPanes(){this._panes.notify()}onResize(){this.updatePaneRects()}getNextPaneID(){return++i.default.totalPanes+"P"+Date.now()}getAllPerPaneState(e,t){for(var a=0,i=[],r=this.paneCount(),s=0;s<r;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this.getPaneAtIndex(s);i.push(n.getPerPaneState(e,t))}return i}setAllPerPaneState(e,t,a){for(var i=0,r=this.paneCount(),s=0;s<r;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.getPaneAtIndex(s).setPerPaneState(e,t,a)}}deletePerPaneState(e,t){var a=this.getPaneById(e);a&&a.deletePerPaneState(t)}updatePaneStateForPane(e){try{i.default.PAssert(644,e,"Must pass in a valid pane to update")}catch(t){i.default.reportError(t)}this.savePaneState()}recreatePaneState(){var e=[];return this.runForEachPane(t=>{e.push(t.getSaveInfo())}),e}isPaneActive(e){return!!this._panesById[e]}createPaneAtIndex(e,t,a,r){try{i.default.PAssert(645,e,"Must supply a valid pane type")}catch(n){i.default.reportError(n)}try{i.default.PAssert(646,!this._iteratingPanes,"Should not change pane array while iterating")}catch(n){i.default.reportError(n)}isNaN(t)&&(t=this.paneCount()),(a=a||{}).id=a.id||this.getNextPaneID(),a.document=a.document||o.a.getDefaultDocument(),i.default.isString(a.item)&&(a.item=o.a.getItem(a.item));var s=q.a.createPane(e,a);return s?this.addPaneAtIndex(s,t,!1,r):i.default.reportError(new Error("Invalid pane created: "+e+" | "+t)),s}addPaneAtIndex(e,t,a,s){try{i.default.PAssert(647,e,"Must supply a valid pane")}catch(l){i.default.reportError(l)}this._panesById[e.id]&&(e.id=this.getNextPaneID());try{i.default.PAssert(648,!this._panesById[e.id],"Should never add the same pane twice")}catch(l){i.default.reportError(l)}if(this._panesById[e.id]=e,this.enableTempPanePosition&&this._panes.length()>0&&t===this._panes.length()){var n=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:n,left:n.rect.get().left+r.a.PaneSpaceSize}}if(isNaN(t)?this._panes.push(e,s):this._panes.splice(t,0,e,s),e.init(),e.isExpanded.listen(this.onResize),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(e),!a){var o=this.getPaneState();isNaN(t)?o.push(e.getSaveInfo()):o.splice(t,0,e.getSaveInfo()),this.savePaneState()}}unloadPane(e){e.unload(),e.isExpanded.unlisten(this.onResize),n.a.fireEvent("paneRemoved",[e]);try{i.default.PAssert(649,this._panesById[e.id],"Should never add the same pane twice")}catch(t){i.default.reportError(t)}this._panesById[e.id]=void 0,e.destroy()}removePaneAtIndex(e,t){try{i.default.PAssert(650,!isNaN(e),"Must supply a valid index to remove from")}catch(s){i.default.reportError(s)}try{i.default.PAssert(651,!this._iteratingPanes,"Should not change pane array while iterating")}catch(s){i.default.reportError(s)}var a,r=this._panes.splice(e,1,void 0,t)[0];try{i.default.PAssert(652,r,"Must have removed a valid pane")}catch(s){i.default.reportError(s)}return this.unloadPane(r),this.getPaneState().splice(e,1),this.savePaneState(),a=r.id,this.ensurePaneInView(),a}loadPaneFromState(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];{let s=e.item||e.focus,n=s&&o.a.getItem(s),l=e.document,d=o.a.getDocumentById(l);n&&n.isDeleted()&&(n=void 0);var t,a=e.type||"PaneTask",r=i.default.clone(e);return r.item=n,r.document=d,r.deferredItemID=n?void 0:s,r.offset=e.offset,r.id&&this.isPaneActive(r.id)||(t=q.a.createPane(a,r))&&(e.id=t.id,e.showarch&&t.showArchived.set(!0),t.applyItemState(e.itemState)),t}}removeFocusedPane(){return this.removePane(i.default.focusedPane)}removePane(e){var t=this.getPaneIndex(e);return this.removePaneAtIndex(t)}clearPanes(e){try{i.default.PAssert(653,i.default.isDemoMode(),"Should only be clearing panes in demo mode")}catch(t){i.default.reportError(t)}_.a.setFocusedPane(void 0),this.runForEachPane(e=>{e.destroy()}),this._panesById={},this._panes.set([],e)}clearPaneCaches(){this.runForEachPane(e=>{e.getInfiniteList().clearCache()})}getPaneAtIndex(e){return this._panes.get()[e]}getPaneIndex(e){return this._panes.get().indexOf(e)}getFocusedPaneIndex(){return this.getPaneIndex(i.default.focusedPane)}getPaneById(e){try{i.default.PAssert(656,this._panesById[e],"Should never request a pane that is not currently loaded")}catch(t){i.default.reportError(t)}return this._panesById[e]}getPaneByName(e){try{i.default.PAssert(657,this._panesByName[e],"Should never request a pane that is not currently loaded")}catch(t){i.default.reportError(t)}return this._panesByName[e]}getPanesByType(e){for(var t=0,a=[],i=this.paneCount(),r=0;r<i;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=this.getPaneAtIndex(r);e&&s.type!==e||a.push(s)}return a}paneCount(){return this._panes.get().length}runForEachPane(e,t){var a=0;this._iteratingPanes=!0;for(var r=this.paneCount(),s=0;s<r;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this.getPaneAtIndex(s);try{i.default.PAssert(658,!n.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(o){i.default.reportError(o)}if(!t||n.type===t)try{e(n)}catch(l){i.default.reportError(l)}}this._iteratingPanes=!1}applyFnToPanes(e,t){var a=0;this._iteratingPanes=!0;for(var r=this.paneCount(),s=0;s<r;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this.getPaneAtIndex(s);try{i.default.PAssert(659,!n.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(l){i.default.reportError(l)}if(!t||n.type===t){var o=n[e];try{i.default.PAssert(660,o,"Must provide a valid function name for the given pane type")}catch(l){i.default.reportError(l)}try{o.apply(n,Array.prototype.slice.call(arguments,2))}catch(d){i.default.reportError(d)}}}this._iteratingPanes=!1}dragPaneTo(e,t,a){for(var i,r=0,s=this._panes.get(),n=s.indexOf(e),o=-1,l=Number.MAX_VALUE,d=this.paneCount(),h=0;h<d;++h){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=this.getPaneAtIndex(h).rect.get(),u=Math.abs(h<=n?c.left-t:c.right-a);u<l&&(l=u,o=h)}if(o>=0){var p=s.indexOf(e);p!==o&&(s.splice(o,0,s.splice(p,1)[0]),this._panes.set(s),this.savePaneState(),i=!0)}return i}paneSortFn(e,t){return e.uniquePaneID-t.uniquePaneID}clearLoadTimeout(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0,Wr.toasts.clearMessage(r.a.MessageID.PaneLoadTimeout)}updateDisplayPanes(){var e=0;this._initialTimeout&&this.clearLoadTimeout();for(var t=this._panes.get().slice(0).sort(this.paneSortFn),a=[],i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i];r.isOverviewVisible()&&a.push({type:"overview",pane:r}),a.push({type:"pane",pane:r}),r.isExpanded.get()&&a.push({type:"emailPreview",pane:r})}this.updatePaneRects(),this.displayPanes.set(a),this.isLoading.set(!1)}hasScrollbar(){return this.totalWidth.get()>y.a.windowWidth()}onBoardChanged(){this.loadPanesFromState()}_addPaneByButton(e,t,a,r){var s=this.createPaneAtIndex(e,void 0,{viewState:{viewMode:t},item:a});s&&(P.d.performAction(P.b.UIAction,{type:P.c.AddPane,data:{type:e,pane:s}}),i.default.sendEvent("Menu","AddPane_"+e)),_.a.setFocusedPane(s),s.onAdded()}addPaneByButton(e,t,a){q.a.canCreatePane(e)&&this._addPaneByButton(e,t,a)}emailPreviewSize(e){var t=this._panes.length()>1?r.a.EmailPreviewSizeMaxFlex:r.a.EmailPreviewSizeMax,a=e.widthManual||r.a.ExpandedPaneWidth;return e.getOverview().isVisible.get()&&(a+=r.a.OverviewWidth),Math.max(Math.min(t,y.a.windowWidth()-a),r.a.EmailPreviewSizeMin)}onLoadRemote(){}},p()(j.prototype,"onResize",[f.a],Object.getOwnPropertyDescriptor(j.prototype,"onResize"),j.prototype),p()(j.prototype,"updateDisplayPanes",[f.a],Object.getOwnPropertyDescriptor(j.prototype,"updateDisplayPanes"),j.prototype),j),K=a(26);var Y,X=(W=class extends G{constructor(){super()}load(){this.isLoaded||(K.a.init(),super.load(),Wr.DesktopUI.sidebarChanged.listen(this.onResize),Wr.intro&&setTimeout(()=>{Wr.intro.isVisible.listen(this.onResize)},0))}onPluginGmailToggled(){this.savePaneState(),this.loadPanesFromState()}loadPanesFromState(){this.load();var e=this.getPaneState();if(e){var t=0,a=!1;this._isLoading=!0;var i=[];if(Wr.PaneUpdateBatcher.beginUpdateItems(),this.paneCount()>0){var r=0;for(let e=0;e<this.paneCount();++e){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;let t=this.getPaneAtIndex(e);i.push(t.id),this.unloadPane(t)}this._panes.set([],!1)}for(let r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let s=e[r];i.indexOf(s.id)>=0&&(s.id=this.getNextPaneID());let n=this.loadPaneFromState(s);n?(this.addPaneAtIndex(n,void 0,!0,!1),n.zoomIn(n.getItem(!0),{forLoad:!0})):(e.splice(r,1),a=!0,--r)}this.paneCount()>0&&_.a.setFocusedPane(this.getPaneAtIndex(0)),this._isLoading=!1,a&&this.savePaneState(),this.notifyPanes(),Wr.PaneUpdateBatcher.commitUpdateItems()}}loadPaneFromState(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];{let s=e.item||e.focus,n=s&&o.a.getItem(s),l=e.document,d=o.a.getDocumentById(l);n&&n.isDeleted()&&(n=void 0);var t,a=e.type||"PaneTask",r=i.default.clone(e);return r.item=n,r.document=d,r.deferredItemID=n?void 0:s,r.offset=e.offset,this._panesById[e.id]&&(e.id=this.getNextPaneID()),r.id&&this.isPaneActive(r.id)||(t=q.a.createPane(a,r))&&(e.id=t.id,e.showarch&&t.showArchived.set(!0),t.applyItemState(e.itemState)),t}}savePaneState(){try{i.default.PAssert(399,!this._isLoading,"Bad stuff! Saving pane state during load")}catch(t){i.default.reportError(t)}if(this._isInitialStateLoaded&&Wr.settings.activeUser.get()){var e=this.recreatePaneState();K.a.savePaneState(e)}}getPaneState(){return K.a.getPaneState()}hasLoadedPaneState(){return K.a.hasLoadedPaneState()}loadInitialState(){var e=i.default.isDemoMode()&&v.a.getURLParam("panes"),t=e&&e.split(":");t?this.loadDemoPanes(t):this.loadPanesFromState(),K.a.selectedChanged.listen(this.onBoardChanged.bind(this)),this._isInitialStateLoaded=!0}addBoard(){var e=K.a.add();return this.switchToBoard(e),e}switchToBoard(e){K.a.switchTo(e)}removePanesByType(e){var t=0,a=[];this.runForEachPane(function(e){a.push(e)},e);for(var i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.removePane(a[i])}}getAvailableArea(){return Wr.DesktopUI.getSidebarWidth()-2}updatePaneRects(e){this.isResizingPane=e;var t,a=this._panes.get(),s=Wr.DesktopUI.getSidebarWidth(),o=y.a.windowWidth()-(Wr.DesktopUI.getSidebarWidth()-2),l=y.a.windowHeight()-Wr.DesktopUI.topBarHeight();if(i.default.isDemoInIframe()&&(o-=5),a.length>0){var d,h,c=0,u=0,p=0,g=r.a.PaneSpaceSize,f=[],m=[],v=0;for(t=0;t<a.length;t++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;let e=a[t];e.widthManual?(m[t]=e.widthManual,v+=e.widthManual):e.isExpanded.get()?(m[t]=r.a.ExpandedPaneWidth,v+=r.a.ExpandedPaneWidth):f.push({index:t,pane:e}),e.isExpanded.get()&&(v+=e.widthManualExpanded||this.emailPreviewSize(e)),e.getOverview().isVisible.get()?v+=r.a.OverviewWidth:t>0&&(v+=g)}for(var _=o-v;f.length>0;){var S=0;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var P=Math.floor(_/f.length),I=-1,b=P;for(t=0;t<f.length;t++){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;let e=f[t].pane;e.maxWidthFlex<b&&(I=t,b=e.maxWidthFlex)}if(I>=0){let e=f[I].pane;d=Math.min(1===a.length?e.widthBiggerInSingle?e.maxWidthSingle:e.maxWidthFlex:f[I].pane.maxWidthFlex,_),m[f[I].index]=d,v+=d,_-=d,f.splice(I,1)}else{var D=0,w=-1,E=P;for(t=0;t<f.length;t++){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;let e=f[t].pane;e.minWidthFlex>E&&(w=t,E=e.minWidthFlex)}if(!(w>=0)){var C=0;for(t=0;t<f.length;t++){if(C++>5e3&&__infLoop&&__infLoop(C))throw new RangeError;m[f[t].index]=P,v+=P}break}d=f[w].pane.minWidthFlex,m[f[w].index]=d,v+=d,_-=d,f.splice(w,1)}}var A=Math.max((o-v)/2,0),M=Math.floor(A)+s,T=!1;for(M!==Math.round(A)&&(T=v+1===o),i.default.isDemoInIframe()&&(M+=2),t=0;t<a.length;t++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;let e=a[t];d=m[t]+(T&&t===a.length-1?1:0),h=e.isExpanded.get()?e.widthManualExpanded||this.emailPreviewSize(e):0,e.isOverviewVisible()?M+=r.a.OverviewWidth:0!==t&&(M+=g),this.tempPositionForNewPane&&e.rect.get()?(e.rect.get().width=d,e.rect.notify()):e.rect.set({left:M,top:0,width:d,height:l,right:M+d,bottom:l,isFirst:0===t,widthExpanded:h}),M+=d,e.isExpanded.get()&&(M+=h)}Wr.intro&&Wr.intro.isVisible&&Wr.intro.isVisible.get()&&(M+=g,Wr.intro.position.set(M))}if(this.tempPositionForNewPane){var L=a[a.length-1].rect.get(),x=this.tempPositionForNewPane;L.left=x.left+x.pane.rect.get().width}this.totalWidth.set(M),e||n.a.fireEvent("paneSizeChanged",[])}ensurePaneInView(e){if(i.default.vmMain.panesContainer){if(!e){var t=this._panes.get();e=t[t.length-1]}if(e){var a=e.rect.get();if(a){var r=a.width+(e.isExpanded.get()?a.widthExpanded:0),s=y.a.windowWidth()-(Wr.DesktopUI.getSidebarWidth()-2),n=i.default.vmMain.getScrollOffset(),o=a.left-n,l=a.left+r-n;(o<0||l>s)&&i.default.vmMain.setScrollOffset(a.left+r-s)}}}}scrollToAndHighlightItem(e,t){e.highlight(),this.runForEachPane(function(a){if(a!==t){var i=a.indexOfItem(e);if(i<0&&a.type===r.a.PaneMode.Task&&a.isViewOutline()&&e.isDescendantOf(a.item.get())&&a.search.isMatched(e)){var s=0;Wr.PaneUpdateBatcher.beginUpdateItems();for(var n=e.parent();n&&n!==a.item.get();){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;n.isCollapsed(a,!1)&&(a.setIgnoreRestoreScroll(),n.setCollapsed(!1,a,!1)),n=n.parent()}Wr.PaneUpdateBatcher.commitUpdateItems(),i=a.indexOfItem(e)}i>=0&&a.scrollIndexToMiddle(i,r.a.ScrollDuration.Default)}})}_timeoutLoadFailed(){0===this._panes.length()&&0===Wr.menus.modalStack.length()&&(i.default.reportError(new Error("Pane Load Timeout")),Wr.toasts.pushMessage(r.a.MessageID.PaneLoadTimeout))}loadDemoPanes(e){var t=0;this.load(),Wr.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e[a].split(",");if("help"===s[0])i.default.vmMain.showHelp();else{var n=s[0],l={document:o.a.getDefaultDocument()};if("1"===n||"Outline"===n?(n=r.a.PaneMode.Task,l.viewState={viewMode:r.a.TaskViewMode.Outline}):("2"===n||"Calendar"===n)&&(n=r.a.PaneMode.Task,l.viewState={viewMode:r.a.TaskViewMode.Calendar_Week}),s.length>1){if(s[1]){for(var d=0,h={text:s[1]},c=s[1].split(" "),u=0;u<c.length;u++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var p=!1,g="-"===c[u][0],f=c[u].replace("-","");if(f.indexOf("//")>=0)p=!0,h.complete=g?-1:1;else if(f.indexOf("*")>=0)p=!0,h.starred=g?-1:1;else if(f.indexOf("!")>=0){var m;p=!0,3===f.length?m=r.a.VMLIFlag.P0:2===f.length?m=r.a.VMLIFlag.P1:1===f.length&&(m=r.a.VMLIFlag.P2),h.priority=m}p&&(h.text=h.text.replace(c[u],""))}l.search=h}var v=void 0;s[2]&&(v=o.a.getItem(s[2])),l.item=v}var y=q.a.createPane(n,l);y&&this.addPaneAtIndex(y)}}var S=this.getPaneAtIndex(0);try{i.default.PAssert(400,S,"Must always have at least one valid pane in demo mode")}catch(P){i.default.reportError(P)}S&&(_.a.setFocusedPane(S),S.zoomIn(S.getItem(),{forLoad:!0})),this.notifyPanes(),Wr.PaneUpdateBatcher.commitUpdateItems()}},p()(W.prototype,"savePaneState",[f.a],Object.getOwnPropertyDescriptor(W.prototype,"savePaneState"),W.prototype),W),Q=a(143),$=a(52);var J=new(Y=class{constructor(){this.scheduledItems=[],this.notifiedItems={},this.timeouts={},this.timeoutNextNotification=void 0,this.frequency=15*r.a.MSPerMinute}scheduleItems(e){this.scheduledItems=e,y.a.hasNotificationPermission()?this.runNotifications():Notification.requestPermission(()=>{this.runNotifications()})}runNotifications(){for(var e=0,t=0;t<this.scheduledItems.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.scheduledItems[t];this.notifiedItems[a.id]&&this.notifiedItems[a.id]===a.date||this.runNotification(a)}i.default.shouldLog(r.a.LogLevels.Timeline)&&i.default.log("Next Notifications in: ",this.frequency),clearTimeout(this.timeoutNextNotification),this.timeoutNextNotification=setTimeout(this.runNotifications,this.frequency)}runNotification(e){var t=e.id,a=new Date,i=e.alertDate,r=Math.max(i.getTime()-a.getTime(),0);r<0&&this.doNotification(e),r>=0&&r<=this.frequency?(clearTimeout(this.timeouts[t]),this.timeouts[t]=setTimeout(this.doNotification.bind(this,e),r)):this.notifiedItems[t]=e.date}doNotification(e){var t=e.date,a=Math.ceil((t.getTime()-Date.now())/r.a.MSPerMinute);new Notification(e.text,{body:a>0?"in "+a+" minutes":"now",icon:y.a.isNativeApp()?void 0:"/img/favicon-96x96.png",requireInteraction:!0});this.notifiedItems[e.id]=e.date,i.default.shouldLog(r.a.LogLevels.Timeline)&&i.default.log("Show HTML5 Notification: ",e)}},p()(Y.prototype,"runNotifications",[f.a],Object.getOwnPropertyDescriptor(Y.prototype,"runNotifications"),Y.prototype),Y);var Z,ee=new class{setNotifications(e){y.a.usesHTML5Notifications()?(J.scheduleItems(e),i.default.shouldLog(r.a.LogLevels.Timeline)&&i.default.log("HTML5 Scheduling Completed: ",e.length)):Wr.nativeBridge.isEnabled()?Wr.nativeBridge.sendToApp("scheduledItems",this.convertForSend(e)):Wr.nativeBridge.hasEmbedBridge()&&Wr.nativeBridge.sendToEmbed("scheduledItems",this.convertForSend(e))}convertForSend(e){return e.map(e=>({id:e.id,text:e.text,date:e.date.toJSON(),alertDate:e.date.toJSON()}))}};var te=(Z=class{constructor(){this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,this.oldSoftDates=["now","next","soon","later","someday"],this.agendaSort=Wr.settings.agendaSort}clearDailyCaches(){}addNotification(e){try{i.default.PAssert(332,e,"Must provide a valid item to schedule notifications for")}catch(t){i.default.reportError(t)}this.notificationItems[e.id]=e,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),i.default.shouldLog(r.a.LogLevels.Timeline)&&i.default.log("Add Notification: ",e)}removeNotification(e){try{i.default.PAssert(333,e,"Must provide a valid item to unschedule notifications for")}catch(t){i.default.reportError(t)}this.notificationItems[e.id]&&(this.notificationItems[e.id]=void 0,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),i.default.shouldLog(r.a.LogLevels.Timeline)&&i.default.log("Remove Notification: ",e))}clearNotifications(){for(var e in this.notificationItems)this.notificationItems.hasOwnProperty(e)&&(this.notificationItems[e]=void 0,this.numNotificationItemsChanged++);clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),i.default.shouldLog(r.a.LogLevels.Timeline)&&i.default.log("Clear Notifications")}shouldNotify(e,t){var a=e.getNextDate();return!e.isDestroyed()&&!e.isDeleted()&&!e.isComplete()&&!e.hasCompletedAncestor()&&!e.allDayDate()&&a&&a>t&&+a-Date.now()<864e5}updateNotifications(e){if(y.a.supportsNotifications()&&$.a.isNotificationsEnabled()&&!i.default.isDemoMode()){var t=new Date;e?(i.default.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(e,t)?this.addNotification(e):this.removeNotification(e)):(i.default.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),o.a.runOnAllDocumentRoots(e=>{i.default.searchVMLIs({item:e,each:e=>{this.shouldNotify(e,t)&&this.addNotification(e)}})}))}}setupNotifications(){try{i.default.PAssert(334,y.a.supportsNotifications(),"Platform must support notifications")}catch(n){i.default.reportError(n)}var e=[];for(var t in this.notificationItems)if(this.notificationItems.hasOwnProperty(t)){var a=this.notificationItems[t];if(a&&a.getNotificationEntry){var s=a.getNotificationEntry();s&&e.push(s)}else delete this.notificationItems[t]}ee.setNotifications(e),i.default.shouldLog(r.a.LogLevels.Timeline)&&i.default.log("Notifications Scheduled: "+this.numNotificationItemsChanged),this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,i.default.shouldLog(r.a.LogLevels.Timeline)&&i.default.log("Scheduled Notifications: ",e)}getDateForKey(e){return this.oldSoftDates.indexOf(e)>=0&&(e="#"+e),this.agendaSort.get()[e]}saveAgendaSort(e){this.agendaSort.set(e),Wr.settings.agendaSort.set(e),Wr.PaneManager.runForEachPane(function(e){e.isViewAgenda()&&e.setItemsDirty()}),Wr.PaneUpdateBatcher.updateAllItems()}},p()(Z.prototype,"updateNotifications",[f.a],Object.getOwnPropertyDescriptor(Z.prototype,"updateNotifications"),Z.prototype),p()(Z.prototype,"setupNotifications",[f.a],Object.getOwnPropertyDescriptor(Z.prototype,"setupNotifications"),Z.prototype),Z);var ae=class{constructor(){this._registeredRenderers=[],this._registeredRenderers[r.a.PluginRenderTypes.Generic]={},this._registeredRenderers[r.a.PluginRenderTypes.StyledText]={},this._registeredRenderers[r.a.PluginRenderTypes.UnstyledText]={},this._registeredRenderers[r.a.PluginRenderTypes.Measure]={}}registerDefaultRenderers(){var e=this;this.registerRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.DriveFile,(e,t,a,i)=>{if(e.isLoaded()){var r=e.getField("title");return i&&i.highlightSearch&&(r=Wr.ElementRenderer.replaceTextWithSearch(r,t)),e.hasField("isDeleted")&&e.getField("isDeleted")?r+"  (Deleted)":r}return e.hasField("title")?e.getField("title")+"  (Loading...)":e.isLocalOnlyAttachment()?"Failed upload":"Loading..."},["title"]),this.registerRenderer(r.a.PluginRenderTypes.UnstyledText,r.a.PluginRenderers.DriveFile,e=>e.hasField("title")?e.getField("title"):"Loading...",["title"]),this.registerRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.DriveFile,(t,a,i)=>{var s=e.useRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.DriveFile);return Wr.Measure.measureWord(a,s(t),i,!1)},["title"]),this.registerRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.EmailThread,(e,t,a,i)=>{var s="";if(e&&e.isLoaded()){var n=e.getField("count"),o=e.getPlugin(),l=e.getField("subject");if(l&&""!==l||(l="(no subject)"),i&&i.highlightSearch&&(l=Wr.ElementRenderer.replaceTextWithSearch(l,t)),l='<span class="subject c-foreground">'+l+"</span>",t&&t.type===r.a.PaneMode.Gmail){var d=o.getDisplayTags(e,t);s+='<span class="line1"><span class="from">'+o.getDisplayParticipants(e)+"</span>";var h,c=e.getField("date");if(h=c.isToday()?Wr.International.getFormat(r.a.DFormat.ShortTime):c.getYear()!==(new Date).getYear()?Wr.International.getFormat(r.a.DFormat.MonthDayYearShort):Wr.International.getFormat(r.a.DFormat.MonthDay),s+='<span class="emailDate c-foreground-faded">'+c.toString(h)+"</span></span>",s+='<span class="line2">'+l,(e.getField("hasAttachments")||n>1)&&(s+='<span class="line2Right">',e.getField("hasAttachments")&&(s+='<span class="attach icon-attach_file"></span>'),n>1&&(s+='<span class="count">'+n+"</span>"),s+="</span>"),s+="</span>",e.hasField("snippet")||d.length){if(s+='<span class="line3">',e.hasField("snippet")&&(s+='<span class="snippet c-foreground-faded">'+e.getField("snippet")+"</span>"),d.length){var u=0;s+='<span class="tags">';for(var p=0;p<d.length;++p){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;s+='<span class="emailLabel c-tag">'+d[p]+"</span>"}s+="</span>"}s+="</span>"}}else s=l}else s="Loading...";return s},["from","subject","snippet","count","date"]),this.registerRenderer(r.a.PluginRenderTypes.UnstyledText,r.a.PluginRenderers.EmailThread,e=>{if(e.isLoaded()){var t=e.getField("subject");return t&&""!==t||(t="(no subject)")," "+t+" "}return"Loading..."},["from","subject"]),this.registerRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.EmailThread,(e,t,a)=>{var i;return e.isLoaded()?(i=e.getField("subject"))&&""!==i||(i="(no subject)"):i="Loading...",Wr.Measure.measureWord(t,i,a,!1)},[]),this.registerRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.CalendarEvent,e=>"",[]),this.registerRenderer(r.a.PluginRenderTypes.UnstyledText,r.a.PluginRenderers.CalendarEvent,e=>"",[]),this.registerRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.CalendarEvent,(t,a,i)=>{var s=e.useRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.CalendarEvent);return Wr.Measure.measureWord(a,s(t),i,!1)},[]),this.registerRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.Unknown,e=>"Unknown Plugin",[]),this.registerRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.Unknown,(e,t,a)=>Wr.Measure.measureWord(t,"Unknown Plugin",a,!0),[])}registerRenderer(e,t,a,r){try{i.default.PAssert(684,this._registeredRenderers[e],"Invalid renderer type",e,t)}catch(s){i.default.reportError(s)}try{i.default.PAssert(685,!this._registeredRenderers[e][t],"Cannot register a renderer twice",e,t)}catch(s){i.default.reportError(s)}this._registeredRenderers[e][t]={fn:a,fields:r}}useRenderer(e,t){try{i.default.PAssert(686,this._registeredRenderers[e],"Invalid renderer type",e,t)}catch(a){i.default.reportError(a)}try{i.default.PAssert(687,this._registeredRenderers[e][t],"Renderer has not been registered yet",e,t)}catch(a){i.default.reportError(a)}return this._registeredRenderers[e][t].fn}ensureRendererFields(e,t,a){}},ie=a(18),re=a(31),se={Unloaded:1,Waiting:2,Requesting:3,LoadedPreview:4,LoadedFull:5,FailedRequest:6,Updating:7},ne=3;var oe,le=class{constructor(e,t,a){this.id=t,this._oldLocalID=void 0,this._plugin=e,this._loadState=se.Unloaded,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=a,this.load()}load(e){this._loadState=se.Waiting,this._plugin.requestData(this,e)}notifyDataRequested(){try{i.default.PAssert(1522,!this.isLoaded(),"Should not request additional data once loaded")}catch(e){i.default.reportError(e)}this._numRemoteRequests++,this._loadState=se.Requesting}notifyDataLoaded(e,t,a,s){try{i.default.PAssert(1523,t||this._loadState!==se.LoadedFull||i.default.isFlagSet(e,r.a.PluginLoad.Full),"Should not load preview data after full data has been loaded")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1524,!t||this._loadState===se.LoadedPreview||i.default.isFlagSet(e,r.a.PluginLoad.Full),"Incoming update much match previous type")}catch(n){i.default.reportError(n)}this._loadState=i.default.isFlagSet(e,r.a.PluginLoad.Full)?se.LoadedFull:se.LoadedPreview,this.onUpdate(!0,a,s)}notifyDataMutated(e,t){try{i.default.PAssert(1525,e&&i.default.isArray(e),"Must specify valid update fields when mutating attachment state manually")}catch(a){i.default.reportError(a)}this.onUpdate(!0,e,t)}notifyDataRequestFailed(){try{i.default.PAssert(1526,this._loadState===se.FailedRequest||this._loadState===se.Requesting||this._loadState===se.LoadedPreview,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(e){i.default.reportError(e)}if(this._loadState===se.FailedRequest);else if(this._loadState===se.Requesting)this._loadState=se.FailedRequest;else if(this._loadState===se.LoadedPreview)try{i.default.PAssert(1527,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(e){i.default.reportError(e)}else try{i.default.PAssert(1528,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(e){i.default.reportError(e)}}isLoaded(){return this._loadState===se.LoadedPreview||this._loadState===se.LoadedFull}needsRemoteData(){return this._loadState!==se.LoadedFull}getOldID(){return this._oldLocalID}changeID(e){try{i.default.PAssert(1529,this.id!==e,"Change the ID of an attachment to the same value")}catch(s){i.default.reportError(s)}if(this.id!==e){var t=0,a=this.id;this.id=e,this._oldLocalID=a;try{i.default.PAssert(1530,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(s){i.default.reportError(s)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._subscribers[r].onAttachmentIDChange(this,a)}catch(n){i.default.reportError(n)}}this._iteratingSubscribers=!1,this._oldLocalID=void 0}}delayChangeID(){var e=0;try{i.default.PAssert(1531,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(s){i.default.reportError(s)}this._iteratingSubscribers=!0;for(var t=0;t<this._subscribers.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._subscribers[t];try{var r=a.onAttachmentIDChange.bind(a,this,this.id);setTimeout(r,0)}catch(n){i.default.reportError(n)}}this._iteratingSubscribers=!1}isFieldDefined(e){return this._plugin.isFieldDefined(e)}hasField(e){return this._plugin.hasAttachField(this,e)}getField(e){return this._plugin.getAttachField(this,e)}updateField(e,t,a,i){return this._plugin.updateAttachField(this,e,t,a,i)}fieldsHaveParseEffect(e){return this._plugin.fieldsHaveParseEffect(e)}isFieldDefault(e){return this._plugin.isAttachFieldDefault(this,e)}fieldNeedsWrite(e,t){return this._plugin.fieldNeedsWrite(this,e,t)}getFieldAsDate(e){var t=this._plugin.getAttachField(this,e);if(t)return new Date(t).toString(Wr.International.getFormat(r.a.DFormat.MonthDay));try{i.default.PAssert(1532,!1,"Invalid attachment date field: ",this._plugin.id,e)}catch(a){i.default.reportError(a)}}getPlugin(){return this._plugin}getData(){return this._plugin.getCacheData(this.id)}getEmbedString(){return this._plugin.getAttachmentEmbedString(this)}getTitleString(){return this._plugin.getAttachmentTitleString(this)}unload(){this._loadState=se.Unloaded,this._plugin.releaseAttachment(this)}match(e){return!!this.isLoaded()&&this._plugin.matchAttachment(this,e)}markInUse(e){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,e),this._countInUse++}markUnused(e){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,e);try{i.default.PAssert(1533,this._countInUse>=0,"Should never have negative users of the attachment")}catch(t){i.default.reportError(t)}}isInUse(){return this._countInUse>0}subscribe(e){try{i.default.PAssert(1534,this._subscribers.indexOf(e)<0,"Must not double subscribe")}catch(t){i.default.reportError(t)}try{i.default.PAssert(1535,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){i.default.reportError(t)}try{i.default.PAssert(1536,e.onAttachmentUpdate,"Must specify a valid subscriber callback")}catch(t){i.default.reportError(t)}this._subscribers.push(e)}unsubscribe(e){try{i.default.PAssert(1538,this._subscribers.indexOf(e)>=0,"Subscriber should be active")}catch(t){i.default.reportError(t)}try{i.default.PAssert(1539,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){i.default.reportError(t)}this._subscribers.remove(e)}forEachItem(e,t){var a=0;try{i.default.PAssert(1541,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(s){i.default.reportError(s)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i.default.isVMLI(this._subscribers[r])&&(!e||this._subscribers[r].belongsToItemStore(e)))try{t(this._subscribers[r])}catch(n){i.default.reportError(n)}}this._iteratingSubscribers=!1}onUpdate(e,t,a){var s=0;try{i.default.PAssert(1542,!t||i.default.isArray(t),"Must supply a valid value for updateFields:",t)}catch(l){i.default.reportError(l)}if(a=a||r.a.ChangeType.Remote,e&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(d){i.default.reportError(d)}if(e||(a|=r.a.ChangeType.PluginLoad),t)for(var n=0,o=0;o<t.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;try{i.default.PAssert(1543,this._plugin.isFieldDefined(t[o]),"Invalid field supplied to be updated: ",t[o])}catch(l){i.default.reportError(l)}}try{i.default.PAssert(1544,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(l){i.default.reportError(l)}for(this._iteratingSubscribers=!0,o=0;o<this._subscribers.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;try{this._subscribers[o].onAttachmentUpdate(this,t,a)}catch(d){i.default.reportError(d)}}this._iteratingSubscribers=!1}notifyItemNoteChanged(e){this._plugin.notifyItemNoteChanged(this,e)}notifyItemTextChanged(e,t){this._plugin.notifyItemTextChanged(this,e,t)}notifyItemDateChanged(e){this._plugin.notifyItemDateChanged(this,e)}notifyItemPropertyChanged(e,t,a){this._plugin.notifyItemPropertyChanged(this,e,t,a)}isLocalOnlyAttachment(){return i.default.isTempId(this.id)}isType(e){return this._plugin.getType()===e}isPlugin(e){return this._plugin.id===e}shouldBeDeleted(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()}hasFatalError(){return this._loadState===se.FailedRequest&&this._numRemoteRequests>ne}hasInlineData(){return!!this._inlineData}getInlineData(){return this._inlineData}setInlineData(e){this._inlineData=e,this._loadState=se.LoadedFull}clearInlineData(){this._inlineData=void 0}};var de=(oe=class{constructor(e){this._taskCB=e,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,n.a.listen("lowImpactBegin",this.handleLowImpactBegin)}getStats(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}}disable(){this._disabled=!0}enable(){this._disabled=!1}handleLowImpactBegin(){this._startTaskRun()}requestRun(){this._forceRun=!0,this._startTaskRun()}notifyWorkAvailable(){this._workAvailable=!0,i.default.isLowImpact()&&!this._isRunning&&this._startTaskRun()}_startTaskRun(){if(!this._isRunning&&!this._disabled&&this._workAvailable){try{i.default.PAssert(1227,this._forceRun||i.default.isLowImpact(),"Must always run a task during a low impact timeframe")}catch(e){i.default.reportError(e)}this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun)}}_onTaskEndRun(e){try{i.default.PAssert(1228,this._isRunning,"Must be currently running task to finish")}catch(t){i.default.reportError(t)}this._isRunning=!1,this._forceRun=!1,(e||this._workAvailable)&&(this._workAvailable=!0,i.default.isLowImpact()&&this._startTaskRun())}},p()(oe.prototype,"handleLowImpactBegin",[f.a],Object.getOwnPropertyDescriptor(oe.prototype,"handleLowImpactBegin"),oe.prototype),p()(oe.prototype,"_onTaskEndRun",[f.a],Object.getOwnPropertyDescriptor(oe.prototype,"_onTaskEndRun"),oe.prototype),oe);function he(e,t,a,r,s,n){try{i.default.PAssert(1229,i.default.isFunction(s),"Must supply a valid entry CB")}catch(o){i.default.reportError(o)}try{i.default.PAssert(1230,i.default.isFunction(n),"Must supply a valid done CB")}catch(o){i.default.reportError(o)}this._nextPageToken=e,this._inUse=!1,this._q=t,this._info=a,this._maxResults=r,this._entryCB=s,this._doneCB=n}var ce={updateToken:function(e){try{i.default.PAssert(1231,this._nextPageToken!==e,"Should never update token to be same value")}catch(t){i.default.reportError(t)}this._nextPageToken=e},getNextPageToken:function(){return this._nextPageToken},getInfo:function(){return this._info},getQuery:function(){return this._q},getEntryCB:function(){return this._entryCB},getDoneCB:function(){return this._doneCB},getMaxResults:function(){return this._maxResults},hasMorePages:function(){return!!this._nextPageToken},notifyBeginUse:function(){try{i.default.PAssert(1232,!this._inUse,"Should not currently be in use")}catch(e){i.default.reportError(e)}this._inUse=!0},notifyEndUse:function(){try{i.default.PAssert(1233,this._inUse,"Should always be using token when done")}catch(e){i.default.reportError(e)}this._inUse=!1},isInUse:function(){return this._inUse}};v.a.defineBase(he),v.a.extend(he.prototype,ce);var ue=he,pe=a(21),ge=[1,5,20,40,80,170],fe=[r.a.HTTPStatusCode.Network,r.a.HTTPStatusCode.Timeout,r.a.HTTPStatusCode.TooMany,r.a.HTTPStatusCode.ServerError,r.a.HTTPStatusCode.BadGateway,r.a.HTTPStatusCode.Unavailable,r.a.HTTPStatusCode.GatewayTimeout,null],me=[r.a.HTTPStatusCode.Forbidden,r.a.HTTPStatusCode.TooMany],ve={};ve[r.a.PluginDependency.DemoMode]={online:!1},ve[r.a.PluginDependency.GoogleLogin]={online:!0},ve[r.a.PluginDependency.PremiumSub]={online:!1},ve[r.a.PluginDependency.EarlyAccess]={online:!1};const ye=r.a.DETAILED_STATS;class _e{constructor(e,t,a,r,s){try{i.default.PAssert(1015,e,"Must supply a valid id")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1016,a,"Must supply a valid name")}catch(n){i.default.reportError(n)}this.id=e,this.name=a,this.DefaultRequestTimeout=i.default.seconds(15),this.LongWaitThreshold=i.default.seconds(7),this._paneType="Pane"+e,this._acProviderId="AC"+e,this._settingsGroup="plugin"+this.id,this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new A.a(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._attachKeys=[],this._attachCache={},this._dataCache={},this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._requiresOfflineAuth=!1,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this.supportSyncAccounts=!1,this.Settings={},v.a.binder(this,"_retryRemoteRequest","_reqSortFn"),Wr.settings.registerGroup(this._settingsGroup,t,s),this.registerSetting("IsEnabled","isEnabled","e",!0,r),this.getDataPane()&&q.a.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),ye&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,combinedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0},this.__TrackedStats={},this.__ReqStats=[]),this.onSettingChanged(this.Settings.IsEnabled,(e,t)=>{e&&Wr.pluginManager.activatePlugin(this)})}getType(){return r.a.PluginType.Unknown}sendEvent(e,t){return i.default.sendEvent(this.id,e,t)}getSettingObs(e){return Wr.settings[this._settingsGroup][e]}getSetting(e){return Wr.settings[this._settingsGroup][e].get()}setSetting(e,t,a){return Wr.settings[this._settingsGroup][e].set(t,a)}registerSetting(e,t,a,i,r){this.Settings[e]=t,Wr.settings.registerSetting(t,a,this._settingsGroup,i,r)}onSettingChanged(e,t){Wr.settings[this._settingsGroup][e].listen(t)}getCacheStats(e){var t={},a=Object.keys(this._registeredCaches).length,i=0,r=r=>{t[r.id]=r,a===++i&&e(t)};if(a>0)for(var s in this._registeredCaches){if(this._registeredCaches.hasOwnProperty(s))this._registeredCaches[s].getStats(r)}else e()}getCacheState(){var e={};for(var t in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(t)){var a=this._registeredCaches[t];e[t]=a.getState()}return e}registerLocalCache(e,t,a){var i=Wr.cacheManager.registerLocalCache(e,t,a);return this._registeredCaches[e]=i,i}registerDeferredTaskType(e,t,a,r){try{i.default.PAssert(1017,e,"Must specify a valid deferred task type")}catch(s){i.default.reportError(s)}Wr.deferredTaskManager.registerTaskType(e,t,a,r)}scheduleDeferredTask(e,t,a,r){try{i.default.PAssert(1018,e,"Must supply a valid local ID for deferred task")}catch(s){i.default.reportError(s)}try{i.default.PAssert(1019,t,"Must specify a valid deferred task type")}catch(s){i.default.reportError(s)}Wr.deferredTaskManager.scheduleTask(e,t,a,!1,void 0,r)}cancelDeferredTask(e,t){Wr.deferredTaskManager.cancelTask(e,t)}createRecurringTask(e,t){var a,i=this.id+"_"+e,r=Wr.recurringTaskManager;return this.hasRecurringTask(e)?a=r.getRecurringTask(i):(this._recurringTasks.push(e),a=Wr.recurringTaskManager.createRecurringTask(i,t)),a}getRecurringTask(e){return Wr.recurringTaskManager.getRecurringTask(this.id+"_"+e)}hasRecurringTask(e){return Wr.recurringTaskManager.hasRecurringTask(this.id+"_"+e)}cancelRecurringTask(e){var t=this.id+"_"+e;return this._recurringTasks.remove(e),Wr.recurringTaskManager.cancelRecurringTask(t)}cancelRecurringTasks(){for(var e=0;this._recurringTasks.length>0;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.cancelRecurringTask(this._recurringTasks[0])}}getRecurringStats(){for(var e=0,t={},a=0;a<this._recurringTasks.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._recurringTasks[a],r=this.getRecurringTask(i);t[i]=r.getStats()}return t}registerLowImpactTask(e,t){try{i.default.PAssert(1020,!this._lowImpactTasks[e],"Must specify different IDs for each task: ",e)}catch(r){i.default.reportError(r)}var a=new de(t);return this._lowImpactTasks[e]=a,a}getLowImpactStats(){var e={};for(var t in this._lowImpactTasks)if(this._lowImpactTasks.hasOwnProperty(t)){var a=this._lowImpactTasks[t];e[t]=a.getStats()}return e}getTrackedStat(e){if(ye)return this.__TrackedStats[e]}addTrackedStat(e){if(ye){try{i.default.PAssert(1021,!this.__TrackedStats.hasOwnProperty(e),"Should not double define a tracked stat for a plugin")}catch(t){i.default.reportError(t)}this.__TrackedStats[e]=0}}reportTrackedStat(e){if(ye){try{i.default.PAssert(1022,this.__TrackedStats.hasOwnProperty(e),"Must first register a tracked stat before reporting instantces of it")}catch(t){i.default.reportError(t)}this.__TrackedStats[e]++}}getStats(){return{fnCalls:ye?this.__Stats:void 0,tracked:ye?this.__TrackedStats:void 0,remoteReqs:ye?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._numSendRequests>0?this._totalRequestSendTime/this._numSendRequests:0,avgRequestHandleTime:this._numHandledRequests>0?this._totalRequestHandleTime/this._numHandledRequests:0,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}}getState(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState()}}isPluginPane(e){return e.type===this._paneType}getPaneType(){return this._paneType}activate(e){var t=this.isActiveObs.get();if(t||(this.isActiveObs.set(!0),this.useItemStore()&&(this._defaultItemStore=Wr.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions()),this._defaultItemStore.createRoot(this.isActive()?this.useItemStore():this.id+"Root","")),this._hasLoadedCaches||(this.supportUsageCache()&&i.default.shouldWriteLocal()&&this.loadUsageCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive()),this._unloadedDependencies)for(var a in e)e.hasOwnProperty(a)&&this.onDependencyLoaded(a,e[a]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),this._activate&&this._activate(),t||Wr.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),!t}deactivate(){try{i.default.PAssert(1023,this.isActiveObs.get(),"Must be active in order to deactivate pane")}catch(e){i.default.reportError(e)}return this.isActiveObs.set(!1),Wr.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.getDataPane()&&q.a.deactivatePaneType(this._paneType),this.useItemStore()&&(Wr.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0}ensurePaneTypeIsActive(){(!this.hasDependency(r.a.PluginDependency.PremiumSub)||Wr.billingManager.hasPremiumFeatures())&&this.getDataPane()&&!q.a.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||i.default.isDemoMode())&&q.a.activatePaneType(this._paneType)}isActive(){return this.isActiveObs.get()}isReady(){return this._isReady}isEnabled(){return i.default.isDemoMode()||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)}isAvailable(){var e=!1,t=this.hasDependency(r.a.PluginDependency.EarlyAccess),a=this.hasDependency(r.a.PluginDependency.PremiumSub);try{i.default.PAssert(1024,!a||!t,"Must not require both early access and premium sub: "+this.id)}catch(o){i.default.reportError(o)}var s=Wr.billingManager.hasEarlyAccess(),n=Wr.billingManager.hasPremiumFeatures();return t&&s?e=!0:a&&n?e=!0:t||a?i.default.isDemoMode()&&(e=!0):e=!0,e}hasSettingsError(){return!1}isCurrentlyAuthorized(e){const t=this.googleScopes();return!t||re.a.isAuthorizedForScopes(e,t)}onAuthorized(e){this._pendingRequests.length>0&&Wr.pluginManager.notifyHasPendingRemoteRequest()}verifyAuthorization(e){return!0}notifyUnauthorized(e,t){}isOnline(){return Wr.pluginManager.isOnline()}goOnline(){}onDocumentShared(e){}onShutdown(){}onDependencyLoaded(e,t){if(this._unloadedDependencies){var a=this._unloadedDependencies.indexOf(e);if(a>=0&&(i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Plugin Dependency Loaded: ",this.id,e),this._unloadedDependencies.removeAt(a),e===r.a.PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var s=0,n=!1,o=0;o<this._unloadedDependencies.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=this._unloadedDependencies[o];ve[l].online||(n=!0)}!n&&this.isActiveObs.get()&&this.offlineLoad()}}}onAllDependenciesLoaded(){this.isActiveObs.get()&&(i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Plugin All Dependencies Loaded: ",this.id),this._isReady=!0,this._updateAttachmentStates(),this.offlineLoad(),this.load())}areDependenciesLoaded(){return void 0===this._unloadedDependencies}hasDependencyBeenLoaded(e){var t=!1;return this.hasDependency(e)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(e)<0&&(t=!0):t=!0),t}getUnloadedDependencies(){return this._unloadedDependencies}areRemoteAPIsLoaded(){return!0}forceLoad(){this._loadedInitialData=!1,this.activate({}),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())}hasDependency(e){var t=this.getDependencies();return!!t&&t.indexOf(e)>=0}migrateOldOfflineCache(){if(this.supportUsageCache()&&i.default.shouldWriteLocal()){let h="ocache_"+this.id;var e=ie.a.getLegacyLocalStorage(h);if(e)try{var t=JSON.parse(e);if(t){var a=0;try{i.default.PAssert(1025,t,"Must provide a valid dataset to load")}catch(l){i.default.reportError(l)}t.props;var s=t.data;try{i.default.PAssert(1026,s,"Load object must contain valid data")}catch(l){i.default.reportError(l)}let e=Object.keys(s);for(var n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e[n];let t=this.createEntryFromLocal(o,s[o]);t.id=o,ie.a.savePluginUsage(this.id,t)}ie.a.deleteLegacyLocalStorage(h)}}catch(d){i.default.reportError(d)}else i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("No offline cache present: ",this.id)}}loadUsageCache(){try{i.default.PAssert(1027,i.default.isEmpty(this._dataCache),"Must have no data already loaded")}catch(e){i.default.reportError(e)}if(this.supportUsageCache()&&i.default.shouldWriteLocal()){this.migrateOldOfflineCache();let e=ie.a.getPluginTableUsage(this.id);e&&Object.keys(e).forEach(t=>this._dataCache[t]=this.createEntryFromLocal(t,e[t]))}}supportOfflineLoad(){return!1}supportUsageCache(){return!1}createEntryFromLocal(e,t){try{i.default.PAssert(1028,!1,"SubClass must override")}catch(a){i.default.reportError(a)}}clearData(){for(var e=0,t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._attachCache[this._attachKeys[t]].unload()}this._attachKeys=[],this._attachCache={},this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]}onCacheLimitExceeded(){for(var e in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(e)){var t=this._registeredCaches[e];t.usesDiskSpace()&&t.clearCache()}}changeID(e,t,a){try{i.default.PAssert(1029,t!==a,"Should never be switching to the same ID")}catch(o){i.default.reportError(o)}if(this._attachCache[a])e.delayChangeID(),delete this._attachCache[t],this._attachKeys.remove(t),delete this._dataCache[t];else{var r=this._attachCache[t];try{i.default.PAssert(1030,e===r,"Attach entries must match")}catch(o){i.default.reportError(o)}r&&(delete this._attachCache[t],this._attachCache[a]=r,this._attachKeys.remove(t),this._attachKeys.push(a));var s=this._dataCache[t];delete this._dataCache[t],s&&(s.id===t&&(s.id=a),this._dataCache[a]=s);var n=e.isLocalOnlyAttachment();e.isInUse()&&n&&this.deleteAttachmentFromUsageCache(e),e.changeID(a),e.isInUse()&&n&&this.saveAttachmentToUsageCache(e)}}_isFullData(e){for(var t=0,a=this.getPropertySet(r.a.PluginLoad.Full),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.getPropertyDescriptor(a[i]).isOpt&&!e.hasOwnProperty(a[i]))return!1}return!0}cacheData(e,t,a,r,s){try{i.default.PAssert(1031,e,"Must supply a valid key for data")}catch(l){i.default.reportError(l)}ye&&this.__Stats.cacheWrites++;this._dataCache[e];if(this._dataCache[e]=t,this._attachCache[e]){var n=this._attachCache[e],o=this._getPluginLoadType(t);try{i.default.PAssert(1033,o,"Must contain valid full data")}catch(l){i.default.reportError(l)}n.notifyDataLoaded(o,a,r,s)}}getCacheData(e){return this._dataCache[e]}_attachMetadataFields(){}fieldsHaveParseEffect(e){var t=!1;if(e){var a=this._attachMetadataFields();if(a)for(var i=0,r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a.indexOf(e[r])<0){t=!0;break}}else t=!0}else t=!0;return t}isFieldDefined(e){return!!this.getPropertyDescriptor(e)}hasAttachField(e,t){var a=!1,r=this._dataCache[e.id];if(r&&r.hasOwnProperty(t))a=!0;else{var s=this.getPropertyDescriptor(t);try{i.default.PAssert(1035,s,"Must have a valid field descriptor",t)}catch(o){i.default.reportError(o)}if(s&&s.isOpt)a=!0;else{var n=e.getInlineData();n&&n.hasOwnProperty(t)&&(a=!0)}}return a}getAttachField(e,t){var a,r=this._dataCache[e.id];if(r&&r.hasOwnProperty(t))a=r[t];else{var s=this.getPropertyDescriptor(t);try{i.default.PAssert(1036,s,"Must have a valid field descriptor",t)}catch(o){i.default.reportError(o)}var n=e.getInlineData();a=n&&n.hasOwnProperty(t)?n[t]:s?s.defaultValue:void 0}return a}updateAttachField(e,t,a,r,s){var n=!1;try{i.default.PAssert(1038,this.isFieldDefined(t),"Must be updating a valid attachment field")}catch(d){i.default.reportError(d)}var o=this._dataCache[e.id];try{i.default.PAssert(1039,o,"Invalid field request: ",this.id,t)}catch(d){i.default.reportError(d)}o&&((s||this.dataFieldNeedsWrite(o,t,a))&&(o[t]=a,this.cacheData(e.id,o,!0,[t])),n=!0);var l=e.getInlineData();if(l&&l.hasOwnProperty(t)&&!r)try{i.default.PAssert(1042,l[t]===a,"Should never change inline field value")}catch(d){i.default.reportError(d)}return n}isAttachFieldDefault(e,t){var a=!1,r=this._dataCache[e.id];try{i.default.PAssert(1043,r,"Invalid field request: ",this.id,t)}catch(n){i.default.reportError(n)}if(r){var s=this.getPropertyDescriptor(t);try{i.default.PAssert(1044,s,"Must have a valid field descriptor",t)}catch(n){i.default.reportError(n)}r.hasOwnProperty(t)?s&&s.isOpt&&s.defaultValue===r[t]&&(a=!0):s&&s.isOpt&&(a=!0)}return a}fieldNeedsWrite(e,t,a){var r=this._dataCache[e.id];try{i.default.PAssert(1045,r,"Invalid field request: ",this.id,t)}catch(s){i.default.reportError(s)}return this.dataFieldNeedsWrite(r,t,a)}dataFieldNeedsWrite(e,t,a){var r=!1;if(e){var s=this.getPropertyDescriptor(t);try{i.default.PAssert(1046,s,"Must have a valid field descriptor",t)}catch(o){i.default.reportError(o)}var n=this.compactCacheField(e,t);e.hasOwnProperty(t)?void 0===a&&n===s.defaultValue||(s&&s.comparator?s.comparator(n,a)||(r=!0):n!==a?r=!0:(i.default.isObject(n)||i.default.isObject(a)||i.default.isArray(n)||i.default.isArray(a))&&(r=!0)):void 0!==a&&(s&&s.isOpt&&s.defaultValue===a||(r=!0))}return r}hasCacheData(e){return!!this._dataCache[e]}findCachedItemsByField(e,t,a){ye&&this.__Stats.findByField++;var i=[];return Object.keys(this._dataCache).some(r=>{let s=this._dataCache[r];if(s&&s[e]===t&&(i.push(s),i.length>=a))return!0}),i}findCachedItemsByFn(e,t){try{i.default.PAssert(1047,e,"Must supply a valid match function")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1048,i.default.isFunction(e),"Match function must be a valid function")}catch(r){i.default.reportError(r)}ye&&this.__Stats.findByFn++;var a=[];return Object.keys(this._dataCache).some(i=>{let r=this._dataCache[i];if(e(r)&&(a.push(r),a.length>=t))return!0}),a}notifyAttachmentInUse(e,t){try{i.default.PAssert(1049,this._activeAttachments.indexOf(e)<0,"Attachment should not already be active")}catch(a){i.default.reportError(a)}this._activeAttachments.push(e),i.default.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e,!0)}notifyAttachmentUpdated(e){this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e)}notifyAttachmentUnused(e,t){try{i.default.PAssert(1050,this._activeAttachments.indexOf(e)>=0,"Attachment should be marked active")}catch(a){i.default.reportError(a)}this._activeAttachments.remove(e),i.default.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.deleteAttachmentFromUsageCache(e)}onAuthorizedSetting(e,t){}notifyItemNoteChanged(e,t){}notifyItemDateChanged(e,t){}notifyItemTextChanged(e,t,a){}notifyItemPropertyChanged(e,t,a,i){}getAttachment(e,t){try{i.default.PAssert(1051,e,"Must provide a valid key")}catch(a){i.default.reportError(a)}return e&&(this._attachCache[e]?t&&!this._attachCache[e].hasInlineData()&&this._attachCache[e].setInlineData(t):(this._attachCache[e]=this._requestAttachment(e,t),this._attachKeys.push(e))),this._attachCache[e]}hasAttachment(e){return!!this._attachCache[e]}forEachActiveAttachment(e){for(var t=0,a=0;a<this._activeAttachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._activeAttachments[a])}}forEachAttachment(e){for(var t=0,a=0;a<this._attachKeys.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._attachCache[this._attachKeys[a]])}}numActiveAttachments(){return this._activeAttachments.length}getAttachmentEmbedString(e){for(var t=0,a=r.a.EmbedAttachChar+"p:"+this.id+",id:"+e.id,s=this.getPropertySet(r.a.PluginLoad.Inline),n=0;n<s.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=s[n],l=this.getPropertyDescriptor(o),d=encodeURIComponent(e.getField(o));try{i.default.PAssert(1052,l.isOpt||d&&d.indexOf(":")<0&&d.indexOf(" ")<0,"Property value is invalid: "+o+", "+d)}catch(h){i.default.reportError(h)}void 0!==d&&"undefined"!==d&&(a+=","+o+":"+d)}return a+=r.a.EmbedAttachChar}getAttachmentTitleString(e){return this.getUnstyledText(e)}_getTextForItem(e){try{i.default.PAssert(1053,e,"Must pass in a valid item to get text for")}catch(t){i.default.reportError(t)}return r.a.EmbedAttachChar+"p:"+this.id+",id:"+e.id+r.a.EmbedAttachChar}_requestAttachment(e,t){try{i.default.PAssert(1054,e,"Must provide a valid key")}catch(a){i.default.reportError(a)}return ye&&this.__Stats.createdAttachments++,new le(this,e,t)}releaseAttachment(e){}saveAttachmentToUsageCache(e,t){this.supportUsageCache()&&i.default.shouldWriteLocal()&&(t&&ie.a.getPluginUsage(this.id,e.id)||ie.a.savePluginUsage(this.id,this.serializeEntry(e.id)))}deleteAttachmentFromUsageCache(e){this.supportUsageCache()&&i.default.shouldWriteLocal()&&ie.a.deletePluginUsage(this.id,e.id)}dataHasChanged(e,t){for(var a=0,i=!e,s=this.getPropertySet(r.a.PluginLoad.Full),n=0;!i&&n<s.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=s[n];this.dataFieldNeedsWrite(e,o,t[o])&&(i=!0)}return i}getChangedFields(e,t){for(var a=0,i=[],s=this.getPropertySet(r.a.PluginLoad.Full),n=0;n<s.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=s[n];this.dataFieldNeedsWrite(e,o,t[o])&&i.push(o)}return i}matchAttachment(e,t){try{i.default.PAssert(1055,!1,"SubClass must override")}catch(a){i.default.reportError(a)}}getStyledText(e,t,a,r){try{i.default.PAssert(1056,!1,"SubClass must override")}catch(s){i.default.reportError(s)}}getUnstyledText(e){try{i.default.PAssert(1057,!1,"SubClass must override")}catch(t){i.default.reportError(t)}return""}getRichText(e){try{i.default.PAssert(1058,!1,"SubClass must override")}catch(t){i.default.reportError(t)}return""}getBlockedText(e){return"Blocked"}getAttachMeasure(e,t,a){}useRenderer(e,t){var a,s=Wr.pluginManager.useRenderer(e,t);switch(e){case r.a.PluginRenderTypes.StyledText:a="getStyledText";break;case r.a.PluginRenderTypes.UnstyledText:a="getUnstyledText";break;case r.a.PluginRenderTypes.RichText:a="getRichText";break;case r.a.PluginRenderTypes.Measure:a="getAttachMeasure";break;default:try{i.default.PAssert(1059,!1,"Unknown plugin renderer type")}catch(n){i.default.reportError(n)}}a&&(this[a]=s)}_getDisplayText(e,t,a,i){return this.isPluginBlocked()?this.getBlockedText(e):this.getStyledText(e,t,a,i)}createDisplayElement(e){var t=this.getAttachmentClass(e);try{i.default.PAssert(1060,i.default.isArray(t),"Must have a valid class list")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1061,t.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(n){i.default.reportError(n)}t.push("plugin"),this.isPluginBlocked()&&t.push("blocked");var a=this._getDisplayText(e),r={attrs:{cls:t,plugin:this.id,"plugin-id":e.id},text:a},s=this.getAttachmentTooltip(e);return s&&(r.attrs["data-tooltip"]=s),r}measureAttachment(e,t){try{i.default.PAssert(1062,t&&t.attrs&&t.attrs["plugin-id"],"Must have a valid word style obj with attachment ID")}catch(n){i.default.reportError(n)}var a;if(t.attrs&&!t.attrs.isUnknown){var r=this.getAttachment(t.attrs["plugin-id"]);try{i.default.PAssert(1063,r,"Must have valid attachment to measure: ",t.attrs["plugin-id"])}catch(n){i.default.reportError(n)}if(this.isPluginBlocked())a=Wr.Measure.measureWord(e,this.getBlockedText(r),t);else if(void 0===(a=this.getAttachMeasure(r,e,t))){let i=this.getWordStyles();a=Wr.Measure.measureWord(e,this.getUnstyledText(r),Object.assign({},t,i)),i.padding&&(a+=i.padding)}}else a=Wr.Measure.measureWord(e,"Unknown Plugin",t);if(t.attrs&&t.attrs.cls){var s=t.attrs.cls;a+=this.pluginMargin,s.indexOf("padB")>=0&&(a+=this.pluginMargin)}return a+=this.pluginPadding}getAttachmentClass(e){return[]}getAttachmentTooltip(e){}isPluginBlocked(){var e=!1;return Wr.billingManager.hasPremiumFeatures()||!this.hasDependency(r.a.PluginDependency.PremiumSub)&&!this.hasDependency(r.a.PluginDependency.EarlyAccess)||(e=!0),e}_displayMissingProperties(e,t,a){var r=0,s=!1,n=this.getPropertySet(a);i.default.log("Displaying Missing Properties: ",e);for(var o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.getPropertyDescriptor(n[o]).isOpt||t.hasOwnProperty(n[o])||(i.default.log(" Missing Property: ",n[o]),s=!0)}try{i.default.PAssert(1064,s,"Must be missing props to run this")}catch(l){i.default.reportError(l)}}_getPluginLoadType(e){try{i.default.PAssert(1065,e,"Must be querying loaded data for load state with valid data")}catch(a){i.default.reportError(a)}var t=r.a.PluginLoad.None;return this._isFullData(e)&&(t|=r.a.PluginLoad.Full),t}requestData(e,t){ye&&this.__Stats.requestData++,t=t||r.a.PluginLoad.Full;var a,s=this.getCacheData(e.id);s?(a=this._getPluginLoadType(s),i.default.isFlagSet(a,t)?e.notifyDataLoaded(a,!1,void 0,r.a.ChangeType.Remote):(i.default.forEachFlagSet(t,t=>{this._displayMissingProperties(e.id,s,t)}),!e.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(e,t))):e.isLocalOnlyAttachment()||(a=r.a.PluginLoad.None,this.allowRemoteRequests()&&!i.default.isFlagSet(a,t)&&this._getRemoteAttachmentData(e,t))}_getRemoteAttachmentData(e,t){this.getRemoteAttachmentData(e,t)}getRemoteAttachmentData(e,t){try{i.default.PAssert(1066,!1,"SubClass must override")}catch(a){i.default.reportError(a)}}_appendDupeRequest(e,t){try{i.default.PAssert(1067,e,"Must provide a valid queued request")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1068,t,"Must provide a valid duped request")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1069,!e.duped,"Must never use an already duped request as a dupe for another request")}catch(a){i.default.reportError(a)}t.attach&&(e.attach||(e.attach=[]),e.attach.pushOnlyUniques(t.attach)),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}_areRequestFnsEqual(e,t){var a=!1;return e===t?a=!0:i.default.isArray(e)&&i.default.isArray(t)&&(a=e.equals(t)),a}_areRequestsEqual(e,t){try{i.default.PAssert(1070,e,"Must have a valid request A")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1071,t,"Must have a valid request B")}catch(n){i.default.reportError(n)}var a=!0;if(e.accountID!==t.accountID)a=!1;else if(e.forceNoDupe||t.forceNoDupe)a=!1;else if(e.id!==t.id&&this._areRequestFnsEqual(e.requestFn,t.requestFn))if(e.data===t.data)a=!0;else{for(var r in e.data){if(!e.data.hasOwnProperty(r)||!t.data.hasOwnProperty(r)){a=!1;break}if(e.data[r]!==t.data[r]){a=!1;break}}if(a)for(var s in t.data){if(!e.data.hasOwnProperty(s)||!t.data.hasOwnProperty(s)){a=!1;break}if(e.data[s]!==t.data[s]){a=!1;break}}}else a=!1;return a}_getDupeRequest(e){var t,a=0,i=0;for(let r=0;!t&&r<this._outstandingRequests.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!this._outstandingRequests[r].duped&&this._areRequestsEqual(this._outstandingRequests[r],e)&&(t=this._outstandingRequests[r])}for(let r=0;!t&&r<this._pendingRequests.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;!this._pendingRequests[r].duped&&this._areRequestsEqual(this._pendingRequests[r],e)&&(t=this._pendingRequests[r])}return t}_combineRequest(e,t){try{i.default.PAssert(1072,e,"Must provide a valid queued request")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1073,t,"Must provide a valid combine request")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1074,!e.combined,"Must never use an already combined request as a target for another request")}catch(a){i.default.reportError(a)}e.data=i.default.mergeObjects(e.data,t.data),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}_areRequestsCombinable(e,t){try{i.default.PAssert(1075,e,"Must have a valid request A")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1076,t,"Must have a valid request B")}catch(r){i.default.reportError(r)}var a=!1;return e.id!==t.id&&e.combinable&&t.combinable&&e.accountID===t.accountID&&this._areRequestFnsEqual(e.requestFn,t.requestFn)&&e.type===t.type&&(e.attach||t.attach?e.attach&&t.attach&&e.attach.equals(t.attach)&&(a=!0):a=!0),a}_getCombineRequest(e){var t;if(e.combinable)for(var a=0,i=0;!t&&i<this._pendingRequests.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!this._pendingRequests[i].combined&&this._areRequestsCombinable(this._pendingRequests[i],e)&&(t=this._pendingRequests[i])}return t}_handleBatchRequestResponse(e){this._numOutstandingReqs--;try{i.default.PAssert(1077,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){i.default.reportError(t)}}_handleRequestResponse(e,t){if(!t){this._numOutstandingReqs--;try{i.default.PAssert(1078,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(a){i.default.reportError(a)}}}_handleRequestTimeout(e){if(this._pendingRequests.indexOf(e)>=0){var t=0;e.timedOut=!0;for(var a={error:{code:r.a.HTTPStatusCode.Network,message:"Internal request timeout"}},s=0;s<e.failureCB.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e.failureCB[s](a)}catch(n){i.default.reportError(n)}}0,this._pendingRequests.remove(e)}}_queueRemoteRequestMulti(e,t,a,r,s,n,o,l){try{i.default.PAssert(1079,e,"Missing accountID parameter")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1080,!i.default.isArray(e),"Missing accountID paramter")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1081,!i.default.isFunction(e),"Missing accountID parameter")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1082,!l||void 0===l.accountID,"AccountID is specified as a separate param")}catch(h){i.default.reportError(h)}var d=l?i.default.clone(l):{};return d.accountID=e,this._queueRemoteRequest(t,a,r,s,n,o,d)}_computeTimeoutMS(e){var t;return e&&void 0!==e.timeoutMS&&(0===e.timeoutMS?t=this.DefaultRequestTimeout:e.timeoutMS>=1e3&&(t=e.timeoutMS)),t}_updateRequestTimeout(e){e.timeoutMS&&(this._clearRequestTimeout(e),e.timeout=setTimeout(this._handleRequestTimeout.bind(this,e),e.timeoutMS))}_clearRequestTimeout(e){e.timeout&&(clearTimeout(e.timeout),e.timeout=void 0)}_queueRemoteRequest(e,t,a,s,n,l,d){d=d||{};try{i.default.PAssert(1083,e&&i.default.isArray(e),"RequestFn must be a valid packed function")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1084,t,"Must provide valid data for the request")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1086,a,"Must supply a callback for request success")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1087,i.default.isFunction(a),"Success callback must be a valid function")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1088,s,"Must supply a callback for request failure")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1089,i.default.isFunction(s),"Failure callback must be a valid function")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1090,l,"Request type must be specified")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1091,d.accountID||d.token,"Must have an accountID")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1092,!d.combinable,"Combinable is not currently a valid option. Do not use.")}catch(u){i.default.reportError(u)}try{i.default.PAssert(1093,!n||!n.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",n?n.id:"UNDEFINED")}catch(u){i.default.reportError(u)}if(d.accountID&&this.supportSyncAccounts&&!this.hasSyncAccount(d.accountID))return;d.token&&!d.accountID&&(d.accountID="from_token"),ye&&(this.__ReqStats[l]=this.__ReqStats[l]?this.__ReqStats[l]+1:1);var h={id:++this._requestCounter,plugin:this,attach:n?[n]:void 0,request:void 0,requestFn:e,data:t,successCB:[a],failureCB:[s],type:l,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,noBatch:d.noBatch,requestsBehind:this._pendingRequests.length,token:d.token,accountID:d.accountID,combinable:d.combinable,autoRetry:!d||void 0===d.autoRetry||d.autoRetry,timeoutMS:this._computeTimeoutMS(d),forceNoDupe:d.forceNoDupe,priority:d.priority?d.priority:r.a.RequestPriority.Default};h.autoRetry&&(h.numRetries=d&&d.numRetries?d.numRetries:2,h.currentRetries=0),this._updateRequestTimeout(h),i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Request Queued: ",this.name,l,h.id,h);let c=()=>{var e=this._insertPendingRequest(h);h.priority>r.a.RequestPriority.Default&&i.default.log("Insert Index: ",e,this._pendingRequests.length,h),Wr.pluginManager.notifyHasPendingRemoteRequest()};o.a.isLoadedRemote.onValue(!0,()=>{h.token?c():re.a.getAccountAuthToken(d.accountID,this.googleScopes(),e=>{e?(h.token=e,c()):console.log("Skipping request because of missing token")})})}_insertPendingRequest(e){e.priority++;var t=this._pendingRequests.insertSorted(e,this._reqSortFn);return e.priority--,t}_reqSortFn(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1}_queuePagedRemoteRequestMulti(e,t,a,r,s,n,o,l){try{i.default.PAssert(1094,e,"Missing accountID parameter")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1095,!i.default.isArray(e),"Missing accountID paramter")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1096,!i.default.isFunction(e),"Missing accountID parameter")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1097,!l||void 0===l.accountID,"AccountID is specified as a separate param")}catch(h){i.default.reportError(h)}var d=l?i.default.clone(l):{};return d.accountID=e,this._queuePagedRemoteRequest(t,a,r,s,n,o,d)}_queuePagedRemoteRequest(e,t,a,r,s,n,o){try{i.default.PAssert(1098,o,"Must supply a valid options param")}catch(g){i.default.reportError(g)}try{i.default.PAssert(1099,!o.getAllPages||!o.maxPages,"Should only define either maxPages or getAllPages: ",o.getAllPages,o.maxPages)}catch(g){i.default.reportError(g)}o.maxPages=o.maxPages||1,o.getAllPages=o.getAllPages||!1,o.maxPageResults=o.maxPageResults||(o.maxResults?o.maxResults:100),o.maxResults=o.maxResults||1/0,o.resultsField=o.resultsField||"items";var l,d=0,h=[],c=i.default.clone(t);c.maxResults=o.maxPageResults;var u=e=>{e[o.resultsField]?h.pushArray(e[o.resultsField]):e.items?h.pushArray(e.items):e.history&&h.pushArray(e.history),e.nextPageToken&&(o.getAllPages||o.maxPages>d)&&h.length<o.maxResults?l(e.nextPageToken):e.nextPageToken||e.nextSyncToken||e.historyId?a(h,t,e):a(h)},p=e=>{r(e,h)};(l=t=>{t&&(c.pageToken=t),d++,this._queueRemoteRequest(e,c,u,p,void 0,n,o)})()}_retryRemoteRequest(e,t){i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Request Re-Queued: ",this.name,e.type,e.id,e),ye&&this.__Stats.remoteRetries++,e.request=void 0,e.wasBatched=void 0,e.batchID=void 0,e.batchRequestID=void 0,setTimeout(()=>{e.currentRetries=e.currentRetries?e.currentRetries+1:1,this._insertPendingRequest(e),Wr.pluginManager.notifyHasPendingRemoteRequest()},this._getRetryDelay(e,t))}getNumOutstandingReqs(){return this._numOutstandingReqs}_pumpRequestQueue(e,t,a,s){var n=0,o=0;try{i.default.PAssert(1100,this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue")}catch(E){i.default.reportError(E)}try{i.default.PAssert(1101,!this.hasDependency(r.a.PluginDependency.GoogleLogin)||this.hasDependencyBeenLoaded(r.a.PluginDependency.GoogleLogin),"Must be authorized to make remote requests")}catch(E){i.default.reportError(E)}var l=0,d=0,h=0,c=0,u=0,p=0,g=0;try{i.default.PAssert(1102,this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests")}catch(E){i.default.reportError(E)}var f=t;try{i.default.PAssert(1103,f>0,"Should never have more than max outstanding requests for a given plugin")}catch(E){i.default.reportError(E)}let m={},v=this._pendingRequests.filter(e=>!e.noBatch),y=f>1&&v.length>1;var _=[];for(let C=0;f>0&&C<this._pendingRequests.length&&g<r.a.MaxBatchSize;++C){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;let s,o=this._pendingRequests[C];if(y&&!o.noBatch&&((s=m[o.accountID])||(s=m[o.accountID]=this.createBatch())),o.priority<e)p++;else{i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Request Pumped: ",this.name,o.type,o.id,o);try{i.default.PAssert(1104,!i.default.isFunction(o),"Should never use a deferred request")}catch(E){i.default.reportError(E)}try{i.default.PAssert(1105,!1===o.handled,"Should never service a request that has already been handled")}catch(E){i.default.reportError(E)}var S=this._getDupeRequest(o);if(S)ye&&this.__Stats.dupedRequests++,o.duped=!0,_.push(o),h++,this._appendDupeRequest(S,o);else{var P=this._getCombineRequest(o);if(P)ye&&this.__Stats.combinedRequests++,o.combined=!0,_.push(o),c++,this._combineRequest(P,o);else{var I=!1;if(o.attach)for(var b=0,D=0;D<o.attach.length;++D){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;o.attach[D].needsRemoteData()&&(o.attach[D].notifyDataRequested(),I=!0)}else I=!0;if(I)if(o.token||this.isCurrentlyAuthorized(o.accountID)){var w=this._runRemoteRequest(s,o,a);if(ye&&this.__Stats.remoteRequests++,w.isNewRequest||0===g){try{i.default.PAssert(1106,t>l,"Should not be making more requests for plugin than allowed")}catch(E){i.default.reportError(E)}l++,f--,this._numOutstandingReqs++,ye&&this.__Stats.actualRemoteCallsSent++}w.wasBatched&&g++,_.push(o)}else re.a.notifyUnauthorizedRequest(o.accountID),u++;else ye&&this.__Stats.canceledRequests++,o.canceled=!0,d++,_.push(o)}}}}this._pendingRequests=this._pendingRequests.removeArray(_);for(let i=0;i<_.length;++i){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;_[i].canceled||_[i].duped||this._addRequest(this._outstandingRequests,_[i])}return Object.keys(m).forEach(e=>{let t=m[e];try{i.default.PAssert(1107,!t||g+d+h+c+u+p>1,"Batches should always have multiple items in them")}catch(E){i.default.reportError(E)}t&&(g>0?(ye&&this.__Stats.remoteBatches++,this.commitBatch(t,s)):ye&&this.__Stats.canceledBatches++)}),l}_clearRequestQueue(){i.default.log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0}_addRequest(e,t){try{i.default.PAssert(1108,e.indexOf(t)<0,"Should never re-add a request to a queue without removing it first")}catch(a){i.default.reportError(a)}return e.push(t)}_removeRequest(e,t){return e.remove(t)}isRateLimited(){return this._isRateLimited}_notifyRateLimitedOver(){this._isRateLimited=!1}_notifyRateLimited(e){this._isRateLimited=!0,this._lastRateLimitTime=new Date}isRateLimitError(e){var t=!1;return e&&me.indexOf(e.status)>=0&&(e.status===r.a.HTTPStatusCode.Forbidden?i.default.hasGoogleError(e,r.a.GoogleErrorDomain.UsageLimits,r.a.GoogleError.UserRateLimitExceeded)?t=!0:i.default.hasGoogleError(e,r.a.GoogleErrorDomain.UsageLimits,r.a.GoogleError.RateLimitExceeded)?t=!0:i.default.hasGoogleError(e,r.a.GoogleErrorDomain.UsageLimits,r.a.GoogleError.QuotaExceeded)&&(t=!0):t=!0),t}_getRetryDelay(e,t){var a=e.currentRetries;return t&&(a=Math.max(2,e.currentRetries)),i.default.seconds(ge[a])}_notifyRequestSuccess(e,t){var a={cbList:e.successCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)}_notifyRequestFailure(e,t){var a={cbList:e.failureCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)}_handleResponse(e){for(var t=0,a=0;a<e.cbList.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e.cbList[a](e.result)}catch(r){i.default.reportError(r)}}}_notifyBatchCompleted(e){var t=this._batchedResponses[e.getBatchID()];if(delete this._batchedResponses[e.getBatchID()],t){var a=0;Wr.PaneUpdateBatcher.beginUpdateItems(),ie.a.beginBatch();for(var i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._handleResponse(t[i])}ie.a.commitBatch(),Wr.PaneUpdateBatcher.commitUpdateItems()}}computeBatchGroupID(e){return e.accountID}computeRequestID(e){return e.id+"-"+Date.now()}_setSendTime(e){var t=Date.now();if(0===e.sendTimes.length){var a=t-e.queueTime;this._numSendRequests++,this._totalRequestSendTime+=a,a>this.LongWaitThreshold&&this._numLongWaitRequests++}e.sendTimes.push(t)}_setHandleTime(e){var t=Date.now();if(0===e.handleTimes.length){var a=t-e.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=a}e.handleTimes.push(t)}_runRemoteRequest(e,t,a){var s,n={wasBatched:!1,isNewRequest:!1};if(pe.a.canConstruct(t.requestFn))s=t.request=pe.a.createRequest(t.accountID,t.requestFn,t.data,t.token);else{var o=i.default.unpackFn(t.requestFn);try{i.default.PAssert(1109,i.default.isFunction(o),"Must specify a valid packed function: ",t.requestFn)}catch(h){i.default.reportError(h)}o&&(s=t.request=o(t.data))}if(s){try{i.default.PAssert(1110,s.then,"Remote request must be thenable")}catch(h){i.default.reportError(h)}if(e){var l=this.computeBatchGroupID(t),d=this.computeRequestID(t);n.isNewRequest=e.add(s,l,d);try{i.default.PAssert(1111,i.default.isBoolean(n.isNewRequest),"Add must return whether it will create a new remote request for this request")}catch(h){i.default.reportError(h)}n.wasBatched=!0,t.wasBatched=!0,t.batchID=e.getBatchID(),t.batchRequestID=d}else t.wasBatched=!1,t.batchID=void 0,t.batchRequestID=void 0;i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Request Run: ",this.name,t.type,t.id,t);try{i.default.PAssert(1112,t.token||this.isCurrentlyAuthorized(t.accountID),"Must be currently authorized to make this request")}catch(h){i.default.reportError(h)}this._clearRequestTimeout(t),this._setSendTime(t);let o=e=>{try{i.default.PAssert(1113,!1===t.handled,"Must not handle the same request multiple times")}catch(h){i.default.reportError(h)}i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Request Failed: ",this.name,t.type,t.id,t,e),this._setHandleTime(t);var s=this.isRateLimitError(e);if(s&&this._notifyRateLimited(e),(s||fe.indexOf(e.status)>=0)&&t.autoRetry&&t.currentRetries<t.numRetries)a(t.attach,t.plugin,t.wasBatched),this._removeRequest(this._outstandingRequests,t),this._retryRemoteRequest(t,s);else{if(t.handled=!0,t.failed=!0,t.attach)for(var n=0,o=0;o<t.attach.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t.attach[o].notifyDataRequestFailed()}this._notifyRequestFailure(t,e.result),a(t.attach,t.plugin,t.wasBatched),this._removeRequest(this._outstandingRequests,t)}};t.request.then(e=>{let s=e.result;if(!pe.a.isRest||s&&!s.error||204===e.status){try{i.default.PAssert(1114,!1===t.handled,"Must not handle the same request multiple times")}catch(h){i.default.reportError(h)}i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Request Success: ",this.name,t.type,t.id,t,e),this._setHandleTime(t),t.handled=!0,this._notifyRateLimitedOver(),this._notifyRequestSuccess(t,s),a(t.attach,t.plugin,t.wasBatched),this._removeRequest(this._outstandingRequests,t)}else o(e)},o)}return n}createPaginationToken(e,t,a,i,r,s){return new ue(e,t,a,i,r,s)}updatePaginationToken(e,t){try{i.default.PAssert(1115,e,"Must specify a valid token to update")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1116,t,"Must update the pagination token with a valid next page token")}catch(a){i.default.reportError(a)}return e.updateToken(t),e}createBatch(e){return pe.a.createBatch(e)}commitBatch(e,t){try{i.default.PAssert(1117,e,"Batch to commit must be specified")}catch(a){i.default.reportError(a)}e.then(()=>{this._notifyBatchCompleted(e),t(this,!0)},()=>{this._notifyBatchCompleted(e),t(this,!1)})}addModifiedOffline(e,t){try{i.default.PAssert(1118,e,"Must have a valid cache entry to update")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1119,i.default.isBoolean(t)||i.default.isArray(t),"Incoming fields must be valid")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1120,!1!==t,"Use removeModifiedOffline to clear data instead")}catch(r){i.default.reportError(r)}if(e){var a=e.modifiedOffline||!1;try{i.default.PAssert(1121,i.default.isBoolean(a)||i.default.isArray(a),"Previous fields must be valid")}catch(r){i.default.reportError(r)}!1===a?e.modifiedOffline=t:!0===a||(!0===t?e.modifiedOffline=!0:e.modifiedOffline?e.modifiedOffline.pushOnlyUniques(t):e.modifiedOffline=t)}}removeModifiedOffline(e,t){try{i.default.PAssert(1122,e,"Must have a valid cache entry to update")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1123,i.default.isBoolean(t)||i.default.isArray(t),"Incoming fields must be valid")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1124,!0!==t,"Use addModifiedOffline to add data instead")}catch(r){i.default.reportError(r)}if(e){var a=e.modifiedOffline||!1;try{i.default.PAssert(1125,i.default.isBoolean(a)||i.default.isArray(a),"Previous fields must be valid")}catch(r){i.default.reportError(r)}!1===a||(!0===a?!1===t&&(e.modifiedOffline=!1):!1===t?e.modifiedOffline=!1:(e.modifiedOffline=e.modifiedOffline.removeArray(t),0===e.modifiedOffline.length&&(e.modifiedOffline=!1)))}}compactCacheField(e,t){return e[t]}_serializeObj(e,t){var a=0;try{i.default.PAssert(1126,e,"Must specify a valid entry to serialize")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1127,t,"Must provide a valid property list")}catch(h){i.default.reportError(h)}for(var r={},s=0;s<t.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[s],o=this.getPropertyDescriptor(n);if(!o.isOpt||o.defaultValue!==e[n]){var l=this.compactCacheField(e,n);void 0!==l&&(r[n]=l)}}var d=this.getBlobData(e);return d&&(r._blob=d),r}serializeEntry(e){var t=this.getPropertySet(r.a.PluginLoad.Full),a=this.getCacheData(e);if(a){let i=this._serializeObj(a,t);return i.id=e,i.plugin=this.id,i}}serializeExternalData(e){try{i.default.PAssert(1128,e,"Must supply valid data to serialize")}catch(s){i.default.reportError(s)}var t=this.getPropertySet(r.a.PluginLoad.Full),a=this._serializeObj(e,t);return a.id=e.id,e.parents&&(a.parents=e.parents),a}declareProperty(e,t,a,s,n){try{i.default.PAssert(1129,!this._propertyDescriptors[e],"Should not declare the same property twice")}catch(o){i.default.reportError(o)}t=t||r.a.PluginLoad.Full,a=a||!1,i.default.forEachFlagSet(t,t=>{this._propertySets[t]||(this._propertySets[t]=[]),this._propertySets[t].push(e)}),this._propertyDescriptors[e]={isOpt:a,defaultValue:s,comparator:n}}getPropertySet(e){return this._propertySets[e]||[]}getPropertyDescriptor(e){return this._propertyDescriptors[e]}getBlobData(e){}_updateAttachmentStates(){try{var e=0;Wr.PaneUpdateBatcher.beginUpdateItems();for(var t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._attachCache[this._attachKeys[t]];a.isInUse()&&a.onUpdate(!1,void 0,r.a.ChangeType.Auto)}Wr.PaneUpdateBatcher.commitUpdateItems()}catch(s){i.default.reportError(s)}}offlineLoad(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad())try{this._offlineLoad&&(this._hasRunOfflineLoad=this._offlineLoad())}catch(e){i.default.reportError(e)}}load(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(e){i.default.reportError(e)}}this._loadedInitialData||!i.default.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()}loadInitialData(){try{i.default.PAssert(1131,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1132,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(e){i.default.reportError(e)}this._loadedInitialData=!0}getDataPane(){}getPaneIcon(){return"icon-question"}getPanePriority(){return 0}getDefaultDisplayItem(e){}useItemStore(){}itemStoreOptions(){}getDefaultItemStore(){try{i.default.PAssert(1133,this.useItemStore(),"Must request an item store")}catch(e){i.default.reportError(e)}return this._defaultItemStore}getActiveItemStore(e){try{i.default.PAssert(1134,e,"Must specify a valid paneID to get the item store for")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1135,this.useItemStore(),"Must request item store usage")}catch(a){i.default.reportError(a)}var t=this._activeItemStore[e];return t||this._defaultItemStore}getBucketItemStore(e){return this._searchBuckets[e]}allowRemoteRequests(){return!1}handleDropEvent(e,t){return!1}handleTapClick(e,t,a,i){return!1}handleDoubleTap(e,t,a,i){return!1}notifyPaneCreated(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||this.areDependenciesLoaded()&&this.loadInitialData()}notifyPaneDestroyed(){this._numActivePanes--;try{i.default.PAssert(1138,this._numActivePanes>=0,"Should never have negative active panes")}catch(e){i.default.reportError(e)}}notifyPanesReadyForLoad(){Wr.PaneManager.runForEachPane(e=>{e.notifyPluginLoaded()},this.getPaneType())}hasActiveDataPanes(){return this._numActivePanes>0}allowTextEditing(e,t){return!0}_createSearchBucket(e,t){var a;a=i.default.generateTempId();var r=Wr.itemStoreManager.registerItemStore(a,this,{trackGlobally:!1});return r.createRoot(t||i.default.generateTempId(),"Search Results"),this._searchBuckets[a]=r,a}_destroySearchBucket(e){this._searchBuckets[e].clearStore()}swapInSearchBucket(e,t){try{i.default.PAssert(1139,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){i.default.reportError(o)}if(i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Swap IN search bucket: ",e),Wr.PaneManager.isPaneActive(t)){var a=Wr.PaneManager.getPaneById(t),s=this._searchBuckets[e];if(!this._activeSearchBucket[t]||this._activeSearchBucket[t].id!==e){var n=s.getRoot();this._activeSearchBucket[t]||(this._defaultZoomItems[t]=a.getItem()),this._activeItemStore[t]=s,this._activeSearchBucket[t]=s,a.setRootItem(n,!0),a.useItemStore(s)}}}swapOutSearchBucket(e,t){try{i.default.PAssert(1140,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(l){i.default.reportError(l)}var a=this._activeSearchBucket[e].id;i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Swap OUT search bucket: ",a);var s=Wr.PaneManager.getPaneById(e),n=this._searchBuckets[a];try{i.default.PAssert(1141,n,"Must have a valid bucket we are swapping from")}catch(l){i.default.reportError(l)}var o=s.getRootItem();try{i.default.PAssert(1142,o===n.getRoot(),"Current root for pane should match bucket root")}catch(l){i.default.reportError(l)}t=t||this._defaultZoomItems[e];try{i.default.PAssert(1143,t,"Must always be able to get a valid default zoom item")}catch(l){i.default.reportError(l)}this._activeItemStore[e]=void 0,this._activeSearchBucket[e]=void 0,this._defaultZoomItems[e]=void 0,s.setItem(t,!0),s.stopUsingItemStore(n),this._destroySearchBucket(a)}runSearch(e,t,a,r,s){try{i.default.PAssert(1144,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){i.default.reportError(o)}var n;return r&&(n=this._createSearchBucket(e,a)),this.runRemoteSearch(e,t,n,s)}getSearchRoot(e){var t=this._searchBuckets[e];try{i.default.PAssert(1145,t,"Should always reference a valid search bucket")}catch(a){i.default.reportError(a)}return t.getRoot()}isRemoteSearchBucketActive(e){return!!this._activeSearchBucket[e]}clearSearch(e,t){this._activeSearchBucket[e]&&this.swapOutSearchBucket(e,t)}refreshCurrentView(e){try{i.default.PAssert(1146,!1,"SubClass must override")}catch(t){i.default.reportError(t)}}dumpRequestQueue(e){var t=0,a=0;console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(let i=0;i<this._outstandingRequests.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let e=this._outstandingRequests[i];console.log("  ",e.requestFn,":",e.id," - ",e.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(let i=0;i<this._pendingRequests.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let e=this._pendingRequests[i];console.log("  ",e.requestFn,":",e.id," - ",e.data)}if(e){var r=0;try{i.default.PAssert(1147,!1,"Must be in __DEV__ mode to display info on handled requests")}catch(s){i.default.reportError(s)}console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(let e=0;e<this._handledRequests.length;++e){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;let t=this._handledRequests[e];t.failed?console.log(" !",t.requestFn,":",t.id," - ",t.data):console.log("  ",t.requestFn,":",t.id," - ",t.data)}}}dumpQueueStats(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)}getCssClass(e,t){return""}getSyncAccounts(e){let t=[];var a=Wr.settings.syncAccounts.get();return a&&(t=Object.keys(a).filter(e=>!!a[e][this.id])),0!==t.length||e||(t=[Wr.settings.getUserIdentifier()]),t}numSyncAccounts(){return this.getSyncAccounts().length}hasSyncAccount(e,t){let a=!1;var i=Wr.settings.syncAccounts.get();if(i){let t=i[e];a=t&&t[this.id]}return a||t||e!==Wr.settings.getUserIdentifier()||(a=!0),a}getWordStyles(){return{}}_activate(){}_deactivate(){}_offlineLoad(){}_load(){}runRemoteSearch(e,t,a,i){}googleScopes(e){return[]}getDependencies(){return[]}}v.a.defineBase(_e);var Se=_e;var Pe=class extends Se{constructor(){super(r.a.PluginID.Date,"t","Date",!0),this.pluginMargin=0,this.pluginPadding=8,this.declareProperty("itemID",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!1)}getStyledText(e,t,a,i){return this.getUnstyledText(e,a)}getUnstyledText(e,t){if(t=t||o.a.getItem(e.id)){let e=t.getMooDate();if(e)return e.toText(!0)}return""}getAttachMeasure(e,t,a){}getWordStyles(){return{fontSize:11}}getAttachmentEmbedString(){return r.a.CharDate}_getTextForItem(e){try{i.default.PAssert(668,e,"Must pass in a valid item to get text for")}catch(t){i.default.reportError(t)}return r.a.CharDate}getAttachmentClass(e){let t=["inlineDate","c-date","c-shadow-thin"],a=o.a.getItem(e.id);if(a){let e=a.getMooDate();e&&e.getGCalId()&&(t=t.concat("syncedToCalendar"))}return t}requestData(e,t){e.notifyDataLoaded(r.a.PluginLoad.Full,!1,void 0,r.a.ChangeType.Remote)}handleTapStart(e,t,a,i){return!0}handleTapClick(e,t,a,i){return i.altKey?e.setMooDate(void 0,r.a.ChangeType.Local):Wr.menus.openContextMenu({componentName:"ReactContextMenuDate",element:i.target,item:e,pane:t}),!0}};function Ie(e){this._cb=e,this._pageToken=void 0,this._validToken=!1}var be={hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(e){this._pageToken=e,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(e){e?this._pageToken.notifyEndUse():this._validToken=!1},notifyPaginationUpdate:function(){i.default.log("Pagination Update")}};v.a.defineBase(Ie),v.a.extend(Ie.prototype,be);var De=Ie;function we(e,t,a){this._super.constructor.call(this),this._searchQuery=e,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=a,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=t,v.a.forceBind("onEntry",this)}var Ee={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(e,t){try{i.default.PAssert(997,i.default.isFunction(e)&&i.default.isFunction(t)||this._lastPageRequest,"Must provide valid callbacks")}catch(n){i.default.reportError(n)}try{i.default.PAssert(998,!this._invalid,"Should never request another page from an invalidated search")}catch(n){i.default.reportError(n)}try{i.default.PAssert(999,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1e3,!this._activePageRequest,"Should only run a single request at a time")}catch(n){i.default.reportError(n)}if(e||t||!this._lastPageRequest||(e=this._lastPageRequest.entryCB,t=this._lastPageRequest.doneCB),this._activePageRequest)t(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){var a=0;for(let t=0;t<this._pageSize;++t){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._cachedResults[this._localPageOffset+t];try{e(r)}catch(o){i.default.reportError(o)}}this._localPageOffset+=this._pageSize,t(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:e,doneCB:t},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){var s=0;for(let t=this._localPageOffset;t<this._cachedResults.length;++t){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;r=this._cachedResults[t];try{e(r)}catch(o){i.default.reportError(o)}this._localPageOffset++}t(!0)}},onEntry:function(e){this._invalid||this._cachedResults.push(e)},onDone:function(e){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,e?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,this._lastPageRequest.doneCB(e)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};v.a.inherit(De,we),v.a.extend(we.prototype,Ee);var Ce=we,Ae=a(107),Me=2500,Te=5e3;var Le,xe=class extends Ae.a{constructor(e){let t={title:"Files",paneEmptyMessage:"Loading Google Drive...",paneEmptySearchMessage:"",titleContextMenuHeader:"Open folder",dropEffect:()=>r.a.DropEffect.Copy,isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:!0,supportPagination:!0,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,hasMoreButtons:!0,searchFilters:[],supportsDocuments:!1};e.plugin=Wr.pluginManager.getPlugin(r.a.PluginID.Drive),super(e,t),this.type=this.plugin._paneType,this.paneClass="paneOutline panePlugin paneDrive noComplete",this._isSearchingRemote=new A.a(!1),this._currentSearch=void 0,this.initDrive()}initDrive(){this.search.onChanged.listen(v.a.forceBind("notifySearchChanged",this)),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0}destroy(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,super.destroy()}_getNotReadyStatus(){var e="Unknown Error: Unable to load pane data.",t=this.plugin.getUnloadedDependencies();return t&&(t.indexOf(r.a.PluginDependency.PremiumSub)>=0?e="Only available to premium subscribers.":t.indexOf(r.a.PluginDependency.GoogleLogin)>=0&&(e="Missing permissions for Google Drive access.")),e}getItemStore(){return this.plugin.getActiveItemStore(this.id)}getRootItem(){var e=this.getItemStore();return e?e.getRoot():void 0}bottomListMessage(){var e;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(e="LOAD MORE"),{text:e,clickable:!0}}searchACName(){}getPaneIcon(){return this.plugin.getPaneIcon()}requestDemandLoadData(e){this.plugin.requestDemandLoadData(this.id,e)}requestDataPage(e){this.plugin.requestDataPage(e)}onAfterLoaded(){super.onAfterLoaded()}onClose(){super.onClose()}_runRemoteSearch(){if(Wr.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var e=this.search.getValue();this._lastSearchValue=e,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(e,this.id,void 0,!1,e=>{switch(this.isLoading.set(!1),e){case r.a.SearchResultStatus.Done:this.paneTopText.set("");break;case r.a.SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case r.a.SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case r.a.SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{i.default.PAssert(995,!1,"Invalid search state: ",e)}catch(t){i.default.reportError(t)}}})}}notifySearchChanged(e){var t=this.search.getValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>Te)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:Me;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")}_refreshPaneData(){this.plugin.refreshCurrentView(this.id)}notifyDropFrom(e,t){this.plugin.notifyDropFrom(e,t)}notifyDropFromToEdit(e,t){return this.plugin.notifyDropFromToEdit(e,t)}applyDropOnBlock(e,t){if(e.isDate){var a,s=e.dateTime||e.date;a=i.default.isString(s)?Wr.International.parseDate(s,r.a.DateFormat.MDY):s;try{i.default.PAssert(996,i.default.isDateValid(a),"Must provide a valid date when scheduling an email",e.dateTime,e.date)}catch(n){i.default.reportError(n)}i.default.isDateValid(a)&&this.plugin.scheduleFile(t,a)}}dropEffectCopyBehavior(e,t){return super.dropEffectCopyBehavior(e,t)}isSearchingRemote(){return this._isSearchingRemote.get()}_onRemoteDataLoaded(){}isItemHeader(e,t){if(t){var a=this.plugin,i=e.getAttachmentByPlugin(a.id),r=i&&a.getCacheData(i.id);return!r||a.isFolder(r)}return e.isHeader()}titleOfFirstItem(){return"Drive Root"}},ke=a(20),Re=a(108),Oe="application/octet-stream",Fe="application/vnd.google-apps.folder",Ne="application/vnd.google-apps.spreadsheet",Be="application/vnd.google-apps.presentation",Ue="application/vnd.google-apps.document",He="application/vnd.google-apps.drive-sdk.597847337936",Ve="image/png",je="image/jpg",ze="image/jpeg",qe="image/gif",We=1,Ge=2,Ke=3,Ye=4,Xe=5,Qe=6,$e=7,Je="S~SharedWithMe",Ze="https://drive.google.com/open?id=",et="-------314159265358979323846",tt="\r\n--"+et+"\r\n";var at,it=(Le=class extends Se{constructor(){super(r.a.PluginID.Drive,"d","Files",!1),this.displaySharedWithMe=!i.default.isDemoMode(),this._requiresOfflineAuth=!0,this.registerSetting("WriteAccess","writeAccess","w",!0),this.registerSetting("LastChangeId","lastChangeId","i"),this.registerSetting("DriveRootId","driveRootId","d"),this._folderCache=this.registerLocalCache(this.id,r.a.StorageType.IndexedDB,{metadataKeys:["isSyncd"],keyFieldsRN:[]}),this.declareProperty("showInline",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!0),this.declareProperty("imageWidth",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!0),this.declareProperty("titleLower",r.a.PluginLoad.Runtime,!1,""),this.declareProperty("dataUrl",r.a.PluginLoad.Preview|r.a.PluginLoad.Runtime,!0),this.declareProperty("pinToTop",r.a.PluginLoad.Runtime,!0,!1),this.declareProperty("title"),this.declareProperty("mimeType"),this.declareProperty("fileSize",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0),this.declareProperty("alternateLink",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0),this.declareProperty("webContentLink",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0),this.declareProperty("isDeleted",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,!1),this.declareProperty("modifiedDate",r.a.PluginLoad.Autocomplete,!0),this.declareProperty("parents",r.a.PluginLoad.Autocomplete,!0),this.useRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.DriveFile),this.useRenderer(r.a.PluginRenderTypes.UnstyledText,r.a.PluginRenderers.DriveFile),this.useRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.DriveFile)}getType(){return r.a.PluginType.Storage}getDataPane(){try{i.default.PAssert(705,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){i.default.reportError(e)}return xe}getPaneIcon(){return"icon-drive-file"}getPanePriority(){return 96}useItemStore(){return"Google Drive"}itemStoreOptions(){return{requireStoredEls:!1,parserFn:D.a.runParseSinglePlugin}}allowRemoteRequests(){return!0}onAuthorizedSetting(e,t){switch(e){case this.Settings.WriteAccess:t&&this._ensureAttachmentsAreShared()}}_ensureSpecialFolders(){var e=this.getDefaultItemStore();if(e){var t=e.getRoot();if(this.displaySharedWithMe&&!e.hasItem(Je)){var a=i.default.generateTempId();this.cacheData(a,{title:"Shared With Me",titleLower:"shared with me",mimeType:Fe,pinToTop:!0});var r=this.getAttachment(a),s=e.createItem(Je,this.getAttachmentEmbedString(r),t.id,{demandLoadChildren:!0});t.insertSorted(s,this.sortFn)}}}_load(){this._ensureSpecialFolders(),i.default.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:i.default.minutes(15),minDelay:i.default.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate.bind(this)})}_notifyFailedRequest(e){e&&e.error&&i.default.reportError(new Error("Failed Drive request: "+e.error.code),e)}refreshCurrentView(){this.hasRecurringTask("ChangeListUpdates")&&this.getRecurringTask("ChangeListUpdates").forceUpdate()}loadInitialData(){super.loadInitialData(),this._ensureSpecialFolders();var e=new De(()=>{});setTimeout(()=>{if(!this._folderCache.getMetadata("isSyncd")){i.default.log("Folder cache unsyncd - running folder sync");var t="trashed=false and mimeType contains '"+Fe+"'";this._requestRemoteFiles(Ge,e,t,999,e=>{this._folderCache.saveEntry(this.serializeExternalData(e)),0},e=>{0}),this._folderCache.setMetadata("isSyncd",!0)}},100);var t=!1,a=this.getDefaultItemStore(),r=a.getRoot(),s="trashed=false and 'root' in parents and mimeType != '"+He+"'";this._requestRemoteFiles(Ke,r,s,70,e=>{if(this.hasCacheData(e.id)||this._addRemoteEntry(e),!this._hasSameItem(e.id,r.id,a)){var t=a.createItem(this._createItemID(e.id,a),this._getTextForItem(e),r.id,{demandLoadChildren:e.mimeType===Fe});r.insertSorted(t,this.sortFn)}if(!this.getSetting(this.Settings.DriveRootId)&&e.parents)for(var i=0,s=0;s<e.parents.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.parents[s].isRoot&&this.setSetting(this.Settings.DriveRootId,e.parents[s].id)}},()=>{t||(t=!0)})}performChangeListUpdate(){var e=-1,t=this.getSetting(this.Settings.LastChangeId);this._requestChangeList(t,a=>{try{i.default.PAssert(706,!t||parseInt(a.id)>parseInt(t),"Must have correctly ordered change entry")}catch(r){i.default.reportError(r)}e=a.id;try{!a.fileId||a.file&&a.file.mimeType===He||this._handleChange(a)}catch(s){i.default.reportError(s)}},t=>{t&&-1!==e&&this.setSetting(this.Settings.LastChangeId,e)})}_deleteFile(e){e.forEachItem(this.getDefaultItemStore(),e=>{e.parent().removeChild(e,r.a.ChangeType.Remote),e.setParent(void 0)}),e.updateField("isDeleted",!0)}_handleChange(e){try{i.default.PAssert(707,e&&(e.deleted||e.file),"Must have a valid formed change entry to handle")}catch(p){i.default.reportError(p)}if((e.deleted||e.file.mimeType===Fe)&&(e.deleted?this._folderCache.hasEntry(e.fileId).then(t=>{t&&this._folderCache.removeEntry(e.fileId)}):this._folderCache.saveEntry(this.serializeExternalData(e.file))),!this.hasCacheData(e.fileId)&&!e.deleted&&e.file){var t=0,a=e.file.parents,s=!1;for(let e=0;e<a.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasCacheData(a[e].id)||a[e].isRoot){s=!0;break}}s&&this._addRemoteEntry(e.file)}var n=this.getCacheData(e.fileId);if(n){e.deleted||this.dataHasChanged(n,e.file)&&this._addRemoteEntry(e.file);var o=this.getDefaultItemStore();if(e.deleted){var l=this.getAttachment(e.fileId);this._deleteFile(l)}else{var d=0,h=[];(l=this.getAttachment(e.fileId)).forEachItem(o,t=>{var a=0,i=!1;for(let r=0;r<e.file.parents.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let s=e.file.parents[r];if(s.isRoot&&t.parent()&&t.parent().isRootItem()||t.parent()&&t.parent().hasAttachment(s.id)){i=!0,h.push(s.id);break}}t.parent()&&this._isSpecialFolder(t.parent().id)&&(i=!0,h.push(t.parent().id)),!i&&t.parent()&&(t.parent().removeChild(t,r.a.ChangeType.Remote),t.setParent(void 0))});for(let t=0;t<e.file.parents.length;++t){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;let a=e.file.parents[t];if(h.indexOf(a.id)<0)if(a.isRoot){var c=o.getRoot();let t=o.createItem(this._createItemID(e.fileId,o),this._getTextForItem(e.file),c.id,{demandLoadChildren:e.file.mimeType===Fe});c.insertSorted(t,this.sortFn)}else{this.getAttachment(a.id).forEachItem(o,t=>{let a=o.createItem(this._createItemID(e.fileId,o),this._getTextForItem(e.file),t.id,{demandLoadChildren:e.file.mimeType===Fe});t.insertSorted(a,this.sortFn)})}}if(this.displaySharedWithMe&&e.file.sharedWithMeDate&&h.indexOf(Je)<0){var u=o.getItem(Je);let t=o.createItem(this._createItemID(e.fileId,o),this._getTextForItem(e.file),u.id,{demandLoadChildren:e.file.mimeType===Fe});u.insertSorted(t,this.sortFn)}}}}_isValidFileID(e){return e.indexOf("~")<0}_createItemID(e,t){var a=0;try{i.default.PAssert(708,e,"Must provide a fileID")}catch(n){i.default.reportError(n)}try{i.default.PAssert(709,this._isValidFileID(e),"Invalid fileID - "+e)}catch(n){i.default.reportError(n)}try{i.default.PAssert(710,t,"Must provide a valid itemStore")}catch(n){i.default.reportError(n)}for(var r=e,s=0;t.hasItem(r)&&s<50;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r=e+"~"+ ++s}try{i.default.PAssert(711,s<50,"SANITY: Should not have items with 50+ parents")}catch(n){i.default.reportError(n)}return r}_hasSameItem(e,t,a){for(var i=0,r=!1,s=e,n=0;a.hasItem(s)&&n<50;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=a.getItem(s);if(o&&o.parent()&&o.parent().id===t){r=!0;break}s=e+"~"+ ++n}return r}_isSpecialFolder(e){return e.startsWith("S~")}requestDemandLoadData(e,t){try{i.default.PAssert(712,1===t.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(o){i.default.reportError(o)}var a,r=Wr.PaneManager.getPaneById(e),s=t.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(t.id))switch(t.id){case Je:a="trashed=false and sharedWithMe and mimeType != '"+He+"'";break;default:try{i.default.PAssert(713,!1,"Invalid special folder ID")}catch(o){i.default.reportError(o)}}a||(a="trashed=false and '"+s.id+"' in parents and mimeType != '"+He+"'");var n=this.getActiveItemStore(e);this._requestRemoteFiles(Ke,t,a,70,e=>{if(this.hasCacheData(e.id)||this._addRemoteEntry(e),!this._hasSameItem(e.id,t.id,n)){var a=n.createItem(this._createItemID(e.id,n),this._getTextForItem(e),t.id,{demandLoadChildren:e.mimeType===Fe});t.insertSorted(a,this.sortFn)}},e=>{e||t.hasPaginationToken()||t.notifyLoadDataFailed(r)}),this.sendEvent("RequestDemandLoadData")}requestDataPage(e){this._requestRemoteFiles(Xe,e)}_ensureAncestorChain(e,t,a,r){try{i.default.PAssert(714,a,"Must provide a valid success callback")}catch(g){i.default.reportError(g)}try{i.default.PAssert(715,r,"Must provide a valid error callback")}catch(g){i.default.reportError(g)}if(t.parents&&t.parents.length)for(var s=0,n=t.parents.length,o=0,l=()=>{++o===n&&a()},d=t=>{try{i.default.PAssert(716,t,"Must provide valid fileInfo up ancestor chain")}catch(g){i.default.reportError(g)}this.hasCacheData(t.id)||this._addRemoteEntry(t),this._ensureAncestorChain(e,t,l,r)},h=e=>{if(e){var t=this.serializeExternalData(e);this._folderCache.saveEntry(t),d(t)}else r({error:"Undefined success result."})},c=e=>{if(e)d(e);else{var t=pe.a.fns("drive").files.get.packedFn,a={fileId:e.id};this._queueRemoteRequestMulti(ke.a.getDefaultAccountID(),t,a,h,r,void 0,$e)}},u=0;u<t.parents.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var p=t.parents[u].id;try{i.default.PAssert(717,p,"Must supply a valid parent ID to query")}catch(g){i.default.reportError(g)}c(this._folderCache.getEntry(p))}else a()}_hasAttachmentChild(e,t){for(var a=0,i=!1,r=0;r<e.numItems();++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e.itemAtIndex(r).hasAttachment(t)){i=!0;break}}return i}_attachAncestorChain(e,t){try{i.default.PAssert(718,t,"Must provide a valid cache entry to create items for")}catch(o){i.default.reportError(o)}if(t.parents&&t.parents.length>0)for(var a=0,r=0;r<t.parents.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t.parents[r];try{i.default.PAssert(719,s&&s.id,"Must supply a valid parent ID to query")}catch(o){i.default.reportError(o)}if(s.isRoot){var n=e.getRoot();if(!this._hasAttachmentChild(n,t.id)){let a=e.createItem(this._createItemID(t.id,e),this._getTextForItem(t),n.id,{demandLoadChildren:t.mimeType===Fe});n.insertSorted(a,this.sortFn)}}else this._folderCache.getEntry(s.id).then(a=>{this._attachAncestorChain(e,a),this.getAttachment(a.id).forEachItem(e,a=>{if(!this._hasAttachmentChild(a,t.id)){let i=e.createItem(this._createItemID(t.id,e),this._getTextForItem(t),a.id,{demandLoadChildren:t.mimeType===Fe});a.insertSorted(i,this.sortFn)}})})}}getNextSearchPage(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()}runRemoteSearch(e,t,a,s){try{i.default.PAssert(720,e,"Must provide a valid search")}catch(m){i.default.reportError(m)}try{i.default.PAssert(721,t,"Must provide a valid pane")}catch(m){i.default.reportError(m)}try{i.default.PAssert(722,i.default.isFunction(s),"Must provide a valid search callback")}catch(m){i.default.reportError(m)}var n=!1,o=0,l=0,d=0,h=new Ce(e,10,this.requestDataPage.bind(this)),c=()=>{if(o===l&&n){i.default.log("Done Searching! "+o);var e=r.a.SearchResultStatus.Done;if(h.isValid())Wr.PaneManager.getPaneById(t).search.update(!0),h.isValid()&&h.hasMoreResults()?(i.default.log("Too many search results"),e=r.a.SearchResultStatus.TooMany):h.hasError()||d>0?e=r.a.SearchResultStatus.Error:0===o&&(e=r.a.SearchResultStatus.None),this._lastCompletedSearch=h;s(e)}},u=e=>{o++,this.hasCacheData(e.id)||this._addRemoteEntry(e);var a=this.getActiveItemStore(t);this._ensureAncestorChain(a,e,()=>{h.isValid()&&this._attachAncestorChain(a,e),l++,c()},e=>{i.default.reportError(new Error("Error during remote search: "+e)),l++,d++,c()})},p=e=>{n=!0,c()},g=!1,f="trashed=false and (fullText contains '"+e+"')";return this._requestRemoteFiles(Ye,h,f,100,h.onEntry,e=>{h.onDone(e),g||(g=!0,h.isValid()&&(h.hasResults()?h.getNextPage(u,p):p()))}),this.sendEvent("RemoteSearch"),h}_requestRemoteFiles(e,t,a,r,s,n){var o;t&&t.hasPaginationToken()&&!t.paginationTokenInUse()?(a=(o=t.beginDataPageLoad()).getQuery(),r=o.getMaxResults(),s=o.getEntryCB(),n=o.getDoneCB()):t&&t.needsPaginationToken()&&(o=this.createPaginationToken(void 0,a,{},r,s,n),t.setPaginationToken(o),t.beginDataPageLoad()),r=r||70;try{i.default.PAssert(723,s&&i.default.isFunction(s),"Must define a valid entry callback")}catch(u){i.default.reportError(u)}try{i.default.PAssert(724,n&&i.default.isFunction(n),"Must define a valid done callback")}catch(u){i.default.reportError(u)}var l,d,h=pe.a.fns("drive").files.list.packedFn,c={fields:"items,nextPageToken",maxResults:r,q:a,pageToken:o&&o.hasMorePages()?o.getNextPageToken():void 0};o||!t?(l=e=>{if(e.items){var a=0;Wr.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<e.items.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;s(e.items[i])}Wr.PaneUpdateBatcher.commitUpdateItems()}e.nextPageToken&&o&&this.updatePaginationToken(o,e.nextPageToken),t&&o&&t.endDataPageLoad(!!e.nextPageToken),n(!0)},d=()=>{o&&t.endDataPageLoad(!!o),n(!1)}):(l=()=>{n(!0)},d=()=>{n(!1)}),ke.a.onActiveUser(t=>{this._queueRemoteRequestMulti(t,h,c,l,d,void 0,e)})}getRemoteAttachmentData(e){var t=pe.a.fns("drive").files.get.packedFn,a={fileId:e.id},s=t=>{try{i.default.PAssert(725,!t||t.id===e.id,"If valid result, attachment should match remote file ID")}catch(a){i.default.reportError(a)}t&&(this._addRemoteEntry(t),(t.deleted||t.mimeType===Fe)&&(t.deleted?this._folderCache.hasEntry(t.id).then(e=>{e&&this._folderCache.removeEntry(t.id)}):this._folderCache.saveEntry(this.serializeExternalData(t))))},n=t=>{if(i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.NotFound)){var a={id:e.id,mimeType:Oe,title:"Unknown",titleLower:"unknown",fileSize:0};this._addRemoteEntry(a),this._deleteFile(e)}else e.notifyDataRequestFailed(),this._notifyFailedRequest(t)};ke.a.onActiveUser(i=>{this._queueRemoteRequestMulti(i,t,a,s,n,e,We)})}_requestChangeList(e,t,a){let r,s,n,o;if(e&&e>=0){try{i.default.PAssert(726,t,"Must supply a valid entry CB")}catch(l){i.default.reportError(l)}try{i.default.PAssert(727,a,"Must provide a valid done CB")}catch(l){i.default.reportError(l)}r=pe.a.fns("drive").changes.list.packedFn,s={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+e+1,fields:"items,nextPageToken"},n=r=>{var s=0,n=e;Wr.PaneUpdateBatcher.beginUpdateItems();for(var o=0;o<r.items.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=r.items[o];try{i.default.PAssert(728,d,"Must have a valid change entry")}catch(l){i.default.reportError(l)}try{i.default.PAssert(729,parseInt(d.id)<1e8,"Must have a valid entry ID")}catch(l){i.default.reportError(l)}try{i.default.PAssert(730,parseInt(d.id)>parseInt(n),"Must be ordered monotonic increasing")}catch(l){i.default.reportError(l)}n=d.id,t(d)}Wr.PaneUpdateBatcher.commitUpdateItems(),r.nextPageToken?this._requestChangeList(n,t,a):a(!0)},o=e=>{a(!1)}}else r=pe.a.fns("drive").changes.list.packedFn,s={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:1e8},n=e=>{let i=e.largestChangeId;t({id:i}),a(!0)},o=e=>{a(!1)};ke.a.onActiveUser(e=>{this._queueRemoteRequestMulti(e,r,s,n,o,void 0,Qe)})}_createRemoteEntry(e){var t={id:e.id,mimeType:e.mimeType,title:e.title,titleLower:e.title.toLowerCase(),alternateLink:e.alternateLink,webContentLink:e.webContentLink||e.alternateLink,dataUrl:e.dataUrl,fileSize:+e.fileSize,parents:e.parents,modifiedDate:e.modifiedDate?new Date(e.modifiedDate):void 0};if(t.parents)for(var a=0,i=0;i<t.parents.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._updateParentsEntry(t.parents[i])}return this.isFolder(t)&&(t.items=[]),t}_addRemoteEntry(e){var t=this._createRemoteEntry(e);this.cacheData(t.id,t)}createEntryFromLocal(e,t){if(this.isFolder(t)&&(t.items=[]),t.titleLower=t.title.toLowerCase(),t.modifiedDate=t.modifiedDate?new Date(t.modifiedDate):void 0,t.isDeleted=t.isDeleted||i.default.isTempId(e),t.parents)for(var a=0,r=0;r<t.parents.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._updateParentsEntry(t.parents[r])}return t}_updateParentsEntry(e){this._folderCache.getEntry(e.id).then(t=>{t&&(e.title=t.title)})}isFolder(e){return e.mimeType===Fe}_getCompStringForItem(e){return e.hasPluginAttachment(this.id)?e.getAttachmentByPlugin(this.id).getTitleString():e.getParsedText()}_isItemPinnedToTop(e){return!!e.hasPluginAttachment(this.id)&&e.getAttachmentByPlugin(this.id).getField("pinToTop")}sortFn(e,t){return this._isItemPinnedToTop(e)?-1:this._isItemPinnedToTop(t)?1:this._getCompStringForItem(e).localeCompare(this._getCompStringForItem(t))}getAttachmentClass(e){var t=["plugin_drive"];return e.hasField("mimeType")?t.push(this.getMimetypeClass(e)):t.push("plugin_drive_unk"),e.hasField("isDeleted")&&e.getField("isDeleted")&&t.push("fileDeleted"),t}getMimetypeClass(e){var t=e.getField("mimeType");if(this.isMimetypeImage(t))return e.getField("showInline")?"plugin_drive_image_inline":"plugin_drive_image";switch(t){case Fe:return"plugin_drive_folder";case Ne:return"plugin_drive_sheet";case Be:return"plugin_drive_slide";case Ue:return"plugin_drive_doc";default:return"plugin_drive_unk"}}isMimetypeImage(e){switch(e){case Ve:case qe:case je:case ze:return!0}}isImage(e){var t=this.getMimetypeClass(e);return e.hasField("mimeType")&&("plugin_drive_image"===t||"plugin_drive_image_inline"===t)}googleScopes(e){return e||this.getSetting(this.Settings.WriteAccess)?[r.a.GScope.DriveFull]:[r.a.GScope.Drive,r.a.GScope.DriveMetadataRO]}getDependencies(){return[r.a.PluginDependency.PremiumSub,r.a.PluginDependency.GoogleLogin]}verifyAuthorization(e){return re.a.isAuthorizedForScopes(e,this.googleScopes())}handleDropEvent(e,t){var a=e.dataTransfer?e.dataTransfer.getData("text/uri-list"):void 0,s=i.default.getPaneForElement(e.target);if(a&&a.startsWith(Ze)){var n=a.replace(Ze,""),o=n.indexOf("&"),l=n.substr(0,o);return i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Dropped File: ",l),t(this.getAttachment(l).getEmbedString()),!0}if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){for(var d=0,h=0;h<e.dataTransfer.files.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var c=e.dataTransfer.files[h];this.handleDropFile(c,s,e,t)}return P.d.miscAction({type:P.b.Misc,misc:P.a.DriveUpload}),!0}if(e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0){var u=0;for(h=0;h<e.clipboardData.items.length;++h){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var p=e.clipboardData.items[h];(c=p?p.getAsFile():void 0)&&(c.customName="Moo.do Upload "+Date.now(),this.handleDropFile(c,s,e,t))}return P.d.miscAction({type:P.b.Misc,misc:P.a.DriveUpload}),!0}return!1}highlightItem(e){e.highlight()}handleDropFile(e,t,a,s){var n=0;let o=e.customName||e.name,l=this.findCachedItemsByField("title",o),d=this.getDefaultItemStore(),h=t.type===r.a.PaneMode.Task&&this.isMimetypeImage(e.type)&&Wr.settings.showImagesInline.get()?{showInline:!0}:void 0,c=!1;for(var u=0;u<l.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var p=l[u];if(p.fileSize===e.size&&!p.isDeleted){let e=this.getAttachment(p.id,h);if(t&&t.isWriteable&&t.plugin!==this)s(this.getAttachmentEmbedString(e),!1);else if(t&&t.plugin===this){let t=this.getDefaultItemStore();e.forEachItem(t,this.highlightItem)}c=!0;break}}if(!c){var g=i.default.generateTempId();this.cacheData(g,{title:o,titleLower:o.toLowerCase(),mimeType:e.type});let r=this.getAttachment(g,h);var f,m,v=t&&t.isWriteable&&t.plugin!==this,y=!1;if(t&&t.isWriteable&&t.plugin!==this)y=!0;else if(a&&this.getSetting(this.Settings.WriteAccess)){var _=a.target;(f=i.default.hasClass(_,"paneContent")?t.getItem():i.default.getItemForElement(_))&&!f.isHeader()&&(f=f.parent())}if(f){if(!f.isRootItem()){var S=f.getAttachmentByPlugin(this.id);try{i.default.PAssert(731,S,"Drive items must have valid attachments")}catch(P){i.default.reportError(P)}m=S.id}}else f=d.getRoot(),m=this.getSetting(this.Settings.DriveRootId);let n=t.getDocument();this._upload(e,r,v,n,m,()=>{try{i.default.PAssert(732,!d.hasItem(r.id),"When uploading a new file, should never have duplicated items")}catch(P){i.default.reportError(P)}var e=d.createItem(r.id,this.getAttachmentEmbedString(r),f.id);f.insertSorted(e,this.sortFn),y&&s(this.getAttachmentEmbedString(r),!0),n.isShared()&&Wr.toasts.pushMessage({text:"Note: Sharing files with collaborators is temporarily disabled while we rebuild it for the new backend",timeout:8e3})})}}notifyDropFrom(e,t){try{i.default.PAssert(733,e,"Must have a valid item that was dropped")}catch(n){i.default.reportError(n)}try{i.default.PAssert(734,t,"Must have a valid pane the item was dropped on")}catch(n){i.default.reportError(n)}if(!i.default.isDemoMode()){var a=e.getAttachmentByPlugin(this.id),s=t.getDocument();Re.a.getDocumentFolder(s.id,e=>{Re.a.copyFileToFolder(a.id,e,(e,t)=>{e||this.getSetting(this.Settings.WriteAccess)&&t.code===r.a.HTTPStatusCode.Unauthorized&&this.setSetting(this.Settings.WriteAccess,!1)})}),this.sendEvent("AttachmentDropped")}}notifyDropFromToEdit(e,t){if(!i.default.isDemoMode())if(this.getSetting(this.Settings.WriteAccess)){if(e.getAttachmentByPlugin(this.id)){var a=document.createEvent("Event");a.item=e,a.initEvent("cdrop",!0,!0),t.dispatchEvent(a)}this.sendEvent("AttachmentDroppedEdit")}else Wr.toasts.pushMessage(r.a.MessageID.NeedDrivePermission)}getAttachUrl(e){var t=this.getCacheData(e.id);if(t)return t.webContentLink&&t.webContentLink.replace("export=download","")||t.dataUrl}getAttachDataUrl(e){var t=this.getCacheData(e.id);return t&&t.dataUrl}handleTapStart(e,t,a,i){return!0}handleTapClick(e,t,a,i){var r=this.getAttachment(a);if(y.a.mac&&i.metaKey||!y.a.mac&&i.ctrlKey||this.isPluginPane)return this.openAttach(r,e,t,!0,i)}openAttach(e,t,a,s,n){var o=this.getCacheData(e.id);if(o){var l;if(this.isPluginPane(a)&&this.isFolder(o))a.zoomIn(t),this.sendEvent("Tap_FolderZoom");else o.alternateLink?l=o.alternateLink:o.id?l=this._createDriveURL(o.id,o.mimeType):Wr.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:r.a.MessageAction.Okay}),l&&(s&&!(y.a.mac&&n.metaKey||!y.a.mac&&n.ctrlKey)&&this.isImage(e)?(l="https://drive.google.com/uc?export=view&id="+o.id,Wr.menus.openLightbox(l)):l&&(i.default.isDemoMode()?Wr.toasts.pushMessage(r.a.MessageID.DemoPluginClick):(i.default.openUrl(l,n),this.sendEvent("Tap_OpenFileDesktop"))));return!0}return!1}createFolderURL(e){return"https://drive.google.com/drive/folders/"+e}_createDriveURL(e,t){var a="https://docs.google.com/";switch(t){case Fe:return a+"folderview?id="+e+"&usp=drivesdk";case Ne:return a+"spreadsheets/d/"+e+"/edit?usp=drivesdk";case Ue:return a+"document/d/"+e+"/edit?usp=drivesdk";case Be:return a+"presentation/d/"+e+"/edit?usp=drivesdk";default:return a+"file/d/"+e+"/edit?usp=drivesdk"}}compactCacheField(e,t){var a;switch(t){case"alternateLink":e[t]!==this._createDriveURL(e.id,e.mimeType)&&(a=e[t]);break;default:a=e[t]}return a}supportUsageCache(){return!0}matchAttachment(e,t){return e.getField("titleLower").indexOf(t)>=0}getBlockedText(e){return"Go Premium to view Drive files"}onDocumentShared(e){this.getSetting(this.Settings.WriteAccess)?e&&this._ensureAttachmentsAreShared():this.numActiveAttachments()>0&&Wr.toasts.pushMessage(r.a.MessageID.NoSharingWarning)}_ensureAttachmentsAreShared(){}notifyAttachmentUnused(e,t){super.notifyAttachmentUnused(e,t),i.default.isDemoMode()}_upload(e,t,a,s,n,o){e.size>20971520?(Wr.toasts.pushMessage(r.a.MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var l=this.isMimetypeImage(e.type)&&Wr.settings.showImagesInline.get();if(l){let a=new FileReader;a.onload=e=>{var a=this.getCacheData(t.id);a.dataUrl=e.target.result,this.cacheData(t.id,a),o(e)},a.readAsDataURL(e)}var d=new FileReader;d.readAsBinaryString(e),d.onload=o=>{var l=e.type||Oe,h=(r,s)=>{var o={title:e.customName||e.name,mimeType:l,parents:n?[{id:n}]:[]};a&&s&&o.parents.push({id:s});var h=btoa(d.result),c=tt+"Content-Type: application/json\r\n\r\n"+JSON.stringify(o)+tt+"Content-Type: "+l+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+h+"\r\n---------314159265358979323846--";window.gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{Authorization:r?"Bearer "+r.access_token:void 0,"Content-Type":'multipart/mixed; boundary="'+et+'"'},body:c}).execute(e=>{this.changeID(t,t.id,e.id),Wr.remoteAPI().drivePermissionsPublic(e.id,()=>{let a=this.getAttachDataUrl(t);a&&(e.dataUrl=a),this._addRemoteEntry(e)},e=>{i.default.reportError(new Error("Error adding permission"))})})};try{i.default.PAssert(735,s,"Must supply a valid paneDoc if uploading a file")}catch(c){i.default.reportError(c)}this.getDocumentFolder(s,e=>{re.a.getDefaultAuthToken(this.googleScopes(),t=>{t?h(t,e):Wr.toasts.pushMessage({text:"Uploading file failed because of missing authorization. Please check the Drive plugin is enabled.",action:r.a.MessageAction.OpenSettings})})})},l||o()}getDocumentFolder(e,t){return Re.a.getDocumentFolder(e.id,t)}scheduleFile(e,t){P.d.beginAction();var a=e.getAttachmentByPlugin(this.id);try{i.default.PAssert(736,a,"Must be able to get a valid attachment from item")}catch(h){i.default.reportError(h)}var s=r.a.MSPerHour,n=Wr.pluginManager.getPluginGCalendar();if(n){var o=n.getDefaultExportCalendarID();if(o&&(i.default.isDemoMode()||n.getSetting(n.Settings.WriteAccess))){var l=a.getField("title"),d=this._createDriveURL(a.id,a.getField("mimeType"));n.createEventForEmail(o,l,d,t,s,(e,t,a,i)=>{e||t?t||Wr.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:r.a.MessageAction.Okay}):Wr.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:()=>{Wr.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:r.a.MessageAction.Okay})}})})}else Wr.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:r.a.MessageAction.OpenCalendarSettings})}else Wr.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:r.a.MessageAction.OpenSettings});P.d.endAction()}findMatchExact(e){}findMatchLike(e,t){var a=e.toLowerCase(),i=this.findCachedItemsByFn(e=>e.titleLower.indexOf(a)>=0,t);return i.sort((e,t)=>e.modifiedDate&&t.modifiedDate?Date.compare(e.modifiedDate,t.modifiedDate):e.modifiedDate?-1:t.modifiedDate?1:e.titleLower.localeCompare(t.titleLower)),i}getAttachWidth(e){return e.hasField("imageWidth")&&e.getField("imageWidth")?+e.getField("imageWidth"):void 0}setAttachWidth(e,t,a){t.updateField("imageWidth",a,!0),e.onAttachInlineUpdate()}setShowInline(e,t,a){t.updateField("showInline",a,!0),e.onAttachInlineUpdate()}},p()(Le.prototype,"sortFn",[f.a],Object.getOwnPropertyDescriptor(Le.prototype,"sortFn"),Le.prototype),Le),rt="Gmail";function st(e){var t={subject:e.subject||"",from:e.from||"",id:e.mailMessageId?e.mailMessageId:"mailbird_"+e.id,latestMessageAt:e.latestMessageAt};return e.gmailID&&(t.provider="Gmail",t.threadID=e.gmailID),t}let nt=new class{dragOver(e){var t=i.default.elementFromPoint(e.x,e.y);if(t){var a=void 0!==this._prevX?e.x-this._prevX:0,r=void 0!==this._prevY?e.y-this._prevY:0;this._prevX=e.x,this._prevY=e.y;var s={clientX:e.x,clientY:e.y,diffX:a,diffY:r,target:t,dataTransfer:{}};Wr.DragDrop.handleDragOver(s)}}drop(e){var t=i.default.elementFromPoint(e.x,e.y),a={clientX:e.x,clientY:e.y,target:t,dataTransfer:{getData:t=>{if("mailbird/email"===t)return st(e)}},preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn};setTimeout(()=>{Wr.DragDrop.handleDrop(a)},0)}dragLeave(){Wr.DragDrop.handleDragLeave({target:document.getElementById("container")})}reportError(e){i.default.reportError(new Error(e))}};var ot=(at=class extends Se{constructor(){if(super(r.a.PluginID.Mailbird,"b","Mailbird",!0),this.declareProperty("subject",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!1,""),this.declareProperty("from",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!1,""),this.declareProperty("date",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,new Date),this.declareProperty("subjectLower",r.a.PluginLoad.Runtime,!1,""),this.declareProperty("fromLower",r.a.PluginLoad.Runtime,!1,""),this.declareProperty("unread",r.a.PluginLoad.Runtime,!0,!1),this.declareProperty("snippet",r.a.PluginLoad.Runtime,!0,""),this.declareProperty("count",r.a.PluginLoad.Runtime,!0,1),this.declareProperty("latestMessageAt",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!1),this.declareProperty("provider",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!0),this.declareProperty("threadID",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!0),this.declareProperty("hasAttachments",r.a.PluginLoad.Full,!0,!1),this.useRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.EmailThread),this.useRenderer(r.a.PluginRenderTypes.UnstyledText,r.a.PluginRenderers.EmailThread),this.useRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.EmailThread),this.isMailbirdEmbed=y.a.embed===r.a.EmbedApps.Mailbird,this.isMailbirdEmbed){this.setSetting(this.Settings.IsEnabled,!0),this._needInlineDataUpdate=[],Wr.nativeBridge.registerEmbedBridge(this);var e=Wr.nativeBridge.registerInboundAPI("mailbird");try{i.default.PAssert(669,e,"Error creating native inbound API for mailbird")}catch(t){i.default.reportError(t)}e&&(e.registerVariable("_prevX"),e.registerVariable("_prevY"),e.registerFunction("dragOver",nt.dragOver,!0),e.registerFunction("drop",nt.drop,!0),e.registerFunction("dragLeave",nt.dragLeave,!0),e.registerFunction("reportError",nt.reportError,!0)),this._mailbirdOutAPI=Wr.nativeBridge.registerOutboundAPI("mailbird");try{i.default.PAssert(670,this._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(t){i.default.reportError(t)}this._mailbirdOutAPI&&(this._mailbirdOutAPI.requireFunction("selectConversation"),this._mailbirdOutAPI.requireFunction("selectConversationEx",!0),this._mailbirdOutAPI.requireFunction("scheduleNotifications",!0),this._mailbirdOutAPI.requireFunction("getByIdEx",!0),this._canUpdateInlineData=this._mailbirdOutAPI.hasOptionalFunction("getByIdEx"))}}getPaneIcon(){return"icon-envelope"}useItemStore(){return"Mailbird"}_addRemoteEntry(e){var t={id:e.id,provider:e.provider,threadID:e.threadID,subject:e.subject,subjectLower:e.subject.toLowerCase(),from:e.from,fromLower:e.from.toLowerCase(),latestMessageAt:e.latestMessageAt};return this.cacheData(t.id,t),t}createEntryFromLocal(e,t){return t.subjectLower=t.subject.toLowerCase(),t.fromLower=t.from.toLowerCase(),t}getAttachmentClass(e){return["plugin_mailbird"]}isPluginBlocked(){return!1}handleEmbedMessage(e,t){switch(e){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var a=JSON.stringify(t);this._mailbirdOutAPI.call("scheduleNotifications",a)}catch(r){i.default.reportError(r)}break;default:try{i.default.PAssert(671,!1,"Unknown embed message: "+e)}catch(s){i.default.reportError(s)}}}handleDropEvent(e,t){try{i.default.PAssert(672,t,"Must provide a valid callback to the drop event")}catch(n){i.default.reportError(n)}if(e.dataTransfer){var a=e.dataTransfer.getData("mailbird/email");if(a){var r=this._addRemoteEntry(a),s=this.getAttachment(r.id,r);try{i.default.PAssert(673,s.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(n){i.default.reportError(n)}return t(this.getAttachmentEmbedString(s)),!0}}return!1}handleTapStart(e,t,a,i){return!0}handleTapClick(e,t,a,s){var n=this.getCacheData(a);if(!n){let e=this.getAttachment(a);e&&(n=e.getInlineData())}if(n){if(this.isMailbirdEmbed){var o;if(!n.id.startsWith("mailbird_")&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var l=null;if("Gmail"===n.provider){try{i.default.PAssert(674,n.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(h){i.default.reportError(h)}l=parseInt(n.threadID)}var d=n.id;o=this._mailbirdOutAPI.call("selectConversationEx",l,d,+n.latestMessageAt)}else{d=n.id.replace("mailbird_","");o=this._mailbirdOutAPI.call("selectConversation",d)}try{i.default.PAssert(675,void 0!==o,"Must always receive a value back from Mailbird")}catch(h){i.default.reportError(h)}if(!0===o||!1===o)try{i.default.PAssert(676,o,"Must have successfully selected the email conversation in Mailbird: ",n.id,n.provider)}catch(h){i.default.reportError(h)}else{try{i.default.PAssert(677,o&&o.then,"Must have a valid promise object returned")}catch(h){i.default.reportError(h)}o.then(e=>{try{i.default.PAssert(678,e,"Must have successfully selected the email conversation in Mailbird: ",n.id,n.provider)}catch(h){i.default.reportError(h)}},e=>{try{i.default.PAssert(679,!1,"Failed to successfully select the email conversation in Mailbird: ",n.id,n.provider)}catch(h){i.default.reportError(h)}})}}else switch(n.provider){case rt:i.default.openUrl("https://mail.google.com/mail/u/0/#inbox/"+n.threadID);break;default:Wr.toasts.pushMessage(r.a.MessageID.MailbirdClick)}return!0}return!1}getDisplayTags(e){return[]}getDisplayParticipants(e){return""}matchAttachment(e,t){return e.getField("fromLower").indexOf(t)>=0||e.getField("subjectLower").indexOf(t)>=0}findMatchExact(e){}findMatchLike(e,t){var a=e.toLowerCase();return this.findCachedItemsByFn(function(e){return e.subjectLower.indexOf(a)>=0||e.fromLower.indexOf(a)>=0},t)}requestData(e,t){e.hasField("subject")?(e.notifyDataLoaded(r.a.PluginLoad.Full,!1,void 0,r.a.ChangeType.Remote),e.hasInlineData()||!this.isMailbirdEmbed||this._needInlineDataUpdate.includes(e)||(this._needInlineDataUpdate.push(e),this._timeoutInlineDataUpdate||(this._timeoutInlineDataUpdate=setTimeout(this.processMissingInlineUpdates,1e3))),e.hasField("latestMessageAt")||this.requestMissingData(e)):this.requestMissingData(e)}requestMissingData(e){this._canUpdateInlineData&&setTimeout(()=>{this._mailbirdOutAPI.call("getByIdEx",e.id).then(t=>{try{let r=st(JSON.parse(t));this.cacheData(r.id,r),this.fixAttach(e)}catch(a){i.default.reportError(a)}})},1e3)}processMissingInlineUpdates(){let e=this._needInlineDataUpdate;if(e.length>0)for(var t=0,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let i=e[a];i.isLoaded()&&this.fixAttach(i)}}fixAttach(e){e.forEachItem(Wr.itemStoreManager.getDefaultItemStore(),t=>{let a=t.getRawText();a=a.replace(this._getTextForItem(e.getData()),this.getAttachmentEmbedString(e)),t.setText(t.getParsedText(),r.a.ChangeType.Local)})}},p()(at.prototype,"processMissingInlineUpdates",[f.a],Object.getOwnPropertyDescriptor(at.prototype,"processMissingInlineUpdates"),at.prototype),at);function lt(e){this._maxSize=e,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}lt.prototype={registerOwner:function(e,t){try{i.default.PAssert(1545,e,"Must supply a valid owner object")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1546,!this._registeredOwners[t],"Must not double define an owner")}catch(a){i.default.reportError(a)}this._registeredOwners[t]=e,this._registeredActions[t]={}},registerAction:function(e,t,a){try{i.default.PAssert(1547,e,"Must provide a valid owner")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1548,t,"Must provide a valid action ID")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1549,this._registeredOwners[e],"Must have already registered a valid owner")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1550,!this._registeredActions[e][t],"Must not double define an action for an owner")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1551,a,"Must pass in a valid undo/redo descriptor")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1552,i.default.isFunction(a.undo),"Must provide a valid undo fn")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1553,i.default.isFunction(a.redo),"Must provide a valid redo fn")}catch(r){i.default.reportError(r)}this._registeredActions[e][t]=a},_getOwner:function(e){try{i.default.PAssert(1554,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){i.default.reportError(t)}return this._registeredOwners[e.ownerID]},_getActionData:function(e){try{i.default.PAssert(1555,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){i.default.reportError(t)}try{i.default.PAssert(1556,this._registeredActions[e.ownerID][e.actionID],"Must have previously registered action for owner")}catch(t){i.default.reportError(t)}return this._registeredActions[e.ownerID][e.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(e){return{id:this._useNextGroupID(),events:e||[]}},_pushNewGroup:function(e){var t=this._createGroup(e);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(t),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(e){if(0===this._aggregateActions){try{i.default.PAssert(1557,0===this._currentAction.length,"Current actions should be flushed")}catch(t){i.default.reportError(t)}this._actionsPreventUndo=!!e}this._aggregateActions++},runAction:function(e,t,a){var i={ownerID:e,actionID:t},r=this._getOwner(i);return this._getActionData(i).redo.apply(r,a)},performAction:function(e,t,a){try{i.default.PAssert(1558,this._aggregateActions>0,"Must be in a begin/end action block")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1559,a,"Must provide valid data for the action")}catch(r){i.default.reportError(r)}this._currentAction.push({ownerID:e,actionID:t,data:a})},performActions:function(e){if(e&&e.length>0){var t=0;this.beginAction();for(var a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];this.performAction(i.ownerID,i.actionID,i.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var e=0,t=this._groups[this._cursor--],a=t.events.length-1;a>=0;a--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t.events[a],r=this._getOwner(i);this._getActionData(i).undo.apply(r,i.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var e=0,t=this._groups[++this._cursor],a=0;a<t.events.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t.events[a],r=this._getOwner(i);this._getActionData(i).redo.apply(r,i.data.redoParams)}}};var dt=lt,ht="Moo.do",ct={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},ut={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},pt={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},gt={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},ft={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0};var mt=class{constructor(e,t,a,s,n,o){try{i.default.PAssert(1575,e,"Must specify a valid account ID")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1576,t,"Must specify a valid label ID")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1578,!s||i.default.isDateValid(s),"Must provide a valid oldestSync date")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1579,o,"Must supply a valid label store this label belongs to")}catch(l){i.default.reportError(l)}this._labelStore=o,this._accountID=e,this._labelID=t,this._fullName=a,this._minName=void 0,this._matchName=a?a.toUpperCase():void 0,this._oldestSync=s,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!n||!n.isDeleted),this._labelListVisibility=n&&n.labelListVisibility?n.labelListVisibility:r.a.LabelListVisibility.Show,this._messageListVisibility=n&&n.messageListVisibility?n.messageListVisibility:r.a.MessageListVisibility.Show,this._origLabelID=void 0}_getDisplayPriority(){return ut[this.getLabelID()]||-1}displayCompare(e){var t=this.isSystemOrSpecialLabel(),a=e.isSystemOrSpecialLabel();return t&&a?this._getDisplayPriority()<e._getDisplayPriority()?1:-1:t?-1:a?1:this.getName().localeCompare(e.getName())}isDropTarget(){return!ft[this.getLabelID()]}_getStoreLabel(e){var t,a=e.toUpperCase();return Object.keys(this._labelStore).some(e=>{var i=this._labelStore[e].getRawName();if(i&&i.toUpperCase()===a)return t=this._labelStore[e],!0}),t}_computeAncestors(){try{i.default.PAssert(1580,this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors")}catch(n){i.default.reportError(n)}if(this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var e=0,t=this._fullName.split("/"),a="",r=0;r<t.length-1;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a+=t[r];var s=this._getStoreLabel(a);s&&s!==this&&this._ancestors.push(s),a+="/"}this._computeMinName()}try{i.default.PAssert(1581,this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")}catch(n){i.default.reportError(n)}}_computeMinName(){for(var e=0,t=this.getRawName(),a=0;a<this._ancestors.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._ancestors[a].getMinName()+"/",r=t.indexOf(i);t=t.substr(r+i.length)}this._minName=t}getAccountID(){return this._accountID}getLabelID(){return this._labelID}getRawName(){return this._fullName}getMinName(){return this._minName?this._minName:this._fullName}getMatchName(){return this._matchName}isMatched(e){try{i.default.PAssert(1582,i.default.isString(e),"Must pass in a valid string for label name")}catch(r){i.default.reportError(r)}var t=!1,a=this.getMatchName();return e&&a&&a.indexOf(e.toUpperCase())>=0&&(t=!0),t}isNamed(e){try{i.default.PAssert(1583,i.default.isString(e),"Must pass in a valid string for label name")}catch(r){i.default.reportError(r)}var t=!1,a=this.getMatchName();return e&&a&&a===e.toUpperCase()&&(t=!0),t}getName(e){var t;if(ct[this.getLabelID()])t=ct[this.getLabelID()];else if(pt[this.getLabelID()])t=pt[this.getLabelID()];else if(e&&this._minName)t=this.getMinName();else if(this._fullName)t=this._fullName;else{try{i.default.PAssert(1584,!this.isLocalOnly(),"Should not have a local-only label without a name")}catch(a){i.default.reportError(a)}t=this.getLabelID()}return t||""}hasName(){return ct[this.getLabelID()]||pt[this.getLabelID()]||!!this._fullName}clearOldestSync(){this._oldestSync=void 0}getOldestSync(){return this._oldestSync}setOldestSync(e){try{i.default.PAssert(1585,i.default.isDateValid(e),"Must provide a valid oldestSync date")}catch(t){i.default.reportError(t)}this._oldestSync=e}getMessageListVisibility(){return this._messageListVisibility}getLabelListVisibility(){return this._labelListVisibility}isLocalOnly(){return i.default.isTempId(this.getLabelID())}updateLabelID(e){try{i.default.PAssert(1587,this.isLocalOnly(),"Should only ever modify local labels")}catch(t){i.default.reportError(t)}this._origLabelID=this.getLabelID(),this._labelID=e}updateLabelName(e){this._fullName=e,this._matchName=e.toUpperCase(),this._computeAncestors()}getSaveData(){return{id:this.getLabelID(),name:this._fullName,oldestSync:this.getOldestSync(),messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted}}getDisplayText(e){var t;return this.getName()&&(t=this.getName().startsWith(ht+"/")?this.getName().substr(ht.length+1):this.getName(e)),t}getOutlineText(){var e=this.getDisplayText();return e?e.replace(/ /g,"_"):void 0}matchesText(e){return this.getDisplayText().toLowerCase().indexOf(e)>=0}hasAncestors(){return!!this._fullName&&this.getAncestors().length>0}getAncestors(){return this._computeAncestors(),this._ancestors}getParent(){var e=this.getAncestors();return e[e.length-1]}isSystemLabel(){return!!ct[this.getLabelID()]}isSpecialLabel(){return!!pt[this.getLabelID()]}isSystemOrSpecialLabel(){return this.isSystemLabel()||this.isSpecialLabel()}isCategoryLabel(){return!!gt[this.getLabelID()]}isArchived(){return"Archived"===this.getName()}isStarred(){return"Starred"===this.getName()}isInbox(){return"Inbox"===this.getName()}isDraft(){return"Draft"===this.getName()}isTrash(){return"Trash"===this.getName()}isCustom(){return!this.isSystemLabel()&&!this.isSpecialLabel()}getUnreadCount(){return this._numUnread}shouldDisplayInLabelList(){var e=!1;return this._isDeleted||(this.getLabelListVisibility()===r.a.LabelListVisibility.Show?e=!0:this.getLabelListVisibility()===r.a.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0&&(e=!0)),e}shouldDisplayInMessageList(){return this._messageListVisibility===r.a.MessageListVisibility.Show}delete(){try{i.default.PAssert(1588,!this.isSystemOrSpecialLabel(),"Should never delete a special or system label")}catch(e){i.default.reportError(e)}this._isDeleted=!0}},vt=a(67),yt=0;var _t,St=class{constructor(e){this._plugin=e,this._headers=[],this._mimeTree=void 0}reset(){this._headers=[],this._mimeTree=void 0}getMessageText(e){return e.decoded}async updateFromDraft(e,t,a,r,s,n){var o,l;if(this.reset(),this.addHeader("From",this._plugin._formatAddressText(a,r,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(t.to,!0)),t.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(t.cc,!0)),t.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(t.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",i.default.encodeMIMEHeader(t.subject||"(no subject)")),t.inReplyTo){this.addHeader("In-Reply-To",t.inReplyTo.trim());var d=e.messages.indexOfWithProperty("messageID",t.inReplyTo);try{i.default.PAssert(1567,d>=0,"Must always be able to find the message being replied to")}catch(f){i.default.reportError(f)}o=e.messages[d]}t.references?l=t.references:o&&(l=(i.default.isTempId(o.messageID)?"":o.messageID)+(o.references?" "+o.references:"")),l&&this.addHeader("References",l.trim());var h,c=await vt.a.generatePlaintext(this.getMessageText(t)),u=this._getAttachedResources(t);if(u.length>0&&(h=this.createMimePart("multipart/mixed"),this.addMimePart(h)),c){let e=this.createMimePart("multipart/alternative");this.addMimePart(e,h);let a=this.createMimePart("text/plain",c,"7bit");this.addMimePart(a,e);let i=this._getInlineResources(t);if(i.length>0){var p=0;let a=this.createMimePart("multipart/related");this.addMimePart(a,e);let r=this.createMimePart("text/html",this.getMessageText(t),"7bit");this.addMimePart(r,a);for(let e=0;e<i.length;++e){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;let t=i[e],r=this.createResourcePart(t);r&&this.addMimePart(r,a)}}else{let a=this.createMimePart("text/html",this.getMessageText(t),"7bit");this.addMimePart(a,e)}}else{let e=this.createMimePart(t.contentType||"text/html",this.getMessageText(t),"7bit");this.addMimePart(e,h)}if(h&&s){var g=0;let a=0,r=()=>{if(++a===u.length){var e=0;for(let t=0;t<u.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;let a=u[t];if(a.id&&i.default.isTempId(!a.id)){let e=this.createResourcePart(a);e&&this.addMimePart(e,h)}}n()}};for(let i=0;i<u.length;++i){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;this._plugin.loadResource(e.id,t.id,u[i].cid,r)}}else setTimeout(n,0)}_getInlineResources(e){var t=[];return i.default.forEachValue(e.resources,function(e){"inline"===e.disposition&&t.push(e)}),t}_getAttachedResources(e){var t=[];return i.default.forEachValue(e.resources,function(e){"attachment"===e.disposition&&e.id&&t.push(e)}),t}addHeader(e,t){try{i.default.PAssert(1568,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(r){i.default.reportError(r)}var a=t.trim().replace(/[\r\n]/g,"");this._headers.push(e+": "+a)}_generateBoundary(){return"=========3141592653589moodo"+Date.now()+ ++yt}createMimePart(e,t,a,r){try{i.default.PAssert(1569,e,"Must supply a valid content type")}catch(s){i.default.reportError(s)}try{i.default.PAssert(1570,void 0===t||a,"Must supply a valid content encoding")}catch(s){i.default.reportError(s)}return{boundary:this._generateBoundary(),contentType:e,content:t,contentEncoding:a,contentDisposition:r,children:[]}}createResourcePart(e){try{i.default.PAssert(1571,e&&e.data,"Must have valid data loaded for resource to embed it in message")}catch(s){i.default.reportError(s)}var t;if(e&&e.data){var a=e.mimeType+'; name="'+e.cid+'"',r=e.disposition+'; filename="'+e.cid+'"';(t=this.createMimePart(a,e.data,e.contentEncoding,r)).contentID=e.cid}return t}addMimePart(e,t){try{i.default.PAssert(1572,e,"Must supply a valid mime part")}catch(a){i.default.reportError(a)}if(t)t.children.push(e);else{try{i.default.PAssert(1573,!this._mimeTree,"Must not yet have a valid mime tree root")}catch(a){i.default.reportError(a)}this._mimeTree=e}}_mimePartToBlob(e){var t="\r\n",a=[];function r(e,t){if(t){try{i.default.PAssert(1574,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(s){i.default.reportError(s)}var r=t.trim().replace(/[\r\n]/g,"");a.push(e+": "+r)}}var s=e.contentType;if(e.content||(s+='; boundary="'+e.boundary+'"'),r("MIME-Version","1.0"),r("Content-Type",s),r("Content-Transfer-Encoding",e.contentEncoding),r("Content-Disposition",e.contentDisposition),e.contentID&&r("Content-ID","<"+e.contentID+">"),t=a.join("\r\n").trim(),t+="\r\n",e.content)t+="\r\n"+e.content+"\r\n";else if(e.children&&e.children.length>0){for(var n=0,o=0;o<e.children.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t+="\r\n--"+e.boundary+"\r\n",t+=this._mimePartToBlob(e.children[o])}t+="--"+e.boundary+"--\r\n"}else t+="\r\n(no text)\r\n";return t}generateBlob(){var e=this._headers.join("\r\n").trim();return e+="\r\n"+this._mimePartToBlob(this._mimeTree)}},Pt=a(62);var It=(_t=class extends Ae.a{constructor(e){let t={title:"Email",contextMenuMode:"Gmail",paneEmptyMessage:"No emails here",paneEmptySearchMessageDefault:"Press enter to search",paneEmptySearchMessage:"Press enter to search",titleContextMenuHeader:"Open label",dropEffect:()=>r.a.DropEffect.Copy,isWriteable:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!1,supportCompleting:!0,supportCheckbox:!0,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:!0,supportReportError:!0,supportCompose:!0,supportPagination:!0,supportVertLines:!1,supportSearchItemAutocomplete:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportLocalSearch:!1,supportClone:!1,supportDeferredItemLoad:!0,supportCellTransition:!1,useLineCache:!1,shouldSearchMatchParents:!1,noOverviewStyle:!0,supportStarClick:!0,supportClickOverviewScroll:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,overviewHasPaneItems:!1,overviewPadLevels:-1,maxWidthFlex:r.a.ExpandedPaneWidth,maxWidth:r.a.ExpandedPaneWidth+200,maxWidthSingle:r.a.ExpandedPaneWidth,widthBiggerInSingle:!1,supportsDocuments:!1,_topBoxHeight:0,searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:e=>{var t;switch(e){case-1:t="-in:trash -is:unread";break;case 1:t="-in:trash is:unread";break;default:t=""}return t},matchFn:(e,t)=>{var a=this.plugin.isItemUnread(t);if(e)return a&&e>0||!a&&e<0?r.a.MatchState.Yes:r.a.MatchState.No}},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:e=>{var t;switch(e){case-1:t="-is:starred";break;case 1:t="is:starred";break;default:t=""}return t},matchFn:(e,t)=>{var a=this.plugin.isItemStarred(t);if(e)return a&&e>0||!a&&e<0?r.a.MatchState.Yes:r.a.MatchState.No}},{name:"priority",remoteStringFn:e=>{var t;switch(e){case r.a.VMLIFlag.P0:t="label:Moo.do/Priority High";break;case r.a.VMLIFlag.P1:t="label:Moo.do/Priority Medium";break;case r.a.VMLIFlag.P2:t="label:Moo.do/Priority Low";break;default:t=""}return t},matchFn:(e,t)=>{return this.plugin.getItemPriority(t)>=e?r.a.MatchState.Yes:r.a.MatchState.No}},{name:"category",remoteStringFn:e=>e?"category:"+e:"",matchFn:(e,t)=>e?this.plugin.itemHasLabel(t,e)?r.a.MatchState.Yes:r.a.MatchState.No:r.a.MatchState.Yes}]};e.plugin=Wr.pluginManager.getPlugin(r.a.PluginID.Gmail),super(e,t),this.type=this.plugin._paneType,this.paneClass="panePlugin paneGmail",this.isInitializing=!0,this._lines=[{text:"\u2000",start:0,length:1,width:0}],this.dragMarginTop=25,this.blocks=[],this.blocksByKey={},this._focusedTrash=!1,this.shouldCheckHeight=!0,this.maxScrollOffset=0,this.selectedIndex=new A.a(-1,this.onSelectedIndexChanged.bind(this)),this._isSearchingRemote=new A.a(!1),this._overviewAccount=new A.a,this._currentSearch=void 0,this._ignoreRestoreScroll=!0,this._failedPageRequest=new A.a(!1),this.viewState=new A.a(e.viewState&&e.viewState.viewMode?e.viewState:{viewMode:r.a.GmailViewMode.Date}),this.item.listen(e=>this._onItemChange(e,!1)),this.viewState.listen(this._onViewStateChange.bind(this)),v.a.binder(this,"onScroll","_runRemoteSearch","searchCompare","onTopTextChanged","headerSearchCompare","onMultiselectReset","changeView","openViewMenu","onEmailComposeClosed","onEmailPreviewClosed"),this.initGmail(),this._firstSelectedItemID=void 0,e.isExpanded&&(Wr.EmailPreview.startOpenOnLoad(this),this._firstSelectedItemID=e.selectedItem),this.isInitializing=void 0}initGmail(){S.a.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),n.a.listen("EmailCompose","onClosed",this.onEmailComposeClosed),n.a.listen("EmailPreview","onClosed",this.onEmailPreviewClosed)}destroy(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),n.a.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),n.a.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),S.a.unlisten("reset",this.onMultiselectReset),super.destroy()}onLoad(){this.plugin.onPaneActivated(()=>{this.isLoading.set(!1)})&&this.isLoading.set(!0),super.onLoad(),this.addScrollListener(this.onScroll),this._onItemChange(this.getItem(),!0)}notifyPluginLoaded(){var e=this.deferredItemState;if(e){var t=this.getItemStore().getItem(e.itemID);t&&this.setItem(t,!0)}}getItemStore(){return this.plugin.getActiveItemStore(this.id)}getRootItem(){var e=this.getItemStore();return e?e.getRoot():void 0}getDefaultDisplayItem(e){return this.plugin.getDefaultDisplayItem(e)}searchCompare(e){var t=!1,a=e.getAttachmentByPlugin(this.plugin.id);if(a){let i=a.getField("accountID");this.plugin.hasSyncAccount(i)&&(this.plugin.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0):this.search.isMatched(e,!1)&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0))}return t}runItemSearch(e){try{i.default.PAssert(1610,e,"Must supply a valid param set for local item search")}catch(t){i.default.reportError(t)}try{i.default.PAssert(1611,e.item,"Gmail pane always expects a valid item when running local item search")}catch(t){i.default.reportError(t)}return e.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(e):super.runItemSearch(e)}getItemSearchParams(){var e=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=e&&e.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}}setOverviewAccount(e){this._overviewAccount.set(e),this.updateHeaders(!0)}headerSearchCompare(e){if(this.plugin.isLabelItem(e)){var t=this.plugin.getLabelForVMLI(e);return!t||t.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(e)}getHeaderSearchParams(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?1:NaN,overview:!0,pane:this}}saveSelection(){return S.a.getSelectedItems(this)}restoreSelection(e){if(e.length>0){for(var t=0,a=[],i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let r=this.indexOfItem(e[i]);r>=0&&a.push(r)}if(a.length>1)this.selectedIndex.set(a[0],!1),S.a.setSelected(a,this);else if(1===a.length)this.selectIndex(a[0]);else{let e=this.selectedIndex.get();e>=this.numItems()&&(e=this.numItems()-1),this.selectIndex(e,!0)}}}_setItems(e,t){for(var a,i=0,s=this.saveSelection(),n=[],o={},l=this.getViewMode()===r.a.GmailViewMode.Date?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn,d=0;d<e.length;++d){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var h=e[d],c=this.plugin._getThreadIDFromItem(h);c&&!o[c]&&(n.insertSorted(h,l),this._firstSelectedItemID&&h.id===this._firstSelectedItemID&&(a=h),o[c]=!0)}if(this.updateOutline(n),this.restoreSelection(s),a&&e.length>0){var u=this.indexOfItem(a);u>=0&&(this.selectIndex(u),requestAnimationFrame(()=>{this.setScrollOffset(this.getScrollTop(),r.a.ScrollDuration.Snap)})),this._firstSelectedItemID=void 0}}setHeaders(e,t){var a=0;if(!this._overviewAccount.get()){var s=this.plugin.getDescriptorForItem(this.getItem());this._overviewAccount.set(s.accountID)}this._allHeaders=e;for(var n=[],o={},l={},d=0;d<this._allHeaders.length;++d){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let e=this._allHeaders[d];var h;if(o[h=this.plugin._getAccountIDFromItem(e)]||(o[h]=[]),this.plugin.isAccountItem(e))l[h]=e;else{var c=o[h];this.plugin.isDisplayHeader(e)&&c.insertSorted(e,this.plugin.labelVMLISortFn)}}var u=o[this._overviewAccount.get()];if(u){var p=l[h];try{i.default.PAssert(1612,p,"Must have valid account item")}catch(y){i.default.reportError(y)}if(p){var g=0;for(d=0;d<u.length;++d){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(d>0){var f=this.plugin.getLabelForVMLI(u[d-1]),m=this.plugin.getLabelForVMLI(u[d]);(f.isSystemOrSpecialLabel()&&!m.isSystemOrSpecialLabel()||!f.isCategoryLabel()&&m.isCategoryLabel())&&n.push(new Pt.a({type:r.a.BlockType.HR,id:"hr"+h+d,pane:this,index:d,sizeInPane:this.heightOverviewHR}))}n.push(u[d])}}}this.headersArr=n;let v=n.map((e,t)=>i.default.isVMLI(e)?new Pt.a({type:"blockItem",item:e,id:e.id,pane:this,index:t,levelsDeep:e.levelsDeep.get()-1,sizeInPane:r.a.OverviewItemHeightDesktop}):new Pt.a(Object.assign({pane:this},e)));this.headerPaneObjects.set(v)}heightOverviewHR(){return 4}getTitleList(){var e=this.plugin.getDescriptorForItem(this.getItem()),t=this.plugin.getVMLIForAccount(e.accountID);return t===this.getItem()?[this.getItem()]:[t,this.getItem()]}onClickTitle(e){return this.plugin.isAccountItem(e)?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e)):e===this.getRootItem()?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(e)||(e=this.plugin.getDefaultDisplayItem(this.plugin.getDefaultAccount())),super.onClickTitle(e)}onTopTextChanged(){this.topBoxHeight.set(this.paneTopText.get()?36:0)}searchACName(){}getPaneIcon(){return this.plugin.getPaneIcon()}requestDataPage(e){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(e,this.onDataPagedIn.bind(this))}dropEffectCopyBehavior(e,t){try{i.default.PAssert(1613,!e.belongsToSameItemStore(t),"Dropping onto a Gmail pane is not supported")}catch(a){i.default.reportError(a)}return this.plugin.createOutlinePaneItem(e,t)}_refreshPaneData(e){this.plugin.refreshCurrentView(e)}reportPaneError(){Wr.menus.openModal(r.a.Modals.ReportBug)}_onItemChange(e,t){S.a.reset(this),this._clearCurrentSearch();var a=this.plugin.getLabelForVMLI(e);this._focusedTrash=a&&a.isTrash(),e.hasPaginationToken()||this.plugin.handleItemChange(e,()=>{this.isLoading.set(!1)}),this.numItems()>0&&this.selectIndex(0)}_onViewStateChange(){S.a.reset(this),this.plugin.handleViewModeChange(this.getItem(),this.getViewMode()),this.updateItemsImmediate(!0,void 0,void 0,!0),Wr.PaneManager.updatePaneStateForPane(this),this.setScrollOffset(0)}getItemLabel(e){var t=e?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(t)}onDataPagedIn(e){e?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)}onScroll(){if(!this.isLoadingNewPage.get()&&!this.isSearched()){var e=this._infiniteList.getMaxScrollOffset();this.getScrollOffset()>=e&&this.requestDataPage(this.getItem())}}handleStatusClick(){}_getLoadingMessage(){var e=this.plugin._getAccountIDFromItem(this.getItem());return re.a.isAuthorizedForScopes(e,[r.a.GScope.GmailModify])?"Loading...":"Authorizing..."}bottomListMessage(){var e;return this.getItem().hasPaginationToken()&&(e=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),{text:e,clickable:!0}}_onRemoteDataLoaded(){}sizeOfItem(e,t,a){if("blockHeader"===e.type)return 40;if(a)return super.sizeOfItem(e,t,a);var i=this.objectAtIndex(t);return a?Wr.DisplaySettings.lineItemHeight(i,e,this,1):r.a.EmailItemHeight}onClickItem(e,t,a,r){i.default.activeInput.get()&&i.default.activeInput.get().blur();var s=!0;if(r.shiftKey){var n=S.a.getFirstSelectedIndex(this),o=S.a.getLastSelectedIndex(this);e<n?n=e:e>o&&(o=e),S.a.selectInOrder(n,o,this),s=!1}else if(i.default.hasClass(r.target,"emailLabel")){var l=r.target.textContent,d=t.getAttachmentByPlugin(this.plugin.id).getField("accountID"),h=this.plugin._getLabelByName(d,l);try{i.default.PAssert(1614,h,"Must be able to get a valid label if clicking a valid label: ",l)}catch(u){i.default.reportError(u)}if(h){var c=this.plugin.getVMLIForLabel(d,h);this.zoomIn(c),s=!1}}else i.default.hasClass(r.target,"itemCheckbox")||this.selectIndex(e);s&&t.onClick(e,a,r)}onRightClickItem(e,t,a){(S.a.numSelectedInPane(this)<=1||!S.a.isSelected(e,this))&&this.selectIndex(e),super.onRightClickItem(e,t,a),a.preventDefault(),a.stopPropagation()}handleLeftSideTap(e,t){var a=e.item;this.toggleStar(a)}handleRightSideTap(e,t){if(e&&e.hasPluginAttachment(this.plugin.id)){this.archiveEmailFromCurrentLabel(e);var a=this.selectedIndex.get();a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0),i.default.vmMain.redoLastMouseMove()}}onMultiselectReset(e){this===e&&this.selectedIndex.set(-1)}selectIndex(e,t,a){var i=this.selectedIndex.get();this.selectedIndex.set(e,t),e>=0?S.a.setSelected([e],this):S.a.reset(this),(t||i!==e)&&this.selectedIndex.notify(),a||Wr.PaneManager.updatePaneStateForPane(this)}selectItem(e,t){if(e){var a=this.indexOfItem(e);a>=0&&this.selectIndex(a,t)}else this.selectIndex(-1,t)}onSelectedIndexChanged(e){if(Wr.EmailPreview.isOpenOnPane(this))if(e>=0){var t=this.itemAtIndex(e);this.openEmailByItem(t)}else e<0&&Wr.EmailPreview.reset()}_runRemoteSearch(){if(Wr.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var e=this.search.getRemoteValue(),t=this.plugin.getDescriptorForItem(this.item.get());if(t.labelID){var a=this.plugin._getLabelByID(t.accountID,t.labelID);a.isSpecialLabel()||a.isInbox()||!a.hasName()||(e+=" label:"+a.getName())}this._lastSearchValue=e,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var s="R~"+this.getActualPaneItem().id+"~"+i.default.generateTempId();i.default.log("Gmail Remote Search ItemID: ",s),this._currentSearch=this.plugin.runSearch(e,this.id,s,!0,e=>{if(!this._destroyed&&this._isSearchingRemote.get())switch(this.paneEmptySearchMessage=e===r.a.SearchResultStatus.Done?this.paneEmptySearchMessageDefault:"",this.isLoading.set(!1),e){case r.a.SearchResultStatus.Done:this.paneTopText.set(""),this.setScrollOffset(0);break;case r.a.SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case r.a.SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case r.a.SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{i.default.PAssert(1615,!1,"Invalid search state: ",e)}catch(t){i.default.reportError(t)}}})}}_clearCurrentSearch(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)}onSearchChanged(e){var t=this.search.getRemoteValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")}isSearchingRemote(){return this._isSearchingRemote.get()}isRemoteSearchActive(){return this.plugin.isRemoteSearchBucketActive(this.id)}onEmailComposeClosed(){var e=this.plugin,t=e.getDefaultAccount(),a=e._getLabelByID(t,oa.DRAFT),i=e.getVMLIForLabel(t,a);this.item.get()===i&&this.selectIndex(-1)}onEmailPreviewClosed(){0}applyToSelection(e){var t=this.saveSelection();S.a.applyFnToSelected(e,this),this.restoreSelection(t)}_autocompletePopup(e,t,a){if(!e.elementDisplay){var i=S.a.getFirstSelectedIndex(this),r=this.elementAtIndex(i);e.elementDisplay=r}var s=[];S.a.applyFnToSelected(e=>{s.push(e)},this),e.items=s,e.onSelected=i=>{this.plugin.beginAction(),e.item?t(e.item,i):S.a.applyFnToSelected(e=>{t(e,i)},this),a&&a(),this.plugin.endAction()},I.a.showPopup(e)}getPaddingForPaneObject(e,t){return t?super.getPaddingForPaneObject(e,t):24}getWidth(){return this.rect.get().width}getFirstSelectedItem(){return S.a.getFirstSelectedItem(this)}getFirstSelectedIndex(){return S.a.getFirstSelectedIndex(this)}autocompleteSchedule(e,t){var a=this.selectedIndex.get();super.autocompleteSchedule(e,()=>{a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0),t&&t()})}autocompleteSnooze(e,t,a){var i=this.selectedIndex.get();super.autocompleteSnooze(e,t,()=>{i>=this.numItems()&&(i=this.numItems()-1),this.selectIndex(i,!0),a&&a()})}autocompleteMove(e,t){e=e||{};var a=this.selectedIndex.get();e.positionOffset={left:40},super.autocompleteMove(e,()=>{a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0),t&&t()})}autocompleteCreateTask(){var e=this,t=this.selectedIndex.get();if(!isNaN(t)){var a=this.elementAtIndex(t),i=S.a.getSelectedItems(this);Wr.menus.openItemEditor({element:a,pane:this,selectIndex:0,addOnSave:!0,side:"bottom",children:i,positionOffset:{left:10},options:[{text:"Archive email",vlue:Wr.pluginManager.getSetting(r.a.PluginID.Gmail,r.a.PluginSettingsID.Gmail.ArchiveOnOrganize),cb(){for(var t=0,a=0;a<i.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i[a].getAttachmentByPlugin(e.plugin.id);e.plugin.performAction(r.a.PluginAction.Gmail.Archive,!1,s)}}}],beginSave:()=>{var t=0;Wr.PaneUpdateBatcher.beginUpdateItems(),e.plugin.beginAction();for(var a=0;a<i.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i[a].getAttachmentByPlugin(e.plugin.id);e.plugin.attachmentHasLabel(s,"Moo.do/Handled")||e.plugin.performAction(r.a.PluginAction.Gmail.AddLabel,!1,s,"Moo.do/Handled")}},endSave:t=>{e.plugin.endAction(),Wr.PaneUpdateBatcher.commitUpdateItems()}})}}toggleStarSelected(){super.toggleStarSelected(),this.updateItems()}toggleStar(e){var t=e.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(1617,t,"Must be able to get a valid attachment")}catch(s){i.default.reportError(s)}var a=t.getPlugin();a.isItemStarred(e)?a.performAction(r.a.PluginAction.Gmail.Unstar,!1,t):a.performAction(r.a.PluginAction.Gmail.Star,!1,t),this.updateItems()}_openSelectedInMode(e){var t=S.a.getFirstSelectedIndex(this);this.selectIndex(t);var a=this.itemAtIndex(t);this.openEmailByItem(a,e)}replySelected(){this._openSelectedInMode(r.a.EmailResponseMode.Reply)}replyAllSelected(){this._openSelectedInMode(r.a.EmailResponseMode.ReplyAll)}forwardSelected(){this._openSelectedInMode(r.a.EmailResponseMode.Forward)}archiveSelected(e){this.plugin.beginAction(),this.applyToSelection(this.archiveEmailFromCurrentLabel),this.plugin.endAction()}archiveItem(e,t){var a=t.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(1618,a,"Must be able to get a valid attachment")}catch(s){i.default.reportError(s)}!e&&this.plugin.isItemArchived(t)?this.plugin.performAction(r.a.PluginAction.Gmail.Unarchive,!1,a):e&&!this.plugin.isItemArchived(t)&&this.plugin.performAction(r.a.PluginAction.Gmail.Archive,!1,a)}deleteSelected(e,t){this.plugin.beginAction(),this.applyToSelection(this.deleteEmailFromCurrentLabel),this.plugin.endAction()}applyPriorityToSelection(e,t){var a=e,s=!0;this.plugin.beginAction(),this.applyToSelection(n=>{var o=n.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(1619,o,"Must be able to get a valid attachment")}catch(l){i.default.reportError(l)}t&&s&&(this.plugin.getAttachmentPriority(o)===e&&(a=r.a.VMLIFlag.None),s=!1),this.plugin.performAction(r.a.PluginAction.Gmail.SetPriority,!1,o,a),this.updateItems()}),this.plugin.endAction()}handleUndo(){this.plugin.handleUndo()}handleRedo(){this.plugin.handleRedo()}keyMoveDown(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(S.a.isInverted(this)&&1===S.a.numSelectedInPane(this)&&S.a.setInverted(!1,this),S.a.isInverted(this)?(t=S.a.getFirstSelectedIndex(this),S.a.removeSelected(t,this)):(t=this.indexOfNextVMLI(S.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(S.a.addSelected(t,this),this.scrollIndexIntoView(t,r.a.ScrollDuration.Default))):(t=this.indexOfNextVMLI(S.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(this.selectIndex(t),this.scrollIndexIntoView(t,r.a.ScrollDuration.Default))}keyMoveUp(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(S.a.isInverted(this)||1!==S.a.numSelectedInPane(this)||S.a.setInverted(!0,this),S.a.isInverted(this)?(t=this.indexOfPrevVMLI(S.a.getFirstSelectedIndex(this)))>=0&&(S.a.addSelected(t,this),this.scrollIndexIntoView(t,r.a.ScrollDuration.Default)):(t=S.a.getLastSelectedIndex(this),S.a.removeSelected(t,this))):(t=this.indexOfPrevVMLI(S.a.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(t),this.scrollIndexIntoView(t,r.a.ScrollDuration.Default))}onHotkey(e,t,a){if(this.selectedIndex.get()>=0&&!Wr.menus.isContextMenuOpen()&&"Email"===e){var s=this.itemAtIndex(this.selectedIndex.get()),n=!0;if(s){if("Up"===t)this.keyMoveUp(a);else if("Down"===t)this.keyMoveDown(a);else if("Open"===t)Wr.EmailPreview.isOpenOnPane(this)||this.openEmailByItem(s);else if("Archive"===t){a.shiftKey&&Wr.EmailPreview.isOpenOnPane(this)&&Wr.EmailPreview.close();var o=!this.getItemLabel(!0).isArchived();this.archiveSelected(o)}else if("Delete"===t)this.deleteSelected(this.plugin.isGmailItem,!0);else if("Schedule"===t)this.autocompleteSchedule();else if("Snooze"===t)this.autocompleteSnooze();else if("Move"===t)this.autocompleteMove();else if("Task"===t)this.autocompleteCreateTask();else if("Label"===t)this.autocompleteLabel({item:s});else if("MarkRead"===t)this.markReadSelected(!0);else if("MarkUnread"===t)this.markReadSelected(!1);else if("Star"===t)this.toggleStarSelected();else if("Reply"===t)this.replySelected();else if("ReplyAll"===t)this.replyAllSelected();else if("Forward"===t)this.forwardSelected();else if("Priority1"===t)this.applyPriorityToSelection(r.a.VMLIFlag.P0,!0);else if("Priority2"===t)this.applyPriorityToSelection(r.a.VMLIFlag.P1,!0);else if("Priority3"===t)this.applyPriorityToSelection(r.a.VMLIFlag.P2,!0);else if("RemoveFromLabel"===t)this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel),this.plugin.endAction());else if("Undo"===t)this.handleUndo();else if("Print"===t){if(1===S.a.numSelectedInPane(this)){let e=S.a.getFirstSelectedItem(this);var l=this.plugin.createPrintURLForThread(e.getAttachmentByPlugin(this.plugin.id));i.default.printPage(l)}}else if("OpenInGmail"===t){if(1===S.a.numSelectedInPane(this)){let e=S.a.getFirstSelectedItem(this);var d=this.plugin.createURLForThread(e.getAttachmentByPlugin(this.plugin.id));i.default.openUrl(d)}}else n=!1;n&&i.default.preventDefault(a)}}}archiveEmailFromCurrentLabel(e){var t=this.getItemLabel(!0),a=!t.isArchived();this.archiveItem(a,e),t.isInbox()||t.isArchived()||this.plugin.removeItemFromLabel(t,e)}deleteEmailFromCurrentLabel(e){var t=this.getItemLabel(!0);this.plugin.deleteItem(e,t)}removeItemFromCurrentLabel(e){var t=this.getItemLabel(!0);this.plugin.removeItemFromLabel(t,e)}canAcceptDragOver(e,t,a,r){if(e&&this.type===e.type&&(r||e&&this!==e)){var s,n=e.getItemLabel();if(r){var o=i.default.getElementParent(a);s=o&&i.default.getItemForElement(o)}else s=this.getItem();if(s&&this.plugin.isLabelItem(s)&&this.plugin.areItemsFromSameAccount(t,s)){var l=this.plugin.getLabelForVMLI(s);if(l!==n&&l.isDropTarget())return!0}}return!1}_handleDragOverPane(e,t,a,i,r,s,n){return{targetElement:a,targetItem:this.getItem()}}_handleDragDrop(e,t,a,s,n){let o=!1;if(a){var l,d=t.pane,h=d.getItemLabel(),c=a.targetItem,u=this.plugin.getLabelForVMLI(c);if(e.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(e,c)){l=e.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(1620,l,"Must be able to get a valid attachment")}catch(p){i.default.reportError(p)}this.plugin.beginAction(),this.plugin.performAction(r.a.PluginAction.Gmail.RemoveLabel,!1,l,h.getName()),this.plugin.attachmentHasLabel(l,u.getName())||this.plugin.performAction(r.a.PluginAction.Gmail.AddLabel,!1,l,u.getName()),d.notifyDropFrom(e,this),this.plugin.endAction(),o=!0}}return o}notifyDropFrom(e,t){if(this.selectIndex(-1),t.type===r.a.PaneMode.Task){var a=e.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(1621,a,"Must be able to get a valid attachment")}catch(n){i.default.reportError(n)}this.plugin.attachmentHasLabel(a,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(r.a.PluginAction.Gmail.RemoveLabel,!1,a,"Inbox"),this.plugin.performAction(r.a.PluginAction.Gmail.AddLabel,!1,a,"Moo.do/Handled"),this.plugin.endAction());var s=this.plugin.getAttachmentPriority(a);s!==r.a.VMLIFlag.None&&e.setPriority(s,r.a.ChangeType.Local),this.plugin.attachmentHasLabelByID(a,"STARRED")&&e.setStarred(!0,r.a.ChangeType.Local)}}maxWidthOfPaneObject(){return this.getWidth()-56}allowZoom(e){var t=!1;return this.plugin.isLabelItem(e)&&(t=!0),t}performOverviewAction(e){if(this.plugin.isAccountItem(e)){e.setCollapsed(!e.isCollapsed(this,!0),this,!0);var t=e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e));this.zoomIn(t),i.default.sendEvent("Menu","OverviewZoom_Gmail")}}setItem(e,t){return this.selectIndex(-1,void 0,!0),super.setItem(e,t)}isItemHeader(e,t){if(!t)return e.isHeader();for(var a=0,i=this.plugin,r=e.getItems(),s=0;s<r.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i.isLabelItem(r[s])||i.isAccountItem(r[s]))return!0}}getActualPaneItem(){return this.plugin._defaultZoomItems[this.id]||this.item.get()}canResetMultiselect(){return!Wr.EmailPreview.isOpenOnPane(this)||0===this.numItems()}setExpanded(e,t){super.setExpanded(e,t),e||this===i.default.focusedPane||S.a.reset(this)}applyDropOnBlock(e,t,a,s){var n=e,o=t.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(1622,o,"Must be able to get a valid attachment")}catch(c){i.default.reportError(c)}if(n.isDate){var l,d=n.dateTime||n.date;l=i.default.isString(d)?Wr.International.parseDate(d,r.a.DateFormat.MDY):d;try{i.default.PAssert(1623,i.default.isDateValid(l),"Must provide a valid date when scheduling an email",n.dateTime,n.date)}catch(c){i.default.reportError(c)}i.default.isDateValid(l)&&this.plugin.scheduleEmail(t,l)}else{var h;n.isStarred?this.plugin.performAction(r.a.PluginAction.Gmail.Star,!1,o):n.isImportant&&(h=r.a.VMLIFlag.P0),h&&this.plugin.performAction(r.a.PluginAction.Gmail.SetPriority,!1,o,h)}}getSaveInfo(){var e=super.getSaveInfo();e.viewState=this.viewState.get();var t=S.a.getFirstSelectedItem(this);return e.selectedItem=t?t.id:void 0,e}setIgnoreRestoreScroll(){}getSwipeMenuItemsNew(e){let{item:t}=e;return{left:[{icon:"check",text:"Archive",backgroundColor:"#0c0",onActivated:()=>{this.archiveEmailFromCurrentLabel(t)}}],right:[{icon:"format-align-left",backgroundColor:"#09d",onActivated:()=>{Wr.menus.openItemAutocomplete(e=>{this.plugin.moveEmailToItem(t,e.extraInfo)})}},{icon:"delete",backgroundColor:"#a30",onActivated:()=>{this.deleteEmailFromCurrentLabel(t)}}]}}titleOfFirstItem(){return this.getItem().getParsedText()}onTapAddItem(e){Wr.menus.openComposeEmail(Wr.pluginManager.getPluginGmail())}isOverviewVisibleInPane(){return!0}getMinItemSize(){return r.a.EmailItemHeight}widthOfDrag(e){return this.getWidth()}getStyledLinesForPaneObject(e,t){if(t)return super.getStyledLinesForPaneObject(e,t);var a=e.item;return a.els||i.default.runSingleParse(a,r.a.ChangeType.Auto),D.a.generateStyledLines(a.els,this._lines,this,e.item)}viewModeIcon(){return"Date"===this.getViewMode()?"icon-access_time":"icon-exclamation"}viewModeColor(){return"#2a6"}openViewMenu(e){Wr.menus.openContextMenu({componentName:"ReactContextMenuGmailSort",element:e.target,pane:this,onSelected:this.changeView})}changeView(e){this.viewMode.set(e),this.updateItems(!1,!0)}getViewMode(){return this.viewState.get().viewMode}setViewMode(e){var t=this.viewState.get();t.viewMode!==e&&(t.viewMode=e,this.viewState.set(t,!this.isFakePane))}becomeReal(){this.getItem()&&this.setItem(this.getItem(),!0)}setDocument(){}getItemHeight(){return r.a.EmailItemHeight}},p()(_t.prototype,"archiveEmailFromCurrentLabel",[f.a],Object.getOwnPropertyDescriptor(_t.prototype,"archiveEmailFromCurrentLabel"),_t.prototype),p()(_t.prototype,"deleteEmailFromCurrentLabel",[f.a],Object.getOwnPropertyDescriptor(_t.prototype,"deleteEmailFromCurrentLabel"),_t.prototype),p()(_t.prototype,"removeItemFromCurrentLabel",[f.a],Object.getOwnPropertyDescriptor(_t.prototype,"removeItemFromCurrentLabel"),_t.prototype),_t),bt=5e3;var Dt,wt=class{constructor(e,t,a){try{i.default.PAssert(1560,i.default.isFunction(e),"Must provide a valid entry callback")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1561,i.default.isFunction(t),"Must provide a valid done callback")}catch(r){i.default.reportError(r)}this._entryCB=e,this._doneCB=t,this._delay=a||bt,this._flushTimeout=void 0,this._entries=[],v.a.binder(this,"_onEntry","_onDone","_flushEntries","_flushEntriesWatchdog")}getEntryCB(){return this._onEntry}getDoneCB(){return this._onDone}_onEntry(e){e&&this._entries.push(e),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))}_onDone(e,t){Wr.PaneUpdateBatcher.beginUpdateItems(),this._flushEntries();try{this._doneCB(e,t)}catch(a){i.default.reportError(a)}Wr.PaneUpdateBatcher.commitUpdateItems()}_flushEntriesWatchdog(){}_flushEntries(){var e=0;this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),Wr.PaneUpdateBatcher.beginUpdateItems(),ie.a.beginBatch();for(var t=0;t<this._entries.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{this._entryCB(this._entries[t])}catch(a){i.default.reportError(a)}}this._entries=[],ie.a.commitBatch(),Wr.PaneUpdateBatcher.commitUpdateItems()}},Et=a(148),Ct="EnsureLabelVMLI",At="CreateLabelVMLI",Mt="MergeThread",Tt="SyncdMessage",Lt="ErrorSyncdMessage",xt="UnsyncdMessage",kt="OldUnsyncdMessage",Rt="MessagesSyncd",Ot="MessageDataCached",Ft="snoozemail",Nt="sendmail",Bt=1,Ut=2,Ht=3,Vt=4,jt=5,zt=6,qt=7,Wt=8,Gt=9,Kt=10,Yt=11,Xt=12,Qt=13,$t=14,Jt=15,Zt=16,ea=17,ta=18,aa=19,ia=20,ra="historyIDs",sa="labels",na="sendAs";let oa;!function(e){e.INBOX="INBOX",e.SPAM="SPAM",e.TRASH="TRASH",e.UNREAD="UNREAD",e.STARRED="STARRED",e.IMPORTANT="IMPORTANT",e.SENT="SENT",e.DRAFT="DRAFT",e.CHAT="CHAT",e.CATEGORY_PERSONAL="CATEGORY_PERSONAL",e.CATEGORY_SOCIAL="CATEGORY_SOCIAL",e.CATEGORY_PROMOTIONS="CATEGORY_PROMOTIONS",e.CATEGORY_UPDATES="CATEGORY_UPDATES",e.CATEGORY_FORUMS="CATEGORY_FORUMS"}(oa||(oa={}));var la,da={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},ha="==MOODO_ARCHIVED==",ca="==MOODO_ALLMAIL==",ua={PRI0:"Moo.do/Priority High",PRI1:"Moo.do/Priority Medium",PRI2:"Moo.do/Priority Low"},pa=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError","modifiedOffline"],ga="multipart/signed",fa="multipart/related",ma="message/partial",va="multipart/mixed",ya="multipart/report",_a="multipart/parallel",Sa="multipart/alternative",Pa="multipart/digest",Ia="multipart/encrypted",ba="multipart/voice-message",Da="text/calendar",wa="text/plain",Ea="text/html",Ca="text/watch-html",Aa="text/x-watch-html";!function(e){e.Unknown="unknown",e.Inline="inline",e.FormData="form-data",e.Attachment="attachment"}(la||(la={}));var Ma=["application","audio","example","image","message","model","video","text"],Ta=[Sa,va,wa,Ea,ya],La=[wa,Ea],xa=[Da,ba,Ia,va],ka=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],Ra=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,Oa=/\'(.*)\'/g;var Fa=(Dt=class extends Se{constructor(){super(r.a.PluginID.Gmail,"g","Email",!1,{s:!0}),this._lastSyncTime=void 0,this._requiresOfflineAuth=!0,this.supportSyncAccounts=!0,v.a.binder(this,"threadSortFn","threadSortPriorityFn","labelSortFn","labelVMLISortFn","sortFn","_fromComparator","_toComparator","_dateComparator","_messagesComparator","_shallowObjComparator","isGmailItem","_flushPendingDraftUpdates","driveMessageContentSync","_cleanupLocalCaches","_handleDeferredSnoozeTask","_cancelDeferredSnoozeTask","_persistRemoteSnoozeTask","_handleDeferredSendMailTask","_cancelDeferredSendMailTask","_persistRemoteSendMailTask"),this._emailCache={},this._labelsByID={},this._labelsByName={},this._priorityLabels={},this._creatingDrafts={},this._pendingDraftUpdates={},this._pendingThreadLoads={},this._loadThreadMutex=0,this._activeDraftUpdates=0,this._accountSettings={},this._pendingSends={},this._draftCache={},this._unsyncdMessages={},this._pendingSyncdMessages={},this._numUnsyncdMessages=0,this._numSyncdMessages=0,this._outstandingContentSync=!1,this._undoStack=new dt(10),this._generateUndoRedo(),this._syncingOfflineChanges=!1,this._draftFlushTimer=void 0,this.registerSetting("WriteAccess","writeAccess","w",!0),this.registerSetting("SyncTime","syncTime","t",!0,r.a.MaxGmailSyncTime.Free),this.registerSetting("ArchiveOnSchedule","archiveOnSchedule","a",!0,!1),this.registerSetting("ArchiveOnOrganize","archiveOnOrganize","o",!0,!1),this.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies","i",!0,!1),this.addTrackedStat(Ct),this.addTrackedStat(At),this.addTrackedStat(Mt),this.addTrackedStat(Tt),this.addTrackedStat(Lt),this.addTrackedStat(xt),this.addTrackedStat(kt),this.addTrackedStat(Rt),this.addTrackedStat(Ot),this._threadCache=this.registerLocalCache(this.id,r.a.StorageType.IndexedDB,{noInMemoryCache:!0,metadataKeys:[ra,sa,na],keyFieldsRN:["date","accountID","modifiedOffline"]}),this._rawCache=this.registerLocalCache(this.id+"Messages",r.a.StorageType.IndexedDB,{noInMemoryCache:!0,keyFieldsRN:["internalDate"]}),this.registerDeferredTaskType(Ft,this._handleDeferredSnoozeTask,this._cancelDeferredSnoozeTask,this._persistRemoteSnoozeTask),this.registerDeferredTaskType(Nt,this._handleDeferredSendMailTask,this._cancelDeferredSendMailTask,this._persistRemoteSendMailTask),this._contentSyncTask=this.registerLowImpactTask("ContentSync",this.driveMessageContentSync),this._cacheCleanup=this.registerLowImpactTask("CacheCleanup",this._cleanupLocalCaches),this._lastCacheCleanup=0,i.default.isDemoMode()?this.declareProperty("accountID",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!0,"me"):this.declareProperty("accountID",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline),this.declareProperty("from",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!1,void 0,this._fromComparator),this.declareProperty("to",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!1,void 0,this._toComparator),this.declareProperty("subject",r.a.PluginLoad.Preview|r.a.PluginLoad.Full),this.declareProperty("date",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,new Date(0),this._dateComparator),this.declareProperty("lastModifiedDate",r.a.PluginLoad.Full,!0,void 0,this._dateComparator),this.declareProperty("modifiedOffline",r.a.PluginLoad.Full,!0,!1),this.declareProperty("pendingSend",r.a.PluginLoad.Full,!0,!1),this.declareProperty("messages",r.a.PluginLoad.Full,!0,[],this._messagesComparator),this.declareProperty("snippet",r.a.PluginLoad.Full),this.declareProperty("participants",r.a.PluginLoad.Runtime,!0,[]),this.declareProperty("subjectLower",r.a.PluginLoad.Runtime),this.declareProperty("count",r.a.PluginLoad.Runtime),this.declareProperty("dataLoaded",r.a.PluginLoad.Runtime,!0,!1),this.declareProperty("isDeleted",r.a.PluginLoad.Runtime,!0,!1),this.declareProperty("labelIds",r.a.PluginLoad.Runtime,!0,[]),this.declareProperty("hasAttachments",r.a.PluginLoad.Full,!0,!1),this.useRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.EmailThread),this.useRenderer(r.a.PluginRenderTypes.UnstyledText,r.a.PluginRenderers.EmailThread),this.useRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.EmailThread),Wr.settings.syncAccounts.listen(this.onSyncAccountsChanged)}getType(){return r.a.PluginType.Email}_attachMetadataFields(){return ka}getDataPane(){try{i.default.PAssert(1283,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){i.default.reportError(e)}return It}getPaneIcon(){return"icon-mail_outline"}getPanePriority(){return 97}useItemStore(){return"Gmail"}itemStoreOptions(){return{requireStoredEls:!1,enabledFilters:r.a.ItemStoreFilter.Priority,parserFn:D.a.runParseSinglePlugin}}allowRemoteRequests(){return!0}ensureAccountEmail(e){return"me"===e?this.getDefaultAccount():e}getDefaultAccount(){var e,t=Wr.settings.getUserIdentifier();if(t){try{i.default.PAssert(1284,i.default.isDemoMode()||"me"!==t,'Should never return "me" as a valid user')}catch(a){i.default.reportError(a)}this.hasSyncAccount(t)&&(e=t)}else{try{i.default.PAssert(1285,!1,'Unable to get default account name, returning "me"')}catch(a){i.default.reportError(a)}e="me"}return e||(e=t),e}isSameAccount(e,t){return"me"===e&&(e=this.getDefaultAccount()),"me"===t&&(t=this.getDefaultAccount()),e===t}areItemsFromSameAccount(e,t){var a=this._getAccountIDFromItem(e),i=this._getAccountIDFromItem(t);return this.isSameAccount(a,i)}_handleAccountChanges(){var e=0,t=[];Wr.PaneManager.runForEachPane(e=>{var a=this._getAccountIDFromItem(e.getItem());try{i.default.PAssert(1286,a,"Missing Account ID: ",e.id,e.getItem().id)}catch(r){i.default.reportError(r)}this.hasSyncAccount(a)||t.push(e)},this.getPaneType());for(var a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;Wr.PaneManager.removePane(t[a])}0===t.length&&Wr.PaneManager.notifyPanes()}onSyncAccountsChanged(e,t){Wr.PaneUpdateBatcher.beginUpdateItems(),t&&Object.keys(t).forEach(a=>{if(t[a][this.id]&&(!e[a]||!e[a][this.id])){if(this._clearCachedData(a),this.getDefaultItemStore()){var i=this.getVMLIForAccount(a);i&&(i.deleteSelf(r.a.ChangeType.Local),i.getItemStore().destroyItem(i.id))}this._handleAccountChanges()}}),Object.keys(e).forEach(a=>{!e[a][this.id]||t[a]&&t[a][this.id]||(this.isActive()&&(this._ensureLabel(a,oa.INBOX,"Inbox",void 0,void 0,r.a.ChangeType.Local),this._ensureLabel(a,oa.UNREAD,"Unread",void 0,void 0,r.a.ChangeType.Local),this._ensureLabel(a,ha,"Archived",void 0,void 0,r.a.ChangeType.Local),this._ensureLabel(a,ca,"All Mail",void 0,void 0,r.a.ChangeType.Local),this._forceLabelSync(()=>{this._forceThreadSync()})),this._handleAccountChanges())}),Wr.PaneUpdateBatcher.commitUpdateItems()}_iterateSendAs(e){for(var t=0,a=this.getSyncAccounts(),i=!1,r=0;!i&&r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=this.getAccountSetting(a[r],"sendAs");if(s)for(var n=0,o=0;o<s.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=s[o];if(e(a[r],l)){i=!0;break}}else e(a[r])}}getSignature(e){var t;return this._iterateSendAs((a,i)=>{if(i&&i.sendAsEmail===e)return t=i.signature,!0}),t}getReplyToAddress(e){var t;return this._iterateSendAs((a,i)=>{if(i&&i.sendAsEmail===e&&i.replyToAddress)return t=i.replyToAddress,!0}),t}_computeDisplayName(e,t){var a;return!t.displayName&&t.isPrimary||(a=t.displayName),a}getDisplayName(e){var t;return this._iterateSendAs((a,i)=>{if(i&&i.sendAsEmail===e)return t=this._computeDisplayName(a,i),!0}),t}getDefaultSendingAccount(e){var t;return this._iterateSendAs((a,i)=>{if(a===e&&i&&i.isDefault)return t=i.sendAsEmail,!0}),t||(t=e),t}getDefaultFromInfo(e){var t=this.getDefaultSendingAccount(e);try{i.default.PAssert(1287,t,"Must have found a valid account to send from")}catch(a){i.default.reportError(a)}return{text:this.getDisplayName(t),email:t}}getSendingAccounts(e){var t=[];return this._iterateSendAs((a,i)=>{e&&e!==a||(i?"pending"!==i.verificationStatus&&t.push(i.sendAsEmail):t.push(a))}),t}getSyncAccount(e){var t;return this._iterateSendAs((a,i)=>{if(i){if(i.sendAsEmail===e)return t=a,!0}else if(e===a)return t=a,!0}),t}getSendingAccountInfo(e){var t;return this._iterateSendAs((a,i)=>{if(i){if(i.sendAsEmail===e)return t={text:this._computeDisplayName(a,i),email:e},!0}else if(e===a)return!0}),t}_getSettingsSendAs(e){for(var t=0,a=this.getSyncAccounts(),i=a.length,r=0,s={},n=(t,a,n)=>{t&&(s[a]=n.sendAs),++r===i&&e(s)},o=0;o<a.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let e=a[o];re.a.getAccountAuthToken(e,this.googleScopes(),t=>{t&&this._requestSettings(e,n)})}}_requestSettings(e,t){var a=pe.a.fns("gmail").users.settings.sendAs.list.packedFn,i={userId:e};this._queueRemoteRequestMulti(e,a,i,a=>{t(!0,e,a)},a=>{t(!1,e,a),this._notifyFailedRequest(e,a)},void 0,ia)}_fromComparator(e,t){var a=!1;if(e||t){if(e&&t){try{i.default.PAssert(1288,!i.default.isString(e),"Old from must not be a string")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1289,!i.default.isString(t),"New from must not be a string")}catch(r){i.default.reportError(r)}e.text===t.text&&e.email===t.email&&(a=!0)}}else a=!0;return a}_toComparator(e,t){var a=!1;if(e||t){if(e&&t){try{i.default.PAssert(1290,i.default.isArray(e),"Old to must be an array")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1291,i.default.isArray(t),"New to must be an array")}catch(r){i.default.reportError(r)}a=t.equals(e)}}else a=!0;return a}_dateComparator(e,t){var a=!1;if(e||t){if(e&&t){i.default.isString(e)&&(e=this.parseDateHeader(e)),i.default.isString(t)&&(t=this.parseDateHeader(t));try{i.default.PAssert(1292,i.default.isDateValid(e),"Must be an old valid date to compare")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1293,i.default.isDateValid(t),"Must be a new valid date to compare")}catch(r){i.default.reportError(r)}i.default.isDateValid(e)&&i.default.isDateValid(t)&&(a=e.equals(t))}}else a=!0;return a}_messagesComparator(e,t){var a=!0;if(e&&t)if(e.length===t.length)for(var i=0,r=0;a&&r<t.length;++r){var s=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var n=e[r],o=t[r],l=0;l<pa.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=pa[l],h=!0;switch(d){case"from":h=this._fromComparator(n[d],o[d]);break;case"to":h=this._toComparator(n[d],o[d]);break;case"resources":case"listUnsubscribe":h=this._shallowObjComparator(n[d],o[d]);break;case"labelIds":h=o[d].equals(n[d]);break;case"date":case"internalDate":h=this._dateComparator(n[d],o[d]);break;default:h=n[d]===o[d]}h||(a=!1)}}else a=!1;else a=!1;return a}_shallowObjComparator(e,t){var a=!1;if(e||t){if(e&&t)if(e===t)a=!0;else for(var i in a=!0,e)if(!t.hasOwnProperty(i)){a=!1;break}}else a=!0;return a}onPaneActivated(e){0}_offlineLoad(){return ke.a.onActiveUser(()=>{if(!i.default.isDemoMode()){let e=this._threadCache.getMetadata(na);e&&Object.keys(e).forEach(t=>this.setAccountSetting(t,"sendAs",e[t]))}let e=this._threadCache.getMetadata(sa);i.default.batchRenderUpdates(()=>{var t=0,a=this.getSyncAccounts();!i.default.isDemoMode()&&e||(e={}),e.me&&!e[this.getDefaultAccount()]&&(e[this.getDefaultAccount()]=e.me),Wr.PaneUpdateBatcher.beginUpdateItems();for(let u=0;u<a.length;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[u];this._ensureLabel(s,oa.INBOX,"Inbox",void 0,void 0,r.a.ChangeType.Local),this._ensureLabel(s,oa.UNREAD,"Unread",void 0,void 0,r.a.ChangeType.Local),this._ensureLabel(s,ha,"Archived",void 0,void 0,r.a.ChangeType.Local),this._ensureLabel(s,ca,"All Mail",void 0,void 0,r.a.ChangeType.Local);var n=e[s];if(n){for(let e in n)if(n.hasOwnProperty(e)){var o=n[e];if(!oa[o.id]){let t=o.name||"LocalLabel"+Date.now();i.default.isString(o.oldestSync)&&(o.oldestSync=new Date(o.oldestSync)),this._ensureLabel(s,e,t,o.oldestSync,o,r.a.ChangeType.Local)}}for(let e in oa)if(oa.hasOwnProperty(e)){let t=da[e];this._ensureLabel(s,e,t,void 0,void 0,r.a.ChangeType.Local)}}this._ensureLabelVMLIsForAccount(s)}var l=this._getMetadataSyncTime(),d=this._getUnreadSyncTime();let h=this._threadCache.getPreloadData();if(h){try{i.default.PAssert(1295,i.default.isObject(h),"Thread preload is not object")}catch(c){i.default.reportError(c)}(e=>{if(e){this._isLoadingLocal=!0;let t=[];Object.keys(e).forEach(r=>{let s=e[r];try{i.default.PAssert(1294,s,"Must always contain a valid entry when retreiving data from preload")}catch(c){i.default.reportError(c)}if(s&&(e=>a.indexOf(e.accountID)>=0&&e.date.isAfter(d))(s)){var n=this.createEntryFromLocal(s.id,s);(this.isPriorityData(n)||s.date.isAfter(l))&&(this.cacheData(n.id,n)&&t.push(n),this._updateSpecialLabels(n))}}),this._isLoadingLocal=!1,i.default.scheduleIdleTask(()=>{var e=0;ie.a.beginBatch();for(var a=0;a<t.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._checkUnsyncdMessageContent(t[a])}ie.a.commitBatch()})}})(h)}Wr.PaneUpdateBatcher.commitUpdateItems(),this.notifyPanesReadyForLoad()})}),!0}isPriorityData(e){var t=!1;return e.labelIds.indexOf(oa.UNREAD)>=0?t=!0:e.labelIds.indexOf(ua.PRI0)>=0?t=!0:e.labelIds.indexOf(ua.PRI1)>=0?t=!0:e.labelIds.indexOf(ua.PRI2)>=0&&(t=!0),t}_load(){i.default.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:i.default.minutes(15),minDelay:i.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runThreadSync}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:i.default.minutes(30),minDelay:i.default.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync})}_notifyFailedRequest(e,t){try{i.default.PAssert(1296,i.default.isString(e),"Must supply a valid accountID string")}catch(n){i.default.reportError(n)}if(t&&t.error)if(t.error.code===r.a.HTTPStatusCode.Unauthorized)Wr.pluginManager.verifyAuthorization(e);else if(t.error.code===r.a.HTTPStatusCode.BadRequest){var a=0;let e=t.error.errors;for(let t=0;t<e.length;++t){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e[t].reason===r.a.GoogleError.FailedPrecondition&&(Wr.toasts.pushMessage(r.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}}else if(t.error.code===r.a.HTTPStatusCode.Forbidden){var s=0;let e=t.error.errors;for(let t=0;t<e.length;++t){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e[t].reason===r.a.GoogleError.InsufficientPermissions&&(Wr.toasts.pushMessage(r.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}}else t.error.code>=400&&t.error.code<500&&this._reportErrorCode(t.error.code)&&i.default.reportError(new Error("Failed Gmail request: "+t.error.code),t)}_reportErrorCode(e){var t=!1;return e!==r.a.HTTPStatusCode.NotFound&&(t=!0),t}_notifySendFailed(){Wr.toasts.pushMessage(r.a.MessageID.EmailSendFail)}_createResourceCID(e,t){var a=0;t||(t="UnnamedFile");for(var i=t,r=1;e[i];){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t.split(".");i=s[0]+"_"+r,s[1]&&(i+="."+s[1]),r++}return i}_createResource(e,t){try{i.default.PAssert(1297,e,"Must have valid resources lib to add to")}catch(a){i.default.reportError(a)}return{cid:this._createResourceCID(e,t.name),id:i.default.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:la.Attachment,parentType:va,mimeType:t.type,contentEncoding:void 0}}_getLinkedResourceString(e){return'<a cid="'+e.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+e.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+e.cid+"</a>"}async _removeAttachContent(e,t,a){var i,r=await vt.a.removeElementsByAttribute(t.decoded,"cid",a.cid);return i=r!==t.decoded,t.decoded=r,i}notifyAttachLinkedFile(e,t,a,i){var s={name:a.getField("title"),type:a.getField("mimeType")},n=this._createResource(t.resources,s);n.size=a.getField("fileSize"),n.link=a.getField("alternateLink"),this._shareAttachment(e,a.id,n,i),t.resources[n.cid]=n,e.notifyDataMutated(["hasAttachments"],r.a.ChangeType.Local)}notifyAttachFiles(e,t,a,i){for(var s=0,n=e.getField("accountID"),o=0;o<a.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=a[o],d=this._createResource(t.resources,l);d.size=l.size,d.uploader=new Et.a(l,n,r.a.DriveFolder.Attach,void 0,()=>{e.notifyDataMutated(["hasAttachments"],r.a.ChangeType.Local)},((t,a)=>{t.error=!1,t.link=a.alternateLink,t.thumbnail=a.thumbnailLink,this._shareAttachment(e,a.id,t,i)}).bind(this,d),(t=>{t.error=!0,Wr.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:()=>{t.uploader.resume()}}),e.notifyDataMutated(["hasAttachments"],r.a.ChangeType.Local),i&&i(!1)}).bind(this,d)),d.uploader.upload(),t.resources[d.cid]=d}e.notifyDataMutated(["messages"],r.a.ChangeType.Local)}_shareAttachment(e,t,a,s){try{i.default.PAssert(1298,t,"Must supply a valid fileID to share")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1299,a,"Must supply a valid resource object to share")}catch(n){i.default.reportError(n)}Wr.remoteAPI().drivePermissionsPublic(t,()=>{a.error=!1,e.notifyDataMutated(["messages"],r.a.ChangeType.Local),s&&s(!0)},n=>{a.error=!0,i.default.isHTTPStatusCode(n,r.a.HTTPStatusCode.Forbidden)?Wr.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):Wr.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:()=>{this._shareAttachment(e,t,a,s)}}),e.notifyDataMutated(["hasAttachments"],r.a.ChangeType.Local),s&&s(!1)})}async removeAttachFiles(e,t,a){try{i.default.PAssert(1300,a,"Must always specify a valid resource to remove from the message")}catch(n){i.default.reportError(n)}var s=!1;return a.uploader&&!a.uploader.isDone()&&(a.uploader.cancel(),s=!0),t.resources[a.cid]&&delete t.resources[a.cid],s=await this._removeAttachContent(e,t,a)||s,e.notifyDataMutated(["messages"],r.a.ChangeType.Local),s}notifyItemPropertyChanged(e,t,a,i){var r=e.getField("accountID");if(this.hasSyncAccount(r)){var s=this.attachmentIsArchived(e);if(t.belongsToItemStore(this.getDefaultItemStore()))t.dateCompleted&&!s&&this.archiveAttachment(e);if("priority"===i)this.getAttachmentPriority(e)!==t.getPriority()&&this.setAttachmentPriority(e,t.getPriority());else"isArchived"===i&&(s&&!t.isArchived()?this.unarchiveAttachment(e):!s&&t.isArchived()&&(this.archiveAttachment(e),Wr.EmailPreview.isOpenOnThread(e)&&Wr.EmailPreview.reset()))}}createLabelString(e){if(!da[e.toUpperCase()])return e}isDisplayTag(e,t){var a=!1;if(e&&e.shouldDisplayInMessageList()){var i=e.isCustom()||e.getLabelID()===oa.DRAFT,r=t&&!t.isInbox()&&e.isInbox();if(i||r)switch(a=!0,e.getName()){case ua.PRI0:case ua.PRI1:case ua.PRI2:case"Moo.do/Handled":case da.STARRED:a=!1}}return a}isDisplayHeader(e){var t=!1;this.isLabelItem(e)&&(this._getLabelIDFromItem(e)!==oa.UNREAD&&(t=!0));return t}isMessageDraft(e){return e&&e.labelIds&&e.labelIds.indexOf(oa.DRAFT)>=0}getDisplayTags(e,t,a){var i,r=0,s=e.getField("labelIds"),n=e.getField("accountID"),o=[];t&&(i=t.getItemLabel(!0));for(var l=0;l<s.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var d=this._getLabelByID(n,s[l]);if(this.isDisplayTag(d,i)){var h=a?d.getOutlineText():d.getDisplayText();h&&o.push(h)}}return o}_getParticipantDisplayName(e,t){var a;if(this.isMyAccountID(e.email))a="me";else if(e.text)if(1===t)a=e.text;else{var i=e.text.split(" ");a=i&&i.length>0?i[0]:e.email}else a=e.email;return a}getDisplayParticipants(e){for(var t=0,a=e.getField("participants"),i=[],r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i.push(this._getParticipantDisplayName(a[r],a.length))}return i.join(", ")}getDefaultDisplayItem(e){e=e||this.getDefaultAccount();var t=this._getLabelByID(e,oa.INBOX);return this.getVMLIForLabel(e,t)}getEmailRootItem(){return k.getItems(r.a.FavoriteGroup.EmailRoot)[0]}hasEmailRootItem(){return k.hasItems(r.a.FavoriteGroup.EmailRoot)}createEmailRootItem(){try{i.default.PAssert(1301,!this.hasEmailRootItem(),"Should not create email root if it already exists")}catch(a){i.default.reportError(a)}var e=Wr.itemStoreManager.getDefaultItemStore().getRoot(),t=o.a.createVMLI({text:"Email",favorites:[r.a.FavoriteGroup.EmailRoot]},{parent:e,changeType:r.a.ChangeType.AllLocal,documentOwner:void 0});return e.insertItem(t,0),Wr.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:r.a.MessageAction.Okay,hold:!0}),t}ensureEmailItem(e){var t=0;P.d.beginAction(),this.hasEmailRootItem()||this.createEmailRootItem();for(var a,i=this.getEmailRootItem(),s=i.getItems(),n=0;n<s.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(s[n].getRawText()===e){a=s[n];break}}return a||(a=o.a.createVMLI({text:e},{parent:i,changeType:r.a.ChangeType.AllLocal,documentOwner:void 0}),i.insertItem(a,0)),P.d.endAction(),a}getWaitingItem(e){e(this.ensureEmailItem("Waiting"))}allowTextEditing(e){var t=!0,a=this.getDefaultItemStore();return e.belongsToItemStore(a)&&(t=!1),t}getDraftForMessage(e,t,a,r){try{i.default.PAssert(1302,t,"Must have a valid thread ID")}catch(d){i.default.reportError(d)}try{i.default.PAssert(1303,a,"Must have a valid message ID")}catch(d){i.default.reportError(d)}var s,n=this.getAttachment(t).getField("messages"),o=n.indexOfWithProperty("id",a);try{i.default.PAssert(1304,o>=0,"Must be able to find the requested message")}catch(d){i.default.reportError(d)}var l=n[o+1];l&&l.labelIds.indexOf(oa.DRAFT)>=0?s=l:(this.createDraft(e,t,a,{from:r}),s=n[o+1]);try{i.default.PAssert(1305,s.labelIds.indexOf(oa.DRAFT)>=0,"Must return a valid draft")}catch(d){i.default.reportError(d)}return s}getDraftByID(e,t,a,r){var s,n;if(t){let e=(s=this.getAttachment(t)).getField("messages");n=a?this._getMessageFromAttachment(s,a):e[0];try{i.default.PAssert(1306,n.labelIds.indexOf(oa.DRAFT)>=0,"Must be a valid draft")}catch(l){i.default.reportError(l)}}else{var o=this.createDraft(e,void 0,void 0,r);n=(s=this.getAttachment(o.threadID)).getField("messages")[0]}return{attach:s,draftMsg:n}}_notifyDraftMessage(e,t,a){try{i.default.PAssert(1307,e,"Must supply a valid accountID")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1308,t&&!i.default.isTempId(t),"Must supply a valid threadID: ",t)}catch(r){i.default.reportError(r)}try{i.default.PAssert(1309,a&&!i.default.isTempId(a),"Must supply a valid messageID: ",a)}catch(r){i.default.reportError(r)}setTimeout(()=>{this.hasCacheData(t)&&this._getRemoteDraftID(e,t,a,(e,a)=>{a&&(i.default.log("DraftID: ",e),this.cacheData(t,this.getCacheData(t),!0,["messages"]))})},0)}_getInlineResources(e){var t={};return i.default.forEachValue(e.resources,e=>{e.disposition===la.Inline&&(t[e.cid]=Object.assign({},e))}),t}createDraft(e,t,a,s){s=s||{};try{i.default.PAssert(1310,!s.body||!s.decoded,"Must not supply both a decoded field and a body")}catch(f){i.default.reportError(f)}this.sendEvent("CreateDraft");var n=i.default.generateTempId(),o=s.from||this.getDefaultFromInfo(e),l=s.body||s.decoded||"";""===l&&(l=this.createSignature(o.email));var d,h,c={id:n,modifiedOffline:!0,labelIds:[oa.DRAFT],messageID:void 0,raw:"",decoded:l,mimeType:Ea,contentType:"text/html;charset=utf-8",from:o,replyTo:this.getReplyToAddress(o.email),to:s.to||[],cc:s.cc||[],bcc:s.bcc||[],snippet:"",subject:s.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:{}};if(t){d=this.getCacheData(t);try{i.default.PAssert(1311,a,"When supplying a thread ID, must also supply a valid message ID")}catch(f){i.default.reportError(f)}var u=d.messages.indexOfWithProperty("id",a);try{i.default.PAssert(1312,u>=0,"If requesting a reply to a message, it must exist in the thread")}catch(f){i.default.reportError(f)}var p=d.messages[u];if(p&&(c.references=(i.default.isTempId(p.messageID)?"":p.messageID)+(p.references?" "+p.references:""),i.default.isTempId(p.messageID)||(c.inReplyTo=p.messageID),c.resources=this._getInlineResources(p)),d.messages.splice(u+1,0,c),this.hasAttachment(t)){var g=this.getAttachment(t);this._updateAttachmentFromMessages(g,r.a.ChangeType.Local),g.notifyDataMutated(["messages"],r.a.ChangeType.Local)}this.addModifiedOffline(d,["messages"]),h=d}else d={id:n,accountID:e,modifiedOffline:!0,messages:[c],labelIds:[oa.DRAFT],subject:s.subject||"",from:e},h=this.createEntryFromLocal(n,d),this.cacheData(h.id,h);return this.cacheThreadData(h.id,this.serializeExternalData(h)),{threadID:h.id,draftID:n,messageID:a}}_updateDraftID(e,t,a){try{i.default.PAssert(1313,a,"Must provide a valid set of draft info")}catch(o){i.default.reportError(o)}try{i.default.PAssert(1314,a.id&&a.message,"Draft info must contain valid data")}catch(o){i.default.reportError(o)}var s=e.isLocalOnlyAttachment();s&&(this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.message.threadId),this._threadCache.removeEntry(t));var n=this._findDraft(e,t,a.id);if(n){n.id=a.message.id;try{i.default.PAssert(1315,n.draftID===a.id,"Should have valid draft ID associated with the message")}catch(o){i.default.reportError(o)}this._draftCache[n.id]=a.id,s&&this.cacheData(e.id,e.getData()),this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[n.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[n.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],r.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}}_updateDraftFromSend(e,t,a){try{i.default.PAssert(1316,a,"Must provide a valid set of draft info")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1317,a.id&&a.threadId,"Draft info must contain valid data")}catch(n){i.default.reportError(n)}if(e.isLocalOnlyAttachment()){this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.threadId);try{i.default.PAssert(1318,!i.default.isTempId(e.id),"After an ID change, should never be a temp ID")}catch(n){i.default.reportError(n)}this._threadCache.removeEntry(t)}var s=this._getMessageFromAttachment(e,t);s.id=a.id,s.labelIds=a.labelIds||[],this._updateAttachmentFromMessages(e,r.a.ChangeType.Remote),this._draftCache[s.id]=a.id,this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[s.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[s.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],r.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}_createRemoteDraft(e,t,a){if(this._creatingDrafts[t])a(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[t]=!0;var r=this._getMessageFromAttachment(e,t);if(r)this._createRFC822Message(e.getData(),r,!1,i=>{var s={raw:i};e.isLocalOnlyAttachment()||(s.threadId=e.id);var n=pe.a.fns("gmail").users.drafts.create.packedFn,o={userId:e.getField("accountID"),resource:{message:s}};this._queueRemoteRequestMulti(e.getField("accountID"),n,o,i=>{this._attachmentHasMessage(e,t)&&(delete this._creatingDrafts[t],r.draftID=i.id,this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(r,!1),this._pendingDraftUpdates[t]&&this._notifyPendingDraftUpdate(),this._updateDraftID(e,t,i),this._updateIsSavingDrafts()),a(!0)},i=>{delete this._creatingDrafts[t],this._updateIsSavingDrafts(),a(!1,i),this._notifyFailedRequest(e.getField("accountID"),i)},void 0,Qt,{noBatch:!0})});else{try{var s={length:e.getField("messages").length};i.default.reportError(new Error("Unable to find valid draft for creation"),s)}catch(n){i.default.reportError(n)}a(!1,{msg:"Unable to find requested message in thread"})}}}_updateIsSavingDrafts(){i.default.isSavingDrafts=this._activeDraftUpdates>0||!i.default.isEmpty(this._pendingDraftUpdates)||!i.default.isEmpty(this._creatingDrafts)}_notifyPendingDraftUpdate(e,t,a,i){e&&t&&(this._pendingDraftUpdates[t]={attach:e,draftID:a,lastUpdate:Date.now()},i&&this._runDraftUpdate(t)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()}_flushPendingDraftUpdates(){if(this.isOnline()){for(var e in this._pendingDraftUpdates)this._pendingDraftUpdates.hasOwnProperty(e)&&this._runDraftUpdate(e);this._draftFlushTimer=void 0}}_runDraftUpdate(e){if(!this._creatingDrafts[e]){var t=this._pendingDraftUpdates[e];try{i.default.PAssert(1319,t,"Must be able to find valid draft info for pending draft update")}catch(a){i.default.reportError(a)}this._updateRemoteDraft(t.attach,e,t.draftID,!1,(e,t)=>{e?Wr.toasts.clearMessage(r.a.MessageID.EmailUpdateFail):i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.NotFound)?Wr.toasts.clearMessage(r.a.MessageID.EmailUpdateFail):Wr.toasts.pushMessage(r.a.MessageID.EmailUpdateFail),this._updateIsSavingDrafts()}),delete this._pendingDraftUpdates[e],this.sendEvent("UpdateDraft")}}_clearPendingDraftUpdate(e,t){var a=this._pendingDraftUpdates[t];if(a){try{i.default.PAssert(1320,a.attach===e,"Must have the correct attachment for the draft update")}catch(r){i.default.reportError(r)}delete this._pendingDraftUpdates[t]}}hasPendingSends(){return Object.keys(this._pendingSends).length>0}notifyPendingSend(e,t){try{i.default.PAssert(1321,!this._pendingSends[t],"Must not have an already pending send for a message")}catch(a){i.default.reportError(a)}this._pendingSends[t]=e,i.default.isSendingEmail=!0}notifySent(e,t){try{i.default.PAssert(1322,this._pendingSends[t],"Must have a pending send to be sent")}catch(a){i.default.reportError(a)}delete this._pendingSends[t],this.hasPendingSends()||(i.default.isSendingEmail=!1)}notifySendError(e,t){try{i.default.PAssert(1323,this._pendingSends[t],"Must have a pending send to have an error")}catch(a){i.default.reportError(a)}delete this._pendingSends[t],this.hasPendingSends()||(i.default.isSendingEmail=!1)}onShutdown(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()}_getLinkedResources(e){var t=[];return i.default.forEachValue(e,e=>{"attachment"===e.disposition&&e.link&&t.push(e)}),t}_createDraftBody(e,t){var a;if(t){var i=this._getLinkedResources(t);if(i.length>0){for(var r=0,s="<br/><br/>",n=0;n<i.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;s+=this._getLinkedResourceString(i[n])}a=e+'<var id="moodoAttach" moodoAttach="true">'+s+"</var>"}else a=e}else a=e;return a}updateDraft(e,t,a,s,n,o,l){try{i.default.PAssert(1324,i.default.isBoolean(n),"Must supply a valid bool for updateRemoteDraft")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1325,i.default.isBoolean(o),"Must supply a valid bool for forceFlush")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1326,i.default.isFunction(l),"Must supply a valid bool for cb")}catch(h){i.default.reportError(h)}var d=this._findDraft(e,t,a);if(d)return d.to=s.to,d.from=s.from||d.from,d.cc=s.cc,d.bcc=s.bcc,d.subject=s.subject,d.decoded=this._createDraftBody(s.decoded,d.resources),d.snippet=s.snippet?i.default.escape(s.snippet.substring(0,60)):"",d.modifiedOffline=!0,s.hasOwnProperty("resources")&&(d.resources=s.resources),this._updateAttachmentFromMessages(e,r.a.ChangeType.Local),e.notifyDataMutated(["messages"],r.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(this.getCacheData(e.id))),!this._creatingDrafts[d.id]&&n?i.default.isTempId(d.id)?this._createRemoteDraft(e,d.id,(e,t)=>{e||Wr.toasts.pushMessage(r.a.MessageID.EmailUpdateFail),l(e,t)}):(this._notifyPendingDraftUpdate(e,d.id,d.draftID,o),l(!0)):(n&&this._notifyPendingDraftUpdate(e,d.id,d.draftID,o),l(!0)),this._updateIsSavingDrafts(),{threadID:e.id,draftID:d.draftID,messageID:d.id};try{i.default.PAssert(1327,!1,"Unable to update draft as expected from compose window")}catch(h){i.default.reportError(h)}l(!1)}_updateRemoteDraft(e,t,a,r,s){try{i.default.PAssert(1328,t&&a,"Must specify both a valid messageID and draftID"+t+"."+a)}catch(o){i.default.reportError(o)}var n=this._findDraft(e,t,a);try{i.default.PAssert(1329,n&&n.labelIds.indexOf(oa.DRAFT)>=0,"Must be updating a valid draft"+!!n)}catch(o){i.default.reportError(o)}try{i.default.PAssert(1330,!this._creatingDrafts[n.id],"Should not send a remote update while the original draft is being created")}catch(o){i.default.reportError(o)}this._activeDraftUpdates++,this._getRemoteDraftID(e.getField("accountID"),e.id,n.id,t=>{if(t)this._createRFC822Message(e.getData(),n,r,a=>{var i=pe.a.fns("gmail").users.drafts.update.packedFn,r={userId:e.getField("accountID"),id:t,resource:{message:{raw:a,threadId:e.id}}};this._queueRemoteRequestMulti(e.getField("accountID"),i,r,t=>{this._updateDraftID(e,n.id,t),this._activeDraftUpdates--,s(t)},t=>{s(void 0,t),this._activeDraftUpdates--,this._notifyFailedRequest(e.getField("accountID"),t)},void 0,$t)});else{try{i.default.PAssert(1331,!1,"Must always be able to get a valid draft ID when updating")}catch(o){i.default.reportError(o)}s(!1)}})}sendDraft(e,t,a,s,n){try{i.default.PAssert(1332,!e.getField("pendingSend"),"Should not try to re-send a message after it has already been sent")}catch(p){i.default.reportError(p)}var o=!0,l=this._findDraft(e,t,a),d=(t,a)=>{t?(e.updateField("pendingSend",!1),this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(l,!1),this.notifySent(e,l.id)):(i.default.isHTTPStatusCode(a,r.a.HTTPStatusCode.Network)||e.updateField("pendingSend",!1),this.notifySendError(e,l.id)),n(t,a)},h=this._verifyEmailRecipients(e,l.id,l.draftID);if(h||(h=this._verifyEmailAttachments(e,l.id,l.draftID)),h){o=!1;var c=Wr.toasts.pushMessage({text:h.message,action:r.a.MessageAction.Okay});h.handleMessageFn&&h.handleMessageFn(c),this.notifyPendingSend(e,l.id),d(!1)}else if(!s){e.updateField("pendingSend",!0),this.notifyPendingSend(e,l.id);var u=!1;this.onEmailReadyToSend(l,()=>{try{i.default.PAssert(1333,!u,"Should not send an email twice")}catch(p){i.default.reportError(p)}u||(u=!0,e.isLocalOnlyAttachment()||i.default.isTempId(l.id)?this._sendEmail(e,l.id,l.draftID,d):this._sendRemoteDraft(e,l.id,d))})}return o}onEmailReadyToSend(e,t){var a=!0;i.default.forEachValue(e.resources,r=>{if(r.uploader&&!r.uploader.isDone())if(a=!1,r.uploader.hasError())try{i.default.PAssert(1334,!1,"Attachment has error when sending.")}catch(s){i.default.reportError(s)}else r.uploader.notifyOnComplete(this.onEmailReadyToSend.bind(this,e,t))}),a&&setTimeout(t,0)}_sendRemoteDraft(e,t,a){this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t),this._getRemoteDraftID(e.getField("accountID"),e.id,t,s=>{if(s)this._updateRemoteDraft(e,t,s,!0,t=>{if(t&&t.message){var i=pe.a.fns("gmail").users.drafts.send.packedFn,n={userId:e.getField("accountID"),resource:{id:s}};this._queueRemoteRequestMulti(e.getField("accountID"),i,n,i=>{this._updateLocalDraftFromSend(e,t.message.id,i,a)},t=>{this._notifySendFailed(),a(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)},void 0,Zt)}else Wr.toasts.pushMessage(r.a.MessageID.EmailUpdateFail),a(!1)});else{try{i.default.PAssert(1335,!1,"Must always be able to get a valid draft ID when sending")}catch(n){i.default.reportError(n)}Wr.toasts.pushMessage(r.a.MessageID.EmailUpdateFail),a(!1)}})}_updateLocalDraftFromSend(e,t,a,r){try{i.default.PAssert(1336,a,"Must have a valid draft result")}catch(n){i.default.reportError(n)}var s=this._getMessageFromAttachment(e,t);try{i.default.PAssert(1337,s,"Must always be able to find the sent message")}catch(n){i.default.reportError(n)}s&&(this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(s,!1),this._updateDraftFromSend(e,t,a)),i.default.isDemoMode()||this._requestRemoteMessageData(e,a.id,e=>{try{i.default.PAssert(1338,e,"Should always be able to update message data after send")}catch(n){i.default.reportError(n)}}),r(!0)}runDiscardDraft(e){var t=this._getDraftFromAttachment(e);this.discardDraft(e,t.id,t.draftID,e=>{try{i.default.PAssert(1339,e,"Must be able to discard message draft")}catch(t){i.default.reportError(t)}})}discardDraft(e,t,a,s){var n=e.getData(),o=this._findDraft(e,t,a),l=n.messages.indexOf(o);i.default.isTempId(t)?s(!0):this._deleteRemoteDraft(e,t,s);var d=n.messages[l];n.messages.splice(l,1),this._removeRemoteResources(d),this._updateAttachmentFromMessages(e,r.a.ChangeType.Local),this._clearPendingDraftUpdate(e,t),e.notifyDataMutated(["messages"],r.a.ChangeType.Local),this.cacheThreadData(n.id,this.serializeExternalData(n)),this.sendEvent("DiscardDraft")}_removeRemoteResources(e){e&&i.default.forEachValue(e.resources,e=>{e.uploader&&!e.uploader.isDone()&&e.uploader.cancel()})}_deleteRemoteDraft(e,t,a){try{i.default.PAssert(1340,!i.default.isTempId(t),"Should not try to remotely delete a local message")}catch(s){i.default.reportError(s)}this._getRemoteDraftID(e.getField("accountID"),e.id,t,t=>{if(t){var n=pe.a.fns("gmail").users.drafts.delete.packedFn,o={userId:e.getField("accountID"),id:t};this._queueRemoteRequestMulti(e.getField("accountID"),n,o,()=>{a(!0)},t=>{i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.NotFound)?a(!0):a(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)},void 0,Jt)}else{try{i.default.PAssert(1341,!1,"Must always be able to get a valid draft ID when deleting")}catch(s){i.default.reportError(s)}Wr.toasts.pushMessage(r.a.MessageID.EmailUpdateFail),a(!1)}})}_getRemoteDraftIDRaw(e,t,a,i){var r=pe.a.fns("gmail").users.drafts.list.packedFn,s={userId:e,q:"rfc822msgid:"+t};this._queuePagedRemoteRequestMulti(e,r,s,a,i,void 0,ea,{getAllPages:!0,resultsField:"drafts"})}_getRemoteDraftID(e,t,a,s){try{i.default.PAssert(1342,i.default.isString(e),"Must provide a valid accountID")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1343,i.default.isString(t)&&!i.default.isTempId(t),"Should not try to remotely get the draft ID of a local thread: ",t)}catch(l){i.default.reportError(l)}try{i.default.PAssert(1344,i.default.isString(a)&&!i.default.isTempId(a),"Should not try to remotely get the draft ID of a local draft: ",a)}catch(l){i.default.reportError(l)}var n=this.getAttachment(t);try{i.default.PAssert(1345,n,"Must be able to find a valid attachment for the requested thread")}catch(l){i.default.reportError(l)}if(!n)return setTimeout(s,0,void 0,!1);var o=this._getMessageFromAttachment(n,a);try{i.default.PAssert(1346,o,"Must be able to find a valid message for the requested draft")}catch(l){i.default.reportError(l)}if(!o)return setTimeout(s,0,void 0,!1);if(o.draftID)setTimeout(s,0,o.draftID,!1);else{try{i.default.PAssert(1347,o.messageID&&!i.default.isTempId(o.messageID),"Must have a valid messageID for the draft being queried")}catch(l){i.default.reportError(l)}if(!o.messageID||i.default.isTempId(o.messageID))return setTimeout(s,0,void 0,!1);this._getRemoteDraftIDRaw(e,o.messageID,d=>{try{i.default.PAssert(1348,d&&d.length<=1,"Must find only a single draft ID for a given message: ",d.length,o.messageID)}catch(l){i.default.reportError(l)}if(d){for(var h=0,c=0;c<d.length;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var u=d[c];if(1===d.length||u.message.threadId===t){try{i.default.PAssert(1349,!o.draftID||o.draftID===u.id,"Draft ID must either match or not be known yet")}catch(l){i.default.reportError(l)}o.draftID=u.id}}try{i.default.PAssert(1350,0===d.length||o.draftID,"Draft returned but IDs dont match: ",d[0]?d[0].message.threadId:"NO RESULT",t,d[0]?d[0].message.id:"NO RESULT",a)}catch(l){i.default.reportError(l)}}return o.draftID?s(o.draftID,!0):o.contentType&&o.mimeType&&o.decoded?void this._createRemoteDraft(n,o.id,(a,n)=>a?s(o.draftID,!0):(i.default.isHTTPStatusCode(n,r.a.HTTPStatusCode.NotFound)&&this._deleteCachedThread(e,t),s(void 0,!1))):s(void 0,!1)},t=>(this._notifyFailedRequest(e,t),s(void 0,!1)))}}_attachmentHasMessage(e,t){return e.getField("messages").indexOfWithProperty("id",t)>=0}_getMessageFromAttachment(e,t){var a=e.getField("messages"),r=a.indexOfWithProperty("id",t);try{i.default.PAssert(1351,r>=0,"Must have a vald draft")}catch(s){i.default.reportError(s)}return a[r]}_getDraftFromAttachment(e,t){for(var a,i=0,r=e.getField("messages"),s=0;s<r.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r[s].labelIds.indexOf(oa.DRAFT)>=0){t&&t!==r[s].draftID||(a=r[s]);break}}return a}_findDraft(e,t,a){var r,s=e.getField("messages"),n=s.indexOfWithProperty("id",t);if(n>=0)r=s[n];else if(a){var o=s.indexOfWithProperty("draftID",a);o>=0&&(r=s[o])}try{i.default.PAssert(1352,r,"Must be able to find a valid draft for given messageID/draftID")}catch(l){i.default.reportError(l)}return r}isAttachmentDraftOnly(e){return this.attachmentHasLabel(e,da.DRAFT)&&1===e.getField("messages").length}archiveAttachment(e){try{i.default.PAssert(1353,!this.attachmentIsArchived(e),"Should not archive a thread that is already archived")}catch(t){i.default.reportError(t)}return this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(e,da.INBOX)}unarchiveAttachment(e){try{i.default.PAssert(1354,this.attachmentIsArchived(e),"Thread must be unarchived to archive it")}catch(t){i.default.reportError(t)}return this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(e,da.INBOX)}trashAttachment(e){return this.sendEvent("TrashMail"),this.trashMail(e.getField("accountID"),e.id,void 0,e=>{try{i.default.PAssert(1355,e,"Must have successfully trashed remote thread")}catch(t){i.default.reportError(t)}})}untrashAttachment(e){return this.sendEvent("UntrashMail"),this.untrashMail(e.getField("accountID"),e.id,void 0,e=>{try{i.default.PAssert(1356,e,"Must have successfully untrashed remote thread")}catch(t){i.default.reportError(t)}})}markAttachmentRead(e){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(e,da.UNREAD)}markAttachmentUnread(e){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(e,da.UNREAD)}snoozeAttachment(e,t){}unsnoozeAttachment(e){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(e,"Moo.do/Snoozed"),this.addLabelToAttachment(e,da.INBOX),this.addLabelToAttachment(e,da.UNREAD),this.cancelDeferredTask(e.id,Ft)}_handleDeferredSnoozeTask(e){}scheduleSendMessage(e,t,a){}cancelSendMessage(e,t){this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(e,"Moo.do/ScheduledSend"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,e=>{e&&this.cancelDeferredTask(e,Nt)})}_handleDeferredSendMailTask(e){var t=e.getData();try{i.default.PAssert(1359,t.gidLinked,"Must have valid gidLinked")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1360,t.threadID,"Must have a valid threadID")}catch(a){i.default.reportError(a)}i.default.log("Handling deferred send mail: ",t)}_ensureNoPriority(e){var t=r.a.VMLIFlag.None;return this.attachmentHasLabel(e,ua.PRI0)&&(this.removeLabelFromAttachment(e,ua.PRI0),t=r.a.VMLIFlag.P0),this.attachmentHasLabel(e,ua.PRI1)&&(this.removeLabelFromAttachment(e,ua.PRI1),t=r.a.VMLIFlag.P1),this.attachmentHasLabel(e,ua.PRI2)&&(this.removeLabelFromAttachment(e,ua.PRI2),t=r.a.VMLIFlag.P2),t}getAttachmentPriority(e){return this._attachmentHasPriorityLabel(e,r.a.VMLIFlag.P0)&&r.a.VMLIFlag.P0||this._attachmentHasPriorityLabel(e,r.a.VMLIFlag.P1)&&r.a.VMLIFlag.P1||this._attachmentHasPriorityLabel(e,r.a.VMLIFlag.P2)&&r.a.VMLIFlag.P2||r.a.VMLIFlag.None}setAttachmentPriority(e,t){this.sendEvent("SetMailPriority");var a=this._ensureNoPriority(e);switch(t){case r.a.VMLIFlag.None:break;case r.a.VMLIFlag.P0:this.addLabelToAttachment(e,ua.PRI0);break;case r.a.VMLIFlag.P1:this.addLabelToAttachment(e,ua.PRI1);break;case r.a.VMLIFlag.P2:this.addLabelToAttachment(e,ua.PRI2);break;default:try{i.default.PAssert(1361,!1,"Invalid priority for email attachment")}catch(s){i.default.reportError(s)}}return a}markAttachmentStarred(e){return this.sendEvent("StarMail"),this.addLabelToAttachment(e,da.STARRED)}markAttachmentUnstarred(e){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(e,da.STARRED)}attachmentHasLabelByID(e,t){return this.hasLabelByID(e.getField("accountID"),e.id,void 0,t)}attachmentHasLabel(e,t){return this.hasLabel(e.getField("accountID"),e.id,void 0,t)}attachmentHasFullLabel(e,t){return this.hasFullLabel(e.getField("accountID"),e.id,t)}attachmentIsArchived(e){return this._threadIsArchived(e.getData())}addLabelToAttachment(e,t){return this.addLabel(e.getField("accountID"),e.id,void 0,t)}removeLabelFromAttachment(e,t){return this.removeLabel(e.getField("accountID"),e.id,void 0,t)}trashMail(e,t,a,s){var n=this.getAttachment(t);if(this.isAttachmentDraftOnly(n)){var o=n.getField("messages")[0];this.discardDraft(n,o.id,o.draftID,s)}else this.removeLabelsFromMessage(e,t,a,[oa.INBOX],r.a.ChangeType.Local),this.addLabelsToMessage(e,t,a,[oa.TRASH],r.a.ChangeType.Local),i.default.isTempId(t)?s(!0):this._trashRemoteMail(e,t,a,s)}untrashMail(e,t,a,s){this.removeLabelsFromMessage(e,t,a,[oa.TRASH],r.a.ChangeType.Local),i.default.isTempId(t)?(this.addLabelsToMessage(e,t,a,[oa.INBOX],r.a.ChangeType.Local),s(!0)):(this.addLabel(e,t,a,da.INBOX),this._untrashRemoteMail(e,t,a,s))}moveItem(e,t,a){return a.insertItem(t,0),[t,a]}unmoveItem(e,t,a){return a.removeChild(t,r.a.ChangeType.Local),[t,a]}hasLabelByID(e,t,a,r){try{i.default.PAssert(1362,!a,"We don't support individual queries on messages, only threads")}catch(s){i.default.reportError(s)}return this.getAttachment(t).getField("labelIds").indexOf(r)>=0}hasLabel(e,t,a,r){try{i.default.PAssert(1363,!a,"We don't support individual queries on messages, only threads")}catch(o){i.default.reportError(o)}var s=!1;if(!a){var n=this._getLabelByName(e,r,!0);n&&(s=this.hasLabelByID(e,t,a,n.getLabelID()))}return s}hasFullLabel(e,t,a){var i=!1,r=this.getCacheData(t),s=this._getLabelByName(e,a,!0);if(s&&r){var n=0,o=r.messages;i=!0;for(var l=0;l<o.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(o[l].labelIds.indexOf(s.getLabelID())<0){i=!1;break}}}return i}hasLabelLike(e,t,a){var i=!1,r=this.getAttachment(t);if(r){var s=r.getField("labelIds"),n=this._getAccountLib(e,this._labelsByID);if(n)for(var o=0,l=0;l<s.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=n[s[l]];d&&d.isMatched(a)&&(i=!0)}}return i}addLabel(e,t,a,s){try{i.default.PAssert(1364,!a,"We currently do not support setting labels on single messages")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1365,!this.hasLabel(e,t,a,s),"Should not add the same label to a thread/message twice")}catch(l){i.default.reportError(l)}var n=this._getLabelByName(e,s,!0);if(n)n.isLocalOnly()?this._createRemoteLabel(e,s,a=>{if(a){try{i.default.PAssert(1367,a,"Should have successfully created the remote label")}catch(l){i.default.reportError(l)}this._changeLabelID(e,n.getLabelID(),a.id),this._modifyRemoteThreadLabels(e,t,[a.id],void 0)}}):this._modifyRemoteThreadLabels(e,t,[n.getLabelID()],void 0);else{var o=i.default.generateTempId();n=this._ensureLabel(e,o,s,void 0,void 0,r.a.ChangeType.Local),this._ensureVMLIsForLabel(e,n),this._writeLabelsToCache(),this._createRemoteLabel(e,s,a=>{try{i.default.PAssert(1366,a,"Should have successfully created the remote label")}catch(l){i.default.reportError(l)}a&&(this._changeLabelID(e,o,a.id),this._modifyRemoteThreadLabels(e,t,[a.id],void 0))})}return this.addLabelsToMessage(e,t,a,[n.getLabelID()],r.a.ChangeType.Local),s}removeLabel(e,t,a,s){try{i.default.PAssert(1368,!a,"We currently do not support setting labels on single messages")}catch(o){i.default.reportError(o)}var n=this._getLabelByName(e,s);try{i.default.PAssert(1369,n,"Must have valid label for gmail in order to remove")}catch(o){i.default.reportError(o)}return n&&(n.isLocalOnly()||this._modifyRemoteThreadLabels(e,t,void 0,[n.getLabelID()]),this.removeLabelsFromMessage(e,t,a,[n.getLabelID()],r.a.ChangeType.Local)),s}_threadIsArchived(e){if(e){var t=e.labelIds.indexOf(oa.INBOX)>=0,a=this.hasFullLabel(e.accountID,e.id,da.TRASH),r=e.labelIds.indexOf(oa.SPAM)>=0,s=this.hasFullLabel(e.accountID,e.id,da.DRAFT);return!i.default.isTempId(e.id)&&!t&&!a&&!r&&!s}return!1}_trashRemoteMail(e,t,a,r){try{i.default.PAssert(1370,!i.default.isTempId(t),"Should not try to trash local only threads")}catch(o){i.default.reportError(o)}try{i.default.PAssert(1371,!a||!i.default.isTempId(a),"Should not try to trash local only messages")}catch(o){i.default.reportError(o)}var s,n;a?(s=pe.a.fns("gmail").users.messages.trash.packedFn,n={userId:e,id:a}):(s=pe.a.fns("gmail").users.threads.trash.packedFn,n={userId:e,id:t});this._queueRemoteRequestMulti(e,s,n,()=>{r(!0)},t=>{r(!1,t),this._notifyFailedRequest(e,t)},void 0,Yt)}_untrashRemoteMail(e,t,a,r){try{i.default.PAssert(1372,!i.default.isTempId(t),"Should not try to untrash local only threads")}catch(o){i.default.reportError(o)}try{i.default.PAssert(1373,!a||!i.default.isTempId(a),"Should not try to untrash local only messages")}catch(o){i.default.reportError(o)}var s,n;a?(s=pe.a.fns("gmail").users.messages.untrash.packedFn,n={userId:e,id:a}):(s=pe.a.fns("gmail").users.threads.untrash.packedFn,n={userId:e,id:t});this._queueRemoteRequestMulti(e,s,n,()=>{r(!0)},t=>{r(!1,t),this._notifyFailedRequest(e,t)},void 0,Yt)}_createRemoteLabel(e,t,a){var s=pe.a.fns("gmail").users.labels.create.packedFn,n={userId:e,resource:{name:t,labelListVisibility:"labelHide",messageListVisibility:"hide"}};this._queueRemoteRequestMulti(e,s,n,e=>{a&&a(e)},t=>{i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.Conflict)?a&&a(void 0,t):(a&&a(void 0,t),this._notifyFailedRequest(e,t))},void 0,Gt)}_modifyRemoteThreadLabels(e,t,a,i,r){var s=pe.a.fns("gmail").users.threads.modify.packedFn,n={userId:e,id:t,resource:{addLabelIds:a,removeLabelIds:i}};this._queueRemoteRequestMulti(e,s,n,e=>{r&&r(e)},t=>{r&&r(void 0,t),this._notifyFailedRequest(e,t)},void 0,Kt)}_ensureRemoteLabel(e,t,a,s){this._getLabelByName(e,t,!0)?s&&s(!0):(this._ensureLabel(e,i.default.generateTempId(),t,void 0,void 0,a),this._createRemoteLabel(e,t,(e,t)=>{try{i.default.PAssert(1374,e||i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.Conflict),"Should have successful root label creation")}catch(a){i.default.reportError(a)}s&&s(!!e)}))}_createInMemoryLabel(e,t,a,i,r,s){var n=new mt(e,t,a,this._clampSyncTime(i),r,s);s[t]=n,this._ensureAccountLib(e,this._labelsByName)[a]=n}_updateLabelName(e,t){var a=e.getAccountID(),r=this._getAccountLib(a,this._labelsByName);try{i.default.PAssert(1375,r,"Must have valid label name bucket")}catch(s){i.default.reportError(s)}try{i.default.PAssert(1376,r[e.getRawName()],"Must have valid label in bucket")}catch(s){i.default.reportError(s)}e.updateLabelName(t),delete r[e.getRawName()],r[t]=e}_ensureLabel(e,t,a,r,s,n){try{i.default.PAssert(1377,t.length>3,"Label ID should be longer than a couple of chars")}catch(d){i.default.reportError(d)}var o=this._ensureAccountLib(e,this._labelsByID);if(o[t])!i.default.isRemoteChange(n)&&o[t].hasName()||o[t].isSystemLabel()||this._updateLabelName(o[t],a);else{var l=this._getLabelByName(e,a,!0);if(l)l.isLocalOnly()&&!i.default.isTempId(t)?this._changeLabelID(e,l.getLabelID(),t):l.isLocalOnly()||(o[t]=l);else{try{i.default.PAssert(1379,a||!i.default.isTempId(t),"All local labels must have a valid name")}catch(d){i.default.reportError(d)}this._createInMemoryLabel(e,t,a,r,s,o)}}return o[t]}_clampSyncTime(e){return e&&e.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():e}_ensureLabelVMLIsForAccount(e){var t=this._getAccountLib(e,this._labelsByID);for(var a in t)t.hasOwnProperty(a)&&this._ensureVMLIsForLabel(e,t[a])}_changeLabelID(e,t,a){var i=this._getLabelByID(e,t);Wr.PaneUpdateBatcher.beginUpdateItems(),i.updateLabelID(a),this._getAccountLib(e,this._labelsByID)[a]=i,this._ensureVMLIsForLabel(e,i),Wr.PaneUpdateBatcher.commitUpdateItems(),this.forEachAttachment(e=>{var i=e.getField("labelIds");if(i.remove(t)>=0){for(var r=0,s=e.getField("messages"),n=0;n<s.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;s[n].labelIds.remove(t)>=0&&s[n].labelIds.push(a)}i.push(a),e.updateField("labelIds",i)}});var r=this.getDefaultItemStore(),s="L~"+e+"~"+t;r.hasItem(s)&&r.destroyItem(s)}labelExists(e,t){var a=this._getAccountLib(e,this._labelsByID);return a&&a[t]}_getLabelByID(e,t){try{i.default.PAssert(1380,e,"Must supply a valid accountID")}catch(s){i.default.reportError(s)}try{i.default.PAssert(1381,t,"Must supply a valid labelID")}catch(s){i.default.reportError(s)}var a=this._ensureAccountLib(e,this._labelsByID);if(!a[t]){var r=da[t];this._createInMemoryLabel(e,t,r,void 0,void 0,a)}return a[t]}_getLabelByName(e,t,a){try{i.default.PAssert(1382,this.hasSyncAccount(e),"Must provide a valid accountID with a matching sync account: "+e)}catch(n){i.default.reportError(n)}var r,s=this._getAccountLib(e,this._labelsByName);try{i.default.PAssert(1383,a||s,"Unable to find labelsByName for given account: "+e)}catch(n){i.default.reportError(n)}return s&&(r=s[t]),r}_getPriorityLabel(e,t){var a=this._ensureAccountLib(e,this._priorityLabels);if(!a[t]){var s;switch(t){case r.a.VMLIFlag.P0:s=ua.PRI0;break;case r.a.VMLIFlag.P1:s=ua.PRI1;break;case r.a.VMLIFlag.P2:s=ua.PRI2;break;default:try{i.default.PAssert(1384,!1,"Invalid priority for email attachment")}catch(n){i.default.reportError(n)}}a[t]=this._getLabelByName(e,s)}return a[t]}_getAccountLib(e,t){try{i.default.PAssert(1385,e,"Must provide valid accountID")}catch(s){i.default.reportError(s)}try{i.default.PAssert(1386,t,"Must provide valid lib object")}catch(s){i.default.reportError(s)}var a;if(e)if(t[e])a=t[e];else for(var r in t)if(r.toUpperCase()===e.toUpperCase())try{i.default.PAssert(1387,!1,"Mismatch case request found for accountIDs: "+e,r)}catch(s){i.default.reportError(s)}return a}_ensureAccountLib(e,t){try{i.default.PAssert(1388,e,"Must provide valid accountID")}catch(s){i.default.reportError(s)}try{i.default.PAssert(1389,t,"Must provide valid lib object")}catch(s){i.default.reportError(s)}var a;if(e)if(t[e=e.toLowerCase()])a=t[e];else{for(var r in t)if(t.hasOwnProperty(r))try{i.default.PAssert(1390,!e||!r||r.toUpperCase()!==e.toUpperCase(),"Dupe accountID found with non-matching case: "+e,r)}catch(s){i.default.reportError(s)}a=t[e]={}}return a}_deleteAccountLib(e,t){try{i.default.PAssert(1391,e,"Must provide valid accountID")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1392,t,"Must provide valid lib object")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1393,t[e],"Trying to delete an account lib that doesnt exist: ",e)}catch(a){i.default.reportError(a)}delete t[e]}_attachmentHasPriorityLabel(e,t){var a=this._getPriorityLabel(e.getField("accountID"),t);return!!a&&e.getField("labelIds").indexOf(a.getLabelID())>=0}getLabels(e,t,a){var i=[],r=t.toLowerCase(),s=0,n=this._labelsByID[e];for(var o in n)if(n.hasOwnProperty(o)){var l=n[o];if(l.matchesText(r)&&this.isDisplayTag(l)&&i.indexOf(l)<0&&(i.push(l),s++),a&&s>=a)break}return i}_writeLabelsToCache(){var e={};for(var t in this._labelsByID)if(this._labelsByID.hasOwnProperty(t)){e[t]={};var a=this._labelsByID[t];for(var i in a)a.hasOwnProperty(i)&&(e[t][i]=a[i].getSaveData())}this._threadCache.setMetadata(sa,e)}_writeSendAsToCache(){var e={};this._iterateSendAs((t,a)=>{e[t]||(e[t]=[]),e[t].push(a)}),this._threadCache.setMetadata(na,e)}runLabelSync(e){var t=0,a=this.getSyncAccounts(),s=a.length,n=0,o=0,l=(t,a)=>{if(this.hasSyncAccount(t)){Wr.PaneUpdateBatcher.beginUpdateItems();var l={};if(a){var d=0;for(let e=0;e<a.length;++e){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h,c=a[e];l[c.id]=!0,h="system"===c.type&&da[c.id]?da[c.id]:c.name,this._ensureLabel(t,c.id,h,void 0,c,r.a.ChangeType.Remote)}}this._ensureLabelVMLIsForAccount(t),this._ensureRemoteLabel(t,"Moo.do",r.a.ChangeType.Local),this._ensureRemoteLabel(t,ua.PRI0,r.a.ChangeType.Local),this._ensureRemoteLabel(t,ua.PRI1,r.a.ChangeType.Local),this._ensureRemoteLabel(t,ua.PRI2,r.a.ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Snoozed",r.a.ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Handled",r.a.ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Scheduled",r.a.ChangeType.Local);var u=this._getAccountLib(t,this._labelsByID);if(u)for(var p in u)if(u.hasOwnProperty(p)){var g=u[p];if(g.isLocalOnly()){try{i.default.PAssert(1394,g.hasName(),"Label must have a valid name to be created on remote")}catch(f){i.default.reportError(f)}this._createRemoteLabel(t,g.getName(),function(e,a){a&&this._changeLabelID(t,e,a.id)}.bind(this,p))}else 0!==o||l[p]||g.isSystemOrSpecialLabel()||i.default.isDemoMode()||g.delete()}Wr.PaneUpdateBatcher.commitUpdateItems(),this._writeLabelsToCache(),o+n===s&&e&&e()}else e&&e()},d=(e,t)=>{o++,l(e),this._notifyFailedRequest(e,t)},h=(e,t)=>{t?(n++,l(e,t.labels)):d(e,t)};for(let i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var c=pe.a.fns("gmail").users.labels.list.packedFn;let e=a[i];var u={userId:e,timeoutMS:0};re.a.getAccountAuthToken(e,this.googleScopes(),t=>{t&&this._queueRemoteRequestMulti(e,c,u,h.bind(this,e),d.bind(this,e),void 0,Wt)})}}getDescriptorForItem(e){try{i.default.PAssert(1396,e,"Must have a valid item to get a description for")}catch(n){i.default.reportError(n)}var t=this._getAccountIDFromItem(e),a=this._getLabelIDFromItem(e),r={accountID:t,labelID:a,threadID:this._getThreadIDFromItem(e)};if(t&&a){var s=this._getLabelByID(t,a);r.labelName=s.getName()}return r}handleItemChange(e,t){var a=this.getDescriptorForItem(e);if(a.labelID){try{i.default.PAssert(1397,a.accountID,"Must specify a valid accountID")}catch(r){i.default.reportError(r)}this._getThreadsForLabel(a.accountID,this._getLabelByID(a.accountID,a.labelID),e,!1,e=>{try{i.default.PAssert(1398,e,"Expected success when querying for remote threads")}catch(r){i.default.reportError(r)}t&&t()})}}handleViewModeChange(e,t){if(t===r.a.GmailViewMode.Priority){var a=this._getAccountIDFromItem(e);try{i.default.PAssert(1399,a,"Missing Account ID: ",e.id)}catch(l){i.default.reportError(l)}var s=this._getLabelByName(a,ua.PRI0);s&&this._getThreadsForLabel(a,s,void 0,!1,e=>{try{i.default.PAssert(1400,e,"Expected success when querying for remote PRI0 threads")}catch(l){i.default.reportError(l)}});var n=this._getLabelByName(a,ua.PRI1);n&&this._getThreadsForLabel(a,n,void 0,!1,e=>{try{i.default.PAssert(1401,e,"Expected success when querying for remote PRI1 threads")}catch(l){i.default.reportError(l)}});var o=this._getLabelByName(a,ua.PRI2);o&&this._getThreadsForLabel(a,o,void 0,!1,e=>{try{i.default.PAssert(1402,e,"Expected success when querying for remote PRI2 threads")}catch(l){i.default.reportError(l)}})}}_getThreadsForLabel(e,t,a,r,s){try{i.default.PAssert(1403,t,"Must provide a valid label to get thrads for")}catch(h){i.default.reportError(h)}var n="-in:chats -in:spam label:"+t.getName(),o=t.getOldestSync();i.default.isDateValid(o)&&(n+=" before:"+Math.floor(o.getTime()/1e3));var l=new Date,d=new wt(t=>{if(t){var a=this._addRemoteEntry(e,t);a.internalDate.isBefore(l)&&(l=a.internalDate),this.cacheThreadData(a.id,this.serializeExternalData(a))}},e=>{t.setOldestSync(l),this._writeLabelsToCache(),s(e)});this._requestRemoteThreads(e,Xt,a,n,r?999:25,void 0,d.getEntryCB(),d.getDoneCB())}createOutlinePaneItem(e,t){for(var a=0,s=t.getItemStore(),n=e.getRawText(),o=e.getAttachmentByPlugin(this.id),l=this.getDisplayTags(o,void 0,!0),d=0;d<l.length;++d){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n+=" #"+l[d]}return s.createItem(i.default.generateTempId(),n,t.id,void 0,r.a.ChangeType.Local,t.getDocumentOwner())}refreshCurrentView(e){this._forceThreadSync(e)}goOnline(){this._forceThreadSync(this._notifyPendingDraftUpdate)}loadInitialData(){super.loadInitialData(),i.default.isDemoMode()&&this._forceThreadSync()}_forceThreadSync(e){this.hasRecurringTask("GmailThreadSync")&&this.getRecurringTask("GmailThreadSync").forceUpdate(e)}_forceLabelSync(e){this.hasRecurringTask("GmailLabelSync")&&this.getRecurringTask("GmailLabelSync").forceUpdate(e)}_syncOfflineChanges(){try{i.default.PAssert(1404,!1,"Currently we do not perform a sync offline step for Gmail changes")}catch(e){i.default.reportError(e)}this._syncingOfflineChanges||(this._syncingOfflineChanges=!0)}_cleanupLocalCaches(e){try{i.default.PAssert(1405,i.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(l){i.default.reportError(l)}var t=0,a=0,r=this._getFullSyncTime(),s=this._getUnreadSyncTime(),n=this._getMetadataSyncTime(),o=e=>e&&e.date&&e.date.isBefore(r);this._threadCache.getFilterEntries(o).then(r=>{if(r)for(var o=0,l=0;l<r.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=r[l],h=!0;if(!d.date.isBefore(s)){var c=0;for(let e=0;h&&e<d.messages.length;++e){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;let t=d.messages[e];if(this.isPriorityData(t)){h=!1;break}}}if(h){var u=0;d.date.isBefore(n)&&(this._threadCache.removeEntry(d.id),t++);for(let e=0;e<d.messages.length;++e){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;let t=d.messages[e];this._rawCache.removeEntry(t.id),a++}}}i.default.log("Gmail Cache Pruned: ",t,a),e(!1)})}_cleanupRawCache(e){try{i.default.PAssert(1406,i.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(s){i.default.reportError(s)}var t=0,a=this._getUnreadSyncTime(),r=e=>!e.internalDate||new Date(parseInt(e.internalDate)).isBefore(a);this._rawCache.getFilterEntries(r).then(a=>{if(a)for(var r=0,s=0;s<a.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=a[s];this._rawCache.removeEntry(n.id),t++}i.default.log("Raw Cache Pruned: ",t),e()})}getAccountSetting(e,t){var a,i=this._getAccountLib(e,this._accountSettings);return i&&(a=i[t]),a}setAccountSetting(e,t,a){var i,r=this._ensureAccountLib(e,this._accountSettings);return i=r[t],r[t]=a,i}runSettingsSync(){this._getSettingsSendAs(e=>{for(var t in e)e.hasOwnProperty(t)&&this.setAccountSetting(t,"sendAs",e[t]);this._writeSendAsToCache()})}_getSyncDays(){var e=this.getSetting(this.Settings.SyncTime);Wr.billingManager.isTrialOver()&&(e=r.a.MaxGmailSyncTime.Free);var t=Wr.pluginManager.getCacheSizeRatio();return t<1&&t>0&&(e=Math.round(e*t)),e}_getMetadataSyncDays(){var e=Math.max(this.getSetting(this.Settings.SyncTime),15),t=Wr.pluginManager.getCacheSizeRatio();return t<.5&&(e=Math.max(Math.round(e*t),7)),e}_getUnreadSyncTime(){var e=this._getSyncDays();return(new Date).addDays(-1.5*e)}_getFullSyncTime(){var e=this._getSyncDays();return(new Date).addDays(-e)}_getMetadataSyncTime(){var e=this._getMetadataSyncDays();return(new Date).addDays(-e)}_getFullSyncTimeStr(){return this._getSyncDays()+"d"}_getMetadataSyncTimeStr(){return this._getMetadataSyncDays()+"d"}runThreadSync(e){var t,a=0,s=0,n=[],o=[],l=(l,d,h)=>{l?(a++,n.push(d)):(s++,!i.default.isHTTPStatusCode(h,r.a.HTTPStatusCode.Network)&&this.isOnline()&&o.push(d)),s+a===t&&(o.length>0?Wr.toasts.pushMessage(r.a.MessageID.EmailSyncFail):Wr.toasts.clearMessage(r.a.MessageID.EmailSyncFail),n.length>0&&this._contentSyncTask.requestRun(),e&&e(0===o.length))},d=!1,h=this._getSyncDays();void 0!==this._lastSyncTime&&this._lastSyncTime<h&&(d=!0,i.default.log("Forcing full gmail sync")),this._lastSyncTime=h;let c=this._threadCache.getMetadata(ra);var u=this.getSyncAccounts();t=u.length,u.forEach(e=>{var t;if(!d){var a=c?c[e]:void 0;t=a?a.historyID:void 0}re.a.getAccountAuthToken(e,this.googleScopes(),a=>{a&&this.performThreadSync(e,t,l)})})}syncAllAccountsFull(e){this._lastSyncTime=0,this.runThreadSync(e)}performThreadSync(e,t,a){t?(Date.now()-this._lastCacheCleanup>i.default.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(e,t,a)):this._performThreadSyncFull(e,a)}_performThreadSyncFull(e,t){var a,r="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),s=this.getDefaultItemStore(),n=this._ensureVMLIsForAccount(e,s);n.clearPaginationToken();var o=new wt(t=>{if(t&&(!a&&t.historyId&&(a=t.historyId,this.setHistoryID(e,a)),this._shouldCacheThread(t))){var i=this._addRemoteEntry(e,t);this.cacheThreadData(i.id,this.serializeExternalData(i))}},a=>{t(a,e)});this._requestRemoteThreads(e,Bt,n,r,999,0,o.getEntryCB(),o.getDoneCB()),this.runLabelSync(()=>{let t=this._getLabelByName(e,"Moo.do/Handled",!0);t&&this._getThreadsForLabel(e,t,void 0,!0,e=>{try{i.default.PAssert(1407,e,"Expect to be able to get all handled messages")}catch(t){i.default.reportError(t)}}),this._getThreadsForLabel(e,this._getLabelByID(e,oa.UNREAD),void 0,!1,e=>{try{i.default.PAssert(1408,e,"Expect to be able to get all unread messages")}catch(t){i.default.reportError(t)}})})}_compactHistoryEntries(e){for(var t=0,a={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e[r],n=0;if(s.messagesAdded){var o=0;for(let e=0;e<s.messagesAdded.length;++e){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;let t=s.messagesAdded[e].message,i=a.messagesAdded[t.threadId];i||(i=a.messagesAdded[t.threadId]=[]),i.indexOf(t.id)<0&&i.push(t.id)}n+=s.messagesAdded.length}if(s.messagesDeleted){var l=0;for(let e=0;e<s.messagesDeleted.length;++e){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;let t=s.messagesDeleted[e].message,i=a.messagesDeleted[t.threadId];i||(i=a.messagesDeleted[t.threadId]=[]),i.indexOf(t.id)<0&&i.push(t.id)}n+=s.messagesDeleted.length}if(s.labelsAdded){var d=0;for(let e=0;e<s.labelsAdded.length;++e){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;let t=s.labelsAdded[e].message,i=a.labelsAdded[t.threadId];i||(i=a.labelsAdded[t.threadId]={}),i[t.id]||(i[t.id]=[]),i[t.id].pushOnlyUniques(s.labelsAdded[e].labelIds)}n+=s.labelsAdded.length}if(s.labelsRemoved){var h=0;for(let e=0;e<s.labelsRemoved.length;++e){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;let t=s.labelsRemoved[e].message,i=a.labelsRemoved[t.threadId];i||(i=a.labelsRemoved[t.threadId]={}),i[t.id]||(i[t.id]=[]),i[t.id].pushOnlyUniques(s.labelsRemoved[e].labelIds)}n+=s.labelsRemoved.length}try{i.default.PAssert(1409,0===n||n===s.messages.length,"Must have handled all or none of the generic messages")}catch(p){i.default.reportError(p)}if(0===n){var c=0;for(let e=0;e<s.messages.length;++e){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;let t=s.messages[e],i=a.messages[t.threadId];i||(i=a.messages[t.threadId]=[]),i.indexOf(t.id)<0&&i.push(t.id)}}}var u={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(let i in a.messages)a.messages.hasOwnProperty(i)&&u.messages.push({id:i,msgIDs:a.messages[i]});for(let i in a.messagesAdded)a.messagesAdded.hasOwnProperty(i)&&!a.messages[i]&&u.messagesAdded.push({id:i,msgIDs:a.messagesAdded[i]});for(let i in a.messagesDeleted)a.messagesDeleted.hasOwnProperty(i)&&!a.messages[i]&&u.messagesDeleted.push({id:i,msgIDs:a.messagesDeleted[i]});for(let i in a.labelsAdded)if(a.labelsAdded.hasOwnProperty(i)&&!a.labelsAdded[i])for(let e in a.labelsAdded[i])a.labelsAdded[i].hasOwnProperty(e)&&u.labelsAdded.push({id:i,msgID:e,labelIDs:a.labelsAdded[i][e]});for(let i in a.labelsRemoved)if(a.labelsRemoved.hasOwnProperty(i)&&!a.messages[i])for(let e in a.labelsRemoved[i])a.labelsRemoved[i].hasOwnProperty(e)&&u.labelsRemoved.push({id:i,msgID:e,labelIDs:a.labelsRemoved[i][e]});return u}_performThreadSyncPartial(e,t,a){var s=pe.a.fns("gmail").users.history.list.packedFn,n={userId:e,startHistoryId:t},o={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},l=(e,t)=>{i.default.log("History Sync Request Failed: ",e,t)};this._queuePagedRemoteRequestMulti(e,s,n,(t,i,r)=>{var s;r&&(s=r.historyId,this.setHistoryID(e,s)),Wr.PaneUpdateBatcher.beginUpdateItems();var n=this._compactHistoryEntries(t);this._handleCompactHistory(e,n,l),Wr.PaneUpdateBatcher.commitUpdateItems(),a(!0,e)},t=>{t&&t.error&&t.error.code===r.a.HTTPStatusCode.NotFound?this._clearCachedData(e,i=>{i?this.performThreadSync(e,void 0,a):a(!1,e,t)}):(a(!1,e,t),this._notifyFailedRequest(e,t))},void 0,Ut,o)}_handleCompactHistory(e,t,a){var i=0,r=0,s=0,n=0,o=0,l=0;for(let u=0;u<t.messages.length;++u){var d=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;let r=t.messages[u];for(let t=0;t<r.msgIDs.length;++t){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;this._handleMessageUpdated(e,r.id,r.msgIDs[t],a),l++}}for(let u=0;u<t.messagesAdded.length;++u){var h=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;let i=t.messagesAdded[u];for(let t=0;t<i.msgIDs.length;++t){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;this._handleMessageAdded(e,i.id,i.msgIDs[t],a),l++}}for(let u=0;u<t.messagesDeleted.length;++u){var c=0;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;let a=t.messagesDeleted[u];for(let t=0;t<a.msgIDs.length;++t){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;this._handleMessageDeleted(e,a.id,a.msgIDs[t]),l++}}for(let u=0;u<t.labelsAdded.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;let a=t.labelsAdded[u];this._handleLabelsAdded(e,a.id,a.msgID,a.labelIDs),l++}for(let u=0;u<t.labelsRemoved.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;let a=t.labelsRemoved[u];this._handleLabelsRemoved(e,a.id,a.msgID,a.labelIDs),l++}return l}_handleMessageAdded(e,t,a,i){this.refreshThreadCacheData(e,t,a,i)}_handleMessageDeleted(e,t,a){this._deleteCachedMessage(e,t,a)}_handleLabelsAdded(e,t,a,i){this.addLabelsToMessage(e,t,a,i,r.a.ChangeType.Remote)}_handleLabelsRemoved(e,t,a,i){this.removeLabelsFromMessage(e,t,a,i,r.a.ChangeType.Remote)}_handleMessageUpdated(e,t,a,i){this.refreshThreadCacheData(e,t,a,i)}getLastSyncTime(e){let t=this._threadCache.getMetadata(ra);var a;if(t){var i=t[e];i&&i.date&&(a=new Date(i.date))}return a}getAllLastSyncTimes(){var e=0;let t=this._threadCache.getMetadata(ra);for(var a={},i=this.getSyncAccounts(),r=0;r<i.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=i[r],n=t?t[s]:void 0;n&&n.date?a[s]=new Date(n.date):a[s]=void 0}return a}setHistoryID(e,t){try{i.default.PAssert(1411,i.default.isString(e),"Must provide a valid account ID to set history ID")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1412,i.default.isString(t),"Must provide a valid history ID to set")}catch(r){i.default.reportError(r)}let a=Object.assign({},this._threadCache.getMetadata(ra));a[e]={historyID:t,date:Date.now()},this._threadCache.setMetadata(ra,a)}clearHistoryID(e){try{i.default.PAssert(1413,i.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(a){i.default.reportError(a)}let t=this._threadCache.getMetadata(ra);t&&(delete t[e],this._threadCache.setMetadata(ra,t))}clearCachedLabel(e){try{i.default.PAssert(1414,i.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(a){i.default.reportError(a)}let t=this._threadCache.getMetadata(sa);t&&(delete t[e],this._threadCache.setMetadata(sa,t))}_clearCachedData(e,t){this.clearHistoryID(e),this.clearCachedLabel(e),this.clearAccountThreadCache(e,t)}clearAccountThreadCache(e,t){try{i.default.PAssert(1415,i.default.isString(e),"Must provide a valid account ID to clear thread cache for")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1416,!t||i.default.isFunction(t),"Must provide valid CB function when clearing thread cache")}catch(r){i.default.reportError(r)}var a=t=>t.accountID===e;this._threadCache.getFilterEntries(a).then(a=>{if(a){var r=0;i.default.log("Clearing account thread cache: "+e);for(var s=0;s<a.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=a[s];if(this._threadCache.removeEntry(n.id),n.messages)for(var o=0,l=0;l<n.messages.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;this._rawCache.removeEntry(n.messages[l].id)}}t&&t(!0)}else t&&t(!1)})}requestDataPage(e,t){i.default.log("Data Page: ",e.hasPaginationToken()),e.hasPaginationToken()&&!e.paginationTokenInUse()&&e?this._requestRemoteThreads(void 0,zt,e,void 0,25,void 0,void 0,t):t(!0)}_requestRemoteThreads(e,t,a,r,s,n,o,l){var d;if(a&&a.hasPaginationToken()&&!a.paginationTokenInUse()){d=a.beginDataPageLoad();try{i.default.PAssert(1419,!r,"Should not define a new q for paged token")}catch(f){i.default.reportError(f)}try{i.default.PAssert(1420,!o,"Should not define a new entryCB for paged token")}catch(f){i.default.reportError(f)}if(r=d.getQuery(),s=d.getMaxResults(),o=d.getEntryCB(),l){var h=l;l=(...e)=>{d.getDoneCB().apply(null,e),h.apply(null,e)}}else l=d.getDoneCB();e=e||d.getInfo().accountID}else a&&a.needsPaginationToken()&&(d=this.createPaginationToken(void 0,r,{accountID:e},s,o,l),a.setPaginationToken(d),a.beginDataPageLoad());s=s||25;try{i.default.PAssert(1421,o&&i.default.isFunction(o),"Must define a valid entry callback")}catch(f){i.default.reportError(f)}try{i.default.PAssert(1422,l&&i.default.isFunction(l),"Must define a valid done callback")}catch(f){i.default.reportError(f)}var c,u,p=pe.a.fns("gmail").users.threads.list.packedFn,g={userId:e,maxResults:s,timeoutMS:n,q:r,pageToken:d&&d.hasMorePages()?d.getNextPageToken():void 0};d||!a?(c=t=>{if(t.nextPageToken&&d&&this.updatePaginationToken(d,t.nextPageToken),a&&d&&a.endDataPageLoad(!!t.nextPageToken),t.threads)for(var i=0,r=t.threads.length,s=0,n=0,h=e=>{e?(o(e),s++):(o(void 0),n++),s+n===r&&l(!0)},c=0;c<t.threads.length;++c){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=t.threads[c];this._requestRemoteThreadMetadata(e,u.id,void 0,h)}else l(!0)},u=t=>{a&&d&&a.endDataPageLoad(d),l(!1),this._notifyFailedRequest(e,t)}):(c=()=>{l(!0)},u=t=>{l(!1),this._notifyFailedRequest(e,t)}),this._queueRemoteRequestMulti(e,p,g,c,u,void 0,t)}_requestRemoteMessageData(e,t,a){try{i.default.PAssert(1423,!e.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment")}catch(n){i.default.reportError(n)}var r=pe.a.fns("gmail").users.messages.get.packedFn,s={userId:e.getField("accountID"),id:t,format:"full"};this._queueRemoteRequestMulti(e.getField("accountID"),r,s,async r=>{var s=await this._parseMailMessage(r);try{i.default.PAssert(1424,s,"Must be able to parse message")}catch(n){i.default.reportError(n)}this._updateMessageData(e,t,s),a(!0)},t=>{a(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)},void 0,aa)}_requestRemoteMessageDataRaw(e,t,a,i,s){var n=pe.a.fns("gmail").users.messages.get.packedFn,o={userId:e,id:a,format:"full"},l=t=>{s(void 0,t),this._notifyFailedRequest(e,t)},d=a=>{a&&this._handleContentSyncdMessage(e,t,a),s(a)};re.a.getAccountAuthToken(e,[r.a.GScope.GmailModify],t=>{t?this._queueRemoteRequestMulti(e,n,o,d,l,void 0,aa,{priority:i?r.a.RequestPriority.UserBlocking:r.a.RequestPriority.Default}):s(!1,!1,"This thread belongs to an account ("+e+") you are not authorized to access.")})}_requestRemoteThreadDataRaw(e,t,a){var i=pe.a.fns("gmail").users.threads.get.packedFn,r={userId:e,id:t,format:"full"};this._queueRemoteRequestMulti(e,i,r,a,t=>{a(void 0,t),this._notifyFailedRequest(e,t)},void 0,Ht)}_requestRemoteThreadMetadata(e,t,a,i){var r=pe.a.fns("gmail").users.threads.get.packedFn,s={userId:e,id:t,format:"metadata"};this._queueRemoteRequestMulti(e,r,s,e=>{i(e)},t=>{i(void 0,t),this._notifyFailedRequest(e,t)},a,Vt)}_persistRemoteSnoozeTask(e,t){e.getData()}_cancelDeferredSnoozeTask(e,t){e.getData()}_persistRemoteSendMailTask(e,t){e.getData()}_cancelDeferredSendMailTask(e,t){e.getData()}_handleRemotePersist(e,t){if(t.status!==r.a.HTTPStatusCode.Success)return e(!1);try{return e(!0,JSON.parse(t.response).data.messageID)}catch(a){return i.default.reportError(a),e(!1)}}async _parseMailThread(e,t){var a=[];await Promise.all(t.messages.map(async e=>{var t=await this._parseMailMessage(e);try{i.default.PAssert(1425,t,"Must be able to parse each message")}catch(r){i.default.reportError(r)}t&&a.push(t)}));var s=e.getField("messages");this._mergeMessagesData(s,a,["labelIds","draftID"]),e.updateField("dataLoaded",!0),e.updateField("messages",a),this._updateAttachmentFromMessages(e,r.a.ChangeType.Remote)}getAttachmentURL(e,t,a){return"https://mail.google.com/mail/b/"+e+"/?ui=2&view=att&disp=safe&zw"+("&th="+t)+("&attid="+a)}getPreviewURL(e){return e.link}reportMessage(e,t,a,r,s){var n=pe.a.fns("gmail").users.messages.get.packedFn,o={userId:e,id:a,format:"full",forceNoDupe:!0};this._queueRemoteRequestMulti(e,n,o,this._sendReport.bind(this,s,r),()=>{try{i.default.PAssert(1426,!1,"Failed to report message")}catch(e){i.default.reportError(e)}},void 0,aa)}dumpMessage(e,t,a){var i=this.getAttachment(t),r=this._getMessageFromAttachment(i,a);console.log("Message Dump: ",r)}async _sanitizeMessage(e){if(e.parts&&await Promise.all(e.parts.map(e=>this._sanitizeMessage(e))),e.body&&e.body.data){var t=this._runDecodeEmail(e);let a;t&&t.mimeType===Ea?a=await vt.a.sanitizeContent(t.decoded):e.body.data=this._encodeEmail(vt.a.sanitizePlaintext(t.decoded)),e.body.data=this._encodeEmail(a)}if(e.headers){var a=0;for(let t=0;t<e.headers.length;++t){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e.headers[t];switch(i.name.toUpperCase()){case"TO":case"CC":case"BCC":case"FROM":i.value=i.value.replace(/[A-Za-z0-9]/g,"#");break;case"SUBJECT":case"SNIPPET":i.value=new Array(i.name.length+1).join("#")}}}}async _sendReport(e,t,a){try{i.default.PAssert(1427,i.default.isBoolean(e),"Must provide a valid boolean for sendContent")}catch(s){i.default.reportError(s)}try{i.default.PAssert(1428,i.default.isString(t),"Must provide a valid description string")}catch(s){i.default.reportError(s)}try{i.default.PAssert(1429,i.default.isObject(a),"Must provide valid raw data")}catch(s){i.default.reportError(s)}try{i.default.log("Sending Message Report",a),e||await this._sanitizeMessage(a.payload);var r={description:t,payload:a.payload};i.default.reportError(new Error("Report Message"),r)}catch(n){i.default.reportError(n)}}loadResource(e,t,a,i){if(this.hasCacheData(e)){var r=this.getAttachment(e),s=this._getMessageFromAttachment(r,t).resources[a];s?(s.data?i(s,a):this._requestRemoteAttachment(r.getField("accountID"),t,s.id,(e,t)=>{e&&(s.data=e,s.size=t),i(s,a)}),this.sendEvent("FetchAttachment")):i(void 0,a)}else i(void 0,a)}_requestRemoteAttachment(e,t,a,i){var r=pe.a.fns("gmail").users.messages.attachments.get.packedFn,s={id:a,messageId:t,userId:e};this._queueRemoteRequestMulti(e,r,s,e=>{i(e.data.replace(/-/g,"+").replace(/_/g,"/"),e.size)},t=>{i(void 0),this._notifyFailedRequest(e,t)},void 0,ta)}_parseAttachment(e,t,a){try{i.default.PAssert(1430,e,"Must have valid multipart lib")}catch(m){i.default.reportError(m)}try{i.default.PAssert(1431,a.body,"Must have a valid attachment body")}catch(m){i.default.reportError(m)}try{i.default.PAssert(1432,a.body.attachmentId,"Must have a valid attachment ID")}catch(m){i.default.reportError(m)}var r,s,n,o,l,d="0."+a.partId;if(a.headers)for(var h=0,c=0;c<a.headers.length;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var u=a.headers[c];switch(u.name.toUpperCase()){case"CONTENT-ID":var p=/^<(.*)>$/.exec(u.value);s=r=p?p[1]:u.value;break;case"CONTENT-TRANSFER-ENCODING":l=u.value;break;case"CONTENT-DISPOSITION":var g=u.value.split(";");o=g[0]?g[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":n=u.value}}r&&o!==la.Attachment||!a.filename?!r&&a.body.attachmentId&&(r=a.body.attachmentId):r=a.filename;try{i.default.PAssert(1433,r,"Must be able to find a valid resource ID")}catch(m){i.default.reportError(m)}var f={cid:r,rawContentID:s,id:a.body.attachmentId,attID:d,realAttrID:n,data:void 0,size:a.body.size,uploader:void 0,disposition:o,parentType:t.mimeType,mimeType:a.mimeType,contentEncoding:l};e[f.cid]=f}_decodeFlowed(e,t){return e.split(/\r?\n/).reduce((e,a,i)=>{var r=e;return t&&(r=r.replace(/[ ]+$/,"")),/ $/.test(e)&&!/(^|\n)\-\- $/.test(e)||1===i?r+a:r+"\n"+a}).replace(/^ /gm,"")}_decodeEmail(e,t,a){try{i.default.PAssert(1434,i.default.isString(e),"Passing in an invalid string to decode")}catch(s){i.default.reportError(s)}var r;if(e)try{r=i.default.b64_to_utf8(e),"FLOWED"===a.format&&(r=this._decodeFlowed(r,a.delSp))}catch(n){i.default.reportError(n)}return r}_encodeEmail(e){var t;try{t=i.default.utf8_to_b64(e)}catch(a){i.default.reportError(a)}return t}_runDecodeEmail(e){try{i.default.PAssert(1435,e&&e.body,"Must pass in a valid part")}catch(o){i.default.reportError(o)}var t,a=this._getHeader(e,"Content-Transfer-Encoding"),r=!1;if(xa.indexOf(e.mimeType)>=0)return{decoded:t=this._generateMessageDisplayNode(e),mimeType:Ea,contentType:"text/html;charset=utf-8",name:"GeneratedContent",hasError:r};var s=this._getHeader(e,"Content-Type")||"text/html;charset=utf-8";try{i.default.PAssert(1436,s,"Must have a valid contentType")}catch(o){i.default.reportError(o)}var n=this._sanitizeContentType(s);return e.body&&e.body.data?t=this._decodeEmail(e.body.data,a,n):e.body&&e.body.attachmentId?t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>':(t="Unable to decode email content",r=!0),{decoded:t,mimeType:e.mimeType,contentType:n.type,name:n.name,hasError:r}}_runDecodeMessage(e){var t=this._decodeMessagePart(e);return 0===t.length&&e?Ta.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:xa.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:[]:t}_decodeMessagePart(e){var t=[];if(e)if(e.mimeType===va||e.mimeType===ya||e.mimeType===ma){var a=0;for(let i=0;i<e.parts.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let r=this._decodeMessagePart(e.parts[i]);t.pushArray(r)}}else if(e.mimeType===fa||e.mimeType===ga||e.mimeType===ga||e.mimeType===Sa){var i=0;for(let a=e.parts.length-1;a>=0;a--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this._isValidDisplayPart(e.parts[a])){let i=this._decodeMessagePart(e.parts[a]);if(i.length>0){t.pushArray(i);break}}}}else this._isValidDisplayPart(e)&&t.push(this._runDecodeEmail(e));return t}async _combineMessageParts(e){var t="",a=wa,i="text/html;charset=utf-8",r=!1;if(e&&e.length>0){var s=0;a=e[0].mimeType,i=e[0].contentType,e.length;for(var n=0;n<e.length;++n){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;La.indexOf(e[n].mimeType)<0&&(r=!0)}t=await vt.a.combineParts(e)}else t=" ";return a===wa&&(a=Ea,i=Ea+";charset="+i.split(";charset=")[1]),{decoded:t,mimeType:a,contentType:i,reportMessage:r}}_isValidDisplayPart(e){var t=!1;return!this._isResourcePart(e)&&Ta.indexOf(e.mimeType)>=0&&(t=!0),t}_isResourcePart(e){var t=!1;return e.filename?t=!0:this._getHeader(e,"CONTENT-ID")&&(this._getHeader(e,"CONTENT-DISPOSITION")||Ta.indexOf(e.mimeType)<0)&&(t=!0),t}_parseMessagePart(e,t){var a=0,r=0,s={parent:t,raw:e,mimeType:e.mimeType,children:[],resources:[]};switch(e.mimeType){case wa:case Ea:case Pa:break;case ga:case ma:case Ia:case fa:case _a:case ya:case ba:case va:for(let t=0;t<e.parts.length;++t){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e.parts[t];let i=this._parseMessagePart(n,s);this._isResourcePart(n)?s.resources.push(i):s.children.push(i)}break;case Sa:for(let t=0;t<e.parts.length;++t){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;let a=this._parseMessagePart(e.parts[t],s);s.children.push(a)}break;default:var o=e.mimeType.split("/")[0];Ma.indexOf(o)<0&&(i.default.log("Unknown Part Mimetype: ",e),i.default.reportError(new Error("Unknown attachment mimetype: "+e.mimeType)))}return s}_getMessageDisplay(e,t){var a=0;switch(e.mimeType){case wa:case Ea:case va:case ya:case _a:t.push(e);break;case fa:case ga:case Sa:case ma:for(var r=0;r<e.children.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._getMessageDisplay(e.children[r],t)}break;case Ca:case Aa:break;case Ia:case Da:case ba:t.push(e);break;default:try{i.default.PAssert(1437,!1,"Should never have an unknown multipart mimetype in the tree: ",e.mimeType)}catch(s){i.default.reportError(s)}}}_getResourcesForNode(e,t){for(var a=0,i=e.resources,r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i[r].raw;this._parseAttachment(t,e,s)}e.raw&&e.raw.body&&e.raw.body.attachmentId&&this._parseAttachment(t,e.parent,e.raw)}_getResourcesForPart(e){var t=0,a={};if(e.mimeType===va||e.mimeType===ya)for(var i=0,r=0;r<e.children.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._getResourcesForNode(e.children[r],a)}for(;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._getResourcesForNode(e,a),e=e.parent}return a}_displayAttachment(e,t){var a=!1;return e.cid===t&&(e.disposition===la.Attachment?a=!0:e.disposition===la.Inline&&e.parentType===va&&(a=!0)),a}getMessageAttachments(e){var t=[];return i.default.forEachValue(e.resources,e=>{this._displayAttachment(e,e.cid)&&t.push(e)}),t}async getMessageDisplayAttachments(e){var t,a=0,i=this.getMessageAttachments(e);if(e.initializedForDisplay)t=e.specialLinks?e.specialLinks.attachments:[];else{var r={ignoreQuotedAttachments:!!(e.labelIds.indexOf(oa.DRAFT)>=0)};t=await vt.a.getAttachmentLinks(e.decoded,r)}for(var s=0;s<t.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[s];if(!e.resources[n.name]){var o=this._createResource(e.resources,n);o.link=n.href,i.push(o)}}return i}_verifyDKIM(e){var t;if(e)for(var a=0,i=e.split(";"),r=/([a-z]+)[=](.*)/i,s=0;s<i.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=i[s].trim();if(n){var o=r.exec(n);if(o)switch(t={},o[1]){case"d":t.domain=o[2];break;case"h":t.headers=o[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return t}_sanitizeContentType(e){var t="text/html;charset=utf-8";try{var a,r,s,n,o=0,l=e.replace(/[\"\']/g,"").split(";"),d=l[0].trim().toLowerCase();try{i.default.PAssert(1438,d===wa||d===Ea,"Unknown ContentType MediaType: "+d)}catch(f){i.default.reportError(f)}for(var h=1;h<l.length;++h){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=l[h].trim();if(c){var u=c.indexOf("=");if(u>=1){var p=c.substr(0,u).trim(),g=c.substr(u+1).trim();if(p&&g)switch(p.toUpperCase()){case"CHARSET":a=g;break;case"FORMAT":r=g.toUpperCase();break;case"DELSP":s="YES"===g.toUpperCase();break;case"NAME":n=g;break;case"BOUNDARY":break;default:try{i.default.PAssert(1439,!1,"Unknown param in ContentType: "+c)}catch(f){i.default.reportError(f)}}else try{i.default.PAssert(1440,!1,"Malformed contentType part: ",e)}catch(f){i.default.reportError(f)}}else try{i.default.PAssert(1441,!1,"Invalid contentType part: ",e)}catch(f){i.default.reportError(f)}}}a||(a="utf-8"),d&&a&&(t=d+";charset="+a)}catch(m){i.default.reportError(m)}return{type:t,format:r,delSp:s,name:n}}_getHeader(e,t){var a;if(e&&e.headers)for(var i=0,r=0;r<e.headers.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.headers[r].name.toUpperCase()===t.toUpperCase()){a=e.headers[r].value;break}}return a}_generateMessageDisplayNode(e){try{i.default.PAssert(1443,xa.indexOf(e.mimeType)>=0,"Must be a valid mimeType to generate content from")}catch(r){i.default.reportError(r)}var t;if(e.body&&e.body.attachmentId)t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>';else{var a;switch(e.mimeType){case Da:case ba:case va:a="&nbsp;";break;case Ia:a="Unable to display encrypted message content.";break;default:a="Unable to display unknown content type: "+e.mimeType}t="<html><body>"+a+"</body></html>"}return t}async _parseMailMessage(e){try{return await this._parseMailMessageInternal(e)}catch(t){i.default.reportError(t)}}async _parseMailMessageInternal(e){var t=0,a=e.payload,r=!!a.body&&a.body.size>0;try{i.default.PAssert(1444,r!==a.mimeType.startsWith("multipart/")||a.mimeType===ma,"Checking the body size should be the same as checking whether this is a multipart message")}catch(_){i.default.reportError(_)}this._verifyDKIM(this._getHeader(e.payload,"DKIM-Signature"));for(var s,n,o=e.payload.headers,l=0;l<o.length;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var d=o[l];switch(d.name.toUpperCase()){case"FROM":e.from=this.parseEmailAddress(d.value);break;case"REPLY-TO":e.replyTo=this.parseEmailAddress(d.value);break;case"TO":e.to=this.parseEmailAddresses(d.value);break;case"CC":e.cc=this.parseEmailAddresses(d.value);break;case"BCC":e.bcc=this.parseEmailAddresses(d.value);break;case"SUBJECT":e.subject=d.value;break;case"DATE":e.date=this.parseDateHeader(d.value);try{i.default.PAssert(1445,i.default.isDateValid(e.date),"Must have a valid message date: ",e.date)}catch(_){i.default.reportError(_)}break;case"MESSAGE-ID":e.messageID=d.value;break;case"REFERENCES":e.references=d.value;break;case"IN-REPLY-TO":e.inReplyTo=d.value;break;case"LIST-UNSUBSCRIBE":e.listUnsubscribe=d.value}}if(e.messageID||(e.messageID=i.default.generateTempId()),r)n=a;else{var h,c=0,u=this._parseMessagePart(a),p=[];this._getMessageDisplay(u,p);for(var g=p.length-1;!h&&g>=0;g--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(Ta.indexOf(p[g].mimeType)>=0)h=p[g];else if(xa.indexOf(p[g].mimeType)>=0)h=p[g];else{i.default.log("Unknown bestNode mimepart: ",p[g]);try{i.default.PAssert(1446,!1,"Unknown mimePart display type: ",p[g].mimeType)}catch(_){i.default.reportError(_)}}}h?(s=this._getResourcesForPart(h),n=h.raw):await this._sendReport(!1,"Missing bestNode",e)}try{i.default.PAssert(1447,n,"Must have found a valid message part to display")}catch(_){i.default.reportError(_)}var f=this._runDecodeMessage(n);try{i.default.PAssert(1448,f.length>0,"Should have at least one decoded message part available")}catch(_){i.default.reportError(_)}if(0===f.length)try{var m=JSON.parse(JSON.stringify(e));await this._sendReport(!0,"No valid decoded part",m)}catch(S){i.default.reportError(S)}var v=await this._combineMessageParts(f);if(v){var y={id:e.id,labelIds:e.labelIds,messageID:e.messageID,decoded:v.decoded,mimeType:v.mimeType,contentType:v.contentType,from:e.from,to:e.to||[],cc:e.cc,bcc:e.bcc,snippet:e.snippet,subject:e.subject||"",date:e.date,internalDate:e.internalDate?i.default.isDateValid(e.internalDate)?e.internalDate:new Date(i.default.parseInt(e.internalDate)):new Date,references:e.references,inReplyTo:e.inReplyTo,listUnsubscribe:e.listUnsubscribe,resources:s||{}};return v.reportMessage&&await this._sendReport(!1,"Mismatch mimeType/contentType",e),y}}parseEmailAddress(e){Ra.lastIndex=0;var t=Ra.exec(e),a={};if(t){var i=Oa.exec(t[1]);a.text=i?i[1]:t[1],a.email=t[2]}else a.email=e;return a.email&&(a.email=a.email.replace(/[\r\n]/g,"")),a.text&&(a.text=a.text.replace(/[\r\n]/g,"")),a}parseEmailAddresses(e){for(var t=0,a=[],r=i.default.parseEmailAddresses(e),s=0;s<r.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=r[s];"contact"===n.type&&n.email&&a.push(n)}return a}parseDateHeader(e){var t=new Date(e);return i.default.isDateValid(t)||(t=Wr.International.parseDate(e,r.a.DateFormat.MDY)),t}runRemoteSearch(e,t,a,s){try{i.default.PAssert(1450,e,"Must provide a valid search")}catch(y){i.default.reportError(y)}try{i.default.PAssert(1451,t,"Must provide a valid pane")}catch(y){i.default.reportError(y)}try{i.default.PAssert(1452,a,"Must provide a valid bucket ID")}catch(y){i.default.reportError(y)}try{i.default.PAssert(1453,i.default.isFunction(s),"Must provide a valid search callback")}catch(y){i.default.reportError(y)}var n="-in:chats -in:spam "+e,o=Wr.PaneManager.getPaneById(t),l=this._getAccountIDFromItem(o.getItem())||this.getDefaultAccount(),d=!1,h=0,c=0,u=new Ce(e,25,this.requestDataPage.bind(this)),p=e=>{if(h===c&&d){i.default.log("Done Searching: ",h);var n=e?r.a.SearchResultStatus.Error:h>0?r.a.SearchResultStatus.Done:r.a.SearchResultStatus.None;u.isValid()&&this.swapInSearchBucket(a,t),s(n)}},g=e=>{if(h++,e){var t=this._addRemoteEntry(l,e),i=this.getBucketItemStore(a);this._ensureVMLIsForSearchResult(t,i),c++}else c++;p()},f=e=>{d=!0,p(!e)},m=!1,v=new wt(u.onEntry,e=>{u.onDone(e),m||(m=!0,u.isValid()&&u.hasResults()?u.getNextPage(g,f):f(e))});return this._requestRemoteThreads(l,jt,void 0,n,25,void 0,v.getEntryCB(),v.getDoneCB()),u}_addSearchCacheEntryInternal(e,t,a){var i=!1,r=this._ensureAccountLib(e,this._emailCache);return r[t]||(r[t]={}),r[t][a]||(r[t][a]=!0,i=!0),i}_removeSearchCacheEntryInternal(e,t,a){var i,r=this._getAccountLib(e,this._emailCache);return r&&r[t]&&(i=r[t][a],delete r[t][a]),i}_getSearchCacheLabelEntryInternal(e,t){var a,i=this._getAccountLib(e,this._emailCache);return i&&i[t]&&(a=i[t]),a}_addEmailToSearchCache(e,t){var a=!1;if(t&&i.default.isArray(t.labelIds))for(var r=0,s=0;s<t.labelIds.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a=this._addSearchCacheEntryInternal(t.accountID,t.labelIds[s],e)||a}return a}_removeEmailFromSearchCache(e,t){var a=!1;if(t&&i.default.isArray(t.labelIds))for(var r=0,s=0;s<t.labelIds.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=!!this._removeSearchCacheEntryInternal(t.accountID,t.labelIds[s],e);a=a||n,n&&this._removeThreadLabelVMLI(t.accountID,e,t.labelIds[s])}return a}_addEmailLabelToSearchCache(e,t,a){return this._addSearchCacheEntryInternal(e,a,t)}_removeEmailLabelFromSearchCache(e,t,a){var i=!!this._removeSearchCacheEntryInternal(e,a,t);return i&&this._removeThreadLabelVMLI(e,t,a),i}runLocalItemSearch(e){var t=this.getDescriptorForItem(e.item),a=this._getSearchCacheLabelEntryInternal(t.accountID,t.labelID);if(a)for(var r in a)if(a.hasOwnProperty(r)){var s=this.getCacheData(r);try{i.default.PAssert(1454,s,"Must have valid data for search entry")}catch(o){i.default.reportError(o)}if(s){var n=this._ensureThreadLabelVMLI(s,t.labelID);e.comparator&&!e.comparator(n)||e.each&&e.each(n)}}}getRemoteAttachmentData(e){try{i.default.PAssert(1455,e.hasField("accountID"),"Must have a valid accountID for a thread")}catch(s){i.default.reportError(s)}let t;var a=(a,i)=>{a?this._addRemoteEntry(t,a):(e.notifyDataRequestFailed(),this._notifyFailedRequest(t,i))};e.hasField("accountID")?(t=e.getField("accountID"),this._requestRemoteThreadMetadata(t,e.id,e,a)):this.getSyncAccounts().forEach(i=>{this._requestRemoteThreadMetadata(i,e.id,e,(s,n)=>{s&&(t=i,s.accountID=t,a(s,n),e.notifyDataMutated(["accountID"],r.a.ChangeType.Local))})})}_updateThreadFromMessages(e){var t=0;try{i.default.PAssert(1456,!e.isDeleted||0===e.messages.length,"Should never run an update on a deleted thread with messages")}catch(u){i.default.reportError(u)}var a=e.labelIds,r=Wr.settings.getUserIdentifier();"me"===e.accountID&&"me"!==r&&(e.accountID=r),e.labelIds=[],e.date=void 0,e.participants=[],e.count=e.messages.length,e.snippet=e.count>0?e.messages[e.messages.length-1].snippet:"",e.hasPriority=!1;for(var s=0;s<e.messages.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.messages[s];try{i.default.PAssert(1457,n.id,"Each message must have a valid ID")}catch(u){i.default.reportError(u)}e.labelIds.pushOnlyUniques(n.labelIds);var o=n.labelIds.indexOf(oa.DRAFT)>=0,l=!1;if(n.labelIds.indexOf(oa.SENT)>=0)for(var d=0,h=0;h<n.to.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var c=n.to[h];if(this.isMyAccountID(c.email)){l=!0;break}}else l=!0;(!e.date||n.date&&e.date.isBefore(n.date)&&!o&&l)&&(e.date=n.date),(!e.internalDate||n.internalDate&&e.internalDate.isBefore(n.internalDate))&&(e.internalDate=n.internalDate),n.from&&e.participants.indexOfWithProperty("email",n.from.email)<0&&e.participants.push(n.from),n.resources&&i.default.forEachValue(n.resources,t=>{this._displayAttachment(t,t.cid)&&(e.hasAttachments=!0)})}return e.date=e.date?new Date(e.date):new Date(0),i.default.isDateValid(e.date)||(e.date=new Date(0)),e.internalDate=e.internalDate?new Date(e.internalDate):new Date,i.default.isDateValid(e.internalDate)||(e.internalDate=new Date),e.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):e.date,i.default.isDateValid(e.lastModifiedDate)&&!e.lastModifiedDate.isBefore(e.date)||(e.lastModifiedDate=e.date),e.messages.length>0&&(e.subject=e.messages[0].subject,e.subjectLower=e.subject.toLowerCase(),e.from=e.messages[e.messages.length-1].from,e.to=e.messages[0].to),{labelsAdded:a?e.labelIds.removeArray(a):e.labelIds,labelsRemoved:a?a.removeArray(e.labelIds):void 0}}_updateAttachmentFromMessages(e,t){var a=this._updateThreadFromMessages(e.getData());this._handleThreadLabelUpdates(e.getData(),a.labelsAdded,a.labelsRemoved),e.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],t)}_createRemoteEntry(e,t){for(var a=0,r={id:t.id,accountID:e,messages:[],labelIds:[]},s=0;s<t.messages.length;++s){var n=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t.messages[s];try{i.default.PAssert(1458,o.id,"Message must have a valid id")}catch(c){i.default.reportError(c)}try{i.default.PAssert(1459,!o.labelIds||o.labelIds.indexOf(oa.CHAT)<0,"Should never receive a chat message")}catch(c){i.default.reportError(c)}o.labelIds&&o.labelIds.indexOf(oa.DRAFT)>=0&&this._notifyDraftMessage(e,t.id,o.id);for(var l={id:o.id,messageID:void 0,internalDate:o.internalDate?new Date(i.default.parseInt(o.internalDate)):new Date,snippet:o.snippet,labelIds:o.labelIds||[],to:[],resources:{},subject:""},d=0;d<o.payload.headers.length;++d){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var h=o.payload.headers[d];switch(h.name.toUpperCase()){case"TO":l.to=this.parseEmailAddresses(h.value);break;case"FROM":l.from=this.parseEmailAddress(h.value);break;case"SUBJECT":l.subject=h.value;break;case"MESSAGE-ID":l.messageID=h.value;break;case"IN-REPLY-TO":l.inReplyTo=h.value;break;case"DATE":l.date=this.parseDateHeader(h.value);try{i.default.PAssert(1460,i.default.isDateValid(l.date),"Must have a valid message date: ",h.value)}catch(c){i.default.reportError(c)}}}i.default.isDateValid(l.date)||(l.date=l.internalDate),l.subject||(l.subject=""),l.messageID||(l.messageID=i.default.generateTempId()),r.messages.push(l)}return this._updateThreadFromMessages(r),r}_addRemoteEntry(e,t){var a=this._createRemoteEntry(e,t);if(this.hasCacheData(a.id)){var i=this.getCacheData(a.id);if(i){this._mergeThreadData(i,a);var s=this._updateThreadFromMessages(a);this._handleThreadLabelUpdates(a,s.labelsAdded,s.labelsRemoved)}var n=this.getChangedFields(i,a);if(this.cacheData(a.id,a,!!i,n),this.fieldsHaveParseEffect(n))if(this.hasAttachment(a.id))this.getAttachment(a.id).notifyDataMutated(n,r.a.ChangeType.Remote)}else this.cacheData(a.id,a),this._updateSearchPanes(a,a.labelIds,[]);return a}cacheData(e,t,a,i){this._verifyMessageState(t,!1);var r=this._addEmailToSearchCache(e,t);if(super.cacheData(e,t,a,i),t.messages&&!this._isLoadingLocal&&this._checkUnsyncdMessageContent(t),r){var s=this.getDefaultItemStore();s&&s.updateItems()}return!!t.messages}cacheThreadData(e,t){this._verifyMessageState(t,!0),this._threadCache.saveEntry(t,this.compareCachedData)}compareCachedData(e,t){return this._propertySets[r.a.PluginLoad.Full].some(a=>!i.default.deepEqual(e[a],t[a]))}_verifyMessageState(e,t){}createEntryFromLocal(e,t){var a=0;t.subjectLower=t.subject.toLowerCase(),i.default.isString(t.internalDate)&&(t.internalDate=new Date(t.internalDate)),i.default.isString(t.internalDate)&&(t.internalDate=new Date(t.internalDate)),t.messages=t.messages||[];for(var r=0;r<t.messages.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t.messages[r];i.default.isString(s.date)?s.date=this.parseDateHeader(s.date):s.date||(s.date=new Date),i.default.isString(s.internalDate)?s.internalDate=new Date(s.internalDate):s.internalDate||(s.internalDate=new Date),s.to||(s.to=[]),s.resources?(s.resources=Object.assign({},s.resources),delete s.resources._lib):s.resources={};try{i.default.PAssert(1464,s.draftID||s.messageID||i.default.isTempId(s.id),"Remotely saved messages must have a valid message ID")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1465,i.default.isDateValid(s.date),"Must have a valid message date: ",s.date)}catch(n){i.default.reportError(n)}try{i.default.PAssert(1466,i.default.isDateValid(s.internalDate),"Must have a valid internal message date: ",s.internalDate)}catch(n){i.default.reportError(n)}!i.default.isTempId(s.id)&&!s.draftID&&s.labelIds&&s.labelIds.indexOf(oa.DRAFT)>=0&&this._notifyDraftMessage(t.accountID,e,s.id),s.decoded&&this.reportTrackedStat(Ot)}return this._updateThreadFromMessages(t),t}_updateMessageData(e,t,a){var s=e.getField("messages"),n=s.indexOfWithProperty("id",t);try{i.default.PAssert(1467,n>=0,"Must always be able to find the message being updated")}catch(o){i.default.reportError(o)}n>=0&&(this._mergeMessageData(s[n],a,["labelIds"]),s[n]=a,e.updateField("messages",s),this._updateAttachmentFromMessages(e,r.a.ChangeType.Remote))}_mergeMessageData(e,t,a){try{i.default.PAssert(1468,i.default.isObject(e),"Must pass in a valid old message")}catch(o){i.default.reportError(o)}try{i.default.PAssert(1469,i.default.isObject(t),"Must pass in a valid new message")}catch(o){i.default.reportError(o)}if(e.modifiedOffline){var r=e.modifiedOffline;if(i.default.isArray(r)){var s=0;for(let a=0;a<r.length;++a){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;t[r[a]]=e[r[a]]}}else Object.keys(e).forEach(a=>{t[a]=e[a]}),Object.keys(t).forEach(a=>{t[a]=e[a]});t.modifiedOffline=e.modifiedOffline}for(var n in a&&a.forEach(a=>t[a]=e[a]),e)if(e.hasOwnProperty(n))switch(n){case"snippet":this._pendingDraftUpdates[e.id]&&(t[n]=e[n]);break;default:t.hasOwnProperty(n)||(t[n]=e[n])}}_mergeMessagesData(e,t,a){var r=0;try{i.default.PAssert(1470,i.default.isArray(e),"Must have a valid old messages array")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1471,i.default.isArray(t),"Must have a valid new messages array")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1472,e!==t,"Should not pass in the same array for old and new")}catch(h){i.default.reportError(h)}for(var s=0;s<e.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[s],o=t.indexOfWithProperty("id",n.id);if(o>=0){let e=t[o];try{i.default.PAssert(1473,e,"Must have a valid new message")}catch(h){i.default.reportError(h)}this._mergeMessageData(n,e,a)}else if(n.labelIds.indexOf(oa.DRAFT)>=0)if(i.default.isTempId(n.id)){var l=t.indexOfWithProperty("messageID",n.inReplyTo);try{i.default.PAssert(1474,l>=0,"Must be able to find the message being replied to")}catch(h){i.default.reportError(h)}l>=0&&t.splice(l+1,0,n)}else if(n.inReplyTo){var d=t.indexOfWithProperty("inReplyTo",n.inReplyTo);if(d>=0){let e=t[d];try{i.default.PAssert(1475,e,"Must have a valid new message")}catch(h){i.default.reportError(h)}this._mergeMessageData(n,e,a)}}}}_mergeThreadData(e,t){this.reportTrackedStat(Mt);try{i.default.PAssert(1477,!e.isDeleted,"Should never merge message data in a deleted thread")}catch(n){i.default.reportError(n)}if(this._mergeMessagesData(e.messages,t.messages,["resources","draftID"]),e.modifiedOffline){var a=0,r=e.modifiedOffline;try{i.default.PAssert(1478,i.default.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(n){i.default.reportError(n)}for(var s=0;s<r.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let i=r[s];switch(i){case"messages":break;default:t[i]=e[i]}}t.modifiedOffline=e.modifiedOffline}for(let i in e)t.hasOwnProperty(i)||(t[i]=e[i]);t.labelIds=e.labelIds}_shouldCacheThread(e){for(var t=0,a=!0,i=0;i<e.messages.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e.messages[i];if(r.labelIds&&(r.labelIds.indexOf(oa.SPAM)>=0||r.labelIds.indexOf(oa.CHAT)>=0)){a=!1;break}}return a}_shouldCacheMessageData(e){var t=!1,a=this._getFullSyncTime(),i=this._getUnreadSyncTime();if(e.date.isAfter(a))t=!0;else if(e.date.isAfter(i))for(var r=0,s=0;s<e.messages.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e.messages[s];if(this.isPriorityData(n)){t=!0;break}}return t}refreshThreadCacheData(e,t,a,i,s){this._requestRemoteThreadMetadata(e,t,void 0,(a,n)=>{if(a)if(this._shouldCacheThread(a)){var o=this._addRemoteEntry(e,a);this.cacheThreadData(t,this.serializeExternalData(o)),s&&s(!0)}else this._deleteCachedThread(e,t,s);else n&&n.error&&n.error.code===r.a.HTTPStatusCode.NotFound?this._deleteCachedThread(e,t,s):(i(e,t),s&&s(!1))})}_deleteCachedThread(e,t,a){if(this.hasCacheData(t)){for(var i=0,s=this.getAttachment(t),o=s.getField("messages"),l=0;l<o.length;++l){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;Wr.menus.isComposeOpenForEmail(o[l].id)&&(this._clearPendingDraftUpdate(s,o[l].id),n.a.fireEvent("EmailCompose","onClosed",[]),Wr.menus.closeComposeEmail(s,o[l])),this._rawCache.removeEntry(o[l].id)}s.updateField("isDeleted",!0),s.updateField("messages",[]),this._updateAttachmentFromMessages(s,r.a.ChangeType.Remote)}this._threadCache.removeEntry(t),a&&a(!0)}_deleteCachedMessage(e,t,a){try{i.default.PAssert(1479,a,"Must specify a valid message ID to remove from thread")}catch(l){i.default.reportError(l)}if(this.hasCacheData(t)){var s=0,n=this.getAttachment(t),o=n.getField("messages");for(let e=0;e<o.length;++e){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(o[e].id===a){o.removeAt(e),this._updateAttachmentFromMessages(n,r.a.ChangeType.Remote),n.updateField("messages",o);break}}}this._threadCache.getEntry(t,!0).then(e=>{if(e){var i=0;for(let r=0;r<e.messages.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.messages[r].id===a){e.messages.removeAt(r),this.cacheThreadData(t,e);break}}}}),this._rawCache.removeEntry(a)}setLastModifiedDate(e,t,a){this.hasCacheData(t)&&this.getAttachment(t).updateField("lastModifiedDate",a);this._threadCache.getEntry(t,!0).then(e=>{e&&(e.lastModifiedDate=a,this.cacheThreadData(t,e))})}addLabelsToMessage(e,t,a,r,s){if(this.hasCacheData(t)){var n=0,o=this.getAttachment(t),l=o.getField("messages");for(let t=0;t<l.length;++t){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if((!a||l[t].id===a)&&(l[t].labelIds.pushOnlyUniques(r),a))break}this._updateAttachmentFromMessages(o,s),o.updateField("messages",l,void 0,!0);let e=o.getField("labelIds");e&&(e.pushOnlyUniques(r),o.updateField("labelIds",e,void 0,!0))}this._threadCache.getEntry(t,!0).then(e=>{if(e){var s=0;let o=!1;e.labelIds&&e.labelIds.pushOnlyUniques(r);for(let i=0;i<e.messages.length;++i){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(!a||e.messages[i].id===a){e.messages[i].labelIds.pushOnlyUniques(r),this.cacheThreadData(t,e),o=!0;break}}try{i.default.PAssert(1481,o,"Must have found message to add labels to")}catch(n){i.default.reportError(n)}}})}removeLabelsFromMessage(e,t,a,r,s){if(this.hasCacheData(t)){var n=0;let e=this.getAttachment(t),i=e.getField("messages");for(let t=0;t<i.length;++t){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!a||i[t].id===a){var o=0;for(let e=0;e<r.length;++e){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;i[t].labelIds.remove(r[e])}if(a)break}}this._updateAttachmentFromMessages(e,s),e.updateField("messages",i,void 0,!0);let d=e.getField("labelIds");if(d){var l=0;for(let e=0;e<r.length;++e){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;d.remove(r[e])}e.updateField("labelIds",d,void 0,!0)}}this._threadCache.getEntry(t,!0).then(e=>{if(e){var s=0;let d=!1;if(e.labelIds){var n=0;for(let t=0;t<r.length;++t){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e.labelIds.remove(r[t])}}for(let i=0;i<e.messages.length;++i){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(!a||e.messages[i].id===a){var o=0;for(let t=0;t<r.length;++t){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e.messages[i].labelIds.remove(r[t])}this.cacheThreadData(t,e),d=!0;break}}try{i.default.PAssert(1482,d,"Must have found message to remove labels from")}catch(l){i.default.reportError(l)}}})}async changeMessageAccount(e,t,a,r,s,n){try{i.default.PAssert(1483,n,"Must supply a valid from contact")}catch(d){i.default.reportError(d)}var o=r!==e.getField("accountID"),l=this._findDraft(e,t,a);return o&&this.discardDraft(e,l.id,l.draftID,e=>{try{i.default.PAssert(1484,e,"Must successfully delete remote draft")}catch(d){i.default.reportError(d)}}),l.from=n,l.replyTo=this.getReplyToAddress(n.email),l.decoded=await vt.a.replaceSignature(l.decoded,this.getSignature(s)),o?this.createDraft(r,void 0,void 0,l):this.updateDraft(e,l.id,l.draftID,l,!0,!0,e=>{try{i.default.PAssert(1485,e,"Must be able to successfully update the draft when swiching sending accounts")}catch(d){i.default.reportError(d)}})}_ensureVMLIsForSearchResult(e,t){try{i.default.PAssert(1486,t,"Should never be ensuring a search VMLI in the default item store")}catch(o){i.default.reportError(o)}var a="S~"+e.accountID,r=this._ensureVMLIsForAccount(a,t),s=this._createThreadID(a,"",e.id);if(!t.hasItem(s)){var n=t.createItem(s,this._getTextForItem(e),r.id);r.insertSorted(n,this.sortFn)}}_removeVMLIFromSearchResult(e,t){try{i.default.PAssert(1487,t,"Should never be ensuring a search VMLI in the default item store")}catch(s){i.default.reportError(s)}var a="S~"+e.accountID,r=this._createThreadID(a,"",e.id);t.hasItem(r)&&t.destroyItem(r)}_createThreadID(e,t,a){return"T~"+e+"~"+t+"~"+a}_getItemProps(e,t){var a;return t.isNamed(ua.PRI0)?a={priority:r.a.VMLIFlag.P0}:t.isNamed(ua.PRI1)?a={priority:r.a.VMLIFlag.P1}:t.isNamed(ua.PRI2)&&(a={priority:r.a.VMLIFlag.P2}),a}_ensureThreadLabelVMLI(e,t,a){a=a||this.getDefaultItemStore();var i,r=this._getLabelByID(e.accountID,t),s=this._ensureVMLIsForLabel(e.accountID,r,a),n=this._createThreadID(e.accountID,t,e.id);if(this.reportTrackedStat(Ct),a.hasItem(n))i=a.getItem(n);else{this.reportTrackedStat(At);var o=this._getItemProps(e,r);i=a.createItem(n,this._getTextForItem(e),s.id,o),s.insertSorted(i,this.threadSortFn,!1)}return i}_removeThreadLabelVMLI(e,t,a,i){i=i||this.getDefaultItemStore();var r=this._createThreadID(e,a,t);i.hasItem(r)&&i.destroyItem(r)}_getRequiredSearchLabels(e){for(var t=0,a=[oa.INBOX],i=e.split(" "),r=0;r<i.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i[r].split(":");s&&2===s.length&&("label"!==s[0]&&"category"!==s[0]&&"is"!==s[0]||a.push(s[1].toUpperCase()))}return a}_handleThreadLabelUpdates(e,t,a){Wr.PaneUpdateBatcher.beginUpdateItems();var i=!1;if(t){var r=0;for(let a=0;a<t.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i=this._addEmailLabelToSearchCache(e.accountID,e.id,t[a])||i}}if(a){var s=0;for(let t=0;t<a.length;++t){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;i=this._removeEmailLabelFromSearchCache(e.accountID,e.id,a[t])||i}}this._updateSpecialLabels(e),this._updateSearchPanes(e,t,a),i&&this.getDefaultItemStore().updateItems(),Wr.PaneUpdateBatcher.commitUpdateItems()}_updateSearchPanes(e,t,a){Wr.PaneUpdateBatcher.beginUpdateItems(),Wr.PaneManager.runForEachPane(r=>{if(r.isSearchingRemote()){var s=this.getActiveItemStore(r.id),n=r.search.getRemoteValue(),o=this._getRequiredSearchLabels(n),l=!1,d=!1;o.forEach(e=>{a&&a.indexOf(e)>=0?l=!0:t&&t.indexOf(e)>=0&&(d=!0)}),l?s!==this.getDefaultItemStore()&&(i.default.focusedPane===r&&0===t.length&&a&&1===a.length&&a[0]===oa.UNREAD||this._removeVMLIFromSearchResult(e,s)):d&&s!==this.getDefaultItemStore()&&this._ensureVMLIsForSearchResult(e,s)}},this.getPaneType()),Wr.PaneUpdateBatcher.commitUpdateItems()}_updateSpecialLabels(e){this._threadIsArchived(e)?this._addEmailLabelToSearchCache(e.accountID,e.id,ha):this._removeEmailLabelFromSearchCache(e.accountID,e.id,ha),this._addEmailLabelToSearchCache(e.accountID,e.id,ca)}_ensureVMLIsForAccount(e,t){try{i.default.PAssert(1488,e,"Must specify a valid account ID")}catch(n){i.default.reportError(n)}var a="A~"+e,r=(t=t||this.getDefaultItemStore()).getItem(a);if(!r){var s=t.getRoot();r=t.createItem(a,e,s.id),s.insertSorted(r,this.sortFn)}return r}_ensureVMLIsForLabel(e,t,a){try{i.default.PAssert(1489,t,"Must specify a valid label")}catch(h){i.default.reportError(h)}try{i.default.PAssert(1490,t instanceof mt,"Must pass in a valid label object")}catch(h){i.default.reportError(h)}a=a||this.getDefaultItemStore();var s="L~"+e+"~"+t.getLabelID(),n=a.getItem(s),o=t.getDisplayText(!0);if(n)n.getParsedText()!==o&&n.setText(o,r.a.ChangeType.Auto);else{var l;if(t.hasAncestors()){var d=this._getLabelByName(e,t.getParent().getRawName(),!0);l=d?this._ensureVMLIsForLabel(e,d,a):this._ensureVMLIsForAccount(e,a)}else l=this._ensureVMLIsForAccount(e,a);n=a.createItem(s,o,l.id),l.insertSorted(n,this.sortFn)}return n}getVMLIForAccount(e){return this._ensureVMLIsForAccount(e)}getVMLIForLabel(e,t){return this._ensureVMLIsForLabel(e,t)}getLabelForVMLI(e){var t,a=this.getDescriptorForItem(e);return a.accountID&&a.labelID&&(t=this._getLabelByID(a.accountID,a.labelID)),t}_getAccountIDFromItem(e){var t,a=e.id;a.startsWith("R~")&&(a=a.substr(2)),a.startsWith("A~")?(t=a.substr(2)).startsWith("S~")&&(t=t.substr(2)):a.startsWith("L~")?t=a.substring(2,a.indexOf("~",2)):a.startsWith("T~")&&(t=a.substring(2,a.indexOf("~",2)));try{i.default.PAssert(1491,!t||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(r){i.default.reportError(r)}return t}_getLabelIDFromItem(e){var t,a=e.id;a.startsWith("L~")?t=a.substr(a.indexOf("~",2)+1):a.startsWith("T~")&&(t=a.substr(a.indexOf("~",2)+1));try{i.default.PAssert(1492,!t||i.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1493,!t||t.length>3,"Label ID should be longer than a couple of chars")}catch(r){i.default.reportError(r)}return t}_getThreadIDFromItem(e){return this._getThreadID(e.id)}_getThreadID(e){var t;e.startsWith("T~")?t=e.substr(e.lastIndexOf("~")+1):e.startsWith("A~")||e.startsWith("L~")||e.startsWith("R~")||(t=e);try{i.default.PAssert(1494,!t||i.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in thread ID")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1495,!t||t.length>3,"Thread ID should be longer than a couple of chars")}catch(a){i.default.reportError(a)}return t}isAccountItem(e){return e.id.startsWith("A~")}isLabelItem(e){return e.id.startsWith("L~")}isThreadItem(e){return e.id.startsWith("T~")}getAttachmentClass(){return["plugin_gmail"]}googleScopes(){return[r.a.GScope.GmailModify,r.a.GScope.GmailCompose]}getDependencies(){return[r.a.PluginDependency.GoogleLogin]}verifyAuthorization(e){return!this.getSetting(this.Settings.IsEnabled)||this.isCurrentlyAuthorized(e)}handleUnauthorized(e){0}_activate(){}_deactivate(){}handleTapStart(){return!0}handleTapClick(e,t,a,r){var s=r.target;try{i.default.PAssert(1496,t,"Gmail tapped but is not actually a pane",i.default.getElementPath(s))}catch(n){i.default.reportError(n)}if(t&&(y.a.mac&&r.metaKey||!y.a.mac&&r.ctrlKey||!this.isPluginPane(t)))return this.openEmailByItem(e,t)}handleDoubleTap(e,t,a,i){return this.openEmailByItem(e,t),!0}isMyAccountID(e){try{i.default.PAssert(1497,"me"!==e||i.default.isDemoMode(),"Should not be checking me")}catch(a){i.default.reportError(a)}var t=Wr.settings.getUserIdentifier();try{i.default.PAssert(1498,i.default.isDemoMode()||"me"!==t,"Should not be checking against current account until loaded")}catch(a){i.default.reportError(a)}return e===t}createURLForThread(e){var t=e.getField("accountID");return"me"===t&&(t=Wr.settings.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"#all/"+e.id}createPrintURLForThread(e){var t=e.getField("accountID");return"me"===t&&(t=Wr.settings.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"/?ui=2&view=pt&search=all&th="+e.id}openEmailByItem(e,t,a){var i=e.getAttachmentByPlugin(r.a.PluginID.Gmail);if((i&&i!==Wr.EmailPreview.getThreadAttach()||!Wr.EmailPreview.isOpen()||a)&&this.getCacheData(i.id))return this.isAttachmentDraftOnly(i)?(this.sendEvent("Tap_DesktopDraft"),this.loadThread(i,()=>{Wr.menus.openComposeEmail(this,i.id)})):Wr.EmailPreview.open(e,i,t,a),!0}_convertRawMessage(e,t,a,r){var s={id:t,payload:a},n=this._getMessageFromAttachment(e,t);try{i.default.PAssert(1499,n,"Must be able to get message metadata")}catch(o){i.default.reportError(o)}s.labelIds=n.labelIds,s.messageID=n.messageID,s.snippet=n.snippet,s.internalDate=a.internalDate,r(s)}getThreadData(e,t,a){if(0!==e.getField("messages").length)return this._getThreadData(e,t,a);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,void 0,(i,s)=>{var n=!0;i?this._addRemoteEntry(e.getField("accountID"),i):s&&s.error&&s.error.code===r.a.HTTPStatusCode.NotFound&&(n=!1),n?this._getThreadData(e,t,a):t(!1,"The conversation that you requested no longer exists.")})}_getThreadData(e,t,a){var r=0,s=e.getField("messages"),n=s.length,o=0,l=!1,d=!1,h={},c=()=>{if(!d&&o===n&&l){var e=0;d=!0;var a={messages:[]},r=0;for(let t=0;t<s.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var c=h[s[t].id];c?a.messages.push(c):++r}try{i.default.PAssert(1500,a.messages.length+r===s.length,"Messages should always be found for thread")}catch(u){i.default.reportError(u)}0===s.length?t(void 0,"This message is not cached locally and we could not contact the remote server."):t(a)}},u=e=>{e&&(h[e.id]=e),++o,c()};for(let i=0;i<s.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var p=s[i];this.getMessageData(e,p.id,u)}l=!0,setTimeout(c,0)}getMessageData(e,t,a){this._rawCache.getEntry(t).then(r=>{r?this._convertRawMessage(e,t,r,a):(i.default.log("Warning: Local message cache missing email display data: ",e.id,t),this._requestRemoteMessageDataRaw(e.getField("accountID"),e.id,t,!0,a))})}_handleThreadLoaded(e,t,a,r){var s=this._pendingThreadLoads[e];try{i.default.PAssert(1501,s,"Must always have a valid pending load when handling laod")}catch(l){i.default.reportError(l)}if(delete this._pendingThreadLoads[e],s)for(var n=0,o=0;o<s.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;try{s[o](t,a,r)}catch(d){i.default.reportError(d)}}}loadThread(e,t){try{i.default.PAssert(1502,0===this._loadThreadMutex,"Should never have an outstanding lock on thread load")}catch(a){i.default.reportError(a)}this._loadThreadMutex++;e.getField("accountID");this._loadThread(e,t,8e3),this._loadThreadMutex--}_loadThread(e,t,a){var r=this.isAttachmentDraftOnly(e),s=this._pendingThreadLoads[e.id];if(s)i.default.log("Duped pending thread load: ",e.id),s.push(t);else if(this._pendingThreadLoads[e.id]=[t],e.getField("dataLoaded")||e.isLocalOnlyAttachment()){for(var n=0,o=e.getField("messages"),l=!1,d=!1,h=0,c=0,u=o.length,p=0,g=()=>{l&&h===c&&(u===p&&(d=!0),this._handleThreadLoaded(e.id,!0,d))},f=async t=>{if(c++,t){""===t.decoded&&(t.decoded=void 0);var a=await this._parseMailMessage(t);try{i.default.PAssert(1503,a,"Must be able to parse message")}catch(r){i.default.reportError(r)}this._updateMessageData(e,a.id,a),d=!0}g()},m=0;m<o.length;++m){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var v=o[m];void 0===v.decoded?(v.decoded="",h++,this.getMessageData(e,v.id,f)):(v.decoded||v.labelIds.indexOf(oa.DRAFT)>=0)&&p++}l=!0,g()}else if(r){var y=e.getField("messages")[0];this.getMessageData(e,y.id,async t=>{if(t){var a=await this._parseMailMessage(t);try{i.default.PAssert(1504,a,"Must be able to parse message")}catch(r){i.default.reportError(r)}this._updateMessageData(e,a.id,a)}d=!0,this._handleThreadLoaded(e.id,!0,d)})}else this.getThreadData(e,async(t,a)=>{t&&await this._parseMailThread(e,t),d=!0,this._handleThreadLoaded(e.id,!!e.getField("dataLoaded"),d,a)},a)}forceReloadMessage(e,t,a){this._requestRemoteMessageData(e,t,a)}_verifyEmailAttachments(e,t,a){var r,s,n=this._findDraft(e,t,a);return n?i.default.forEachValue(n.resources,e=>{e.uploader&&(e.uploader.hasError()?r="There was an error uploading one or more attachments. Please remove them or try uploading again.":e.uploader.isDone()||(r="One or more of your attachments is still uploading.",s=e=>{this.onEmailReadyToSend(n,()=>{Wr.toasts.clearMessage(e)})}))}):r="Could not find message to verify attachments.",r?{message:r,handleMessageFn:s}:void 0}_verifyEmailRecipients(e,t,a){var r,s=this._findDraft(e,t,a);if(s)if(s.to&&0!==s.to.length)for(var n=0,o=0;o<s.to.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=s.to[o];l&&l.email?i.default.isEmail(l.email)||(r="You have entered an invalid email"):r="You have entered a contact with an invalid email address"}else r="You must enter at least one person to send this email to";else r="Unable to find the message you are trying to send";return r?{message:r}:void 0}_formatAddressText(e,t,a){return e?a?'"'+i.default.encodeMIMEHeader(e)+'" <'+t+">":'"'+e+'" <'+t+">":t}_createAddressTextFromTokens(e,t){var a="";if(e)for(var r=0,s=0;s<e.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[s];i.default.isEmail(n.email)&&(0!==s&&(a+=", "),a+=this._formatAddressText(n.text,n.email,t))}try{i.default.PAssert(1505,!a.startsWith(","),"Should not start with a comma")}catch(o){i.default.reportError(o)}try{i.default.PAssert(1506,!a.endsWith(","),"Should not end with a comma")}catch(o){i.default.reportError(o)}try{i.default.PAssert(1507,a.indexOf(",,")<0,"Should not have two commas in a row")}catch(o){i.default.reportError(o)}return a.trim()}_createRFC822Message(e,t,a,r){try{i.default.PAssert(1508,t,"Must specify a valid draft")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1509,t.contentType,"Must specify a valid content type for the draft")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1510,t.from,"Must be able to get the from information for a user.")}catch(l){i.default.reportError(l)}try{i.default.PAssert(1511,!t.inReplyTo||t.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+t.inReplyTo)}catch(l){i.default.reportError(l)}try{i.default.PAssert(1512,!t.references||t.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+t.references)}catch(l){i.default.reportError(l)}var s=t.from.text,n=t.from.email,o=new St(this);o.updateFromDraft(e,t,s,n,a,()=>{var e=o.generateBlob();r(this._encodeEmail(e))})}createSignature(e){var t=this.getSignature(e);return t?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+t+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+t+"</div>":'<div class="gmail_signature"></div>'}createReplyQuote(e){var t;e&&(t='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+e.date.toString("MMM dd, y")+" at "+e.date.toString("hh:mm tt")+", "+i.default.escape(this._createAddressTextFromTokens([e.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+e.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n");return t}createForwardQuote(e){var t,a=i.default.isArray(e.to)?e.to:[e.to];return e&&(t='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+i.default.escape(this._createAddressTextFromTokens([e.from]))+"<br>\nDate: "+e.date.toString("ddd, MMM dd, y")+" at "+e.date.toString("hh:mm tt")+"<br>\nSubject: "+e.subject+"<br>\nTo: "+i.default.escape(this._createAddressTextFromTokens(a))+"\n<br>\n<br>\n"+e.decoded+"\n</div>\n<br>\n"),t}createMessageBody(e,t,a){var s,n=this.createSignature(t);if(a===r.a.EmailResponseMode.Reply||a===r.a.EmailResponseMode.ReplyAll)s=this.createReplyQuote(e);else if(a===r.a.EmailResponseMode.Forward)s=this.createForwardQuote(e);else try{i.default.PAssert(1513,!1,"Invalid email response mode: "+a)}catch(o){i.default.reportError(o)}return this.getSetting(this.Settings.InsertSignatureAboveReplies)?n+s:s+n}_sendEmail(e,t,a,i){this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t);var r=this._findDraft(e,t,a);this._createRFC822Message(e.getData(),r,!0,t=>{var a={raw:t};e.isLocalOnlyAttachment()||(a.threadId=e.id);var s=pe.a.fns("gmail").users.messages.send.packedFn,n={userId:e.getField("accountID"),resource:a};this._queueRemoteRequestMulti(e.getField("accountID"),s,n,t=>{this._updateLocalDraftFromSend(e,r.id,t,i)},t=>{this._notifySendFailed(),i(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)},void 0,qt)})}_shouldSaveMessageContent(e,t){return t.labelIds.indexOf(oa.DRAFT)>=0}compactCacheField(e,t){var a,r=0;switch(t){case"messages":a=[];for(var s=e[t],n={},o=e=>{var t=i.default.clone(e);delete t.data,delete t.size,delete t.uploader,n[e.id]=t},l=0;l<s.length;++l){var d=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var h=s[l],c={},u=0;u<pa.length;++u){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;let e=h[pa[u]];void 0!==e&&null!==e&&(c[pa[u]]=h[pa[u]])}this._shouldSaveMessageContent(e,h)||(delete c.decoded,delete c.mimeType,delete c.contentType,delete c.listUnsubscribe),i.default.forEachValue(c.resources,o),c.resources=n,a.push(c)}break;default:a=e[t]}return a}_generateUndoRedo(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.DiscardDraft,{undo:i.default.emptyFn,redo:this.runDiscardDraft})}performAction(e,t,a,r,s){try{i.default.PAssert(1514,e,"Must supply a valid action")}catch(d){i.default.reportError(d)}try{i.default.PAssert(1515,i.default.isBoolean(t),"Invalid preventUndo param")}catch(d){i.default.reportError(d)}var n;this.beginAction(t);var o=[a,r,s];try{n=this._undoStack.runAction(this.id,e,o)}catch(h){i.default.reportError(h)}if(this._undoStack.isUndoableAction()){var l=[a];i.default.isArray(n)?l.pushArray(n):l.push(n),this._undoStack.performAction(this.id,e,{undoParams:l,redoParams:o})}this.endAction()}performActions(e,t){var a=0;this.beginAction(t);for(var i=0;i<e.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.performAction(e[i].action,!1,e[i].attach,e[i].param)}this.endAction()}beginAction(e){this._undoStack.beginAction(e),P.d.beginAction()}endAction(){this._undoStack.endAction(),P.d.endAction()}handleUndo(){P.d.beginAction(),this._undoStack.undoAction(),P.d.endAction()}handleRedo(){P.d.beginAction(),this._undoStack.redoAction(),P.d.endAction()}supportUsageCache(){return!0}supportOfflineLoad(){return!0}_matchParticipant(e,t){var a=!1;return e&&(e.text&&(a=e.text.toLowerCase().indexOf(t)>=0),!a&&e.email&&(a=e.email.toLowerCase().indexOf(t)>=0)),a}_matchLabels(e,t){return this.hasLabelLike(e.accountID,e.id,t)}_matchEntry(e,t){return e.subjectLower.indexOf(t)>=0||this._matchParticipant(e.from,t)||this._matchLabels(e,t)}matchAttachment(e,t){return this._matchEntry(e.getData(),t)}findMatchExact(){}findMatchLike(e,t){var a=e.toLowerCase();return this.findCachedItemsByFn(e=>this._matchEntry(e,a),t)}isGmailItem(e){return!!e.getAttachmentByPlugin(this.id)}itemHasLabelByID(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabelByID(a,t)}itemHasLabel(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabel(a,t)}itemHasFullLabel(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasFullLabel(a,t)}itemHasDraft(e){return this.itemHasLabelByID(e,oa.DRAFT)}isItemUnread(e){return this.itemHasLabelByID(e,oa.UNREAD)}isItemImportant(e){return this.itemHasLabelByID(e,oa.IMPORTANT)}isItemStarred(e){return this.itemHasLabelByID(e,oa.STARRED)}isItemArchived(e){var t=e.getAttachmentByPlugin(this.id);return!!t&&this.attachmentIsArchived(t)}isItemTrashed(e){return this.itemHasLabelByID(e,oa.TRASH)}isItemFullTrashed(e){return this.itemHasFullLabel(e,da.TRASH)}isItemSpam(e){return this.itemHasLabelByID(e,oa.SPAM)}isDisplayItem(e,t){var a=!1;return this.isItemSpam(e)||!this.isThreadItem(e)||this.isItemFullTrashed(e)&&!t||(a=!0),a}getItemPriority(e){return e.hasPluginAttachment(this.id)?this.getAttachmentPriority(e.getAttachmentByPlugin(this.id)):0}_getCompDateForItem(e){var t=0,a=e.getAttachmentByPlugin(this.id);if(a){var i=a.getField("lastModifiedDate");if(i)t=i.getTime();else{var r=a.getField("internalDate");r&&(t=r.getTime())}}return t}_timeCompare(e,t){return e>t?1:e<t?-1:0}threadSortFn(e,t){return this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}threadSortPriorityFn(e,t){var a=e.getAttachmentByPlugin(this.id),i=t.getAttachmentByPlugin(this.id),r=this.getAttachmentPriority(a),s=this.getAttachmentPriority(i),n=this.attachmentHasLabelByID(a,oa.STARRED),o=this.attachmentHasLabelByID(i,oa.STARRED);return r>s?-1:r<s?1:n&&!o?-1:o&&!n?1:this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}labelSortFn(e,t){return e.displayCompare(t)}labelVMLISortFn(e,t){var a=this._getLabelByID(this._getAccountIDFromItem(e),this._getLabelIDFromItem(e)),i=this._getLabelByID(this._getAccountIDFromItem(t),this._getLabelIDFromItem(t));return this.labelSortFn(a,i)}sortFn(e,t){return e.getParsedText().localeCompare(t.getParsedText())}getCssClass(e,t){if(t&&t.type===this.getPaneType())return i.default.classNames({starred:this.attachmentHasLabelByID(e,oa.STARRED)},{unread:this.attachmentHasLabelByID(e,oa.UNREAD)},{p0:this.attachmentHasLabel(e,ua.PRI0)},{p1:this.attachmentHasLabel(e,ua.PRI1)},{p2:this.attachmentHasLabel(e,ua.PRI2)})}getUnsyncdMessageCount(){return this._numUnsyncdMessages}getSyncdMessageCount(){return this._numSyncdMessages}_checkUnsyncdMessageContent(e){e.messages.forEach(t=>{t.cached?(this.reportTrackedStat(Tt),this._numSyncdMessages++):t.cachedError?this.reportTrackedStat(Lt):this._shouldCacheMessageData(e)?this._rawCache.getEntry(t.id).then(a=>{a||(this.reportTrackedStat(xt),this._notifyUnsyncdMessage(e.accountID,e.id,t.id))}):this.reportTrackedStat(kt)})}_notifyUnsyncdMessage(e,t,a){i.default.isTempId(t)||i.default.isTempId(a)||(this._handleSyncContentCacheOp(this._unsyncdMessages,e,t,a),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())}_notifyContentCached(e,t,a){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,e,t,a)}_handleSyncContentCacheOp(e,t,a,i){var r=this._ensureAccountLib(t,e);r[a]?!0!==r[a]&&r[a].indexOf(i)<0&&r[a].push(i):r[a]=!i||[i]}_removeUnsyncdMessage(e,t,a){this.reportTrackedStat(Rt),this._numUnsyncdMessages--;var r=this._getAccountLib(e,this._unsyncdMessages);if(a){var s=r[t];s.remove(a),0===s.length&&delete r[t]}else delete r[t];i.default.isEmpty(r)&&this._deleteAccountLib(e,this._unsyncdMessages)}_setCachedFieldForMessage(e,t,a){if(this.hasCacheData(t)){var i=0,r=this.getAttachment(t).getField("messages");for(let e=0;e<r.length;++e){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;(!0===a||a.indexOf(r[e].id)>=0)&&(r[e].cached=!0)}}this._threadCache.getEntry(t,!0).then(e=>{if(e){var i=0;for(let t=0;t<e.messages.length;++t){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e.messages[t];(!0===a||a.indexOf(r.id)>=0)&&(r.cached=!0)}this.cacheThreadData(t,e)}})}_updateCachedErrorFieldForMessage(e,t,a){if(this.hasCacheData(t)){var i=0,r=this.getAttachment(t).getField("messages");for(let e=0;e<r.length;++e){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;(!0===a||a.indexOf(r[e].id)>=0)&&(r[e].cachedError?r[e].cachedError++:r[e].cachedError=1)}}this._threadCache.getEntry(t,!0).then(e=>{if(e){var i=0;for(let t=0;t<e.messages.length;++t){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e.messages[t];(!0===a||a.indexOf(r.id)>=0)&&(r.cached?r.cachedError++:r.cachedError=1)}this.cacheThreadData(t,e)}})}_processSyncdContent(){for(var e in this._pendingSyncdMessages)if(this._pendingSyncdMessages.hasOwnProperty(e)){var t=this._pendingSyncdMessages[e];for(var a in t)if(t.hasOwnProperty(a)){var r=t[a];if(i.default.isArray(r)){for(var s=0,n=0;n<r.length;++n){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var o=r[n];this._removeUnsyncdMessage(e,a,o)}this._setCachedFieldForMessage(e,a,r)}else!0===r&&this._removeUnsyncdMessage(e,a)}}this._pendingSyncdMessages={}}_processSyncErrors(e){for(var t in i.default.log("Process Sync Errors: ",e),e)if(e.hasOwnProperty(e)){var a=e[t];for(var r in a)if(a.hasOwnProperty(r)){var s=0,n=a[r];try{i.default.PAssert(1516,i.default.isArray(n),"Must have a valid message ID list")}catch(d){i.default.reportError(d)}for(var o=0;o<n.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=n[o];this._removeUnsyncdMessage(t,r,l)}this._updateCachedErrorFieldForMessage(t,r,n)}}}driveMessageContentSync(e){if(Wr.cacheManager.hasReportedQuotaError())return e(!1);this._outstandingContentSync=!0,this._runMessageContentSync(35,(t,a)=>{if(!t)try{this._processSyncErrors(a)}catch(r){i.default.reportError(r)}return this._processSyncdContent(),this._outstandingContentSync=!1,e(!i.default.isEmpty(this._unsyncdMessages))})}_runMessageContentSync(e,t){var a=0,i=0,r=!1,s=0,n=0,o={};const l=(e,a,l)=>{if(e?s++:(n++,o[a]=l),r&&s+n===i){var d=0===n;t(d,d?void 0:o)}};var d=this.getSyncAccounts();for(let h in this._unsyncdMessages)if(d.indexOf(h)>=0&&(a+=this._syncMessageContentForAccount(h,this._unsyncdMessages[h],e-a,l),i++,a>=e))break;return r=!0,0===a&&setTimeout(()=>{t(!0)},0),a}_syncMessageContentForAccount(e,t,a,i){var r=0,s=0,n=0,o=0,l={},d=(t,a,r)=>{if(t?n++:(o++,l[a]=r),n+o===s){var d=0===o;i(d,e,d?void 0:l)}};for(let h in t)if(t.hasOwnProperty(h)&&(r+=this._syncMessageContentForThread(e,h,t[h],a-r,d),s++,r>=a))break;return r}_syncMessageContentForThread(e,t,a,r,s){var n=0;if(i.default.isArray(a)){var o=!1,l=0,d=[],h=(a,i)=>{if(i?(l++,this._notifyContentCached(e,t,a)):d.push(a),o&&l+d.length===n){var r=0===d.length;s(r,t,r?void 0:d)}};a.forEach(a=>{n<r&&this._requestRemoteMessageDataRaw(e,t,a,!1,(e,t)=>{h(a,!!e)}),n++}),o=!0}else this._requestRemoteThreadDataRaw(e,t,(a,i)=>{a?this._handleContentSyncdThread(e,a,a=>{this._notifyContentCached(e,t),s(a,t)}):s(!1,t,!0)}),n++;return n}_handleContentSyncdMessage(e,t,a,i){a.error||(a.internalDate=new Date(+a.internalDate),a.payload.id=a.id,a.payload.internalDate=a.internalDate,this._rawCache.saveEntry(a.payload)),i&&i(!0)}_handleContentSyncdThread(e,t,a){for(var i=0,r=0;r<t.messages.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t.messages[r];this._handleContentSyncdMessage(e,t.id,s,a)}}scheduleEmail(e,t){P.d.beginAction();var a=e.getAttachmentByPlugin(this.id);try{i.default.PAssert(1517,a,"Must be able to get a valid attachment from item")}catch(h){i.default.reportError(h)}var s=a.getField("subject"),n=this.createURLForThread(a),o=r.a.MSPerHour,l=Wr.pluginManager.getPluginGCalendar();if(l){var d=l.getDefaultExportCalendarID();d&&(i.default.isDemoMode()||l.getSetting(l.Settings.WriteAccess))?l.createEventForEmail(d,s,n,t,o,(e,t)=>{e||t?t?(this.addLabelToAttachment(a,"Moo.do/Scheduled"),this.getSetting(this.Settings.ArchiveOnSchedule)&&this.archiveAttachment(a)):t||Wr.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:r.a.MessageAction.Okay}):Wr.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:()=>{Wr.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:r.a.MessageAction.Okay})}})}):Wr.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:r.a.MessageAction.OpenCalendarSettings})}else Wr.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:r.a.MessageAction.OpenSettings});P.d.endAction()}getIconInfoForLabel(e){var t,a;switch(e.getParsedText()){case"Inbox":a="inbox2",t=r.a.ColorBrand;break;case"Starred":a="star",t="#fd3";break;case"Important":a="exclamation",t="#d43";break;case"Sent Mail":a="send",t="#08c";break;case"Draft":a="drafts",t="#fafafa";break;case"Archived":a="mail";break;case"Trash":a="delete",t="#ff738c";break;case"Primary":a="user";break;case"Social":a="group";break;case"Promotions":a="tag";break;case"Updates":a="flag";break;case"Forums":a="question_answer";break;case"Chat":a="chat";break;case"Spam":a="warning";default:0}return{icon:a,color:t}}archiveItem(e,t){var a=t.getAttachmentByPlugin(this.id);try{i.default.PAssert(1518,a,"Must be able to get a valid attachment")}catch(s){i.default.reportError(s)}!e&&this.isItemArchived(t)?this.performAction(r.a.PluginAction.Gmail.Unarchive,!1,a):e&&!this.isItemArchived(t)&&this.performAction(r.a.PluginAction.Gmail.Archive,!1,a)}deleteItem(e,t){var a=e.getAttachmentByPlugin(this.id);try{i.default.PAssert(1519,a,"Must be able to get a valid attachment")}catch(s){i.default.reportError(s)}t&&t.isDraft()&&this.itemHasDraft(e)?this.performAction(r.a.PluginAction.Gmail.DiscardDraft,!0,a):t&&t.isTrash()&&this.isItemFullTrashed(e)?this.performAction(r.a.PluginAction.Gmail.Untrash,!1,a):this.isItemFullTrashed(e)||this.performAction(r.a.PluginAction.Gmail.Trash,!1,a)}removeItemFromLabel(e,t){var a=t.getAttachmentByPlugin(this.id);try{i.default.PAssert(1520,a,"Must be able to get a valid attachment")}catch(s){i.default.reportError(s)}e&&(e.isCustom()?this.performAction(r.a.PluginAction.Gmail.RemoveLabel,!1,a,e.getName()):e.isInbox()?this.performAction(r.a.PluginAction.Gmail.Archive,!1,a):e.isArchived()?this.performAction(r.a.PluginAction.Gmail.Unarchive,!1,a):e.isStarred()&&this.performAction(r.a.PluginAction.Gmail.Unstar,!1,a))}moveEmailToItem(e,t,a){this.beginAction(),a||(e=e.clone(t,r.a.ChangeType.Local));var s=e.getAttachmentByPlugin(this.id);try{i.default.PAssert(1521,s,"Must be able to get a valid attachment")}catch(n){i.default.reportError(n)}this.performAction(r.a.PluginAction.Gmail.Move,!1,s,e,t),this.getSetting(this.Settings.ArchiveOnOrganize)&&this.performAction(r.a.PluginAction.Gmail.Archive,!1,s),this.attachmentHasLabel(s,"Moo.do/Handled")||this.performAction(r.a.PluginAction.Gmail.AddLabel,!1,s,"Moo.do/Handled"),this.endAction()}getLastMessage(e){let t=e.getField("messages")||[],a=t.length-1;return this.isMessageDraft(t[a])&&!this.getAttachField(e,"pendingSend")&&a--,t[a]}async sendEmail(e,t){return new Promise(a=>{this.sendDraft(e,t.id,t.draftID,void 0,(t,s)=>{Wr.EmailPreview.ensureDisplayMessages(e),t||(i.default.isHTTPStatusCode(s,r.a.HTTPStatusCode.Network)?Wr.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:r.a.MessageAction.Okay,hold:!0}):s&&Wr.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:r.a.MessageAction.Okay})),a(!!t)})||a(!1)})}},p()(Dt.prototype,"onSyncAccountsChanged",[f.a],Object.getOwnPropertyDescriptor(Dt.prototype,"onSyncAccountsChanged"),Dt.prototype),p()(Dt.prototype,"_notifyPendingDraftUpdate",[f.a],Object.getOwnPropertyDescriptor(Dt.prototype,"_notifyPendingDraftUpdate"),Dt.prototype),p()(Dt.prototype,"runLabelSync",[f.a],Object.getOwnPropertyDescriptor(Dt.prototype,"runLabelSync"),Dt.prototype),p()(Dt.prototype,"runThreadSync",[f.a],Object.getOwnPropertyDescriptor(Dt.prototype,"runThreadSync"),Dt.prototype),p()(Dt.prototype,"compareCachedData",[f.a],Object.getOwnPropertyDescriptor(Dt.prototype,"compareCachedData"),Dt.prototype),p()(Dt.prototype,"removeItemFromLabel",[f.a],Object.getOwnPropertyDescriptor(Dt.prototype,"removeItemFromLabel"),Dt.prototype),Dt),Na={GenericSingle:1,GenericPaged:2,DrivePermissionsInsert:3,DrivePermissionsDelete:4,DrivePermissionsList:5,DriveFilesGet:6,DriveFilesList:7,DriveFilesTrash:8,DrivePropertiesInsert:9,DrivePropertiesUpdate:10,DriveParentsInsert:11,DriveParentsDelete:12,DriveChildrenList:13,DriveRealtimeGet:14},Ba="items(id,name,role,type,emailAddress)",Ua="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)",Ha="items("+Ua+"),nextPageToken",Va="items(id),nextPageToken";var ja,za=class extends Se{constructor(){super(r.a.PluginID.Moodo,"m","Moodo",!0),this.setSetting(this.Settings.IsEnabled,!0,!1),this.useRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.Unknown),this.useRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.Unknown)}isPluginBlocked(){return!1}allowRemoteRequests(){return!0}getRemoteAttachmentData(e){this.cacheData(e.id,{})}runRemoteSingleRequest(e,t,a,i,r,s){let n=ke.a.getDefaultAccountID();this._queueRemoteRequestMulti(n,e,t,a,i,void 0,r||Na.GenericSingle,s)}runRemotePagedRequest(e,t,a,i,r,s){r||(r={}),r.accountID=ke.a.getDefaultAccountID(),this._queuePagedRemoteRequest(e,t,a,i,void 0,s,r)}drivePermissionsInsert(e,t,a,r,s){try{i.default.PAssert(667,i.default.isEmail(t),"Should pass in a valid email address")}catch(l){i.default.reportError(l)}var n=pe.a.fns("drive").permissions.insert.packedFn,o={fileId:e,sendNotificationEmails:a,resource:{value:t,type:"user",role:"writer",withLink:!1}};this.runRemoteSingleRequest(n,o,r,s,Na.DrivePermissionsInsert)}drivePermissionsDelete(e,t,a,i){var r=pe.a.fns("drive").permissions.delete.packedFn,s={fileId:e,permissionId:t};this.runRemoteSingleRequest(r,s,a,i,Na.DrivePermissionsDelete)}drivePermissionsList(e,t,a){var i=pe.a.fns("drive").permissions.list.packedFn,r={fileId:e,fields:Ba};this.runRemoteSingleRequest(i,r,t,a,Na.DrivePermissionsList)}drivePermissionsPublic(e,t,a){var i=pe.a.fns("drive").permissions.insert.packedFn,r={fileId:e,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this.runRemoteSingleRequest(i,r,t,a,Na.DrivePermissionsInsert)}driveFilesGet(e,t,a,i){var r=pe.a.fns("drive").files.get.packedFn,s={fileId:e,fields:Ua};i&&i.props&&Object.assign(s,i.props),this.runRemoteSingleRequest(r,s,t,a,Na.DriveFilesGet)}driveFilesExport(e,t,a,i){var r=pe.a.fns("drive").files.export.packedFn,s={fileId:e,mimeType:"application/vnd.google-apps.drive-sdk.597847337936"};this.runRemoteSingleRequest(r,s,t,a,Na.DriveFilesGet,i)}realtimeFileGet(e,t,a,i){var r=pe.a.fns("drive").realtime.get.packedFn,s={fileId:e};this.runRemoteSingleRequest(r,s,t,a,Na.DriveFilesGet,i)}driveFilesList(e,t,a,i){var r=pe.a.fns("drive").files.list.packedFn,s={q:e,fields:Ha};i&&i.props&&Object.assign(s,i.props),this.runRemotePagedRequest(r,s,t,a,i,Na.DriveFilesList)}driveFilesTrash(e,t,a){var i=pe.a.fns("drive").files.trash.packedFn,r={fileId:e};this.runRemoteSingleRequest(i,r,t,a,Na.DriveFilesTrash)}driveFilesUntrash(e,t,a){var i=pe.a.fns("drive").files.untrash.packedFn,r={fileId:e};this.runRemoteSingleRequest(i,r,t,a,Na.DriveFilesTrash)}drivePropertiesInsert(e,t,a,i,r){var s=pe.a.fns("drive").properties.insert.packedFn,n={fileId:e,resource:{key:t,value:a,visibility:"PRIVATE"}};this.runRemoteSingleRequest(s,n,i,r,Na.DrivePropertiesInsert)}drivePropertiesUpdate(e,t,a,i,r){var s=pe.a.fns("drive").properties.update.packedFn,n={fileId:e,propertyKey:t,resource:{key:t,value:a,visibility:"PRIVATE"}};this.runRemoteSingleRequest(s,n,i,r,Na.DrivePropertiesUpdate)}driveParentsInsert(e,t,a,i){var r=pe.a.fns("drive").parents.insert.packedFn,s={fileId:e,resource:{id:t}};this.runRemoteSingleRequest(r,s,a,i,Na.DriveParentsInsert)}driveParentsDelete(e,t,a,i){var r=pe.a.fns("drive").parents.delete.packedFn,s={fileId:e,parentId:t};this.runRemoteSingleRequest(r,s,a,i,Na.DriveParentsDelete)}driveChildrenList(e,t,a,i){var r=pe.a.fns("drive").children.list.packedFn,s={folderId:e,fields:Va};this.runRemotePagedRequest(r,s,t,a,i,Na.DriveChildrenList)}},qa=["description","end","start","status","summary","extendedProperties"],Wa="syncTokens",Ga="calendarList",Ka="isComplete",Ya="priority",Xa="isStarred",Qa="isArchived",$a=["modifiedOffline"],Ja=2,Za=3,ei=4,ti=6,ai=7,ii=8,ri=9,si=10,ni=11,oi=12,li=13,di=14,hi=r.a.DefaultEventDuration;var ci,ui=(ja=class extends Se{constructor(){super(r.a.PluginID.GCalendar,"c","Calendar",!1),this.pluginMargin=4,this.pluginPadding=14,this._requiresOfflineAuth=!0,this.supportSyncAccounts=!0,this._numEntriesSyncd=0,this._calendarList={},this.registerSetting("WriteAccess","writeAccess","w",!0,!0),this.registerSetting("ImportCalendars","importCalendars","i",!0),this.registerSetting("ExportCalendar","exportCalendar","x",!0),this.registerSetting("WeeksPast","weeksPast","p",!0,1),this.registerSetting("WeeksFuture","weeksFuture","f",!0,4),this.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda","o",!0,!1),this.registerSetting("SyncNewEvents","syncNewEvents","n",!0,!0),this.registerSetting("SyncDraggedEvents","syncDraggedEvents","d",!0,!0),this.registerSetting("CreateLocalEvents","createLocalEvents","l",!0,!0),this._updateSyncTimes(),this.onCalendarsSynced=new T.a,this._eventCache=this.registerLocalCache(this.id,r.a.StorageType.IndexedDB,{metadataKeys:[Wa,Ga],keyFieldsRN:["startTime","calendarID","modifiedOffline"]}),this._cacheCleanup=this.registerLowImpactTask("CacheCleanup",this._purgeOldData),this.declareProperty("isInvalid",r.a.PluginLoad.Runtime,!0,!1),i.default.isDemoMode()?this.declareProperty("calendarID",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline,!0,"me"):this.declareProperty("calendarID",r.a.PluginLoad.Preview|r.a.PluginLoad.Full|r.a.PluginLoad.Inline),this.declareProperty("summary",r.a.PluginLoad.Preview|r.a.PluginLoad.Full),this.declareProperty("status",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,"confirmed"),this.declareProperty("startTime",r.a.PluginLoad.Preview|r.a.PluginLoad.Full),this.declareProperty("endTime",r.a.PluginLoad.Preview|r.a.PluginLoad.Full),this.declareProperty("allDayEvent",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,!1),this.declareProperty("recurringEventId",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0),this.declareProperty("eid",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0),this.declareProperty("isComplete",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,!1),this.declareProperty("isArchived",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,!1),this.declareProperty("isStarred",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,!1),this.declareProperty("priority",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,r.a.VMLIFlag.None),this.declareProperty("locked",r.a.PluginLoad.Preview|r.a.PluginLoad.Full,!0,!1),this.declareProperty("modifiedOffline",r.a.PluginLoad.Full,!0,!1),this.declareProperty("source",r.a.PluginLoad.Full,!0),this.declareProperty("location",r.a.PluginLoad.Full,!0),this.declareProperty("description",r.a.PluginLoad.Full,!0),this.declareProperty("attendees",r.a.PluginLoad.Full,!0),this.declareProperty("organizer",r.a.PluginLoad.Full,!0),this.useRenderer(r.a.PluginRenderTypes.StyledText,r.a.PluginRenderers.CalendarEvent),this.useRenderer(r.a.PluginRenderTypes.UnstyledText,r.a.PluginRenderers.CalendarEvent),this.useRenderer(r.a.PluginRenderTypes.Measure,r.a.PluginRenderers.CalendarEvent),this._pendingCreates={},this._syncingOfflineChanges=!1,this._hasInitializedTasks=!1,this._purgeOldDataTimeout=void 0,this._eventUpdateTimeout=void 0,this._eventUpdateQueue={},this._propConverter={},this._propConverter[Ka]=i.default.parseDate,this._propConverter[Qa]=i.default.parseBoolean,this._propConverter[Xa]=i.default.parseBoolean,this._propConverter[Ya]=this.parsePriority,Wr.settings.syncAccounts.listen(this.onSyncAccountsChanged)}getType(){return r.a.PluginType.Calendar}_attachMetadataFields(){return $a}allowRemoteRequests(){return!0}useItemStore(){return"Google Calendar"}itemStoreOptions(){return{listenToItemStateChanged:!0,enabledFilters:r.a.ItemStoreFilter.Dates}}supportOfflineLoad(){return!0}supportUsageCache(){return!0}googleScopes(){return this.getSetting(this.Settings.WriteAccess)?[r.a.GScope.Calendar]:[r.a.GScope.CalendarRO]}getDependencies(){return[r.a.PluginDependency.PremiumSub,r.a.PluginDependency.GoogleLogin]}hasSettingsError(){return!1}verifyAuthorization(e){var t=this.googleScopes();return re.a.isAuthorizedForScopes(e,t)}getBlockedText(){return""}computeBatchGroupID(e){var t="me";return e.data&&e.data.calendarId&&(t=e.data.calendarId),t}_serializeDate(e){return e instanceof Date?e.toISOString():i.default.isNumber(e)?new Date(e).toISOString():e}compactCacheField(e,t){var a;switch(t){case"startTime":case"endTime":a=this._serializeDate(e[t]);break;default:a=e[t]}return a}_updateSyncTimes(){var e=-(this.getSetting(this.Settings.WeeksPast)||1),t=this.getSetting(this.Settings.WeeksFuture)||4;try{i.default.PAssert(772,i.default.isNumber(e)&&e<=0,"Invalid value for weeksPast: ",e)}catch(s){i.default.reportError(s)}try{i.default.PAssert(773,i.default.isNumber(t)&&t>=0,"Invalid valid for weeksFuture: ",t)}catch(s){i.default.reportError(s)}var a=Math.min(-7,e),r=Math.max(20,t);this._minSyncStartTime=(new Date).clearTime().addWeeks(a),this._maxSyncStartTime=(new Date).clearTime().addWeeks(r),this._syncTokenDuration=i.default.weeks(10),this._minDisplayStartTime=(new Date).clearTime().addWeeks(e),this._maxDisplayStartTime=(new Date).clearTime().addWeeks(t);try{i.default.PAssert(774,this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}catch(s){i.default.reportError(s)}}_shouldDisplayTime(e,t){return t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime||e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime}_filterDates(e,t,a){return i=>{var r=new Date(i[e]);return r>=t&&r<=a}}_purgeOldData(e){let t=new Date(0),a=this._minDisplayStartTime.clone().addDays(-1);var r=e=>{var i=new Date(e.startTime);return i>=t&&i<=a};this._eventCache.getFilterEntries(r).then(t=>{if(t){var a=0;i.default.log("Removing "+t.length+" old calendar entries.");for(var r=0;r<t.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._eventCache.removeEntry(t[r].id)}}e&&e(!1)})}_offlineLoad(){if(this.isEnabled()){let a=this._eventCache.getMetadata(Ga);i.default.isEmpty(this._calendarList)&&(this._calendarList=a||{});var e=this._filterDates("startTime",this._minDisplayStartTime,this._maxDisplayStartTime);let s=!0;let n=this._eventCache.getPreloadData();if(n){try{i.default.PAssert(776,i.default.isObject(n),"Calendar preload is not object")}catch(t){i.default.reportError(t)}(a=>{i.default.batchRenderUpdates(()=>{Wr.PaneUpdateBatcher.beginUpdateItems();var n=this.getDefaultItemStore(),o=n.getRoot();Object.keys(a).forEach(l=>{let d=a[l];if(!s||e(d)){var h=this.createEntryFromLocal(d.id,d);this.cacheData(h.id,h,void 0,void 0,r.a.ChangeType.Auto);try{i.default.PAssert(775,!n.hasItem(h.id),"Load should never try to create a VMLI that has already been created")}catch(t){i.default.reportError(t)}if(this._eventNeedsItem(h)){if(h.source){var c=Wr.pluginManager.parseEmailURL(h.source.url);if(c.plugin&&!c.plugin.hasCacheData(c.threadID)){var u=c.plugin.createEntryFromLocal(c.threadID,{accountID:c.accountID,subject:h.source.title});c.plugin.cacheData(c.threadID,u)}}var p=this._createItem(n,h,o.id);o.insertItem(p)}}}),Wr.PaneUpdateBatcher.commitUpdateItems(),this._cacheCleanup.notifyWorkAvailable()})})(n)}return!0}}_activate(){}_deactivate(){Wr.PaneUpdateBatcher.beginUpdateItems(),this._hasInitializedTasks=!1,Wr.PaneUpdateBatcher.updateAllItems(!0,!0),Wr.PaneUpdateBatcher.commitUpdateItems()}_load(){!i.default.isDemoMode()&&this.isEnabled()&&(this.createRecurringTask("CalendarListSync",{delay:i.default.hours(2),minDelay:i.default.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runCalendarListSync}),this.createRecurringTask("CalendarEventSync",{delay:i.default.minutes(15),minDelay:i.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runCalendarSync}),this._hasInitializedTasks=!0)}goOnline(){this._hasInitializedTasks&&this.getRecurringTask("CalendarEventSync").forceUpdate()}handleTapStart(e,t,a,i){return!0}handleTapClick(e,t,a,s){var n=this.getCacheData(a);if(n){var o=this.getAttachment(a).getField("calendarID");let e=this._getCalendarInfo(o);if(e)try{i.default.PAssert(777,e.accountID,"Should have an accountID on the calendar")}catch(l){i.default.reportError(l)}if(n.eid&&e.accountID){let t="https://www.google.com/calendar/event?eid="+n.eid+"&authuser="+e.accountID;i.default.isDemoMode()?Wr.toasts.pushMessage(r.a.MessageID.DemoPluginClick):(i.default.openUrl(t,s),this.sendEvent("Tap_OpenGCalendarDesktop"))}return!0}return!1}_durationToString(e){var t=Math.round(e/6e4),a=0,i=0;t>0&&(t-=60*(a=Math.floor(t/60)),a>0&&(a-=24*(i=Math.floor(a/24))));var r="";return i>0&&(r+=i+"d "),a>0&&(r+=a+"h "),t>0&&(r+=t+"m "),r.trim()}_createItemDateText(e){return e.allDayEvent?e.startTime.toString(Wr.International.getFormat(r.a.DFormat.MonthDayYear)):e.startTime.toString(Wr.International.getFormat(r.a.DFormat.DayYearTime))}_createItemDurationText(e){var t,a=e.endTime-e.startTime;if(e.allDayEvent)if(a>i.default.days(1)){var s=e.endTime.clone();s.addMilliseconds(-1),t="until "+s.toString(Wr.International.getFormat(r.a.DFormat.MonthDayYear))}else t="";else t=this._durationToString(a);return t}_createItemSummaryText(e){var t;if(e.source&&e.source.url){var a=Wr.pluginManager.parseEmailURL(e.source.url);a.plugin&&(t=a.plugin._getTextForItem({id:a.threadID}))}return t||(t=e.summary?e.summary.replace(/\u2000/g,""):""),t}_createItemText(e){try{i.default.PAssert(778,e,"Must specify a valid attachment")}catch(t){i.default.reportError(t)}return this._createItemSummaryText(e)}_eventNeedsItem(e){return"cancelled"!==e.status&&!e.isArchived}_createItem(e,t,a){var s;try{i.default.PAssert(779,this._eventNeedsItem(t),"Item must always be required to cause create")}catch(h){i.default.reportError(h)}i.default.isDateValid(t.isComplete)&&(s=t.isComplete);let n=!t.allDayEvent&&t.endTime-t.startTime||void 0;var o={date:new C.a(new Date(t.startTime.getTime()),{gcalId:t.id,duration:n,gcalCalendar:t.calendarID}).toData(),priority:t.priority,isComplete:!!t.isComplete,isArchived:t.isArchived,dateCompleted:s,isStarred:t.isStarred},l=e.createItem(t.id,this._createItemText(t),a,o,r.a.ChangeType.Auto);if(t.description){var d=e.createItem(t.id+"_note",t.description,l.id,{isNote:!0},r.a.ChangeType.Auto);l.setNote(d,r.a.ChangeType.Auto)}return l}getRemoteAttachmentData(e){try{i.default.PAssert(780,e.hasField("calendarID")||!Wr.settings.fixedMissingCalendars.get(),"Must have a valid calendarID for an event")}catch(s){i.default.reportError(s)}if(e.hasField("calendarID")){var t=e.getField("calendarID");let n=this._getCalendarInfo(t);if(n)try{i.default.PAssert(781,n.accountID,"Should have an accountID on the calendar")}catch(s){i.default.reportError(s)}var a=pe.a.fns("calendar").events.get.packedFn,r={eventId:e.id,calendarId:t};n&&this._queueRemoteRequestMulti(n.accountID,a,r,a=>{try{i.default.PAssert(782,!a||a.id===e.id,"If valid result, attachment should match remote event ID")}catch(s){i.default.reportError(s)}if(a){var r=this._addRemoteEntry(t,a);this._eventCache.saveEntry(this.serializeExternalData(r))}},()=>{e.notifyDataRequestFailed()},e,ti)}else Wr.settings.fixedMissingCalendars.get()?e.isLoaded()&&e.updateField("status","cancelled"):(this.needsFixMissingData||(this.needsFixMissingData=[]),this.needsFixMissingData.push(e),i.default.timeoutOnce("fixcalendar",this.fixMissingCalendars,5e3,()=>this.needsFixMissingData=void 0,this.needsFixMissingData))}_createRemoteEntry(e,t){var a,r,s,n=!1;try{i.default.PAssert(783,t.start,"Must always have valid start data")}catch(h){i.default.reportError(h)}if(t.start.dateTime){try{i.default.PAssert(784,t.end.dateTime,"End date format should always match start")}catch(h){i.default.reportError(h)}a=new Date(t.start.dateTime),r=new Date(t.end.dateTime)}else if(t.start.date){try{i.default.PAssert(785,t.end.date,"End date format should always match start")}catch(h){i.default.reportError(h)}var o=t.start.date.split("-"),l=t.end.date.split("-");a=new Date(o[0],o[1]-1,o[2]),r=new Date(l[0],l[1]-1,l[2]),n=!0}t.htmlLink&&(s=t.htmlLink.split("?eid=")[1]);var d={id:t.id,calendarID:e,status:t.status,summary:t.summary,startTime:a,endTime:r,allDayEvent:n,recurringEventId:t.recurringEventId,eid:s,isComplete:this._getRemoteProperty(t,Ka),isArchived:this._getRemoteProperty(t,Qa),isStarred:this._getRemoteProperty(t,Xa),priority:this._getRemoteProperty(t,Ya),locked:t.locked||!1,attendees:t.attendees,location:t.location,description:t.description,organizer:t.organizer?t.organizer.displayName||t.organizer.email||t.organizer.id:"Unknown"};return t.source&&(d.source={title:t.source.title,url:t.source.url}),d}_addRemoteEntry(e,t){var a=this._createRemoteEntry(e,t);return this.cacheData(a.id,a),a}createEntryFromLocal(e,t){return t.startTime=t.startTime?new Date(t.startTime):void 0,t.endTime=t.endTime?new Date(t.endTime):void 0,t.isComplete=this._propConverter[Ka](t.isComplete),t.isArchived=this._propConverter[Qa](t.isArchived),t.isStarred=this._propConverter[Xa](t.isStarred),t.priority=this._propConverter[Ya](t.priority),t}_notifyFailedRequest(e,t){e&&e.error&&(e.error.code===r.a.HTTPStatusCode.Unauthorized?Wr.toasts.pushMessage(r.a.MessageID.LostPermission):e.error.code>=400&&e.error.code<500&&i.default.reportError(new Error("Failed GCalendar request: "+e.error.code),e))}_getRemoteProperty(e,t){try{i.default.PAssert(786,e,"Must provide valid event info")}catch(r){i.default.reportError(r)}try{i.default.PAssert(787,t,"Must provide valid remote prop")}catch(r){i.default.reportError(r)}try{i.default.PAssert(788,this._propConverter[t],"Missing prop converter: ",t)}catch(r){i.default.reportError(r)}var a;return e.extendedProperties&&e.extendedProperties.private&&(a=e.extendedProperties.private["MDCProp_"+t]),this._propConverter[t]&&(a=this._propConverter[t](a)),a}_updateAttachFromData(e,t){var a=[];for(var i in t)t.hasOwnProperty(i)&&e.isFieldDefined(i)&&(e.updateField(i,t[i]),a.push(i));return a}_runRemoteUpdate(e,t,a,r,s,n){try{i.default.PAssert(789,this.getSetting(this.Settings.WriteAccess),"Should not be calling _runRemoteUpdate without proper permission")}catch(p){i.default.reportError(p)}try{i.default.PAssert(790,!e.getField("locked"),"Should never try to modify an event that is locked")}catch(p){i.default.reportError(p)}try{i.default.PAssert(791,i.default.isBoolean(t)||i.default.isArray(t),"Must specify a boolean or list of fields for modified value")}catch(p){i.default.reportError(p)}try{i.default.PAssert(792,i.default.isFunction(r),"Must provide a valid localDoneCB")}catch(p){i.default.reportError(p)}try{i.default.PAssert(793,i.default.isFunction(s),"Must provide a valid remoteDoneCB")}catch(p){i.default.reportError(p)}try{i.default.PAssert(794,i.default.isFunction(n),"Must provide a valid allDoneCB")}catch(p){i.default.reportError(p)}var o,l,d,h,c=(e,t,a)=>{try{i.default.PAssert(795,i.default.isFunction(e),"Must supply a valid CB function")}catch(p){i.default.reportError(p)}try{i.default.PAssert(796,void 0!==t,"Must always pass success back from CB")}catch(p){i.default.reportError(p)}if(e.apply(this,Array.prototype.slice.call(arguments,1)),e===r){try{i.default.PAssert(797,void 0===o,"Local CB called twice")}catch(p){i.default.reportError(p)}o=t,d=a}else if(e===s){try{i.default.PAssert(798,void 0===l,"Remote CB called twice")}catch(p){i.default.reportError(p)}l=t,h=a}void 0!==o&&void 0!==l&&n(o,l,d,h)},u=this.getCacheData(e.id);try{i.default.PAssert(799,u,"Performing update on event that does not have local data")}catch(p){i.default.reportError(p)}u?(this.addModifiedOffline(u,t),this._eventCache.saveEntry(this.serializeExternalData(u)),a((a,i)=>{if(a){var n=this.getCacheData(e.id),o=!0!==t&&t;this.removeModifiedOffline(n,o),this._eventCache.saveEntry(this.serializeExternalData(n)),c(s,!0)}else c(r,!1),c(s,!1,i)})):(c(r,!1),c(s,!1))}_updateEvent(e,t,a,i,r,s){var n=this._updateAttachFromData(e,t);this._runRemoteUpdate(e,n,i=>{this._updateRemoteEvent(e.getField("calendarID"),e.id,t,a,i)},i,r,s)}_updateRemoteEvent(e,t,a,s,n){try{i.default.PAssert(800,this.getSetting(this.Settings.WriteAccess),"Should not be calling _updateRemoteEvent without proper permission")}catch(c){i.default.reportError(c)}try{i.default.PAssert(801,this.hasWritePermissionForCalendar(e),"Should not be calling _updateRemoteEvent for a read-only calendar")}catch(c){i.default.reportError(c)}var o=this._createEventUpdateInfo(a);let l=this._getCalendarInfo(e);try{i.default.PAssert(802,l.accountID,"Should have an accountID on the calendar")}catch(c){i.default.reportError(c)}var d=pe.a.fns("calendar").events.patch.packedFn,h={calendarId:e,eventId:t,resource:o};this._queueRemoteRequestMulti(l.accountID,d,h,()=>{n(!0)},a=>{if(a&&a.error&&a.error.code===r.a.HTTPStatusCode.NotFound)this._eventCache.removeEntry(t),n(!0);else{var s=Object.keys(o);if(i.default.log("Failed Update: ",e,t,s),i.default.isHTTPStatusCode(a,r.a.HTTPStatusCode.Forbidden)&&!this.isRateLimitError(a)){var l=this.getCacheData(t);l&&(l.locked=!0),this.cacheData(t,l,!0,["locked"])}n(!1,a),this._notifyFailedRequest(a,e)}},void 0,ii||s)}_updateRemoteProperty(e,t,a,i,r,s){e.updateField(t,a);var n={},o=void 0===a?null:a;n["MDCProp_"+t]=o;var l={extendedProperties:{private:n}};this._runRemoteUpdate(e,[t],t=>{this._updateRemoteEvent(e.getField("calendarID"),e.id,l,Za,t)},i,r,s)}_getStartEndFromDateInfo(e,t){var a,r,s,n=!1;if(e instanceof Date)e.hasTimeOfDay()||(n=!0),a=e,r=e.clone().addMilliseconds(t);else if(e instanceof C.a)a=e.getStart(),r=e.getEnd(),s=e.toICal();else try{i.default.PAssert(803,!1,"Should always have a valid date")}catch(o){i.default.reportError(o)}return{startTime:a,endTime:r,allDayEvent:n,recurrence:s}}deleteCalendarEventForItem(e,t,a,i,s){this.sendEvent("DeleteEvent");this._runRemoteUpdate(t,["status"],a=>{e.getMooDate().removeGCal(),e.onMooDateUpdated(r.a.ChangeType.Local,!0),e.onAttachInlineUpdate(),t.isLocalOnlyAttachment()?(t.updateField("status","cancelled"),a(!0)):this.deleteCalendarEvent(t,a)},a,i,s)}deleteCalendarEvent(e,t){try{i.default.PAssert(804,!e.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event")}catch(d){i.default.reportError(d)}let a=e.getField("calendarID"),s=this._getCalendarInfo(a);try{i.default.PAssert(805,s.accountID,"Should have an accountID on the calendar")}catch(d){i.default.reportError(d)}var n=pe.a.fns("calendar").events.delete.packedFn,o={calendarId:a,eventId:e.id},l=()=>{var a=this.getDefaultItemStore();e.updateField("status","cancelled"),e.forEachItem(a,e=>{e.parent()&&(e.parent().removeChild(e),e.setParent(void 0))}),this._eventCache.saveEntry(this.serializeExternalData(e.getData())),t(!0)};this._queueRemoteRequestMulti(s.accountID,n,o,()=>{l()},a=>{a&&a.error&&a.error.code===r.a.HTTPStatusCode.Gone?l():a&&a.error&&a.error.code===r.a.HTTPStatusCode.NotFound?l():(t(!1,a),this._notifyFailedRequest(a,e.getField("calendarID")))},void 0,si)}forceRemoteEventSync(){if(!i.default.isDemoMode()&&this._hasInitializedTasks){if(this.hasRecurringTask("CalendarEventSync"))this.getRecurringTask("CalendarEventSync").forceUpdate();if(this.hasRecurringTask("CalendarListSync"))this.getRecurringTask("CalendarListSync").forceUpdate()}}getDefaultExportCalendarID(){return i.default.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)}isExportCalendarID(e){return this.getSetting(this.Settings.ExportCalendar)===e}hasWritePermissionForAttach(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var a=e.getField("calendarID"),i=this._getCalendarInfo(a);i&&("writer"!==i.accessRole&&"owner"!==i.accessRole||(t=!0))}return t}hasWritePermissionForCalendar(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var a=this._getCalendarInfo(e);a&&("writer"!==a.accessRole&&"owner"!==a.accessRole||(t=!0))}return t}getCalendarBackgroundColor(e){var t="rgba(0, 120, 255, 0.85)",a=this._getCalendarInfo(e);return a&&a.backgroundColor&&(t=a.backgroundColor),t}getCalendarForegroundColor(e){var t="#000000",a=this._getCalendarInfo(e);return a&&a.foregroundColor&&(t=a.foregroundColor),t}getCalendarDisplayProps(e){var t,a=this._getCalendarInfo(e);return a&&"reader"===a.accessRole&&(t={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),t}shouldDisplayOverdueInAgenda(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)}createEventForEmail(e,t,a,r,s,n){try{i.default.PAssert(806,i.default.isString(e),"Must provide a valid calendarID for email")}catch(l){i.default.reportError(l)}try{i.default.PAssert(807,i.default.isString(t),"Must provide a valid subject")}catch(l){i.default.reportError(l)}try{i.default.PAssert(808,i.default.isString(a),"Must provide a valid email url")}catch(l){i.default.reportError(l)}try{i.default.PAssert(809,i.default.isDateValid(r),"Must provide a valid schedule date")}catch(l){i.default.reportError(l)}try{i.default.PAssert(810,i.default.isNumber(s),"Must provide a valid event duration")}catch(l){i.default.reportError(l)}this.sendEvent("AddEmailEvent");var o={duration:s,summary:t,date:r,source:{title:t,url:a}};this.createNewCalendarEvent(e,o,e=>{if(e){var t=this.getDefaultItemStore();if(!t.hasItem(e.id)){Wr.PaneUpdateBatcher.beginUpdateItems();var a=t.getRoot(),i=this._createItem(t,e,a.id);a.insertItem(i),Wr.PaneUpdateBatcher.commitUpdateItems()}}},i.default.newEmptyFn(),n)}createEventForItem(e,t){!e.hasPluginAttachment(this.id)&&e.getNextDate()&&((t=t||this.getDefaultExportCalendarID())?e.getDate()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(t,e,(t,a,i,s)=>{t||a?a?P.d.miscAction({type:P.b.Misc,misc:P.a.AddToGCal,data:{item:e}}):s&&s.error&&-1===s.error.code?P.d.miscAction({type:P.b.Misc,misc:P.a.AddToGCal,data:{item:e}}):Wr.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:r.a.MessageAction.Okay}):i&&!1===i.isValid?Wr.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:r.a.MessageAction.Okay}):Wr.toasts.pushMessage({text:'There was an error creating your calendar event. There may be a problem with your authorization. Please try toggling your "Save To" calendar off and back on, or try toggling the Google Calendar plugin off and on. Contact support@moo.do if you have questions',action:r.a.MessageAction.OpenCalendarSettings})})):(this.sendEvent("AddRepeatEvent"),Wr.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:r.a.MessageAction.Okay})):Wr.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:r.a.MessageAction.OpenCalendarSettings}))}newCalendarEventForItem(e,t,a){try{i.default.PAssert(811,t,"Must provide a valid item")}catch(l){i.default.reportError(l)}try{i.default.PAssert(812,t.getNextDate(),"Item must have a valid date")}catch(l){i.default.reportError(l)}try{i.default.PAssert(813,!t.hasPluginAttachment(r.a.PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item")}catch(l){i.default.reportError(l)}var s=t.getDuration();s||(s=t.allDayDate()?i.default.days(1):hi);var n={duration:s,summary:t.getCalendarParsedText()};if(t.getDate()&&(n.date=t.getDate()),t.hasNote()&&(n.description=t.getNote().getParsedText()),t.hasAttachmentType(r.a.PluginType.Email)){var o=t.getAttachmentByType(r.a.PluginType.Email);n.source={title:o.getField("subject"),url:o.getPlugin().createURLForThread(o)}}this.createNewCalendarEvent(e,n,e=>{if(e)if(t.isDestroyed()){var a=this.getDefaultItemStore();if(!a.hasItem(e.id)){Wr.PaneUpdateBatcher.beginUpdateItems();var i=a.getRoot(),s=this._createItem(a,e,i.id);i.insertItem(s),Wr.PaneUpdateBatcher.commitUpdateItems()}}else t.getMooDate().setGCalIdAndCalendar(e.id,e.calendarID),t.onMooDateUpdated(r.a.ChangeType.Local,!0),t.setTextToWhatItAlreadyIs(r.a.ChangeType.Local)},i.default.newEmptyFn(),a)}createNewCalendarEvent(e,t,a,r,s){try{i.default.PAssert(815,t,"Must have valid event info passed in")}catch(c){i.default.reportError(c)}try{i.default.PAssert(816,t.date,"Must have valid date for event")}catch(c){i.default.reportError(c)}try{i.default.PAssert(817,void 0!==t.duration,"Must have a valid event duration")}catch(c){i.default.reportError(c)}try{i.default.PAssert(818,t.summary,"Must have a valid event summary")}catch(c){i.default.reportError(c)}try{i.default.PAssert(819,i.default.isFunction(a),"Must supply a valid local done CB")}catch(c){i.default.reportError(c)}try{i.default.PAssert(820,i.default.isFunction(r),"Must supply a valid remote done CB")}catch(c){i.default.reportError(c)}var n=i.default.generateTempId(),o=this._getStartEndFromDateInfo(t.date,t.duration);let l=this._getCalendarInfo(e);if(l){try{i.default.PAssert(821,l.accountID,"Should have an accountID on the calendar")}catch(c){i.default.reportError(c)}var d={id:n,calendarID:e,status:"confirmed",summary:t.summary,source:t.source,description:t.description,startTime:o.startTime,endTime:o.endTime,allDayEvent:o.allDayEvent,recurrence:o.recurrence,organizer:l.accountID,modifiedOffline:!0};this.cacheData(n,d),this._eventCache.saveEntry(d),a(d,!0);var h=this.getAttachment(d.id);i.default.isDemoMode()?(r(!0),s(!0,!0)):this._runRemoteUpdate(h,!0,t=>{this._createRemoteEventFromCacheData(e,d,i.default.newEmptyFn(),t,s)},i.default.newEmptyFn(),r,()=>{this.getDefaultItemStore().updateItems()})}}_createRemoteEventFromCacheData(e,t,a,r,s){try{i.default.PAssert(822,!this._pendingCreates[t.id],"Should never try and double create a calendar event")}catch(c){i.default.reportError(c)}var n,o,l,d;this._pendingCreates[t.id]=!0;var h=(e,t,h)=>{try{i.default.PAssert(823,i.default.isFunction(e),"Must supply a valid CB function")}catch(c){i.default.reportError(c)}try{i.default.PAssert(824,void 0!==t,"Must always pass success back from CB")}catch(c){i.default.reportError(c)}if(e.apply(this,Array.prototype.slice.call(arguments,1)),e===a){try{i.default.PAssert(825,void 0===n,"Local CB called twice")}catch(c){i.default.reportError(c)}n=t,l=h}else if(e===r){try{i.default.PAssert(826,void 0===o,"Remote CB called twice")}catch(c){i.default.reportError(c)}o=t,d=h}void 0!==n&&void 0!==o&&s(n,o,l,d)};this._createNewRemoteEvent(e,t,(i,s)=>{delete this._pendingCreates[t.id],Wr.PaneUpdateBatcher.beginUpdateItems();var n=this.getAttachment(t.id);if(i){var o=t.id;this.changeID(n,n.id,i.id);var l=this.getDefaultItemStore(),d=l.getRoot();l.hasItem(o)&&l.destroyItem(o),this._eventCache.removeEntry(o);var c=this._addRemoteEntry(e,i),u=this._createItem(l,c,d.id);d.insertItem(u),this._eventCache.saveEntry(this.serializeExternalData(c)),h(a,!0),n.updateField("isInvalid",!1),h(r,!0)}else n.updateField("isInvalid",!0),h(a,!1),h(r,!1,s);Wr.PaneUpdateBatcher.commitUpdateItems()})}_createNewRemoteEvent(e,t,a){try{i.default.PAssert(827,t,"Must specify valid event info")}catch(d){i.default.reportError(d)}try{i.default.PAssert(828,t.startTime instanceof Date,"Must have a valid start time")}catch(d){i.default.reportError(d)}try{i.default.PAssert(829,t.endTime instanceof Date,"Must have a valid end time")}catch(d){i.default.reportError(d)}try{i.default.PAssert(830,t.summary,"Must have a valid event title")}catch(d){i.default.reportError(d)}let r=this._getCalendarInfo(e);try{i.default.PAssert(831,r.accountID,"Should have an accountID on the calendar")}catch(d){i.default.reportError(d)}var s,n;t.allDayEvent?(s={date:t.startTime.toString("yyyy-MM-dd")},n={date:t.endTime.toString("yyyy-MM-dd")}):(s={dateTime:t.startTime.toISOString()},n={dateTime:t.endTime.toISOString()});var o=pe.a.fns("calendar").events.insert.packedFn,l={calendarId:e,resource:{start:s,end:n,recurrence:t.recurrence,summary:t.summary,description:t.description,status:t.status,source:t.source}};this._queueRemoteRequestMulti(r.accountID,o,l,e=>{a(e)},t=>{a(void 0,t),this._notifyFailedRequest(t,e)},void 0,ai)}getImportCalendarList(){var e=this.getSetting(this.Settings.ImportCalendars);if(e)return e.filter(e=>this.hasSyncAccount(e.accountID,!0))}getReadableCalendarList(e){return this._getCalendarList("reader",e)}getWritableCalendarList(e){return this._getCalendarList("writer",e)}getWritableCalendarListSync(e){var t=this.getImportCalendarList();if(t)return t.filter(t=>(!e||t.accountID===e||!t.accountID&&e===Wr.settings.getUserIdentifier())&&("writer"===t.accessRole||"owner"===t.accessRole))}getFullCalendarList(e){var t=this.getImportCalendarList();this.getReadableCalendarList(a=>{if(t&&a){var r=t.map(e=>{if(!i.default.isObject(e))return{id:e,accessRole:"none"};var t=i.default.clone(e);return t.accessRole="none",t}).filter(e=>{if(this.hasSyncAccount(e.accountID)){for(var t=0,i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].id===e.id)return!1}return!0}});a.pushArray(r)}e(a)})}createCalendar(e,t,a){var i=pe.a.fns("calendar").calendars.insert.packedFn,r={resource:{summary:t}};this._queueRemoteRequestMulti(e,i,r,e=>{a(e)},e=>{a(),this._notifyFailedRequest(e,void 0)},void 0,ni,{}),this.sendEvent("CreateCalendar")}_getCalendarList(e,t){let a=this.getSyncAccounts(!0),r=a.length,s=[],n=e=>{r--,e&&(s=i.default.arrayUniques(s.concat(e))),0===r&&t(s)};if(0===a.length)t([]);else for(var o=0,l=0;l<a.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;this._getCalendarListForAccount(a[l],e,n)}}_getCalendarListForAccount(e,t,a){var i=pe.a.fns("calendar").calendarList.list.packedFn,r={minAccessRole:t,userId:"me"};this._queuePagedRemoteRequestMulti(e,i,r,t=>{t=t.map(t=>(t.accountID=e,t)),a(t)},e=>{a(),this._notifyFailedRequest(e,void 0)},void 0,ei,{getAllPages:!0,timeoutMS:0})}handleEventUpdate(e,t){this._numEntriesSyncd++;var a=this.getDefaultItemStore();if("cancelled"===t.status){if(this.hasAttachment(t.id)){let i=this.getAttachment(t.id);i.getField("calendarID")===e&&(this._eventCache.removeEntry(t.id),this.hasCacheData(t.id)&&(i.updateField("status","cancelled"),i.forEachItem(a,e=>{e.parent()&&(e.parent().removeChild(e,r.a.ChangeType.Remote),e.setParent(void 0))})))}}else{var s=this.getCacheData(t.id),n=this._createRemoteEntry(e,t);s&&s.modifiedOffline&&this._mergeEventData(s,n),this.cacheData(n.id,n),this._eventCache.saveEntry(this.serializeExternalData(n));var o=a.getRoot();let r=this.getAttachment(t.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(r,s,n)}catch(d){i.default.reportError(d)}if(this._endIgnorePropertyChanges(),!a.hasItem(n.id)&&this._shouldDisplayTime(n.startTime,n.endTime)&&this._eventNeedsItem(n)){var l=this._createItem(a,n,o.id);o.insertItem(l)}}}_mergeEventData(e,t){var a=0;try{i.default.PAssert(834,e.modifiedOffline,"Should only merge events that were locally modified")}catch(o){i.default.reportError(o)}var r=e.modifiedOffline;try{i.default.PAssert(835,i.default.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(o){i.default.reportError(o)}for(var s=0;s<r.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=r[s];0,t[n]=e[n]}t.modifiedOffline=e.modifiedOffline}updateVMLIsFromUpdate(e,t,a){try{i.default.PAssert(836,e,"Must provide a valid attachment")}catch(s){i.default.reportError(s)}try{i.default.PAssert(837,a,"Must provide valid new data")}catch(s){i.default.reportError(s)}if(t)e.hasInlineData(),e.forEachItem(void 0,e=>{e.getParsedText();(e.belongsToItemStore(Wr.itemStoreManager.getTempItemStore())&&e.getRawText().includes("calendarID"),t.summary!==a.summary)&&(e.hasAttachmentType(r.a.PluginType.Email)||a.summary&&a.summary.replace(/\u2000/g,""));if(t.description!==a.description&&e.belongsToItemStore(this.getDefaultItemStore()))if(e.hasNote())if(a.description){e.getNote().setText(a.description,r.a.ChangeType.Remote)}else e.setNote(void 0,r.a.ChangeType.Remote);else if(a.description){var i=a.id+"_note";let t;this.getDefaultItemStore().hasItem(i)?(t=this.getDefaultItemStore().getItem(i)).setText(a.description,r.a.ChangeType.Remote):t=this.getDefaultItemStore().createItem(i,a.description,e.id,{isNote:!0},r.a.ChangeType.Remote),e.setNote(t,r.a.ChangeType.Remote)}this.areDatesEqual(t.isComplete,a.isComplete)||e.setComplete(!!a.isComplete,r.a.ChangeType.Remote),t.isArchived!==a.isArchived&&e.setArchived(a.isArchived),t.isStarred!==a.isStarred&&e.setStarred(a.isStarred,r.a.ChangeType.Remote),t.priority!==a.priority&&e.setPriority(a.priority,r.a.ChangeType.Remote)});else{this._createItemText(a);e.forEachItem(void 0,e=>{e.setTextToWhatItAlreadyIs(r.a.ChangeType.Remote)})}}setSyncToken(e,t){try{i.default.PAssert(838,i.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(s){i.default.reportError(s)}try{i.default.PAssert(839,i.default.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(s){i.default.reportError(s)}let a=this._eventCache.getMetadata(Wa)||{};var r=Date.now()+this._syncTokenDuration;a[e]={token:t,date:Date.now(),expires:r},this._eventCache.setMetadata(Wa,a)}clearSyncToken(e){try{i.default.PAssert(840,i.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(a){i.default.reportError(a)}let t=this._eventCache.getMetadata(Wa);t&&(delete t[e],this._eventCache.setMetadata(Wa,t))}clearCalendarEventCache(e,t){try{i.default.PAssert(841,i.default.isString(e),"Must provide a valid calendar ID to clear event cache for")}catch(r){i.default.reportError(r)}var a=t=>t.calendarID===e;this._eventCache.getFilterEntries(a).then(e=>{if(e){for(var a=0,i=0;i<e.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._eventCache.removeEntry(e[i].id)}t&&t(!0)}else t&&t(!1)})}_calendarSyncComplete(e,t){if(t.length>0){if($.a.notifySyncError(t),this.isOnline()){var a=0;for(let e=0;e<t.length;++e){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t[e].result!==r.a.SyncResult.FailureNetwork&&Wr.toasts.pushMessage(r.a.MessageID.CalendarSync)}}}else $.a.notifySyncError(void 0),Wr.toasts.clearMessage(r.a.MessageID.CalendarSync);var i=this.getSetting(this.Settings.ExportCalendar);if(i){var s=0,n=!1;for(let e=0;e<t.length;++e){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(t[e].id===i){n=!0;break}}n||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}this.onCalendarsSynced.notify()}_shouldExpireToken(e){var t=!0;return e&&(e.expires?t=e.expires<Date.now():e.date&&(t=e.date+this._syncTokenDuration<Date.now())),t}_getCalendarInfo(e){return this._calendarList[e]}allowTextEditing(e,t){var a=!1;if(this.getSetting(this.Settings.WriteAccess)){var i=t.getField("calendarID");(this.hasWritePermissionForCalendar(i)||t.isLocalOnlyAttachment())&&(a=!0)}return a}_createCalendarFromRemote(e){var t={id:e.id,accountID:e.accountID,summary:e.summary,accessRole:e.accessRole};return i.default.isValidColor(e.backgroundColor)&&(t.backgroundColor=e.backgroundColor),i.default.isValidColor(e.foregroundColor)&&(t.foregroundColor=e.foregroundColor),t}runCalendarListSync(e){this.getReadableCalendarList(t=>{if(t){var a=0;this._calendarList={};for(var i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t[i];this._calendarList[s.id]=this._createCalendarFromRemote(s)}Wr.toasts.clearMessage(r.a.MessageID.CalendarSync);var n=this.getDefaultExportCalendarID();n&&!this._calendarList[n]&&(this.setSetting(this.Settings.ExportCalendar,void 0),Wr.toasts.pushMessage({text:"Your Default Save calendar is no longer accessible. Please select another or update your sync accounts.",action:r.a.MessageAction.OpenCalendarSettings})),this._eventCache.setMetadata(Ga,this._calendarList)}else this.isOnline()&&Wr.toasts.pushMessage(r.a.MessageID.CalendarSync);e&&e()})}_notifyTokenExpired(e){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)}_notifyCalendarUnsyncd(e){i.default.log("Detected calendar "+e+" is no longer syncd"),this._clearCachedData(e,t=>{t||i.default.log("Failure unsyncing calendar "+e)}),this._clearCalendarItems(e)}_clearCalendarItems(e){var t=this.getDefaultItemStore();Wr.PaneUpdateBatcher.beginUpdateItems(),t.forEach(a=>{a.hasAttachments()&&(a.getAttachment(0).getField("calendarID")===e&&t.destroyItem(a.id))}),Wr.PaneUpdateBatcher.commitUpdateItems()}_getSyncResultFromResult(e,t){var a=r.a.SyncResult.Success;if(t&&t.error&&t.error.code){var i=t.error.code;if(i===r.a.HTTPStatusCode.Unauthorized){var s=this._getCalendarInfo(e);a=s&&"owner"===s.accessRole?r.a.SyncResult.FailureOAuth:s&&"writer"===s.accessRole?r.a.SyncResult.FailureNoWrite:r.a.SyncResult.FailureNoRead}else a=i===r.a.HTTPStatusCode.NotFound?r.a.SyncResult.FailureNoRead:i===r.a.HTTPStatusCode.Network?r.a.SyncResult.FailureNetwork:i===r.a.HTTPStatusCode.Forbidden?r.a.SyncResult.FailureNoRead:r.a.SyncResult.FailureUnknown}return a}runCalendarSync(e,t){var a=0,s=0,n=[],o=[],l=(t,l,d)=>{try{i.default.PAssert(842,s<a,"Should never have more calendars syncd than we tried to sync")}catch(h){i.default.reportError(h)}t?n.push({id:l,result:r.a.SyncResult.Success}):o.push({id:l,result:this._getSyncResultFromResult(l,d)}),++s===a&&(this._calendarSyncComplete(n,o),e&&e())};let d=this._eventCache.getMetadata(Wa);this._updateSyncTimes();var h=this.getImportCalendarList();if(h&&h.length>0){var c=0;a=h.length;for(var u=0;u<h.length;++u){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var p=h[u];i.default.isObject(p)||(p={id:h[u]});var g,f=d?d[p.id]:void 0;this._shouldExpireToken(f)?(this._notifyTokenExpired(p.id),g=void 0):g=f.token,this.performCalendarSync(p,g,l,t)}for(let e in d)if(d.hasOwnProperty(e)){var m=0,v=!1;for(u=0;u<h.length;++u){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;p=h[u];if(i.default.isObject(p)||(p={id:h[u]}),p.id===e){v=!0;break}}v||this._notifyCalendarUnsyncd(e)}}else this._clearAllData(),this._calendarSyncComplete([],[]),e&&e()}performCalendarSync(e,t,a,s){let n=e.id,o=e.accountID;try{i.default.PAssert(843,i.default.isString(n),"Must provide a valid calendar ID for each sync op")}catch(h){i.default.reportError(h)}if(!o){let t=this._getCalendarInfo(e.id);t&&(o=t.accountID),o||(o=Wr.settings.getUserIdentifier())}var l=pe.a.fns("calendar").events.list.packedFn,d={calendarId:n,singleEvents:!0};s||(t?d.syncToken=t:(d.timeMin=this._minSyncStartTime.toISOString(),d.timeMax=this._maxSyncStartTime.toISOString()));this._queuePagedRemoteRequestMulti(o,l,d,(e,t,i)=>{var r,s=0;i&&(r=i.nextSyncToken,this.setSyncToken(n,r)),Wr.PaneUpdateBatcher.beginUpdateItems();for(var o=0;o<e.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;this.handleEventUpdate(n,e[o])}Wr.PaneUpdateBatcher.commitUpdateItems(),a(!0,n)},t=>{t&&t.error&&t.error.code===r.a.HTTPStatusCode.Gone?this._clearCachedData(n,i=>{i?this.performCalendarSync(e,void 0,a,s):a(!1,n,t)}):(a(!1,n,t),this._notifyFailedRequest(t,n))},void 0,Ja,{getAllPages:!0,timeoutMS:0})}_createEventUpdateInfo(e){var t={};for(var a in e)e.hasOwnProperty(a)&&qa.indexOf(a)>=0&&(t[a]=e[a]);return t}_notifyOfflineSyncFailures(e,t,a){t>0&&($.a.notifySyncError(a),i.default.log("Failed to sync offlineChanges: ",t))}_syncOfflineChanges(e){if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var t=0,a=0,s=0,n=[],o=(i,o)=>{o===r.a.SyncResult.Success?a++:(s++,n.push({id:i,result:o})),t===a+s&&(this._syncingOfflineChanges=!1,e(a,s,n))},l=e=>!!e.modifiedOffline;this._eventCache.getFilterEntries(l).then(e=>{t=e.length,e.forEach(e=>{var t=this.createEntryFromLocal(e.id,e);if(!t.isInvalid){let e=t.calendarID;i.default.isTempId(t.id)&&!this._pendingCreates[t.id]?this._createRemoteEventFromCacheData(t.calendarID,t,i.default.newEmptyFn(),(t,a)=>{o(e,this._getSyncResultFromResult(e,a))},i.default.newEmptyFn()):this.hasWritePermissionForCalendar(e)?this._updateRemoteEvent(e,t.id,t,ri,(a,i)=>{a?(delete t.modifiedOffline,this._eventCache.saveEntry(t).then(()=>o(e,r.a.SyncResult.Success)).catch(()=>o(e,r.a.SyncResult.FailureUnknown))):o(e,this._getSyncResultFromResult(e,i))}):(delete t.modifiedOffline,this._eventCache.saveEntry(t),o(t.calendarID,r.a.SyncResult.Success))}})})}}_getEventDuration(e){try{i.default.PAssert(844,!e.getField("allDayEvent"),"All day events do not have valid durations")}catch(r){i.default.reportError(r)}var t=e.getField("startTime"),a=e.getField("endTime");try{i.default.PAssert(845,t&&a,"Must always have valid start and end times")}catch(r){i.default.reportError(r)}return a-t}_computeItemDates(e,t,a){var i,r;t.getDate()&&(r=(i=t.getDate().clone()).clone().addMilliseconds(t.getDuration())),i&&r&&(t.allDayDate()?(e.start={date:i.toString("yyyy-MM-dd"),dateTime:null},e.end={date:r.toString("yyyy-MM-dd"),dateTime:null}):(e.start={dateTime:i.toISOString(),date:null},e.end={dateTime:r.toISOString(),date:null})),e.startTime=i,e.endTime=r}_queueEventUpdate(e,t){if(this._updateAttachFromData(e,t),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!e.isLocalOnlyAttachment()){var a=this._eventUpdateQueue[e.id];if(a)for(var i in t)t.hasOwnProperty(i)&&(a.info[i]=t[i]);else this._eventUpdateQueue[e.id]={attach:e,info:t}}}onShutdown(){}_flushEventUpdateQueue(){this._eventUpdateTimeout=void 0;var e=(e,t)=>{e||t?Wr.toasts.clearMessage(r.a.MessageID.CalendarSaveFail):Wr.toasts.pushMessage(r.a.MessageID.CalendarSaveFail)};for(var t in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(t)){var a=this._eventUpdateQueue[t];this._updateEvent(a.attach,a.info,oi,i.default.newEmptyFn(),i.default.newEmptyFn(),e)}this._eventUpdateQueue={}}_handleAttachDeleted(e,t){var a=e.getField("status");this.deleteCalendarEvent(e,s=>{if(s){var n=()=>{this._updateEvent(e,{status:a},li,i.default.newEmptyFn(),e=>{e||Wr.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:n,timeout:1e4})},i.default.newEmptyFn());var s=this._createItemText(e.getData());t.setText(s,r.a.ChangeType.Local),t.parent()||t.setParent(this.getDefaultItemStore().getRoot()),t.getIndex()<0&&t.parent().insertItem(t)};Wr.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:n,timeout:1e4})}else Wr.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:this._handleAttachDeleted.bind(this,e,t),timeout:1e4})})}notifyItemNoteChanged(e,t){this._queueEventUpdate(e,{description:t.getRawText()})}notifyItemDateChanged(e,t){var a={};this._computeItemDates(a,t,e),this._queueEventUpdate(e,a)}notifyItemTextChanged(e,t,a){if(a)this._handleAttachDeleted(e,t);else if(e.getField("recurringEventId")&&t.getCalendarParsedText()===e.getField("summary"))Wr.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!i.default.isDemoMode())if(t.getDate()){var s,n=t.getCalendarParsedText(),o=e.getField("summary"),l=e.getField("source");if(t.hasAttachmentType(r.a.PluginType.Email)){var d=t.getAttachmentByType(r.a.PluginType.Email);s={title:d.getField("subject"),url:d.getPlugin().createURLForThread(d)}}var h={summary:n,start:void 0,end:void 0,source:void 0},c=!1;n!==o&&(c=!0),l&&!s||!l&&s?c=!0:l&&s&&(l.title===s.title&&l.url===s.url||(c=!0));var u=t.getDate(),p=e.getField("startTime");this.areDatesEqual(p,u)||(c=!0);var g=t.getEndDate(),f=e.getField("endTime");this.areDatesEqual(f,g)||(c=!0),c&&(this._computeItemDates(h,t,e),h.source=s,this._queueEventUpdate(e,h)),e.updateField("isInvalid",!1)}else e.updateField("isInvalid",!0)}_beginIgnorePropertyChanges(){this._ignoringPropertyChanges=!0}_endIgnorePropertyChanges(){this._ignoringPropertyChanges=!1}_isIgnoringPropertyChanges(){return this._ignoringPropertyChanges}notifyItemPropertyChanged(e,t,a){if(this.getSetting(this.Settings.WriteAccess)&&!e.getField("locked")&&this.hasWritePermissionForCalendar(e.getField("calendarID"))&&(!i.default.isRemoteChange(a)||!this._isIgnoringPropertyChanges())){var s=e.getField("isComplete"),n=e.getField("isArchived"),o=e.getField("isStarred"),l=e.getField("priority"),d=t.dateCompleted,h=t.isArchived(),c=t.isStarred(),u=t.getPriority(),p=i.default.newEmptyFn(),g=i.default.newEmptyFn(),f=(e,t,a,i)=>{e||t?Wr.toasts.clearMessage(r.a.MessageID.CalendarSaveFail):Wr.toasts.pushMessage(r.a.MessageID.CalendarSaveFail)};this.areDatesEqual(s,d)||(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isComplete",d,p,g,f):e.updateField("isComplete",d)),n!==h&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isArchived",h,p,g,f):e.updateField("isArchived",h)),o!==c&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isStarred",c,p,g,f):e.updateField("isStarred",c)),l!==u&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"priority",u,p,g,f):e.updateField("priority",u))}}_clearCachedData(e,t){this.clearSyncToken(e),this.clearCalendarEventCache(e,t)}_clearAllData(e){this._eventCache.clearMetadata(),this._eventCache.clearCache().then(()=>{e&&e(!0)}),this.getDefaultItemStore().clearStore()}getAttachmentClass(e){var t=["plugin_gcalendar","c-date"];return e.isLoaded()&&(e.getField("isInvalid")&&t.push("invalid"),"cancelled"===e.getField("status")&&t.push("eventDeleted")),t}getAttachmentTooltip(e){var t;return this.isPluginBlocked()?t="Go premium to view calendar events":e.isLoaded()?(e.isLocalOnlyAttachment()?t="Syncing event...":e.getField("isInvalid")&&(t="Item has an invalid date"),"cancelled"===e.getField("status")&&(t="Item was deleted from Google Calendar")):t="Plugin is loading data",t}areDatesEqual(e,t){var a=!1;return e&&t?i.default.isDateValid(e)&&i.default.isDateValid(t)&&(a=e.equals(t)):a=!e&&!t,a}parsePriority(e){var t=i.default.parseInt(e);return isNaN(t)&&(t=r.a.VMLIFlag.None),t}fieldsHaveParseEffect(e){return(!e||1!==e.length||"isComplete"!==e[0])&&super.fieldsHaveParseEffect(e)}changeCalendarForEvent(e,t){try{i.default.PAssert(847,e.hasField("calendarID"),"Must have a valid calendarID for an event")}catch(h){i.default.reportError(h)}let a=e.getField("calendarID"),s=this._getCalendarInfo(a),n=s.id;try{i.default.PAssert(848,s.accountID,"Should have an accountID on the calendar")}catch(h){i.default.reportError(h)}var o=pe.a.fns("calendar").events.move.packedFn,l={eventId:e.id,calendarId:a,destination:t};e.updateField("calendarID",t,!0);var d=()=>{e.forEachItem(Wr.itemStoreManager.getDefaultItemStore(),e=>{let a=e.getMooDate();a&&(a.setGCalCalendar(t),e.onMooDateUpdated(r.a.ChangeType.Local,!0),e.setTextToWhatItAlreadyIs(r.a.ChangeType.Local))})};this._queueRemoteRequestMulti(s.accountID,o,l,d,t=>{e.updateField("calendarID",n,!0),t&&t.error&&t.error.code===r.a.HTTPStatusCode.Gone?d():(t&&t.error&&(t.error.code,r.a.HTTPStatusCode.NotFound),this._notifyFailedRequest(t,e.getField("calendarID")))},void 0,di)}getCalendarForAttach(e){if(e.hasField("calendarID"))return this._getCalendarInfo(e.getField("calendarID"))}fixMissingCalendars(){this.runCalendarSync(),Wr.settings.fixedMissingCalendars.set(!0)}getWriteableCalendarsForItem(e){let t,a,i;if(this.isAvailable()&&this.isEnabled()){if(e.hasPluginAttachment(r.a.PluginID.GCalendar)){let i=e.getAttachmentByPlugin(r.a.PluginID.GCalendar),s=this.getCalendarForAttach(i);s&&(a=s.id,t=s.accountID)}i=this.getWritableCalendarListSync(t)}return{selected:a,calendars:i}}setCalendarForItem(e,t){let a=e.getAttachmentByPlugin(r.a.PluginID.GCalendar);t?e.hasPluginAttachment(r.a.PluginID.GCalendar)?this.changeCalendarForEvent(a,t):this.createEventForItem(e,t):e.hasPluginAttachment(r.a.PluginID.GCalendar)&&this.deleteCalendarEventForItem(e,a,i.default.newEmptyFn(),i.default.newEmptyFn(),()=>{console.log("Done")})}onSyncAccountsChanged(e,t){t&&Object.keys(t).forEach(a=>{!t[a][this.id]||e[a]&&e[a][this.id]||this._clearCachedData(a)}),this.isActive()&&Object.keys(e).some(a=>e[a][this.id]&&(!t[a]||!t[a][this.id]))&&this.runCalendarSync()}},p()(ja.prototype,"_purgeOldData",[f.a],Object.getOwnPropertyDescriptor(ja.prototype,"_purgeOldData"),ja.prototype),p()(ja.prototype,"createEventForItem",[f.a],Object.getOwnPropertyDescriptor(ja.prototype,"createEventForItem"),ja.prototype),p()(ja.prototype,"runCalendarListSync",[f.a],Object.getOwnPropertyDescriptor(ja.prototype,"runCalendarListSync"),ja.prototype),p()(ja.prototype,"runCalendarSync",[f.a],Object.getOwnPropertyDescriptor(ja.prototype,"runCalendarSync"),ja.prototype),p()(ja.prototype,"_flushEventUpdateQueue",[f.a],Object.getOwnPropertyDescriptor(ja.prototype,"_flushEventUpdateQueue"),ja.prototype),p()(ja.prototype,"parsePriority",[f.a],Object.getOwnPropertyDescriptor(ja.prototype,"parsePriority"),ja.prototype),p()(ja.prototype,"fixMissingCalendars",[f.a],Object.getOwnPropertyDescriptor(ja.prototype,"fixMissingCalendars"),ja.prototype),p()(ja.prototype,"onSyncAccountsChanged",[f.a],Object.getOwnPropertyDescriptor(ja.prototype,"onSyncAccountsChanged"),ja.prototype),ja),pi=i.default.seconds(30);var gi,fi=(ci=class extends g.a{constructor(){super(),this._plugins={},this._activePlugins=[],this._loadedDependencies={},this._iteratingPlugins=!1,this._hasAdjustedCacheSizeRatio=!1,this._queueTimeout=void 0,this._forcedLastPossible=!1,this._numOutstandingReqs=0,this._pluginRenderer=new ae}init(){this._setupRequestQueues();try{this._pluginRenderer.registerDefaultRenderers()}catch(e){console.log(e)}i.default.isDemoMode()&&this.notifyDependencyLoad(r.a.PluginDependency.DemoMode),o.a.onlineStatus.listen(e=>{"Online"===e&&this.goOnline()}),y.a.onForeground.listen(this.goOnline),n.a.listen("resetEverything",this._clearRequestQueues),this.registerPlugins()}printStats(e){if(i.default.log("---- Plugin Stats ----"),void 0!==e){let t=this._plugins[e];i.default.log(t.name),i.default.log(" Stats: ",t.getStats())}else for(var t=0,a=Object.keys(this._plugins),r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let e=this._plugins[a[r]];var s=e.getStats();i.default.log(e.name),i.default.log(" Stats: ",s)}i.default.log("----------------------")}dumpQueueState(){var e=0,t=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._plugins[t[a]];console.log(i.name),i.dumpRequestQueue(!1)}}dumpQueueStats(){for(var e=0,t=Object.keys(this._plugins),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._plugins[t[a]];console.log(i.name),i.dumpQueueStats()}}getStats(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getStats();else for(var a=0,i=Object.keys(this._plugins),r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._plugins[i[r]];t[s.id]=s.getStats()}return t}getCacheStats(e,t){var a={};if(void 0!==e)this._plugins[e].getCacheStats(t);else for(var i=0,r=Object.keys(this._plugins),s=0,n=0;n<r.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._plugins[r[n]].getCacheStats(function(e,i){i&&(a[e]=i),r.length===++s&&t(a)}.bind(this,r[n]))}}getState(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getState();else for(var a=0,i=Object.keys(this._plugins),r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._plugins[i[r]];t[s.id]=s.getState()}return t}registerPlugins(){try{this.registerPlugin(new za)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new it)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new Fa)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new ui)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new ot)}catch(e){i.default.reportError(e)}this.registerPlugin(new Pe)}registerPlugin(e){try{i.default.PAssert(427,!this._plugins[e.id],"Should never double-register a plguin")}catch(t){i.default.reportError(t)}this._plugins[e.id]=e,this.isAuthorized(e.id)&&this.loadPlugin(e.id)}getPlugin(e){return this._plugins[e]}getPluginGmail(){return this._plugins[r.a.PluginID.Gmail]}getPluginDrive(){return this._plugins[r.a.PluginID.Drive]}getPluginGCalendar(){return this._plugins[r.a.PluginID.GCalendar]}loadPlugin(e){var t=this.getPlugin(e);try{i.default.PAssert(428,t,"Must register a plugin before loading it")}catch(a){i.default.reportError(a)}this.activatePlugin(t)}unloadPlugin(e){}authorizePlugin(e,t,a){a(!0)}deauthorizePlugin(e,t){try{i.default.PAssert(431,t&&i.default.isFunction(t),"Must provide a valid callback fn")}catch(s){i.default.reportError(s)}var a=this.getPlugin(e);try{i.default.PAssert(432,a,"Must register a plugin before loading it")}catch(s){i.default.reportError(s)}a.setSetting(a.Settings.IsEnabled,!1),i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Plugin Deauthorized: ",e),this.deactivatePlugin(a),t(!0)}onPluginAuthorized(e,t){e.setSetting(e.Settings.IsEnabled,t),i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Plugin Authorized: ",e.id,t),t&&this.activatePlugin(e)}activatePlugin(e){try{i.default.PAssert(433,e,"Plugin must be valid to be activated")}catch(t){i.default.reportError(t)}e.activate(this._loadedDependencies)&&this._activePlugins.indexOf(e.id)<0&&this._activePlugins.push(e.id),e.ensurePaneTypeIsActive(),i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Plugin Activated: ",e.id)}deactivatePlugin(e){try{i.default.PAssert(434,e,"Plugin must be valid to be deactivated")}catch(t){i.default.reportError(t)}this._activePlugins.indexOf(e.id)>=0&&(e.deactivate()&&this._activePlugins.remove(e.id),i.default.shouldLog(r.a.LogLevels.Plugin)&&i.default.log("Plugin Deactivated: ",e.id))}isOnline(){return o.a.isConnected()||i.default.isDemoMode()}goOnline(){setTimeout(()=>{var e=0;this._setupRequestQueues(!0);for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.goOnline()}catch(i){this._reportPluginError(i)}}},0)}onDocumentShared(e){for(var t=0,a=0;a<this._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._plugins[this._activePlugins[a]];try{i.onDocumentShared(e)}catch(r){this._reportPluginError(r)}}}onShutdown(){for(var e=0,t=[],a=0;a<this._activePlugins.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._plugins[this._activePlugins[a]];try{var r=i.onShutdown();r&&t.push(r)}catch(s){this._reportPluginError(s)}}return t.length>0?t:void 0}onClearData(){for(var e=0,t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.clearData()}catch(i){this._reportPluginError(i)}}}getCacheSizeRatio(){var e=Wr.settings.cacheSizeRatio.get()||1;try{i.default.PAssert(435,e>=0&&e<=1,"Invalid ratio value: "+e)}catch(t){i.default.reportError(t)}return e}hasAdjustedCacheSizeRatio(){return this._hasAdjustedCacheSizeRatio}_adjustCacheSizeRatio(){var e=this.getCacheSizeRatio();1===e&&i.default.sendEvent("CacheRatioChange","FromDefault");e>.35?e-=.1:i.default.sendEvent("CacheRatioChange","Minimum"),i.default.sendEvent("CacheRatioChange","Change",e),Wr.settings.cacheSizeRatio.set(e)}onCacheLimitExceeded(){if(!this._hasAdjustedCacheSizeRatio){var e=0;this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.onCacheLimitExceeded()}catch(i){this._reportPluginError(i)}}}}getPluginsForType(e){var t;switch(e){case r.a.PluginType.Calendar:t=[r.a.PluginID.GCalendar];break;case r.a.PluginType.Email:t=[r.a.PluginID.Gmail];break;case r.a.PluginType.Storage:t=[r.a.PluginID.Drive];break;case r.a.PluginType.Unknown:t=[r.a.PluginID.Mailbird,r.a.PluginID.Moodo]}return t}hasAttachmentType(e,t){var a=!1;if(e.hasAttachments())for(var i=0,r=this.getPluginsForType(t),s=0;s<r.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.hasPluginAttachment(r[s])){a=!0;break}}return a}allowTextEditing(e){var t=!0;if(e&&e.hasAttachments())for(var a=0,i=e.getAttachments(),r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!i[r].getPlugin().allowTextEditing(e,i[r])){t=!1;break}}return t}validatePlugin(e){}runForEachPlugin(e){var t=0;this._iteratingPlugins=!0;for(var a=0;a<this._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e(this.getPlugin(this._activePlugins[a]))}catch(r){i.default.reportError(r)}}this._iteratingPlugins=!1}getAttachment(e,t){try{i.default.PAssert(436,e.p,"Must specify the plugin string to be used: ",e)}catch(r){i.default.reportError(r)}try{i.default.PAssert(437,e.id,"Must specify the ID of the data to use from the plugin: ",e)}catch(r){i.default.reportError(r)}var a=this.getPlugin(e.p);try{i.default.PAssert(438,a,"Must specify a valid plugin: ",e)}catch(r){i.default.reportError(r)}if(a&&a.isActive())return a.getAttachment(e.id,t?e:void 0)}createDisplayElement(e,t){try{i.default.PAssert(439,e.p,"Must specify the plugin string to be used")}catch(n){i.default.reportError(n)}try{i.default.PAssert(440,e.id,"Must specify the ID of the data to use from the plugin")}catch(n){i.default.reportError(n)}var a,r=this.getPlugin(e.p);if(r){var s=this.getAttachment(e,t);if(s)try{a=r.createDisplayElement(s)}catch(o){this._reportPluginError(o),a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p);return a}createUnknownPluginElement(e){return{attrs:{cls:[],isUnknown:!0,plugin:r.a.PluginID.Moodo,"plugin-id":"Invalid"}}}measureAttachment(e,t){try{i.default.PAssert(441,t&&t.attrs&&t.attrs.plugin,"Must have a valid plugin ID for measuring")}catch(s){i.default.reportError(s)}var a=0,r=this.getPlugin(t.attrs.plugin);try{i.default.PAssert(442,r,"Should always be able to find a valid plugin: ",t.attrs.plugin)}catch(s){i.default.reportError(s)}return r&&(a=r.measureAttachment(e,t)),a}parseAttachmentEmbedString(e,t){try{i.default.PAssert(443,e,"Must provide a valid string to parse")}catch(n){i.default.reportError(n)}var a=e.replace(/&quot;/g,'"').split(","),r={};if(a.forEach(e=>{var t=e.indexOf(":"),a=e.substr(0,t),i=e.substr(t+1,e.length-t-1);if("p"!==a&&"id"!==a)try{i=decodeURIComponent(i)}catch{}r[a]=i}),t){var s=a.length>2;r.displayElement=this.createDisplayElement(r,s),r.hasInlineData=s}return r}createSimpleAttachment(e){return e.isSimpleAttachment=!0,e}handleDropEvent(e,t){for(var a=0,i=!1,s=!1,n=0;n<this._activePlugins.length&&!i;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._activePlugins[n],l=this.getPlugin(o);try{i=l.handleDropEvent(e,t)}catch(d){this._reportPluginError(d),s=!0}}if(!i&&(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0||e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0)){let e=s?{text:"An error was detected handling drag drop and the developers have been notified",action:r.a.MessageAction.OpenSettings}:{text:"Attaching files is a Premium feature, using the Drive plugin. Please enable Drive in the settings.",action:r.a.MessageAction.OpenSettings};Wr.toasts.pushMessage(e),i=!0}return i}handleTapEvent(e,t,a,s){var n=!1,o=i.default.getPluginForElement(a.target);if(o){var l=o.getAttribute("plugin"),d=this.getPlugin(l);try{i.default.PAssert(444,d,"Must be able to get a valid plugin from a plugin element")}catch(c){i.default.reportError(c)}if(d.isPluginBlocked())Wr.toasts.pushMessage(r.a.MessageID.PremiumRequired),n=!0;else{var h=o.getAttribute("plugin-id");try{i.default.PAssert(445,h,"Must have a valid item ID for a plugin element")}catch(c){i.default.reportError(c)}try{n=d[s](e,t,h,a)}catch(u){this._reportPluginError(u)}}}return n}handleTapStart(e,t,a){return this.handleTapEvent(e,t,a,"handleTapStart")}handleTapClick(e,t,a){if(!t.isEditable||i.default.findParent(a.target,"plugin"))return this.handleTapEvent(e,t,a,"handleTapClick")}handleDoubleTap(e,t,a){return this.handleTapEvent(e,t,a,"handleDoubleTap")}isAuthorized(e){return!!i.default.isDemoMode()||!!this.getPlugin(e)&&!!this.getSetting(e,this.getPlugin(e).Settings.IsEnabled)}getSetting(e,t){return this.getPlugin(e).getSetting(t)}setSetting(e,t,a){return this.getPlugin(e).setSetting(t,a)}onAuthorizedSetting(e,t,a){this.getPlugin(e).onAuthorizedSetting(t,a)}notifyDependencyLoad(e,t){for(var a in this._loadedDependencies[e]=t||!0,this._plugins)if(this._plugins.hasOwnProperty(a))try{this.getPlugin(a).onDependencyLoaded(e,t)}catch(i){this._reportPluginError(i)}}notifyDependencyUnload(e,t){}_handleBatchRequestResponse(e,t){try{i.default.PAssert(447,e,"Plugin must be passed to response to know who is handling it")}catch(a){i.default.reportError(a)}this._numOutstandingReqs--;try{i.default.PAssert(448,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(a){i.default.reportError(a)}try{e._handleBatchRequestResponse(t)}catch(r){this._reportPluginError(r)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}_handleRequestResponse(e,t,a){try{i.default.PAssert(449,t,"Plugin must be passed to response to know who is handling it")}catch(r){i.default.reportError(r)}if(!a){this._numOutstandingReqs--;try{i.default.PAssert(450,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(r){i.default.reportError(r)}}try{t._handleRequestResponse(e,a)}catch(s){this._reportPluginError(s)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}notifyNoOutstandingReqs(){try{i.default.PAssert(451,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(e){i.default.reportError(e)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)}notifyHasPendingRemoteRequest(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)}notifyAuthorizationAdded(e){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(e)}verifyAuthorization(e,t){for(var a,i,r=0,s=0;s<this._activePlugins.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=this._activePlugins[s],o=this.getPlugin(n);if(o.isEnabled()){!o.verifyAuthorization(e)&&(i=(i||[]).concat(o.googleScopes())),a=a||!o.verifyAuthorization(e)}}}_reportInvalidScopes(e,t){Wr.toasts.pushMessage(r.a.MessageID.MissingOffline),Wr.toasts.clearMessage(r.a.MessageID.LostPermission),i.default.reportError(new Error("Invalid scopes reported"),{accountID:e,scopes:t})}_setupRequestQueues(e){var t=e?1:pi;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,t)),this._forcedLastPossible=this._forcedLastPossible||!!e}_pumpRequestQueues(){this._runPumpRequestQueues(r.a.RequestPriority.UserBlocking),this._runPumpRequestQueues(r.a.RequestPriority.Default),this._runPumpRequestQueues(r.a.RequestPriority.Low)}_runPumpRequestQueues(e){var t=0;if(this.isOnline()){var a=0,r=6-this._numOutstandingReqs;try{i.default.PAssert(452,r>=0,"Should never have more than max outstanding requests at any given point in time")}catch(c){i.default.reportError(c)}for(var s=0;r>0&&s<this._activePlugins.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this._activePlugins[s],o=this.getPlugin(n),l=4-o.getNumOutstandingReqs();try{i.default.PAssert(453,l>=0,"Must always have a postiive number of available plugin reqs")}catch(c){i.default.reportError(c)}var d=Math.min(r,l);if(d>0&&o.isReady()){var h=0;try{h=o._pumpRequestQueue(e,d,this._handleRequestResponse,this._handleBatchRequestResponse);try{i.default.PAssert(454,h>=0,"Number of requests sent can never be negative")}catch(c){i.default.reportError(c)}}catch(u){this._reportPluginError(u)}try{i.default.PAssert(455,r-h>=0,"Too Many requests sent")}catch(c){i.default.reportError(c)}t+=h,r-=h,this._numOutstandingReqs+=h}}}else 0;return this._forcedLastPossible=!1,this._setupRequestQueues(),t}_clearRequestQueues(){var e=0;this._numOutstandingReqs=0;for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._activePlugins[t],i=this.getPlugin(a);try{i._clearRequestQueue()}catch(r){this._reportPluginError(r)}}}useRenderer(e,t){return this._pluginRenderer.useRenderer(e,t)}_reportPluginError(e){i.default.reportError(e)}parseEmailURL(e){var t={accountID:void 0,threadID:void 0,plugin:void 0},a=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g.exec(e);return a&&(t.accountID=a[1],t.threadID=a[2],t.plugin=this.getPlugin(r.a.PluginID.Gmail)),t}isAvailable(e){return this.getPlugin(e).isAvailable()}isActive(e){return this.getPlugin(e).isActive()}isEnabled(e){return this.getPlugin(e).isEnabled()}isGmailPaneEnabled(){return this.isEnabled(r.a.PluginID.Gmail)}},p()(ci.prototype,"goOnline",[f.a],Object.getOwnPropertyDescriptor(ci.prototype,"goOnline"),ci.prototype),p()(ci.prototype,"_handleBatchRequestResponse",[f.a],Object.getOwnPropertyDescriptor(ci.prototype,"_handleBatchRequestResponse"),ci.prototype),p()(ci.prototype,"_handleRequestResponse",[f.a],Object.getOwnPropertyDescriptor(ci.prototype,"_handleRequestResponse"),ci.prototype),p()(ci.prototype,"_pumpRequestQueues",[f.a],Object.getOwnPropertyDescriptor(ci.prototype,"_pumpRequestQueues"),ci.prototype),p()(ci.prototype,"_clearRequestQueues",[f.a],Object.getOwnPropertyDescriptor(ci.prototype,"_clearRequestQueues"),ci.prototype),ci),mi=a(97),vi=a(56),yi=a(103),_i=["4.95","49.95","5","49"],Si=y.a.demo;var Pi=(gi=class{constructor(){this._premiumStatus=new A.a(r.a.PremiumStatus.Unknown),Si&&this._premiumStatus.set(r.a.PremiumStatus.Active),this.hasPremiumFeaturesObservable=new mi.a([this._premiumStatus],()=>this.hasPremiumFeatures()),this._lastSignupError=-1,this._earlyAdopter=!1,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._pricingSelected=r.a.Pricing.None,this._billingIdentifier=void 0,this._hasValidBillingData=new A.a(!1),this.daysLeftInTrial=new A.a(-1),this.inviteCodeError=new A.a,this.inviteEmailError=new A.a,this.inviteEmailSuccess=new A.a,Wr.settings.userProperties.onHasValue(e=>this.init())}init(){if(this._premiumStatus.listen((e,t)=>{this.hasPremiumFeatures()?(Wr.pluginManager.notifyDependencyLoad(r.a.PluginDependency.EarlyAccess),Wr.pluginManager.notifyDependencyLoad(r.a.PluginDependency.PremiumSub)):this.hasEarlyAccess()&&Wr.pluginManager.notifyDependencyLoad(r.a.PluginDependency.EarlyAccess),e!==t&&t&&Wr.DisplaySettings.onSettingChanged()}),!Si&&(this.userProperties=Wr.settings.userProperties.get(),this.userProperties)){this.updateBillingData(),i.default.shouldLog(r.a.LogLevels.Account)&&i.default.log("Premium Status (Local): ",this.userProperties.premiumStatus);var e=v.a.getURLParam("premium");void 0!==e&&v.a.removeURLParam("premium",!0),e&&setTimeout(()=>{Wr.menus.openSettings(r.a.SettingsSections.Account)},100)}}setLastSignupError(e){this._lastSignupError=e}_reportRemoteStatusFailure(){i.default.sendEvent("Billing","RemoteStatusFailure")}getBillingIdentifier(){this._billingIdentifier;return this._billingIdentifier}onBillingIdentifierAvailable(e){}onConnected(e){}hasPremium(){return this._premiumStatus.get()===r.a.PremiumStatus.Active||this._premiumStatus.get()===r.a.PremiumStatus.PastDue}isTrialState(){return this._premiumStatus.get()===r.a.PremiumStatus.Trial||this._premiumStatus.get()===r.a.PremiumStatus.TrialOver}isCanceledState(){return this._premiumStatus.get()===r.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===r.a.PremiumStatus.CanceledPastDue}canceledUserHasPremiumAccess(){let e=this.getPremiumEndDate();return this.isCanceledState()&&e&&e.getTime()>Date.now()}isInFreeMonthAndPremium(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts>=100}hasSubscription(){return!this._premiumCode&&this.getNextBillingDate()}updateBillingData(){let e=this.userProperties,{premiumStatus:t}=e;var a;this._earlyAdopter=e.earlyAdopter,this._joinDate=e.joinDate?new Date(e.joinDate):new Date,this._premiumStartDate=e.premiumSignupDate?new Date(e.premiumSignupDate):new Date,this._premiumEndDate=e.premiumEndDate?new Date(e.premiumEndDate):void 0,this._premiumCode=e.premiumCode,this._nextBillingDate=e.nextBillingDate?new Date(e.nextBillingDate):void 0,this._trialStart=e.trialStart?new Date(e.trialStart):new Date,this._trialDuration=e.trialDuration||r.a.TrialDuration,this._trialExtended=e.trialExtended||!1,a=t===r.a.PremiumStatus.CanceledPastDue||t===r.a.PremiumStatus.CanceledUser?-1:this._trialDuration-Math.ceil((Date.now()-this._trialStart.getTime())/864e5);try{i.default.PAssert(456,a<=320,"Sanity check on trial length",a)}catch(s){i.default.reportError(s)}this.daysLeftInTrial.set(a),this._premiumStatus.get()===r.a.PremiumStatus.Trial&&a<0?(t=r.a.PremiumStatus.TrialOver,this.notifyTrialOver()):this._premiumStatus.get()===r.a.PremiumStatus.Trial&&a<5&&this.notifyTrialEndSoon(),t&&this.setPremiumStatus(t),this._hasValidBillingData.set(!0)}setPremiumStatus(e){try{i.default.PAssert(457,i.default.isNumber(e),"Status must be a valid number",e)}catch(t){i.default.reportError(t)}try{i.default.PAssert(458,e>0&&e<8,"Should be a valid status identifier",e)}catch(t){i.default.reportError(t)}e!==this._premiumStatus.get()&&(this._premiumStatus.set(e),i.default.setDimension(r.a.Analytics.Dimensions.PremiumStatus,e))}hasValidBillingData(){return this._hasValidBillingData.get()}getPremiumStatus(){return this._premiumStatus.get()}getInviteCode(){return this._inviteCode}getJoinDate(){return this._joinDate||new Date}getPremiumStartDate(){return this._premiumStartDate||new Date}getPremiumEndDate(){return this._premiumEndDate}hasTrialExtended(){return this._trialExtended||!1}isEligibleForTrialExtension(){return!1}getNextBillingDate(){return this._nextBillingDate}hasEarlyAccess(){return this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()}cancelSubscription(e,t){i.default.sendEvent("Billing","SubCancelTapped");var a=()=>{t&&i.default.isFunction(t)&&t()};return Wr.menus.confirm("Are you sure you want to cancel your subscription?",e=>{e?(i.default.sendEvent("Billing","SubCancelYES"),vi.a.cancelPremium().then(e=>{var t=e.value?"Your premium subscription has been canceled. Please contact support@moo.do if you need assistance.":"There was a server error, please try again in a few minutes or contact support@moo.do.";Wr.menus.alert({text:t}),a()})):(a(),i.default.sendEvent("Billing","SubCancelNO"))}),!0}getCustomPurchaseURL(){}_openPaymentWindow(e){Wr.menus.openModal(r.a.Modals.Billing,{isUpdate:e})}onTapUpdatePaymentMethod(){this._openPaymentWindow(!0)}onTapViewInvoices(e,t){return vi.a.listTransactions().then(e=>{if(e&&e.value)try{Wr.menus.openModal(r.a.Modals.Invoices,e.value)}catch(a){i.default.reportError(a)}else Wr.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do."});t()}),!0}onTapDeleteAccount(e,t){return Wr.menus.openModal(r.a.Modals.DeleteAccount,{callback:()=>{vi.a.deleteAccount().then(e=>{e.value?o.a.clearLocalData():Wr.menus.alert({text:"There was a server error. Please try again in a few minutes or contact support@moo.do."}),t()})}}),!0}getInviteUrl(){return"https://www.moo.do/"}getSelectText(){return"Select and press "+y.a.cmdChar+" + C to copy to clipboard"}wasInvited(){return!!this._referredBy}sendInviteEmail(e,t){}joinDateText(){return this.getJoinDate().toString(Wr.International.getFormat(r.a.DFormat.LongStrDate))}premiumStartDateText(){return this.getPremiumStartDate().toString(Wr.International.getFormat(r.a.DFormat.LongStrDate))}premiumEndDateText(){let e=this.getPremiumEndDate();return e?e.toString(Wr.International.getFormat(r.a.DFormat.LongStrDate)):"Never"}nextBillingDateText(){let e=this.getNextBillingDate();return e?e.toString(Wr.International.getFormat(r.a.DFormat.LongStrDate)):"Never"}shareTwitter(){var e="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(e,550,420),i.default.sendEvent("Billing","ShareTwitter")}shareFacebook(){var e="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(e,600,303),i.default.sendEvent("Billing","ShareFacebook")}shareGoogle(){var e="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(e,500,650),i.default.sendEvent("Billing","ShareGoogle")}showPopup(e,t,a){var i=t,r=a,s=window.screen.height,n=window.screen.width,o="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+i+",height="+r+",left="+Math.round(n/2-i/2)+",top="+Math.round(s/2-r/2);window.open(e,null,o)}onTapSignupMonth(){this._pricingSelected=this.getMonthlyPricing(),this._openPaymentWindow(!1),i.default.sendEvent("Billing","OpenSignupModal")}onTapSignupYear(){this._pricingSelected=this.getYearlyPricing(),this._openPaymentWindow(!1),i.default.sendEvent("Billing","OpenSignupModal")}onTapCodeSignup(){Wr.menus.alert({text:"Redeeming code is not ready yet in the new backend. Please contact support.",callback:()=>{Wr.menus.openModal(r.a.Modals.ReportBug)}})}getMonthlyPricing(){return this._earlyAdopter?r.a.Pricing.EarlyMonthly:r.a.Pricing.RegMonthly}getYearlyPricing(){return this._earlyAdopter?r.a.Pricing.EarlyYearly:r.a.Pricing.RegYearly}getMonthlyPrice(){return _i[this.getMonthlyPricing()]}getYearlyPrice(){return _i[this.getYearlyPricing()]}getPlanPrice(e){return _i[e]}notifyTrialOver(){if(!Wr.settings.notifiedTrialOver.get()){if(!Wr.toasts)return void setTimeout(this.notifyTrialOver.bind(this),0);Wr.toasts.pushMessage(r.a.MessageID.TrialOver),Wr.settings.notifiedTrialOver.set(!0)}}notifyTrialEndSoon(){if(!Wr.settings.notifiedTrialEndSoon.get()){if(!Wr.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);Wr.toasts.pushMessage(r.a.MessageID.TrialEndSoon),Wr.settings.notifiedTrialEndSoon.set(!0)}}isTrialOver(){var e=!1;return this._premiumStatus.get()===r.a.PremiumStatus.TrialOver?e=!0:this._premiumStatus.get()!==r.a.PremiumStatus.CanceledUser&&this._premiumStatus.get()!==r.a.PremiumStatus.CanceledPastDue||this.canceledUserHasPremiumAccess()||(e=!0),e}startTrial(){try{i.default.PAssert(463,!this.isTrialOver(),"Should never try to start a trial once it is over")}catch(e){i.default.reportError(e)}vi.a.startTrial().then(t=>{if(t.error)if(t.errorCode===r.a.PrivateAPIErrorCodes.TrialOver)Wr.toasts.pushMessage({text:"Your free trial of Premium has ended. Please contact support@moo.do to extend.",actionText:"OKAY"}),this._premiumStatus.set(r.a.PremiumStatus.TrialOver);else{try{i.default.PAssert(464,!1,"Failed to start trial for user")}catch(e){i.default.reportError(e)}Wr.toasts.pushMessage({text:"There was an error starting your trial. Please contact support@moo.do.",action:r.a.MessageAction.Contact})}})}hasPremiumFeatures(){return this.hasPremium()||this._premiumStatus.get()===r.a.PremiumStatus.Trial||this.canceledUserHasPremiumAccess()}getBillingPeriod(){return this._pricingSelected}loadUserProperties(e){"premiumStatus"in e&&this._premiumStatus.set(e.premiumStatus);let t=Wr.settings.userProperties.get();if(t=Object.assign({},t,e),Wr.settings.userProperties.set(t),this.userProperties=t,this.updateBillingData(),!this.userProperties.gid&&Wr.settings.shouldShowHelp("missingGID")){let e=Wr.toasts.pushMessage({id:"shouldImportMoodo",text:"If you are coming from the old Moo.do, please import your Premium settings and documents. If you're a new user just click to ignore this message.",hold:!0,actionText:"IMPORT",onClose:()=>{e=void 0,Wr.settings.closeHelp("missingGID")},action:()=>{(new yi.a).authAndImportDocuments()}}),t=()=>{Wr.settings.shouldShowHelp("missingGID")||(setTimeout(()=>Wr.settings.closedHelps.unlisten(t),0),e&&Wr.toasts.clearMessage(e))};Wr.settings.closedHelps.listen(t)}}},p()(gi.prototype,"cancelSubscription",[f.a],Object.getOwnPropertyDescriptor(gi.prototype,"cancelSubscription"),gi.prototype),p()(gi.prototype,"onTapUpdatePaymentMethod",[f.a],Object.getOwnPropertyDescriptor(gi.prototype,"onTapUpdatePaymentMethod"),gi.prototype),p()(gi.prototype,"onTapViewInvoices",[f.a],Object.getOwnPropertyDescriptor(gi.prototype,"onTapViewInvoices"),gi.prototype),p()(gi.prototype,"onTapDeleteAccount",[f.a],Object.getOwnPropertyDescriptor(gi.prototype,"onTapDeleteAccount"),gi.prototype),p()(gi.prototype,"onTapSignupMonth",[f.a],Object.getOwnPropertyDescriptor(gi.prototype,"onTapSignupMonth"),gi.prototype),p()(gi.prototype,"onTapSignupYear",[f.a],Object.getOwnPropertyDescriptor(gi.prototype,"onTapSignupYear"),gi.prototype),p()(gi.prototype,"onTapCodeSignup",[f.a],Object.getOwnPropertyDescriptor(gi.prototype,"onTapCodeSignup"),gi.prototype),gi);var Ii=class{constructor(e,t){this._id=e,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._useInMemoryStore=!t||!t.noInMemoryCache,this._useMetadataInMemoryStore=!t||!t.noMetadataInMemoryCache,this._metadataKeys=t&&t.metadataKeys?t.metadataKeys:[]}getStats(){return this.getFilterEntriesSync(()=>!0).map(e=>({id:this._id,count:e.length,size:JSON.stringify(e).length}))}getState(){return{isAllLoaded:this._isAllLoaded,storageError:this._storageError}}enableLogging(){this._loggingEnabled=!0}disableLogging(){this._loggingEnabled=!1}isLoggingEnabled(){return this._loggingEnabled}usesDiskSpace(){return this._usesDiskSpace}_cacheInMemory(){return this._useInMemoryStore}_cacheMetadataInMemory(){return this._useMetadataInMemoryStore}_hasLoadedAll(){return this._isAllLoaded}getStorageType(){try{i.default.PAssert(699,!1,"SubClass must override")}catch(e){i.default.reportError(e)}}_setRawInMemoryCache(e){try{i.default.PAssert(700,this._cacheInMemory(),"Must be running an in-memory cache")}catch(t){i.default.reportError(t)}this._cache=e}_getRawInMemoryCache(){return this._cacheInMemory()?this._cache:void 0}count(e){e(this._cacheInMemory()?Object.keys(this._cache).length:void 0)}size(e){e(this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0)}loadAll(e){this._isAllLoaded=!0}getEntrySync(e){return this._cacheInMemory()?this._cache[e]:void 0}getBoundEntries(e,t,a,r){try{i.default.PAssert(701,!r,"In memory query is sync")}catch(o){i.default.reportError(o)}var s;if(this._cacheInMemory())for(var n in s=[],this._cache)this._cache[n][e]>=t&&this._cache[n][e]<=a&&s.push(this._cache[n]);return s}getFilterEntriesSync(e){var t;return this._cacheInMemory()&&(t=[],Object.keys(this._cache).forEach(a=>{e&&!e(this._cache[a])||t.push(this._cache[a])})),t}removeEntrySync(e){delete this._cache[e]}hasEntrySync(e){return!!this._cacheInMemory()&&this._cache.hasOwnProperty(e)}saveEntrySync(e){try{i.default.PAssert(702,e,"Must be saving data")}catch(t){i.default.reportError(t)}try{i.default.PAssert(703,e&&e.id,"Saved data must have id")}catch(t){i.default.reportError(t)}this.isLoggingEnabled()&&i.default.log("Cache Entry: ",e),this._cacheInMemory()&&e&&(this._cache[e.id]=e)}clearCacheSync(){this._cache={}}clearBackingStore(){try{i.default.PAssert(704,!1,"SubClass must override")}catch(e){i.default.reportError(e)}}dumpData(e){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)}onCacheError(e){i.default.reportError(e)}};var bi,Di=class extends Ii{constructor(e,t){super(e,t),this.keyFieldsRN=t.keyFieldsRN}getPreloadData(){return ie.a.getTableData(this._id)}getMetadata(e){return ie.a.getValue(this._id+"_"+e)}setMetadata(e,t){ie.a.setValue(this._id+"_"+e,t)}removeMetadata(e){ie.a.deleteValue(this._id+"_"+e)}clearMetadata(){this._metadataKeys&&this._metadataKeys.forEach(e=>this.removeMetadata(e))}async hasEntry(e){return void 0!==await this.getEntry(e)}async getEntry(e,t){let a;return this._useInMemoryStore&&(a=this.getEntrySync(e)),void 0===a&&(a=ie.a.getTableValue(this._id,e)),void 0===a&&(a=await ie.a.tableGet(this._id,e)),t&&(a=i.default.cloneDeep(a)),a}async removeEntry(e){if(this._useInMemoryStore)super.removeEntrySync(e);else{let t=ie.a.getTableData(this._id);t&&delete t[e]}return ie.a.tableDelete(this._id,e)}async saveEntry(e,t){let a=ie.a.getTableValue(this._id,e.id);if(!a||(t?t(a,e):a!==e&&!i.default.deepEqual(a,e,!0)))return this._useInMemoryStore?super.saveEntrySync(e):ie.a.setTableValue(this._id,e.id,e),ie.a.tablePut(this._id,e)}async clearCache(){return this._useInMemoryStore&&super.clearCacheSync(),ie.a.tableClear(this._id)}async getFilterEntries(e){return ie.a.tableFilter(this._id,e)}ensureTableLoaded(e){return ie.a.ensureTableLoaded(this._id,e)}};var wi=(bi=class extends Ii{constructor(e,t){if(t){try{i.default.PAssert(580,!t.noInMemoryCache,"Invalid in-memory cache option")}catch(a){i.default.reportError(a)}try{i.default.PAssert(581,!t.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(a){i.default.reportError(a)}t.noInMemoryCache=!1,t.noMetadataInMemoryCache=!1}if(super(e,t),t?(this.saveTime=isNaN(t.saveTime)?5e3:t.saveTime,t.writeOnUnload&&n.a.listen("onUnload",this.writeCache),t.clearBackingOnLoad&&(this.clearBackingOnLoad=!0,n.a.listen("enterForeground",this.clearBackingStore))):this.saveTime=5e3,this.storageKey="MDC_"+this._id,this._cache=ie.a.getValue(this.storageKey)||{},i.default.isString(this._cache))try{let e=JSON.parse(this._cache);this._cache=e}catch{}this._saveTimeout=void 0}_onWrite(e){e||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))}writeCache(){if(Wr.settings.activeUser.get()){let t=this._getRawInMemoryCache();try{ie.a.setValue(this.storageKey,t)}catch(e){i.default.reportError(e)}}}getStorageType(){return r.a.StorageType.LocalStorage}removeEntrySync(e){delete this._cache[e],this._onWrite()}getEntrySync(e){return this._cache[e]}saveEntrySync({id:e,value:t}){void 0===t||null===t?delete this._cache[e]:this._cache[e]=t,this._onWrite()}clearCacheSync(){super.clearCacheSync(),this._onWrite(!0)}clearBackingStore(){ie.a.deleteValue(this.storageKey)}},p()(bi.prototype,"writeCache",[f.a],Object.getOwnPropertyDescriptor(bi.prototype,"writeCache"),bi.prototype),p()(bi.prototype,"clearBackingStore",[f.a],Object.getOwnPropertyDescriptor(bi.prototype,"clearBackingStore"),bi.prototype),bi);var Ei,Ci=class{constructor(){this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[]}init(){this._storageReady[r.a.StorageType.InMemory]=!0,this._storageReady[r.a.StorageType.LocalStorage]=!0}getInfo(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}}registerLocalCache(e,t,a){try{i.default.PAssert(310,e,"Must provide a valid cache ID")}catch(n){i.default.reportError(n)}try{i.default.PAssert(311,void 0===this._registeredCaches[e],"Must not have a previously registered cache with the same id")}catch(n){i.default.reportError(n)}var s;switch(i.default.shouldWriteLocal()||(t=r.a.StorageType.InMemory,a&&(a.noInMemoryCache=!1,a.noMetadataInMemoryCache=!1)),t){case r.a.StorageType.InMemory:break;case r.a.StorageType.LocalStorage:s=new wi(e,a);break;case r.a.StorageType.IndexedDB:s=new Di(e,a)}try{i.default.PAssert(312,s,"Must have valid cache after creation")}catch(n){i.default.reportError(n)}return this._registeredCaches[e]=s,s}_notifyIDBReady(e){}notifyMigrationRequired(){this._migrationRequired=!0}needsMigration(){return this._migrationRequired||1!==Wr.settings.localDataVersion.get()}hasReportedQuotaError(){return this._reportedQuotaError}reportQuotaExceeded(){this._reportedQuotaError||(this._reportedQuotaError=!0,i.default.reportError(new Error("Quota exceeded!")))}};var Ai=(Ei=class{constructor(e,t,a,r,s,n,o,l,d){this._id=e,this._remoteID=s,this._type=t;try{i.default.PAssert(582,i.default.isDateValid(a),"Must specify a valid schedule date for deferred task")}catch(h){i.default.reportError(h)}this._scheduleDate=a,this._timeout=void 0,this._data=n,this._cbRun=o,this._cbCancel=l,this._cbPersistRemote=d,this._hasRun=!1,this._isCanceled=r,this._destroyed=!1}schedule(){try{i.default.PAssert(583,!this._timeout,"Should not schedule the same task multiple times")}catch(t){i.default.reportError(t)}try{i.default.PAssert(584,!this._hasRun,"Should not schedule a task once it has already run once")}catch(t){i.default.reportError(t)}try{i.default.PAssert(585,!this._isCanceled,"Should not schedule canceled tasks")}catch(t){i.default.reportError(t)}var e=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,e),!this._remoteID&&e>0&&re.a.onLoaded(()=>{try{this._cbPersistRemote(this,this._onPersistedRemote)}catch(e){i.default.reportError(e)}})}_onCanceled(e){e&&(this._destroyed=!0,Wr.deferredTaskManager._notifyTaskComplete(this._id))}_onPersistedRemote(e,t){e&&(this._remoteID=t,Wr.deferredTaskManager._updateTask(this._id))}reschedule(e){try{i.default.PAssert(586,!this._hasRun,"Should never reschedule a task that has already run")}catch(t){i.default.reportError(t)}try{i.default.PAssert(587,!this._isCanceled,"Should not reschedule canceled tasks")}catch(t){i.default.reportError(t)}try{i.default.PAssert(588,this._timeout,"Must always have already schedule a task that is being rescheduled")}catch(t){i.default.reportError(t)}clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=e,this.schedule()}cancel(){try{i.default.PAssert(589,this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled")}catch(e){i.default.reportError(e)}try{i.default.PAssert(590,!this._hasRun,"Should not cancel tasks that have already been run")}catch(e){i.default.reportError(e)}this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&re.a.onLoaded(()=>{try{this._cbCancel(this,this._onCanceled)}catch(e){i.default.reportError(e)}}),Wr.deferredTaskManager._updateTask(this._id)}runTask(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(e){i.default.reportError(e)}Wr.deferredTaskManager._notifyTaskComplete(this._id)}getData(){return this._data}getType(){return this._type}getScheduleDate(){return this._scheduleDate}getSaveData(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}}isPersistedRemote(){return!!this._remoteID}},p()(Ei.prototype,"_onCanceled",[f.a],Object.getOwnPropertyDescriptor(Ei.prototype,"_onCanceled"),Ei.prototype),p()(Ei.prototype,"_onPersistedRemote",[f.a],Object.getOwnPropertyDescriptor(Ei.prototype,"_onPersistedRemote"),Ei.prototype),p()(Ei.prototype,"runTask",[f.a],Object.getOwnPropertyDescriptor(Ei.prototype,"runTask"),Ei.prototype),Ei);var Mi,Ti=class{constructor(){this._registeredTypes={},this._deferredTasks={},this._stats={}}init(){var e=0;this._taskCache=Wr.cacheManager.registerLocalCache("DeferredTasks",r.a.StorageType.LocalStorage);let t=this._taskCache.getFilterEntriesSync();for(var a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t[a];this.scheduleTask(i.id,i.type,new Date(i.scheduleDate),i.isCanceled,i.remoteID,i.data,!0)}}getLastSyncDate(){var e=Wr.settings.lastTaskSync.get();try{i.default.PAssert(313,!e||i.default.isString(e),"Must have a valid string sync date")}catch(t){i.default.reportError(t)}return e}getStats(){return{}}registerTaskType(e,t,a,r){try{i.default.PAssert(314,!this._registeredTypes[e],"Must not double register task type")}catch(s){i.default.reportError(s)}try{i.default.PAssert(315,i.default.isFunction(t),"Must register a valid run callback")}catch(s){i.default.reportError(s)}try{i.default.PAssert(316,i.default.isFunction(a),"Must register a valid cancel callback")}catch(s){i.default.reportError(s)}try{i.default.PAssert(317,i.default.isFunction(r),"Must register a valid persist callback")}catch(s){i.default.reportError(s)}this._registeredTypes[e]={cbRun:t,cbCancel:a,cbPersistRemote:r}}_notifyTaskComplete(e){this._removeTask(e)}scheduleTask(e,t,a,r,s,n,o){try{i.default.PAssert(318,e,"Must supply a valid task ID")}catch(c){i.default.reportError(c)}try{i.default.PAssert(319,t,"Must supply a valid task type")}catch(c){i.default.reportError(c)}try{i.default.PAssert(320,i.default.isDateValid(a),"Must always have a valid scheduled date available")}catch(c){i.default.reportError(c)}try{i.default.PAssert(321,this._registeredTypes[t],"Must request a valid registered task type")}catch(c){i.default.reportError(c)}if(this._deferredTasks[e]){var l=this._deferredTasks[e];try{i.default.PAssert(322,l.getType()===t,"Task types must match")}catch(c){i.default.reportError(c)}try{i.default.PAssert(323,l.getScheduleDate().equals(a),"Task schedule dates must match")}catch(c){i.default.reportError(c)}}else{var d=this._registeredTypes[t];if(d){var h=new Ai(e,t,a,r,s,n,d.cbRun,d.cbCancel,d.cbPersistRemote);if(this._deferredTasks[e]){i.default.log("Overriding existing task");try{i.default.PAssert(324,this._deferredTasks[e].type===t,"Should only update deferred tasks of the same type")}catch(c){i.default.reportError(c)}}this._addTask(e,h,o),r?h.cancel():h.schedule()}}}cancelTask(e,t){this._deferredTasks[e].cancel()}_updateTask(e){var t=this._deferredTasks[e];this._taskCache.saveEntrySync(t.getSaveData())}_addTask(e,t,a){this._deferredTasks[e]=t,a||this._updateTask(e)}_removeTask(e){this._deferredTasks[e]=void 0,this._taskCache.removeEntrySync(e)}},Li=a(92),xi="Suspend",ki="Resume",Ri="AsyncSkip",Oi="SyncSkip",Fi="Run",Ni="AsyncBegin",Bi="AsyncComplete",Ui="AsyncAbort",Hi="AsyncTimeout";var Vi=(Mi=class{constructor(e,t){try{i.default.PAssert(591,t,"Must provide a valid set of task options: "+e)}catch(a){i.default.reportError(a)}this._id=e,this._iterationID=void 0,this._isAsync=t.async,this._isAsyncRunning=!1;try{i.default.PAssert(593,t.task&&i.default.isFunction(t.task),"Must provide a valid task function")}catch(a){i.default.reportError(a)}this._task=t.task,this._delay=t.delay;try{i.default.PAssert(594,void 0===t.asyncTimeout||t.async,"Should never specify an async timeout for a non-async task")}catch(a){i.default.reportError(a)}this._asyncTimeout=t.asyncTimeout||0,this._pauseWhileIdle=t.pauseWhileIdle||!1,this._minDelayOnResume=t.minDelayOnResume||!1;try{i.default.PAssert(595,this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume")}catch(a){i.default.reportError(a)}this._suspended=!1,this._remainingTime=0,this._lastUpdate=t.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=t.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new Li.a(10),this._actions=new Li.a(20),this.init()}init(){this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()}getStats(){return{numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()}}cancel(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0}abortAsync(){this._numAsyncAborts++,this.performAction(Ui),this._notifyAsyncAborted()}performAction(e){try{i.default.PAssert(596,e,"Invalid action reported")}catch(t){i.default.reportError(t)}this._actions.push({action:e,time:Date.now()})}notifyOfSuspend(){this._pauseWhileIdle&&(this.performAction(xi),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)}notifyOfResume(){if(this._pauseWhileIdle){this.performAction(ki);var e,t=!this._suspended;if(this._suspended=!1,this._minDelayOnResume)e=Math.max(0,this._minDelay-this._timeSinceLastUpdate());else{try{i.default.PAssert(597,t||this._remainingTime>=0,"Must have a valid remaining time set for task")}catch(a){i.default.reportError(a)}e=this._remainingTime,this._remainingTime=-1}e=Math.max(500,e),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e)}}isAsync(){return this._isAsync}isAsyncRunning(){return this.isAsync()&&this._isAsyncRunning}_notifyUpdateAsyncSkipped(){this._numUpdatesAsyncSkipped++,this.performAction(Ri)}_notifyUpdateSkipped(){this._numUpdatesSkipped++,this.performAction(Oi)}_notifyUpdateRun(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(Fi)}_timeSinceLastUpdate(){return Date.now()-this._lastUpdate}_asyncRunTime(){var e=0;return this._asyncStartTime>0&&(e=Date.now()-this._asyncStartTime),e}_notifyAsyncBegin(){return this.performAction(Ni),this._isAsyncRunning=!0,this._iterationID=i.default.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID}_notifyAsyncComplete(){this.performAction(Bi),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}_notifyAsyncAborted(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}_handleAsyncAbortTimeout(){this._numAsyncTimeouts++,this.performAction(Hi),this._notifyAsyncAborted()}_runUpdate(e){try{i.default.PAssert(598,!this._isCancelled,"Should never run a cancelled task")}catch(a){i.default.reportError(a)}try{i.default.PAssert(600,!this._updateIsRunning,"Should not run another update while already running one: "+this._id)}catch(a){i.default.reportError(a)}if(!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,e),0)):this._notifyUpdateAsyncSkipped();else{var t=this._notifyAsyncBegin();try{this._task(()=>{try{i.default.PAssert(602,t===this._iterationID,"Callback is only valid while task is considered running")}catch(a){i.default.reportError(a)}this._notifyAsyncComplete(),e&&e.apply(this,arguments)})}catch(r){i.default.reportError(r),this._notifyAsyncComplete()}}else try{this._task()}catch(r){i.default.reportError(r)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}}requestUpdate(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var e=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e),this._lastSetDelay=this._minDelay}}forceUpdate(e){this._runUpdate(e)}breakOnNextUpdate(){0}},p()(Mi.prototype,"_notifyAsyncComplete",[f.a],Object.getOwnPropertyDescriptor(Mi.prototype,"_notifyAsyncComplete"),Mi.prototype),p()(Mi.prototype,"_handleAsyncAbortTimeout",[f.a],Object.getOwnPropertyDescriptor(Mi.prototype,"_handleAsyncAbortTimeout"),Mi.prototype),p()(Mi.prototype,"_runUpdate",[f.a],Object.getOwnPropertyDescriptor(Mi.prototype,"_runUpdate"),Mi.prototype),Mi);var ji,zi=class{constructor(){this._tasks={}}init(){window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this))}getStats(){var e={};return Object.keys(this._tasks).forEach(t=>e[t]=this._tasks[t].getStats()),e}createRecurringTask(e,t){try{i.default.PAssert(335,!this._tasks[e],"Must not register multiple tasks with the same ID")}catch(r){i.default.reportError(r)}var a=new Vi(e,t);return this._tasks[e]=a,a}getRecurringTask(e){try{i.default.PAssert(336,this._tasks[e],"Must only retreive a valid recurring task")}catch(t){i.default.reportError(t)}return this._tasks[e]}hasRecurringTask(e){return!!this._tasks[e]}cancelRecurringTask(e){try{i.default.PAssert(337,this._tasks[e],"Must only cancel a valid recurring task")}catch(t){i.default.reportError(t)}this._tasks[e].cancel(),delete this._tasks[e]}_handleFocus(){for(var e in this._tasks)this._tasks[e].notifyOfResume()}_handleBlur(){for(var e in this._tasks)this._tasks[e].notifyOfSuspend()}};var qi,Wi=(ji=class{constructor(){this._numTimesItemsUpdated=0,this._itemsUpdateTimeout=void 0,this.itemFlushStacks=[],this.EnableItemFlushStacks=!0,this._isUpdating=!1,this._numFlushesInCommit=0,this._isWaitingUpdateItems=0,this._itemsDirty=!1,this._itemHeightsDirty=!1,this._forceNotify=!1,this._updateSearch=!1,this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0}checkItemsUpdated(){0}notifyItemsUpdated(e,t){this._numTimesItemsUpdated++,this.EnableItemFlushStacks&&this.itemFlushStacks.push({stack:i.default.getCurrentStack("Update Items Stack"),panes:e,forceNotify:t}),this._itemsUpdateTimeout||(this._itemsUpdateTimeout=setTimeout(this.checkItemsUpdated,0))}_updateAllItems(){var e=this._forceNotify;this._forceNotify=!1;var t=this._updateSearch;(this._updateSearch=!1,this._itemsDirty||e)&&(this._itemsDirty=!1,this._isUpdating=!0,Wr.PaneManager.runForEachPane(a=>{(e||a.isItemsDirty())&&a.updateItemsImmediate(t,e)}),this._isUpdating=!1)}updateWatchdog(){i.default.log("Last Update Items Stack: "+this._lastUpdateItemsStack);try{i.default.PAssert(326,!1,"Update Watchdog Triggered - This should never happen.",this._isWaitingUpdateItems)}catch(e){i.default.reportError(e)}this._isWaitingUpdateItems=1,this.commitUpdateItems()}isUpdatingItems(){return this._isWaitingUpdateItems>0&&this._itemsDirty}beginUpdateItems(){this._isWaitingUpdateItems++}commitUpdateItems(e,t){try{i.default.PAssert(329,this._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",this._isWaitingUpdateItems)}catch(a){i.default.reportError(a)}this._isWaitingUpdateItems--,0===this._isWaitingUpdateItems&&(clearTimeout(this._itemsUpdateWatchdog),this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0,this._numFlushesInCommit=0,!this._itemsDirty&&this._itemHeightsDirty&&this._updateAllItemHeights(),this._itemHeightsDirty=!1),this._itemsDirty&&this.updateAllItems(e,t)}flushItemsUpdate(e){this.isUpdatingItems()&&(e?e.isItemsDirty()&&(this._itemsDirty||this._forceNotify)&&(this._numFlushesInCommit++,e.updateItemsImmediate(this._updateSearch,this._forceNotify)):(this._numFlushesInCommit++,this._updateAllItems()))}updateAllItems(e,t){try{i.default.PAssert(330,void 0===e||i.default.isBoolean(e),"Must supply a bool param for updateSearch")}catch(a){i.default.reportError(a)}try{i.default.PAssert(331,void 0===t||i.default.isBoolean(t),"Must supply a bool param for forceNotify")}catch(a){i.default.reportError(a)}this._itemsDirty=!0,t&&(this._forceNotify=t),e&&(this._updateSearch=e),0===this._isWaitingUpdateItems&&this._updateAllItems()}_updateAllItemHeights(){Wr.PaneManager.runForEachPane(e=>{e.itemsHeightDirty&&e.updateItemHeights()})}updateAllItemHeights(){0===this._isWaitingUpdateItems?this._updateAllItemHeights():this._itemHeightsDirty=!0}},p()(ji.prototype,"checkItemsUpdated",[f.a],Object.getOwnPropertyDescriptor(ji.prototype,"checkItemsUpdated"),ji.prototype),p()(ji.prototype,"updateWatchdog",[f.a],Object.getOwnPropertyDescriptor(ji.prototype,"updateWatchdog"),ji.prototype),ji),Gi=a(39),Ki=0;var Yi=(qi=class{constructor(e,t){try{i.default.PAssert(638,e,"Must provide valid message info")}catch(a){i.default.reportError(a)}try{i.default.PAssert(639,t,"Must provide a valid message owner")}catch(a){i.default.reportError(a)}if(this.info=e,this.id=e.id||"Message_"+Ki++,this.owner=t,this.timeout=e.timeout||r.a.ToastTimeoutDefault,this.text=new A.a(e.text),this.action=e.action||r.a.MessageAction.Default,this.isBig=e.big,this.data=e.data,this.hold=!e.timeout&&!1!==e.hold&&(e.hold||this.action!==r.a.MessageAction.Default),this.noIgnore=e.noIgnore,this.onCloseFn=e.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=e.actionText,!this.actionText)switch(this.action){case r.a.MessageAction.Default:this.actionText="";break;case r.a.MessageAction.Reload:case r.a.MessageAction.ResetClient:this.actionText="RELOAD";break;case r.a.MessageAction.Okay:this.actionText="OKAY";break;case r.a.MessageAction.Blog:this.actionText="BLOG";break;case r.a.MessageAction.Undo:this.actionText="UNDO";break;case r.a.MessageAction.LoginScreen:this.actionText="LOGIN";break;case r.a.MessageAction.Contact:this.actionText="CONTACT";break;case r.a.MessageAction.OpenSettings:case r.a.MessageAction.OpenAccountSettings:case r.a.MessageAction.OpenLinkedSettings:case r.a.MessageAction.OpenGeneralSettings:case r.a.MessageAction.OpenCalendarSettings:this.actionText="SETTINGS";break;case r.a.MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case r.a.MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case r.a.MessageAction.StartDemo:this.actionText="START DEMO"}}show(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide,this.timeout)),this.owner.onMessageShow(this))}hide(){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),this.owner.onMessageHide(this))}isVisible(){return this._isVisible}doAction(e){if(this.isVisible()){if(i.default.isFunction(this.action))this.action();else switch(this.action){case r.a.MessageAction.None:case r.a.MessageAction.Okay:case r.a.MessageAction.Default:break;case r.a.MessageAction.Reload:i.default.reload();break;case r.a.MessageAction.LoginScreen:v.a.removeURLParam("demo");break;case r.a.MessageAction.Demo:v.a.insertURLParam("demo","true");break;case r.a.MessageAction.ResetClient:break;case r.a.MessageAction.OpenURL:var t=this.data?this.data.url:void 0;try{i.default.PAssert(640,t,"Should always have a valid URL to navigate")}catch(a){i.default.reportError(a)}t&&i.default.openUrl(t);break;case r.a.MessageAction.Blog:i.default.openUrl("https://www.moo.do/blog/updates");break;case r.a.MessageAction.Undo:Gi.a.undo();break;case r.a.MessageAction.LoginScreen:v.a.removeURLParam("demo",!0),v.a.removeURLParam("dmode");break;case r.a.MessageAction.Contact:Wr.menus.openModal(r.a.Modals.ReportBug);break;case r.a.MessageAction.OpenSettings:Wr.menus.openSettings(r.a.SettingsSections.Plugins);break;case r.a.MessageAction.OpenGeneralSettings:Wr.menus.openSettings(r.a.SettingsSections.General);break;case r.a.MessageAction.OpenAccountSettings:Wr.menus.openSettings(r.a.SettingsSections.Account);break;case r.a.MessageAction.OpenLinkedSettings:Wr.menus.openSettings(r.a.SettingsSections.Linked);break;case r.a.MessageAction.OpenCalendarSettings:Wr.menus.openSettings(r.a.SettingsSections.GoogleCalendar);break;case r.a.MessageAction.OpenGoogleDrive:i.default.openUrl("https://drive.google.com");break;case r.a.MessageAction.OpenDisplaySettings:i.default.vmMain.isDisplaySettingsOpen.set(!0);break;case r.a.MessageAction.StartDemo:window.postMessage("resume","*");break;default:try{i.default.PAssert(641,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(a){i.default.reportError(a)}}e&&i.default.stopPropagation(e),this.info.holdOnAction||this.hide()}}onTapIgnore(e){this.isVisible()&&!this.noIgnore&&this.hide()}setText(e){this.text.set(e)}},p()(qi.prototype,"hide",[f.a],Object.getOwnPropertyDescriptor(qi.prototype,"hide"),qi.prototype),p()(qi.prototype,"onTapIgnore",[f.a],Object.getOwnPropertyDescriptor(qi.prototype,"onTapIgnore"),qi.prototype),qi);var Xi=class{constructor(){this.queue=new M.a,this.defaultMessages=[],this.defaultMessages[r.a.MessageID.Undefined]=void 0}getMessageById(e){void 0===this.defaultMessages[e]&&this.initMessageById(e);try{i.default.PAssert(391,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(t){i.default.reportError(t)}return this.defaultMessages[e]}testMessageById(e){return!!this.defaultMessages[e]}initMessageById(e){var t;switch(e){case r.a.MessageID.ConnectionError:t={text:"Connection error detected. Please reload to try again.",action:r.a.MessageAction.Reload};break;case r.a.MessageID.OfflineUndo:t={text:"Offline undo/redo has been disabled temporarily.",hold:!0};break;case r.a.MessageID.FatalError:t={text:"There was a fatal error in the application. "+y.a.actionVerbCaps()+" to restart.",action:r.a.MessageAction.Reload};break;case r.a.MessageID.MailbirdClick:t={text:"Sorry, emails can currently only be opened from inside Mailbird.",action:r.a.MessageAction.Okay};break;case r.a.MessageID.ExitDemo:t={text:"Changes are not saved in demo",action:r.a.MessageAction.LoginScreen,hold:!0,noIgnore:!0};break;case r.a.MessageID.ShareFailure:t={text:"There was an error sharing the file you attached.",action:r.a.MessageAction.OpenSettings,timeout:8e3};break;case r.a.MessageID.ThisIsDemo:t={text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:()=>{window.parent.postMessage("userInteracted","*")},hold:!0,big:!0};break;case r.a.MessageID.InviteFailure:t={text:"Failed to use referral code. Please try again in your account settings.",action:r.a.MessageAction.OpenAccountSettings};break;case r.a.MessageID.InviteSuccess:t={text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:r.a.MessageAction.Okay};break;case r.a.MessageID.PremiumRequired:t={text:"You must be a premium subscriber to use plugins.",action:r.a.MessageAction.OpenAccountSettings,actionText:"LEARN MORE"};break;case r.a.MessageID.TrialOver:t={text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:r.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case r.a.MessageID.TrialEndSoon:t={text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:r.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case r.a.MessageID.WarnLargeFile:t={text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:r.a.MessageAction.OpenGoogleDrive};break;case r.a.MessageID.InviteInvalid:t={text:"Invalid referral code. Please try again in your account settings.",action:r.a.MessageAction.OpenAccountSettings,actionText:"OKAY"};break;case r.a.MessageID.NoSharingWarning:t={text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:r.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case r.a.MessageID.LostPermission:t={text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:r.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case r.a.MessageID.CalendarSync:t={text:"There was an error syncing your calendars.",action:r.a.MessageAction.OpenCalendarSettings,actionText:"SETTINGS"};break;case r.a.MessageID.EmailSendFail:t={text:"Your email was not sent, there was an error contacting the remote server."};break;case r.a.MessageID.EmailUpdateFail:t={text:"Unable to save draft to Gmail. Your draft is still saved locally."};break;case r.a.MessageID.EmailLabelFail:t={text:"Unable to sync you changes to Gmail. Your changes are still saved locally."};break;case r.a.MessageID.EmailSyncFail:t={text:"There was an error syncing your Gmail data.",action:()=>{Wr.pluginManager.getPluginGmail().runThreadSync()},actionText:"RETRY"};break;case r.a.MessageID.DemoPluginClick:t={text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3};break;case r.a.MessageID.PromptScriptStart:t={text:"Start demo",hold:!0,big:!0,action:r.a.MessageAction.StartDemo};break;case r.a.MessageID.SnoozeOffline:t={text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:r.a.MessageAction.Okay};break;case r.a.MessageID.NeedDrivePermission:t={text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:r.a.MessageAction.OpenSettings};break;case r.a.MessageID.NeedGmailPermission:t={text:"Sending email requires the Gmail plugin to be enabled in settings.",action:r.a.MessageAction.OpenSettings};break;case r.a.MessageID.LostLinked:t={text:"Moo.do has lost access to one of your linked accounts.",action:r.a.MessageAction.OpenLinkedSettings};break;case r.a.MessageID.GmailDisabled:t={text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:r.a.MessageAction.Okay};break;case r.a.MessageID.LocalWritesDisabled:t={text:"There was an error writing to the local cache. Please restart Moo.do.",action:r.a.MessageAction.Reload};break;case r.a.MessageID.MissingOffline:case r.a.MessageID.MissingOfflineMobile:t={text:"We are missing authorization for your account. Please reauthorize.",actionText:"REAUTHORIZE",action:()=>{$.a.enableOfflineFeatures(!0)}};break;case r.a.MessageID.FlatSearchMultiSelect:t={text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."};break;case r.a.MessageID.FlatSearchEnter:t={text:"Pressing Enter in flat search results is not supported because it would have unpredictable results."};break;case r.a.MessageID.FlatSearchTab:t={text:"Indenting search results while in flat search results is not supported because it would have unpredictable results."};break;case r.a.MessageID.ReadOnlyCalendar:t={text:"You do not have write permission for the calendar you are trying to modify."};break;case r.a.MessageID.CalendarSaveFail:t={text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."};break;case r.a.MessageID.QuotaError:t={text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3};break;case r.a.MessageID.ReselectEmail:t={text:"Please re-select the email item and try again."};break;case r.a.MessageID.ReactError:t={text:"The application has encountered an error. The developers have been notified, but sending a bug report describing what happened would be very helpful!",actionText:"REPORT",action:()=>{Wr.menus.openModal(r.a.Modals.ReportBug)}};break;case r.a.MessageID.PaneLoadTimeout:t={text:"The file is taking an unusually long time to load. Please try loading again.",actionText:"RELOAD",action:i.default.reload};break;default:try{i.default.PAssert(392,!1,"Invalid MessageID: ",e)}catch(a){i.default.reportError(a)}}t&&(this.defaultMessages[e]=new Yi(t,this))}pushMessage(e){try{i.default.PAssert(393,e,"Must supply a valid message to display")}catch(a){i.default.reportError(a)}var t;if(e instanceof Yi)t=e;else if(i.default.isObject(e))this.hasMsgWithText(e.text)||(t=new Yi(e,this));else if(i.default.isString(e))this.hasMsgWithText(e)||(t=new Yi({text:e},this));else if(!(t=this.getMessageById(e))){try{i.default.PAssert(394,!1,"Invalid data passed to message creation")}catch(a){i.default.reportError(a)}i.default.log("Message not created properly",e)}return t&&t.show(),t}clearMessage(e){var t;return e instanceof Yi?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t}isMessageVisible(e){var t=!1;return e instanceof Yi?t=e.isVisible():this.testMessageById(e)&&(t=this.getMessageById(e).isVisible()),t}onMessageShow(e){try{i.default.PAssert(395,e,"Must pass in a valid message to add to the queue")}catch(t){i.default.reportError(t)}try{i.default.PAssert(396,e&&e.doAction,"Message added to queue must have valid API exposed - doAction")}catch(t){i.default.reportError(t)}e instanceof Yi?this.queue.push(e):i.default.reportError(new Error("Toast message must be an instance of Toast"),e)}onMessageHide(e){try{i.default.PAssert(397,e,"Must pass in a valid message to be removed from the queue")}catch(a){i.default.reportError(a)}var t=this.queue.indexOf(e);if(t<0)try{i.default.PAssert(398,!1,"Trying to remove an invalid message from the queue")}catch(a){i.default.reportError(a)}else this.queue.splice(t,1)}hasMsgWithText(e){return!!this.queue.get().find(t=>t.text.get()===e)}};var Qi=class{init(){}render(e,t){var a,s=0,n=[],{convertSpaces:o,pane:l,noPrefix:d,suffix:h,highlightSearch:c,item:u}=t,p=!1;try{i.default.PAssert(401,e,"C Item has no els: ")}catch(C){i.default.reportError(C)}e||(e=[]);for(var g=0;g<e.length;++g){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var f=e[g],m=f.getAttrs(),v="",y="",_=f.getStyledText(l,!0,u,{highlightSearch:c});if(!c||m&&f.hasClass("plugin")?f.hasClass("plugin")||(_=i.default.escape(_)):_=this.replaceTextWithSearch(_,l),o&&(_=_&&_.replace(/ /g,"&nbsp;")),!d||!f.hasClass("itemPrefix"))if(m){if(l&&!l.plugin&&f.hasClass("plugin_drive_image_inline")){var S=Wr.pluginManager.getPluginDrive(),P=S.getAttachment(f.getAttr("plugin-id")),I=S.getAttachUrl(P);if(I)return{isImage:!0,isDriveImage:!0,maxWidth:S.getAttachWidth(P),src:I,srcDataUrl:S.getAttachDataUrl(P),text:f.getParsedText(),originalText:f.getParsedText(),previousText:n.join(""),attach:P,nextText:g<e.length-1?" ":""}}if(f.hasClass("mdImage"))return{isImage:!0,src:f.getAttr("data-href"),text:f.getParsedText(),maxWidth:f.getAttr("size"),originalText:f.getAttr("data-original-text"),previousText:n.join(""),nextText:g<e.length-1?" ":""};var b="",D="",w=f.getClassString();for(var E in f.getAttr("appLink")&&(p||(b+='<span class="appLink '+((f.hasClass("evernote")?"Evernote":"")||(f.hasClass("onenote")?"OneNote":"")||(f.hasClass("bear")?"Bear":""))+'">',b+='<span contenteditable="false"'+(f.getAttr("appLinkStart")?' class="appLinkStart"':"")+"></span>"),p=!0),f.hasClass("plugin")&&(_="<span>"+_+"</span>"),b+="<span ",D+=">"+_+"</span>",f.hasClass("plugin")&&(b+='contenteditable="false" '),m)m.hasOwnProperty(E)&&("cls"===E?(y='class="'+w+'" ',"itemPrefix"===m[E][0]&&(a=!0)):"appLink"!==E&&(v+=E+'="'+m[E]+'" '));!p||g!==e.length-1&&e[g+1].getAttr("appLink")||(D+="</span>",p=!1),y||v?n.push(b+(y||"")+(v?" "+v:"")+D):n.push(_)}else n.push(_)}return a&&1===e.length&&n.push("<span>"+r.a.TextSpace+"</span>"),h&&n.push(h),n.join("")}replaceTextWithSearch(e,t){var a=0,r=t.search.getSearchWords(),s=e.toLowerCase(),n=[],o=e.length+1;for(let i=0;i<r.length;i++){var l=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let e,t,h=r[i];for(;(e=s.indexOf(h,t))>=0;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(e>=0){var d=0;for(let t=e;t<e+h.length;t++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;(isNaN(o)||t<o)&&(o=t),n[t]=!0}}t=e+1}}if(o<=e.length){var h=0,c=-1,u=!0;for(let t=e.length-1;t>=o-1;t--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(c>=0&&(t<0||!n[t])){var p=e.substring(t+1,c+1),g=e.substr(c+1),f=e.substr(0,t+1);t===o&&(f=i.default.escape(f)),u&&(g=i.default.escape(g),u=!1),e=f+'<span class="c-search-highlight">'+i.default.escape(p)+"</span>"+g,c=-1}n[t]&&c<0&&(c=t)}}else e=i.default.escape(e);return e}renderRichText(e,t){}},$i=a(42);var Ji=class{init(){this.storage=$i.a.storage()}async uploadString(e,t){return new Promise((a,i)=>{let r=this.storage.ref(e).putString(t);r.on("state_changed",e=>{},e=>{i(e)},()=>{r.snapshot.ref.getDownloadURL().then(e=>a(e))})})}async getString(e){let t=await this.storage.ref(e).getDownloadURL();if(t)try{return(await fetch(t)).text()}catch(a){i.default.reportError(a)}}},Zi=a(73);var er=new class{deriveKey(e,t){const a=(new TextEncoder).encode(e),i=Zi.a.str2ab(t);return crypto.subtle.importKey("raw",a,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then(e=>crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:2e5,hash:"SHA-512"},e,{name:"AES-CTR",length:256},!1,["encrypt","decrypt"])).then(e=>e)}importKey(e){return crypto.subtle.importKey("raw",e,"AES-CTR",!0,["encrypt","decrypt"])}exportKey(e){return crypto.subtle.exportKey("raw",e)}encrypt(e,t,a){const i={name:"AES-CTR",counter:a,length:128};return crypto.subtle.encrypt(i,t,e)}decrypt(e,t,a){const i={name:"AES-CTR",counter:a,length:128};return crypto.subtle.decrypt(i,t,e)}};var tr,ar=new class{key(e,t){return er.deriveKey(e,t)}saltToCounter(e){let t=Zi.a.str2ab(e);if(t.length>16)t=t.slice(0,16);else if(t.length<16){var a=0;let e=new Uint8Array(16);for(var i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e[i]=t[i]}t=e}return t}encrypt(e,t,a){const i=this.saltToCounter(a),r=Zi.a.unicode2ab(e);return er.encrypt(r,t,i).then(e=>Zi.a.ab2str(e))}decrypt(e,t,a){const i=this.saltToCounter(a),r=Zi.a.str2ab(e);return er.decrypt(r,t,i).then(e=>Zi.a.ab2unicode(e))}};const ir="afolaw8klslbsahgbeoiya4pifoqlncduzvxgze60lvk17sevauroatsxm8qqia",rr=new Uint8Array([76,30,217,70,117,53,119,240,33,22,147,24,106,228,253,86,175,251,159,47,232,124,89,230,19,65,243,211,58,83,88,158]).buffer;function sr(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,sr):this.stack=(new Error).stack}function nr(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,nr):this.stack=(new Error).stack}sr.prototype=Object.create(Error.prototype),sr.prototype.name="InvalidArgumentError",sr.prototype.constructor=sr,nr.prototype=Object.create(sr.prototype),nr.prototype.name="InvalidPasswordError",nr.prototype.constructor=nr;var or=(tr=class{constructor(){this.sentinel=r.a.EncryptionSentinel,this.keys={},this.onLoadCbs=[],this.onUpdated=new T.a,this.importKeys({}).then(()=>{this.isLoaded=!0,this.onLoadCbs.forEach(e=>e())})}onLoad(e){this.isLoaded?e():this.onLoadCbs.push(e)}canDecryptSentinel(e){return!!this.getKeyBySentinel(e)}getKeyBySentinel(e){for(var t in this.keys)if(this.keys[t].sentinel===e)return this.keys[t].key}encryptSentinel(e,t){return ar.encrypt(this.sentinel,e,t)}createKeyInfo({name:e,password:t,sentinelSalt:a}){return ar.key(t,ir).then(t=>this.encryptSentinel(t,a).then(a=>({name:e,key:t,sentinel:a})))}importKeys(e={}){return this.keys.Global||(e[r.a.EncryptionKeys.Global]=rr),e[r.a.EncryptionKeys.UserPassword]&&!ke.a.getEncryptionUid()?new Promise(t=>{Wr.settings.userId.onHasValue(a=>{this.importKeys(e).then(e=>t(e))})}):Promise.all(Object.keys(e).map(t=>{let a=e[t],s=(t===r.a.EncryptionKeys.Global?ir:t===r.a.EncryptionKeys.UserPassword&&ke.a.getEncryptionUid())||t;return a instanceof CryptoKey?this.encryptSentinel(a,s).then(e=>{this.keys[t]={name:t,key:a,sentinel:e}}):(i.default.isString(a)&&(a=Zi.a.str2ab(a)),er.importKey(a).then(e=>this.encryptSentinel(e,s).then(a=>{this.keys[t]={name:t,key:e,sentinel:a}})))})).then(()=>this.keys).catch(e=>(console.log(e),this.onUpdated.notify(),this.keys))}getGlobalKeyInfo(){return this.keys[r.a.EncryptionKeys.Global]}getGlobalKey(){return this.keys[r.a.EncryptionKeys.Global].key}getKey(e){return this.keys[e].key}getKeyInfo(e){return this.keys[e]}setKey({name:e,password:t,sentinelSalt:a}){return this.createKeyInfo({name:e,password:t,sentinelSalt:a}).then(t=>(this.keys[e]=t,this.onUpdated.notify(),t))}canDecrypt({source:e,target:t,key:a}){return ar.decrypt(e,a.key,a.salt).then(e=>e===t)}findDecryptKeys({source:e,target:t,keys:a}){const r=i.default.objectValues(a).map(t=>ar.decrypt(e,t.key,t.salt).then(e=>({name:t,text:e})));return Promise.all(r).then(e=>e.filter(e=>e.text===t).map(e=>e.name))}addKey({name:e,password:t,sentinelSalt:a}){return"string"!==typeof e?Promise.reject(new sr(`Name must be a string. Saw: ${e}`)):e in this.keys?Promise.reject(new sr(`${e} exists. Use 'updateKey' to change existing keys.`)):this.setKey({name:e,password:t,sentinelSalt:a})}updateKey({name:e,password:t,sentinelSalt:a}){return"string"!==typeof e?Promise.reject(new sr(`Name must be a string. Saw: ${e}`)):e in this.keys?this.setKey({name:e,password:t,sentinelSalt:a}):Promise.reject(new sr(`${e} does not exist. Use 'addKey' to add new key.`))}removeKey(e){delete this.keys[e]}createKey({name:e,password:t,sentinelSalt:a}){return"string"!==typeof e?Promise.reject(new sr(`Name must be a string. Saw: ${e}`)):this.createKeyInfo({name:e,password:t,sentinelSalt:a})}exists(e){return!!(e in this.keys)}encryptText(e,t,a){const r="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;try{i.default.PAssert(365,r,"No valid encryption key")}catch(s){i.default.reportError(s)}return"string"!==typeof t?Promise.reject(new sr(`Text must be a string. Saw: ${t}`)):ar.encrypt(t,r,a)}decryptText(e,t,a){const i="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;return"string"!==typeof t?Promise.reject(new sr(`Text must be a string. Saw: ${t}`)):ar.decrypt(t,i,a)}exportKey(e){return er.exportKey(e)}},p()(tr.prototype,"addKey",[f.a],Object.getOwnPropertyDescriptor(tr.prototype,"addKey"),tr.prototype),p()(tr.prototype,"updateKey",[f.a],Object.getOwnPropertyDescriptor(tr.prototype,"updateKey"),tr.prototype),tr);var lr=class{constructor(){this._items=new M.a}addItemEntry(e,t){this.hasItemEntry(e)||this._items.push({id:e.id,item:e,pane:t})}removeItemEntry(e){var t=this._items.indexOfWithProperty("id",e);if(t>=0)return this._items.splice(t,1)[0]}hasItemEntry(e){var t=this.getItemEntry(e);return!(!t||t.isText)}getItemEntry(e){var t=this._items.indexOfWithProperty("id",e.id);return this._items.get()[t]}getItems(){return this._items}hasItems(){return this._items.get().length>0}};var dr=class{constructor(){this.modalStack=new M.a,this.contextMenuStack=new M.a,this.emailComposeStack=new M.a,v.a.forceBind("onClosingSettings",this)}toggleContextMenu(e,t){this.isContextMenuOpen()?this.closeContextMenu():this.openContextMenu(e,t)}openAddPaneMenu(e){e.componentName="ReactContextMenuAddPane",e.onSelected=function(e,t,a){Wr.PaneManager.addPaneByButton(e,t,a)},this.openContextMenu(e)}openContextMenu(e,t){e.element&&i.default.findParent(e.element,"desktopSidebar")&&(e.pos={left:Wr.DesktopUI.getSidebarWidth()+4},e.side="right",i.default.findParent(e.element,"desktopMenuBottom")&&(e.openFromBottom=!0)),this.contextMenuNoFade=t,this.contextMenuStack.push(e)}indexOfContextMenu(e){var t=this.contextMenuStack.get(),a=t.indexOfWithProperty("fn",e);return a<0&&(a=t.indexOfWithProperty("componentName",e)),a}closeContextMenu(e,t,a){if(e){var r=this.indexOfContextMenu(e);try{i.default.PAssert(366,r>=0,"Tried to close a context menu that was not open")}catch(d){i.default.reportError(d)}if(r>=0){var s=this.contextMenuStack.get()[r];s.onClosed&&s.onClosed(t,a),this.contextMenuStack.removeAt(r)}}else{for(var n=0,o=this.contextMenuStack.get(),l=o.length-1;l>=0;l--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o[l].onClosed&&o[l].onClosed(!1,a)}this.contextMenuStack.clear()}0===this.contextMenuStack.length()&&_.a.updateCaret()}getTopContextMenu(){var e=this.contextMenuStack.get();if(e&&e.length){var t=e[e.length-1];return t.componentName||t.fn}}isAutocompleteOpen(){return this.indexOfContextMenu("ReactAutocomplete")>=0||this.indexOfContextMenu("ReactContextMenuDate")>=0}isOnlyAutocompleteOpen(){return this.isAutocompleteOpen()&&1===this.contextMenuStack.get().length}isContextMenuOpen(e){return e?this.indexOfContextMenu(e)>=0:this.contextMenuStack.get().length>0}isModalOpen(e){var t=this.modalStack.get();if(!e)return t.length>0;for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t[i].id===e)return!0}}openModal(e,t){try{i.default.PAssert(367,void 0===t||i.default.isObject(t),"Must always pass in a valid object for params")}catch(a){i.default.reportError(a)}if(!this.isModalOpen(e)){t=t||{};try{i.default.PAssert(368,void 0===t.id,"Should not already have an ID defined with modal params")}catch(a){i.default.reportError(a)}t.id=e,_.a.reset(),this.modalStack.push(t)}}closeModal(e,t){var a=this.modalStack.get().indexOfWithProperty("id",e);if(a>=0){var i=this.modalStack.get()[a],r=!0;i.onClosing&&(r=i.onClosing()),r&&(this.modalStack.removeAt(a),i.callback&&i.callback(t))}}confirm(e,t){try{i.default.PAssert(369,t,"Confirm modals should have callbacks",e)}catch(a){i.default.reportError(a)}this.openModal(r.a.Modals.Confirm,{text:e,callback:t})}prompt(e,t){try{i.default.PAssert(370,t,"Prompt modals should have callbacks",e)}catch(a){i.default.reportError(a)}this.openModal(r.a.Modals.Prompt,{text:e,callback:t})}alert(e){try{i.default.PAssert(371,!e.action,"Still using an old style alert",e)}catch(t){i.default.reportError(t)}e.action&&(e.callback=e.action),this.openModal(r.a.Modals.Alert,e)}options(e,t,a){try{i.default.PAssert(372,i.default.isArray(t),"Must have valid options array")}catch(s){i.default.reportError(s)}try{i.default.PAssert(373,a,"Options modal must have a callback")}catch(s){i.default.reportError(s)}this.openModal(r.a.Modals.Options,{text:e,options:t,callback:a})}openSettings(e){P.d.performAction(P.b.UIAction,{type:P.c.OpenSettingsMenu}),this.openModal(r.a.Modals.Settings,{section:e,onClosing:this.onClosingSettings})}onClosingSettings(){var e=!$.a.isSaveEnabled.get();return e||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(e){e&&($.a.isSaveEnabled.set(!1),this.closeModal(r.a.Modals.Settings))}.bind(this)),e}openDisplaySettings(){_.a.reset(),i.default.vmMain.isDisplaySettingsOpen.set(!0),P.d.performAction(P.b.UIAction,{type:P.c.OpenDisplaySettings})}getUserEmail(){return Wr.settings.getUserIdentifier()}getUserName(){return i.default.isDemoMode()?"Demo":ke.a.getAccountName()}_indexOfCompose(e){for(var t=0,a=this.emailComposeStack.get(),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].draftMsg.id===e)return i}return-1}isComposeOpenForEmail(e){return e?this._indexOfCompose(e)>=0:this.emailComposeStack.length()>0}openComposeEmail(e,t,a,r){try{i.default.PAssert(374,e,"Must have a valid email plugin")}catch(n){i.default.reportError(n)}try{i.default.PAssert(375,!t||i.default.isString(t),"Must have a string threadID")}catch(n){i.default.reportError(n)}try{i.default.PAssert(376,!a||i.default.isString(a),"Must have a string messageID")}catch(n){i.default.reportError(n)}if(_.a.reset(),this.isComposeOpenForEmail());else{var s=e.getDraftByID(e.getDefaultAccount(),t,a,r);try{i.default.PAssert(377,s,"Must always create a valid draft")}catch(n){i.default.reportError(n)}try{i.default.PAssert(378,this.emailComposeStack.indexOf(s)<0,"Must not double-open drafts, should re-use")}catch(n){i.default.reportError(n)}this.emailComposeStack.get().indexOfWithProperty("attach",s.attach)<0&&this.emailComposeStack.push(s)}P.d.miscAction({type:P.b.Misc,misc:P.a.ComposeEmail})}closeComposeEmail(e,t){var a=this._indexOfCompose(t.id);try{i.default.PAssert(379,a>=0,"Must have found a valid composing email to remove")}catch(r){i.default.reportError(r)}this.emailComposeStack.removeAt(a)}openItemEditor(e){try{i.default.PAssert(380,!e.item===!!e.addOnSave,"Must be adding item if no item prop")}catch(s){i.default.reportError(s)}if(!e.item){e.parent||(e.parent=e.pane&&e.pane.type===r.a.PaneMode.Task?e.pane.getRootItem():o.a.getDefaultDocument().getRootItem());var t=o.a.createTempVMLI({text:e.text||Wr.settings.getDefaultItemText(),date:e.mooDate},{changeType:r.a.ChangeType.AllLocal});e.item=t;var a=e.endSave;e.endSave=()=>{setTimeout(()=>{o.a.destroyTempVMLI(t.id)},0),a&&a.apply(this,arguments)}}e.componentName="ReactItemDetailsPopup",this.openContextMenu(e)}openLightbox(e,t,a){this.openModal(r.a.Modals.Lightbox,{src:e,buttonText:t,buttonAction:a})}confirmEncrypt(e,t){this.openModal(r.a.Modals.ConfirmEncrypt,{password:e,onYes:()=>t(!0),onCancel:()=>t(!1)})}},hr=a(88);var cr=function(e,t){(()=>{function a(e){console.log("ERROR: ",e)}var i,r=window.InjectedJS={postMessage:function(t,i){try{var r;if(void 0!==i)if("string"===typeof i)r=i;else try{r=JSON.stringify(i)}catch(s){a(s),r=""}else r="";window.parent.postMessage("-"+t+"-"+e+"-"+r,"*")}catch(s){a(s)}}};i=function(e){var a=1;t.isAndroid&&(a=function(e){var t=document.documentElement.clientWidth/e;return Math.max(t,.25)}(document.documentElement.scrollWidth))<1&&(document.documentElement.style.transform="scale("+a+")"),r.postMessage("resize",{canBeShorter:e,scale:a})};var s=!1;function n(){document.removeEventListener("DOMContentLoaded",n,!1),s?i():(s=!0,function(){var e=0,t=0,a=0;document.documentElement.addEventListener("click",e=>{r.postMessage("click")}),document.addEventListener("keydown",e=>{var t={type:e.type,keyCode:e.keyCode,charCode:e.charCode,which:e.which,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey};r.postMessage("keypress",t)},!0);for(var s=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=this.getAttribute("href");return t.startsWith("attach:")?r.postMessage("reqResource",[t]):t.startsWith("moodoAction:")?r.postMessage(t.replace(/^moodoAction:/gi,"")):r.postMessage("href",t),!1},n=document.querySelectorAll("[mlink]"),o=0;o<n.length;++o){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[o].addEventListener("click",s)}var l=document.querySelectorAll("[place]");for(o=0;o<l.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;l[o].addEventListener("click",function(e){for(var t=0,a=this.id,r=this.nextElementSibling,s=!1;r&&r.getAttribute("group")===a;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n="collapsed"===r.getAttribute("quote")?"uncollapsed":"collapsed";"collapsed"===n&&(s=!0),r.setAttribute("quote",n),r=r.nextElementSibling}return setTimeout(()=>{i(s)},0),e.stopImmediatePropagation(),e.preventDefault(),!1})}var d=[],h=document.querySelectorAll("img");for(o=0;o<h.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=h[o].getAttribute("cid");c&&d.push(c),h[o].addEventListener("load",()=>{i()})}d.length>0&&r.postMessage("reqResource",d)}(),r.postMessage("epLoaded"))}window.addEventListener("message",e=>{if(e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),r=e.data.substring(1,t),s=e.data.substring(t+1);switch(r){case"resLoad":try{if(s)for(var n=0,o=JSON.parse(s),l=document.querySelectorAll('[cid="'+o.cid+'"]'),d="data:"+o.mimeType+";base64,"+o.data,h=0;h<l.length;++h){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;l[h].src=d}}catch(c){a(c)}break;case"contentLoad":try{s&&(o=JSON.parse(s),document.open(),document.write(o.data),document.close(),setTimeout(i,0))}catch(c){a(c)}break;default:a(new Error("Unknown PreviewFrame message: "+r))}}}),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(n):(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1))})()}.toString(),ur=class{constructor(){this.openOnPane=void 0,this.messageIDs=new M.a,this.messagesLoaded=new A.a(!1),this.isLoading=new A.a(!1),this.errorMessage=new A.a(""),this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,v.a.binder(this,"onAttachmentUpdate","reset","_onWindowResizeTimeout")}init(){Wr.DisplaySettings.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),window.addEventListener("message",e=>{if(i.default.getLocationOrigin()===e.origin&&e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),a=e.data.indexOf("-",t+1);a<0&&(a=void 0);var r=e.data.substring(1,t),s=e.data.substring(t+1,a),n=a?e.data.substring(a+1):void 0;i.default.batchRenderUpdates(()=>{this.handleFrameMessage(s,r,n,e)})}}),n.a.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),y.a.onResize.listen(this._onWindowResize.bind(this))}reset(e,t){if(this.threadAttach){for(var a=0,i=this.threadAttach.getField("messages"),r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[r].initializedForDisplay&&this._destroyMessageDisplay(i[r])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(t,!1),this.messagesLoaded.set(!1,!1),this.messageIDs.get().length>0&&this.messageIDs.set([],e)}_onWindowResizeTimeout(){if(this.threadAttach)for(var e=0,t=this.threadAttach.getField("messages"),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.updateMessageHeight(t[a].id,!0)}}_onWindowResize(){i.default.timeoutOnce("email resize",this._onWindowResizeTimeout,0)}getPlugin(){return this.threadAttach?this.threadAttach.getPlugin():Wr.pluginManager.getPluginGmail()}_sendReply(e,t,a){try{i.default.PAssert(519,e,"Must supply a valid target")}catch(s){i.default.reportError(s)}try{i.default.PAssert(520,t,"Must supply a valid action")}catch(s){i.default.reportError(s)}try{var r="-"+t+(void 0!==a?"-"+a:"");e.postMessage(r,"*")}catch(n){i.default.reportError(n)}}handleFrameMessage(e,t,a,r){switch(t){case"resize":try{var s=JSON.parse(a);this.updateMessageHeight(e,!0===s.canBeShorter,s.scale)}catch(f){i.default.reportError(f)}break;case"click":n.a.fireEvent("tapMain",[]);break;case"keypress":try{var o=JSON.parse(a);y.a.normalizeKeys(o),_.a.fireKeyEvent(document.documentElement,o)}catch(f){i.default.reportError(f)}break;case"href":if(a.startsWith("mailto:")){var l=this.parseMailtoURL(a.replace(/^mailto:/gi,"")),d={to:[{email:l.to}],subject:l.subject&&unescape(l.subject),body:l.body&&unescape(l.body).replace(/\r?\n/g,"<br>")};Wr.menus.openComposeEmail(this.getPlugin(),void 0,void 0,d)}else i.default.openUrl(a);break;case"epLoaded":this.onMessageLoaded(e);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(e,this.threadAttach,e);break;case"reqResource":try{try{i.default.PAssert(521,r,"Must provide a valid request event")}catch(m){i.default.reportError(m)}if(this.threadAttach)for(var h=0,c=JSON.parse(a),u=0;u<c.length;++u){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var p=c[u],g=!1;p.startsWith("attach:")&&(p=p.replace(/^attach:/gi,""),g=!0),this.getPlugin().loadResource(this.threadAttach.id,e,p,async(e,t)=>{var a;if(e){let i;i=g?(await this._createMessageHTML(this.getPlugin()._decodeEmail(e.data,void 0,{}),{},"text/html")).parsed:e.data,a={cid:t,data:i,mimeType:e.mimeType}}try{if(r&&r.source&&a){var s=g?"contentLoad":"resLoad";this._sendReply(r.source,s,a?JSON.stringify(a):void 0)}}catch(n){i.default.reportError(n)}})}}catch(f){i.default.reportError(f)}break;default:i.default.log("Unknown message from child frame: ",e,t,a,r)}}isOpen(){return this.openOnPane&&this.openOnPane.isExpanded.get()}isOpenOnPane(e){return this.openOnPane===e&&this.openOnPane.isExpanded.get()}isOpenOnThread(e){return this.isOpen()&&this.threadAttach===e}close(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),this.reset(),this.wantsPaneTransition=!1,n.a.fireEvent("EmailPreview","onClosed",[]))}setOpenPane(e,t){this.openOnPane&&this.openOnPane!==e&&this.openOnPane.setExpanded(!1,t),this.openOnPane=e,e&&e.setExpanded(!0,t)}_openPane(e,t){try{i.default.PAssert(522,t,"Must supply a valid cb to openPane")}catch(a){i.default.reportError(a)}e!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout(()=>{this.wantsPaneTransition=!1,t()},r.a.EmailOpenTime+100)):t(),this.setOpenPane(e)}getPane(){try{i.default.PAssert(523,this.openOnPane,"Should not be trying to get pane if email preview is not open")}catch(e){i.default.reportError(e)}return this.openOnPane}startOpenOnLoad(e){this.setOpenPane(e,!1)}open(e,t,a,i){if(t!==this.threadAttach||a!==this.openOnPane){var r=t.getPlugin();this.reset(!0,!0),this.threadAttachLoading=t,Wr.PaneManager.ensurePaneInView(a);var s=2,n=!1;i&&this.messageIDs.listen(()=>{let e=this.getMessages();if(e.length>0)return e[e.length-1].labelIds.indexOf("DRAFT")<0&&this.setLastMessageResponseMode(i),!1});var o=()=>{0===--s&&t===this.threadAttachLoading&&(n?(this._setThread(t,e),P.d.miscAction({type:P.b.Misc,misc:P.a.OpenEmail,data:{pane:a}})):this.errorMessage.get()?this.isLoading.set(!1):Wr.menus.alert({text:"Unable to load email messages. You may be offline.",actionText:"OKAY"}))};this._openPane(a,()=>{o()}),r.loadThread(t,(e,t,a)=>{n=e,!e&&a?this.errorMessage.set(a):this.errorMessage.set(""),o()})}else i&&this.isOpen()&&this.setLastMessageResponseMode(i)}_getReplyToFromMessage(e){return this._selfSentMessage(e)?e.to:e.replyTo?[e.replyTo]:[e.from]}_getSenderFromMessage(e){var t=this.threadAttachLoading||this.threadAttach;return this._findSelf(t.getField("accountID"),e)}_selfSentMessage(e){return this.getPlugin().isMyAccountID(e.from.email)}_removeSelf(e){if(e){for(var t=0,a=e.slice(0),i=this.getPlugin(),r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i.isMyAccountID(a[r].email)&&(a.splice(r,1),r--)}return a}}_findSelf(e,t){var a,i=this.getPlugin(),r=i.getSendingAccounts(e);if(r.indexOf(t.from.email)>=0)a=t.from.email;else{if(t.to)for(var s=0,n=0;n<t.to.length;++n){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(r.indexOf(t.to[n].email)>=0){a=t.to[n].email;break}}if(!a&&t.cc){var o=0;for(n=0;n<t.cc.length;++n){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(r.indexOf(t.cc[n].email)>=0){a=t.cc[n].email;break}}}if(!a&&t.bcc){var l=0;for(n=0;n<t.bcc.length;++n){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(r.indexOf(t.bcc[n].email)>=0){a=t.bcc[n].email;break}}}}return a||(a=i.getDefaultSendingAccount(e)),{text:i.getDisplayName(a),email:a}}_updateDraftFromMessage(e,t,a){var s,n,o,l,d=this.getPlugin(),h=e.subject,c=this._getSenderFromMessage(e);try{i.default.PAssert(524,a!==r.a.EmailResponseMode.Compose,"Should never pass Compose mode to _updateDraftFromMessage")}catch(p){i.default.reportError(p)}a===r.a.EmailResponseMode.Reply?s=this._getReplyToFromMessage(e):a===r.a.EmailResponseMode.ReplyAll?(s=this._removeSelf(this._getReplyToFromMessage(e).concat(e.to)),n=this._removeSelf(e.cc)):a===r.a.EmailResponseMode.Forward&&(l=Object.assign({},e.resources)),a&&(o=d.createMessageBody(e,t.from.email,a)),s=i.default.arrayUniques(s||[],"email"),n=i.default.arrayUniques(n||[],"email"),a===r.a.EmailResponseMode.Reply||a===r.a.EmailResponseMode.ReplyAll?(0!==h.toLowerCase().indexOf("re")&&(h="Re: "+h),l=t.resources):a===r.a.EmailResponseMode.Forward&&0!==h.toLowerCase().indexOf("fwd")&&(h="Fwd: "+h);var u={id:t.id,to:s,from:c,cc:n,bcc:void 0,subject:h,decoded:o,resources:l||{}};this.getPlugin().updateDraft(this.threadAttach,t.id,t.draftID,u,!0,!1,e=>{try{i.default.PAssert(525,e,"Should always be able to update a draft")}catch(p){i.default.reportError(p)}})}requestAttachment(e,t,a,i){this.getPlugin().loadResource(e,t,a,i)}getAttachmentURL(e,t,a){return this.getPlugin().getAttachmentURL(e,t,a)}getPreviewURL(e){return this.getPlugin().getPreviewURL(e)}reportMessage(e,t,a,i,r){this.getPlugin().reportMessage(e,t,a,i,r)}dumpMessage(e,t,a){try{i.default.PAssert(526,!1,"Should not be dumping message in non-__DEV__ modes")}catch(r){i.default.reportError(r)}this.getPlugin().dumpMessage(e,t,a)}parseMailtoURL(e){var t={to:void 0,subject:void 0,body:void 0},a=e.split("?");if(t.to=a[0],a[1])for(var i=0,r=a[1].split("&"),s=0;s<r.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r[s].split("=");switch(n[0].toUpperCase()){case"SUBJECT":t.subject=n[1];break;case"BODY":t.body=n[1]}}return t}parseListUnsubscribe(e){for(var t=0,a={emailData:void 0,url:void 0},r=e.split(","),s=0;s<r.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=/^<?(http|https|mailto):([^<>]*)>?/gi.exec(r[s]);if(n)switch(n[1]){case"http":case"https":a.url=n[1]+":"+n[2];break;case"mailto":a.emailData=this.parseMailtoURL(n[2]);break;default:try{i.default.PAssert(527,!1,"Unknown List Unsubscribe Format: "+e)}catch(o){i.default.reportError(o)}}}return a}setMessageResponseMode(e,t){let a=this.getMessages(),s=a[a.indexOfWithProperty("id",e)];try{i.default.PAssert(528,s,"Must be able to find a valid reply message to update response mode for")}catch(n){i.default.reportError(n)}if(s){let a,o=this.getPlugin();if(t!==r.a.EmailResponseMode.None){try{i.default.PAssert(529,s.initializedForDisplay,"Must be initialized for display to set response mode")}catch(n){i.default.reportError(n)}a=o.getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,e,this._getSenderFromMessage(s)),this._updateDraftFromMessage(s,a,t)}s.responseMode&&s.responseMode.set(t)}}setLastMessageResponseMode(e){if(e){let r=this.getMessages();var t=r[r.length-1];try{i.default.PAssert(530,t,"Setting message response mode when there are no messages")}catch(a){i.default.reportError(a)}t&&this.setMessageResponseMode(t.id,e)}}async _createErrorHTML(){return vt.a.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html")}async _createMessageHTML(e,t,a,i){var r={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0};if(i)for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s]);return vt.a.update(e,t,r,a)}_generateCSS(){if(!this._cachedCSS){var e={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};Wr.DisplaySettings.isDark()&&(e.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",e.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var t="";Object.keys(e).forEach(a=>{t+=a+"{",Object.keys(e[a]).forEach(i=>{let r=e[a][i];t+=i+":"+r+";"}),t+="}"}),this._cachedCSS="<style>"+t+"</style>"}return this._cachedCSS}_createFrameBlob(e,t,a){var i={isApp:y.a.app},r=this._generateCSS(),s="<script>("+cr+')("'+a+'",'+JSON.stringify(i)+");<\/script>",n="<!DOCTYPE html>";return t='<meta http-equiv="Content-Type" content="'+t+'">',y.a.supportBlobURLIFrame?new Blob([n,"<html>","<head>",t,r,s,"</head>",e,"</html>"],{type:"text/html"}):[n,"<html>","<head>",t,r,s,"</head>",e,"</html>"].join("")}onMessageLoaded(e){this.updateMessageHeight(e),this.messagesLoaded.set(!0)}getPreviewIFrame(e){return document.getElementById("emailPreview_"+e)}updateMessageHeight(e,t,a){var r=this.getPreviewIFrame(e);if(r){let h=this.getMessages(),c=h[h.indexOfWithProperty("id",e)];t&&(r.style.height="0px");try{var s=r.contentDocument.documentElement;if(s){var n=a||c.defaultScale.get(),o=Math.ceil(s.scrollWidth*n),l=Math.ceil(s.scrollHeight*n);t&&l===c.height.get()&&(r.style.height=l+"px"),c.width.set(o),c.height.set(l),a&&c.defaultScale.get()!==a&&c.defaultScale.set(a)}}catch(d){i.default.reportError(d)}}}_generateAltParts(e,t){var a=this.getPlugin().getMessageAttachments(t);if(a)for(var r=0,s=0;s<a.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=a[s];"application/ics"===n.mimeType&&this.getPlugin().loadResource(e.id,t.id,n.cid,e=>{if(e){var t=hr.a.parseICS(i.default.b64_to_utf8(e.data));i.default.log("Parsed ICS Data: ",t)}})}}_computeResponseMode(e){var t=r.a.EmailResponseMode.None;return e&&e.labelIds.indexOf("DRAFT")>=0&&(t=e.subject.startsWith("Fwd:")?r.a.EmailResponseMode.Forward:e.subject.startsWith("Re:")?1===e.to.length?r.a.EmailResponseMode.Reply:r.a.EmailResponseMode.ReplyAll:r.a.EmailResponseMode.Compose),t}async _createMessageDisplay(e,t,a,r){try{i.default.PAssert(531,!t.initializedForDisplay,"Should only initialize message for display once")}catch(o){i.default.reportError(o)}try{i.default.PAssert(532,t.to,"Must have a valid to object")}catch(o){i.default.reportError(o)}try{i.default.PAssert(533,t.from,"Mus have a valid from object")}catch(o){i.default.reportError(o)}var s,n=!0;t.decoded?(t.isErrorMessage=!1,(s=await this._createMessageHTML(t.decoded,t.resources,t.mimeType,r)).missingResourceData&&(n=!1)):(i.default.reportError(new Error("Missing message decoded data"),"Missing message decoded data: "+i.default.isString(t.decoded)),t.isErrorMessage=!0,s=await this._createErrorHTML());try{i.default.PAssert(534,s.parsed,"Must have valid parsed data")}catch(o){i.default.reportError(o)}return t.blob=this._createFrameBlob(s.parsed,t.contentType,t.id),i.default.isString(t.blob)||(t.blobURL&&(y.a.URL.revokeObjectURL(t.blobURL),t.blobURL=void 0),t.blobURL=y.a.URL.createObjectURL(t.blob)),t.specialLinks=s.specialLinks,t.width||(t.width=new A.a(0)),t.height||(t.height=new A.a(0)),t.defaultScale||(t.defaultScale=new A.a(1)),t.responseMode||(t.responseMode=new A.a(this._computeResponseMode(a))),t.initializedForDisplay=!0,n||this.getPlugin().reportMessage(e.getField("accountID"),e.id,t.id,"Error creating display",!1),t}_destroyMessageDisplay(e){try{i.default.PAssert(535,e.initializedForDisplay,"Message must first be initialized before being destroyed")}catch(t){i.default.reportError(t)}e.initializedForDisplay=!1,e.isErrorMessage=!1,e.width=void 0,e.height=void 0,e.defaultScale=void 0,e.responseMode&&(e.responseMode=void 0),e.specialLinks=void 0,e.blob=void 0,e.blobURL&&(y.a.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0)}async ensureDisplayMessages(e){if(e===this.threadAttach)try{var t=this.getMessages();await Promise.all(t.map((a,r)=>{if(!e.getPlugin().isMessageDraft(a)&&!a.initializedForDisplay){try{this._generateAltParts(e,a)}catch(s){i.default.reportError(s)}return this._createMessageDisplay(e,a,t[r+1],0===r?{collapseQuotes:!1}:void 0)}})),t.equals(this.messageIDs.get())||this.messageIDs.set(t.map(e=>e.id))}catch(a){i.default.reportError(a)}}getMessages(){return this.threadAttach&&this.threadAttach.getField("messages")||[]}async _requestMessageReload(e,t,a){t.getPlugin().forceReloadMessage(t,a,async r=>{try{i.default.PAssert(536,r,"Must be able to re-load message data")}catch(h){i.default.reportError(h)}if(t===this.threadAttach){var s=t.getField("messages"),n=s.indexOfWithProperty("id",a),o=s[n];if(o){var l=this.getPreviewIFrame(e);if(l)if(o.initializedForDisplay=!1,await this.ensureDisplayMessages(t),y.a.supportBlobURLIFrame)l.src=o.blobURL;else{var d=l.contentWindow.document;d.documentElement.innerHTML="",d.open(),d.write(o.blob),d.close()}}}})}onAttachmentUpdate(e,t,a){(!t||t.indexOf("messages")>=0)&&e.getPlugin().loadThread(e,(t,a)=>{try{i.default.PAssert(537,t,"Must be able to re-load thread data")}catch(r){i.default.reportError(r)}a&&e===this.threadAttach&&this.ensureDisplayMessages(e)})}getThreadAttach(){return this.threadAttach}async _setThread(e,t){try{i.default.PAssert(538,e.hasField("messages"),"Must supply valid messages to the email preview")}catch(a){i.default.reportError(a)}try{i.default.PAssert(539,this.errorMessage.get()||e.getField("dataLoaded"),"Must have loaded remote data or have an error")}catch(a){i.default.reportError(a)}if(!this.threadAttach||this.threadAttach.id!==e.id){this.reset(),this.threadAttach=e,this.threadItem=t,e.subscribe(this),await this.ensureDisplayMessages(e);let a=e.getPlugin();a.attachmentHasLabelByID(e,"UNREAD")&&a.performAction(r.a.PluginAction.Gmail.MarkRead,!0,e),n.a.fireEvent("EmailPreview","openThreadChanged",[])}}onSelectedIndexChanged(e,t,a){this.isOpen()&&t===this.openOnPane&&(a&&a.hasAttachmentType(r.a.PluginType.Email)?a.getAttachmentByType(r.a.PluginType.Email).getPlugin()===this.getPlugin()&&this.getPlugin().openEmailByItem(a,t):"PaneGmail"===t.type&&this.reset())}onDisplaySettingsChanged(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}},pr=a(187);var gr=class{init(e){this.settings=new s.a,this.International=new c,this.billingManager=new Pi,this.pluginManager=new fi,this.DisplaySettings=new m,this.itemStoreManager=new z,this.PaneUpdateBatcher=new Wi,this.PaneManager=new X,this.DragDrop=new Q.default,this.timeline=new te,this.cacheManager=new Ci,this.recurringTaskManager=new zi,this.deferredTaskManager=new Ti,this.toasts=new Xi,this.ElementRenderer=new Qi,this.crypto=new or,this.cloudStorage=new Ji,this.dropBucket=new lr,this.menus=new dr,this.EmailPreview=new ur,this.International.init(),this.itemStoreManager.init(),this.cacheManager.init(),this.pluginManager.init(),this.PaneManager.init(),this.recurringTaskManager.init(),this.deferredTaskManager.init(),this.ElementRenderer.init(),this.cloudStorage.init(),this.EmailPreview.init(),b.a.init()}searchVMLIArray(e,t,a){for(var i=0,r=0;r<t.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t[r];if(!e.headers||s.showInOverview()){if((!e.comparator||e.comparator(s,e))&&e.each&&!1===e.each(s,e))return!1;this.searchFromVMLI(s,e,a+1)}}}searchFromVMLI(e,t,a){a=a||0;var i,r=t.noCollapsed,s=t.pane,n=t.overview;t.includeNotes&&!t.headers&&e.hasNote()&&(t.comparator&&!t.comparator(e.getNote(),t)||t.each&&(i=t.each(e.getNote(),t))),!1===i||r&&0!==a&&e.isCollapsed(s,n)||(i=this.searchVMLIArray(t,e.items.get(),a))}searchVMLIs(e){try{i.default.PAssert(103,e,"Must supply a valid options param")}catch(t){i.default.reportError(t)}try{if(e.itemStoreFilter)this.itemStoreManager.runForEachStore(t=>{var a=e.item,i=a&&a.belongsToItemStore(t)?a:t.getRoot();this.searchFromVMLI(i,e)},e.itemStoreFilter);else if(e.item){try{i.default.PAssert(104,!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(t){i.default.reportError(t)}this.searchFromVMLI(e.item,e)}else if(e.itemStore){try{i.default.PAssert(105,!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(t){i.default.reportError(t)}this.searchFromVMLI(e.itemStore.getRoot(),e)}else try{i.default.PAssert(106,!1,"Must specify a valid search root, using the default root is deprecated")}catch(t){i.default.reportError(t)}}catch(a){i.default.reportError(a)}}sendFeedback(e,t){var a={};pr.default.getAppInfo(a),a.eventStream=void 0;var i={name:e,message:t,appInfo:a,email:this.settings.getUserIdentifier(),premiumStatus:this.billingManager.getPremiumStatus()};return vi.a.sendFeedback(i)}remoteAPI(){return this.pluginManager.getPlugin(r.a.PluginID.Moodo)}},fr=a(19),mr={" ":!0,"-":!0},vr={[r.a.AttachChar]:!0},yr=5,_r=5,Sr={CallCount:{GetCaretOffset:0,GetClassStyles:0,measurePaneObject:0,MeasureLines:0,MeasureWord:0,GetOffsetForPositionInLine:0},Cache:{ItemCacheMiss:0,ItemCacheHit:0,LinesCacheMiss:0,LinesCacheHit:0,CanvasStyleHit:0,CanvasStyleMiss:0,WordCacheHit:0,WordCacheMiss:0}};var Pr=100;function Ir(e){return Math.round(e*Pr)/Pr}var br=class{constructor(){v.a.binder(this,"clearCacheForItem","onDisplaySettingsChanged"),this.fontSize=Wr.DisplaySettings.fontSize(),this.isNote=!1,this.isBold=!1,this.needsFontUpdate=!0,this.canvasContext=void 0,this.canvasElement=void 0,this.measureTextItem=new A.a,this.measureTextPane=new A.a,this._paneObjectCache={},this._paneObjectsForItem={}}init(){this.registerWordCaches(["Normal","Bold","Note","Header","HeaderTopLevel","Date"]),this._lineCache=Wr.cacheManager.registerLocalCache("LineCache",r.a.StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0}),this._imageCache=Wr.cacheManager.registerLocalCache("ImageCache",r.a.StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0}),n.a.listen("clearMeasureCacheItem",this.clearCacheForItem),n.a.listen("clearMeasureCacheAll",()=>{this.clearItemCache(),this.clearLineCache()}),Wr.DisplaySettings.listen("settingsChanged",this.onDisplaySettingsChanged)}registerWordCaches(e){var t=0;this._wordCaches=[];for(let s=0;s<e.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=e[s],i=Wr.cacheManager.registerLocalCache("WordCache"+a,r.a.StorageType.LocalStorage);this._wordCaches.push(i),this["_wordCache"+a]=i}}updateFont(e){this.needsFontUpdate||this.fontSize!==e.fontSize||e.isBold!==this.isBold||e.isNote!==this.isNote||e.isPrefixHeader!==this.isPrefixHeader||e.isHeaderTopLevel!==this.isHeaderTopLevel?(this.fontSize=e.fontSize,this.isBold=!!e.isBold,this.isNote=!!e.isNote,this.isPrefixHeader=e.isPrefixHeader,this.isHeaderTopLevel=e.isHeaderTopLevel,this.canvasFont=(this.isBold?"bold ":"")+this.fontSize+"px Helvetica Neue, Helvetica, Arial, Sans-serif",Sr.Cache.CanvasStyleMiss++,this.canvasContext&&(this.canvasContext.font=this.canvasFont),this.needsFontUpdate=!1):Sr.Cache.CanvasStyleHit++}getCanvasElement(){return this.canvasElement||(this.canvasElement=document.createElement("canvas")),this.canvasElement}getCanvasContext(e){return this.canvasContext||(this.canvasContext=this.getCanvasElement().getContext("2d")),this.updateFont(e),this.canvasContext}getMeasureStats(){return Sr}_getLineOffset(e,t,a){var s=e.childNodes,n=0;if(s){var o=0;for(let e=0;e<s.length;e++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=s[e];if(l===t){n+=a;break}if(i.default.hasClass(l,"plugin")?n+=1:l.nodeType===Node.TEXT_NODE?l.nodeValue!==r.a.TextSpace&&(n+=l.length):l.childNodes.length>0&&(n+=this._getLineOffset(l,t,a)),t&&i.default.isAncestor(t,l))break}}return n}_getCaretPosition(e,t,a,s,n){var o=i.default.element("measureTextItem"),l=o.querySelector(".line");if(l){let f,m,v,_,S=l.getBoundingClientRect(),P=o.getBoundingClientRect(),I={left:S.left,top:P.top},b=a.isNote()?i.default.unescape(a.getNotePreviewText()):a.getParsedText(),D=0,w=a.hasPrefix()&&s.isViewProject()&&s.isItemTopLevel(t,a);e>b.length&&(e=b.length);var d=fr.default._getSelectionRange();fr.default.selectElement(o,e);var h,c=fr.default._getSelectionRange();if(c){m=i.default.findParent(c.startContainer,"line");var u=i.default.findParent(c.startContainer,"itemPrefix",2);if(m){var p=0;v=[].indexOf.call(m.parentNode.children,m),_=this._getLineOffset(m,c.startContainer,c.startOffset);let t=0,s=c.startContainer.parentElement,o=s.previousElementSibling;if(o&&!n&&"IMG"===o.nodeName)t=-o.getBoundingClientRect().width;else if(!n&&i.default.hasClass(s,"mdImageMarkup")){let e=s.nextElementSibling;c.startOffset>0&&c.endOffset>0&&"IMG"===e.nodeName&&(t=e.getBoundingClientRect().width+10+(a.hasPrefix()?r.a.PrefixWidth:0))}Wr.settings.showMarkdown.get()||i.default.hasClass(s,"mdMarkup")&&(c=this.adjustSelectionForMarkup(c)),i.default.hasClass(c.startContainer,"plugin")?(h=c.startContainer.getBoundingClientRect(),f={left:c.startOffset>0?h.right+(i.default.hasClass(c.startContainer,"inlineDate")?1:12):h.left,top:h.top}):u&&e===a.getPrefixLength()?(h=u.getBoundingClientRect(),f={left:I.left+r.a.PrefixWidth+(y.a.isFirefox?0:5),top:h.top}):n&&_===this._getLineOffset(m)&&m.nextSibling?(f={left:(h=(m=m.nextSibling).getBoundingClientRect()).left+5+(a.hasPrefix()?r.a.PrefixWidth:0),top:h.top},_=0,v++):(h=c.getBoundingClientRect())&&(h.left===h.right&&0===h.left&&(h=c.getClientRects()[0]||m.getBoundingClientRect()),f={left:h.left,top:h.top}),y.a.isFirefox||(f.left=Math.max(f.left-5,0));var g=m.parentNode.childNodes;for(let e=0;e<v;e++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;D+=this._getLineOffset(g[e])}return d&&!i.default.findParent(d.startContainer,"fancyInput")&&fr.default.setSelectionRange(d),{left:f.left-I.left-(w?r.a.PrefixWidth:0)+t,top:f.top-I.top,line:v,lineOffset:_,lineLength:this._getLineOffset(m),lineStart:D}}}}try{i.default.PAssert(213,!1,"Failed to compute caret position: ",e,a.getParsedText().length,i.default.getElementPath(o))}catch(f){i.default.reportError(f)}return{left:0,top:0,line:0,lineOffset:0,lineLength:0,lineStart:0}}_measureCaretPosition(e,t,a,s){var n=0,o=i.default.element("measureText"),l=i.default.element("measureTextItem"),d=e.item,h=a.getStyledLinesForPaneObject(e,!1,!0),c="";for(let i=0;i<h.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;let t=h[i],s=(0===i?"margin-top:"+Wr.DisplaySettings.paddingForItemTop(e,d)+"px;":"")+(t.isImage||i===h.length-1?"margin-bottom:"+Wr.DisplaySettings.paddingForItemBottom(e,d,a)+"px;":"");t.isImage?c+='<span class="line" style="'+(s+=t.maxWidth?"max-width: "+t.maxWidth+"px;":"")+'">'+t.previousText+'<span class="mdImageMarkup">'+t.originalText+"</span>"+(t.isDriveImage||!Wr.settings.showMarkdown.get()?'<img class="inlineImage" src="'+t.src+'"></img>':"")+"<span>"+t.nextText+"</span></span>":c+='<span class="line" style="'+(s+="font-size:"+Wr.DisplaySettings.fontSizeForItem(e,d,a)+"px;line-height:"+Wr.DisplaySettings.lineHeightForItem(e,d,a)+"px")+'">'+(h[i]||r.a.TextSpace)+"</span>"}return o.className="pane "+a.paneClass,l.className="item "+d.styleProps(e,a),l.innerHTML=c,this._getCaretPosition(t,e,d,a,s)}getCaretOffset(e,t,a,i){var r=e.item;if(Sr.CallCount.GetCaretOffset++,isNaN(a)&&(a=r.getParsedText().length),void 0===i){var s=t.caretPosition.get();if(s&&_.a.getStartOffset()===_.a.getEndOffset()&&_.a.getStartIndex()===_.a.getEndIndex())i=s.left-t.getPaddingForPaneObject(e)<30;else{var n=_.a.isArrowSelectInverted(),o=n?_.a.getStartOffset():_.a.getEndOffset(),l=n?_.a.getStartObject():_.a.getEndObject(),d=this._measureCaretPosition(l,o,t,!0),h=this._measureCaretPosition(l,o,t,!1);d.left!==h.left&&(i=!n)}}return this._measureCaretPosition(e,a,t,i)}getCaretScreenPosition(e,t,a){try{i.default.PAssert(214,t>=0,"Must provide a valid index")}catch(c){i.default.reportError(c)}var r=e.itemAtIndex(t),s=e.objectAtIndex(t);try{i.default.PAssert(215,r,"Must be able to find a valid item at index")}catch(c){i.default.reportError(c)}if(e.isIndexMounted(t)){var n=e.elementAtIndex(t);try{i.default.PAssert(216,n,"Must be able to get element for item at index")}catch(c){i.default.reportError(c)}var o=e.getPaddingForPaneObject(s),l=this.getCaretOffset(s,e,a),d={left:-1,top:-1};if(n){var h=n.getBoundingClientRect();d.left=l.left+h.left+o,d.top=l.top+h.top}return d}return{left:-1,top:-1}}_getClassStyles(e,t,a,r){Sr.CallCount.GetClassStyles++;try{i.default.PAssert(217,i.default.isVMLI(t),"Item must be a valid VMLI instance")}catch(l){i.default.reportError(l)}var s=t.isNote(),n=t.isPrefixHeader(),o=t.isPrefixHeader()&&a.isItemTopLevel(e,t);return{isBold:a.isItemBold(t)||r.hasClass("mdBold")||r.hasClass("contact")||r.hasClass("date")||r.hasClass("duration")||r.hasClass("tag"),fontSize:t.isNote()?Wr.DisplaySettings.noteFontSize():o&&Wr.DisplaySettings.fontSizeHeaderTopLevel()||n&&Wr.DisplaySettings.fontSizeHeader()||Wr.DisplaySettings.fontSize(),isPrefixHeader:n,isHeaderTopLevel:o,isNote:s,attrs:r.getAttrs()}}measureLines(e,t,a,s,n){var o=0;try{i.default.PAssert(218,i.default.isVMLI(t),"Must provide a valid item to measure lines for")}catch(U){i.default.reportError(U)}try{i.default.PAssert(219,i.default.isPane(a),"Must provide a valid pane to measure lines for")}catch(U){i.default.reportError(U)}try{i.default.PAssert(220,s>=0,"Max width must be greater than 0: ",s)}catch(U){i.default.reportError(U)}Sr.CallCount.MeasureLines++;var l=this.getItemDisplayText(t),d=!t.isDestroyed()&&t.requireStoredEls();n=n||!d;try{i.default.PAssert(221,t&&(t.els||!d),"A Item has no els: ",t.__TEMP_InitCalled,t.__TEMP_InitParseCalled,t.__TEMP_ParseCalled,t.__TEMP_SkippedInitParsed)}catch(U){i.default.reportError(U)}if(0===l.length||!t||!t.els&&d)return t&&i.default.runSingleParse(t,r.a.ChangeType.Auto),[{text:"",start:0,length:0,width:0}];if(!n){var h=this.getLinesFromCache(t,a,s);if(h){var c=0,u=l.length,p=0;for(let e=0;e<h.length;e++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;p+=h[e].length}if(u===p)return Sr.Cache.LinesCacheHit++,h}else Sr.Cache.LinesCacheMiss++}var g=[],f=t.els,m=0,v="",y=0,_=[],S=0;if(f&&d){var P=0;for(let o=0;o<f.length;++o){var I=0;if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;let d,h=f[o],c=this._getClassStyles(e,t,a,h),u=h.getParsedText(),p=h.getWidth(n),g=!!(c&&c.attrs&&c.attrs.attachSimple);if(h.hasClass("plugin_drive_image_inline")&&(p=s,g=!0,d=!0),void 0===p){var b=u.length;try{i.default.PAssert(222,!c.plugin||u===r.a.AttachChar,"Plugin should only be set for attachment element")}catch(U){i.default.reportError(U)}for(let e=0;e<b;++e){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;var D=u[e];if(!mr[D]||m===S||0===e&&o>0&&void 0!==f[o-1].getWidth(n)){var w=0;v+=D;for(var E="",C=m+1;C<l.length;++C){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;var A=l[C];if(!mr[A])break;E+=A}var M=E||vr[D]||u[e+1]===r.a.AttachChar;if(M&&g&&e+E.length<b)v+=E;else if(M){let e=this.measureWord(a,v,c,n);var T=this.measureWord(a,E,c,n);_.push({text:v,delim:E,styles:c,width:e,delimWidth:Math.min(T,s),isAttach:D===r.a.AttachChar,isImage:g,isDriveImage:d}),v=""}}m++}if(v.length>0){let e=this.measureWord(a,v,c,n);_.push({text:v,delim:"",styles:c,width:e,delimWidth:0,isImage:g,isDriveImage:d}),v=""}}else _.push({isPrefix:0===o,text:u,width:o>0||a.shouldRenderPrefix(e)?p:0,styles:c,delimWidth:0,delim:"",isImage:g,isDriveImage:d}),S+=u.length,m+=u.length}}else{try{i.default.PAssert(223,t&&!d,"Items that do not have els must be marked as not requiring them to be cached")}catch(U){i.default.reportError(U)}t.els||i.default.runSingleParse(t,r.a.ChangeType.Auto);try{i.default.PAssert(224,t.els&&1===t.els.length,"Should always have a single el for non-measure cached items")}catch(U){i.default.reportError(U)}let s=this._getClassStyles(e,t,a,t.els[0]);s&&s.attrs?_.push({text:r.a.AttachChar,delim:"",styles:s,width:Wr.pluginManager.measureAttachment(a,s),delimWidth:0}):(v=t.els[0].getParsedText(),_.push({text:v,delim:"",styles:s,width:this.measureWord(a,v,s,n),delimWidth:0}))}var L=0,x="",k=0,R=0;m=0;for(let i=0;i<_.length;++i){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if((v=_[i]).isPrefix&&(k=v.width),v.isImage&&1===i&&k){let e=this.getAttachSimpleLine(v,m,_[0]);if(e){g.push(e),m+=e.length,x="",y=i+1,k=0;continue}}if(i>y&&(v.isImage||L+v.width>s&&!(k&&1===R&&v.width>0))&&(g.push({text:x,start:m,length:x.length,width:Ir(L)}),m+=x.length,L=0,x="",y=i,k=0),v.isImage){let e=this.getAttachSimpleLine(v,m);if(e){g.push(e),m+=e.length,x="",y=i+1,k=0;continue}}if(!v.isPrefix&&v.width+v.delimWidth>s&&!v.isAttach){var O=0,F=0,N=0;L=0;for(let e=0;e<v.text.length;++e){if(O++>5e3&&__infLoop&&__infLoop(O))throw new RangeError;L=N,(N+=this.measureChar(v.text[e],v.styles))>s&&e>0&&e-1>F&&(x+=v.text.substring(F,e),g.push({text:x,start:m,length:x.length,width:Ir(L)}),m+=x.length,F=e,L=0,k=0,x="",e--,N=0)}if(F>=0){var B=v.text.substring(F,v.text.length);B.length>0&&(v.text=v.text.substr(0,F),x=B+v.delim,L=this.measureWord(a,B,v.styles,!0),y=i)}}else v.isPrefix||(L+=v.width+v.delimWidth),x+=v.text+v.delim;i===_.length-1&&(g.push({text:x,start:m,length:x.length,width:Ir(L)}),k=0),v.width>0&&R++}return n||this.saveLinesToCache(t,a,s,g),g}getPaneObjectFromCache(e,t){var a,s=e.item,n=e.id,o=this._paneObjectCache[n],l=t,d=this.getItemDisplayText(s);if(o&&o[l]&&o[l].isHeader===s.isHeader()&&d===o.text&&o[l].isNote===s.isNote()&&d.indexOf(r.a.AttachChar)<0){var h=o[l];if(h.els)Sr.Cache.ItemCacheHit++,a=h;else try{i.default.PAssert(225,!1,"Getting item from cache with no els")}catch(c){i.default.reportError(c)}}return a||Sr.Cache.ItemCacheMiss++,a}savePaneObjectToCache(e,t){try{i.default.PAssert(226,t,"Must save a valid measured item to cache")}catch(u){i.default.reportError(u)}try{i.default.PAssert(227,t.els,"Measured item must have els")}catch(u){i.default.reportError(u)}try{i.default.PAssert(228,t.maxWidth,"Measured item must have a valid max width")}catch(u){i.default.reportError(u)}var a=e.item,r=this.getItemDisplayText(a),s=e.id,n=this._paneObjectCache[s];if(n&&n.text===r){var o,l=0,d=Number.MAX_VALUE;for(var h in n)if(n.hasOwnProperty(h)){l++;var c=n[h].lastAccess;c<d&&(d=c,o=h)}l>=yr&&delete n[o]}else n=this._paneObjectCache[s]={text:r},this._paneObjectsForItem[a.id]||(this._paneObjectsForItem[a.id]=[]),this._paneObjectsForItem[a.id].push(s);n[t.maxWidth]=t}getLinesFromCache(e,t,a){if(t.useLineCache){let t,h,c=this._lineCache.getEntrySync(e.id);if(c){var r=0;for(let e=0;e<c.length;e++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t=c[e][a])break}}if(t){var s=this.getItemDisplayText(e);if(i.default.isNumber(t))h=[{start:0,length:s.length,text:s}];else{var n=0;h=new Array(t.length);var o=0;for(let e=0;e<t.length;e++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=t[e];try{i.default.PAssert(229,!i.default.isNumber(l),"Cached lines should always be line info rather than a number")}catch(d){i.default.reportError(d)}h[e]={start:o,length:l.length,text:s.substr(o,l.length)},l.size&&(h[e].size=l.size),o+=l.length}}}return h}}saveLinesToCache(e,t,a,i){if(t.useLineCache){var r,s=0;if(i.length>1||i[0].size){var n=0;r=i;for(let e=0;e<r.length;e++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;delete r[e].imageUrl,delete r[e].originalText}}else r=1;var o=this._lineCache.getEntrySync(e.id)||[];o.length>=_r&&o.pop();for(let e=0;e<o.length;e++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;o[e][a]&&(o.splice(e,1),e--)}var l={};l[a]=r,o.splice(0,0,l),this._lineCache.saveEntrySync({id:e.id,value:o})}}measurePaneObject(e,t,a){Sr.CallCount.measurePaneObject++;var s,n=e.item,o=t.maxWidthOfPaneObject(e),l=this.getItemDisplayText(n),d=n.isHeader(),h=n.isNote();try{i.default.PAssert(230,i.default.isNumber(o),"Must provide a valid number for maxWidth: ",o)}catch(S){i.default.reportError(S)}try{i.default.PAssert(231,o>=0,"Max width must be greater than 0: ",o)}catch(S){i.default.reportError(S)}if(0===l.length||o<i.default.MinItemWidth){let a=[{text:"",start:0,length:0,width:0,cls:"line",index:0}];return{height:Wr.DisplaySettings.lineItemHeight(e,n,t,1),maxWidth:o,lineLengths:[0],styledLines:[r.a.TextSpace],els:a,isHeader:d,isNote:h}}if(!(s=!a&&this.getPaneObjectFromCache(e,o))||t.search.shouldHighlightSearch()){var c=0,u=this.measureLines(e,n,t,o,a),p=[],g=[],f=0,m=u.length;for(let a=0;a<u.length;++a){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var v=u[a];if(v.size&&!isNaN(v.size.height)){var y=Math.min(v.size.width,o);f+=v.size.height*y/v.size.width+(a>0?Wr.DisplaySettings.paddingForItemTop(e,n):0)+(a<u.length-1?Wr.DisplaySettings.paddingForItemBottom(e,n,t):0),m--}p.push(v.length),g.push({text:v.text,start:v.start,length:v.length,width:v.width,cls:"line",index:a})}try{i.default.PAssert(233,n&&(n.els||!n.requireStoredEls()),"B Item has no els: ",n.__TEMP_InitCalled,n.__TEMP_InitParseCalled,n.__TEMP_ParseCalled,n.__TEMP_SkippedInitParsed)}catch(S){i.default.reportError(S)}if(!n.els&&n.requireStoredEls())return{height:Wr.DisplaySettings.lineItemHeight(e,n,t,1),maxWidth:o,lineLengths:[],styledLines:[],els:[{text:"",start:0,length:0,width:0,cls:"line",index:0}],isHeader:d,isNote:h};var _=D.a.generateStyledLines(n.els,u,t,n);s={height:Wr.DisplaySettings.lineItemHeight(e,n,t,m)+f,maxWidth:o,lineLengths:p,styledLines:_,els:g,isHeader:d,isNote:h,lastAccess:Date.now()},t.search.shouldHighlightSearch()&&(s.searchHighlightedLines=D.a.generateStyledLines(n.els,u,t,n,!0)),a||this.savePaneObjectToCache(e,s)}return s}measureWord(e,t,a,s){Sr.CallCount.MeasureWord++;try{i.default.PAssert(234,void 0!==t,"Must pass in a valid word")}catch(c){i.default.reportError(c)}try{i.default.PAssert(235,a,"Must supply valid styles for word")}catch(c){i.default.reportError(c)}try{i.default.PAssert(236,t.indexOf(r.a.AttachChar)<0||1===t.length,"AttachChar should not be processed with other chars")}catch(c){i.default.reportError(c)}if(t.length>0){if(t===r.a.AttachChar&&a&&a.attrs){try{i.default.PAssert(237,!a.attrs||a.attrs.plugin,"Must have a valid plugin: ",a.attrs&&a.attrs.plugin)}catch(c){i.default.reportError(c)}try{i.default.PAssert(238,!a.attrs||a.attrs["plugin-id"],"Must have a valid attachment",a.attrs&&a.attrs["plugin-id"])}catch(c){i.default.reportError(c)}return Wr.pluginManager.measureAttachment(e,a)}var n=this._selectCache(a),o=n.getEntrySync(t);if(o)return Sr.Cache.WordCacheHit++,o;var l=0,d=0;for(let e=0;e<t.length;e++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;d+=this.measureChar(t[e],a)}var h=Ir(d);return s||n.saveEntrySync({id:t,value:h}),h}return 0}measureChar(e,t){var a=this._selectCache(t),i=a.getEntrySync(e);if(i)return i;var r=this.getCanvasContext(t).measureText(e).width;return a.saveEntrySync({id:e,value:r}),r}getOffsetForScreenPositionInLine(e,t,a,s,n){var o,l=t.item;if(a.isIndexMounted(e)){var d=a.elementAtIndex(e).querySelectorAll(".line");if(d.length>s){var h=d[s],c=h.getBoundingClientRect(),u=fr.default.getSelectOffsetsForMouseEvent({target:h,clientX:i.default.clamp(n,c.left,c.right-2),clientY:c.top+2+(l.shouldShowParents(t,a)?r.a.HeightAgendaParents:0)+(0===s?Wr.DisplaySettings.paddingForItemTop(t,l):0)});u&&(o=u.start)}}if(isNaN(o)){var p=0,g=this.measurePaneObject(t,a,!0).lineLengths;o=0;for(let e=0;e<g.length;e++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;o+=g[e]}}return o}clearCacheForItem(e){this._lineCache.removeEntrySync(e);let t=this._paneObjectsForItem[e];if(t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let e=t[i];this._paneObjectCache[e]&&delete this._paneObjectCache[e]}delete this._paneObjectsForItem[e]}}clearWordCaches(){var e=0;for(let t=0;t<this._wordCaches.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._wordCaches[t].clearCacheSync()}}clearItemCache(){this._paneObjectCache={},this._paneObjectsForItem={}}clearLineCache(){this._lineCache.clearCacheSync()}_selectCache(e){var t;if(e.isHeaderTopLevel)t=this._wordCacheHeaderTopLevel;else if(e.isPrefixHeader)t=this._wordCacheHeader;else if(e.isBold){try{i.default.PAssert(239,!e.isNote,"Currently do not support bold+note")}catch(a){i.default.reportError(a)}t=this._wordCacheBold}else t=e.isNote?this._wordCacheNote:11===e.fontSize?this._wordCacheDate:this._wordCacheNormal;return t}getItemDisplayText(e){return e.getParsedText()}onDisplaySettingsChanged(e){this.needsFontUpdate=!0,e&&this.clearWordCaches(),this.clearItemCache(),this.clearLineCache()}measureImage(e){let t=e.src.replace("&retryPermissions","");var a=!this._imageCache.getEntrySync(t);return this._imageCache.saveEntrySync({id:t,value:{width:e.naturalWidth,height:e.naturalHeight}}),a}getImageOriginalSize(e,t){var a=this._imageCache.getEntrySync(e)||t&&this._imageCache.getEntrySync(t);return{width:a.width,height:a.height}}getImageSize(e,t,a){var i,r=this._imageCache.getEntrySync(e)||t&&this._imageCache.getEntrySync(t);return r&&(i=a?{width:a=Math.min(a,r.width),height:r.height*(a/r.width)}:{width:r.width,height:r.height}),i}getAttachSimpleLine(e,t,a){var s,n,o,l=e.styles.attrs,d=(a?a.text+a.delim:"")+e.text+e.delim;if(l.plugin){try{i.default.PAssert(240,l.plugin===r.a.PluginID.Drive,"Attach simple line with a plugin other than Drive",l.plugin)}catch(p){i.default.reportError(p)}var h=Wr.pluginManager.getPluginDrive(),c=h.getAttachment(l["plugin-id"]);s=h.getAttachUrl(c),n=h.getAttachDataUrl(c),o=h.getAttachWidth(c)}else s=l["data-href"],o=l.size;if(s){var u=this.getImageSize(s,n,o);return{text:d,start:t,length:d.length,size:u}}}adjustSelectionForMarkup(e){var t=!1,a=e.startContainer.parentElement,r=i.default.hasClass(a,"mdMarkupStart"),s=i.default.hasClass(a,"mdMarkupEnd","appLinkStart");if(r||s){var n=r?1:-1,o=this.findNextNonMarkup(a,n);if(o){let a=o.childNodes[0]||o;a&&(e.setStart(a,n<0?a.length:0),t=!0)}else if(n*=-1,o=this.findNextNonMarkup(a,n)){let a=o.childNodes[0];a&&(e.setStart(a,n<0?a.length:0),t=!0)}}return t?this.adjustSelectionForMarkup(e):e}findNextNonMarkup(e,t){for(var a=0;e&&i.default.hasClass(e,"mdMarkup","appLinkStart");){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=t>0?e.nextSibling:e.previousSibling}return e}};var Dr,wr=class{constructor(){this.sidebarTransitioning=!1,this.isDraggingSidebar=new A.a(!1),this.lightboxPosition=new A.a,this.lightboxSrc=new A.a,this.lightboxElement=void 0,this.sidebarChanged=new T.a}init(){this.showSidebar=y.a.isMailbirdSidebar()||i.default.isDemoInIframe()?new A.a(!1):Wr.settings.showSidebar;var e=Wr.settings.sidebarWidth.get()||r.a.DesktopMenuWidthDefault;this._savedSidebarWidth=e===r.a.DesktopMenuWidthSmall?r.a.DesktopMenuWidthDefault:e,this.sidebarWidth=new A.a(e)}toggleSidebar(e){this.sidebarTransitioning=!0;var t=void 0!==e?e:!this.showSidebar.get();t&&(!0===e&&this._savedSidebarWidth===r.a.DesktopMenuWidthSmall&&(this._savedSidebarWidth=r.a.DesktopMenuWidthDefault),this.sidebarWidth.set(this._savedSidebarWidth)),this._setSidebarVisible(t),this.sidebarChanged.notify()}minimize(){this.sidebarTransitioning=!0;var e=r.a.DesktopMenuWidthSmall;Wr.settings.sidebarWidth.set(e),this.sidebarWidth.set(e),this.sidebarChanged.notify()}restore(){this.toggleSidebar(!0),Wr.settings.sidebarWidth.set(this.sidebarWidth.get())}getSidebarWidth(){return y.a.isMailbirdSidebar()||!this.showSidebar.get()?0:this.sidebarWidth.get()}setSidebarWidthMoving(e){this.showSidebar.set(!0),this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarWidth.set(e)}setSidebarWidthUp(){var e=this.sidebarWidth.get();e<20?e=0:e<r.a.DesktopMenuWidthMinBig&&(e=r.a.DesktopMenuWidthSmall),e!==this.sidebarWidth.get()&&(this.sidebarTransitioning=!0,this.sidebarWidth.set(e)),e>0&&(this._savedSidebarWidth=e,Wr.settings.sidebarWidth.set(e)),this._setSidebarVisible(e>0),this.isDraggingSidebar.set(!1),this.sidebarChanged.notify()}_setSidebarVisible(e){Wr.settings.showSidebar.set(e),this.showSidebar.set(e)}shouldShowTopBar(){return!this.showSidebar.get()||y.a.isNativeMac()&&this.sidebarWidth.get()<r.a.DesktopMenuWidthMinBig}topBarHeight(){return this.shouldShowTopBar()?32:0}},Er=a(35);var Cr=(Dr=class{setup(){this.callbacks={},this.nextId=0,this.ipcBridge=window.___electronIPCBridge;try{i.default.PAssert(107,this.ipcBridge,"IPC bridge was not created")}catch(e){i.default.reportError(e)}this.ipcBridge&&(this.ipcBridge.onElectronMessage=this.handleMessage)}handleMessage(e,t){try{if(isNaN(+e)){try{i.default.PAssert(108,this["onEvent_"+e],"Missing handler for native event")}catch(a){i.default.reportError(a)}this["onEvent_"+e](t)}else{let a=this.callbacks[+e],s=!1;if(a){if(i.default.isString(t)&&"{"===t[0]&&"}"===t[t.length-1])try{("error"in(t=JSON.parse(t))||"value"in t)&&(a(t.error,t.value),s=!0)}catch(r){i.default.reportError(r)}!s&&a&&a(t)}}}catch(r){i.default.reportError(r)}}sendMessage(e,t,a){if(this.ipcBridge){let r=this.nextId++,s=r+"~"+e;void 0!==t&&(s+="~"+(i.default.isString(t)?t:JSON.stringify(t))),a&&(this.callbacks[r]=a),this.ipcBridge.send("moodo-message",s)}}saveBackup(e,t,a){this.sendMessage("saveBackup",{filename:e,data:t},a)}saveDoc(e,t,a){this.sendMessage("saveDoc",{filename:e,data:t},a)}listDocss(e,t){this.sendMessage("listDocs",{folder:e},t)}getDoc(e,t){this.sendMessage("getDoc",{filename:e},t)}deleteDoc(e,t){this.sendMessage("deleteDoc",{filename:e},t)}renameDoc(e,t,a){this.sendMessage("renameDoc",{filenameOld:e,filenameNew:t},a)}getAllDocs(e){this.sendMessage("getAllDocs",void 0,(t,a)=>{t?e(t):e(void 0,a)})}listenToDocChanges(e){this._fileListener=e}getPrefs(e){this.sendMessage("getPrefs",void 0,e)}setDocsFolder(e,t,a){this.sendMessage("setDocsFolder",{folder:e,moveFiles:t},a)}onEvent_features(e){try{var t=JSON.parse(e);t.version&&y.a.recordAppSubVersion(t.version),!1===t.notifications&&y.a.disallowNativeNotifications()}catch(a){i.default.reportError(a)}}onEvent_downloadProgress(e){i.default.handleNativeDownloadProgress(e)}onEvent_reportError(e){i.default.reportError(new Error("Native Error"),e)}onEvent_onMenuClick(e){if("NewMessage"===e||"NewEmail"===e){var t=Wr.pluginManager.getPluginGmail();t.isEnabled()?Wr.menus.openComposeEmail(t):Wr.toasts.pushMessage(r.a.MessageID.NeedGmailPermission)}else"NewPane"===e?Er.a.hotkeyAddPane():"NewItem"===e?Er.a.hotkeyNewItem():"Preferences"===e?Wr.menus.openSettings():"DisplaySettings"===e?Wr.menus.openDisplaySettings():"ToggleSidebar"===e?Wr.DesktopUI.toggleSidebar():i.default.reportError(new Error("Unknown Native Menu Click: "+e))}onEvent_darkMode(e){console.log("dark mode",e)}onEvent_fileChanged(e){try{let a=JSON.parse(e);this._fileListener(r.a.CrudActions.Modified,a)}catch(t){Wr.toasts.pushMessage("A local document has gotten corrupted. Please check the Moo.do documents saved on your computer."),i.default.reportError(t)}}onEvent_fileDeleted(e){try{this._fileListener(r.a.CrudActions.Removed,e)}catch(t){i.default.reportError(t)}}},p()(Dr.prototype,"handleMessage",[f.a],Object.getOwnPropertyDescriptor(Dr.prototype,"handleMessage"),Dr.prototype),Dr);function Ar(e){try{i.default.PAssert(340,void 0===window.__MoodoBridge[e],"Registering an Inbound API that already exists on the window object",e)}catch(t){i.default.reportError(t)}this._name=e,this._publicObj={},this._privateObj={},window.__MoodoBridge[e]=this._publicObj,this.init()}Ar.prototype={init:function(){},_createWrapper:function(e){return function(){try{return e.apply(this,arguments)}catch(t){i.default.reportError(t)}}},registerFunction:function(e,t,a){try{i.default.PAssert(341,e,"Name must be provided to register function")}catch(r){i.default.reportError(r)}try{i.default.PAssert(342,t,"A valid function must be provided to register")}catch(r){i.default.reportError(r)}try{i.default.PAssert(343,void 0===this._privateObj[e],"Re-registering an api function on private obj",e)}catch(r){i.default.reportError(r)}try{i.default.PAssert(344,void 0===this._publicObj[e],"Re-registering an api function on public obj",e)}catch(r){i.default.reportError(r)}this._privateObj[e]=t.bind(this._privateObj),a&&(this._publicObj[e]=this._createWrapper(this._privateObj[e]))},registerVariable:function(e,t,a){try{i.default.PAssert(345,e,"Name must be provided to register variable")}catch(r){i.default.reportError(r)}try{i.default.PAssert(346,!a,"Public variables are not currently supported")}catch(r){i.default.reportError(r)}try{i.default.PAssert(347,void 0===this._privateObj[e],"Re-registering an api variable on private obj")}catch(r){i.default.reportError(r)}try{i.default.PAssert(348,void 0===this._publicObj[e],"Re-registering an api variable on public obj")}catch(r){i.default.reportError(r)}this._privateObj[e]=t}},v.a.defineBase(Ar);var Mr=Ar;function Tr(e){this._name=e,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}Tr.prototype={init:function(){i.default.isObject(window[this._name])?this.onAPILoaded():(v.a.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){try{i.default.PAssert(349,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(e){i.default.reportError(e)}i.default.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){var e=0;this._apiLoaded=!0;for(var t=0;t<this._requiredFns.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i.default.isFunction(window[this._name][name])||(this._apiError=!0,this._addMissingFn(name))}this.notifyListeners()},requestNotification:function(e){this._apiLoaded?setTimeout(e,0):this._listeners?this._listeners.push(e):this._listeners=[e]},notifyListeners:function(){try{i.default.PAssert(350,this._apiLoaded,"API must be loaded to notify listeners")}catch(a){i.default.reportError(a)}if(this._listeners)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._listeners[t]()}this._listeners=void 0},requireFunction:function(e,t){try{i.default.PAssert(351,this._requiredFns.indexOf(e)<0,"Should not double require a single function")}catch(a){i.default.reportError(a)}this._requiredFns.push(e),this._apiLoaded&&(i.default.isFunction(window[this._name][e])||t||(this._apiError=!0,this._addMissingFn(e)))},_addMissingFn:function(e){if(this._missingFns){try{i.default.PAssert(352,this._missingFns.indexOf(e)<0,"Should not be missing the same function multiple times")}catch(t){i.default.reportError(t)}this._missingFns.push(e)}else this._missingFns=[e]},hasOptionalFunction:function(e){try{i.default.PAssert(353,this._requiredFns.indexOf(e)>=0,"Must be querying for a registered function")}catch(t){i.default.reportError(t)}return!!window[this._name]&&!!window[this._name][e]},call:function(e){try{i.default.PAssert(354,this._apiLoaded,"Trying to call an API function before it is loaded",e)}catch(a){i.default.reportError(a)}if(this._apiLoaded){var t=Array.prototype.slice.call(arguments,1);try{return window[this._name][e].apply(window[this._name],t)}catch(r){i.default.reportError(r)}}}},v.a.defineBase(Tr);var Lr,xr=Tr;var kr=(Lr=class{constructor(){if(y.a.app)try{this.flushingBacklog=!1,this.isPokingBackground=!1,this.setupFns=[],this.setupFns[r.a.AppPlatform.Electron]=this.setupElectron,this.sendFns=[],this.sendFns[r.a.AppPlatform.Electron]=this.sendToAppElectron,this.setupFn=this.setupFns[y.a.appPlatform],this.sendFn=this.sendFns[y.a.appPlatform],this.init(),this._isEnabled=!0}catch(e){i.default.log("Native API Bridge Disabled"),i.default.reportError(e)}else this._isEnabled=!1;if(this._embedBridge=void 0,y.a.app||y.a.embed){try{i.default.PAssert(109,void 0===window.__MoodoBridge,"Must not have a previous bridge in place")}catch(t){i.default.reportError(t)}window.__MoodoBridge={},this._canRegisterAPIs=!0,this._inboundAPIs={},this._outboundAPIs={}}}init(){try{i.default.PAssert(110,this.setupFn,"Must have a valid setup function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(111,this.sendFn,"Must have a valid send function")}catch(e){i.default.reportError(e)}this.setupFn&&this.sendFn&&this.setupFn()}isEnabled(){return this._isEnabled}registerEmbedBridge(e){try{i.default.PAssert(112,e,"Must supply a valid embed bridge")}catch(t){i.default.reportError(t)}try{i.default.PAssert(113,y.a.embed,"Must be embedded")}catch(t){i.default.reportError(t)}this._embedBridge=e}hasEmbedBridge(){return!!this._embedBridge}sendToEmbed(e,t){try{i.default.PAssert(114,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",e)}catch(a){i.default.reportError(a)}this._embedBridge.handleEmbedMessage(e,t)}registerInboundAPI(e){try{i.default.PAssert(115,!this._inboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(a){i.default.reportError(a)}if(this._canRegisterAPIs){var t=new Mr(e);return this._inboundAPIs[e]=t,t}}registerOutboundAPI(e){try{i.default.PAssert(116,!this._outboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(a){i.default.reportError(a)}if(this._canRegisterAPIs){var t=new xr(e);return this._outboundAPIs[e]=t,t}}setupElectron(){Wr.ElectronBridge.setup()}sendToApp(e,t){try{i.default.PAssert(117,y.a.app,"Only use native bridge when creating an app")}catch(s){i.default.reportError(s)}try{i.default.PAssert(118,this.sendFn,"Must have a valid send method for the native bridge")}catch(s){i.default.reportError(s)}var a=!1;try{var r;t&&(r=i.default.isString(t)?t:JSON.stringify(t)),this.sendFn&&(this.sendFn(e,r),a=!0)}catch(n){i.default.reportError(n)}return a}sendToAppElectron(e,t){Wr.ElectronBridge.sendMessage(e,t)}},p()(Lr.prototype,"setupElectron",[f.a],Object.getOwnPropertyDescriptor(Lr.prototype,"setupElectron"),Lr.prototype),p()(Lr.prototype,"sendToApp",[f.a],Object.getOwnPropertyDescriptor(Lr.prototype,"sendToApp"),Lr.prototype),p()(Lr.prototype,"sendToAppElectron",[f.a],Object.getOwnPropertyDescriptor(Lr.prototype,"sendToAppElectron"),Lr.prototype),Lr),Rr=r.a.TooltipDelay;var Or=class{constructor(){this.tooltip=new A.a,this.tooltipsSticky=new M.a,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,y.a.touch||(n.a.listen("mouseover",this.handleEleOver.bind(this)),n.a.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))}windowOut(e){(e.pageX>=y.a.windowWidth()||e.pageY>=y.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.hideTip()}register(e,t){this.update(e,t)}update(e,t){e.setAttribute("tooltip",t)}displayTipSticky(e){e.sticky=!0,this.displayTip(e)}displayTip(e){try{i.default.PAssert(119,e,"When display a tooltip, must pass in some info")}catch(s){i.default.reportError(s)}clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var t=this.displayElement=e.element;if(e&&t&&t.offsetWidth>0&&t.offsetHeight>0){var a=e.text;this.isSticky=e.sticky;try{i.default.PAssert(120,a,"When display a tooltip, elements should always have valid data set")}catch(s){i.default.reportError(s)}if(a){var r={text:a,hotkey:e.hotkey,element:t,blue:e.blue,sticky:e.sticky,maxWidth:e.maxWidth,onRight:e.onRight,arrowClass:e.arrowDirection||"hidden"};e.sticky?this.tooltipsSticky.push(r):this.tooltip.set(r)}}}tipOut(e){var t=!0;e.target&&(t=i.default.isAttachedToDoc(e.target)&&!i.default.findParent(e.target,"tooltip")),t&&this.hideTip()}getAttr(e){return e&&e.getAttribute&&(e.getAttribute("tooltip")||e.getAttribute("data-tooltip"))}getAttrHotkey(e){return e&&e.getAttribute&&(e.getAttribute("tooltipHotkey")||e.getAttribute("data-tooltiphotkey"))}getByClassName(e,t){var a,r=y.a.priModKey,s=e.parentElement,n=e.textContent;if(!i.default.findParent(e,"fancyInputInner"))if(i.default.hasClass(e,"linkImage"))a="<b>Click</b> to open image.<br><b>"+r+" + Click</b> to open in "+(y.a.app?"browser":"new tab")+".";else if(s&&i.default.hasClass(s,"appLink"))a="<b>"+r+" + Click</b> to open in "+((i.default.hasClass(s,"Evernote")?"Evernote":"")||(i.default.hasClass(s,"OneNote")?"OneNote":"")||(i.default.hasClass(s,"Bear")?"Bear":""));else if(i.default.hasClass(e,"link")&&e.getAttribute("data-href")){var o=e.getAttribute("data-href");a=(o!==n?o+"<br>":"")+"<b>"+r+" + Click</b> to open"}else i.default.hasClass(e,"tag")||i.default.hasClass(e,"date")||i.default.hasClass(e,"duration")?a="<b>"+r+"+ Click</b> to show only "+n+"<br><b>"+r+" + Shift + Click</b> to hide "+n+"<br><b>"+(y.a.mac?"Option":"Alt")+" + Click</b> to remove "+n:i.default.hasClass(e,"email")?a="<b>"+r+"+ Click</b> to email "+n:i.default.hasClass(e,"prefixHeader")||i.default.hasClass(e,"prefixBullet")?a="<b>Click</b> to zoom in":i.default.hasClass(e,"prefixTask")?a="<b>Click</b> to toggle complete.<br><b>"+y.a.priModKey+" + Click</b> to zoom in.":i.default.hasClass(e,"prefixNumList")?a="<b>"+y.a.priModKey+" + Click</b> to zoom in":i.default.hasClass(e,"inlineDate")?a="<b>Click</b> to edit date":i.default.hasClass(e,"plugin")&&(a=(t>0?"<b>"+y.a.priModKey+" + Click</b>":"<b>Click icon</b>")+" to open");return a}getTooltipText(e,t){return this.getAttr(e)||this.getByClassName(e,t)}handleEleOver(e){try{i.default.PAssert(121,i.default.isDOMNode(e.target),"Must have a valid DOM node: ",typeof e.target)}catch(o){i.default.reportError(o)}if(e.target){for(var t,a,r=0,s=e.target,n=0;!t&&s&&n<3;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t=this.getTooltipText(s,n),a=this.getAttrHotkey(s),t||a||(s=s.parentElement)}s&&(!t&&a&&(t=a,a=void 0),t&&this.displayElement!==s&&!Wr.DragDrop.isDragging&&!_.a.isMouseDown())&&(clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),Rr,{element:s,offset:{y:5},text:t,hotkey:a}))}}handleEleOut(e){this.tipOut(e)}isOpenSticky(){return this.tooltipsSticky.get().length>0}hideSticky(e){for(var t=0,a=this.tooltipsSticky.get(),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].text===e){this.tooltipsSticky.removeAt(i);break}}}hideTip(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}},Fr=a(188),Nr=a(184),Br=a(2),Ur=a.n(Br);var Hr=class{constructor(e,t,a){this.isComplete=new A.a(!1),this.id=e,this.text=t,this.noRender=a,this.items=[],this.inOrder=!1,this.enforceOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0}loadFromSaveData(e){var t=0;this.numComplete=0;for(var a=0,i=0;i<this.items.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.items[i];e[r.id]&&(r.isComplete.set(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,i+1))),r.hiddenObservable&&r.hiddenObservable.get()||r.visibleObservable&&!r.visibleObservable.get()||a++}if((this.numComplete===a||e[this.id])&&this.isComplete.set(!0),this.inOrder&&0!==this.next&&this.next<a){var s=this.items[this.next];s&&s.show()}}saveData(e,t){for(var a=0,r=0;r<this.items.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this.items[r];try{i.default.PAssert(540,s,"Item entries must exist")}catch(n){i.default.reportError(n)}s.isComplete.get()&&(e[s.id]=1)}t&&this.isComplete.get()&&(e[this.id]=1)}addStep(e){try{i.default.PAssert(541,!!e.id===!!e.check,"Invalid help step")}catch(t){i.default.reportError(t)}!1!==e.if&&(e.isComplete||(e.isComplete=new A.a(!1)),this.inOrder?e.isDisabled||(e.isDisabled=new A.a(this.items.length>0)):e.isDisabled=new A.a(!1),e.isHotkeyOr=e.isHotkeyOr,e.show||(e.show=()=>e.isDisabled.set(!1)),this.items.push(e))}complete(e){e.isComplete.get()||(e.isComplete.set(!0),this.numComplete++,this.numComplete===this.items.length&&this.isComplete.set(!0),this.owner.notifyOfChange(e))}forceComplete(){this.isComplete.set(!0),this.numComplete=this.items.length,this.owner.notifyOfChange()}check(e){var t=0;try{i.default.PAssert(542,!this.isComplete.get(),"Should never be checking items in a completed section")}catch(s){i.default.reportError(s)}for(var a=0;a<this.items.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.items[a];if(!r.isComplete.get()&&((!0===e||r.check&&r.check(e))&&(this.complete(r),this.inOrder&&a===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].show())),this.enforceOrder))break}}},Vr=a(14),jr={display:"inline-block",height:"24px"};function zr(){Wr.menus.openSettings(r.a.SettingsSections.Plugins)}var qr=class{init(){this.mode=new A.a(r.a.HelpMode.None),this.position=new A.a,this.sections=new M.a,this.isVisible=new mi.a([this.mode],()=>this.isHelpShowing()),this.priKey=y.a.priModKey,this.secKey=y.a.secModKey,this.secKeyForce=y.a.secModKeyForce,this.tooltipIntroSection=void 0;var e=Wr.settings.helpPaneState.get();void 0===e&&(e=r.a.HelpMode.None),this.initItemsDesktop(),i.default.isDemoMode()||(this.initState(e),Wr.settings.inTooltipIntro.get()&&this.tooltipIntroSection.isComplete.get()&&Wr.settings.inTooltipIntro.set(!1)),Wr.settings.helpPaneState.listen((e,t)=>{void 0!==e&&e!==t&&this.initState(e)}),Wr.settings.helpState.listen((e,t)=>{e&&e!==t&&this.loadState()}),P.d.addListener(this.onAction.bind(this))}isHelpShowing(){return this.mode.get()!==r.a.HelpMode.None}initState(e){try{i.default.PAssert(241,void 0!==e,"Must pass in a valid intro mode")}catch(t){i.default.reportError(t)}this.sections.clear(),this.mode.set(e),this.isHotkeyMode()||this.initHelp(),Wr.settings.inTooltipIntro.get()&&this.initTooltipIntro(),this.loadState()}initItemsDesktop(){this.itemIndent={id:"458052715",text:'Press <span class="hHotkey">Tab</span> to indent an item into a list and <span class="hHotkey">Shift + Tab</span> to unindent out of a list',check:this.checkIndent},this.itemDateTime={id:"321249113",text:'Add a date/time by typing ! in the text of an item or pressing <span class="hHotkey">'+this.priKey+" + Shift + D</span>",check:this.checkDate},this.itemRightClick={id:"3288459206",text:"Right click an item to explore more options",check:e=>e.type===P.b.Misc&&e.misc===P.a.RightClick};var e=Wr.pluginManager.getPluginGmail(),t=Wr.pluginManager.getPlugin(r.a.PluginID.GCalendar),a=Wr.pluginManager.getPlugin(r.a.PluginID.Drive);this.itemPluginSettings={id:"ep",jsx:Ur.a.createElement("span",null,Ur.a.createElement("span",{style:jr},Ur.a.createElement(Vr.a,{raised:!0,primary:!0,marginRight:8,onClick:zr},"Enable plugins")),"to connect to your other services"),hiddenObservable:new mi.a([e.isActiveObs,t.isActiveObs,a.isActiveObs]),check:()=>{}},this.itemOpenEmail={id:"dblE",text:"Double click an email to open it",check:e=>e.type===P.b.Misc&&e.misc===P.a.OpenEmail&&e.data.pane.type===r.a.PaneMode.Gmail},this.itemDragEmail={id:"drgEm",text:"Drag an email to your Tasks to organize it",check:e=>e.type===P.b.Misc&&e.misc===P.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===r.a.PaneMode.Gmail},this.itemRightClickEmail={id:"rcE",text:"Right click an email to explore more options",check:e=>e.type===P.b.Misc&&e.misc===P.a.RightClick&&e.data.pane.type===r.a.PaneMode.Gmail},this.itemGmailLabels={id:"lbls",text:'Click <i class="overviewButtonNormal icon-menu g"></i> in the top left to access your labels',check:e=>e.type===P.b.Misc&&e.misc===P.a.ToggleOverview&&e.data.pane.type===r.a.PaneMode.Gmail},this.itemGmailCompose={id:"cmp",text:'Click <i class="icon-edit2 g"></i> in the sidebar to compose a new email',check:e=>e.type===P.b.Misc&&e.misc===P.a.ComposeEmail}}setMode(e){this.mode.set(e),Wr.settings.helpPaneState.set(e)}show(e){this.setMode(e||r.a.HelpMode.Normal)}toggle(e){!this.isHelpShowing()||e&&this.mode.get()!==e?this.show(e):this.close()}close(){Wr.tooltip.hideTip(),this.setMode(r.a.HelpMode.None),i.default.sendEvent("Menu","CloseHelp")}isHotkeyMode(){return this.mode.get()===r.a.HelpMode.Hotkeys}_getHelpStateObj(){var e={},t=Wr.settings.helpState.get();if(i.default.isString(t)){if(t)try{(e=JSON.parse(t))&&!i.default.isString(e)||(e={})}catch(a){i.default.reportError(a)}}else e=t;return e||{}}loadState(){var e=this._getHelpStateObj();if(e)for(var t=0,a=0;a<this.sections.get().length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.sections.get()[a].loadFromSaveData(e)}}saveState(){if(i.default.shouldWriteLocal())try{var e=this.getState();Wr.settings.helpState.set(JSON.stringify(e))}catch(t){i.default.reportError(t)}}getState(){for(var e=0,t=i.default.clone(this._getHelpStateObj()),a=0;a<this.sections.get().length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sections.get()[a].saveData(t)}return t}notifyOfChange(){this.saveState()}createSection(e,t,a,i){var r=0,s=new Hr(e,t,i);s.owner=this;for(var n=0;n<a.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;s.addStep(a[n])}return s}addSection(e,t,a,i){var r=this.createSection(e,t,a,i);return this.sections.push(r),r}checkAddItem(e){if(e.type===P.b.Create)return o.a.getItem(e.data[0].itemID),!1}checkIndent(e){if(e.type===P.b.Move){var t=e.data[0].oldParent;try{i.default.PAssert(242,t&&t.items,"Old parent must have items",t)}catch(a){i.default.reportError(a)}if(t&&t.items&&t.items.get().indexOf(e.data[0].newParent)>=0)return!0}}checkSearch(e){return e.type===P.b.Misc&&e.misc===P.a.SearchChanged}checkComplete(e){if(e.type===P.b.Update){var t=e.data[0];return"isComplete"===t.field&&t.newValue}}checkOverview(e){return e.type===P.b.Misc&&e.misc===P.a.ToggleOverview}checkZoom(e){return e.type===P.b.Zoom&&!e.data[0].zoomOut&&i.default.focusedPane&&i.default.focusedPane.overview.isVisible.get()}checkPriority(e){var t=e.data[0];return e.type===P.b.Update&&"priority"===t.field&&t.newValue>0}checkDate(e){return e.type===P.b.Insert&&"!"===e.data[0].text}checkGoogleCalendar(e){return e.type===P.b.Misc&&e.misc===P.a.AddToGCal}checkGoogleDrive(){}initHelp(){function e(){Wr.menus.openContextMenu({componentName:"ReactContextMenuOptions",element:"optionsButton"})}this.sections.clear(),this.addSection("2102025841","Organization",[this.itemIndent,{id:"3825397189",text:"Click and drag on the left edge of an item to move it",check:e=>{if(e.type===P.b.Misc&&e.misc===P.a.DropItem&&i.default.isLoaded)return!0}},{id:"441256378",text:'Click the left edge of a list or press <span class="hHotkey">'+this.secKey+" + ,</span> to collapse its subitems",check:e=>{if(e.type===P.b.Update){var t=e.data[0];return"isCollapsed"===t.field&&t.newValue}}}]),this.addSection("prefixes","Item Prefixes",[{id:"header",text:"Start a line with "+r.a.Prefix.Header+" to create a project",check:e=>e.type===P.b.Misc&&e.misc===P.a.SetPrefix&&e.data.prefix===r.a.Prefix.Header},{id:"task",text:"Start a line with [ to create a task",check:e=>e.type===P.b.Misc&&e.misc===P.a.SetPrefix&&e.data.prefix===r.a.Prefix.Task},{id:"bullet",text:"Start a line with - to create a bullet",check:e=>e.type===P.b.Misc&&e.misc===P.a.SetPrefix&&(e.data.prefix===r.a.Prefix.Bullet||e.data.prefix===r.a.Prefix.Bullet2||e.data.prefix===r.a.Prefix.Bullet3)},{id:"numlist",text:"Start a line with 1. to create a numbered list",check:e=>e.type===P.b.Misc&&e.misc===P.a.SetPrefix&&e.data.prefix===r.a.Prefix.NumList}]),this.addSection("cal","Dates",[this.itemDateTime,{id:"enableCalendar",jsx:Ur.a.createElement("span",null,Ur.a.createElement(Vr.a,{raised:!0,primary:!0,marginRight:8,onClick:zr},"Enable Google Calendar"),"to sync Google Calendar."),hiddenObservable:Wr.pluginManager.getPlugin(r.a.PluginID.GCalendar).isActiveObs,check:()=>{}},{id:"adc2",text:'Add an item with a date to Google Calendar by pressing <span class="hHotkey">'+this.secKeyForce+' + C</span> or right clicking the date.<span style="color: #777;"></span>',check:this.checkGoogleCalendar}]),this.addSection("3971635305","Priority",[this.itemRightClick,{id:"215510164",text:'Set a priority with the right click menu or <span class="hHotkey">'+this.secKey+" + 1|2|3</span>",check:this.checkPriority},{id:"2165585377",text:'Click the right edge of an item or <span class="hHotkey">'+this.secKey+" + /</span> to complete it",check:this.checkComplete},{id:"4286506454",text:'Press <span class="hHotkey">'+this.secKey+" + 8</span> to star an item and highlight it in yellow",check:e=>{if(e.type===P.b.Update){var t=e.data[0];return"isStarred"===t.field&&t.newValue}}}]),this.addSection("4240025947","Contacts",[{id:"9158366",text:"Add a contact by typing + in the text of an item",check:e=>e.type===P.b.Insert&&"+"===e.data[0].text},{id:"1594166733",text:'Click on a <span class="contact c-contact">+contact</span> to start a call or email',check:e=>e.type===P.b.Misc&&e.misc===P.a.OpenContact}]),this.addSection("1493247039","Zooming",[{id:"1829655333",text:'To zoom in on an item, right click it and select Zoom In, press <span class="hHotkey">'+this.priKey+' + Enter</span>, or hold <span class="hHotkey">'+this.priKey+"</span> and click its left edge",check:e=>e.type===P.b.Zoom&&!e.data[0].zoomOut},{id:"3440644647",text:"To zoom back out, click the title of the list in the top of the pane",check:e=>e.type===P.b.Zoom&&e.data[0].zoomOut},{id:"801492595",text:'Press <i class="overviewButtonNormal icon-menu g"></i> in the top left of a pane to open the overview',check:this.checkOverview},{id:"1720747864",text:'Click an item in the Overview to scroll to it or click <i class="icon-zoom-in g"></i> to zoom into it',check:this.checkZoom}]),this.addSection("1393893782","Search",[{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:e=>e.type===P.b.Insert&&e.data[0].text===r.a.TagPrefix},{id:"2783340419",text:'Filter by priority by clicking the <span class="searchPriority searchP0 hovered"></span> <span class="searchPriority searchP1 hovered"></span> <span class="searchPriority searchP2 hovered"></span> buttons',check:e=>e.type===P.b.Misc&&e.misc===P.a.SearchChanged&&0!==e.data.priority},{id:"923656242",text:'Show only starred items by clicking the <span class="c-foreground-faded icon-star"></span> button',check:e=>e.type===P.b.Misc&&e.misc===P.a.SearchChanged&&0!==e.data.starred},{id:"2227925102",text:'Hide completed items by clicking the <span class="c-foreground-faded icon-check"></span> button',check:e=>e.type===P.b.Misc&&e.misc===P.a.SearchChanged&&0!==e.data.complete},{id:"457209713",text:"Hide items you're not interested in by starting a search with - (dash)",check:e=>e.type===P.b.Misc&&e.misc===P.a.SearchChanged&&e.data.text.indexOf("-")>=0}]),this.addSection("gm","Gmail",[{id:"eG",jsx:Ur.a.createElement("span",null,Ur.a.createElement(Vr.a,{raised:!0,primary:!0,marginRight:8,onClick:zr},"Enable Gmail"),"to sync Gmail."),hiddenObservable:Wr.pluginManager.getPlugin(r.a.PluginID.Gmail).isActiveObs,check:()=>{}},this.itemOpenEmail,this.itemDragEmail,this.itemRightClickEmail,this.itemGmailLabels]),this.addSection("formatting","Formatting",[{id:"format",text:"Format text like <i>*italic*</i>, <b>**bold**</b>, or <b><i>***both***</i></b>",check:e=>{}},{id:"link",text:"Insert links like [title](http://address.com)",check:e=>{}},{id:"hr",text:"--- to insert a horizontal line",check:e=>{}}]),this.addSection("327865517","Collaboration",[{id:"3453735943",jsx:Ur.a.createElement("span",null,Ur.a.createElement("span",{style:jr},"Click the ",Ur.a.createElement(Vr.a,{icon:"icon-folder",iconSize:18},"File"))," in the options button to open the Files menu"),check:e=>e.type===P.b.Misc&&e.misc===P.a.OpenDocumentsMenu},{id:"4176091097",text:'Click <i class="icon-settings f18 g"></i> to change the sharing settings',check:e=>e.type===P.b.Misc&&e.misc===P.a.OpenDocSharing}]),this.addSection("drv","Google Drive (Premium)",[{id:"eD",jsx:Ur.a.createElement("span",null,Ur.a.createElement(Vr.a,{raised:!0,primary:!0,marginRight:8,onClick:zr},"Enable Google Drive"),"to sync Google Drive."),hiddenObservable:Wr.pluginManager.getPlugin(r.a.PluginID.Drive).isActiveObs,check:()=>{}},{id:"drL",text:"Drag a file from the Google Drive Pane to an Task Pane to add it to a list",check:e=>e.type===P.b.Misc&&e.misc===P.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===r.a.PaneMode.Drive},{id:"drDr",text:"Drag a file from your "+(y.a.mac?"Finder":"Explorer")+" to your Tasks to upload it to Drive and add it to a list",check:e=>e.type===P.b.Misc&&e.misc===P.a.DriveUpload}]),this.addSection("set","Settings",[{id:"oS",jsx:Ur.a.createElement("span",null,"Click ",Ur.a.createElement("span",{style:jr},Ur.a.createElement(Vr.a,{icon:"icon-settings",iconSize:18,onClick:e}))," in the sidebar, then Settings, to access plugin and account settings."),check:e=>e.type===P.b.UIAction&&e.data[0].type===P.c.OpenSettingsMenu},{id:"oDS",jsx:Ur.a.createElement("span",null,"Click ",Ur.a.createElement("span",{style:jr},Ur.a.createElement(Vr.a,{icon:"icon-settings",iconSize:18,onClick:e}))," in the sidebar, then Display Settings, to change display settings."),check:e=>e.type===P.b.UIAction&&e.data[0].type===P.c.OpenDisplaySettings}]),this.addSection("3926176240","Data",[{id:"1927292896",jsx:Ur.a.createElement("span",null,"Click on Import Data in the options menu in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please ",Ur.a.createElement(Vr.a,{primary:!0,onClick:function(){Wr.menus.openModal(r.a.Modals.ReportBug)}},"contact us")," and tell us what app you want to import from."),check:e=>e.type===P.b.Misc&&e.misc===P.a.OpenImport},{id:"67562060",text:"Click on Export Data in the options menu in the sidebar, then choose the format you'd like.",check:e=>e.type===P.b.Misc&&e.misc===P.a.OpenExport}])}onAction(e){if(!Wr.menus.isModalOpen(r.a.Modals.ImportData))try{for(var t=0,a=this.sections.get(),s=0;s<a.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[s].isComplete.get()||a[s].check(e)}}catch(n){i.default.reportError(n)}}runTooltipIntro(){Wr.settings.inTooltipIntro.set(!0),this.initTooltipIntro()}initTooltipIntro(){function e(){return Wr.pluginManager.isGmailPaneEnabled()}function t(e){try{i.default.PAssert(243,e,"Must supply a valid tooltip descriptor")}catch(t){i.default.reportError(t)}try{i.default.PAssert(244,!e||e.element,"Must specify a valid target tooltip element")}catch(t){i.default.reportError(t)}Wr.tooltip.hideSticky(e.text),e.blue=!0,"top"===e.arrowDirection&&(e.offset={top:15}),Wr.tooltip.displayTipSticky(e)}var a,s,o,l=[];function d(e){var a=!1;l.push({id:e.id,check:r=>!(!e.check2Invalidates1||!e.check2(r))||(e.check1(r)?(setTimeout(function(){var r=i.default.isFunction(e.element)?e.element():e.element,s=i.default.isFunction(e.text)?e.text():e.text;r&&(a=!0,t({text:s,element:r,arrowDirection:e.arrowDirection,onRight:e.onRight}))},1e3),!0):void 0)}),l.push({id:e.id+"_complete",check:t=>{if(e.check2(t)){if(a){var r=i.default.isFunction(e.text)?e.text():e.text;Wr.tooltip.hideSticky(r)}return!0}}})}d({id:"tipAddPaneMenu",text:"Click here to add a new pane",element:()=>i.default.element("addPaneButton"),arrowDirection:"left",check2Invalidates1:!0,check1:this.checkAddItem,check2:e=>e.type===P.b.Misc&&e.misc===P.a.OpenAddPaneMenu}),d({id:"tipAddPane",text:()=>e()?"Add a Gmail pane to organize your email":"Add another Task pane to get another view on your tasks.",element:()=>e()?i.default.element("addPane_PaneGmail"):i.default.element("addPane_PaneTask"),arrowDirection:"left",check2Invalidates1:!0,onRight:!0,check1:e=>e.type===P.b.Misc&&e.misc===P.a.OpenAddPaneMenu,check2:t=>t.type===P.b.UIAction&&t.data[0].type===P.c.AddPane&&t.data[0].data.type===(e()?r.a.PaneMode.Gmail:r.a.PaneMode.Task)}),d({id:"tipNewTaskPane",text:"Each Task pane is a unique view on the same data. Customize your view by searching and filtering.",element:()=>{if(a){var e=a.element;if(e)return e.getElementsByClassName("searchWrap")[0]}},arrowDirection:"top",check1:e=>{if(e.type===P.b.UIAction&&e.data[0].type===P.c.AddPane&&e.data[0].data.type===r.a.PaneMode.Task)return a=e.data[0].data.pane,!0},check2:e=>e.type===P.b.Misc&&e.misc===P.a.SearchChanged}),d({id:"tipNewGmailPane",text:"Try dragging an email to your Task Pane",element:()=>{if(s){var e=s.element;if(e)return e.getElementsByClassName("paneContent")[0]}},arrowDirection:"bottom",check2Invalidates1:!0,check1:e=>{if(e.type===P.b.UIAction&&e.data[0].type===P.c.AddPane&&e.data[0].data.type===r.a.PaneMode.Gmail&&Wr.PaneManager.getPanesByType(r.a.PaneMode.Task).length>0)return s=e.data[0].data.pane,!0},check2:e=>e.type===P.b.Misc&&e.misc===P.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===r.a.PaneMode.Gmail}),d({id:"tipNewGmailPane",text:"Each board is a different set of panes. Add a new pane to start setting up your new board.",element:()=>i.default.element("addPaneButton"),arrowDirection:"left",onRight:!0,check1:e=>e.type===P.b.UIAction&&e.data[0].type===P.c.AddBoard,check2:e=>e.type===P.b.UIAction&&e.data[0].type===P.c.AddPane}),d({id:"tipAddToCalendar",text:()=>"Sync items with dates to Google Calendar by pressing "+y.a.secModKeyForce+" + C",element:()=>{var e=_.a.getStartElement();if(e)return e.getElementsByClassName("date")[0]},arrowDirection:"top",check1:e=>{if(e.type===P.b.Misc&&e.misc===P.a.ChangeDate&&i.default.isLoaded&&Wr.pluginManager.getPlugin(r.a.PluginID.GCalendar).isActive())return!0},check2:e=>e.type===P.b.Misc&&e.misc===P.a.AddToGCal}),d({id:"tipOverviewButton",text:"Toggle the Overview open and closed",element:()=>{var e=o.element;if(e)return e.getElementsByClassName("overviewButton")[0]},arrowDirection:"top",check1:e=>{if(e.type===P.b.Zoom)return o=e.data[0].pane,!0},check2:this.checkOverview,check2Invalidates1:!0}),Wr.settings.shouldShowHelp("helpTooltip")&&setTimeout(function e(){if(Wr.tooltip.isOpenSticky())setTimeout(e,5e3);else if(Wr.settings.closeHelp("helpTooltip"),i.default.element("helpButton")){var a={text:"See the Help to learn more",element:i.default.element("helpButton"),arrowDirection:"left",onRight:!0};n.a.listen("helpOpened",function e(){Wr.tooltip.hideSticky(a.text),n.a.unlisten("helpOpened",e)}),t(a)}},9e4),this.tooltipIntroSection=this.addSection("tooltipIntro","Tooltip Intro",l,!0)}};var Wr=t.default=new class extends gr{init(e){this.rollbar=window.Rollbar,this.ElectronBridge=new Cr,this.nativeBridge=new kr,super.init(e),this.setup=new Fr.a,this.Measure=new br,this.Measure.init(),this.DesktopUI=new wr,this.DesktopUI.init(),this.tooltip=new Or,this.AppCache=new Nr.a,this.intro=new qr}}},31:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(1),l=a(3),d=a(5),h=a(40),c=a(20),u=a(8),p=a(9),g=a(56),f=a(54);let m=(i=class{constructor(){this.isLoaded=new p.a(!1),this.isGapiLoaded=new p.a(!1),this._handlersOnLoaded=[],this.authTokens={},this._scopesNeedRedo={},this.onAccountsUpdated=new h.a,this.hasTriedToLoadGapi=!1}loadWithTokens(e){this.ensureGapi(),Promise.all(Object.keys(e).map(e=>this.refreshAuthToken(e))).then(()=>{if(this.isLoaded.set(!0),this._runOnSyncHandlers(),!l.default.settings.syncAccounts.get()){let t={};Object.keys(e).forEach(a=>{let i=e[a];t[a]={[o.a.PluginID.Gmail]:i.scopes.includes(o.a.GScope.GmailModify),[o.a.PluginID.GCalendar]:i.scopes.includes(o.a.GScope.Calendar)||i.scopes.includes(o.a.GScope.CalendarRO)}}),l.default.settings.syncAccounts.set(t)}})}authAccount(e,t,a){let i=i=>{i&&!i.error?a(i):this.doAuthForAccount({email:e,scopes:t},a)};this.authTokens[e]?this.getAccountAuthToken(e,t,i,!0):i()}authAccountTemp(e,t){this.doAuthForAccount({email:c.a.getDefaultAccountID(),scopes:e,temp:!0},t)}removeAccount(e){delete this.authTokens[e],this.onAccountsUpdated.notify(),f.a.deleteAuthToken(e)}convertScopeToScopes(e){let t=e.scope?e.scope.split(" "):void 0;return e.scopes=t?t.map(e=>o.a.GScopeArray[e]):void 0,delete e.scope,e}refreshAuthToken(e){return new Promise(t=>{try{n.default.PAssert(511,e,"Trying to get account auth token for undefined")}catch(a){n.default.reportError(a)}e?g.a.getAccessToken(e).then(a=>{if(a.value){let i=this.convertScopeToScopes(a.value);this.authTokens[e]=i,t(i)}else console.log(a.error),a.error&&a.error.includes("invalid_grant")&&this.redoAuth(e,c.a.getScopes())}):t(void 0)})}redoAuth(e,t,a){this._scopesNeedRedo[e]||(this._scopesNeedRedo[e]=[]),this._scopesNeedRedo[e].pushOnlyUniques(t),l.default.toasts.pushMessage({text:"Error authorizing for account: "+e+". Please reauthorize.",actionText:"REAUTHORIZE",action:()=>{this.doAuthForAccount({email:e,scopes:this._scopesNeedRedo[e]},a)}})}getAccountAuthToken(e,t,a,i){try{n.default.PAssert(512,e,"Trying to get account auth token for undefined")}catch(r){n.default.reportError(r)}e?this.onLoaded(()=>{let r=this.authTokens[e];r?this._verifyScopes(t,r)?!r.expires_at||r.expires_at-Date.now()<o.a.MinimumTokenExpireTimeMS?this.refreshAuthToken(e).then(a):a(r):i?a(void 0):this.redoAuth(e,t,a):(a(void 0),this.redoAuth(e,t))}):a(void 0)}isAuthorizedForScopes(e,t){let a=this.authTokens&&this.authTokens[e];return!!a&&this._verifyScopes(t,a)}notifyUnauthorizedRequest(e){}_verifyScopes(e,t){var a=0;if(!t||!t.scopes)return!1;const i=t.scopes;for(let r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!i.includes(e[r]))return!1}return!0}_getRedirectURL(){return window.location.protocol+"//"+window.location.host+"/oauthRelay.html"}_createAuthURL({email:e,scopes:t,temp:a}){try{n.default.PAssert(513,n.default.isArray(t)&&t.length>0,"Must pass in a valid scopes array")}catch(r){n.default.reportError(r)}var i={email:e,temp:a,scope:t.join(" "),redirect_uri:this._getRedirectURL()};return g.a.createURL("auth/authGoogleAPI",i)}doAuthForAccount({email:e,scopes:t,temp:a},i){try{n.default.PAssert(514,e||a,"Must provide a valid email to link if not temp")}catch(l){n.default.reportError(l)}try{n.default.PAssert(515,n.default.isArray(t),"Must always provide a valid scopes array")}catch(l){n.default.reportError(l)}t=n.default.arrayUnion([o.a.GScope.UserInfoEmail],t);let r,s=!1;this._createAuthURL({email:e,scopes:t,temp:a}).then(t=>{var a=window.open(t,"googleauth","height=600,width=550"),o=!1,l=t=>{if(clearInterval(r),n.default.getLocationOrigin()&&!o&&n.default.isObject(t.data)){if(window.removeEventListener("message",l),s=!0,t.data){let a=this.convertScopeToScopes(t.data);this.authTokens[e]=a,this.onAccountsUpdated.notify(),i&&i(a)}i&&!s&&i(void 0),o=!0}};let h;d.a.isNativeApp()&&((h=new BroadcastChannel("Moo.do_auth_gapi_channel")).onmessage=e=>{l(e)}),r=setInterval(()=>{h&&a&&!a.closed?(console.log("posting auth"),h.postMessage("checkAuth")):a&&!a.closed||(clearInterval(r),window.removeEventListener("message",l),!s&&i&&i(void 0))},1e3),window.addEventListener("message",l)})}ensureGapi(e){if(window.gapi&&window.gapi.client)e&&e();else if(!this.isGapiLoaded.get()&&!this.hasTriedToLoadGapi){setTimeout(()=>{this.hasTriedToLoadGapi=!1},2e3);let t=e=>{},a=e=>{},i=t=>{window.gapi.client.init({apiKey:o.a.APIKey,clientId:o.a.ClientID}).then(()=>{this.isGapiLoaded.set(!0),l.default.pluginManager.notifyDependencyLoad(o.a.PluginDependency.GoogleLogin)}),e&&e()};document.getElementById("gapiScript")||n.default.addScript("https://apis.google.com/js/api.js","gapiScript",this.ensureGapi.bind(this,e),a),window.gapi&&!window.gapi.client&&(this.hasTriedToLoadGapi=!0,window.gapi.load("client",{callback:i,onerror:a,timeout:2e4,ontimeout:t}))}}onLoaded(e){this.isLoaded.get()?e():this._handlersOnLoaded.push(e)}_runOnSyncHandlers(){this._handlersOnLoaded.forEach(e=>e()),this._handlersOnLoaded=[]}getAccountName(e){}getDefaultAuthToken(e,t){let a=c.a.getDefaultAccountID();this.getAccountAuthToken(a,e,e=>{e?t(e):console.log("No auth token")})}hasError(){return!1}getError(e){return""}getGoogleUserInfo(e){this.getDefaultAuthToken(["profile"],t=>{t?fetch(`https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=${t.access_token}`).then(t=>{200===t.status&&t.json().then(t=>e(t))}):e(void 0)})}isEmailAuthed(e){let t=e.toLowerCase();return Object.keys(this.authTokens).some(e=>e.toLowerCase()===t)}},s()(i.prototype,"refreshAuthToken",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"refreshAuthToken"),i.prototype),i);t.a=new m},32:function(e,t,a){"use strict";var i=a(0),r=a(9);t.a=class extends r.a{constructor(e,t,a){super(e,t,a),this._value=e||[],this.version=0}notify(e,t,a){0===arguments.length&&this.version++,super.notify.apply(this,arguments)}length(){return this._value.length}set(e,t){try{i.default.PAssert(136,e&&i.default.isArray(e),"Value set on an Observable array must be an array",e)}catch(a){i.default.reportError(a)}return this._value=e,this.version++,!1!==t&&this.notify(this._value),e}clear(e){this.set([],e)}remove(e,t){let a;if(i.default.isFunction(e))for(var r=0,s=0;s<this._value.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e(this._value[s])&&(void 0===a&&(a=s),this._value.splice(s,1),s--)}else a=this._value.remove(e);return this.version++,a>=0&&!1!==t&&this.notify(this._value),a}removeAt(e,t){var a=this._value.removeAt(e);return this.version++,!1!==t&&this.notify(this._value),a}push(e,t){var a=this._value.push(e);return this.version++,!1!==t&&this.notify(this._value),a}pushArray(e,t){var a=this._value.pushArray(e);return this.version++,!1!==t&&this.notify(this._value),a}insertSorted(e,t,a){var i=this._value.insertSorted(e,t);return this.version++,!1!==a&&this.notify(this._value),i}sort(e,t){return this._value.sort(e),this.version++,!1!==t&&this.notify(this._value),this}splice(e,t,a,i){var r;return r=a?this._value.splice(e,t,a):this._value.splice(e,t),this.version++,!1!==i&&this.notify(this._value),r}indexOf(e){return this._value.indexOf(e)}indexOfWithProperty(e,t){return this._value.indexOfWithProperty(e,t)}includes(e){return this._value.includes(e)}}},34:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(5),o=a(35),l=a(2),d=a.n(l),h=a(15),c=a(14),u=a(77);t.a=class extends h.a{init(){this.createObservables({isHovered:!1})}getElement(){var e=this.refs.element;return e.getElement?e.getElement():e}closeMenu(){!1!==this.props.canClose&&s.default.menus.closeContextMenu()}onClick(e){var t=this.props;t.hasButtons||this.didClickJustFire||!t.onClick||(!1!==t.clickCloses&&this.closeMenu(),t.onClick(e),this.didClickJustFire=!0,setTimeout(function(){this.didClickJustFire=!1}.bind(this),300))}onClickIcon(e){var t=this.props;t.onClickIcon?(this.closeMenu(),t.onClickIcon(e)):this.onClick(e)}onMouseDown(e){(this.props.onClickIcon||i.default.hasClass(e.target,"fancyContextMenuIcon"))&&e.preventDefault()}onMouseUp(e){var t=this.props;!isNaN(e.button)&&e.button!==r.a.ButtonCode.Left||n.a.mac&&e.ctrlKey||t.onClickIcon&&i.default.hasClass(e.target,"fancyContextMenuIcon")||this.onClick(e)}onMouseEnter(e){this.isHovered.set(!0),this.props.onMouseEnter&&this.props.onMouseEnter(e)}onMouseLeave(){this.isHovered.set(!1)}render(){var e,t=this.props,a=this.state,r=t.onClick||t.hoverEffects,s=i.default.classNames("fancyContextMenuItem",{flexbox:!t.customLayout},{"c-foreground":!t.faded},{"c-foreground-faded":t.faded},{"c-popup-item":r&&!1!==t.hoverEffects},{selected:t.selected||!1!==t.hoverEffects&&a.isHovered},{active:t.active},{disabled:t.disabled},{hasIcon:!!t.icon},{hasContent:!!t.children},{bold:t.bold},{hasHotkey:t.hotkey},{"flex-center":t.center},{hasButtons:t.hasButtons},this.props.className);if(t.icon)if(t.onClickIcon)e=d.a.createElement(c.a,{className:"fancyContextMenuIcon",icon:t.icon,tooltip:t.iconTooltip,width:36,height:t.height||28,onClick:this.onClickIcon});else{var n=i.default.classNames("fancyContextMenuIcon c-foreground-faded",t.icon),l={fontSize:t.iconSize,height:t.height,lineHeight:t.height&&t.height+"px",color:t.iconColor};e=d.a.createElement("span",{className:n,style:l,onClick:this.onClickIcon,"data-tooltip":t.iconTooltip})}var h,p=t.hotkey;if(p){var g=i.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:t.hotkeyCentered}),f=i.default.isString(p)?p:o.a.printHotkeyByName(p.name,p.group);h=d.a.createElement("span",{className:g},f)}var m=t.style||{};m.height=t.height,m.lineHeight=t.height&&t.height+"px",m.cursor=r?"pointer":"";var v={id:t.id,className:s,"data-tooltip":t.tooltip,onMouseOver:t.onMouseOver,style:m,ref:"element"};return r&&(v.onMouseDown=t.onClick?this.onMouseDown:void 0,v.onMouseUp=t.onClick&&!t.noMouseUp?this.onMouseUp:void 0,v.onClick=t.onClick&&t.noMouseUp?this.onMouseUp:void 0,v.onMouseEnter=!1!==t.hoverEffects?this.onMouseEnter:void 0,v.onMouseLeave=!1!==t.hoverEffects?this.onMouseLeave:void 0),d.a.createElement(t.onClick?u.a:"div",v,e,h?d.a.createElement("span",{className:"f1"},t.children):t.children,h)}}},35:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(6),o=a(16),l=a(5),d=a(9),h=a(61),c=a(19);var u=class{constructor(){this.stack=[]}push(e){this.stack.push(e)}pop(e){this.stack.remove(e)}peek(){return this.stack[this.stack.length-1]}contains(e){return this.stack.indexOf(e)>=0}forEach(e){for(var t=0,a=this.stack.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!1===e(this.stack[a],a))break}}},p=a(4),g=a(26),f=a(39),m={},v={Ctrl:0,Meta:1,Alt:2,Shift:3};t.a=new class{constructor(){var e;this.currentArrowsMode=void 0,this.platformPrimaryKey=l.a.mac?v.Meta:v.Ctrl,this.platformSecondaryKey=l.a.mac?v.Ctrl:v.Alt;var t=(e,t)=>{for(var a,r=0,n=0;n<t.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o,l,d,h,c=t[n],u=!c.mods;if(u||(o=!!c.mods[v.Ctrl]===!!e.ctrlKey,l=!!c.mods[v.Meta]===!!e.metaKey,d=!!c.mods[v.Alt]===!!e.altKey,h=!!c.mods[v.Shift]===!!e.shiftKey),(u||o&&l&&d&&h)&&(c.isGlobal||e.target===document.body&&!s.default.menus.isContextMenuOpen()&&!s.default.menus.isModalOpen()||i.default.findParent(e.target,"paneContent"))){a=c;break}}if(a){this.currentArrowsMode&&!a.isOnPane&&(this._exitingArrowsMode=this.currentArrowsMode,this._exitArrowsMode());var p=a.callback.call(this,e);return a.stopPropagation&&e.stopPropagation(),this._exitingArrowsMode=void 0,!1===p||(e.handled=!0,e.preventDefault(),!1)}},a=a=>{if(s.default.setup&&s.default.settings.activeUser.get()){var r;if(l.a.normalizeKeys(a),e=a.normCode,this.currentArrowsMode&&this._updateArrowsMode(a),this.hotkeyStack.forEach(e=>{if(e&&e[a.normCode]&&(r=t(a,[e[a.normCode]])),void 0!==r)return!1}),void 0===r){var n=m[a.normCode];n&&(r=t(a,n))}if(void 0!==r)return i.default.vmMain&&i.default.vmMain.updateCursorFromEvent(a),r}};this.hotkeyStack=new u,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},o.a.binder(this,"onMouseDownArrowsMode"),document.addEventListener("keydown",a,!0),document.addEventListener("keyup",function(t){s.default.setup&&s.default.settings.activeUser.get()&&(l.a.normalizeKeys(t),i.default.vmMain&&i.default.vmMain.updateCursorFromEvent(t),l.a.windows&&e!==t.normCode&&(t.normCode!==r.a.KeyCode.D1&&t.normCode!==r.a.KeyCode.D2&&t.normCode!==r.a.KeyCode.D3&&t.normCode!==r.a.KeyCode.D8||m[t.normCode]&&(a(t),e=void 0)))},!0),this.loadConfig()}loadConfig(){this.config={Pane:{Search:["Pr+F"],Goto:["Se+G"],Overview:["Se+O"],Complete:["Pr+Enter"],ZoomOut:["Se+Sh+Enter","Se+LeftArrow"],ZoomIn:["Se+Enter","Se+RightArrow"],EditNote:["Sh+Enter"],Collapse:["Pr+Period","mac:Se+Space"],CollapseRecursive:["Pr+Sh+Period","mac:Se+Sh+Space"],CollapseAll:["Pr+Se+Period","mac:Pr+Se+Sh+Space"],Unindent:["Sh+Tab","Pr+LBracket","Se+LBracket","Se+Sh+LeftArrow"],Indent:["Tab","Pr+RBracket","Se+RBracket","Se+Sh+RightArrow"],MoveUp:["Se+Sh+UpArrow","mac:Op+UpArrow","win:Pr+Sh+UpArrow"],MoveDown:["Se+Sh+DownArrow","mac:Op+DownArrow","win:Pr+Sh+DownArrow"],Priority1:["Pr+D1"],Priority2:["Pr+D2"],Priority3:["Pr+D3"],PriorityNone:["Pr+D0","Pr+D4"],Star:["Pr+D8","win:Pr+Tilde"],NextPane:["mac:app:Se+Tilde","mac:app:Pr+Op+RightArrow","win:Se+Tilde"],PreviousPane:["mac:app:Se+Sh+Tilde","mac:app:Pr+Op+LeftArrow","win:Se+Sh+Tilde"],SelectItem:["Se+L"],ClosePane:["Sh+F4"],Bold:["Pr+B"],Italic:["Pr+I"],Underline:["Pr+U"],InsertLink:["Pr+K"],MoveAutocomplete:["Se+M"],JumpAutocomplete:["Se+J"],PrefixHeader:["Pr+Sh+D6","Pr+Sh+P","Pr+Sh+H","win:Pr+Sh+D3"],PrefixTask:["mac:app:Pr+Sh+LBracket","win:Pr+Sh+LBracket","Se+Sh+LBracket","Pr+Sh+D9","Pr+Sh+D0"],PrefixBullet:["Pr+Sh+D8"],PrefixNumList:["Pr+Sh+D1"],AddToCalendar:["Se+C"],DeleteItem:["Pr+Sh+Backspace","Pr+Sh+K"],Date:["Pr+Sh+D"]},Global:{SelectPane1:["app:Se+D1"],SelectPane2:["app:Se+D2"],SelectPane3:["app:Se+D3"],SelectPane4:["app:Se+D4"],SelectPane5:["app:Se+D5"],SelectPane6:["app:Se+D6"],SelectPane7:["app:Se+D7"],SelectPane8:["app:Se+D8"],SelectPane9:["app:Se+D9"],SelectPane10:["app:Se+D0"],Undo:["Pr+Z"],Redo:["Pr+Y","Pr+Sh+Z"],AddPane:["app:Pr+T","Se+T"],NewItem:["app:Pr+N","Se+N"],EmailCompose:["Pr+E"],NextBoard:["mac:app:Se+Tab","win:app:Pr+Tab"],PreviousBoard:["mac:app:Se+Sh+Tab","win:app:Pr+Sh+Tab"],SelectBoard1:["Se+Sh+D1"],SelectBoard2:["Se+Sh+D2"],SelectBoard3:["Se+Sh+D3"],SelectBoard4:["Se+Sh+D4"],SelectBoard5:["Se+Sh+D5"],SelectBoard6:["Se+Sh+D6"],SelectBoard7:["Se+Sh+D7"],SelectBoard8:["Se+Sh+D8"],SelectBoard9:["Se+Sh+D9"],SelectBoard10:["Se+Sh+D0"],HelpHotkeys:["Pr+Slash","Se+Slash"],Help:["Pr+Sh+Slash","Se+Sh+Slash"],Settings:["mac:app:Pr+Comma"],ZoomInApp:["app:Pr+Plus"],ZoomOutApp:["app:Pr+Dash"]},Email:{Down:["DownArrow","J"],Up:["UpArrow","K"],Open:["Enter"],Archive:["E","Slash"],Delete:["Delete","Backspace","Sh+D3"],Schedule:["C"],Snooze:["D"],Move:["M","V"],Task:["T"],Label:["L"],MarkRead:["I"],MarkUnread:["U"],Star:["S","D8"],Reply:["R"],ReplyAll:["Sh+R","A"],Forward:["F"],Priority1:["D1"],Priority2:["D2"],Priority3:["D3"],RemoveFromLabel:["Y"],Undo:["Z"],Print:["P"],OpenInGmail:["G"]}},Object.keys(this.config.Pane).forEach(e=>this.createHotkeyNew(e,this.config.Pane[e],!1)),Object.keys(this.config.Global).forEach(e=>this.createHotkeyNew(e,this.config.Global[e],!0)),Object.keys(this.config.Email).forEach(e=>this.createHotkeyNew(e,this.config.Email[e],!1,!0,"Email")),this.createHotkeyNew("Noop",["Pr+S"],!0)}createHotkeyNew(e,t,a,s=!1,n){var o=0,l=s?this.callbackOnPane.bind(this,n,e):this["hotkey"+e];try{i.default.PAssert(465,l&&i.default.isFunction(l),"Missing hotkey handler",e)}catch(h){i.default.reportError(h)}for(let c=0;c<t.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;let n=t[c],u=n.split(":"),p=u[u.length-1].split("+"),g=r.a.KeyCode[p[p.length-1]];try{i.default.PAssert(466,g,"Key code must be defined",n)}catch(h){i.default.reportError(h)}if(this.isValidPlatform(n)){var d={name:c>0?e+c:e,isGlobal:a,keyCode:g,primary:p.indexOf("Pr")>=0,secondary:p.indexOf("Se")>=0,shift:p.indexOf("Sh")>=0,option:p.indexOf("Op")>=0,isOnPane:s,callback:l};this.addHotkeyNew(d)}}}isValidPlatform(e){var t=e.split(":");return 1===t.length||(t.indexOf("win")<0||!l.a.mac)&&(t.indexOf("mac")<0||l.a.mac)&&(t.indexOf("app")<0||l.a.isNativeApp())}pushStack(e){for(var t=0,a={},i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[i];a[r.keyCode]=r}return this.hotkeyStack.push(a),a}pushStackEscape(e){return this.pushStack([this.createEscape(e)])}popStack(e){this.hotkeyStack.pop(e)}getHotkey(e){var t,a=m[e.normCode];if(a)for(var i=0,r=0;r<a.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s,n,o,l,d=a[r],h=!d.mods;if(h||(s=!!d.mods[v.Ctrl]===!!e.ctrlKey,n=!!d.mods[v.Meta]===!!e.metaKey,o=!!d.mods[v.Alt]===!!e.altKey,l=!!d.mods[v.Shift]===!!e.shiftKey),h||s&&n&&o&&l){t=d.name;break}}return t}create(e,t,a,s,n,o){try{i.default.PAssert(467,i.default.isNumber(e),"Invalid keyCode")}catch(h){i.default.reportError(h)}try{i.default.PAssert(468,i.default.isBoolean(t),"Invalid isGlobal")}catch(h){i.default.reportError(h)}try{i.default.PAssert(469,i.default.isFunction(n),"Invalid callback")}catch(h){i.default.reportError(h)}var d={keyCode:e,mods:{},callback:n,isGlobal:t};return a!==r.a.Primary.Yes&&a!==r.a.Primary.Both&&a!==r.a.Primary.Only||(d.mods[this.platformPrimaryKey]=!0),a!==r.a.Primary.No&&a!==r.a.Primary.Never&&a!==r.a.Primary.Both||(d.mods[this.platformSecondaryKey]=!0),o&&l.a.mac&&(d.mods[v.Alt]=!0),s===r.a.Shift.Yes&&(d.mods[v.Shift]=!0),d}addHotkeyNew(e){e.mods={},e.primary&&(e.mods[this.platformPrimaryKey]=!0),e.secondary&&(e.mods[this.platformSecondaryKey]=!0),e.option&&(e.mods[v.Alt]=!0),e.shift&&(e.mods[v.Shift]=!0);let t=e.keyCode;m[t]||(m[t]=[]),m[t].push(e)}createEscape(e){return this.create(r.a.KeyCode.Escape,!0,r.a.Primary.Either,r.a.Shift.Either,e)}addHotkey(e,t,a,s,n,o,d,h){try{i.default.PAssert(470,a,"Must supply a valid keycode")}catch(c){i.default.reportError(c)}l.a.app&&!isNaN(s)&&s!==r.a.Primary.Both&&s!==r.a.Primary.Never&&s!==r.a.Primary.Only&&(s=r.a.Primary.Either),this._addHotkey(e,t,a,s,n,o,d,h)}_addHotkey(e,t,a,s,n,o,d,h){try{i.default.PAssert(471,a,"Must supply a valid keycode")}catch(u){i.default.reportError(u)}if(!h||!l.a.windows){if(m[a]=m[a]||[],s===r.a.Primary.Either)return this._addHotkey(e,t,a,r.a.Primary.No,n,o,d,h),void this._addHotkey(e,t,a,r.a.Primary.Yes,n,o,d,h);if(n===r.a.Shift.Either)return this._addHotkey(e,t,a,s,r.a.Shift.No,o,d,h),void this._addHotkey(e,t,a,s,r.a.Shift.Yes,o,d,h);try{i.default.PAssert(472,!l.a.windows||s!==r.a.Primary.Both,"Should never require AltGr combo on windows")}catch(u){i.default.reportError(u)}var c=this.create(a,t,s,n,o,h);c.stopPropagation=d,c.name=e,m[a].push(c)}}registerArrowsMode(e,t,a,i,r,s){var n=this["arrowsModeIndex"+e]=new d.a(-1);return!0===t?this._enterArrowsMode(e,a,i,r):this._addHotkey(e,!0,t.keyCode,t.primary,t.shift,this._onKeyDownArrowsMode.bind(this,e,a,i,r,s)),n}getArrowsModeObs(e){return this["arrowsModeIndex"+e]}isInArrowsMode(e){return this.currentArrowsMode&&this.currentArrowsMode.name===e}exitArrowsMode(e){this.isInArrowsMode(e)&&this._exitArrowsMode()}_onKeyDownArrowsMode(e,t,a,i,r){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===e||this._enterArrowsMode(e,t,a,i,r)}_enterArrowsMode(e,t,a,i,r){this.currentArrowsMode={name:e,cbGetMax:t,cbSelect:a,cbKey:i,cbOnHotkey:r},r&&r(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+e].set(-1)}_exitArrowsMode(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)}onMouseDownArrowsMode(e){this._exitArrowsMode()}_updateArrowsMode(e){var t=this.currentArrowsMode,a=this.getArrowsModeObs(t.name),i=l.a.getKeyCode(e),s=a.get(),n=t.cbGetMax();if(i===r.a.KeyCode.Enter)s>=0&&t.cbSelect(s),this._exitArrowsMode();else if(i===r.a.KeyCode.Escape)this._exitArrowsMode();else if(i===r.a.KeyCode.UpArrow)s>0&&a.set(s-1);else if(i===r.a.KeyCode.DownArrow)s<n-1&&a.set(s+1);else if(t.cbKey){var o=t.cbKey(i,e);o>=0&&(t.cbSelect(o),this._exitArrowsMode(),e.stopPropagation(),e.preventDefault())}}checkToggleSearchFilter(e){var t=i.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.toggleFilterDefault(e),!0)}checkToggleSearchPriority(e){var t=i.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.getFilterValue("priority")===e&&(e=0),t.search.setFilter("priority",e),!0)}hotkeyNewItem(){s.default.menus.openItemEditor({addOnSave:!0,element:i.default.element("newItemButton")})}hotkeyAddPane(){s.default.menus.openAddPaneMenu({element:i.default.element("addPaneButton")})}hotkeySearch(){var e=i.default.focusedPane||s.default.PaneManager.getPaneAtIndex(0);if(e){var t=e.search;t.isFocused.get()||t.focus()}}hotkeyGoto(){i.default.focusedPane.applyToSelection(function(e){return s.default.PaneManager.scrollToAndHighlightItem(e,i.default.focusedPane),!1})}hotkeyOverview(){i.default.focusedPane&&i.default.focusedPane.toggleOverviewVisibility()}hotkeyComplete(){var e,t=p.a.getSelectedItems();p.a.isValid()&&1===t.length&&!t[0].isComplete()&&(e=!0),i.default.beginCompleteAction(),i.default.focusedPane.applyFnToSelection("setComplete",{toggle:"isComplete",value2:r.a.ChangeType.Local}),e&&i.default.focusedPane.selectNearestItem(p.a.getStartIndex()),i.default.endCompleteAction(),i.default.sendEvent("Hotkey","Complete")}_hotkeyPriorityHelper(e){i.default.focusedPane&&!this.checkToggleSearchPriority(e)&&i.default.focusedPane.applyPriorityToSelection(e,!0)}hotkeyPriority1(){this._hotkeyPriorityHelper(r.a.VMLIFlag.P0)}hotkeyPriority2(){this._hotkeyPriorityHelper(r.a.VMLIFlag.P1)}hotkeyPriority3(){this._hotkeyPriorityHelper(r.a.VMLIFlag.P2)}hotkeyPriorityNone(){i.default.focusedPane.applyPriorityToSelection(r.a.VMLIFlag.None)}hotkeyStar(){this.checkToggleSearchFilter("starred")||i.default.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",value2:r.a.ChangeType.Local})}selectPaneAtIndex(e){if(e>=0&&e<s.default.PaneManager.paneCount()){var t=s.default.PaneManager.getPaneAtIndex(e);if(t&&(p.a.focusPane(t),!p.a.isValid()&&t.isEditable)){var a=t.indexOfFirstItem();t.selectIndex(a),t.scrollIndexIntoView(a,r.a.ScrollDuration.Default)}}}hotkeySelectPane1(){this.selectPaneAtIndex(0)}hotkeySelectPane2(){this.selectPaneAtIndex(1)}hotkeySelectPane3(){this.selectPaneAtIndex(2)}hotkeySelectPane4(){this.selectPaneAtIndex(3)}hotkeySelectPane5(){this.selectPaneAtIndex(4)}hotkeySelectPane6(){this.selectPaneAtIndex(5)}hotkeySelectPane7(){this.selectPaneAtIndex(6)}hotkeySelectPane8(){this.selectPaneAtIndex(7)}hotkeySelectPane9(){this.selectPaneAtIndex(8)}hotkeySelectPane10(){this.selectPaneAtIndex(9)}hotkeyPreviousPane(){var e=s.default.PaneManager,t=e.getFocusedPaneIndex()-1;t<0&&(t=e.paneCount()-1),this.selectPaneAtIndex(t)}hotkeyNextPane(){var e=s.default.PaneManager,t=e.getFocusedPaneIndex()+1;t>=e.paneCount()&&(t=0),this.selectPaneAtIndex(t)}hotkeyZoomIn(){i.default.focusedPane&&i.default.focusedPane.applyToSelection(e=>(e.isNote()||i.default.focusedPane.zoomIn(e),!1))}hotkeyZoomOut(){var e=i.default.focusedItem;e&&e.parent()&&i.default.focusedPane.zoomOut(e.parent())}hotkeyCollapse(){i.default.focusedPane.applyToSelection(function(e){i.default.focusedPane.supportCollapsing&&e.toggleCollapsed(i.default.focusedPane)})}hotkeyCollapseAll(){i.default.focusedItem&&i.default.focusedPane&&i.default.focusedPane.supportCollapsing&&i.default.focusedPane.toggleCollapseAll()}hotkeyCollapseRecursive(){var e,t=i.default.focusedPane;i.default.focusedPane.applyToSelection(function(a,i,r,s){t.supportCollapsing&&(void 0===e&&(e=!t.isPaneObjectCollapsed(s)),t.collapseAll(a,e,!0))})}hotkeyIndent(){h.a.compoundOperation(()=>{p.a.isValid()&&h.a.handleTab()})}hotkeyUnindent(){h.a.compoundOperation(()=>{p.a.isValid()&&h.a.handleTab(!0)})}hotkeyMoveUp(){h.a.moveUp()}hotkeyMoveDown(){h.a.moveDown()}hotkeySelectItem(){h.a.handleSelectAllItem()}hotkeyClosePane(e){var t=s.default.PaneManager.removeFocusedPane();void 0!==t&&(n.d.performAction(n.b.UIAction,{type:n.c.RemovePane,data:t}),s.default.tooltip.hideTip(),e.stopImmediatePropagation())}hotkeyBold(e){return p.a.isValid()&&p.a.applyFormatToSelection("**"),e.preventDefault(),!1}hotkeyItalic(e){return p.a.isValid()&&p.a.applyFormatToSelection("*"),e.preventDefault(),!1}hotkeyUnderline(e){return p.a.isValid()&&p.a.applyFormatToSelection("__"),e.preventDefault(),!1}hotkeyInsertLink(e){return p.a.isValid()&&p.a.getStartItem().insertLinkAtSelection(),e.preventDefault(),!1}hotkeyMoveAutocomplete(){i.default.focusedPane&&p.a.isValid()&&i.default.focusedPane.autocompleteMove()}hotkeyJumpAutocomplete(){var e=i.default.focusedPane;if(e){var t=e.search,a={};t.isFocused.get()?a.elementDisplay=t.getSearchBox():e!==i.default.focusedPane&&(p.a.focusPane(e),a.elementDisplay=t.getSearchBox()),e.autocompleteJump(a)}}hotkeyUndo(){c.default.hasRawSelection()&&i.default.elementInNonPaneEdit(c.default.getSelectionNode())||(i.default.focusedPane?i.default.focusedPane.handleUndo():f.a.undo())}hotkeyRedo(){c.default.hasRawSelection()&&i.default.elementInNonPaneEdit(c.default.getSelectionNode())||(i.default.focusedPane?i.default.focusedPane.handleRedo():f.a.redo())}hotkeyPrefixHeader(){p.a.applyPrefixToSelection(r.a.Prefix.Header)}hotkeyPrefixTask(e){p.a.applyPrefixToSelection(r.a.Prefix.Task)}hotkeyPrefixBullet(e){p.a.applyPrefixToSelection(r.a.Prefix.Bullet)}hotkeyPrefixNumList(e){p.a.applyPrefixToSelection(r.a.Prefix.NumList)}hotkeyEmailCompose(){var e=s.default.pluginManager.getPluginGmail();e.isEnabled()?s.default.menus.openComposeEmail(e):s.default.toasts.pushMessage(r.a.MessageID.NeedGmailPermission)}hotkeyPreviousBoard(){g.a.hotkeyPrevBoard()}hotkeyNextBoard(){g.a.hotkeyNextBoard()}hotkeySelectBoard1(){g.a.selectBoard(0)}hotkeySelectBoard2(){g.a.selectBoard(1)}hotkeySelectBoard3(){g.a.selectBoard(2)}hotkeySelectBoard4(){g.a.selectBoard(3)}hotkeySelectBoard5(){g.a.selectBoard(4)}hotkeySelectBoard6(){g.a.selectBoard(5)}hotkeySelectBoard7(){g.a.selectBoard(6)}hotkeySelectBoard8(){g.a.selectBoard(7)}hotkeySelectBoard9(){g.a.selectBoard(8)}hotkeySelectBoard10(){g.a.selectBoard(9)}hotkeyAddToCalendar(){var e=s.default.pluginManager.getPluginGCalendar();e&&e.isActive()&&!e.isPluginBlocked()&&i.default.focusedPane.applyToSelection(t=>e.createEventForItem(t))}hotkeyEditNote(){i.default.focusedPane&&(s.default.PaneUpdateBatcher.beginUpdateItems(),i.default.focusedPane.clearPreventUpdate(),i.default.focusedPane.applyToSelection(e=>{e.isNote()||p.a.editNote(e)}),s.default.PaneUpdateBatcher.commitUpdateItems())}hotkeyHelp(){s.default.intro.toggle(r.a.HelpMode.Normal)}hotkeyHelpHotkeys(){s.default.intro.toggle(r.a.HelpMode.Hotkeys)}hotkeySettings(){s.default.menus.openSettings()}hotkeyDeleteItem(){i.default.focusedPane.deleteSelected()}hotkeyZoomInApp(){s.default.nativeBridge.sendToApp("zoomIn")}hotkeyZoomOutApp(){s.default.nativeBridge.sendToApp("zoomOut")}hotkeyDate(){if(p.a.isValid()){let e=p.a.getStartIndex(),t=p.a.getStartItem(),a=p.a.getPane(),i=p.a.getStartOffset();if(e>=0){let r=a.elementAtIndex(e);r&&s.default.menus.openContextMenu({componentName:"ReactContextMenuDate",element:r,item:t,pane:a,textOffset:i>=0?i:t.getParsedText().length})}}}hotkeyNoop(){}callbackOnPane(e,t,a){var r=i.default.focusedPane;return r&&r.onHotkey&&r.onHotkey(e,t,a),!1}printHotkeyByName(e,t){var a=this.config[t||"Pane"][e];try{i.default.PAssert(473,a,"Getting an invalid hotkey")}catch(n){i.default.reportError(n)}if(a)for(var r=0,s=0;s<a.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;let e=a[s];if(this.isValidPlatform(e))return this.printHotkey(e)}}printHotkey(e){var t=0,a=e.split(":"),i=a[a.length-1].split("+"),r="";for(let s=0;s<i.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let e,a=i[s];s>0&&(r+=l.a.windows?" + ":" "),r+=e="Pr"===a?l.a.priModKey:"Se"===a?l.a.secModKeyForce:"Sh"===a?l.a.mac?"\u21e7":"Shift":"Op"===a?"\u2325":2===a.length&&"D"===a[0]?a[1]:"Slash"===a?"/":"Tilde"===a?"~":"LeftArrow"===a?"\u2190":"RightArrow"===a?"\u2192":"UpArrow"===a?"\u2191":"DownArrow"===a?"\u2193":"Period"===a?".":"Comma"===a?",":"Equals"===a?"=":"Plus"===a?"+":"Dash"===a?"-":"Backspace"===a?l.a.mac?"Delete":a:a.endsWith("Bracket")?a.startsWith("L")?"[":"]":a}return r}__dbgCheckHotkeyOverlap(e,t){for(var a=0,r=t.mods,s=m[e],n=0;n<s.length;++n){var o=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var l=s[n].mods,d=!0,h=0;h<4;h++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(r[h]!==l[h]){d=!1;break}}if(d){if(l[this.platformPrimaryKey]&&r[this.platformPrimaryKey])try{i.default.PAssert(474,!1,"Overlapping hotkey: ",t)}catch(c){i.default.reportError(c)}if(l[this.platformSecondaryKey]&&r[this.platformSecondaryKey])try{i.default.PAssert(475,!1,"Overlapping hotkey: ",t)}catch(c){i.default.reportError(c)}}}}}},36:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=[" ","-","/","[","]","(",")","*","_","@",".",":"];t.a=new class{getPreviousWord(e,t,a){for(var s=0,o=a-1;o>=0;o--){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=t[o];if(i.default.shouldLog(r.a.LogLevels.Edit)&&console.log(o,l),n.indexOf(l)>=0&&!this.isInsideMarkup(e,o))return o}return-1}getNextWord(e,t,a){for(var i=0,r=a+1;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t[r];if(n.indexOf(s)>=0&&!this.isInsideMarkup(e,r,!0))return r}return t.length}moveLeft(e,t){if(s.default.settings.showMarkdown.get())t--;else{var a=0;do{if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t--}while(t>0&&this.isInsideMarkup(e,t,!1))}return t}moveRight(e,t,a){let i=t;if(s.default.settings.showMarkdown.get())i++;else{var r=0;do{if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i++}while(i<=a&&this.isInsideMarkup(e,i-1,!0))}return t<a-3&&i>a&&(i=a),i}isInsideMarkup(e,t,a,i){if(!s.default.settings.showMarkdown.get())for(var r=0,n=e.getEls(),o=0;o<n.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=n[o],d=l.getOrigTextLength();if(t<d)return(i?l.hasClass(i):l.isMarkdown()||l.isMDImage()||a&&l.hasClass("itemPrefix"))?l:void 0;t-=d}}adjustLeftForMarkup(e,t){if(s.default.settings.showMarkdown.get())return t;for(var a=0;t>0&&this.isInsideMarkup(e,t-1,!1);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t--}return t}}},39:function(e,t,a){"use strict";var i,r=a(0),s=a(1),n=a(7),o=a.n(n),l=a(16),d=a(3),h=a(106),c=a(17),u=a(13),p=a(8);var g=(i=class{constructor(){this.undoStack=[],this.redoStack=[],this.isUndoing=!1,this._deleteSelection=void 0,this._batch=[],this.__numInBatch=0,this._batchPrevSel=void 0,this._groupTextChanges=!1,this._needsSelection=!1,l.a.binder(this,"_onSelectionChanged"),c.a.listen("selectionChanged",this._onSelectionChanged)}_getLastState(){return this.undoStack[this.undoStack.length-1]}_getLastAction(){var e=this.undoStack[this.undoStack.length-1];if(e&&1===e.actions.length)return e.actions[0]}pushModified(e,t,a){if(!this.isUndoing){let i=!1;if("text"in t){let a=this._getLastAction(),r=this._getLastState();this._needsSelection=!0,this._groupTextChanges&&r&&a&&a.itemId===e.id&&(a.changes.text=t.text,i=!0)}i||this._doPush(e,{itemId:e.id,type:"Modified",changes:t,prevState:a}),this.clearDeleteSelection()}}pushAdded(e,t){try{r.default.PAssert(402,void 0!==t.index,"Item should have index when adding")}catch(a){r.default.reportError(a)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Added",changes:{parent:e.id,index:t.index}}),this.clearDeleteSelection())}pushRemoved(e,t){try{r.default.PAssert(403,void 0!==t.index,"Item should have index when removing")}catch(a){r.default.reportError(a)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Removed",prevSel:this._deleteSelection,changes:{parent:e.id,index:t.index}}),this.clearDeleteSelection())}clearDeleteSelection(){this.__numInBatch<=0&&(this._deleteSelection=void 0)}_doAction(e){if(!this.isUndoing)try{let a=e?this.redoStack:this.undoStack,i=e?this.undoStack:this.redoStack,n=a.pop();if(n){let a=n.actions;try{r.default.PAssert(404,a.length>0,"Undo state should have some actions")}catch(t){r.default.reportError(t)}a.length>0&&(this.isUndoing=!0,d.default.PaneUpdateBatcher.beginUpdateItems(),r.default.focusedPane.clearPreventUpdate(),a.forEach(t=>{let a=t.type,i=a===s.a.CrudActions.Added||a===s.a.CrudActions.Removed?t.changes:e?t.changes:t.prevState;Object.keys(i).forEach(e=>{void 0===i[e]&&(i[e]=null)}),e||(a===s.a.CrudActions.Added?(a=s.a.CrudActions.Removed,i.isDeleted=!0):a===s.a.CrudActions.Removed&&(a=s.a.CrudActions.Added,i.isDeleted=!1));let r=u.a.getItem(t.itemId);if(r){let e=r.getDocumentOwner(),a=u.a.getItemDataLocal(e,t.itemId);h.a.onRemoteChange(e,a,t.itemId,i),u.a.saveItem(r,i,s.a.ChangeType.Local,s.a.SaveFlag.All)}}),d.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelFromState(e,n),i.push(n))}}finally{this.isUndoing=!1}}restoreSelFromState(e,t){}undo(){this._doAction(!1)}redo(){this._doAction(!0)}_onSelectionChanged(e){var t=this._getLastState();t&&this._needsSelection?(this._needsSelection=!1,t.selection=e,this._groupTextChanges=!0):this._groupTextChanges=!1}saveDeleteSelection(){}beginAction(){this.__numInBatch++,r.default.timeoutOnce("batch_beginAction",this.onActionTimeout,0)}endAction(e){this.__numInBatch--;try{r.default.PAssert(405,this.__numInBatch>=0,"Undo batch somehow went negative")}catch(t){r.default.reportError(t)}(this.__numInBatch<=0||e)&&(this.__numInBatch=0,this._batch.length>0&&(this.undoStack.push({prevSel:this._batchPrevSel,actions:this._batch}),this._batch=[]),this._deleteSelection=void 0)}onActionTimeout(){this.__numInBatch>0&&this.endAction(!0)}clearGroupTextChanges(){this._needsSelection=!1,this._groupTextChanges=!1}},o()(i.prototype,"onActionTimeout",[p.a],Object.getOwnPropertyDescriptor(i.prototype,"onActionTimeout"),i.prototype),i),f=a(4);t.a=new class extends g{_doPush(e,t){this.redoStack=[];let a=t.prevSel||f.a.getSavedSelection()||f.a.save();if(t.itemId=e.id,f.a.isValid()&&(t.selection=f.a.save(!0)),this.__numInBatch>0){this._batchPrevSel=a;let n=this._batch.indexOfWithProperty("itemId",e.id);if(n>=0){let e=this._batch[n];if(e.type===s.a.CrudActions.Modified&&"Removed"===t.type)t.changes.text=e.prevState.text;else try{r.default.PAssert(138,!1,"Existing item in batch when adding undo item",e.type,t.type)}catch(i){r.default.reportError(i)}this._batch[n]=t}else this._batch.push(t)}else this.undoStack.push({prevSel:a,actions:[t]})}restoreSelFromState(e,t){let a=e?t.selection:t.prevSel;a&&f.a.restore(a,!0)}saveDeleteSelection(){this._deleteSelection=f.a.save()}pushRemoved(e,t){if(!this.isUndoing)try{r.default.PAssert(139,this._deleteSelection,"Must have saved delete selection before deleting")}catch(a){r.default.reportError(a)}super.pushRemoved(e,t)}}},4:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(5),o=a(16),l=a(17),d=a(9),h=a(19),c=a(36),u=a(25),p=a(6);var g=class{constructor(){this.pane=new d.a}setSelectedPaneObject(e){}scrollStartIntoView(){}updateCaret(){}checkValid(){}getPane(){try{i.default.PAssert(574,this.pane.get()===i.default.focusedPane,"Should these always match?")}catch(e){i.default.reportError(e)}return this.pane.get()}setFocusedPane(e){i.default.focusedPane=e,this.pane.set(e)}applyFormatToSelection(e){var t,a,s=!1;i.default.setItemAnimationMode(r.a.ItemAnimationMode.None),i.default.focusedPane.applyToSelection((i,n,o)=>{var l=0===n?this.getStartOffset():0,d=n===o-1?this.getEndOffset():i.getParsedText().length,h=i.applyFormatToSelection(e,l,d,0===n?r.a.SetMode.Toggle:s?r.a.SetMode.Yes:r.a.SetMode.No);0===n&&(s=h.didSet,t=h.selStart),n===o-1&&(a=h.selEnd)}),this.selectIndices(this.getStartIndex(),t,this.getEndIndex(),a),i.default.resetItemAnimationMode()}applyPrefixToSelection(e,t){var a,r;if(this.isValid()&&(a=this.getStartItem().getPrefixLength(),r=this.getEndItem().getPrefixLength()),t)e=t.prefix===e?null:e,t.setPrefix(e);else{var s=!0;i.default.focusedPane.applyToSelection(t=>{if(t.prefix!==e)return s=!1,!1}),s&&(e=null),i.default.focusedPane.applyFnToSelection("setPrefix",{value:e,noRestoreSel:!0})}if(!isNaN(a)){var n=this.getStartItem().getPrefixLength()-a,o=this.getEndItem().getPrefixLength()-r;n||o?this.selectIndices(this.getStartIndex(),this.getStartOffset()+n,this.getEndIndex(),this.getEndOffset()+o):this.updateCaret()}}selectIndex(e,t,a,i){return void 0===a&&(a=t),this.selectIndices(e,t,e,a,i)}},f=-1,m={Start:"start",End:"end"};const v=["mdImageResizer","emptyItemAddButton",["itemNotInPane",!0],"itemCheckbox","itemPrefix",["searchWrap",!0],"collapser","itemMenuIcon","itemEditButton",["formattingToolbar",!0],"itemTime"];t.a=new class extends g{constructor(){super(),this._isValid=!1,this._isInRightClick=!1,this._isDirty=!1,this._isWatchingChange=!0,this._isMouseDown=!1,this.isWindowFocused=new d.a(!0),this.hoveredItem=void 0,this.hoveredReactCell=void 0,this._previousSelectedIndex=void 0,this._previousIsValid=void 0,this._selectedMap=[],this.mousePos={x:-1,y:-1},this.mouseDownPos={x:-1,y:-1},this._lastClickTime=0,this._numClicks=0,this._savedPaneSels={},this._itemHighlightPosition=void 0,this.itemHighlightPosition=new d.a,this.init()}init(){this.reset();var e={};e.onStart=this.onMouseDown.bind(this),e.onEnd=this.onMouseUp.bind(this),e.onRightStart=this.onRightMouseDown.bind(this),e.onMove=this.onMouseMove.bind(this),document.addEventListener("mousemove",this.onMouseMoveDocument.bind(this),!0),window.addEventListener("blur",this.onWindowBlur.bind(this)),window.addEventListener("focus",this.onWindowFocus.bind(this)),i.default.setupClick(document,this,e),l.a.listen("paneAdded",this.onPaneAdded.bind(this)),l.a.listen("paneRemoved",this.onPaneRemoved.bind(this)),o.a.binder(this,"restore","onScroll")}reset(e,t){if(this._isValid){i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::reset");var a=!t&&this.save();a&&(this._previousSelection=a),this._setIndexSide(m.Start,void 0),this._setIndexSide(m.End,void 0),this._setOffsetSide(m.Start,void 0),this._setOffsetSide(m.End,void 0),this._dblClickOffsets=void 0,this.preferLineStart=!1,this._mouseOffset=-1,this._mouseMoved=!1,this._isValid=!1,this._isArrowSelectInverted=!1,this._itemHighlightPosition=void 0;var s=this.getPane();!s||s.isUnloaded()||s.isDestroyed()||(s.caretPosition.set(void 0),this._updateSelection())}}getPreviousSelection(){return this._previousSelection}dumpState(){var e={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.startIndex,offset:this.startOffset},end:{index:this.endIndex,offset:this.endOffset}};try{var t=!!this.pane.get();e.paneInfo=t?{hasPane:t,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop(),displayCount:this.pane.get().inViewCount()}:"No Pane Set"}catch(a){e.paneInfo="Invalid Pane"}try{void 0!==this.startIndex&&(e.start.item=this.pane.get().items.get()[this.startIndex].id)}catch(a){e.start.item="Invalid Item"}try{void 0!==this.endIndex&&(e.end.item=this.pane.get().items.get()[this.endIndex].id)}catch(a){e.end.item="Invalid Item"}return e}setValid(e){if(e){try{i.default.PAssert(249,!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex())}catch(r){i.default.reportError(r)}try{i.default.PAssert(250,!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex())}catch(r){i.default.reportError(r)}try{var t=this.pane.get().items.get()[this.startIndex];try{i.default.PAssert(251,t&&(i.default.isVMLI(t)||i.default.isVMLI(t.item)),"Valid selection must always be into a VMLI for start item")}catch(r){i.default.reportError(r)}var a=this.pane.get().items.get()[this.endIndex];try{i.default.PAssert(252,a&&(i.default.isVMLI(a)||i.default.isVMLI(a.item)),"Valid selection must always be into a VMLI for end item")}catch(r){i.default.reportError(r)}}catch(s){i.default.reportError(s)}}else this.reset();this._isValid=e}isArrowSelectInverted(){return this._isArrowSelectInverted}setArrowSelectInverted(e){this._isArrowSelectInverted=e}getStartItem(){return this.getPane().itemAtIndex(this.startIndex)}getStartObject(){return this.getPane().objectAtIndex(this.startIndex)}getStartOffset(){var e;return this.startOffset===f?(e=this.getStartTotal(),this.startOffset=e):e=this.startOffset,e}getStartIndex(){return this.startIndex}getStartTotal(){return this.getStartItem().getParsedText().length}getEndItem(){return this.getPane().itemAtIndex(this.endIndex)}getEndObject(){return this.getPane().objectAtIndex(this.endIndex)}getEndOffset(){var e;return this.endOffset===f?(e=this.getEndTotal(),this.endOffset=e):e=this.endOffset,e}getEndIndex(){return this.endIndex}getEndTotal(){return this.getEndItem().getParsedText().length}isMouseDown(){return this._isMouseDown}_mutateProperty(e,t){var a=this[e];this[e]=t,a!==t&&(this._isDirty=!0)}_setIndexSide(e,t){this._mutateProperty(e+"Index",t)}_setOffsetSide(e,t){if(s.default.settings.selectFullItems.get()&&this.getStartIndex()!==this.getEndIndex()){var a=e===m.Start?this.getStartIndex():this.getEndIndex(),n=this.getPane().itemAtIndex(a);t=e===m.Start?0:n.getParsedText().length}this._mutateProperty(e+"Offset",t),i.default.shouldLog(r.a.LogLevels.Edit)&&i.default.log(e,t)}setSelection(e,t,a,i){this._setIndexSide(m.Start,e),this._setIndexSide(m.End,a),this._setOffsetSide(m.Start,t),this._setOffsetSide(m.End,i),this._downIndex=e,this._downOffset={start:t,end:i}}isValid(){return this._isValid}checkValid(){var e=!1,t=this.getPane();if(t&&this.startIndex>=0&&this.startIndex<t.numItems()&&this.endIndex>=0&&this.endIndex<t.numItems())if(this.getStartItem()&&this.getEndItem()){var a=this.getStartItem().getParsedText(),r=this.getEndItem().getParsedText();this.startOffset>=0&&this.startOffset<=a.length&&this.endOffset>=0&&this.endOffset<=r.length&&(e=!0)}else e=!1;return!e&&this.isValid()&&(i.default.log("Sel is now invalid"),this.reset(void 0,!0)),e}clearSelection(e){this.reset(e)}onPaneAdded(e){e.addScrollListener(this.onScroll)}onPaneRemoved(e){e.removeScrollListener(this.onScroll),this.getPane()===e&&this.setFocusedPane(void 0)}onScroll(e){var t=i.default.getPaneForElement(e.target);if(this._isMouseDown&&t===this.getPane()&&t.isWriteable&&!a(143).default.isDragging){var r=this.getMousePos();this._mouseOffset=r.y+t.getScrollTop();var s=document.elementFromPoint(r.x,r.y),n={clientX:r.x,clientY:r.y,target:s};this._updateFromMouse(n),this._updateSelection()}}onRightMouseDown(e){var t=!i.default.hasClass(e.target,"mdImage"),a=i.default.findParent(e.target,"item")&&i.default.getElementParent(e.target);if(a&&!i.default.findParent(a,"autocompleteItem",2)&&!i.default.hasClass(a,"itemNotInPane")){var r=i.default.getPaneObjectForElement(a);if(r){var s=i.default.getPaneForElement(a),n=r.index;this.isSelected(n,s)&&(t=!1)}}t&&(this._isInRightClick=!0,this.onMouseDown(e,!0),this._isInRightClick=!1)}checkDoubleClick(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0}onMouseDown(e,t){var a=i.default.getPaneForElement(e.target);if(this.isWindowFocused.set(!0),i.default.findParent(e.target,"formattingToolbar")||(this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0)),a&&!(e.clientX-s.default.DesktopUI.getSidebarWidth()>a.getLeft()+a.getWidth()-48)){this.setFocusedPane(a);var o=e.target,l=a.getInfiniteList();if(a.supportSel&&!v.some(e=>i.default.isArray(e)?i.default.findParent(o,e[0]):i.default.hasClass(o,e))){t||(this._isMouseDown=!0),this._selectionBeforeBlur=void 0,this.preferLineStart=!1;var d,u=this.mouseDownPos.x,p=this.mouseDownPos.y,g=!1,f=i.default.getElementParent(e.target),y=i.default.findParent(e.target,"line");if(this.mouseDownPos.x=e.pageX,this.mouseDownPos.y=e.pageY,!y&&(y=f&&i.default.findChild(f,"line"))){let t=i.default.offset(y);d=e.clientX>t.left+50||e.clientY>t.top+10?"end":"start"}if(i.default.findParent(o,"paneContent")){if(a&&a.isWriteable&&a.isEditable){if(f&&y){if(t)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var _=Date.now();_-this._lastClickTime<r.a.DoubleClickTime&&Math.abs(e.pageX-this.mouseDownPos.x)<2&&Math.abs(e.pageY-this.mouseDownPos.y)<2&&Math.abs(e.pageX-u)<2&&Math.abs(e.pageY-p)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=_}var S=h.default.getCursorSelectionRange(e);if(S){i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::onMouseDown - Default");var P=i.default.getListCellForElement(e.target);if(P&&!P.props.overview){if(this.preferLineStart=e.clientX-i.default.offset(y).left<30,e.shiftKey&&!(n.a.mac&&e.metaKey||!n.a.mac&&e.ctrlKey))this._mouseMoved=!0,this._mouseOffset=e.eventY+a.getScrollTop(),this._updateFromMouse(e);else if(1===this._numClicks||this._numClicks>3){this._downIndex=P.getIndex();try{i.default.PAssert(256,this._downIndex>=0,"Must have a valid index in react item")}catch(x){i.default.reportError(x)}if(this._downIndex<0)try{i.default.PAssert(257,this._downIndex>=0,"Dead cell error",i.default.getElementPath(S.getStartElement()),i.default.getElementPath(e.target))}catch(x){i.default.reportError(x)}this._downItem=P.getItem();try{i.default.PAssert(258,this._downItem,"Must have a valid item in react item")}catch(x){i.default.reportError(x)}var I=S.getSelectOffsetsInElement(f);if(d){let e="start"===d?this._downItem.getPrefixLength():this._downItem.getTextLength();I.start=e,I.end=e}if(0===this._downItem.getParsedTextWithoutPrefix().length?this._downOffset={start:I.total,end:I.total}:this._downOffset={start:I.start,end:I.start},s.default.settings.showMarkdown.get()&&!this.isSelected(this._downIndex,a)){var b=i.default.findParent(S.getStartContainer(),"mdSpan",2);if(b&&S.getStartOffset()===b.innerHTML.length){for(var D=0,w=b.nextElementSibling,E=0;w&&i.default.hasClass(w,"mdMarkup");){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;E+=w.innerHTML.length,w=w.nextElementSibling}if(!w){var C=Math.min(this._downOffset.start+E,I.total);this._downOffset={start:C,end:C}}}}this.setSelection(this._downIndex,this._downOffset.start,this._downIndex,this._downOffset.end)}else if(2===this._numClicks){var A=this._downItem.getParsedText(),M=c.a.getPreviousWord(this._downItem,A,this._downOffset.start)+1,T=c.a.getNextWord(this._downItem,A,this._downOffset.end);this._setOffsetSide(m.Start,M),this._setOffsetSide(m.End,T),this._downOffset={start:M,end:T}}else 3===this._numClicks&&(this._setOffsetSide(m.Start,0),this._setOffsetSide(m.End,this._downItem.getParsedText().length),this._downOffset={start:0,end:this._downItem.getParsedText().length});g=!0}}}else if(!i.default.findParent(e.target,"paneContent")||i.default.findParent(e.target,"addItemButton")||l.disablePointerEvents.get())i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::onMouseDown - Skip");else{var L=a.indexOfLastItem();L>=0&&(e.shiftKey&&this.isValid()&&!t?this.selectIndices(this.getStartIndex(),this.getStartOffset(),L,-1):this.selectIndex(L,-1),g=!0),e.preventDefault()}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}}else i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::onMouseDown - Skip header");this.setValid(g&&this.checkValid()),this.isValid()&&(i.default.setItemAnimationMode(r.a.ItemAnimationMode.None),this._updateSelection(),i.default.resetItemAnimationMode()),l&&l.flushTimeoutPointerEvents()}}}getMousePos(){return this.mousePos}onMouseMoveDocument(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY}onMouseMove(e){if(this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),e.target!==document.documentElement&&e.target.parentElement&&!i.default.isDraggingImage){var t=i.default.getPaneForElement(e.target);if(this._isValid&&this._isMouseDown&&t===this.getPane()&&t.supportSel&&t.isWriteable&&!a(143).default.isDragging)return this._mouseMoved=!0,i.default.setItemAnimationMode(r.a.ItemAnimationMode.None),this._mouseOffset=e.eventY+t.getScrollTop(),this._updateFromMouse(e),this._updateSelection(),e.preventDefault(),!1}}onMouseUp(e){let t=i.default.isAttachedToDoc(e.target)&&i.default.getPaneForElement(e.target),a=t&&i.default.getElementParent(e.target);t&&t.supportSel&&!v.some(t=>i.default.isArray(t)?i.default.findParent(e.target,t[0]):i.default.hasClass(e.target,t))&&(this._isMouseDown=!1,i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::onMouseDown - onMouseUp"),i.default.vmMain&&i.default.resetItemAnimationMode(),!a||i.default.hasClass(e.target,"contact")||i.default.hasClass(a,"itemNotInPane")||i.default.findParent(e.target,"inlineDate")||this.updateCaret(),this._itemHighlightPosition&&this.itemHighlightPosition.set(this._itemHighlightPosition),i.default.cancelRepeatScrolls())}focusPane(e){this.setFocusedPane(e),this.updateCaret()}setFocusedPane(e){if(!e||!i.default.focusedPane||i.default.focusedPane.id!==e.id){var t=i.default.focusedPane;if(t&&!t.isUnloaded()&&(t.setFocused(!1),t.isEditable&&this.isValid()&&(this._savedPaneSels[t.id]=this.save())),s.default.PaneUpdateBatcher.beginUpdateItems(),this.reset(),u.a.reset(t),i.default.focusedPane=e,i.default.focusedItem=e?e.getItem():void 0,super.setFocusedPane(e),e){var a=this._savedPaneSels[e.id];a?(a.pane=e,e.isLoaded?this.restore(a):setTimeout(this.restore,0,a),this._savedPaneSels[e.id]=void 0):this.reset(),e.setFocused(!0)}s.default.PaneUpdateBatcher.commitUpdateItems()}}_updateWith(e,t,a){var s=t===m.Start?a.getStartElement():a.getEndElement();try{i.default.PAssert(259,s,"Trying to select in invalid container")}catch(u){i.default.reportError(u)}if(s){var n=i.default.getListCellForElement(s),o=i.default.getElementParent(s),l=i.default.getItemForElement(o),d=a.getSelectOffsetsInElement(o),h=t===m.Start?d.start:d.end;try{i.default.PAssert(260,n.getItem(),"Should not be updating ReactCells without VMLIs")}catch(u){i.default.reportError(u)}if(i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::_updateWith["+e+"] - ",h,n.index),this._setIndexSide(e,n.getIndex()),this._dblClickOffsets&&n.getIndex()===this._dblClickOffsets.index)if(e===m.Start)h=Math.min(h,this._dblClickOffsets.start);else if(e===m.End)h=Math.max(h,this._dblClickOffsets.end);else try{i.default.PAssert(261,!1,"Invalid toUpdate value")}catch(u){i.default.reportError(u)}this._downOffset.start!==this._downOffset.end&&(h=e===m.Start?c.a.getPreviousWord(l,l.getParsedText(),h)+1:c.a.getNextWord(l,l.getParsedText(),h-1)),this._setOffsetSide(e,h);try{i.default.PAssert(262,!isNaN(h),"Selection offsets should not be undefined")}catch(u){i.default.reportError(u)}}}_setSelectionOnSide(e,t,a){var i=e===m.Start?m.End:m.Start;this._setIndexSide(e,t),this._setIndexSide(i,this._downIndex),this._setOffsetSide(e,a),this._setOffsetSide(i,e===m.Start?this._downOffset.start:this._downOffset.end),this.setArrowSelectInverted(t<this._downIndex||t===this._downIndex&&a<this._downOffset.start)}_updateFromMouse(e){var t=e.target;if(!t)return;var a=i.default.focusedPane;if(!i.default.getElementParent(t)&&e.clientY<a.contentTop()){if(i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::_updateFromMouse - outOfPane"),t=i.default.elementFromPoint(e.clientX,a.contentTop()+1),i.default.getElementParent(t)){let e=i.default.getListCellForElement(t),a=i.default.getItemForElement(t);try{i.default.PAssert(263,a,"If it is an LI it should be an item",t)}catch(p){i.default.reportError(p)}this._setIndexSide(m.Start,e.getIndex()),this._setOffsetSide(m.Start,0)}return}let s,n,o,l=i.default.getElementParent(t);if(l){if(i.default.findParent(t,"line")||(t=l.firstElementChild),(o=h.default.getCursorSelectionRange(e))&&o.getStartElement()){let e=i.default.getListCellForElement(t);try{i.default.PAssert(264,e,"Must be able to find a valid reactCell for the start element")}catch(p){i.default.reportError(p)}if(e){if((s=e.getIndex())<0)try{i.default.PAssert(266,s>=0,"Dead cell error",i.default.getElementPath(o.getStartElement()),i.default.getElementPath(t))}catch(p){i.default.reportError(p)}i.default.findParent(o.getStartContainer(),"line")&&i.default.findParent(o.getEndContainer(),"line")?n=o.getSelectOffsetsInElement(l).start:s<=this._downIndex?this._setSelectionOnSide(m.Start,s,0):this._setSelectionOnSide(m.End,s,0)}}}else if(a.hasNonVMLIs){let e=i.default.getPaneObjectForElement(t);if(e){let t=e.index;if(t>=0&&!a.itemAtIndex(t))if(t<this._downIndex){let e=a.indexOfNextVMLI(t);e>=0&&this._setSelectionOnSide(m.Start,e,0)}else{let e=a.indexOfPrevVMLI(t);if(e>=0){let t=a.itemAtIndex(e);this._setSelectionOnSide(m.End,e,t.getParsedText().length)}}}}else if(i.default.hasClass(t,"paneContent")){i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::_updateFromMouse - paneContent");var d=a.getLastItem();this._setIndexSide(m.End,a.numItems()-1),this._setOffsetSide(m.End,d?d.getParsedText().length:0)}if(!isNaN(s)&&!isNaN(n)&&o){var c,u=i.default.findParent(t,"line");u&&(this.preferLineStart=e.clientX-i.default.offset(u).left<30,s<this._downIndex||s===this._downIndex&&n<this._downOffset.start?(c=m.End,this._updateWith(m.Start,m.Start,o),this.setArrowSelectInverted(!0)):(s>this._downIndex||s===this._downIndex&&n>=this._downOffset.start)&&(c=m.Start,this._updateWith(m.End,m.End,o),this.setArrowSelectInverted(!1),n===this._downOffset.start&&(this._isDirty=!0)),void 0!==c&&(i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::_updateFromMouse - RunAfterUpdates"),this._setIndexSide(c,this._downIndex),this._dblClickOffsets?this._setOffsetSide(c,this._dblClickOffsets[c]):this._setOffsetSide(c,c===m.Start?this._downOffset.start:this._downOffset.end),this.setValid(!0)))}}setSelectionFromNativeRange(e){this._updateWith(m.Start,m.Start,e),this._updateWith(m.End,m.End,e),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))}_updateSelection(){if(this._isDirty){var e=this.getPane(),t=this.save(),a=this._selectedMap;if(this.getStartIndex()!==this.getEndIndex()||(this.getStartOffset(),this.getEndOffset()),this._selectedMap=[],this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex())),this.getStartIndex()===this.getEndIndex()&&void 0!==this.getStartIndex()){try{i.default.PAssert(267,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(g){i.default.reportError(g)}this._selectedMap[this.getStartIndex()]={start:this.getStartOffset(),end:this.getEndOffset()}}else for(var n=0,o=this.getStartIndex();o<=this.getEndIndex();++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var d=!0;if(!s.default.settings.selectFullItems.get())if(o===this.getStartIndex())d={start:this.getStartOffset(),end:f};else if(o===this.getEndIndex()){try{i.default.PAssert(268,this.getEndOffset()<=this.getEndItem().getParsedText().length,"Selection is past end of text string")}catch(g){i.default.reportError(g)}d={start:0,end:this.getEndOffset()}}this._selectedMap[o]=d}if(e){var h=!1;a.forEach((t,a)=>{if(void 0===this._selectedMap[a]&&a<e.numItems()){var i=e.itemAtIndex(a);i&&(i.itemChanged.notify(),h=h||e.checkHeightChanged(i,a))}}),this._selectedMap.forEach((t,r)=>{var s=a[r],n=this._selectedMap[r];if(void 0===s||s.start!==n.start||s.end!==n.end){var o=e.itemAtIndex(r);o&&((!s||n.start!==n.end||s&&s.start!==s.end||i.default.isObject(s)!==i.default.isObject(n))&&o.itemChanged.notify(),h=h||e.checkHeightChanged(o,r))}}),h&&(i.default.setItemAnimationMode(r.a.ItemAnimationMode.Move),e.updateItems(!1,!0),i.default.resetItemAnimationMode())}this.updateCaret(),this._isDirty=!1,l.a.fireEvent("selectionChanged",[t]);var c=this.getStartIndex(),u=this.isValid();if(c===this.getEndIndex()||!u){if(c!==this._previousSelectedIndex||u!==this._previousIsValid){var p=u?this.getStartItem():void 0;l.a.fireEvent("selectedIndexChanged",[c,e,p])}this._previousSelectedIndex=c,this._previousIsValid=u}}}updateCaret(){var e=this.getPane();if(e&&e.isWriteable){if(this.isValid()){var t=!this._isInRightClick&&this.getStartItem()===this.getEndItem()&&this.getStartItem()&&this.getStartItem().isNote();t?e.openNoteContextMenu():!s.default.menus.isAutocompleteOpen()&&s.default.menus.isContextMenuOpen()&&s.default.menus.closeContextMenu()}if(this.isValid()){var a=this.getStartItem(),n=this.getStartObject(),o=e.topOfIndex(this.getStartIndex())+(a&&a.shouldShowParents(n,e)?r.a.HeightAgendaParents:0),l=e.getPaddingForPaneObject(n),d=s.default.Measure.getCaretOffset(n,e,this.getStartOffset(),this.preferLineStart);if(this.getStartItem()&&this.getEndItem()&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()===this.getEndOffset()){this._selectionBeforeUpdate={index:this.getStartIndex(),offset:this.getStartOffset()};var h=e.caretPosition.get();d.left=Math.floor(Math.min(d.left+l,e.getWidth()-10)),d.top+=o,d.isVisible=!0,d.item=a,d.pane=e,d.paneObject=n,this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0),h&&h.isVisible&&h.left===d.left&&h.top===d.top||e.caretPosition.set(d)}else{var c=e.caretPosition.get();c&&c.isVisible&&((c=i.default.clone(c)).isVisible=!1,e.caretPosition.set(c));var u=this.getStartIndex()===this.getEndIndex()?this.getEndOffset():a.getTextLength(),p=s.default.Measure.getCaretOffset(n,e,u,this.preferLineStart);this._itemHighlightPosition={x:l+(d.left+p.left)/2,y:o}}t||!e.hiddenInput||this.isComposing||this.focusHiddenInput()}else e.caretPosition.set(void 0)}}focusHiddenInput(){var e=this.getPane();if(e&&e.isEditable&&e.hiddenInput){var t=h.default.createSelectionRange(),a=e.hiddenInput,s=0,n=1,o=e.scrollElement,l=o.scrollLeft,d=o.scrollTop;if(this.isValid()){var c=this.getStartItem().getParsedText();a.innerHTML=i.default.escape(c),s=this.getStartOffset(),n=this.getStartItem()===this.getEndItem()?this.getEndOffset():this.getStartOffset(),s>c.length&&(s=c.length),n>c.length&&(n=c.length)}a.firstChild&&0!==a.firstChild.length||(a.innerHTML=r.a.TextSpace);var u=a.firstChild;try{i.default.PAssert(271,u,"Empty element must have a valid child")}catch(p){i.default.reportError(p)}try{a.focus(),t.setStart(u,s),t.setEnd(u,n),h.default.setSelectionRange(t)}catch(g){i.default.reportError(g)}o.scrollLeft=l,o.scrollTop=d}}isSelected(e,t){return t===this.getPane()&&!!this._selectedMap[e]}getSelectionAtIndex(e){return this._selectedMap[e]}selectIndices(e,t,a,s,n){try{i.default.PAssert(272,e>=0,"Must supply a valid start index")}catch(c){i.default.reportError(c)}try{i.default.PAssert(273,a>=0,"Must supply a valid end index")}catch(c){i.default.reportError(c)}try{i.default.PAssert(274,a>e||a===e&&(s>=t||s===f),"Must not pass reversed selection")}catch(c){i.default.reportError(c)}if(!(e<0||a<0)){var o,l,d=!1,h=this.getPane();if(h&&h.isWriteable){o=h.itemAtIndex(e),l=h.itemAtIndex(a);try{i.default.PAssert(275,o,"Trying to select invalid start index")}catch(c){i.default.reportError(c)}try{i.default.PAssert(276,l,"Trying to select invalid end index")}catch(c){i.default.reportError(c)}if(o&&l&&n!==r.a.SelectOption.AllowPrefix){let e=o.getPrefixLength(),a=l.getPrefixLength();t>=0&&t<e&&(t=e),s>=0&&s<a&&(s=a)}}if(!o||!l||this.isValid()&&e===this.getStartIndex()&&t===this.getStartOffset()&&a===this.getEndIndex()&&s===this.getEndOffset())this.updateCaret();else{i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::selectIndices -",t,s),this.setSelection(e,t,a,s);try{i.default.PAssert(277,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(c){i.default.reportError(c)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(),d=!0}return d}}selectItem(e,t,a){try{i.default.PAssert(278,i.default.isNumber(t),"Must pass a valid start offset")}catch(r){i.default.reportError(r)}try{i.default.PAssert(279,i.default.isNumber(a)||void 0===a,"Must pass a valid end offset")}catch(r){i.default.reportError(r)}return void 0===a&&(a=t),this.selectItems(e,t,e,a)}selectItems(e,t,a,r){try{i.default.PAssert(280,i.default.isVMLI(e),"Should only be passing VMLIs to start this fn")}catch(l){i.default.reportError(l)}try{i.default.PAssert(281,i.default.isVMLI(a),"Should only be passing VMLIs to end this fn")}catch(l){i.default.reportError(l)}var s=this.getPane();if(s){var n=s.indexOfItem(e);try{i.default.PAssert(282,n>=0,"Must be able to find the start item in the pane")}catch(l){i.default.reportError(l)}var o=s.indexOfItem(a);try{i.default.PAssert(283,o>=0,"Must be able to find the end item in the pane")}catch(l){i.default.reportError(l)}return this.selectIndices(n,t,o,r)}}selectElements(e,t,a,s){try{i.default.PAssert(284,!i.default.isVMLI(e),"Should not be passing VMLIs to start this fn")}catch(d){i.default.reportError(d)}try{i.default.PAssert(285,!i.default.isVMLI(a),"Should not be passing VMLIs to end this fn")}catch(d){i.default.reportError(d)}i.default.shouldLog(r.a.LogLevels.Selection)&&i.default.log("Sel::selectElements -",t,s),this._isWatchingChange=!1;var n=!1,o=h.default.getOffsetChildElement(e,t),l=h.default.getOffsetChildElement(a,s);try{i.default.PAssert(286,o&&o.element&&!isNaN(o.offset),"Start element is invalid")}catch(d){i.default.reportError(d)}try{i.default.PAssert(287,l&&l.element&&!isNaN(l.offset),"End element is invalid")}catch(d){i.default.reportError(d)}return o&&o.element&&l&&l.element&&(h.default.setSelection(o.element,o.offset,l.element,l.offset),n=!0),this._isWatchingChange=!0,n}save(e){if(!this._isValid)return;var t=this.getPane();if(t.isDestroyed()||t.isUnloaded())return;try{i.default.PAssert(288,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(r){i.default.reportError(r)}try{i.default.PAssert(289,!isNaN(this.getEndIndex()),"End index must be valid")}catch(r){i.default.reportError(r)}let a={pane:t,startIndex:this.getStartIndex(),startOffset:this.getStartOffset(),endIndex:this.getEndIndex(),endOffset:this.getEndOffset()};return e||(a.endItem=this.getEndItem(),a.endObject=this.getEndObject(),a.startItem=this.getStartItem(),a.startObject=this.getStartObject()),this._savedSelection=a,a}getSavedSelection(){return this._savedSelection}restore(e,t){var a=!1;if(e&&!e.pane.isDestroyed()){try{i.default.PAssert(290,e.pane,"Must have a valid pane to restore selection to")}catch(s){i.default.reportError(s)}var r=i.default.focusedPane;i.default.focusedPane=e.pane,i.default.focusedItem=e.pane.getItem(),r&&!r.isUnloaded()&&r!==e.pane&&r.setFocused(!1),e.pane.setFocused(!0),this.pane.set(e.pane),t||(e=e.pane.adjustSelectionFromPaneObject(e))}return e&&e.startItem&&e.endItem?(this.selectIndices(e.startIndex,e.startOffset,e.endIndex,e.endOffset),a=!0):this.reset(),this._savedSelection=void 0,a}scrollStartIntoView(e){if(this._isValid){try{i.default.PAssert(291,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){i.default.reportError(t)}try{i.default.PAssert(292,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){i.default.reportError(t)}i.default.focusedPane.scrollIndexIntoView(this.getStartIndex(),e?r.a.ScrollDuration.Snap:r.a.ScrollDuration.Default)}}scrollEndIntoView(){if(this._isValid){try{i.default.PAssert(293,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){i.default.reportError(e)}try{i.default.PAssert(294,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){i.default.reportError(e)}i.default.focusedPane.scrollIndexIntoView(this.getEndIndex(),r.a.ScrollDuration.Default)}}onWindowBlur(e){this.isWindowFocused.set(!1)}onWindowFocus(e){this.isWindowFocused.set(!0)}getSelectedObjects(e){var t=0;if(!this._isValid)return[];for(var a=[],i=this.getPane(),r=this.getStartIndex();r<=this.getEndIndex();++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i.objectAtIndex(r),n=s.item;!n||!e&&n.isNote()||a.push(s)}return a}getSelectedItems(e){var t=0;if(!this._isValid)return[];for(var a=[],i=this.getPane(),r=this.getStartIndex();r<=this.getEndIndex();++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i.itemAtIndex(r);!s||!e&&s.isNote()||a.push(s)}return a}getStartElement(){if(this._isValid&&!isNaN(this.getStartIndex()))return this.getPane().elementAtIndex(this.getStartIndex())}getEndElement(){if(this._isValid&&!isNaN(this.getEndIndex()))return this.getPane().elementAtIndex(this.getEndIndex())}setHovered(e,t,a){if(this.hoveredReactCell!==a){var i=this.hoveredItem;this.hoveredItem=t,this.hoveredReactCell=a,i&&i.itemChanged.notify(),t&&t.itemChanged.notify()}}isReactCellHovered(e){return this.hoveredReactCell===e}isItemHovered(e){return this.hoveredItem===e}fireKeyEvent(e,t,a){this.fireKeyEventInternal(e,"keydown",t),this.fireKeyEventInternal(e,"keypress",a||t),this.fireKeyEventInternal(e,"keyup",t)}fireKeyEventInternal(e,t,a){try{i.default.PAssert(295,void 0!==a,"Must pass in valid key data to type")}catch(s){i.default.reportError(s)}if(e||(e=this.getStartElement()),document.createEvent&&e){var r=document.createEvent("Event");r.normCode=a.normCode,r.shiftKey=!!a.shiftKey,r.altKey=!!a.altKey,r.ctrlKey=!!a.ctrlKey,r.metaKey=!!a.metaKey,r.synthetic=!0,r.initEvent(t,!0,!0),e.dispatchEvent(r)}else if(e)try{i.default.PAssert(296,!1,"Unable to fire key event")}catch(s){i.default.reportError(s)}else try{i.default.PAssert(297,!1,"No element available to fire key event on")}catch(s){i.default.reportError(s)}}fireClickEvent(e,t){this.fireClickEventInternal(e,"mousedown",t),this.fireClickEventInternal(e,"mouseup",t),this.fireClickEventInternal(e,"mouseclick",t)}fireClickEventInternal(e,t,a,r){try{i.default.PAssert(298,void 0!==a,"Must pass in a valid button to click with")}catch(o){i.default.reportError(o)}if(e||(e=h.default.getSelectionNode()),document.createEvent&&e){var s=document.createEvent("Event");if(s.button=a,s.synthetic=!0,r)for(var n in r)r.hasOwnProperty(n)&&(s[n]=r[n]);s.initEvent(t,!0,!0),e.dispatchEvent(s)}else if(e)try{i.default.PAssert(299,!1,"Unable to fire click event")}catch(o){i.default.reportError(o)}else try{i.default.PAssert(300,!1,"No element available to fire click event on")}catch(o){i.default.reportError(o)}}fireMouseUp(e,t){this.fireClickEventInternal(e,"mouseclick",t)}editNote(e){let t=i.default.focusedPane,a=this.getStartObject();if(e.isNote())this.selectIndex(this.getStartIndex(),0);else{e.hasNote()||(p.d.beginAction(),e.createNote(),p.d.endAction());let i=t.indexOfObject(a);setTimeout(()=>{this.selectIndex(i+1,0)},0)}}}},40:function(e,t,a){"use strict";var i=a(145);t.a=class{constructor(e){this._listeners=[],this._enabled=!0,e&&this._listeners.push(e)}listen(e){return this._addListener(e),new i.a(this,e)}_addListener(e){this._listeners.push(e)}_hasListener(e){return this._listeners.indexOf(e)>=0}unlisten(e){this._listeners.remove(e)}enable(){this._enabled=!0}disable(){this._enabled=!1}notify(...e){if(this._enabled)for(var t=0,a=0;a<this._listeners.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e.length>0?this._listeners[a](e[0]):this._listeners[a]()}}}},41:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(1),l=a(3),d=a(17),h=a(4),c=a(6),u=a(8);let p=(i=class{constructor(){this._batchTimeout=void 0,this.itemsBatchingUpdates={}}beginBatch(e,t){n.default.isEmpty(this.itemsBatchingUpdates)&&(!c.d.undoRedoActive&&t?(this._savedSelectionDrive=h.a.save(),h.a.reset()):this._savedSelectionDrive=void 0,this._batchTimeout=setTimeout(this._runUpdates,500)),this.itemsBatchingUpdates[e.id]||(this.itemsBatchingUpdates[e.id]={item:e})}commitBatch(e){var t=this.itemsBatchingUpdates[e.id];t&&(this._runUpdate(e,t),delete this.itemsBatchingUpdates[e.id])}itemItemsChanged(e){this.updateItem(e,o.a.ItemProp.Items)}itemTextChanged(e){this.updateItem(e,o.a.ItemProp.Text)}itemDateChanged(e){this.updateItem(e,o.a.ItemProp.Date)}itemTagsChanged(e,t){this.updateItem(e,o.a.ItemProp.Tags,t)}itemFontChanged(e){this.updateItem(e,o.a.ItemProp.Font)}itemSearchChanged(e){this.updateItem(e,o.a.ItemProp.Search)}updateItem(e,t,a){if(a=a||!0,this.itemsBatchingUpdates[e.id]){var i=this.itemsBatchingUpdates[e.id];i||(i=this.itemsBatchingUpdates[e.id]={item:e}),i[t]=a,this._batchTimeout&&clearTimeout(this._batchTimeout),this._batchTimeout=setTimeout(this._runUpdates,500)}else this._runUpdate(e,{item:e,[t]:a})}_runUpdate(e,t){d.a.fireEvent("clearMeasureCacheItem",[e.id]),!e.isDestroyed()&&e.getItemStore()&&e.getItemStore().onItemChanged(e,t)}_runUpdates(){n.default.batchRenderUpdates(()=>{for(var e in l.default.PaneUpdateBatcher.beginUpdateItems(),this.itemsBatchingUpdates)if(this.itemsBatchingUpdates.hasOwnProperty(e)){var t=this.itemsBatchingUpdates[e];this._runUpdate(t.item,t)}this.itemsBatchingUpdates={},l.default.PaneUpdateBatcher.commitUpdateItems(),this._savedSelectionDrive&&h.a.restore(this._savedSelectionDrive)})}},s()(i.prototype,"_runUpdate",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"_runUpdate"),i.prototype),s()(i.prototype,"_runUpdates",[u.a],Object.getOwnPropertyDescriptor(i.prototype,"_runUpdates"),i.prototype),i);t.a=new p},42:function(e,t,a){"use strict";var i=a(465);a(557),a(749),a(560);t.a=i},44:function(e,t,a){"use strict";var i=a(0),r=a(3),s=a(16),n=a(1),o=a(32),l=a(4);var d,h=class{constructor(){this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.repeatStart=["every"],this.dict=this.repeatStart.concat(this.softDays).concat(this.dayModifiers).concat(this.days).concat(this.months)}findMatchLike(e){for(var t=0,a=e.toLowerCase(),i=[],r=0;r<this.dict.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;0===this.dict[r].indexOf(a)&&i.push({type:"date",text:this.dict[r]})}return i}findMatchExact(e){if(this.dict.indexOf(e)>=0)return{type:"date",text:e}}},c=a(207),u=a(7),p=a.n(u),g=a(8);var f=new(d=class{constructor(){}findMatchLike(e,t,a){var r=e.toLowerCase(),s=[];return i.default.searchVMLIs({item:a,comparator:e=>!e.isComplete()&&!e.isDisplayComplete(),each:e=>{var a=!1;r?(e.getPrefix()+e.getSearchText()).indexOf(r)>=0&&(a=!0):a=e.isPrefixHeader();if((a=a&&(!e.els||!e.els[0]||!e.els[0].isMDImage()))&&s.push({type:"item",text:e.getParsedText(),item:e}),s.length>=t)return!1}}),s}findMatchExact(e,t){}getRNList(e,t,a){let i=[];return this.findMatchLike(e,t,a).forEach(e=>{i.push({type:"item",text:e.text,extraInfo:e.item})}),i}},p()(d.prototype,"getRNList",[g.a],Object.getOwnPropertyDescriptor(d.prototype,"getRNList"),d.prototype),d);var m=new class{constructor(){this.accountID=void 0}setAccountID(e){this.accountID=e}findMatchLike(e,t){for(var a=0,i=r.default.pluginManager.getPluginGmail(),s=i.getLabels(this.accountID,e,t),o=[],l=0;l<s.length;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;s[l].isSystemLabel()||o.insertSorted(s[l],i.labelSortFn)}return o.map(function(e){return{type:n.a.AutocompleteMode.GmailLabel,text:e.getName(),label:e}})}findMatchExact(e,t){}},v=a(47),y=a(13);t.a=new class{constructor(){this.matches=new o.a,this._isShowing=!1,this._isTempDisabled=!1,this._showNoMatches=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[n.a.ContactPrefix,n.a.TagPrefix,n.a.PrefixItemAutocomplete],this._prefixMap={},this.autocompleteDates=new h,this._prefixMap[n.a.ContactPrefix]=v.a,this._prefixMap[n.a.TagPrefix]=c.a,this._prefixMap[n.a.PrefixItemAutocomplete]=f,s.a.binder(this,"onClosed","onSelectedFromPane"),this.supportedModes=null}isShowing(){return this._isShowing}getText(){return this.text}getProviderForPrefix(e){return this._prefixMap[e]}_checkPrefixes(e,t){for(var a=0,i=e.startsWith("-")?1:0,r=0;r<this._prefixes.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._prefixes[r];if((s!==n.a.PrefixItemAutocomplete||t)&&e[i]===s)return{length:i+1,prefix:s}}}_findClosestWithPrefix(e,t,a,r){for(var s,o=0,l=e.split(/ /),d=0,h=-1,c=-1,u=-1,p=0,g=0;g<l.length&&d<=t;++g){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var f=l[g],m=f.replace(/[\*_]+$/,"");l[h]===s&&(p=0);var v=this._checkPrefixes(m,r.canAutocompleteItems);v?(h=g,u=(c=d)+f.length,p=v.length,s=v.prefix):p&&s!==n.a.TagPrefix&&(u+=f.length+1),d+=f.length+1}if(p&&t>=c&&t<=u){var y=e.substr(c+p,u-c-p);return i.default.shouldLog(n.a.LogLevels.Autocomplete)&&i.default.log("closest is",s,"--",y),{mode:a,text:e,prefix:s,searchText:y,start:c+p,end:u}}}_findClosestDelimited(e,t,a){var r,s=0;r=a===n.a.AutocompleteMode.Item?[e]:e.split(",");for(var o=!1,l=0,d=-1,h=-1,c=0;c<r.length&&l<=t;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=r[c];d=l+this._numStartSpaces(u),h=l+u.length-this._numEndSpaces(u),d<t&&t<=h&&u.length>0?(o=!0,i.default.shouldLog(n.a.LogLevels.Autocomplete)&&i.default.log("phrase",u,u.length),i.default.shouldLog(n.a.LogLevels.Autocomplete)&&i.default.log("start char",d,e[d]),i.default.shouldLog(n.a.LogLevels.Autocomplete)&&i.default.log("end char",h,e[h])):o=!1,l+=u.length+1}if(o||this._showNoMatches){var p=e.substr(d,h-d+1);return i.default.shouldLog(n.a.LogLevels.Autocomplete)&&i.default.log("closest is",p),{mode:a,text:e,searchText:p,start:d,end:h}}}_findClosestVMLIElement(e,t,a,i){for(var r,s,n,o=0,l=0,d=!1,h=0;h<t.length&&!1===d;h++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=t[h].getParsedText();if(r=l+this._numStartSpaces(c),s=l+c.length-1-this._numEndSpaces(c),r<a&&a<=s+1&&c.length>0){d=h,n=c.trim();break}l+=c.length}if(!1!==d)return{mode:i,text:e,prefix:"",searchText:n,start:r,end:s,el:t[h]}}_numStartSpaces(e){for(var t=0,a=0,i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[i])break;a++}return a}_numEndSpaces(e){for(var t=0,a=0,i=e.length-1;i>=0;i--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[i])break;a++}return a}insertMatch(e){var t=this._searchInfo,a=t.text,r=a.substr(0,t.start),s=a.substr(t.end,a.length),o=t.start+e.length;" "!==s[0]&&e&&" "!==e[e.length-1]&&(e+=" ",o++);var l=r+e+s;return i.default.shouldLog(n.a.LogLevels.Autocomplete)&&i.default.log(r,r.length,s,s.length),i.default.shouldLog(n.a.LogLevels.Autocomplete)&&i.default.log(l),{text:l,offset:o}}onSelectedFromPane(e){e.owner.setText(e.value,n.a.ChangeType.Local),l.a.selectIndex(e.index,e.offset)}prefixForMode(e){return"contact"===e&&n.a.ContactPrefix||"tag"===e&&n.a.TagPrefix||void 0}startMobileAutocomplete(e){var t=e.mode,a=this.prefixForMode(t),i="date"===t?"Enter date":"Search "+t.capitalize()+"s";this.showPopup({mode:t,text:i,allowCustom:"date"===t,buttonText:"Add",pane:e.pane,onSelected:t=>{var i=e.owner;if(i){var r=i.getParsedText();r=r+(r.endsWith(" ")?"":" ")+a+t.value,i.setText(r,n.a.ChangeType.Local),l.a.selectIndex(e.index,r.length)}}})}updateFromPane(e){var t=e.owner.getParsedText()||"";if(!(e.start<=1)||"#"!==t&&"+"!==t){var a=e.element.getBoundingClientRect(),i=r.default.Measure.getCaretScreenPosition(e.pane,e.index,e.start);this.update({mode:"all",text:t,pane:e.pane,offset:e.start,owner:e.owner,item:e.owner,positionOffset:{left:i.left-a.left,top:0},fromPane:!0,indexInPane:e.index,elementDisplay:e.element,position:void 0,onSelected:this.onSelectedFromPane})}}update(e){var{text:t,offset:a,mode:s}=e;let o=e.item;if(e.owner===this.owner&&e.elementInput===this.elementInput||(this._isTempDisabled=!1),e.showNoMatches&&(this._showNoMatches=!0),this.text=e.text,this._isTempDisabled||!e.text&&!this._showNoMatches)this.matches.set([]),this._showNoMatches||this.hide();else{this.owner=e.owner,this.elementInput=e.elementInput;var t=e.text,l=null,d=null;if(this._searchInfo="all"===s?this._findClosestWithPrefix(t,e.offset,e.mode,e):this._findClosestDelimited(t,e.offset,e.mode),this._searchInfo){if(this.text=this._searchInfo.searchText,"all"===s)d=this.getProviderForPrefix(this._searchInfo.prefix);else switch(s){case n.a.AutocompleteMode.Move:case n.a.AutocompleteMode.Jump:case n.a.AutocompleteMode.Item:d=f;break;case n.a.AutocompleteMode.Email:l=(d=this._prefixMap[n.a.ContactPrefix]).findEmailsLike(this._searchInfo.searchText.trim(),100);break;case n.a.AutocompleteMode.Contact:d=this._prefixMap[n.a.ContactPrefix];break;case n.a.AutocompleteMode.Tag:d=this._prefixMap[n.a.TagPrefix];break;case n.a.AutocompleteMode.Date:case n.a.AutocompleteMode.Snooze:d=this.autocompleteDates;break;case n.a.AutocompleteMode.GmailLabel:var h=r.default.pluginManager.getPluginGmail()._getAccountIDFromItem(e.item);(d=m).setAccountID(h);break;default:try{i.default.PAssert(14,!1,"Unknown autocomplete mode: ",s)}catch(c){i.default.reportError(c)}}if(null===l){let t,a=e.pane;t=a&&a.type===n.a.PaneMode.Task?a.getRootItem():e.item?e.item:y.a.getDefaultDocument().getRootItem(),l=d.findMatchLike(this._searchInfo.searchText,100,t)}1===l.length&&d.findMatchExact(this._searchInfo.searchText,l)&&(l=[])}this._searchInfo&&0!==l.length||!o||o.getRawText().includes(n.a.CharDate)||t[a-1]!==n.a.PrefixDate||!(a<2||" "===t[a-2]||t[a-2]===n.a.AttachChar)||t[a]&&" "!==t[a]&&t[a]!==n.a.AttachChar||r.default.menus.openContextMenu(Object.assign({componentName:"ReactContextMenuDate",item:e.item,textOffset:e.offset,element:e.elementDisplay,onClosed:()=>{let t=e.owner&&e.owner.onDatePickerClosed;t&&t()}},e)),l=l||[],e.supportSearchItemAutocomplete&&"all"===s&&0===l.length&&e.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(t,e.parsedEls,e.offset,s)),this.matches.set(l),!this._isShowing&&l.length>0&&!this._isTempDisabled&&!e.noShow?this.show(e):0===l.length&&(this._showNoMatches||this.hide(),this._isTempDisabled=!1)}}clearDisabled(){this._isTempDisabled=!1}onClosed(){this._isShowing=!1,this._owner=null,this.matches.clear()}show(e){this._isShowing=!0,this._showNoMatches=!!e._showNoMatches,this._owner=e.owner,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,r.default.menus.openContextMenu(e,!1)}showPopup(e){this._isShowing=!0,this._showNoMatches=!0,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,r.default.menus.openContextMenu(e)}hide(){this._isShowing&&(this._isShowing=!1,r.default.menus.closeContextMenu("ReactAutocomplete"))}}},451:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(5),o=a(2),l=a.n(o),d=a(15),h=a(19),c=a(14),u=a(151);const p=36,g=/(^|\s|&nbsp;|<div>|<span>|<p>)((?:(?:((https?|ftps?):\/\/)|www)[^"<\s]+)(?![^<>]*>|[^"]*?<\/a))/gi,f=[r.a.KeyCode.LeftArrow,r.a.KeyCode.RightArrow,r.a.KeyCode.UpArrow,r.a.KeyCode.DownArrow,r.a.KeyCode.Enter,r.a.KeyCode.Escape,r.a.KeyCode.PageUp,r.a.KeyCode.PageDown];t.a=class extends d.a{init(){this.createObservables({isFocused:this.props.focused||!1})}onMount(){var e=this.props;if(e.value){var t=this.replaceHTMLLinks(e.value.replace(/\r?\n/g,"<br>"));this.setValue(t)}e.focused&&requestAnimationFrame(()=>{this.refs.div&&this.refs.div.focus()})}onUnmount(){this.isFocused.get()&&this.onBlur()}focus(){i.default.isDemoRunning||this.refs.div.focus()}blur(){this.refs.div.blur()}setValue(e){this.refs.div.innerHTML=e}getValue(){return this.refs.div.textContent.length>0?this.refs.div.innerHTML:""}getTextValue(){return this.refs.div.textContent}getElement(){return this.refs.div}insertCharAtIndex(e,t){var a=this.refs.div,i=a.innerHTML;i=i.substr(0,t)+e+i.substr(t,i.length),a.innerHTML=i,h.default.selectElement(a,t+1),this.props.onChange&&this.props.onChange()}onFocus(e){i.default.activeInput.set(this),this.isFocused.set(!0),this.props.onFocus&&this.props.onFocus(e)}onBlur(e){i.default.activeInput.set(null),this.isFocused.set(!1),this.props.onBlur&&this.props.onBlur(e)}hasFocus(){return this.isFocused.get()}onEscapeKey(){this.props.onEscape&&this.props.onEscape()}onDrop(e){this.props.onDrop&&this.props.onDrop(e.dataTransfer)}onDragEnter(){this.props.onDrop&&i.default.addClass(this.refs.div,"dragTarget")}onDragLeave(){this.props.onDrop&&i.default.removeClass(this.refs.div,"dragTarget")}onKeyDown(e){if(n.a.mac&&e.metaKey||!n.a.mac&&e.ctrlKey)e.keyCode===r.a.KeyCode.U?this.onClickToolbarButton("underline"):e.keyCode===r.a.KeyCode.K?this.insertLink({target:this.refs.link.getElement()}):e.keyCode===r.a.KeyCode.H?(this.makeHeading(),i.default.preventDefault(e)):e.keyCode===r.a.KeyCode.V&&(this.__pasteWithShift=e.shiftKey);else if(!f.includes(e.keyCode)){var t=h.default._getSelectionRange();if(t){var a=t.startContainer,s=a.parentElement;"A"===s.nodeName&&s.textContent===s.getAttribute("href")&&t.startOffset===t.endOffset&&t.startOffset===s.textContent.length&&(s.replaceWith(a),h.default.selectAfterNode(a))}}this.props.onKeyDown&&this.props.onKeyDown(e)}insertNode(e){this.focus(),h.default.deleteRangeContents(),h.default.insertNode(e),h.default.selectAfterNode(e)}insertLink(e){var t=h.default.getSelectedText(),a=e.target;this.savedSel=h.default.getSelectionRange(),s.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:a,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:t})}onInsertLinkClosed(){this.savedSel&&(this.focus(),h.default.setSelectionRange(this.savedSel))}onInsertLink(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.insertNode(t)}makeHeading(e){for(var t,a,i=0,r=window.getSelection(),s=r.rangeCount;s--;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r.getRangeAt(s),o=n.startContainer,l=n.startContainer.parentElement,d=h.default.getSelectOffsetsInElement(this.refs.div,n);if("H2"===l.nodeName)a=void 0,l.parentElement.replaceChild(o,l),h.default.selectElement(o,0,o.textContent.length);else if(d){if(!e&&d.start===d.end)return h.default.selectElement(o,0,o.textContent.length),this.makeHeading(!0);(a=document.createElement("h2")).appendChild(n.extractContents()),n.insertNode(a),t=a.textContent.length}}a&&t&&h.default.selectElement(a,0,t)}onClickToolbarButton(e,t){i.default.isString(e)?"heading"===e?this.makeHeading():document.execCommand(e):e(t),i.default.preventAndStop(t)}onClick(e){"A"===e.target.nodeName?i.default.openUrl(e.target.href):this.props.onClick&&this.props.onClick(e)}onPaste(e){if(this.__pasteWithShift){var t=document.queryCommandSupported("insertText"),a=document.queryCommandSupported("paste");if(t||a){e.preventDefault();var i="";e.clipboardData||e.originalEvent.clipboardData?i=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(i=window.clipboardData.getData("Text")),i=i.trim();var r=t?"insertText":"paste";document.execCommand(r,!1,i)}}}replaceHTMLLinks(e){return e.replace(g,(e,t,a)=>t+'<a href="'+a+'">'+a+"</a>")}onSetColor(e){document.execCommand("forecolor",!1,e)}onChange(e){var t=e.target.innerHTML,a=this.replaceHTMLLinks(t);if(t!==a){var i=h.default._getSelectionRange(),r={start:0,end:0};i&&(r=h.default.getSelectOffsetsInElement(e.target,i)),e.target.innerHTML=a,h.default.selectElement(e.target,r.start,r.end)}this.props.onChange&&this.props.onChange(e)}renderToolbarButton(e,t,a,i,r,s){const o=n.a.priModKey;return r="Escape"===r?r:o+" + "+r,l.a.createElement(c.a,{className:"button_"+i,icon:e,width:p,height:p,iconSize:t,onClick:this.onClickToolbarButton.bind(this,a),tooltip:i,tooltipHotkey:r,ref:s})}render(){var e,t=this.props,a=i.default.classNames("fancyContenteditableWrapper flexbox flexvert",t.className),r=i.default.classNames("fancyContenteditable f1 c-background",{richText:t.richText}),s=!!t.spellCheck||null;return t.richText&&(e=l.a.createElement("div",{className:"fancyContenteditableToolbar c-bg-faded c-border-light"},this.renderToolbarButton("icon-format_bold",19,"bold","Bold","B"),this.renderToolbarButton("icon-format_italic",19,"italic","Italic","I"),this.renderToolbarButton("icon-format_underlined",18,"underline","Underline","U"),this.renderToolbarButton("icon-header",14,"heading","Heading","H","H1"),l.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),this.renderToolbarButton("icon-numlist",14,"insertOrderedList","Numbered list","L"),this.renderToolbarButton("icon-bullet",26,"insertUnorderedList","Bulleted list","Option + L"),l.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),l.a.createElement(u.a,{color:"#000000",onChange:this.onSetColor,style:{marginTop:11,verticalAlign:"top"}}),this.renderToolbarButton("icon-link",18,this.insertLink,"Link","K","link"),t.onClickClose&&this.renderToolbarButton("icon-close",18,t.onClickClose,"Close","Escape"))),l.a.createElement("div",{className:a},e,l.a.createElement("div",{contentEditable:!1!==t.editable,className:r,style:this.props.style,ref:"div",spellCheck:s,onInput:this.onChange,onClick:this.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onPaste:this.onPaste,tabIndex:t.tabIndex}))}}},452:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(2),o=a(15),l=a(52),d=a(142),h=a(64),c=o.b.createClass({displayName:"ReactSearchFilters",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.DISABLE_LISTENER_ASSERT=!0},getState:function(e){for(var t=0,a=e.pane,i=a.search,r={hasFilter:!1,showHelp:s.default.settings.shouldShowHelp("searchHelp"),viewState:a.viewState,viewMode:a.getViewMode(),sortModeBlocks:a.supportsSortBlocks()&&a.getSortModeBlocks(),sortModeItems:a.supportsSortItems()&&a.getSortModeItems(),calendars:l.a.GCalendarsAvailable,displayCalendars:a.displayCalendars,displayLocalItems:a.displayLocalItems,closedHelps:s.default.settings.closedHelps},n=0;n<i.filters.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=i.filters[n];r[o.name]=o.value,r[o.name+"Enabled"]=o.enabled,0!==o.value.get()&&(r.hasFilter=!0)}return r},onMount:function(){this.listenTo(this.props.pane.search.onChanged)},componentWillReceiveProps:function(e){e.pane!==this.props.pane&&(this.refreshListeners(e),this.updateState(e))},onClickSelectCalendars:function(e){s.default.menus.openContextMenu({componentName:"ReactContextMenuCalendars",element:e.target,pane:this.props.pane})},saveScrollOfTop:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)},onToggleButton:function(e){this.saveScrollOfTop(),this.props.pane.search.toggleFilter(e)},setPriority:function(e){this.saveScrollOfTop();var t=this.props.pane.search;t.getFilterValue("priority")===e&&(e=0),t.setFilter("priority",e)},onClickCloseHelp:function(){s.default.settings.closeHelp("searchHelp")},onClickShowHelp:function(){s.default.settings.uncloseHelp("searchHelp")},renderSearchButton:function(e){var t=this.props.pane,a="showOnlyMatches"===e.name&&t.isViewFlatList()?1:e.value.get();return n.createElement(d.a,{key:e.name,filter:e,filterValue:a,search:t.search,paneViewMode:t.getViewMode(),hasBorder:!0})},renderSearchPriority:function(){var e=this.props.pane.search.filter_priority.value.get(),t=i.default.classNames("searchPriorities c-border-light",{hasSelected:!!e}),a=i.default.classNames("searchPriority searchP0",{selected:e===r.a.VMLIFlag.P0}),s=i.default.classNames("searchPriority searchP1",{selected:e===r.a.VMLIFlag.P1}),o=i.default.classNames("searchPriority searchP2",{selected:e===r.a.VMLIFlag.P2});return n.createElement("span",{key:"priority",className:t},n.createElement("span",{className:a,"data-tooltip":"Show only high priority",onClick:this.setPriority.bind(this,r.a.VMLIFlag.P0)}),n.createElement("span",{className:s,"data-tooltip":"Show medium priority and higher",onClick:this.setPriority.bind(this,r.a.VMLIFlag.P1)}),n.createElement("span",{className:o,"data-tooltip":"Show low priority and higher",onClick:this.setPriority.bind(this,r.a.VMLIFlag.P2)}))},render:function(){for(var e=0,t=this.state,a=this.props.pane,r=a.search,s=t.showHelp,o=[],l=[],d=i.default.classNames("filterSection flexbox",{showHelp:s}),c=0;c<r.filters.length;c++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var u=r.filters[c];u.enabled.get()&&(u.isOption?l.push(this.renderSearchButton(u)):u.icon?o.push(this.renderSearchButton(u)):"priority"===u.name&&o.push(this.renderSearchPriority()))}if(a.isViewDates()){var p=a.isCalFilterActive(),g=i.default.classNames("buttonCalendars searchButton icon-calendar c-border-light c-button",{selected:p});l.push(n.createElement("div",{key:"calendars",className:g,onClick:this.onClickSelectCalendars,"data-tooltip":"Select calendars to display in this pane"}))}return n.createElement("div",{className:d},o.length>0&&n.createElement("div",null,s&&n.createElement(h.a,null,"Filters"),n.createElement("div",{className:"searchFilters c-border-light"},o)),l.length>0&&n.createElement("div",null,s&&n.createElement(h.a,null,"Options"),n.createElement("div",{className:"searchFilters c-border-light"},l)))}});t.a=c},46:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(13),o=a(16),l=r.a.TaskSortMode;var d=class{constructor(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.id=e.id,this.text=e.name,this.search=this.pane.search,this.items=[],this.numInstancesOfItem={},o.a.binder(this,"toggleCollapsed","heightOfHeader","compareItemsAgenda","compareItemsCreated","compareItemsCompleted");try{i.default.PAssert(1009,this.id,"Added an agenda block without an id")}catch(a){i.default.reportError(a)}}shouldShowTime(){return!this.isOverdue&&this.isDate}heightOfHeader(){return 32}heightOfSpaceBetween(){return 16}heightOfAddButton(){return this.heightOfHeader()+this.heightOfSpaceBetween()}numItems(){return this.items.length}getLastItem(){var e=this.items[this.items.length-1];return e&&e.isNote()&&(e=e.parent()),e}comparePriority(e,t){var a=e.getPriority(),i=t.getPriority();return a>i?-1:a<i?1:0}compareDate(e,t){try{i.default.PAssert(1010,this.date,"This block does not have a date",this.text)}catch(h){i.default.reportError(h)}var a=this.pane,r=e.getDate(a)||e.getNextDate(),s=t.getDate(a)||t.getNextDate();if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(r&&!s)return-1;if(!r&&s)return 1;if(!r&&!s)return 0;if(e.getDuration(a)>0){let t=e.getDisplayDateWithDuration(this.date);t&&(r=t)}if(t.getDuration(a)>0){let e=t.getDisplayDateWithDuration(this.date);e&&(s=e)}var n=r.clone().clearTime(),o=s.clone().clearTime();if(!n.equals(o))return n<o?-1:1;if(r.hasTimeOfDay()&&s.hasTimeOfDay()){var l=r.getTimeOfDay(),d=s.getTimeOfDay();return l===d?0:l<d?-1:1}return r.hasTimeOfDay()?1:s.hasTimeOfDay()?-1:0}compareOrder(e,t){return e.index-t.index}compareItemsAgenda(e,t){var a=e.item,r=t.item;i.default.DAssert(a,"Must have a valid left item to compare"),i.default.DAssert(r,"Must have a valid right item to compare"),i.default.DAssert(!a||a.parent(),"Must have a valid left parent item"),i.default.DAssert(!r||r.parent(),"Must have a valid right parent item"),a.isNote()&&(a=a.parent()),r.isNote()&&(r=r.parent());var s=this.isStarred||this.isImportant?0:this.compareDate(a,r);if(0===s){var n=this.isStarred?0:this.comparePriority(a,r);return 0===n?this.compareOrder(e,t):n}return s}compareItemsCreated(e,t){return this.pane.compareDate(e.dateCreated,t.dateCreated)}compareItemsCompleted(e,t){return this.pane.compareDate(e.dateCompleted,t.dateCompleted)}addItem(e){try{i.default.PAssert(1011,e&&i.default.isVMLI(e),"Must be adding a valid item: "+i.default.getObjectInfo(e))}catch(t){i.default.reportError(t)}this.items.indexOf(e)<0&&this.items.push(e)}toggleCollapsed(){this.pane.setBlockCollapsed(this,!this.isCollapsed())}isCollapsed(){return this.pane.isBlockCollapsed(this)}getItemID(e){var t=this.numInstancesOfItem[e.id]||0;return this.numInstancesOfItem[e.id]=t+1,e.id+"_"+this.id+(t?"_"+t:"")}sort(){var e;if(this.pane.isViewAgenda()){var t=this.pane.getSortModeBlocks();t===l.Date?e=this.compareItemsAgenda:t===l.Created?e=this.compareItemsCreated:t===l.Completed&&(e=this.compareItemsCompleted)}else this.pane.isViewCalendarMonth()?e=this.compareItemsAgenda:this.sortMode&&this.sortMode!==l.None&&(e=this.pane.getItemComparator());if(e){var a=this.items.map((e,t)=>({item:e,index:t}));a.sort(e),this.items=a.map(e=>e.item)}}},h=a(107),c=a(9),u=a(17),p=a(4),g=a(6),f=a(62),m=r.a.TaskViewMode,v=r.a.TaskSortMode,y=50,_="__block_nokey",S={};S[m.Groups_Project]={Default:v.None,Available:[v.None,v.Alphabetical,v.NumItems,v.Date,v.Priority,v.Created]},S[m.Groups_Tag]=S[m.Groups_Contact]={Default:v.Alphabetical,Available:[v.Alphabetical,v.NumItems]},S[m.Agenda_Today]=S[m.Agenda_Week]=S[m.Agenda_All]={Default:v.Date,Available:[v.Date,v.Created,v.Completed]};class P extends h.a{constructor(e){s.default.pluginManager.getPlugin(r.a.PluginID.GCalendar).isActive()&&i.default.isDemoMode();e.document||(e.document=n.a.getDefaultDocument());super(e,{isWriteable:!0,hasNonVMLIs:!0,supportCollapsing:!0,supportCompleting:!0,supportIndent:!1,supportOffline:!0,supportMenuIcon:!0,supportViewMenu:!0,supportMultiselect:!1,supportClickOverviewScroll:!1,isDraggable:!0,overviewTracksScroll:!1,overviewCanTrackScroll:!0,combineOverdue:!0,searchFilters:["project","task","starred","complete","priority","showOnlyMatches","showOnlyAgendaDates","showOnlyMatchingTags","showChildProjects"]}),this.type=r.a.PaneMode.Task,this.paneClass="paneTask",o.a.binder(this,"getDayWidth","updateAllDay","scrollToToday","openViewMenu","setViewMode","compareBlockDate","compareBlockName","compareBlockItemPriority","compareBlockItemCreated","compareItemDate","compareItemName","_itemSearchComparator","onScroll","checkFlatListMode","addFnProject","addFnTag","addFnDate","onGCalendarActiveChanged","onGmailActiveChanged","onCalendarCustomDaysChanged","switchToOutline","onViewStateChanged","_onSelectionChanged"),this.dragHoveredBlock=new c.a;var t=e.viewState||{};t.viewMode=t.viewMode||m.Groups_Project,t.sortModeBlocks=t.sortModeBlocks||{mode:v.None},t.sortModeItems=t.sortModeItems||{mode:v.None},i.default.isString(t.sortModeBlocks)&&(t.sortModeBlocks={mode:t.sortModeBlocks}),i.default.isString(t.sortModeItems)&&(t.sortModeItems={mode:t.sortModeItems}),this.viewState=new c.a(t,this.onViewStateChanged),this.item.get()||this.item.set(this.getDefaultDisplayItem()),this._allPaneItems=[],this._isViewHelper={},this.topBoxHeight.set(0,!1),this.blocksCollapsed=new c.a(e.blocksCollapsed||{[_+"_"+m.Groups_Project]:!0,[_+"_"+m.Groups_Tag]:!0,[_+"_"+m.Groups_Contact]:!0,[_+"_"+m.Groups_Priority]:!0}),this.search.getFilterObs("showOnlyMatches").listen(this.checkFlatListMode),this.dropEffect=e=>{var t=r.a.DropEffect.Move;return this.isCalendarItem(e)&&(t=r.a.DropEffect.Copy),t},this.displayLocalItems=new c.a(void 0===e.displayLocalItems||e.displayLocalItems),this.displayCalendars=new c.a(e.displayCalendars||{}),this.numAllDay=new c.a(0),this.setupViewState(),this.initBlocks()}initBlocks(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForItem=void 0,this.itemAnimationTimeout=void 0;var e=s.default.pluginManager.getPlugin(r.a.PluginID.GCalendar);e.isActive()&&this.useItemStore(e.getDefaultItemStore());var t=s.default.pluginManager.getPlugin(r.a.PluginID.Gmail);t.isActive()&&this.useItemStore(t.getDefaultItemStore()),s.default.pluginManager.listen("pluginActiveChanged",r.a.PluginID.GCalendar,this.onGCalendarActiveChanged),s.default.pluginManager.listen("pluginActiveChanged",r.a.PluginID.Gmail,this.onGmailActiveChanged),u.a.listen("selectionChanged",this._onSelectionChanged),s.default.settings.dayWeekStart.listen(this.scrollToToday),s.default.settings.calendarCustomDays.listen(this.onCalendarCustomDaysChanged),s.default.pluginManager.getPluginGCalendar().onCalendarsSynced.listen(this.updateItems)}destroy(){s.default.pluginManager.unlisten("pluginActiveChanged",r.a.PluginID.GCalendar,this.onGCalendarActiveChanged),s.default.pluginManager.unlisten("pluginActiveChanged",r.a.PluginID.Gmail,this.onGmailActiveChanged),u.a.unlisten("selectionChanged",this._onSelectionChanged),s.default.settings.dayWeekStart.unlisten(this.scrollToToday),s.default.settings.calendarCustomDays.unlisten(this.onCalendarCustomDaysChanged),s.default.pluginManager.getPluginGCalendar().onCalendarsSynced.unlisten(this.updateItems),this._onAfterLoadedRAF||this.removeScrollListener(this.onScroll),super.destroy()}getPaneIcon(){return this.isViewAgenda()?"today":"format_list_bulleted"}keydown(e){return p.a.isValid()&&p.a.getStartIndex()===p.a.getEndIndex()&&!g.d.undoRedoActive&&(this.preventUpdateItemsForItem=p.a.getStartObject(),this.search.stickMatch(p.a.getStartObject())),super.keydown(e)}handleLeftSideTap(e,t){return this.clearPreventUpdate(),super.handleLeftSideTap(e,t)}clearPreventUpdate(){var e=this.preventUpdateItemsForItem;if(e&&s.default.DragDrop.isDragging){var t=()=>{u.a.unlisten("endDrag",t),this.clearPreventUpdate()};u.a.listen("endDrag",t)}else{var a=!1;e&&(a=a||this.search.unstickMatch(e),this.preventUpdateItemsForItem=void 0),a&&(this.setItemsDirty(),s.default.PaneUpdateBatcher.updateAllItems())}}_onSelectionChanged(e){p.a.getPane()===this&&this.preventUpdateItemsForItem&&!g.d.undoRedoActive?p.a.isValid()?p.a.getStartObject().id!==this.preventUpdateItemsForItem.id&&(s.default.PaneUpdateBatcher.beginUpdateItems(),this.clearPreventUpdate(),i.default.setItemAnimationMode(r.a.ItemAnimationMode.Move),s.default.PaneUpdateBatcher.updateAllItems(),e&&this.restoreSelection(e),clearTimeout(this.itemAnimationTimeout),this.itemAnimationTimeout=setTimeout(function(){i.default.resetItemAnimationMode()},300),s.default.PaneUpdateBatcher.commitUpdateItems()):(this.clearPreventUpdate(),this.updateItems()):this.clearPreventUpdate()}isCalendarItem(e){return e.belongsToItemStore(s.default.pluginManager.getPlugin(r.a.PluginID.GCalendar).getDefaultItemStore())}isEmailItem(e){return e.belongsToItemStore(s.default.pluginManager.getPlugin(r.a.PluginID.Gmail).getDefaultItemStore())}_itemSearchComparator(e){var t=this.search.isMatched(e)||e.isNote()&&this.search.isMatched(e.parent()),a=!1,i=!1;if(this.isCalendarItem(e)){let t=e.getAttachmentByPlugin(r.a.PluginID.GCalendar);t&&("cancelled"===t.getField("status")?i=!0:t.forEachItem(void 0,e=>{e.belongsToItemStore(t.getPlugin().getDefaultItemStore())||e.getDocumentOwner()!==this.getDocument()||(a=!0)}))}else if(this.isEmailItem(e)){var n=e.getAttachmentByPlugin(r.a.PluginID.Gmail);if(n){var o=s.default.pluginManager.getPluginGmail();if(o.isItemArchived(e))t=!1;else o.getAttachmentPriority(n)!==r.a.VMLIFlag.None&&(t=!0)}}return t&&!a&&!i}getItemSearchParams(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.getItem(),comparator:this._itemSearchComparator,noCollapsed:this.isViewOutline(),includeNotes:!0,pane:this}}_setItems(e,t){this.updateBlockItems()}onLoad(){isNaN(this.initialOffset)&&this.isViewDates()&&(this.initialOffset=this.getScrollOffsetOfToday(),this._infiniteList.setInitialScrollOffset(this.initialOffset)),super.onLoad()}onAfterLoaded(){this.orientation.get()===r.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY()),this.setIgnoreRestoreScroll(),super.onAfterLoaded(),this.addScrollListener(this.onScroll)}getScrollOffsetOfToday(){var e;this.getViewMode();if(this.isViewCalendarMonth()){let t=this.getWeekStart(new Date);e=this.heightWeek()*this.items.get().findIndex(e=>e.date.equals(t))}else if(this.isViewCalendarHoriz())e=this.getDayWidth()*r.a.CalendarDayViewNumDaysPad+1;else if(this.isViewAgenda())for(var t=0,a=this.items.get(),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[i];if((s.isOverdue||s.isToday)&&"blockHeader"===s.type){e=this.topOfIndex(i)-16;break}}return e}_getDateInMiddle(){var e=(new Date).clearTime(),t=this.getViewMode();return t===m.Calendar_Month?e=this.getMonthStart(e):t===m.Calendar_Week&&(e=this.getWeekStart(e)),e}scrollToTop(e){this.isViewDates()?this.scrollToToday(e):super.scrollToTop(e)}scrollToToday(e){var t=this.getScrollOffsetOfToday();e=isNaN(e)?r.a.ScrollDuration.Default:e,this.setIgnoreRestoreScroll(e+100),this.setScrollOffset(t,e),this.orientation.get()===r.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY(),this.scrollElement.scrollTop=0)}weekCount(e,t,a){var i=new Date(e,t,1),r=a?new Date(e,t,a):new Date(e,t+1,0),s=i.getDay()+r.getDate();return Math.ceil(s/7)}scrollJump(e,t){t=isNaN(t)?r.a.ScrollDuration.Default:t;var a,i,n=this.getViewMode(),o=this._infiniteList.getScrollOffset(),l=this._infiniteList.indexOfTop(),d=this._infiniteList.objectAtIndex(l),h=o-this.topOfIndex(l);if(n===m.Calendar_Month){var c=d.date;if(e<0){var u=c.clone().addMonths(-1);a=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,i=this.weekCount(u.getFullYear(),u.getMonth()),o-=this.heightWeek()*(i+a)+h}else i=this.weekCount(c.getFullYear(),c.getMonth()),a=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,o+=this.heightWeek()*(i-a)-h}else if(n===m.Calendar_Custom){var p=s.default.settings.calendarCustomDays.get();o+=this.getDayWidth()*p*e-h+1}else if(n===m.Calendar_Week){var g,f=d.date.getDay(),v=s.default.settings.dayWeekStart.get();g=e<0?f>v?-f+v:-7:7-f+v,o+=this.getDayWidth()*g-h+1}else n===m.Calendar_Day&&(e<0&&h>200?o-=h:o+=this.getDayWidth()*e-h+1);this.setIgnoreRestoreScroll(),this.setScrollOffset(o,t)}compareDate(e,t){return e||t?e?t?e.compareTo(t):-1:1:0}compareText(e,t){return e.localeCompare(t)}comparePriority(e,t){var a=e.getPriority(this),i=t.getPriority(this);return i>a?1:i<a?-1:0}compareBlockBase(e,t,a){try{i.default.PAssert(769,e,"Comparator was invalid")}catch(l){i.default.reportError(l)}var r,s=this.getSortOrderBlocks()||1;if(e&&(r=this.compareNoKey(t,a)*s||e(t,a)),0===r||void 0===r){var n=S[this.getViewMode()].Default,o=this._getBlockSortComparator(n);if(o!==e)return o(t,a)}return r*s}compareBlockPriority(e,t){return t.priority-e.priority}compareNoKey(e,t){return e.id===this.blockNoKey?1:t.id===this.blockNoKey?-1:void 0}compareNone(e,t){return e.originalIndex-t.originalIndex}compareBlockDate(e,t){return this.compareDate(e.date,t.date)}compareBlockName(e,t){return this.compareText(e.name,t.name)}compareBlockNumItems(e,t){return t.items.length-e.items.length}compareBlockItemPriority(e,t){return this.comparePriority(e.item,t.item)}compareBlockItemCreated(e,t){return this.compareDate(e.item.dateCreated,t.item.dateCreated)}_getBlockSortComparator(e){return e===v.Alphabetical&&this.compareBlockName||e===v.Date&&this.compareBlockDate||e===v.NumItems&&this.compareBlockNumItems||e===v.Priority&&this.compareBlockItemPriority||e===v.Created&&this.compareBlockItemCreated||e===v.None&&this.compareNone}getBlockComparator(){var e=this.getSortModeBlocks();return this.compareBlockBase.bind(this,this._getBlockSortComparator(e))}compareItemBase(e,t,a){try{i.default.PAssert(770,e,"Comparator was invalid")}catch(n){i.default.reportError(n)}var r,s=this.getSortOrderItems();return e&&(r=e(t,a)*s),0===r||void 0===r?this.compareItemNone(t,a):r}compareItemNone(e,t){return e.index-t.index}compareItemDate(e,t){return this.compareDate(e.item.getDate(this),t.item.getDate(this))}compareItemName(e,t){return this.compareText(e.item.getSearchText(this),t.item.getSearchText(this))}compareItemNumItems(e,t){return t.item.numItems()-e.item.numItems()}_getItemSortComparator(e){return e===v.Alphabetical&&this.compareItemName||e===v.Date&&this.compareItemDate||e===v.NumItems&&this.compareItemNumItems||e===v.Priority&&this.compareBlockItemPriority||e===v.Created&&this.compareBlockItemCreated||e===v.None&&this.compareItemNone}getItemComparator(){var e=this.getSortModeItems();return this.compareItemBase.bind(this,this._getItemSortComparator(e))}getItemsOnDate(e){var t=0;let a=[];for(var i=0;i<this._itemsWithDates.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let r=this._itemsWithDates[i];r.getMooDate().isOnDate(e)&&a.push(r)}return a}findIndexOfNextBlock(){for(var e=0,t=new Date,a=this.items.get(),i=0;i<a.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=a[i];if("blockHeader"===r.type){var s=r.block;if(s.isOverdue||s.isNow||s.isToday||s.isStarred||s.isImportant||s.date>=t)return i}}return-1}_keyHelper(e,t){var a=e["get"+t](this);if(a){if(a=a.map(e=>({value:e,lower:e.toLowerCase()})),this.search.showOnlyMatchingTags()){let e=this.search["get"+t]();e&&e.length>0&&(e=e.map(i.default.toLowerCase),a=a.filter(t=>{var a=0;for(let i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.lower===e[i])return!0}}))}return a}if(!e.hasVisibleChildren(this)){var r=0;let a=!0,i=e.parent();for(;void 0!==i&&i!==this.getItem();){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;let e=i["get"+t](this);if(e){var s=0;for(let t=0;t<e.length;t++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(this.blocksByKey[e[t].toLowerCase()]){a=!1;break}}}i=i.parent()}if(a)return[this.blockNoKey]}}_getKeysForItem(e){var t=this.getViewMode();if(this.isViewAgenda()||this.isViewCalendar()){var a=!0;if(this.isViewAgenda()&&e.hasAttachmentType(r.a.PluginType.Calendar)&&e.getDate()<Date.today()){var i=e.getAttachmentByType(r.a.PluginType.Calendar);i.getPlugin().shouldDisplayOverdueInAgenda()&&i.getPlugin().hasWritePermissionForAttach(i)||(a=!1)}if(a){var n=this._getDatesForItem(e);if(this.isViewAgenda()&&this.getSortModeBlocks()===v.Date&&!this.search.showOnlyAgendaDates()){var o=[];if(!e.isComplete()){if(e.isStarred(this)){var l="starred";s.default.timeline.getDateForKey(l)&&o.push(l)}if(e.isImportant(this)){l="important";s.default.timeline.getDateForKey(l)&&o.push(l)}}var d=e.getTagsLower();if(d)for(var h=0,c=0;d&&c<d.length;c++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var u="#"+d[c];s.default.timeline.getDateForKey(u)&&o.push(u)}o.length>0&&(n=n?n.concat(o):o)}return n}}else if(t===m.Groups_Project){var p=e.parent();if(p===this.getItem()&&!e.isPrefixHeader(this))return[this.blockNoKey];if(p&&p.isPrefixHeader()&&p!==this.getItem()&&(this.search.showChildProjects()||p.parent()===this.getItem()))return[p.id]}else{if(t===m.Groups_Tag)return this._keyHelper(e,"Tags");if(t===m.Groups_Contact)return this._keyHelper(e,"Contacts");if(t===m.Groups_Priority){var g=e.getPriority(this);if(g)return[g];if(!e.hasVisibleChildren(this)){for(var f=0,y=(a=!0,e.parent());void 0!==y&&y!==this.getItem();){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;if(y.getPriority(this)){a=!1;break}y=y.parent()}if(a)return[this.blockNoKey]}}}}isOkOnAgenda(e){return!!this._getKeysForItem(e)||this.search.showHierarchy()&&e.parent()&&this.isOkOnAgenda(e.parent())}_getDatesForItem(e){var t,a=this.getSortModeBlocks();if(this.isViewCalendar()||a===v.Date){var i=e.getMooDate();if(e.isComplete()&&this.isViewAgenda())e.dateCompleted>=Date.today()&&(t=e.dateCompleted);else if(i){let e=i.getAllDates();return e.length>10&&i.isRepeatDate()&&!i.isRange()&&(e=e.slice(0,10)),e.filter(e=>this.isDateWithinRange(e))}}else if(a===v.Created||a===v.Completed){var r=a===v.Created?e.dateCreated:e.dateCompleted;(!this.startDate||r>=this.startDate)&&(t=r)}if(t&&this.isDateWithinRange(t))return[t]}isDateWithinRange(e){return e&&(!this.endDate||e<this.endDate)}_getKeyForDate(e){var t=Date.today();if(!(this.combineOverdue&&e<t)){var a=r.a.DFormat.MonthDayYearLong,i=s.default.International.getFormat(a);return e.toString(i)}return"overdue".toLowerCase()}updateBlockItems(){var e,t=this.getViewMode();if(this.isViewOutline())this.updateOutline(this._allPaneItems,this.supportsSortItems()&&this.getItemComparator());else if(this.isViewCalendar()){var a=0;this._itemsWithDates=[];for(var i=0;i<this._allPaneItems.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let e=this._allPaneItems[i];if(e.getMooDate()){let t=e.getAttachmentByType(r.a.PluginType.Calendar),a=t&&t.getField("calendarID");(a?!1!==this.displayCalendars.get()[a]:this.displayLocalItems.get())&&this._itemsWithDates.push(e)}}t===m.Calendar_Month?this.updateCalendarMonth():this.isViewCalendarHoriz()&&(this.updateCalendarWeek(),e=!0)}else this.updateBlocks(),this.updatePaneObjects();e&&this.updateAllDay()}updateBlocks(){var e,t=0;this.blocks=[],this.blocksByKey={},this.isViewAgenda()&&this.getBlock(Date.today());for(var a=0;a<this._allPaneItems.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let e=this._allPaneItems[a],i=!e.isNote();if(i){if(e.getMooDate()){let t=e.getAttachmentByType(r.a.PluginType.Calendar),a=t&&s.default.pluginManager.getPluginGCalendar().isReady()&&t.getField("calendarID");i=a?!1!==this.displayCalendars.get()[a]:this.displayLocalItems.get()}}i&&this.addToBlock(this._allPaneItems[a])}this.isViewAgenda()?e=this.compareBlockDate:this.isViewPriority()?e=this.compareBlockBase.bind(this,this.compareBlockPriority):this.supportsSortBlocks()&&(e=this.getBlockComparator()),e&&this.blocks.sort(e)}addItemToPaneObjects(e,t,a,i,r){i=i||0;var s=new f.a({type:"blockItem",item:a,id:t.getItemID(a)+(r?"_"+r.id:""),pane:this,block:t,parentObject:r,index:e.length,levelsDeep:i,sizeInPane:a.sizeInPane});if(this.addPaneObject(e,s),a.hasNote()&&(s.noteObject=this.addItemToPaneObjects(e,t,a.getNote(),i,r)),!a.isCollapsed(this)){var n=a.getVisibleChildren(this);if(n)for(var o=0,l=0;l<n.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;this.addItemToPaneObjects(e,t,n[l],i+1,s)}}return s}updatePaneObjects(){var e,t,a,i,s=0,n=[];for(a=0;a<this.blocks.length;a++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var o=this.blocks[a],l=this.isBlockCollapsed(o)&&(a===this.blocks.length-1||!this.isBlockCollapsed(this.blocks[a+1]));if(o.sort(),o.item?(t=o.item,i=new f.a({type:"blockItem",item:t,id:t.id+"_"+o.id,pane:this,block:o,index:n.length,levelsDeep:0,sizePad:l?o.heightOfSpaceBetween():o.isCollapsed()?0:4,sizeInPane:t.sizeInPane,isBlockHeader:!0}),this.addPaneObject(n,i),t.hasNote()&&!this.isBlockCollapsed(o)&&this.addItemToPaneObjects(n,o,t.getNote(),0,i)):this.isViewProjectNoBlocks()||this.addPaneObject(n,new f.a({type:"blockHeader",block:o,id:o.id,pane:this,index:n.length,isToday:o.isToday,isOverdue:o.isOverdue,isFirstCollapsed:e&&o.isCollapsed()&&!e.isCollapsed(),sizePad:l?o.heightOfSpaceBetween():this.isViewProject()||this.isViewAgenda()&&o.isDate?4:0,sizeInPane:o.heightOfHeader})),1===this.blocks.length&&this.isViewProject()||!this.isBlockCollapsed(o)){for(var d=0,h=!1,c=0;c<o.items.length;c++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;t=o.items[c],i=this.addItemToPaneObjects(n,o,t),!h&&this.isViewAgenda()&&this.shouldShowTime(i)&&!t.getTime()&&(i.showAllDay=!0,h=!0)}this.addPaneObject(n,new f.a({type:r.a.BlockType.AddItem,id:o.id+"_add",pane:this,block:o,index:n.length,sizeInPane:o.noAddButton?o.heightOfSpaceBetween():o.heightOfAddButton(),addFn:o.addItem}))}e=o}this.isViewProject()&&!this.isViewProjectNoBlocks()&&((o=this.getBlock("newProject")).isNewProject=!0,this.addPaneObject(n,new f.a({type:r.a.BlockType.Header,block:o,id:o.id,pane:this,index:n.length,sizeInPane:o.heightOfHeader}))),this.items.set(n)}addToBlock(e){this.isViewProject()&&e.isPrefixHeader(this)&&(this.search.showChildProjects()||e.parent()===this.getItem())&&this.getBlock(e.id,e);var t=this._getKeysForItem(e);if(t)for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this.getBlock(t[i],e);r&&r.addItem(e)}}_addFnBase(e,t,a,n,o){e=s.default.settings.getDefaultItemText(n)+e,this.clearPreventUpdate(),s.default.PaneUpdateBatcher.beginUpdateItems(),g.d.beginAction();var l={text:e};o&&(l=i.default.extend(l,o));var d=this.createVMLI(l,{parent:a,changeType:r.a.ChangeType.AllLocal,isEditable:!0});a.insertItem(d),g.d.performAction(g.b.Create,{itemID:d.id,parent:a.id,position:a.numItems(),text:e}),g.d.endAction(),s.default.PaneUpdateBatcher.commitUpdateItems();var h=this.indexOfItem(d,t);h>=0&&p.a.selectIndex(h,0)}addFnProject(e){return this._addFnBase("",e,e.id===this.blockNoKey?this.getItem():n.a.getItem(e.id))}addFnTag(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}addFnDate(e){var t,a="";return e.isDate?(a=" "+r.a.CharDate,t={date:e.date}):e.isStarred?t={isStarred:!0}:e.isImportant?t={priority:r.a.VMLIFlag.P2}:a=" "+e.id,this._addFnBase(a,e,this.getItem(),void 0,t)}addFnContact(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}addFnPriority(e){return this._addFnBase("",e,this.getItem(),void 0,{priority:e.priority})}getDateForSoftDate(e){var t=s.default.timeline.getDateForKey(e.toLowerCase());if(!isNaN(t)){var a=100*Math.round(t/100),i={days:Math.round(a/100),minutes:Math.round(t-a)};return Date.today().add(i)}}getBlock(e,t){var a,o=this.isViewDates(),l=this.isViewAgenda(),h=e;if(o&&!i.default.isString(e))a=e,h=e=this._getKeyForDate(a),"overdue"===e&&(!t.isComplete()&&s.default.timeline.getDateForKey(e)||(e=void 0),a=void 0);else if(i.default.isObject(e)){try{i.default.PAssert(771,e.value&&e.lower,"If key is object it should have this form")}catch(v){i.default.reportError(v)}h=e.lower,e=e.value}if(e){var c,u=this.isViewAutoBlocks()?void 0:n.a.getItem(e),p=this.getViewMode(),g=this.blocksByKey[h];if(!g)if(void 0!==(c=u?u.getStyledTextAsOneLine(!0):this.isViewPriority()?e===r.a.VMLIFlag.P0?"High":e===r.a.VMLIFlag.P1?"Medium":e===r.a.VMLIFlag.P2?"Low":"(No priority)":e)){var f={pane:this,id:e,name:c,sortMode:this.supportsSortItems()&&this.getSortModeItems(),addFn:this.isViewProject()&&this.addFnProject.bind(this)||this.isViewTag()&&this.addFnTag.bind(this)||this.isViewContact()&&this.addFnContact.bind(this)||this.isViewPriority()&&this.addFnPriority.bind(this)||l&&this.addFnDate};this.isViewTag()?(f.name=e===this.blockNoKey?"(No tag)":"#"+f.name,f.isTag=!0):this.isViewContact()?(f.name=e===this.blockNoKey?"(No contact)":"+"+f.name,f.isContact=!0):this.isViewPriority()&&(f.isPriority=!0,f.priority=e),p===m.Groups_Project&&(f.name=e===this.blockNoKey?"(No project)":f.name,f.item=u,f.isEditable=!0,f.date=u&&u.getDate(this)),e===this.blockNoKey&&(f.isNoKey=!0),o&&(a?(f.date=a.clone().clearTime(),f.isDate=!0,f.date.equals(Date.today())&&(f.isToday=!0)):(f.date=this.getDateForSoftDate(e),f.name=f.name.toUpperCase(),"now"===e?f.isNow=!0:"starred"===e?f.isStarred=!0:"important"===e?f.isImportant=!0:"overdue"===e&&(f.isOverdue=!0,f.noAddButton=!0))),g=new d(f),this.blocksByKey[h]=g,g.originalIndex=this.blocks.length,this.blocks.push(g)}}return g}closestIndexOfObject(e){return this.indexOfItem(e,e.block,e.index)}onGCalendarActiveChanged(e,t){var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)}onGmailActiveChanged(e,t){var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)}_refreshPaneData(){var e=s.default.pluginManager.getPluginGCalendar();e.isActive()&&e.forceRemoteEventSync()}viewModeIcon(){let e=this.getViewMode();return r.a.TaskViewModeIcon[e]}viewModeColor(){return this.isViewOutline()?"#09d":"#a30"}isViewDates(){return this._isViewHelper.dates}isViewAgenda(){return this._isViewHelper.agenda}isViewCalendar(){return this._isViewHelper.calendar}isViewCalendarHoriz(){return this._isViewHelper.calendarHoriz}isViewCalendarMonth(){return this._isViewHelper.calendarMonth}isViewProject(){return this._isViewHelper.project}isViewProjectNoBlocks(){return this._isViewHelper.project&&(0===this.blocks.length||1===this.blocks.length&&this.blocks[0].id===this.blockNoKey)}isViewGroups(){return this._isViewHelper.groups}isViewOutline(){return this._isViewHelper.outline}isViewFlatList(){return this._isViewHelper.flatList}isViewTag(){return this._isViewHelper.tag}isViewContact(){return this._isViewHelper.contact}isViewPriority(){return this._isViewHelper.priority}isViewAutoBlocks(){return this._isViewHelper.autoBlocks}isViewText(){return this._isViewHelper.text}isViewItems(){return this._isViewHelper.items}isViewArchived(){return this._isViewHelper&&this._isViewHelper.archived}isViewDeleted(){return this._isViewHelper&&this._isViewHelper.deleted}canScrollToItem(){return!this.isViewCalendar()&&this.isViewItems()}isViewPremiumBlocked(){return!s.default.billingManager.hasPremiumFeatures()&&r.a.TaskViewModesPremium[this.getViewMode()]}shouldShowAddBox(){return this.canAddItem&&(this.isViewOutline()||this.isViewProject())}isCalFilterActive(){var e=this.displayCalendars.get(),t=!this.displayLocalItems.get();for(var a in e)if(e.hasOwnProperty(a)&&!1===e[a]){t=!0;break}return t}becomeReal(){super.becomeReal(),this.onViewStateChanged()}onViewStateChanged(){this.isFakePane?this.setupViewStateMinor():(i.default.setItemAnimationMode(r.a.ItemAnimationMode.None),this.setIgnoreRestoreScroll(void 0,()=>{this._infiniteList.saveScrollOfTop()}),this.setupViewState(!0),this._infiniteList.clearCache(),this._infiniteList.alwaysRenderScroll=!0,this.isViewCalendar()||this._infiniteList.setInitialScrollOffset(0),this.updateItemsImmediate(!0,void 0,void 0,!0),s.default.PaneManager.updatePaneStateForPane(this),this.isViewDates()?(this.scrollToToday(r.a.ScrollDuration.Snap),requestAnimationFrame(()=>{this.isViewDates()&&(this.scrollToToday(r.a.ScrollDuration.Snap),i.default.resetItemAnimationMode(),requestAnimationFrame(()=>{this._infiniteList.alwaysRenderScroll=!1}))})):this.setScrollOffset(0,r.a.ScrollDuration.Snap),i.default.resetItemAnimationMode(),this.hasCollapsedObs.set(this.hasCollapsed()))}setupViewStateMinor(){let e=this.getViewMode(),t=this.getSortModeBlocks(),a={agenda:e===m.Agenda_Today||e===m.Agenda_Week||e===m.Agenda_All,calendar:e===m.Calendar_Day||e===m.Calendar_Week||e===m.Calendar_Month||e===m.Calendar_Custom,calendarHoriz:e===m.Calendar_Day||e===m.Calendar_Week||e===m.Calendar_Custom,calendarMonth:e===m.Calendar_Month,project:e===m.Groups_Project,groups:e===m.Groups_Project||e===m.Groups_Tag||e===m.Groups_Contact||e===m.Groups_Priority,outline:e===m.Outline||e===m.List_Flat||e===m.Archived||e===m.Deleted,flatList:e===m.List_Flat,tag:e===m.Groups_Tag,contact:e===m.Groups_Contact,priority:e===m.Groups_Priority,archived:e===m.Archived,deleted:e===m.Deleted,items:e!==m.Archived&&e!==m.Deleted};a.dates=a.agenda||a.calendar,a.autoBlocks=a.agenda||a.tag||a.contact||a.priority,a.text=!a.calendar,this._isViewHelper=a,this.supportsSortBlocks()&&(this.supportsSortBlocksMode(t)||this.setSortModeBlocks(S[e].Default,1,!1),(t=this.getSortModeBlocks())===v.Completed&&0===this.search.getFilterValue("completeOption")&&this.search.setFilter("completeOption",1)),this.search.setFilterEnabled("showOnlyAgendaDates",this.isViewAgenda()),this.search.setFilterEnabled("showOnlyMatchingTags",this.isViewTag()||this.isViewContact()),this.search.setFilterEnabled("showChildProjects",this.isViewProject()),(this.isViewTag()||this.isViewContact())&&this.search.setFilterTooltip("showOnlyMatchingTags","Show only matching "+(this.isViewTag()?"Tag":"Contact")+" blocks")}setupViewState(e){this.setupViewStateMinor();var t=this.getViewMode(),a=this.getSortModeBlocks(),n=this.isViewOutline(),o=this.isViewCalendar()||i.default.activeDisplayMode&r.a.DisplayMode.NoPaneTop?0:(this.isViewAgenda()||this.isViewProject()?48:36)||!1;let l=this.isViewItems();var d;if(this.canAddItem=l,this.supportCompleting=l,this.supportCheckbox=l,this.supportPerformArchive=l,this.supportIndent=l,this.supportClone=l,this.hasMoreButtons=l,this.contextMenuMode=(this.isViewArchived()?"Archived":this.isViewDeleted()&&"Deleted")||"Normal",this.isEditable=l,this.isDraggable=l,this.isDropTarget=l,this.search.setFilterEnabled("complete",l),this.blockNoKey=_+"_"+t,this.supportIndent=n,this.supportMultiselect=n,this.overviewTracksScroll=n,this.supportSearchFlat=n,this.supportCheckbox=!this.isViewCalendar(),this.topBoxHeight.set(o,!1),this.paneClass=this.getPaneClass(),this.paneEmptyMessage=(this.isViewArchived()?"No archived items":this.isViewDeleted()&&"No deleted items")||this.isViewAgenda()&&"Nothing on the agenda"||this.isViewOutline()&&"Write some things here to get started"||"",this.collapsedFieldName=r.a.PerPaneStateField.Collapsed+(this.viewState?t:""),this._isSearchedFlat=!(this.isViewCalendar()||!this.search)&&!this.search.showHierarchy(),this.isViewPremiumBlocked()?this.toast.set({text:"The "+r.a.TaskViewModeText[t]+" view is a Premium feature",actionText:"GO TO OUTLINE",doAction:this.switchToOutline}):this.toast.set(void 0),(this.isViewCalendar()||this.isViewAgenda())&&(d=r.a.ItemStoreFilter.Dates,(this.isViewCalendar()||this.getSortModeBlocks()===v.Date)&&(d|=r.a.ItemStoreFilter.Priority)),this.search.itemStoreFilter=d,this.search.onlyMatchDates=this.isViewDates(),this.shouldUpdateOnTextChanged=this.isViewAgenda()||this.isViewTag(),this.combineOverdue=this.isViewAgenda()&&a===v.Date,this.showScrollbars.set(!this.isViewCalendar()),this.isViewAgenda()){var h,c;if(t!==m.Agenda_All)t===m.Agenda_Today?c=1:t===m.Agenda_Week&&(c=7),h=Date.today().addDays(a===v.Date?c:-(c-1));a===v.Date?this.endDate=h:(this.startDate=h,this.endDate=Date.today().addDays(1))}this.isEditable=this.supportSel=l&&!this.isViewCalendar(),this.orientation.set(this.isViewCalendarHoriz()?r.a.Orientation.Horizontal:r.a.Orientation.Vertical),t===m.Calendar_Week||t===m.Calendar_Month?(this.minWidthFlex=700,this.maxWidthFlex=1200,this.maxWidthSingle=1600,this.minWidth=600,this.maxWidth=1600):(this.minWidth=r.a.StdPaneWidthMin,this.minWidthFlex=r.a.StdPaneWidthMin,this.maxWidth=r.a.PaneWidthMax,this.maxWidthFlex=this.maxWidthSingle=r.a.StdPaneWidthMax),this.dateInMiddle=this._getDateInMiddle(),s.default.PaneManager.updatePaneRects()}getPaneClass(){return"paneTask pane"+((this.isViewCalendar()?"Calendar":this.isViewAgenda()&&"Agenda")||this.isViewProject()&&"Project"||this.isViewTag()&&"Tag"||this.isViewContact()&&"Contact"||this.isViewPriority()&&"Priority"||this.isViewOutline()&&"Outline")}onScroll(){this.getViewMode();this.isViewCalendarHoriz()&&(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50))}_handleDragOverPane(e,t,a,r,n,o,l){if(e&&i.default.findParent(a,"paneContent")&&!i.default.hasClass(a,"paneContent")&&!i.default.hasClass(a,"paneTopBox")&&n&&"blockHeader"===n.type&&(this.isViewAgenda()&&e.supportDates||this.isViewAutoBlocks())){var d,h=i.default.getListCellForElement(a);return h&&h.props.cell&&(d=h.props.cell.paneObject.block,this.isViewAgenda()&&d.isOverdue&&(d=void 0)),this.dragHoveredBlock.set(d),s.default.DragDrop.setBlockTarget(d),{block:d}}if(!n||"blockItem"===n.type)return this.dragHoveredBlock.set(void 0),this.isViewCalendar()||s.default.DragDrop.setBlockTarget(void 0),this._handleDragOverTasks(e,t,a,r,n,o,l)}_handleDragOverTasks(e,t,a,s,n,o,l){var d,h,c,u,p,g,f=!1,m=r.a.DragDropPosition.Below,v=!1,y=0;if(n){d=n.item,g=n.index,d.isNote()&&(g--,n=this.objectAtIndex(g),s=this.elementAtIndex(g),d=d.parent()),d.hasNote()&&(y=this.sizeOfItem(d.getNote(),g+1));let e=s.getBoundingClientRect(),t=e.height+y;m=this.isSearchedFlat()&&this.search.isFlatSearchResult(d)||this.isViewAgenda()||this.isViewAutoBlocks()?r.a.DragDropPosition.On:l<e.top+.38*t&&(!this.isViewProject()||0!==n.levelsDeep)?r.a.DragDropPosition.Above:l>e.top+.62*t?r.a.DragDropPosition.Below:r.a.DragDropPosition.On,c=s,f=!0}else if(0===this.numItems())d=this.getItem(),v=!0;else if(this.isSearchedFlat()||!i.default.findParent(a,"paneScroller")||this.isViewProject())d=this.getItem(),v=!0,u=!0;else{var _=this.indexOfLastItem();if(!f&&_>=0&&this.isIndexMounted(_))if(l>=(p=this.elementAtIndex(_)).getBoundingClientRect().bottom)d=this.getLastItem(),n=this.getLastObject(),c=p,m=r.a.DragDropPosition.Below,f=!0}if(!f&&!this.isSearchedFlat()){var S=this&&this.indexOfFirstItem();if(this&&S>=0&&this.isIndexMounted(S))if(l<(p=this.elementAtIndex(S)).getBoundingClientRect().top)d=this.getFirstItem(),n=this.getFirstObject(),c=p,m=this.isViewProject()&&0===n.levelsDeep?r.a.DragDropPosition.On:r.a.DragDropPosition.Above,f=!0}if(f){var P=c.getBoundingClientRect(),I=m!==r.a.DragDropPosition.Below?P.top:P.top+P.height+y,b=m===r.a.DragDropPosition.On?P.height:void 0;if(I>this.contentTop()){var D;m===r.a.DragDropPosition.Below&&g+1<this.numItems()&&d.hasChildren()&&((D=this.objectAtIndex(g+1)).item||(D=void 0)),D=D||n;var w=this.getPaddingForPaneObject(D);h={left:P.left+w,top:I,width:P.right-P.left-w,height:b}}}return this.scrollFromMousePosition(o,l,this.orientation.get()===r.a.Orientation.Horizontal),{position:m,targetElement:c,targetItem:d,linePosition:h,overview:!1,dropOnPane:v,atEnd:u}}handleDragDrop(e,t,a,i){let r=s.default.DragDrop.blockTarget;if(r){let a=()=>{s.default.DragDrop.startPane.applyDropOnBlock(r,e,this,t.dataTransfer.block),this.revertDrag()},n=t.dataTransfer.pane,o=n.getDocument();if(this===n||!this.isViewCalendar()||o===this.getDocument())return a(),!0;s.default.menus.confirm(`Dropping onto the calendar of a different document. Do you want to move this item to ${o.text.get()}?`,r=>{r&&(this._handleDragDrop(e,t.dataTransfer,{targetItem:this.getRootItem(),dropOnPane:!0},t,i),a())})}else if(!this.isViewAutoBlocks())return super.handleDragDrop(e,t,a,i)}revertDrag(){super.revertDrag(),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)}getSaveInfo(){var e=super.getSaveInfo();return e.viewState=this.viewState.get(),e.displayCalendars=this.displayCalendars.get(),e.displayLocalItems=this.displayLocalItems.get(),e.blocksCollapsed=this.blocksCollapsed.get(),e}isBlockCollapsed(e){return e.item?e.item.isCollapsed(this):!0===this.blocksCollapsed.get()[e.id]}setBlockCollapsed(e,t){p.a.reset();this.blocksCollapsed.get();this.blocksCollapsed.set(Object.assign({},this.blocksCollapsed.get(),{[e.id]:t})),this.hasCollapsedObs.set(this.hasCollapsed()),this.updateBlockItems(),s.default.PaneManager.savePaneState()}onInfiniteListLoaded(){!this.initialOffset&&this.isViewCalendar()&&(this.initialOffset=this.getScrollOffsetOfToday()||0,this._infiniteList.setInitialScrollOffset(this.initialOffset))}addProject(e,t,a){return this.addItem({index:e,prefix:r.a.Prefix.Header,text:t,toRoot:a})}onTapAddItem(){super.onTapAddItem()}addItem({index:e,prefix:t,text:a,toRoot:n,date:o,e:l}){e=e||0,a=a||"",void 0===t&&(t=s.default.settings.getDefaultItemText()),s.default.PaneUpdateBatcher.beginUpdateItems(),p.a.reset(),this.setIgnoreRestoreScroll();var d=n?this.getRootItem():this.getItem(),h={text:(t?t+" ":"")+a};1===this.search.getFilterValue("complete")&&(h.isComplete=!0),1===this.search.getFilterValue("starred")&&(h.isStarred=!0);let c=this.search.getFilterValue("priority");c&&(h.priority=c);let u=d.addItemAtIndex(h,e,this);if(this.isViewProject()&&t===r.a.Prefix.Header){let t=s.default.settings.getDefaultItemText();u.addItemAtIndex({text:t},e,this)}if(this.paneContent&&(p.a.focusPane(this),e>=0)){var g=h.text.length;p.a.selectIndex(e,g)}s.default.PaneUpdateBatcher.commitUpdateItems();var f=this.indexOfItem(u);return this.scrollIndexIntoView(f),p.a.selectIndex(f,h.text.length),i.default.sendEvent("Menu","AddItemButton"),u}setDisplayLocal(e){this.displayLocalItems.set(e),this.updateItems()}setDisplayCalendar(e,t){var a=i.default.clone(this.displayCalendars.get());a[e.id]=t,this.displayCalendars.set(a),this.updateItems()}getCollapsedDefault(e,t,a){return t?e.parent()!==this.getRootItem():(a=a||this.getViewMode(),!(this.isViewOutline()||this.isViewProject()&&e.isPrefixHeader()&&this.isItemTopLevel(void 0,e)))}getWidth(){var e=super.getWidth();return this.isViewCalendar()&&!this.isViewCalendarMonth()&&(e-=y),e}getMonthStart(e){return e.clone().clearTime().addDays(1-e.getDate())}getWeekStart(e){return e.clone().clearTime().addDays(-e.getDay()+s.default.settings.dayWeekStart.get())}doesWeekCrossMonth(e){if(e.clone().addDays(6).getDate()<e.getDate())return!0}updateCalendarMonth(){var e,t,a,i=0,s=0,n=[],o=this.dateInMiddle,l=this.getWeekStart(o),d=r.a.CalendarMonthViewNumWeeksPad;for(a=0;a<=d;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;let r=-d-1+a;e=l.clone().addWeeks(r),(t=this.doesWeekCrossMonth(e))&&n.push(this.updateCalendarMonthWeek(n.length,e,!0,!1)),n.push(this.updateCalendarMonthWeek(n.length,e,!1,t))}for(d=2*r.a.CalendarMonthViewNumWeeksPad+1,a=0;n.length<d;a++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e=l.clone().addWeeks(a),(t=this.doesWeekCrossMonth(e))&&n.length<d&&n.push(this.updateCalendarMonthWeek(n.length,e,!0,!1)),n.push(this.updateCalendarMonthWeek(n.length,e,!1,t))}this.items.set(n)}updateCalendarMonthWeek(e,t,a,i){for(var r,s,n=0,o=[],l=1===t.getDate(),d=0;d<7;d++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var h=t.clone().addDays(d);r&&h.getDate()<r.getDate()&&(l=!0),!l&&i||l&&a||(o[d]={date:h,items:this.getItemsOnDate(h)},s||(s=h)),r=h}return new f.a({type:"calendarWeek",id:"week_"+t+(a?"_end":""),pane:this,date:s,dates:o,sizeInPane:this.heightWeek(),index:e})}heightWeek(){return r.a.CalendarMonthViewWeekHeight}updateCalendarWeek(){for(var e=0,t=[],a=r.a.CalendarDayViewNumDaysPad,i=this.dateInMiddle,s=this.getViewMode(),n=-a;n<a;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=i.clone().addDays(n),l=(this._getKeyForDate(o),this.getItemsOnDate(o));t.push(new f.a({type:"calendarDay",id:s+"_day_"+(n+a),pane:this,date:o,items:l,sizeInPane:this.getDayWidth}))}this.items.set(t)}getItemPlacementOnDate(e,t){var a=!e.getDate(),i=e.getNextDate(t),s=e.getDuration()&&i&&e.getEndDate();if(i&&i.hasTimeOfDay()&&(a||i.isSameDay(t))){let t=i.getHours()+i.getMinutes()/60,a=e.getDuration()?e.getDuration()/r.a.MSPerHour:1;if(a=Math.round(10*Math.min(a,24-i.getHours()))/10,t>0||a<24)return{time:t,duration:a}}else if(i&&i.hasTimeOfDay()&&s&&!i.isSameDay(t)&&s.isSameDay(t)){return{time:0,duration:s.getHours()+s.getMinutes()/60}}return!1}updateAllDay(){if(!this._destroyed){for(var e=0,t=this.indexOfTop(),a=this.inViewCount(),i=1,r=t;r<t+a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=this.items.get()[r];if(s){for(var n=0,o=0,l=s.items||[],d=0;d<l.length;d++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var h=l[d];this.getItemPlacementOnDate(h,s.date)||o++}o>i&&(i=o)}}this.numAllDay.set(i)}}getContentHeight(){return 1224+this.getHeightAllDay()+2}getHeightAllDay(){return Math.min(r.a.CalendarDayViewMaxAllDayHeight,26*this.numAllDay.get())+1}getDayViewY(){return 409}getDayWidth(){var e=this.getWidth(),t=this.getViewMode(),a=(t===m.Calendar_Day?1:t===m.Calendar_Week&&7)||t===m.Calendar_Custom&&s.default.settings.calendarCustomDays.get();return Math.max(e/a,40)}getPaddingForPaneObject(e,t){var a=super.getPaddingForPaneObject(e,t);return t||(a+=this.extraPaddingForPaneObject(e)),a}extraPaddingForPaneObject(e){return this.isViewAgenda()?r.a.PaddingAgendaTime:0}shouldShowTime(e){var t="blockItem"===e.type&&e.item;return t&&!t.isNote()&&0===e.levelsDeep&&e.block&&e.block.shouldShowTime()}isSearchedFlat(){return this._isSearchedFlat}isItemTopLevel(e,t){var a=!0;if(this.isViewProject()){if(e)return e.isBlockHeader;a=t.isPrefixHeader(this)}return this.isViewProject()&&this.search.showChildProjects()||(a=super.isItemTopLevel(e,t)),a}openViewMenu(e){s.default.menus.openContextMenu({componentName:"ReactContextMenuPanes",element:e.target,pane:this,positionOffset:{left:45},subset:r.a.PaneMode.Task})}hasCollapsed(e){if(!e&&this.isViewAutoBlocks()){for(var t=0,a=0;this.blocks&&a<this.blocks.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.isBlockCollapsed(this.blocks[a]))return!0}return!1}return super.hasCollapsed(e)}toggleCollapseAll(){var e=!this.hasCollapsed();if(this.isViewAutoBlocks()){var t=0;let r=i.default.clone(this.blocksCollapsed.get());for(var a=0;a<this.blocks.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[this.blocks[a].id]=e}this.blocksCollapsed.set(r),e||(e=void 0)}super.collapseAll(this.item.get(),e,void 0,this.isViewAutoBlocks())}supportsSortBlocks(e){return e=e||this.getViewMode(),P.viewModeSupportsSortBlocks(e)}supportsSortBlocksMode(e,t){return t=t||this.getViewMode(),P.viewModeSupportsSortBlocksMode(e,t)}supportsSortItems(e){return e=e||this.getViewMode(),P.viewModeSupportsSortItems(e)||this.isViewOutline()&&this.isSearchedFlat()}getSortModeBlocks(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.mode}getSortOrderBlocks(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.order||1}isSortedBlocks(){var e=this.getSortModeBlocks();return e&&e!==v.None}setSortModeBlocks(e,t,a){this.setViewProp("sortModeBlocks",{mode:e,order:t},a)}getSortModeItems(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.mode}getSortOrderItems(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.order||1}setSortModeItems(e,t,a){this.setViewProp("sortModeItems",{mode:e,order:t},a)}isSortedItems(){var e=this.getSortModeItems();return e&&e!==v.None}getViewMode(){return this.viewState.get().viewMode}setViewMode(e){this.setViewProp("viewMode",e)}setViewProp(e,t,a){var i=this.viewState.get();i[e]!==t&&(i[e]=t,this.viewState.set(i,!1!==a))}createVMLI(e,t){var a=this.search.getTags();if(!this.isViewTag()&&a)for(var i=0,r=0;r<a.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[r],n="#"+s;if(e.text.indexOf(n)<0){for(var o=0,l=!1,d=t&&t.parent;d;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var h=d.getTags();if(h&&h.indexOf(s)>=0){l=!0;break}d=d.parent()}l||(e.text+=" "+n)}}return super.createVMLI(e,t)}getItemDisplayTime(e){var t=this.getSortModeBlocks(),a=e.item;return t===v.Date?a.getTime()||(e.showAllDay?"All day":""):t===v.Created?a._formatDateTime(a.dateCreated):t===v.Completed?a.dateCompleted?a._formatDateTime(a.dateCompleted):"no time":void 0}checkFlatListMode(){var e=this.getViewMode();e===m.List_Flat&&0===this.search.getFilterValue("showOnlyMatches")&&this.setViewMode(m.Outline),e===m.Outline&&1===this.search.getFilterValue("showOnlyMatches")&&this.setViewMode(m.List_Flat)}onCalendarCustomDaysChanged(){this.getViewMode()===m.Calendar_Custom&&this.onViewStateChanged()}switchToOutline(){this.setViewMode(m.Outline)}shouldRenderPrefix(e){return e.item.hasPrefix()&&!(this.isViewProject()&&e.isBlockHeader)}bottomListMessage(){let e;if(!(this.numItems()>0)){let t=this.search.numUnmatchedItems();t&&(e=this.isSearched()?t+" items hidden by search / filters. Click the search box above to clear your search / filters, or click to add new items.":t+" completed items hidden by filter. Click the search box above and click the checkbox filter to show completed items.")}return{text:e,clickable:!1}}needsUpdateForDate(e){return this.isViewDates()}_anyTagHasKey(e){return e&&e.some(e=>s.default.timeline.getDateForKey("#"+e))}needsUpdateForTags(e,t){return this.isViewAgenda()&&this._anyTagHasKey(t)}handleItemChanged(e,t){var a=!1;return t[r.a.ItemProp.Text]&&(this.isViewTag()||this.isViewContact())&&(a=!0),super.handleItemChanged(e,t,a)}setDocument(e,t){super.setDocument(e,t,!0),this.onViewStateChanged()}getItem(e){let t=this.getDocument();return e||this.isViewItems()?super.getItem():this.isViewArchived()?t.getRootArchivedItem():this.isViewDeleted()?t.getRootDeletedItem():void 0}getRootItem(){let e=this.getDocument();return this.isViewArchived()?e.getRootArchivedItem():this.isViewDeleted()?e.getRootDeletedItem():super.getRootItem()}handleRightSideTap(e,t){this.isViewArchived()?(e.unArchive(r.a.ChangeType.Local),p.a.reset()):this.isViewDeleted()?(e.unDelete(r.a.ChangeType.Local),p.a.reset()):super.handleRightSideTap(e,t)}static viewModeSupportsSortBlocks(e){return!!S[e]}static viewModeSupportsSortBlocksMode(e,t){return S[t]&&S[t].Available.indexOf(e)>=0}static viewModeSupportsSortItems(e){return e===m.Groups_Project||e===m.Groups_Tag||e===m.Groups_Contact||e===m.Groups_Priority}}var I=P,b=a(32),D=r.a.TaskViewMode;t.a=new class{constructor(){this._inactivePaneTypes={},this.activePaneTypes=new b.a,this._registeredTypes={},this.numInactivePanes=new c.a(0),this.registerPaneType(void 0,r.a.PaneMode.Task,"Task",I,"icon-align-left",99)}paneSortCompare(e,t){return e.priority<t.priority?1:-1}registerPaneType(e,t,a,i,r,s){this._registeredTypes[t]={plugin:e,constructor:i};var n={type:t,name:a,icon:r,text:a,priority:s,tooltip:"Add "+a+" Pane"};!e||e.isActive()?this.activePaneTypes.insertSorted(n,this.paneSortCompare):(this._inactivePaneTypes[t]=n,this.numInactivePanes.set(this.numInactivePanes.get()+1))}activatePaneType(e){var t=this._inactivePaneTypes[e];try{i.default.PAssert(543,t,"Must have previously registered pane type")}catch(a){i.default.reportError(a)}this._inactivePaneTypes[e]=void 0,this.activePaneTypes.insertSorted(t,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)}deactivatePaneType(e){var t=this.activePaneTypes.get().find(t=>t.type===e);this.activePaneTypes.remove(t=>t.type===e);try{i.default.PAssert(544,t,"Must have previously activated pane type")}catch(a){i.default.reportError(a)}s.default.PaneManager.removePanesByType(e),this._inactivePaneTypes[e]=t,this.numInactivePanes.set(this.numInactivePanes.get()+1)}canCreatePane(e){var t=this._registeredTypes[e];return!(t.plugin&&(!t.plugin.isActive()||t.plugin.isPluginBlocked()))}createPane(e,t){(t=t||{}).id||(t.id=s.default.PaneManager.getNextPaneID()),"PaneTimeline"===e?(e=r.a.PaneMode.Task,t.viewState={viewMode:D.Agenda_All}):"PaneOutline"===e?(e=r.a.PaneMode.Task,t.viewState={viewMode:D.Outline}):"PaneArchived"===e&&(e="PaneTask",t.viewState={viewMode:D.Archived});var a=this._registeredTypes[e];if(a){if(!a.plugin||a.plugin.isActive()&&!a.plugin.isPluginBlocked())try{s.default.PaneUpdateBatcher.beginUpdateItems();var n=new a.constructor(t);return s.default.PaneUpdateBatcher.commitUpdateItems(),n}catch(o){return void i.default.reportError(o)}}else try{i.default.PAssert(545,!1,"Invalid pane type requested")}catch(l){i.default.reportError(l)}}isPaneTypeActive(e){var t=!!this._registeredTypes[e],a=!!this._inactivePaneTypes[e];return t&&!a}getRegisteredPanes(){return this.activePaneTypes.get()}_getTaskView(e,t,a,i){var n=0;let o=[];for(var l=0;l<a.length;l++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var d=a[l],h=r.a.TaskViewModeText[d];d===D.Calendar_Custom&&(h=h.replace("#",s.default.settings.calendarCustomDays.get())),o.push({text:h,type:r.a.PaneMode.Task,viewMode:d,icon:r.a.TaskViewModeIcon[d],premium:!!r.a.TaskViewModesPremium[d],canZoom:!0})}e.push({text:t,viewModes:o,border:!i})}getAvailablePanes(e){var t=this.activePaneTypes.get(),a=this.numInactivePanes.get(),i=[];if(this._getTaskView(i,"List",[D.Outline,D.List_Flat,D.Archived,D.Deleted]),this._getTaskView(i,"Grouped by",[D.Groups_Project,D.Groups_Tag,D.Groups_Contact,D.Groups_Priority]),this._getTaskView(i,"Agenda",[D.Agenda_Today,D.Agenda_Week,D.Agenda_All]),this._getTaskView(i,"Calendar",[D.Calendar_Day,D.Calendar_Custom,D.Calendar_Week,D.Calendar_Month],e),!e){for(var s=0,n=0;n<t.length;n++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var o=t[n];if(o.type!==r.a.PaneMode.Task){var l=o.type===r.a.PaneMode.Gmail;i.push({text:o.text,type:o.type,icon:o.icon,canZoom:l,border:!0})}}i[i.length-1].border=!1,a>0&&i.push({enableMore:!0})}return i}}},462:function(e,t,a){"use strict";a.r(t);var i,r=a(20),s=a(0),n=a(16),o=a(1),l=a(3),d=(a(181),a(13)),h=a(5),c=a(7),u=a.n(c),p=a(17),g=a(18),f=a(182),m=a(4),v=a(9),y=a(52),_=a(41),S=a(8);var P=(i=class{constructor(){this.isLoaded=!1,this.isRendered=new v.a(!1),this.isInit=!1,this.help=void 0,this._itemAnimationMode=o.a.ItemAnimationMode.Normal,this.isDisplaySettingsOpen=new v.a(!1),this.failedInitialDocLoad=new v.a(!1),this.cursor=new v.a,this.loadedImages={},s.default.vmMain=this,Rollbar.configure({payload:{environment:h.a.getDeployVar(o.a.DeployVariable.Environment),person:{id:l.default.settings.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:o.a.jsVersion,guess_uncaught_frames:!0}}},maxItems:o.a.__MAX_ERRORS_REPORTED,checkIgnore:s.default.rollbarIgnoreFn}),s.default.element("outerWrapper").addEventListener("mousemove",this.mousemove),s.default.isDemoMode()||(this.setupPageVisibility(),s.default.checkLowActivity()),l.default.PaneManager.onResize(),this.checkLastCodeVersion(),this.init()}loadPlugins(){}init(){try{s.default.PAssert(7,!this.isInit,"Should never double init VMMain, may cause severe issues")}catch(e){s.default.reportError(e)}this.isInit=!0,f.default.init(),y.a.init(),this.loadPlugins(),l.default.intro.init(),p.a.fireEvent("VMMainLoaded",[]),h.a.demo||(window.onbeforeunload=this.onUnload)}loadData(){if(s.default.shouldLog(o.a.LogLevels.Timing))var e=performance.now();s.default.shouldLog(o.a.LogLevels.Profile)&&console.profile("Load Local Data"),s.default.checkpoint(o.a.Checkpoint.LocalDocLoad),s.default.shouldLog(o.a.LogLevels.Profile)&&console.profileEnd(),s.default.isLoaded=!0,l.default.setup.initDemo(),s.default.isDemoMode()&&setTimeout(()=>{h.a.script&&l.default.setup.runScript(n.a.getURLParam("script")),window.parent.postMessage("loaded","*")},0),this.afterLoaded(),s.default.shouldLog(o.a.LogLevels.Profile)&&console.profile("Apply Bindings"),this.isRendered.set(!0),s.default.isDemoMode()&&h.a.script&&s.default.setupClick(document.getElementById("container"),this,{onStart:()=>{p.a.fireEvent("tapMain",[])},onClick:()=>{try{s.default.PAssert(8,s.default.isDemoMode()&&h.a.script,"Tap handler should only be active on demo page")}catch(e){s.default.reportError(e)}window.parent.postMessage("click","*")}}),s.default.shouldLog(o.a.LogLevels.Profile)&&console.profileEnd(),h.a.app&&l.default.nativeBridge.sendToApp("localLoaded"),s.default.shouldLog(o.a.LogLevels.Timing)&&(s.default.log("DONE LOCALLY",performance.now()),setTimeout(()=>{var t=performance.now();s.default.log("time react:",t-e,t)},0))}afterLoaded(){h.a.app&&(document.onreadystatechange=()=>{l.default.nativeBridge.sendToApp("loaded")},document.onreadystatechange())}updateCursorFromEvent(e){if(this.prevMove){var t=this.prevMove.target;if(t&&s.default.isAttachedToDoc(t)){var a=s.default.getPaneForElement(t);if(a){var i=s.default.elementFromPoint(this.prevMove.clientX,this.prevMove.clientY);if(i){var r=s.default.getItemForElement(i);this.updateCursor(e,a,i,r)}}}}}getCursorForClass(e,t,a){for(var i=0,r=e.classList,s=0;s<r.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(r[s]){case"link":case"date":case"plugin":return h.a.mac&&t.metaKey||!h.a.mac&&t.ctrlKey?"cursor-pointer":null}}if(a)return"cursor-pointer"}updateCursor(e,t,a,i){var r;if(t&&a){if(i&&s.default.isVMLI(i)){var n=s.default.findParentInItem(a,"plugin");n&&(a=n)}var l=!!s.default.findParent(a,"paneOverviewScroller");if(!m.a.isMouseDown()&&!(r=this.getCursorForClass(a,e,l))){var d=s.default.findParent(a,"itemInCalendarResizable");if(d){var h=d.getBoundingClientRect(),c=Math.min(o.a.CalendarResizeHandleHeight,h.height/3);(e.clientY-h.top<c||h.bottom-e.clientY<c)&&(r="cursor-row-resize")}}}this.cursor.set(r)}redoLastMouseMove(){var e=this.prevMove,t={target:document.elementFromPoint(e.clientX,e.clientY),clientX:e.clientX,clientY:e.clientY};this.mousemove(t,!0)}mousemove(e,t){if(s.default.notifyActivity(),!(s.default.disableMouseMove&&!e.target||l.default.PaneManager.isResizingPane||!t&&this.prevMove&&e.clientX===this.prevMove.clientX&&e.clientY===this.prevMove.clientY||l.default.DragDrop.isDragging)){var a,i,r,n=s.default.ensureDOMNode(e.target);if(n)(s.default.findParent(n,"paneRoot")||s.default.findParent(n,"paneOverviewScroller"))&&(r=s.default.getPaneForElement(n))&&(a=s.default.getItemForElement(n))&&(i=s.default.getListCellForElement(n)),this.updateCursor(e,r,n,a),m.a.setHovered(r,a,i),this.prevMove&&this.prevMove.target===n||(this.prevMove&&this.prevMove.target&&p.a.fireEvent("mouseout",[{target:this.prevMove.target}]),n&&p.a.fireEvent("mouseover",[{clientX:e.clientX,clientY:e.clientY,target:n}])),this.prevMove={clientX:e.clientX,clientY:e.clientY,target:n};else try{s.default.PAssert(9,!n,"Target should be defined",s.default.getElementPath(e.target))}catch(o){s.default.reportError(o)}}}showHelp(e){l.default.intro.show(e)}runAfterWelcome(){l.default.intro.runTooltipIntro()}setupPageVisibility(){let e=()=>{h.a.isPageVisible()?(this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=void 0),s.default.whenLowImpactEnd()):this.updateTimeout=setTimeout(()=>{s.default.whenLowImpactBegin()},5e3)};h.a.pageVisibilityChange&&document.addEventListener(h.a.pageVisibilityChange,e)}checkLastCodeVersion(){if(s.default.shouldWriteLocal()){var e="versionDesktop",t=+g.a.getValue(e),a=h.a[e];if(isNaN(t)&&(t=+g.a.getLegacyLocalStorage(e),isNaN(t)||(g.a.deleteLegacyLocalStorage(e),g.a.setValue(e,a))),!s.default.isDemoMode()&&t>0&&a>t)for(var i=0,r=h.a.getUpdateMessages(t),n=0;n<r.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(s.default.isString(r[n]))l.default.toasts.pushMessage({text:r[n],hold:!0});else{try{s.default.PAssert(10,s.default.isFunction(r[n]),"Must supply a valid getter fn for the message")}catch(c){s.default.reportError(c)}var d=r[n]();d.isPremiumOnly&&!l.default.billingManager.hasPremium()||l.default.toasts.pushMessage({text:d.text,hold:!0,action:d.action||o.a.MessageAction.Blog,actionText:d.actionText})}}t!==a&&g.a.setValue(e,a)}}getScrollOffset(){return this.panesContainer.scrollLeft}setScrollOffset(e,t){s.default.scrollTo(e,0,t||o.a.ScrollDuration.Default,this.panesContainer)}onUnload(){s.default.log("Unloading the page");try{var e,t=s.default.getAggregateEvents();for(var a in t)if(t.hasOwnProperty(a)){var i=t[a];s.default.sendEvent(i.category,i.action,i.count),i.count=0}if(p.a.fireEvent("onUnload",[]),s.default.hasPageDataBeenCleared()?l.default.pluginManager&&(e=l.default.pluginManager.onShutdown()):self&&l.default.pluginManager&&(e=l.default.pluginManager.onShutdown()),s.default.UIAction("PageUnload"),s.default.isLoadingRemote)return"We are still syncing your changes. Do you still want to quit?";if(s.default.isSendingEmail)return"Some emails have not been sent. Closing Moo.do will stop them from sending. Do you still want to quit?";if(s.default.isSavingDrafts)return"Your drafts are still being saved. Do you still want to quit?";if(e)return e[0]}catch(r){s.default.reportError(r)}}onImageLoaded(e,t,a){var i=e.id+s.default.hashCode(t);this.loadedImages[i]||(this.loadedImages[i]=!0,l.default.Measure.measureImage(a.target),_.a.beginBatch(e),l.default.Measure.clearCacheForItem(e.id),p.a.fireEvent("imageLoaded",[e]))}checkDragForScroll(e){var t=document.getElementById("panes");if(t){let a=t.scrollLeft,i=0,r=80,n=t.clientWidth,o=n-80,l=0;e.clientX<r&&a>0?l=s.default.computeScrollSpeed(i,r,e.clientX,4,-1):e.clientX>=o&&a<t.scrollWidth-t.clientWidth&&(l=s.default.computeScrollSpeed(o,n,e.clientX,4)),0!==l?s.default.repeatScroll("panes",l,void 0,!0):s.default.cancelRepeatScroll("panes")}}},u()(i.prototype,"mousemove",[S.a],Object.getOwnPropertyDescriptor(i.prototype,"mousemove"),i.prototype),u()(i.prototype,"onUnload",[S.a],Object.getOwnPropertyDescriptor(i.prototype,"onUnload"),i.prototype),i),I=(a(188),a(184),a(44),a(2)),b=a.n(I),D=a(71),w=a.n(D),E=a(87),C=a(15),A=a(26),M=a(149),T=a(64),L=a(50),x=a(34),k=a(77);var R=class extends C.a{getState(e){var t=e.item,a=e.pane,i={customName:a.name,rootText:a.titleOfFirstItem,viewState:a.viewState,viewMode:a.getViewMode(),text:""};if(e.viewMode)if(a.name.get())i.text=a.name.get();else{i.text=o.a.TaskViewModeTextSimple[i.viewMode];let e=a.getSortModeBlocks(),t=a.getSortModeItems(),r=e&&e!==o.a.TaskSortMode.None;r&&(i.text+=": "+o.a.TaskSortModeText[e]),t&&t!==o.a.TaskSortMode.None&&(i.text+=(r?", ":": ")+o.a.TaskSortModeText[t])}else e.paneName?i.text=a.title:(i.text=this.getTextForItem(t),i.jsx=this.getJSXForItem(t),t.els&&t.els.length&&(i.html=this.getHTMLForItem(t)));return i}init(){this._onMount()}_onMount(e){(e=e||this.props).viewMode||(this.listenTo(e.pane.document),this.listenTo(e.item.itemChanged),e.pane.getDocument()&&this.listenTo(e.pane.getDocument().text))}componentWillReceiveProps(e){e.viewMode===this.props.viewMode&&this.props.item===e.item||(this.refreshListeners(),this._onMount(e),this.updateState(e))}onMouseDown(e){this._holdTimeout=setTimeout(this.openContextMenu,150,{target:e.target})}onMouseUp(){this.clearHoldTimeout()}onClick(e){var t=this.props;s.default.isString(t.item)||(t.isLast?this.openContextMenu(e):t.pane.onClickTitle(t.item)||this.openContextMenu(e))}onRightClick(e){e.preventDefault(),this.openContextMenu(e)}onDoubleClick(e){var t=this.props.pane;s.default.isString(this.props.item)||t.onDoubleClickTitle()}onClickMenuItem(e){this.props.pane.onClickTitle(e)}onClickDocument(e){this.props.pane.setDocument(e)}clearHoldTimeout(){clearTimeout(this._holdTimeout),this._holdTimeout=void 0}getTextForItem(e){return e.generateTitleText(this.props.pane)}getHTMLForItem(e){return e.getStyledTextAsOneLine(!1,!1)}getJSXForItem(e){var t=this.getTextForItem(e),a=l.default.pluginManager.getPluginGmail();if(a.isLabelItem(e)){var i=a.getIconInfoForLabel(e).icon,r=s.default.classNames("labelText",{hasIcon:!!i});return b.a.createElement("span",{className:r},b.a.createElement("i",{className:i&&"c-foreground-light icon-"+i}),t)}return t}openContextMenu(e){var t=this.props,a=t.pane,i=t.item;!i.parent()&&a.supportsDocuments?l.default.menus.openContextMenu({fn:this.renderContextMenuDocuments,element:e.target,doc:a.getDocument(),pane:a,documents:d.a.getDocumentsArray()}):l.default.menus.openContextMenu({fn:this.renderContextMenuHold,element:e.target,item:a.getItem(),pane:a,titles:i.parent()?i.parent().items.get():i.items.get()}),this.clearHoldTimeout()}renderContextMenuDocuments(e){return b.a.createElement(L.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},b.a.createElement(T.a,{topHeader:!0},"Select document"),e.documents.map(t=>b.a.createElement(x.a,{key:t.id,active:t===e.doc,onClick:this.onClickDocument.bind(this,t)},t.text.get())))}renderContextMenuHold(e){return b.a.createElement(L.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},b.a.createElement(T.a,{topHeader:!0},this.props.pane.titleContextMenuHeader),e.titles.map(t=>{var a=this.getJSXForItem(t);return b.a.createElement(x.a,{key:t.id,active:t===e.item,onClick:this.onClickMenuItem.bind(this,t)},a)}))}render(){var e,{className:t,isFirst:a,isLast:i,viewMode:r,paneName:n,item:o,pane:l}=this.props,{text:d,jsx:h,html:c,siblingMode:u}=this.state,p=s.default.classNames("titleWrapper",t,{"c-foreground":i},{"c-foreground-very-faded c-color-hover":!i&&!r&&!n},{last:i},{firstRow:r||n},{viewMode:r}),g=s.default.classNames("title");return e=r?"<b>Click</b> to change view mode or name this pane":"<b>Click</b> to zoom to item\n<b>Press and hold</b> to zoom to select a "+(u?"sibling":"parent")+" to zoom to",b.a.createElement(k.a,{className:p,"data-tooltip":e,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:r?l.openViewMenu:this.onMouseDown,onMouseUp:this.onMouseUp,onContextMenu:this.onRightClick,ripple:!1},(h||!c)&&b.a.createElement("span",{className:g},h||d),!(h||!c)&&b.a.createElement("span",{className:g,dangerouslySetInnerHTML:{__html:c}}))}},O=a(14);var F=class extends C.a{init(){}getState(){var e=this.props.pane;return l.default.pluginManager.getPluginGmail(),{accounts:l.default.settings.syncAccounts,isOverviewVisible:e.overview.isVisible,item:e.item,showingArchived:e.showArchived,isSearchFocused:e.search.isFocused,isFocused:e.isFocused,titles:e.getTitleList()}}onPaneScroll(e){var t=this.props.pane.getScrollOffset();if(void 0===this.paneScrollOffset&&(this.paneScrollOffset=t),t!==this.paneScrollOffset&&t>0){var a=this.headerRow2Position.get()+this.paneScrollOffset-t;this.headerRow2Position.set(s.default.clamp(a,-o.a.PaneHeaderRow2Height,0))}this.paneScrollOffset=t}onMouseDown(e){e.button===o.a.ButtonCode.Left&&this.props.startDragging(e)}onMouseDownMore(e){l.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}numComplete(){return this.props.pane.getItemsToArchive().length}cloneBoard(e){A.a.cloneBoard(void 0,e)}_clonePane(e){var t=l.default.PaneManager.getPaneIndex(e),a=e.getSaveInfoForClone();l.default.PaneManager.createPaneAtIndex(a.type,t+1,a)}onClickClonePane(){this._clonePane(this.props.pane)}onClickStar(){this.cloneBoard(this.props.pane)}onClickArchiveCompleted(){var e=this.props.pane,t=this.numComplete();l.default.menus.confirm("Are you sure you want to archive "+t+" completed item"+(t>1?"s":"")+"?",function(t){t&&e.archiveCompleted()})}onDoubleClickHeader(e){s.default.hasClass(e.target,"paneDraggable")&&this.props.pane.scrollToTop(o.a.ScrollDuration.Default)}renderContextMenu(e){var t=this.props.pane,a=t.supportDataRefresh||t.supportReportError;return I.createElement(L.a,{key:"contextMenuPaneHeader",element:e.element},I.createElement(I.Fragment,null,I.createElement(x.a,{icon:"icon-close",onClick:t.onTapClosePane.bind(t)},"Close"),I.createElement("hr",null)),I.createElement(x.a,{icon:"icon-star_border",onClick:this.onClickStar},"Open pane in new board"),t.supportClone&&h.a.isFeatureEnabled(o.a.Feature.ClonePane)&&I.createElement(x.a,{icon:"icon-align-left",onClick:this.onClickClonePane},"Clone Pane"),t.supportPerformArchive&&I.createElement(x.a,{icon:"icon-task",disabled:0===this.numComplete(),onClick:this.onClickArchiveCompleted},"Archive Completed Items"),a&&I.createElement("hr",null),t.supportDataRefresh&&I.createElement(x.a,{icon:"icon-spinner",onClick:t.onClickRefreshData},"Force refresh"),t.supportReportError&&I.createElement(x.a,{icon:"icon-warning",onClick:t.onClickReportError},"Report Error"),t.widthManual&&I.createElement("hr",null),t.widthManual&&I.createElement(x.a,{icon:"icon-arrows-h",onClick:t.setWidthManual.bind(t,void 0)},"Auto-size pane"))}render(){var{titles:e,isOverviewVisible:t,isFocused:a}=this.state,{pane:i}=this.props,r=this.getChildByKey("headerButtons"),n=o.a.PaneHeaderButtonWidth,l=o.a.PaneHeaderButtonHeight,d=s.default.classNames("paneHeader c-background c-border twoRows",{focused:a});return I.createElement("div",{className:d,onDoubleClick:this.onDoubleClickHeader},I.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox",onMouseDown:this.onMouseDown},I.createElement(O.a,{className:"overviewButton",icon:"icon-menu",iconSize:15,width:n,height:l,onClick:i.onTapOverviewButton.bind(i),tooltip:(t?"Close":"Open")+" Overview"}),I.createElement("div",{className:"f1",style:{maxWidth:4}}),I.createElement("span",{className:"titles titlesRow1"},i.supportViewMenu&&I.createElement(R,{pane:i,item:e[e.length-1],viewMode:!0,row1:!0}),!i.supportViewMenu&&I.createElement(R,{pane:i,item:e[0],paneName:!0,row1:!0})),I.createElement(M.a,{pane:i}),I.createElement("div",{className:"f1 paneDraggable"}),r&&I.Children.map(r.props.children,e=>e),I.createElement(O.a,{className:"paneCloseButton",icon:"icon-more_vert",iconSize:17,width:n,height:l,onMouseDown:this.onMouseDownMore,tooltip:"Pane Options"})),I.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox paneDraggable",onMouseDown:this.onMouseDown},I.createElement(R,{key:"title_0",pane:i,item:e[0],isFirst:!0,isLast:1===e.length}),I.createElement("div",{className:"paneHeaderRow2Inner f1 paneDraggable"},I.createElement("div",{className:"paneHeaderRow2Inner2 paneDraggable"},e.map((t,a)=>{if(a>0)return I.createElement(R,{key:"title_"+a,pane:i,item:t,isLast:a===e.length-1})})))))}},N=C.b.createClass({displayName:"ReactHiddenInput",componentDisplay:o.a.ComponentDisplay.Desktop,getState:function(){return{position:this.props.pane.caretPosition}},getElement:function(){return this.refs.hiddenInput},render:function(){this.state;var e=this.state.position,t={};return e&&(t.left=e.left,t.top=e.top),b.a.createElement("div",{style:t,contentEditable:!0,className:"paneHiddenInput",ref:"hiddenInput",suppressContentEditableWarning:!0},o.a.TextSpace)}});var B=class extends C.a{init(){this.props.pane.onInfiniteListLoaded(),this.props.owner.notifyInit(this)}onMount(){this.props.hiddenInput&&(this.props.pane.hiddenInput=this.refs.hiddenInput.getElement())}onUnmount(){this.props.owner.notifyUnmounted()}getState(){var{pane:e,owner:t,overview:a}=this.props;return{cells:t.cellsObs,paddingBottom:t.paddingBottom,contentSize:t.contentSize,bottomListMessage:!a&&e.bottomListMessage(),isLoadingNewPage:e.isLoadingNewPage,isLoading:e.isLoading,statusMessage:e.getStatusMessage(this.props.overview),disablePointerEvents:t.disablePointerEvents,rect:this.props.pane.rect,items:t._itemsObs}}isIndexMounted(e){return e>=0&&!!this._getElementAtIndex(e)}getElement(){return this.refs.contentElement}_getElementAtIndex(e){for(var t,a=0,i=this.props,r=this.state,s=0;s<r.cells.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r.cells[s].index===e){t=s;break}}var n=this.getChildByKey("topBox"),o=t+(i.hiddenInput?1:0)+(n?1:0);return this.refs.contentElement.children[o]}getElementAtIndex(e){var t=this._getElementAtIndex(e);try{s.default.PAssert(692,t,"Must have a valid mounted item at index",e)}catch(a){s.default.reportError(a)}return t}handleClick(){this.props.pane.isLoading.get()&&this.state.statusMessage&&this.props.pane.handleStatusClick()}renderItems(){for(var e=0,t=[],a=this.state.cells,i=0;i<a.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(this.props.renderCell(i,a[i]))}return t}render(){var e,t=this.state,a=this.props,i=a.pane,r=s.default.classNames(a.contentClass,{noClickItems:t.disablePointerEvents}),n=t.statusMessage,l=t.contentSize+t.paddingBottom;if(!a.isLoading)if(t.bottomListMessage&&t.bottomListMessage.text&&!a.overview){var d=t.bottomListMessage,c={};c[h.a.transform.react]="translateY("+t.contentSize+"px)",e=b.a.createElement("div",{className:"paneBottomMessage c-border-light",style:c},d.clickable?b.a.createElement(O.a,{className:"paneDataPageLoad"},d.text):b.a.createElement("div",{className:"paneDataPageLoad c-foreground-very-faded"},d.text)),l+=40}else a.owner.hasItems()||(r+=" noItems"+(n?" displayStatus":""));var u={};a.orientation===o.a.Orientation.Horizontal?(u.width=(l||200)+"px",u.height="100%"):(u.height=(l||200)+"px",u.width="100%");var p=null;return a.hiddenInput&&(p=b.a.createElement(N,{ref:"hiddenInput",pane:i})),b.a.createElement("ul",{className:r,style:u,onClick:this.handleClick,spellCheck:!1,draggable:!1,ref:"contentElement","data-pane-status":n},p,this.getChildByKey("topBox"),this.renderItems(),e)}};var U=class extends C.a{init(){this.createObservables({isOn:!1})}onMount(){document.addEventListener("mousedown",this.startAnim),document.addEventListener("mouseup",this.startAnim)}onUnmount(){document.removeEventListener("mouseup",this.startAnim),document.removeEventListener("mousedown",this.startAnim),clearTimeout(this.animTimeout)}getState(){var e=this.props.pane;return{info:e.caretPosition,isWindowFocused:m.a.isWindowFocused,activePane:m.a.pane,contextMenus:l.default.menus.contextMenuStack,isPaneActive:m.a.isWindowFocused.get()&&m.a.getPane()===e&&0===l.default.menus.contextMenuStack.get().length}}onAfterChanged(e,t){e.isPaneActive&&e.info&&(e.isPaneActive!==t.isPaneActive||e.info!==t.info)&&this.startAnim(e)}startAnim(e){this.animTick(!0,e)}animTick(e,t){(t=t||this.state).isPaneActive&&t.info&&(clearTimeout(this.animTimeout),this.isOn.set(e||!this.isOn.get()),this.animTimeout=setTimeout(this.animTick,500))}render(){var e=this.state,t=this.state.info,a=t&&t.item,i=t&&t.pane,r=t&&t.paneObject,s={height:"18px"};return t&&e.isPaneActive&&m.a.isValid()&&m.a.getStartItem()?(t.isVisible&&(s.height=a&&i&&l.default.DisplaySettings.fontSizeForItem(r,a,i)+"px",s.opacity=e.isOn?1:0),s[h.a.transform.react]="translate3d("+t.left+"px, "+t.top+"px, 0)"):s[h.a.transform.react]="translate3d(-1000px, -1000px, 0)",b.a.createElement("div",{className:"caret c-bg-caret",style:s})}},H=a(25),V=a(89),j=a(86);var z=class extends C.a{init(){this.createObservables({draggedWidth:void 0})}onMouseDownResize(e){var t=this.props,a=t.line,i=this.refs.image.getBoundingClientRect(),r=l.default.Measure.getImageOriginalSize(a.src,a.srcDataUrl);this.maxWidth=Math.min(r.width,t.pane.maxWidthOfPaneObject(t.paneObject)+(t.item.hasPrefix()?o.a.PrefixWidth:0)),this.draggedWidth.set(t.line.maxWidth||i.width,!1),this.leftPos=i.left,this.rightOffset=i.right-e.clientX,t.onStartResize(),s.default.preventAndStop(e),s.default.isDraggingImage=!0}onMouseMoveResize(e){var t=e.clientX-this.leftPos+this.rightOffset;this.draggedWidth.set(s.default.clamp(t,40,this.maxWidth)),s.default.preventAndStop(e)}onMouseUpResize(){var e=this.draggedWidth.get();this.props.onEndResize(e),s.default.isDraggingImage=!1}onError(e){let t=e.target,a=this.props.item.getAttachmentByPlugin(o.a.PluginID.Drive);a&&navigator.onLine&&!this.attemptedFix&&l.default.remoteAPI().drivePermissionsPublic(a.id,()=>{this.attemptedFix=!0,console.log("Fixed image"),t.src=t.src+"&retryPermissions"},e=>{s.default.reportError(new Error("Error adding permission"))})}render(){var{line:e,style:t,isHovered:a,item:i,hasSelection:r}=this.props,n=e.srcDataUrl&&e.src!==e.srcDataUrl,o=e.isDriveImage||!l.default.settings.showMarkdown.get()||!r,d=s.default.classNames({mdImage:!e.isDriveImage},{driveImage:e.isDriveImage}),h=s.default.classNames(d,{none:n}),c=s.default.classNames("mdMarkup",{driveImageMarkup:e.isDriveImage}),u={maxWidth:!this.state.draggedWidth&&o&&e.maxWidth,width:this.state.draggedWidth},p=e.attach&&e.attach.isLocalOnlyAttachment();return b.a.createElement("span",{className:"line",style:t},e.previousText&&b.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.previousText}}),b.a.createElement("span",{className:c},e.originalText),o&&b.a.createElement("div",{className:"mdImageWrapper rel ib",style:u},b.a.createElement("img",{key:s.default.hashCode(e.src),className:h,src:e.src,onLoad:s.default.vmMain.onImageLoaded.bind(s.default.vmMain,i,e.src),onError:this.onError,"data-original-text":e.originalText,ref:"image"}),n&&b.a.createElement("img",{key:s.default.hashCode(e.srcDataUrl),className:d,src:e.srcDataUrl,onLoad:s.default.vmMain.onImageLoaded.bind(s.default.vmMain,i,e.srcDataUrl),"data-original-text":e.originalText}),p&&b.a.createElement(j.a,{style:{background:"rgba(0,0,0,0.5)"},color:"#eee",center:!0},"Uploading..."),a&&b.a.createElement(V.a,{className:"mdImageResizer flexbox flexvert",onMouseDown:this.onMouseDownResize,onMouseMove:this.onMouseMoveResize,onMouseUp:this.onMouseUpResize,globalEvents:!0})),e.nextText&&b.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.nextText}}))}},q=function(e,t,a){var i=t.overview,r=t.pane;return a.isHeader&&(r.supportCollapsing||i)&&(i||!r.isSearchedFlat())&&!e.isNote()&&!(i&&0===a.levelsDeep)},W=function(e,t,a,i){return e=e||o.a.TextSpace},G=function(e,t){var a=e.item||e;return!t.isViewAgenda()&&a.isNote()&&a.parent().getPrefix()&&(!e.block||e.block.item!==a.parent())&&o.a.PrefixWidth+o.a.LineLeftPad},K=function(){this.setState({draggingImage:!0})},Y=function(e,t,a){if(e.isDriveImage){var i=e.attach;i.getPlugin().setAttachWidth(t,i,a)}else{var r,s=t.getRawText();o.a.Regexp.MDLink.lastIndex=0,null!==(r=o.a.Regexp.MDLink.exec(s))&&(s="!["+r[2]+"]("+r[3]+" ="+a+"x)"),t.setText(s,o.a.ChangeType.Local)}setTimeout(()=>{this.setState({draggingImage:!1})},o.a.ItemTransitionTime)},X=function(e,t,a,i,r){var n=[],d=a.pane,c=a.cell.paneObject,u=d.maxWidthOfPaneObject(c)+(t.hasPrefix()?o.a.PrefixWidth:0);if(i.selected||t.isNote()){var p={top:0,width:u,height:i.height};p[h.a.transform.react]="translateX("+r+"px)",n.push(b.a.createElement("span",{key:"selStart",className:"textSelected",style:p}))}else if(void 0!==i.selectedStart){var g,f=i.lines.reduce(function(e,t){return e+s.default.unescape(t).length},0),v=i.selectedStart,y=i.selectedEnd;v<0&&(v=0),y<0&&(y=f,g=!0);var _=l.default.Measure.getCaretOffset(c,d,v,!0),S=l.default.Measure.getCaretOffset(c,d,y,m.a.preferLineStart),P=l.default.DisplaySettings.paddingForItemTop(c,t),I=l.default.DisplaySettings.paddingForItemBottom(c,t,d),D=l.default.DisplaySettings.lineHeightForItem(c,t,d),w=!t.isNote()&&S.line>_.line,E=t.shouldShowParents(c,d)?o.a.HeightAgendaParents:0,C=D+(0===_.line?P:0)+(_.line===i.lines.length-1?I:0),A=function(e,t,a,i,r){var s=r.refs.li,n=0;if(s){for(var o=0,l=s.getElementsByClassName("line"),d=0;d<e&&d<l.length;d++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;n+=l[d].getBoundingClientRect().height}0===n&&(n+=i)}return n}(_.line,0,0,E,e);if(_.lineOffset<_.lineLength||!w){var M=w||g?u-_.left:S.left-_.left,T=_.left<0?_.left:0,L={top:A,width:Math.min(M+T,u),height:C,marginLeft:G(c,d)};A+=C,L[h.a.transform.react]="translateX("+(_.left-T+r)+"px)",n.push(b.a.createElement("span",{key:"selStart",className:"textSelected textSelectedStart",style:L}))}if(w){var x=S.line-_.line,k=D+(S.line===i.lines.length-1?I:0),R=g?u:S.left;if(x>1){var O=D*(x-1),F={top:A,width:u,height:O};A+=O,F[h.a.transform.react]="translateX("+r+"px)",n.push(b.a.createElement("span",{key:"selMid",className:"textSelected textSelectedMid",style:F}))}var N={top:A,width:R,height:k};N[h.a.transform.react]="translateX("+r+"px)",n.push(b.a.createElement("span",{key:"selEnd",className:"textSelected textSelectedEnd",style:N}))}}return n},Q=function(e,t,a){return l.default.DisplaySettings.paddingForItemTop(t,e)+(e.shouldShowParents(t,a)?o.a.HeightAgendaParents:0)},$=function(e){return e.overview||e.cell.paneObject.levelsDeep>0?l.default.DisplaySettings.itemIndentSize()-1:20},J={onMount:function(e,t,a,i,r){var s=i.pane,n=i.overview;e.listenTo(t.itemChanged),e.listenToDispatcher("numListChanged"),e.listenToDispatcher("EmailPreview","onClosed"),e.listenToDispatcher("EmailPreview","openThreadChanged"),s&&!n&&t.onLoad(s)},onUnmount:function(e){e.disposeDispatcherListeners()},getState:function(e,t,a,i){var r=i.pane,n=i.cell.paneObject,d=i.overview;if(r.isDestroyed())return{};var h=m.a.isSelected(a,r),c={flags:t.flags,levelsDeep:t.levelsDeep,styleProps:t.styleProps(n,r),isHovered:m.a.isReactCellHovered(e),showVerticalLines:!d&&r.supportVertLines&&l.default.settings.ui.showVerticalLines.get(),isSelected:!d&&r===s.default.focusedPane&&H.a.isSelected(a,r),hasSelection:!!h,hasNote:t.hasNote(),isCollapsed:r.isPaneObjectCollapsed(n,d),isHighlighted:t.isHighlighted,numListNumber:t.isPrefixNumList()&&t.numListNumber(),draggedInPane:t.draggedInPane,isSearchFocused:r.search.isFocused,isBeingDragged:t.draggedInPane.get()===r,isMatchStuckHiding:r.search.isMatchStuckHiding(t)};if(d){if(c.paneItem=r.item,c.lines=[t.getStyledTextAsOneLine(!1,!1)],r.type===o.a.PaneMode.Gmail){var u=l.default.pluginManager.getPluginGmail(),p=t.getParsedText(),g=u.getIconInfoForLabel(t);g.icon&&(c.lines[0]='<span class="labelText hasIcon"><i class="c-foreground-light icon-'+g.icon+'"></i>'+p+"</span>")}c.isOverviewAtTop=r.getOverview().isItemAtTop(t),c.isOverviewDragHover=r.getOverview().isItemDragHovered(t),c.isOverviewVisibleInPane=r.type===o.a.PaneMode.Task?r.getItem()!==r.getRootItem()&&r.isOverviewVisibleInPane(t):t===r.getItem(),c.isOverviewFocused=r.getItem()===t,c.isOverviewRoot=r.getRootItem()===t}else{var f=t.getAttachmentByPlugin(o.a.PluginID.Gmail);if(c.isEmailOpen=f&&(r.type===o.a.PaneMode.Gmail&&c.isSelected||f===l.default.EmailPreview.getThreadAttach()&&l.default.EmailPreview.isOpenOnPane(r)),t.isNote())c.lines=r.getStyledLinesForPaneObject(n,d,c.hasSelection);else{var v=r.getMetricsForPaneObject(n,d,c.hasSelection);c.lines=r.search.shouldHighlightSearch()&&v.searchHighlightedLines||v.styledLines}if(c.selected=c.selectedText=c.selectedStart=c.selectedEnd=void 0,h){var y=m.a.getSelectionAtIndex(a);!0===y?c.selected=!0:y.start!==y.end&&(c.selectedStart=y.start,c.selectedEnd=y.end)}else c.selectedText=void 0;t.isNote()&&(c.parentFlags=t.parent().flags,c.parentStyleProps=t.parent().styleProps(n,r))}return c.isHeader=r.isItemHeader(t,d),c},render:function(e,t,a,i,r,n,d,c){var u=r.pane,p=r.cell.paneObject,g=r.overview,f=u.getPaddingForPaneObject(p,g),m=s.default.classNames("item c-foreground",c,n.styleProps,{"c-border-light ":!g},{"c-background":!g&&!a.isNote()},{"overviewItem c-button-overview":g},{overviewAncestor:g&&n.isOverviewAncestor},{overviewFocused:g&&n.isOverviewFocused},{"c-background-overview-selected":g&&n.isOverviewVisibleInPane},{overviewRoot:g&&n.isOverviewRoot},{overviewAtTop:g&&n.isOverviewAtTop},{overviewDragHover:g&&n.isOverviewDragHover},{collapsed:n.isCollapsed},{itemBeingDragged:n.isBeingDragged},{faded:n.faded},{"c-background-item-selected":n.isEmailOpen},{highlighted:n.isHighlighted&&u!==s.default.focusedPane},{"c-bg-faded":!g&&n.isHovered},{firstItem:0===i},{hasSelection:n.hasSelection},{hasNote:n.hasNote},{hasPrefix:!!a.getPrefixLength()},{blockHeader:p.isBlockHeader},{"c-foreground-very-faded":p.isBlockHeader&&n.isCollapsed},{stuckMatch:n.isMatchStuckHiding},{checked:a.isComplete()});return g||(d=s.default.extend({fontSize:l.default.DisplaySettings.fontSizeForItem(p,a,u),lineHeight:l.default.DisplaySettings.lineHeightForItem(p,a,u)+"px",zIndex:n.draggingImage?1:void 0},d)),b.a.createElement("li",{"data-moo-id":t,className:m,style:d,ref:"li",suppressContentEditableWarning:!0},function(e,t,a,i,r){var n=i.lines,d=a.pane,c=a.overview,u=a.cell.paneObject,p=!c&&d.maxWidthOfPaneObject(u),g=G(u,d),f=[];try{s.default.PAssert(1012,n,"If an item is being rendered it must have styled lines")}catch(S){s.default.reportError(S)}if(n){var m=0;try{s.default.PAssert(1013,!isNaN(r),"Should always have a valid number for padding")}catch(S){s.default.reportError(S)}var v={};c||(v.width=p-(g?g-5:0)),h.a.isFirefox||a.padInsteadOfTransformLines?v.marginLeft=r:c?v.paddingLeft=r:v[h.a.transform.react]="translateX("+r+"px)",c||t.isNote()?n=[n[0]||o.a.TextSpace]:p<s.default.MinItemWidth&&(n=["..."]);for(var y=0;y<n.length;++y){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var _=n[y];if(_.isImage){let a=s.default.extend({paddingTop:!c&&(0===y?Q(t,u,d):l.default.DisplaySettings.paddingForItemTop(u,t)),paddingBottom:!c&&l.default.DisplaySettings.paddingForItemBottom(u,t,d)},v);c?f.push(b.a.createElement("span",{className:"line",style:a,key:"line_"+y},_.originalText)):f.push(b.a.createElement(z,{line:_,item:t,paneObject:u,pane:d,key:"line_"+y,style:a,isHovered:i.isHovered,hasSelection:i.hasSelection,onStartResize:K.bind(e),onEndResize:Y.bind(e,_,t)}))}else{let e=s.default.classNames("line",{"c-bg-light":i.isBeingDragged},{first:0===y},{blockHeaderText:y===n.length-1&&u.isBlockHeader},{last:y===n.length-1}),r=s.default.extend({paddingTop:!c&&0===y&&Q(t,u,d),paddingBottom:!c&&y===n.length-1&&l.default.DisplaySettings.paddingForItemBottom(u,t,d),height:!c&&l.default.DisplaySettings.lineHeightForItem(u,t,d)+"px",paddingLeft:g},v);_=W(_),!a.overview&&d.isViewOutline()&&i.isHovered&&t.isPrefixHeader()&&!d.isSearchedFlat()&&y===n.length-1&&(_+='<span data-tooltip="Add new item to project" class="itemAddButton itemIgnoreText icon-add c-button" />'),d.isViewProject()&&u.isBlockHeader&&y===n.length-1&&(_+='<span class="blockHeaderNumItems itemIgnoreText ns c-foreground-faded" data-num-items="'+u.block.items.length+'" />'),f.push(b.a.createElement("span",{className:e,key:"line_"+y,style:r,dangerouslySetInnerHTML:{__html:_}}))}}}return f}(e,a,r,n,f),function(e,t,a,i,r){if(t.hasPrefix()){var s=t.els[0],n=a.cell.paneObject,o=r-5,l={paddingTop:Q(t,n,a.pane)};return h.a.isFirefox||a.padInsteadOfTransformLines||a.overview?l.marginLeft=o:l[h.a.transform.react]="translateX("+o+"px)",b.a.createElement("div",{className:s.getClassString(),style:l,"data-listnum":t.isPrefixNumList()?i.numListNumber:void 0})}}(0,a,r,n,f),function(e,t,a,i,r){var s=a.pane;if(!a.overview&&t.shouldShowParents(a.cell.paneObject,s)){var n=t.parents(s.getItem()),o=a.cell.paneObject,d=n.map(function(e,t){return e.generateTitleText()}).join(" > "),h={paddingTop:l.default.DisplaySettings.paddingForItemTop(o,t),marginLeft:r};return d&&b.a.createElement("div",{className:"itemParents c-foreground-very-faded",style:h,"data-tooltip":d},d)}}(0,a,r,0,f),function(e,t,a,i,r){if(i.showVerticalLines&&r>l.default.DisplaySettings.itemIndentStart()){var s=a.pane.extraPaddingForPaneObject(a.cell.paneObject),n=l.default.DisplaySettings.itemIndentStart()+s+6,o=r-n;if(o>0){var d={left:n,width:o};return b.a.createElement("div",{className:"vertLines",style:d})}}}(0,0,r,n,f),function(e,t,a,i,r){var n=a.pane,o=a.cell.paneObject,d=$(a);if(!a.overview&&n.supportMenuIcon&&i.isHovered&&!t.isNote()&&""!==t.getParsedText()&&(!n.isViewAgenda()||!n.shouldShowTime(a.cell.paneObject))){var c={width:r-5-(q(t,a,i)?d:0),paddingRight:d-20,height:l.default.DisplaySettings.lineHeightForItem(o,t,n)+"px",marginTop:Q(t,o,n)+"px"},u=s.default.classNames("itemMenuIcon",{"c-foreground-super-faded c-color-hover":!i.isEmailOpen},{"c-background-item-selected":i.isEmailOpen}),p="<b>Drag</b> to move.<br><b>Click</b> to open menu.<br><b>"+h.a.priModKey+" + Click</b> to zoom in.";return b.a.createElement("div",{className:u,style:c,"data-tooltip":p},b.a.createElement("i",{className:"icon-drag-handle"}))}}(0,a,r,n,f),function(e,t,a,i,r){var n=a.overview,o=a.cell.paneObject,d=a.pane;if(i.isHovered&&""===t.getParsedText()&&!t.hasChildren()){var c=s.default.classNames("emptyItemAddButton icon-add c-background c-shadow-light"),u={marginLeft:1===i.levelsDeep?-4:-12};return u[h.a.transform.react]="translateX("+(r-24)+"px)",b.a.createElement("div",{className:c,style:u})}if(q(t,a,i)){var p=s.default.classNames("collapser c-foreground-super-faded c-color-hover",{"collapsed icon-angle-right":i.isCollapsed},{"icon-angle-down":!i.isCollapsed}),g={left:Math.max(r-5-$(a),0),lineHeight:!n&&l.default.DisplaySettings.lineHeightForItem(o,t,d)+"px",paddingTop:!n&&Q(t,o,d)+"px"},f=(h.a.secModKey,"<b>Click</b> to "+(i.isCollapsed?"expand":"collapse")+" item.<br><b>Shift + Click</b> to "+(i.isCollapsed?"expand":"collapse")+" item recursively.<br><b>"+h.a.priModKey+" + Click</b> to zoom in.");return b.a.createElement("div",{className:p,style:g,"data-tooltip":f})}}(0,a,r,n,f),function(e,t,a){var i=a.pane,r=a.cell.paneObject,n=t.getMooDate();if(n&&!t.getRawText().includes(o.a.CharDate)&&!i.isViewDates()){let e=n.isRepeatDate(),a=n.toText(!0),o=s.default.classNames("itemTime c-date pointer"),l={paddingTop:Q(t,r,i)+"px"};return b.a.createElement("div",{className:o,style:l},n.getGCalId()&&b.a.createElement("i",{className:"icon-calendar"}),e&&b.a.createElement("i",{className:"icon-spinner"}),a)}}(0,a,r),function(e,t,a,i){var r,n,o=a.overview,l=a.cell.paneObject,d=a.pane,h={paddingTop:Q(t,l,d)};return o||t.isNote()?o&&i.isHovered&&d.supportClickOverviewScroll&&i.isOverviewVisibleInPane&&!i.isOverviewFocused&&(r=s.default.classNames("itemCheckbox c-button","itemOverviewZoom","icon-unfold_less"),n="Scroll to item"):d.supportCheckbox&&i.isHovered?r=s.default.classNames("itemCheckbox c-button icon-check",{checked:t.isComplete()}):d.isViewArchived()?(r=s.default.classNames("itemCheckbox c-button itemUnarchive","icon-task"),n="Unarchive"):d.isViewDeleted()&&(r=s.default.classNames("itemCheckbox c-button itemUnarchive icon-task"),n="Undelete"),r&&b.a.createElement("div",{"data-tooltip":n,className:r,style:h})}(0,a,r,n),g&&n.isHovered&&b.a.createElement("div",{className:"overviewOptions icon-more_horiz c-button"}),!g&&u.isViewAgenda()&&function(e,t,a){var i=a.pane,r=a.cell.paneObject;if(i.shouldShowTime(r)){var n,o=i.getItemDisplayTime(r);s.default.isArray(o)&&(n=!0,o=`<div>${o[0]}</div><div class="c-foreground-very-faded">${o[1]}</div>`);let e=s.default.classNames("agendaTime cursor-grab",{twoLines:n},{allDay:"All day"===o},{hasParents:t.shouldShowParents(a.cell.paneObject,i)}),l={paddingTop:Q(t,r,i)+"px"};return b.a.createElement("div",{className:e,style:l,dangerouslySetInnerHTML:{__html:o}})}}(0,a,r),!g&&(n.selected||void 0!==n.selectedStart)&&X(e,a,r,n,f))}},Z={onMount:function(e,t,a,i){e.listenTo(i.pane.dragHoveredBlock)},getState:function(e,t,a,i){return{isHovered:i.cell.paneObject.block===i.pane.dragHoveredBlock.get()}},onClickNewProject:function(e,t){var a=t.pane,i=a.getItem().numItems(),r=a.addItemToPane({text:o.a.Prefix.Header+" "},i),s=a.indexOfItem(r);m.a.selectIndex(s,0)},render:function(e,t,a,i,r,n,o,d){var h,c=a.block,u=c.isCollapsed(),p=s.default.classNames(d,"blockHeader noItem c-border-light flexbox",{blockHeaderDate:c.isDate},{"c-tag":r.pane.isViewTag()},{"c-contact":r.pane.isViewContact()},{agendaBlockRed:!u&&c.isOverdue},{dragHovered:n.isHovered},{"collapsed c-foreground-very-faded":u},{firstBlock:0===i}),g=s.default.classNames("blockCollapser c-foreground-super-faded",{"icon-angle-down":!u&&!c.isNewProject},{"icon-angle-right":u&&!c.isNewProject}),f={paddingBottom:l.default.DisplaySettings.paddingForBlockHeader()},m=b.a.createElement("span",{className:"blockHeaderNumItems c-foreground-faded"},c.numItems());if(c.isDate){var v,y=c.date,_=Date.today(),S=y.isToday()?"Today":y.isSameDay((new Date).clearTime().addDays(1))?"Tomorrow":y.toString("dddd"),P=s.default.classNames("blockHeaderText blockHeaderDayName f1 ib",{"c-foreground-light":!u});y.getMonth()===_.getMonth()&&y.getYear()===_.getYear()||(v=y.toString("MMMM"),P+=" diffMonth"),y.getYear()!==_.getYear()&&(v+=", "+y.toString("yyyy")),h=b.a.createElement(b.a.Fragment,null,b.a.createElement("span",{className:"blockHeaderDateNum"},y.getDate()),b.a.createElement("span",{className:P,style:f},S&&b.a.createElement("div",null,S,m),v&&b.a.createElement("div",{className:"blockHeaderMonth"},v)))}else if(c.isNewProject)h=b.a.createElement("span",{className:"blockHeaderText pointer f1 c-foreground-very-faded",style:f,onClick:this.onClickNewProject.bind(this,e,r)},"New project");else{var I=c.isStarred&&b.a.createElement("i",{className:"icon-star"})||c.isImportant&&b.a.createElement("i",null,"!");h=b.a.createElement("span",{className:"blockHeaderText f1",style:f},I,c.text,m)}return b.a.createElement("li",{ref:"li","data-moo-id":t,className:p,style:o},b.a.createElement("span",{className:g,onClick:c.toggleCollapsed}),h)}},ee={render:function(e,t,a,i,r,n,o){var l=s.default.classNames("hr c-border-heavy",r.className);return b.a.createElement("li",{"data-moo-id":t,className:l,style:o},a.text)}},te={onClick:function(e,t){var a=t.block;a.addFn(a)},render:function(e,t,a,i,r,n,o,l){l=s.default.classNames(l,"taskAddButton");let d=a.block,h=s.default.classNames("c-foreground-ultra-faded");return b.a.createElement("li",{ref:"li","data-moo-id":t,className:l,style:o},!d.noAddButton&&b.a.createElement(V.a,{className:h,onClick:this.onClick.bind(this,e,a,i)},b.a.createElement("i",{className:"icon-add"}),"Add item"))}},ae=a(48),ie=a(94),re=C.b.createClass({displayName:"ReactMonthDay",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){p.a.listen("endDrag",this.onDragEnd),this.createObservables({isHovered:!1}),this.listenToDispatcher("dateChanged")},arePropsEqual:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0},areStatesEqual:function(e,t,a){if("items"===e){var i=0;if(!t||!a||t.length!==a.length)return!1;for(var r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t[r].time!==a[r].time||t[r].item!==a[r].item)return!1}return!0}},componentWillReceiveProps:function(e){e.items!==this.props.items&&this.updateState(e)},getState:function(e){var t={};if(e.items){for(var a=0,i=[],r=[],s=0;s<e.items.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e.items[s];if(!n.isNote()){var d=n.getNextDate(this.props.date),h=d.hasTimeOfDay()&&d.toString(l.default.International.getFormat(o.a.DFormat.ShortTime));h?r.push({time:h,item:n}):i.push({item:n})}}t.items=i.concat(r)}return t},onMouseDown:function(e){e.preventDefault()},onMouseEnter:function(){if(l.default.DragDrop.isDragging){this.isHovered.set(!0);var e=l.default.DragDrop.dragItem.getDate();l.default.DragDrop.setBlockTarget({pane:this.props.pane,date:this.props.date,dateTime:e&&e.hasTimeOfDay()&&e,isDate:!0})}},onDragEnd:function(){this.isHovered.set(!1)},onMouseLeave:function(){this.isHovered.set(!1)},onDoubleClick:function(e){var t=this.props,a=t.pane,i=t.date,r=a.item.get(),s=new ae.a(i,{duration:o.a.DefaultEventDuration});a.openItemEditor({element:e.target,text:" "+o.a.CharDate,parent:r,selectIndex:0,mooDate:s,pos:{top:e.clientY},showCalendarButtons:!0,addOnSave:!0})},render:function(){var e,t=this.props,a=this.state,i=t.date,r=0===i.getDay()||6===i.getDay(),n=i.getDate(),l=Date.getDaysInMonth(i.getFullYear(),i.getMonth()),d=s.default.classNames("dateBlock c-border",{firstDay:1===i.getDate()},{lastDay:i.getDate()===l},{"weekend c-bg-faded":r},{"c-background":!r},{hoveredInDrag:a.isHovered},{today:i.isToday()}),h={left:t.left-1,width:t.width+1},c=s.default.classNames("dateBlockDay");if(a.items){var u=0,p=0,g=[],f=!1;for(let e=0;e<a.items.length;e++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;let t=a.items[e];t.time&&t.item.hasAttachmentType(o.a.PluginType.Calendar)&&(f=!0)}for(let e=0;e<a.items.length;e++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;let i=a.items[e],r=i.time,n=i.item,l=f&&r,d=s.default.classNames("dateBlockItem flexbox",{hasCircle:l}),h=null;if(l){var m={background:n.hasAttachmentType(o.a.PluginType.Calendar)&&n.getCalendarColor()};h=b.a.createElement("div",{className:"monthItemColorCircle",style:m})}g.push(b.a.createElement("div",{className:d,key:n.id},h,b.a.createElement(ie.a,{className:"itemInCalendar",item:n,pane:t.pane,coloredInCalendar:!r&&n.getCalendarColor(),showPriority:!0,allowDrag:!0,editOnClick:!0}),r&&t.width>100&&b.a.createElement("span",{className:"itemTime"},r)))}e=(t.items||a.isHovered)&&b.a.createElement("div",{className:"dateBlockItems"},g)}return b.a.createElement("div",{className:d,style:h,onMouseDown:this.onMouseDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onDoubleClick:this.onDoubleClick},b.a.createElement("div",{className:c},n),e)}}),se={getState:function(e,t,a,i){return{paneRect:i.pane.rect}},render:function(e,t,a,i,r,n,o){var l,d=0,h=r.pane,c=s.default.classNames("calendarWeek c-bg-app","flexbox",r.className),u=h.getWidth()+1,p=Math.floor(u/7),g=u-7*p,f=0,m=0;g>0&&(f=Math.ceil(g/2),m=g-f),o.height+=1;for(var v=0;v<a.dates.length;v++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var y=a.dates[v];y&&1===(y=y.date).getDate()&&(l=y.toString("MMMM"),y.getYear()!==Date.today().getYear()&&(l+=y.toString(" yyyy")))}return b.a.createElement("li",{"data-moo-id":t,className:c,style:o},a.dates.map(function(e,t){var a=p+(0===t?f:0)+(6===t?m:0);return b.a.createElement(re,{key:e.date.getTime(),pane:h,date:e.date,items:e.items,index:t,left:t*p+(t>0?f:0),width:a})}),l&&b.a.createElement("div",{className:"calendarMonthTitle c-bg-app"},l))}};var ne=class extends C.a{init(){this.createObservables({hoveredTime:void 0,hoveredDuration:void 0,isResizing:!1}),this.listenToDispatcher("dateChanged"),this.listenToDispatcher("endDrag")}arePropsEqual(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0}areStatesEqual(e,t,a){if("items"===e){var i=0;if(!t||!a||t.length!==a.length)return!1;for(var r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!t[r].date||!a[r].date||!t[r].date.equals(a[r].date)||t[r].item!==a[r].item||t[r].duration!==a[r].duration)return!1}return!0}}componentWillReceiveProps(e){e.date.equals(this.props.date)&&e.items===this.props.items||this.updateState(e)}getState(e){var t=e.date.isToday(),a={isToday:t,todayTime:t&&new Date,numAllDay:e.pane.numAllDay};if(a.heightHeader=e.pane.getHeightAllDay(),e.items){var i=0;a.items=[];for(var r=0;r<e.items.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=e.items[r];if(!s.isNote()){let e=s.getNextDate(this.props.date);if(e){let t=e.clone();a.items.push({date:t,duration:s.getDuration(),item:s})}}}}return a}onMount(){this.state.isToday&&this.runTimeTimer()}onUnmount(){clearTimeout(this.timeTimeout)}componentDidUpdate(e){this.props.date.equals(e.date)||(this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0))}onBeforeChanged(e,t){return e.isToday?this.runTimeTimer():t.isToday&&!e.isToday&&clearTimeout(this.timeTimeout),!t.hoveredTime||l.default.DragDrop.isDragging||this.resizing||(this.hoveredTime.set(void 0,!1),this.hoveredDuration.set(void 0,!1),e.hoveredTime=void 0,e.hoveredDuration=void 0),e}runTimeTimer(){clearTimeout(this.timeTimeout),this.timeTimeout=setTimeout(this.updateState,3e5)}resetHovered(){this.resizing&&(this.resizing.component&&this.resizing.component.stopResizing(),this.resizing=void 0,this.isResizing.set(!1)),this.mouseDownAtTime=void 0,this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0)}onMouseUp(e){document.removeEventListener("mouseup",this.onMouseUp),this.resizing&&this.resizing.placeholder?this.addTime(this.hoveredTime.get(),this.hoveredDuration.get(),e):this.resetHovered()}onMouseLeave(){this.resizing||this.resetHovered()}getTimeFromMouseEvent(e){var t=e.clientY;return l.default.DragDrop.isDragging&&l.default.DragDrop.startPane&&l.default.DragDrop.startPane.isViewDates()&&l.default.DragDrop.startInfo&&(t+=12-(l.default.DragDrop.startInfo.y-l.default.DragDrop.position.top)),t-=s.default.findParent(e.target,"calendarDayTimes").getBoundingClientRect().top,Math.floor(t/(o.a.CalendarDayViewBlockHeight+1)*4)/4}onMouseDown(e){document.addEventListener("mouseup",this.onMouseUp),s.default.hasClass(e.target,"calendarDayTimes")&&(this.mouseDownAtTime=this.getTimeFromMouseEvent(e)),e.preventDefault()}onMouseMove(e){if(void 0!==this.mouseDownAtTime&&(this.resizing={placeholder:!0,pivot:this.mouseDownAtTime},this.mouseDownAtTime=void 0),l.default.DragDrop.isDragging){var t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var a=1,i=l.default.DragDrop.dragItem;i&&i.getDuration()&&(a=i.getDuration()/o.a.MSPerHour),this.hoveredDuration.set(a,!1),this.hoveredTime.set(t),(h=this.props.date.clone()).setHours(Math.floor(t)),h.setMinutes(60*(t-Math.floor(t))),l.default.DragDrop.setBlockTarget({pane:this.props.pane,date:h,dateTime:h,duration:1!==a?a*o.a.MSPerHour:null,isDate:!0})}}else if(this.resizing&&(t=this.getTimeFromMouseEvent(e),!isNaN(t))){var r=this.resizing,s=r.pivot,n=t>=s?s:t,d=Math.floor(4*(t>=s?t-s+.5:s-t))/4;if(!isNaN(n)&&d>=.25)if(r.item){var h,c={isDate:!0};(h=this.props.date.clone()).setHours(Math.floor(n)),h.setMinutes(Math.round(60*(n-Math.floor(n)))),c.duration=d*o.a.MSPerHour,c.date=c.dateTime=h,l.default.PaneUpdateBatcher.beginUpdateItems();var u=this.props.pane;u.applyDropOnBlock(c,r.item,u),l.default.PaneUpdateBatcher.commitUpdateItems()}else r.placeholder&&(d===this.hoveredDuration.get()&&n===this.hoveredTime.get()||(this.hoveredDuration.set(d,!1),this.hoveredTime.set(n,!0)))}}onMouseEnterAllDay(){if(l.default.DragDrop.isDragging){var e=this.props.date;this.hoveredDuration.set(1,!1),this.hoveredTime.set(-1),l.default.DragDrop.setBlockTarget({pane:this.props.pane,date:e,isDate:!0,allDay:!0})}}onDoubleClickTimes(e){var t=this.getTimeFromMouseEvent(e);this.addTime(t,1,e)}addTime(e,t,a){var i=this.props,r=i.pane,s=i.date,n=r.item.get();e&&(s=s.addHours(e));let l=new ae.a(s,{duration:t*o.a.MSPerHour});r.openItemEditor({element:a.target,text:" "+o.a.CharDate,parent:n,selectIndex:0,mooDate:l,pos:{left:a.clientX,top:a.clientY},addOnSave:!0,onClosed:this.resetHovered})}onItemResizeStart(e,t,a){if(e.hasTime()){var i=e.getTimeOfDay(),r=e.getDuration()/o.a.MSPerHour||1,n=s.default.round(i/o.a.MSPerHour,4),l=a?n:n+r;return this.resizing={item:e,component:t,pivot:l},this.isResizing.set(!0),!0}}addToDay(e,t,a,i){e.push({t,dur:a,item:i,top:t,bottom:t+a,obj:i})}packItems(e){var t=0;e=e.sort(function(e,t){return e.top<t.top?-1:e.top>t.top?1:e.bottom<t.bottom?-1:e.bottom>t.bottom?1:0});for(var a=[],i=[],r=null,s=0;s<e.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[s];if(n.isPlaceholder)i=i.concat.apply(i,this.packEvents([[n]]));else{var o=0;null!==r&&n.top>=r&&(this.packEvents(a),i=i.concat.apply(i,a),a=[],r=null);for(var l=!1,d=0;d<a.length;d++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var h=a[d];if(!this.collidesWith(h[h.length-1],n)){h.push(n),l=!0;break}}l||a.push([n]),(null===r||n.bottom>r)&&(r=n.bottom)}}return a.length>0&&(this.packEvents(a),i=i.concat.apply(i,a)),i}packEvents(e){for(var t=0,a=e.length,i=0;i<a;i++){var r=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var s=e[i],n=0;n<s.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=s[n],l=this.expandEvent(o,i,e);o.pos=i/a*100,o.width=100*l/a}}return e}collidesWith(e,t){return e.bottom>t.top&&e.top<t.bottom}expandEvent(e,t,a){for(var i=0,r=1,s=t+1;s<a.length;s++){var n=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o=a[s],l=0;l<o.length;l++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var d=o[l];if(this.collidesWith(e,d))return r}r++}return r}renderItems(){var e,t=0,a=this.props,i=this.state,r=i.items,n=[],l=i.hoveredTime,d=i.hoveredDuration;for(e=0;e<r.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var h=r[e].item,c=a.pane.getItemPlacementOnDate(h,a.date);c&&this.addToDay(n,c.time,c.duration,h)}isNaN(l)||isNaN(d)||n.push({t:l,dur:d,top:l,bottom:l+d,isPlaceholder:!0});var u,p=this.packItems(n);if(p.length){var g=0;for(u=[],e=0;e<p.length;e++){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var f=p[e],m=f.isPlaceholder,v=this.props.pane,y={height:f.dur*o.a.CalendarDayViewBlockHeight+Math.ceil(f.dur)-1,left:m?0:f.pos+"%",width:m?"95%":f.width+"%",top:Math.floor(f.t*(o.a.CalendarDayViewBlockHeight+1))},_=s.default.classNames("dayTimeBlock abs",{placeholder:m});u.push(b.a.createElement("div",{className:_,key:m?"placeholder":f.item.id,style:y},f.item&&b.a.createElement(ie.a,{className:"itemInCalendar itemInCalendarResizable",item:f.item,pane:v,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}}return u}renderItemsAllDay(){for(var e=0,t=this.props,a=this.state,i=a.items,r=t.pane,s=[],n=a.hoveredTime,o={},l=0;l<i.length;l++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var d=i[l].item;t.pane.getItemPlacementOnDate(d,t.date)||s.push(b.a.createElement("div",{className:"dayTimeBlock",key:d.id,style:o},b.a.createElement(ie.a,{className:"itemInCalendar",item:d,pane:r,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}return!isNaN(n)&&n<0&&s.push(b.a.createElement("div",{className:"dayTimeBlock placeholder",key:"placeholder"})),s}render(){var e,t,a,i,r,n,l=this.props,d=this.state,c=(l.pane,l.date),u=0===c.getDay()||6===c.getDay(),p=this.renderItemsAllDay();if(d.isToday){var g=d.todayTime,f={top:Math.floor((g.getHours()+g.getMinutes()/60)*(o.a.CalendarDayViewBlockHeight+1))};n=b.a.createElement("div",{className:"calendarDayTimeLine",style:f})}e={width:l.width},t={top:d.heightHeader+30+3,height:l.height-d.heightHeader,width:l.width},a={height:d.heightHeader,minHeight:d.heightHeader},e[h.a.transform.react]=t[h.a.transform.react]=l.transform;var m=s.default.classNames("allDay c-border-heavy f1 preventScrollPropagate",{"c-bg-faded weekend":u}),v=s.default.classNames("calendarDayTimes c-border-heavy",{"c-bg-faded":u});i=b.a.createElement("ul",{className:m,style:a,onMouseEnter:this.onMouseEnterAllDay,onDoubleClick:this.addTime.bind(this,void 0,void 0),onMouseLeave:this.onMouseLeave},p),r=b.a.createElement("div",{className:v,style:t,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},b.a.createElement("div",{className:"calendarDayGradient"}),b.a.createElement("div",{className:"calendarDayItems"},this.renderItems()),n);var y,_={className:s.default.classNames("calendarDay",{"weekend c-bg-faded":u},{today:d.isToday},{resizing:d.isResizing},l.className),"data-moo-id":l["data-moo-id"]};return c.getYear()!==Date.today().getYear()&&(y=c.toString(", yyyy")),b.a.createElement(l.component,_,b.a.createElement("div",{className:"calendarDayHeader c-background c-border-heavy flexbox flexvert",style:e},b.a.createElement("div",{className:"dayTitle"},b.a.createElement("span",null,c.toString("ddd MMM ")),b.a.createElement("span",{className:"dayTitleDay"},c.getDate()),y&&b.a.createElement("span",null,y)),i),r)}},oe={getState:function(e,t,a,i){return{numAllDay:i.pane.numAllDay}},render:function(e,t,a,i,r,n,o){var l=r.pane,d=s.default.classNames("calendarDay",r.className);return b.a.createElement(ne,{"data-moo-id":t,component:"li",className:d,date:a.date,items:a.items,pane:l,height:o.height,transform:o[h.a.transform.react],width:l.getDayWidth()})}};var le=class extends C.a{init(){this.DISABLE_LISTENER_ASSERT=!0,this.allowTransition=this.props.pane.supportCellTransition&&this.props.cell.isLive,this.createObservables({isHoveredLong:!1}),this.props.list.listen("reMount",this.reMount)}areStatesEqual(e,t,a){var i=this.props.cell.isLive&&this._getRenderer();if(i&&i.areStatesEqual)return i.areStatesEqual(e,t,a)}getState(e){var t,a=e.cell,i=a.paneObject,r=i;a.isLive&&(t=this._getRenderer(),r=this._getRenderObj());var n={isLive:a.isLive,item:r,id:i&&i.id,index:a.index,height:a.height,offset:a.offset,prevOffset:a.prevOffset,renderer:t,faded:!1};return a.isLive&&t&&t.getState&&(n=s.default.extend(n,t.getState(this,r,a.index,this.props))),n}onMount(){this.listenTo(this.props.cell.cellChanged,!1),this._onMount()}onBeforeChanged(e,t){this.allowTransition=this.props.pane.supportCellTransition&&e.isLive&&this.props.cell.wasLive,this.props.pane.isViewDates()&&e.isHovered!==t.isHovered&&(e.isHovered?setTimeout(()=>{this.state.isHovered&&this.isHoveredLong.set(!0)},o.a.TooltipDelay):(this.isHoveredLong.set(!1,!1),e.isHoveredLong=!1))}componentDidUpdate(e,t){var a=this.state.item,i=t.item,r=this.state.renderer;r!==t.renderer&&t.renderer&&t.renderer.onUnmount&&t.renderer.onUnmount(this,i),a!==i&&(this.needsRefresh={prevState:t},this.props.list.isDelayingMounts||this.reMount()),r&&r.onUpdate&&r.onUpdate(this,a,this.props,this.state,e,t)}_onMount(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onMount&&t.onMount(this,e,this.state.index,this.props,this.state)}onUnmount(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onUnmount&&t.onUnmount(this,e,this.state.index,this.props,this.state)}reMount(){if(this.needsRefresh){var e=this.needsRefresh.prevState,t=e.item;this.refreshListeners(),t&&e.renderer&&e.renderer.onUnmount&&e.renderer.onUnmount(this,t),this._onMount(),this.needsRefresh=void 0}}_getRenderer(){var e,t=this.props.cell.paneObject;return s.default.isVMLI(t)?e=J:t.type===o.a.BlockType.Item?e=J:t.type===o.a.BlockType.Header?e=Z:t.type===o.a.BlockType.HR?e=ee:"calendarWeek"===t.type?e=se:"calendarDay"===t.type?e=oe:t.type===o.a.BlockType.AddItem&&(e=te),e}_getRenderObj(){var e=this.props.cell.paneObject;return"blockItem"===e.type?e.item:e}_getCellState(){var e=this.state,t={cell:this.props.cell.getState(),reactCell:{item:e.item.id,index:e.index,height:e.height,offset:e.offset,prevOffset:e.prevOffset,isLive:e.isLive}};return this.refs.li&&(t.element=s.default.getElementPath(this.refs.li)),t}getIndex(){try{s.default.PAssert(697,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(e){s.default.reportError(e)}return this.state.index}getItem(){try{s.default.PAssert(698,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(e){s.default.reportError(e)}return this.state.item}getCell(){return this.props.cell}getPaneObject(){return this.props.cell.paneObject}render(){var e=this.props,t=this.state,a=t.isLive?t.offset:-1e3,i=this.getUniqueID(),r=t.renderer,n=s.default.getItemAnimationMode(),l={height:t.height},d=s.default.classNames("cell",{transition:this.allowTransition&&n!==o.a.ItemAnimationMode.None});return e.orientation===o.a.Orientation.Horizontal?l[h.a.transform.react]="translate("+a+"px,0)":l[h.a.transform.react]="translate(0,"+a+"px)",r&&t.isLive?r.render(this,i,t.item,t.index,e,t,l,d):b.a.createElement("li",{"data-moo-id":i,className:"itemdead",style:l})}};var de=class extends C.a{getState(e){return{text:e.toast.text}}componentWillReceiveProps(e){this.updateState(e)}render(){var e=this.props.toast,t=this.state.text,a=s.default.classNames("toast noSelect",{hasAction:!!e.actionText},{big:e.isBig});return b.a.createElement("div",{className:a,onClick:e.onTapIgnore},b.a.createElement(O.a,{width:40,height:40,icon:"icon-close",className:"messageClose",onClick:e.onTapIgnore&&e.onTapIgnore}),b.a.createElement("span",{className:"messageText f1",dangerouslySetInnerHTML:{__html:t}}),b.a.createElement(O.a,{primary:!0,className:"messageAction",onClick:e.doAction.bind(e)},e.actionText))}},he=C.b.createClass({displayName:"ReactFormattingToolbar",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){},getState:function(){return{showFormattingToolbar:l.default.settings.showFormattingToolbar,position:m.a.itemHighlightPosition,pane:m.a.getPane(),numSelected:m.a.getSelectedItems().length,isCollapsed:0===l.default.settings.showFormattingToolbar.get()}},onClickFormat:function(e){m.a.applyFormatToSelection(e)},onClickPrefix:function(e){m.a.applyPrefixToSelection(e)},onClickNote:function(){var e=m.a.getStartItem();e&&m.a.editNote(e)},onClickLink:function(){m.a.getStartItem().insertLinkAtSelection()},onClickToggleShow:function(){var e=l.default.settings.showFormattingToolbar.get();e=0===e?1:0,l.default.settings.showFormattingToolbar.set(e)},render:function(){var e=this.state,t=this.props,a=e.position,i=e.position&&e.pane===t.pane,r=e.isCollapsed;if(i){var s=r?24:32,n=r?24:36,l=r?24:329,d=Math.min(Math.max(Math.floor(a.x),l/2+4),e.pane.getWidth()-l/2-4),c={height:n,width:l,marginLeft:-l/2,marginTop:-n-4};return c[h.a.transform.react]="translate3d("+d+"px,"+Math.floor(a.y)+"px,0)",r?b.a.createElement("div",{className:"formattingToolbar collapsed c-popup c-bg-sidebar c-shadow-popup",style:c},b.a.createElement(O.a,{icon:"icon-more_horiz",width:l,height:l,iconSize:14,tooltip:"Show formatting toolbar",onClick:this.onClickToggleShow})):b.a.createElement("div",{className:"formattingToolbar c-popup c-bg-sidebar c-shadow-popup",style:c},b.a.createElement(O.a,{icon:"icon-format_bold",width:s,height:n,iconSize:19,onClick:this.onClickFormat.bind(this,"**"),tooltip:"Bold",tooltipHotkey:{name:"Bold"}}),b.a.createElement(O.a,{icon:"icon-format_italic",width:s,height:n,iconSize:19,onClick:this.onClickFormat.bind(this,"*"),tooltip:"Italic",tooltipHotkey:{name:"Italic"}}),b.a.createElement(O.a,{icon:"icon-format_underlined",width:s,height:n,iconSize:18,onClick:this.onClickFormat.bind(this,"__"),tooltip:"Underline",tooltipHotkey:{name:"Underline"}}),b.a.createElement("div",{className:"divider"}),b.a.createElement(O.a,{icon:"icon-project",width:s,height:n,iconSize:18,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Header),tooltip:"Project",tooltipHotkey:o.a.Prefix.Header+"&nbsp;&nbsp; Space"}),b.a.createElement(O.a,{icon:"prefixTask",width:s,height:n,iconSize:20,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Task),tooltip:"Task",tooltipHotkey:o.a.Prefix.Task+"&nbsp;&nbsp; Space"}),b.a.createElement(O.a,{icon:"icon-bullet",width:s,height:n,iconSize:22,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Bullet),tooltip:"Bulleted list",tooltipHotkey:o.a.Prefix.Bullet+"&nbsp;&nbsp; Space"}),b.a.createElement(O.a,{icon:"icon-numlist",width:s,height:n,iconSize:14,onClick:this.onClickPrefix.bind(this,o.a.Prefix.NumList),tooltip:"Numbered list",tooltipHotkey:o.a.Prefix.NumList+"&nbsp;&nbsp; Space"}),b.a.createElement("div",{className:"divider"}),b.a.createElement(O.a,{icon:"icon-link",enabled:1===e.numSelected,width:s,height:n,iconSize:18,onClick:this.onClickLink,tooltip:"Create link",tooltipHotkey:{name:"InsertLink"}}),b.a.createElement(O.a,{icon:"icon-sticky-note-o",enabled:1===e.numSelected,width:s,height:n,iconSize:14,onClick:this.onClickNote,tooltip:"Add note",tooltipHotkey:{name:"EditNote"}}),b.a.createElement("div",{className:"divider"}),b.a.createElement(O.a,{icon:"icon-minus",width:s,height:n,iconSize:10,tooltip:"Hide formatting toolbar",onClick:this.onClickToggleShow}))}return null}}),ce=a(65);var ue=class extends C.a{init(){this.createObservables({dragOffset:0,isDragging:!1})}onMount(){var e=this.props.pane,t=e.scrollElement=this.refs.scroller.getScrollElement(),a=e.rootElement=this.refs.rootElement,i=e.paneContent=this.refs.contentElement.getElement(),r=e.getInfiniteList(!1);e.element=this.refs.pane,r.setupScroller(t,i),r.setScrollHandler(this.onScroll),a.addEventListener("compositionstart",e.compositionStart),a.addEventListener("compositionend",e.compositionEnd),e.onInput&&a.addEventListener("input",e.onInput),s.default.setupClick(t,e,{onStart:e.onTapStart,onMove:e.onTapMove,onClick:e.onTapClick,onEnd:e.onTapEnd,onDoubleClick:e.onTapDoubleClick,onRightClick:e.onTapRightClick}),e.onLoad(),e.getOverview().onPaneLoad(),p.a.fireEvent("paneAdded",[e])}getState(){var e=this.props.pane;return e.isDestroyed()?{}:{rect:e.rect,left:e.getLeft(),isExpanded:e.isExpanded,isActive:e.isActive,isOverviewVisible:e.overview.isVisible,isHelpVisible:!!l.default.intro&&l.default.intro.isVisible,item:e.item,paneTopText:e.paneTopText,orientation:e.orientation,titles:e.getTitleList(),showScrollbars:e.showScrollbars,toast:e.toast,_showFormattingToolbar:l.default.settings.showFormattingToolbar,showFormattingToolbar:l.default.settings.showFormattingToolbar.get()>0,parents:e.getItem().parents()}}getPane(){return this.props.pane}getScrollSize(){return this.props.pane.getInfiniteList(!1).getScrollSize()}getClientHeight(){return this.props.pane.getHeight()}getScrollTop(){return this.props.pane.getInfiniteList(!1).getScrollTop()}onScroll(){this.refs.scroller&&this.refs.scroller.handleScroll()}startDragging(e){s.default.hasClass(e.target,"paneDraggable")&&l.default.PaneManager.paneCount()>1&&(this.hasMovedDrag=!1,this.dragStartX=e.clientX-this.props.pane.rect.get().left,document.addEventListener("mousemove",this.onDragMove),document.addEventListener("mouseup",this.onDragUp))}onDragMove(e){this.hasMovedDrag||(this.hasMovedDrag=!0,l.default.DragDrop.isDraggingPane.set(!0),this.isDragging.set(!0));var t=this.props.pane.rect.get(),a=e.clientX-this.dragStartX-t.left;this.updateDragOffset(a),l.default.PaneManager.dragPaneTo(this.props.pane,t.left+a,t.right+a)&&this.updateDragOffset(e.clientX-this.dragStartX-this.props.pane.rect.get().left)}onDragUp(){this.isDragging.set(!1),l.default.DragDrop.isDraggingPane.set(!1),document.removeEventListener("mousemove",this.onDragMove),document.removeEventListener("mouseup",this.onDragUp),this.updateDragOffset(0)}updateDragOffset(e){this.dragOffset.set(e)}onTouchMove(e){}onMouseDownDrag(e){this._onMouseDownDrag(e,!1)}onMouseDownDragExpanded(e){this._onMouseDownDrag(e,!0)}_onMouseDownDrag(e,t){var a=this.state.rect;this.resizingInfo={startPos:e.clientX,startOffset:e.clientX-s.default.offset(this.refs.pane).left-a.width-(t?a.widthExpanded:0),startWidth:this.state.rect.width,isExpanded:t},document.addEventListener("mousemove",this.onMouseMoveResize),document.addEventListener("mouseup",this.onMouseUpResize),s.default.preventDefault(e)}onMouseMoveResize(e){var t=this.resizingInfo;if(t){var a=s.default.offset(this.refs.pane),i=e.clientX-a.left-t.startOffset;t.isExpanded&&(i-=this.state.rect.width),this.props.pane.setWidthManual(i,t.isExpanded)}}onMouseUpResize(){this.resizingInfo=void 0,l.default.PaneManager.updatePaneRects(),document.removeEventListener("mousemove",this.onMouseMoveResize),document.removeEventListener("mouseup",this.onMouseUpResize)}onDoubleClickDrag(e,t){this.props.pane.widthManual&&this.props.pane.setWidthManual(void 0,t)}onDoubleClickDragExpanded(e){this.onDoubleClickDrag(e,!0)}renderCell(e,t){var a=this.props.pane;return b.a.createElement(le,{key:e,list:a.getInfiniteList(!1),pane:a,orientation:this.state.orientation,cell:t})}render(){var e,t=this.props,a=this.state,i=t.pane,r=s.default.classNames("pane c-border",i.paneClass,t.className,{overviewOpen:a.isOverviewVisible},{expanded:a.isExpanded},{none:!a.isActive},{hasTitles:a.parents.length>0},{horizontal:a.orientation===o.a.Orientation.Horizontal},{vertical:a.orientation!==o.a.Orientation.Horizontal},{firstPane:a.rect.isFirst},{transition:!l.default.PaneManager.isResizingPane&&!a.isDragging},{dragging:a.isDragging}),n=s.default.classNames("paneScroller belowHeader c-background",{overviewOpen:a.isOverviewVisible},"f1"),d=s.default.classNames("paneRoot"),c=s.default.classNames("paneContent",{editable:i.isWriteable});i.topBoxHeight.get()>0&&(e=a.paneTopText?b.a.createElement("span",{className:"loadingText"},a.paneTopText):this.getChildByKey("topBox"));var u=b.a.createElement(B,{owner:i.getInfiniteList(!1),pane:i,overview:!1,renderCell:this.renderCell,hiddenInput:!0,contentClass:c,orientation:a.orientation,ref:"contentElement"},i.topBoxHeight.get()>0&&b.a.createElement("div",{key:"topBox",className:"paneTopBox c-background"},e)),p=i.isWriteable?b.a.createElement(U,{pane:i}):null,g=a.rect,f={width:g.width},m={left:g.width},v={left:g.width+g.widthExpanded},y="translate3d("+Math.round(a.left+(a.dragOffset||0))+"px,0,0)";return h.a.isFirefox&&!s.default.isRunningScript()?(f.left=a.left,a.dragOffset&&(f[h.a.transform.react]="translate3d("+a.dragOffset+"px,0,0)")):f[h.a.transform.react]=y,m[h.a.transform.react]=y,v[h.a.transform.react]=y,b.a.createElement(b.a.Fragment,null,b.a.createElement("div",{key:"pane","data-moo-id":this.getUniqueID(),ref:"pane",className:r,style:f},b.a.createElement(F,{pane:i,startDragging:this.startDragging},this.getChildByKey("headerButtons")),b.a.createElement(ce.a,{className:n,getScrollSize:this.getScrollSize,getClientHeight:this.getClientHeight,getScrollTop:this.getScrollTop,noOwnScroll:!0,orientation:a.orientation,showScrollbars:a.showScrollbars,ref:"scroller"},b.a.createElement("div",{className:d,ref:"rootElement",onTouchMove:this.onTouchMove},u,p,a.showFormattingToolbar&&b.a.createElement(he,{pane:i}))),this.getChildByKey("overlay"),a.toast&&b.a.createElement("div",{className:"paneToasts"},b.a.createElement(de,{toast:a.toast}))),b.a.createElement("div",{className:"paneDragHandle cursor-ew-resize",onMouseDown:a.isExpanded?this.onMouseDownDragExpanded:this.onMouseDownDrag,style:a.isExpanded?v:m,onDoubleClick:a.isExpanded?this.onDoubleClickDragExpanded:this.onDoubleClickDrag}))}},pe=C.b.createClass({displayName:"ReactPaneList",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){var e=this.props.pane;return{rect:e.rect,hasCollapsed:e.hasCollapsedObs,_allowCollapsingObs:e.search.getFilterObs("showOnlyMatches"),allowCollapsing:!e.search.getFilterValue("showOnlyMatches")}},render:function(){var e=this.state,t=this.props.pane,a=e.hasCollapsed,i=(a?"Expand":"Collapse")+" all items in view",r=o.a.PaneHeaderButtonWidth,s=o.a.PaneHeaderButtonHeight;return b.a.createElement(ue,{pane:t},b.a.createElement("div",{className:"f1",key:"headerButtons"},t.supportCollapsing&&b.a.createElement(O.a,{icon:a?"icon-angle-down":"icon-angle-right",iconSize:16,width:r,height:s,onClick:t.toggleCollapseAll.bind(t),tooltip:i,tooltipHotkey:{name:"CollapseAll",group:"Pane"},enabled:e.allowCollapsing})))}});var ge=class extends C.a{init(){this.scrollTop=void 0,this.refScroller=b.a.createRef()}getState(){var e=this.props.pane;return{numAllDay:e.numAllDay,heightAllDay:e.getHeightAllDay()}}onMount(){this.props.trackPane&&setTimeout(()=>{let e=this.props.pane.paneContent;e&&(this.onPaneScroll(),e.addEventListener("scroll",this.onPaneScroll))},0)}onUnmount(){let e=this.props.pane.paneContent;e&&e.removeEventListener("scroll",this.onPaneScroll)}onPaneScroll(){let e=this.props.pane.paneContent.scrollTop,t=this.refScroller.current;e!==this.scrollTop&&t&&(this.scrollTop=t.scrollTop=e)}render(){for(var e=0,t=this.props,a=this.state,i={height:t.height},r={height:a.heightAllDay+2},s={top:a.heightAllDay+30+2},n=[],o=0;o<24;o++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var l;12===o?l="Noon":(l=0===o?12:o%12,l+=" "+(o>=12?"pm":"am")),n.push(b.a.createElement("div",{key:o,className:"time"},l))}return b.a.createElement("div",{className:"calendarTimes belowHeader c-background",style:i},b.a.createElement("div",{className:"calendarTimesInner hideScrollbar c-border-heavy",style:s,ref:this.refScroller},n),t.showAllDay&&b.a.createElement("div",{className:"calendarTimesAllDay c-border-heavy",style:r},"All day"))}},fe=a(57),me=a.n(fe);var ve=class extends C.a{render(){return b.a.createElement(O.a,me()({},this.props,{className:"fancyCalendarDayButton",iconSize:16,padding:0,tooltip:"Jump to Today",icon:"icon-calendar-o",center:!0}),this.props.day)}},ye=o.a.TaskViewMode;var _e=class extends C.a{init(){this.listenToDispatcher("dateChanged");var e=l.default.pluginManager.getPlugin(o.a.PluginID.GCalendar);e.onSettingChanged(e.Settings.IsEnabled,this.onSettingChanged)}getState(){var e=this.props.pane,t=l.default.pluginManager.getPlugin(o.a.PluginID.GCalendar);return{item:e.item,rect:e.rect,hasCollapsed:e.hasCollapsedObs,_allowCollapsingObs:e.search.getFilterObs("showOnlyMatches"),allowCollapsing:!e.search.getFilterValue("showOnlyMatches"),viewState:e.viewState,viewMode:e.getViewMode(),isCalendarView:e.isViewCalendar(),hasPremiumFeatures:l.default.billingManager.hasPremiumFeaturesObservable,date:(new Date).getDate(),isGCalEnabled:t.isEnabled(),calendarCustomDays:l.default.settings.calendarCustomDays,dayWeekStart:l.default.settings.dayWeekStart}}onSettingChanged(){this._isMounted&&this.updateState()}onClickToday(){this.props.pane.scrollToToday(o.a.ScrollDuration.Default)}onClickJumpBack(){this.props.pane.scrollJump(-1,o.a.ScrollDuration.Default)}onClickJumpForward(){this.props.pane.scrollJump(1,o.a.ScrollDuration.Default)}onClickAddItem(e){this.props.pane.addItem({index:0,prefix:e})}onClickAddFile(e,t){var{pane:a}=this.props;l.default.menus.openContextMenu({componentName:"ReactContextMenuDropZone",element:t.target,pane:a,itemParent:a.getItem(),insertIndex:0,image:e})}onClickAddItemPopup(e){this.props.pane.openItemEditor({element:e.target,addOnSave:!0})}onClickViewMode(e){this.props.pane.setViewMode(e)}renderPaneBox(){var e=this.props.pane,t=e.isViewOutline()||e.isViewProjectNoBlocks();return b.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-faded"},b.a.createElement(O.a,{icon:"icon-project",iconSize:16,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Header),tooltip:"Add project"}),t&&b.a.createElement(O.a,{icon:"icon-edit",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,""),tooltip:"Add item"}),t&&b.a.createElement(O.a,{icon:"icon-check",iconSize:14,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Task),tooltip:"Add task"}),t&&b.a.createElement(O.a,{icon:"icon-bullet",iconSize:22,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Bullet),tooltip:"Add bullet"}),t&&b.a.createElement(O.a,{icon:"icon-numlist",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.NumList),tooltip:"Add numbered list"}),t&&b.a.createElement(O.a,{icon:"icon-drive-file",iconSize:14,width:44,onClick:this.onClickAddFile.bind(this,!1),tooltip:"Add file"}),t&&b.a.createElement(O.a,{icon:"icon-image",iconSize:14,width:44,onClick:this.onClickAddFile.bind(this,!0),tooltip:"Add image"}))}render(){var e,t,a,i=this.state,r=this.props.pane,n=this.state.viewMode,l=o.a.TaskViewModeText[n],d=i.rect.width>550,h=o.a.PaneHeaderButtonWidth,c=o.a.PaneHeaderButtonHeight,u=s.default.classNames(i.isCalendarView?"calendar"+o.a.TaskViewModeText[n]+"View c-background":"",{showingButtons:i.isCalendarView},{premiumBlocked:r.isViewPremiumBlocked()}),p=i.hasCollapsed,g=o.a.SearchHeight,f=(p?"Expand":"Collapse")+" all items in view",m=r.isViewAgenda()&&[ye.Agenda_Today,ye.Agenda_Week,ye.Agenda_All]||r.isViewCalendar()&&[ye.Calendar_Day,ye.Calendar_Custom,ye.Calendar_Week,ye.Calendar_Month],v=b.a.createElement(ve,{day:this.state.date,height:g,width:g,onClick:this.onClickToday});return a=b.a.createElement("div",{key:"headerButtons"},r.isViewDates()&&b.a.createElement("div",{className:"calendarButtons"},r.isViewCalendar()&&b.a.createElement("div",{className:"borderButtons ib c-border-light"},b.a.createElement(O.a,{icon:"icon-caret-left",width:d?20:14,height:g,onClick:this.onClickJumpBack,enabled:i.isCalendarView,tooltip:"Previous "+l}),v,b.a.createElement(O.a,{icon:"icon-caret-right",width:d?20:14,height:g,onClick:this.onClickJumpForward,enabled:i.isCalendarView,tooltip:"Next "+l})),r.isViewAgenda()&&v,d&&b.a.createElement("div",{className:"viewModeButtons borderButtons ib c-border-light"},m.map(function(e){var t=o.a.TaskViewModeText[e];return e===ye.Calendar_Custom&&(t=t.replace("#",i.calendarCustomDays)),b.a.createElement(O.a,{height:g,selected:i.viewMode===e,onClick:this.onClickViewMode.bind(this,e),key:e},t)}.bind(this)))),r.supportCollapsing&&!r.isViewCalendar()&&b.a.createElement(O.a,{icon:p?"icon-angle-down":"icon-angle-right",iconSize:16,width:h,height:c,onClick:r.toggleCollapseAll.bind(r),tooltip:f,tooltipHotkey:{name:"CollapseAll",group:"Pane"},enabled:i.allowCollapsing})),r.isViewCalendar()?e=n===ye.Calendar_Month?b.a.createElement("div",{className:"calendarMonthDays belowHeader c-background c-border-heavy flexbox",key:"overlay"},0===i.dayWeekStart&&b.a.createElement("div",null,"SUN"),b.a.createElement("div",null,"MON"),b.a.createElement("div",null,"TUE"),b.a.createElement("div",null,"WED"),b.a.createElement("div",null,"THU"),b.a.createElement("div",null,"FRI"),b.a.createElement("div",null,"SAT"),1===i.dayWeekStart&&b.a.createElement("div",null,"SUN")):b.a.createElement(ge,{pane:r,key:"overlay",trackPane:!0,showAllDay:!0}):r.isViewAgenda()?t=b.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-faded"},b.a.createElement(O.a,{onClick:this.onClickAddItemPopup},"Add Item")):r.shouldShowAddBox()&&(t=this.renderPaneBox()),b.a.createElement(ue,{pane:r,className:u},e,t&&b.a.createElement("div",{key:"topBox"},t),a)}};var Se=class extends C.a{onMount(){this.listenTo(this.props.pane.search.onChanged)}getState(){var e=this.props.pane;return e.isDestroyed()?{}:{rootItem:e.item,messageIDs:l.default.EmailPreview.messageIDs,messages:l.default.EmailPreview.getMessages(),viewState:e.viewState,viewMode:e.getViewMode()}}onHoldViewButton(e){l.default.menus.openContextMenu({fn:this.renderContextMenuSort,element:e.target})}onClickViewButton(){var e=this.state.viewMode===o.a.GmailViewMode.Priority?o.a.GmailViewMode.Date:o.a.GmailViewMode.Priority;this.setViewMode(e),l.default.menus.closeContextMenu()}renderContextMenuSort(e){return b.a.createElement(L.a,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:e.element},b.a.createElement(T.a,null,"Sort by"),b.a.createElement(x.a,{icon:"icon-access_time",onClick:this.setViewMode.bind(this,o.a.GmailViewMode.Date)},o.a.GmailViewMode.Date),b.a.createElement(x.a,{icon:"icon-exclamation",onClick:this.setViewMode.bind(this,o.a.GmailViewMode.Priority)},o.a.GmailViewMode.Priority))}setViewMode(e){this.props.pane.setViewMode(e)}renderViewButton(){var e=this.state.viewMode===o.a.GmailViewMode.Date?"icon-access_time":"icon-exclamation";return b.a.createElement(O.a,{key:"sort",className:"emailViewButton",tooltip:"Sort Order",icon:e,iconSize:14,width:o.a.PaneHeaderButtonWidth,height:o.a.PaneHeaderButtonHeight,onClick:this.onClickViewButton,onHold:this.onHoldViewButton})}render(){return this.props.pane,b.a.createElement(ue,{key:"pane",pane:this.props.pane},b.a.createElement("div",{key:"headerButtons"},this.renderViewButton()))}},Pe=C.b.createClass({displayName:"ReactDragDrop",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){var e=l.default.DragDrop;l.default.PaneManager;return{items:e.draggingItems,activePane:e.activePane,pane:e.startPane,position:e.position,transform:e.transform,isDragging:e.isInDrag,linePosition:e.linePosition,fromOverview:e.fromOverview,dropBucketItems:l.default.dropBucket.getItems(),onlineText:d.a.onlineText(),contextMenus:l.default.menus.contextMenuStack}},onBeforeChanged:function(e,t){if(e.items!==t.items){var a=0;this.paddings=[];for(let t=0;t<e.items.length;t++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.paddings[t]=e.pane.getPaddingForPaneObject(e.items[t])-8}}},render:function(){var e,t,a,i=this.state,r=i.pane,n=i.items;if(r&&i.isDragging){if(n&&n.length>0&&i.position&&i.transform){var o=0,l=[],d=Math.min(n.length,10);for(let e=0;e<d;++e){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=this.paddings[e];l.push(b.a.createElement(ie.a,{key:"drag_"+e,pane:r,item:n[e].item,paneObject:n[e],renderLikePane:!0,noNotes:i.fromOverview,padding:c}))}var u=n.length-d;u>0&&l.push(b.a.createElement("div",{className:"dotdotdot",key:"dotdotdot"},"... plus "+u+" more ..."));var p=i.position,g={left:p.left+8,top:p.top,width:r.widthOfDrag(n[0]),maxWidth:r.getWidth()},f=i.transform;g[h.a.transform.react]="translate3d("+f.left+"px, "+f.top+"px, 0)",e=b.a.createElement("ul",{id:"dragUL",style:g,className:"popup c-shadow-popup c-background"},l)}if(i.linePosition&&i.activePane){var m=i.linePosition,v={width:m.width,height:m.height},y=s.default.classNames({isLine:!m.height});v[h.a.transform.react]="translate("+m.left+"px, "+m.top+"px)",t=b.a.createElement("div",{id:"dragLine",style:v,className:y})}a=s.default.classNames("from_"+r.type,i.activePane.paneClass)}return b.a.createElement("div",{id:"dragdrop",className:a},e,t)}}),Ie=a(192),be=a(151),De=a(70);var we=class extends C.a{init(){(this.props.canMinimize||this.props.canMaximize)&&this.createObservables({minimized:!1,maximized:!1})}minimize(){let e=!this.minimized.get();e&&this.maximized.set(!1,!1),this.minimized.set(e)}maximize(){let e=!this.maximized.get();e&&this.minimized.set(!1,!1),this.maximized.set(e)}render(){var{className:e,canMinimize:t,canMaximize:a,close:i,title:r,width:n,height:o,children:l,...d}=this.props,{minimized:h,maximized:c}=this.state,u={height:!c&&(h?36:o),width:!c&&n},p=s.default.classNames(e,"fancyOverlayPopup popup c-shadow-popup c-background",{minimized:h},{f1:c}),g=t&&s.default.classNames("popupMinimize",{minimized:h});let f=b.a.createElement("div",me()({},d,{className:p,style:u}),b.a.createElement("div",{className:"overlayTitleBar c-foreground c-border-heavy c-bg-popup-title flexbox"},b.a.createElement("div",{className:"displayTitle f1"},r),t&&b.a.createElement(O.a,{className:g,icon:"icon-minus",iconSize:14,width:36,height:36,onClick:this.minimize,tooltip:h?"Restore":"Minimize"}),a&&b.a.createElement(O.a,{icon:c?"icon-filter_none":"icon-check_box_outline_blank",iconSize:14,width:36,height:36,onClick:this.maximize,tooltip:c?"Restore":"Maximize"}),b.a.createElement(O.a,{icon:"icon-close",width:36,height:36,onClick:i,tooltip:"Close"})),l);return c?b.a.createElement("div",{className:"fancyOverlayPopupMaximized flexbox flexvert absFull maximized"},b.a.createElement("div",{className:"fancyModalBackdrop"}),f):f}};var Ee=class extends C.a{init(){this.createObservables({showAdvanced:l.default.billingManager.hasPremiumFeatures()})}onMount(){}getState(){return{isOpen:s.default.vmMain.isDisplaySettingsOpen,colorTheme:l.default.settings.ui.theme,displaySpacing:l.default.settings.ui.displaySpacing,displayPrefixes:l.default.settings.ui.displayPrefixes}}updateSetting(e,t){e.set(t)}onClickColorTheme(e){l.default.DisplaySettings.changeColorTheme(e)}onClickTheme(e,t){l.default.DisplaySettings.changeTheme(e,t)}isGrayscale(){return!0===l.default.settings.ui.grayscale.get()}toggleAdvanced(){this.showAdvanced.set(!this.showAdvanced.get())}updateGrayscale(e){l.default.settings.ui.grayscale.set(e),this.forceUpdate()}close(){s.default.vmMain.isDisplaySettingsOpen.set(!1)}renderCheckbox(e,t){return b.a.createElement(De.a,{checked:e.get(),onChange:this.updateSetting.bind(this,e)},t)}renderNumber(e){return b.a.createElement(Ie.a,{value:e.get(),onChange:this.updateSetting.bind(this,e)})}renderColorPicker(e){return b.a.createElement(be.a,{color:e.get(),onChange:this.updateSetting.bind(this,e)})}render(){let e,t=this.state,a=this.isGrayscale(),i=l.default.settings.ui;if(t.isOpen&&t.showAdvanced){let t=s.default.classNames("settingsAdvanced",{disabledSettings:!l.default.billingManager.hasPremiumFeatures()}),r=s.default.classNames({disabled:a});e=b.a.createElement("div",null,b.a.createElement("div",{className:"header c-foreground-very-faded"},"ADVANCED (PREMIUM)"),b.a.createElement("div",{className:t},b.a.createElement("div",null,b.a.createElement("span",null,"Item Font Size: "),this.renderNumber(i.fontSize)),b.a.createElement("div",null,b.a.createElement("span",null,"Project Font Size: "),this.renderNumber(i.fontSizeHeader)),b.a.createElement("div",null,b.a.createElement("span",null,"Top Level Project Font Size: "),this.renderNumber(i.fontSizeHeaderTopLevel)),b.a.createElement("div",null,b.a.createElement("span",null,"Note Font Size: "),this.renderNumber(i.noteFontSize)),b.a.createElement("div",null,b.a.createElement("span",null,"Item Line Height: "),this.renderNumber(i.itemLineHeight)),b.a.createElement("div",null,b.a.createElement("span",null,"Item Padding: "),this.renderNumber(i.itemPadding)),b.a.createElement("div",null,b.a.createElement("span",null,"Indent Size: "),this.renderNumber(i.itemIndentSize)),b.a.createElement("div",null,b.a.createElement("span",null,"Project Opacity: "),this.renderNumber(i.projectOpacity)),b.a.createElement("div",null,b.a.createElement("span",null,"Bullet Opacity: "),this.renderNumber(i.bulletOpacity)),b.a.createElement("div",null,b.a.createElement("span",null,"Checkbox Opacity: "),this.renderNumber(i.checkboxOpacity)),b.a.createElement("div",null,b.a.createElement("span",null,"Checkbox Background: "),this.renderNumber(i.checkboxBackgroundOpacity)),b.a.createElement("div",null,b.a.createElement("span",null,"Vertical Lines Opacity: "),this.renderNumber(i.verticalLinesOpacity)),a&&b.a.createElement("div",{className:"colorsDisabled"},"Colors disabled in Grayscale mode"),b.a.createElement("div",{className:r},b.a.createElement("span",null,"Tag Color: "),this.renderColorPicker(i.tagColor)),b.a.createElement("div",{className:r},b.a.createElement("span",null,"Date Color: "),this.renderColorPicker(i.dateColor)),b.a.createElement("div",{className:r},b.a.createElement("span",null,"Contact Color: "),this.renderColorPicker(i.contactColor)),b.a.createElement("div",{className:r},b.a.createElement("span",null,"Link Color: "),this.renderColorPicker(i.linkColor)),b.a.createElement("div",null,this.renderCheckbox(i.underlineP,"Underline tags, dates, contacts"))))}var r=t.isOpen&&b.a.createElement("div",{className:"sidebar displaySettings"},b.a.createElement(we,{title:"Display Settings",close:this.close},b.a.createElement(ce.a,null,b.a.createElement("div",null,b.a.createElement("div",{className:"header first c-foreground-very-faded"},"COLOR THEME"),b.a.createElement("div",{className:"themeButtons"},b.a.createElement(O.a,{raised:!0,primary:t.colorTheme===o.a.ColorTheme.Light,height:32,onClick:this.onClickColorTheme.bind(this,o.a.ColorTheme.Light)},"Light"),b.a.createElement(O.a,{raised:!0,primary:t.colorTheme===o.a.ColorTheme.Dark,height:32,onClick:this.onClickColorTheme.bind(this,o.a.ColorTheme.Dark)},"Dark")),b.a.createElement("div",{className:"header c-foreground-very-faded"},"SPACING"),b.a.createElement("div",{className:"themeButtons"},b.a.createElement(O.a,{raised:!0,primary:t.displaySpacing===o.a.DisplayTheme.SpacingCompact,height:32,onClick:this.onClickTheme.bind(this,i.displaySpacing,o.a.DisplayTheme.SpacingCompact)},"Compact"),b.a.createElement(O.a,{raised:!0,primary:t.displaySpacing===o.a.DisplayTheme.SpacingComfortable,height:32,onClick:this.onClickTheme.bind(this,i.displaySpacing,o.a.DisplayTheme.SpacingComfortable)},"Comfortable")),b.a.createElement("div",{className:"header c-foreground-very-faded"},"PREFIXES"),b.a.createElement("div",{className:"themeButtons"},b.a.createElement(O.a,{raised:!0,primary:t.displayPrefixes===o.a.DisplayTheme.PrefixesFaded,height:32,onClick:this.onClickTheme.bind(this,i.displayPrefixes,o.a.DisplayTheme.PrefixesFaded)},"Faded"),b.a.createElement(O.a,{raised:!0,primary:t.displayPrefixes===o.a.DisplayTheme.PrefixesStrong,height:32,onClick:this.onClickTheme.bind(this,i.displayPrefixes,o.a.DisplayTheme.PrefixesStrong)},"Strong")),b.a.createElement("div",{className:"header c-foreground-very-faded"},"OPTIONS"),b.a.createElement("div",null,b.a.createElement(De.a,{checked:a,onChange:this.updateGrayscale},"Grayscale")),b.a.createElement("div",{style:{marginTop:8}},b.a.createElement(De.a,{checked:l.default.settings.ui.boldHeaders.get(),onChange:this.updateSetting.bind(this,i.boldHeaders)},"Automatically Bold Parents")),b.a.createElement("div",{style:{marginTop:8}},this.renderCheckbox(i.showVerticalLines,"Show Vertical Lines"))),e,b.a.createElement("div",{style:{marginTop:16,textAlign:"center"}},b.a.createElement(O.a,{raised:!0,onClick:this.toggleAdvanced},(t.showAdvanced?"Hide":"Show")+" Advanced (Premium)")))));return b.a.createElement(E.CSSTransitionGroup,{transitionName:"previewOpen",component:"div",transitionEnterTimeout:200,transitionLeaveTimeout:200},r)}},Ce=a(35),Ae=C.b.createClass({displayName:"ReactIntroItem",componentDisplay:o.a.ComponentDisplay.Desktop,getState:function(){var e=this.props.item;return{isComplete:e.isComplete,isDisabled:e.isDisabled,text:e.text,jsx:e.jsx,isVisible:e.visibleObservable,isHidden:e.hiddenObservable}},render:function(){var e=this.state,t=s.default.classNames({checked:e.isComplete},{disabled:e.isDisabled}),a=s.default.classNames("icon-check",{"c-foreground-super-faded":!e.isComplete},{"c-blue":e.isComplete});return!1!==e.isVisible&&!0!==e.isHidden&&b.a.createElement("li",{className:t},b.a.createElement("span",{className:a}),e.text&&b.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.text}}),e.jsx)}}),Me=C.b.createClass({displayName:"ReactHelpSidebar",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){this.intro=l.default.intro},onMount:function(){},getState:function(){return{isOpen:this.intro.isVisible,sections:this.intro.sections,mode:this.intro.mode}},close:function(){this.intro.close()},onTapFeatures:function(){this.intro.setMode(o.a.HelpMode.Normal),this.refs.scroller.scrollTo(0,0,0)},onTapHotkeys:function(){this.intro.setMode(o.a.HelpMode.Hotkeys),this.refs.scroller.scrollTo(0,0,0)},renderSection:function(e){return b.a.createElement("div",{className:"helpSection c-border-heavy",key:e.id||e.text},b.a.createElement("div",{className:"helpTitle"},e.text),e.note&&b.a.createElement("div",{className:"helpNote c-foreground-faded"},e.note),b.a.createElement("ul",null,e.items.map(function(e,t){return b.a.createElement(Ae,{item:e,key:t})})))},renderHotkeySection:function(e){var t=Ce.a.config[e],a=[];for(let c in t)if(t.hasOwnProperty(c)){var i=0,r=0,s=t[c],n=c;for(let e=n.length-1;e>=0;e--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;(n[e]>="A"&&n[e]<="Z"||!isNaN(n[e])&&(0===e||isNaN(n[e-1])))&&(n=n.substr(0,e)+" "+n.substr(e))}var o=0;for(let e=0;e<s.length;e++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=s[e].split(":"),d=!h.a.app&&l.indexOf("app")>=0;l.indexOf("win")>=0&&h.a.mac||l.indexOf("mac")>=0&&!h.a.mac||(a.push(b.a.createElement("li",{key:c+"-"+e,className:o>0?"hotkeyOr":""},b.a.createElement("span",null,b.a.createElement("span",{className:"helpHotkeyName ib"},0===o&&n),b.a.createElement("span",{className:"introHotkey c-bg-light c-blue"},Ce.a.printHotkey(s[e])+(d?" (App only)":""))))),o++)}}return b.a.createElement("div",{className:"helpSection helpHotkeys c-border-heavy",key:e},b.a.createElement("div",{className:"helpTitle"},e),b.a.createElement("ul",null,a))},renderHotkeys:function(){return[this.renderHotkeySection("Pane"),this.renderHotkeySection("Global"),this.renderHotkeySection("Email")]},render:function(){var e=this.state;if(e.isOpen){var t=[];if(e.mode===o.a.HelpMode.Hotkeys)t=this.renderHotkeys();else for(var a=0,i=0;i<e.sections.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e.sections[i].noRender||t.push(this.renderSection(e.sections[i]))}var r=s.default.classNames("tab tabFeatures c-border-heavy f1",{selected:e.mode===o.a.HelpMode.Normal}),n=s.default.classNames("tab tabHotkeys c-border-heavy f1",{selected:e.mode===o.a.HelpMode.Hotkeys}),l=s.default.classNames("sidebar sidebarHelp intro",{helpHotkeys:e.mode===o.a.HelpMode.Hotkeys},{helpNormal:e.mode===o.a.HelpMode.Normal}),d=e.isOpen&&b.a.createElement("div",{className:l},b.a.createElement(we,{title:"Help",close:this.close},b.a.createElement("div",{className:"helpHeaderRow flexbox"},b.a.createElement(O.a,{height:36,className:r,onClick:this.onTapFeatures},"Features"),b.a.createElement(O.a,{height:36,className:n,onClick:this.onTapHotkeys},"Hotkeys")),b.a.createElement(ce.a,{ref:"scroller"},t)))}return b.a.createElement(E.CSSTransitionGroup,{transitionName:"previewOpen",component:"div",transitionEnterTimeout:200,transitionLeaveTimeout:200},d)}}),Te=a(6),Le=a(51);var xe=class extends C.a{init(){var e=A.a.isAdding();e&&A.a.setIsAdding(!1),this.createObservables({isEditing:e})}getState(){return{name:this.props.board.name,selected:A.a.selected}}onBeforeChanged(e,t){e.selected!==t.selected&&e.isEditing&&e.selected!==this.props.board&&(this.isEditing.set(!1,!1),e.isEditing=!1)}onMouseEnter(){l.default.DragDrop.isDragging&&!this.props.active&&this.onClick()}openMenu(e){l.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}onClickRemove(){this.props.active?l.default.tooltip.displayTip({text:"Cannot remove the active board.",element:this.refs.element}):A.a.removeBoard(this.props.board)}onClickClone(){A.a.cloneBoard(this.props.board)}onClick(){l.default.PaneManager.switchToBoard(this.props.board)}edit(){this.isEditing.set(!0)}rename(){if(this.state.isEditing){var e=this.refs.input.getValue();A.a.renameBoard(this.props.board,e)?this.isEditing.set(!1):l.default.tooltip.displayTip({text:"Please give this board a unique name.",element:this.refs.element})}}onEscape(){this.refs.input.setValue(this.state.name),this.isEditing.set(!1)}onClickSaveDefault(){A.a.saveBoardDefault(this.props.board)}onClickRestoreDefault(){A.a.restoreBoardDefault(this.props.board)}renderContextMenu(e){let t=!this.props.board.defaultPanes;return b.a.createElement(L.a,me()({},e,{key:"contextMenuBoard",id:"contextMenuBoard"}),b.a.createElement(x.a,{onClick:this.edit},"Rename"),b.a.createElement(x.a,{onClick:this.onClickClone},"Clone as new board"),b.a.createElement("hr",null),b.a.createElement(x.a,{onClick:this.onClickSaveDefault},"Save view as default"),b.a.createElement(x.a,{disabled:t,onClick:this.onClickRestoreDefault},"Restore default view"),b.a.createElement("hr",null),b.a.createElement(x.a,{onClick:this.onClickRemove},"Delete"))}render(){var{inSidebar:e,inSidebarSmall:t,fontSize:a,className:i,active:r,buttonSize:n}=this.props,o=this.state,l=s.default.classNames(i,{"toolbarBoard c-border-light":!e},{"sidebarBoard c-bg-sidebar":e},{"active c-background":r}),d=o.name||"Board",h=d;return t&&(h=h.substr(0,Math.min(h.length,4))),b.a.createElement("div",{className:l,ref:"element",onMouseEnter:this.onMouseEnter},o.isEditing&&b.a.createElement(Le.a,{height:n,fontSize:a,padding:t?{left:2,right:2}:void 0,value:d,border:!1,focused:!0,selectAll:!0,onEnter:this.rename,onBlur:this.rename,onEscape:this.onEscape,ref:"input"}),!o.isEditing&&b.a.createElement(O.a,{height:n,fontSize:a,onClick:this.onClick,selected:r,onMouseEnter:this.onMouseEnter,onDoubleClick:this.edit,onRightClick:this.openMenu,ref:"menu"},h,e&&!t&&b.a.createElement("i",{className:"icon-drag-handle c-button"})))}},ke=a(144);var Re=class extends C.a{init(){this.createObservables({isHovered:!1})}getState(){return{hasPremiumFeatures:l.default.billingManager.hasPremiumFeaturesObservable,boards:A.a._boards,selectedIndex:A.a.selectedIndex}}moveChild(e,t){A.a.moveTo(e,t)}onMouseEnter(){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){s.default.hasClass(e.target,"sidebarDragHandle")||!s.default.isAttachedToDoc(e.target)||s.default.findParent(e.target,"sidebarBoardOutside")||s.default.findParent(e.target,"sidebarBoard")||this.onMouseLeave()}onMouseLeave(){this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove)}addBoard(){var e=this.refs.newButton.getElement();!l.default.billingManager.hasPremiumFeatures()&&this.state.boards.length>=o.a.PremiumMaxBoards?l.default.menus.openContextMenu({componentName:"ReactContextMenuUpsell",element:e,premiumMessage:"Using more than "+o.a.PremiumMaxBoards+" boards is a Premium feature that allows you to customize your workflow and save multiple sets of panes.",enableMessage:"unlimited Boards"}):(l.default.PaneManager.addBoard(),Te.d.performAction(Te.b.UIAction,{type:Te.c.AddBoard}))}onClickNew(){this.addBoard()}onClickAddPane(e){l.default.menus.openAddPaneMenu({element:e.target})}render(){for(var e=0,t=this.state,a=this.props,i=(s.default.classNames({upsell:!t.hasPremiumFeatures}),s.default.classNames({flexbox:!a.isSmall})),r=[],n=0;n<t.boards.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var l=t.boards[n];r.push(b.a.createElement(xe,{key:l.id,board:l,fontSize:12,active:n===t.selectedIndex,buttonSize:a.buttonSize}))}return b.a.createElement("div",{className:"toolbarBoards"},b.a.createElement(ce.a,{orientation:o.a.Orientation.Horizontal,showScrollbars:!0,tinyMode:!0},b.a.createElement(ke.a,{moveChild:this.moveChild,onMouseEnter:this.onMouseEnter,horizontal:!0},r),b.a.createElement("span",{className:i},b.a.createElement(O.a,{icon:"icon-add",iconSize:16,width:a.buttonSize,height:a.buttonSize,onClick:this.onClickNew,tooltip:"Add new board",ref:"newButton"}))))}},Oe=C.b.createClass({displayName:"ReactSidebarBoards",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isHovered:!1}),window.addEventListener("mouseout",this.onWindowOut)},getState:function(){return{hasPremiumFeatures:l.default.billingManager.hasPremiumFeaturesObservable,boards:A.a._boards,selectedIndex:A.a.selectedIndex}},onUnmount:function(){document.removeEventListener("mouseout",this.onWindowOut)},moveChild:function(e,t){A.a.moveTo(e,t)},onMouseEnter:function(){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)},onMouseMove:function(e){s.default.hasClass(e.target,"sidebarDragHandle")||!s.default.isAttachedToDoc(e.target)||s.default.findParent(e.target,"sidebarBoardOutside")||s.default.findParent(e.target,"sidebarBoard")||this.onMouseLeave()},onWindowOut:function(e){(e.pageX>=h.a.windowWidth()||e.pageY>=h.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.isHovered.set(!1)},onMouseLeave:function(e){this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove)},addBoard:function(){var e=this.refs.newButton.getElement();!l.default.billingManager.hasPremiumFeatures()&&this.state.boards.length>=o.a.PremiumMaxBoards?l.default.menus.openContextMenu({componentName:"ReactContextMenuUpsell",element:e,premiumMessage:"Using more than "+o.a.PremiumMaxBoards+" boards is a Premium feature that allows you to customize your workflow and save multiple sets of panes.",enableMessage:"unlimited Boards"}):(l.default.PaneManager.addBoard(),Te.d.performAction(Te.b.UIAction,{type:Te.c.AddBoard}))},onClickNew:function(){this.addBoard()},render:function(){for(var e=0,t=this.state,a=this.props,i=[],r=0;r<t.boards.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=t.boards[r];i.push(b.a.createElement(xe,{key:s.id,board:s,active:r===t.selectedIndex,fontSize:a.fontSize,buttonSize:a.buttonSize,inSidebar:!0,inSidebarSmall:a.isSmall}))}return b.a.createElement("div",{className:"sidebarBoards"},b.a.createElement(ke.a,{moveChild:this.moveChild,onMouseEnter:this.onMouseEnter},i),b.a.createElement(O.a,{icon:"icon-add",className:"addButton",iconSize:16,width:a.isSmall?void 0:36,height:a.buttonSize,onClick:this.onClickNew,tooltip:"Add new board",ref:"newButton"}))}}),Fe=a(31),Ne=26;var Be=class extends C.a{init(){this.createObservables({isEditingBoard:!1}),this.listenToDispatcher(l.default.pluginManager,"pluginActiveChanged"),this.listenToDispatcher("windowResize"),this.listenTo(Fe.a.onAccountsUpdated)}getState(){var e,t=d.a.onlineStatus.get(),a={onlineStatus:d.a.onlineStatus,isEmailEnabled:!h.a.isMailbirdSidebar()&&l.default.pluginManager.isEnabled(o.a.PluginID.Gmail),isOnline:"Offline"!==t,isConnected:"Online"===t,onlineText:d.a.onlineText(),showSidebar:l.default.DesktopUI.showSidebar,isDraggingSidebar:l.default.DesktopUI.isDraggingSidebar,isNativeMacFullscreen:h.a.isNativeMacFullscreen(),isMailbirdSidebar:h.a.isMailbirdSidebar(),_sidebarWidth:l.default.DesktopUI.sidebarWidth,sidebarWidth:l.default.DesktopUI.getSidebarWidth(),isSmall:l.default.DesktopUI.getSidebarWidth()<o.a.DesktopMenuWidthMinBig,daysLeftInTrial:l.default.billingManager.daysLeftInTrial};return s.default.isDemoMode()||(e="Offline"===t?"icon-cloud_off":Fe.a.hasError()?"icon-warning":"Online"===t?"icon-cloud_done":"icon-cloud_queue",a.statusIcon=e),a}onMouseDownAddPane(e){!l.default.billingManager.hasPremiumFeatures()&&l.default.PaneManager.paneCount()>=o.a.PremiumMaxPanes?l.default.menus.openContextMenu({componentName:"ReactContextMenuUpsell",element:e.target,premiumMessage:"Using more than "+o.a.PremiumMaxPanes+" Panes in a board is a Premium feature.",enableMessage:"unlimited Panes"}):l.default.menus.openAddPaneMenu({element:e.target})}onMouseDownOptions(e){l.default.menus.openContextMenu({componentName:"ReactContextMenuOptions",element:e.target})}onClickNewEmail(){l.default.menus.openComposeEmail(l.default.pluginManager.getPluginGmail())}onClickStatusText(e){s.default.isDemoMode()?l.default.menus.confirm("Go to the Moo.do homepage?",function(e){if(e)if(window.parent)try{window.parent.location="https://www.moo.do"}catch(t){window.location="/"}else window.location="/"}):l.default.menus.openContextMenu({componentName:"ReactContextMenuOnlineStatus",element:e.target})}onClickToggle(){l.default.DesktopUI.toggleSidebar(),l.default.tooltip.hideTip()}onClickMinimize(){l.default.DesktopUI.minimize(),l.default.tooltip.hideTip()}onClickRestore(){l.default.DesktopUI.restore(),l.default.tooltip.hideTip()}onMouseDownExpand(e){this.expandingFrom=e.clientX,this.startPosition=this.state.sidebarWidth,document.addEventListener("mousemove",this.onMouseMoveExpand),document.addEventListener("mouseup",this.onMouseUpExpand),s.default.preventDefault(e)}onMouseMoveExpand(e){if(this.expandingFrom){var t=s.default.clamp(this.startPosition+e.clientX-this.expandingFrom,0,o.a.DesktopMenuWidthMax);l.default.DesktopUI.setSidebarWidthMoving(t)}}onMouseUpExpand(){this.expandingFrom=void 0,this.startPosition=void 0,s.default.vmMain.cursor.set(void 0),l.default.DesktopUI.setSidebarWidthUp(),document.removeEventListener("mousemove",this.onMouseMoveExpand),document.removeEventListener("mouseup",this.onMouseUpExpand)}onClickAddItem(e){l.default.menus.openItemEditor({addOnSave:!0,selectDocument:!0,element:e.target})}onClickHelp(e){l.default.menus.openContextMenu({componentName:"ReactContextMenuHelp",element:e.target})}onClickShare(e){l.default.menus.openContextMenu({componentName:"ReactContextMenuShare",element:e.target})}onClickTrial(){l.default.menus.openSettings(o.a.SettingsSections.Account)}render(){var e,t,a=this.state,i=s.default.classNames("desktopMenuText desktopOnline",{offline:!a.isOnline},{connected:a.isConnected}),r=l.default.billingManager,n=r.isTrialState()&&!l.default.settings.trialOverHidden.get(),d=r.isTrialOver(),c=a.isSmall,u=h.a.isNativeMac(),p=u?36:32,g=l.default.DesktopUI.shouldShowTopBar();if(a.showSidebar){var f={width:a.sidebarWidth+o.a.SidebarDragHandleSize/4},m={marginRight:o.a.SidebarDragHandleSize/4},v={marginRight:3*o.a.SidebarDragHandleSize/4},y=s.default.classNames("desktopSidebar",{transition:l.default.DesktopUI.sidebarTransitioning},{noClick:a.isDraggingSidebar},{small:c},{big:!c}),_=c?0:8,S=s.default.clamp((l.default.DesktopUI.getSidebarWidth()-o.a.DesktopMenuWidthMinBig)/(o.a.DesktopMenuWidthDefault-o.a.DesktopMenuWidthMinBig),0,1),P=c?9:Math.round(s.default.lerp(10,12,S));e=b.a.createElement("div",{id:"desktopMenu",className:y,style:f},b.a.createElement("div",{className:"desktopMenuInside ns flexbox flexvert c-bg-sidebar",style:m},b.a.createElement("div",{className:"desktopDrag sidebarPaddingTop",style:v}),b.a.createElement("div",{className:"sidebarToggle noShrink flexbox"},b.a.createElement("div",{className:"desktopDrag flex-spacer"}),c&&b.a.createElement(O.a,{icon:"icon-angle-right",iconSize:16,width:32,height:32,onClick:this.onClickRestore,tooltip:"Toggle Sidebar"}),!c&&b.a.createElement(O.a,{icon:"icon-minus",iconSize:8,width:32,height:32,onClick:this.onClickMinimize,tooltip:"Shrink to tiny sidebar"}),!c&&b.a.createElement(O.a,{icon:"icon-sidebar",iconSize:14,width:32,height:32,onClick:this.onClickToggle,tooltip:"Toggle Sidebar"})),!c&&b.a.createElement("div",{className:"sidebarHeader","data-tooltip":"Use Boards to save your pane layouts and customize your workflow."},"BOARDS"),b.a.createElement("div",{className:"sidebarSection sectionBoards"},b.a.createElement(Oe,{buttonSize:Ne,fontSize:P,height:Ne,padding:_,isSmall:c})),b.a.createElement("div",{style:{height:16}}),!c&&b.a.createElement("div",{className:"sidebarHeader"},"ACTIONS"),b.a.createElement("div",{className:"sidebarSection noShrink"},b.a.createElement(O.a,{id:"addPaneButton",ref:"addPane",tooltip:"Add Pane",tooltipHotkey:{name:"AddPane",group:"Global"},icon:"icon-crop_portrait",iconSize:15,fontSize:P,height:Ne,onMouseDown:this.onMouseDownAddPane,padding:_},!c&&"Add Pane"),b.a.createElement(O.a,{id:"newItemButton",icon:"icon-edit",iconSize:13,fontSize:P,height:Ne,tooltip:"New Item",tooltipHotkey:{name:"NewItem",group:"Global"},onClick:this.onClickAddItem,padding:_},!c&&"New Item"),a.isEmailEnabled&&b.a.createElement(O.a,{id:"newEmailButton",iconSize:13,fontSize:P,height:Ne,ref:"newEmail",icon:"icon-mail_outline",tooltip:"Compose Email",tooltipHotkey:{name:"EmailCompose",group:"Global"},onMouseDown:this.onClickNewEmail,padding:_},!c&&"New Email")),b.a.createElement("div",{className:"desktopDrag flex-spacer",style:v}),!g&&b.a.createElement("div",{className:"sidebarSection desktopMenuBottom noShrink"},!c&&b.a.createElement("div",{className:"sidebarHeader"},"MORE"),b.a.createElement(O.a,{id:"buttonOnlineStatus",icon:a.statusIcon,tooltip:"Check sync status",onClick:this.onClickStatusText,className:i,iconSize:15,fontSize:P,height:Ne,padding:_},!c&&a.onlineText),n&&!d&&b.a.createElement(O.a,{tooltip:a.daysLeftInTrial+" days left in trial",onClick:this.onClickTrial,fontSize:P,height:Ne,padding:_},"TRIAL"),n&&d&&b.a.createElement(O.a,{tooltip:"Learn more about Premium",onClick:this.onClickTrial,fontSize:P,height:Ne,padding:_},"TRIAL OVER"),b.a.createElement(O.a,{tooltip:"Share Moo.do with your friends or team",icon:"icon-heart",ref:"share",iconSize:12,fontSize:P,height:Ne,onClick:this.onClickShare},!c&&"Share"),b.a.createElement(O.a,{id:"helpButton",ref:"help",tooltip:"Show the Help",icon:"icon-question",iconSize:16,fontSize:P,height:Ne,onClick:this.onClickHelp,tooltipHotkey:{name:"Help",group:"Global"}},!c&&"Help"),b.a.createElement(O.a,{id:"optionsButton",ref:"options",tooltip:"Show more options",icon:"icon-settings",iconSize:14,fontSize:P,height:Ne,onMouseDown:this.onMouseDownOptions},!c&&"Options"),b.a.createElement("div",{style:{height:8}}))),b.a.createElement("div",{className:"sidebarDragHandle",onMouseDown:this.onMouseDownExpand,onDoubleClick:this.onClickToggle,style:{width:o.a.SidebarDragHandleSize}}))}if(g){var I=a.showSidebar&&!c,D=s.default.classNames("desktopToolbar flexbox"),w={left:!u&&a.sidebarWidth},E=s.default.classNames("desktopDrag noShrink",{"c-bg-sidebar":I}),C={width:Math.max(a.sidebarWidth,o.a.DesktopMenuWidthMinBig),height:I&&p+1};t=b.a.createElement("div",{className:D,style:w},u&&!a.isNativeMacFullscreen&&b.a.createElement("div",{className:E,style:C}),!a.isMailbirdSidebar&&b.a.createElement(O.a,{icon:"icon-sidebar",className:"noShrink",iconSize:14,width:p,height:p,tooltip:"Toggle sidebar",onClick:this.onClickToggle}),!a.showSidebar&&b.a.createElement(Re,{buttonSize:p}),b.a.createElement("div",{className:"f1 desktopDrag"}),b.a.createElement("div",{className:"noShrink"},!1,b.a.createElement(O.a,{id:"buttonOnlineStatus",icon:a.statusIcon,iconSize:13,width:p,height:p,onClick:this.onClickStatusText,className:i,tooltip:"Check sync status"}),b.a.createElement(O.a,{id:"addPaneButton",icon:"icon-add-pane",iconSize:15,width:p,height:p,onMouseDown:this.onMouseDownAddPane,tooltip:"Add Pane",tooltipHotkey:{name:"AddPane",group:"Global"}}),b.a.createElement(O.a,{id:"newItemButton",icon:"icon-edit",iconSize:14,width:p,height:p,onClick:this.onClickAddItem,tooltip:"New Item",tooltipHotkey:{name:"NewItem",group:"Global"}}),a.isEmailEnabled&&!a.isMailbirdSidebar&&b.a.createElement(O.a,{icon:"icon-mail_outline",iconSize:15,width:p,height:p,onClick:this.onClickNewEmail,tooltip:"New Email",tooltipHotkey:{name:"EmailCompose",group:"Global"}}),b.a.createElement(O.a,{id:"optionsButton",ref:"options",tooltip:"More",icon:"icon-settings",iconSize:14,width:p,height:p,onMouseDown:this.onMouseDownOptions})))}return b.a.createElement(b.a.Fragment,null,e,t)}},Ue=a(19);var He=class extends C.a{render(){var e=this.props,t={height:e.height},a={[h.a.transform.react]:"scale("+e.percent+", 1)"},i={lineHeight:e.height-2+"px"};return b.a.createElement("div",{className:"fancyProgressBar",style:t},!e.error&&b.a.createElement("div",{className:"fancyProgressInside",style:a}),e.error&&b.a.createElement("div",{className:"fancyProgressError",style:i},e.errorMsg))}};var Ve,je=class extends C.a{init(){this.createObservables({attachments:[]}),this.onAttachmentUpdate(),this.props.threadAttach.subscribe(this)}onUnmount(){this.props.threadAttach.unsubscribe(this)}onAttachmentUpdate(){this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message).then(e=>this.attachments.set(e))}onAttachmentIDChange(){}isAttachImage(e){var t=e.mimeType;return"image/png"===t||"image/jpg"===t||"image/jpeg"===t||"image/gif"===t}onClickAttach(e,t){if(e.error)e.uploader&&!e.uploader.isDone()&&e.uploader.resume();else if(!e.uploader||e.uploader.isDone()){var a=this._getURL(e);this.props.editable?s.default.openUrl(a):e.attID?h.a.mac&&t.metaKey||!h.a.mac&&t.ctrlKey||!this.isAttachImage(e)?s.default.downloadFile(a,e.cid):l.default.menus.openLightbox(a,"Download",function(){s.default.downloadFile(a,e.cid)}):s.default.openUrl(a)}t.stopPropagation()}onClickDelete(e,t){s.default.preventAndStop(t),(async()=>{var t=this.props.threadAttach.getPlugin(),a=await t.removeAttachFiles(this.props.threadAttach,this.props.message,e);this.props.onUpdate&&this.props.onUpdate(a)})()}onAttachDragStart(e){var t=e.target.getAttribute("data-downloadurl");e.stopPropagation(),e.dataTransfer.setData("DownloadURL",t),l.default.DragDrop.setExternalData(t)}_getURL(e){return this.props.editable||!e.attID?l.default.EmailPreview.getPreviewURL(e):l.default.EmailPreview.getAttachmentURL(this.props.threadAttach.getField("accountID"),this.props.message.id,e.attID)}_renderAttachment(e){var t=e.mimeType+":"+e.cid+":"+this._getURL(e),a=e.uploader?s.default.clamp(e.uploader.getPercent(),.05,1):1,i=this.isAttachImage(e)?"Click to open image.\n"+h.a.priModKey+" click to download image.":"Click to download image";return b.a.createElement("div",{key:e.id,className:"messageAttachment flexbox c-button-raised",draggable:!0,"data-downloadurl":t,onClick:this.onClickAttach.bind(this,e),onDragStart:this.onAttachDragStart,"data-tooltip":i},b.a.createElement("div",{className:"attachmentIcon icon-drive-file"}),b.a.createElement("div",{className:"attachmentText"},e.cid),b.a.createElement("div",{className:"f1"}),a<1&&b.a.createElement(He,{percent:a,height:22,error:e.error,errorMsg:"Click to retry"}),1===a&&e.error&&b.a.createElement("div",null,"ERROR"),b.a.createElement("div",{className:"attachmentSize"},s.default.toFileSize(e.size)),this.props.editable&&b.a.createElement(O.a,{className:"attachmentClose",icon:"icon-close",onClick:this.onClickDelete.bind(this,e),tooltip:"Remove"}))}render(){var e=null,t=this.state.attachments;if(t.length>0){for(var a=0,i=[],r=0;r<t.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t[r];i.push(this._renderAttachment(s))}e=b.a.createElement("div",{className:"messageAttachments c-border"},i)}return e}},ze=a(451),qe=a(67);var We=(Ve=class{constructor(e,t,a){this.plugin=e.getPlugin(),this.threadAttach=e,this.message=t,this._getEmailData=a}onMount(){this._isMounted=!0}onUnmount(){this._isMounted=!1,this.flushUnsavedChanges({updateRemoteDraft:!0,forceFlush:!0})}onEmailChanged(){this.saveDraft({updateRemoteDraft:!0,forceFlush:!1})}saveDraft({updateRemoteDraft:e,forceFlush:t}){clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this.needsSaveDraft=e,this.needsForceFlush=t,this._isMounted&&(this._draftUpdateDebounce=setTimeout(this.flushUnsavedChanges.bind(this,{updateRemoteDraft:e,forceFlush:t}),1e3))}flushUnsavedChanges({updateRemoteDraft:e,forceFlush:t}){this._draftUpdateDebounce&&(clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._saveDraftUpdates(this.needsSaveDraft||e,this.needsForceFlush||t),this.needsSaveDraft=!1,this.needsForceFlush=!1)}discardDraft(){this.plugin.discardDraft(this.threadAttach,this.message.id,this.message.draftID,e=>{try{s.default.PAssert(993,e,"Should always be able to delete a draft")}catch(t){s.default.reportError(t)}})}async getComposeBody(e){var t;return e&&e.decoded&&(t=await qe.a.getComposeBody(e.decoded,e.resources)),t}createTokensFromAddressText(e){var t=[];if(e)for(var a=0,i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[i];r.text?t.push(r):r.email&&t.push({email:r.email,text:r.email})}return{tokens:t}}_saveDraftUpdates(e,t){if(s.default.shouldLog(o.a.LogLevels.Compose)&&s.default.log("Queue Save Draft: ",this.threadAttach.id,this.message.id,this.message.draftID,this._isMounted),this._isMounted){var a=this._getEmailData();this.plugin.updateDraft(this.threadAttach,this.message.id,this.message.draftID,a,e,t,e=>{console.log("draft updated",e);try{s.default.PAssert(994,e,"Should always be able to update a draft")}catch(t){s.default.reportError(t)}})}}prepForSend(e,t){this.flushUnsavedChanges({updateRemoteDraft:!1,forceFlush:!1}),e.to&&e.to.length?e.subject?e.decoded?t():l.default.menus.confirm("There is no email body. Send anyway?",e=>{e&&t()}):l.default.menus.confirm("There is no email subject. Send anyway?",e=>{e&&t()}):l.default.menus.alert({text:"Please enter a recipient."})}async changeFrom(e){var t=this.threadAttach,a=this.plugin.getSyncAccount(e),i=this.plugin.getSendingAccountInfo(e);this.flushUnsavedChanges({updateRemoteDraft:!1,forceFlush:!1});var r=await this.plugin.changeMessageAccount(t,this.message.id,this.message.draftID,a,e,i),s=this.plugin.getDraftByID(a,r.threadID,r.messageID);return this.threadAttach=s.attach,this.message=s.draftMsg,this.saveDraft({updateRemoteDraft:!0,forceFlush:!1}),{body:await this.getComposeBody(this.message)||"",threadAttach:this.threadAttach,message:this.message}}},u()(Ve.prototype,"flushUnsavedChanges",[S.a],Object.getOwnPropertyDescriptor(Ve.prototype,"flushUnsavedChanges"),Ve.prototype),Ve);var Ge=class extends C.a{init(){var e=this.props;this.threadAttach=e.threadAttach,this.message=e.message,this._composeHelper=new We(this.threadAttach,this.message,this.getEmailData),this._dragEnterCounter=0,this._escapedFromDrag=!1,this.to=this._composeHelper.createTokensFromAddressText(this.message.to),this.cc=this._composeHelper.createTokensFromAddressText(this.message.cc);var t=!!this.message.cc&&this.message.cc.length>0;if(this.createObservables({showSubject:e.showSubject,showCc:t,showBcc:!1,isSending:!1,isDragOver:!1}),this.listenTo(Fe.a.onAccountsUpdated),this.message.inReplyTo){var a=this.threadAttach.getData().messages,i=a.indexOfWithProperty("messageID",this.message.inReplyTo);if(i>=0){var r=a[i];try{s.default.PAssert(693,r.initializedForDisplay,"Message must be ready to display if being replied to")}catch(n){s.default.reportError(n)}r&&r.responseMode&&(this.modeListener=r.responseMode.listen(this.onReplyModeChanged))}}s.default.isDemoMode()&&(s.default.reactEmailCompose=this),this.refBody=b.a.createRef(),this.refContainer=b.a.createRef(),this.refPicker=b.a.createRef(),this.refTo=b.a.createRef(),this.refCc=b.a.createRef(),this.refBcc=b.a.createRef(),this.refSubject=b.a.createRef(),this.refFrom=b.a.createRef(),this.refLink=b.a.createRef()}onReplyModeChanged(){this.to=this._composeHelper.createTokensFromAddressText(this.message.to),this.cc=this._composeHelper.createTokensFromAddressText(this.message.cc),this.cc&&this.cc.tokens&&this.cc.tokens.length>0&&this.showCc.set(!0),this.updateState()}_getHotkeys(){return[Ce.a.create(o.a.KeyCode.Escape,!0,o.a.Primary.Either,o.a.Shift.Either,this.onEscape),Ce.a.create(o.a.KeyCode.Enter,!0,o.a.Primary.Yes,o.a.Shift.Either,this.sendEmail),Ce.a.create(o.a.KeyCode.K,!0,o.a.Primary.Yes,o.a.Shift.No,this.insertLinkHotkey)]}getPlugin(){return this.threadAttach.getPlugin()}getState(){return{attachments:this.getPlugin().getMessageDisplayAttachments(this.message),fromAccounts:this.getSendingAccounts()}}onMount(){this._composeHelper.onMount(),(async()=>{var e=await this._composeHelper.getComposeBody(this.message);e&&this.refBody.current.setValue(e),this.refContainer.current.addEventListener("cdrop",this.onItemDrop);let t=this.refPicker.current;t.addEventListener("change",()=>(this.getPlugin().notifyAttachFiles(this.threadAttach,this.message,t.files,this.onAttachUpdated),t.value=null,!1),!1),this.refContainer.current.addEventListener("paste",e=>{var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;if(t&&t.items&&t.items.length>0){for(var a=0,i=[],r=0;r<t.items.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;"file"===t.items[r].kind&&i.push(t.items[r].getAsFile())}if(i.length>0)return this.getPlugin().notifyAttachFiles(this.threadAttach,this.message,i,this.onAttachUpdated),!1}},!1),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown)})()}onUnmount(){this.modeListener&&(this.modeListener.dispose(),this.modeListener=void 0),this._composeHelper.onUnmount(),document.removeEventListener("mouseup",this.onMouseUp)}discard(){this.close(!1,!0,!0)}onEscape(){this.isDragOver.get()||(this.refTo.current.getTokens().length>0||this.refBody.current.getValue()||this.state.attachments.length>0?l.default.menus.confirm("Do you want to discard this draft?",e=>{e&&this.discard()}):this.discard())}onFocus(){this.__hotkeys||(this.__hotkeys=Ce.a.pushStack(this._getHotkeys())),m.a.clearSelection()}onBlur(){this.__hotkeys&&(Ce.a.popStack(this.__hotkeys),this.__hotkeys=void 0)}onClickAttach(){this.refPicker.current.click()}onAttachUpdated(e){this._isMounted&&(this.onDraftChanged(),e&&this._composeHelper.flushUnsavedChanges({updateRemoteDraft:!0,forceFlush:!0}),this.updateState())}onDragEnter(e){e.preventDefault(),this._escapedFromDrag||(this._dragEnterCounter++,this.isDragOver.set(!0))}onDragLeave(){this._dragEnterCounter--,0===this._dragEnterCounter&&this.isDragOver.set(!1)}onMouseUp(){this._escapedFromDrag=!1,this.isDragOver.set(!1)}onKeyDown(e){e.keyCode===o.a.KeyCode.Escape&&this.isDragOver.get()&&(this._escapedFromDrag=!0,this.isDragOver.set(!1))}onFileDrop(e){if(!this._escapedFromDrag){this.isDragOver.set(!1);var t=e.dataTransfer;t.files&&t.files.length>0&&(this.getPlugin().notifyAttachFiles(this.threadAttach,this.message,t.files,this.onAttachUpdated.bind(this)),e.preventDefault(),e.stopPropagation(),l.default.DragDrop.stop(),l.default.DragDrop.finish())}}onItemDrop(e){if(e.item&&e.item.hasAttachmentType(o.a.PluginType.Storage)){var t=e.item.getAttachmentByType(o.a.PluginType.Storage);this.getPlugin().notifyAttachLinkedFile(this.threadAttach,this.message,t,this.onAttachUpdated.bind(this))}}close(e,t,a){try{s.default.PAssert(694,s.default.isBoolean(e),"Must supply a valid value for sendDraft")}catch(i){s.default.reportError(i)}try{s.default.PAssert(695,s.default.isBoolean(t),"Must supply a valid value for discardDraft")}catch(i){s.default.reportError(i)}try{s.default.PAssert(696,s.default.isBoolean(a),"Must supply a valid value for forceFlush")}catch(i){s.default.reportError(i)}s.default.shouldLog(o.a.LogLevels.Compose)&&s.default.log("Compose Close: ",e,t,a),!e&&t?this._composeHelper.discardDraft():this._composeHelper.flushUnsavedChanges({updateRemoteDraft:e,forceFlush:a}),this.props.onClose()}openSubject(){this.showSubject.set(!0),setTimeout(()=>{this._setFocus(this.refSubject.current),this.refSubject.current.selectEnd()},0)}openCc(){this.showCc.set(!0),setTimeout(()=>{this._setFocus(this.refCc.current)},0)}openBcc(){this.showBcc.set(!0),setTimeout(()=>{this._setFocus(this.refBcc.current)},0)}focusTo(){this._setFocus(this.refTo.current)}focusBody(){this._setFocus(this.refBody.current)}_setFocus(e){e.isFocused.get()||e.focus()}onClickSend(){this.sendEmail()}sendEmail(){this._composeHelper.prepForSend(this.message,async()=>{Ue.default.clearSelection(),this.isSending.set(!0),await this.getPlugin().sendEmail(this.threadAttach,this.message)?this.close(!1,!1,!0):this.isSending.set(!1)})}onDraftChanged(){this._composeHelper.saveDraft({updateRemoteDraft:!0,forceFlush:!1})}getEmailData(){return this.props,{id:this.message.id,to:this.refTo.current.getTokens(),cc:this.refCc.current&&this.refCc.current.getTokens(),bcc:this.refBcc.current&&this.refBcc.current.getTokens(),subject:this.refSubject.current&&this.refSubject.current.getValue()||this.message.subject,decoded:this.refBody.current.getValue(),snippet:this.refBody.current.getTextValue()}}onChangeFrom(){(async()=>{var e=this.refFrom.current.value;let t=await this._composeHelper.changeFrom(e);this.threadAttach=t.threadAttach,this.message=t.message,this.refBody.current.setValue(t.body)})()}getSendingAccounts(){var e,t=this.getPlugin();return this.message.inReplyTo&&(e=this.threadAttach.getField("accountID")),t.getSendingAccounts(e)}insertLinkHotkey(){this.refBody.current.hasFocus()&&this.insertLink()}insertLink(){var e=Ue.default.getSelectedText(),t=this.refLink.current.getElement();this.savedSel=Ue.default.getSelectionRange(),l.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:t,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:e})}onInsertLinkClosed(){this.savedSel&&(this.refBody.current.focus(),Ue.default.setSelectionRange(this.savedSel))}onInsertLink(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.refBody.current.insertNode(t)}render(){var e=this.state,t=this.props,a=this.to,i=this.cc,r="(no subject)"===this.message.subject?"":this.message.subject,n=this.state.showCc||this.cc&&this.cc.length>0,l=8+(n?0:28)+(e.showBcc?0:34),d=this.message.from.email,h=e.fromAccounts.slice(0),c=e.fromAccounts.length>1,u=s.default.classNames("emailCompose validDropTarget flexbox flexvert",t.className);h.remove(d),h.unshift(d);var p=s.default.classNames("composeHeader c-border-heavy",{showingFrom:e.fromAccounts.length>1});return b.a.createElement("div",{className:u,style:{},ref:this.refContainer,onFocus:this.onFocus,onBlur:this.onBlur,onDrop:this.onFileDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave},b.a.createElement("div",{className:p},b.a.createElement("div",{className:"composeButtons"},!e.showSubject&&b.a.createElement(O.a,{height:24,padding:6,onClick:this.openSubject},"Subject"),!n&&b.a.createElement(O.a,{height:24,padding:6,onClick:this.openCc},"Cc"),!e.showBcc&&b.a.createElement(O.a,{height:24,padding:6,onClick:this.openBcc},"Bcc")),b.a.createElement(Le.a,{className:"toBox",height:50,floatingText:"To",display:"block",ref:this.refTo,tokens:a.tokens,focused:"to"===this.props.focus,autocompleteMode:"email",padding:{right:0},margin:{right:l},onChange:this.onDraftChanged,onEscape:t.onEscape}),n&&b.a.createElement(Le.a,{height:50,floatingText:"Cc",display:"block",ref:this.refCc,tokens:i.tokens,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showBcc&&b.a.createElement(Le.a,{height:50,floatingText:"Bcc",display:"block",ref:this.refBcc,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showSubject&&b.a.createElement(Le.a,{height:50,floatingText:"Subject",display:"block",ref:this.refSubject,value:r,padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),c&&b.a.createElement("div",{className:"composeFrom"},b.a.createElement("span",null,"From"),b.a.createElement("select",{ref:this.refFrom,onChange:this.onChangeFrom},h.map(e=>b.a.createElement("option",{key:e,value:e},e))))),b.a.createElement(ze.a,{className:"emailComposeTextarea c-border-heavy f1",ref:this.refBody,onChange:this.onDraftChanged,spellCheck:!0,onEscape:t.onEscape,editable:!e.isSending,richText:!0}),b.a.createElement(je,{onUpdate:this.onAttachUpdated,threadAttach:this.threadAttach,message:this.message,editable:!0}),b.a.createElement("div",{className:"composeFooter"},b.a.createElement(O.a,{className:"discardDraft",icon:"icon-delete",iconSize:20,onClick:this.discard,tooltip:"Discard Draft"}),b.a.createElement(O.a,{className:"attachFile",icon:"icon-attach_file",iconSize:20,marginLeft:8,onClick:this.onClickAttach,tooltip:"Attach File"}),b.a.createElement(O.a,{className:"insertLink",icon:"icon-link",ref:this.refLink,iconSize:20,marginLeft:8,onClick:this.insertLink,tooltip:"Insert Link"}),this.state.isSending?b.a.createElement(j.a,{inline:!0,color:o.a.ColorBrand,style:{height:32,lineHeight:"32px",fontWeight:"bold"}},"Sending..."):b.a.createElement(O.a,{className:"buttonSend",primary:!0,marginLeft:16,onClick:!this.state.isSending&&this.onClickSend},e.isSending?"Sending...":"SEND")),b.a.createElement("input",{type:"file",ref:this.refPicker,className:"hidden",multiple:!0}),e.isDragOver&&b.a.createElement("div",{className:"dropNotice flexbox flex-center"},b.a.createElement("div",{className:"dropBg absFull"}),b.a.createElement("div",{className:"f1 center"},b.a.createElement("div",{className:"icon-attach_file"}),b.a.createElement("div",null,"Drop to attach"))))}};var Ke=class extends C.a{init(){this.listenToDispatcher("windowResize"),this.refCompose=b.a.createRef()}getState(){var e=h.a.windowWidth(),t=h.a.windowHeight();return{width:Math.min(Math.max(Math.min(.4*e,800),500),e-20),height:Math.min(Math.max(Math.min(.4*t,800),500),t)}}close(){this.refCompose.current.close(!0,!1,!0)}onClose(){p.a.fireEvent("EmailCompose","onClosed",[]),l.default.menus.closeComposeEmail(this.props.threadAttach,this.props.message)}onMouseDown(){m.a.reset()}onMount(){var e=this.refCompose.current;e.focusTo(),requestAnimationFrame(()=>{e.focusTo()})}render(){var{threadAttach:e,message:t}=this.props,{width:a,height:i}=this.state;return b.a.createElement(we,{title:"New Message",canMinimize:!0,canMaximize:!0,width:a,height:i,close:this.close,className:"composeEmail flexbox flexvert",onMouseDown:this.onMouseDown},b.a.createElement(Ge,{className:"f1",threadAttach:e,message:t,showSubject:!0,onClose:this.onClose,ref:this.refCompose,focus:"to"}))}};var Ye=class extends C.a{getState(){return{emailComposes:l.default.menus.emailComposeStack}}render(){for(var e=0,t=this.state,a=[],i=0;i<t.emailComposes.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.emailComposes[i];a.push(b.a.createElement(Ke,{key:r.draftMsg.id,threadAttach:r.attach,message:r.draftMsg}))}return b.a.createElement("div",{className:"emailComposes flexbox"},a)}};var Xe=class extends C.a{init(){this.createObservables({addingItem:void 0})}onMount(){var e=this.props.pane,t=e.getOverview(),a=t.scrollElement=this.refs.overviewScroller.getScrollElement(),i=t.contentElement=this.refs.overviewContentElement.getElement();e.getInfiniteList(!0).setupScroller(a,i),s.default.setupClick(a,e.getOverview(),e.getOverview().onTap)}getState(){var e=this.props.pane,t=e.getOverview(),a={accounts:l.default.settings.syncAccounts,isVisible:t.isVisible,activeDoc:e.document,showDocuments:e.supportsDocuments,zoomed:e.item,viewMode:e.viewState};return a.cursor=t.cursor,a.isAtRoot=e.getItem()===e.getRootItem(),e.type===o.a.PaneMode.Gmail&&(a.overviewAccount=e._overviewAccount),a}getPane(){return this.props.pane}renderCell(e,t){var a=this.props.pane;return b.a.createElement(le,{key:e,list:a.getInfiniteList(!0),pane:a,cell:t,overview:!0})}sizeAtIndex(e){var t=this.props.pane;return t.headersArr[e].sizeInPane(t,e,!0)}onClickAddTop(){this.addingItem.set("top")}onClickAll(){var e=this.props.pane;e.type!==o.a.PaneMode.Task||e.isViewItems()||e.setViewMode(o.a.TaskViewMode.Outline),e.zoomOut(e.getRootItem())}onAddItem(e){var t=this.refs.inputAddItem.getValue();this.addingItem.set(void 0);var a=this.props.pane,i=a.getRootItem(),r="top"===e?0:i.numItems(),s=a.addProject(r,t,!0);setTimeout(()=>{a.getItem()!==i&&a.zoomOut(i),a.scrollItemToTop(s,o.a.ScrollDuration.Default)},0)}onClickCancel(){this.addingItem.set(void 0)}onClickGmailAccount(e){var t=this.props.pane;t.setOverviewAccount(e),t.zoomIn(t.getDefaultDisplayItem(e))}renderAddProjectInput(e){var t=this.onAddItem.bind(this,e),a=this.onClickCancel.bind(this,e);return b.a.createElement("div",{className:"addProjectInput"},b.a.createElement(Le.a,{ref:"inputAddItem",focused:!0,height:32,placeholder:"Name project",onEscape:a,onEnter:t}),b.a.createElement("div",{className:"addProjectButtons"},b.a.createElement(O.a,{primary:!0,onClick:t},"Add Project"),b.a.createElement(O.a,{onClick:a},"Cancel")))}renderShowAllButton(e){return b.a.createElement(O.a,{className:"overviewHeaderButton",icon:"icon-visibility",height:30,iconSize:15,onClick:this.onClickAll,enabled:!this.state.isAtRoot||!this.props.pane.isViewItems()},"Show all "+e)}renderDocuments(){if(this.state.showDocuments)return b.a.createElement("div",{className:"paneOverviewTop c-border",style:{color:"c-foreground"}},b.a.createElement(O.a,{color:"c-foreground-very-faded c-color-hover",onClick:this.props.onClickViewDocuments},"Documents"),b.a.createElement("span",{className:"c-foreground-very-faded c-color-hover",style:{lineHeight:"36px",verticalAlign:"top"}},">"),b.a.createElement(O.a,{color:"c-foreground",onClick:this.props.onClickViewDocuments},"Overview"))}renderHeader(){var e=this.state,t=this.props.pane;switch(t.type){case o.a.PaneMode.Task:var a=t.isViewOutline()||t.isViewProject();return b.a.createElement("div",{className:"overviewHeader"},this.renderShowAllButton("projects"),a&&"top"!==e.addingItem&&b.a.createElement(O.a,{className:"overviewHeaderButton",icon:"icon-project",iconSize:15,height:30,onClick:this.onClickAddTop},"Add project"),a&&"top"===e.addingItem&&this.renderAddProjectInput("top"),b.a.createElement("hr",null));case o.a.PaneMode.Archived:return b.a.createElement("div",{className:"overviewHeader"},this.renderShowAllButton("projects"),b.a.createElement("hr",null));case o.a.PaneMode.Drive:return b.a.createElement("div",{className:"overviewHeader"},b.a.createElement("div",{className:"overviewHeaderTitle"}),this.renderShowAllButton("folders"),b.a.createElement("hr",null));case o.a.PaneMode.Gmail:var i=l.default.pluginManager.getPluginGmail(),r=e.overviewAccount,n=i.getSyncAccounts(),d=s.default.classNames("overviewHeader",{"c-border":n.length>1});return b.a.createElement("div",{className:d},n.length>1&&n.map(function(e){return b.a.createElement(O.a,{className:"overviewHeaderButton",key:e,selected:e===r,height:30,onClick:this.onClickGmailAccount.bind(this,e)},e)}.bind(this)))}}render(){this.state;var e=this.props.pane,t=s.default.classNames("paneOverview flexbox flexvert",e.type+"Overview"),a=s.default.classNames(this.props.className,"paneOverviewScroller scroller f1",{transition:!l.default.PaneManager.isResizingPane}),i=this.renderHeader();return b.a.createElement("div",{className:"paneOverviewOutside f1 flexbox flexvert","data-moo-id":this.getUniqueID()},this.renderDocuments(),b.a.createElement(ce.a,{className:a,ref:"overviewScroller",showScrollbars:!0},b.a.createElement("div",{className:t,ref:"overview"},i,b.a.createElement(B,{owner:e.getInfiniteList(!0),pane:e,overview:!0,renderCell:this.renderCell,contentClass:"overviewList noSelect f1 mat-list",ref:"overviewContentElement"}))))}},Qe=a(53);var $e=class extends C.a{init(){this.createObservables({isEditing:""===this.props.doc.text.get()})}getState(){let{doc:e}=this.props;return{text:e.text,contentPreview:e.contentPreview,isLocal:e.isLocalOnly(),isSyncing:e.isSyncing,docTimeText:Qe.a.toHumanText(new Date(e.dateModified.get()),!0),docTime:e.dateModified}}onBeforeChanged(e,t){e.text&&!t.text&&e.isEditing&&(e.isEditing=!1,this.isEditing.set(!1,!1))}onEscape(){let e=!0,t=this.props.doc;t.needsSave&&(t.getAllItems().length<=1?t.delete():(e=!1,l.default.toasts.pushMessage("You must name this document before it can sync"))),e&&this.isEditing.set(!1)}onFinishEdit(){d.a.renameDocument(this.props.doc,this.refs.inputAddDocument.getValue()),this.isEditing.set(!1)}onClick(){this.props.onSelectDocument(this.props.doc)}onClickOverview(){this.props.onSelectDocument(this.props.doc,!0)}onRightClick(e){l.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}onClickRename(){this.isEditing.set(!0)}onClickShare(){l.default.menus.openModal(o.a.Modals.ShareDoc,{doc:this.props.doc})}onClickDelete(){if(d.a.getDocumentsArray().length>1){let{pane:e,doc:t}=this.props;l.default.menus.confirm(`Are you sure you want to delete ${t.text.get()}?`,e=>{e&&t.delete()})}else l.default.menus.alert({text:"Deleting the last document is not supported.",actionText:"OKAY"})}onClickRevisionHistory(){l.default.menus.openModal(o.a.Modals.Backups,{doc:this.props.doc})}renderContextMenu(e){let{doc:t}=this.props,a=t.isAdmin(),i=t.isLocalOnly();return I.createElement(L.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:e.element},a&&I.createElement(I.Fragment,null,I.createElement(x.a,{onClick:this.onClickRename},"Rename"),!i&&I.createElement(x.a,{onClick:this.onClickShare},"Share"),!i&&I.createElement(x.a,{onClick:this.onClickRevisionHistory},"Revision History"),I.createElement("hr",null),I.createElement(x.a,{onClick:this.onClickDelete},"Delete")),!a&&I.createElement("div",{style:{padding:"12px 16px"}},"Please request Admin privelege on this document to modify it."))}render(){let{isSelected:e,pane:t}=this.props,{text:a,isEditing:i,contentPreview:r,docTimeText:n,isLocal:o,isSyncing:l}=this.state,d=s.default.classNames("paneSidebarDocument flexbox borderBottom c-background c-border noSelect",{borderLeft:t.rect.get()&&t.rect.get().isFirst},{selected:e}),h=s.default.classNames("documentStatusIcon c-foreground-faded",{"icon-drive-file":o},{"icon-cloud_upload":!o&&l},{"icon-cloud_done":!o&&!l});return I.createElement(k.a,{className:d,onClick:this.onClick,onRightClick:this.onRightClick},e&&I.createElement("div",{className:"selectedIndicator c-border-blue"}),i?I.createElement(Le.a,{ref:"inputAddDocument",focused:!0,height:32,placeholder:"Name document",buttonText:"SAVE",value:a,onButtonClick:this.onFinishEdit,onEscape:this.onEscape}):I.createElement(I.Fragment,null,I.createElement("div",{className:"mw0 f1"},I.createElement("div",{className:"documentName f1 bold"},a),I.createElement("div",{className:"documentExtra c-foreground-faded"},r),I.createElement("div",{className:"documentExtra documentTime c-foreground-faded"},n)),I.createElement("div",null,I.createElement(O.a,{display:"block",className:"buttonDocumentOverview",icon:"icon-format_list_bulleted",onClick:this.onClickOverview}),I.createElement("div",{style:{width:36,height:36,lineHeight:"36px"},className:h,onClick:this.onClickOverview}))))}},Je=a(54);var Ze=class extends C.a{init(){}getState(){let{docInfo:e}=this.props;return{text:e.text,encryptionSentinel:e.encryptionSentinel}}onClick(){let e=this.props.docInfo;l.default.menus.openModal(o.a.Modals.EnterCode,{isPassword:!0,text:`Please enter the password for this document: ${this.state.text}`,onSelect:t=>new Promise((a,i)=>{t&&l.default.crypto.addKey({name:e.id,password:t,sentinelSalt:e.id}).then(t=>{e.encryptionSentinel===t.sentinel?(a(),l.default.settings.addEncryptionKey(e.id,t.key),Je.a.loadSingleDocument(e).then(e=>{e&&this.props.onSelectDocument(e)})):(l.default.crypto.removeKey(e.id),i("The password was invalid. Please try again."))})})})}onRightClick(e){l.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}onClickDelete(){l.default.menus.alert({text:"Deleting encrypted documents is not supported yet. Please contact support if this is important to you.",actionText:"OKAY"})}renderContextMenu(e){return I.createElement(L.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:e.element},I.createElement(x.a,{onClick:this.onClickDelete},"Delete"))}render(){let{text:e}=this.state,t=s.default.classNames("paneSidebarDocument flexbox borderBottom borderLeft c-background c-border noSelect");return I.createElement(k.a,{className:t,onClick:this.onClick,onRightClick:this.onRightClick},I.createElement("div",{className:"mw0 f1"},I.createElement("div",{className:"documentName f1 bold"},e),I.createElement("div",{className:"documentExtra c-foreground-faded"},"Encrypted")))}},et=a(55);var tt=class extends C.a{getState(){let e=this.props.pane,t={rect:e.rect,_documents:d.a.documentsArray,documentsEncrypted:d.a.documentsEncryptedArray,paneDoc:e.document,documentSortMode:e.documentSortMode};return t.documents=d.a.documentsArray.get().slice().sort(et.a.getCompareFn(e.documentSortMode.get())),t}addDocument(e){let t=e?d.a.getBackingLocal():d.a.getBackingRemote(),a=d.a.addEmptyDocument("",t,!0);this.props.onSelectDocument(a,!1)}onMouseDownSort(e){l.default.menus.openContextMenu({fn:this.renderContextMenuSort,element:e.target})}setSortMode(e){this.props.pane.documentSortMode.set(e)}onClickAdd(e){h.a.supportLocalFiles()?l.default.menus.openContextMenu({fn:this.renderContextMenuAdd,element:e.target}):this.addDocument(!1)}renderContextMenuAdd(e){return b.a.createElement(L.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},b.a.createElement(x.a,{icon:"icon-drive-file",onClick:this.addDocument.bind(this,!0),tooltip:"File on your computer - does not sync with the server"},"New local file"),b.a.createElement(x.a,{icon:"icon-cloud_upload",onClick:this.addDocument.bind(this,!1),tooltip:"File synced with the server and other devices"},"New synced file"))}renderContextMenuSort(e){let t=Object.keys(o.a.DocumentSortMode);return b.a.createElement(L.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},b.a.createElement(T.a,{topHeader:!0},"Sort mode"),t.map(e=>b.a.createElement(x.a,{key:e,active:this.state.documentSortMode===e,onClick:this.setSortMode.bind(this,e)},e)))}renderDocument(e){return b.a.createElement($e,{key:e.id,doc:e,pane:this.props.pane,isSelected:e===this.state.paneDoc,onSelectDocument:this.props.onSelectDocument})}renderDocumentEncrypted(e){return b.a.createElement(Ze,{key:e.id,docInfo:e,onSelectDocument:this.props.onSelectDocument})}render(){var e=this.state;return b.a.createElement("div",{className:"paneSidebarDocuments f1"},b.a.createElement("div",{className:"paneSidebarDocumentsButtons flexbox"},b.a.createElement(O.a,{fontSize:17,color:"c-foreground",onClick:this.props.onClickViewDocuments},"Documents"),b.a.createElement("div",{className:"flex-spacer"}),b.a.createElement(O.a,{icon:"icon-add",onClick:this.onClickAdd}),b.a.createElement(O.a,{icon:"icon-filter_list",fontSize:17,style:{marginRight:6},onMouseDown:this.onMouseDownSort})),b.a.createElement("div",{className:"borderTop c-border"},e.documentsEncrypted.map(this.renderDocumentEncrypted),e.documents.map(this.renderDocument)))}};var at=class extends C.a{getState(){let e=this.props.pane;return{rect:e.rect,activeDoc:e.document,isShowingContents:!e.supportsDocuments||e.overview.isShowingContents}}getPane(){return this.props.pane}onClickViewDocuments(){this.props.pane.overview.setShowingContents(!1)}onSelectDocument(e,t){this.props.pane.setDocument(e),t&&this.props.pane.overview.setShowingContents(!0)}render(){var{rect:e,isShowingContents:t}=this.state,{className:a,pane:i}=this.props,r=s.default.classNames("paneOverviewWrapper flexbox flexvert",a),n={width:o.a.OverviewWidth,[h.a.transform.react]:"translate("+(e.left-o.a.OverviewWidth)+"px,0)"};return b.a.createElement("div",{className:r,style:n},t&&b.a.createElement(Xe,{onClickViewDocuments:this.onClickViewDocuments,pane:i}),!t&&b.a.createElement(tt,{pane:i,onClickViewDocuments:this.onClickViewDocuments,onSelectDocument:this.onSelectDocument}))}};var it=class extends C.a{init(){this._initializedFrame=!1,this.createObservables({hovered:!1}),this.refFrame=b.a.createRef(),this.refMessage=b.a.createRef()}onMount(){this.props.isLastMessage&&this.props.index>0&&(this.needsScrollIntoView=!0),this.checkIsHovered(),this._initializeFrame()}_initializeFrame(){if(!this._initializedFrame){let t=this.refFrame.current;if(t){this._initializedFrame=!0;var e=t.contentWindow.document;h.a.supportBlobURLIFrame||(e.open(),e.write(this.props.message.blob),e.close())}}}getState(){var e=this.props.message;return{responseMode:e.responseMode,height:e.height,width:e.width}}onAfterChanged(e,t){this._initializeFrame(),e.height!==t.height&&e.height>0&&(this.checkIsHovered(),this.needsScrollIntoView&&(this.needsScrollIntoView=!1,this.scrollIntoView()))}checkIsHovered(){var e=m.a.getMousePos(),t=document.elementFromPoint(e.x,e.y);t&&s.default.findParent(t,"emailMessageWrapper")===this.refMessage.current&&this.hovered.set(!0)}scrollIntoView(){var e=this.refMessage.current,t=s.default.findParent(e,"fancyScrollContent"),a=0;a=e.clientHeight>t.clientHeight?e.offsetTop:t.scrollHeight-t.clientHeight,s.default.scrollTo(0,a,o.a.ScrollDuration.Snap,t)}onClickHeader(){this.props.toggleExpanded()}onMouseEnterMessage(){this.hovered.set(!0)}onMouseLeaveMessage(){this.hovered.set(!1)}onClickReply(e){l.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.Reply),e.stopPropagation()}onClickReplyAll(e){l.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.ReplyAll),e.stopPropagation()}onClickForward(e){l.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.Forward),e.stopPropagation()}onClickReport(){l.default.menus.openModal(o.a.Modals.ReportProblem,{accountID:this.props.threadAttach.getField("accountID"),threadID:this.props.threadAttach.id,msgID:this.props.message.id})}_generateParticipantText(e){return e.text?e.text:e.email}isExpanded(){return this.props.expanded||this.props.isLastMessage||this.state.responseMode!==o.a.EmailResponseMode.None}openEmailDetails(e){var t=this.refs.messageHeaderText;l.default.menus.openContextMenu({componentName:"ReactContextMenuEmailDetails",element:t,message:this.props.message,accountID:this.props.threadAttach.getField("accountID")}),e.stopPropagation()}render(){var e,t=this.props,a=this.state,i=t.message,r=this.isExpanded(),n={height:a.height},d=l.default.International.formatDate(i.date,o.a.DFormat.MonthDay),c=l.default.International.formatDate(i.date,o.a.DFormat.ShortTime),u=t.isLastMessage||a.responseMode!==o.a.EmailResponseMode.None,p=h.a.windowWidth()>1080&&!s.default.isDemoMode(),g={},f={};r||(g.opacity=a.hovered?"1":"0"),p&&(f.opacity=a.hovered?"1":"0");var m,v,y={cursor:r?"pointer":null};if(m=b.a.createElement("span",{className:"from",onClick:r?this.openEmailDetails:void 0,style:y},this._generateParticipantText(i.from)),r){var _=(i.to?i.to:[]).concat(i.cc?i.cc:[]).map(this._generateParticipantText).join(", ");v=b.a.createElement("span",{className:"to c-foreground-faded",onClick:this.openEmailDetails,style:{cursor:"pointer"}},b.a.createElement("i",{className:"icon-long-arrow-right"}),b.a.createElement("span",null,_))}else v=b.a.createElement("span",{className:"snippet",dangerouslySetInnerHTML:{__html:i.snippet}});var S,P=b.a.createElement("span",{className:"emailDate c-foreground-faded"},b.a.createElement("div",{className:"emailDateDate"},d),b.a.createElement("div",{className:"emailDateTime"},c));e=b.a.createElement(V.a,{className:"messageHeader flexbox",onClick:this.onClickHeader},b.a.createElement("span",{className:"messageHeaderText f1",ref:"messageHeaderText"},m,v),b.a.createElement("span",{className:"headerButtons",style:g},p&&b.a.createElement(O.a,{height:40,className:"reportEmail",style:f,onClick:this.onClickReport},"Report Problem"),b.a.createElement(O.a,{iconSize:16,width:40,height:40,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply}),b.a.createElement(O.a,{iconSize:16,width:40,height:40,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll}),b.a.createElement(O.a,{iconSize:16,width:40,height:40,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward})),P),S=h.a.supportBlobURLIFrame?b.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:this.refFrame,sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",src:i.blobURL,style:n,scrolling:"no"}):b.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:this.refFrame,sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",style:n});var I=s.default.classNames("emailMessage emailBox c-border",{collapsed:!r},{prevCollapsed:!t.prevExpanded},{nextCollapsed:!t.nextExpanded}),D=s.default.classNames("emailMessageWrapper",{replying:a.responseMode!==o.a.EmailResponseMode.None});return b.a.createElement("div",{className:D,onMouseEnter:this.onMouseEnterMessage,onMouseLeave:this.onMouseLeaveMessage,ref:this.refMessage},b.a.createElement("div",{className:I},e,r&&b.a.createElement("div",{className:"messageContent",style:{}},S,b.a.createElement(je,{threadAttach:t.threadAttach,message:t.message,editable:!1}))),u&&b.a.createElement("div",{className:"replyPlaceholder flexbox flex-center",ref:"placeholder"},b.a.createElement("div",{className:"replyPlaceholderInner c-background c-shadow-light"},b.a.createElement(O.a,{iconSize:16,width:40,height:40,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply,selected:a.responseMode===o.a.EmailResponseMode.Reply,padding:24}),b.a.createElement(O.a,{iconSize:16,width:40,height:40,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll,selected:a.responseMode===o.a.EmailResponseMode.ReplyAll,padding:24}),b.a.createElement(O.a,{iconSize:16,width:40,height:40,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward,selected:a.responseMode===o.a.EmailResponseMode.Forward,padding:24}))))}};var rt=class extends C.a{init(){this.refMessage=b.a.createRef(),this.refCompose=b.a.createRef()}componentDidUpdate(){this._updateFocus()}onMount(){this.refMessage.current&&(this.scrollIntoView(),this._updateFocus())}getState(){var e=this.props.inReplyToMessage;return{responseMode:e.responseMode,replytoMessageHeight:e.height}}onAfterChanged(e,t){e.replytoMessageHeight!==t.replytoMessageHeight&&this.scrollIntoView()}scrollIntoView(){var e=this.refMessage.current;if(e){var t=s.default.findParent(e,"fancyScrollContent"),a=e.offsetTop+e.offsetHeight-t.clientHeight+16;s.default.scrollTo(0,a,o.a.ScrollDuration.Default,t)}}_updateFocus(){var e=this.state.responseMode;switch(e){case o.a.EmailResponseMode.None:break;case o.a.EmailResponseMode.Reply:case o.a.EmailResponseMode.ReplyAll:this.focusBody();break;case o.a.EmailResponseMode.Forward:case o.a.EmailResponseMode.Compose:this.focusTo();break;default:try{s.default.PAssert(628,!1,"Unknown response mode for reply box",e)}catch(t){s.default.reportError(t)}}}focusTo(){this.refCompose.current.focusTo()}focusBody(){this.refCompose.current.focusBody()}onClose(){l.default.EmailPreview.setMessageResponseMode(this.props.inReplyToMessage.id,o.a.EmailResponseMode.None)}render(){return this.state.responseMode!==o.a.EmailResponseMode.None?b.a.createElement("div",{className:"emailReplyBox emailBox c-shadow-popup",ref:this.refMessage},b.a.createElement(Ge,{threadAttach:this.props.threadAttach,message:this.props.message,ref:this.refCompose,onClose:this.onClose})):null}};var st=class extends C.a{init(){this.listenToDispatcher("windowResize"),this.createObservables({expandedMessages:[]}),s.default.isDemoMode()&&(s.default.reactEmailPreview=this)}onBeforeChanged(e,t){if(e.threadAttach!==t.threadAttach){var a=e.messages,i=[];if(a.length>0)for(var r=0,s=this.getLastMessage(e),n=0;n<a.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=a[n];(o===s||this.isMessageUnread(o))&&i.push(o.id)}this.expandedMessages.set(i,!1),e.expandedMessages=i}}getState(){return{rect:this.props.pane.rect,pane:l.default.EmailPreview.openOnPane,isLoading:l.default.EmailPreview.isLoading,threadAttach:l.default.EmailPreview.threadAttach,threadItem:l.default.EmailPreview.threadItem,messageIDs:l.default.EmailPreview.messageIDs,messages:l.default.EmailPreview.getMessages(),errorMessage:l.default.EmailPreview.errorMessage,messagesLoaded:l.default.EmailPreview.messagesLoaded}}getLastMessage(e){return e=e||this.state,l.default.pluginManager.getPluginGmail().getLastMessage(e.threadAttach)}onEscapeKey(){l.default.EmailPreview.close()}isMessageDraft(e){return e.labelIds.indexOf("DRAFT")>=0}isMessageUnread(e){return e.labelIds.indexOf("UNREAD")>=0}onClickClose(){l.default.EmailPreview.close()}onClickArchive(){this.props.pane.archiveItem(!0,this.state.threadItem)}onClickLabel(e){this.props.pane.autocompleteLabel({elementDisplay:e.target,item:this.state.threadItem})}onClickMove(e){this.props.pane.autocompleteMove({elementDisplay:e.target,item:this.state.threadItem})}onClickSchedule(e){this.props.pane.autocompleteSchedule({elementDisplay:e.target,item:this.state.threadItem})}onClickSnooze(e){var t=this.state.threadAttach.getField("accountID");this.props.pane.autocompleteSnooze({elementDisplay:e.target,item:this.state.threadItem},t)}onClickUnread(){this.props.pane.markItemRead(!1,this.state.threadItem)}onClickDelete(){var e,t=this.state,a=this.props.pane,i=l.default.pluginManager.getPluginGmail();if(a.type===o.a.PaneMode.Gmail)a.deleteSelected(i.isGmailItem,!0);else if(m.a.getStartItem()===t.threadItem&&(e=a.indexOfPrevVMLI(m.a.getStartIndex(),!0,!0)),t.threadItem.deleteSelf(o.a.ChangeType.Local),l.default.EmailPreview.reset(),e){var r=a.itemAtIndex(e);if(r){var s=r.getParsedText().length;m.a.selectIndex(e,s)}}}onClickPrint(){var e=l.default.pluginManager.getPluginGmail().createPrintURLForThread(this.state.threadAttach);s.default.printPage(e)}onClickViewInGmail(){var e=l.default.pluginManager.getPluginGmail().createURLForThread(this.state.threadAttach);s.default.openUrl(e)}onClickReply(e){var t=this.getLastMessage();l.default.EmailPreview.setMessageResponseMode(t.id,o.a.EmailResponseMode.Reply)}onClickReplyAll(e){var t=this.getLastMessage();l.default.EmailPreview.setMessageResponseMode(t.id,o.a.EmailResponseMode.ReplyAll)}onClickForward(e){var t=this.getLastMessage();l.default.EmailPreview.setMessageResponseMode(t.id,o.a.EmailResponseMode.Forward)}toggleExpanded(e){var t=this.state.messages,a=t[e];this.expandedMessages.indexOf(a.id)>=0?!(t.length>1&&e<t.length-1)||t[e+1]&&this.isMessageDraft(t[e+1])||this.expandedMessages.remove(a.id):this.expandedMessages.push(a.id)}onClickDown(){this.props.pane.keyMoveDown()}onClickUp(){this.props.pane.keyMoveUp()}onClickMobileReply(){l.default.menus.openContextMenu({fn:this.renderContextMenuReply})}renderContextMenuReply(e){return b.a.createElement(L.a,{key:"contextMenuGmailReply",id:"contextMenuGmailReply",className:"contextMenuMobile",element:e.element,position:"bottom"},b.a.createElement(x.a,{icon:"icon-reply",onClick:this.onClickReply},"Reply"),b.a.createElement(x.a,{icon:"icon-reply-all",onClick:this.onClickReplyAll},"Reply All"),b.a.createElement(x.a,{icon:"icon-forward",onClick:this.onClickForward},"Forward"))}render(){var e,{threadAttach:t,messages:a,rect:i,isLoading:r,errorMessage:n,messagesLoaded:d}=this.state;if(this.props.pane.type,o.a.PaneMode.Gmail,(a=a||[]).length>0){for(var c=0,u=a[0],p=(t.getPlugin().getDisplayParticipants(t),u.subject||"(no subject)"),g=[],f=this.expandedMessages.get(),m=this.getLastMessage(),v=0;v<a.length;++v){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var y,_=a[v];if(this.isMessageDraft(_)){try{s.default.PAssert(246,v>0,"Should never have a draft as the first message in the list")}catch(T){s.default.reportError(T)}var S=a[v-1];y=b.a.createElement(rt,{key:S.id+"_draft",threadAttach:t,message:_,inReplyToMessage:S})}else{var P=f.indexOf(_.id)>=0,I=a[v-1],D=a[v+1],w=0===v||f.indexOf(I.id)>=0||this.isMessageDraft(I),E=v>=a.length-2||f.indexOf(D.id)>=0||this.isMessageDraft(D);y=b.a.createElement(it,{key:_.id,index:v,threadAttach:t,message:_,toggleExpanded:this.toggleExpanded.bind(this,v),expanded:P,isLastMessage:_===m,prevExpanded:w,nextExpanded:E})}g.push(y)}e=b.a.createElement("div",{className:"emailMessages c-background c-border c-foreground",style:{opacity:d?1:0}},g)}else e=r?b.a.createElement(j.a,{center:!0},"Loading messages..."):n?b.a.createElement("div",{className:"noMessages center"},n):b.a.createElement("div",{className:"noMessages center"},"No conversation selected");var C=s.default.classNames("emailPreview c-background c-border",{noClick:l.default.PaneManager.isResizingPane},{transition:!l.default.PaneManager.isResizingPane}),A={width:i.widthExpanded,[h.a.transform.react]:"translate("+(i.left+i.width)+"px,0)"},M=s.default.classNames("emailPreviewTop c-foreground c-background c-border-light",{hasBorder:a.length>0});return b.a.createElement("div",{className:C,style:A},b.a.createElement("div",{className:M},a.length>0&&b.a.createElement(b.a.Fragment,null,b.a.createElement("div",{className:"emailHeaderRow"},b.a.createElement("div",{className:"emailButtons"},b.a.createElement(O.a,{icon:"icon-check",iconSize:17,width:36,height:36,tooltip:"Archive (E)",onClick:this.onClickArchive}),b.a.createElement(O.a,{icon:"icon-access_time",iconSize:17,width:36,height:36,tooltip:"Snooze (D)",onClick:this.onClickSnooze}),b.a.createElement(O.a,{icon:"icon-unread icon-unread-header",iconSize:15,width:36,height:36,tooltip:"Mark Unread (U)",onClick:this.onClickUnread}),b.a.createElement(O.a,{icon:"icon-tag",iconSize:15,width:36,height:36,tooltip:"Label (L)",onClick:this.onClickLabel}),b.a.createElement(O.a,{icon:"icon-align-left",iconSize:15,width:36,height:36,tooltip:"Add to Outline (M)",onClick:this.onClickMove}),b.a.createElement(O.a,{icon:"icon-calendar",iconSize:15,width:36,height:36,tooltip:"Add to Calendar (C)",onClick:this.onClickSchedule}),b.a.createElement(O.a,{icon:"icon-delete",iconSize:18,width:36,height:36,tooltip:"Delete (Backspace)",onClick:this.onClickDelete}),!h.a.app&&b.a.createElement(O.a,{icon:"icon-print",iconSize:18,width:36,height:36,tooltip:"Print (P)",onClick:this.onClickPrint}),b.a.createElement(O.a,{icon:"icon-gmail",iconSize:15,width:36,height:36,tooltip:"Open in Gmail (G)",onClick:this.onClickViewInGmail}))),b.a.createElement("div",{className:"emailHeaderRow emailSubject"},p)),b.a.createElement(O.a,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,onClick:this.onClickClose,tooltip:"Close"})),b.a.createElement(ce.a,{className:"emailMessagesScroller"},e))}};var nt=class extends C.a{getState(){return{toasts:l.default.toasts.queue}}render(){for(var e=0,t=this.state,a=[],i=0;i<t.toasts.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.toasts[i];s.default.classNames("toast noSelect",{hasAction:!!r.actionText},{big:r.isBig}),a.push(b.a.createElement(de,{key:r.id,toast:r}))}return b.a.createElement(E.CSSTransitionGroup,{id:"toasts",transitionName:"reactFade",transitionEnterTimeout:800,transitionLeaveTimeout:100},a)}};var ot=class extends C.a{getState(){return{caption:s.default.AScript.demoCaption}}render(){var e=this.state.caption;if(void 0!==e){var t=s.default.classNames("demoCaption",{center:e.center},{light:e.light});return b.a.createElement("div",{className:t,style:{opacity:e.opacity}},b.a.createElement("div",{className:"demoCaptionText",dangerouslySetInnerHTML:{__html:e.text}}))}return null}},lt=C.b.createClass({displayName:"ReactIntroPopup",componentDisplay:o.a.ComponentDisplay.Desktop,close:function(){l.default.settings.closeHelp("firstRunIntro")},showHelp:function(){this.close();var e=s.default.createPath("help/basics");s.default.openUrl(e)},render:function(){return b.a.createElement("div",{id:"introPopup",className:"intro"},b.a.createElement(we,{title:"Introduction",close:this.close},b.a.createElement("div",{className:"helpSection c-border-heavy"},b.a.createElement("div",{className:"helpVideo"},b.a.createElement("iframe",{src:"https://www.youtube.com/embed/"+o.a.IntroVideoID,frameBorder:"0",allowFullScreen:!0}))),b.a.createElement("div",{id:"introOpenHelp"},b.a.createElement(O.a,{primary:!0,raised:!0,onClick:this.showHelp},"How to get started"))))}});var dt=class extends C.a{init(){this.listenToDispatcher("windowResize")}getState(){var e=this.updatePosition();return{left:e.left,top:e.top}}onMount(){this.updateState()}updatePosition(){var e,t=this.props.tip,a=document.documentElement.getBoundingClientRect(),i=this.refs.element;if(t.element)e=t.element.getBoundingClientRect();else try{s.default.PAssert(573,!1,"Adjust bounds had no valid tip for determining an offset",t)}catch(u){s.default.reportError(u)}if(e){if(i){var r,n,o=s.default.width(i),d=s.default.height(i),h=e.left+e.width/2-o/2,c=t&&t.offset;return t&&(t.onRight||s.default.findParentID(t.element,"desktopMenu",8))&&(n=!0,c={left:8+l.default.DesktopUI.getSidebarWidth()+((c?c.left:0)||0)}),r=n?e.top+(e.height-d)/2:t&&t.above||e.bottom+d>a.bottom?e.top-d:e.bottom,c?(c.x?h+=c.x:c.right?h=a.right-o-c.right:c.left&&(h=c.left),c.y?r+=c.y:c.top&&(r+=c.top)):t&&t.above?r-=5:r+=5,h+o>a.right?h=a.right-o-4:h<0&&(h=4),r<0&&(r=4),{left:h=Math.round(h),top:r=Math.round(r)}}return{left:e.left,top:e.top}}}onClick(){l.default.tooltip.hideSticky(this.props.tip.text)}render(){var e=this.state,t=this.props.tip,a=t.text+(t.hotkey?'<div class="tooltipHotkey">'+t.hotkey+"</div>":""),i=s.default.classNames("tooltip flexbox flexvert",{blue:t.blue},{sticky:t.sticky},{hasHotkey:t.hotkey},{noFormat:a.indexOf("<b>")<0},{arrowDirection:t.arrowDirection}),r=s.default.classNames("tooltipArrow c-tooltip c-shadow-popup",t.arrowClass),n={maxWidth:t.maxWidth};return n[h.a.transform.react]="translate3d("+e.left+"px,"+e.top+"px,0)",b.a.createElement("div",{className:i,style:n,onClick:this.onClick,ref:"element"},b.a.createElement("div",{className:r}),b.a.createElement("div",{className:"tooltipText c-tooltip c-shadow-popup",dangerouslySetInnerHTML:{__html:a}}))}};var ht=class extends C.a{getState(){return{tooltip:l.default.tooltip.tooltip,tooltipsSticky:l.default.tooltip.tooltipsSticky}}render(){var e=this.state,t=e.tooltip?e.tooltipsSticky.concat(e.tooltip):e.tooltipsSticky;return t.length>0?b.a.createElement("div",{className:"tooltips"},t.map(e=>b.a.createElement(dt,{key:e.text,tip:e}))):null}},ct=a(46),ut=a(463);var pt=class extends C.a{init(){this.createObservables({numPanes:1,selectedIndex:0}),this.panePlaceholder=ct.a.createPane(o.a.PaneMode.Task,{isFakePane:!0,document:d.a.getEmptyDocument()})}getState(){var e=l.default.PaneManager;return{registeredPanes:ct.a.activePaneTypes,numInactivePanes:ct.a.numInactivePanes,totalWidth:e.totalWidth,hasPremiumFeatures:l.default.billingManager.hasPremiumFeaturesObservable,sidebarWidthObs:l.default.DesktopUI.sidebarWidth,sidebarWidth:l.default.DesktopUI.getSidebarWidth()}}onClickCreateBoard(){for(var e=0,t=l.default.PaneManager,a=[],i=0;i<this.state.numPanes;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this.refs["config_"+i],s=r.getPane(),n=r.getZoomItem();s.setDocument(d.a.getDefaultDocument(),!0),n&&s.setItem(n.item),t.addPaneAtIndex(s,i,!1,!1),a[i]=s}l.default.PaneUpdateBatcher.updateAllItems(!0,!0),t.notifyPanes(),m.a.setFocusedPane(a[0])}onMouseDownPlaceholder(){this.numPanes.set(this.numPanes.get()+1)}renderPanes(){for(var e=0,t=this.state,a=t.numPanes,i=[],r=0;r<a+1;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=r===a,l=n&&r>=o.a.PremiumMaxPanes&&!t.hasPremiumFeatures,d=l?"Go Premium to add more panes":n?"Add another pane":"Pane "+(r+1),h=s.default.classNames("c-background",{placeholder:n});i.push(b.a.createElement("div",{key:r},b.a.createElement("div",{className:"boardBuilderPaneTitle"},d),b.a.createElement("div",{className:"boardBuilderPane c-border"},!l&&b.a.createElement("div",{onMouseDownCapture:n?this.onMouseDownPlaceholder:void 0},b.a.createElement(ut.a,{className:h,showSearchZoom:!0,ref:"config_"+r,hidePremiumTypes:!0})),l&&b.a.createElement("div",{className:"paneConfigPremiumBlocked flexbox flexvert"},b.a.createElement("div",{className:"ib c-border-heavy"},"Using more than ",o.a.PremiumMaxPanes," panes on a board is a Premium feature")))))}return i}render(){var e={left:this.state.sidebarWidth};return b.a.createElement("div",{id:"addPaneAreaWrapper",className:"flexbox flexvert flex-center",style:e},b.a.createElement("div",{className:"addPaneAreaDescription"},b.a.createElement("div",{className:"addPaneHeader center bold"},"Create a new board"),b.a.createElement("div",{className:"addPaneMessage c-foreground-light"},"Each Pane is a unique view on your data. Combine multiple panes together to customize your own Boards.")),b.a.createElement("div",{className:"addPaneArea"},b.a.createElement("div",{className:"boardCreatorPanes"},this.renderPanes()),b.a.createElement("div",{className:"createBoardArea center flexbox flexvert flex-center"},b.a.createElement(O.a,{raised:!0,primary:!0,onClick:this.onClickCreateBoard},"CREATE BOARD"))))}};var gt,ft=class extends C.a{getState(){var e=l.default.setup;return{loginStatus:e.loginStatus,popupClosedError:e.popupClosedError,shouldShowLogin:e.shouldShowLogin(),gapiFailedToLoad:e.gapiFailedToLoad,loggedOutByAuthFailure:e.loggedOutByAuthFailure}}onClickLogin(){l.default.setup.userLogin()}onClickLanding(e){s.default.hasClass(e.target,"link")&&s.default.openUrl("https://www.moo.do",e)}onClickDownloadApp(){s.default.openUrl(h.a.getAppDownloadURL())}onClickPrivacy(e){s.default.hasClass(e.target,"link")&&s.default.openUrl("https://www.moo.do/privacy/",e)}render(){var{popupClosedError:e,loggedOutByAuthFailure:t}=this.state,a=l.default.setup;return b.a.createElement("div",{id:"setupWrapper",className:"flexbox flexvert"},b.a.createElement("div",{id:"setupInner"},b.a.createElement("div",{id:"loginInfo"},b.a.createElement("div",{id:"setupLogo"})),b.a.createElement("div",{id:"setupBox"},b.a.createElement("div",{id:"login"},b.a.createElement("div",{id:"loginArea"},b.a.createElement("div",{className:"loginButton google",onClick:this.onClickLogin}),b.a.createElement("div",{id:"learnButton",onClick:this.onClickLanding},"Learn more at ",b.a.createElement("b",{className:"link"},"https://moo.do"))),e&&b.a.createElement("div",{className:"popupClosedError red"},e),t&&b.a.createElement("div",{className:"popupClosedError"},"Logged out due to an error connecting to Google. If you are using a privacy plugin such as Ghostery or Privacy Badger, please disable them or download the app below."),a.showDownload&&b.a.createElement("div",{className:"textInLine"},b.a.createElement("div",null,"or")),a.showDownload&&b.a.createElement("div",{id:"setupDownloadArea"},b.a.createElement("div",{className:"loginButton black",onClick:this.onClickDownloadApp},b.a.createElement("span",{className:h.a.getPlatformIcon()}),b.a.createElement("span",{className:"signInText"},a.downloadText)))))))}},mt=a(103);!function(e){e[e.PluginSelect=0]="PluginSelect",e[e.Encrypt=1]="Encrypt",e[e.ImportData=2]="ImportData"}(gt||(gt={}));var vt=class extends C.a{init(){var e=gt.PluginSelect;this.createObservables({page:e,colorTheme:o.a.ColorTheme.Light,errorGapiImport:"",modal:void 0,errorEncrypt:""}),Fe.a.ensureGapi(),n.a.removeURLParam("ispremium",!0)}getState(){return{modalStack:l.default.menus.modalStack,isGapiLoaded:Fe.a.isGapiLoaded,loadState:d.a.loadState}}onAfterChanged(e,t){e.modal?e.modal&&0===e.modalStack.length&&this.modal.set(void 0):this.getModal(e)}getModal(e){let t=e.modalStack;t&&t.length>0&&(t[0].id===o.a.Modals.EnterCode?Promise.all([a.e(0),a.e(2)]).then(a.bind(null,776)).then(e=>{this.modal.set(e.default)}):t[0].id===o.a.Modals.ImportMoodo?Promise.all([a.e(0),a.e(2)]).then(a.bind(null,777)).then(e=>{this.modal.set(e.default)}):t[0].id===o.a.Modals.ConfirmEncrypt&&Promise.all([a.e(0),a.e(2)]).then(a.bind(null,778)).then(e=>{this.modal.set(e.default)}))}nextPage(){let e=this.page.get()+1;e===gt.Encrypt&&l.default.settings.userEncryptionSentinel.get()&&e++,this.page.set(e)}onClickEnable(){this.state.page;var e=[o.a.PluginID.Contacts,o.a.PluginID.GCalendar,o.a.PluginID.Gmail,o.a.PluginID.Drive].filter(e=>this.refs[e].getValue()),t=e.map(e=>e===o.a.PluginID.Drive?{id:e,shared:this.refs.DriveShared.getValue()}:{id:e});y.a.enablePlugins(t,!1,t=>{t&&(l.default.billingManager.hasPremiumFeatures()||(e.indexOf(o.a.PluginID.Drive)>=0||e.indexOf(o.a.PluginID.GCalendar)>=0)&&l.default.billingManager.startTrial(),this.nextPage())})}onChangeDrive(e){this.onChangeFeature(e),e||this.refs.DriveShared.setValue(!1)}onChangeDriveShared(e){this.onChangeFeature(e),e&&this.refs[o.a.PluginID.Drive].setValue(!0)}onChangeFree(e){this.refs[o.a.PluginID.Contacts].setValue(e),this.refs[o.a.PluginID.Gmail].setValue(e)}onChangePremium(e){this.refs[o.a.PluginID.GCalendar].setValue(e),this.refs[o.a.PluginID.Drive].setValue(e),this.refs.DriveShared.setValue(e)}checkTier(e,t){for(var a=0,i=0,r=0;r<t.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.refs[t[r]].getValue()?i++:i--}i===t.length&&e.setValue(!0),i===-t.length&&e.setValue(!1)}onChangeFeature(e){this.checkTier(this.refs.free,[o.a.PluginID.Contacts,o.a.PluginID.Gmail]),this.checkTier(this.refs.premium,[o.a.PluginID.GCalendar,o.a.PluginID.Drive,"DriveShared"])}onClickImport(e){this.startFresh(),l.default.menus.openModal(o.a.Modals.ImportData,{importer:e})}startFresh(){A.a.createDefaultState()}onClickImportMoodo(e,t){(new mt.a).authAndImportDocuments()}onClickSkipEncryption(){this.nextPage()}onClickSaveEncrypt(){let e=this.refs.pass1.getValue(),t=this.refs.pass2.getValue(),a=o.a.EncryptionKeys.UserPassword;e?e!==t?this.errorEncrypt.set("Passwords do not match"):e.length<5?this.errorEncrypt.set("Password is too short. Please enter a longer password to make it secure."):l.default.menus.confirmEncrypt(e,t=>{t&&(this.nextPage(),l.default.crypto.addKey({name:a,password:e,sentinelSalt:r.a.getEncryptionUid()}).then(e=>{Je.a.updateUserEncryption(e)}))}):this.errorEncrypt.set("No password entered")}renderModal(e){let t=this.state.modalStack[0];return b.a.createElement(this.state.modal,me()({noBackdrop:!0},t))}renderPage(e){switch(e){case gt.PluginSelect:return this.renderPagePluginSelect();case gt.Encrypt:return this.renderPageEncryptionKey();case gt.ImportData:return this.renderPageImportData();default:try{s.default.PAssert(248,!1,"Invalid intro page requested: "+e)}catch(t){s.default.reportError(t)}}}renderConnecting(){return b.a.createElement("div",{key:"content"},b.a.createElement("div",{className:"flexbox flex-center",style:{margin:"64px 0"}},b.a.createElement(j.a,{center:!0},"Connecting...")))}renderPagePluginSelect(){return b.a.createElement("div",{key:"content",className:"pageConnect"},b.a.createElement("div",{className:"setupTitle"},"Connect with Google Services"),b.a.createElement("div",{className:"setupFeatures featureCheckboxes"},b.a.createElement("div",{className:"featureTier c-border"},b.a.createElement("div",{className:"tierTitleWrapper"},b.a.createElement(De.a,{ref:"free",className:"tierTitle c-background",checked:!0,onChange:this.onChangeFree},"Free Features")),b.a.createElement("div",{className:"flexbox"},b.a.createElement("div",{className:"setupFeatureHalf"},b.a.createElement(De.a,{ref:o.a.PluginID.Contacts,checked:!0,onChange:this.onChangeFeature},b.a.createElement("img",{src:"/img/plugin-gcontacts.png"}),"Google Contacts")),b.a.createElement("div",{className:"setupFeatureHalf"},b.a.createElement(De.a,{ref:o.a.PluginID.Gmail,checked:!0,onChange:this.onChangeFeature},b.a.createElement("img",{src:"/img/plugin-gmail.png"}),"Gmail")))),b.a.createElement("div",{className:"featureTier c-border"},b.a.createElement("div",{className:"tierTitleWrapper"},b.a.createElement(De.a,{ref:"premium",className:"tierTitle c-background",checked:!0,onChange:this.onChangePremium},"Premium Features")),!l.default.billingManager.hasPremiumFeatures()&&b.a.createElement("div",{className:"featureTierDesc c-foreground-light",style:{marginTop:-8}},"Enabling Premium features will start a free "+o.a.TrialDuration+" day trial of Moo.do Premium."),b.a.createElement("div",{className:"flexbox"},b.a.createElement("div",{className:"setupFeature setupFeatureHalf"},b.a.createElement(De.a,{ref:o.a.PluginID.GCalendar,checked:!0,onChange:this.onChangeFeature},b.a.createElement("img",{src:"/img/plugin-gcal.png"}),"Google Calendar")),b.a.createElement("div",{className:"setupFeature setupFeatureHalf"},b.a.createElement(De.a,{ref:o.a.PluginID.Drive,checked:!0,onChange:this.onChangeDrive},b.a.createElement("img",{src:"/img/plugin-gdrive.png"}),"Google Drive"),b.a.createElement(De.a,{ref:"DriveShared",checked:!0,className:"subcheckbox",onChange:this.onChangeDriveShared},"Share files with collaborators")))),b.a.createElement("div",{className:"setupSubtext"},b.a.createElement("b",null,"Moo.do")," interacts with your Google services only client-side and your data is never sent to any server or shared with anyone. See our ",b.a.createElement("span",{className:"link"},"Privacy Policy")," for more details."),b.a.createElement("div",{className:"setupButtons center"},b.a.createElement(O.a,{raised:!0,primary:!0,onClick:this.onClickEnable},"NEXT"))))}renderPageEncryptionKey(){let{errorEncrypt:e}=this.state,t={marginTop:8,width:240};return b.a.createElement("div",{key:"content"},b.a.createElement("div",{className:"setupTitle"},"Password protect your data"),b.a.createElement("div",{className:"welcomeEncryption"},b.a.createElement("div",{className:"modal-subtext c-foreground-faded"},"Your data is encrypted client-side before sending it to the database. For an extra level of security, you can enter your own password for the encryption. This makes it so that even the developers cannot read your data, and it cannot be recovered."),b.a.createElement("div",{style:{marginTop:24}},b.a.createElement(Le.a,{type:"password",placeholder:"Password",ref:"pass1",style:t}),b.a.createElement(Le.a,{type:"password",placeholder:"Confirm Password",ref:"pass2",style:t})),b.a.createElement("div",{className:"modal-warning flexbox c-warning"},b.a.createElement("i",{className:"icon-warning"}),b.a.createElement("div",null,"If you lose this password, all your data will be lost! For your security, Moo.do cannot recover your password, so keep your password safe. This is competely optional (see above).")),e&&b.a.createElement("div",{className:"error",style:{marginTop:8}},e),b.a.createElement("div",{style:{marginTop:24}},b.a.createElement(O.a,{raised:!0,onClick:this.onClickSkipEncryption},"SKIP"),b.a.createElement(O.a,{raised:!0,primary:!0,marginLeft:24,onClick:this.onClickSaveEncrypt},"SAVE"))))}renderPageImportData(){return b.a.createElement("div",{key:"content"},b.a.createElement("div",{className:"setupTitle"},"Coming from the old Moo.do?"),b.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Please import your Premium status, billing data, and files from the old database"),b.a.createElement("div",{style:{margin:"32px 0"}},b.a.createElement(O.a,{raised:!0,enabled:this.state.isGapiLoaded,onClick:this.onClickImportMoodo},"Import from Moo.do")),b.a.createElement("hr",{style:{width:600,margin:"32px auto"}}),b.a.createElement("div",{className:"setupTitle"},"Import from another app"),b.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Copy your data from another app into Moo.do"),b.a.createElement("div",{className:"flexbox flex-center importWrapper",style:{marginTop:32}},b.a.createElement("div",{className:"welcomeImporters"},["Wunderlist","Workflowy","Trello","Google Tasks","Todoist"].map((e,t)=>b.a.createElement(O.a,{key:t,raised:!0,onClick:this.onClickImport.bind(this,e)},e)))),b.a.createElement("hr",{style:{width:200,margin:"32px auto"}}),b.a.createElement("div",{className:"setupTitle"},"Just start fresh"),b.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Start from scratch with an empty document. You can always import your data later."),b.a.createElement("div",{style:{marginTop:32}},b.a.createElement(O.a,{raised:!0,onClick:this.startFresh},"Get Started")))}render(){let{loadState:e}=this.state,t=s.default.classNames("welcome c-background flexbox flexvert flex-center"),a=e!==o.a.LoadState.Connected,i=this.state.modal;return b.a.createElement("div",{className:t},b.a.createElement("div",{style:{width:720}},i&&this.renderModal(i),!i&&(a?this.renderConnecting():this.renderPage(this.state.page))))}};var yt,_t,St=class extends C.a{getState(){return{hasUpdate:l.default.AppCache.hasUpdate,ignoreUpdate:l.default.AppCache.ignoreUpdate}}onClickClose(){l.default.AppCache.ignoreUpdate.set(!0)}onClickLog(){s.default.openUrl(location.origin+"/changelog/")}onClickUpdate(){s.default.reload()}render(){if(this.state.hasUpdate&&!this.state.ignoreUpdate){let e=32,t=11,a={lineHeight:e+"px"};return l.default.settings.showSidebar.get()?(a.bottom=6,a.left=l.default.settings.sidebarWidth.get()+6):(a.top=o.a.DesktopToolbarHeight+6,a.right=6),b.a.createElement("div",{id:"updateMessage",className:"flexbox",style:a},b.a.createElement(O.a,{color:"white",height:e,icon:"icon-close",onClick:this.onClickClose}),b.a.createElement("div",{className:"updateMessageText f1"},"A new update is available"),b.a.createElement(O.a,{color:"white",height:e,fontSize:t,padding:12,onClick:this.onClickLog},"LOG"),b.a.createElement(O.a,{color:"white",height:e,fontSize:t,padding:12,onClick:this.onClickUpdate},"UPDATE"))}return null}};var Pt=class extends C.a{init(){this.createObservables({modulesLoaded:!1,disablePointerEvents:!1}),this.scrollPos=0,setTimeout(()=>{var e=2;Promise.all([a.e(0),a.e(2)]).then(a.bind(null,805)).then(t=>{yt=t.default,0===--e&&this.modulesLoaded.set(!0)}),Promise.all([a.e(0),a.e(2)]).then(a.bind(null,806)).then(t=>{_t=t.default,0===--e&&this.modulesLoaded.set(!0)})},100);var e=h.a.blockClient();if(void 0!==e){s.default.errorPlatformInfo=e;var t,i=e.platform;i?t=e.update?"iOS App"===i?"Please update your iOS app to the latest version in the App Store.":"Android App"===i?"Please update your Android app to the latest version in the Play Store.":"Firefox"===i?'Please update your Firefox browser to use Moo.do. Moo.do requires at least Firefox 16. See <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">https://support.mozilla.org/en-US/kb/update-firefox-latest-version</a> for more information.':"Chrome"===i?'Please update your Chrome browser to use Moo.do. Moo.do requires at least Chrome 26. See <a href="https://support.google.com/chrome/answer/95414">https://support.google.com/chrome/answer/95414</a> for more information.':"Native Android"===i?"Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"===i?'Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"===i?'Please update your Safari browser to use Moo.do. Moo.do requires at least Safari 6.1. See <a href="http://support.apple.com/kb/HT6103">http://support.apple.com/kb/HT6103</a> for more information.':"Please update your browser to use Moo.do. If you are unable to update your browser, please let us know. Thanks!":"Sorry, we don't support "+i+" yet. Please let us know that you're interested in using "+i+" and we will make it a higher priority. Thanks!":e.version?t="Please update your app to the latest version of Moo.do. Thanks!":e.cacheUpdate&&(t="There was an issue while updating the app, "+h.a.actionVerb()+" to try again.",l.default.AppCache.update()),h.a.app&&l.default.nativeBridge.sendToApp("localLoaded"),t&&(this.platformError=t)}}onMount(){this.platformError||(this.setPanesContainer(),document.addEventListener("keydown",this.keydown),document.addEventListener("keypress",this.keypress),document.addEventListener("keyup",this.keyup),this.listenToDispatcher("panesChanged"))}componentDidUpdate(){this.platformError||this.setPanesContainer()}setPanesContainer(){var e=this.props.main;e.panesContainer||(e.panesContainer=this.refs.panes)}onClickErrorRefresh(){s.default.reload(!l.default.AppCache.useServiceWorker)}onClickErrorDownload(){s.default.openUrl(h.a.getAppDownloadURL())}_isOkToSendKey(e){var t=m.a.getPane();return!e.defaultPrevented&&t&&!t.isDestroyed()&&!t.isUnloaded()&&!(l.default.menus.isContextMenuOpen()&&!l.default.menus.isOnlyAutocompleteOpen())&&!l.default.menus.isModalOpen()&&!s.default.activeInput.get()}keydown(e){if(this._isOkToSendKey(e)&&m.a.getPane().keydown(e),e.target===document.body&&e.normCode===o.a.KeyCode.Backspace)return e.handled=!0,e.preventDefault(),!1}keypress(e){this._isOkToSendKey(e)&&m.a.getPane().keypress(e)}keyup(e){this._isOkToSendKey(e)&&m.a.getPane().keyup(e)}onMouseDownPanes(e){"panes"===e.target.id&&m.a.reset()}getState(){var e=this.props.main,t=l.default.PaneManager,a=h.a.blockedReason.get();return a?{blockedReason:a}:{panes:t.displayPanes,documents:d.a.documentsArray,boards:A.a._boards,isHelpShowing:l.default.intro.isVisible,helpPosition:l.default.intro.position,isWindowFocused:m.a.isWindowFocused,isDragging:l.default.DragDrop.isVisible,isDraggingPane:l.default.DragDrop.isDraggingPane,isLoading:t.isLoading,animatePaneSwap:t.animatePaneSwap,isDraggingSidebar:l.default.DesktopUI.isDraggingSidebar,showSidebar:l.default.DesktopUI.showSidebar,cursor:e.cursor,activeUser:l.default.settings.activeUser,isMainRendered:e.isRendered,showMarkdown:l.default.settings.showMarkdown,inTooltipIntro:l.default.settings.inTooltipIntro,closedHelps:l.default.settings.closedHelps,blockedReason:h.a.blockedReason,showIntroPopup:!1}}_onTimeoutPointerEvents(){this.disablePointerEvents.set(!1)}onScroll(e){"panes"===e.target.id&&e.target.scrollLeft!==this.scrollPos&&(this.scrollPos=e.target.scrollLeft,this.disablePointerEvents.set(!0),this._timeoutPointerEvents&&clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=setTimeout(this._onTimeoutPointerEvents,500))}render(){var e,t,a=this.state,i=[];if(a.blockedReason&&(this.platformError=a.blockedReason),this.platformError)e=b.a.createElement("div",{className:"centerVHFlex",style:{width:540,lineHeight:1.5}},b.a.createElement("div",null,b.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.platformError}}),b.a.createElement("br",null),b.a.createElement("br",null),b.a.createElement("div",null,b.a.createElement(O.a,{raised:!0,onClick:this.onClickErrorRefresh},"Reload")),b.a.createElement("br",null),b.a.createElement("div",null,b.a.createElement(O.a,{raised:!0,onClick:this.onClickErrorDownload},"Download app"))));else{for(var r=0,n=0;n<a.panes.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var d=a.panes[n],c=d.type,u=d.pane;if(u.hasBeenActive)if("overview"===c)i.push(b.a.createElement(at,{key:"overview"+u.id,pane:u}));else if("pane"===c)switch(u.type){case o.a.PaneMode.Task:i.push(b.a.createElement(_e,{key:"pane"+u.id,pane:u}));break;case o.a.PaneMode.Archived:case o.a.PaneMode.Drive:i.push(b.a.createElement(pe,{key:"pane"+u.id,pane:u}));break;case o.a.PaneMode.Gmail:i.push(b.a.createElement(Se,{key:"pane"+u.id,pane:u}));break;default:try{s.default.PAssert(17,!1,"Invalid pane mode requested"+u.type)}catch(_){s.default.reportError(_)}}else"emailPreview"===c&&i.push(b.a.createElement(st,{key:"emailPreview"+u.id,pane:u}))}var p=a.cursor;a.isDraggingSidebar&&(p="cursor-ew-resize");var g=s.default.classNames("renderedContent c-foreground c-bg-app",p,{windowBlurred:!a.isWindowFocused},{draggingItems:!!a.isDragging||a.isDraggingPane},{draggingPane:a.isDraggingPane},{hideMDMarkup:!a.showMarkdown});if(l.default.settings.activeUser.get()){if(a.isMainRendered)if(a.isLoading&&!s.default.isDemoMode())e=b.a.createElement("div",{id:"container"},b.a.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"c-foreground-light centerVH"},b.a.createElement("div",{className:"loading loading20"}),b.a.createElement("div",{className:"loadingText"},"Loading documents...")),b.a.createElement(nt,null));else if(0===a.documents.length||0===a.boards.length)e=b.a.createElement("div",{id:"container"},b.a.createElement(vt,null));else{var f,m=s.default.classNames("panes c-background",{noPanes:0===i.length},{noClick:a.isDraggingSidebar},{transition:l.default.DesktopUI.sidebarTransitioning},{noClickItems:a.disablePointerEvents}),v={left:-1,top:l.default.DesktopUI.shouldShowTopBar()?h.a.isNativeMac()?36:32:0};if(a.isHelpShowing){var y={};y[h.a.transform.react]="translate("+a.helpPosition+"px,0)",f=b.a.createElement("div",{id:"helpPlaceholder",style:y})}t=b.a.createElement("div",{id:"panes",className:m,ref:"panes","data-moo-id":"panes",style:v,onMouseDown:this.onMouseDownPanes},i.length>0?i:b.a.createElement(pt,null),f),e=b.a.createElement("div",{id:"container",className:g,onScroll:this.onScroll},b.a.createElement("div",{id:"measureText"},b.a.createElement("div",{id:"measureTextItem"})),h.a.isNativeMac()&&b.a.createElement("div",{className:"appTopBar desktopDrag c-bg-app"}),b.a.createElement(Be,null),t,a.showIntroPopup&&b.a.createElement(lt,null),l.default.pluginManager.getPluginGmail()&&b.a.createElement(Ye,null),yt&&b.a.createElement(yt,null),b.a.createElement(Ee,null),b.a.createElement(Me,null),_t&&b.a.createElement(_t,null),b.a.createElement(Pe,null),b.a.createElement(nt,null),b.a.createElement(ht,null),b.a.createElement(St,null),s.default.isDemoInIframe()&&b.a.createElement(ot,null))}}else e=b.a.createElement(ft,null)}return b.a.createElement(E.CSSTransitionGroup,{transitionName:"reactFadeMain",transitionEnterTimeout:300,transitionLeaveTimeout:100},e)}};t.default=()=>{try{if(!h.a.blockedReason.get()){s.default.checkpoint(o.a.Checkpoint.RequireLoaded),(e=>{e||r.a.init()})(s.default.isDemoMode()),l.default.init(),d.a.init(),window.__ERRORINMAINHEADER&&s.default.reportError(window.__ERRORINMAINHEADER);try{s.default.PAssert(0,-1===navigator.userAgent.indexOf("Electron")||h.a.appPlatform===o.a.AppPlatform.Electron,"Electron app missing app platform set")}catch(u){s.default.reportError(u)}s.default.checkpoint(o.a.Checkpoint.PageLoad);try{s.default.PAssert(1,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(u){s.default.reportError(u)}if("loading"===document.readyState){var e="ERROR: MainJS running before document load! "+document.readyState;s.default.shouldLog(o.a.LogLevels.Error)&&s.default.log(e),s.default.reportError(new Error(e))}for(var t in window.scriptErrors)window.scriptErrors.hasOwnProperty(t)&&s.default.fireCustomEvent("scriptLoadError",{src:t,id:window.scriptErrors[t],firstChance:!0});window.scriptErrors=window.scriptErrors||{},window.handleLoadError=function(e){try{window.scriptErrors[e.target.src]=e.target.id,s.default.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(t){s.default.reportError(t)}},window.oncontextmenu=function(e){s.default.isKeyboardInputElement(e.target)||e.preventDefault()},s.default.isDemoMode()||h.a.offline||(!function(e,t,a,i,r,s,n){e.GoogleAnalyticsObject=r,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,s=t.createElement(a),n=t.getElementsByTagName(a)[0],s.async=1,s.src="//www.google-analytics.com/analytics.js",n.parentNode.insertBefore(s,n)}(window,document,"script",0,"ga"),ga("create","UA-37740918-2",{cookieDomain:"auto"}),ga("send","pageview")),h.a.updateBodyClass();var a=function(e){document.documentElement.addEventListener(e,function(e){s.default.reportEvent(e)},!0)};0,a("keydown"),a("keyup"),a("keypress"),a("MSPointerDown"),a("MSPointerUp"),a("MSPointerHover"),a("MSPointerCancel"),a("mousedown"),a("mouseup"),a("touchstart"),a("touchend"),l.default.AppCache.init(),s.default.localDocChangeRequested=!1;var i=function(e){var t=h.a.getActualWindowWidth(),a=h.a.getActualWindowHeight();try{s.default.PAssert(2,0!==t&&!isNaN(t)&&0!==a&&!isNaN(a),"Window size is 0",t,a)}catch(u){s.default.reportError(u)}var i=h.a.windowWidth(!0),n=h.a.windowHeight(!0);t===i&&a===n||(h.a.setWindowSize(t,a),h.a.onResize.notify(),s.default.documentHeight=a,r.a.onActiveUser(()=>{p.a.fireEvent("windowResize",[])}))};function n(){h.a.updateOrientation()}i(),n(),s.default.shouldLog(o.a.LogLevels.Timing)&&s.default.log("Running main.js: ",log.now()),window.onblur=function(){s.default.hasFocus=!1},window.onfocus=function(){s.default.hasFocus=!0},new P,window.addEventListener("resize",i),window.addEventListener("orientationchange",n),window.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),window.addEventListener("dragover",function(e){return e.preventDefault(),!1});var c=!1;d.a.loadLocal(function(e){c||(c=!0,s.default.checkpoint(o.a.Checkpoint.InitializeMain),function(){try{!0,s.default.checkpoint(o.a.Checkpoint.OnInitializedData),s.default.isDemoMode()||(s.default.setupDateRollover(),window.addEventListener("focus",s.default.ensureDateRollover)),s.default.vmMain.loadData(),s.default.shouldLog(o.a.LogLevels.Timing)&&s.default.log("Data done loading: ",log.now())}catch(e){s.default.reportError(e)}}())}),!s.default.isDemoMode()&&h.a.app&&l.default.nativeBridge.sendToApp("loaded")}w.a.render(b.a.createElement(Pt,{main:s.default.vmMain}),document.getElementById("outerWrapper"))}catch(g){console.log(g),s.default.handleCriticalError(),s.default.reportError(g,"Critical Error")}}},463:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(5),o=a(2),l=a(15),d=a(46),h=a(13),c=a(149),u=a(452),p=l.b.createClass({displayName:"ReactPremiumWall",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return{hasPremium:s.default.billingManager.hasPremiumFeaturesObservable}},hasChildren:function(){var e=!1;return o.Children.forEach(this.props.children,t=>{t&&(e=!0)}),e},render:function(){var e=this.props,t=this.state;if(!1===e.needsPremium||t.hasPremium||!this.hasChildren())return e.children;if(e.children){var a=i.default.classNames(e.className,"premiumWall",{"border c-border-heavy c-bg-faded":!e.className});return o.createElement("div",{className:a,style:e.style,onClick:this.onClick},e.render&&e.render(),!e.render&&o.createElement(o.Fragment,null,o.createElement("div",{className:"premiumWallText c-foreground-faded flexbox flexvert flex-center",style:e.styleText},"Premium Features:"),o.createElement("div",{className:"noPremium"},e.children)))}}}),g=a(14),f=a(51),m=a(34),v=a(64),y=r.a.TaskSortMode;t.a=class extends l.a{init(){this.DISABLE_LISTENER_ASSERT=!0;var e=this.props;this.availablePanes=d.a.getAvailablePanes(!!e.subset);var t=e.pane||d.a.createPane(r.a.PaneMode.Task,{isFakePane:!0,document:h.a.getDefaultDocument()});this.createObservables({pane:t}),this.refZoomItem=o.createRef()}getState(){var e=this.pane.get(),t={pane:e,activePaneTypes:d.a.activePaneTypes,numInactivePanes:d.a.numInactivePanes,hasPremium:s.default.billingManager.hasPremiumFeaturesObservable};return e&&(t.viewState=e.viewState,t.viewMode=e.getViewMode(),t.sortModeBlocks=e.supportsSortBlocks()&&e.getSortModeBlocks(),t.sortModeItems=e.supportsSortItems()&&e.getSortModeItems(),t.sortOrderBlocks=e.supportsSortBlocks()&&e.getSortOrderBlocks(),t.sortOrderItems=e.supportsSortItems()&&e.getSortOrderItems(),t.filterShowOnlyMatches=e.search.getFilter("showOnlyMatches")&&e.search.getFilterObs("showOnlyMatches")),t}getZoomItem(){return this.refZoomItem.current.getItem()}getPane(){return this.state.pane}isPaneTypeOk(){return!this.props.subset}onClickEnableMorePanes(){s.default.menus.openSettings(r.a.SettingsSections.Plugins)}onSelected(e,t){if(e===this.state.pane.type)this.state.pane.setViewMode(t);else{var a={isFakePane:!0,document:h.a.getDefaultDocument()};t&&(a.viewState={viewMode:t}),this.pane.set(d.a.createPane(e,a)),this.refreshListeners()}}onSortModeClick(e,t,a){var i=1;(n.a.mac&&a.metaKey||!n.a.mac&&a.ctrlKey)&&(i=-1),this.state.pane["setSortMode"+(e?"Blocks":"Items")](t,i)}onChangePaneName(e){this.state.pane.setName(e)}renderSelectedNeedsPremium(){var e=this.state.pane.getViewMode();return o.createElement("div",null,o.createElement("div",{className:"ib c-border-heavy"},"The ",o.createElement("b",null,r.a.TaskViewModeText[e])," view is a Premium feature"))}renderPaneType(e,t){var a=this.props,r=this.state;if(e.enableMore)return o.createElement(m.a,{key:"enableMore",height:32,onClick:this.onClickEnableMorePanes},"Enable more panes");if(e.viewModes){for(var s=0,n=i.default.classNames("hasHorButtons",{"hasBorder c-border":e.border}),l=[],d=e.viewModes.length,h=0;h<d;h++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=e.viewModes[h],u=i.default.classNames("c-popup-item",{selected:c.viewMode===r.viewMode});a.hidePremiumTypes&&c.premium&&!r.hasPremium||l.push(o.createElement(g.a,{key:c.text,className:u,padding:0,iconSize:15,color:"c-foreground",onMouseUp:this.onSelected.bind(this,c.type,c.viewMode)},o.createElement("div",{className:"viewIcon c-foreground-faded "+c.icon}),c.text))}return o.createElement(m.a,{className:n,key:e.text,customLayout:!0,clickCloses:!1,hoverEffects:!1},o.createElement(v.a,{hotkeyCentered:!0},e.text),o.createElement("div",{className:"horButtons flexbox"},l))}var p=e.viewMode,f=e.type,y=i.default.classNames({"hasBorder c-border":e.border},{selected:this.state.pane.type===f&&(!p||this.state.viewMode===p)});return o.createElement(m.a,{key:e.text,className:y,icon:e.icon,height:32,onClick:this.onSelected.bind(this,e.type,e.viewMode),clickCloses:!1,id:"addPane_"+(p||e.type)},e.text)}renderSortMode(e,t){var a=this.state.pane,s=this.state.viewMode;if(!e||a.supportsSortBlocksMode(t,s)){var l=t===this.state["sortMode"+(e?"Blocks":"Items")],d=l&&-1===this.state["sortOrder"+(e?"Blocks":"Items")],h=i.default.classNames("sortModeButton c-border-light c-popup-item",{selected:l},{reversed:d}),c=l?"c-foreground":"c-foreground-light",u="<b>Click</b> to sort ascending.<br><b>"+n.a.priModKey+" + Click</b> to sort descending.";return o.createElement(g.a,{className:h,color:c,height:r.a.SearchHeight,tooltip:u,onClick:this.onSortModeClick.bind(this,e,t)},r.a.TaskSortModeText[t])}}renderSelectedPane(){var e=this.state,t=this.props,a=this.state.pane,i=a,s=e.viewMode,n=a.getViewMode(),l="Name this pane"+(e.hasPremium?"":" (Premium only)");return o.createElement(p,{className:"paneConfigNeedsPremium flexbox flexvert",needsPremium:!!r.a.TaskViewModesPremium[n],render:this.renderSelectedNeedsPremium},o.createElement("div",{className:"paneTypeDetails"},o.createElement(f.a,{className:"c-border-light",value:a&&a.name.get(),placeholder:l,readonly:!e.hasPremium,fontSize:13,height:32,border:!1,padding:{left:16,right:16},onChange:this.onChangePaneName}),t.showSearchZoom&&o.createElement(o.Fragment,null,o.createElement(f.a,{className:"c-border-light",autocompleteMode:r.a.AutocompleteMode.Item,placeholder:"Zoom to item",height:30,border:!1,padding:{left:16,right:16},autocompleteOnClick:!0,ref:this.refZoomItem,pane:a}),o.createElement(c.a,{pane:a,showFilters:!1})),o.createElement(u.a,{pane:a}),o.createElement(p,{style:{marginTop:8},styleText:{marginBottom:-8}},s&&i.supportsSortBlocks()&&o.createElement("div",{className:"sortSection"},o.createElement(v.a,null,"Sort ",r.a.TaskViewModeTextSimple[n]),o.createElement("div",{className:"borderButtons c-border-light"},this.renderSortMode(!0,y.None),this.renderSortMode(!0,y.Alphabetical),this.renderSortMode(!0,y.NumItems),this.renderSortMode(!0,y.Priority),this.renderSortMode(!0,y.Date),this.renderSortMode(!0,y.Created),this.renderSortMode(!0,y.Completed))),s&&i.supportsSortItems()&&o.createElement("div",{className:"sortSection"},o.createElement(v.a,null,"Sort Items"),o.createElement("div",{className:"borderButtons c-border-light"},this.renderSortMode(!1,y.None),this.renderSortMode(!1,y.Alphabetical),this.renderSortMode(!1,y.NumItems),this.renderSortMode(!1,y.Priority),this.renderSortMode(!1,y.Date),this.renderSortMode(!1,y.Created))))))}render(){var e=this.props,t=i.default.classNames("addPaneTypes withSelected flexbox",e.className);return o.createElement("div",{className:t},o.createElement("div",{key:"leftcol",className:"leftSide"},this.availablePanes.map(this.renderPaneType)),o.createElement("div",{className:"selectedPaneArea c-border-light f1"},this.renderSelectedPane()))}}},47:function(e,t,a){"use strict";var i=a(7),r=a.n(i),s=a(0),n=a(3),o=a(1);const l=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/;var d,h=class{constructor(e){var t=0,a=0;try{s.default.PAssert(850,s.default.isObject(e),"Should always supply a valid object to init a contact")}catch(r){s.default.reportError(r)}this.id=e.id,this.type="contact",this.text=e.text||"",this.phoneNumbers=e.phoneNumbers||[],this.emails=e.emails||[];for(var i=0;i<this.phoneNumbers.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let e=this.phoneNumbers[i];e.link=this.formatPhone(e.number),e.type=e.type?e.type[0].toLowerCase():""}for(i=0;i<this.emails.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.emails[i].link="mailto:"+this.emails[i].address}}formatPhone(e){if(l.test(e)){var t=e.match(l),a="";return t[1]&&(a+="+1-"+t[1]+"-"),"tel:"+(a+=t[2]+"-"+t[3])}var i=e.replace(/\D+/g,"");try{s.default.PAssert(851,i&&""!==i,"Invalid phone number format: "+e)}catch(r){s.default.reportError(r)}return e.startsWith("+")&&(i="+"+i),"tel:"+i}},c=a(31),u=a(32),p=a(18),g=a(8),f=a(20);let m=(d=class{constructor(){this._contactCache={},this._contacts=new u.a,this._contactsByID={},this._contactsByName={},this.areContactsLoaded=!1}init(){n.default.settings.syncContacts.listen((e,t)=>{e&&!e!==!t&&this.refreshContacts()})}loadContacts(e){let t=!1,a=!!e;if(!this.areContactsLoaded){let d=e||p.a.getContacts();try{s.default.PAssert(150,0===this._contacts.get().length,"Should only load contacts once")}catch(l){s.default.reportError(l)}if(this.areContactsLoaded=!0,d){for(var i=0,r=[],n=0;n<d.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=d[n];if(o.name&&(o.text=o.name,d[n].text=o.name,delete d[n].name,t=!0),!a&&o.isDemo||o.text&&!o.phoneNumbers&&!o.emails)t=!0;else{o.text&&(this._contactsByName[s.default.escape(o.text)]=o,r.push(o));try{s.default.PAssert(151,o.id,"Each contact must have a valid id")}catch(l){s.default.reportError(l)}}}this._contacts.set(r)}else this.clearContacts()}return t}updateContact(e){try{s.default.PAssert(152,e.id,"Incoming contacts must have a valid id")}catch(r){s.default.reportError(r)}try{s.default.PAssert(153,e.text,"All contacts are expected to have a text")}catch(r){s.default.reportError(r)}let t,a=s.default.escape(e.text),i=this._contactsByName[a];return e.emails&&e.emails.length&&(e.emails.forEach(e=>e.address=e.address.toLowerCase()),e.emails=s.default.arrayUniques(e.emails,"address")),i?(e.emails&&!s.default.deepEqual(e.emails,i.emails)&&(i.emails=s.default.arrayUnionByKey(i.emails||[],e.emails,"address"),t=!0),e.phoneNumbers&&!s.default.deepEqual(e.phoneNumbers,i.phoneNumbers)&&(i.phoneNumbers=s.default.arrayUnionByKey(i.phoneNumbers||[],e.phoneNumbers,"number"),t=!0)):(this._contacts.push(e),e.text&&(this._contactsByName[a]=e),t=!0),this._contactCache[e.id]&&(this._contactCache[e.id]=new h(e)),t}clearContacts(){this._contactCache={},this._contacts.clear(),this._contactsByName={}}numContacts(){return this._contacts.get().length}getContacts(){return this._contactsByName}getAll(){return this._contacts.get()}contactComparator(e,t){return e.text&&t.text?e.text.localeCompare(t.text):e.text&&!t.text?1:!e.text&&t.text?-1:void 0}getRNList(e){let t=[];return this.findMatchLike(e).forEach(e=>{let a=e.text.split(" "),i=a.map(e=>e[0]).slice(0,Math.min(2,a.length)).join(""),r=e.emails;t.push({text:e.text,iconText:i,subText:r.length?r[0].address:void 0})}),t.sort(this.contactComparator),t}emailComparator(e,t){return e.address.toLowerCase()===t.address.toLowerCase()}emailComparatorSort(e,t){return e.address&&t.address?e.address.toLowerCase().localeCompare(t.address.toLowerCase()):e.address&&!t.address?1:!e.address&&t.address?-1:void 0}phoneComparator(e,t){return e===t||e.number===t.number}ensureCacheObject(e){try{s.default.PAssert(154,e,"Must have valid data to store in cache")}catch(a){s.default.reportError(a)}if(this._contactCache[e.id])return this._contactCache[e.id];var t=new h(e);return this._contactCache[e.id]=t,t}findMatchExact(e){var t=this._contactsByName[s.default.escape(e)];if(t)return this.ensureCacheObject(t)}findMatchLike(e,t){var a=0;try{s.default.PAssert(155,void 0!==e,"Must provide a valid contact part")}catch(p){s.default.reportError(p)}for(var i=e.toUpperCase(),r=[],n=this._contacts.get(),o=0;o<n.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=n[o],d=!1;if(l.text.toUpperCase().indexOf(i)>=0&&(d=!0),!d&&l.emails)for(var h=0,c=0;!d&&c<l.emails.length;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(l.emails[c].address.toUpperCase().indexOf(i)>=0){d=!0;break}}if(!d&&l.phoneNumbers){var u=0;for(c=0;!d&&c<l.phoneNumbers.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(l.phoneNumbers[c].number.indexOf(i)>=0){d=!0;break}}}if(d&&(r.push(this.ensureCacheObject(l)),r.length>=t))break}return r.sort(this.contactComparator),r}findContactByEmail(e){for(var t=0,a=0;a<this._contacts.get().length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._contacts.get()[a];if(i.emails)for(var r=0,s=0;s<i.emails.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i.emails[s].address===e)return i}}}findEmailsLike(e,t){var a=0;try{s.default.PAssert(156,void 0!==e,"Must provide a valid email part")}catch(u){s.default.reportError(u)}t=t||20;for(var i=[],r=e.toUpperCase(),n=0;n<this._contacts.get().length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._contacts.get()[n];if(o&&o.emails){var l=0,d=!1;o.text&&o.text.toUpperCase().indexOf(r)>=0&&(d=!0);for(var h=0;h<o.emails.length;++h){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var c=o.emails[h].address;(d||c.toUpperCase().indexOf(r)>=0)&&i.push({type:"contact",text:o.text,email:c})}}if(i.length>=t)break}return i.sort(this.emailComparatorSort),i}save(e){let t=e.map(e=>this._contactsByName[e]);p.a.saveContacts(this._contacts.get(),t)}handleRemoteContactLoad(e,t){var a=0,i=(this.numContacts(),[]);for(let n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let t=e[n],h={id:t.resourceName.replace("people/",""),text:""};if(t.names&&t.names.length>0){let e=t.names[0].displayName;h.text=e,"'"===h.text[0]&&(h.text=h.text.substr(1))}if(!h.text&&t.organizations){var r=0;for(let e=0;e<t.organizations.length;e++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;let a=t.organizations[e];a.metadata&&a.metadata.primary&&(h.text=a.name)}h.text||(h.text=t.organizations[0].name)}if(t.emailAddresses){var l=0;h.emails=[];for(let e=0;e<t.emailAddresses.length;e++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;let a=t.emailAddresses[e],i=a.metadata&&a.metadata.primary,r={address:a.value};i&&(r.isPrimary=i),a.type&&(r.type=a.type),h.emails.push(r),!h.text&&r.isPrimary&&(h.text=r.address)}!h.text&&h.emails.length>0&&(h.text=h.emails[0].address)}if(t.phoneNumbers){var d=0;h.phoneNumbers=[];for(let e=0;e<t.phoneNumbers.length;e++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;let a=t.phoneNumbers[e],i=a.metadata&&a.metadata.primary,r={number:a.value};i&&(r.isPrimary=i),a.type&&(r.type=a.type),h.phoneNumbers.push(r)}}h.text?this.updateContact(h)&&i.indexOfWithProperty("id",h.id)<0&&i.push(h.text):s.default.shouldLog(o.a.LogLevels.Data)&&s.default.log("Contact entry with no name or email address",t)}i.length&&(this.save(i),n.default.PaneUpdateBatcher.updateAllItems(!1,!0)),t&&t(e.length)}syncContactInfo(e,t){c.a.getAccountAuthToken(e,[o.a.GScope.Contacts],e=>{let a,i=[],r=e&&e.access_token,n=async e=>{let r=await e.json();if(r&&r.connections){try{s.default.PAssert(157,s.default.isArray(r.connections),"Connections are not array")}catch(n){s.default.reportError(n)}s.default.isArray(r.connections)&&i.pushArray(r.connections),r.nextPageToken?a(r.nextPageToken):this.handleRemoteContactLoad(i,t)}};a=e=>{let t=`https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,phoneNumbers,organizations&access_token=${r}`+(e?`&pageToken=${e}`:"");s.default.XHR({type:"GET",url:t}).then(n)},r&&a()})}refreshContacts(e){return!!n.default.settings.syncContacts.get()&&(f.a.onActiveUser(t=>{c.a.onLoaded(()=>{this.syncContactInfo(t,t=>{e&&e()})})}),!0)}},r()(d.prototype,"getRNList",[g.a],Object.getOwnPropertyDescriptor(d.prototype,"getRNList"),d.prototype),r()(d.prototype,"refreshContacts",[g.a],Object.getOwnPropertyDescriptor(d.prototype,"refreshContacts"),d.prototype),d);t.a=new m},48:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(22),n=a(53);const o=1e5,l={notify:"n",duration:"d",gcalId:"c",gcalCalendar:"b",completes:"x",repeatComplete:"r"},d=i.default.invertObject(l),h={freq:"f",byweekday:"w",byday:"b",byhour:"h",bymonth:"m",bymonthday:"t",byyearday:"y",byweekno:"n",byminute:"o",bysecond:"s",dtstart:"d",until:"u",interval:"i",count:"c"},c=i.default.invertObject(h),u=Object.keys(l),p=r.a.CalendarDayViewNumDaysPad;class g{constructor(e,t){if(e instanceof Date)this.date=e,this.dateCleared=e.clone().clearTime();else{this.rruleset=e;try{i.default.PAssert(765,this.rruleset._rrule[0],"MooDate missing rrule in constructor",()=>e)}catch(a){i.default.reportError(a)}}t&&(this.notify=t.notify,this.duration=t.duration,this.gcalId=t.gcalId,this.completes=t.completes,this.gcalCalendar=t.gcalCalendar,this.repeatComplete=t.repeatComplete)}getNext(e,t,a){if(this.date)return this.date;{let o=this.rruleset._rrule[0];try{i.default.PAssert(766,o,"MooDate missing rrule",this.toData())}catch(r){i.default.reportError(r)}if(o){e||(e=new Date);let i,r=this.rruleset._rrule[0].options;r.dtstart&&r.dtstart>e?(i=r.dtstart,a&&(i=i.clone().addMinutes(1))):(t||!(r.freq<s.a.DAILY)&&(r.freq!==s.a.DAILY||r.byhour&&0!==r.byhour[0])||(e=new Date(e).clearTime()),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes())));let o=this.rruleset.after(i,!0);return o&&(o=n.a.UTCtoLocal(o)),o}}}getStart(){if(this.date)return this.date;{let e=this.rruleset._rrule[0].options;return n.a.UTCtoLocal(e.dtstart)}}getEnd(){let e=this.getDuration()||r.a.DefaultEventDuration;if(this.date)return new Date(this.date.getTime()+e);{let t=this.rruleset._rrule[0].options;if(t.until)return n.a.UTCtoLocal(t.until);return new Date(this.getStart().getTime()+e)}}isOnDate(e,t){return this.date?+e===+this.dateCleared:(this._nextDates||this._generateDates(),!0===this._nextDatesMap[+e])}getDate(){return this.date}getFirstDate(){return this._nextDates||this._generateDates(),this._nextDates[0]}_generateDates(){if(!this.date&&!this._nextDates){let e=Date.now()+p*r.a.MSPerDay,t=this.rruleset.all((t,a)=>a<p&&+t<e);this._nextDates=t.map(e=>n.a.UTCtoLocal(e).clearTime()),this._nextDatesMap={},this._nextDates.forEach(e=>this._nextDatesMap[+e]=!0)}}getAllDates(){return this.date?[this.date]:(this._nextDates||this._generateDates(),this._nextDates)}isRange(){if(this.date)return!1;let e=this.rruleset._rrule[0].options;return 3===e.freq&&1===e.interval&&e.until}setDate(e){if(this.date&&!e.hasTimeOfDay()){let t=this.date.getTimeOfDay();this.date=e.clone().clearTime().addMilliseconds(t)}else this.date=e;this.dateCleared=this.date.clone().clearTime(),this._nextDates=void 0}setDuration(e){this.duration=e}getDuration(){return this.duration}setHours(e){let t=Math.floor(e),a=60*(e-t);if(this.date)this.date.setHours(t),this.date.setMinutes(a);else{let e=this.rruleset._rrule[0];e.options.byhour=[t],e.origOptions.byhour=[t],e.options.byminute=[a],e.origOptions.byminute=[a],this._nextDates=void 0}}toText(e){let t;if(this.date)t=n.a.toHumanText(this.date);else{let r=this.rruleset._rrule[0];try{i.default.PAssert(767,r,"MooDate has no rrule",()=>this.toData())}catch(a){i.default.reportError(a)}r&&(t=e?r.toTextShort():r.toText())}if(t&&!e&&this.duration){let e=this.duration/r.a.MSPerMinute;t+=" "+(e>=60?e/60+"hr":e+"m")}return t||""}getGCalId(){return this.gcalId}getGCalCalendar(){return this.gcalCalendar}setGCalId(e){this.gcalId=e}setGCalCalendar(e){this.gcalCalendar=e}setGCalIdAndCalendar(e,t){this.gcalId=e,this.gcalCalendar=t}removeGCal(){this.gcalId=void 0,this.gcalCalendar=void 0}clone(){return g.fromData(this.toData())}isRepeatDate(){return!!this.rruleset}getTime(){if(this.date)return this.date.getTimeOfDay();{let e=this.getNext();return e||(e=this.rruleset&&this.rruleset.before(new Date))&&(e=n.a.UTCtoLocal(e)),e?e.getTimeOfDay():void 0}}copyFrom(e){e.rruleset?(this.rruleset=e.rruleset,this.date=void 0):e.date&&(this.date=e.date,this.dateCleared=e.date.clone().clearTime(),this.rruleset=void 0),this.duration=e.duration,this._nextDates=void 0}complete(){if(this.isRepeatDate()){let e=new Date;this.completes?this.completes.push(e):this.completes=[e];let t,a=this.rruleset._rrule[0];if(this.repeatComplete){let t=n.a.toUTCDate(e.addSeconds(1));a.origOptions.dtstart=t,a.options.dtstart=t,a=this.rruleset._rrule[0]=s.b.fromString(this.rruleset.toString());let i=(new Date).clearTime().addDays(1);e=this.getNext(i,!0,!0)}t=this.getNext(e,!0,!0),t=n.a.toUTCDate(t),a.origOptions.dtstart=t,a.options.dtstart=t,this._nextDates=void 0}}setRepeatOnComplete(e){this.repeatComplete=e}toICal(){if(this.isRepeatDate())return this.rruleset.toString()}toData(){let e=[],t=[];if(u.forEach(e=>{let a=this[e];a&&("completes"===e?a=a.filter(e=>!isNaN(+e)).map(e=>+e).join(","):"duration"===e&&(a=Math.round(a/o)),t.push(`${l[e]}:${a}`))}),t.length&&e.push(t.join(";")),this.date){let a=+this.date;if(!t.length)return a;e.push(a)}else e.push(this.rruleset._rrule.map(function({origOptions:e}){return Object.keys(e).map(t=>{let a=e[t];return t=t.toLowerCase(),a instanceof Date?a=Math.round(+a/o):i.default.isArray(a)&&a[0]&&a[0]instanceof s.d?a=a.map(e=>e.weekday+(e.n?"-"+e.n:"")).join(","):i.default.isNumber(a)&&(a=Math.round(a)),`${h[t]}:${a}`}).join(";")}).join("\n"));return e.join("\\")}static fromData(e){if(!e)return;let t,a;if(i.default.isString(e)){let a=e.split("\\");if(a.length>1){t={},a[0].split(";").forEach(e=>{let[a,i]=e.split(":");"completes"===d[a]?i=i.split(",").map(e=>new Date(e)):"duration"===d[a]&&(i*=o),t[d[a]]=i}),e=a[1]}}if(i.default.isNumber(+e))a=new Date(+e);else try{a=new s.c,e.split("n").forEach(t=>{let r={};t.split(";").forEach(e=>{let[t,a]=e.split(":"),n=c[t];if(t===h.byweekday)a=a.split(",").map(e=>{let[t,a]=e.split("-");return new s.d(i.default.isNumber(+t)?+t:void 0,i.default.isNumber(a)?+a:void 0)});else if(a.indexOf(",")>0)a=a.split(",").map(e=>+e);else if(i.default.isNumber(+a)){let e=a.indexOf(".");e>0&&(a=a.substr(0,e)),"dtstart"===n||"until"===n||a.length>6?a=new Date(+a*o):(a=+a,"interval"===n&&a<0&&(a=Math.abs(a)))}r[n]=a}),a.rrule(new s.b(r));try{i.default.PAssert(768,a._rrule[0],"RRuleSet created with no rrule",e)}catch(n){i.default.reportError(n)}a._rrule[0]})}catch(r){i.default.reportError(r,"Error parsing date string: "+e)}return new g(a,t)}static fromRRuleOptions(e,t){let a=new s.c;return a.rrule(new s.b(e)),new g(a,{duration:t})}static fromRange(e,t,a=0,i){let r,o=Math.floor(a),l=60*(a-o);if(e=e.clone(),t=t.clone(),e.equals(t))(r=e).setHours(o),r.setMinutes(l);else{o&&(e.setHours(o),t.setHours(o)),l&&(e.setHours(l),t.setHours(l));let a={freq:s.a.DAILY,dtstart:n.a.toUTCDate(e),until:n.a.toUTCDate(t)};o&&(a.byhour=o?[o]:void 0),l&&(a.byminute=l?[l]:void 0);let i=new s.c;i.rrule(new s.b(a)),r=i}return new g(r)}static now(){return new g(new Date)}}t.a=g},481:function(e,t,a){"use strict";a.r(t);a(482);var i=a(18),r=a(5);function s(){document.removeEventListener("DOMContentLoaded",s,!1),window.removeEventListener("load",s,!1),r.a.demo?a(462).default():i.a.preload(()=>{a(462).default()})}window.__isLoaded=!0,Date.Config={__DEV__:!0,DisableCache:!0},"complete"===document.readyState||"interactive"===document.readyState?s():(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1))},482:function(e,t,a){"http:"===window.location.protocol&&(window.location.hash.indexOf("state=")<0||window.location.hash.indexOf("app")<0&&window.location.hash.indexOf("appv")<0)&&(window.location=window.location.href.replace(/^http:/,"https:"));try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.console||(window.console={log:function(){},error:function(){}});window.log=window.console.log.bind(window.console),window.__log=window.console.log.bind(window.console),window.__warn=window.console.warn.bind(window.console),window.__error=window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){})}catch(i){console.log("Error in main header",i),window.__ERRORINMAINHEADER=i}},49:function(e,t,a){"use strict";var i=a(7),r=a.n(i),s=a(0),n=a(1),o=a(3),l=["data-href","plugin","plugin-id","appLink","tooltip","data-original-text","attachSimple","size"];var d,h=class{constructor(e,t){this._parsedText=e,this._textLength=e.length,this._attrs=t?s.default.clone(t):{},this._width=void 0}setWidth(e){this._width=e}getWidth(e){return!this.isMarkdown()||o.default.settings.showMarkdown.get()&&e?this._width:this.isAppLinkStart()?20:0}getParsedText(){return this._parsedText}getOrigTextLength(){return this._textLength}setParsedText(e){this._parsedText=e}_getTextHelper(e,t){var a;if(this.getAttr("plugin")){try{s.default.PAssert(761,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(n){s.default.reportError(n)}var i=o.default.pluginManager.getPlugin(this._attrs.plugin),r=i.getAttachment(this.getAttr("plugin-id"));a="unstyled"===t?i.getUnstyledText(r):i.getRichText(r)}else a=s.default.escape(this._parsedText);return a}getUnstyledText(e){return this._getTextHelper(e,"unstyled")}getRichText(e){return this._getTextHelper(e,"rich")}getStyledText(e,t,a,i){var r;if(this.getAttr("plugin")){try{s.default.PAssert(762,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(d){s.default.reportError(d)}var n=o.default.pluginManager.getPlugin(this._attrs.plugin),l=n.getAttachment(this.getAttr("plugin-id"));r=n._getDisplayText(l,e,a,i)}else r=t?this._parsedText:s.default.escape(this._parsedText);return r}getAttrs(){return this._attrs}getAttr(e){var t;return this._attrs&&(t=this._attrs[e]),t}hasAttrs(){return!!this._attrs}getClasses(){var e;return this._attrs&&(e=this._attrs.cls),e}hasClasses(){var e=this.getClasses();return!!e&&e.length>0}hasClass(e){var t=!1,a=this.getClasses();return a&&(t=a.indexOf(e)>=0),t}getClassString(){var e="",t=this.getClasses();return t&&(e=t.join(" ")),e}addClass(e){this._attrs||(this._attrs={}),this._attrs.cls||(this._attrs.cls=[]),this._attrs.cls.push(e)}mergeAttrs(e){if(e)if(this._attrs){var t=0;e.cls&&(this._attrs.cls?this._attrs.cls=this._attrs.cls.concat(e.cls):this._attrs.cls=e.cls);try{s.default.PAssert(763,void 0===this._attrs.plugin||void 0===e.plugin||this._attrs.plugin===e.plugin,"A single element cannot match multiple plugins")}catch(n){s.default.reportError(n)}try{s.default.PAssert(764,void 0===this._attrs["plugin-id"]||void 0===e["plugin-id"]||this._attrs["plugin-id"]===e["plugin-id"],"A single element cannot match multiple plugins")}catch(n){s.default.reportError(n)}for(var a=0;a<l.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=l[a],r=this._attrs[i]||e[i];r&&(this._attrs[i]=r)}}else this._attrs=e}addAttr(e,t){this._attrs||(this._attrs={}),this._attrs[e]=t}isMarkdown(){return this.hasClass("mdMarkup")}isMDImage(){return this.hasClass("mdImage")}isAppLinkStart(){return this.hasClass("mdMarkupStart")&&this._attrs.appLink}},c=a(47),u=a(8),p=", . ? ! ) ( : ; [ ] ' \" _".split(" "),g=0,f=["http","https","evernote","onenote","bear"],m=window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0},v=/(^#|[\(\s-]#)([^\s\),*#]+)/g,y=(n.a.Regexp.Link,n.a.Regexp.LinkExc),_=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,S=n.a.Regexp.Prefix,P=/(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) /gi,I=n.a.Regexp.MDLink,b=/^(-{3,})$/g,D=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,w=/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) (-{3,})$/g,E=/(\*\*\*)(.*?)\1/g,C=/(\*\*)(.*?)\1/g,A=/(__)(.*?)\1/g,M=/(\*)(\u2005*?)([^\u2005|\*]+?)\2\1/gi,T=[y,/(?:^|[\s\(\[])([^\(\[#@\s]+\.(?:com|org|net|io))/gi];let L=(d=class{isFlagSet(e,t){return(e&t)===t}trimPunc(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}generateStyledLines(e,t,a,i,r){for(var s=0,n=this.linesToEls(e,t),l=[],d=0;d<n.length;++d){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;l.push(o.default.ElementRenderer.render(n[d],{item:i,convertLines:!1,pane:a,highlightSearch:r}))}return l}linesToEls(e,t){for(var a=0,i=[],r=[],s=!1,n=0;n<t.length;++n){var o=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var l=0,d=t[n].start,c=t[n].length,u=0,p=0;p<e.length;++p){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var g=e[p],f=g.getParsedText().length,m=Math.max(d-l,0);if(m<f){var v=Math.min(f-m,c-u);if(v>0){var y=g.getParsedText().substr(m,v),_=new h(y,g.getAttrs());_.getAttr("appLink")&&!s&&_.addAttr("appLinkStart",!0),r.push(_),s=!!_.getAttr("appLink"),u+=v}}l+=f}i.push(r),r=[]}return i}replaceTextInEls(e,t,a,i){var r=0;try{s.default.PAssert(631,s.default.isArray(e),"Must supply a valid VMLIElement array")}catch(g){s.default.reportError(g)}try{s.default.PAssert(632,t,"Must be replacing at least one of parsed or styled text")}catch(g){s.default.reportError(g)}for(var n=0,o=0;o<e.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=e[o],d=l.getParsedText();if(a+i>=n&&a<n+l.getOrigTextLength()){var h=a-n,c=Math.min(i,d.length-h),u=d.substr(0,h),p=d.substr(h+c);t&&l.setParsedText(u+t+p);break}n+=l.getOrigTextLength()}}getElAtOffset(e,t){for(var a=0,i=0,r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=e[r],n=s.getOrigTextLength();if(t>=i&&t<i+n)return s;i+=n}}insertEl(e,t,a,i){var r=0;try{s.default.PAssert(633,s.default.isArray(t.cls),"Must always pass in a valid classes array")}catch(P){s.default.reportError(P)}try{s.default.PAssert(634,s.default.isNumber(a),"Must have a valid start")}catch(P){s.default.reportError(P)}try{s.default.PAssert(635,s.default.isNumber(i),"Must have a valid length")}catch(P){s.default.reportError(P)}for(var n,o=0,l=i,d=0;d<e.length;++d){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=e[d],u=c.getParsedText();if(o<a+i&&a<o+c.getOrigTextLength()){var p=0,g=Math.max(a-o,0),f=Math.min(l,u.length),m=g+l,v=u.length-m;if(g>0){var y=u.substr(0,g);e.splice(d,0,new h(y,c.getAttrs())),p++}var _=u.substr(g,f);if((n=new h(_,c.getAttrs())).mergeAttrs(t),e.splice(d+p,1,n),p++,v>0){var S=u.substr(m,v);e.splice(d+p,0,new h(S,c.getAttrs()))}if(d+=p-1,l-=f,v>0)break}o+=c.getOrigTextLength()}return n}_notifyParse(e){m.total++,m[e]++}runParseSinglePlugin(e,t){return this.parseSinglePlugin(e.getRawText(),t)}parseSinglePlugin(e,t){if(this._notifyParse("parseSinglePlugin"),!e||0===e.length)return{parsedText:void 0,els:void 0};try{s.default.PAssert(636,!g,"We do not support recursive calls to parse")}catch(d){s.default.reportError(d)}var a,i;if(g++,"\u2001"===e[0]||"\u2003"===e[0]){var r=!s.default.isFlagSet(t,n.a.ChangeType.ItemLoad),l=o.default.pluginManager.parseAttachmentEmbedString(e.slice(1,-1),r);i=[l],e=n.a.AttachChar,r&&(a=[new h(n.a.AttachChar,l.displayElement.attrs)])}else a=[new h(e)];return g--,{parsedText:e,attachments:i,els:a}}parseNote(e){return this._notifyParse("parseNote"),{parsedText:e.getRawText(),els:[new h(e.getRawText())]}}runParseText(e){return this.parseText(e.getRawText(),c.a.getContacts(),void 0,void 0,void 0,e)}parseText(e,t,a,i,r,l){if(this._notifyParse("parseText"),!e||0===e.length)return{parsedText:void 0,contacts:void 0,tags:void 0,attachments:void 0,els:[]};try{s.default.PAssert(637,!g,"We do not support recursive calls to parse")}catch(ie){s.default.reportError(ie)}g++;let d,c,u,m,P,w,L,x,k=!1,R=e,O=0,F=!1;var N,B=[new h(R)];i||(S.lastIndex=0,null!==(d=S.exec(R))&&(P=d[1])&&(O=d[0].length,0===P.indexOf("#")||0===P.indexOf("^")?(N="prefixHeader",w="header"):"["===P||"[]"===P||"[ ]"===P||"]"===P||"("===P||"()"===P||"( )"===P||")"===P?(N="prefixTask icon-square-o",w="task"):"*"===P||"-"===P||"+"===P?(N="prefixBullet",w="bullet"):(N="prefixNumList",w="numList"),this.insertEl(B,{cls:["itemPrefix",N]},0,O).setWidth(n.a.PrefixWidth)));var U=0;for(_.lastIndex=0;null!==(d=_.exec(R));){if(U++>5e3&&__infLoop&&__infLoop(U))throw new RangeError;let e=o.default.pluginManager.parseAttachmentEmbedString(d[1],!0);this.replaceTextInEls(B,n.a.AttachChar,d.index,d[0].length);var H=this.insertEl(B,e.displayElement.attrs,d.index,1);R=R.substr(0,d.index)+n.a.AttachChar+R.substr(d.index+d[0].length);var V=B.indexOf(H);V>0&&H.addClass("padB"),V<B.length-1&&H.addClass("padA"),k=!0,m?m.push(e):m=[e]}{let e=R.indexOf(n.a.CharDate);if(e>=0&&l){let t={p:n.a.PluginID.Date,id:l.id,itemID:l.id};t.displayElement=o.default.pluginManager.createDisplayElement(t,!0);H=this.insertEl(B,t.displayElement.attrs,e,1);this.replaceTextInEls(B,n.a.AttachChar,e,1),R=R.replace(n.a.CharDate,n.a.AttachChar),k=!0,m?m.push(t):m=[t]}}let j=R.substr(O);var z=0,q=0,W=0,G=0,K=0;for(I.lastIndex=0;null!==(d=I.exec(j));){if(z++>5e3&&__infLoop&&__infLoop(z))throw new RangeError;let e=d[3],t=e.indexOf("://")>0?e:"http://"+e,a=!!s.default.parseEvernoteLink(e),i=s.default.isOneNoteLink(e),r=s.default.isBearLink(e),n=a||i||r,o=["mdMarkup","mdMarkupStart"],l=O+d.index+d[1].length,h="!"===d[1],c=d[4]||"",u=c&&+c.replace(/\s|=|x/g,"");h?(this.insertEl(B,{attachSimple:"inlineImage",cls:["mdImage"],"data-href":t,"data-original-text":d[0],size:u},O+d.index,d[0].length),F=!0):d[2]&&(a?o.push("evernote"):i?o.push("onenote"):r&&o.push("bear"),this.insertEl(B,{cls:o,appLink:n},O+d.index,1+d[1].length),this.insertEl(B,{cls:["mdSpan","link","c-link"].concat(s.default.isUrlImage(t)?"linkImage":[]),appLink:n,"data-href":t,"data-original-text":d[0]},l+1,d[2].length),this.insertEl(B,{cls:["mdMarkup"],appLink:n},l+1+d[2].length,2),this.insertEl(B,{cls:["mdSpan","link","c-link","mdMarkup"].concat(s.default.isUrlImage(t)?"linkImage":[]),appLink:n,"data-href":t,"data-original-text":d[0]},l+d[2].length+3,e.length+c.length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"],appLink:n},l+d[2].length+c.length+e.length+3,1),F=!0)}if(!F){var Y=0;let e,t,a,i;for(var X=0;X<T.length;X++){var Q=0;if(Y++>5e3&&__infLoop&&__infLoop(Y))throw new RangeError;let r=T[X];for(r.lastIndex=0;null!==(d=r.exec(j));){if(Q++>5e3&&__infLoop&&__infLoop(Q))throw new RangeError;if(r===y){a=f.indexOf(d[3])>=0?d[2]:"http://"+d[2],e=d.index+O,t=d[0].length,i="!"===d[1]}else{let i=d[0].length-d[1].length;a=d[1].startsWith("http")?d[1]:"http://"+d[1],e=d.index+i+O,t=d[1].length}if(a)if(i)this.insertEl(B,{attachSimple:"inlineImage",cls:["mdImage"],"data-href":a,"data-original-text":d[0]},O+d.index,d[0].length);else{let i=s.default.parseEvernoteLink(a),r=s.default.isOneNoteLink(a),n=s.default.isBearLink(a),o={cls:["link","c-link"].concat(s.default.isUrlImage(a)?"linkImage":[]),"data-href":a};i&&(o.appLink=!0,o.cls.push("evernote")),r&&(o.appLink=!0,o.cls.push("onenote")),n&&(o.appLink=!0,o.cls.push("bear")),this.insertEl(B,o,e,t)}}}}for(A.lastIndex=0;null!==(d=A.exec(j));){if(q++>5e3&&__infLoop&&__infLoop(q))throw new RangeError;this.isInTag(d)||this.getElAtOffset(B,d.index).hasClass("link")||(this.insertEl(B,{cls:["mdMarkup","mdMarkupStart"]},O+d.index,d[1].length),this.insertEl(B,{cls:["mdSpan","mdUnderline"]},O+d.index+d[1].length,d[2].length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"]},O+d.index+d[1].length+d[2].length,d[1].length))}for(E.lastIndex=0;null!==(d=E.exec(j));){if(W++>5e3&&__infLoop&&__infLoop(W))throw new RangeError;this.isInTag(d)||this.getElAtOffset(B,d.index).hasClass("link")||(this.insertEl(B,{cls:["mdMarkup","mdMarkupStart"]},O+d.index,d[1].length),this.insertEl(B,{cls:["mdSpan","mdBold","mdItalic"]},O+d.index+d[1].length,d[2].length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"]},O+d.index+d[1].length+d[2].length,d[1].length))}var $=j.replace(E,"\u2005\u2005\u2005$2\u2005\u2005\u2005");for(C.lastIndex=0;null!==(d=C.exec($));){if(G++>5e3&&__infLoop&&__infLoop(G))throw new RangeError;this.isInTag(d)||this.getElAtOffset(B,d.index).hasClass("link")||(this.insertEl(B,{cls:["mdMarkup","mdMarkupStart"]},O+d.index,d[1].length),this.insertEl(B,{cls:["mdSpan","mdBold"]},O+d.index+d[1].length,d[2].length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"]},O+d.index+d[1].length+d[2].length,d[1].length))}for($=$.replace(C,"\u2005\u2005$2\u2005\u2005"),M.lastIndex=0;null!==(d=M.exec($));){if(K++>5e3&&__infLoop&&__infLoop(K))throw new RangeError;this.isInTag(d)||this.getElAtOffset(B,d.index).hasClass("link")||(this.insertEl(B,{cls:["mdMarkup","mdMarkupStart"]},O+d.index,d[1].length),this.insertEl(B,{cls:["mdSpan","mdItalic"]},O+d.index+d[1].length+d[2].length,d[3].length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"]},O+d.index+d[1].length+d[2].length+d[3].length+d[2].length,d[1].length))}if(b.lastIndex=0,null!==(d=b.exec(j))&&this.insertEl(B,{cls:["mdSpan","mdHR","c-border-heavy"]},0,R.length),!m){var J=0;for(D.lastIndex=0;null!==(d=D.exec(R));){if(J++>5e3&&__infLoop&&__infLoop(J))throw new RangeError;this.getElAtOffset(B,d.index).hasClass("link")||this.insertEl(B,{cls:["email","c-contact"]},d.index,d[1].length)}}if(t&&Object.keys(t).length>0){let e=R.split(n.a.ContactPrefix);if(e.length>1){var Z=0;let a=e[0].length;for(e=e.slice(1),L=0;L<e.length;L++){if(Z++>5e3&&__infLoop&&__infLoop(Z))throw new RangeError;let i,r=e[L];if(" "!==r[0]&&!p.includes(r[0])){var ee=0;for(x=0;x<r.length;x++){if(ee++>5e3&&__infLoop&&__infLoop(ee))throw new RangeError;let e=r.substr(0,x+1);t[e]&&(i=e)}}i&&(u?u.push(i):u=[i],this.insertEl(B,{cls:["contact","c-contact"]},a,i.length+1)),a+=r.length+n.a.ContactPrefix.length}}}var te=0;for(v.lastIndex=0;null!==(d=v.exec(R));){var ae=0;if(te++>5e3&&__infLoop&&__infLoop(te))throw new RangeError;let e=d.index+d[1].length-1,t=d[2].length+1,a=d[2];for(;p.indexOf(a.charAt(a.length-1))>=0;){if(ae++>5e3&&__infLoop&&__infLoop(ae))throw new RangeError;t--,a=a.substr(0,a.length-1)}a&&(c?c.push(a):c=[a]),this.insertEl(B,{cls:["tag","c-tag"]},e,t)}return m&&(_.lastIndex=0,R=R.replace(_,n.a.AttachChar)),g--,{parsedText:k?R:void 0,durations:void 0,tags:c,attachments:m,contacts:u,prefix:P,prefixType:w,els:B}}isInTag(e){for(var t=0,a=e.index;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "===e.input[a])return!1;if("#"===e.input[a])return!0}return!1}checkMultiplePrefixes(e){var t,a,i=0;for(P.lastIndex=0;null!==(a=P.exec(e));){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t)a.index===t[0].length&&(e=e.substr(a.index));else{if(0!==a.index)break;t=a}}return e=e.replace(w,n.a.TextMDHR)}},r()(d.prototype,"runParseSinglePlugin",[u.a],Object.getOwnPropertyDescriptor(d.prototype,"runParseSinglePlugin"),d.prototype),r()(d.prototype,"runParseText",[u.a],Object.getOwnPropertyDescriptor(d.prototype,"runParseText"),d.prototype),d);t.a=new L},5:function(e,t,a){"use strict";var i=a(0),r=a(16),s=a(40),n=a(1),o=a(9);var l=class{constructor(){this.onResize=new s.a,this.onForeground=new s.a}setWindowSize(e,t){this._windowWidth.set(e),this._windowHeight.set(t)}};t.a=new class extends l{constructor(){super(),r.a.binder(this,"normalizeKeys","getKeyCode"),this.blockedReason=new o.a,this.versionRequired=[],this.versionAvailable=[],this.versionRequired[n.a.AppPlatform.Electron]=1,this.versionAvailable[n.a.AppPlatform.Electron]=3,this.versionDesktop=16,this.versionDesktopMessages={15:"The latest version of Moo.do changes how item order is stored. Newly added items may be out of order on old versions, so please restart Moo.do on all of your devices.",16:"Plugin caching has been upgraded in the latest update so Moo.do is syncing emails and calendars again"},this.appSubVersion=void 0,this.setDeployEnvironments(),this.appPlatform=void 0,this.requireCustomRedirect=!1,this.requireCustomPurchase=!1,this.requireCustomPaypal=!1,this.bodyClass=void 0,this.b=document.documentElement,this.orientation=n.a.Orientation.Portrait,this.onResize=new s.a,this.appState=void 0,this.isHosted=!1,this.hostedBy=void 0,this.initStorageQuota={quota:NaN,usage:NaN},this.isNearStorageQuota=!1,this.pageVisibilityHidden=void 0,this.pageVisibilityChange=void 0,this._allowNativeNotifications=!0,this.isDevURL="localhost"===window.location.hostname||"dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,this.isBeta="beta.moo.do"===window.location.hostname,this._features={},this.init(),this._windowWidth=new o.a(this.getActualWindowWidth()),this._windowHeight=new o.a(this.getActualWindowHeight()),this.app&&(this.customRedirectState={app:!0,appv:this.appv,webview:this.getAppState("webview")})}getDeployVar(e){return this.deployEnvironment[e]}setDeployEnvironments(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[n.a.DeployVariable.Environment]="dev",this.deployEnvironment[n.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[n.a.DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[n.a.DeployVariable.Environment]="beta",this.deployEnvironment[n.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[n.a.DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[n.a.DeployVariable.Environment]="local",this.deployEnvironment[n.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[n.a.DeployVariable.APIHost]="//api-dev.moo.do"):(this.deployEnvironment[n.a.DeployVariable.Environment]=this.isMobile?"mobile":"web",this.deployEnvironment[n.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[n.a.DeployVariable.APIHost]="//api.moo.do")}windowWidth(){if(!this._windowWidth.get()){try{i.default.PAssert(3,!1,"Window width was not set",this._windowWidth.get(),this._windowHeight.get())}catch(e){i.default.reportError(e)}this._windowWidth.set(this.getActualWindowWidth())}return this._windowWidth.get()}windowHeight(){if(!this._windowHeight.get()){try{i.default.PAssert(4,!1,"Window height was not set",this._windowWidth.get(),this._windowHeight.get())}catch(e){i.default.reportError(e)}this._windowHeight.set(this.getActualWindowHeight())}return this._windowHeight.get()}getLocaleInfo(e){try{e.lang=navigator.language||navigator.userLanguage}catch(t){e.lang="EXCEPTION"}}getPlatformInfo(e){e.os=this.OSName,e.browser=this.browser,e.majorVersion=this.majorVersion,e.minorVersion=this.minorVersion,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.requireCustomRedirect=this.requireCustomRedirect,e.requireCustomPurchase=this.requireCustomPurchase,e.requireCustomPaypal=this.requireCustomPaypal,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.appState=this.appState,e.isHosted=this.isHosted,e.hostedBy=this.hostedBy,e.embed=this.embed,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent,e.referrer=document.referrer,e.devicePixelRatio=window.devicePixelRatio,e.pageVisibilityChange=!!this.pageVisibilityChange,e.appSubVersion=this.appSubVersion,e.initStorageQuota=this.initStorageQuota,e.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(e)}getUserPlatformConfig(){return(this.platformBrowser&&this.platformOS?this.platformOS+""+this.platformBrowser:navigator.userAgent)+(this.isBeta?"b":"")}getAppDownloadURL(){return window.location.origin+"/download/"}supportsNativeApp(){switch(this.OSName){case"Windows":case"MacOS":return!0;default:return!1}}isNativeApp(){return this.appPlatform===n.a.AppPlatform.Electron}supportLocalFiles(){return this.isNativeApp()&&this.appv>=3}isNativeMac(){return this.isNativeApp()&&this.mac}isNativeMacFullscreen(){return this.isNativeApp()&&this.mac&&!window.screenTop&&!window.screenY}canDownloadNativeApp(){return this.supportsNativeApp()&&!this.isNativeApp()}init(){this.initAppState(),this.initHostState(),this.initFeatures();var e=navigator.userAgent,t="";let s;var o,l;if(this.OSName="Unknown OS",this.app&&(t+=" app"),-1!==e.indexOf("Win")?(this.platformOS=n.a.PlatformOS.Windows,this.OSName="Windows",this.windows=!0):-1!==e.indexOf("Mac")?(this.platformOS=n.a.PlatformOS.Mac,this.OSName="MacOS",this.mac=!0):-1!==e.indexOf("X11")?-1!==e.indexOf("CrOS")?(this.platformOS=n.a.PlatformOS.ChromeOS,this.OSName="ChromeOS",this.chromeOS=!0):(this.platformOS=n.a.PlatformOS.Linux,this.OSName="UNIX",this.unix=!0):-1!==e.indexOf("Linux")&&(this.platformOS=n.a.PlatformOS.Linux,this.OSName="Linux",this.linux=!0),this.majorVersion=1e3,this.minorVersion=1e3,-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident")?(this.platformBrowser=n.a.PlatformBrowser.IE,this.browser="Trident",this.ie=!0,null!==(s="Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(e)?this.majorVersion=parseFloat(RegExp.$1):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==e.indexOf("Chrome")||-1!==e.indexOf("CriOS")?(this.platformBrowser=n.a.PlatformBrowser.Chrome,this.browser="Chrome",this.isChrome=!0,null!==(s=new RegExp("Chrome/([0-9]{1,}).")).exec(e)&&(this.majorVersion=parseFloat(RegExp.$1)),-1!==e.indexOf("Edge")&&(this.ieEdge=!0,this.platformBrowser=n.a.PlatformBrowser.Edge),this.app&&this.appPlatform!==n.a.AppPlatform.Android&&(this.requireCustomPaypal=!0)):-1!==e.indexOf("Firefox")?(this.platformBrowser=n.a.PlatformBrowser.Firefox,this.browser="Firefox",this.isFirefox=!0,null!==(s=new RegExp("Firefox/([0-9]{1,}).")).exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==e.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName?(this.platformBrowser=n.a.PlatformBrowser.Safari,this.browser="Safari",this.safari=!0,null!==(s=new RegExp("Version/([0-9]{1,}).([0-9]{1,}).")).exec(e)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))):-1!==e.indexOf("Opera")?(this.platformBrowser=n.a.PlatformBrowser.Opera,this.browser="Opera"):-1!==e.indexOf("Edge")&&(this.ieEdge=!0,this.platformBrowser=n.a.PlatformBrowser.Edge),e.indexOf("Electron")>=0&&e.indexOf(n.a.ProductName)>=0){if(this.platformBrowser=n.a.PlatformBrowser.Electron,this.app=!0,this.appPlatform=n.a.AppPlatform.Electron,t+=" electron",null!==new RegExp("Moo\\.do/([^\\s]+)\\s").exec(navigator.userAgent)){let e=(e,t)=>{for(var a=0,i=e.split("."),r=t.split("."),s=0;s<3;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=+i[s],o=+r[s];if(n>o)return 1;if(o>n)return-1;if(!isNaN(n)&&isNaN(o))return 1;if(isNaN(n)&&!isNaN(o))return-1}return 0};var d,h=RegExp.$1;e(h,"1.1.4")<=0&&setTimeout(()=>{Promise.resolve().then(a.bind(null,3)).then(e=>{e.default.toasts.pushMessage({text:"A new version is available with important fixes. Future versions will update themselves, but please download this manually.",hold:!0,holdOnAction:!0,actionText:"DOWNLOAD",action:()=>{i.default.openUrl(this.getAppDownloadURL())}})})},2e3),d=e(h,"1.2.1")>=0?3:e(h,"1.1.0")>=0?2:1,this.appv=d}this.mac&&(t+=" electronMac"),this.appState||(this.appState={}),this.appState.appType||(this.appState.appType="electron"),this.requireCustomPurchase=!0,this._enableFeature(n.a.Feature.OAuth)}this.isTouchDevice=!!("ontouchstart"in window||navigator.msMaxTouchPoints),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),r.a.hasURLParam("touch","false")?this.touch=!1:r.a.hasURLParam("touch","true")&&(this.touch=!0),this.windows&&(t+=" windows",this.ie&&(t+=" ie")),"Firefox"===this.browser&&(t+=" firefox"),this.safari&&(t+=" safari"),this.embed===n.a.EmbedApps.Mailbird&&(this.platformBrowser=n.a.PlatformBrowser.Mailbird,t+=" mailbird",this.isMailbirdSidebar()&&(t+=" mailbirdSidebar")),this.demo&&(t+=" demoMode"),this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"\u2318":"ctrl",this.priModKey=this.mac?"\u2318":"Ctrl",this.secModKeyForce=this.mac?"\u2303":"Alt",this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app)&&(this.requireCustomRedirect=!0),t&&t.length>0&&(this.bodyClass=t,this.b.className+=t),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!(this.ie||this.ieEdge),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){clearTimeout(e)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),"undefined"!==typeof document.hidden?(o="hidden",l="visibilitychange"):["moz","ms","webkit"].forEach(e=>{if("undefined"!==document[e+"Hidden"])return o=e+"Hidden",l=e+"visibilitychange",!1}),void 0!==o&&(this.pageVisibilityHidden=o,this.pageVisibilityChange=l),this.initRedirectString(),this.supportsEstimatedStorage()&&this.estimateAvailableStorage(function(e){this.initStorageQuota=e,e.usage/e.quota>.9&&(this.isNearStorageQuota=!0)}.bind(this),function(){})}updateBodyClass(){this.bodyClass&&(document.body.className+=this.bodyClass)}supportsNotifications(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()}supportsNativeNotifications(){var e=!1;return this._allowNativeNotifications&&(this.app&&this.appPlatform!==n.a.AppPlatform.Electron&&this.isChrome?e=!0:this.embed===n.a.EmbedApps.Mailbird&&(e=!0)),e}supportsHTML5Notifications(){return"Notification"in window}usesHTML5Notifications(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()}hasNotificationPermission(){return!this.usesHTML5Notifications()||"granted"===Notification.permission}disallowNativeNotifications(){this._allowNativeNotifications=!1}supportsPersistedStorage(){var e=!1;return"storage"in navigator&&"persist"in navigator.storage&&(e=!0),e}requestStoragePersistence(e,t){navigator.storage.persisted().then(function(a){a?e():navigator.storage.persist().then(e,t)})}isStoragePersisted(e){this.supportsPersistedStorage()?navigator.storage.persisted().then(e):setTimeout(e,0,!1)}supportsNativePromises(){return!!window.Promise}supportsEstimatedStorage(){var e=!1;return"storage"in navigator&&"estimate"in navigator.storage?e=!0:"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage&&(e=!0),e&&this.supportsNativePromises()}estimateAvailableStorage(e,t){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(e,t):setTimeout(t,0)}_estimateAvailableStorage(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise(function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t,a){e({usage:t,quota:a})},t)}):Promise.resolve({usage:NaN,quota:NaN})}supportsWebworkers(){var e=!1;return window.Worker&&(e=!0),e}supportsNativeDownload(){return this.isNativeApp()&&this.appv>=2}supportsIDBWebworkers(){var e=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":e=this.majorVersion>=37;break;case"Chrome":e=this.majorVersion>=24}return e}supportsPassiveListeners(){if(void 0===this._supportsPassiveListeners){var e=!1;try{var t=Object.defineProperty({},"passive",{get:()=>{e=!0}});window.addEventListener("test",null,t)}catch(a){}this._supportsPassiveListeners=e}return this._supportsPassiveListeners}addPassiveListener(e,t,a){this.supportsPassiveListeners()?e.addEventListener(t,a,{passive:!0}):e.addEventListener(t,a)}isMobro(){var e,t=null;try{new ActiveXObject("")}catch(a){e=a.name}try{t=!!new ActiveXObject("htmlfile")}catch(a){t=!1}return!(t="ReferenceError"===e||!1!==t)}normalizeKeys(e){void 0!==e.normCode&&(e.synthetic||e instanceof KeyboardEvent)||(e.normCode=this.getKeyCode(e))}getKeyCode(e){var t;return 46===(t=null===e.keyCode||0===e.keyCode?null!==e.charCode?e.charCode:e.which:e.keyCode)&&"keypress"===e.type&&(t=190),t}initAppState(){var e=location.hash.substring(1);if(e)for(var t,a=0,i=/([^&=]+)=([^&]*)/g;null!==(t=i.exec(e));){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("state"===decodeURIComponent(t[1])){var s=decodeURIComponent(t[2]);if(s){let t=t=>{try{e=JSON.parse(t)}catch(a){}};t(s),e||t(s.replace(/\\"/g,'"')),e&&(this.app=!0===e.app,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.syncContacts=e.syncContacts,this.test=e.test,this.embed=e.embed,this.appState=e)}break}}this.live=this.live||r.a.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||r.a.hasURLParam("offline","true")||!1,this.demo=r.a.hasURLParam("demo","true")||!1,this.script=r.a.hasURLParam("script"),this.app=this.app||!1}getAppState(e){return this.appState?this.appState[e]:void 0}_enableFeature(e){this._features[e]=!0}_disableFeature(e){this._features[e]=!1}initFeatures(){this._enableFeature(n.a.Feature.ClonePane)}isMailbirdSidebar(){return this.embed===n.a.EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")}initHostState(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)}initRedirectString(){var e,t;e=this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone?window.location.host:"www.moo.do",t=this.app&&this.appPlatform===n.a.AppPlatform.Electron?"oauthRelay.html":"app/",this.customRedirectString=window.location.protocol+"//"+e+"/"+t}addPrefix(e,t){var a="",i=["ms","webkit","moz","o"],r=this.b.style;if(t||(t=e),"string"===typeof r[e])a="";else for(var s=0,n=0;n<i.length;n++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if("string"===typeof r["-"+i[n]+"-"+t]){a=i[n];break}}var o=a.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;if(a){var l=a.length>0?a.charAt(0).toUpperCase()+a.slice(1):e;return{prop:"-"+a+"-"+t,style:a+o,react:l+o}}return{prop:e,style:o,react:o}}blockClient(){if(this.isMobile&&!this.app)return{needsApp:!0};switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0};break;case"Safari":if(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){a(0).default.log("App Version out of date.");var e={version:this.versionRequired[this.appPlatform]};return a(0).default.nativeBridge.sendToApp("updateRequired"),e}if(this.appv>this.versionAvailable[this.appPlatform])return a(0).default.log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0}}}actionVerb(){return this.touch?"tap":"click"}actionVerbCaps(){return this.touch?"Tap":"Click"}updateOrientation(){return this.orientation=90===Math.abs(window.orientation)?n.a.Orientation.Landscape:n.a.Orientation.Portrait,this.orientation}isPageVisible(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]}getUpdateMessages(e){for(var t=0,a=[],i=(e||0)+1;i<=this.versionDesktop;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.versionDesktopMessages[i];r&&a.push(r)}return a}isFeatureEnabled(e){return this._features[e]}recordAppSubVersion(e){this.appSubVersion=e}getPlatformName(){return this.mac?"Mac":this.windows?"Windows":"Chrome"}getPlatformIcon(){return this.mac?"icon-apple":this.windows?"icon-windows":"icon-chrome"}getActualWindowWidth(){return document.body&&document.body.clientWidth||0}getActualWindowHeight(){return document.body&&document.body.clientHeight||0}hasBetaFeatures(){return this.isDevURL}}},50:function(e,t,a){"use strict";var i=a(0),r=a(3),s=a(5),n=a(2),o=a.n(n),l=a(15),d=a(35),h=a(65);t.a=class extends l.a{init(){var e=this.props;this.listenToDispatcher("windowResize"),e.supportArrows&&(this.selectedIndex=d.a.registerArrowsMode("FancyContextMenu",!0,this.getNumItems,this.onArrowsModeSelect,this.onArrowsModeKey),e.fromHotkey&&this.selectedIndex.set(0,!1),e.onSelectedIndexChanged&&this.selectedIndex.listen(e.onSelectedIndexChanged))}close(){try{i.default.PAssert(629,this.props.name,"Cannot call close on a menu without a name")}catch(e){i.default.reportError(e)}r.default.menus.closeContextMenu(this.props.name)}getHotkeys(){var e=this.props,t=[d.a.createEscape(this.onEscapeKey)];return e.hotkeys&&(t=t.concat(e.hotkeys)),t}getRefAtIndex(e){return this.refs["el_"+e]}onMount(){this.props.noBackdrop&&document.addEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.updateState()}onUnmount(){this.props.supportArrows&&d.a.exitArrowsMode("FancyContextMenu"),this.props.noBackdrop&&document.removeEventListener("mousedown",this.onMouseDownNoBackdrop,!0)}getState(){var e=this.updatePosition();return{selectedIndex:this.selectedIndex,left:e.left,top:e.top,right:e.right,bottom:e.bottom,maxHeight:e.maxHeight}}onMouseDownNoBackdrop(e){i.default.findParent(e.target,"fancyContextMenu")||r.default.menus.closeContextMenu()}isAtPosition(e){return!!(this.props.position&&this.props.position.split("-").indexOf(e)>=0)}getNumItems(){return this.numItems}onArrowsModeSelect(e){if(e>=0)if(this.props.onEnterKey)this.props.onEnterKey();else{var t=this.refs["el_"+e];t&&t.onClick&&t.onClick()}}onArrowsModeKey(e,t){var a=this.props;a.onKeyPress&&a.onKeyPress(e,t)&&a.supportArrows&&d.a.exitArrowsMode("FancyContextMenu")}onEscapeKey(){this.props.onEscape&&this.props.onEscape(),r.default.menus.closeContextMenu()}onChildMouseEnter(e,t){this.selectedIndex.set(e)}isOnSide(e){return this.props.side?this.props.side.indexOf(e)>=0:"bottom"===e}updatePosition(){var e=this.props,t=s.a.windowWidth(),a=s.a.windowHeight();try{i.default.PAssert(630,e.element,"Context menu needs an element to open on",e.id)}catch(y){i.default.reportError(y)}if(e.element){var r,n,o=e.element.getBoundingClientRect(),l=e.pos,d=this.refs.menu,h=l?l.left:void 0,c=l?l.top:void 0;isNaN(h)&&(this.isOnSide("right")?h=o.right:this.isOnSide("left")?r=t-("top left"===e.side?o.right:o.left):h=o.left),isNaN(c)&&(this.isOnSide("bottom")?c=o.bottom:this.isOnSide("top")?n=a-o.top:c=o.top);var u=e.positionOffset;u&&(!isNaN(h)&&u.left&&(h+=u.left),!isNaN(r)&&u.right&&(r+=u.right),!isNaN(c)&&u.top&&(c+=u.top),!isNaN(n)&&u.bottom&&(n+=u.bottom));var p={left:h,top:c,right:r,bottom:n};if(d){var g=h+d.clientWidth,f=c+d.clientHeight,m=t-8,v=a-8;"shrink"===this.props.overflowHeight&&n>a-8&&(p.maxHeight=Math.min(Math.max(a-c,260),500),f=Math.min(f,p.maxHeight+c)),g>m&&(p.left+=m-g),f>v&&(p.top+=v-f),(h<8||h+p.left<8)&&g<t&&(p.left+=8-h)}return p}return{left:0,top:0,maxHeight:400}}remapChildren(e,t){return o.a.Children.map(e,e=>{if(e&&"hr"!==e.type){if("leftcol"===e.key){var{children:a,...i}=e.props;return o.a.createElement("div",i,this.remapChildren(a,t))}if("scroller"===e.key)return o.a.createElement(h.a,{style:{maxHeight:400}},this.remapChildren(e.props.children,t));if(!e.props||e.props.onClick||e.props.customLayout){var r=e.props.onMouseEnter?a=>{this.onChildMouseEnter(t.index,a),e.props.onMouseEnter(a)}:this.onChildMouseEnter.bind(this,t.index);return o.a.cloneElement(e,{onMouseEnter:r,ref:"el_"+t.index,selected:this.state.selectedIndex===t.index++})}return e}return e})}render(){var e=this.state,t=this.props,a=i.default.classNames("fancyContextMenu popup c-shadow-popup",t.className,t.position,t.background,{"c-bg-menu":!t.background},{loading:t.loading},{openFromBottom:t.openFromBottom},{top:this.isAtPosition("top")},{bottom:this.isAtPosition("bottom")},{left:this.isAtPosition("left")},{right:this.isAtPosition("right")},{fill:this.isAtPosition("fill")},{full:this.isAtPosition("full")}),r={left:e.left,top:e.top,right:e.right,bottom:isNaN(t.bottom)?e.bottom:t.bottom,width:t.width,height:t.height,minWidth:t.minWidth,maxHeight:e.maxHeight||t.maxHeight,maxWidth:t.maxWidth};r=i.default.extend(r,this.props.style);var s=this.props.children;if(t.supportArrows){var n={index:0};s=this.remapChildren(this.props.children,n),this.numItems=n.index}return o.a.createElement("div",{ref:"menu",id:t.id,className:a,style:r},s)}}},51:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(5),n=a(3),o=a(2),l=a(15),d=a(35),h=a(49),c=a(44),u=a(19),p=a(47);t.a=class extends l.a{constructor(e){super(e),this.__isInput=!0}init(){var e=this.props,t={isFocused:e.focused,isComposing:!1,value:e.value||"",tokens:e.tokens||[],item:e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0};this.isInput="password"===e.type,this.isInput||(this.html=this.parseHTML(t.value||r.a.TextSpace)),e.buttonText&&(t.isLoading=!1),this.createObservables(t)}onMount(){this.updateHTML(this.state.value,!1),this.props.focused&&(this.focus(),this.props.selectAll?this.selectAll():this.selectEnd())}onUnmount(){this.isFocused.get()&&this.onBlur()}componentWillReceiveProps(e){this.state.item!==e.item&&e.item&&this.item.set(e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0),this.props.value!==e.value&&e.value!==this.state.value&&(this.setValue(e.value,this.isFocused.get()),this.forceUpdate()),this.props.tokens!==e.tokens&&e.tokens!==this.state.tokens&&this.tokens.set(e.tokens)}componentDidUpdate(e){var t=this._isDirty;if(this._isDirty=void 0,t&&this._dirtyCallbacks){for(var a=0,i=0;i<this._dirtyCallbacks.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._dirtyCallbacks[i]()}this._dirtyCallbacks=void 0}this.props.autocompleteItem!==e.autocompleteItem&&this.updateAutocomplete()}clearValue(){this.setValue("")}clearTokens(){this.tokens.clear()}isButtonEnabled(){return void 0!==this.props.buttonEnabled?this.props.buttonEnabled:this.state.value||this.state.tokens.length>0}getValue(){return this.value.get()}getTokens(){var e=this.getValue().trim(),t=this.tokens.get();return e?t.concat([{text:e,email:e,type:"contact"}]):t}getItem(){return this.state.item}parseHTML(e){var t;if(this.props.parse){var a=h.a.parseText(e,p.a.getContacts(),!0,!0,this.props.isSearch);this.parsedEls=a.els;var r=e.match(/(^#|[\(\s]#)([^\s\),#]+)/g);r&&(r=r.map(function(e){return e.trim().slice(1)})),this.tags=a.tags=r,this.contacts=a.contacts,this.props.onParsed&&this.props.onParsed(a),t=n.default.ElementRenderer.render(a.els,{convertSpaces:!0})}else t=e&&i.default.escape(e).replace(/ /g,"&nbsp;");return t}addDirtyCallback(e){this._dirtyCallbacks||(this._dirtyCallbacks=[]),this._dirtyCallbacks.push(e)}focus(){this._isDirty?this.addDirtyCallback(this.focus):this.refs.input.focus()}blur(){this.refs.input.blur()}select(){u.default.selectElement(this.refs.input)}selectEnd(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectEnd);else{var t=this.refs.input.textContent;t.length>0&&t!==r.a.TextSpace&&u.default.selectElement(this.refs.input,t.length)}}selectAll(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectAll);else{var t=this.refs.input.textContent;t.length>0&&t!==r.a.TextSpace&&u.default.selectElement(this.refs.input,0,t.length)}}handleCut(e){var t=this.getSelectionOffsets();if(t.start===t.end){var a=s.a.ie?"Text":"text/plain",r=e&&e.clipboardData?e.clipboardData:window.clipboardData,n=this.getValue();r.setData(a,n),this.clearValue(),this.onInput(),i.default.preventDefault(e),i.default.stopPropagation(e)}}_getHotkeys(e){var t=[d.a.create(r.a.KeyCode.L,!0,r.a.Primary.No,r.a.Shift.Either,this.selectAll)];return s.a.app&&t.push(d.a.create(r.a.KeyCode.L,!0,r.a.Primary.Yes,r.a.Shift.Either,this.selectAll)),e&&t.push(d.a.create(r.a.KeyCode.Escape,!0,r.a.Primary.Either,r.a.Shift.Either,this.handleEscapeKey)),t}onFocus(e){this.props.autocompleteMode&&c.a.clearDisabled(),this.props.autocompleteOnClick&&this.updateAutocomplete(),i.default.activeInput.set(this),this.isFocused.set(!0),this.___hotkeys=d.a.pushStack(this._getHotkeys(!!this.props.onEscape)),this.refs.input.addEventListener("cut",this.handleCut,!0),this.props.onFocus&&this.props.onFocus(e)}onBlur(e){i.default.activeInput.set(null),this.isFocused.set(!1),this.___hotkeys&&(d.a.popStack(this.___hotkeys),this.___hotkeys=void 0),this.refs.input.removeEventListener("cut",this.handleCut,!0),this.props.onBlur&&this.props.onBlur(e)}getSelectionOffset(){return this.getSelectionOffsets().end}getSelectionOffsets(){var e=u.default._getSelectionRange(),t={start:0,end:0};return e&&(t=u.default.getSelectOffsetsInElement(this.refs.input,e)),t}_setSelectionOffset(e){var t,a;if(e>0){var r=u.default.getOffsetChildElement(this.refs.input,e);r&&(t=r.element,a=r.offset)}else t=this.refs.input,a=0;if(t){var s=u.default.createFakeRange(t,a,t,a);try{i.default.PAssert(642,s,"Range should be valid when setting selection offset")}catch(n){i.default.reportError(n)}s&&u.default.setSelectionRange(s)}}setSelectionOffset(e){this._setSelectionOffset(e)}updateAutocomplete(e){var t=this.props,a=this.refs.input,i=t.autocompleteMode;if(e=t.autocompleteItem||e||this.item.get(),i){var r=u.default.getSelectionInElement(a);(t.autocompleteOnClick||r&&r.start===r.end)&&c.a.update({mode:i,canAutocompleteItems:t.canAutocompleteItems,text:this.value.get(),offset:r?r.start:0,owner:this,item:e,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:t.positionOffset,elementDisplay:t.autocompleteElementDisplay||this.refs.wrapper,elementInput:a,supportSearchItemAutocomplete:t.supportSearchItemAutocomplete,noShow:t.noShowAutocomplete,showNoMatches:t.autocompleteOnClick})}}setValue(e,t,a){this._isDirty=!0;try{i.default.PAssert(643,void 0!==e,"Should not set FancyInput value to undefined")}catch(r){i.default.reportError(r)}e=e||"",this.updateHTML(e,t,a),this.value.set(e)}updateHTML(e,t,a){var i=a;t&&void 0===i&&(i=this.getSelectionOffset());var s=this.parseHTML(e||r.a.TextSpace);s!==this.refs.input.innerHTML&&(this.refs.input.innerHTML=s),t&&(i>e.length&&(i=e.length),this.setSelectionOffset(i))}addToken(e){this.tokens.push(e);var t=this.refs.inner;t.scrollWidth>t.clientWidth&&(t.scrollLeft=t.scrollWidth-t.clientWidth)}updateTokens(e){for(var t=0,a=i.default.parseTokensFromText(this.value.get()),r="",s=0;s<a.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=a[s];"contact"===n.type?this.addToken(n):r+=n.text}this.setValue(r,!0)}onChange(){this.value.set(this.refs.input.value)}onInput(){if(!this.isComposing.get()){var e=this.refs.input.textContent.replace(/\u00a0/g," ").replace(new RegExp(r.a.TextSpace,"g"),"").replace(/\n/g,"");this.setValue(e,!0),this.updateAutocomplete(),this.props.onChange&&this.props.onChange(e,this.item.get())}}handleEscapeKey(){this.props.onEscape?this.props.onEscape():this.isInput||this.select(),this.__hotkeyEscape&&(d.a.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0)}onMouseDown(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(e)}onKeyDown(e){var t=this.props;this.isInput||(t.autocompleteMode&&c.a.isShowing()||t.buttonText&&e.keyCode===r.a.KeyCode.Enter&&this.onButtonClick(),e.keyCode===r.a.KeyCode.Backspace&&(!this.state.value&&this.state.tokens.length>0&&this.removeToken(this.tokens.length()-1),0===this.refs.input.textContent.length&&(this.refs.input.textContent=r.a.TextSpace)),e.keyCode===r.a.KeyCode.Tab&&c.a.isShowing()&&c.a.hide()),e.keyCode===r.a.KeyCode.Enter&&(t.onEnter&&t.onEnter(e),e.preventDefault()),t.onKeyDown&&t.onKeyDown(e)}onKeyUp(e){var t=this.props;!this.isInput&&t.autocompleteMode&&(e.keyCode!==r.a.KeyCode.LeftArrow&&e.keyCode!==r.a.KeyCode.RightArrow||this.updateAutocomplete()),"email"===t.autocompleteMode&&(e.keyCode===r.a.KeyCode.Comma?this.updateTokens(!1):e.keyCode===r.a.KeyCode.Enter&&this.updateTokens(!0)),t.onKeyUp&&t.onKeyUp(e)}onCompositionStart(){this.isComposing.set(!0)}onCompositionEnd(e){this.isComposing.set(!1),this.onInput()}onAutocompleteSelected(e){var t=this.props;e.item&&t.isSearch?t.onAutocompleteSelected(e):(e.item&&this.item.set({item:e.item,text:e.item.getStyledTextAsOneLine()}),void 0!==e.value&&(this.setValue(e.value,!0,e.offset),t.onChange&&t.onChange(e.value,this.item.get())),e.token&&this.addToken(e.token),t.onAutocompleteSelected&&t.onAutocompleteSelected(e))}onButtonClick(){var e=this.state;this.isButtonEnabled()&&(this.props.onButtonClick&&this.props.onButtonClick(e.value,this.onButtonClickCallback)&&this.isLoading.set(!0),c.a.isShowing()&&c.a.hide())}onButtonClickCallback(){this.value.set(""),this.isLoading.set(!1)}removeToken(e){var t=this.props,a=this.tokens.get()[e];this.tokens.removeAt(e),t.onChange&&t.onChange(this.getValue(),this.item.get()),t.onTokenRemoved&&t.onTokenRemoved(a)}removeItem(){this.item.set(void 0),this.props.onChange&&this.props.onChange(this.getValue(),this.item.get())}render(){var e,t,a=this.state,r=this.props,n=r.margin||{},l=r.padding||{};isNaN(l.left)&&(l.left=8),isNaN(l.right)&&(l.right=8);var d=!1!==r.border,h=d?2:0,c=i.default.classNames("fancyInput",{disabled:r.disabled},{focused:a.isFocused},{hasFloatingText:!!r.floatingText},{hasButton:!!r.buttonText},{hasBorder:d},this.props.className),u=r.height||40,p=(u-40)/2,g=i.default.extend({width:r.width,height:u,display:r.display,fontSize:r.fontSize},r.style);if(r.floatingText)l.bottom=5+Math.min(p,2),l.top=u-16-l.bottom;else{var f=(u-h-16)/2;l.top=f,l.bottom=f}if(r.floatingText){var m={marginBottom:5+p,marginLeft:l.left,marginRight:l.right};a.isFocused||a.value?a.isFocused?m.color=i.default.colorBlue:m.color="#ccc":m.color="#aaa";var v=i.default.classNames("placeholder c-foreground-super-faded","noSelect",{floating:a.isFocused||a.value||a.tokens.length>0});e=o.createElement("div",{className:v,style:m},r.floatingText)}else if(r.placeholder&&!a.value&&!a.isComposing&&0===a.tokens.length&&!a.item){var y={paddingTop:l.top,marginLeft:l.left,marginRight:l.right};e=o.createElement("div",{className:"placeholder c-foreground-super-faded noSelect",style:y},r.placeholder)}var _,S={right:r.buttonText&&50};if(a.isFocused&&!a.item?S[s.a.transform.react]="":S[s.a.transform.react]="scale(0,1)",t=o.createElement("div",{className:"focusUnderline",style:S}),r.buttonText){var P=i.default.classNames("fancyInputButton c-button-raised-primary",{loading:a.isLoading},{disabled:!this.isButtonEnabled()}),I={width:r.buttonWidth,lineHeight:u+"px"};_=o.createElement("span",{className:P,style:I,onClick:this.onButtonClick},r.buttonText)}var b,D={paddingLeft:l.left,paddingRight:l.right,marginLeft:n.left,marginRight:n.right},w={ref:"input",className:"fancyInputInput",style:{paddingTop:l.top,paddingBottom:l.bottom},onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown,autoComplete:"false",tabIndex:r.tabIndex,disabled:a.isLoading};this.isInput?(w.type=r.type,w.onChange=this.onChange,b=o.createElement("input",w)):(w.onInput=this.onInput,w.contentEditable=r.readonly||a.item?null:"true",w.onCompositionStart=this.onCompositionStart,w.onCompositionEnd=this.onCompositionEnd,b=o.createElement("div",w));var E=[];if(a.tokens)for(var C=0,A=0;A<a.tokens.length;A++){if(C++>5e3&&__infLoop&&__infLoop(C))throw new RangeError;let e=a.tokens[A],t={marginTop:l.top-4,paddingLeft:r.padding&&!isNaN(r.padding.left)?r.padding.left:8};E.push(o.createElement("div",{key:"token"+A,className:"token c-button-raised c-border",style:t},o.createElement("span",{dangerouslySetInnerHTML:{__html:e.text}}),o.createElement("i",{className:"icon-close c-button",onClick:this.removeToken.bind(this,A)})))}if(a.item){let e={lineHeight:u+"px",marginTop:0,paddingLeft:r.padding&&!isNaN(r.padding.left)?r.padding.left:8};E.push(o.createElement("div",{key:"tokenItem",className:"token flexbox",style:e},o.createElement("span",{className:"f1",dangerouslySetInnerHTML:{__html:a.item.text}}),o.createElement("i",{className:"icon-close c-button",onClick:this.removeItem})))}var M=i.default.classNames("fancyInputWrap c-foreground c-background c-border",{hasTokens:E.length>0},{hasItem:a.item});return o.createElement("div",{className:c,id:this.props.id,style:g,onClick:this.props.onClick},o.createElement("div",{className:"fancyInputContent"},o.createElement("div",{className:M,ref:"wrapper"},e,o.createElement("div",{className:"fancyInputInner",style:D,ref:"inner"},E,o.createElement("div",{className:"fancyInputInner2"},b))),_,t))}}},52:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(1),l=a(3),d=a(16),h=a(5),c=a(6),u=a(9),p=a(32),g=a(47),f=a(31),m=a(20),v=a(13),y=a(8);let _=(i=class{constructor(){this.pluginsAvailable=[o.a.PluginID.Contacts,o.a.PluginID.Drive,o.a.PluginID.GCalendar,o.a.PluginID.Gmail],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new u.a(!1),this.GCalendarsAvailable=new p.a,this.GCalendarSyncErrors=new p.a(void 0),this.GCalendarAddFailure=new u.a(!1),this.GCalendarListFailure=new u.a(!1),this.GCalendarListLoading=new u.a(!1),this.GmailNumSyncd=new u.a(0),this.GmailCacheSize=new u.a(0),this.GmailSyncAccounts=new p.a,this.isSaveEnabled=new u.a(!1),this.hasRefreshed=!1,d.a.forceBind("calendarComparator",this)}init(){var e=l.default.pluginManager.getPluginGCalendar().getImportCalendarList();e&&this.GCalendarsAvailable.set(e)}checkRefresh(){this.hasRefreshed||this.refreshPluginStatus()}refreshPluginStatus(e){var t=0;this.hasRefreshed=!0;for(var a=0;a<this.pluginsAvailable.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i,r=this.pluginsAvailable[a];i=r===o.a.PluginID.Contacts?l.default.settings.syncContacts.get():l.default.pluginManager.isAuthorized(r),this.updatePluginStatus(r,i)}e&&e!==o.a.PluginID.GCalendar||(this.updatePluginOptionStatus(o.a.PluginID.GCalendar,o.a.PluginSettingsID.GCalendar.WriteAccess),this.updatePluginOptionStatus(o.a.PluginID.GCalendar,o.a.PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(o.a.PluginID.GCalendar,o.a.PluginSettingsID.GCalendar.ExportCalendar)),e&&e!==o.a.PluginID.Drive||this.updatePluginOptionStatus(o.a.PluginID.Drive,o.a.PluginSettingsID.Drive.WriteAccess)}refresh(e){this.refreshPluginStatus(),e&&e!==o.a.PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),e&&e!==o.a.PluginID.Gmail||this.updateGmailInfo()}calendarComparator(e,t){return e.summary.localeCompare(t.summary)}updateGmailInfo(){var e=l.default.pluginManager.getPluginGmail();this.GmailNumSyncd.set(e.getSyncdMessageCount()),this.GmailSyncAccounts.set(e.getSyncAccounts())}updateCalendarList(){if(l.default.pluginManager.isAuthorized(o.a.PluginID.GCalendar)){var e=l.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),e.getFullCalendarList(e=>{this.GCalendarListLoading.set(!1,!1),e?(e.sort(this.calendarComparator),this.GCalendarsAvailable.set(e),this.GCalendarListFailure.set(!1)):this.GCalendarListFailure.set(!0)})}}getEnabledPlugins(){this.checkRefresh();var e=this._pluginEnabledObservables;return Object.keys(e).filter(t=>e[t].get())}getPluginEnabledObservable(e){return this.checkRefresh(),this._pluginEnabledObservables[e]}isPluginEnabled(e){return this.checkRefresh(),this._pluginEnabledObservables[e].get()}getPluginOptionObservable(e,t){return this.checkRefresh(),this._pluginOptionObservables[e][t]}getPluginOptions(e){return this.checkRefresh(),this._pluginOptionObservables[e]}isPluginAnOption(e){return e===o.a.PluginID.Mailbird?h.a.embed===o.a.EmbedApps.Mailbird:this.pluginsAvailable.indexOf(e)>=0}updatePluginStatus(e,t,a){this._pluginEnabledObservables[e]?this._pluginEnabledObservables[e].set(t,a):this._pluginEnabledObservables[e]=new u.a(t)}updatePluginOptionStatus(e,t,a){var i=l.default.pluginManager.getSetting(e,t);this._pluginOptionObservables[e]||(this._pluginOptionObservables[e]={}),this._pluginOptionObservables[e][t]?this._pluginOptionObservables[e][t].set(i||a&&[]):this._pluginOptionObservables[e][t]=a?new p.a(i):new u.a(i)}onFailedAuthenticate(e){l.default.toasts.pushMessage({text:"We failed to successfully authenticate you for "+e+", please try again.",actionText:"OKAY"})}_wasPluginAuthorized(e,t){var a;if(e===o.a.PluginID.Contacts)t.indexOf(o.a.GScope.Contacts)>=0&&(a=!0);else{var i=l.default.pluginManager.getPlugin(e);let t=m.a.getUserSync();t&&(a=i.verifyAuthorization(t.email))}try{n.default.PAssert(142,a,"Should always be successful at authorizing plugins")}catch(r){n.default.reportError(r)}return a}setEnabledSyncAccount(e,t,a,i){e[t]||(e[t]={}),e[t][a]=i}setEnabledPlugins(e,t){var a=0;let i=l.default.settings.syncAccounts.get(),r=n.default.clone(i||{});for(var s=0;s<e.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let t=e[s],i=t.id,n=t.enable,d=this._pluginEnabledObservables[i].get(),h=l.default.pluginManager.getPlugin(t.id);n?(t.id===o.a.PluginID.GCalendar&&h.setSetting(o.a.PluginSettingsID.GCalendar.WriteAccess,!0),t.id!==o.a.PluginID.Drive||t.shared||h.setSetting(o.a.PluginSettingsID.Drive.WriteAccess,!1)):d&&this.disablePlugin(i),this.setEnabledSyncAccount(r,m.a.getDefaultAccountID(),t.id,d)}n.default.deepEqual(i,r)||l.default.settings.syncAccounts.set(r);var d=e.filter(e=>e.enable);this.enablePlugins(d,!1,t)}enablePlugins(e,t,a){var i=e.map(e=>{var t=e.id,a=l.default.pluginManager.getPlugin(e.id);return a?t===o.a.PluginID.Drive?a.googleScopes(e.shared):a.googleScopes():t===o.a.PluginID.Contacts?[o.a.GScope.Contacts]:void 0}).reduce((e,t)=>e.concat(t),[]);if(i=n.default.arrayUnion(i,[o.a.GScope.UserInfoEmail]),t||i&&i.length>1){let t=l.default.settings.activeUser.get();f.a.authAccount(t,i,t=>{t&&!t.error?(this.refresh(),e.map(e=>{if(e.id===o.a.PluginID.Contacts)this.enableSyncContacts();else{var a=l.default.pluginManager.getPlugin(e.id);l.default.pluginManager.onPluginAuthorized(a,!0),e.id===o.a.PluginID.Drive&&e.shared&&a.setSetting(o.a.PluginSettingsID.Drive.WriteAccess,!0)}try{n.default.PAssert(143,this._wasPluginAuthorized(e.id,t.scopes),"Plugin "+e.id+" was not authorized properly.")}catch(i){n.default.reportError(i)}}),this.refresh(),a(!0)):a(!1)})}else this.refresh(),a(!0)}_enablePlugin(e){var t=this._pluginEnabledObservables[e];l.default.pluginManager.authorizePlugin(e,!0,a=>{a?(t.set(!0),this.refresh(e),n.default.sendEvent(e,"PluginEnabled")):(this.onFailedAuthenticate(e),n.default.sendEvent(e,"PluginEnableFailed"))})}enablePlugin(e){e===o.a.PluginID.Contacts?this.enableSyncContacts():this._enablePlugin(e)}disablePlugin(e){var t=this._pluginEnabledObservables[e];e===o.a.PluginID.Contacts?(n.default.sendEvent("Settings","DisableContacts"),l.default.settings.syncContacts.set(!1),g.a.clearContacts(),t.set(!1)):l.default.pluginManager.deauthorizePlugin(e,()=>{t.set(!1),n.default.sendEvent(e,"PluginDisabled")})}togglePlugin(e){!this._pluginEnabledObservables[e].get()?this.enablePlugin(e):this.disablePlugin(e)}togglePluginOption(e,t){var a=this._pluginOptionObservables[e][t],i=!a.get();l.default.pluginManager.setSetting(e,t,i),i?l.default.pluginManager.authorizePlugin(e,!0,r=>{r?(l.default.pluginManager.onAuthorizedSetting(e,t,i),a.set(!0),n.default.sendEvent(e,"OptionEnabled_"+t)):(this.onFailedAuthenticate(t),l.default.pluginManager.setSetting(e,t,!i),n.default.sendEvent(e,"OptionEnableFailed_"+t))}):(a.set(!1),n.default.sendEvent(e,"OptionDisabled_"+t))}setPluginOption(e,t,a,i,r){var s=this._pluginOptionObservables[e][t],o=s.get();l.default.pluginManager.setSetting(e,t,a),a&&i?l.default.pluginManager.authorizePlugin(e,!0,i=>{i?(l.default.pluginManager.onAuthorizedSetting(e,t,a),s.set(a),n.default.sendEvent(e,"OptionSet_"+t+"_"+a),r&&r(!0)):(this.onFailedAuthenticate(t),l.default.pluginManager.setSetting(e,t,o),n.default.sendEvent(e,"OptionEnableFailed_"+t+"_"+a),r&&r(!1))}):(s.set(a),n.default.sendEvent(e,"OptionSet_"+t+"_"+a),r&&r(!0))}enableOfflineFeatures(e,t){var a=this.getEnabledPlugins().map(e=>e===o.a.PluginID.Drive?{id:e,shared:this.getPluginOptionObservable(e,o.a.PluginSettingsID.Drive.WriteAccess).get()}:{id:e});this.enablePlugins(a,e,e=>{e||(l.default.toasts.pushMessage({text:"We failed to successfully authenticate you for offline access.",actionText:"OKAY"}),n.default.sendEvent("OfflineAccessFailed",!0)),t&&t(e)})}isNotificationsEnabled(){return!l.default.settings.disableNotifications.get()}toggleNotifications(){var e=l.default.settings.disableNotifications.get();l.default.settings.disableNotifications.set(!e),e?l.default.timeline.updateNotifications():l.default.timeline.clearNotifications()}enableSyncContacts(){n.default.sendEvent("Settings","EnableContacts");l.default.settings.syncContacts.set(!0),this.updatePluginStatus(o.a.PluginID.Contacts,!0),g.a.refreshContacts(e=>{e<0?l.default.toasts.pushMessage({text:"There was an error syncing your contacts. Please try again.",actionText:"SYNC",action:()=>{this.enableSyncContacts()}}):e>0&&v.a.parseAll(o.a.ChangeType.Auto)}),c.d.miscAction({type:c.b.Misc,misc:c.a.SyncContacts})}onTapRefreshContacts(e,t){var a=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),a=g.a.refreshContacts(()=>{this.isRefreshingContacts.set(!1),t&&t()}),n.default.sendEvent("Menu","RefreshContacts")),a}addCalendar(e,t){var a=l.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),a.createCalendar(e,t,e=>{this.GCalendarListLoading.set(!1),e?this.updateCalendarList():this.GCalendarAddFailure.set(!0)})}notifySyncError(e){this.GCalendarSyncErrors.set(e||[])}},s()(i.prototype,"onTapRefreshContacts",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"onTapRefreshContacts"),i.prototype),i);t.a=new _},53:function(e,t,a){"use strict";var i=a(3),r=a(0),s=a(1),n=a(48),o=a(467),l=a.n(o),d=a(22);const h=864e5;t.a=new class{constructor(){}parseText(e){let t,a=(e=e.toLowerCase()).substring(e.indexOf("every")),o=d.b.parseText(a,void 0);if(o){try{r.default.PAssert(852,!(o.options.interval<0),"Interval set to negative",e)}catch(c){r.default.reportError(c)}let{options:a,fromDate:i,duration:l}=o;i||(i=new Date,i=this.toUTCDate(i));let h=Object.assign({dtstart:i},a);delete h.interval;let u=new d.b(h).after(i,!0);if(u){u=this.UTCtoLocal(u);let e=a.byhour?a.byhour[0]:0,r=a.byminute?a.byminute[0]:0;u.setHours(e),u.setMinutes(r),u.setSeconds(0),u.setMilliseconds(0),u=new Date(this.toUTCDate(u).getTime()),a.dtstart=u,a.until&&(a.until=new Date(u.getTime()+a.until.getTime()-i.getTime())),t=n.a.fromRRuleOptions(a,l?l*s.a.MSPerMinute:void 0)}}else{let a=e.replace(/\./g,"/");var h=l.a.parse(a,void 0,{forwardDate:!0})[0];if(h){let a=i.default.International.parseDate(h.text,i.default.settings.dateFormat.get());if(a){let i,r=e.substring(h.index+h.text.length).trim().match(d.f.tokens.duration);r&&(i=Math.round(+r[1]*("h"===r[2][0]?s.a.MSPerHour:s.a.MSPerMinute))),t=new n.a(a,{duration:i})}}}return t}toUTCDate(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()))}UTCtoLocal(e){return new Date(e.getTime()+e.getTimezoneOffset()*s.a.MSPerMinute)}toHumanText(e,t){let a=+new Date(e).clearTime()-+Date.today(),r="";return t||(a<0&&a>=-h?r="Yesterday":e.isToday()?r="Today":a>0&&a<2*h&&(r="Tomorrow")),r||(r=e.toString(i.default.International.getFormat(e.getFullYear()!==Date.today().getFullYear()?s.a.DFormat.MonthDayYear:s.a.DFormat.MonthDay))),e.hasTimeOfDay()&&(r+=" "+e.toString("h:mmtt").toLowerCase()),r}testGetNext(e,t,a){}testOnDate(e,t,a){}}},54:function(e,t,a){"use strict";var i=a(7),r=a.n(i),s=a(0),n=a(1),o=a(3),l=a(8),d=a(27),h=a(55),c=a(18);const u={identity:e=>e,true:e=>!0,index:(e,t)=>t},p=(e=u.identity,t=u.true,a,i,r)=>((e,t,a)=>Object.assign(a,{[e]:t}))(e(i,r),t(i,r),a),g=(e,t,a)=>p(void 0,void 0,e,t,a),f=(e,t)=>{const a={id:e.id},i=i=>{void 0===t[i]?a[i]=null:e[i]!==t[i]&&(a[i]=t[i])};return Object.keys(e).forEach(i),Object.keys(t).forEach(i),a},m=(e,t,a)=>"Removed"===e||"Added"===e?{type:e,value:a}:{type:e,value:t?f(t,a):a},v=(e,t)=>({type:t,value:e}),y=(e,t)=>t=>[t].map((e=>t=>m(t.type,e[t.value.id],t.value))(e))[0],_=(e,t)=>{const a=t.value;return e=(e=>(t,a,i)=>p((e=>t=>((e,t)=>t?t[e]:void 0)(e,t))(e),u.identity,t,a,i))("id")(e,a),"Removed"===t.type&&delete e[a.id],e},S=({changes:e})=>e.map(e=>e.value),P=({changes:e,prevStore:t})=>e.map(y(t)),I=e=>(e._store={},e),b=({changes:e,type:t="load",prevStore:a,api:i})=>(i._store=e.reduce(_,i._store),i),D=({item:e,api:t,changeType:a})=>{const i=Object.assign({},t._store),r=v(e,a);b({changes:[r],prevStore:i,api:t})},w=e=>(t,a)=>D({item:a,api:t,changeType:e}),E={load:({changes:e,api:t,prevStore:a})=>b({api:t,type:"update",changes:e,prevStore:a}),normalizeChanges:P,addItem:w("Added"),removeItem:w("Removed"),modifyItem:w("Modified")},C={load:({changes:e,api:t,prevStore:a})=>b({changes:e,api:I(t),prevStore:a}),normalizeChanges:S},A=(e,t,a)=>(e.push(t),a),M=(e,t,a)=>{const i=e.indexOf(t);return i>-1&&e.splice(i,1),a},T=(e,t,a)=>{for(let i of e)setTimeout(()=>i(...t),0);return a},L=e=>(t,a)=>((e,t,a)=>{const i=Object.assign({},a._store),r=a._loadingState,s="load"===r?a._loader:a._updater,n="load"===r;n||(e=e.filter(e=>{let t=e.value;return"Removed"===e.type||!i[t.id]||t.d!==i[t.id].d})),n&&(a._loadingState="update","load"===r&&a._earlyEdits.length&&(a._earlyEdits.forEach(e=>{T(a._callbacks.update,[e])}),a._earlyEdits=[]));if("update"===a._loadingState){if(n||e.length>0){a=s.load({api:a,changes:e,prevStore:i});const n=s.normalizeChanges({api:a,changes:e,prevStore:i});T(a._callbacks[r],[{responses:n},t]),T(a._callbacks[`${r}Debug`],[{responses:n,changes:e,api:a},t])}}else a._earlyEdits.push({changes:e,api:a});return a})(t,a,e),x=({id:e,store:t})=>t[e]?Object.assign({},t[e]):void 0,k=[],R=({db:e,config:t,ignore:a=k,backend:i,path:r,orderBy:s,startAt:n,extraModifiedPath:o,encryptedFields:l})=>{const d={_config:t,_database:e,_store:{},_callbacks:{update:[],load:[],updateDebug:[],loadDebug:[]},_ignore:a.reduce(g,{}),_loadingState:"load",_earlyEdits:[],_backend:i.create({db:e,path:r,orderBy:s,startAt:n,extraModifiedPath:o,encryptedFields:l}),_loader:C,_updater:E};return d._backend.onUpdate(L(d)),d.get=e=>x({id:e,store:d._store}),d.getFromRemote=e=>d._backend.getFromRemote(e),d.update=e=>(({item:e,backend:t,api:a})=>{const i=(e=>t=>((e,t)=>{if(!e)return e;const a={};for(var i in e)i in t||(a[i]=e[i]);return a})(t,e))(a._ignore)(e);return a._updater.modifyItem(a,i),t.update(i,e=>a._updater.modifyItem(a,e))})({item:e,backend:d._backend,api:d}),d.getPathForItem=e=>(({item:e,backend:t,api:a,batch:i})=>t.getPathForItem(e))({item:e,backend:d._backend,api:d}),d.remove=e=>(({item:e,backend:t,api:a})=>{return a._updater.removeItem(a,e),console.log("remove",e),t.remove(e)})({item:e,backend:d._backend,api:d}),d.onLoad=e=>A(d._callbacks.load,e),d.offLoad=e=>M(d._callbacks.load,e),d.onUpdate=e=>A(d._callbacks.update,e),d.offUpdate=e=>M(d._callbacks.update,e),d.onLoadDebug=e=>A(d._callbacks.loadDebug,e),d.offLoadDebug=e=>M(d._callbacks.loadDebug,e),d.onUpdateDebug=e=>A(d._callbacks.updateDebug,e),d.offUpdateDebug=e=>M(d._callbacks.updateDebug,e),d.setSent=(e,t)=>d._backend.setSent(e,t),d};var O=a(42);var F,N=class{constructor({path:e,orderBy:t,startAt:a,extraModifiedPath:i,encryptedFields:r}){this.path=e,this.session=O.a.database(),this.orderBy=t,this.startAt=a,this.extraModifiedPath=i,this.encryptedFields=r,this.updatesSent={},this.reqNum=0}update(e){let t={};const a=Object.assign({},e);delete a.id,s.default.isObject(a)?Object.keys(a).forEach(i=>{t[`${this.path}/${e.id}/${i}`]=a[i]}):t[`${this.path}/${e.id}`]=a,this.extraModifiedPath&&(t[this.extraModifiedPath]=O.a.database.ServerValue.TIMESTAMP);let i=this.setSent(e.id,t);return this.session.ref().update(t).then(()=>(delete this.updatesSent[e.id][i],s.default.isEmpty(this.updatesSent[e.id]))).catch(e=>s.default.reportError(e))}getPathForItem(e){return`${this.path}/${e.id}/`}remove(e){let t=this.setSent(e.id,{type:n.a.CrudActions.Removed,id:e});return this.session.ref(`${this.path}/${e.id}`).remove().then(()=>(delete this.updatesSent[e.id][t],s.default.isEmpty(this.updatesSent[e.id])))}toChangeInternal(e,t,a){return t.id=e,{type:a,value:t}}isChangeRemote(e){let t=e.key,a=(e.val(),this.updatesSent[t]);return!(a&&!s.default.isEmpty(a))}onUpdate(e){this.cbOnUpdate=e;let t=!1,a=this.session.ref(this.path);this.orderBy&&this.startAt&&(a=a.orderByChild(this.orderBy).startAt(this.startAt)),a.once("value",a=>{if(t)return;t=!0;let i=a.val();const r=Object.keys(i||{}).map(e=>this.toChangeInternal(e,i[e],"load"));e(r,!0)},e=>{console.log("Firebase error",e)}),a.on("child_added",a=>{if(!t)return;const i=[this.toChangeInternal(a.key,a.val(),"Added")];e(i,this.isChangeRemote(a))},e=>{console.log("Firebase error",e)}),a.on("child_changed",a=>{if(!t)return;const i=[this.toChangeInternal(a.key,a.val(),"Modified")];e(i,this.isChangeRemote(a))},e=>{console.log("Firebase error",e)}),a.on("child_removed",a=>{if(!t)return;const i=[this.toChangeInternal(a.key,a.val(),"Removed")];e(i,this.isChangeRemote(a))},e=>{console.log("Firebase error",e)})}setSent(e,t){let a=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][a]=t,a}};var B=new(F=class{init(){return this.session||(this.database=this.session=O.a.database()),this.serverTime=O.a.database.ServerValue.TIMESTAMP,this}create(e){return new N(e)}onOnlineChange(e){this.session.ref(".info/connected").on("value",t=>{e(!0===t.val())})}generateId(){return O.a.database().ref().push().key}},r()(F.prototype,"onOnlineChange",[l.a],Object.getOwnPropertyDescriptor(F.prototype,"onOnlineChange"),F.prototype),r()(F.prototype,"generateId",[l.a],Object.getOwnPropertyDescriptor(F.prototype,"generateId"),F.prototype),F);var U,H=class{constructor(e,t){this.path=e,this.firebasePath=new N({path:e}),this.session=O.a.database(),this.dataCache={},this.isLoaded=!1,this.ignoreLocalChange=!1,this.cbsOnUpdate={},this.updatesSent={},this.reqNum=0,this.encryptedFields=t}toChangeInternal(e,t,a){let i=e.ref.path.slice(2),r=e.val(),s={},n=s,o=this.dataCache;if("object"===typeof r){var l=0;for(let e=0;e<i.length;e++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;let a=i[e];n[a]={},n=n[a],"Removed"!==t&&(o[a]||(o[a]={}),o&&(o=o[a]))}Object.keys(r).forEach(e=>{n[e]=r[e],"Removed"!==t?o[e]=r[e]:o&&delete o[e]}),s=s[i[0]]}else{let i=e.key;o[a]||(o[a]={}),o=o[a],"Removed"!==t?o[i]=r:o&&delete o[i],s[i]=r}return{type:t,value:s}}async set(e,t){var a=0;let i=e.split("/"),r=this.dataCache,n=i[i.length-1],o=`${this.path}/${e}`;for(let s=0;s<i.length-1;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!r)return Promise.resolve(!1);i[s]&&(r[i[s]]||(r[i[s]]={}),r=r[i[s]])}r[n]=t;let l=this.session.ref(o),d=this.setSent(e,t);try{return await l.update(t),delete this.updatesSent[e][d],s.default.isEmpty(this.updatesSent[e])}catch(h){s.default.reportError(h)}return!1}async remove(e){let t=this.setSent(e,{type:n.a.CrudActions.Removed,id:e});try{return await this.session.ref(`${this.path}/${e}`).remove(),delete this.updatesSent[e][t],s.default.isEmpty(this.updatesSent[e])}catch(a){s.default.reportError(a)}return!1}isChangeRemote(e){let t=this.updatesSent[e];return!(t&&!s.default.isEmpty(t))}sendChangeCB(e,t,a){let i=e.ref.path;s.default.isString(i)&&(i=i.split("/"));let r=i.slice(2).join("/"),n=this.isChangeRemote(r);n&&a(t,n)}onLoad(e,t){this.session.ref(this.path).once("value",t=>{if(this.isLoaded)return;this.isLoaded=!0;const a=t.val()||{};this.dataCache=a,e(a)},e=>{s.default.log("Firebase error",e),t?t(e):s.default.reportError(e,"Missing cbError handler: "+this.path)})}onUpdate(e,t,a){this.cbsOnUpdate[e]=t;let i=this.path+"/"+e;this.session.ref(i).on("child_added",a=>{if(!this.isLoaded)return;const i=this.toChangeInternal(a,"Added",e);this.sendChangeCB(a,i,t)},e=>{console.log("Firebase error",e),a&&a(e)}),this.session.ref(i).on("child_changed",a=>{if(!this.isLoaded)return;const i=this.toChangeInternal(a,"Modified",e);this.sendChangeCB(a,i,t)},e=>{console.log("Firebase error",e),a&&a(e)}),this.session.ref(i).on("child_removed",a=>{if(!this.isLoaded)return;const i=this.toChangeInternal(a,"Removed",e);this.sendChangeCB(a,i,t)},e=>{console.log("Firebase error",e),a&&a(e)})}offUpdate(e,t){let a=this.path+"/"+e;this.session.ref(a).off("child_added",t),this.session.ref(a).off("child_changed",t),this.session.ref(a).off("child_removed",t)}setSent(e,t){let a=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][a]=t,a}};var V=(U=class{constructor(e,t,a){this.docID=e,this.uid=t,this.userDocuments=a,this.treeApi=new H(`documents/${e}`,{"p/s":!0}),this.cbs=[],this.cbsAcl=[]}onLoad(e,t){this.treeApi.onLoad(t=>{e(t)},t)}onUpdate(e,t){this.cbs.push(e),this.treeApi.onUpdate("p",e,t)}offUpdate(e){let t=this.cbs.indexOf(e);this.cbs.splice(t,1),this.treeApi.offUpdate("p",e)}onAclUpdate(e,t){this.cbsAcl.push(e),this.treeApi.onUpdate("a",e,t)}offAclUpdate(e){let t=this.cbsAcl.indexOf(e);this.cbsAcl.splice(t,1),this.treeApi.offUpdate("p",e)}create(e,t){let a=Object.assign({},e),i={t:a.p.t};a.p.d&&(i.d=a.p.d),delete a.id;var r={[`/documents/${this.docID}`]:a,[`/userdocuments/${this.uid}/${this.docID}`]:i};if(t)for(var s=0,n=0;n<t.length;n++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;let e=t[n],a=e.id;delete e.id,r[`/items/${this.docID}/${a}`]=e}return this.userDocuments.setSent(this.docID,i),B.database.ref().update(r)}unlisten(){this.cbs.forEach(this.offUpdate),B.database.ref(`/items/${this.docID}`).off(),B.database.ref(`/userdocuments/${this.uid}/${this.docID}`).off(),B.database.ref(`/documents/${this.docID}/a`).off(),B.database.ref(`/documents/${this.docID}`).off()}deleteFully(){this.unlisten();var e={[`/items/${this.docID}`]:null,[`/userdocuments/${this.uid}/${this.docID}`]:null,[`/documents/${this.docID}`]:null};return B.database.ref().update(e)}update(e,t){let a=Object.assign({},e);delete a.id;var i={};t?i[`/documents/${this.docID}/p`]=a.p:i[`/documents/${this.docID}`]=a,a.p.d&&(i[`/userdocuments/${this.uid}/${this.docID}/d`]=a.p.d),a.p.t&&(i[`/userdocuments/${this.uid}/${this.docID}/t`]=a.p.t),B.database.ref().update(i)}addBackup(e){B.database.ref(`/documents/${this.docID}/c`).update({[e]:""})}},r()(U.prototype,"offUpdate",[l.a],Object.getOwnPropertyDescriptor(U.prototype,"offUpdate"),U.prototype),r()(U.prototype,"offAclUpdate",[l.a],Object.getOwnPropertyDescriptor(U.prototype,"offAclUpdate"),U.prototype),U);var j=class{constructor(e){this.uid=e,this.session=O.a.database(),this.treeApi=new H(`users/${e}`,{"s/aE/v":!0});const t={a:"AuthToken",b:"Board",p:"Property",s:"Setting"};Object.keys(t).forEach(e=>{let a=t[e];this["on"+a+"Update"]=this.treeApi.onUpdate.bind(this.treeApi,e),this["set"+a]=(t,a)=>this.treeApi.set(e+"/"+t,a),this["remove"+a]=t=>this.treeApi.remove(e+"/"+t)})}onLoad(e){this.treeApi.onLoad(t=>{e({properties:t.p,settings:t.s,authTokens:t.a,boards:t.b})},void 0)}getPathForSettings(){return`users/${this.uid}/s/`}deleteFully(){var e={[`/users/${this.uid}/a`]:null,[`/users/${this.uid}/b`]:null,[`/users/${this.uid}/s`]:null};return this.session.ref().update(e)}setProperties(e){return this.session.ref(`/users/${this.uid}/p`).update(e)}};var z,q=class{constructor(e){this.uid=e,this.docs={},this.db={firebase:O.a,session:O.a.database()},B.init(),this.onOnlineChange=B.onOnlineChange,this.serverTime=B.serverTime,this.generateId=B.generateId,this.user=new j(e),this.userDocuments=R({db:this.db,backend:B,path:`userdocuments/${e}`,encryptedFields:{s:!0}})}loadDocuments(e){this.userDocuments.onLoad(({responses:t})=>{e(t)})}onDocumentsUpdate(e){this.userDocuments.onUpdate(e)}document(e,t,a){if(!(e in this.docs)){try{s.default.PAssert(578,!t||!isNaN(t)&&t<Date.now(),"Date modified is not number: "+t)}catch(i){s.default.reportError(i)}const r=a||new V(e,this.uid,this.userDocuments),n=R({db:this.db,backend:B,path:`items/${e}`,orderBy:"d",startAt:t&&!isNaN(t)?t+1:void 0,extraModifiedPath:`documents/${e}/p/d`,encryptedFields:{t:!0}});this.docs[e]={info:r,items:n}}return this.docs[e]}addDocument(e,t){const a=e.id;let i=this.docs[a];if(!i){const i=new V(a,this.uid,this.userDocuments);return i.create(e,t).then(()=>this.document(a,void 0,i))}return Promise.resolve(i)}forgetDocument(e){const t=this.docs[e];return delete this.docs[e],t._callbacks={update:[],load:[],updateDebug:[],loadDebug:[]},!0}commitBatch(e){return this.db.session.ref().update(e)}},W=a(105),G=a(106),K=a(20),Y=a(13),X=a(31),Q=a(9),$=a(96),J=a(16),Z=a(56),ee=a(26);let te=(z=class extends W.a{constructor(){super(!1),this.documentsEncrypted={},this._isLoaded=!1,this.loadState=new Q.a(n.a.LoadState.Connecting)}init(e,t){if(this._seenLocal={},this._coalescedChanges={},this._itemsChangedQueue=[],this._isLoaded=!1,this.cbOnLoad=e,this.cbOnDocumentsChanged=t,this.savedDocInfo={},c.a.init(this,this.onLoadLocal),J.a.hasURLParam("invite")){let e=J.a.getURLParam("invite");K.a.onAuthed(async()=>{(await Z.a.acceptInvite(e)).error||J.a.removeURLParam("invite")})}}onLoadLocal(e,{documentsPending:t,itemsPending:a,settingsPending:i,boardsPending:r,isPreload:s}){e||(e=[]),e.forEach(e=>this.documents[e.id]=e),this.documentsPending=t,this.itemsPending=a,this.settingsPending=i,this.boardsPending=r,this.cbOnLoad&&this.cbOnLoad(e),s||(this.cbOnLoad=void 0,o.default.settings.userId.onHasValue(()=>{this.createStore()}))}onLoadRemoteDocuments(){this._isLoaded=!0,this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted),ee.a.ensureSelected(),o.default.settings.lastSync.set(Date.now())}createStore(){const e=new q(K.a.getUid());let t,a;this.api=e;let i=()=>{Object.keys(this.documents).forEach(e=>{if(!this.documentsPending[e]&&a.indexOfWithProperty("id",e)<0){this.documents[e].delete(!0),delete this.documents[e]}}),Promise.all(Object.keys(this.documentsPending).map(e=>{let t=this.documents[e];return t&&(!a||a.indexOfWithProperty("id",t.id)<0)?this.addDocument(t,!1):Promise.resolve()})).then(()=>{this.documentsPending={},c.a.beginBatch(),Promise.all(a.map(e=>this.loadDocumentData(d.a.documentInFlat(e)))).then(()=>{this.onLoadRemoteDocuments(),this.loadState.set(n.a.LoadState.Connected),c.a.commitBatch()})}).catch(e=>s.default.reportError(e))},r=()=>{t&&a&&i()};e.user.onLoad(e=>{let a=o.default.settings.getSettingAbbrev("userEncryptionSentinel"),i=e.settings;e.properties?(this.userProperties=d.a.userIn(e.properties),o.default.billingManager.loadUserProperties(this.userProperties),o.default.settings.userProperties.set(this.userProperties),this.userProperties.fname||this.userProperties.lname||this.onFirstSync()):this.onFirstSync(),this.checkUserEncryption(i&&i[a]&&i[a].v,()=>{this.loadState.set(n.a.LoadState.LoadingDocs),i&&this.onSettingsChange("Modified",i,!0,!0),this.settingsPending&&Object.keys(this.settingsPending).forEach(e=>{let t=o.default.settings.getValueFromAbbrev(e);void 0!==t&&this._setSettingRemote(e,t)});let a=e.boards;a&&this.onBoardsChange("Modified",a,!0),this.boardsPending&&Object.keys(this.boardsPending).forEach(e=>{let t=ee.a.getById(e);try{s.default.PAssert(301,t,"Pending board that does not exist")}catch(a){s.default.reportError(a)}t&&this._saveBoardRemote(t.getSaveInfo())}),t=!0;let l=e.authTokens;this.onAuthTokensChange("Added",l,!0),r(),o.default.settings.userEncryptionSentinel.listen(e=>{e?this.checkUserEncryption(e):o.default.settings.removeEncryptionKey(n.a.EncryptionKeys.UserPassword)})})}),e.user.onPropertyUpdate(({type:e,value:t},a)=>{if(a){"Removed"===e&&Object.keys(t).forEach(e=>t[e]=null);let a=d.a.userIn(t);o.default.billingManager.loadUserProperties(a)}}),e.user.onSettingUpdate(({type:e,value:t},a)=>{this.onSettingsChange(e,t,a,!1)}),e.user.onBoardUpdate(({type:e,value:t},a)=>{this.onBoardsChange(e,t,a)}),e.user.onAuthTokenUpdate(({type:e,value:t},a)=>{this.onAuthTokensChange(e,t,a)}),e.loadDocuments(e=>{a=e,r()}),e.onDocumentsUpdate(({responses:e},t)=>{c.a.beginBatch(),Promise.all(e.map(({type:e,value:t})=>{if("Removed"!==e)return this.loadDocumentData(d.a.documentInFlat(t));this.documents[t.id]&&(this.documents[t.id].delete(!0),delete this.documents[t.id])})).then(()=>{c.a.commitBatch(),this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted)}).catch(e=>s.default.reportError(e))}),e.onOnlineChange(e=>{this.updateOnlineStatus(e)}),this._isLoaded||(this._isLoaded=!0),this._runCoalescedChanges()}async onFirstSync(){let e=e=>{this.userProperties=e;let t={email:e.email,fname:e.given_name,lname:e.family_name,picture:e.picture,displayName:e.name};Z.a.setUserProperties(d.a.userOut(t))};if(K.a.userProfile)e(K.a.userProfile);else{let t=await K.a.getUser();X.a.getGoogleUserInfo(a=>{a?e({email:t.email,given_name:a.given_name,family_name:a.family_name,picture:t.photoURL,name:t.displayName}):o.default.settings.activeUser.set(void 0)})}}async loadSingleDocument(e){try{let a=await this.loadDocumentData(e);return this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted),a}catch(t){s.default.reportError(t)}}async loadDocumentData(e){let t,a=this.documents[e.id];if(a)t=a.dateModified.get();else if(e.encryptionSentinel&&!o.default.crypto.canDecryptSentinel(e.encryptionSentinel))return this.documentsEncrypted[e.id]=e,Promise.resolve(void 0);try{let r=this.api.document(e.id,t),n=await new Promise(t=>{let a,i;if(this.savedDocInfo[e.id])Object.assign(this.savedDocInfo[e.id].docProps,e),t(this.savedDocInfo[e.id]);else{let s=()=>{if(null===a)t(void 0);else if(a&&i){let r={docProps:a,docItemsEncrypted:i};this.savedDocInfo[e.id]=r,t(r)}},n=r.info;n.onLoad(t=>{t.id=e.id;let i=d.a.documentIn(t);a=i,s()},e=>{a=null,s()}),n.onUpdate(this.onDocInfoChange.bind(this,e)),n.onAclUpdate(this.onDocAclChange.bind(this,e));let o=r.items;o.onLoad(({responses:e})=>{i=e,s()}),o.onUpdate(this.onItemsChange.bind(this,e))}});if(n){let{docProps:i,docItemsEncrypted:r}=n,l=this.getEncryptionForDocument(i);if(!l)return e.encryptionSentinel=i.encryptionSentinel,this.documentsEncrypted[e.id]=e,Promise.resolve(void 0);let d=t||0,u=await Promise.all(r.map(e=>this.decryptItemIn(e,o.default.crypto,l))).then(e=>(e.forEach(e=>{e.docId=i.id,d=Math.max(d,e.dateModified)}),$.a.createItemHierarchy(e,c.a.getItemsMap()),a&&e.length>0&&this.resolveItemConflicts(a,e),e));if(a&&Object.keys(this.itemsPending).forEach(e=>{let t=c.a.getItemData(e),i=Y.a.getItem(e),r=this.itemsPending[e];if(t&&t.docId===a.id){try{s.default.PAssert(302,i||t.isArchived||t.isDeleted,"Pending update that has no parent")}catch(n){s.default.reportError(n)}if(i||t.isArchived||t.isDeleted){let i=Object.keys(r);if(i.length>0){let r={id:e};i.forEach(e=>{r[e]=t[e]}),this._saveItemRemote(a,r)}}}}),c.a.ensureMirror(u,!0,!1),i.dateModified=d,a)this.documentsPending[a.id]?(this._saveDocumentRemote(a),delete this.documentsPending[a.id]):a.onRemoteUpdate(i);else if(i.root){i.backing=this;let e=s.default.clone(i);e.rootData=this.getItemData(i.root),e.rootData&&(delete e.pendingSync,(a=h.a.fromData(e,this)).createVMLIs())}return a&&(this.documents[a.id]=a,delete this.documentsEncrypted[a.id],c.a.saveDocument(a)),a||console.log("Failed to find root item"),a}}catch(i){console.log(i),s.default.reportError(i)}}getItemData(e){let t=this._coalescedChanges[e],a=c.a.getItemData(e,!0);return t&&"Removed"!==t.type&&(a=Object.assign({},a,t.info)),a}getItemSaveData(e){return e.getFullSaveData()}importItem(e,t){e.getDocumentOwner(),e.parent();t.push(e),e.hasNote()&&this.importItem(e.getNote(),t),e.getItems().forEach((e,a)=>{e.index=""+a,this.importItem(e,t)}),this._seenLocal[e.id]=!0}onSettingsChange(e,t,a,i){let r=t;Object.keys(t).forEach(i=>{let n=t[i];a&&this.settingsPending[i]?(r===t&&(r=s.default.clone(t)),delete r[i],t[i]={v:o.default.settings.getValueFromAbbrev(i)}):delete this.settingsPending[i],n.v="Removed"===e?void 0:this.decodeValue(n.v)}),"Removed"===e&&c.a.deleteSettings(r),o.default.settings.load(t,i)}onBoardsChange(e,t,a){Object.keys(t).forEach(i=>{if(!a||!this.boardsPending[i]){t[i].id=i;let r=d.a.boardIn(t[i]);"Removed"===e?c.a.deleteBoard(i):c.a.saveBoard(r),a&&ee.a.onRemoteUpdate(e,r)}})}onAuthTokensChange(e,t,a){let i={};t&&"Removed"!==e&&Object.keys(t).forEach(e=>{let a=e.replace(/,/g,"."),r=t[e],o=r.s?r.s.split(" "):void 0,l={email:a,scopes:o?o.map(e=>n.a.GScopeArray[e]):void 0};try{s.default.PAssert(303,"Have an auth token without scopes")}catch(d){s.default.reportError(d)}i[a]=l}),X.a.loadWithTokens(i)}onDocAclChange(e,{type:t,value:a},i){let r=this.documents[e.id];r&&("Removed"===t&&Object.keys(a).forEach(e=>{a[e]=void 0}),r.onAclUpdate(a),c.a.saveDocument(r))}onDocInfoChange(e,{type:t,value:a},i){let r=this.documents[e.id];if(r)if("Removed"!==t){if(a){let{t:e,s:t}=a,i={text:e,encryptionSentinel:t};r&&(r.onRemoteUpdate(i),i.encryptionSentinel&&!r.canDecrypt()&&(this.documentsEncrypted[r.id]=r.getSaveInfo(),delete this.savedDocInfo[r.id],r.delete(!0),this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted),o.default.PaneManager.runForEachPane(e=>{e.document.get()===r&&e.setDocument(Y.a.getDefaultDocument())})),c.a.saveDocument(r))}}else 0}async _processItemsChange(){if(!this._isProcessingItemsChanged&&!this._pauseProcessingItemsChanged&&this._itemsChangedQueue.length>0){this._isProcessingItemsChanged=!0;let{docInfo:a,responses:i,isRemote:r}=this._itemsChangedQueue[0];this._itemsChangedQueue.splice(0,1);let n=[],l=this.documents[a.id];try{if(l){var e=0;let t=await Promise.all(i.map(e=>this.decryptItemIn(e.value,o.default.crypto,l.getBestEncryption()).then(t=>({type:e.type,value:t}))));r&&o.default.PaneUpdateBatcher.beginUpdateItems();let s=l.dateModified.get()||0;for(let i=0;i<t.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;let{type:o,value:l}=t[i],d=l;c.a.getItemData(l.id);s=Math.max(s,l.dateModified),r&&this.handleRemoteItemChange(this.documents[a.id],l.id,l),"Removed"===o?c.a.deleteItem(l):(d.docId=a.id,n.push(d))}r&&(o.default.PaneUpdateBatcher.commitUpdateItems(),c.a.ensureMirror(n,!0)),l&&(this._updateDocModified(l,s),c.a.saveDocument(l))}}catch(t){s.default.reportError(t)}this._isProcessingItemsChanged=!1,this._itemsChangedQueue.length>0&&this._processItemsChange()}}onItemsChange(e,{responses:t},a){(t=t.filter(({value:e})=>{let t=Object.keys(e).length;return void 0!==e.d&&t--,void 0!==e.id&&t--,t>0})).length>0&&(this._itemsChangedQueue.push({docInfo:e,responses:t,isRemote:a}),this._processItemsChange())}convertItemUndefineds(e,t){var a=this.getItemData(e.id);return Object.keys(t).forEach(i=>{void 0===t[i]&&(void 0===a[i]?delete t[i]:t[i]=this.getAPIForItem(e).props.remove)}),t}_coalesceChange(e,t,a,i){var r=this._coalescedChanges[t],s=!r;i.id||(i.id=t),r&&("Modified"===r.type?r.info=Object.assign(r.info,i):r.type),s&&(r=this._coalescedChanges[t]={id:t,time:Date.now(),doc:e,type:a,info:i}),this.isCoalescing?this.needsCoalesceAfterFinish=!0:this._timeoutCoalesce||(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0))}async _runCoalescedChanges(){this._timeoutCoalesce=void 0,this.needsCoalesceAfterFinish=!1,this.isCoalescing=!0;try{await this._runCoalescedChangesInside()}catch(e){s.default.reportError(e)}this.isCoalescing=!1,this.needsCoalesceAfterFinish&&!this._timeoutCoalesce&&(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0))}async _runCoalescedChangesInside(){if(this._isLoaded){let e=s.default.objectValues(this._coalescedChanges);if(e.length>0){let t=e.sort((e,t)=>e.time-t.time),a=[];t.forEach(e=>{let t=e.info,i=e.doc,r=Y.a.getItem(e.id);"Added"===e.type?this.importItem(r,a):"Modified"===e.type?r.isNote()&&!t.isDeleted?this.importItem(r,a):s.default.isEmpty(t)||this._saveItem(i,r,t):"Removed"===e.type&&this._saveItem(i,r,t)});let i=[],r=[],n={};a.map(e=>{if(!n[e.id]){n[e.id]=!0;let t=e.getFullSaveData(),{localChanges:a,remoteChanges:s}=this._prepDataSaveLocal(e,t);i.push(a),r.push({item:e,itemData:s})}}),this.checkItemsPending(),this._coalescedChanges={},await c.a.ensureMirror(i,!1),r.forEach(({item:e,itemData:t})=>{this._saveItemRemote(e._documentOwner,t)})}}}saveItem(e,t,a,i,r){s.default.isLocalChange(i)&&!s.default.isUndoRedoChange(i)&&this._coalesceChange(e,t.id,"Modified",a)}addItem(e,t){let a=this.getItemSaveData(t);this._coalesceChange(e,t.id,"Added",a)}deleteItem(e,t,a){this._coalesceChange(e,t.id,"Modified",{id:t.id,isDeleted:!0})}deleteItemRecursive(e,t){t.forEachChildRecursive(t=>{this._coalesceChange(e,t.id,"Modified",{id:t.id,isDeleted:!0})},!0,!0)}generateNewItemIDsRecursive(e){e.forEachChildRecursive(e=>{e.id=this.generateId(),Y.a.setItem(e)},!0,!0)}setNote(e,t,a,i,r){if(s.default.isLocalChange(r))if(a){let t=this.getItemSaveData(a);this._coalesceChange(e,a.id,"Modified",t)}else i&&this._coalesceChange(e,i.id,"Modified",{id:i.id,isDeleted:!0})}moveItem(e,t){let a=e.parent(),i=e.index,r=e.getDocumentOwner(),s=t.getDocumentOwner();r===s?this._coalesceChange(r,e.id,"Modified",{id:e.id,parent:a.id,index:i}):(this.deleteItemRecursive(s,e),this.generateNewItemIDsRecursive(e),this.addItem(r,e))}_prepDataSaveLocal(e,t){t.parent&&s.default.isVMLI(t.parent)&&(t.parent=t.parent.id);let a=s.default.extend({id:e.id},t),i=c.a.getItemData(e.id)||{},r=i.pendingSync||{};Object.keys(t).forEach(e=>{"id"!==e&&"dateModified"!==e&&void 0===r[e]&&(r[e]=i[e])});let n=Object.assign({pendingSync:r},a);return this.itemsPending[e.id]=Object.assign(this.itemsPending[e.id]||{},r),{localChanges:n,remoteChanges:a}}_saveItem(e,t,a){let{localChanges:i,remoteChanges:r}=this._prepDataSaveLocal(t,a);c.a.saveItem(i,t),e.needsSave||this._saveItemRemote(e,this.convertItemUndefineds(t,r)),this.checkItemsPending()}async _saveItemRemote(e,t){if(this.api){let a=await this.encryptItemForSaveRemote(e,t);if(d.a.validateOutFields(a,!0)){0;let i=await this.getAPIForDocumentItems(e).update(a);return i&&(delete this.itemsPending[t.id],this.checkItemsPending(),c.a.saveItem({id:t.id,pendingSync:void 0})),i}}}generateId(){return O.a.database().ref().push().key}addDocument(e,t){let a=e.getSaveInfo(),i=e.getRootItem(),r=this.getItemSaveDataRecursive(i);if(!1!==t&&(this.documents[e.id]=e,a.pendingSync=Date.now(),c.a.saveDocument(e),c.a.ensureMirror(r,!0)),this.documentsPending&&(this.documentsPending[e.id]=e),this.api){let t=d.a.documentOut(a);return Promise.all(r.map(t=>this.encryptItemForSaveRemote(e,t))).then(e=>{this.api.addDocument(t,e).then(e=>{e.items.onLoad(s.default.emptyFn),e.items.onUpdate(this.onItemsChange.bind(this,a)),e.info.onLoad(s.default.emptyFn),e.info.onUpdate(this.onDocInfoChange.bind(this,a)),e.info.onAclUpdate(this.onDocAclChange.bind(this,a))})}).catch(e=>s.default.reportError(e))}return Promise.resolve()}async encryptItemForSaveRemote(e,t){return t.dateModified=this.api.serverTime,delete t.pendingSync,delete t.docId,d.a.encryptItemOut(t,o.default.crypto,e.getBestEncryption())}saveDocument(e){this.documentsPending[e.id]=!0,c.a.saveDocument(e,{pendingSync:Date.now()}),this._saveDocumentRemote(e)}_saveDocumentRemote(e){let t=e.getSaveInfo();delete t.dateModified;let a=d.a.documentOut(t,{onlyUpdate:!0});d.a.validateOutFields(a,!0)&&this.getAPIForDocument(e).update(a,!0)}getItemSaveDataRecursive(e,t){let a=!t;return t||(t=[]),t.push(e),e.hasNote()&&t.push(e.getNote()),e.hasChildren()&&e.getItems().forEach(e=>{this.getItemSaveDataRecursive(e,t)}),a&&(t=t.map(e=>this.getItemSaveData(e))),t}encodeValue(e){return s.default.isObject(e)||s.default.isArray(e)?JSON.stringify(e):e}decodeValue(e){if(e.length>1&&("{"===e[0]||"["===e[0]))try{e=JSON.parse(e)}catch{0}return e}getSetting(e){return c.a.getSetting(e)}setSetting(e,t){let a=Date.now();c.a.setSetting(e,{pendingSync:a,v:t}),this._setSettingRemote(e,t)}_setSettingRemote(e,t){if(this.api){let a;if(void 0===t||null===t)a=this.api.user.removeSetting(e);else{t=this.encodeValue(t),this.settingsPending[e]=!0;let i={v:t,d:this.api.serverTime};a=this.api.user.setSetting(e,i)}a.then(t=>{if(t){delete this.settingsPending[e];let t=c.a.getSetting(e);delete t.pendingSync,c.a.setSetting(e,t)}})}}saveBoard(e){let t=Date.now(),a=Object.assign({pendingSync:t},e);c.a.saveBoard(a),this._saveBoardRemote(e)}_saveBoardRemote(e){if(this.api){let t=s.default.cloneDeep(e);delete t.id,delete t.pendingSync,this.boardsPending[e.id]=!0;let a=d.a.boardOut(t);a.d=this.api.serverTime,this.api.user.setBoard(e.id,a).then(t=>{if(t){delete this.boardsPending[e.id];let t=c.a.getBoard(e.id);delete t.pendingSync,c.a.saveBoard(t)}})}}deleteBoard(e){c.a.deleteBoard(e),this.api&&this.api.user.removeBoard(e)}getBoards(){return c.a.getBoards()}deleteAuthToken(e){this.api&&(e=e.replace(/\./g,","),this.api.user.removeAuthToken(e))}getAPIForDocument(e){return this.api.document(e.id).info}getAPIForDocumentItems(e){return this.api.document(e.id).items}getAPIForItem(e){return this.getAPIForDocumentItems(e.getDocumentOwner())}async clearAllData(){try{return await c.a.clearAllData(),await Promise.all(Object.keys(this.documents).map(e=>{return this.documents[e].isAdmin()?this.getAPIForDocument({id:e}).deleteFully():Promise.resolve()})),this.api.user.deleteFully()}catch(e){s.default.reportError(e)}}deleteDocument(e,t){c.a.deleteDocument(e),t?this.getAPIForDocument(e).unlisten():this.getAPIForDocument(e).deleteFully(),this.api.forgetDocument(e.id),delete this.documents[e.id]}unlistenDocument(e){this.getAPIForDocument(e).unlisten(),this.api.forgetDocument(e.id),delete this.documents[e.id]}updateOnlineStatus(e){let t=Y.a.onlineStatus,a=t.get();e||"Connecting"!==a?(s.default.clearTimeoutOnce("initialOffline"),t.set(e?"Online":"Offline")):K.a.isOnline()?s.default.timeoutOnce("initialOffline",()=>t.set("Offline"),2e3):t.set("Offline")}resolveItemConflicts(e,t){o.default.PaneUpdateBatcher.beginUpdateItems();let a=e.dateModified.get()||0;t.forEach(t=>{let i=this.itemsPending[t.id],r=Y.a.getItem(t.id),n=this.getItemData(t.id);i&&(Object.keys(i).forEach(a=>{let s=n[a],o=t[a];if(o===i[a]||o===s)s===o&&delete i[a],delete t[a];else if("text"!==a||t.isDeleted)delete t[a];else{let n=`Sync Conflict: ${o}  ;  ${s}`;i[a]=t.text,this.handleRemoteItemChange(e,r.id,{text:n}),c.a.saveItem({id:r.id,text:n},r),delete t[a]}}),t.isDeleted&&(t.isDeleted=!1,i.isDeleted=!0,this.handleRemoteItemChange(e,t.id,t),r||(r=Y.a.getItem(t.id)),r&&c.a.saveItem({id:r.id,isDeleted:!1},r))),a=Math.max(a,t.dateModified);let o=t.id;s.default.isEmpty(t)||this.handleRemoteItemChange(e,o,t)}),this._updateDocModified(e,a),o.default.PaneUpdateBatcher.commitUpdateItems()}handleRemoteItemChange(e,t,a){let i,r,s=this.getItemData(t);s?(r={id:t},Object.keys(a).forEach(e=>{s[e]!==a[e]&&("dateModified"!==e&&"id"!==e&&(i=!0),r[e]=a[e])}),Object.keys(s).forEach(e=>{"items"!==e&&e in a&&void 0!==s[e]&&void 0===a[e]&&(r[e]=void 0,i=!0)})):(i=!0,r=a),i&&G.a.onRemoteChange(e,s,t,r)}getEncryptionForDocument(e){return e.encryptionSentinel?o.default.crypto.getKeyBySentinel(e.encryptionSentinel):e.acl&&Object.keys(e.acl).length>1?o.default.crypto.getGlobalKey():o.default.crypto.getKey(o.default.settings.getBestUserEncryption())}_getItemWithText(e){return{id:e.id,text:e.getRawText()}}checkUserEncryption(e,t){if(e){const a=()=>{this.loadState.set(n.a.LoadState.NeedPassword),this._pauseProcessingItemsChanged=!0,o.default.menus.openModal(n.a.Modals.EnterCode,{noCancel:!0,isPassword:!0,text:"Please enter your encryption password to unlock your data.",onSelect:a=>new Promise((i,r)=>{a&&o.default.crypto.setKey({name:n.a.EncryptionKeys.UserPassword,password:a,sentinelSalt:K.a.getEncryptionUid()}).then(a=>{e===a.sentinel?(o.default.settings.addEncryptionKey(n.a.EncryptionKeys.UserPassword,a.key),t&&t(),i(),this._pauseProcessingItemsChanged=!1,this._processItemsChange()):(o.default.crypto.removeKey(n.a.EncryptionKeys.UserPassword),r("The password was invalid. Please try again."))}).catch(e=>s.default.reportError(e))})})};let i=o.default.settings.getEncryptionKey(n.a.EncryptionKeys.UserPassword);i?o.default.crypto.decryptText(i,e,K.a.getEncryptionUid()).then(e=>{e===n.a.EncryptionSentinel?t&&t():a()}):a()}else t&&t()}_encryptDocumentItems(e,t,a){let i=this.getAPIForDocumentItems(t);return Promise.all(t.getAllItems().map(t=>{let r={id:t.id,text:t.getRawText()};return new Promise(t=>{d.a.encryptItemOut(r,o.default.crypto,a.key).then(a=>{if(d.a.validateOutFields(a,!0)){let r=i.getPathForItem(a,e);e[r+"t"]=a.t,t()}})})}))}updateDocumentEncryption(e,t){let a,i={};return t&&t!==o.default.crypto.getKeyInfo(n.a.EncryptionKeys.Global)?(a=Object.assign({},o.default.settings.encryptionKeys.get()))[e.id]=t.key:t=o.default.crypto.getKeyInfo(n.a.EncryptionKeys.Global),i[`documents/${e.id}/p/s`]=t.sentinel,i[`userdocuments/${K.a.getUid()}/${e.id}/s`]=t.sentinel,this._encryptDocumentItems(i,e,t).then(()=>this.api.commitBatch(i).then(()=>{a&&(e.encryptionSentinel.set(t.sentinel),o.default.settings.encryptionKeys.set(s.default.clone(a)))}).catch(e=>s.default.reportError(e))).catch(e=>s.default.reportError(e))}updateUserEncryption(e){if(this.api){let t,a={},i=Object.assign({},o.default.settings.encryptionKeys.get());e!==o.default.crypto.getGlobalKeyInfo()?(t=e.sentinel,i[e.name]=e.key):(t=null,delete i[n.a.EncryptionKeys.UserPassword]);let r=o.default.settings.getSettingAbbrev("userEncryptionSentinel");return a[this.api.user.getPathForSettings()+r]={v:t},Promise.all(Object.keys(this.documents).filter(e=>!this.documents[e].encryptionSentinel.get()&&!this.documents[e].isShared()).map(t=>this._encryptDocumentItems(a,this.documents[t],e))).then(()=>this.api.commitBatch(a).then(()=>{o.default.settings.encryptionKeys.set(i),null===t&&o.default.crypto.removeKey(n.a.EncryptionKeys.UserPassword)})).catch(e=>s.default.reportError(e))}}_checkItemsPendingTimeout(){let e={};Object.keys(this.itemsPending).forEach(t=>{let a=c.a.getItemData(t).docId;a&&(e[a]=!0)}),Object.keys(this.documents).forEach(t=>{this.documents[t].isSyncing.set(!!e[t])})}checkItemsPending(){s.default.timeoutOnce("checkItemsPending",this._checkItemsPendingTimeout,100)}decryptItemIn(e,t,a){return d.a.decryptItemIn(e,t,a)}_updateDocModified(e,t){e.updateModified(t)&&c.a.saveDocument(e)}},r()(z.prototype,"onLoadLocal",[l.a],Object.getOwnPropertyDescriptor(z.prototype,"onLoadLocal"),z.prototype),r()(z.prototype,"onLoadRemoteDocuments",[l.a],Object.getOwnPropertyDescriptor(z.prototype,"onLoadRemoteDocuments"),z.prototype),r()(z.prototype,"_runCoalescedChanges",[l.a],Object.getOwnPropertyDescriptor(z.prototype,"_runCoalescedChanges"),z.prototype),r()(z.prototype,"clearAllData",[l.a],Object.getOwnPropertyDescriptor(z.prototype,"clearAllData"),z.prototype),r()(z.prototype,"_checkItemsPendingTimeout",[l.a],Object.getOwnPropertyDescriptor(z.prototype,"_checkItemsPendingTimeout"),z.prototype),z);t.a=new te},55:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(27),o=a(41),l=a(0),d=a(1),h=a(3),c=a(9),u=a(147),p=a(109),g=a(20),f=a(54),m=a(8),v=a(13),y=a(56);let _=(i=class e{constructor({id:e,text:t,dateModified:a,rootData:i,acl:r,backing:s,encryptionSentinel:n,backups:o}){try{l.default.PAssert(147,e,"Document must have id")}catch(d){l.default.reportError(d)}try{l.default.PAssert(148,r,"Document must have acl")}catch(d){l.default.reportError(d)}try{l.default.PAssert(149,i&&i.isRoot,"Document must have root item set to root")}catch(d){l.default.reportError(d)}i&&!i.isRoot&&(i.isRoot=!0),this.id=e,this.text=new c.a(t),this.contentPreview=new c.a(""),this._root=i,this._backing=s,this._isLocalOnly=s.isLocalOnly,this.isSyncing=new c.a(!1),this.acl=new c.a(r),this.dateModified=new c.a(a),this.encryptionSentinel=new c.a(n),this.isDecrypted=this.canDecrypt(),this.backups=new c.a(o),i.archivedItems&&(this._archivedItemsData=i.archivedItems,delete i.archivedItems),i.deletedItems&&(this._deletedItemsData=i.deletedItems,delete i.deletedItems)}static create({id:t,text:a,rootData:i,backing:r}){return new e({id:t||v.a.generateID(),rootData:i,text:a,acl:{[g.a.getUid()]:{r:d.a.DocumentAccessRoles.Admin,e:g.a.getDefaultAccountID(),t:g.a.getAccountName()}},dateModified:Date.now(),backing:r||f.a,encryptionSentinel:void 0})}static fromData(t,a){let i={};return Object.keys(t.acl).forEach(e=>{let a=t.acl[e];i[e]=l.default.isNumber(a)?{r:a,t:g.a.getAccountName(),e:g.a.getDefaultAccountID()}:a}),new e({id:t.id,rootData:t.rootData,text:t.text,acl:i,dateModified:t.dateModified,backing:a,encryptionSentinel:t.encryptionSentinel})}createVMLIs(e){if(!this._rootItem||e){let t=h.default.itemStoreManager.getDefaultItemStore();e?e.items&&(h.default.PaneUpdateBatcher.beginUpdateItems(),this._rootItem.setItems(e.items),h.default.PaneUpdateBatcher.commitUpdateItems()):(this._rootItem=t.createItemRaw(this._root,{documentOwner:this,changeType:d.a.ChangeType.Auto,isRoot:!0}),t.addItemToRoot(this._rootItem)),this._rootItem.items.listen(this.updatePreviewTextListener),this.updatePreviewTextListener()}}_ensureRootItem(e,t){e||(this[`_root${t}Item`]=h.default.itemStoreManager.getDefaultItemStore().createItemRaw({id:void 0,text:`${t} Root`},{documentOwner:this,changeType:d.a.ChangeType.Auto,isRoot:!0}))}ensureRootArchivedItem(){this._ensureRootItem(this._rootArchivedItem,"Archived")}ensureRootDeletedItem(){this._ensureRootItem(this._rootDeletedItem,"Deleted")}_ensureHelper(e,t,a,i){if(e(),this[t]){let e=this[t];delete this[t];let r=this[a];o.a.beginBatch(r),e.forEach(i),o.a.commitBatch(r)}}ensureArchivedItems(){this._ensureHelper(this.ensureRootArchivedItem,"_archivedItemsData","_rootArchivedItem",this.createArchivedVMLI)}ensureDeletedItems(){this._ensureHelper(this.ensureRootDeletedItem,"_deletedItemsData","_rootDeletedItem",this.createDeletedVMLI)}_createVMLI(e,t,a){!t.isNote&&(t.text||("Deleted"===a?t.deletedItems:t.archivedItems))&&e.items.push(h.default.itemStoreManager.getDefaultItemStore().createItemRaw(t,{parent:e,documentOwner:this,changeType:d.a.ChangeType.Auto}))}createArchivedVMLI(e){this._createVMLI(this._rootArchivedItem,e,"Archived")}createDeletedVMLI(e){this._createVMLI(this._rootDeletedItem,e,"Deleted")}_archiveDeleteHelper(e,t,a,i,r,s,n){let o=e.parent();if(!n&&!o[a]()){o.items.remove(e),i(),this[r].items.push(e)}s(e,!0,t)}archiveItem(e,t,a){this._archiveDeleteHelper(e,t,"isArchived",this.ensureRootArchivedItem,"_rootArchivedItem",this.propagateArchive,a)}_unActionHelper(e,t,a,i,r){let s=e.parent(),o=s&&!s[a]()&&s!==i?s:this._rootItem;s&&s!==o&&s.items.indexOf(e)>=0&&s.items.remove(e),i.items.remove(e),e.setParent(o),o.items.includes(e)||o.items.insertSorted(e,n.a.compareItemIndex),r(e,!1,t)}_propagateHelper(e,t,a,i,r,s){e[i](t,a);let n={id:e.id,[r]:t};v.a.saveItem(e,n,a,d.a.SaveFlag.All),s&&e.items.get()&&e.items.get().forEach(e=>this._propagateHelper(e,t,a,i,r,s))}unArchiveItem(e,t){this._unActionHelper(e,t,"isArchived",this._rootArchivedItem,this.propagateArchive)}propagateArchive(e,t,a){this._propagateHelper(e,t,a,"setArchived","isArchived",!0)}deleteItem(e,t,a){this._archiveDeleteHelper(e,t,"isDeleted",this.ensureRootDeletedItem,"_rootDeletedItem",this.propagateDelete,a)}unDeleteItem(e,t){this._unActionHelper(e,t,"isDeleted",this._rootDeletedItem,this.propagateDelete)}propagateDelete(e,t,a){this._propagateHelper(e,t,a,"setDeleted","isDeleted",!t)}getRootData(){return this._root}getRootItem(){return this._rootItem}getRootArchivedItem(){return this.ensureArchivedItems(),this._rootArchivedItem}getRootDeletedItem(){return this.ensureDeletedItems(),this._rootDeletedItem}getBacking(){return this._backing}getSaveInfo(e,t){let a={id:this.id,version:1,root:this._root.id,text:this.text.get(),dateModified:this.dateModified.get()||Date.now()};return e||(a.acl=this.acl.get()),t||(a.encryptionSentinel=this.encryptionSentinel.get()),a}setText(e,t){let a=this.text.get();this.text.set(e,t),this._isLocalOnly&&this.getBacking().renameDocument(this,a)}static comparatorModified(e,t){return t.dateModified.get()-e.dateModified.get()}static comparatorAlpha(e,t){return e.text.get().localeCompare(t.text.get())}static getCompareFn(e){return e===d.a.DocumentSortMode.Alphabetical&&this.comparatorAlpha||e===d.a.DocumentSortMode.Modified&&this.comparatorModified}onRemoteUpdate(e){e.date,void 0!==e.backups&&this.backups.set(e.backups),void 0!==e.text&&this.setText(e.text),void 0!==e.acl&&this.onAclUpdate(e.acl),void 0!==e.encryptionSentinel&&this.encryptionSentinel.set(e.encryptionSentinel)}getBestEncryptionInfo(){let e=h.default.crypto.getGlobalKeyInfo();return this.encryptionSentinel.get()?e.sentinel===this.encryptionSentinel.get()?e:h.default.crypto.getKeyInfo(this.id):this.isShared()?e:h.default.crypto.getKeyInfo(h.default.settings.getBestUserEncryption())}getBestEncryption(){return this.getBestEncryptionInfo().key}async toJSON(e){let t=this.getRootItem(),a=this.getBestEncryptionInfo();e.encryptionKey=a.key;let i=await u.a.getItemsData(t,e),r={moodoVer:h.default.settings.localDataVersion.get(),doc:this.getSaveInfo(!0,!e.encrypt),items:i};return e.encrypt&&(r.sentinel=a.sentinel),JSON.stringify(r,null,2)}delete(e){let t=()=>{let t=this.getCollaborators();!e&&t&&t.length>0?this.shareWithUser(this.getCollaborators().map(e=>e.email),null).then(()=>{v.a.deleteDocument(this,e)}):v.a.deleteDocument(this,e);let a=h.default.itemStoreManager.getDefaultItemStore();a.removeItemFromRoot(this._rootItem),this.getAllItems().forEach(e=>a.removeItemFromStore(e.id)),h.default.PaneManager.runForEachPane(e=>{e.document.get()===this&&e.setDocument(v.a.getDefaultDocument())})};!e&&!this._isLocalOnly&&this.getAllItems().length>1?p.a.backupDocumentAll(this).then(()=>{t()}):t()}getAllItems(){let e=[],t=this._rootItem;return this._getAllItems(e,t),e}_getAllItems(e,t){var a=0;e.push(t),t.hasNote()&&e.push(t.getNote());let i=t.items.get();for(var r=0;r<i.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._getAllItems(e,i[r])}}updateModified(e){let t=e>this.dateModified.get();if(t){this.dateModified.set(e);let t=h.default.settings.lastSync;(!t.get()||e>t.get())&&t.set(e)}return t}updatePreviewTextListener(){let e=this._rootItem.getFirstChild();e!==this._firstChild&&(this._firstChild&&this._firstChild.itemChanged.unlisten(this.onFirstItemChanged),this._firstChild=e,e&&(this._firstChild.itemChanged.listen(this.onFirstItemChanged),this.onFirstItemChanged()))}onFirstItemChanged(){let e=this._firstChild.getParsedText();e!==this.contentPreview.get()&&this.contentPreview.set(e)}isShared(){return Object.keys(this.acl.get()).length>1}isAdmin(){if(this._isLocalOnly)return!0;let e=this.acl.get()[g.a.getUid()];return e&&e.r===d.a.DocumentAccessRoles.Admin}getCollaborators(){let e=this.acl.get();return Object.keys(e).filter(e=>e!==g.a.getEncryptionUid()).map(t=>({uid:t,name:e[t].t,email:e[t].e,role:e[t].r}))}shareWithUser(e,t){return y.a.shareDocument({docID:this.id,docName:this.text.get(),encryptionSentinel:this.encryptionSentinel.get(),emails:e,accessRole:t})}onAclUpdate(e){let t=l.default.clone(this.acl.get());Object.keys(e).forEach(a=>{e[a]?t[a]=e[a]:delete t[a]}),this.acl.set(t)}canDecrypt(){let e=this.encryptionSentinel.get();return this.isDecrypted=!e||h.default.crypto.canDecryptSentinel(e),this.isDecrypted}addBackup(e){this.backups.get()?this.backups.get()[e]="":this.backups.set({[e]:""})}getLastBackup(){let e=this.backups.get();if(e){let t=Object.keys(e).sort();return+t[t.length-1]}return 0}getLastBackupDrive(){let e=h.default.settings.backupsDrive.get();return e&&e[this.id]||0}isLocalOnly(){return this._isLocalOnly}parseAll(e){l.default.parseSubtree(this.getRootItem(),e)}},s()(i.prototype,"ensureRootArchivedItem",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"ensureRootArchivedItem"),i.prototype),s()(i.prototype,"ensureRootDeletedItem",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"ensureRootDeletedItem"),i.prototype),s()(i.prototype,"createArchivedVMLI",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"createArchivedVMLI"),i.prototype),s()(i.prototype,"createDeletedVMLI",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"createDeletedVMLI"),i.prototype),s()(i.prototype,"propagateArchive",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"propagateArchive"),i.prototype),s()(i.prototype,"propagateDelete",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"propagateDelete"),i.prototype),s()(i.prototype,"updatePreviewTextListener",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"updatePreviewTextListener"),i.prototype),s()(i.prototype,"onFirstItemChanged",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"onFirstItemChanged"),i.prototype),i);t.a=_},56:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(20);a(16);t.a=new class{constructor(){this.url=r.a.CloudFunctionsURL}async run(e,{query:t,body:a}={}){let i=await this.createURL(e,t);if(i){let e=a?{method:"POST",body:JSON.stringify(a)}:void 0,t=await fetch(i,e);if(200===t.status)return{value:await t.json(),errorCode:void 0,error:void 0};{let e=await t.json();return{value:void 0,errorCode:e.errorCode||e.status,error:e.message,braintreeErrorCode:e.braintreeErrorCode}}}return{value:void 0,errorCode:r.a.PrivateAPIErrorCodes.MissingIDToken,error:"User does not have a valid id_token"}}async createURL(e,t={}){let a=await s.a.getUser(),r=await a.getIdToken();try{i.default.PAssert(304,r,"User does not have a valid id_token")}catch(d){i.default.reportError(d)}if(r){t.id_token=r;var n=this.url+e+"?",o=[];for(var l in t)t.hasOwnProperty(l)&&t[l]&&o.push(l+"="+encodeURIComponent(t[l]));return n+o.join("&")}}getAccessToken(e){return this.run("auth/getAccessToken",{query:{email:e}})}sendFeedback(e){return this.run("user/sendFeedback",{body:e})}setUserProperties(e){return this.run("user/setUserProperties",{body:e})}shareDocument(e){return this.run("sharing/shareDocument",{body:e})}listTransactions(){return this.run("billing/listTransactions")}getBillingToken(){return this.run("billing/getBillingToken")}purchasePlan(e){return this.run("billing/purchasePlan",{body:e})}updatePlan(e){return this.run("billing/updatePlan",{body:e})}startTrial(){return this.run("billing/startTrial")}cancelPremium(){return this.run("billing/cancelPremium")}deleteAccount(){return this.run("user/deleteAccount")}acceptInvite(e){return this.run("sharing/acceptInvite",{body:{token:e}})}todoistImport(e){return this.run("oauth/todoist",{body:{code:e}})}}},564:function(e,t,a){var i={"./af":209,"./af.js":209,"./ar":210,"./ar-dz":211,"./ar-dz.js":211,"./ar-kw":212,"./ar-kw.js":212,"./ar-ly":213,"./ar-ly.js":213,"./ar-ma":214,"./ar-ma.js":214,"./ar-sa":215,"./ar-sa.js":215,"./ar-tn":216,"./ar-tn.js":216,"./ar.js":210,"./az":217,"./az.js":217,"./be":218,"./be.js":218,"./bg":219,"./bg.js":219,"./bm":220,"./bm.js":220,"./bn":221,"./bn.js":221,"./bo":222,"./bo.js":222,"./br":223,"./br.js":223,"./bs":224,"./bs.js":224,"./ca":225,"./ca.js":225,"./cs":226,"./cs.js":226,"./cv":227,"./cv.js":227,"./cy":228,"./cy.js":228,"./da":229,"./da.js":229,"./de":230,"./de-at":231,"./de-at.js":231,"./de-ch":232,"./de-ch.js":232,"./de.js":230,"./dv":233,"./dv.js":233,"./el":234,"./el.js":234,"./en-au":235,"./en-au.js":235,"./en-ca":236,"./en-ca.js":236,"./en-gb":237,"./en-gb.js":237,"./en-ie":238,"./en-ie.js":238,"./en-il":239,"./en-il.js":239,"./en-nz":240,"./en-nz.js":240,"./eo":241,"./eo.js":241,"./es":242,"./es-do":243,"./es-do.js":243,"./es-us":244,"./es-us.js":244,"./es.js":242,"./et":245,"./et.js":245,"./eu":246,"./eu.js":246,"./fa":247,"./fa.js":247,"./fi":248,"./fi.js":248,"./fo":249,"./fo.js":249,"./fr":165,"./fr-ca":250,"./fr-ca.js":250,"./fr-ch":251,"./fr-ch.js":251,"./fr.js":165,"./fy":252,"./fy.js":252,"./gd":253,"./gd.js":253,"./gl":254,"./gl.js":254,"./gom-latn":255,"./gom-latn.js":255,"./gu":256,"./gu.js":256,"./he":257,"./he.js":257,"./hi":258,"./hi.js":258,"./hr":259,"./hr.js":259,"./hu":260,"./hu.js":260,"./hy-am":261,"./hy-am.js":261,"./id":262,"./id.js":262,"./is":263,"./is.js":263,"./it":264,"./it.js":264,"./ja":265,"./ja.js":265,"./jv":266,"./jv.js":266,"./ka":267,"./ka.js":267,"./kk":268,"./kk.js":268,"./km":269,"./km.js":269,"./kn":270,"./kn.js":270,"./ko":271,"./ko.js":271,"./ky":272,"./ky.js":272,"./lb":273,"./lb.js":273,"./lo":274,"./lo.js":274,"./lt":275,"./lt.js":275,"./lv":276,"./lv.js":276,"./me":277,"./me.js":277,"./mi":278,"./mi.js":278,"./mk":279,"./mk.js":279,"./ml":280,"./ml.js":280,"./mr":281,"./mr.js":281,"./ms":282,"./ms-my":283,"./ms-my.js":283,"./ms.js":282,"./mt":284,"./mt.js":284,"./my":285,"./my.js":285,"./nb":286,"./nb.js":286,"./ne":287,"./ne.js":287,"./nl":288,"./nl-be":289,"./nl-be.js":289,"./nl.js":288,"./nn":290,"./nn.js":290,"./pa-in":291,"./pa-in.js":291,"./pl":292,"./pl.js":292,"./pt":293,"./pt-br":294,"./pt-br.js":294,"./pt.js":293,"./ro":295,"./ro.js":295,"./ru":296,"./ru.js":296,"./sd":297,"./sd.js":297,"./se":298,"./se.js":298,"./si":299,"./si.js":299,"./sk":300,"./sk.js":300,"./sl":301,"./sl.js":301,"./sq":302,"./sq.js":302,"./sr":303,"./sr-cyrl":304,"./sr-cyrl.js":304,"./sr.js":303,"./ss":305,"./ss.js":305,"./sv":306,"./sv.js":306,"./sw":307,"./sw.js":307,"./ta":308,"./ta.js":308,"./te":309,"./te.js":309,"./tet":310,"./tet.js":310,"./tg":311,"./tg.js":311,"./th":312,"./th.js":312,"./tl-ph":313,"./tl-ph.js":313,"./tlh":314,"./tlh.js":314,"./tr":315,"./tr.js":315,"./tzl":316,"./tzl.js":316,"./tzm":317,"./tzm-latn":318,"./tzm-latn.js":318,"./tzm.js":317,"./ug-cn":319,"./ug-cn.js":319,"./uk":320,"./uk.js":320,"./ur":321,"./ur.js":321,"./uz":322,"./uz-latn":323,"./uz-latn.js":323,"./uz.js":322,"./vi":324,"./vi.js":324,"./x-pseudo":325,"./x-pseudo.js":325,"./yo":326,"./yo.js":326,"./zh-cn":327,"./zh-cn.js":327,"./zh-hk":328,"./zh-hk.js":328,"./zh-tw":329,"./zh-tw.js":329};function r(e){var t=s(e);return a(t)}function s(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=s,e.exports=r,r.id=564},6:function(e,t,a){"use strict";a.d(t,"b",function(){return l}),a.d(t,"a",function(){return d}),a.d(t,"c",function(){return h});var i=a(0),r=a(3),s=a(1),n=a(16),o=a(13);const l={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11,Mobile:12},d={ToggleOverview:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,OpenDocumentsMenu:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19,AddToGCal:20,OpenEmail:21,ComposeEmail:22,DriveUpload:23,OpenDisplaySettings:24,DragItem:25,OpenAddPaneMenu:26,SetPrefix:27,OpenCalendarsMenu:28,OpenHelp:29},h={AddPane:1,RemovePane:2,SwitchPaneMode:3,OpenSettingsMenu:4,AddBoard:5,OpenDisplaySettings:6};function c(){this.disabled=!1,this.allowOfflineUndo=!1,this.cursor=-1,this.groupID=0,this.groups=[],this.externalUndoRedo=!1,this.undoRedoActive=!1,this.canRedo=!1,this.canUndo=!1,this._performingActions=!1,this._currentAction=[],this._actionsPreventUndo=!1,this._aggregateActions=0,this._externalStateChanged=[],n.a.binder(this,"stateChangeForUndoRedo"),this.init()}function u(e){let t=e[0],a=o.a.getItem(t.oldItemID),r=i.default.focusedPane;try{i.default.PAssert(406,a,"Expected model to exist: ",t)}catch(s){i.default.reportError(s)}if(t.zoomIn)r.zoomOut(a);else if(t.zoomOut)r.zoomIn(a);else try{i.default.PAssert(407,!1,"Zoom action must define either zoomIn or zoomOut")}catch(s){i.default.reportError(s)}}function p(e){let t=e[0],a=o.a.getItem(t.itemID),r=i.default.focusedPane;try{i.default.PAssert(408,a,"Expected model to exist: ",t)}catch(s){i.default.reportError(s)}if(t.zoomIn)r.zoomOut(a);else if(t.zoomOut)r.zoomIn(a);else try{i.default.PAssert(409,!1,"Zoom action must define either zoomIn or zoomOut")}catch(s){i.default.reportError(s)}}function g(e){switch(e[0].type){case h.RemovePane:case h.SwitchPaneMode:break;default:try{i.default.PAssert(410,!1,"Invalid UIAction")}catch(t){i.default.reportError(t)}}}function f(e){}c.prototype={init:function(){this.listeners=[]},addListener:function(e){this.listeners.push(e)},removeListener:function(e){this.listeners.remove(e)},_getNextGroupID:function(){return this.groupID+1},_useNextGroupID:function(){return++this.groupID},_getCurrentGroup:function(){return this.groups[this.cursor]},_getCurrentAction:function(){return this.groups[this.cursor].events[this.groups[this.cursor].events.length-1]},_pushGroup:function(){var e=this._useNextGroupID();return this.groups.push({id:e,events:[],persisted:!1}),this.cursor<74&&this.cursor++,this.groups.length>75&&this._handleGroupTrimmed(this.groups.shift()),e},_doAction:function(e,t){var a=this._getCurrentGroup();try{i.default.PAssert(411,a,"Expected group to exist")}catch(s){i.default.reportError(s)}var r={type:e,data:t};switch(e){case l.Zoom:r.cb={undo:u,redo:p};break;case l.UIAction:r.cb={undo:g,redo:f}}a.events.push(r)},_handleGroupTrimmed:function(e){for(var t=0,a=0;a<e.events.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e.events[a];switch(r.type){case l.Insert:case l.Remove:case l.Create:case l.Delete:case l.Move:case l.Update:case l.Format:case l.Zoom:case l.UIAction:break;default:try{i.default.PAssert(413,!1,"Expected TrackerType, received: ",r.type)}catch(s){i.default.reportError(s)}}}},_mergeAction:function(e,t){i.default.log("Tracker Action Merged: ",e,t);var a=this._getCurrentAction();try{i.default.PAssert(414,a,"Expected action to exist")}catch(r){i.default.reportError(r)}switch(e){case l.Insert:case l.Remove:case l.Create:case l.Delete:case l.Move:case l.Update:break;case l.Format:try{i.default.PAssert(415,!1,"Formats cannot be merged")}catch(r){i.default.reportError(r)}break;case l.Zoom:try{i.default.PAssert(416,!1,"Zooms cannot be merged")}catch(r){i.default.reportError(r)}break;case l.UIAction:try{i.default.PAssert(417,!1,"UIActions cannot be merged")}catch(r){i.default.reportError(r)}break;default:try{i.default.PAssert(418,!1,"Expected TrackerType, received: ",e)}catch(r){i.default.reportError(r)}}},_canMerge:function(e){var t=!1,a=this._getCurrentGroup();return a&&a.events.length>0&&(a.events[a.events.length-1].type===e?e===l.Insert&&(t=!0):t=!1),t},_canCombine:function(e,t){var a=this._getCurrentGroup();return a&&(a.id===t||0===a.events.length)},performActions:function(e){try{i.default.PAssert(419,!this.disabled||r.default.intro,"Can only perform actions when enabled or during the intro")}catch(o){i.default.reportError(o)}try{i.default.PAssert(420,!this._performingActions,"Can not nest performing actions")}catch(o){i.default.reportError(o)}if(this._performingActions=!0,e&&e.length>0){var t,a=0;if(!this.disabled)this.cursor!==this.groups.length-1?(this.groups.splice(this.cursor+1,this.groups.length-(this.cursor+1)),t=this._pushGroup()):t=this._getNextGroupID();for(var s=0;s<e.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e[s];this.fireActionEvent(n),this.disabled||(this._canCombine(n.type,t)?this._canMerge(n.type)?this._mergeAction(n.type,n.data):this._doAction(n.type,n.data):(t=this._pushGroup(),this._doAction(n.type,n.data)))}}this._performingActions=!1},beginAction:function(e){try{i.default.PAssert(421,!this._performingActions,"Should never begin an action while replaying old actions")}catch(t){i.default.reportError(t)}if(0===this._aggregateActions){this._actionsPreventUndo=!!e;try{i.default.PAssert(422,0===this._currentAction.length,"Current actions should always be empty when starting a new action")}catch(t){i.default.reportError(t)}}else i.default.shouldLog(s.a.LogLevels.Tracker)&&i.default.log("  -- Beginning Nested Action --");this._aggregateActions++},performAction:function(e,t){try{i.default.PAssert(423,!this._performingActions,"Should never perform an action while replaying old actions")}catch(n){i.default.reportError(n)}var a=!i.default.isLoaded||i.default.isLoadingRemote;this.disabled?r.default.intro?a?i.default.shouldLog(s.a.LogLevels.Tracker)&&i.default.log("Skipping Action For Intro: ",e,t):(i.default.shouldLog(s.a.LogLevels.Tracker)&&i.default.log("Performing Action For Intro: ",e,t),this.performActions([{type:e,data:[t]}])):i.default.shouldLog(s.a.LogLevels.Tracker)&&i.default.log("Performing Disabled Action: ",e,t):(i.default.shouldLog(s.a.LogLevels.Tracker)&&i.default.log("Performing Action: ",e,t),this._aggregateActions?this._currentAction.push({type:e,data:[t]}):this.performActions([{type:e,data:[t]}]))},endAction:function(){try{i.default.PAssert(424,!this._performingActions,"Should never end an action while replaying old actions")}catch(e){i.default.reportError(e)}try{i.default.PAssert(425,0!==this._aggregateActions,"Must have called beginAction before calling endAction")}catch(e){i.default.reportError(e)}1===this._aggregateActions?(this.disabled&&!r.default.intro||this.performActions(this._currentAction),this._currentAction.length=0,this._actionsPreventUndo=!1):i.default.shouldLog(s.a.LogLevels.Tracker)&&i.default.log("  -- Ending Nested Action --"),this._aggregateActions=Math.max(0,this._aggregateActions-1)},resetAggregateActionCount:function(){this._aggregateActions=0},notifyStateChangedFromUndoRedo:function(e,t){try{i.default.PAssert(426,this.undoRedoActive)}catch(a){i.default.reportError(a)}i.default.shouldLog(s.a.LogLevels.Tracker)&&i.default.log("Tracker notified of state change: ",t),this._externalStateChanged.push({type:e,data:t})},miscAction:function(e){this.fireActionEvent(e)},resetState:function(){this._performingActions=!1,this._externalStateChanged=[],this._currentAction=[],this.undoRedoActive=!1,this.cursor=-1,this.groupID=0,this.groups=[]},_getOrderedGroups:function(){return this.groups.slice(this.cursor).concat(this.groups.slice(0,this.cursor))},stringifyGroups:function(){return"Tracker: "+this._getOrderedGroups().length},stateChangeForUndoRedo:function(e){this.externalUndoRedo=!0,this.disabled=!0,this.canRedo=e.canRedo,this.canUndo=e.canUndo},fireActionEvent:function(e){try{if(e.data||(e.data={}),this.listeners)for(var t=0,a=0;a<this.listeners.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.listeners[a](e)}}catch(r){i.default.reportError(r)}}},t.d=new c},61:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(5),o=a(6),l=a(4),d=a(36),h=a(44),c=a(39),u={None:0,Left:1,Right:2,StartLine:3,EndLine:4,LeftWord:5,RightWord:6,Down:7,Up:8,PageDown:9,PageUp:10,Top:11,Bottom:12,PrevHeader:13,NextHeader:14,All:15},p=[r.a.KeyCode.Tab,r.a.KeyCode.Backspace,r.a.KeyCode.Delete],g=[r.a.KeyCode.UpArrow,r.a.KeyCode.DownArrow,r.a.KeyCode.LeftArrow,r.a.KeyCode.RightArrow,r.a.KeyCode.Home,r.a.KeyCode.End,r.a.KeyCode.A,r.a.KeyCode.E,r.a.KeyCode.F,r.a.KeyCode.B,r.a.KeyCode.PageUp,r.a.KeyCode.PageDown];t.a=new class{getNavigationAction(e){var t=n.a.mac,a=e.ctrlKey&&!e.altKey&&!e.metaKey,i=e.altKey&&!e.ctrlKey&&!e.metaKey,s=e.metaKey&&!e.ctrlKey&&!e.altKey,o=!e.ctrlKey&&!e.altKey&&!e.metaKey,l=e.normCode,d=r.a.KeyCode,h=u;if(l===d.LeftArrow){if(a&&!n.a.mac||i&&n.a.mac)return h.LeftWord;if(s&&t)return h.StartLine;if(o)return h.Left}if(l===d.RightArrow){if(a&&!n.a.mac||i&&n.a.mac)return h.RightWord;if(s&&t)return h.EndLine;if(o)return h.Right}if(l===d.UpArrow){if(t&&s)return h.Top;if(t&&a)return h.PageUp;if(t&&i)return h.StartLine;if(!t&&a)return h.PrevHeader;if(o)return h.Up}if(l===d.DownArrow){if(t&&s)return h.Bottom;if(t&&a)return h.PageDown;if(t&&i)return h.EndLine;if(!t&&a)return h.NextHeader;if(o)return h.Down}if(l===d.A&&a&&t)return h.StartLine;if(l===d.E&&a&&t)return h.EndLine;if(l===d.B&&a&&t)return h.Left;if(l===d.F&&a&&t)return h.Right;if(l===d.Home&&!t){if(a)return h.Top;if(o)return h.StartLine}if(l===d.End&&!t){if(a)return h.Bottom;if(o)return h.EndLine}return l===d.PageUp&&o?h.PageUp:l===d.PageDown&&o?h.PageDown:l===d.A&&s&&t||l===d.A&&a&&!t?h.All:h.None}updateAutocomplete(e){var t=e&&e.normCode&&g.indexOf(e.normCode)>=0&&"#"!==e.key;if(!i.default.isDemoRunning&&l.a.isValid()){var a=l.a.getStartIndex(),r=l.a.getStartItem(),s=l.a.getStartOffset(),n=l.a.getPane();l.a.isValid()&&r===l.a.getEndItem()&&s===l.a.getEndOffset()&&n.isIndexMounted(a)?h.a.updateFromPane({owner:r,pane:n,index:a,start:s,element:l.a.getStartElement(),fromArrows:t}):h.a.hide()}}keyup(e,t){if(t.normCode===r.a.KeyCode.Space&&c.a.clearGroupTextChanges(),i.default.preventAndStop(t),this.isTyping=!1,t.handled)return!0}handleSelectAll(e){var t=e.indexOfFirstItem(),a=e.indexOfLastItem();return l.a.selectIndices(t,0,a,-1,r.a.SelectOption.AllowPrefix),!1}handleSelectAllItem(){if(i.default.focusedPane&&i.default.focusedPane.isWriteable)return l.a.selectIndex(l.a.getStartIndex(),0,-1),!1}_move(e){try{i.default.PAssert(746,e===r.a.Direction.Up||e===r.a.Direction.Down,"Must move in a direction")}catch(m){i.default.reportError(m)}var t,a,s=i.default.focusedPane,n=l.a.getStartIndex(),d=l.a.getEndIndex(),h=l.a.getStartItem(),c=l.a.getEndItem(),u=!1;if(h.parent()===c.parent()&&(u=!0),!u&&!s.getNextItem(l.a.getEndIndex(),!0))for(var p=0;c;){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;if(h.parent()===c.parent()){u=!0;break}c=c.parent()}if(u&&(e===r.a.Direction.Up?(t=s.getPreviousItem(n,!0),a=c.getIndex()+1):(t=s.getNextItem(d,!0),a=h.getIndex()),t)){o.d.beginAction(),s.setIgnoreRestoreScroll();var g=l.a.save();l.a.reset();var f=1+t.numChildrenRecursive();i.default.setItemAnimationMode(r.a.ItemAnimationMode.Move),t.moveTo({parent:t.parent(),index:a},r.a.ChangeType.Local),i.default.resetItemAnimationMode(),e===r.a.Direction.Up?(g.startIndex-=f,g.endIndex-=f):e===r.a.Direction.Down&&(g.startIndex+=f,g.endIndex+=f),l.a.restore(g),e===r.a.Direction.Up?l.a.scrollStartIntoView():l.a.scrollEndIntoView(),o.d.endAction()}}moveUp(){!i.default.focusedPane.isViewAgenda()&&l.a.isValid()&&this._move(r.a.Direction.Up)}moveDown(){!i.default.focusedPane.isViewAgenda()&&l.a.isValid()&&this._move(r.a.Direction.Down)}handleArrows(e,t){var a=i.default.focusedPane;if(!l.a.isValid())return!0;var o=this.getNavigationAction(t),h=u;switch(l.a.preferLineStart=!1,o){case h.Left:case h.Right:case h.StartLine:case h.EndLine:case h.LeftWord:case h.RightWord:{let e,i,u,g,f,m,v=o===h.Left||o===h.LeftWord||o===h.StartLine,y=o===h.Right||o===h.RightWord||o===h.EndLine;v&&(!t.shiftKey||l.a.isArrowSelectInverted())||y&&t.shiftKey&&l.a.isArrowSelectInverted()||o===h.StartLine&&l.a.getStartIndex()===l.a.getEndIndex()?(u=l.a.getStartOffset(),g=l.a.getStartIndex(),m=l.a.getStartTotal(),e=l.a.getStartObject()):(u=l.a.getEndOffset(),g=l.a.getEndIndex(),m=l.a.getEndTotal(),e=l.a.getEndObject());let _,S=e.item;if(i=S.getParsedText(),o===h.StartLine)f=s.default.Measure.getCaretOffset(e,a,u).lineStart,g=l.a.isArrowSelectInverted()?l.a.getStartIndex():l.a.getEndIndex(),m=l.a.isArrowSelectInverted()?l.a.getStartTotal():l.a.getEndTotal();else if(o===h.EndLine){let t=s.default.Measure.getCaretOffset(e,a,u);S.metricsInPane(a,g),f=t.lineStart+t.lineLength,g=l.a.isArrowSelectInverted()?l.a.getStartIndex():l.a.getEndIndex()}else if(o===h.LeftWord){let e=d.a.getPreviousWord(S,i,u-1),n=i.prevIndexOf(r.a.AttachChar,u);if(n<0||n<=e)if(-1===e&&0===u)if(s.default.settings.selectFullItems.get()&&t.shiftKey)f=0;else if(g>0){if((g=a.indexOfPrevVMLI(g,!1,!0))>=0){let e=a.itemAtIndex(g).getParsedText();f=d.a.getPreviousWord(S,e,e.length-1)+1,m=e.length}}else f=-1;else f=e+1;else n>e&&(f=n+1,n+1===u&&f--)}else if(o===h.RightWord){let e=d.a.getNextWord(S,i,u+1),n=i.indexOf(r.a.AttachChar,u);if(n<0||n>=e)if(e===m)if(u!==m||t.shiftKey&&s.default.settings.selectFullItems.get())f=m;else if(g<a.numItems()-1){if((g=a.indexOfNextVMLI(g,!1,!0))>=0){let t=(_=a.itemAtIndex(g)).getParsedText();e=d.a.getNextWord(_,t,0),m=t.length,-1===e&&(e=t.length),f=e}}else f=m+1;else f=e;else(e>n||e<0)&&n>=0&&(f=n,n===u&&f++)}else o===h.Left?f=l.a.getStartOffset()===l.a.getEndOffset()||t.shiftKey?d.a.moveLeft(S,u):l.a.getStartOffset():o===h.Right&&(f=l.a.getStartOffset()===l.a.getEndOffset()||t.shiftKey?d.a.moveRight(S,u,m):l.a.getEndOffset());if(l.a.preferLineStart=v,!_&&(!s.default.settings.selectFullItems.get()||!t.shiftKey))if(f<l.a.getStartItem().getPrefixLength()&&o!==h.StartLine)if(l.a.preferLineStart=!1,g>0){g=a.indexOfPrevVMLI(g,!1,!0);let e=a.itemAtIndex(g);f=e.getParsedText().length,d.a.isInsideMarkup(e,f)&&(f=d.a.moveLeft(e,f))}else f=0;else f>m&&(g<a.numItems()-1?(g=a.indexOfNextVMLI(g,!1,!0),f=0):f=m);if(t.shiftKey){var c=l.a.isArrowSelectInverted()?l.a.getEndIndex():l.a.getStartIndex(),p=l.a.isArrowSelectInverted()?l.a.getEndOffset():l.a.getStartOffset();!l.a.isArrowSelectInverted()&&v&&g<=l.a.getStartIndex()&&f>=-1&&f<l.a.getStartOffset()?l.a.setArrowSelectInverted(!0):l.a.isArrowSelectInverted()&&y&&g>=l.a.getEndIndex()&&f>l.a.getEndOffset()&&l.a.setArrowSelectInverted(!1),l.a.isArrowSelectInverted()?l.a.selectIndices(g,f,c,p):l.a.selectIndices(c,p,g,f)}else l.a.selectIndex(g,f);if(n.a.isFirefox)if(t.normCode===r.a.KeyCode.LeftArrow){if(S.getParsedText()[l.a.getStartOffset()-1]===r.a.AttachChar&&!t.shiftKey)return l.a.selectItem(S,l.a.getStartOffset()-1),!1}else if(t.normCode===r.a.KeyCode.RightArrow&&S.getParsedText()[l.a.getEndOffset()]===r.a.AttachChar&&!t.shiftKey)return l.a.selectItem(S,l.a.getEndOffset()+1),!1;v?l.a.scrollStartIntoView():l.a.scrollEndIntoView();break}case h.Up:case h.Down:case h.Top:case h.Bottom:case h.PageUp:case h.PageDown:case h.PrevHeader:case h.NextHeader:{let e,r,n,d=o===h.Up||o===h.Top||o===h.PageUp,u=o===h.Down||o===h.Bottom||o===h.PageDown;d&&(!t.shiftKey||l.a.isArrowSelectInverted())||u&&t.shiftKey&&l.a.isArrowSelectInverted()?(n=l.a.getStartOffset(),r=l.a.getStartIndex(),e=l.a.getStartObject()):(n=l.a.getEndOffset(),r=l.a.getEndIndex(),e=l.a.getEndObject());let P,I=e.item,b=s.default.Measure.getCaretOffset(e,a,n),D=s.default.Measure.getCaretScreenPosition(a,r,n),w=(b.lineOffset,D.left);if(l.a.preferLineStart=b.lineOffset<=2,o===h.Up){let t=b.line-1;0===r&&t<0?(P=0,t=0):(t<0&&r>0&&(r=a.indexOfPrevVMLI(r,!1,!0))>=0&&(I=a.itemAtIndex(r),e=a.objectAtIndex(r),t=s.default.Measure.getCaretOffset(e,a).line),t>=0&&(P=s.default.Measure.getOffsetForScreenPositionInLine(r,e,a,t,w)))}else if(o===h.Down){let t=b.line+1;t>I.metricsInPane(a,r).styledLines.length-1&&(r<a.numItems()-1&&(r=a.indexOfNextVMLI(r,!1,!0))>=0?(I=a.itemAtIndex(r),t=0):t=b.line),r>=0&&(e=a.objectAtIndex(r),P=s.default.Measure.getOffsetForScreenPositionInLine(r,e,a,t,w))}else if(o===h.Top)r=a.indexOfFirstItem(),P=0;else if(o===h.Bottom){var g=a.getLastItem(),f=a.numItems();g&&f>0&&(r=a.indexOfLastItem(),P=g.getParsedText().length)}else if(o===h.PageUp)r=a.indexPageUp(l.a.getStartIndex()),P=0;else if(o===h.PageDown){var m=a.indexPageDown(l.a.getStartIndex());r=m,P=a.itemAtIndex(m).getParsedText().length}else{if(o===h.PrevHeader&&a.isViewOutline()){let e=l.a.getStartItem();if(e.parent()===i.default.focusedItem){if(!e.isFirstChild()){try{i.default.PAssert(747,e.getIndex()>0,"Should never hit this with the first item in the list")}catch(S){i.default.reportError(S)}y=e.parent().getChild(e.getIndex()-1)}}else{for(var v=0;e.parent()!==i.default.focusedItem;){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;e=e.parent()}y=e}return void 0!==y&&l.a.selectItem(y,-1),!1}if(o===h.NextHeader&&a.isViewOutline()){let e=l.a.getEndItem();var y;if(e.parent()===i.default.focusedItem)e.isLastChild()||(y=e.parent().getChild(e.getIndex()+1));else{for(var _=0;e.parent()!==i.default.focusedItem;){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;e=e.parent()}e.isLastChild()||(y=e.parent().getChild(e.getIndex()+1))}return void 0!==y&&l.a.selectItem(y,-1),!1}}r>=0&&!isNaN(P)&&(t.shiftKey?(c=l.a.isArrowSelectInverted()?l.a.getEndIndex():l.a.getStartIndex(),p=l.a.isArrowSelectInverted()?l.a.getEndOffset():l.a.getStartOffset(),!l.a.isArrowSelectInverted()&&d&&(r===l.a.getStartIndex()&&P<l.a.getStartOffset()||r<l.a.getStartIndex())?l.a.setArrowSelectInverted(!0):l.a.isArrowSelectInverted()&&u&&(r===l.a.getEndIndex()&&P>l.a.getEndOffset()||r>l.a.getEndIndex())&&l.a.setArrowSelectInverted(!1),l.a.isArrowSelectInverted()?l.a.selectIndices(r,P,c,p):l.a.selectIndices(c,p,r,P)):l.a.selectIndex(r,P)),d?l.a.scrollStartIntoView():l.a.scrollEndIntoView();break}case h.All:this.handleSelectAll(a)}return o===h.None}keydown(e,t){this.isTyping=!0;var a=!0;if(p.indexOf(t.normCode)>=0?a=this.keypress(e,t,!0):n.a.mac&&t.ctrlKey&&t.normCode===r.a.KeyCode.D?a=this.keypress(e,t,!0):g.indexOf(t.normCode)>=0?(i.default.setItemAnimationMode(r.a.ItemAnimationMode.None),a=this.handleArrows(e,t),i.default.resetItemAnimationMode(),this.getNavigationAction(t)&&this.updateAutocomplete(t)):n.a.mac&&t.metaKey||!n.a.mac&&t.ctrlKey&&!t.altKey?t.normCode!==r.a.KeyCode.Y&&t.normCode!==r.a.KeyCode.Z||(a=this.keypress(e,t,!0)):n.a.mac&&t.ctrlKey&&t.normCode===r.a.KeyCode.H&&i.default.preventDefault(t),a&&l.a.getStartIndex()===l.a.getEndIndex()&&l.a.getStartOffset()===l.a.getEndOffset()){var s=l.a.getStartOffset(),o=l.a.getStartItem(),h=o.getParsedText();i.default.shouldLog(r.a.LogLevels.Edit)&&console.log("check markdown",s,h[s]),"]"===h[s]&&d.a.isInsideMarkup(o,s)&&(s=d.a.moveRight(o,s,h.length-1),l.a.selectIndex(l.a.getStartIndex(),s),l.a.focusHiddenInput(),i.default.shouldLog(r.a.LogLevels.Edit)&&console.log("Adjusted to",s))}return a&&this.keyWantsScrollIntoView(t,!0)&&l.a.scrollStartIntoView(),a}checkKeypressSpecialCases(e,t){var a;return e.ctrlKey&&e.altKey&&t?a=!0:e.metaKey&&e.normCode===r.a.KeyCode.Tilde&&(a=!1),a}isMultiselectDangerous(){var e=0,t=i.default.focusedPane;if(!t.isViewOutline()&&!t.isViewProject())return"Are you sure you want to delete multiple items?";for(var a=t.indexOfNextVMLI(l.a.getStartIndex()-1),s=t.indexOfPrevVMLI(l.a.getEndIndex()+1),n=a,o=0;!isNaN(n)&&n>=0&&n<=s;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var d=t.itemAtIndex(n);if(t.isSearchedFlat()){if(t.search.isFlatSearchResult(d)&&o++,o>=2)return r.a.MessageID.FlatSearchMultiSelect}else if(++o>=8)return"You have selected a large number of items to delete. Are you sure?";n=t.indexOfNextVMLI(n)}return!1}keypress(e,t,a,d){var h=[r.a.KeyCode.Enter,r.a.KeyCode.D];i.default.stopPropagation(t);var u=!0,p=i.default.focusedPane,g=t.normCode>=32||h.indexOf(t.normCode)>=0;if(0!==t.which&&(a||g)){if(n.a.mac&&t.metaKey||!n.a.mac&&t.ctrlKey)switch(String.fromCharCode(t.normCode)){case"c":case"C":return t.handled=!0,!0;case"v":case"V":return t.handled=!0,!0;case"x":case"X":return t.handled=!0,!0;case"Y":case"y":case"Z":case"z":try{i.default.PAssert(748,!1,"Should not be handled undo/redo hotkeys here")}catch(_){i.default.reportError(_)}return t.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return t.handled=!0,!0}var f=l.a.getStartItem();o.d.beginAction(),c.a.saveDeleteSelection(),c.a.beginAction();var m=[r.a.KeyCode.Tab,r.a.KeyCode.Enter,r.a.KeyCode.Backspace,r.a.KeyCode.Delete,r.a.KeyCode.D];if(l.a.getStartIndex()!==l.a.getEndIndex()&&t.normCode!==r.a.KeyCode.Tab&&(!t.metaKey&&!t.ctrlKey&&!t.altKey||m.indexOf(t.normCode)>=0))if(p.isViewOutline()||p.isViewProject()){var v;if(s.default.PaneUpdateBatcher.beginUpdateItems(),!d&&(v=this.isMultiselectDangerous())){if(p.isSearchedFlat())s.default.toasts.pushMessage(r.a.MessageID.FlatSearchMultiSelect);else{var y=l.a.save();s.default.menus.confirm(v,function(i){l.a.restore(y),i&&this.keypress(e,t,a,!0)}.bind(this))}u=!1}else u=!!p.isEditable&&u&&this.handleMultiselect(t);s.default.PaneUpdateBatcher.commitUpdateItems()}else s.default.toasts.pushMessage({text:"Editing multiple items from this view is not currently supported. Please edit them individually.",actionText:"OKAY"}),u=!1;u&&m.indexOf(t.normCode)>=0&&(s.default.PaneUpdateBatcher.beginUpdateItems(),t.normCode===r.a.KeyCode.Enter?u=!!p.isEditable&&u&&this.handleEnter(t):t.normCode===r.a.KeyCode.Backspace?u=!!(f&&f.allowTextEditing()&&p.isEditable)&&u&&this.handleBackspace(t):(t.normCode===r.a.KeyCode.Delete||n.a.mac&&t.ctrlKey&&t.normCode===r.a.KeyCode.D)&&(u=!!(f&&f.allowTextEditing()&&p.isEditable)&&u&&this.handleDelete(t)),s.default.PaneUpdateBatcher.commitUpdateItems()),c.a.endAction(),o.d.endAction()}return this.keyWantsScrollIntoView(t,a)&&l.a.scrollStartIntoView(),u}handleMultiselect(e){var t=0,a=0,s=i.default.focusedPane,n=s.indexOfNextVMLI(l.a.getStartIndex()-1),d=s.indexOfPrevVMLI(l.a.getEndIndex()+1),h=l.a.getStartOffset(),c=l.a.getEndOffset();l.a.selectIndices(n,h,d,c,r.a.SelectOption.AllowPrefix);var u=!0,p=s.objectAtIndex(n),g=l.a.getStartItem(),f=l.a.getEndItem();if(g.isNote()&&(g=g.parent()),f.isNote()&&(f=f.parent()),!s.hasNonVMLIs&&g===f)return!1;if(e.normCode===r.a.KeyCode.Enter&&e.shiftKey)return!0;let m=[];d=d;let v=s.indexOfNextVMLI(n);for(;v&&v>=0&&(v<d||v===d&&l.a.getEndOffset()===l.a.getEndTotal());){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;let e=s.itemAtIndex(v);e.parent()===i.default.focusedPane.getItem()&&e.isHeader(),m.indexOf(e)<0&&e!==g&&m.push(e),v=s.indexOfNextVMLI(v)}var y,_=l.a.getEndItem().levelsDeep.get()-l.a.getStartItem().levelsDeep.get();if(l.a.getStartOffset()>0||l.a.getEndOffset()<l.a.getEndTotal()){var S=g.splitUsableText(g.getParsedText(),h,h),P=f.splitUsableText(f.getParsedText(),c,c);y=S.before+P.after,o.d.performAction(o.b.Remove,{itemID:g.id,position:l.a.getStartOffset(),text:g.getParsedText().slice(l.a.getStartOffset())}),o.d.performAction(o.b.Insert,{itemID:g.id,position:l.a.getStartOffset(),text:f.getParsedText().substring(l.a.getEndOffset())}),m.indexOf(f)<0&&m.push(f),0===l.a.getStartOffset()&&g.copyProperties(f)}else o.d.performAction(o.b.Remove,{itemID:g.id,position:0,text:g.getParsedText()}),y="";if(e.normCode!==r.a.KeyCode.Backspace&&e.normCode!==r.a.KeyCode.Delete&&e.normCode!==r.a.KeyCode.Enter||(u=!1),g.setText(y,r.a.ChangeType.Local),f.moveChildren(g,0,r.a.ChangeType.Local),_>0){for(var I=0,b=[],D=f.nextSibling();_>0&&D;){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;v=D.getIndex();var w=D.parent().getItems().slice(v);b=b.concat(w),D=D.parent().nextSibling(),_--}if(b.length>0){var E=0,C=g;v=0;for(var A=0;A<b.length;A++){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;let e=b[A],t=e.parent();if(m.indexOf(t)>=0){let a=e.getIndex();e.moveTo({parent:C,index:v},r.a.ChangeType.Local),o.d.performAction(o.b.Move,{itemID:e.id,oldParent:t.id,oldPosition:a,newParent:C.id,newPosition:v}),v++}}}}else if(m.indexOf(f.parent())>=0){var M=0;C=g.parent();let e=s.getNextItem(d,!0);for(;e;){if(M++>5e3&&__infLoop&&__infLoop(M))throw new RangeError;v=C.numItems();let t=e.parent(),a=t.getChildIndex(e);e.moveTo({parent:C,index:v},r.a.ChangeType.Local),o.d.performAction(o.b.Move,{itemID:e.id,oldParent:t.id,oldPosition:a,newParent:C.id,newPosition:v}),e=s.getNextItem(d,!0)}}for(A=0;A<m.length;A++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let e=m[A];try{i.default.PAssert(749,e,"Item must exist")}catch(L){i.default.reportError(L)}e.isDeleted()||e.parent().deleteChild(e,void 0,void 0,r.a.ChangeType.Local)}if(s.hasNonVMLIs){var T=s.closestIndexOfObject(p);try{i.default.PAssert(750,T>=0,"Could not find item to select")}catch(L){i.default.reportError(L)}T>=0&&l.a.selectIndex(T,h)}else l.a.selectIndex(n,h);return u}handleTab(e){var t=0,a=l.a.getPane(),n=l.a.getStartItem(),d=l.a.getStartIndex(),h=l.a.getEndItem(),c=l.a.getStartObject(),u=l.a.getEndObject(),p=l.a.getStartOffset(),g=l.a.getEndOffset(),f=!e,m=f?0:1;if(c.levelsDeep<m)return!1;if(f&&a.isViewAutoBlocks()&&c.levelsDeep===m){var v=a.prevPaneObjectAtSameLevel(d);if(!v||v.block!==c.block||v.item.parent()!==n.parent())return!1}s.default.PaneUpdateBatcher.beginUpdateItems(),n&&n.isNote()&&(n=n.parent()),h&&h.isNote()&&(h=h.parent()),l.a.scrollStartIntoView();var y=n,_={},S=[n],P={},I={};if(I[n.id]=!0,n!==h){var b=0;do{if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;(y=i.default.getNextItem(y,a,{numLevels:0,ignoreSearch:!0}))&&(S.push(y),I[y.id]=!0)}while(y!==h&&void 0!==y)}var D,w,E,C=0;for(e?(D=function(){C=S.length-1},w=function(){return C>=0},E=function(){C--}):(D=function(){C=0},w=function(){return C<S.length},E=function(){C++}),D();w();E()){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var A=S[C];try{i.default.PAssert(751,A,"Must always be tabbing/untabbing valid items")}catch(Q){i.default.reportError(Q)}var M,T,L=A.parent(),x=L.getItems().indexOf(A);if(f){var k=0;let e;if(M=x>0&&!c.isBlockHeader,a.search.isFlatSearchResult(A)&&(M=!1,s.default.toasts.pushMessage(r.a.MessageID.FlatSearchTab)),M)if(c.block){var R=a.prevPaneObjectAtSameLevel(d+C);R&&R.item&&(e=R.item)}else e=L.itemAtIndex(x-1);if(M&&e){for(var O=0;e.isHidden(a);){if(O++>5e3&&__infLoop&&__infLoop(O))throw new RangeError;if(--x<=0)return s.default.PaneUpdateBatcher.commitUpdateItems(),!1;e=L.itemAtIndex(x-1)}P[L.id]||(_[A.parent().id]=A.parent(),_[e.id]=e,A.moveTo({parent:e},r.a.ChangeType.Local),e.isCollapsed(a,!1)&&e.setCollapsed(!1,a)),P[A.id]=!0,o.d.performAction(o.b.Move,{itemID:A.id,oldParent:L,oldPosition:x,newParent:e,newPosition:e.numItems()-1})}else e=L,P[A.id]=P[L.id];for(var F=!1,N=A;N;){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;if(P[N.id]){N.isCollapsed(a,!1)||(F=!0);break}N=N.parent()}var B=A.getIndex()+1;if(F){var U=0,H=A.getItems(),V=0;for(T=0;T<H.length;T++){if(U++>5e3&&__infLoop&&__infLoop(U))throw new RangeError;var j=H[T];if(!I[j.id]){if(j.isHidden(a))continue;_[j.parent().id]=j.parent(),_[A.parent().id]=A.parent();var z=B+V;j.moveTo({parent:A.parent(),index:z},r.a.ChangeType.Local),P[j.id]=!0,o.d.performAction(o.b.Move,{itemID:j.id,oldParent:A,oldPosition:T,newParent:A.parent(),newPosition:z}),V++,T--}}}}else if(M=A.parent()!==i.default.focusedItem&&!(a.isViewProject()&&c.block.id!==a.blockNoKey&&A.parent().parent()===i.default.focusedItem),(a.search.isFlatSearchResult(A)||a.search.isFlatSearchResult(A.parent()))&&(M=!1,s.default.toasts.pushMessage(r.a.MessageID.FlatSearchTab)),M){var q=0;let e=A.parent().parent();var W=L.getItems();for(T=x+1;W[x+1];){if(q++>5e3&&__infLoop&&__infLoop(q))throw new RangeError;var G=W[x+1];I[G.id]||G.isHidden(a)?x++:(_[G.parent().id]=G.parent(),_[A.id]=A,G.moveTo({parent:A},r.a.ChangeType.Local),P[G.id]=!0,o.d.performAction(o.b.Move,{itemID:G.id,oldParent:L,oldPosition:T,newParent:A,newPosition:A.numItems()-1})),T++}if(I[L.id]>=0&&(!L.parent()||L.parent()!==i.default.focusedItem))continue;var K=e.getItems().indexOf(L);_[A.parent().id]=A.parent(),_[e.id]=e,A.moveTo({parent:e,index:K+1},r.a.ChangeType.Local),P[A.id]=!0,o.d.performAction(o.b.Move,{itemID:A.id,oldParent:L,oldPosition:x,newParent:e,newPosition:K+1})}}a.setIgnoreRestoreScroll(),s.default.PaneUpdateBatcher.commitUpdateItems(!1,!1);let Y=a.indexOfObject(c),X=a.indexOfObject(u);Y>=0&&X>=0?l.a.selectIndices(Y,p,X,g):requestAnimationFrame(()=>l.a.updateCaret())}handleEnter(e){var t=i.default.focusedPane,a=l.a.getStartItem(),n=l.a.getStartObject(),h=l.a.getStartIndex(),c=l.a.getStartOffset(),u=l.a.getStartTotal(),p=l.a.getEndItem(),g=l.a.getEndOffset(),f=l.a.getEndTotal();if(!a){try{i.default.PAssert(752,!1,"Invalid item in handleEnter")}catch(F){i.default.reportError(F)}return!1}var m=a.parent();if(!m){try{i.default.PAssert(753,!1,"Invalid parent in handleEnter")}catch(F){i.default.reportError(F)}return!1}var v,y=m.getItems().indexOf(a),_=a.getParsedText(),S=a.getMooDate(),P=!1,I=m;if(t.clearPreventUpdate(),t.setIgnoreRestoreScroll(),e&&e.shiftKey)return i.default.preventDefault(e),!1;if(a.isNote())return i.default.preventDefault(e),!1;if(t.search.isFlatSearchResult(a))return s.default.toasts.pushMessage(r.a.MessageID.FlatSearchEnter),i.default.preventDefault(e),!1;if(t.isViewProject()&&t.isItemTopLevel(n,a)&&a.hasChildren()&&0===a.getChild(0).getParsedTextWithoutPrefix().length)l.a.selectIndex(h+1,0);else if(a.shouldCopyPrefix()&&_===a.getPrefix())a.setText("",r.a.ChangeType.Local),l.a.selectIndex(h,0);else{if(!a.getPrefix()||c!==a.getPrefixLength()||g!==f){var b,D,w=!0,E=!1,C=!1,A={text:""},M=n.block;t.setIgnoreRestoreScroll(),s.default.PaneUpdateBatcher.beginUpdateItems(),t.isViewTag()&&a.getParsedText().indexOf(n.block.text)>=0&&(b=n.block.text,D=a.getParsedText()[a.getPrefixLength()]===r.a.TagPrefix?0:-1),d.a.isInsideMarkup(a,c)&&(c=d.a.moveRight(a,c,_.length));let h=d.a.adjustLeftForMarkup(a,g);if(!t.isViewAgenda()||0!==n.levelsDeep||a.hasVisibleChildren(t)&&!a.isCollapsed(t))if(a.hasAttachmentType(r.a.PluginType.Calendar));else if(h===p.getPrefixLength()&&""!==_)y--,w=!1,E=!0;else if(c>=u)(P=!a.isCollapsed(t,!1)&&(a.getVisibleChildren(t).length>0||a.isPrefixHeader()))&&(I=a);else if(c===a.getPrefixLength()&&g===f)a.setText(a.getPrefix(),r.a.ChangeType.Local),o.d.performAction(o.b.Remove,{itemID:a.id,position:0,text:_});else{var T=a.splitUsableText(_,c,g);b&&T.before.indexOf(T)<0&&(0===D?T.before=b+" "+T.before:T.before+=" "+b),A.text=T.after,S&&T.after.includes(r.a.CharDate)&&(A.date=S),i.default.setItemAnimationMode(r.a.ItemAnimationMode.Move),a.setText(T.before,r.a.ChangeType.Local),o.d.performAction(o.b.Remove,{itemID:a.id,position:0,text:_.substring(0,g)}),C=!0,(P=!a.isCollapsed(t,!1)&&(a.numItems()>0||a.isHeader()))&&(I=a)}else M.isStarred?A.isStarred=!0:M.isImportant?A.priority=a.getPriority():M.isDate&&M.date&&a.getMooDate()?A.date=a.getMooDate().toData():A.text=" "+M.id,a.shouldSave()||(y=-1);!P&&b&&A.text.indexOf(b)<0&&(0===D?A.text=b+" "+A.text:A.text+=" "+b);var L=s.default.settings.defaultItemPrefix.get();if(P||!a.shouldCopyPrefix()&&!C?(!P||P&&L&&(a.isPrefixHeader()||a.shouldCopyPrefix()&&a.prefix===L))&&(A.text=(L&&L+" ")+A.text):A.text=a.getPrefix()+A.text,v=t.createVMLI(A,{parent:I,changeType:r.a.ChangeType.AllLocal,isEditable:!0}),C&&v.copyProperties(a),v.parseText("",r.a.ChangeType.Local|r.a.ChangeType.All),P)a.insertItem(v,0),o.d.performAction(o.b.Create,{itemID:v.id,parent:a.id,position:0,text:v.getParsedText()});else{try{i.default.PAssert(754,!v.isNote(),"Should never be inserting a note here")}catch(F){i.default.reportError(F)}I.insertItem(v,y+1),o.d.performAction(o.b.Create,{itemID:v.id,parent:I.id,position:y+1,text:v.getParsedText()})}s.default.PaneUpdateBatcher.commitUpdateItems(),i.default.resetItemAnimationMode();var x=w?v:a;try{i.default.PAssert(755,x,"Expected another item to exist")}catch(F){i.default.reportError(F)}var k=t.closestIndexOfObject(n),R=w?t.indexOfItem(v,M):E?k-1:k,O=x.shouldCopyPrefix()&&x.getPrefixLength()||0;return R>=0&&l.a.selectIndex(R,O,O),i.default.preventDefault(e),!1}a.setText(a.getPrefix(),r.a.ChangeType.Local),l.a.selectIndex(h,0),o.d.performAction(o.b.Remove,{itemID:a.id,position:0,text:_})}}handleBackspace(e){var t=l.a.getStartItem(),a=l.a.getStartIndex(),h=l.a.getStartOffset(),u=l.a.getEndOffset(),p=l.a.getStartObject(),g=i.default.focusedPane,f=h===u;if(!t){try{i.default.PAssert(756,!1,"Invalid item in handleBackspace")}catch(R){i.default.reportError(R)}return!1}var m=t.parent();try{i.default.PAssert(757,m,"Must always have a valid parent for an item")}catch(R){i.default.reportError(R)}n.a.ie&&i.default.preventAndStop(e);var v=t.getParsedText(),y="",_=0,S=!0,P=t.hasAttachmentType(r.a.PluginType.Calendar);if(0===h&&0===u||""===v)if(p.isBlockHeader&&t.hasChildren())S=!1;else if(t.isNote()&&""!==v)S=!1;else if(P)S=!1;else if(l.a.getStartIndex()>0){var I=i.default.focusedPane.indexOfPrevVMLI(l.a.getStartIndex(),!0,!0),b=I>=0&&i.default.focusedPane.itemAtIndex(I);if(b&&b.allowTextEditing()){if((g.isViewAgenda()||g.search.isFlatSearchResult(t))&&0!==v.length&&(S=!1),S){g.setIgnoreRestoreScroll(),s.default.PaneUpdateBatcher.beginUpdateItems(),c.a.saveDeleteSelection();var D=b.getParsedText(),w=b.isFullscreen()?0:I,E=g.objectAtIndex(w),C=b.isFullscreen()?0:D.length;l.a.selectIndex(w,C),m.deleteChild(t,b,0,r.a.ChangeType.Local),v.length>0&&""!==v&&(0===D.length&&b.copyProperties(t),b.setText(b.generateSaveText(D)+t.generateSaveText(v),r.a.ChangeType.Local),t.hasNote()&&(b.hasNote()||b.moveNote(t,r.a.ChangeType.Local)),o.d.performAction(o.b.Insert,{itemID:b.id,position:D.length,text:v})),s.default.PaneUpdateBatcher.commitUpdateItems(),w=g.indexOfObject(E),l.a.selectIndex(w,C),S=!1}}else S=!1}else S=!1;else if(f&&h<=t.getPrefixLength())p.isBlockHeader&&t.hasChildren()?S=!1:(o.d.performAction(o.b.Remove,{itemID:t.id,position:0,text:v.slice(0,t.getPrefixLength())}),y=v.substr(t.getPrefixLength()),_=0);else if(0===h&&u===v.length)o.d.performAction(o.b.Remove,{itemID:t.id,position:0,text:t.getParsedText()}),y="",_=0;else if(e&&e.metaKey)if(t.isNote()){var A=v.prevIndexOf("\n",u);A<0?(y=v.substring(u),_=0,o.d.performAction(o.b.Remove,{itemID:t.id,position:0,text:v.slice(0,u)})):(y=v.substring(0,A)+v.substring(u),_=A,o.d.performAction(o.b.Remove,{itemID:t.id,position:0,text:v.slice(A,u)}))}else y=t.getPrefix()+v.substring(u),o.d.performAction(o.b.Remove,{itemID:t.id,position:0,text:v.slice(0,u)}),_=0;else{let a=d.a.isInsideMarkup(t,h-1);if(a&&(h=d.a.moveLeft(t,h-1)+1,a.isMDImage()&&"!"===v[h-1]&&h--),f?u=h:d.a.isInsideMarkup(t,u-1)&&(u=d.a.moveRight(t,u-1,l.a.getStartTotal())-1),f=h===u,(e&&n.a.mac&&e.altKey||e&&!n.a.mac&&e.ctrlKey)&&f){var M=v.substring(h),T=d.a.getPreviousWord(t,v,h-1)+1;i.default.shouldLog(r.a.LogLevels.Edit)&&console.log(T,v[T],M),T>=0?(o.d.performAction(o.b.Remove,{itemID:t.id,position:T,text:v.slice(T,h)}),y=v.substring(0,T)+M,_=T):(h===v.length?0===h&&(y="",o.d.performAction(o.b.Remove,{itemID:t.id,position:0,text:v})):(o.d.performAction(o.b.Remove,{itemID:t.id,position:0,text:v.slice(0,h)}),y=M),_=0)}else if(f){var L=1;v.length>1&&""===v[h-1]&&L++,y=v.substr(0,h-L)+v.substr(h),o.d.performAction(o.b.Remove,{itemID:t.id,position:h-L,text:v.slice(h-L,h)}),_=h-L}else{var x=v.slice(h,u);o.d.performAction(o.b.Remove,{itemID:t.id,position:h,text:x}),y=v.substr(0,h)+v.substr(u),_=h}}if(S){if(!s.default.settings.showMarkdown.get()){var k=y.search(/(_{4,}?|\*{4,}?)/);k>=0&&(y=y.replace(/(_{4,}?|\*{4,}?)/g,""),_>k&&(_-=_-k))}t.setText(y,r.a.ChangeType.Local),l.a.selectIndex(a,_),this.updateAutocomplete(e)}return!1}handleDelete(e){var t=l.a.getStartItem(),a=i.default.focusedPane;if(!t)return!1;var s,h=t.parent(),u=t.getParsedText(),p=l.a.getStartIndex(),g=l.a.getStartOffset(),f=l.a.getEndOffset(),m=g===f,v=!0;if(""===u)if(a.isViewOutline()){if(t.isNote())h.setNote(void 0,r.a.ChangeType.Local),l.a.selectItem(h,-1);else if(p<a.numItems()-1){var y=p;a.setIgnoreRestoreScroll(),c.a.saveDeleteSelection(),a.numItems()>1&&(t.hasChildren()?h.replaceChild(t,t.getFirstChild(),r.a.ChangeType.Local):h.deleteChild(t,h,y,r.a.ChangeType.Local)),l.a.selectIndex(y,0)}}else v=!1;else if(g===l.a.getStartTotal()&&f===l.a.getEndTotal())if(a.isViewOutline())if(t.isNote())v=!1;else{var _=a.indexOfNextVMLI(p,!0,!0),S=_>=0&&a.itemAtIndex(_);if(a.setIgnoreRestoreScroll(),S&&v){u=t.generateSaveText(u);var P=S.generateSaveText(S.getParsedText()),I=S.hasNote()&&S.getNote();if(t.setText(u+P,r.a.ChangeType.Local),I){var b=t.hasNote()&&t.getNote();if(b){var D=b.getRawText()+"\n\n--- merged note ---\n\n"+I.getRawText();b.setText(D,r.a.ChangeType.Local)}else I.setParent(t),t.setNote(I,r.a.ChangeType.Local)}o.d.performAction(o.b.Insert,{itemID:t.id,position:u.length,text:S.getParsedText()}),c.a.saveDeleteSelection(),S.parent().deleteChild(S,t,0,r.a.ChangeType.Local),l.a.selectIndex(l.a.getEndIndex(),f)}}else v=!1;else if(e.metaKey)t.isNote()||(s=u.substring(0,g),t.setText(s,r.a.ChangeType.Local),o.d.performAction(o.b.Remove,{itemID:t.id,position:0,text:u.slice(0,g)}),l.a.selectIndex(p,g));else if((n.a.mac&&e.altKey||!n.a.mac&&e.ctrlKey)&&g===f){var w=d.a.getNextWord(t,u,g+1);w<0&&(w=l.a.getStartTotal()),w>=0&&(s=u.substring(0,g)+u.substring(w),t.setText(s,r.a.ChangeType.Local),o.d.performAction(o.b.Remove,{itemID:t.id,position:w,text:s}),l.a.selectIndex(p,g))}else d.a.isInsideMarkup(t,g-1)&&(g=d.a.moveLeft(t,g-1)+1),d.a.isInsideMarkup(t,f)&&(f=d.a.moveRight(t,f,l.a.getStartTotal())-1),m?(s=u.substr(0,g)+u.substr(g+1),o.d.performAction(o.b.Remove,{itemID:t.id,position:g,text:u.slice(g,g+1)})):(u.slice(g,f),s=u.substr(0,g)+u.substr(f),o.d.performAction(o.b.Remove,{itemID:t.id,position:g,text:u.slice(g,f)})),void 0!==s&&(t.setText(s,r.a.ChangeType.Local),l.a.selectIndex(p,g),this.updateAutocomplete(e));return!1}keyWantsScrollIntoView(e,t){switch(e.normCode){case r.a.KeyCode.LeftMeta:case r.a.KeyCode.RightMeta:case r.a.KeyCode.Alt:case r.a.KeyCode.Shift:case r.a.KeyCode.Ctrl:case r.a.KeyCode.LeftArrow:case r.a.KeyCode.RightArrow:case r.a.KeyCode.UpArrow:case r.a.KeyCode.DownArrow:return!1}return!(n.a.mac&&e.metaKey&&(t&&e.normCode===r.a.KeyCode.Tilde||!t&&"`"===String.fromCharCode(e.normCode)))&&(!(n.a.mac&&e.metaKey||!n.a.mac&&e.ctrlKey)||e.normCode!==r.a.KeyCode.Z&&e.normCode!==r.a.KeyCode.Y)&&!(e.normCode>=r.a.KeyCode.F1&&e.normCode<=r.a.KeyCode.F12)}compoundOperation(e){o.d.beginAction(),s.default.PaneUpdateBatcher.beginUpdateItems(),e(),s.default.PaneUpdateBatcher.commitUpdateItems(),o.d.endAction()}}},62:function(e,t,a){"use strict";t.a=class{constructor(e){Object.keys(e).forEach(t=>this[t]=e[t])}}},623:function(e,t,a){var i={"./af":330,"./af.js":330,"./ar":331,"./ar-dz":332,"./ar-dz.js":332,"./ar-kw":333,"./ar-kw.js":333,"./ar-ly":334,"./ar-ly.js":334,"./ar-ma":335,"./ar-ma.js":335,"./ar-sa":336,"./ar-sa.js":336,"./ar-tn":337,"./ar-tn.js":337,"./ar.js":331,"./az":338,"./az.js":338,"./be":339,"./be.js":339,"./bg":340,"./bg.js":340,"./bm":341,"./bm.js":341,"./bn":342,"./bn.js":342,"./bo":343,"./bo.js":343,"./br":344,"./br.js":344,"./bs":345,"./bs.js":345,"./ca":346,"./ca.js":346,"./cs":347,"./cs.js":347,"./cv":348,"./cv.js":348,"./cy":349,"./cy.js":349,"./da":350,"./da.js":350,"./de":351,"./de-at":352,"./de-at.js":352,"./de-ch":353,"./de-ch.js":353,"./de.js":351,"./dv":354,"./dv.js":354,"./el":355,"./el.js":355,"./en-au":356,"./en-au.js":356,"./en-ca":357,"./en-ca.js":357,"./en-gb":358,"./en-gb.js":358,"./en-ie":359,"./en-ie.js":359,"./en-il":360,"./en-il.js":360,"./en-nz":361,"./en-nz.js":361,"./eo":362,"./eo.js":362,"./es":363,"./es-do":364,"./es-do.js":364,"./es-us":365,"./es-us.js":365,"./es.js":363,"./et":366,"./et.js":366,"./eu":367,"./eu.js":367,"./fa":368,"./fa.js":368,"./fi":369,"./fi.js":369,"./fo":370,"./fo.js":370,"./fr":168,"./fr-ca":371,"./fr-ca.js":371,"./fr-ch":372,"./fr-ch.js":372,"./fr.js":168,"./fy":373,"./fy.js":373,"./gd":374,"./gd.js":374,"./gl":375,"./gl.js":375,"./gom-latn":376,"./gom-latn.js":376,"./gu":377,"./gu.js":377,"./he":378,"./he.js":378,"./hi":379,"./hi.js":379,"./hr":380,"./hr.js":380,"./hu":381,"./hu.js":381,"./hy-am":382,"./hy-am.js":382,"./id":383,"./id.js":383,"./is":384,"./is.js":384,"./it":385,"./it.js":385,"./ja":386,"./ja.js":386,"./jv":387,"./jv.js":387,"./ka":388,"./ka.js":388,"./kk":389,"./kk.js":389,"./km":390,"./km.js":390,"./kn":391,"./kn.js":391,"./ko":392,"./ko.js":392,"./ky":393,"./ky.js":393,"./lb":394,"./lb.js":394,"./lo":395,"./lo.js":395,"./lt":396,"./lt.js":396,"./lv":397,"./lv.js":397,"./me":398,"./me.js":398,"./mi":399,"./mi.js":399,"./mk":400,"./mk.js":400,"./ml":401,"./ml.js":401,"./mr":402,"./mr.js":402,"./ms":403,"./ms-my":404,"./ms-my.js":404,"./ms.js":403,"./mt":405,"./mt.js":405,"./my":406,"./my.js":406,"./nb":407,"./nb.js":407,"./ne":408,"./ne.js":408,"./nl":409,"./nl-be":410,"./nl-be.js":410,"./nl.js":409,"./nn":411,"./nn.js":411,"./pa-in":412,"./pa-in.js":412,"./pl":413,"./pl.js":413,"./pt":414,"./pt-br":415,"./pt-br.js":415,"./pt.js":414,"./ro":416,"./ro.js":416,"./ru":417,"./ru.js":417,"./sd":418,"./sd.js":418,"./se":419,"./se.js":419,"./si":420,"./si.js":420,"./sk":421,"./sk.js":421,"./sl":422,"./sl.js":422,"./sq":423,"./sq.js":423,"./sr":424,"./sr-cyrl":425,"./sr-cyrl.js":425,"./sr.js":424,"./ss":426,"./ss.js":426,"./sv":427,"./sv.js":427,"./sw":428,"./sw.js":428,"./ta":429,"./ta.js":429,"./te":430,"./te.js":430,"./tet":431,"./tet.js":431,"./tg":432,"./tg.js":432,"./th":433,"./th.js":433,"./tl-ph":434,"./tl-ph.js":434,"./tlh":435,"./tlh.js":435,"./tr":436,"./tr.js":436,"./tzl":437,"./tzl.js":437,"./tzm":438,"./tzm-latn":439,"./tzm-latn.js":439,"./tzm.js":438,"./ug-cn":440,"./ug-cn.js":440,"./uk":441,"./uk.js":441,"./ur":442,"./ur.js":442,"./uz":443,"./uz-latn":444,"./uz-latn.js":444,"./uz.js":443,"./vi":445,"./vi.js":445,"./x-pseudo":446,"./x-pseudo.js":446,"./yo":447,"./yo.js":447,"./zh-cn":448,"./zh-cn.js":448,"./zh-hk":449,"./zh-hk.js":449,"./zh-tw":450,"./zh-tw.js":450};function r(e){var t=s(e);return a(t)}function s(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=s,e.exports=r,r.id=623},64:function(e,t,a){"use strict";var i=a(0),r=a(2),s=a.n(r),n=a(15);t.a=class extends n.a{render(){var e=this.props,t=i.default.classNames("fancyContextMenuItem fancyContextMenuHeader flexbox c-foreground-very-faded",e.className,{"border c-border-light":!1!==e.border},{topHeader:e.topHeader}),a=i.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:e.hotkeyCentered}),r={padding:isNaN(e.padding)?void 0:e.padding};return s.a.createElement("div",{className:t,style:r},s.a.createElement("span",{className:"f1"},e.children),e.hotkey&&s.a.createElement("span",{className:a},e.hotkey))}}},65:function(e,t,a){"use strict";var i=a(57),r=a.n(i),s=a(0),n=a(1),o=a(5),l=a(2),d=a.n(l),h=a(15),c=30;t.a=class extends h.a{init(){var e=this.props;this.thumbExtraHeight=0;try{s.default.PAssert(577,!(e.noOwnScroll&&e.onScroll),"FancyScroller can not have onScroll prop if it does not own its own scroll")}catch(a){s.default.reportError(a)}var t={isVisible:!1,isDragging:!1,thumbTop:0,thumbHeight:0};this.props.trackHasScrolled&&(t.hasScrolled=!1),this.createObservables(t)}onMount(){this.refs.thumb&&s.default.setupClick(this.refs.thumb,this,{onStart:this.onTapThumbStart,onMove:this.onTapThumbMove,onEnd:this.onTapThumbEnd})}onUnmount(){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}getScrollSize(){var e=this.props.orientation!==n.a.Orientation.Horizontal?"Height":"Width";return this.props.getScrollSize?this.props.getScrollSize():this.refs.scroller["scroll"+e]}getClientHeight(){var e=this.props.orientation!==n.a.Orientation.Horizontal?"Height":"Width";return this.props.getClientHeight?this.props.getClientHeight():this.refs.scroller["client"+e]}getScrollTop(){var e=this.props.orientation!==n.a.Orientation.Horizontal?"Top":"Left";return this.props.getScrollTop?this.props.getScrollTop():this.refs.scroller["scroll"+e]}calculateThumb(){this.props;var e,t=this.getScrollSize(),a=this.getClientHeight(),i=this.getScrollTop(),r=this.props.thumbHeight;r||(t===a?r=a:(r=a/t*a,this.thumbExtraHeight=r<c?c-r:0,r=Math.floor(Math.max(r,c)))),e=t===a?0:i/(t-a)*(a-r),e=Math.floor(e);var s=r!==this.thumbHeight.get()||e!==this.thumbTop.get();this.thumbHeight.set(r,!1),this.thumbTop.set(e,s)}onScroll(e){this.handleScroll(),this.props.onScroll&&this.props.onScroll(e)}handleScroll(){this.isMouseDown||(this.calculateThumb(),this.isVisible.set(!0),this.hideTimeout()),this.props.trackHasScrolled&&this.hasScrolled.set(this.getScrollTop()>0)}onMouseMove(e){this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}onMouseEnter(e){var t=this.refs.scroller;t.scrollHeight>t.clientHeight&&(this.timeoutShow&&clearTimeout(this.timeoutShow),this.timeoutShow=setTimeout(this.showScrollbar,100))}onMouseLeave(e){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.isMouseDown||this.hideTimeout()}onTapThumbStart(e){e.button===n.a.ButtonCode.Left&&(this.isMouseDown=!0,this.lastY=this.props.orientation===n.a.Orientation.Horizontal?e.clientX:e.clientY,s.default.disableMouseMove=!0,this.isDragging.set(!0)),e.stopPropagation()}onTapThumbMove(e){if(this.isMouseDown){var t=this.refs.scroller,a=this.props.orientation===n.a.Orientation.Horizontal,i=a?e.clientX:e.clientY,r=a?"Left":"Top",o=a?"Width":"Height",l=i-this.lastY;this.lastY=i;var d=s.default.clamp(this.thumbTop.get()+l,0,t["client"+o]-this.thumbHeight.get());this.thumbTop.set(d);var h=d/(t["client"+o]-this.thumbExtraHeight)*t["scroll"+o];t["scroll"+r]=h,e.preventDefault()}}onTapThumbEnd(e){this.isMouseDown&&e.button===n.a.ButtonCode.Left&&(this.isMouseDown=!1,s.default.disableMouseMove=!1,this.isDragging.set(!1),this.hideTimeout())}hideTimeout(){this.timeoutHide&&clearTimeout(this.timeoutHide),this.timeoutHide=setTimeout(this.hideScrollbar,500)}hideScrollbar(){this.isVisible.set(!1),this.timeoutHide=void 0}showScrollbar(){this.calculateThumb(),this.isVisible.set(!0),this.timeoutShow=void 0}getElement(){return this.refs.element}getScrollElement(){return this.refs.scroller}scrollTo(e,t,a){isNaN(a)&&(a=n.a.ScrollDuration.Default),s.default.scrollTo(e,t,a,this.refs.scroller)}scrollToBottom(){var e=this.getClientHeight();this.scrollTo(0,e)}render(){var e=this.state,t=this.props,{getScrollSize:a,getClientHeight:i,getScrollTop:l,noOwnScroll:h,showScrollbars:c,trackHasScrolled:u,scrollable:p,orientation:g,tinyMode:f,onScroll:m,...v}=t,y=t.orientation===n.a.Orientation.Horizontal,_=!1!==p&&!s.default.noScrollbars,S=s.default.classNames("fancyScroller flexbox",t.className,{"flexvert horizontal":y},{vertical:!y},{trackHasScrolled:t.trackHasScrolled},{scrolled:e.hasScrolled},{tinyMode:f}),P=s.default.classNames("fancyScrollbar",{"visible c-border":e.isVisible},{dragging:e.isDragging}),I=s.default.classNames("fancyScrollbarThumb c-bg-scrollthumb",{dragging:e.isDragging}),b={};y?(b.width=e.thumbHeight,b[o.a.transform.react]="translate3d("+e.thumbTop+"px,0,0)"):(b.height=e.thumbHeight,b[o.a.transform.react]="translate3d(0,"+e.thumbTop+"px,0)");var D=s.default.classNames("fancyScrollContent",{hideScrollbar:void 0!==t.showScrollbars},{scrollable:_}),w={};return w[t.orientation===n.a.Orientation.Horizontal?"overflowX":"overflowY"]="auto",d.a.createElement("div",r()({},v,{className:S,ref:"element"}),d.a.createElement("div",{className:D,style:w,ref:"scroller",onScroll:h?void 0:this.onScroll,"data-moo-id":this.getUniqueID()},t.children),!o.a.isFirefox&&_&&c&&d.a.createElement("div",{className:P,ref:"scrollbar",onMouseMove:this.onMouseMove,onMouseEnter:this.props.tinyMode?void 0:this.onMouseEnter,onMouseLeave:this.props.tinyMode?void 0:this.onMouseLeave},d.a.createElement("div",{className:I,style:b,ref:"thumb"})))}}},66:function(e,t,a){"use strict";var i=a(0);t.a=class{_ensureListeners(){return this._listeners||(this._listeners={}),this._listeners}clearListeners(){this._listeners=void 0}listen(...e){for(var t=0,a=this._ensureListeners(),r=0;r<e.length-1;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{i.default.PAssert(123,"callbacks"!==e[r],"Invalid event name/grouping")}catch(n){i.default.reportError(n)}try{i.default.PAssert(124,i.default.isString(e[r])||i.default.isFunction(e[r]),"Only accept string or functions for listen")}catch(n){i.default.reportError(n)}a[e[r]]||(a[e[r]]={callbacks:[]}),a=a[e[r]]}var s=e[e.length-1];try{i.default.PAssert(125,i.default.isFunction(s),"Listeners must always be valid functions")}catch(n){i.default.reportError(n)}try{i.default.PAssert(126,a.callbacks.indexOf(s)<0,"Should never listen with the same function twice")}catch(n){i.default.reportError(n)}a.callbacks.push(s)}isListening(...e){var t=0,a=this._ensureListeners(),r=e[e.length-1];try{i.default.PAssert(127,i.default.isFunction(r),"Listeners must always be valid functions")}catch(n){i.default.reportError(n)}for(var s=0;s<e.length-1;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[e[s]]&&(a=a[e[s]])}return a&&a.callbacks&&a.callbacks.indexOf(r)>=0}unlisten(...e){var t=0,a=this._ensureListeners(),r=e[e.length-1];try{i.default.PAssert(128,i.default.isFunction(r),"Listeners must always be valid functions")}catch(n){i.default.reportError(n)}for(var s=0;s<e.length-1;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{i.default.PAssert(129,"callbacks"!==e[s],"Invalid event name/grouping")}catch(n){i.default.reportError(n)}try{i.default.PAssert(130,i.default.isString(e[s]),"Only accept string for unlisten")}catch(n){i.default.reportError(n)}try{i.default.PAssert(131,a[e[s]],"Cannot unlisten something that has never been listened")}catch(n){i.default.reportError(n)}a[e[s]]&&(a=a[e[s]])}try{i.default.PAssert(132,a&&a.callbacks&&a.callbacks.indexOf(r)>=0,"Cannot unlisten something that has never been listened")}catch(n){i.default.reportError(n)}a.callbacks&&a.callbacks.remove(r)}fireEvent(...e){var t=0,a=!0,r=this._ensureListeners(),s=e[e.length-1];try{i.default.PAssert(133,void 0===s||i.default.isArray(s),"Last argument to fireEvent must be an array")}catch(d){i.default.reportError(d)}for(var n=0;n<e.length-1;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{i.default.PAssert(134,"callbacks"!==e[n],"Invalid event name/grouping")}catch(d){i.default.reportError(d)}try{i.default.PAssert(135,i.default.isString(e[n])||i.default.isArray(e[n]),"Only accept strings for firing event")}catch(d){i.default.reportError(d)}if(!r[e[n]])break;var o=0;r=r[e[n]];for(var l=0;l<r.callbacks.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;try{a=r.callbacks[l].apply(this,s)&&a}catch(h){i.default.reportError(h)}}}return a}}},67:function(e,t,a){"use strict";var i=a(0),r=/^<(.*)>$/,s=/^[^:]+(?=:)/,n=0,o={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}};var l=class{constructor(e,t){this._reportError=e,this._assert=t}update({decoded:e,resources:t,options:a,mimeType:i}){var r;return this._assert(t,"Must supply a valid resource lib"),this._assert(a,"Must supply a valid options obj"),"text/plain"===i?r=this._parsePlain(e):"text/html"===i?r=this._parseHTML(e,t,a):this._reportError(new Error("Unknown email mimeType"),"Unknown email mimeType: "+i),r?r.parsed=this._escapeHTMLEntities(r.parsed):r={parsed:void 0,missingResourceData:!0},r}getAttachmentLinks({decoded:e,options:t}){var a=[],i=this._createDoc(e);if(i){var r=this._findLinkElements(i),s=this._findQuoteElements(i);try{a=this._findSpecialLinks(r,s,t).attachments}catch(n){this._reportError(n)}}return a}generatePlaintext({decoded:e}){return this._createDoc(e).body.textContent}replaceSignature({decoded:e,newSignature:t}){var a,i=this._createDoc(e),r=this._findActiveSignature(i);if(r){var s=!!r.innerHTML;if(r.innerHTML=t||"",t)s||(r.parentNode.insertBefore(i.createElement("br"),r),r.parentNode.insertBefore(i.createElement("br"),r),r.parentNode.insertBefore(i.createTextNode("--"),r),r.parentNode.insertBefore(i.createElement("br"),r));else{var n=r.previousSibling;if(n&&"BR"===n.nodeName){var o=n.previousSibling;if(o&&3===o.nodeType&&"--"===o.textContent){var l=o.previousSibling;if(l){var d=l.previousSibling;"BR"===l.nodeName&&(l.parentElement.removeChild(l),d&&"BR"===d.nodeName&&d.parentElement.removeChild(d))}n.parentElement.removeChild(n),o.parentElement.removeChild(o)}}}a=i.body.outerHTML}else a=e;return a}combineParts({partList:e}){this._assert(this._isArray(e)&&e.length>0,"Must always supply a valid part list with contents");var t=this._createDoc("<head></head><body></body>");if(this._assert(t,"Must always be able to create a valid document for first part in list"),t)for(var a=0,i=0;i<e.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._ensurePartDoc(e[i]);if(r)try{this._mergeDocs(r,t)}catch(s){this._reportError(s)}}return t?t.body.outerHTML:" "}removeElementsByAttribute({decoded:e,attr:t,value:a}){this._assert(this.isString(e),"Must pass in a valid decoded HTML email string"),this._assert(this.isString(t),"Must provide a valid item ID");var i=!1;try{var r=this._createDoc(e);r&&(i=this._removeElementsByAttribute(r,t,a))}catch(s){this._reportError(s)}return i?r.body.outerHTML:e}sanitizeContent({decoded:e}){var t;if(e){var a=this._createDoc(e);try{let e=a.body;this._traverseNode(e,e=>{e.nodeType===Node.TEXT_NODE?e.textContent=new Array(e.textContent.length+1).join("#"):"A"===e.nodeName&&e.removeAttribute("href")}),t=e.outerHTML}catch(i){this._reportError(i),t="<<SANITIZED>>"}}else t="<<NO HTML CONTENT>>";return t}getComposeBody({decoded:e,resources:t}){var a=!1;try{var i=this._createDoc(e);if(i){a=this._removeElementsByAttribute(i,"moodoAttach","true");var r=this._updateResourceImages(i,t);a=a||r.didUpdate}}catch(s){this._reportError(s)}return a?i.body.outerHTML:e}parseResourceID(e){var t;r.lastIndex=0;var a=r.exec(e);return a&&a[1]&&(t=a[1]),t}_escapeHTMLEntities(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,e=>"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";").replace(/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,e=>"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";")}_ensurePartDoc(e){var t;switch(e.mimeType){case"text/plain":t=this._createDoc(this._parsePlain(e.decoded).parsed);break;case"text/html":t=this._createDoc(e.decoded);break;default:this._assert(!1,"Unknown display part mimeType: "+e.mimeType)}return t}_hasClass(e,t){return e.classList.contains(t)}_mergeDocs(e,t){let a=e.body,i=t.body;if(a){var r=t.importNode(a,!0),s=t.createElement("div");try{for(var n=0,o=0;o<r.attributes.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=r.attributes[o];s.setAttribute(l.name,l.value)}}catch(h){this._reportError(h)}try{for(var d=0;r.childNodes&&r.childNodes.length>0;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;s.appendChild(r.firstChild)}}catch(h){this._reportError(h)}try{i.appendChild(s)}catch(h){this._reportError(h)}}}_removeElementById(e,t){var a=!1,i=e.getElementById(t);return i&&(i.parentNode.removeChild(i),a=!0),a}_removeElementsByAttribute(e,t,a){var i,r=0,s=!1;i=void 0!==a&&null!==a?e.querySelectorAll("["+t+'="'+a+'"]'):e.querySelectorAll("["+t+"]");for(var n=0;n<i.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i[n];o.parentNode.removeChild(o),s=!0}return s}_createFragment(){return{lines:[],isQuote:!1}}_createPlainFragments(e){var t=0,a=[],i=e.split("\n"),r=this._createFragment();a.push(r);for(var s=0;s<i.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=i[s].trim(),o=new RegExp(/^>+/).test(n);r.lines.length>0&&o!==r.isQuote&&""!==n&&(r=this._createFragment(),a.push(r)),r.lines.push(n),r.isQuote=r.isQuote||o}return a}_getFragmentText(e){var t,a,i=0,r="";if(e.isQuote){var s=this._generatePlaceholderID();t='<div id="'+s+'" place="true"></div><p quote="collapsed" group="'+s+'">',a="</p>"}else t="",a="";for(var n=0;n<e.lines.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r+=e.lines[n]+"\n"}return t+r+a}_joinPlainFragments(e){for(var t=0,a="",i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[i];a+=this._getFragmentText(r)}return a}_parsePlain(e){var t,a=this._escapeHTMLEntities(e),i=this._createPlainFragments(a);try{t=(t=this._joinPlainFragments(i)).replace(/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,'<a mlink="true" href="$1">$1</a>')}catch(r){this._reportError(r),t="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+t+"</body><html>"}}_parseHTML(e,t,a){var i={parsed:void 0},r=this._createDoc(e),s=this._findQuoteElements(r);if(s=this._cleanupDocQuotes(r,s),this._isFullQuote(r,s)||this._collapseAndMarkQuotes(r,s,!!a.collapseQuotes),a.createLinksFromText)try{this._createLinksFromText(r)}catch(l){this._reportError(l)}var n=this._findLinkElements(r);this._markLinks(n);try{i.specialLinks=this._findSpecialLinks(n,s,a)}catch(l){this._reportError(l)}try{i.parsedMetadata=this._parseMetadata(r)}catch(l){this._reportError(l)}try{var o=this._updateResourceImages(r,t);i.missingResourceData=o.missingData}catch(l){this._reportError(l)}return this._trimTrailingWhitespace(r),this._trimQuoteWhitespace(s),i.parsed=r.body.outerHTML,i}_traverseNode(e,t){if(!1!==t(e)&&e.childNodes)for(var a=0,i=e.childNodes.length-1;i>=0;i--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._traverseNode(e.childNodes[i],t)}}_sanitizeInputDoc(e,t){var a=o[t];let i=e.body;i&&this._traverseNode(i,e=>{if(e.nodeType===Node.COMMENT_NODE)this._assert(!e.childNodes||0===e.childNodes.length,"A comment node should never have children"),e.parentNode.removeChild(e);else if(e.nodeType===Node.TEXT_NODE);else if(a.bannedTags.indexOf(e.tagName.toLowerCase())>=0)e.parentNode.removeChild(e);else if(e.attributes.length>0){for(var t=0,i=a.allowedTagAttributes[e.tagName],r=e.attributes.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e.attributes[r].name;if(a.allowedAttributes.indexOf(s)<0&&(!i||i.indexOf(s)<0))e.removeAttribute(s);else{var n=e.getAttribute(s);n&&n.startsWith("javascript:")&&(console.log("Remove Inline JS: ",e.tagName,s),e.removeAttribute(s))}}var o=e.getAttribute("height");o&&o.indexOf("%")>=0&&(e.removeAttribute("height"),console.log("Remove Height: ",e.tagName,o))}})}_createDoc(e){var t,a=new DOMParser;try{if(t=a.parseFromString(e,"text/html")){var i=this._parseJSONLD(t);this._sanitizeInputDoc(t,"Default"),i&&i.length>0&&this._reportMetadata(t,i)}}catch(r){this._reportError(r);try{t=a.parseFromString("Error parsing email message","text/html")}catch(s){this._reportError(s)}}return t}_updateResourceImages(e,t){for(var a=0,i={missingData:!1,didUpdate:!1},r=this._findImageElements(e),s=0;s<r.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=r[s],o=n.src;if(o.startsWith("cid:")){var l=o.substr(4);if(l){n.setAttribute("cid",l);var d=t[l];if(d&&d.data){var h="data:"+d.mimeType+";base64,"+d.data;n.src=h,i.didUpdate=!0}else n.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",i.didUpdate=!0,d||(i.missingData=!0)}else n.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",i.didUpdate=!0}}return i}_findImageElements(e){return e.querySelectorAll("img")}_findLinkElements(e){return Array.prototype.slice.call(e.querySelectorAll("a"))}_sanitizeLink(e){if(e&&e.hasAttribute("href")){e.setAttribute("mlink","true");var t=e.getAttribute("href");t.startsWith("file:")?e.setAttribute("href",""):s.exec(t)||e.setAttribute("href","https://"+t)}}_createLinksFromText(e){let t=e.body;this._traverseNode(t,t=>{var a=!0;if(t.nodeType===Node.TEXT_NODE){var i=t.textContent;if(i.indexOf("http")>=0||i.indexOf("www.")>=0){var r=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,s=t.textContent.replace(r,'<a href="$1">$1</a>'),n=e.createElement("div");n.innerHTML=s;var o=n.childNodes?n.childNodes.length:0;if(o>1||1===o&&"A"===n.childNodes[0].nodeName){for(var l=0;n.firstChild;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;t.parentNode.insertBefore(n.firstChild,t)}t.parentNode.removeChild(t)}}}else"A"===t.tagName&&(a=!1);return a})}_markLinks(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._sanitizeLink(e[a])}}_isAttachmentURL(e){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(e)}_findSpecialLinks(e,t,a){for(var i=0,r={unsubscribe:[],twitter:[],attachments:[]},s=0;s<e.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=e[s];n.href&&this._isAttachmentURL(n.href)&&(a.ignoreQuotedAttachments&&this._isInsideQuote(n,t)||r.attachments.push({href:n.href,cid:n.id,name:n.innerText,type:"application/octet-stream"}))}return r}_parseMetadata(e){var t=this._parseMicrodata(e);return t&&t.length>0&&this._reportMetadata(e,t),t}_reportMetadata(e,t){}_parseJSONLD(e){for(var t=0,a=[],i=e.getElementsByTagName("script"),r=0;r<i.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i[r];if("application/ld+json"===s.getAttribute("type")){var n=s.textContent.trim();if(n)try{var o=JSON.parse(n);a.push(o)}catch(l){this._reportError(new Error("Invalid JSONLD Schema String"),n)}}}return a}_parseMicrodata(e){var t=e.querySelectorAll("[itemscope]");return Array.prototype.map.call(t,e=>{if(!e.hasAttribute("itemprop"))return this._parseMicrodataScope(e)}).filter(e=>!!e)}_parseMicrodataScope(e){var t={type:e.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(t,e),t}_recurseMicrodataScope(e,t){var a=0;let i=t.children;for(var r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i[r];if(s.hasAttribute("itemprop")){var n,o=s.getAttribute("itemprop");if(s.hasAttribute("itemscope"))n=this._parseMicrodataScope(s);else switch(s.tagName.toLowerCase()){case"a":case"area":case"link":n=s.getAttribute("href");break;case"meta":n=s.getAttribute("content");break;case"img":n=s.getAttribute("src");break;case"data":case"meter":n=s.getAttribute("value");break;case"time":n=s.getAttribute("datetime");break;default:n=s.hasAttribute("content")?s.getAttribute("content"):s.textContent}o&&n&&(e.properties[o]=n)}else this._recurseMicrodataScope(e,s)}}_cleanupDocQuotes(e,t){return t.filter(e=>{var t=!1;return"BLOCKQUOTE"===e.nodeName&&"cite"===e.getAttribute("type")&&this.parseResourceID(e.innerText)&&e&&e.parentNode&&(e.parentNode.removeChild(e),t=!0),!t})}_generatePlaceholderID(){return"~T"+Date.now()+ ++n}_createQuotePlaceholder(e){var t=e.createElement("div");return t.id=this._generatePlaceholderID(),t.setAttribute("place","true"),t}_findFirstSiblingQuote(e,t){for(var a=0,i=e;i.previousElementSibling&&t.indexOf(i.previousElementSibling)>=0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=i.previousElementSibling}return i}_markAdjacentQuotes(e,t,a,i){for(var r=0;e&&a.indexOf(e)>=0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.setAttribute("quote",i),e.setAttribute("group",t),e=e.nextElementSibling}}_collapseAndMarkQuotes(e,t,a){for(var i=0,r=0;r<t.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t[r];if(!s.getAttribute("quote")){var n=this._findFirstSiblingQuote(s,t),o=this._createQuotePlaceholder(e),l=0===r&&a?"collapsed":"uncollapsed";this._markAdjacentQuotes(n,o.id,t,l),n.parentNode.insertBefore(o,s)}}}_removeQuote(e){e&&e.parentNode&&e.parentNode.removeChild(e)}_isFullQuote(e,t){for(var a=0,i=!0,r=e.body,s=0;r.childNodes&&s<r.childNodes.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=r.children[s];if(""!==n.textContent.trim()&&t.indexOf(n)<0&&t.indexOf(n.firstElementChild)<0){i=!1;break}}return i}_findQuoteElements(e){var t=this._findGmailQuotes(e),a=this._findOffice365Quotes(e),i=this._findBlockquoteQuotes(e),r=[];return this.pushOnlyUniques(r,t),this.pushOnlyUniques(r,a),this.pushOnlyUniques(r,i),r=this._cleanupGmail(r),r=this._removeEmptyQuotes(r)}_cleanupGmail(e){return e.filter(t=>{var a=!1;if("BLOCKQUOTE"===t.nodeName&&this._hasClass(t,"gmail_quote"))for(var i=0,r=0;r<e.length;++r){var s=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var n=t.parentElement;n;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(this._hasClass(n,"gmail_quote")){"DIV"===n.nodeName&&(a=!0);break}n=n.parentElement}}return!a})}_removeEmptyQuotes(e){return e}_findGmailQuotes(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_quote"))}_findOffice365Quotes(e){var t=Array.prototype.slice.call(e.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),a=e.getElementById('3D"divRplyFwdMsg"');return a&&t.push(a),t=t.map(e=>e.previousElementSibling&&"HR"===e.previousElementSibling.nodeName?e.parentElement:e)}_findBlockquoteQuotes(e){return Array.prototype.slice.call(e.querySelectorAll("blockquote"))}_findGmailSignatures(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_signature"))}_findActiveSignature(e){for(var t,a=0,i=this._findGmailSignatures(e),r=this._findQuoteElements(e),s=i.length-1;s>=0&&!t;s--){var n=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var o=i[s],l=!0,d=0;d<r.length;++d){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this._isAncestor(o,r[d])){l=!1;break}}l&&(t=o)}return t}_isAncestor(e,t){for(var a=0;e&&e!==t;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=e.parentElement}return!!e}_trimTrailingWhitespace(e){for(var t=0,a=e.body.childNodes,i=[],r=a.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[r],n=a[r-1];if(!s||"BR"!==s.nodeName||!n||"BR"!==n.nodeName)break;i.push(s)}this._removeElements(i)}_trimQuoteWhitespace(e){for(var t=0,a=[],i=0;i<e.length;++i){var r=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var s=e[i].previousElementSibling;s;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;"BR"===s.nodeName&&s.previousElementSibling&&"BR"===s.previousElementSibling.nodeName&&a.push(s),s=s.previousElementSibling}}this._removeElements(a)}_removeElements(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];try{i.parentNode&&i.parentNode.removeChild(i)}catch(r){}}}_isInsideQuote(e,t){for(var a=0;e.parentNode;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.indexOf(e.parentNode)>=0)return!0;e=e.parentNode}return!1}_isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}isString(e){return"string"===typeof e}pushOnlyUniques(e,t,a){var i=0;if(!t)return e;for(var r=0,s=t.length;r<s;++r){var n=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o=!0,l=0,d=e.length;l<d;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(a&&a(t[r],e[l])||!a&&t[r]===e[l]){o=!1;break}}o&&e.push(t[r])}return e}};var d=class{sanitizePlaintext(e){return e?/^\s*$/.test(e)?"":"<<NonHTML-Sanitized: "+e.length+">>":"<<NO CONTENT>>"}};t.a=new class extends d{constructor(){super(),this.helper=new l(i.default.reportError,i.default.Assert)}async update(e,t,a,i){return this.helper.update({decoded:e,resources:t,options:a,mimeType:i})}async getAttachmentLinks(e,t){return this.helper.getAttachmentLinks({decoded:e,options:t})}async generatePlaintext(e){return this.helper.generatePlaintext({decoded:e})}async replaceSignature(e,t){return this.helper.replaceSignature({decoded:e,newSignature:t})}async combineParts(e){return this.helper.combineParts({partList:e})}async removeElementsByAttribute(e,t,a){return this.helper.removeElementsByAttribute({decoded:e,attr:t,value:a})}async sanitizeContent(e){return this.helper.sanitizeContent({decoded:e})}async getComposeBody(e,t){return this.helper.getComposeBody({decoded:e,resources:t})}}},680:function(e,t,a){"use strict";a.r(t);var i=a(0),r=a(17),s=a(21),n=function(){},o=function(){return{}},l=function(){return{then:n,execute:n}};function d(){this.cache={},this.loadedGapiData={},this._isRemoteHooked=!1,this.resetListener=void 0}d.prototype={setGapiData:function(e,t){try{i.default.PAssert(381,i.default.isObject(t)&&!i.default.isArray(t),"Setting malformed data",e)}catch(r){i.default.reportError(r)}for(var a in this.loadedGapiData[e]=[],t)t[a].id=a,this.loadedGapiData[e].push(t[a])},setGapiDataDirect:function(e,t){try{i.default.PAssert(382,i.default.isArray(t),"Setting malformed data",e)}catch(a){i.default.reportError(a)}this.loadedGapiData[e]||(this.loadedGapiData[e]=t)},clearGapiData:function(){this.loadedGapiData={}},loadRemoteData:function(e,t){try{i.default.PAssert(383,e&&t,"Must supply valid remote load info as well as a cb when data is loaded")}catch(r){i.default.reportError(r)}var a=e.split(":");if(this.cache[a[0]])t(JSON.parse(JSON.stringify(this.cache[a[0]][a[1]])));else{let e=!a[0].endsWith(".txt"),r=e?a[0]+".json":a[0];i.default.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+r}).then(async r=>{if(200===r.status)if(e){let e=await r.json();this.cache[a[0]]=e,a[1]||(a[1]="0");let s=e[a[1]];if(s){let e=JSON.parse(JSON.stringify(s));t(e)}else i.default.log("Invalid data slot")}else{let e=r.responseText.split("\n");e="tags"===a[1]?e.map(e=>{if(e.length>0){var t=0,a=e.split(" ");for(let e=0;e<a.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;Math.random()<.8&&(a[e]="#"+a[e])}e=a.join(" ")}return{text:e}}):e.map(e=>({text:e})),t([{text:"Outline",items:e}])}else i.default.log("Error getting demo data",r.status,r.responseText)})}},stubGapi:function(){try{i.default.PAssert(384,!window.gapi,"Should not have loaded gapi when stubbing")}catch(a){i.default.reportError(a)}var e=[];r.a.listen("resetEverything",function(){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;clearTimeout(e[a])}e=[]});var t=function(t,a){var i=setTimeout(function(){e.remove(i),t({success:!0})},0);e.push(i)};window.gapi={auth:{getToken:function(){return{expires_in:3600,expires_at:Math.floor((Date.now()+i.default.minutes(60))/1e3),access_token:"InvalidToken",id_token:"InvalidIDToken",scope:[C.GScope.UserInfoEmail,C.GScope.Calendar,C.GScope.GmailCompose,C.GScope.GmailModify]}}},client:{request:function(e){return{then:function(t,a,i){return s.a.getAPIForRequest(e)(e.__rawParams).then(t,a,i)},execute:function(){}}},load:n,setApiKey:n,newBatch:function(){return{add:n,then:t}},drive:{files:{get:l,list:l,trash:l,insert:l,patch:l},permissions:{list:l,insert:l,delete:l},properties:{insert:l},parents:{insert:l},changes:{list:l}},gmail:{users:{threads:{list:l,get:l,modify:l,trash:l,untrash:l},labels:{list:l,create:l},history:{list:l},messages:{get:l,send:l,trash:l,untrash:l},drafts:{create:l,update:l,send:l,delete:l,list:l},settings:{sendAs:{list:l}}}},calendar:{settings:{list:l},events:{get:l,list:l,patch:l,insert:l,delete:l},calendars:{insert:l},calendarList:{list:l}}}}},areRemoteFunctionsHooked:function(){return this._isRemoteHooked},hookRemoteFunctions:function(){try{i.default.PAssert(385,!this._isRemoteHooked,"Should not hook remote functions more than once")}catch(u){i.default.reportError(u)}function e(e,t){var a=0;try{i.default.PAssert(386,e,"Must load local or remote data to perform queries")}catch(u){i.default.reportError(u)}for(var r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e[r].id===t)return e[r]}}function t(e,t,a){try{i.default.PAssert(388,e,"Must load local or remote data to perform queries")}catch(u){i.default.reportError(u)}var r=[];if(i.default.isArray(a));else if(e)for(var s=0,n=0;n<e.length;++n){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e[n][t]===a&&r.push(e[n])}return r}function a(e,t,a){var r=0;try{i.default.PAssert(389,e,"Must load local or remote data to perform queries")}catch(u){i.default.reportError(u)}for(var s=[],n=0;n<e.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e[n][t].indexOf(a)>=0&&s.push(e[n])}return s}this.stubGapi(),this._isRemoteHooked=!0;var s=0,n=[],l=this;function d(e){return function(t,a,r){var o;try{o=e(r)}catch(d){i.default.reportError(d)}var l=setTimeout(function(){n.remove(l),o?t.call(r,{result:o}):a.call(r,{error:!0})},s);n.push(l)}}function h(e){return function(t,a,i){var r=e(i),o=setTimeout(function(){n.remove(o),r?t(r):a({error:!0})},s);n.push(o)}}function c(e){return{then:d(e),execute:h(e)}}r.a.listen("resetEverything",function(){for(var e=0,t=0;t<n.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;clearTimeout(n[t])}n=[]}),gapi.client.drive.files.get=function(t){return c(function(a){return e(l.loadedGapiData.Drive,t.fileId)})},gapi.client.drive.files.list=function(e){return c(function(t){if("mimeType='application/vnd.google-apps.drive-sdk.597847337936' and trashed=false"===e.q)return{items:l.loadedGapiData.documents};var r=/\'(.*)\' in parents/g.exec(e.q),s=/title contains \'([^\']*)\'/g.exec(e.q),n=/mimeType contains \'([^\']*)\'/g.exec(e.q),o=l.loadedGapiData.Drive;return r&&(o=function(e,t){var a=0;try{i.default.PAssert(387,e,"Must load local or remote data to perform queries")}catch(u){i.default.reportError(u)}for(var r=[],s=0;s<e.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;(e[s].parents[0].id===t||"root"===t&&e[s].parents[0].isRoot)&&r.push(e[s])}return r}(o,r[1])),s&&(o=a(o,"title",s[1])),n&&(o=a(o,"mimeType",n[1])),{items:o}})},gapi.client.drive.files.trash=function(e){return c(o)},gapi.client.drive.files.insert=function(e){return c(o)},gapi.client.drive.files.patch=function(e){return c(o)},gapi.client.drive.permissions.list=function(e){return c(function(e){return{items:l.loadedGapiData.permissions}})},gapi.client.drive.permissions.insert=function(e){return c(o)},gapi.client.drive.permissions.delete=function(e){return c(o)},gapi.client.drive.properties.insert=function(e){return c(o)},gapi.client.gmail.users.threads.list=function(e){return c(function(a){return{threads:t(l.loadedGapiData.Gmail,"hideInPane",void 0).filter(function(t){return"me"===e.userId||t.accountID===e.userId})}})},gapi.client.gmail.users.threads.modify=function(t){return c(function(a){var i=e(l.loadedGapiData.Gmail,t.id)[0];if(!i)return{};if(i.labelIds||(i.labelIds=[]),t.removeLabelIds)for(var r=0,s=0;s<t.removeLabelIds.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i.labelIds.remove(t.removeLabelIds[s])}t.addLabelIds&&i.labelids.pushOnlyUniques(t.addLabelIds)})},gapi.client.gmail.users.threads.get=function(t){return c(function(a){return e(l.loadedGapiData.Gmail,t.id)})},gapi.client.gmail.users.messages.get=function(e){return c(function(t){return function(e,t){var a=0;try{i.default.PAssert(390,e,"Must load local or remote data to perform queries")}catch(u){i.default.reportError(u)}for(var r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t(e[r]);if(s)return s}}(l.loadedGapiData.Gmail,function(t){for(var a=0,i=0;i<t.messages.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.messages[i].id===e.id)return t.messages[i]}})})},gapi.client.gmail.users.messages.send=function(e){return c(function(t){return{id:i.default.generateTempId(),threadId:e.resource.threadId||i.default.generateTempId().substr(3),labelIds:["SENT","UNREAD"]}})},gapi.client.gmail.users.labels.list=function(e){return c(function(e){return{labels:l.loadedGapiData.Gmail_Labels}})},gapi.client.gmail.users.labels.create=function(e){return c(function(a){var r=t(l.loadedGapiData.Gmail_Labels,"name",e.resource.name)[0];if(r)return r;var s=i.default.generateTempId().substr(3);return r={name:e.resource.name,id:s},l.loadedGapiData.Gmail_Labels||(l.loadedGapiData.Gmail_Labels=[]),l.loadedGapiData.Gmail_Labels.push(r),r})},gapi.client.gmail.users.settings.sendAs.list=function(e){return c(function(e){return{sendAs:[{displayName:"Demo User",isDefault:!0,isPrimary:!0,replyToAddress:"",sendAsEmail:"demo@moo.do",signature:""}]}})},gapi.client.calendar.calendarList.list=function(e){return c(function(e){return{items:l.loadedGapiData.calendarList}})},gapi.client.calendar.events.get=function(t){return c(function(a){return e(l.loadedGapiData.GCalendar,t.eventId)})}}},t.default=new d},70:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(2),n=a.n(s),o=a(9),l=a(15),d=300;t.a=class extends l.a{init(){var e={animCheck:!1};this.props.checked instanceof o.a?(this.checked=this.props.checked,this.trackObservable=!0):e.checked=this.props.checked||this.props.initialChecked,this.createObservables(e)}getState(){return this.trackObservable?{checked:this.checked}:{}}onClick(){var e=this.props;if(!e.disabled){this.animCheck.set(!0),setTimeout(function(){this.animCheck.set(!1)}.bind(this),d);var t=!this.checked.get();this.trackObservable&&!e.setObs||this.checked.set(t),e.onChange&&e.onChange(t)}e.onClick&&e.onClick(t)}getValue(){return this.checked.get()}setValue(e){return this.checked.set(e)}resetValue(){void 0!==this.props.initialChecked&&this.checked.set(this.props.initialChecked)}onKeyDown(e){e.keyCode===r.a.KeyCode.Enter&&this.onClick()}onChangeInput(){}componentWillReceiveProps(e){this.trackObservable||void 0===e.checked||e.checked===this.state.checked||this.checked.set(e.checked)}getElement(){return this.refs.element}getChildren(){return this.props.children}render(){var e=this.props,t=this.state.checked,a={background:t&&e.checkedColor,width:e.size,height:e.size,lineHeight:e.size&&e.size-1+"px",fontSize:e.size&&e.size-4+"px"},r=i.default.classNames("fancyCheckbox",{checked:t},{disabled:e.disabled},{animate:this.state.animCheck},{radio:e.radio},{error:e.error},{noBG:e.noBG},e.className),s=i.default.classNames("fancyCheckboxText"),o=i.default.classNames("fancyCheckboxCheck",{"c-button-raised-primary":t&&!e.disabled}),l=n.a.createElement("span",{className:o,style:a});return n.a.createElement("span",{className:r,onClick:!1!==e.canChange?this.onClick:void 0,id:e.id,style:e.style,tabIndex:e.tabIndex,onKeyDown:this.onKeyDown,ref:"element"},n.a.createElement("input",{className:"fancyCheckboxInput",type:"checkbox",checked:t||!1,onChange:this.onChangeInput}),l,this.props.children&&n.a.createElement("span",{className:s},this.props.children))}}},73:function(e,t,a){"use strict";var i=a(0);const r=1e5;t.a=new class{constructor(){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}ab2str(e){let t="";try{let d=new Uint8Array(e);if(d.length>r){var a,s,n,o=0;for(a=0,s=d.length;a<s;a+=r){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;n=d.slice(a,a+r),t+=String.fromCharCode.apply(null,n)}}else t=String.fromCharCode.apply(null,d)}catch(l){i.default.reportError(l)}return t}str2ab(e){for(var t=0,a=new ArrayBuffer(e.length),i=new Uint8Array(a),r=0,s=e.length;r<s;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[r]=e.charCodeAt(r)}return i}unicode2ab(e){return this.textEncoder.encode(e)}ab2unicode(e){return this.textDecoder.decode(e)}}},77:function(e,t,a){"use strict";var i=a(57),r=a.n(i),s=a(0),n=a(2),o=a.n(n),l=a(71),d=a.n(l),h=a(15),c=1e3;t.a=class extends h.a{init(){this.createObservables({ripples:[]}),this.rippleNum=0}getElement(){return d.a.findDOMNode(this)}onMouseDown(e){var t=this.props;if(!1!==t.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(e),this.props.children&&!e.defaultPrevented&&!1!==t.ripple){var a,i,r=this.refs.element,n=r.offsetWidth,o=r.offsetHeight,l=Math.min(n,o);if(this.props.center)a="50%",i="50%";else{var d=s.default.offset(r);a=e.clientX-d.left,i=e.clientY-d.top}var h={id:this.rippleNum++,left:a,top:i,width:l,height:l};this.ripples.push(h),setTimeout(this.removeRipple,c)}e.stopPropagation()}}onRightClick(e){e.preventDefault(),e.stopPropagation(),this.props.onRightClick(e)}removeRipple(){this.ripples.removeAt(0)}render(){for(var e=0,t=this.state,a=this.props,i=[],n=0;n<t.ripples.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;let a=t.ripples[n],r={left:a.left,top:a.top,width:a.width,height:a.height,marginLeft:-a.width/2,marginTop:-a.height/2};i.push(o.a.createElement("div",{key:"ripple_"+a.id,className:"fancyRipple",style:r}))}let l=s.default.classNames(this.props.className,"fancyRippler",{rippleCenter:this.props.center}),{center:d,onClick:h,enabled:c,ripple:u,onRightClick:p,...g}=a;return o.a.createElement("div",r()({},g,{className:l,onMouseDown:this.onMouseDown,onClick:h,onContextMenu:p?this.onRightClick:void 0,ref:"element"}),this.props.children,i.length>0&&o.a.createElement("div",{className:"fancyRipples"},i))}}},86:function(e,t,a){"use strict";var i=a(0),r=a(2),s=a.n(r),n=a(15);t.a=class extends n.a{render(){let{style:e,size:t,left:a,top:r,center:n,inline:o,color:l,children:d}=this.props;e=Object.assign({},e);var h=(t=t||20)||20,c={fontSize:t,height:h,width:h,lineHeight:h+"px",color:l};(r||a)&&(e.position="absolute",e.left=a||"50%",e.top=r||"50%",c.marginLeft=-t/2,c.marginTop=-t/2+20);var u=i.default.classNames("fancyLoader",{center:n},{inline:o}),p={color:l};return s.a.createElement("div",{className:u,style:e},s.a.createElement("div",{className:"icon-spinner",style:c}),d&&s.a.createElement("div",{className:"fancyLoaderText",style:p},d))}}},88:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(6),o=a(13),l=a(103),d=a(96),h=a(27);t.a=new class{_setSectionValue(e,t,a){e.hasOwnProperty(t)||(e[t]=a)}_parseSection(e,t){for(var a=0,r={},s=t;s<e.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e[s];if(n){var o=n.indexOf(":"),l=[n.substr(0,o),n.substr(o+1)],d=l[0].split(";");switch(d[0]){case"BEGIN":var h=this._parseSection(e,s+1);s+=h.size,r[l[1]]=h.section;break;case"END":return{section:r,size:s-t+1};default:if(d.length>1){for(var c=0,u={value:l[1]},p=1;p<d.length;++p){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var g=d[p].split("=");try{i.default.PAssert(681,!u.hasOwnProperty(g[0]),"Should never overwrite line values")}catch(f){i.default.reportError(f)}u[g[0]]=g[1]}this._setSectionValue(r,d[0],u)}else this._setSectionValue(r,d[0],l[1]);break;case void 0:case null:try{i.default.PAssert(682,!1,"Invalid ICS format: "+n)}catch(f){i.default.reportError(f)}}}}return r}parseICS(e){for(var t=0,a=e.split("\n"),i=[],r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[r];s.startsWith(" ")?i[i.length-1]+=s.trim():i.push(s.trim())}return this._parseSection(i,0)}parseHead(e){for(var t=0,a={},i=0;i<e.childElementCount;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e.children[i],s=r.nodeName;if(r.firstChild){var n=r.firstChild.textContent;a[s]=n}}return a}parseOPML(e,t){let a=t.getDocumentOwner();var s=(e,n)=>{var l,d=!0;switch(e.nodeName){case"#document":case"body":case"opml":break;case"head":d=!1;var h=this.parseHead(e);h&&h.title&&a.setText(h.title);break;case"outline":n||t&&(n=t);var c=e.attributes.text,u=c?c.value:"",p=e.attributes.complete||e.attributes._complete,g=!(!p||"true"!==p.value),f=e.attributes.note||e.attributes._note||e.attributes.Notes,m={text:i.default.stripFormattingTags(u).replace(/[\r\n\t]/g," "),isComplete:g};if(l=o.a.createVMLI(m,{parent:n,changeType:r.a.ChangeType.AllLocal,documentOwner:a}),n.insertItem(l),f){var v={text:f.value,isNote:!0},y=o.a.createVMLI(v,{parent:l,changeType:r.a.ChangeType.AllLocal,documentOwner:a});l.setNote(y,r.a.ChangeType.AllLocal)}break;default:i.default.log("Unknown OPML Node: ",e)}if(d)for(var _=0,S=0;S<e.childElementCount;++S){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;s(e.children[S],l)}return l};return n.d.beginAction(),s(e,t),n.d.endAction(),!0}createItemsFromTree(e,t){}async parseJSON(e,t){if(void 0!==e.moodoVer&&(void 0!==e.moodoRoot||void 0!==e.items))try{let r;if(i.default.parseInt(e.moodoVer),e.doc){let a,n={};if(e.sentinel){let t=s.default.crypto.getKeyBySentinel(e.sentinel);if(!t)return null;a=await Promise.all(e.items.map(e=>h.a.decryptItemIn(e,s.default.crypto,t)))}else a=e.items.map(h.a.itemIn);t&&(a=a.map(e=>{let t=n[e.id];if(t||(t=o.a.generateID(),n[e.id]=t),e.id=t,e.parent){e.parent=n[e.parent];try{i.default.PAssert(683,e.parent,"Imported item has no parent")}catch(a){i.default.reportError(a)}}return e})),d.a.createItemHierarchy(a),r={rootData:a[0],root:a[0],text:e.doc.text,items:a}}else(r=(new l.a).translateDocument({root:e.moodoRoot},!1))&&(r.rootData=r.root);return t&&r&&(r.root.id=o.a.generateID()),r}catch(a){i.default.reportError(a)}return!1}_findLineParent(e,t,a){for(var i,r=0,s=Math.min(e.length-1,t-1);s>=0;--s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[s];if(n&&n.indentLevel===a-1){i=n;break}}return i}parseText(e){for(var t=0,a={items:[]},i=[],r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=this._parseTextLine(e[r]);if(s){i.push(s);var n=this._findLineParent(i,r,s.indentLevel)||a;s.parent=n,n.items.push(s)}}return a}_parseTextLine(e){if(e&&e.length>0)return{indentLevel:Math.floor(e.search(/\S|$/)/4),text:i.default.trimString(e.replace(/[\ud800-\udfff]+/g,"")),items:[]}}_addMulti(e,t,a){return e[t]||(e[t]=a),e[t]}_getReference(e,t){var a;return"Evernote"!==t.type&&(a=e[t.value]),a}_hasReference(e,t){var a=!0;return"Evernote"!==t.type&&(a=!!e[t.value]),a}_lookupNode(e,t){return e[i.default.hashString(t)]}_storeNode(e,t,a){e[i.default.hashString(t)]=a}_beginImport(e){this._reportedImportError=!1,this._rawImportData=e}_endImport(){this._reportedImportError=!1,this._rawImportData=void 0}_reportRecursiveImport(){this._reportRecursiveImport||i.default.reportError(new Error("Recursive import failure"),this._rawImportData)}_parseEntries(e){var t=[];if(e){for(var a=0,i=0,r=e.split(", "),s=["Organization","Contact","Prospect","Email","Evernote","Project","Sub-Project","Subtask","Action"],n=[],o=r.length-1;o>=0;o--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=r[o],d=/^([^:]*):\s(.*)/.exec(l);(!d||!d[1]||s.indexOf(d[1])<0)&&o>0?(r[o-1]+=", "+r[o],r.removeAt(o)):n.push(l)}for(o=0;o<n.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var h=n[o],c=h.indexOf(":");if(c>0){var u=h.substr(0,c),p=h.substr(c+2);t.push({type:u,value:p})}}}return t}stripParents(e){if(e.parent=void 0,e.items)for(var t=0,a=0;a<e.items.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.stripParents(e.items[a])}}parseClassName(e,t){if(e)return e.indexOf("high")>=0?t.priority=r.a.VMLIFlag.P0:e.indexOf("medium")>=0?t.priority=r.a.VMLIFlag.P1:e.indexOf("low")>=0&&(t.priority=r.a.VMLIFlag.P2),e.indexOf("complete")>=0&&(t.isComplete=!0),e.indexOf("starred")>=0&&(t.isStarred=!0),e.indexOf("note")>=0&&(t.isNote=!0),t}traverseDOM(e){var t,a,r,s=0,n=e.root,o=e.stripParents,l=e.shouldPrint,d=e.preserveWhitespace,h=n.firstChild,c={text:"",parent:void 0,items:[]},u=c,p=!1,g=!1,f=!1;let m=e=>{let s=e;if(e.nodeType===Node.TEXT_NODE){(g||p)&&(d||(u.text=u.text.replace(/^ +/g,"").replace(/ +$/g,"")),""===u.text&&f||(f||(f=!0,u={text:"",parent:u,date:void 0}),t={text:"",parent:u.parent,date:r},this.parseClassName(a,t),i.default.hasClass(e.parentNode,"note")?(t.isNote=!0,u._note=t):u.parent.items.push(t),u=t,r=void 0)),g=!1,p=!1;var n=e.nodeValue.replace(/[\ud800-\udfff]+/g,"");""===u.text&&(n=d?n.replace(/^[\r\n\t]+/g,""):n.replace(/^[ \r\n\t]+/g,"")),this.parseClassName(a,u),r&&(u.date=r),u.text+=i.default.stripFormattingTags(n)}else e.nodeType===Node.COMMENT_NODE||("BR"===s.tagName||"P"===s.tagName||"LI"===s.tagName||"DIV"===s.tagName?(p=!0,a=s.className,r=s.getAttribute("data-date")):"A"===s.tagName&&s.getAttribute("href")!==s.textContent?(u.text&&!u.text.endsWith(" ")&&(u.text+=" "),u.text+="["):"UL"!==s.tagName&&"OL"!==s.tagName||(f=!0,u.text=u.text.replace(/^ +/g,"").replace(/ +$/g,""),t={text:"",parent:u},this.parseClassName(a,t),u.items?u.items.push(t):u.items=[t],u=t,p=!1,a="",r=void 0))},v=e=>{e.nodeType!==Node.TEXT_NODE&&("UL"===e.tagName||"OL"===e.tagName?(u=u.parent,g=!0):"DIV"===e.tagName||"P"===e.tagName?(p=!0,a="",r=void 0):"A"===e.tagName&&e.getAttribute("href")!==e.textContent&&(u.text+="]("+e.getAttribute("href")+")"))};var y,_;do{if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(m(h),"note"===h.className?(_=h,u.text=_.innerHTML,u.parent._note=u,u.isNote=!0,g=!0,p=!0,y=void 0):y=h.firstChild,y)h=y;else if(y=h.nextSibling)h=y;else{var S=0;do{if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;(y=h.parentNode.nextSibling)?(v(h.parentNode),h=y):v(h=h.parentNode)}while(!y&&h&&h.parentNode);if(!y)break}}while(h);if(o&&this.stripParents(c),l){let e=(t,a)=>{var i=0;isNaN(a)&&(a=0);for(var r="",s=0;s<a;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r+="--"}if(a&&console.log(r,t.text),t.items){var n=0;for(s=0;s<t.items.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e(t.items[s],a+1)}}};e(c)}return c.items&&c.items.length||(c={items:[c]}),c.items&&c.items.length&&!c.items[c.items.length-1].text&&c.items.splice(c.items.length-1,1),c}}},89:function(e,t,a){"use strict";var i=a(57),r=a.n(i),s=a(0),n=a(2),o=a.n(n),l=a(15);t.a=class extends l.a{getElement(){return this.refs.element}onMouseDown(e){this.lastX=e.clientX,this.lastY=e.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=e.target,this.props.onMouseDown&&this.props.onMouseDown(e),this.props.globalEvents&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}onMouseMove(e){if(this.isDown){this.moveX+=Math.abs(e.clientX-this.lastX),this.moveY+=Math.abs(e.clientY-this.lastY),this.lastX=e.clientX,this.lastY=e.clientY;var t={startSrc:this.startSrc,target:e.target,clientX:e.clientX,clientY:e.clientY,eventX:e.clientX,eventY:e.clientY,preventDefault:s.default.emptyFn,stopPropagation:s.default.emptyFn,stopImmediatePropagation:s.default.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(t)}}onClick(e){this.moveX<s.default.ClickThreshold&&this.moveY<s.default.ClickThreshold&&this.props.onClick&&this.props.onClick(e)}onMouseUp(e){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(e),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}onTapStart(e){this.onMouseDown(e),e.stopPropagation()}onTapClick(e){this.props.onClick&&(this.props.onClick(e),e.stopPropagation())}onTapMove(e){this.props.onMouseMove&&this.props.onMouseMove(e),e.stopPropagation()}onTapEnd(e){this.onMouseUp(e),e.stopPropagation()}render(){var{onClick:e,globalEvents:t,...a}=this.props;return o.a.createElement("div",r()({},a,{onMouseDown:this.onMouseDown,onMouseMove:t?void 0:this.onMouseMove,onClick:this.onClick,onMouseUp:t?void 0:this.onMouseUp,ref:"element"}),this.props.children)}}},9:function(e,t,a){"use strict";var i=a(145);t.a=class{constructor(e,t,a){this._value=e,this._listeners=t?[t]:void 0,this._shouldFreeze=a}get(){return this._value}set(e,t){var a=this._value;return this._value=e,!1!==t&&this.notify(e,a,t),e}onHasValue(e){if(void 0!==this._value)e(this._value);else{let t,a=this.listen((i,r)=>{void 0===i||t||(t=!0,e(i,r),setTimeout(()=>{a.dispose()},0))})}}onValue(e,t){if(this._value===e)t();else{let a,i=this.listen((r,s)=>{r!==e||a||(a=!0,t(),setTimeout(()=>{i.dispose()},0))})}}hasListeners(){return this._listeners&&this._listeners.length>0}listen(e){return this._listeners||(this._listeners=[]),this._listeners.push(e),new i.a(this,e)}unlisten(e){this._listeners&&this._listeners.remove(e)}notify(e,t,a){0===arguments.length&&(e=this._value,t=this._value,a=!0);var i=this._listeners;if(i&&i.length>0&&(e!==t||!0===a))for(var r=0,s=0;s<i.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;!1===(0===arguments.length?i[s](this._value,void 0,a):i[s](e,t,a))&&(i.splice(s,1),s--)}}}},92:function(e,t,a){"use strict";t.a=class{constructor(e){this._limit=e,this._offset=0,this._buffer=[]}get(e){return this._buffer[e]}push(e){this._buffer[this._offset]=e,this._offset=(this._limit+this._offset+1)%this._limit}peek(){var e=(this._limit+this._offset-1)%this._limit;return this._buffer[e]}pop(){var e=(this._limit+this._offset-1)%this._limit,t=this._buffer[e];return t&&(this._buffer[e]=void 0,this._offset=e),t}hasData(){return!!this.peek()}reset(){this._offset=0,this._buffer=[]}buffer(){return this._buffer}limit(e){this._limit=e}ordered(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))}entries(){for(var e=0,t=this.ordered(),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;console.log("---- Entry ["+a+"] ----"),console.log(t[a])}}}},94:function(e,t,a){"use strict";var i=a(0),r=a(1),s=a(3),n=a(2),o=a.n(n),l=a(15),d=a(19),h=a(44),c=a(89),u=a(47);t.a=class extends l.a{init(){var e=this.props,t=e.item;e.renderLikePane&&!isNaN(e.paneObject.index)&&(this.styleProps=t.styleProps(e.paneObject,e.pane),this.metrics=e.pane.getMetricsForPaneObject(e.paneObject))}onMount(){var e=this.props,t=e.item;this.listenTo(t.itemChanged);try{i.default.PAssert(575,e.pane||!e.renderLikePane&&!e.padded,"Should not use these props if no pane")}catch(a){i.default.reportError(a)}this.props.editable&&(this._needsSelect=isNaN(e.selectIndex)?t.getParsedText().length:e.selectIndex,d.default.selectElement(this.getEditable(),this._needsSelect))}getEditable(){return this.refs.editable}getElement(){return this.refs.element.getElement()}getState(){var e=this.props,t=e.pane,a=e.item,i={flags:a.flags,renderLikePane:e.renderLikePane&&!isNaN(e.paneObject.index),styleProps:this.styleProps,priorityProps:e.showPriority&&a.getPriorityProps(),isComplete:a.isComplete(),hasPrefix:a.hasPrefix(),date:a.getMooDate()};return e.allowDrag&&(i.draggedInPane=a.draggedInPane,i.isBeingDragged=a.draggedInPane.get()===t),i.renderLikePane?(i.metrics=this.metrics,i.lines=i.metrics.styledLines):i.lines=[a.getStyledTextAsOneLine()],i}focus(){var e=this.props.item.getParsedText().length;d.default.selectElement(this.getEditable(),e)}onKeyDown(e){var t=this.props,a=t.item;e.keyCode===r.a.KeyCode.Backspace&&this.state.hasPrefix&&""===a.getParsedTextWithoutPrefix()&&a.setText("",!1!==t.shouldSave?r.a.ChangeType.Local:r.a.ChangeType.Auto),t.onKeyDown&&t.onKeyDown(e)}onKeyPress(e){var t=this.props;if(t.onKeyPress&&(t.onKeyPress(e),!e.defaultPrevented)){var a=this.props.item,i=d.default._getSelectionRange(),s=d.default.getSelectOffsetsInElement(e.target,i);if(this._needsSelect=void 0,s.start!==s.end){var n=a.getParsedText(),o=n.substr(0,s.start)+n.substr(s.end);a.setText(o,!1!==t.shouldSave?r.a.ChangeType.Local:r.a.ChangeType.Auto),this._needsSelect=s.start}}}componentDidUpdate(){if(!isNaN(this._needsSelect)){var e=this.getEditable(),t=e.innerHTML;(t.indexOf("<br")>=0||t.indexOf("></span>")>0||""===t)&&(e.innerHTML=this.getRenderedHtml()),d.default.selectElement(e,Math.min(e.textContent.length,this._needsSelect)),this._needsSelect=void 0}}convertElementToText(e){var t="";if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=r.a.AttachChar;else for(var a=0,i=0;i<e.childNodes.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.convertElementToText(e.childNodes[i])}return t}stopResizing(){this.isResizing=!1}onInput(e){e.target.innerHTML.indexOf("<br")>=0&&(e.target.innerHTML=e.target.innerHTML.replace("<br/>","").replace("<br>",""));var t=this.props.item,a=this.convertElementToText(e.target).replace(new RegExp(r.a.TextSpace,"g"),""),i=d.default._getSelectionRange();if(i){var s=d.default.getSelectOffsetsInElement(e.target,i);this._needsSelect=s.start}t.setText(a,r.a.ChangeType.Local),this.updateAutocomplete(),e.preventDefault()}updateAutocomplete(){var e=this.getEditable(),t=this.props.autocompleteMode;if(t){var a=d.default.getSelectionInElement(e);a&&a.start===a.end&&h.a.update({mode:t,text:this.convertElementToText(e).replace(new RegExp(r.a.TextSpace,"g"),""),offset:a.start,item:this.props.item,owner:this,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:this.props.positionOffset,elementDisplay:e,elementInput:e,onDatePickerClosed:this.onDatePickerClosed.bind(this),supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}}onDatePickerClosed(){if(this.props.item.getRawText().includes(r.a.CharDate)){let e=this.props.item.getParsedText();e.length>0&&e!==r.a.TextSpace&&(this.getEditable().focus(),d.default.selectElement(this.getEditable(),e.length),setTimeout(()=>{this.getEditable().focus(),d.default.selectElement(this.getEditable(),e.length)},0))}}onAutocompleteSelected(e){void 0!==e.value&&(this.props.item.setText(e.value,r.a.ChangeType.Local),d.default.selectElement(this.getEditable(),e.offset),setTimeout(()=>{d.default.selectElement(this.getEditable(),e.offset)},0))}onClick(e){if(!this.isResizing){var t=this.props;if(s.default.menus.isContextMenuOpen("ReactContextMenuContactDetails")&&s.default.menus.closeContextMenu("ReactContextMenuContactDetails"),t.editOnClick)e.preventDefault(),e.stopPropagation(),s.default.menus.isContextMenuOpen()&&s.default.menus.closeContextMenu(),s.default.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:e.target,item:t.item,pane:t.pane});else{var a=!0;if((t.editable||t.inItemDetails)&&t.pane&&(a=!s.default.pluginManager.handleTapClick(t.item,t.pane,e)),a&&!t.inItemDetails&&i.default.hasClass(e.target,"contact")){var n=e.target.textContent,o=u.a.findMatchExact(n[0]===r.a.ContactPrefix?n.substr(1):n);o&&s.default.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:e.target,contact:o})}}}}onMouseDown(e){if(e.button===r.a.ButtonCode.Left){var t=this.props,a=t.item,i=t.resizable;if(i){var s=this.getEditable().getBoundingClientRect(),n=Math.min(r.a.CalendarResizeHandleHeight,s.height/3);i=e.clientY-s.top<n?t.onItemResizeStart(a,this,!1):s.bottom-e.clientY<n&&t.onItemResizeStart(a,this,!0)}this.isResizing=i,!i&&t.allowDrag&&a.checkDragOnStart(e)}}onMouseMove(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnMove(e,!1)}onMouseUp(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnEnd(e)}onClickDate(){s.default.menus.openContextMenu({componentName:"ReactContextMenuDate",element:this.getEditable(),item:this.props.item,pane:this.props.pane})}onRightClick(e){var t=this.props;t.pane&&!1!==t.allowDrag&&(s.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"contextMenuItem"+this.props.item.id,element:e.target,item:this.props.item,pane:this.props.pane,pos:{left:e.clientX,top:e.clientY}}),e.preventDefault(),e.stopPropagation())}getRenderedHtml(){for(var e,t=0,a=this.props,i=a.paneObject,n=this.props.item,o=this.state.lines,l="",d=0;d<o.length;++d){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=a.renderLikePane?"padding-top: "+(0===d?s.default.DisplaySettings.paddingForItemTop(i,n)+"px":0)+"; padding-bottom: "+(d===o.length-1?(a.noNotes?s.default.DisplaySettings.paddingForItemTop(i,n):s.default.DisplaySettings.paddingForItemBottom(i,n))+"px":0)+";":"padding-top: 2px; padding-bottom: 2px",l+='<span class="line'+(d===o.length-1?" last":"")+'" style="'+e+'">'+(o[d]||r.a.TextSpace)+"</span>"}return l}render(){var e=this.props,t=e.item,a=this.state,n=(a.lines,e.editable&&s.default.pluginManager.allowTextEditing(t)),l=i.default.classNames("reactItemWrapper flexbox",e.className,e.coloredInCalendar&&"colored"),d=i.default.classNames("item itemNotInPane f1",a.styleProps,a.priorityProps,{hasPrefix:a.hasPrefix},{"itemBeingDragged c-bg-light":a.isBeingDragged},{autoSelect:n},{complete:a.isComplete},{"c-bg-dark":a.isComplete&&e.coloredInCalendar}),h={};a.renderLikePane&&e.padding&&(h.paddingLeft=e.padding);var u=this.getRenderedHtml();if(e.style&&(h=i.default.extend(e.style,h)),e.coloredInCalendar&&!a.isBeingDragged){a.isComplete||(h.backgroundColor=t.getCalendarColor());var p=t.getCalendarDisplayProps();if(p)for(var g in p.style)if(p.hasOwnProperty(g)){try{i.default.PAssert(576,!h[g],"Calendar display prop overwriting default styling")}catch(m){i.default.reportError(m)}h[g]=p.style[g]}}let f;if(this.state.date&&e.inItemDetails&&!this.props.item.getRawText().includes(r.a.CharDate)){let e=this.state.date,t=e.isRepeatDate(),a=e.toText(!0),r=i.default.classNames("itemTime c-date pointer"),s={};f=o.a.createElement("div",{className:r,style:s,onClick:this.onClickDate},e.getGCalId()&&o.a.createElement("i",{className:"icon-calendar"}),t&&o.a.createElement("i",{className:"icon-spinner"}),a)}return o.a.createElement(c.a,{"data-moo-id":this.getUniqueID(),className:l,ref:"element"},o.a.createElement("span",{className:d,style:h,contentEditable:n,onClick:e.editOnClick||n||e.inItemDetails?this.onClick:void 0,onKeyDown:n?this.onKeyDown:void 0,onKeyPress:n?this.onKeyPress:void 0,onInput:n?this.onInput:void 0,onMouseDown:n?void 0:this.onMouseDown,onMouseMove:n?void 0:this.onMouseMove,onMouseUp:n?void 0:this.onMouseUp,onContextMenu:this.onRightClick,tabIndex:e.tabIndex,dangerouslySetInnerHTML:{__html:u},ref:"editable"}),f)}}},96:function(e,t,a){"use strict";var i=a(27),r=a(466);class s extends r.a{constructor(){super("moodonew"),this.version(1).stores({documents:"id",items:"id",settings:"id",boards:"id",localStorage:"id",contacts:"id"});let e={};["plugins","gmail","drive","gcal"].forEach(t=>e[t]="id"),this.version(2).stores(e),this.tableNames=["documents","items","settings","boards","localStorage","contacts","plugins","Drive","GCalendar","Gmail"];let t={GmailMessages:"id",gmail:null,drive:null,gcal:null};this.tableNames.forEach(e=>t[e]="id"),t.Gmail="id,date",this.version(3).stores(t)}beginBatch(){}commitBatch(){}}var n=function(e,t,a){var i=function(e,t,a){for(var i=0,r=0,s=e.length-1;r<=s;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r+s>>1,o=a(e[n],t);if(o<0)r=n+1;else{if(!(o>0))return n;s=n-1}}return r}(e,t,a);return e.splice.apply(e,[i,0,t]),i};let o=(e,t)=>{var a=0;let r={},s={},o=e=>{r[e.id]||(r[e.id]=e,e.isRoot&&(s[e.docId]=e))};e.forEach(o),t&&Object.keys(t).forEach(e=>{o(t[e])});for(let l=0;l<e.length;l++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let t=e[l],o=t.parent,d=r[o],h=!1;if(t.isArchived||t.isDeleted){let e=t.isDeleted,a=(e?"deleted":"archived")+"Items";if(!d||d.isRoot||(e?!d.isDeleted:!d.isArchived)){let e=s[t.docId];e&&(e[a]||(e[a]=[]),e[a].push(t)),h=!0}}h||(d||t.isRoot||console.log("Item without a parent",t.text,t.parent,o,t.docId,t),d&&(32===(32&t.flags)?d.note=t.id:void 0!==t.text&&(d.items||(d.items=[]),void 0===t.index&&(t.index=""+d.items.length),n(d.items,t,i.a.compareItemIndex))))}return r},l=e=>{var t=0;for(let a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e[a]=i.a.itemIn(e[a])}return o(e)},d=()=>new s;t.a={load:(e,t,a)=>{e||(e=d()),a=a||e.tableNames;let r={},s=a.length;a.forEach(e=>r[e]=void 0);const n=(e,a)=>{if(a||(a=[]),r[e]=a,"documents"===e){var n=0;let e=a,t={},s={};for(var o=0;o<e.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;let a=i.a.documentIn(e[o]);t[e[o].id]=a,a.pendingSync&&(s[a.id]=!0)}r.documentsPending=s,r.documents=t}else if("items"===e){let{items:e,itemsPending:t}=(e=>{let t={};return e=l(e),Object.keys(e).forEach(a=>{let i=e[a],r=i.items;if(i.pendingSync&&(t[i.id]=i.pendingSync),r){let e=Number.NEGATIVE_INFINITY;if(r.find(t=>{32!==(32&t.flags)&&(e=t.index)})){var s=0;for(let e=0;e<r.length;e++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;let a=r[e];a.pendingSync={index:a.index},a.index=e,t[a.id]=!0}}}}),{items:e,itemsPending:t}})(a);r.items=e,r.itemsPending=t}else if("settings"===e||"boards"===e){let{values:t,pending:s}=(e=>{let t={},a={};return e.forEach(e=>{t[e.id]=e,e.pendingSync&&(a[e.id]=e.pendingSync)}),{values:t,pending:a}})(a);r[e]=t,r[e+"Pending"]=s,"boards"===e&&Object.keys(t).forEach(e=>{t[e]=i.a.boardIn(t[e])})}else if("plugins"===e){let t={};a.forEach(e=>{t[e.plugin]||(t[e.plugin]={}),t[e.plugin][e.id]=e}),r[e]=t}else if("localStorage"===e){let t={};a.forEach(e=>t[e.id]=e.value),r[e]=t}else if("contacts"===e)r[e]=a.map(e=>i.a.contactIn(e));else if("GCalendar"===e||"Gmail"===e||"GmailMessages"===e){let t={};a.forEach(e=>t[e.id]=e),r[e]=t}0===--s&&t(r)};var o=!1;e.beginBatch();for(const i in r)e[i]&&e[i].toArray().then(n.bind(e[i],i)).catch(e=>{o||(o=!0,console.log(e),t({error:{name:e.name,message:e.message}}))});e.commitBatch()},transformItems:l,createItemHierarchy:o,createDB:d}},97:function(e,t,a){"use strict";var i,r=a(7),s=a.n(r),n=a(0),o=a(9),l=a(8);let d=(i=class extends o.a{constructor(e,t,a){var i=0;super(void 0,a),this._destroyed=!1;for(var r=0;r<e.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e[r].listen(this.onChanged)}this._observables=e,t&&n.default.isFunction(t)?this.checkFn=t:this.checkFn="or"===t?this.checkFnOr:this.checkFnAnd,this._value=this.checkFn()}checkFnOr(){for(var e=0,t=!1,a=0;!t&&a<this._observables.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t=t||this._observables[a].get()}return t}checkFnAnd(){for(var e=0,t=!0,a=0;t&&a<this._observables.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t=t&&this._observables[a].get()}return t}onChanged(e,t,a){var i=this._value,r=this.checkFn();(r!==i||a)&&this.set(r,a)}destroy(){var e=0;this._destroyed=!0;for(var t=0;t<this._observables.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._observables[t].unlisten(this.onChanged)}}},s()(i.prototype,"onChanged",[l.a],Object.getOwnPropertyDescriptor(i.prototype,"onChanged"),i.prototype),i);t.a=d}});
