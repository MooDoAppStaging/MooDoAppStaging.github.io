/*! For license information please see preload.worker-1610169678972.js.LICENSE.txt */
!function(e){self.webpackChunk=function(t,r){for(var i in r)e[i]=r[i];for(;t.length;)n[t.pop()]=1};var t={},n={1:1};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(e){var t=[];return t.push(Promise.resolve().then((function(){n[e]||importScripts(r.p+""+({0:"codeBlock",2:"textEncoding"}[e]||e)+"-1610169678972.worker.js")}))),Promise.all(t)},r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="js/",r(r.s=112)}([function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r),a=n(10),o=n.n(a),s=n(39),u=n.n(s),l=n(5),c=n.n(l),d=n(6),h=n.n(d),f=n(17),p=n.n(f),g=n(18),v=n.n(g),m=n(19),y=n.n(m),_=n(11),b=n.n(_),w=n(7),k=n.n(w),S=n(8),E=n(1),P=n(96),I=n(12),D=n(14),T=n.n(D),x=n(85),C=n.n(x),A=n(21),L=n(110),O=n(111),M=n.n(O);function R(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}function F(){}R.prototype={tokenize:function(){for(var e,t=0,n=[],r=0,i=this.str.length;r<i;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=this.str.charAt(r),this.checkChar(e)}return this.list.forEach((function(e){e.value=(e.value||"").toString().trim(),e.value&&n.push(e)})),n},checkChar:function(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}this.escaped||"\\"!==e?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1):this.escaped=!0}},F.prototype={_handleAddress:function(e){var t,n,r,i,a=0,o=!1,s="text",u=[],l={address:[],comment:[],group:[],text:[]};for(r=0,i=e.length;r<i;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("operator"===(t=e[r]).type)switch(t.value){case"<":s="address";break;case"(":s="comment";break;case":":s="group",o=!0;break;default:s="text"}else t.value&&("address"===s&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),l[s].push(t.value))}if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),o)l.text=l.text.join(" "),u.push({name:l.text||n&&n.name,group:l.group.length?this.parse(l.group.join(",")):[]});else{if(!l.address.length&&l.text.length){var c=0;for(r=l.text.length-1;r>=0;r--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(l.text[r].match(/^[^@\s]+@[^@\s]+$/)){l.address=l.text.splice(r,1);break}}var d=function(e){return l.address.length?e:(l.address=[e.trim()]," ")};if(!l.address.length){var h=0;for(r=l.text.length-1;r>=0;r--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(l.text[r]=l.text[r].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,d).trim(),l.address.length)break}}}if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),l.address.length>1&&(l.text=l.text.concat(l.address.splice(1))),l.text=l.text.join(" "),l.address=l.address.join(" "),!l.address&&o)return[];(n={address:l.address||l.text||"",name:l.text||l.address||""}).address===n.name&&((n.address||"").match(/@/)?n.name="":n.address=""),u.push(n)}return u},parse:function(e){var t=this,n=0,r=new R(e).tokenize(),i=[],a=[],o=[];r.forEach((function(e){"operator"!==e.type||","!==e.value&&";"!==e.value?a.push(e):(a.length&&i.push(a),a=[])})),a.length&&i.push(a),i.forEach((function(e){var n=t._handleAddress(e);n.length&&(o=o.concat(n))}));for(var s=[],u=0;u<o.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;s.push({type:"contact",text:o[u].name||o[u].address,email:o[u].address})}return s}};var N,j,U=new F,B=function(){if("function"!==typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(e){try{J.PAssert(913,J.isArray(e),"Must only supply array to pushArray")}catch(t){J.reportError(t)}return this.push.apply(this,e)}),"function"!==typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(e){try{J.PAssert(914,J.isArray(e),"Must only supply array to removeArray")}catch(t){J.reportError(t)}return this.filter((function(t){return!e||e.indexOf(t)<0}))}),"function"!==typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(e){return this.splice(e,1)[0]}),"function"!==typeof Array.prototype.remove&&(Array.prototype.remove=function(e,t){var n=this.indexOf(e,t);return n>=0&&this.removeAt.call(this,n),n}),"function"!==typeof Array.prototype.equals){var e=function e(t,n,r){return t&&n&&"object"===u()(t)&&"object"===u()(n)?Object.keys(t).length===Object.keys(n).length&&Object.keys(t).reduce((function(i,a){return i&&(r?e(t[a],n[a],r):t[a]===n[a])}),!0):t===n};Array.prototype.equals=function(t,n){var r=0;if(!t)return!1;if(this.length!==t.length)return!1;for(var i=0,a=this.length;i<a;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(this[i]instanceof Array&&t[i]instanceof Array){if(!this[i].equals(t[i]))return!1}else if(this[i]!==t[i]&&!e(this[i],t[i],n))return!1}return!0}}"function"!==typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(e,t){var n=0;for(var r=0;r<this.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this[r][e]===t)return r}return-1}),"function"!==typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(e,t){var n=0;try{J.PAssert(916,void 0!==e&&null!==e,"Require a valid element to insert")}catch(s){J.reportError(s)}try{J.PAssert(917,t,"Require a valid comparison function")}catch(s){J.reportError(s)}for(var r=0,i=this.length-1;r<=i;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r+i>>1,o=t(this[a],e);if(o<0)r=a+1;else{if(!(o>0))return a;i=a-1}}return r}),"function"!==typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(e,t){var n=this.findInsertIndex(e,t);if(0===t(this[n],e))return this[n]}),"function"!==typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(e,t){var n=this.findInsertIndex(e,t);return this.splice.apply(this,[n,0,e]),n}),"function"!==typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(e,t){var n=0;if(!e)return this;for(var r=0,i=e.length;r<i;++r){var a=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var o=!0,s=0,u=this.length;s<u;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t&&t(e[r],this[s])||!t&&e[r]===this[s]){o=!1;break}}o&&this.push(e[r])}return this}),"function"!==typeof Array.prototype.pushIfUnique&&(Array.prototype.pushIfUnique=function(e){return this.includes(e)||this.push(e),this}),"function"!==typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}):String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!==typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(e,t){for(var n=0,r=-1,i=t-1;i>=0;--i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this[i]===e){r=i;break}}return r}),"function"!==typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)})},V=(n(125),n(76)),H=n(23),W={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},q=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g,z=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"],G=(N=function(){function e(){c()(this,e),B(),this.SESSION_BEGIN=Date.now(),this.LogLevel=E.a.LogLevels.Error|E.a.LogLevels.Warning,this.noLocalWrites=!1,this.totalItems=0,this.totalArchivedItems=0,this.totalArchivedParents=0,this.totalPanes=0,this.tempIndex=0,this.__FULL_NOTIFICATION_UPDATES=0,this.__SINGLE_NOTIFICATION_UPDATES=0,this.TEMP_PREFIX="~T^",this.fnRegex=/function\s+([^(]*?)\s*\(([^)]*)\)/,this.supportSimpleStack=!0,this.__LOG_BUFFER=new V.a(50),this.isLoaded=!1,this.aggregateEvents={},this.anonID=void 0,this.defaultSeed=129831293,this._isInCompleteAction=!1,this.lastActivity=Date.now(),this.activityThreshold=this.seconds(5),this.lastDateRollover=0,this.__xhrRequests={},this.isRollbarConfigured=!1,this.lastErrorsReported={},this.timeouts={},this.animationFrames={},this.numReported=0,this.isReporting=!1,this.singletonPromises={},this.lazyLoadedComponents={}}return h()(e,[{key:"Assert",value:function(e){}},{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"isFunction",value:function(e){return!!(e&&e.constructor&&e.call&&e.apply)}},{key:"isEmpty",value:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isString",value:function(e){return"string"===typeof e}},{key:"isObject",value:function(e){return"object"===u()(e)&&null!==e&&!this.isArray(e)}},{key:"isNumber",value:function(e){return"number"===typeof e&&!isNaN(e)}},{key:"isBoolean",value:function(e){return!0===e||!1===e}},{key:"isAnything",value:function(){return!0}},{key:"isNullOrUndefined",value:function(e){return null===e||void 0===e}},{key:"isValidColor",value:function(e){return this.isString(e)&&null!==/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.exec(e)}},{key:"parseBoolean",value:function(e){return!0===e||"true"===e}},{key:"parseDate",value:function(e){var t=new Date(e);return this.isDateValid(t)?t:void 0}},{key:"clone",value:function(e,t){var n;if(this.isArray(e))return this.cloneDeep(e);if(t)for(var r in n={},e)e.hasOwnProperty(r)&&(t&&void 0===e[r]||(n[r]=e[r]));else n=Object.assign({},e);return n}},{key:"cloneWithoutUndefineds",value:function(e){return this.clone(e,!0)}},{key:"cloneDeep",value:function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){0;try{this.PAssert(343,!1,this.safeStringify(t))}catch(n){this.reportError(n)}}}},{key:"arrayDifference",value:function(e,t){for(var n=0,r=[],i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t[e[i]]||r.push(e[i])}return r}},{key:"emptyFn",value:function(){}},{key:"newEmptyFn",value:function(){return function(){}}},{key:"weeks",value:function(e){return 6048e5*e}},{key:"days",value:function(e){return 864e5*e}},{key:"hours",value:function(e){return 36e5*e}},{key:"minutes",value:function(e){return 6e4*e}},{key:"seconds",value:function(e){return 1e3*e}},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return parseInt(e,10)}))},{key:"shouldLog",value:function(e){return this.__DEV__===e}},{key:"shouldWriteLocal",value:function(){return!this.noLocalWrites}},{key:"isLocalWriteReason",value:function(e){return this.noLocalWritesReason===e}},{key:"isValidChangeType",value:function(e){if(void 0!==e&&null!==e){var t=e&~E.a.ChangeType.All;if(this.inMaskOnly(e,E.a.ChangeType.Valid))return(t&E.a.ChangeType.Locations)===E.a.ChangeType.None||this.isOneFlagSet(t,E.a.ChangeType.Local|E.a.ChangeType.Remote|E.a.ChangeType.Auto)}return!1}},{key:"isRemoteChange",value:function(e){try{this.PAssert(344,this.isValidChangeType(e),"Must supply a valid changeType")}catch(n){this.reportError(n)}var t=e&~E.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,E.a.ChangeType.Remote)}},{key:"isUndoRedoChange",value:function(e){try{this.PAssert(345,this.isValidChangeType(e),"Must supply a valid changeType")}catch(n){this.reportError(n)}var t=e&~E.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,E.a.ChangeType.UndoRedo)}},{key:"isLocalChange",value:function(e){try{this.PAssert(346,this.isValidChangeType(e),"Must supply a valid changeType")}catch(n){this.reportError(n)}var t=e&~E.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,E.a.ChangeType.Local)}},{key:"isAutoChange",value:function(e){try{this.PAssert(347,this.isValidChangeType(e),"Must supply a valid changeType")}catch(n){this.reportError(n)}var t=e&~E.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,E.a.ChangeType.Auto)}},{key:"inMaskOnly",value:function(e,t){return 0===(~t&e)}},{key:"isOneFlagSet",value:function(e,t){var n=e&t;return 0!==n&&0===(n&n-1)}},{key:"isAtLeastOneFlagSet",value:function(e,t){return 0!==(e&t)}},{key:"forEachFlagSet",value:function(e,t){for(var n=0;0!==e;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t(Math.abs(e&-e)),e&=e-1}}},{key:"generateTempId",value:function(){return this.TEMP_PREFIX+Date.now()+ ++this.tempIndex}},{key:"toLowerCase",value:function(e){return e.toLowerCase()}},{key:"numberComparator",value:function(e,t){return e-t}},{key:"insertIntoText",value:function(e,t,n){try{this.PAssert(348,n<=e.length)}catch(r){this.reportError(r)}return e.substr(0,n)+t+e.substr(n,e.length-n)}},{key:"arrayUnion",value:function(e,t){for(var n=0,r=0,i=[],a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i.indexOf(e[a])<0&&i.push(e[a])}for(var o=0;o<t.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i.indexOf(t[o])<0&&i.push(t[o])}return i}},{key:"arrayUnionByKey",value:function(e,t,n){for(var r=0,i=0,a=[],o=0;o<e.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a.indexOfWithProperty(n,e[o][n])<0&&a.push(e[o])}for(var s=0;s<t.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a.indexOfWithProperty(n,t[s][n])<0&&a.push(t[s])}return a}},{key:"arrayDiff",value:function(e,t){for(var n=0,r=0,i=[],a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t.indexOf(e[a])<0&&i.push(e[a])}for(var o=0;o<t.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.indexOf(t[o])<0&&i.push(t[o])}return i}},{key:"arrayIntersection",value:function(e,t){for(var n=0,r=[],i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t.indexOf(e[i])>=0&&r.push(e[i])}return r}},{key:"arrayIntersectionByKey",value:function(e,t,n){for(var r=0,i=[],a=0;a<e.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t.indexOfWithProperty(n,e[a][n])>=0&&i.push(e[a])}return i}},{key:"arrayUniques",value:function(e,t){return t?e.filter((function(n,r){return e.findIndex((function(e){return e[t]===n[t]}))===r})):e.filter((function(t,n){return e.indexOf(t)===n}))}},{key:"arrayUniques2",value:function(e){return Array.from(new Set(e))}},{key:"removeNullUndefined",value:function(e){var t={};return Object.keys(e).forEach((function(n){null!==e[n]&&void 0!==e[n]&&(t[n]=e[n])})),t}},{key:"deepEqual",value:function(e,t,n,r){return(e===t||void 0!==e&&void 0!==t&&null!==e&&null!==t)&&(n&&(this.isObject(e)&&(e=this.removeNullUndefined(e)),this.isObject(t)&&(t=this.removeNullUndefined(t))),r&&r.forEach((function(n){delete e[n],delete t[n]})),M()(e,t,!0))}},{key:"extend",value:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}},{key:"classNames",value:function(){for(var e=0,t=0,n=arguments.length,r=new Array(n),i=0;i<n;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r[i]=arguments[i]}for(var a=arguments,o=[],s=0;s<a.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l=a[s];if(l)if(this.isString(l)||this.isNumber(l))o.push(l);else if("object"===u()(l))for(var c in l)l.hasOwnProperty(c)&&l[c]&&o.push(c)}return o.join(" ")}},{key:"isPrefixTask",value:function(e){return e&&(e===E.a.Prefix.Task||e===E.a.Prefix.Task2||e===E.a.Prefix.Task3||e===E.a.Prefix.Task4)}},{key:"escape",value:function(e){return String(e).replace(/[&\"<>]/g,(function(e){return W[e]}))}},{key:"unescape",value:function(e){return String(e).replace(/&lt;|&gt;|&amp;|&quot;/g,(function(e){for(var t in W)if(W.hasOwnProperty(t)&&W[t]===e)return t;try{this.PAssert(349,!1,"Should have found a character to replace")}catch(n){this.reportError(n)}return e}))}},{key:"escapeRegExp",value:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"stripTagsBasic",value:function(e){return e.replace(/<.*>/g,"")}},{key:"stripFormattingTags",value:function(e){return e.replace(/<\/?[biu]>/g,"")}},{key:"invertObject",value:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}},{key:"filterWithNonMatches",value:function(e,t){for(var n=0,r={match:[],fail:[]},i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i];t(a)?r.match.push(a):r.fail.push(a)}return r}},{key:"isUrlImage",value:function(e){return(e=e.toLowerCase().split("?")[0]).endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".gif")}},{key:"isDateSoft",value:function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}},{key:"isDateValid",value:function(e){return e&&e instanceof Date&&!isNaN(e.getTime())}},{key:"parseEmailAddresses",value:function(e){return U.parse(e)}},{key:"isTempId",value:function(e){return e&&e[0]===this.TEMP_PREFIX[0]&&e[1]===this.TEMP_PREFIX[1]&&e[2]===this.TEMP_PREFIX[2]}},{key:"isLocalItem",value:function(e){try{this.PAssert(350,e.id,"All items should have an ID even if it is a temp one")}catch(t){this.reportError(t)}return this.isTempId(e.id)}},{key:"getCurrentStack",value:function(e){var t;if(this.supportSimpleStack)try{t=JSON.stringify(e)}catch(d){this.log("Error stringifying stack message",d,e)}if(this.supportSimpleStack){var n=new Error(t||e);if(n.stack)return n.stack}this.supportSimpleStack=!1;try{for(var r=0,i=["GenError: "+(t||e)],a=arguments.callee.caller,o=75,s=0;a&&s++<o;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u,l=a.toString(),c=this.fnRegex.exec(l);u=c&&3===c.length&&""!==c[1]&&void 0!==c[1]?"at "+c[1]+"("+c[2].replace(/[\r\n]/g,"")+")":c&&3===c.length?"at <anonymous> ("+c[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",i.push(u),a=a.caller}return i.join("\n")}catch(h){this.log("Error generating stack trace",h)}return""}},{key:"isVMLI",value:function(e){return e&&e.__ISVMLI}},{key:"isPane",value:function(e){return e&&e.__ISPANE}},{key:"logQuiet",value:function(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(i){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(a){console.log("Error adding to __LOG_BUFFER: ",arguments)}}}},{key:"log",value:function(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(i){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(a){console.log("Error adding to __LOG_BUFFER: ",arguments)}}console.log.apply(console,arguments)}},{key:"registerEvent",value:function(e,t,n){try{this.PAssert(351,!this.aggregateEvents.hasOwnProperty(e),"Should only register an event once")}catch(i){this.reportError(i)}try{this.PAssert(352,void 0!==e,"Must specify a name for the event")}catch(i){this.reportError(i)}try{this.PAssert(353,void 0!==t,"Must specify a category for the event")}catch(i){this.reportError(i)}try{this.PAssert(354,void 0!==n,"Must specify an action for the event")}catch(i){this.reportError(i)}var r={category:t,action:n,label:this.getAnonUserIdentifier(),count:0};this.aggregateEvents[e]=r}},{key:"aggregateEvent",value:function(e,t){try{this.PAssert(355,this.aggregateEvents.hasOwnProperty(e),"Must register an event before using it")}catch(n){this.reportError(n)}void 0===t&&(t=1),this.aggregateEvents[e]&&(this.aggregateEvents[e].count+=t)}},{key:"UIAction",value:function(e){this.sendEvent("UIAction",e)}},{key:"getAggregateEvents",value:function(){return this.aggregateEvents}},{key:"getAnonUserIdentifier",value:function(){if(!this.anonID){var e=this.getUserIdentifier();this.anonID=e?e[0]+e[1]+e[2]+this.murmurhash3_32_gc(e,17124123):"loggedout"}return this.anonID}},{key:"murmurhash3_32_gc",value:function(e,t){var n,r,i,a,o,s,u,l,c=0;for(n=3&e.length,r=e.length-n,i=t,o=3432918353,s=461845907,l=0;l<r;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;u=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,i=27492+(65535&(a=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16)}switch(u=0,n){case 3:u^=(255&e.charCodeAt(l+2))<<16;case 2:u^=(255&e.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&e.charCodeAt(l)))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}},{key:"hashString",value:function(e){try{this.PAssert(356,this.isString(e),"Must always be passing a string to hash")}catch(t){this.reportError(t)}return this.murmurhash3_32_gc(e,this.defaultSeed)}},{key:"isDemoMode",value:function(){return!1}},{key:"getUserIdentifier",value:function(){var e=this.getToolbox();return this.isDemoMode()?"demouser":e?e.settings.activeUser.get():"Missing toolbox"}},{key:"beginCompleteAction",value:function(){this._isInCompleteAction=!0}},{key:"isInCompleteAction",value:function(){return this._isInCompleteAction}},{key:"endCompleteAction",value:function(){this._isInCompleteAction=!1}},{key:"getObjectInfo",value:function(e){try{if(e&&e.constructor)return e.constructor.name}catch(t){this.reportError(t)}return u()(e)}},{key:"hasTimeoutOnce",value:function(e){return!!this.timeouts[e]}},{key:"timeoutOnce",value:function(e,t,n,r,i,a,o,s){var u=this;try{this.PAssert(357,e,"Must supply a valid name")}catch(c){this.reportError(c)}try{this.PAssert(358,this.isFunction(t),"must supply a valid cb fn")}catch(c){this.reportError(c)}try{this.PAssert(359,arguments.length<=8,"Too many args passed in")}catch(c){this.reportError(c)}var l=this.timeouts[e];l&&clearTimeout(l),this.timeouts[e]=setTimeout((function(){delete u.timeouts[e],t(r,i,a,o,s)}),n)}},{key:"clearTimeoutOnce",value:function(e){var t=this.timeouts[e];t&&(clearTimeout(t),delete this.timeouts[e])}},{key:"timeoutIf",value:function(e,t,n){e?setTimeout(n,t):n()}},{key:"hasAnimationFrameOnce",value:function(e){return!!this.animationFrames[e]}},{key:"animationFrameOnce",value:function(e,t){var n=this;try{this.PAssert(360,e,"Must supply a valid name")}catch(i){this.reportError(i)}try{this.PAssert(361,this.isFunction(t),"must supply a valid cb fn")}catch(i){this.reportError(i)}try{this.PAssert(362,arguments.length<=8,"Too many args passed in")}catch(i){this.reportError(i)}var r=this.animationFrames[e];r&&cancelAnimationFrame(r),this.animationFrames[e]=requestAnimationFrame((function(){delete n.animationFrames[e],t()}))}},{key:"clearAnimationFrameOnce",value:function(e){var t=this.animationFrames[e];t&&(cancelAnimationFrame(t),delete this.animationFrames[e])}},{key:"sendEvent",value:function(e,t,n){}},{key:"objectValues",value:function(e){return Object.keys(e).map((function(t){return e[t]}))}},{key:"trimRight",value:function(e){for(var t=0,n=e.length-1;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[n])break;e=e.substr(0,n)}return e}},{key:"getToolbox",value:function(){return n(2).default}},{key:"searchFromVMLI",value:function(e,t,n){n=n||0;var r=t.noCollapsed,i=t.pane,a=t.overview,o=!0;if(t.includeNotes&&!t.headers&&e.hasNote()){var s=e.getNote();t.comparator&&!t.comparator(s,t.comparatorOptions)||t.each&&(o=t.each(s))}if(!1!==o&&(!r||0===n||!i||!e.isCollapsed(i,a)))for(var u=0,l=e.items.get(),c=0;c<l.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var d=l[c];if(!t.headers||d.showInOverview()){if((!t.comparator||t.comparator(d,t.comparatorOptions))&&t.each&&!1===(o=t.each(d)))return!1;this.searchFromVMLI(d,t,n+1)}}}},{key:"searchVMLIs",value:function(e){var t=this;try{this.PAssert(363,e,"Must supply a valid options param")}catch(r){this.reportError(r)}var n=this.getToolbox();try{if(e.itemStoreFilter)n.itemStoreManager.runForEachStore((function(n){var r=e.item,i=r&&r.belongsToItemStore(n)?r:n.getRoot();t.searchFromVMLI(i,e)}),e.itemStoreFilter);else if(e.item){try{this.PAssert(364,!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(r){this.reportError(r)}this.searchFromVMLI(e.item,e)}else if(e.itemStore){try{this.PAssert(365,!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(r){this.reportError(r)}this.searchFromVMLI(e.itemStore.getRoot(),e)}else try{this.PAssert(366,!1,"Must specify a valid search root, using the default root is deprecated")}catch(r){this.reportError(r)}}catch(i){this.reportError(i)}}},{key:"clamp",value:function(e,t,n){return Math.max(t,Math.min(n,e))}},{key:"padZeros",value:function(e,t){for(var n=0,r=e+"";r.length<(t||2);){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r="0"+r}return r}},{key:"pad2",value:function(e){return this.padZeros(e,2)}},{key:"parseSubtree",value:function(e,t){var n=0;try{this.PAssert(367,e,"Must supply a valid item to parse")}catch(a){this.reportError(a)}this.runSingleParse(e,t,!0);for(var r=e.getItems(),i=0;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this.parseSubtree(r[i],t)}}},{key:"runSingleParse",value:function(e,t,n){try{this.PAssert(368,e,"Must have a valid item to parse")}catch(r){this.reportError(r)}e.parseText("",t,n)}},{key:"notifyActivity",value:function(){this.lastActivity=Date.now(),this.lowActivityTimer||(this.lowActivityTimer=setTimeout(this.checkLowActivity,2*this.activityThreshold)),this.whenLowImpactEnd()}},{key:"checkLowActivity",value:function(){Date.now()-this.lastActivity>this.activityThreshold&&this.whenLowImpactBegin(),this.lowActivityTimer=void 0}},{key:"whenLowImpactBegin",value:function(){this._isLowImpact||(this._isLowImpact=!0,H.a.fireEvent("lowImpactBegin",[]))}},{key:"whenLowImpactEnd",value:function(){this._isLowImpact&&(H.a.fireEvent("lowImpactEnd",[]),this._isLowImpact=!1)}},{key:"isLowImpact",value:function(){return this._isLowImpact}},{key:"parseEvernoteLink",value:function(e){return e.startsWith("evernote:///view/")?{viewUrl:e}:(q.lastIndex=0,null!==(t=q.exec(e))?{shardId:t[1],userId:t[2],noteGuid:t[3]}:void 0);var t}},{key:"isOneNoteLink",value:function(e){return e.startsWith("onenote:https://")}},{key:"isBearLink",value:function(e){return e.startsWith("bear://x-callback-url/")}},{key:"runDateRollover",value:function(){var e=this,t=this.getToolbox();try{this.PAssert(369,this.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(r){this.reportError(r)}var n=+this.scheduledDateRollover-Date.now();this.log("---- Running Date Rollover: "+n+" ----"),this.lastDateRollover=Date.now(),this.scheduledDateRollover=0,clearTimeout(this.dateRolloverTimeout),this.dateRolloverTimeout=void 0,this.setupDateRollover();Date.Parsing.Normalizer.buildReplaceData(),t.timeline.clearDailyCaches(),H.a.fireEvent("beforeDateChanged",[]),t.PaneUpdateBatcher.updateAllItems(!0,!0),t.timeline.updateNotifications(),e.log("-------------------------------"),H.a.fireEvent("dateChanged",[])}},{key:"setupDateRollover",value:function(){try{this.PAssert(370,!this.dateRolloverTimeout,"Should never reschedule a date rollover over another one")}catch(n){this.reportError(n)}var e=new Date,t=+e.clone().addDays(1).clearTime()+1e3;try{this.PAssert(371,t>+e,"Rollover time must be in the future")}catch(n){this.reportError(n)}try{this.PAssert(372,t>this.lastDateRollover,"Rollover time must be after the last rollover")}catch(n){this.reportError(n)}this.dateRolloverTimeout=setTimeout(this.runDateRollover,t-+e),this.scheduledDateRollover=t}},{key:"ensureDateRollover",value:function(){var e=this;setTimeout((function(){var t=Date.now();e.scheduledDateRollover-t<0&&e.runDateRollover()}),1e4)}},{key:"ensureStatsXHR",value:function(e){var t=this.sanitizeURL(e).split("?")[0];return this.__xhrRequests[t]||(this.__xhrRequests[t]={requests:0,successes:0,retries:0,failures:0}),this.__xhrRequests[t]}},{key:"notifyStatsXHRRequest",value:function(e){this.ensureStatsXHR(e).requests++}},{key:"notifyStatsXHRSuccess",value:function(e){this.ensureStatsXHR(e).successes++}},{key:"notifyStatsXHRRetry",value:function(e){this.ensureStatsXHR(e).retries++}},{key:"notifyStatsXHRFailure",value:function(e){this.ensureStatsXHR(e).failures++}},{key:"getXHRStats",value:function(){return this.__xhrRequests}},{key:"sanitizeURL",value:function(e){return e.replace(/&?access_token=[^&]*/g,"")}},{key:"generateQueryString",value:function(e){var t="";if("object"===u()(e)){t=Object.keys(e).map((function(t){return void 0!==e[t]?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):""})).join("&").replace(/%20/g,"+")}else{try{this.PAssert(373,"string"===typeof e,"Only Objects or Strings are currently supported")}catch(n){this.reportError(n)}t=e}return t}},{key:"packedFnToString",value:function(e){for(var t=0,n="",r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n+=e[r]+"."}return n}},{key:"unpackFn",value:function(e,t){try{this.PAssert(374,this.isFunction(e)||this.isArray(e),"Must supply either a valid function or packed function")}catch(a){this.reportError(a)}var n=NaN;if(this.isFunction(e))n=e;else if(e)try{var r=0;0,n=t||window;for(var i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{this.PAssert(375,this.isString(e[i]),"Packed fns must only contain strings: "+i)}catch(a){this.reportError(a)}try{this.PAssert(376,n,"Must be able to unpack each step in object chain: "+e[i]+" in "+this.packedFnToString(e))}catch(a){this.reportError(a)}if(!n){n=NaN;break}n=n[e[i]]}}catch(o){this.reportError(o),n=NaN}return n}},{key:"encodeMIMEHeader",value:function(e){return"=?UTF-8?B?"+this.btoa(unescape(encodeURIComponent(e)))+"?="}},{key:"utf8_to_b64",value:function(e){var t;try{t=this.btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_")}catch(n){this.reportError(n,e)}return t}},{key:"b64_to_utf8",value:function(e){var t;try{t=decodeURIComponent(escape(this.atob(e.replace(/-/g,"+").replace(/_/g,"/"))))}catch(n){this.reportError(n,e)}return t}},{key:"qp_to_utf8",value:function(e){var t;try{t=e.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,(function(e,t){var n=parseInt(t,16);return String.fromCharCode(n)}))}catch(n){this.reportError(n,e)}return t}},{key:"isTextNode",value:function(e){return e&&3===e.nodeType}},{key:"isWhiteSpace",value:function(e){return/^\s*$/.test(e)}},{key:"isAncestor",value:function(e,t){var n=0;try{this.PAssert(377,e,"Must have a valid element")}catch(r){this.reportError(r)}try{this.PAssert(378,t,"Must have a valid candidate")}catch(r){this.reportError(r)}for(;e&&e!==t;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e=e.parentNode}return!!e}},{key:"isEmail",value:function(e){var t=!1;e&&(t=!!new RegExp(/\S+@\S+\.\S+/i).exec(e),t&&(t=e.indexOf('"')<0));return t}},{key:"intervalUntil",value:function(e){var t=0;if(!e())var n=setInterval((function(){t++,(e()||t>100)&&clearInterval(n)}),0);return!0}},{key:"hasGoogleError",value:function(e,t,n){try{this.PAssert(379,e,"Must specify a valid result object")}catch(u){this.reportError(u)}try{this.PAssert(380,t,"Must specify a valid error domain")}catch(u){this.reportError(u)}try{this.PAssert(381,n,"Must specify a valid error reason")}catch(u){this.reportError(u)}var r=!1;if(e&&e.error&&e.errors)for(var i=0,a=e.error.errors,o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o];if(s.domain===t&&s.reason===n){r=!0;break}}return r}},{key:"handleJSError",value:function(e,t,r,i){if(!e.message||!e.message.startsWith("Firebase Storage: Max retry time")&&!e.message.startsWith("ResizeObserver loop limit"))if(e){i||(i=E.a.LogLevels.Error);var a=this.getToolbox();if(a&&a.rollbar)try{var o=this.lastErrorsReported[e.stack];if(!o||o<Date.now()-5e3){var s=this.__LOG_BUFFER.ordered().join("\r\n"),u=a.settings?a.settings.getUserIdentifier():"No User Identifier";this.isRollbarConfigured||(a&&a.settings&&"me"!==u&&(this.isRollbarConfigured=!0),a.rollbar.configure({payload:{person:{id:u}},maxItems:E.a.__MAX_ERRORS_REPORTED,checkIgnore:this.rollbarIgnoreFn}));var l=this.parseExtra(t);if(this.numReported++,this.numReported<=E.a.__MAX_ERRORS_REPORTED){var c=n(100).default,d={};if(!this.isReporting){this.isReporting=!0;try{c.getAppInfo(d)}catch(f){}this.isReporting=!1}d.numReported=this.numReported;var h=Object.assign(this.getRollbarData(),{logs:s,info:d,user:u,extra:l});this.sendRollbar(e,h,i)}}this.lastErrorsReported[e.stack]=Date.now()}catch(e){this.log("Badness happened reporting errors to server: ",e);try{a.rollbar.error(e)}catch(p){this.log("More badness happened reporting errors to rollbar: ",p)}}}else console.log(e)}},{key:"reportError",value:function(e,t,n,r){this.handleJSError(e,t,!1,n)}},{key:"rollbarIgnoreFn",value:function(e,t,n){return!!(n&&n.body&&n.body.trace&&n.body.trace.frames&&n.body.trace.frames[0]&&z.indexOf(n.body.trace.frames[0].filename)>=0)}},{key:"parseExtra",value:function(e){return e?this.safeStringify(e):void 0}},{key:"isVowel",value:function(e){var t=e.toLowerCase();return"a"===t||"e"===t||"i"===t||"o"===t||"u"===t}},{key:"forEachValue",value:function(e,t){Object.keys(e).forEach((function(n){return t(e[n])}))}},{key:"isHTTPStatusCode",value:function(e,t){return e&&e.error&&e.error.code===t}},{key:"safeStringify",value:function(e){try{return JSON.stringify(e)}catch(t){0}}},{key:"makeString",value:function(e){for(var t=0,n="",r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n+=" "+this.safeStringify(e[r])}return n}},{key:"decodeHtmlEntity",value:function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(t)})).replace(/<[^>]*>/g,"")}},{key:"deepFreeze",value:function(e){return e}},{key:"stringRemove",value:function(e,t,n){return e.substr(0,t)+e.substr(t+n)}},{key:"round",value:function(e,t){return t=t||2,Number(Math.round((""+e).includes("e")?e:e+"e"+t)+"e-"+t)}},{key:"debugTime",value:function(e,t){}},{key:"arrayToObjectById",value:function(e){var t={};return e.forEach((function(e){return t[e.id]=e})),t}},{key:"mapArrayToObject",value:function(e,t){var n={};return e.forEach((function(e){return n[e]=t(e)})),n}},{key:"objectToArray",value:function(e){return Object.keys(e).map((function(t){return e[t]}))}},{key:"arrayFlat",value:function(e){return[].concat.apply([],e)}},{key:"isEmoji",value:function(e){return!!e&&0===Object(L.withoutEmoji)(e.replace(/ /g,"")).length}},{key:"addSpacesToCamelCase",value:function(e){for(var t=0,n=e,r=n.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;(n[r]>="A"&&n[r]<="Z"||!isNaN(n[r])&&(0===r||isNaN(n[r-1])))&&(n=n.substr(0,r)+" "+n.substr(r))}return n}},{key:"promiseSerial",value:function(e){return e.reduce((function(e,t){return e.then((function(e){return t().then(Array.prototype.concat.bind(e))}))}),Promise.resolve([]))}},{key:"decodeIDToken",value:function(e){try{var t=e.split(".");return JSON.parse(this.b64_to_utf8(t[1])).email.toLowerCase()}catch(n){this.reportError(n,"Error decoding id_token")}}},{key:"runSingletonPromise",value:function(){var e=o()(i.a.mark((function e(t,n){var r=this;return i.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return this.singletonPromises[t]||(this.singletonPromises[t]=new Promise(function(){var e=o()(i.a.mark((function e(a){var o;return i.a.wrap((function(e){for(var i=0,s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,n();case 2:o=e.sent,a(o),delete r.singletonPromises[t];case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.abrupt("return",this.singletonPromises[t]);case 2:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"tryParseJSON",value:function(e){try{return JSON.parse(e)}catch(t){}}},{key:"arrayMove",value:function(e,t,n){var r=e[n];e.splice(t,0,r),t<n&&n++,e.splice(n,1)}},{key:"promisify",value:function(){var e=o()(i.a.mark((function e(t){var n,r,a,o=0,s=this,u=arguments;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:n=u.length,r=new Array(n>1?n-1:0),a=1;case 1:if(!(a<n)){e.next=8;break}if(!(o++>5e3&&__infLoop&&__infLoop(o))){e.next=4;break}throw new RangeError;case 4:r[a-1]=u[a];case 5:a++,e.next=1;break;case 8:return e.abrupt("return",new Promise((function(e){var n=r.concat((function(){e.apply(this,arguments)}));t.apply(s,n)})));case 9:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"logWithTime",value:function(e){var t=Date.now(),n=t-(this.prevLogTime||0);this.prevLogTime=t,console.log(n,e),console.trace()}},{key:"isArrayEqualWithProperty",value:function(e,t,n){var r=0;if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var i=0;i<e.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i],o=t[i];if(!a[n]||!o[n]||a[n]!==o[n])return!1}return!0}},{key:"distance",value:function(e,t){return Math.floor(Math.sqrt(Math.pow(e,2)+Math.pow(t,2)))}},{key:"sum",value:function(e){return e.reduce((function(e,t){return e+t}),0)}},{key:"max",value:function(e){return(null===e||void 0===e?void 0:e.length)?e.reduce((function(e,t){return Math.max(e,t)})):void 0}},{key:"maxObject",value:function(e,t){for(var n=0,r=Number.MIN_SAFE_INTEGER,i=-1,a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t(e[a]);o>r&&(i=a,r=o)}return e[i]}},{key:"minObject",value:function(e,t){for(var n=0,r=Number.MAX_SAFE_INTEGER,i=-1,a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t(e[a]);o<r&&(i=a,r=o)}return e[i]}},{key:"lazyLoad",value:function(e,t){return this.lazyLoadedComponents[e]||(this.lazyLoadedComponents[e]=Object(D.lazy)(t)),this.lazyLoadedComponents[e]}},{key:"_mapRecursive",value:function(e,t,n,r,i){var a=this;t.forEach((function(t){e.push(i(t,r)),t[n]&&a._mapRecursive(e,t[n],n,r+1,i)}))}},{key:"mapRecursive",value:function(e,t,n){var r=[];return this._mapRecursive(r,e,t,0,n),r}},{key:"truncate",value:function(e,t){return e.length>t?e.slice(0,t)+"...":e}}]),e}(),k()(N.prototype,"parseBoolean",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"parseBoolean"),N.prototype),k()(N.prototype,"parseDate",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"parseDate"),N.prototype),k()(N.prototype,"cloneWithoutUndefineds",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"cloneWithoutUndefineds"),N.prototype),k()(N.prototype,"checkLowActivity",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"checkLowActivity"),N.prototype),k()(N.prototype,"runDateRollover",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"runDateRollover"),N.prototype),k()(N.prototype,"reportError",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"reportError"),N.prototype),N);function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var Y;!function(e){e[e.None=0]="None",e[e.Item=1]="Item",e[e.Element=2]="Element"}(Y||(Y={}));var Q=[0,5,15,35,80,170,400,1200],X=[0,408,429,500,502,503,504],$=(j=function(e){v()(n,e);var t=K(n);function n(){var e;return c()(this,n),e=t.call(this),window.__infLoop=e.infLoop,e.vmMain=void 0,e.archivedPadding=34,e.itemTransitionTime=100,e.scrollbarWidth=12,e.hasFocus=!0,e.demoMode=!1,e.focusedPane=void 0,e.focusedItem=void 0,e.ClickThreshold=5,e.isReconnected=!1,e.isBlocked=!1,e.blockedMessage="",e.authImmediateFailed=!1,e.authUserLoggedIn=!1,e.noLocalWritesReason=E.a.LocalWriteReason.Enabled,e.isLoadingRemote=!1,e.isSendingEmail=!1,e.isSavingDrafts=!1,e.itemMenuOpenedOn=void 0,e.errorPlatformInfo=void 0,e.MobileSideTapThreshold=40,e.MobileSideTapThresholdKeyboardOpen=15,e.colorBlue="#09d",e.colorLightBlue="#02b1ff",e.colorRed="#d43",e.colorLightRed="#f34433",e.MinItemWidth=50,e.paneTop=I.a.app?20:0,e.activeDisplayMode=E.a.DisplayMode.Default,e.eventStream=new V.a(25),e.currentFindPass=0,e.scrollTimeouts={},e.scrollState={speedPane:0,pane:void 0,speedPanes:0,panes:!1},e.keyboardDestination=Y.None,e.keyboardOpenedOn=void 0,e.keyboardBlurFn=void 0,e.keyboardStartScrollOffset=0,e.numLastLoop=-1,e.timeLastLoop=void 0,window.onerror=e.onWindowError,e.wrapAsyncCallbacks(),e.wrapXHR(),I.a.demo&&e.enableDemoMode(),e}return h()(n,[{key:"addDevFunctions",value:function(){var e=this,t=window;t.__globals=function(){return e};var n=1;this.shouldLog(E.a.LogLevels.Input)&&(t.__eventBuffer=new V.a(100)),this.tagEvent=function(r,i,a){r.id||(r.id=n++,e.shouldLog(E.a.LogLevels.Input)&&t.__eventBuffer.push(r)),e.shouldLog(E.a.LogLevels.Input)&&(r.activeHandler={owner:i,fn:a},r.handlers?r.handlers.push(r.activeHandler):r.handlers=[r.activeHandler])},this.Assert=function(){for(var n=0,r=0,i=arguments.length,a=new Array(i),o=0;o<i;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a[o]=arguments[o]}if(!a[0])try{a.length>1?t.__error.apply(console,a.slice(1).map((function(t){return e.isFunction(t)?t():t}))):t.__error("Assert Failure!")}catch(s){t.__error("Problem reporting Assert!")}},this.DAssert=function(t){t||e.log("Debug ONLY assert was hit.")},t.__getXHRStats=this.getXHRStats}},{key:"_dbgCatch",value:function(e){for(var t=0,n=0,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[a-1]=arguments[a]}try{if(e)return e.apply(void 0,i)}catch(o){this.reportError(o,i)}}},{key:"fnCatch",value:function(e){try{this.PAssert(131,e,"Must specify a callback")}catch(t){this.reportError(t)}return this._dbgCatch.bind(this,e)}},{key:"getTransitionClass",value:function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t}},{key:"setTransformStyle",value:function(e,t,n){try{this.PAssert(132,e,"Must provide a valid element")}catch(r){this.reportError(r)}if(e){try{this.PAssert(133,void 0!==t,"Must supply a valid X offset")}catch(r){this.reportError(r)}try{this.PAssert(134,void 0!==n,"Must supply a valid Y offset")}catch(r){this.reportError(r)}I.a.ie?e.style[I.a.transform.style]="translate("+t+"px, "+n+"px)":e.style[I.a.transform.style]="translate3d("+t+"px, "+n+"px, 0px)"}}},{key:"setTransitionStyle",value:function(e,t,n,r){try{this.PAssert(135,e,"Must provide a valid element")}catch(i){this.reportError(i)}e&&(r=r||"ease",e.style[I.a.transition.style]=t+" "+n+"ms "+r,setTimeout((function(){e.style[I.a.transition.style]=""}),n))}},{key:"setTransform",value:function(e,t,n,r,i){r>0?(this.setTransitionStyle(e,I.a.transform.prop,r,i),this.setTransformStyle(e,t,n)):t||n?this.setTransformStyle(e,t,n):e.style[I.a.transform.style]="none"}},{key:"reload",value:function(e){window.location.reload(e)}},{key:"parseTokensFromText",value:function(e){for(var t,n=0,r=[],i=/(?:(?:["]([^"<>]*)["]\s))|(?:([^",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,a=0;null!==(t=i.exec(e));){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e.substring(a,t.index),s=t[1]||t[2],u=t[3]||t[5];a=i.lastIndex,o&&o.trim().length>0&&r.push({text:o,type:"text"}),r.push({text:s||u,email:u,type:"contact"})}var l=e.substring(a,e.length);return l&&l.length>0&&r.push({text:l,type:"text"}),r}},{key:"preventLocalWrites",value:function(e){try{this.PAssert(136,!this.noLocalWrites,"Should only disable local writes once")}catch(t){this.reportError(t)}try{this.PAssert(137,e>=0,"Must provide a valid reason for disabling local writes")}catch(t){this.reportError(t)}this.isDemoMode()||this.shouldLog(E.a.LogLevels.Warning)&&this.log("---- WARNING: Local Writes Disabled ----"),this.noLocalWrites=!0,this.noLocalWritesReason=e}},{key:"enableDemoMode",value:function(){this.demoMode=!0,this.preventLocalWrites(E.a.LocalWriteReason.DemoMode)}},{key:"isDemoMode",value:function(){return this.demoMode}},{key:"isDisplayModeActive",value:function(e){return(this.activeDisplayMode&e)===e}},{key:"isDemoInIframe",value:function(){return this.isDisplayModeActive(E.a.DisplayMode.InIframe)}},{key:"enableMinMode",value:function(){try{var e=A.a.getURLParam("dmode");if(e){var t=parseInt(e);this.addClass(document.body,"minMode"),this.isMinMode=!0,t&E.a.DisplayMode.InIframe&&this.addClass(document.documentElement,"inIframe"),t&E.a.DisplayMode.Invisible&&this.addClass(document.documentElement,"invisible"),t&E.a.DisplayMode.NoBoards&&this.addClass(document.body,"noBoards"),t&E.a.DisplayMode.NoMinPaneSize&&(this.minPaneWidth=0),t&E.a.DisplayMode.NoPaneStyle&&this.addClass(document.body,"noPaneStyle"),t&E.a.DisplayMode.NoPanePadding&&(this.addClass(document.body,"noPanePadding"),this.noPanePadding=!0),t&E.a.DisplayMode.NoScrollbars&&(this.noScrollbars=!0),t&E.a.DisplayMode.NoBackground&&this.addClass(document.documentElement,"noBackground"),t&E.a.DisplayMode.ShowHelp&&this.getToolbox().intro.showHelp(),this.activeDisplayMode=t}}catch(n){this.reportError(n)}}},{key:"hasClass",value:function(e){try{this.PAssert(138,e,"Must pass in a valid element")}catch(r){this.reportError(r)}if(null===e||void 0===e?void 0:e.classList)for(var t=0,n=0;n<(arguments.length<=1?0:arguments.length-1);n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.classList.contains(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]))return!0}return!1}},{key:"removeClass",value:function(e,t){try{this.PAssert(139,e,"Must pass in a valid element")}catch(n){this.reportError(n)}e&&e.classList&&e.classList.remove(t)}},{key:"addClass",value:function(e,t){try{this.PAssert(140,e,"Must pass in a valid element")}catch(n){this.reportError(n)}e&&e.classList&&e.classList.add(t)}},{key:"toggleClass",value:function(e,t){try{this.PAssert(141,e,"Must pass in a valid element")}catch(n){this.reportError(n)}e&&e.classList&&e.classList.toggle(t)}},{key:"findChild",value:function(e,t){try{this.PAssert(142,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(e)for(var n=0,r=0;r<e.childElementCount;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.children[r];if(this.hasClass(i,t))return i;var a=this.findChild(i,t);if(a)return a}}},{key:"setupClick",value:function(e,t,n){var r=this;try{this.PAssert(143,e,"Expecting an object to bind the click handlers to.")}catch(O){this.reportError(O)}try{this.PAssert(144,t,"Must specify a valid owner for click handlers")}catch(O){this.reportError(O)}this.shouldLog(E.a.LogLevels.Input)&&this.log("SetupClick: "+this.elementToString(e)),t||(t=e);var i,a,o,s,u,l,c,d,h,f,p,g,v,m=this,y=!1;this.isFunction(n)?n={onClick:n}:n&&n.useCapture&&(y=n.useCapture);var _=function(e,r){try{m.PAssert(145,!t.isDestroyed||!t.isDestroyed()||"onMove"===e||"onEnd"===e,"Owner must not be destroyed to handle a click")}catch(O){m.reportError(O)}return n[e].call(t,r)},b=function(e){m.shouldLog(E.a.LogLevels.Input)&&r.log("Move: ",e.id);var t=e.eventX-i,p=e.eventY-a;if(0!==t||0!==p){var g=!u;if(i=e.eventX,a=e.eventY,e.distanceX=o+=Math.abs(t),e.distanceY=s+=Math.abs(p),(u||e.distanceX>r.ClickThreshold||e.distanceY>r.ClickThreshold)&&(u=!0,e.moved=u),n.onMove||n.onFirstMove)if(e.diffX=e.eventX-l,e.diffY=e.eventY-c,e.xThisFrame=t,e.yThisFrame=p,e.startX=l,e.startY=c,e.startClientX=d,e.startClientY=h,e.startSrc=f,g&&n.onFirstMove&&_("onFirstMove",e),n.onMove)_("onMove",e)&&e.stopImmediatePropagation()}},w=function(t){m.shouldLog(E.a.LogLevels.Input)&&m.log("End: ",t.id,m.elementToString(t.target),m.elementToString(e));var r=Date.now();p=p||r;var o=Math.max(0,r-p);g?g++:g=1,t.moved=u,t.timeDelta=o,t.diffX=i-l,t.diffY=a-c,t.startX=l,t.startY=c,t.startSrc=f,f=void 0,o<E.a.DoubleClickTime&&o>0&&n.onDoubleClick&&!u&&_("onDoubleClick",t),isNaN(t.button)||t.button===E.a.ButtonCode.Left?(p=r,!n.onClick||u||I.a.mac&&t.ctrlKey||_("onClick",t),n.onEnd&&_("onEnd",t)):t.button===E.a.ButtonCode.Middle&&n.onMiddleClick&&!u&&_("onMiddleClick",t),setTimeout((function(){p=void 0,g=void 0}),E.a.DoubleClickTime)},k=function(t){m.shouldLog(E.a.LogLevels.Input)&&m.log("Cancel: ",t.id,m.elementToString(t.target),m.elementToString(e)),n.onCancel&&_("onCancel",t)},S=function(t){m.shouldLog(E.a.LogLevels.Input)&&m.log("Start: ",t.id,m.elementToString(t.target),m.elementToString(e)),t.timeStart=Date.now(),f=t.target,t.startSrc=t.target,u=!1,t.startX=l=t.eventX,t.startY=c=t.eventY,t.startClientX=d=t.clientX,t.startClientY=h=t.clientY,i=t.eventX,a=t.eventY,o=0,s=0,(isNaN(t.button)||t.button===E.a.ButtonCode.Left||t.button===E.a.ButtonCode.Right)&&((isNaN(t.button)||t.button===E.a.ButtonCode.Left)&&n.onStart?_("onStart",t):t.button===E.a.ButtonCode.Right&&n.onRightStart&&_("onRightStart",t)),isNaN(t.changeLastY)||(a+=t.changeLastY)},P=this.fnCatch((function(t){var n=I.a.ie?t:t.touches[0];if(t.eventX=n.pageX,t.eventY=n.pageY,t.clientX=n.clientX,t.clientY=n.clientY,b.call(e,t),t.returnFalse)return!1})),D=this.fnCatch((function(t){m.shouldLog(E.a.LogLevels.Input)&&m.log("TouchUp: ",t.id,m.elementToString(t.target),m.elementToString(e)),document.removeEventListener(I.a.touchMoveEvent,P,y),document.removeEventListener(I.a.touchEndEvent,D,y),document.removeEventListener(I.a.touchCancelEvent,T,y);var n=I.a.ie?t:t.changedTouches[0];if(t.eventX=n.pageX,t.eventY=n.pageY,t.clientX=n.clientX,t.clientY=n.clientY,w.call(e,t),t.returnFalse)return!1})),T=this.fnCatch((function(t){if(m.shouldLog(E.a.LogLevels.Input)&&m.log("TouchCancel: ",t.id,m.elementToString(t.target),m.elementToString(e)),document.removeEventListener(I.a.touchMoveEvent,P,y),document.removeEventListener(I.a.touchEndEvent,D,y),document.removeEventListener(I.a.touchCancelEvent,T,y),k.call(e,t),t.returnFalse)return!1})),x=this.fnCatch((function(t){if(!t.handled&&!v)return m.shouldLog(E.a.LogLevels.Input)&&m.log("MouseDown: ",t.id,m.elementToString(t.target),m.elementToString(e)),v=!1,t.eventX=t.pageX,t.eventY=t.pageY,S.call(e,t),t.ignore||(t.button===E.a.ButtonCode.Left&&document.addEventListener(I.a.moveEvent,C,y),document.addEventListener(I.a.upEvent,A,y)),!t.returnFalse&&void 0})),C=this.fnCatch((function(t){if(!v)return t.eventX=t.pageX,t.eventY=t.pageY,b.call(e,t),!t.returnFalse&&void 0})),A=this.fnCatch((function(t){if(!t.handled&&!v)return m.shouldLog(E.a.LogLevels.Input)&&m.log("MouseUp: ",t.id,m.elementToString(t.target),m.elementToString(e)),document.removeEventListener(I.a.moveEvent,C,y),document.removeEventListener(I.a.upEvent,A,y),t.button===E.a.ButtonCode.Left&&w.call(e,t),!t.returnFalse&&void 0})),L=this.fnCatch((function(t){t.handled||v||(m.shouldLog(E.a.LogLevels.Input)&&m.log("ContextMenu: ",t.id,m.elementToString(t.target),m.elementToString(e)),n.onRightClick&&_("onRightClick",t))}));return e.addEventListener(I.a.downEvent,x,y),n.onRightClick&&e.addEventListener("contextmenu",L,y),this}},{key:"isDOMNode",value:function(e){return"HTMLElement"in window?e instanceof HTMLElement:e&&e.tagName&&e.nodeType===Node.ELEMENT_NODE}},{key:"ensureDOMNode",value:function(e){var t,n;e instanceof SVGPathElement?t=null===(n=e.parentElement)||void 0===n?void 0:n.parentElement:this.isDOMNode(e)?t=e:(this.isTextNode(e)||e instanceof SVGElement)&&(t=e.parentElement);return t}},{key:"enumToString",value:function(e,t){for(var n in e)if(e[n]===t)return n;return null}},{key:"elementToString",value:function(e,t){if(e){var n,r=e.nodeName;return e.id&&(r+="#"+e.id),(null===(n=e.className)||void 0===n?void 0:n.replace)&&(r+="."+e.className.replace(/ /g,".")),t&&e.innerText&&(r+=":"+e.innerText.length),r}return"UNDEFINED"}},{key:"getElementPath",value:function(e,t){var n=!0,r="";try{for(var i=0;e&&"container"!==e.id&&e!==document.documentElement&&e!==document.body;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r+=n?this.elementToString(e,t)+" ":this.elementToString(e)+" ",n=!1,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e.parentElement}}catch(a){r+=a.message}return r}},{key:"setDimension",value:function(e,t){window.ga&&!this.isDemoMode()&&ga("set",e,t)}},{key:"sendEvent",value:function(e,t,n){try{this.PAssert(147,void 0===n||this.isNumber(n),"Values must be numeric")}catch(r){this.reportError(r)}if(window.ga&&!this.isDemoMode())try{ga("send","event",e,t,this.getAnonUserIdentifier(),n)}catch(i){this.reportError(i,"Category: "+e+" Action: "+t+" Value: "+n)}}},{key:"sendToGoogle",value:function(e,t){var n="//www.googleadservices.com/pagead/conversion/976910954/?label="+e+"&guid=ON";t&&(n+="&value="+t+"&currency_code=USD"),new Image(1,1).src=n}},{key:"reportAdConversion",value:function(e,t){try{this.sendToGoogle(e,t)}catch(n){this.reportError(n)}}},{key:"pageDataCleared",value:function(){this.isPageDataCleared=!0}},{key:"hasPageDataBeenCleared",value:function(){return this.isPageDataCleared}},{key:"findFirstDiff",value:function(e,t,n,r){var i=0;if(!e)return r?0:t.length;if(!t)return r?e.length:0;for(var a=Math.min(e.length,t.length),o=0;o<a;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n){if(e.charAt(o).toLowerCase()!==t.charAt(o).toLowerCase())return o}else if(e.charAt(o)!==t.charAt(o))return o}return r?e.length:t.length}},{key:"lerp",value:function(e,t,n){return e+(t-e)*n}},{key:"hashCode",value:function(e){var t,n=0,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r=(r<<5)-r+e.charCodeAt(t),r|=0}return r}},{key:"sanitizePaneState",value:function(e){try{for(var t=0,n=JSON.parse(JSON.stringify(e)),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;""!==n[r].search&&(n[r].search="HasSearch")}return JSON.stringify(n)}catch(i){return"Failed to sanitize pane state"}}},{key:"sanitizeLocalSettings",value:function(e){try{var t=JSON.parse(e);return delete t.values.Default.paneState,delete t.values.Default.localPaneState,delete t.values.Default.gdocTitle,t}catch(n){return"Failed to parse settings"}}},{key:"sanitizeKey",value:function(e){switch(e){case E.a.KeyCode.Backspace:return"BACKSPACE";case E.a.KeyCode.Delete:return"DELETE";case E.a.KeyCode.Enter:return"ENTER";case E.a.KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}},{key:"getLoadedScripts",value:function(e){try{for(var t=0,n=document.getElementsByTagName("script"),r=[],i=0;i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i];a.src&&r.push(a.src)}e.loadedScripts=r}catch(o){e.loadedScripts="ERROR: "+o.message}}},{key:"getExtraReportData",value:function(e){e.platformConfig=I.a.getUserPlatformConfig()}},{key:"criticalErrorReported",value:function(){return this.hasCriticalError}},{key:"handleCriticalError",value:function(){var e=this;this.hasCriticalError=!0;try{document.body.innerHTML='<div class="centerVHFlex">There was a critical error while loading Moo.do. '.concat(I.a.actionVerb().capitalize()," to reload and try again.</div>"),document.body.addEventListener("click",(function(){return e.reload()}))}catch(t){this.reportError(t)}}},{key:"reportEvent",value:function(e){if(!this.isDemoMode()){var t=this.parseExtra(e);t&&this.eventStream.push(t)}}},{key:"getEventStream",value:function(){return this.eventStream.ordered()}},{key:"parseExtra",value:function(e){var t;if(e)try{var n;if(e instanceof KeyboardEvent){var r=this.elementToString(e.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(r)<0&&(n={type:e.type,currentTarget:this.elementToString(e.currentTarget),target:r,keyCode:this.sanitizeKey(e.keyCode),normCode:this.sanitizeKey(e.normCode),ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()})}else if(e instanceof MouseEvent)n={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof TouchEvent){n={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};var i=e.touches[0];i&&(n.clientX=i.clientX,n.clientY=i.clientY)}else if(window.PointerEvent&&e instanceof PointerEvent)n={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof Event)n={type:e.type,name:e.name,code:e.code,message:e.message,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};else if(e instanceof Selection)if(0===e.rangeCount)n={rangeCount:0};else{var a=e.getRangeAt(0),o=a.startContainer,s=!1,u=a.endContainer,l=!1;o.nodeType===Node.TEXT_NODE&&(o=o.parentNode,s=!0),u.nodeType===Node.TEXT_NODE&&(u=u.parentNode,l=!0),n={rangeCount:e.rangeCount,startContainer:this.getElementPath(o),startWasTextNode:s,startOffset:a.startOffset,endContainer:this.getElementPath(u),endWasTextNode:l,endOffset:a.endOffset}}else n=e;t=n?this.safeStringify(n):void 0}catch(c){this.log("Error parsing extra "+c.message)}return t}},{key:"handleJSError",value:function(e,t,r,i){e&&(!r&&window.__error&&window.__error("JS Error: "+e.message,"  Stack: ",e.stack,"  Extra: ",t),p()(b()(n.prototype),"handleJSError",this).call(this,e,t,r,i))}},{key:"onWindowError",value:function(e,t,n,r,i){console.log(e,t,n,r,i),"ResizeObserver loop limit exceeded"!==e&&"Script error."!==e&&(i?(this.log("Reported Global OnError: "+e+" Script: "+t+" Line: "+n+" Column: "+r),this.reportError(i)):(this.log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+n+" Column: "+r),this.reportError(e)))}},{key:"checkpoint",value:function(e){window.__checkpoints|=e}},{key:"wrapFn",value:function(e,t){var n=this;return function(){try{return e.apply(this,arguments)}catch(r){r&&"auth/network-request-failed"===r.code||(n.reportError(r),t&&t(r))}}}},{key:"wrapAsyncCallbacks",value:function(){var e=this,t=function(t){var n=window[t];window[t]=function(){var t=Array.prototype.slice.call(arguments),r=t[0];return"function"===typeof r&&(t[0]=e.wrapFn(r)),n.apply?n.apply(this,t):n(t[0],t[1])}};t("setTimeout"),t("setInterval")}},{key:"mergeObjects",value:function(e,t){var n,r=this;return Array.isArray(t)?(n=(n=[]).concat(e=e||[]),t.forEach((function(t,i){"undefined"===typeof n[i]?n[i]=t:"object"===u()(t)?n[i]=r.mergeObjects(e[i],t):-1===e.indexOf(t)&&n.push(t)}))):(n={},e&&"object"===u()(e)&&Object.keys(e).forEach((function(t){n[t]=e[t]})),Object.keys(t).forEach((function(i){"object"===u()(t[i])&&t[i]&&e[i]?n[i]=r.mergeObjects(e[i],t[i]):n[i]=t[i]}))),n}},{key:"readyStateCallback",value:function(e,t,n){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onreadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())},n&&(e.onerror=n)}},{key:"createPath",value:function(e){return window.location.protocol+"//"+window.location.host+"/"+e}},{key:"addScript",value:function(e,t,n,r){try{this.PAssert(148,!t||null===document.getElementById(t),"Should never include the same script ID multiple times")}catch(a){this.reportError(a)}var i=document.createElement("script");i.src=e,t&&(i.id=t),n&&this.readyStateCallback(i,n,r);try{this.PAssert(149,"undefined"!==typeof i,"Should always be able to create a valid script object")}catch(a){this.reportError(a)}"undefined"!==typeof i&&document.getElementsByTagName("head")[0].appendChild(i)}},{key:"addStylesheet",value:function(e,t,n){var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t&&this.readyStateCallback(r,t,n),"undefined"!==typeof r&&document.getElementsByTagName("head")[0].appendChild(r)}},{key:"DAssert",value:function(e,t){}},{key:"PAssert",value:function(e,t){var n=this;if(!t){var r={isAssert:!0,tag:e};try{var i=Array.prototype.slice.call(arguments,2),a=this.makeString(i.map((function(e){return n.isFunction(e)?e():e})));arguments.length>2?this.log("Assert Failure "+e+": "+a):this.log("Assert Failure "+e),this.reportError(new Error("Assert Failure: "+a),r,E.a.LogLevels.Warning)}catch(o){this.log("Exception in PAssert "+e+": ",o),this.reportError(o,r)}}}},{key:"getElementParent",value:function(e){var t=0;for(0;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"paneItemElement")||this.hasClass(e,"itemNotInPane")||this.hasClass(e,"paneHiddenInput")||this.hasClass(e,"draggable"))return e;e=e.parentNode}}},{key:"isItemValidForPass",value:function(e,t){return!!e&&(t?e.lastFindPass===this.currentFindPass:e.lastFindPass<this.currentFindPass)}},{key:"markItemForPass",value:function(e,t){if(e){var n=this.isItemValidForPass(e,t);try{this.PAssert(151,n,"Item should always be valid")}catch(r){this.reportError(r)}return e.lastFindPass=this.currentFindPass,n}return!1}},{key:"getPreviousItem",value:function(e,t,n){return this.currentFindPass++,this._getPreviousItem(e,t,n)}},{key:"_getPreviousItem",value:function(e,t,n){var r;var i=n&&n.isTest,a=n&&n.ignoreSearch,o=n&&n.sameLevel,s=n&&n.includeNotes;if(this.markItemForPass(e,i)){var u=e.parent();if(u){if(e.isNote())return e.parent();var l=u.getChildIndex(e);if(l>0)for(var c=0;!r;){var d=0;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;for(var h=!1,f=l-1;f>=0;f--){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var p=u.getChild(f);if(!this.markItemForPass(p,i)){try{this.PAssert(153,!1,"Invalid child found during findPreviousItem")}catch(g){this.reportError(g)}return}if(o||!p.hasChildren()||t&&p.isCollapsed(t,!1)){if(a||!t||!p.isHidden(t,!1)){r=p,h=!0;break}}else if(a||!t||!p.isHidden(t,!1)){u=p,l=p.numChildren(),h=!0;break}}if(o)break;h||(r=u)}else o||(r=e.parent());s&&r&&r.hasNote()&&(r=r.getNote());try{this.PAssert(154,!o||!r||r.parent()===e.parent(),"Previous item must share the same parent")}catch(g){this.reportError(g)}try{this.PAssert(155,i||!r||t&&r.isCollapsed(t,!1)||e===this._getNextItem(r,t,{isTest:!0,ignoreSearch:a,sameLevel:o}),"Previous/Next should always match")}catch(g){this.reportError(g)}return r}}}},{key:"getNextItem",value:function(e,t,n){return this.currentFindPass++,this._getNextItem(e,t,n)}},{key:"_getNextItem",value:function(e,t,n){var r,i=0;var a=n&&n.isTest,o=n&&n.ignoreSearch,s=n&&n.sameLevel,u=n&&n.includeNotes;if(e){if(u&&e.hasNote())return e.getNote();if(e.isNote()&&(e=e.parent()),!s&&e.hasChildren()&&(!t||!e.isCollapsed(t,!1)))for(var l=0,c=e.numChildren(),d=0;d<c;++d){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=e.getChild(d);if(!this.markItemForPass(h,a)){try{this.PAssert(157,!1,"Invalid child found during findNextItem A")}catch(b){this.reportError(b)}return}if(o||!t||!h.isHidden(t,!1)){r=h,n&&n.numLevels++;break}}for(var f=e;!r;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!this.markItemForPass(f,a)){try{this.PAssert(158,!1,"Invalid parent found during findNextItem B")}catch(b){this.reportError(b)}break}var p=f.parent();if(!p)break;var g=p.getChildIndex(f),v=p.numChildren();if(!t||!p.isCollapsed(t,!1))for(var m=0,y=g+1;y<v;++y){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var _=p.getChild(y);if(!this.markItemForPass(_,a)){try{this.PAssert(160,!1,"Invalid child found during findNextItem C")}catch(b){this.reportError(b)}return}if(o||!t||!_.isHidden(t,!1)){r=_;break}}if(f=p,n&&!r&&n.numLevels--,s||t&&f===t.getItem())break}try{this.PAssert(161,!s||!r||r.parent()===e.parent(),"Next item must share the same parent")}catch(b){this.reportError(b)}try{this.PAssert(162,a||!r||e===this._getPreviousItem(r,t,{isTest:!0,ignoreSearch:o,sameLevel:s}),"Previous/Next should always match")}catch(b){this.reportError(b)}return r}}},{key:"easeOut",value:function(e,t,n){return-n*e*(e-2)+t}},{key:"scrollElementTo",value:function(e,t){var n=!1;if(e){try{e.scrollTo(t),n=!0}catch(a){}if(!n){var r=t.left,i=t.top;void 0!==r&&(e.scrollLeft=r),void 0!==i&&(e.scrollTop=i)}}}},{key:"scrollTo",value:function(e,t,n,r,i){try{this.PAssert(163,void 0!==e||void 0!==t,"Must be scrolling something")}catch(o){this.reportError(o)}try{this.PAssert(164,void 0===e||this.isNumber(e),"Must provide a valid scrollPosX")}catch(o){this.reportError(o)}try{this.PAssert(165,void 0===t||this.isNumber(t),"Must provide a valid scrollPosY")}catch(o){this.reportError(o)}try{this.PAssert(166,this.isDOMNode(r),"Must provide a valid element to scroll")}catch(o){this.reportError(o)}try{this.PAssert(167,!i||this.isFunction(i),"Must provide a valid scrollDone callback")}catch(o){this.reportError(o)}var a=r.getAttribute("data-moo-id")||r.id;try{this.PAssert(168,a,"Should only scroll elements with ids")}catch(o){this.reportError(o)}this.scrollTimeouts[a]&&(cancelAnimationFrame(this.scrollTimeouts[a]),delete this.scrollTimeouts[a]),r?(this.scrollElementTo(r,{left:e,top:t,behavior:n}),i&&("smooth"===n?setTimeout(i,500):i())):this.reportError(new Error("Must specify an element to scroll to"))}},{key:"computeScrollSpeed",value:function(e,t,n,r,i){var a=(t-e-(t-(n=this.clamp(n,e,t))))/(t-e);return i<0&&(a-=1),a*r}},{key:"performRepeatScrollPane",value:function(){if(this.scrollState.pane){var e=this.scrollState.pane,t=e.id,n=this.scrollState.speedPane;e.addScrollDelta(n,"auto"),this.animationFrameOnce("repeatScroll"+t,this.performRepeatScrollPane)}}},{key:"repeatScrollPane",value:function(e,t){this.scrollState.speedPane=e,t!==this.scrollState.pane&&(this.scrollState.pane=t,this.animationFrameOnce("repeatScroll"+t.id,this.performRepeatScrollPane))}},{key:"performRepeatScroll",value:function(){if(this.scrollState.pane||this.scrollState.panes){var e;if(this.scrollState.pane){var t=6*this.scrollState.speedPane;e=this.scrollState.pane.addScrollDelta(t)}else{var n=6*this.scrollState.speedPanes,r=this.element("panes"),i=r.scrollLeft;r.scrollLeft+=n,e=i!==r.scrollLeft}e?requestAnimationFrame(this.performRepeatScroll):this.cancelRepeatScroll(this.scrollState.pane?"pane":"panes")}}},{key:"repeatScroll",value:function(e,t,n,r){this.scrollState["speed"+(n?"Pane":"Panes")]=t,(this.scrollState.pane||this.scrollState.panes)&&n===this.scrollState.pane||(this.scrollState.pane=n,this.scrollState.panes=r,requestAnimationFrame(this.performRepeatScroll))}},{key:"cancelRepeatScrolls",value:function(){this.scrollState.pane=void 0,this.scrollState.panes=void 0}},{key:"cancelRepeatScroll",value:function(e){this.scrollState[e]=void 0}},{key:"elementInPane",value:function(e){if(e){var t=0;for(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"pane")||this.hasClass(e,"paneOverviewOutside"))return!!e;e=e.parentElement}}return!1}},{key:"trimString",value:function(e){for(var t=0,n=/\s/,r=(e=e.replace(/^\s\s*/,"")).length;n.test(e.charAt(--r));)if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;return e.slice(0,r+1)}},{key:"preventAndStop",value:function(e){this.preventDefault(e),this.stopPropagation(e)}},{key:"preventDefault",value:function(e){if(e&&e.preventDefault)e.preventDefault();else try{this.PAssert(169,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}},{key:"stopPropagation",value:function(e){if(e&&e.stopPropagation)e.stopPropagation();else try{this.PAssert(170,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}},{key:"preventClick",value:function(){var e=this;this.addClass(this.element("outerWrapper"),"noClick"),window.ontouchstart=this.preventDefault,requestAnimationFrame((function(){window.ontouchstart=void 0,e.removeClass(e.element("outerWrapper"),"noClick")}))}},{key:"loadXML",value:function(e){try{var t=window;if("undefined"!==typeof t.DOMParser)return(new t.DOMParser).parseFromString(e,"text/xml");if("undefined"!==typeof t.ActiveXObject&&new t.ActiveXObject("Microsoft.XMLDOM")){var n=new t.ActiveXObject("Microsoft.XMLDOM");return n.async="false",n.loadXML(e),n}try{this.PAssert(171,!1,"No XML parser found")}catch(r){this.reportError(r)}return}catch(i){return void this.reportError(i)}}},{key:"getPluginForElement",value:function(e){return this.findParent(e,"plugin",4)}},{key:"findParentInItem",value:function(e,t){for(var n=0;e&&!this.hasClass(e,"item");){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this.hasClass(e,t))return e;e=e.parentNode}}},{key:"findParent",value:function(e,t,n){try{this.PAssert(172,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(n||(n=1e3),e)for(var r=0,i=e,a=0;a<n&&i;++a,i=i.parentElement){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if("string"===typeof t?this.hasClass(i,t):i===t)return i}}},{key:"findParentID",value:function(e,t,n){try{this.PAssert(174,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(n||(n=1e4),e)for(var r=0,i=e,a=0;a<n&&i;++a,i=i.parentNode){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i.id===t)return i}}},{key:"findParentAttr",value:function(e,t,n){try{this.PAssert(175,e,"Must pass in a valid element")}catch(a){this.reportError(a)}if(e)for(var r=0,i=e;i&&i.getAttribute;i=i.parentNode){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i.getAttribute(t)===n)return i}}},{key:"prependChild",value:function(e,t){try{this.PAssert(176,e,"Must pass in a valid element")}catch(n){this.reportError(n)}try{this.PAssert(177,t,"Must pass in a valid element")}catch(n){this.reportError(n)}e.insertBefore(t,e.firstChild)}},{key:"isAttachedToDoc",value:function(e){try{this.PAssert(178,e,"Must supply a valid element to check")}catch(t){this.reportError(t)}try{this.PAssert(179,e.ownerDocument,"Checked element must have a valid owner document")}catch(t){this.reportError(t)}return!!e.ownerDocument&&(e.ownerDocument.body.contains(e)||e.ownerDocument.documentElement===e)}},{key:"offset",value:function(e){try{this.PAssert(180,e,"Must pass in a valid element")}catch(a){this.reportError(a)}var t=e.getBoundingClientRect(),n=e.ownerDocument,r=e.ownerDocument.documentElement,i=n.defaultView;return{top:t.top+i.pageYOffset-r.clientTop,left:t.left+i.pageXOffset-r.clientLeft,bottom:t.bottom+i.pageYOffset-r.clientTop,right:t.right+i.pageXOffset-r.clientLeft}}},{key:"position",value:function(e){var t=e.offsetParent,n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return{left:n.left-r.left,top:n.top-r.top}}},{key:"height",value:function(e){try{this.PAssert(182,e,"Must pass in a valid element")}catch(r){this.reportError(r)}var t=e.offsetHeight,n=window.getComputedStyle(e);return n?("border-box"!==n.boxSizing&&(t-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom)),t-=parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth)):this.shouldLog(E.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::height"),t}},{key:"width",value:function(e){try{this.PAssert(184,e,"Must pass in a valid element")}catch(r){this.reportError(r)}var t=e.offsetWidth,n=window.getComputedStyle(e);return n?("border-box"!==n.boxSizing&&(t-=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)),t-=parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth)):this.shouldLog(E.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::width"),t}},{key:"wrapXHR",value:function(){try{var e=window,t=e.XMLHttpRequest.prototype.open,n=e.XMLHttpRequest.prototype.send,r=this;e.XMLHttpRequest.prototype.open=function(e,n,i,a,o){this.url=n,void 0===i&&(i=!0);try{t.call(this,e,n,i,a,o)}catch(s){throw r.reportError(s),s}},e.XMLHttpRequest.prototype.send=function(e){this.timeout||(this.timeout=r.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&n.call(this,e)}catch(t){throw r.reportError(t),t}}}catch(i){this.reportError(i)}}},{key:"element",value:function(e){try{this.PAssert(186,e,"Tried to get an element without an id")}catch(t){this.reportError(t)}return document.getElementById(e)}},{key:"openUrl",value:function(e,t,n){var r=this;try{this.PAssert(187,e,"Must always provide a valid URL to open")}catch(c){this.reportError(c)}if(!e)return!1;var i="/"===e[0]||e.indexOf("://")>0||e.startsWith("tel:")||e.startsWith("mailto:");e=i?e:"http://"+e;var a=this.getToolbox(),o=this.parseEvernoteLink(e);if(o){var s=!!a&&a.settings.openEvernoteApp.get();if(void 0===s)return void a.menus.confirm("Open Evernote links in Evernote app?",(function(i){a&&a.settings.openEvernoteApp.set(i),r.openUrl(e,t,n)}));s&&(e=o.viewUrl?o.viewUrl:"evernote:///view/"+o.userId+"/"+o.shardId+"/"+o.noteGuid+"/"+o.noteGuid+"/")}if(I.a.standalone){var u=document.createElement("a");u.setAttribute("href",e),u.setAttribute("target","_blank"),u.setAttribute("rel","noopener noreferrer");var l=document.createEvent("HTMLEvents");l.initEvent("click",!0,!0),u.dispatchEvent(l)}else if(I.a.app){try{this.PAssert(189,!0,"Should not open URL in globals on mobile")}catch(c){this.reportError(c)}I.a.isChrome||!e.startsWith("http://")&&!e.startsWith("https://")?e.startsWith("/")&&(e=window.location.host+e):e=e.replace("http://","").replace("https://",""),e.startsWith("callto:")&&(e=e.replace("callto:","tel:")),a.nativeBridge.sendToApp("openURL",e),t&&(this.preventAndStop(t),t.returnFalse=!0)}else(n=n||e.startsWith("evernote:///")||e.startsWith("onenote:")||e.startsWith("bear:"))?open(e,"_self"):open(e,"_blank");return!0}},{key:"getLocationOrigin",value:function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}},{key:"isSpellcheckEnabled",value:function(){return!1}},{key:"fFalse",value:function(){return!1}},{key:"fTrue",value:function(){return!0}},{key:"toFileSize",value:function(e){if(e){var t=Math.log(e)/Math.log(1024)|0;return(e/Math.pow(1024,t)).toFixed(2)+" "+(0===t?"bytes":"KMGTPEZY"[t-1]+"B")}return null}},{key:"saveFile",value:function(e,t){var n=new Blob([e],{type:"text/plain;charset=utf-8"});Object(P.saveAs)(n,t)}},{key:"downloadFile",value:function(e,t){var n=this.getToolbox();if(I.a.supportsNativeDownload())n.ElectronBridge.downloadFile(e,t);else if(document.createEvent){var r=document.createElement("a");r.href=e;var i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0),r.dispatchEvent(i)}else window.open(e,"_this")}},{key:"printPage",value:function(e){I.a.app||window.open(e).print()}},{key:"getItemForElement",value:function(e){var t=this.getPaneObjectForElement(e),n=t&&(this.isVMLI(t)?t:t.item);try{this.PAssert(190,!n||this.isVMLI(n),"Must always find a valid VMLI for a given element: "+this.elementToString(e))}catch(r){this.reportError(r)}if(n)return n}},{key:"getIndexForElement",value:function(e){var t=this.getPaneObjectForElement(e);return null===t||void 0===t?void 0:t.index}},{key:"getPaneForElement",value:function(e){var t=this.getPaneObjectForElement(e);return t?null===t||void 0===t?void 0:t.pane:this.getPropFromFiberNode(e,"pane")}},{key:"getPaneObjectForElement",value:function(e){var t=this.getPropFromFiberNode(e,"paneObject");if(t)return t}},{key:"getPropFromFiberNode",value:function(e,t){var n,r=0,i=e;for((null===(n=i)||void 0===n?void 0:n.nodeType)===Node.TEXT_NODE&&(i=i.parentElement);i&&i!==document;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i)for(var a in i)if(a.startsWith("__reactInternalInstance$")){var o=i[a];if(o){var s,u,l=null===o||void 0===o||null===(s=o.child)||void 0===s||null===(u=s.pendingProps)||void 0===u?void 0:u[t];if(!l)for(var c=0,d=o,h=o.return;h&&!l&&h!==d;){var f;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;l=null===(f=h.pendingProps)||void 0===f?void 0:f[t],h=h.return}if(l)return l}break}i=i.parentElement}}},{key:"btoa",value:function(e){return window.btoa(e)}},{key:"atob",value:function(e){return window.atob(e)}},{key:"elementFromPoint",value:function(e,t){return document.elementFromPoint(e,t)}},{key:"parentTextForItem",value:function(e){for(var t=0,n=e.parents(),r="",i=1;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i>1&&(r+="  |  "),r+=n[i].generateTitleText()}return r}},{key:"batchRenderUpdates",value:function(e,t){return C.a.unstable_batchedUpdates(e,t)}},{key:"hexToRgb",value:function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}},{key:"hexToRgbStr",value:function(e){var t=this.hexToRgb(e);return t.r+","+t.g+","+t.b}},{key:"rgbToHex",value:function(e,t,n){return[this.pad2(Math.round(e).toString(16)),this.pad2(Math.round(t).toString(16)),this.pad2(Math.round(n).toString(16))].join("")}},{key:"infLoop",value:function(e){if(!this.timeLastLoop||e<this.numLastLoop)this.timeLastLoop=Date.now();else if(e>this.numLastLoop&&e>3e4&&e%200===0&&Date.now()-this.timeLastLoop>1e4){0;try{this.PAssert(191,!1,"Infinite loop!",e)}catch(n){this.reportError(n)}var t=this.getToolbox();return t.toasts&&t.toasts.pushMessage(E.a.MessageID.ReactError),!0}this.numLastLoop=e}},{key:"XHR_PrivateAPI",value:function(e){var t=I.a.getDeployVar(E.a.DeployVariable.APIHost);e.url="https:".concat(t).concat(e.path),this.XHR(e)}},{key:"getRollbarData",value:function(){return{url:this.sanitizeURL(window.location.href),jsVersion:E.a.jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"}}},{key:"sendRollbar",value:function(e,t,n){window.Rollbar&&(n===E.a.LogLevels.Error?(Rollbar.error(e,t),this.sendEvent("ErrorReport","Error")):n===E.a.LogLevels.Warning?(Rollbar.warning(e,t),this.sendEvent("ErrorReport","Warning")):(Rollbar.error(e,t),this.sendEvent("ErrorReport","Unknown")))}},{key:"textToJSONPromise",value:function(e){try{return Promise.resolve(JSON.parse(e))}catch(t){}}},{key:"textToTextPromise",value:function(e){return Promise.resolve(e)}},{key:"XHR",value:function(){var e=o()(i.a.mark((function e(t){var n,r,a,o,s,u,l,c,d,h,f=this;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:n=t.url,r=t.type,a=t.data,o=t.headers,s=t.autoRetry,u=t.timeout,l=t.maxRetries,c=t.username,d=t.password,h=this;try{h.PAssert(192,n,"Must specify a valid URL to use")}catch(p){h.reportError(p)}try{h.PAssert(193,r,"Must specify a valid request type")}catch(p){h.reportError(p)}return e.abrupt("return",new Promise((function(e){var t=0;l=Math.min(l||2,6),f.notifyStatsXHRRequest(n);var i=function(){try{h.PAssert(194,t<l,"Should not be calling retry once retries have been exhausted")}catch(p){h.reportError(p)}t<l?(t++,f.notifyStatsXHRRetry(n),setTimeout(g,1e3*Q[t])):(f.notifyStatsXHRFailure(n),f.reportError(new Error("XHR Failed: "+n)))},g=function(){var h,p=new XMLHttpRequest;(void 0===u||isNaN(u)||(p.timeout=u),p.onreadystatechange=function(){if(4===p.readyState){var r=p;r.json=f.textToJSONPromise.bind(f,p.response),r.text=f.textToTextPromise.bind(f,p.response),200!==p.status?t<l?(p.retry=i,s&&X.indexOf(p.status)>=0?p.retry():e(r)):(f.notifyStatsXHRFailure(n),e(r)):(f.notifyStatsXHRSuccess(n),e(r))}},c&&d?p.open(r.toUpperCase(),n,!0,c,d):p.open(r.toUpperCase(),n,!0),o&&Object.keys(o).forEach((function(e){return p.setRequestHeader(e,o[e])})),a)?(p.setRequestHeader("Accept","*/*"),o&&o["Content-Type"]||p.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h=a instanceof Blob?a:f.generateQueryString(a),p.send(h)):p.send()};g()})));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"scheduleIdleTask",value:function(e){setTimeout(e,100)}},{key:"getReactChildByKey",value:function(e,t){var n;return T.a.Children.forEach(e,(function(e){e&&e.key===t&&(n=e)})),n}},{key:"onMouseMoveUp",value:function(e,t){document.addEventListener("mousemove",e),document.addEventListener("mouseup",(function n(r){t(r),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",n)}))}},{key:"createStyles",value:function(e){return e}},{key:"enforceBodyScroll",value:function(){var e=this;this._enforceBodyScroll(),requestAnimationFrame((function(){e._enforceBodyScroll(),requestAnimationFrame((function(){e._enforceBodyScroll()}))}))}},{key:"_enforceBodyScroll",value:function(){document.body.scrollTop=0,document.documentElement.scrollTop=0;var e=document.getElementById("container");e&&(e.scrollTop=0)}}]),n}(G),k()(j.prototype,"onWindowError",[S.a],Object.getOwnPropertyDescriptor(j.prototype,"onWindowError"),j.prototype),k()(j.prototype,"performRepeatScrollPane",[S.a],Object.getOwnPropertyDescriptor(j.prototype,"performRepeatScrollPane"),j.prototype),k()(j.prototype,"performRepeatScroll",[S.a],Object.getOwnPropertyDescriptor(j.prototype,"performRepeatScroll"),j.prototype),k()(j.prototype,"preventAndStop",[S.a],Object.getOwnPropertyDescriptor(j.prototype,"preventAndStop"),j.prototype),k()(j.prototype,"preventDefault",[S.a],Object.getOwnPropertyDescriptor(j.prototype,"preventDefault"),j.prototype),k()(j.prototype,"stopPropagation",[S.a],Object.getOwnPropertyDescriptor(j.prototype,"stopPropagation"),j.prototype),k()(j.prototype,"infLoop",[S.a],Object.getOwnPropertyDescriptor(j.prototype,"infLoop"),j.prototype),j),J=t.default=new $},function(e,t,n){"use strict";var r,i=n(33),a=n.n(i);Error.stackTraceLimit=1/0;var o={ScrollLock:3,Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,NumLock:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,ContextMenu:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadMultiply:106,NumPlus:107,NumpadAdd:107,Minus:109,NumpadSubtract:109,NumpadDecimal:110,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,VolumeMute:181,VolumeDown:182,VolumeUp:183,Semicolon:186,Equal:187,Plus:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,Backquote:229},s={CarriageReturn:10},u={};Object.keys(s).forEach((function(e){return u[e]=String.fromCharCode(s[e])}));var l={None:0,Note:32,Archived:128,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},c={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",DriveFull:"https://www.googleapis.com/auth/drive",DriveReadOnly:"https://www.googleapis.com/auth/drive.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",Plus:"",DriveInstall:"https://www.googleapis.com/auth/drive.install",Email:"email",Profile:"Profile"},d="api.moo.do",h="https://".concat(d),f="597847337936-ridipp5ac5bulesmmjici7rtjces027t",p={FirebaseAppID:"597847337936",FirebaseProjectID:"api-project-597847337936",APIKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50",ClientID:"".concat(f,".apps.googleusercontent.com"),ClientIDReversed:"com.googleusercontent.apps.".concat(f),APIBaseURL:d,APIFullURL:h,CloudFunctionsURL:"".concat(h,"/appapi/1/"),EmailOpenTime:250,ItemTransitionTime:150,DoubleClickTime:500,EmailPreviewSizeMin:600,EmailPreviewSizeMaxFlex:800,EmailPreviewSizeMax:1200,PremiumMaxBoards:5,PremiumMaxPanes:3,ExpandedPaneWidth:400,HelpWidth:360,PaneWidthMin:200,StdPaneWidthMin:400,StdPaneWidthMax:900,PaneWidthMax:1400,OverviewWidth:260,OverviewItemHeightDesktop:26,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,MSPerMinute:6e4,MSPerHour:36e5,MSPerDay:864e5,MSPerWeek:6048e5,DefaultEventDuration:36e5,MaxBatchSize:45,TooltipDelay:1e3,HorizScrollbarHeight:18,DesktopToolbarHeight:32,PaneHeaderButtonWidth:32,PaneHeaderButtonHeight:36,PaneHeaderButtonIconHeight:28,PaneHeadingHeightSmall:40,CalendarResizeHandleHeight:8,CalendarTimesWidth:50,DesktopMenuWidthDefault:120,DesktopMenuWidthMax:240,DesktopMenuWidthMinBig:66,DesktopMenuWidthSmall:36,RootItemName:"Home",MinEmailScale:.25,SidebarDragHandleSize:16,SearchHeight:22,PaneAddItemBoxHeight:36,DateFormat:{DMY:"dmy",DMYDot:"dmydot",MDY:"mdy",YMD:"ymd",YMDDot:"ymddot"},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:"None",Reply:"Reply",ReplyAll:"Reply All",Forward:"Forward",Compose:"New Message"},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},TaskViewModesNew:["Outline","List","Calendar","-","Archived","Deleted"],PaneModesNonTask:["Email","Files","Legacy Email"],TaskViewGroups:["None","Project","Tag","Contact","Priority","Agenda","Date","Created","Modified","Completed"],TaskViewSorts:["None","Alphabetical","NumItems","Priority","Date","Created","Completed","Modified"],TaskAgendaOptions:["Today","Week","Month","All"],TaskCalendarOptions:["Day","Custom","Week","Month"],TaskViewModesPremium:{Groups_Tag:!0,Groups_Contact:!0,Groups_Priority:!0},TaskViewModeText:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Project",Groups_Tag:"Tag",Groups_Contact:"Contact",Groups_Priority:"Priority",Agenda_Today:"Today",Agenda_Week:"Week",Agenda_Month:"Month",Agenda_All:"All",Calendar_Day:"Day",Calendar_Custom:"# Days",Calendar_Week:"Week",Calendar_Month:"Month",Archived:"Archive",Deleted:"Deleted"},TaskViewModeTextSimple:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priorities",Agenda_Today:"Agenda",Agenda_Week:"Agenda",Agenda_All:"Agenda",Calendar_Day:"Calendar",Calendar_Custom:"Calendar",Calendar_Week:"Calendar",Calendar_Month:"Calendar",Archived:"Archived Items",Deleted:"Deleted Items"},TaskViewModeIcon:{Outline:"icon-format_list_bulleted",List_Flat:"icon-reorder",Groups_Project:"icon-project",Groups_Tag:"icon-hash",Groups_Contact:"icon-user",Groups_Priority:"icon-exclamation",Agenda_Today:"icon-today",Agenda_Week:"icon-view-groups",Agenda_Month:"icon-reorder",Agenda_All:"icon-format_align_justify",Calendar_Day:"icon-view_carousel",Calendar_Custom:"icon-view_week",Calendar_Week:"icon-cal-week",Calendar_Month:"icon-view_comfy",Archived:"icon-inbox",Deleted:"icon-delete"},TaskSortModeText:{None:"None",Alphabetical:"A-Z",NumItems:"# Items",Priority:"!!!",Date:"Date",Created:"Created",Completed:"Completed",Modified:"Modified"},DocumentSortMode:{Alphabetical:"Alphabetical",Modified:"Modified"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:52,CalendarDayViewNumDaysPad:364,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,CalendarMaxSyncWeeks:52,CalendarMinSyncWeeks:-52,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},DFormat:{LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},HelpMode:{None:0,Normal:1,Hotkeys:3},Pricing:{None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3,ThreeYear:4},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailViewMode:{Date:"Date",Priority:"Priority"},MaxGmailSyncTime:{Premium:120,Free:5},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1,Portrait:0,Landscape:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown",SpacingCompact:"SpacingCompact",SpacingComfortable:"SpacingComfortable",PrefixesFaded:"PrefixesFaded",PrefixesStrong:"PrefixesStrong"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Header2:"^",Bullet:"-",Bullet2:"*",Task:"[",Task2:"[]",Task3:"]",Task4:"[ ]",NumList:"1.",CodeBlock:"```"},SearchFilterTexts:{Star:"*",Pri0:"!!!",Pri1:"!!",Pri2:"!"},MinimumTokenExpireTimeMS:6e4,MinimumTokenExpireTime:60,ToastTimeoutDefault:5e3,PrefixWidth:20,PrefixOffsetFromItem:5,PaddingAgendaTime:30,HeightAgendaParents:18,LineLeftPad:5,TextSpace:"\ufeff",TextSpaceRegexp:/\uFEFF/g,AttachChar:"\u2000",EmbedAttachChar:"\u2001",RNSpace:"\u2002",CharDate:"\ufefe",PerPaneStateField:{Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},ItemStoreFilter:{None:0,Dates:1,Contacts:2,Priority:4},NumKeys:[o.D1,o.D2,o.D3,o.D4,o.D5,o.D6,o.D7,o.D8,o.D9,o.D0],ContactPrefix:"+",TagPrefix:"#",PrefixDate:"!",PrefixItemAutocomplete:"$",KeyCode:o,KeyCodesModifiers:[o.LeftMeta,o.ContextMenu,o.Ctrl,o.Alt,o.Shift],KeyCodesArrows:[o.ArrowUp,o.ArrowDown,o.ArrowLeft,o.ArrowRight],PrivateAPIErrorCodes:{Success:0,UnknownFailure:1,Unexpected:2,DatabaseReadError:3,DatabaseWriteError:4,MissingParameter:5,InvalidParameter:6,UnauthorizedUser:7,ErrorSendingEmail:8,AlreadyReferred:9,ErrorContactingRemote:10,BraintreeUnknown:11,InvalidToken:12,InvalidReferralCode:13,NoSignupFound:14,TrialOver:15,RemoteServerError:16,TokenMissing:17,BraintreePaypalBlock:18,BraintreeInvalidCCN:19,AlreadyExists:20,DomainPolicy:21,InvalidCode:22,RejectedEmail:23,AlreadyPremium:24,MissingIDToken:25},SearchDates:{Overdue:"@overdue",Before:"before:",After:"after:",Date:"date:",Between:"between:"},Regexp:{MDLink:/(!?)\[([^\[]*)\]\(([^\s\)]+)(\s=\d{0,3}x)?(?=\))\)/g,Prefix:/^(```[A-Za-z]*|\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) /gi,HR:/^(?:(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) )?(-{3,})$/gi,Interlink:/\[\[([\w|~|-]*)\]\]/g,InterlinkWithText:/\[\[([\w|~|-]*)(?:[^\[\]]*)\]\]/g,MDFormat:/[*_~`]/g,DataImage:/(?:!?(?:\[\]\()?)(data:image\/(?:[a-zA-Z]*);base64,(?:[^\"\)\s]*))(\s=\d{0,3}x)?(?:\)?)/gi},DefaultBackupFrequency:36e5,DriveFolder:{Root:"root",Attach:"attach",Backup:"backup"},CrudActions:{Added:"Added",Modified:"Modified",Removed:"Removed"},TestDocName:"demo",LocalStoreMode:{Mirror:"mirror"},LogLevels:{Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Edit:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},URLPart:{Search:1,Hash:2},PremiumStatus:{Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},UninitializedVersion:-1,DETAILED_STATS:!1,DEBUG_DATE:!1,OAuthSchemeType:{Invalid:-1,None:0,Web:1,Native:2,Count:2},RepeatFreq:{Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},ChangeType:{None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},DataChangeType:{Add:1,Remove:2,Change:3},VMLIFlag:l,VersionType:{Structure:1,Text:2},SearchResultStatus:{Done:1,TooMany:2,None:3,Error:4},PaneMode:{Task:"PaneTask",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail",Inbox:"PaneInbox"},LoadState:{Connecting:0,NeedPassword:1,LoadingDocs:2,Connected:3},LoginState:{NONE:0,LOGGED_OUT:1,LOGGED_IN:2},ButtonCode:{None:-1,Left:0,Middle:1,Right:2},Direction:{Up:-1,None:0,Down:1},MessageAction:{Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenGeneralSettings:18,OpenCalendarSettings:19},MessageType:{Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},MessageID:{Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,FlatSearchMultiSelect:43,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49,ReactError:50,PaneLoadTimeout:51,SetupGmailViews:52,GmailViewsNeedSignin:53,OutlookViewsNeedSignin:54},SaveFlag:{None:0,Prop:1,Text:2,All:3},DateType:{Once:1,Repeat:2},StorageType:{InMemory:1,LocalStorage:2,IndexedDB:3},DataSource:{Paste:1,Drop:2,Plugin:3},PluginID:{Date:"Date",Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar",Email:"Email"},PluginNames:{Date:"Date",Moodo:"Moodo",Contacts:"Google Contacts",Drive:"Google Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"Google Calendar",Email:"Email"},PluginSettingsID:{Date:{IsEnabled:"isEnabled"},Moodo:{IsEnabled:"isEnabled"},Mailbird:{IsEnabled:"isEnabled"},Gmail:{IsEnabled:"isEnabled",ArchiveOnSchedule:"archiveOnSchedule",ArchiveOnOrganize:"archiveOnOrganize",InsertSignatureAboveReplies:"insertSignatureAboveReplies",SyncTime:"syncTime",SyncAccounts:"syncAccounts"},Drive:{IsEnabled:"isEnabled",LastChangeId:"lastChangeId",DriveRootId:"driveRootId"},GCalendar:{IsEnabled:"isEnabled",ImportCalendars:"importCalendars",ExportCalendar:"exportCalendar",WeeksPast:"weeksPast",WeeksFuture:"weeksFuture",DisplayOverdueInAgenda:"displayOverdueInAgenda",SyncNewEvents:"syncNewEvents",SyncDraggedEvents:"syncDraggedEvents",CreateLocalEvents:"createLocalEvents",SyncPopup:"syncPopup"}},PluginLoad:{None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},PluginDependency:{DemoMode:"DemoMode",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess"},PluginRenderTypes:{Generic:0,StyledText:1,UnstyledText:2,Measure:3,RichText:4},Modals:{ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode",Backups:"backups",ConfirmEncrypt:"confirmEncrypt",Date:"date",Note:"note",AutocompleteList:"autocompleteList",Contact:"contact",ExternalLink:"ExternalLink",DropBucket:"dropBucket",ModalPane:"modalPane",ModalAccountSettings:"accountSettings",ErrorCookies:"ErrorCookies",CreateTemplate:"CreateTemplate",ItemEditor:"ItemEditor",About:"About",GmailAuth:"GmailAuth",OutlookAuth:"OutlookAuth"},DisplayMode:{Default:0,InIframe:1,NoBoards:2,Invisible:4,NoScrollbars:8,NoBackground:16,ShowHelp:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,FullMin:8191},Checkpoint:{MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},PlatformOS:{Unknown:0,iPhone:1,iPad:2,iPod:3,Android:4,Mac:5,Windows:6,Linux:7,ChromeOS:8},PlatformBrowser:{Unknown:0,Electron:1,Mailbird:2,Chrome:3,Firefox:4,Safari:5,IE:6,Edge:7,Opera:8},PlatformConfig:{DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},AppPlatform:{iOS:0,Android:1,Embed:2,Electron:3},EmbedApps:{Mailbird:"mailbird"},DeployVariable:{Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},GScope:c,GScopeArray:[c.Calendar,c.CalendarRO,c.Contacts,c.Drive,c.DriveMetadataRO,c.DriveFull,c.DriveReadOnly,c.GmailCompose,c.GmailModify,c.TasksRO,c.UserInfoEmail,c.UserInfoProfile,c.DriveAppData,c.Plus,c.Email,c.Profile,c.DriveInstall,"openid"],ScopesDefault:[c.UserInfoEmail,c.UserInfoProfile],jsVersion:"1610169678972",__devServerURL:"##DEV_SERVER_URL##",__MAX_ERRORS_REPORTED:50,ProductName:"Moo.do",EncryptionSentinel:"MDsentinel",EncryptionKeys:{Global:"Global",UserPassword:"UserPassword"},PMask:l.P0|l.P1|l.P2,PriorityClass:(r={},a()(r,l.None," "),a()(r,l.P0," p0"),a()(r,l.P1," p1"),a()(r,l.P2," p2"),r),OverviewPaddingStart:0,OverviewPaddingIncrement:10,ColorBrand:"#0099dd",DocumentAccessRoles:{Read:0,Write:1,Admin:2},Colors:{Brand:"#0099dd",Red:"#C9302C",P0:"#f30",P1:"#fa0",P2:"#fc3",Star:"#ffb",Complete:"#d6d6d6",Mobile:{Header:"#f6f6f6"}},SPThresholdRight:42,ItemPaddingRightVirtuoso:30,ItemPaddingRightVirtuosoAgenda:50,PluginPad:8,MinItemWidth:50,ModalMaxWidthPerc:90,ModalMaxHeightPerc:85,RegexpFlags:{WebUrl:1,MDLink:2,Date:4,Markdown:8,HR:16,Email:32,Contact:64,Tag:128,ItemLink:256,Plugin:512,Prefix:1024,FileUrl:2048,MarkdownEscaped:4096,DataImage:8192,All:16383},MobileItemIndentStart:10,OverviewItemHeightMobile:36,CollapserWidth:36,WidthAgendaTime:70,Markdown:{bold:"**",italic:"*",underline:"__",strike:"~~",code:"`"},TransitionSpring:{type:"spring",duration:.4,bounce:.21},TransitionSpring2:{type:"spring",duration:.3,bounce:.21},TransitionSpring3:{type:"spring",duration:.25,bounce:.21},TransitionSpring4:{type:"spring",duration:.2,bounce:.21},TransitionSpring5:{type:"spring",duration:.15,bounce:.21},TransitionSpring6:{type:"spring",duration:.1,bounce:.21},TransitionSpring7:{type:"spring",duration:.05,bounce:.21},TransitionSpringFastestest:{type:"spring",damping:200,stiffness:4e3},TransitionSpringFastest:{type:"spring",damping:56,stiffness:1e3},TransitionSpringFaster:{type:"spring",damping:40,stiffness:600},TransitionSpringFast:{type:"spring",duration:.3,bounce:.21},TransitionSpringMediumer:{type:"spring",damping:30,stiffness:500},TransitionSpringMedium:{type:"spring",damping:25,stiffness:400},TransitionSpringSlow:{type:"spring",damping:20,stiffness:400},TransitionSpringSlower:{type:"spring",damping:15,stiffness:400},TransitionTime:{duration:1},TransitionImmediate:{duration:0},PaddingTopBlockHeader:32,TopBoxHeight:36,TextPaddingLeft:5,SizeReductionInlineCode:2,ListOverscan:300,Mobile:{TopBarHeight:48,BottomBarHeight:48},CharCode:s,Chars:u,ItemClass:"itemInPane itemNew paneItemElement"};t.a=p},function(e,t,n){"use strict";n.r(t);var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(17),l=n.n(u),c=n(18),d=n.n(c),h=n(19),f=n.n(h),p=n(11),g=n.n(p),v=n(0),m=n(100),y=n(1),_=n(7),b=n.n(_),w=n(8),k=n(12),S=n(60),E=n(13),P=n(68),I=n(47);function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var T={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,boldHeaders:!1,fontSize:14,showVerticalLines:!0,verticalLinesOpacity:6,font:"",fontWeight:"normal",Colors:{light:{prefixColor:"#222222",verticalLinesColor:32,tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{prefixColor:"#F6F6F6",verticalLinesColor:255,tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}},x=(r=function(e){d()(n,e);var t=D(n);function n(){var e;if(a()(this,n),(e=t.call(this)).styles={},e.stylesheet={},e._paddingsForLevel={},e.isOpen=new E.a,e.systemColorTheme=new E.a,e._fontSize=new E.a,e._fontSizeHeader=new E.a,e._fontSizeHeaderTopLevel=new E.a,e._noteFontSize=new E.a,e._itemPadding=new E.a,e._notePadding=new E.a,e._itemLineHeight=new E.a,e._noteLineHeight=new E.a,e._itemIndentSize=new E.a,e._font=new E.a(void 0,e._onFontChange),e._fontWeight=new E.a,e._boldHeaders=new E.a,e._fontSizeCodeBlock=new P.a([e._fontSize],(function(e){return e-2})),e.Themes={SpacingCompact:{itemLineHeight:18,itemPadding:3,itemIndentSize:20,fontSizeHeader:16,fontSizeHeaderTopLevel:16},SpacingComfortable:{itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSizeHeader:16,fontSizeHeaderTopLevel:18},PrefixesFaded:{projectOpacity:30,numListOpacity:30,collapserOpacity:20,bulletOpacity:30,checkboxOpacity:25,checkboxBackgroundOpacity:0},PrefixesStrong:{projectOpacity:80,numListOpacity:80,collapserOpacity:80,bulletOpacity:80,checkboxOpacity:80,checkboxBackgroundOpacity:20}},k.a.app)0;else{e.timeoutSettingChanged=void 0;var r=window.matchMedia("(prefers-color-scheme: dark)");if(r){e.systemColorTheme.set(r.matches?"dark":"light");var i=function(t){e.setSystemDarkMode(t.matches)};r.addEventListener?r.addEventListener("change",i):r.addListener&&r.addListener((function(e){"change"===e.type&&i(e)}))}}return e}return s()(n,[{key:"init",value:function(){this.updateSettingValues(),Xh.settings.ui.listen(this.onSettingChanged),this.updateStyles()}},{key:"getSettingValue",value:function(e){var t=Xh.settings.ui[e].get();return t===T.Desktop.Colors.light[e]?T.Desktop.Colors[this._colorTheme][e]:t}},{key:"getThemeValue",value:function(e){var t=this.Themes.SpacingComfortable[e];return void 0===t&&(t=this.Themes.PrefixesFaded[e]),void 0===t&&(t=T.Desktop[e]),void 0===t&&(t=T.Desktop.Colors[this._colorTheme][e]),t}},{key:"setFromThemeValue",value:function(e,t){Xh.settings.ui[t].set(this.getThemeValue(t))}},{key:"updateSettingValues",value:function(){try{this._colorTheme=this.getColorTheme(),v.default.isString(this._colorTheme)||(this._colorTheme="light"),this._prefixColor=T.Desktop.Colors[this._colorTheme].prefixColor,this._verticalLinesColor=T.Desktop.Colors[this._colorTheme].verticalLinesColor,this._boldHeaders.set(this.getSettingValue("boldHeaders")),this._showVerticalLines=this.getSettingValue("showVerticalLines"),this._fontSize.set(this.getSettingValue("fontSize",!0)),this._fontSizeHeader.set(this.getSettingValue("fontSizeHeader",!0)),this._fontSizeHeaderTopLevel.set(this.getSettingValue("fontSizeHeaderTopLevel",!0)),this._noteFontSize.set(this.getSettingValue("noteFontSize",!0)),this._itemPadding.set(this.getSettingValue("itemPadding",!0)),this._notePadding.set(this.getSettingValue("notePadding",!0)),this._itemLineHeight.set(this.getSettingValue("itemLineHeight",!0)),this._noteLineHeight.set(T.Desktop.noteLineHeight),this._itemIndentSize.set(this.getSettingValue("itemIndentSize",!0)),this._fontWeight.set(this.getSettingValue("fontWeight",!0)),this._bulletOpacity=this.getSettingValue("bulletOpacity",!0),this._projectOpacity=this.getSettingValue("projectOpacity",!0),this._numListOpacity=this.getSettingValue("numListOpacity",!0),this._collapserOpacity=this.getSettingValue("collapserOpacity",!0),this._checkboxOpacity=this.getSettingValue("checkboxOpacity",!0),this._checkboxBackgroundOpacity=this.getSettingValue("checkboxBackgroundOpacity",!0),this._verticalLinesOpacity=this.getSettingValue("verticalLinesOpacity",!0),this._tagColor=this.getSettingValue("tagColor",!0),this._dateColor=this.getSettingValue("dateColor",!0),this._contactColor=this.getSettingValue("contactColor",!0),this._linkColor=this.getSettingValue("linkColor",!0),this._grayscale=this.getSettingValue("grayscale"),this._cursorBlink=this.getSettingValue("linkColor",!0);var e=this.getSettingValue("font",!0),t=k.a.windows&&e.w||k.a.mac&&e.m||e.l;this._font.set(t)}catch(n){}}},{key:"_onFontChange",value:function(e){var t=(k.a.windows?"w":k.a.mac&&"m")||"l";Xh.settings.ui.font.setProperty(t,e)}},{key:"onSettingChanged",value:function(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))}},{key:"_updateSettings",value:function(){var e=this._fontSize.get(),t=this._fontSizeHeader.get(),n=this._fontSizeHeaderTopLevel.get(),r=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var i=this._fontSize.get()!==e||this._fontSizeHeader.get()!==t||this._fontSizeHeaderTopLevel.get()!==n||this._noteFontSize!==r;this._paddingsForLevel={},this.fireEvent("settingsChanged",[i]),Xh.PaneManager&&Xh.PaneManager.clearPaneCaches(),this.updateStyles()}},{key:"fontSize",value:function(){return this._fontSize.get()}},{key:"fontSizeHeader",value:function(){return this._fontSizeHeader.get()}},{key:"fontSizeHeaderTopLevel",value:function(){return this._fontSizeHeaderTopLevel.get()}},{key:"fontSizeHeaderProjectView",value:function(){return 17}},{key:"noteFontSize",value:function(){return this._noteFontSize.get()}},{key:"itemPadding",value:function(){return this._itemPadding.get()}},{key:"notePadding",value:function(){return this._notePadding.get()}},{key:"itemLineHeight",value:function(){return this._itemLineHeight.get()}},{key:"noteLineHeight",value:function(){return this._noteLineHeight.get()}},{key:"itemIndentSize",value:function(){return this._itemIndentSize.get()}},{key:"itemIndentStart",value:function(){return 50}},{key:"paddingForBlockHeader",value:function(){return 0}},{key:"paddingForItemBottom",value:function(){return this.itemPadding()}},{key:"paddingForItemTop",value:function(e){var t,n=this.itemPadding();e.index>0&&e.isBlockHeader&&(n+=(null===(t=e.blockPrevious)||void 0===t?void 0:t.isCollapsed())?y.a.PaddingTopBlockHeader/4:y.a.PaddingTopBlockHeader);return n}},{key:"paddingForItemRight",value:function(e){var t,n;return(null===(t=(n=e.pane).shouldShowTime)||void 0===t?void 0:t.call(n,e))?y.a.ItemPaddingRightVirtuosoAgenda:y.a.ItemPaddingRightVirtuoso}},{key:"fontSizeForItem",value:function(e){return this.fontSizeObsForItem(e).get()}},{key:"fontSizeObsForItem",value:function(e){var t=e.item,n=e.pane;if(t.isPrefixCodeBlock())return this._fontSizeCodeBlock;if(t.isPrefixHeader()){if(n.isItemTopLevel(e))return this._fontSizeHeaderTopLevel;if(n.isViewOutline())return this._fontSizeHeader}return this._fontSize}},{key:"lineHeightForItem",value:function(e){var t=e.item,n=this.itemLineHeight()-this.fontSize();return t.isNote()?this.noteLineHeight():this.fontSizeForItem(e)+n}},{key:"boldHeaders",value:function(){return this._boldHeaders.get()}},{key:"createSheet",value:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.rel="stylesheet",e.appendChild(t),this.sheet=t.sheet}},{key:"getThemeObs",value:function(){return Xh.settings.ui.themeDesktop}},{key:"changeColorTheme",value:function(e){k.a.isNativeApp()&&Xh.settings.appSystemDarkMode.get()&&Xh.settings.appSystemDarkMode.set(!1),this.getThemeObs().set(e),this._updateColorTheme(e)}},{key:"_updateColorTheme",value:function(e){e!==this._colorTheme&&(this._colorTheme=e,this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))}},{key:"changeTheme",value:function(e,t){this.isChangingTheme=!0;var n=this.Themes[t];for(var r in n)n.hasOwnProperty(r)&&Xh.settings.ui[r].set(n[r]);e.set(t),this.isChangingTheme=!1,this._updateSettings()}},{key:"updateStyles",value:function(){var e=0;if(this.sheet){var t=this.sheet.ownerNode;t.parentNode.removeChild(t)}this.createSheet();var n=[];if(this.boldHeaders()&&n.push(".item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var r=this.itemIndentSize(),i=this._verticalLinesColor,a="rgba("+i+","+i+","+i+",",o=a+.01*this._verticalLinesOpacity+")",s=a+"0)";n.push(".vertLines { background: repeating-linear-gradient(to right, "+s+" 0, "+o+" 1px, "+s+" 2px, "+s+" "+r+"px) }")}n.push(".item:not(.hasNote) .line.last .itemPrefix:not(.prefixTask):before { bottom: "+this.itemPadding()+"px; }"),n.push(".item:not(.hasNote) .line.last .prefixTask:before { bottom: "+(this.itemPadding()+(this.itemLineHeight()-18)/2)+"px; }"),n.push(".item .prefixTask:before { margin-top: "+(this.itemLineHeight()-14)/2+"px; }"),n.push(".heightLineHeight { min-height: ".concat(this.itemLineHeight(),"px; }"));var u="rgba("+v.default.hexToRgbStr(this._prefixColor)+","+.01*this._bulletOpacity+")";n.push(".prefixBulletNew>div { background-color: "+u+"; }");var l="rgba("+v.default.hexToRgbStr(this._prefixColor)+","+.01*this._projectOpacity+")";n.push(".prefixHeaderNew { color: "+l+"; }");var c="rgba("+v.default.hexToRgbStr(this._prefixColor)+","+.01*this._numListOpacity+")";n.push(".prefixNumListNew { color: "+c+"; }");var d="rgba("+v.default.hexToRgbStr(this._prefixColor)+","+.01*this._collapserOpacity+")";n.push(".collapserNew { color: "+d+"; }");var h="rgba("+v.default.hexToRgbStr(this._prefixColor)+","+.01*this._checkboxOpacity+")";n.push(".prefixTaskNew>div { border-color: "+h+"; }");var f="rgba("+v.default.hexToRgbStr(this._prefixColor)+","+.01*this._checkboxBackgroundOpacity+")";n.push(".prefixTaskNew:not(.searchButton)>div { background-color: "+f+"; }"),n.push(".c-tag { color: "+this._tagColor+";}"),n.push(".c-date { color: ".concat(this._dateColor,"; }")),n.push(".c-date.syncedToCalendar { border-color: ".concat(this._dateColor," !important;}")),n.push(".c-contact { color: "+this._contactColor+";}"),n.push(".c-link, .fancyContenteditable a    { color: "+this._linkColor+";}"),n.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+T.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }");var p=this._font.get();p&&(p="San Francisco"===p?"-apple-system, BlinkMacSystemFont":'"'.concat(p,'"'),n.push(".fontPane { font-family: ".concat(p," }")));var g=this._fontWeight.get();if(g){var m=("light"===g?300:"normal"===g&&400)||"medium"===g&&500||"semibold"===g&&600||"bold"===g&&700;n.push(".fontPane { font-weight: ".concat(m," }"))}Xh.settings.ui.underlineP.get()?v.default.addClass(document.body,"underlineTags"):v.default.removeClass(document.body,"underlineTags"),this._grayscale?v.default.addClass(document.body,"grayscale"):v.default.removeClass(document.body,"grayscale"),v.default.removeClass(document.body,"theme-light"),v.default.removeClass(document.body,"theme-dark"),v.default.addClass(document.body,"theme-"+this._colorTheme);for(var y=0;y<n.length;y++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sheet.insertRule(n[y],0)}}},{key:"tagColor",value:function(){return this._tagColor}},{key:"dateColor",value:function(){return this._dateColor}},{key:"contactColor",value:function(){return this._contactColor}},{key:"noteColor",value:function(){return""}},{key:"isDark",value:function(){return"dark"===this._colorTheme}},{key:"lineItemHeight",value:function(e,t){return(void 0===t||e.item.isNote())&&(t=1),this.paddingForItemTop(e)+this.paddingForItemBottom()+this.lineHeightForItem(e)*t}},{key:"getPaddingForLevel",value:function(e,t){var n=1e4*(t?1:0)+(e=Math.max(e+(t?1:0),0)),r=this._paddingsForLevel[n];return void 0===r&&(r=t?y.a.OverviewPaddingStart+e*y.a.OverviewPaddingIncrement:this.itemIndentStart()+e*this.itemIndentSize(),this._paddingsForLevel[n]=r),r}},{key:"getColorTheme",value:function(){var e;return("auto"===(e=Xh.settings.ui.themeDesktop.get())||k.a.isNativeApp()&&Xh.settings.appSystemDarkMode.get())&&(e=this.systemColorTheme.get()),e||"light"}},{key:"setSystemDarkMode",value:function(e){var t=e?"dark":"light";this.systemColorTheme.set(t),this._updateColorTheme(t)}}]),n}(S.a),b()(r.prototype,"_onFontChange",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"_onFontChange"),r.prototype),b()(r.prototype,"onSettingChanged",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"onSettingChanged"),r.prototype),b()(r.prototype,"_updateSettings",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"_updateSettings"),r.prototype),b()(r.prototype,"updateStyles",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"updateStyles"),r.prototype),r),C=n(99),A=n(72),L=n.n(A),O=n(14),M=n.n(O),R=n(4),F=n(50),N=n(16),j=n(41),U=n.n(j),B=n(63),V=n.n(B),H=n(42),W=n.n(H),q=n(39),z=n.n(q),G=n(21),K=n(23),Y=n(32),Q=n(44);function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var $=0;function J(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}var Z=function(e,t,n){var r=0;if(J(e,t))return!0;if("object"!==z()(e)||null===e||"object"!==z()(t)||null===t)return!1;var i,a=Object.keys(e),o=Object.keys(t);if(a.length!==o.length)return!1;for(var s=0;s<a.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i=void 0,!hasOwnProperty.call(t,a[s]))return!1;if(n&&!1===(i=n(a[s],e[a[s]],t[a[s]])))return!1;if(void 0===i&&!J(e[a[s]],t[a[s]]))return!1}return!0},ee={constructor:!0,render:!0,componentDidMount:!0,componentWillReceiveProps:!0,UNSAFE_componentWillReceiveProps:!0,shouldComponentUpdate:!0,componentWillUpdate:!0,componentDidUpdate:!0,componentWillUnmount:!0},te=function(e){d()(n,e);var t=X(n);function n(e){var r;a()(this,n),r=t.call(this,e);var i=Object.getPrototypeOf(W()(r)),o=Object.getOwnPropertyNames(i).concat(Object.getOwnPropertyNames(i.__proto__)),s=[W()(r)].concat(v.default.arrayDifference(o,ee));return G.a.binder.apply(G.a,s),r.state=r.getInitialState(),r}return s()(n,[{key:"shouldComponentUpdate",value:function(e,t){return!Z(this.props,e,this.arePropsEqual)||!Z(this.state,t,this.areStatesEqual)}},{key:"getInitialState",value:function(){this.init&&this.init();var e=this.getState?this.getState(this.props):{};this._observables&&(e=v.default.extend(e,this._observables));var t=null;return e&&(this.setupListeners(e),t=this.transformState(e)),t}},{key:"createObservables",value:function(e){try{v.default.PAssert(449,!this._listeners,"You have to run createObservables in init()")}catch(r){v.default.reportError(r)}for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];v.default.isArray(n)?e[t]=new Y.a(n):e[t]=new E.a(n);try{v.default.PAssert(450,!this.hasOwnProperty(t),"Must not multi-define observable properties")}catch(r){v.default.reportError(r)}this[t]=e[t]}try{v.default.PAssert(451,!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables")}catch(r){v.default.reportError(r)}this._observables=e}},{key:"_addListener",value:function(e){try{v.default.PAssert(452,e&&e.target,"Must add a valid listener")}catch(t){v.default.reportError(t)}this._ensureListeners();try{v.default.PAssert(453,!this._hasListener(e.target),"Must not double register the same observable/trigger")}catch(t){v.default.reportError(t)}this._listeners.push(e)}},{key:"refreshListeners",value:function(e){this.disposeListeners();var t=this.getState?this.getState(e||this.props):{};this._observables&&(t=v.default.extend(t,this._observables)),t&&this.setupListeners(t)}},{key:"_ensureListeners",value:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])}},{key:"setupListeners",value:function(e){for(var t in this._ensureListeners(),e||(e=this.getState?this.getState(this.props):{}),e)if(e.hasOwnProperty(t)){var n=e[t];n instanceof E.a&&this._addListener(n.listen(this.onListener))}}},{key:"disposeListeners",value:function(e){if(this._listeners){for(var t=0,n=0;n<this._listeners.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._listeners[n].dispose()}if(this._listeners=[],e)for(var r=0,i=0;i<this._permanentListeners.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._permanentListeners[i].dispose()}}e&&this.disposeDispatcherListeners()}},{key:"disposeDispatcherListeners",value:function(){if(this._dispatcherListeners){for(var e=0,t=0;t<this._dispatcherListeners.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._dispatcherListeners[t],r=n[0],i=n.slice(1);r.unlisten.apply(r,i)}this._dispatcherListeners=[]}}},{key:"listenTo",value:function(e,t){try{v.default.PAssert(454,e&&(e instanceof Q.a||e instanceof E.a),"Can only listen to an Observable or a Trigger object")}catch(r){v.default.reportError(r)}if(e instanceof Q.a||e instanceof E.a){var n=e.listen(this.onListener);!1!==t?this._addListener(n):this._permanentListeners.push(n)}}},{key:"listenToDispatcher",value:function(e,t){this._dispatcherListeners||(this._dispatcherListeners=[]);var n,r=Array.prototype.slice.call(arguments);v.default.isString(r[0])?n=K.a:(n=r[0],r.splice(0,1)),r.push(this.onListener),n.listen.apply(n,r);var i=[n].concat(r);this._dispatcherListeners.push(i)}},{key:"_hasListener",value:function(e){var t=0;try{v.default.PAssert(455,e,"Must have a valid target")}catch(i){v.default.reportError(i)}for(var n=!1,r=0;r<this._listeners.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._listeners[r].target===e){n=!0;break}}return n}},{key:"_getState",value:function(e){var t=this.getState?this.getState(e||this.props):{};return this._observables&&(t=v.default.extend(t,this._observables)),this.transformState(t)}},{key:"transformState",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];n&&n instanceof E.a&&(e[t]=n.get(),n instanceof Y.a&&(e[t+"_arrVer"]=n.version))}return e}},{key:"onListener",value:function(){this.updateState()}},{key:"updateState",value:function(e){var t=this.state,n=this._getState(e);if(this.onBeforeChanged){var r=this.onBeforeChanged(n,t);void 0!==r&&(n=r)}!1!==n&&(this.setState(n),this.onAfterChanged&&this.onAfterChanged(n,t))}},{key:"componentWillUnmount",value:function(){this.disposeListeners(!0),this.__hotkeys&&(Xh.hotkeys.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1}},{key:"getChildByKey",value:function(e){return v.default.getReactChildByKey(this.props.children,e)}},{key:"componentDidMount",value:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=Xh.hotkeys.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=Xh.hotkeys.pushStackEscape(this.onEscapeKey)),this.onMount&&this.onMount()}},{key:"getUniqueID",value:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+$++),this.__id)}},{key:"componentDidCatch",value:function(e,t){this.onComponentError&&this.onComponentError(e,t),v.default.reportError(e,t,void 0,"React Component Error: "),Xh.toasts.pushMessage(y.a.MessageID.ReactError)}}]),n}(O.Component);function ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var re=function(e){d()(n,e);var t=ne(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"getElement",value:function(){return this.refs.element}},{key:"onMouseDown",value:function(e){this.lastX=e.clientX,this.lastY=e.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=e.target,this.props.onMouseDown&&this.props.onMouseDown(e),this.props.globalEvents&&v.default.onMouseMoveUp(this.onMouseMove,this.onMouseUp)}},{key:"onMouseMove",value:function(e){if(this.isDown){this.moveX+=Math.abs(e.clientX-this.lastX),this.moveY+=Math.abs(e.clientY-this.lastY),this.lastX=e.clientX,this.lastY=e.clientY;var t={startSrc:this.startSrc,target:e.target,clientX:e.clientX,clientY:e.clientY,eventX:e.clientX,eventY:e.clientY,preventDefault:v.default.emptyFn,stopPropagation:v.default.emptyFn,stopImmediatePropagation:v.default.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(t)}}},{key:"onClick",value:function(e){this.moveX<v.default.ClickThreshold&&this.moveY<v.default.ClickThreshold&&this.props.onClick&&this.props.onClick(e)}},{key:"onMouseUp",value:function(e){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onTapStart",value:function(e){this.onMouseDown(e),e.stopPropagation()}},{key:"onTapClick",value:function(e){this.props.onClick&&(this.props.onClick(e),e.stopPropagation())}},{key:"onTapMove",value:function(e){this.props.onMouseMove&&this.props.onMouseMove(e),e.stopPropagation()}},{key:"onTapEnd",value:function(e){this.onMouseUp(e),e.stopPropagation()}},{key:"render",value:function(){var e=this.props,t=(e.onClick,e.globalEvents),n=V()(e,["onClick","globalEvents"]);return M.a.createElement("div",L()({},n,{onMouseDown:this.onMouseDown,onMouseMove:t?void 0:this.onMouseMove,onClick:this.onClick,onMouseUp:t?void 0:this.onMouseUp,ref:"element"}),this.props.children)}}]),n}(te),ie=n(84),ae=function(e,t){return(ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function oe(e,t){function n(){this.constructor=e}ae(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var se=function(){return(se=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function ue(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function le(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ce(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function de(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ce(arguments[t]));return e}var he=0,fe="undefined"!==typeof window&&void 0!==window.requestAnimationFrame?function(e){return window.requestAnimationFrame(e)}:function(e){var t=Date.now(),n=Math.max(0,16.7-(t-he));he=t+n,setTimeout((function(){return e(he)}),n)},pe=1/60*1e3,ge=!0,ve=!1,me=!1,ye={delta:0,timestamp:0},_e=["read","update","preRender","render","postRender"],be=function(e){return ve=e},we=_e.reduce((function(e,t){return e[t]=function(e){var t=[],n=[],r=0,i=!1,a=0,o=new WeakSet,s=new WeakSet,u={cancel:function(e){var t=n.indexOf(e);o.add(e),-1!==t&&n.splice(t,1)},process:function(l){var c,d;if(i=!0,t=(c=[n,t])[0],(n=c[1]).length=0,r=t.length)for(a=0;a<r;a++)(d=t[a])(l),!0!==s.has(d)||o.has(d)||(u.schedule(d),e(!0));i=!1},schedule:function(e,a,u){void 0===a&&(a=!1),void 0===u&&(u=!1);var l=u&&i,c=l?t:n;o.delete(e),a&&s.add(e),-1===c.indexOf(e)&&(c.push(e),l&&(r=t.length))}};return u}(be),e}),{}),ke=_e.reduce((function(e,t){var n=we[t];return e[t]=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),ve||Ie(),n.schedule(e,t,r),e},e}),{}),Se=_e.reduce((function(e,t){return e[t]=we[t].cancel,e}),{}),Ee=function(e){return we[e].process(ye)},Pe=function(e){ve=!1,ye.delta=ge?pe:Math.max(Math.min(e-ye.timestamp,40),1),ge||(pe=ye.delta),ye.timestamp=e,me=!0,_e.forEach(Ee),me=!1,ve&&(ge=!1,fe(Pe))},Ie=function(){ve=!0,ge=!0,me||fe(Pe)},De=function(){return ye},Te=ke;var xe=function(){return(xe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var Ce=function(){return(Ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var Ae=function(e,t){return function(n){return Math.max(Math.min(n,t),e)}},Le=function(e){return e%1?Number(e.toFixed(5)):e},Oe=/(-)?(\d[\d\.]*)/g,Me=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,Re=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,Fe={test:function(e){return"number"===typeof e},parse:parseFloat,transform:function(e){return e}},Ne=Ce(Ce({},Fe),{transform:Ae(0,1)}),je=Ce(Ce({},Fe),{default:1}),Ue=function(e){return{test:function(t){return"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+e}}},Be=Ue("deg"),Ve=Ue("%"),He=Ue("px"),We=Ue("vh"),qe=Ue("vw"),ze=Ce(Ce({},Ve),{parse:function(e){return Ve.parse(e)/100},transform:function(e){return Ve.transform(100*e)}}),Ge=Ae(0,255),Ke=function(e){return void 0!==e.red},Ye=function(e){return void 0!==e.hue};var Qe=function(e){return function(t){if("string"!==typeof t)return t;for(var n={},r=function(e){return e.substring(e.indexOf("(")+1,e.lastIndexOf(")"))}(t).replace(/(,|\/)/g," ").split(/ \s*/),i=0;i<4;i++)n[e[i]]=void 0!==r[i]?parseFloat(r[i]):1;return n}},Xe=Ce(Ce({},Fe),{transform:function(e){return Math.round(Ge(e))}});function $e(e,t){return e.startsWith(t)&&Re.test(e)}var Je={test:function(e){return"string"===typeof e?$e(e,"rgb"):Ke(e)},parse:Qe(["red","green","blue","alpha"]),transform:function(e){var t=e.red,n=e.green,r=e.blue,i=e.alpha,a=void 0===i?1:i;return function(e){var t=e.red,n=e.green,r=e.blue,i=e.alpha;return"rgba("+t+", "+n+", "+r+", "+(void 0===i?1:i)+")"}({red:Xe.transform(t),green:Xe.transform(n),blue:Xe.transform(r),alpha:Le(Ne.transform(a))})}},Ze={test:function(e){return"string"===typeof e?$e(e,"hsl"):Ye(e)},parse:Qe(["hue","saturation","lightness","alpha"]),transform:function(e){var t=e.hue,n=e.saturation,r=e.lightness,i=e.alpha,a=void 0===i?1:i;return function(e){var t=e.hue,n=e.saturation,r=e.lightness,i=e.alpha;return"hsla("+t+", "+n+", "+r+", "+(void 0===i?1:i)+")"}({hue:Math.round(t),saturation:Ve.transform(Le(n)),lightness:Ve.transform(Le(r)),alpha:Le(Ne.transform(a))})}},et=Ce(Ce({},Je),{test:function(e){return"string"===typeof e&&$e(e,"#")},parse:function(e){var t="",n="",r="";return e.length>4?(t=e.substr(1,2),n=e.substr(3,2),r=e.substr(5,2)):(t=e.substr(1,1),n=e.substr(2,1),r=e.substr(3,1),t+=t,n+=n,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:1}}}),tt={test:function(e){return"string"===typeof e&&Re.test(e)||Ke(e)||Ye(e)},parse:function(e){return Je.test(e)?Je.parse(e):Ze.test(e)?Ze.parse(e):et.test(e)?et.parse(e):e},transform:function(e){return Ke(e)?Je.transform(e):Ye(e)?Ze.transform(e):e}},nt="${c}",rt="${n}",it=function(e){return"number"===typeof e?0:e},at={test:function(e){if("string"!==typeof e||!isNaN(e))return!1;var t=0,n=e.match(Oe),r=e.match(Me);return n&&(t+=n.length),r&&(t+=r.length),t>0},parse:function(e){var t=e,n=[],r=t.match(Me);r&&(t=t.replace(Me,nt),n.push.apply(n,r.map(tt.parse)));var i=t.match(Oe);return i&&n.push.apply(n,i.map(Fe.parse)),n},createTransformer:function(e){var t=e,n=0,r=e.match(Me),i=r?r.length:0;if(r)for(var a=0;a<i;a++)t=t.replace(r[a],nt),n++;var o=t.match(Oe),s=o?o.length:0;if(o)for(a=0;a<s;a++)t=t.replace(o[a],rt),n++;return function(e){for(var r=t,a=0;a<n;a++)r=r.replace(a<i?nt:rt,a<i?tt.transform(e[a]):Le(e[a]));return r}},getAnimatableNone:function(e){var t=at.parse(e);return at.createTransformer(e)(t.map(it))}},ot=function(e,t,n){return Math.min(Math.max(n,e),t)},st=.001;function ut(e){var t,n,r=e.duration,i=void 0===r?800:r,a=e.bounce,o=void 0===a?.25:a,s=e.velocity,u=void 0===s?0:s,l=e.mass,c=void 0===l?1:l,d=1-o;d=ot(.05,1,d),i=ot(.01,10,i/1e3),d<1?(t=function(e){var t=e*d,n=t*i,r=t-u,a=lt(e,d),o=Math.exp(-n);return st-r/a*o},n=function(e){var n=e*d*i,r=n*u+u,a=Math.pow(d,2)*Math.pow(e,2)*i,o=Math.exp(-n),s=lt(Math.pow(e,2),d);return(-t(e)+st>0?-1:1)*((r-a)*o)/s}):(t=function(e){return Math.exp(-e*i)*((e-u)*i+1)-.001},n=function(e){return Math.exp(-e*i)*(i*i*(u-e))});var h=function(e,t,n){for(var r=n,i=1;i<12;i++)r-=e(r)/t(r);return r}(t,n,5/i);if(isNaN(h))return{stiffness:100,damping:10};var f=Math.pow(h,2)*c;return{stiffness:f,damping:2*d*Math.sqrt(c*f)}}function lt(e,t){return e*Math.sqrt(1-t*t)}function ct(e){var t=e.from,n=void 0===t?0:t,r=e.to,i=void 0===r?1:r,a=e.velocity,o=void 0===a?0:a,s=e.stiffness,u=void 0===s?100:s,l=e.damping,c=void 0===l?10:l,d=e.mass,h=void 0===d?1:d,f=e.restSpeed,p=void 0===f?2:f,g=e.restDelta,v=e.duration,m=e.bounce,y=!1,_={done:!1,value:n};if(void 0!==v||void 0!==m){y=!0;var b=ut({duration:v,bounce:m});u=b.stiffness,c=b.damping,o=0,h=1}var w=dt,k=dt;function S(){var e=o?-o/1e3:0,t=i-n,r=c/(2*Math.sqrt(u*h)),a=Math.sqrt(u/h)/1e3;if(null!==g&&void 0!==g||(g=Math.abs(i-n)<=1?.01:.4),r<1){var s=lt(a,r);w=function(n){var o=Math.exp(-r*a*n);return i-o*((e+r*a*t)/s*Math.sin(s*n)+t*Math.cos(s*n))},k=function(n){var i=Math.exp(-r*a*n);return r*a*i*(Math.sin(s*n)*(e+r*a*t)/s+t*Math.cos(s*n))-i*(Math.cos(s*n)*(e+r*a*t)-s*t*Math.sin(s*n))}}else if(1===r)w=function(n){return i-Math.exp(-a*n)*(t+(e+a*t)*n)};else{var l=a*Math.sqrt(r*r-1);w=function(n){var o=Math.exp(-r*a*n),s=Math.min(l*n,300);return i-o*((e+r*a*t)*Math.sinh(s)+l*t*Math.cosh(s))/l}}}return S(),{next:function(e){var t=w(e);if(y)_.done=e>=v;else{var n=1e3*k(e),r=Math.abs(n)<=p,a=Math.abs(i-t)<=g;_.done=r&&a}return _.value=_.done?i:t,_},flipTarget:function(){var e;o=-o,n=(e=[i,n])[0],i=e[1],S()}}}ct.needsInterpolation=function(e,t){return"string"===typeof e||"string"===typeof t};var dt=function(e){return 0},ht=function(e,t,n){var r=t-e;return 0===r?1:(n-e)/r},ft=function(e,t,n){return-n*e+n*t+e},pt=function(e,t,n){var r=e*e,i=t*t;return Math.sqrt(Math.max(0,n*(i-r)+r))},gt=[et,Je,Ze],vt=function(e){return gt.find((function(t){return t.test(e)}))},mt=function(e){return"'"+e+"' is not an animatable color. Use the equivalent color code instead."},yt=function(e,t){var n=vt(e),r=vt(t);mt(e),mt(t),n.transform,r.transform;var i=n.parse(e),a=r.parse(t),o=xe({},i),s=n===Ze?ft:pt;return function(e){for(var t in o)"alpha"!==t&&(o[t]=s(i[t],a[t],e));return o.alpha=ft(i.alpha,a.alpha,e),n.transform(o)}},_t=function(e){return"number"===typeof e},bt=function(e,t){return function(n){return t(e(n))}},wt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce(bt)};function kt(e,t){return _t(e)?function(n){return ft(e,t,n)}:tt.test(e)?yt(e,t):It(e,t)}var St=function(e,t){var n=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}(e),r=n.length,i=e.map((function(e,n){return kt(e,t[n])}));return function(e){for(var t=0;t<r;t++)n[t]=i[t](e);return n}},Et=function(e,t){var n=xe(xe({},e),t),r={};for(var i in n)void 0!==e[i]&&void 0!==t[i]&&(r[i]=kt(e[i],t[i]));return function(e){for(var t in r)n[t]=r[t](e);return n}};function Pt(e){for(var t=at.parse(e),n=t.length,r=0,i=0,a=0,o=0;o<n;o++)r||"number"===typeof t[o]?r++:void 0!==t[o].hue?a++:i++;return{parsed:t,numNumbers:r,numRGB:i,numHSL:a}}var It=function(e,t){var n=at.createTransformer(t),r=Pt(e),i=Pt(t);return r.numHSL===i.numHSL&&r.numRGB===i.numRGB&&(r.numNumbers,i.numNumbers),wt(St(r.parsed,i.parsed),n)},Dt=function(e,t){return function(n){return ft(e,t,n)}};function Tt(e,t,n){for(var r,i=[],a=n||("number"===typeof(r=e[0])?Dt:"string"===typeof r?tt.test(r)?yt:It:Array.isArray(r)?St:"object"===typeof r?Et:void 0),o=e.length-1,s=0;s<o;s++){var u=a(e[s],e[s+1]);if(t){var l=Array.isArray(t)?t[s]:t;u=wt(l,u)}i.push(u)}return i}function xt(e,t,n){var r=void 0===n?{}:n,i=r.clamp,a=void 0===i||i,o=r.ease,s=r.mixer,u=e.length;t.length,!o||!Array.isArray(o)||o.length,e[0]>e[u-1]&&(e=[].concat(e),t=[].concat(t),e.reverse(),t.reverse());var l=Tt(t,o,s),c=2===u?function(e,t){var n=e[0],r=e[1],i=t[0];return function(e){return i(ht(n,r,e))}}(e,l):function(e,t){var n=e.length,r=n-1;return function(i){var a=0,o=!1;if(i<=e[0]?o=!0:i>=e[r]&&(a=r-1,o=!0),!o){for(var s=1;s<n&&!(e[s]>i||s===r);s++);a=s-1}var u=ht(e[a],e[a+1],i);return t[a](u)}}(e,l);return a?function(t){return c(ot(e[0],e[u-1],t))}:c}var Ct=function(e){return function(t){return 1-e(1-t)}},At=function(e){return function(t){return t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2}},Lt=function(e){return function(t){return t*t*((e+1)*t-e)}},Ot=function(e){var t=Lt(e);return function(e){return(e*=2)<1?.5*t(e):.5*(2-Math.pow(2,-10*(e-1)))}},Mt=function(e){return e},Rt=function(e){return function(t){return Math.pow(t,e)}}(2),Ft=Ct(Rt),Nt=At(Rt),jt=function(e){return 1-Math.sin(Math.acos(e))},Ut=Ct(jt),Bt=At(Ut),Vt=Lt(1.525),Ht=Ct(Vt),Wt=At(Vt),qt=Ot(1.525),zt=function(e){if(1===e||0===e)return e;var t=e*e;return e<.36363636363636365?7.5625*t:e<.7272727272727273?9.075*t-9.9*e+3.4:e<.9?12.066481994459833*t-19.63545706371191*e+8.898060941828255:10.8*e*e-20.52*e+10.72},Gt=Ct(zt);function Kt(e,t){return e.map((function(){return t||Nt})).splice(0,e.length-1)}function Yt(e){var t=e.from,n=void 0===t?0:t,r=e.to,i=void 0===r?1:r,a=e.ease,o=e.offset,s=e.duration,u=void 0===s?300:s,l={done:!1,value:n},c=Array.isArray(i)?i:[n,i],d=function(e,t){return e.map((function(e){return e*t}))}(null!==o&&void 0!==o?o:function(e){var t=e.length;return e.map((function(e,n){return 0!==n?n/(t-1):0}))}(c),u);function h(){return xt(d,c,{ease:Array.isArray(a)?a:Kt(c,a)})}var f=h();return{next:function(e){return l.value=f(e),l.done=e>=u,l},flipTarget:function(){c.reverse(),f=h()}}}var Qt={keyframes:Yt,spring:ct,decay:function(e){var t=e.velocity,n=void 0===t?0:t,r=e.from,i=void 0===r?0:r,a=e.power,o=void 0===a?.8:a,s=e.timeConstant,u=void 0===s?350:s,l=e.restDelta,c=void 0===l?.5:l,d=e.modifyTarget,h={done:!1,value:i},f=o*n,p=i+f,g=void 0===d?p:d(p);return g!==p&&(f=g-i),{next:function(e){var t=-f*Math.exp(-e/u);return h.done=!(t>c||t<-c),h.value=h.done?g:g+t,h},flipTarget:function(){}}}};function Xt(e,t,n){return void 0===n&&(n=0),e-t-n}var $t=function(e){var t=function(t){var n=t.delta;return e(n)};return{start:function(){return Te.update(t,!0,!0)},stop:function(){return Se.update(t)}}};function Jt(e){var t,n,r,i,a,o=e.from,s=e.autoplay,u=void 0===s||s,l=e.driver,c=void 0===l?$t:l,d=e.elapsed,h=void 0===d?0:d,f=e.repeat,p=void 0===f?0:f,g=e.repeatType,v=void 0===g?"loop":g,m=e.repeatDelay,y=void 0===m?0:m,_=e.onPlay,b=e.onStop,w=e.onComplete,k=e.onRepeat,S=e.onUpdate,E=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),P=E.to,I=0,D=E.duration,T=!1,x=!0,C=function(e){if(Array.isArray(e.to))return Yt;if(Qt[e.type])return Qt[e.type];var t=new Set(Object.keys(e));return t.has("ease")||t.has("duration")&&!t.has("dampingRatio")?Yt:t.has("dampingRatio")||t.has("stiffness")||t.has("mass")||t.has("damping")||t.has("restSpeed")||t.has("restDelta")?ct:Yt}(E);(null===(n=(t=C).needsInterpolation)||void 0===n?void 0:n.call(t,o,P))&&(a=xt([0,100],[o,P],{clamp:!1}),o=0,P=100);var A=C(xe(xe({},E),{from:o,to:P}));function L(){I++,"reverse"===v?h=function(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=!0),r?Xt(t+-e,t,n):t-(e-t)+n}(h,D,y,x=I%2===0):(h=Xt(h,D,y),"mirror"===v&&A.flipTarget()),T=!1,k&&k()}function O(e){if(x||(e=-e),h+=e,!T){var t=A.next(Math.max(0,h));i=t.value,a&&(i=a(i)),T=x?t.done:h<=0}null===S||void 0===S||S(i),T&&(0===I&&(null!==D&&void 0!==D||(D=h)),I<p?function(e,t,n,r){return r?e>=t+n:e<=-n}(h,D,y,x)&&L():(r.stop(),w&&w()))}return u&&(null===_||void 0===_||_(),(r=c(O)).start()),{stop:function(){null===b||void 0===b||b(),r.stop()}}}function Zt(e,t){return t?e*(1e3/t):0}var en=function(e){return e},tn=function(e){return void 0===e&&(e=en),function(t,n,r){var i=n-r,a=-(0-t+1)*(0-e(Math.abs(i)));return i<=0?n+a:n-a}},nn=(Math.sqrt,function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")}),rn=function(e){return nn(e)&&e.hasOwnProperty("z")},an=function(e,t){return Math.abs(e-t)};function on(e,t){if(_t(e)&&_t(t))return an(e,t);if(nn(e)&&nn(t)){var n=an(e.x,t.x),r=an(e.y,t.y),i=rn(e)&&rn(t)?an(e.z,t.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(r,2)+Math.pow(i,2))}}var sn=function(e,t){return 1-3*t+3*e},un=function(e,t){return 3*t-6*e},ln=function(e){return 3*e},cn=function(e,t,n){return((sn(t,n)*e+un(t,n))*e+ln(t))*e},dn=function(e,t,n){return 3*sn(t,n)*e*e+2*un(t,n)*e+ln(t)};var hn=.1;function fn(e,t,n,r){if(e===t&&n===r)return Mt;for(var i=new Float32Array(11),a=0;a<11;++a)i[a]=cn(a*hn,e,n);function o(t){for(var r=0,a=1;10!==a&&i[a]<=t;++a)r+=hn;--a;var o=r+(t-i[a])/(i[a+1]-i[a])*hn,s=dn(o,e,n);return s>=.001?function(e,t,n,r){for(var i=0;i<8;++i){var a=dn(t,n,r);if(0===a)return t;t-=(cn(t,n,r)-e)/a}return t}(t,o,e,n):0===s?o:function(e,t,n,r,i){var a,o,s=0;do{(a=cn(o=t+(n-t)/2,r,i)-e)>0?n=o:t=o}while(Math.abs(a)>1e-7&&++s<10);return o}(t,r,r+hn,e,n)}return function(e){return 0===e||1===e?e:cn(o(e),t,r)}}var pn=function(e){return"object"===typeof e&&e.hasOwnProperty("current")},gn=function(){function e(){this.subscriptions=new Set}return e.prototype.add=function(e){var t=this;return this.subscriptions.add(e),function(){t.subscriptions.delete(e)}},e.prototype.notify=function(e,t,n){var r,i;if(this.subscriptions.size)try{for(var a=le(this.subscriptions),o=a.next();!o.done;o=a.next()){(0,o.value)(e,t,n)}}catch(s){r={error:s}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},e.prototype.clear=function(){this.subscriptions.clear()},e}(),vn=function(){function e(e){var t,n=this;this.timeDelta=0,this.lastUpdated=0,this.updateSubscribers=new gn,this.renderSubscribers=new gn,this.canTrackVelocity=!1,this.updateAndNotify=function(e,t){void 0===t&&(t=!0),n.prev=n.current,n.current=e,n.prev!==n.current&&n.updateSubscribers.notify(n.current),t&&n.renderSubscribers.notify(n.current);var r=De(),i=r.delta,a=r.timestamp;n.lastUpdated!==a&&(n.timeDelta=i,n.lastUpdated=a,Te.postRender(n.scheduleVelocityCheck))},this.scheduleVelocityCheck=function(){return Te.postRender(n.velocityCheck)},this.velocityCheck=function(e){e.timestamp!==n.lastUpdated&&(n.prev=n.current)},this.set(e,!1),this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t)))}return e.prototype.onChange=function(e){return this.updateSubscribers.add(e)},e.prototype.clearListeners=function(){this.updateSubscribers.clear()},e.prototype.onRenderRequest=function(e){return e(this.get()),this.renderSubscribers.add(e)},e.prototype.attach=function(e){this.passiveEffect=e},e.prototype.set=function(e,t){void 0===t&&(t=!0),t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)},e.prototype.get=function(){return this.current},e.prototype.getPrevious=function(){return this.prev},e.prototype.getVelocity=function(){return this.canTrackVelocity?Zt(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0},e.prototype.start=function(e){var t=this;return this.stop(),new Promise((function(n){t.stopAnimation=e(n)})).then((function(){return t.clearAnimation()}))},e.prototype.stop=function(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()},e.prototype.isAnimating=function(){return!!this.stopAnimation},e.prototype.clearAnimation=function(){this.stopAnimation=null},e.prototype.destroy=function(){this.updateSubscribers.clear(),this.renderSubscribers.clear(),this.stop()},e}();function mn(e){return new vn(e)}var yn=function(){function e(e,t){var n=this;this.children=new Set,this.latest={},this.values=new Map,this.valueSubscriptions=new Map,this.config={},this.update=function(){return n.config.onUpdate(n.latest)},this.triggerRender=function(){return n.render()},this.ref=function(e){e?n.mount(e):n.unmount(),n.externalRef&&("function"===typeof n.externalRef?n.externalRef(e):pn(n.externalRef)&&(n.externalRef.current=e))},this.parent=e,this.rootParent=e?e.rootParent:this,this.treePath=e?de(e.treePath,[e]):[],this.depth=e?e.depth+1:0,this.externalRef=t}return e.prototype.subscribe=function(e){var t=this;return this.children.add(e),function(){return t.children.delete(e)}},e.prototype.hasValue=function(e){return this.values.has(e)},e.prototype.addValue=function(e,t){this.hasValue(e)&&this.removeValue(e),this.values.set(e,t),this.setSingleStaticValue(e,t.get()),this.subscribeToValue(e,t)},e.prototype.removeValue=function(e){var t;null===(t=this.valueSubscriptions.get(e))||void 0===t||t(),this.valueSubscriptions.delete(e),this.values.delete(e),delete this.latest[e]},e.prototype.getValue=function(e,t){var n=this.values.get(e);return void 0===n&&void 0!==t&&(n=new vn(t),this.addValue(e,n)),n},e.prototype.forEachValue=function(e){this.values.forEach(e)},e.prototype.getInstance=function(){return this.element},e.prototype.updateConfig=function(e){void 0===e&&(e={}),this.config=se({},e)},e.prototype.setSingleStaticValue=function(e,t){this.latest[e]=t},e.prototype.setStaticValues=function(e,t){if("string"===typeof e)this.setSingleStaticValue(e,t);else for(var n in e)this.setSingleStaticValue(n,e[n])},e.prototype.scheduleRender=function(){Te.render(this.triggerRender,!1,!0)},e.prototype.scheduleUpdateLayoutDelta=function(){Te.preRender(this.rootParent.updateLayoutDelta,!1,!0)},e.prototype.subscribeToValue=function(e,t){var n=this,r=t.onChange((function(t){n.setSingleStaticValue(e,t),n.element&&n.config.onUpdate&&Te.update(n.update,!1,!0)})),i=t.onRenderRequest((function(){n.element&&n.scheduleRender()}));this.valueSubscriptions.set(e,(function(){r(),i()}))},e.prototype.mount=function(e){this.parent&&(this.removeFromParent=this.parent.subscribe(this)),this.element=this.current=e},e.prototype.unmount=function(){var e=this;this.forEachValue((function(t,n){return e.removeValue(n)})),Se.update(this.update),Se.render(this.render),this.removeFromParent&&this.removeFromParent()},e}();function _n(e){return e}function bn(e){var t=e.top;return{x:{min:e.left,max:e.right},y:{min:t,max:e.bottom}}}function wn(e){return{x:se({},e.x),y:se({},e.y)}}var kn={translate:0,scale:1,origin:0,originPoint:0};function Sn(){return{x:se({},kn),y:se({},kn)}}var En=se(se({},Fe),{transform:Math.round}),Pn={color:tt,backgroundColor:tt,outlineColor:tt,fill:tt,stroke:tt,borderColor:tt,borderTopColor:tt,borderRightColor:tt,borderBottomColor:tt,borderLeftColor:tt,borderWidth:He,borderTopWidth:He,borderRightWidth:He,borderBottomWidth:He,borderLeftWidth:He,borderRadius:He,radius:He,borderTopLeftRadius:He,borderTopRightRadius:He,borderBottomRightRadius:He,borderBottomLeftRadius:He,width:He,maxWidth:He,height:He,maxHeight:He,size:He,top:He,right:He,bottom:He,left:He,padding:He,paddingTop:He,paddingRight:He,paddingBottom:He,paddingLeft:He,margin:He,marginTop:He,marginRight:He,marginBottom:He,marginLeft:He,rotate:Be,rotateX:Be,rotateY:Be,rotateZ:Be,scale:je,scaleX:je,scaleY:je,scaleZ:je,skew:Be,skewX:Be,skewY:Be,distance:He,translateX:He,translateY:He,translateZ:He,x:He,y:He,z:He,perspective:He,transformPerspective:He,opacity:Ne,originX:ze,originY:ze,originZ:He,zIndex:En,fillOpacity:Ne,strokeOpacity:Ne,numOctaves:En},In=[Fe,He,Ve,Be,qe,We,{test:function(e){return"auto"===e},parse:function(e){return e}}],Dn=function(e){return function(t){return t.test(e)}},Tn=function(e){return In.find(Dn(e))},xn=de(In,[tt,at]),Cn=function(e){return xn.find(Dn(e))},An=function(e){return Pn[e]},Ln=function(e,t){return t&&"number"===typeof e?t.transform(e):e},On=["","X","Y","Z"],Mn=new Set,Rn=["transformPerspective","x","y","z"];function Fn(e,t){return Rn.indexOf(e)-Rn.indexOf(t)}["perspective","translate","scale","rotate","skew"].forEach((function(e){var t=new Set(["rotate","skew"]).has(e);On.forEach((function(n){var r=e+n;Rn.push(r),t&&Mn.add(r)}))}));var Nn=new Set(Rn);function jn(e){return Nn.has(e)}var Un=new Set(["originX","originY","originZ"]);function Bn(e){return Un.has(e)}var Vn={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"};function Hn(e,t){var n=e.x,r=e.y;return"translate3d("+n.translate/t.x+"px, "+r.translate/t.y+"px, 0) scale("+n.scale+", "+r.scale+")"}var Wn=Hn(Sn(),{x:1,y:1});function qn(e){return e.startsWith("--")}function zn(e){return"string"===typeof e&&e.startsWith("var(--")}var Gn=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Kn(e,t,n){void 0===n&&(n=1);var r=ce(function(e){var t=Gn.exec(e);if(!t)return[,];var n=ce(t,3);return[n[1],n[2]]}(e),2),i=r[0],a=r[1];if(i){var o=window.getComputedStyle(t).getPropertyValue(i);return o||(zn(a)?Kn(a,t,n+1):a)}}function Yn(e,t){return e/(t.max-t.min)*100}var Qn="_$css";var Xn={process:function(e,t){if("string"===typeof e){if(!He.test(e))return e;e=parseFloat(e)}return Yn(e,t.x)+"% "+Yn(e,t.y)+"%"}},$n={borderRadius:se(se({},Xn),{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:Xn,borderTopRightRadius:Xn,borderBottomLeftRadius:Xn,borderBottomRightRadius:Xn,boxShadow:{process:function(e,t,n,r){var i=e,a=e.includes("var("),o=[];a&&(e=e.replace(Gn,(function(e){return o.push(e),Qn})));var s=at.parse(e);if(s.length>5)return i;var u=at.createTransformer(e),l="number"!==typeof s[0]?1:0,c=n.x.scale*r.x,d=n.y.scale*r.y;s[0+l]/=c,s[1+l]/=d;var h=ft(c,d,.5);"number"===typeof s[2+l]&&(s[2+l]/=h),"number"===typeof s[3+l]&&(s[3+l]/=h);var f=u(s);if(a){var p=0;f=f.replace(Qn,(function(){var e=o[p];return p++,e}))}return f}}};function Jn(e,t,n,r,i,a,o,s,u,l,c,d){var h=o.enableHardwareAcceleration,f=o.transformTemplate,p=o.allowTransformNone;a.length=0;var g=!1,v=!1,m=!0;for(var y in e){var _=e[y],b=An(y),w=Ln(_,b);if(jn(y)){if(g=!0,r[y]=w,a.push(y),!m)continue;_!==(void 0!==b.default?b.default:0)&&(m=!1)}else if(Bn(y))i[y]=w,v=!0;else if("transform"!==y||"function"!==typeof _){var k=qn(y)?n:t;if(s&&$n[y]){var S=$n[y].process(_,d,u,c),E=$n[y].applyTo;if(E)for(var P=E.length,I=0;I<P;I++)k[E[I]]=S;else k[y]=S}else k[y]=w}}s?(t.transform=Hn(l,c),t.transform===Wn&&(t.transform=""),g&&(t.transform+=" "+function(e,t){var n="";t.sort(Fn);for(var r=t.length,i=0;i<r;i++){var a=t[i];Mn.has(a)&&(n+=a+"("+e[a]+") ")}return n}(r,a),t.transform=t.transform.trim()),f&&(t.transform=f(r,t.transform)),t.transformOrigin=function(e){var t=e.x,n=e.y;return 100*t.origin+"% "+100*n.origin+"% 0"}(l)):(g&&(t.transform=function(e,t,n,r,i,a){void 0===i&&(i=!0),void 0===a&&(a=!0);var o="";t.sort(Fn);for(var s=!1,u=t.length,l=0;l<u;l++){var c=t[l];o+=(Vn[c]||c)+"("+e[c]+") ","z"===c&&(s=!0)}return!s&&i?o+="translateZ(0)":o=o.trim(),n?o=n(e,r?"":o):a&&r&&(o="none"),o}(r,a,f,m,h,p)),v&&(t.transformOrigin=function(e){var t=e.originX,n=void 0===t?"50%":t,r=e.originY,i=void 0===r?"50%":r,a=e.originZ;return n+" "+i+" "+(void 0===a?0:a)}(i)))}function Zn(e,t){e.min=t.min,e.max=t.max}function er(e,t,n){return n+t*(e-n)}function tr(e,t,n,r,i){return void 0!==i&&(e=er(e,i,r)),er(e,n,r)+t}function nr(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),e.min=tr(e.min,t,n,r,i),e.max=tr(e.max,t,n,r,i)}function rr(e,t){var n=t.x,r=t.y;nr(e.x,n.translate,n.scale,n.originPoint),nr(e.y,r.translate,r.scale,r.originPoint)}function ir(e,t,n,r){var i=ce(r,3),a=i[0],o=i[1],s=i[2];e.min=t.min,e.max=t.max;var u=void 0!==n[s]?n[s]:.5,l=ft(t.min,t.max,u);nr(e,n[a],n[o],l,n.scale)}var ar=["x","scaleX","originX"],or=["y","scaleY","originY"];function sr(e,t,n,r,i){return e=er(e-=t,1/n,r),void 0!==i&&(e=er(e,1/i,r)),e}function ur(e,t,n){var r=ce(n,3),i=r[0],a=r[1],o=r[2];!function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r=.5);var a=ft(e.min,e.max,r)-t;e.min=sr(e.min,t,n,a,i),e.max=sr(e.max,t,n,a,i)}(e,t[i],t[a],t[o],t.scale)}function lr(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=.01),on(e,t)<n}function cr(e,t){var n=.5,r=e.max-e.min,i=t.max-t.min;return i>r?n=ht(t.min,t.max-r,e.min):r>i&&(n=ht(e.min,e.max-i,t.min)),ot(0,1,n)}function dr(e,t,n,r,i,a){var o=t.max-t.min,s=n.max-n.min;e.origin=void 0===r?cr(t,n):r,e.originPoint=ft(t.min,t.max,e.origin),a&&(e.scale=s/o,lr(e.scale,1,1e-4)&&(e.scale=1)),i&&(e.translate=function(e,t,n){var r=ft(e.min,e.max,n);return ft(t.min,t.max,n)-r}(t,n,e.origin),lr(e.translate)&&(e.translate=0))}function hr(e,t,n,r,i,a){dr(e.x,t.x,n.x,r,i,a),dr(e.y,t.y,n.y,r,!0,a)}function fr(e){return[e("x"),e("y")]}var pr=function(e){return 1e3*e},gr={linear:Mt,easeIn:Rt,easeInOut:Nt,easeOut:Ft,circIn:jt,circInOut:Bt,circOut:Ut,backIn:Vt,backInOut:Wt,backOut:Ht,anticipate:qt,bounceIn:Gt,bounceInOut:function(e){return e<.5?.5*(1-zt(1-2*e)):.5*zt(2*e-1)+.5},bounceOut:zt},vr=function(e){if(Array.isArray(e)){e.length;var t=ce(e,4);return fn(t[0],t[1],t[2],t[3])}return"string"===typeof e?gr[e]:e},mr=function(e,t){return"zIndex"!==e&&(!("number"!==typeof t&&!Array.isArray(t))||!("string"!==typeof t||!at.test(t)||t.startsWith("url(")))},yr=function(e){return Array.isArray(e)},_r=function(){return{type:"spring",stiffness:500,damping:25,restDelta:.5,restSpeed:10}},br=function(e){return{type:"spring",stiffness:550,damping:0===e?100:30,restDelta:.01,restSpeed:10}},wr=function(){return{type:"keyframes",ease:"linear",duration:.3}},kr=function(e){return{type:"keyframes",duration:.8,values:e}},Sr={x:_r,y:_r,z:_r,rotate:_r,rotateX:_r,rotateY:_r,rotateZ:_r,scaleX:br,scaleY:br,scale:br,opacity:wr,backgroundColor:wr,color:wr,default:br};function Er(e){var t=e.yoyo,n=e.loop,r=e.flip,i=e.ease,a=e.times,o=ue(e,["yoyo","loop","flip","ease","times"]),s=se({},o);return a&&(s.offset=a),o.duration&&(s.duration=pr(o.duration)),o.repeatDelay&&(s.repeatDelay=pr(o.repeatDelay)),i&&(s.ease=function(e){return Array.isArray(e)&&"number"!==typeof e[0]}(i)?i.map(vr):vr(i)),"tween"===o.type&&(s.type="keyframes"),t?s.repeatType="reverse":n?s.repeatType="loop":r&&(s.repeatType="mirror"),s.repeat=n||t||r||o.repeat,"spring"!==o.type&&(s.type="keyframes"),s}function Pr(e,t,n){var r;return Array.isArray(t.to)&&(null!==(r=e.duration)&&void 0!==r||(e.duration=.8)),function(e){Array.isArray(e.to)&&null===e.to[0]&&(e.to=de(e.to),e.to[0]=e.from)}(t),function(e){e.when,e.delay,e.delayChildren,e.staggerChildren,e.staggerDirection,e.repeat,e.repeatType,e.repeatDelay,e.from;var t=ue(e,["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from"]);return!!Object.keys(t).length}(e)||(e=se(se({},e),function(e,t){var n;return n=yr(t)?kr:Sr[e]||Sr.default,se({to:t},n(t))}(n,t.to))),se(se({},t),Er(e))}function Ir(e,t,n,r,i){var a,o=r[e]||r.default||r,s=null!==(a=o.from)&&void 0!==a?a:t.get(),u=mr(e,n);"none"===s&&u&&"string"===typeof n&&(s=at.getAnimatableNone(n));var l=mr(e,s);return l&&u&&!1!==o.type?function(){var r={from:s,to:n,velocity:t.getVelocity(),onComplete:i,onUpdate:function(e){return t.set(e)}};return"inertia"===o.type||"decay"===o.type?function(e){var t,n=e.from,r=void 0===n?0:n,i=e.velocity,a=void 0===i?0:i,o=e.min,s=e.max,u=e.power,l=void 0===u?.8:u,c=e.timeConstant,d=void 0===c?750:c,h=e.bounceStiffness,f=void 0===h?500:h,p=e.bounceDamping,g=void 0===p?10:p,v=e.restDelta,m=void 0===v?1:v,y=e.modifyTarget,_=e.driver,b=e.onUpdate,w=e.onComplete;function k(e){return void 0!==o&&e<o||void 0!==s&&e>s}function S(e){return void 0===o?s:void 0===s||Math.abs(o-e)<Math.abs(s-e)?o:s}function E(e){null===t||void 0===t||t.stop(),t=Jt(xe(xe({},e),{driver:_,onUpdate:function(t){var n;null===b||void 0===b||b(t),null===(n=e.onUpdate)||void 0===n||n.call(e,t)},onComplete:w}))}function P(e){E(xe({type:"spring",stiffness:f,damping:g,restDelta:m},e))}if(k(r))P({from:r,velocity:a,to:S(r)});else{var I=l*a+r;"undefined"!==typeof y&&(I=y(I));var D,T,x=S(I),C=x===o?-1:1;E({type:"decay",from:r,velocity:a,timeConstant:d,power:l,restDelta:m,modifyTarget:y,onUpdate:k(I)?function(e){D=T,T=e,a=Zt(e-D,De().delta),(1===C&&e>x||-1===C&&e<x)&&P({from:e,to:x,velocity:a})}:void 0})}return{stop:function(){return null===t||void 0===t?void 0:t.stop()}}}(se(se({},r),o)):Jt(Pr(o,r,e))}:function(){return t.set(n),i(),{stop:function(){}}}}function Dr(e,t,n,r){return void 0===r&&(r={}),t.start((function(i){var a,o,s=Ir(e,t,n,r,i),u=function(e,t){var n,r,i,a,o;return null!==(o=null!==(a=null!==(r=null===(n=e[t])||void 0===n?void 0:n.delay)&&void 0!==r?r:null===(i=e.default)||void 0===i?void 0:i.delay)&&void 0!==a?a:e.delay)&&void 0!==o?o:0}(r,e),l=function(){return o=s()};return u?a=setTimeout(l,pr(u)):l(),function(){clearTimeout(a),null===o||void 0===o||o.stop()}}))}function Tr(e,t){return bn(function(e,t){var n=e.top,r=e.left,i=e.bottom,a=e.right;void 0===t&&(t=_n);var o=t({x:r,y:n}),s=t({x:a,y:i});return{top:o.y,left:o.x,bottom:s.y,right:s.x}}(e.getBoundingClientRect(),t))}var xr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultConfig={enableHardwareAcceleration:!0,allowTransformNone:!0},t.style={},t.reactStyle={},t.vars={},t.transform={},t.transformOrigin={},t.transformKeys=[],t.config=t.defaultConfig,t.isLayoutProjectionEnabled=!1,t.layoutUpdateListeners=new gn,t.layoutMeasureListeners=new gn,t.viewportBoxUpdateListeners=new gn,t.hasViewportBoxUpdated=!1,t.targetBoxFinal={x:{min:0,max:1},y:{min:0,max:1}},t.treeScale={x:1,y:1},t.prevTreeScale={x:1,y:1},t.delta=Sn(),t.deltaFinal=Sn(),t.deltaTransform=Wn,t.stopLayoutAxisAnimation={x:function(){},y:function(){}},t.isTargetBoxLocked=!1,t.axisProgress={x:mn(0),y:mn(0)},t.updateLayoutDelta=function(){t.isLayoutProjectionEnabled&&t.box&&t.updateLayoutDeltas(),t.children.forEach(Cr)},t}return oe(t,e),t.prototype.removeValue=function(t){e.prototype.removeValue.call(this,t),delete this.vars[t],delete this.style[t]},t.prototype.clean=function(){this.style={},this.vars={},this.transform={}},t.prototype.updateConfig=function(e){void 0===e&&(e={}),this.config=se(se({},this.defaultConfig),e)},t.prototype.read=function(e){return this.getComputedStyle()[e]||0},t.prototype.addValue=function(t,n){e.prototype.addValue.call(this,t,n),t.startsWith("rotate")&&(this.layoutOrigin=.5)},t.prototype.readNativeValue=function(e){if(jn(e)){var t=An(e);return t&&t.default||0}return this.read(e)},t.prototype.enableLayoutProjection=function(){this.isLayoutProjectionEnabled=!0},t.prototype.hide=function(){!1!==this.isVisible&&(this.isVisible=!1,this.scheduleRender())},t.prototype.show=function(){!0!==this.isVisible&&(this.isVisible=!0,this.scheduleRender())},t.prototype.onLayoutUpdate=function(e){return this.layoutUpdateListeners.add(e)},t.prototype.onLayoutMeasure=function(e){return this.layoutMeasureListeners.add(e)},t.prototype.onViewportBoxUpdate=function(e){return this.viewportBoxUpdateListeners.add(e)},t.prototype.layoutReady=function(e){this.layoutUpdateListeners.notify(this.box,this.prevViewportBox||this.box,e)},t.prototype.getBoundingBox=function(){var e=this.config.transformPagePoint;return Tr(this.element,e)},t.prototype.getBoundingBoxWithoutTransforms=function(){var e,t,n=this.getBoundingBox();return e=n,t=this.latest,ur(e.x,t,ar),ur(e.y,t,or),n},t.prototype.getComputedStyle=function(){return window.getComputedStyle(this.element)},t.prototype.snapshotBoundingBox=function(){this.prevViewportBox=this.getBoundingBoxWithoutTransforms(),this.rebaseTargetBox(!1,this.prevViewportBox)},t.prototype.rebaseTargetBox=function(e,t){var n=this;void 0===e&&(e=!1),void 0===t&&(t=this.box);var r=this.axisProgress,i=r.x,a=r.y,o=this.box&&!this.isTargetBoxLocked&&!i.isAnimating()&&!a.isAnimating();(e||o)&&fr((function(e){var r=t[e],i=r.min,a=r.max;n.setAxisTarget(e,i,a)}))},t.prototype.measureLayout=function(){var e=this;this.box=this.getBoundingBox(),this.boxCorrected=wn(this.box),this.targetBox||(this.targetBox=wn(this.box)),this.layoutMeasureListeners.notify(this.box,this.prevViewportBox||this.box),Te.update((function(){return e.rebaseTargetBox()}))},t.prototype.lockTargetBox=function(){this.isTargetBoxLocked=!0},t.prototype.unlockTargetBox=function(){this.stopLayoutAnimation(),this.isTargetBoxLocked=!1},t.prototype.resetTransform=function(){var e=this.config.transformTemplate;this.element.style.transform=e?e({},""):"none",this.scheduleRender()},t.prototype.setAxisTarget=function(e,t,n){var r=this.targetBox[e];r.min=t,r.max=n,this.hasViewportBoxUpdated=!0,this.rootParent.scheduleUpdateLayoutDelta()},t.prototype.startLayoutAxisAnimation=function(e,t){var n=this,r=this.axisProgress[e],i=this.targetBox[e],a=i.min,o=i.max-a;return r.clearListeners(),r.set(a),r.set(a),r.onChange((function(t){return n.setAxisTarget(e,t,t+o)})),Dr(e,r,0,t)},t.prototype.stopLayoutAnimation=function(){var e=this;fr((function(t){return e.axisProgress[t].stop()}))},t.prototype.updateLayoutDeltas=function(){var e,t,n,r,i;e=this.boxCorrected,t=this.box,Zn(e.x,t.x),Zn(e.y,t.y),this.parent&&(this.prevTreeScale.x=this.treeScale.x,this.prevTreeScale.y=this.treeScale.y,n=this.treeScale,r=this.parent.treeScale,i=this.parent.delta,n.x=r.x*i.x.scale,n.y=r.y*i.y.scale),function(e,t){for(var n=t.length,r=0;r<n;r++)rr(e,t[r].delta)}(this.boxCorrected,this.treePath),hr(this.delta,this.boxCorrected,this.targetBox,this.layoutOrigin,void 0,!1!==this.config.animateTranslateX,this.config.animateScale),this.hasViewportBoxUpdated&&this.viewportBoxUpdateListeners.notify(this.targetBox,this.delta),this.hasViewportBoxUpdated=!1;var a=Hn(this.delta,this.treeScale);a===this.deltaTransform&&this.prevTreeScale.x===this.treeScale.x&&this.prevTreeScale.y===this.treeScale.y||this.scheduleRender(),this.deltaTransform=a},t.prototype.updateTransformDeltas=function(){var e,t,n;this.isLayoutProjectionEnabled&&this.box&&(e=this.targetBoxFinal,t=this.targetBox,n=this.latest,ir(e.x,t.x,n,ar),ir(e.y,t.y,n,or),hr(this.deltaFinal,this.boxCorrected,this.targetBoxFinal,this.layoutOrigin,void 0,!1!==this.config.animateTranslateX,this.config.animateScale))},t.prototype.build=function(){this.updateTransformDeltas(),void 0!==this.isVisible&&(this.style.visibility=this.isVisible?"visible":"hidden"),Jn(this.latest,this.style,this.vars,this.transform,this.transformOrigin,this.transformKeys,this.config,this.isLayoutProjectionEnabled&&!!this.box,this.delta,this.deltaFinal,this.treeScale,this.targetBoxFinal)},t.prototype.render=function(){for(var e in this.build(),Object.assign(this.element.style,this.style),this.vars)this.element.style.setProperty(e,this.vars[e])},t}(yn),Cr=function(e){return e.updateLayoutDelta()};function Ar(e){var t=Object(O.useRef)(null);return null===t.current&&(t.current=e()),t.current}function Lr(e,t,n){return"string"===typeof e?e:He.transform(t+n*e)}var Or=function(e,t){return He.transform(e*t)},Mr={offset:"stroke-dashoffset",array:"stroke-dasharray"},Rr={offset:"strokeDashoffset",array:"strokeDasharray"};var Fr={x:0,y:0,width:0,height:0};function Nr(e,t,n,r,i,a,o,s,u,l,c,d,h,f,p){var g=e.attrX,v=e.attrY,m=e.originX,y=e.originY,_=e.pathLength,b=e.pathSpacing,w=void 0===b?1:b,k=e.pathOffset,S=void 0===k?0:k;return Jn(ue(e,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]),r,n,i,a,o,s,c,d,h,f,p),r.transform&&(t.transform=r.transform,delete r.transform),(void 0!==m||void 0!==y||t.transform)&&(t.transformOrigin=function(e,t,n){return Lr(t,e.x,e.width)+" "+Lr(n,e.y,e.height)}(u||Fr,void 0!==m?m:.5,void 0!==y?y:.5)),void 0!==g&&(r.x=g),void 0!==v&&(r.y=v),void 0!==l&&void 0!==_&&function(e,t,n,r,i,a){void 0===r&&(r=1),void 0===i&&(i=0),void 0===a&&(a=!0);var o=a?Mr:Rr;e[o.offset]=Or(-i,t);var s=Or(n,t),u=Or(r,t);e[o.array]=s+" "+u}(r,l,_,w,S,!1),r}var jr=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox"]),Ur=/([a-z])([A-Z])/g,Br=function(e){return e.replace(Ur,"$1-$2").toLowerCase()},Vr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attrs={},t.defaultConfig={enableHardwareAcceleration:!1},t.config=t.defaultConfig,t}return oe(t,e),t.prototype.mount=function(t){e.prototype.mount.call(this,t),this.measure()},t.prototype.measure=function(){try{this.dimensions="function"===typeof this.element.getBBox?this.element.getBBox():this.element.getBoundingClientRect()}catch(e){this.dimensions={x:0,y:0,width:0,height:0}}"path"===this.element.tagName&&(this.totalPathLength=this.element.getTotalLength())},t.prototype.clean=function(){e.prototype.clean.call(this),this.attrs={}},t.prototype.read=function(e){return e=jr.has(e)?e:Br(e),this.element.getAttribute(e)},t.prototype.build=function(){this.updateTransformDeltas(),Nr(this.latest,this.style,this.vars,this.attrs,this.transform,this.transformOrigin,this.transformKeys,this.config,this.dimensions,this.totalPathLength,this.isLayoutProjectionEnabled&&!!this.box,this.delta,this.deltaFinal,this.treeScale,this.targetBoxFinal)},t.prototype.render=function(){for(var t in e.prototype.render.call(this),this.attrs)this.element.setAttribute(jr.has(t)?t:Br(t),this.attrs[t])},t}(xr);var Hr=new Set(["animate","circle","clipPath","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","foreignObject","g","image","line","linearGradient","marker","mask","metadata","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","switch","symbol","text","textPath","tspan","use","view"]);function Wr(e){return"string"===typeof e&&Hr.has(e)}var qr=Object(O.createContext)(null);function zr(){var e=Object(O.useContext)(qr);if(null===e)return[!0,null];var t=e.isPresent,n=e.onExitComplete,r=e.register,i=Yr();Object(O.useEffect)((function(){return r(i)}),[]);return!t&&n?[!1,function(){return null===n||void 0===n?void 0:n(i)}]:[!0]}var Gr=0,Kr=function(){return Gr++},Yr=function(){return Ar(Kr)},Qr=new Set(["initial","animate","exit","style","variants","transition","transformTemplate","transformValues","custom","inherit","static","layout","layoutId","onLayoutAnimationComplete","onViewportBoxUpdate","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","drag","dragControls","dragListener","dragConstraints","dragDirectionLock","_dragX","_dragY","dragElastic","dragMomentum","dragPropagation","dragTransition","onPan","onPanStart","onPanEnd","onPanSessionStart","onTap","onTapStart","onTapCancel","whileHover","whileTap","onHoverEnd","onHoverStart"]);function Xr(e){return Qr.has(e)}var $r=function(e){return!Xr(e)};try{var Jr=n(205).default;$r=function(e){return e.startsWith("on")?!Xr(e):Jr(e)}}catch($h){}var Zr,ei=new Set(["width","height","top","left","right","bottom","x","y"]),ti=function(e){return ei.has(e)},ni=function(e,t){e.set(t,!1),e.set(t)},ri=function(e){return e===Fe||e===He};!function(e){e.width="width",e.height="height",e.left="left",e.right="right",e.top="top",e.bottom="bottom"}(Zr||(Zr={}));var ii=function(e,t){return parseFloat(e.split(", ")[t])},ai=function(e,t){return function(n,r){var i=r.transform;if("none"===i||!i)return 0;var a=i.match(/^matrix3d\((.+)\)$/);if(a)return ii(a[1],t);var o=i.match(/^matrix\((.+)\)$/);return o?ii(o[1],e):0}},oi=new Set(["x","y","z"]),si=Rn.filter((function(e){return!oi.has(e)}));var ui={width:function(e){var t=e.x;return t.max-t.min},height:function(e){var t=e.y;return t.max-t.min},top:function(e,t){var n=t.top;return parseFloat(n)},left:function(e,t){var n=t.left;return parseFloat(n)},bottom:function(e,t){var n=e.y,r=t.top;return parseFloat(r)+(n.max-n.min)},right:function(e,t){var n=e.x,r=t.left;return parseFloat(r)+(n.max-n.min)},x:ai(4,13),y:ai(5,14)},li=function(e,t,n,r){void 0===n&&(n={}),void 0===r&&(r={}),t=se({},t),r=se({},r);var i=Object.keys(t).filter(ti),a=[],o=!1,s=[];if(i.forEach((function(i){var u=e.getValue(i);if(e.hasValue(i)){var l,c=n[i],d=t[i],h=Tn(c);if(yr(d))for(var f=d.length,p=null===d[0]?1:0;p<f;p++)l?Tn(d[p]):(l=Tn(d[p]))===h||ri(h)&&ri(l);else l=Tn(d);if(h!==l)if(ri(h)&&ri(l)){var g=u.get();"string"===typeof g&&u.set(parseFloat(g)),"string"===typeof d?t[i]=parseFloat(d):Array.isArray(d)&&l===He&&(t[i]=d.map(parseFloat))}else(null===h||void 0===h?void 0:h.transform)&&(null===l||void 0===l?void 0:l.transform)&&(0===c||0===d)?0===c?u.set(l.transform(c)):t[i]=h.transform(d):(o||(a=function(e){var t=[];return si.forEach((function(n){var r=e.getValue(n);void 0!==r&&(t.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))})),t.length&&e.render(),t}(e),o=!0),s.push(i),r[i]=void 0!==r[i]?r[i]:t[i],ni(u,d))}})),s.length){var u=function(e,t,n){var r=t.getBoundingBox(),i=t.getComputedStyle(),a=i.display,o={top:i.top,left:i.left,bottom:i.bottom,right:i.right,transform:i.transform};"none"===a&&t.setStaticValues("display",e.display||"block"),t.render();var s=t.getBoundingBox();return n.forEach((function(n){var a=t.getValue(n);ni(a,ui[n](r,o)),e[n]=ui[n](s,i)})),e}(t,e,s);return a.length&&a.forEach((function(t){var n=ce(t,2),r=n[0],i=n[1];e.getValue(r).set(i)})),e.render(),{target:u,transitionEnd:r}}return{target:t,transitionEnd:r}};function ci(e,t,n,r){return function(e){return Object.keys(e).some(ti)}(t)?li(e,t,n,r):{target:t,transitionEnd:r}}var di=function(){function e(){this.hasMounted=!1,this.pendingAnimations=[],this.componentControls=new Set}return e.prototype.setVariants=function(e){this.variants=e,this.componentControls.forEach((function(t){return t.setVariants(e)}))},e.prototype.setDefaultTransition=function(e){this.defaultTransition=e,this.componentControls.forEach((function(t){return t.setDefaultTransition(e)}))},e.prototype.subscribe=function(e){var t=this;return this.componentControls.add(e),this.variants&&e.setVariants(this.variants),this.defaultTransition&&e.setDefaultTransition(this.defaultTransition),function(){return t.componentControls.delete(e)}},e.prototype.start=function(e,t){var n=this;if(this.hasMounted){var r=[];return this.componentControls.forEach((function(n){var i=n.start(e,{transitionOverride:t});r.push(i)})),Promise.all(r)}return new Promise((function(r){n.pendingAnimations.push({animation:[e,t],resolve:r})}))},e.prototype.set=function(e){return this.hasMounted,this.componentControls.forEach((function(t){return t.apply(e)}))},e.prototype.stop=function(){this.componentControls.forEach((function(e){return e.stop()}))},e.prototype.mount=function(){var e=this;this.hasMounted=!0,this.pendingAnimations.forEach((function(t){var n=t.animation,r=t.resolve;return e.start.apply(e,de(n)).then(r)}))},e.prototype.unmount=function(){this.hasMounted=!1,this.stop()},e}(),hi=Object(O.createContext)({static:!1}),fi=function(e){return"string"===typeof e||Array.isArray(e)},pi=function(e){return e instanceof di},gi=function(e,t,n,r,i){void 0===r&&(r=!1);var a,o=i.initial,s=i.animate,u=i.variants,l=i.whileTap,c=i.whileHover,d=i.layoutId,h=Object(O.useContext)(qr),f=null===h||void 0===h?void 0:h.id;n.isPresenceRoot=e.presenceId!==f,void 0!==(null===h||void 0===h?void 0:h.initial)&&(o=h.initial),!1!==o||pi(s)?"boolean"!==typeof o&&(a=o):a=s;var p=Object(O.useRef)(!1),g=u||fi(s)||fi(l)||fi(c)||pi(s),v=fi(a)?a:e.initial,m=fi(s)?s:e.animate,y=r?v:null,_=g&&fi(m)?m:null,b=Object(O.useMemo)((function(){return{controls:g?t:e.controls,initial:v,animate:m,visualElement:n,hasMounted:p,isReducedMotion:e.isReducedMotion,presenceId:f}}),[y,_,e.isReducedMotion,s,d,f]);return b.static=r,function(e,t){void 0===t&&(t=!1);var n=Object(O.useRef)(!0);(!t||t&&n.current)&&e(),n.current=!1}((function(){var n=a||e.initial;n&&t.apply(n)}),!r),Object(O.useEffect)((function(){p.current=!0}),[]),b};function vi(e){var t=e.animate,n=e.variants,r=e.inherit;return void 0===r?!!n&&!t:r}var mi=function(e){return e instanceof vn};function yi(e,t){var n=t.layout,r=t.layoutId;return jn(e)||Bn(e)||(n||void 0!==r)&&!!$n[e]}function _i(e,t,n,r,i){for(var a in void 0===r&&(r=!1),r&&(e.reactStyle={}),n){var o=n[a],s=!1;if(mi(o))bi.has(a)||(e.addValue(a,o),s=!0);else if(yi(a,i)){if(e.hasValue(a)){if(o!==t[a]){e.getValue(a).set(o)}}else e.addValue(a,mn(o));s=!0}else r&&(e.reactStyle[a]=o);s&&(t[a]=o)}}var bi=new Set([]),wi=function(){return{}},ki=function(e){return yr(e)?e[e.length-1]||0:e},Si=function(){function e(e,t){var n=this,r=t.makeTargetAnimatable;this.props={},this.variants={},this.baseTarget={},this.overrides=[],this.resolvedOverrides=[],this.activeOverrides=new Set,this.isAnimating=new Set,this.hasValue=function(e){return!n.visualElement.hasValue(e)},this.visualElement=e,this.makeTargetAnimatable=r,this.visualElement.forEachValue((function(e,t){return n.baseTarget[t]=e.get()}))}return e.prototype.setProps=function(e){this.props=e},e.prototype.setVariants=function(e){e&&(this.variants=e)},e.prototype.setDefaultTransition=function(e){e&&(this.defaultTransition=e)},e.prototype.setValues=function(e,t){var n=void 0===t?{}:t,r=n.isActive,i=void 0===r?new Set:r,a=n.priority,o=this.resolveVariant(e),s=o.target,u=o.transitionEnd;for(var l in s=this.transformValues(se(se({},s),u))){if(i.has(l))return;if(i.add(l),s){var c=ki(s[l]);if(this.visualElement.hasValue(l)){var d=this.visualElement.getValue(l);d&&d.set(c)}else this.visualElement.addValue(l,mn(c));a||(this.baseTarget[l]=c)}}},e.prototype.transformValues=function(e){var t=this.props.transformValues;return t?t(e):e},e.prototype.checkForNewValues=function(e){var t=Object.keys(e).filter(this.hasValue),n=t.length;if(n)for(var r=0;r<n;r++){var i=t[r],a=e[i],o=null;if(Array.isArray(a)&&(o=a[0]),null===o){var s=this.visualElement.readNativeValue(i);o=void 0!==s?s:e[i]}"string"===typeof o&&/^\-?\d*\.?\d+$/.test(o)?o=parseFloat(o):!Cn(o)&&at.test(a)&&(o=at.getAnimatableNone(a)),this.visualElement.addValue(i,mn(o)),this.baseTarget[i]=o}},e.prototype.resolveVariant=function(e,t){var n=(void 0===t?{}:t).custom;if(!e)return{target:void 0,transition:void 0,transitionEnd:void 0};"function"===typeof e&&(e=e(null!==n&&void 0!==n?n:this.props.custom,function(e){var t={};return e.forEachValue((function(e,n){return t[n]=e.get()})),t}(this.visualElement),function(e){var t={};return e.forEachValue((function(e,n){return t[n]=e.getVelocity()})),t}(this.visualElement)));var r=e.transition;return{transition:void 0===r?this.defaultTransition:r,transitionEnd:e.transitionEnd,target:ue(e,["transition","transitionEnd"])}},e.prototype.getHighestPriority=function(){return this.activeOverrides.size?Math.max.apply(Math,de(Array.from(this.activeOverrides))):0},e.prototype.setOverride=function(e,t){this.overrides[t]=e,this.children&&this.children.forEach((function(n){return n.setOverride(e,t)}))},e.prototype.startOverride=function(e){var t=this.overrides[e];if(t)return this.start(t,{priority:e})},e.prototype.clearOverride=function(e){var t=this;if(this.children&&this.children.forEach((function(t){return t.clearOverride(e)})),this.overrides[e]){this.activeOverrides.delete(e);var n=this.getHighestPriority();if(this.resetIsAnimating(),n)this.overrides[n]&&this.startOverride(n);var r=this.resolvedOverrides[e];if(r){var i={};for(var a in this.baseTarget)void 0!==r[a]&&(i[a]=this.baseTarget[a]);this.onStart(),this.animate(i).then((function(){return t.onComplete()}))}}},e.prototype.apply=function(e){return Array.isArray(e)?this.applyVariantLabels(e):"string"===typeof e?this.applyVariantLabels([e]):void this.setValues(e)},e.prototype.applyVariantLabels=function(e){var t=this,n=new Set;de(e).reverse().forEach((function(r){var i=t.resolveVariant(t.variants[r]),a=i.target,o=i.transitionEnd;a&&t.setValues(a,{isActive:n}),o&&t.setValues(o,{isActive:n}),t.children&&t.children.size&&t.children.forEach((function(t){return t.applyVariantLabels(e)}))}))},e.prototype.start=function(e,t){var n,r,i=this;return void 0===t&&(t={}),t.priority&&this.activeOverrides.add(t.priority),this.resetIsAnimating(t.priority),r=e,n=Array.isArray(r)?this.animateVariantLabels(e,t):"string"===typeof e?this.animateVariant(e,t):this.animate(e,t),this.onStart(),n.then((function(){return i.onComplete()}))},e.prototype.animate=function(e,t){var n=this;void 0===t&&(t={});var r=t.delay,i=void 0===r?0:r,a=t.priority,o=void 0===a?0:a,s=t.transitionOverride,u=ue(t,["delay","priority","transitionOverride"]),l=this.resolveVariant(e,u),c=l.target,d=l.transition,h=l.transitionEnd;if(s&&(d=s),!c)return Promise.resolve();c=this.transformValues(c),h&&(h=this.transformValues(h)),this.checkForNewValues(c);var f=this.transformValues(function(e,t,n){var r,i,a={};for(var o in e)a[o]=null!==(r=Ei(o,t))&&void 0!==r?r:null===(i=n.getValue(o))||void 0===i?void 0:i.get();return a}(c,d,this.visualElement));if(this.makeTargetAnimatable){var p=this.makeTargetAnimatable(this.visualElement,c,f,h);c=p.target,h=p.transitionEnd}o&&(this.resolvedOverrides[o]=c),this.checkForNewValues(c);var g=[];for(var v in c){var m=this.visualElement.getValue(v);if(m&&c&&void 0!==c[v]){var y=c[v];o||(this.baseTarget[v]=ki(y)),this.isAnimating.has(v)||(this.isAnimating.add(v),g.push(Dr(v,m,y,se({delay:i},d))))}}var _=Promise.all(g);return h?_.then((function(){n.setValues(h,{priority:o})})):_},e.prototype.animateVariantLabels=function(e,t){var n=this,r=de(e).reverse().map((function(e){return n.animateVariant(e,t)}));return Promise.all(r)},e.prototype.animateVariant=function(e,t){var n=this,r=t&&t.priority||0,i=this.variants[e],a=i&&this.resolveVariant(i,t).transition||{},o=i?function(){return n.animate(i,t)}:function(){return Promise.resolve()},s=this.children?function(i){void 0===i&&(i=0);var o=a.delayChildren,s=void 0===o?0:o;return n.animateChildren(e,s+i,a.staggerChildren,a.staggerDirection,r,null===t||void 0===t?void 0:t.custom)}:function(){return Promise.resolve()},u=a.when;if(u){var l=ce("beforeChildren"===u?[o,s]:[s,o],2),c=l[0],d=l[1];return c().then(d)}return Promise.all([o(),s(null===t||void 0===t?void 0:t.delay)])},e.prototype.animateChildren=function(e,t,n,r,i,a){if(void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=0),!this.children)return Promise.resolve();var o=[],s=(this.children.size-1)*n,u=1===r?function(e){return e*n}:function(e){return s-e*n};return Array.from(this.children).forEach((function(n,r){var s=n.animateVariant(e,{priority:i,delay:t+u(r),custom:a});o.push(s)})),Promise.all(o)},e.prototype.onStart=function(){var e=this.props.onAnimationStart;e&&e()},e.prototype.onComplete=function(){var e=this.props.onAnimationComplete;e&&e()},e.prototype.checkOverrideIsAnimating=function(e){for(var t=this.overrides.length,n=e+1;n<t;n++){var r=this.resolvedOverrides[n];if(r)for(var i in r)this.isAnimating.add(i)}},e.prototype.resetIsAnimating=function(e){void 0===e&&(e=0),this.isAnimating.clear(),e<this.getHighestPriority()&&this.checkOverrideIsAnimating(e),this.children&&this.children.forEach((function(t){return t.resetIsAnimating(e)}))},e.prototype.stop=function(){this.visualElement.forEachValue((function(e){return e.stop()}))},e.prototype.addChild=function(e){this.children||(this.children=new Set),this.children.add(e),this.overrides.forEach((function(t,n){t&&e.setOverride(t,n)}))},e.prototype.removeChild=function(e){this.children&&this.children.delete(e)},e.prototype.resetChildren=function(){this.children&&this.children.clear()},e}();function Ei(e,t){if(t)return(t[e]||t.default||t).from}function Pi(e,t,n,r){var i=t.variants,a=t.transition,o=Object(O.useContext)(hi).controls,s=Object(O.useContext)(qr),u=Ar((function(){return new Si(e,n)}));return s&&!s.isPresent||(u.resetChildren(),u.setProps(t),u.setVariants(i),u.setDefaultTransition(a)),Object(O.useEffect)((function(){r&&o&&o.addChild(u)})),Object(O.useEffect)((function(){return function(){t.onAnimationComplete;var e=ue(t,["onAnimationComplete"]);u.setProps(e),o&&o.removeChild(u)}}),[]),u}var Ii,Di,Ti=Object(O.createContext)({transformPagePoint:function(e){return e},features:[]});!function(e){e[e.Entering=0]="Entering",e[e.Present=1]="Present",e[e.Exiting=2]="Exiting"}(Ii||(Ii={})),function(e){e[e.Hide=0]="Hide",e[e.Show=1]="Show"}(Di||(Di={}));var xi={measureLayout:function(e){return e.measureLayout()},layoutReady:function(e){return e.layoutReady()}},Ci=function(e,t){return e.depth-t.depth};function Ai(){var e=new Set;return{add:function(t){return e.add(t)},flush:function(t){var n=void 0===t?xi:t,r=n.measureLayout,i=n.layoutReady,a=Array.from(e).sort(Ci);a.forEach((function(e){return e.resetTransform()})),a.forEach(r),a.forEach(i),a.forEach((function(e){e.isPresent&&(e.presence=Ii.Present)})),e.clear()}}}function Li(e){return!!e.forceUpdate}var Oi=Object(O.createContext)(Ai()),Mi="undefined"!==typeof window?O.useLayoutEffect:O.useEffect;function Ri(e,t){var n=t.defaultFeatures,r=t.useVisualElement,i=t.render,a=t.animationControlsConfig;return Object(O.forwardRef)((function(t,o){var s=Object(O.useContext)(hi),u=vi(t),l=s.static||t.static||!1,c=r(e,t,s.visualElement,l,o);!function(e,t){var n=Ar(wi);for(var r in n){var i=yi(r,t),a=void 0!==t[r],o=t.style&&void 0!==t.style[r],s=a&&mi(t[r]),u=o&&mi(t.style[r]);(i&&!a&&!o||!i&&!s&&!u)&&(e.removeValue(r),delete n[r])}_i(e,n,t,!1,t),t.style&&_i(e,n,t.style,!0,t),t.transformValues&&(e.reactStyle=t.transformValues(e.reactStyle))}(c,t);var d=Pi(c,t,a,u),h=gi(s,d,c,l,t),f=function(e,t,n,r,i,a,o,s){var u=Object(O.useContext)(Ti);if(t||"undefined"===typeof window)return null;for(var l=de(e,u.features),c=l.length,d=[],h=0;h<c;h++){var f=l[h],p=f.shouldRender,g=f.key,v=f.getComponent;if(p(i,o)){var m=v(i);m&&d.push(Object(O.createElement)(m,se({key:g},i,{localContext:a,parentContext:o,visualElement:n,controls:r,inherit:s})))}}return d}(n,l,c,d,t,h,s,u),p=i(e,t,c);return function(e){var t=Object(O.useContext)(Oi);Mi((function(){return function(){Li(t)&&t.remove(e)}}),[])}(c),Object(O.createElement)(O.Fragment,null,Object(O.createElement)(hi.Provider,{value:h},p),f)}))}function Fi(e){var t=null;return function(){return null===t&&(t=e,function(){t=null})}}var Ni=Fi("dragHorizontal"),ji=Fi("dragVertical");function Ui(e){var t=!1;if("y"===e)t=ji();else if("x"===e)t=Ni();else{var n=Ni(),r=ji();n&&r?t=function(){n(),r()}:(n&&n(),r&&r())}return t}function Bi(e,t,n,r){return e.addEventListener(t,n,r),function(){return e.removeEventListener(t,n,r)}}function Vi(e){return"undefined"!==typeof PointerEvent&&e instanceof PointerEvent?!("mouse"!==e.pointerType):e instanceof MouseEvent}function Hi(e){return!!e.touches}var Wi={pageX:0,pageY:0};function qi(e,t){void 0===t&&(t="page");var n=e.touches[0]||e.changedTouches[0]||Wi;return{x:n[t+"X"],y:n[t+"Y"]}}function zi(e,t){return void 0===t&&(t="page"),{x:e[t+"X"],y:e[t+"Y"]}}function Gi(e,t){return void 0===t&&(t="page"),{point:Hi(e)?qi(e,t):zi(e,t)}}function Ki(e){return Gi(e,"client")}var Yi,Qi=function(e,t){void 0===t&&(t=!1);var n,r=function(t){return e(t,Gi(t))};return t?(n=r,function(e){var t=e instanceof MouseEvent;(!t||t&&0===e.button)&&n(e)}):r},Xi="undefined"!==typeof window,$i={pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mousecancel",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"},Ji={pointerdown:"touchstart",pointermove:"touchmove",pointerup:"touchend",pointercancel:"touchcancel"};function Zi(e){return Xi&&null===window.onpointerdown?e:Xi&&null===window.ontouchstart?Ji[e]:Xi&&null===window.onmousedown?$i[e]:e}function ea(e,t,n,r){return Bi(e,Zi(t),Qi(n,"pointerdown"===t),r)}function ta(e,t,n,r){return function(e,t,n,r){Object(O.useEffect)((function(){var i=e.current;if(n&&i)return Bi(i,t,n,r)}),[e,t,n,r])}(e,Zi(t),n&&Qi(n,"pointerdown"===t),r)}!function(e){e.subtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},e.relativeTo=function(e){var t;return function(n){var r=n.x,i=n.y,a=void 0!==t?t:t="string"===typeof e?document.getElementById(e):e;if(a){var o=a.getBoundingClientRect();return{x:r-o.left-window.scrollX,y:i-o.top-window.scrollY}}}}}(Yi||(Yi={}));var na=function(){function e(e,t,n){var r=this,i=(void 0===n?{}:n).transformPagePoint;if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=function(){if(r.lastMoveEvent&&r.lastMoveEventInfo){var e=ia(r.lastMoveEventInfo,r.history),t=null!==r.startEvent,n=on(e.offset,{x:0,y:0})>=3;if(t||n){var i=e.point,a=De().timestamp;r.history.push(se(se({},i),{timestamp:a}));var o=r.handlers,s=o.onStart,u=o.onMove;t||(s&&s(r.lastMoveEvent,e),r.startEvent=r.lastMoveEvent),u&&u(r.lastMoveEvent,e)}}},this.handlePointerMove=function(e,t){r.lastMoveEvent=e,r.lastMoveEventInfo=ra(t,r.transformPagePoint),Vi(e)&&0===e.buttons?r.handlePointerUp(e,t):Te.update(r.updatePoint,!0)},this.handlePointerUp=function(e,t){r.end();var n=r.handlers.onEnd;if(n){var i=ia(ra(t,r.transformPagePoint),r.history);n&&n(e,i)}},!(Hi(e)&&e.touches.length>1)){this.handlers=t,this.transformPagePoint=i;var a=ra(Gi(e),this.transformPagePoint),o=a.point,s=De().timestamp;this.history=[se(se({},o),{timestamp:s})];var u=t.onSessionStart;u&&u(e,ia(a,this.history)),this.removeListeners=wt(ea(window,"pointermove",this.handlePointerMove),ea(window,"pointerup",this.handlePointerUp),ea(window,"pointercancel",this.handlePointerUp))}}return e.prototype.updateHandlers=function(e){this.handlers=e},e.prototype.end=function(){this.removeListeners&&this.removeListeners(),Se.update(this.updatePoint)},e}();function ra(e,t){return t?{point:t(e.point)}:e}function ia(e,t){var n=e.point;return{point:n,delta:Yi.subtract(n,oa(t)),offset:Yi.subtract(n,aa(t)),velocity:sa(t,.1)}}function aa(e){return e[0]}function oa(e){return e[e.length-1]}function sa(e,t){if(e.length<2)return{x:0,y:0};for(var n=e.length-1,r=null,i=oa(e);n>=0&&(r=e[n],!(i.timestamp-r.timestamp>pr(t)));)n--;if(!r)return{x:0,y:0};var a=(i.timestamp-r.timestamp)/1e3;if(0===a)return{x:0,y:0};var o={x:(i.x-r.x)/a,y:(i.y-r.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function ua(e,t,n){var r=t.min,i=t.max;return void 0!==r&&e<r?e=n?ft(r,e,n):Math.max(e,r):void 0!==i&&e>i&&(e=n?ft(i,e,n):Math.min(e,i)),e}function la(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function ca(e,t){var n,r=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&(r=(n=ce([i,r],2))[0],i=n[1]),{min:e.min+r,max:e.min+i}}var da,ha=new WeakMap,fa=function(){function e(e){var t=e.visualElement;this.isDragging=!1,this.currentDirection=null,this.constraints=!1,this.props={},this.hasMutatedConstraints=!1,this.cursorProgress={x:.5,y:.5},this.originPoint={},this.openGlobalLock=null,this.panSession=null,this.visualElement=t,this.visualElement.enableLayoutProjection(),ha.set(t,this)}return e.prototype.start=function(e,t){var n=this,r=void 0===t?{}:t,i=r.snapToCursor,a=void 0!==i&&i,o=r.cursorProgress;a&&this.snapToCursor(e);var s=this.props.transformPagePoint;this.panSession=new na(e,{onSessionStart:function(){n.stopMotion()},onStart:function(e,t){var r,i,a=n.props,s=a.drag,u=a.dragPropagation;if(!s||u||(n.openGlobalLock&&n.openGlobalLock(),n.openGlobalLock=Ui(s),n.openGlobalLock)){n.prepareBoundingBox(),n.visualElement.lockTargetBox(),n.resolveDragConstraints();var l=Ki(e).point;fr((function(e){var t=n.visualElement.targetBox[e],r=t.min,i=t.max;n.cursorProgress[e]=o?o[e]:ht(r,i,l[e]);var a=n.getAxisMotionValue(e);a&&(n.originPoint[e]=a.get())})),n.isDragging=!0,n.currentDirection=null,null===(i=(r=n.props).onDragStart)||void 0===i||i.call(r,e,t)}},onMove:function(e,t){var r,i,a,o,s=n.props,u=s.dragPropagation,l=s.dragDirectionLock;if(u||n.openGlobalLock){var c=t.offset;if(l&&null===n.currentDirection)return n.currentDirection=function(e,t){void 0===t&&(t=10);var n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(c),void(null!==n.currentDirection&&(null===(i=(r=n.props).onDirectionLock)||void 0===i||i.call(r,n.currentDirection)));n.updateAxis("x",e,c),n.updateAxis("y",e,c),null===(o=(a=n.props).onDrag)||void 0===o||o.call(a,e,t),da=e}},onEnd:function(e,t){return n.stop(e,t)}},{transformPagePoint:s})},e.prototype.prepareBoundingBox=function(){var e=this.visualElement.getInstance(),t=e.style.transform;this.visualElement.resetTransform(),this.visualElement.measureLayout(),e.style.transform=t,this.visualElement.rebaseTargetBox(!0,this.visualElement.getBoundingBoxWithoutTransforms())},e.prototype.resolveDragConstraints=function(){var e=this,t=this.props.dragConstraints;this.constraints=!!t&&(pn(t)?this.resolveRefConstraints(this.visualElement.box,t):function(e,t){var n=t.top,r=t.left,i=t.bottom,a=t.right;return{x:la(e.x,r,a),y:la(e.y,n,i)}}(this.visualElement.box,t)),this.constraints&&!this.hasMutatedConstraints&&fr((function(t){e.getAxisMotionValue(t)&&(e.constraints[t]=function(e,t){var n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(e.visualElement.box[t],e.constraints[t]))}))},e.prototype.resolveRefConstraints=function(e,t){var n=this.props,r=n.onMeasureDragConstraints,i=n.transformPagePoint,a=t.current;this.constraintsBox=Tr(a,i);var o=function(e,t){return{x:ca(e.x,t.x),y:ca(e.y,t.y)}}(e,this.constraintsBox);if(r){var s=r(function(e){var t=e.x,n=e.y;return{top:n.min,bottom:n.max,left:t.min,right:t.max}}(o));this.hasMutatedConstraints=!!s,s&&(o=bn(s))}return o},e.prototype.cancelDrag=function(){this.isDragging=!1,this.panSession&&this.panSession.end(),this.panSession=null,!this.props.dragPropagation&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null)},e.prototype.stop=function(e,t){var n;this.visualElement.unlockTargetBox(),null===(n=this.panSession)||void 0===n||n.end(),this.panSession=null;var r=this.isDragging;if(this.cancelDrag(),r){var i=this.props,a=i.dragMomentum,o=i.dragElastic,s=i.onDragEnd;if(a||o){var u=t.velocity;this.animateDragEnd(u)}null===s||void 0===s||s(e,t)}},e.prototype.snapToCursor=function(e){var t=this;this.prepareBoundingBox(),fr((function(n){var r=t.getAxisMotionValue(n);if(r){var i=Ki(e).point,a=t.visualElement.box,o=a[n].max-a[n].min,s=a[n].min+o/2,u=i[n]-s;t.originPoint[n]=i[n],r.set(u)}else t.cursorProgress[n]=.5,t.updateVisualElementAxis(n,e)}))},e.prototype.updateAxis=function(e,t,n){if(pa(e,this.props.drag,this.currentDirection))return this.getAxisMotionValue(e)?this.updateAxisMotionValue(e,n):this.updateVisualElementAxis(e,t)},e.prototype.updateAxisMotionValue=function(e,t){var n=this.getAxisMotionValue(e);if(t&&n){var r=this.props.dragElastic,i=this.originPoint[e]+t[e],a=this.constraints?ua(i,this.constraints[e],r):i;n.set(a)}},e.prototype.updateVisualElementAxis=function(e,t){var n,r=this.props.dragElastic,i=this.visualElement.box[e],a=i.max-i.min,o=this.cursorProgress[e],s=function(e,t,n,r,i){var a=e-t*n;return r?ua(a,r,i):a}(Ki(t).point[e],a,o,null===(n=this.constraints)||void 0===n?void 0:n[e],r);this.visualElement.setAxisTarget(e,s,s+a)},e.prototype.updateProps=function(e){var t=e.drag,n=void 0!==t&&t,r=e.dragDirectionLock,i=void 0!==r&&r,a=e.dragPropagation,o=void 0!==a&&a,s=e.dragConstraints,u=void 0!==s&&s,l=e.dragElastic,c=void 0===l?.35:l,d=e.dragMomentum,h=void 0===d||d,f=ue(e,["drag","dragDirectionLock","dragPropagation","dragConstraints","dragElastic","dragMomentum"]);this.props=se({drag:n,dragDirectionLock:i,dragPropagation:o,dragConstraints:u,dragElastic:c,dragMomentum:h},f)},e.prototype.getAxisMotionValue=function(e){var t=this.props,n=t.layout,r=t.layoutId,i="_drag"+e.toUpperCase();return this.props[i]?this.props[i]:n||void 0!==r?void 0:this.visualElement.getValue(e,0)},e.prototype.animateDragEnd=function(e){var t=this,n=this.props,r=n.drag,i=n.dragMomentum,a=n.dragElastic,o=n.dragTransition,s=fr((function(n){if(pa(n,r,t.currentDirection)){var s=t.constraints?t.constraints[n]:{},u=a?200:1e6,l=a?40:1e7,c=se(se({type:"inertia",velocity:i?e[n]:0,bounceStiffness:u,bounceDamping:l,timeConstant:750,restDelta:1,restSpeed:10},o),s);return t.getAxisMotionValue(n)?t.startAxisValueAnimation(n,c):t.visualElement.startLayoutAxisAnimation(n,c)}}));return Promise.all(s).then((function(){var e,n;null===(n=(e=t.props).onDragTransitionEnd)||void 0===n||n.call(e)}))},e.prototype.stopMotion=function(){var e=this;fr((function(t){var n=e.getAxisMotionValue(t);n?n.stop():e.visualElement.stopLayoutAnimation()}))},e.prototype.startAxisValueAnimation=function(e,t){var n=this.getAxisMotionValue(e);if(n){var r=n.get();return n.set(r),n.set(r),Dr(e,n,0,t)}},e.prototype.scalePoint=function(){var e=this,t=this.props,n=t.drag,r=t.dragConstraints;if(pn(r)&&this.constraintsBox){this.stopMotion();var i={x:0,y:0};fr((function(t){i[t]=cr(e.visualElement.targetBox[t],e.constraintsBox[t])})),this.prepareBoundingBox(),this.resolveDragConstraints(),fr((function(t){if(pa(t,n,null)){var r=function(e,t,n){var r=e.max-e.min,i=ft(t.min,t.max-r,n);return{min:i,max:i+r}}(e.visualElement.targetBox[t],e.constraintsBox[t],i[t]),a=r.min,o=r.max;e.visualElement.setAxisTarget(t,a,o)}}))}},e.prototype.mount=function(e){var t=this,n=ea(e.getInstance(),"pointerdown",(function(e){var n=t.props,r=n.drag,i=n.dragListener;r&&(void 0===i||i)&&t.start(e)})),r=Bi(window,"resize",(function(){t.scalePoint()})),i=e.onLayoutUpdate((function(){t.isDragging&&t.resolveDragConstraints()})),a=e.prevSnapshot;return(null===a||void 0===a?void 0:a.isDragging)&&this.start(da,{cursorProgress:a.cursorProgress}),function(){null===n||void 0===n||n(),null===r||void 0===r||r(),null===i||void 0===i||i(),t.cancelDrag()}},e}();function pa(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}var ga=function(e){return function(t){return e(t),null}},va=ga((function(e){var t=e.visualElement;return function(e,t){var n=e.dragControls,r=Object(O.useContext)(Ti).transformPagePoint,i=Ar((function(){return new fa({visualElement:t})}));i.updateProps(se(se({},e),{transformPagePoint:r})),Object(O.useEffect)((function(){return n&&n.subscribe(i)}),[i]),Object(O.useEffect)((function(){return i.mount(t)}),[])}(ue(e,["visualElement"]),t)})),ma={key:"drag",shouldRender:function(e){return!!e.drag},getComponent:function(){return va}};function ya(e){return Object(O.useEffect)((function(){return function(){return e()}}),[])}var _a=function(e,t){return!!t&&(e===t||_a(e,t.parentElement))},ba=["whileHover","whileTap","whileDrag"],wa=function(e){return ba.indexOf(e)+1},ka=wa("whileTap");var Sa=wa("whileHover"),Ea=function(e){return function(t,n){Vi(t)&&e(t,n)}};function Pa(e,t){!function(e,t){var n=e.onPan,r=e.onPanStart,i=e.onPanEnd,a=e.onPanSessionStart,o=n||r||i||a,s=Object(O.useRef)(null),u=Object(O.useContext)(Ti).transformPagePoint,l={onSessionStart:a,onStart:r,onMove:n,onEnd:function(e,t){s.current=null,i&&i(e,t)}};Object(O.useEffect)((function(){null!==s.current&&s.current.updateHandlers(l)})),ta(t,"pointerdown",o&&function(e){s.current=new na(e,l,{transformPagePoint:u})}),ya((function(){return s.current&&s.current.end()}))}(e,t),function(e,t){var n=e.onTap,r=e.onTapStart,i=e.onTapCancel,a=e.whileTap,o=e.controls,s=n||r||i||a,u=Object(O.useRef)(!1),l=Object(O.useRef)(null);function c(){var e;null===(e=l.current)||void 0===e||e.call(l),l.current=null}a&&o&&o.setOverride(a,ka);var d=Object(O.useRef)(null);d.current=function(e,r){var s=t.current;if(c(),u.current&&s){u.current=!1,o&&a&&o.clearOverride(ka);var l=Ui(!0);l&&(l(),_a(s,e.target)?n&&n(e,r):i&&i(e,r))}},ta(t,"pointerdown",s?function(e,n){c(),l.current=wt(ea(window,"pointerup",(function(e,t){var n;return null===(n=d.current)||void 0===n?void 0:n.call(d,e,t)})),ea(window,"pointercancel",(function(e,t){var n;return null===(n=d.current)||void 0===n?void 0:n.call(d,e,t)}))),t.current&&!u.current&&(u.current=!0,r&&r(e,n),o&&a&&o.startOverride(ka))}:void 0),ya(c)}(e,t),function(e,t){var n=e.whileHover,r=e.onHoverStart,i=e.onHoverEnd,a=e.controls;n&&a&&a.setOverride(n,Sa),ta(t,"pointerenter",Ea((function(e,t){r&&r(e,t),n&&a&&a.startOverride(Sa)}))),ta(t,"pointerleave",Ea((function(e,t){i&&i(e,t),n&&a&&a.clearOverride(Sa)})))}(e,t)}var Ia,Da=["onPan","onPanStart","onPanEnd","onPanSessionStart","onTap","onTapStart","onTapCancel","whileTap","whileHover","onHoverStart","onHoverEnd"],Ta=ga((function(e){var t=e.visualElement;Pa(ue(e,["visualElement"]),t)})),xa={key:"gestures",shouldRender:function(e){return Da.some((function(t){return e.hasOwnProperty(t)}))},getComponent:function(){return Ta}},Ca=ga((function(e){var t=e.animate,n=e.controls,r=e.exit,i=ce(zr(),2),a=i[0],o=i[1],s=Object(O.useContext)(qr),u=Object(O.useRef)(!1),l=void 0!==(null===s||void 0===s?void 0:s.custom)?s.custom:e.custom;Object(O.useEffect)((function(){a?!u.current||!t||"boolean"===typeof t||t instanceof di||n.start(t):(!u.current&&r&&n.start(r,{custom:l}).then(o),u.current=!0),a&&(u.current=!1)}),[t,n,l,r,a,o,e])})),Aa={key:"exit",shouldRender:function(e){return!!e.exit&&!vi(e)},getComponent:function(){return Ca}};!function(e){e.Target="Target",e.VariantLabel="VariantLabel",e.AnimationSubscription="AnimationSubscription"}(Ia||(Ia={}));function La(e,t){void 0===t&&(t=!1);e.transition;var n=e.transitionEnd,r=ue(e,["transition","transitionEnd"]);return t?se(se({},r),n):r}var Oa,Ma,Ra=function(e){var t,n=e instanceof vn?e.get():e;return Array.from(new Set((t=n)?Array.isArray(t)?t:[t]:[]))};var Fa=((Oa={})[Ia.Target]=ga((function(e){return function(e,t,n,r){var i=Object(O.useRef)(!0),a=Object(O.useRef)(null);a.current||(a.current=La(e,!0)),Object(O.useEffect)((function(){var o,s,u={},l=La(e),c=La(e,!0);for(var d in l){var h=i.current&&(!n.hasValue(d)||n.getValue(d).get()!==c[d]),f=null!==c[d],p=(o=a.current[d],void 0!==(s=c[d])&&(Array.isArray(o)&&Array.isArray(s)?!function(e,t){if(null===t)return!1;var n=t.length;if(n!==e.length)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}(s,o):o!==s));f&&(p||h)&&(u[d]=l[d])}i.current=!1,a.current=se(se({},a.current),c),Object.keys(u).length&&t.start(se(se({},u),{transition:e.transition||r,transitionEnd:e.transitionEnd}))}),[e])}(e.animate,e.controls,e.visualElement,e.transition)})),Oa[Ia.VariantLabel]=ga((function(e){var t=e.animate,n=e.inherit,r=void 0===n||n,i=e.controls;return function(e,t,n,r){var i=Ra(t),a=Object(O.useContext)(hi),o=a.hasMounted&&a.hasMounted.current,s=Object(O.useRef)(!1);Object(O.useEffect)((function(){var t,u,l=!1;n?(l=!!o,i=Ra(a.animate)):l=s.current||(t=Ra(e),u=i,t.join(",")!==u.join(",")),l&&r.start(i),s.current=!0}),[i.join(",")])}(e.initial,t,r,i)})),Oa[Ia.AnimationSubscription]=ga((function(e){return function(e,t){var n=Object(O.useMemo)((function(){return e.subscribe(t)}),[e]);Object(O.useEffect)((function(){return function(){n&&n()}}),[n])}(e.animate,e.controls)})),Oa),Na=function(e){return e.animate instanceof di},ja=["initial","animate","whileTap","whileHover"],Ua=((Ma={})[Ia.Target]=function(e){return void 0!==e.animate&&(t=e.animate,!(Array.isArray(t)||"string"===typeof t))&&!Na(e);var t},Ma[Ia.VariantLabel]=function(e){return void 0!==e.variants||ja.some((function(t){return"string"===typeof e[t]}))},Ma[Ia.AnimationSubscription]=Na,Ma),Ba={key:"animation",shouldRender:function(){return!0},getComponent:function(e){var t=void 0;for(var n in Ia)Ua[n](e)&&(t=n);return t?Fa[t]:void 0}};var Va=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.frameTarget={x:{min:0,max:0},y:{min:0,max:0}},t.stopAxisAnimation={x:void 0,y:void 0},t.animate=function(e,n,r){void 0===r&&(r={});var i=r.originBox,a=r.targetBox,o=r.visibilityAction,s=r.shouldStackAnimate,u=ue(r,["originBox","targetBox","visibilityAction","shouldStackAnimate"]),l=t.props,c=l.visualElement,d=l.layout;if(!1===s)return t.safeToRemove();var h=Wa(n=i||n,e=a||e),f=fr((function(r){if("position"===d){var i=e[r].max-e[r].min;n[r].max=n[r].min+i}if(!c.isTargetBoxLocked)return void 0===o?h?t.animateAxis(r,e[r],n[r],u):c.setAxisTarget(r,e[r].min,e[r].max):void(o===Di.Hide?c.hide():c.show())}));return c.render(),Promise.all(f).then((function(){var e,n;null===(n=(e=t.props).onLayoutAnimationComplete)||void 0===n||n.call(e),c.isPresent?c.presence=Ii.Present:t.safeToRemove()}))},t}return oe(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props.visualElement;t.enableLayoutProjection(),this.unsubLayoutReady=t.onLayoutUpdate(this.animate),t.updateConfig(se(se({},t.config),{safeToRemove:function(){return e.safeToRemove()}}))},t.prototype.componentWillUnmount=function(){var e=this;this.unsubLayoutReady(),fr((function(t){var n,r;return null===(r=(n=e.stopAxisAnimation)[t])||void 0===r?void 0:r.call(n)}))},t.prototype.animateAxis=function(e,t,n,r){var i,a,o=void 0===r?{}:r,s=o.transition,u=o.crossfadeOpacity;null===(a=(i=this.stopAxisAnimation)[e])||void 0===a||a.call(i);var l,c=this.props.visualElement,d=this.frameTarget[e],h=c.axisProgress[e];h.clearListeners(),h.set(0),h.set(0),u&&(l=this.createCrossfadeAnimation(u),c.show());var f=function(){var r=h.get()/1e3;!function(e,t,n,r){e.min=ft(t.min,n.min,r),e.max=ft(t.max,n.max,r)}(d,n,t,r),c.setAxisTarget(e,d.min,d.max),null===l||void 0===l||l(r)};f(),c.updateLayoutDelta();var p=h.onChange(f),g=Dr("x"===e?"layoutX":"layoutY",h,1e3,s||this.props.transition||za).then(p);return this.stopAxisAnimation[e]=function(){h.stop(),p()},g},t.prototype.createCrossfadeAnimation=function(e){var t=this.props.visualElement.getValue("opacity",0);return function(n){t.set(Ka(ft(0,1,n))),e.set(Ya(ft(1,0,n)))}},t.prototype.safeToRemove=function(){var e,t;null===(t=(e=this.props).safeToRemove)||void 0===t||t.call(e)},t.prototype.render=function(){return null},t}(O.Component);function Ha(e){var t=ce(zr(),2)[1];return Object(O.createElement)(Va,se({},e,{safeToRemove:t}))}function Wa(e,t){return qa(e.x,t.x)||qa(e.y,t.y)}function qa(e,t){return e.min!==t.min||e.max!==t.max}var za={duration:.45,ease:[.4,0,.1,1]};function Ga(e,t,n){return function(r){return r<e?0:r>t?1:n(ht(e,t,r))}}var Ka=Ga(0,.5,Ut),Ya=Ga(.5,.95,Mt),Qa={key:"animate-layout",shouldRender:function(e){return!!e.layout||!!e.layoutId},getComponent:function(){return Ha}},Xa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return oe(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.syncLayout,n=e.visualElement;Li(t)&&t.register(n)},t.prototype.getSnapshotBeforeUpdate=function(){var e=this.props,t=e.syncLayout,n=e.visualElement;return Li(t)?t.syncUpdate():(n.snapshotBoundingBox(),t.add(n)),null},t.prototype.componentDidUpdate=function(){var e=this.props,t=e.syncLayout,n=e.visualElement;Li(t)||t.flush(),n.rebaseTargetBox()},t.prototype.render=function(){return null},t}(M.a.Component);function $a(e){var t=Object(O.useContext)(Oi);return M.a.createElement(Xa,se({},e,{syncLayout:t}))}var Ja={key:"measure-layout",shouldRender:function(e){return!!e.drag||!!e.layout||!!e.layoutId},getComponent:function(){return $a}},Za=[Ja,Ba,ma,xa,Aa,Qa],eo={useVisualElement:function(e,t,n,r,i){var a=Ar((function(){return new(Wr(e)?Vr:xr)(n,i)}));a.updateConfig(se(se(se({},a.config),{enableHardwareAcceleration:!r}),t)),a.layoutId=t.layoutId;var o=function(){var e=Object(O.useContext)(qr);return null===e||e.isPresent}();return a.isPresent=void 0!==t.isPresent?t.isPresent:o,Object(O.useEffect)((function(){if(t.onViewportBoxUpdate)return a.onViewportBoxUpdate(t.onViewportBoxUpdate)}),[t.onViewportBoxUpdate]),a},render:function(e,t,n){var r="string"===typeof e?function(e){var t={};for(var n in e)$r(n)&&(t[n]=e[n]);return t}(t):t;n.clean(),n.build();var i=Wr(e)?function(e){return se(se({},e.attrs),{style:se({},e.reactStyle)})}(n):function(e,t){var n=t.drag,r={style:se(se(se({},e.reactStyle),e.style),e.vars)};return n&&(r.draggable=!1,r.style.userSelect="none",r.style.touchAction=!0===n?"none":"pan-"+("x"===n?"y":"x")),r}(n,t);return Object(O.createElement)(e,se(se(se({},r),{ref:n.ref}),i))},animationControlsConfig:{makeTargetAnimatable:function(e,t,n,r){var i=function(e,t,n){var r,i=ue(t,[]),a=e.getInstance();if(!(a instanceof HTMLElement))return{target:i,transitionEnd:n};for(var o in n&&(n=se({},n)),e.forEachValue((function(e){var t=e.get();if(zn(t)){var n=Kn(t,a);n&&e.set(n)}})),i){var s=i[o];if(zn(s)){var u=Kn(s,a);u&&(i[o]=u,n&&(null!==(r=n[o])&&void 0!==r||(n[o]=s)))}}return{target:i,transitionEnd:n}}(e,t,r);return ci(e,t=i.target,n,r=i.transitionEnd)}}};function to(e){var t=se(se({},eo),{defaultFeatures:e});var n=new Map;return new Proxy({custom:function(e){return Ri(e,t)}},{get:function(e,r){return"custom"===r?e.custom:(n.has(r)||n.set(r,Ri(r,t)),n.get(r))}})}var no=to(Za);function ro(e,t){return t&&e!==t.lead?{visibilityAction:Di.Hide}:t&&e.presence!==Ii.Entering&&e===t.lead&&t.lead!==t.prevLead?{visibilityAction:Di.Show}:(e.presence===Ii.Entering?n=null===t||void 0===t?void 0:t.getFollowOrigin():e.presence===Ii.Exiting&&(r=null===t||void 0===t?void 0:t.getFollowTarget()),{originBox:n,targetBox:r});var n,r}function io(e,t){var n,r,i,a={},o=t&&t.lead,s=null===o||void 0===o?void 0:o.presence;return t&&e===o?e.presence===Ii.Entering?a.originBox=t.getFollowOrigin():e.presence===Ii.Exiting&&(a.targetBox=t.getFollowTarget()):t&&e===t.follow&&(a.transition=t.getLeadTransition(),s===Ii.Entering?a.targetBox=t.getLeadTarget():s===Ii.Exiting&&(a.originBox=t.getLeadOrigin())),(null===(n=null===t||void 0===t?void 0:t.follow)||void 0===n?void 0:n.isPresenceRoot)||(null===o||void 0===o?void 0:o.isPresenceRoot)?(t&&e!==o?t&&e===t.follow?o&&s!==Ii.Entering&&s===Ii.Exiting&&(a.crossfadeOpacity=null===(i=null===t||void 0===t?void 0:t.lead)||void 0===i?void 0:i.getValue("opacity",1)):a.visibilityAction=Di.Hide:e.presence===Ii.Entering&&(a.crossfadeOpacity=null===(r=null===t||void 0===t?void 0:t.follow)||void 0===r?void 0:r.getValue("opacity",0)),a):a}var ao=function(){function e(){this.order=[],this.hasChildren=!1}return e.prototype.add=function(e){var t;if(this.order.push(e),this.snapshot){e.prevSnapshot=this.snapshot,e.prevViewportBox=this.snapshot.boundingBox;var n=this.snapshot.latestMotionValues;for(var r in n)e.hasValue(r)?null===(t=e.getValue(r))||void 0===t||t.set(n[r]):e.addValue(r,mn(n[r]))}this.hasChildren=!0},e.prototype.remove=function(e){var t=this.order.findIndex((function(t){return e===t}));-1!==t&&this.order.splice(t,1)},e.prototype.updateLeadAndFollow=function(){this.prevLead=this.lead,this.prevFollow=this.follow;var e=ce(function(e,t){for(var n=ce(t,2),r=n[0],i=n[1],a=void 0,o=0,s=void 0,u=e.length,l=!1,c=u-1;c>=0;c--){var d=e[c];if(c===u-1&&(l=d.isPresent),l)a=d;else{var h=e[c-1];h&&h.isPresent&&(a=d)}if(a){o=c;break}}if(a||(a=e[0]),s=e[o-1],a)for(c=o-1;c>=0;c--)if((d=e[c]).isPresent){s=d;break}return a!==r&&!l&&s===i&&e.find((function(e){return e===r}))&&(a=r),[a,s]}(this.order,[this.lead,this.follow]),2),t=e[0],n=e[1];this.lead=t,this.follow=n},e.prototype.updateSnapshot=function(){if(this.lead){var e={boundingBox:this.lead.prevViewportBox,latestMotionValues:{}};this.lead.forEachValue((function(t,n){var r=t.get();jn(r)||(e.latestMotionValues[n]=r)}));var t=ha.get(this.lead);t&&t.isDragging&&(e.isDragging=!0,e.cursorProgress=t.cursorProgress),this.snapshot=e}},e.prototype.isLeadPresent=function(){var e;return this.lead&&(null===(e=this.lead)||void 0===e?void 0:e.presence)!==Ii.Exiting},e.prototype.getFollowOrigin=function(){var e;return this.follow?this.follow.prevViewportBox:null===(e=this.snapshot)||void 0===e?void 0:e.boundingBox},e.prototype.getFollowTarget=function(){var e;return null===(e=this.follow)||void 0===e?void 0:e.box},e.prototype.getLeadOrigin=function(){var e;return null===(e=this.lead)||void 0===e?void 0:e.prevViewportBox},e.prototype.getLeadTarget=function(){var e;return null===(e=this.lead)||void 0===e?void 0:e.box},e.prototype.getLeadTransition=function(){var e;return null===(e=this.lead)||void 0===e?void 0:e.config.transition},e}();!function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.children=new Set,t.stacks=new Map,t.hasMounted=!1,t.updateScheduled=!1,t.renderScheduled=!1,t.syncContext=se(se({},Ai()),{syncUpdate:function(e){return t.scheduleUpdate(e)},forceUpdate:function(){t.syncContext=se({},t.syncContext),t.scheduleUpdate(!0)},register:function(e){return t.addChild(e)},remove:function(e){return t.removeChild(e)}}),t}oe(t,e),t.prototype.componentDidMount=function(){this.hasMounted=!0,this.updateStacks()},t.prototype.componentDidUpdate=function(){this.startLayoutAnimation()},t.prototype.shouldComponentUpdate=function(){return this.renderScheduled=!0,!0},t.prototype.startLayoutAnimation=function(){var e=this;this.renderScheduled=this.updateScheduled=!1;var t=this.props.type;this.children.forEach((function(e){e.isPresent?e.presence!==Ii.Entering&&(e.presence=e.presence===Ii.Exiting?Ii.Entering:Ii.Present):e.presence=Ii.Exiting})),this.updateStacks();var n="crossfade"===t?io:ro,r={measureLayout:function(e){return e.measureLayout()},layoutReady:function(t){var r=t.layoutId;t.layoutReady(n(t,e.getStack(r)))}};this.children.forEach((function(t){return e.syncContext.add(t)})),this.syncContext.flush(r),this.stacks.forEach((function(e){return e.snapshot=void 0}))},t.prototype.updateStacks=function(){this.stacks.forEach((function(e){return e.updateLeadAndFollow()}))},t.prototype.scheduleUpdate=function(e){void 0===e&&(e=!1),!e&&this.updateScheduled||(this.updateScheduled=!0,this.children.forEach((function(e){return e.snapshotBoundingBox()})),this.stacks.forEach((function(e){return e.updateSnapshot()})),!e&&this.renderScheduled||(this.renderScheduled=!0,this.forceUpdate()))},t.prototype.addChild=function(e){this.children.add(e),this.addToStack(e),e.presence=this.hasMounted?Ii.Entering:Ii.Present},t.prototype.removeChild=function(e){this.scheduleUpdate(),this.children.delete(e),this.removeFromStack(e)},t.prototype.addToStack=function(e){var t=this.getStack(e.layoutId);null===t||void 0===t||t.add(e)},t.prototype.removeFromStack=function(e){var t=this.getStack(e.layoutId);null===t||void 0===t||t.remove(e)},t.prototype.getStack=function(e){if(void 0!==e)return!this.stacks.has(e)&&this.stacks.set(e,new ao),this.stacks.get(e)},t.prototype.render=function(){return Object(O.createElement)(Oi.Provider,{value:this.syncContext},this.props.children)}}(O.Component);function oo(){return{scrollX:mn(0),scrollY:mn(0),scrollXProgress:mn(0),scrollYProgress:mn(0)}}oo();var so=mn(null);if("undefined"!==typeof window)if(window.matchMedia){var uo=window.matchMedia("(prefers-reduced-motion)"),lo=function(){return so.set(uo.matches)};uo.addListener(lo),lo()}else so.set(!1);!function(){function e(){this.componentControls=new Set}e.prototype.subscribe=function(e){var t=this;return this.componentControls.add(e),function(){return t.componentControls.delete(e)}},e.prototype.start=function(e,t){this.componentControls.forEach((function(n){n.start(e.nativeEvent||e,t)}))}}();!function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.initialState={},t}oe(t,e),t.prototype.updateLayoutDelta=function(){},t.prototype.build=function(){},t.prototype.clean=function(){},t.prototype.getBoundingBox=function(){return{x:{min:0,max:0},y:{min:0,max:0}}},t.prototype.readNativeValue=function(e){return this.initialState[e]||0},t.prototype.render=function(){this.build()}}(yn);var co,ho,fo,po={start:{transition:{staggerChildren:.2}},end:{transition:{staggerChildren:.2}}},go={start:{y:"50%"},end:{y:"150%"}},vo={duration:.5,yoyo:1/0,ease:"easeInOut"},mo=Object(ie.a)((function(e){var t=e.color,n=e.size,r={width:4*(n=n||8),height:3*n,display:"flex",justifyContent:"space-around"},i={display:"block",width:n,height:n,backgroundColor:t||"#777",borderRadius:"50%"};return M.a.createElement(no.div,{style:r,variants:po,initial:"start",animate:"end"},M.a.createElement(no.span,{style:i,variants:go,transition:vo}),M.a.createElement(no.span,{style:i,variants:go,transition:vo}),M.a.createElement(no.span,{style:i,variants:go,transition:vo}))})),yo=Object(ie.a)((function(e){var t=e.className,n=e.style,r=e.size,i=e.left,a=e.top,o=e.center,s=e.inline,u=e.color,l=e.children;n=Object.assign({},n),(a||i)&&(n.position="absolute",n.left=i||"50%",n.top=a||"50%");var c=v.default.classNames("fancyLoader c-foreground-light flex flex-col items-center justify-center",t,{"absolute inset-0":o},{"relative inline":s}),d=v.default.classNames("fancyLoaderText",{"pt-4":!s}),h={color:u};return M.a.createElement("div",{className:c,style:n},M.a.createElement(mo,{color:u,size:r}),l&&M.a.createElement("div",{className:d,style:h},l))})),_o=n(109),bo=Object(ie.a)((function(e){var t,n,r,i,a,o=e.paneObject,s=e.el,u=o.item,l=s.props,c=s.getText(),d=!!l.plugin;if(l.plugin){var h=Xh.pluginManager.getPluginDrive(),f=h.getAttachment(l.plugin.id);t=h.getAttachWidth(f),n=h.getAttachUrl(f),r=h.getAttachDataUrl(f),a=(i=f.isLocalOnlyAttachment())&&{background:"rgba(0,0,0,0.5)"}}else t=l.link.imageSize,n=l.link.href;var p=Object(O.useState)(t),g=U()(p,2),m=g[0],_=g[1],b=Object(O.useState)(!1),w=U()(b,2),k=w[0],S=w[1],E=Object(_o.a)(),P=U()(E,2),I=P[0],D=P[1],T=Object(O.useRef)(),x=Object(O.useRef)(),C=v.default.classNames("max-w-full align-top",{mdImage:!d},{driveImage:d}),A={maxWidth:m},L=c.match(y.a.Regexp.DataImage)?void 0:c;return M.a.createElement("div",{className:"relative",style:A,ref:I},M.a.createElement("img",{className:C,src:r||n,"data-original-text":L,onLoad:function(e){var t=e.target.naturalWidth;x.current=t,m||_(t)}}),i&&M.a.createElement(yo,{style:a,color:"#eee",center:!0},"Uploading..."),(D||k)&&M.a.createElement(re,{className:"mdImageResizer flexbox flexvert",onMouseDown:function(e){S(!0),v.default.preventAndStop(e),v.default.isDraggingImage=!0},onMouseMove:function(e){var t=Math.round(e.clientX-I.current.getBoundingClientRect().left);t<=x.current&&_(t),v.default.preventAndStop(e)},onMouseUp:function(){if(S(!1),v.default.isDraggingImage=!1,d){var e=Xh.pluginManager.getPluginDrive(),t=e.getAttachment(l.plugin.id);e.setAttachWidth(u,t,m)}else{var n=u.elsNew.findElement(o,(function(e){return e.props.link&&e.props.link.showImage}));n&&(n.el.props.link.imageSize=m,u.setTextFromEls(y.a.ChangeType.Local))}},globalEvents:!0,ref:T}))})),wo=(co=function(){function e(){a()(this,e)}return s()(e,[{key:"onClickHandler",value:function(e,t,n){if(!R.a.hasFullSelection()||!k.a.isPriModKey(n)){var r=t.item,i=t.pane,a=e.props,o=R.a.wasSelectedBeforeThisMouseEvent(t),s=k.a.mac&&n.metaKey||!k.a.mac&&n.ctrlKey;if(a.itemLink){var u=N.a.getItem(a.itemLink);s?n.shiftKey?Xh.PaneManager.clonePane(i,{item:u}):Xh.menus.openModalPaneHighlightingItem({highlightItem:u}):i.zoomIn(u,{showToast:!0})}else if(a.link){var l=a.link.href;o||s||!v.default.isUrlImage(l)?o&&!s||(Xh.openUrl(l,n),v.default.preventAndStop(n)):(Xh.menus.openLightbox(l),v.default.preventAndStop(n))}else if(a.contact||a.tag){var c=e.getText(),d=a.tag&&!o||s,h=n.altKey;if((d||h)&&R.a.reset(),h){Xh.PaneUpdateBatcher.beginUpdateItems();var f=r.getParsedText();f=f.replace(new RegExp(c,"g"),"").replace(/  +/g," "),r.setText(f,y.a.ChangeType.Local),Xh.PaneUpdateBatcher.commitUpdateItems()}else if(d)i.search.toggleText(c,n.shiftKey);else if(a.contact){var p=F.a.findMatchExact(c[0]===y.a.ContactPrefix?c.substr(1):c);p&&(Xh.menus.openContact(p,n),v.default.preventAndStop(n))}}else if(a.email){if(s){var g=Xh.pluginManager.getPluginGmail();if(g.isActive()){R.a.reset();var m={to:[{text:"",email:e.getText()}]};Xh.menus.openComposeEmail(g,{initData:m})}}}else a.date?n.altKey?(R.a.reset(),r.setMooDate(void 0,y.a.ChangeType.Local,!0)):Xh.menus.openDate({element:n.target,item:r,pane:i,paneObject:t}):a.plugin&&Xh.pluginManager.handleTapClick(e,t,n)}}},{key:"renderToJSX",value:function(e,t,n){var r,i=0,a=[],o=n.noPrefix,s=n.highlightSearch,u=e.elsNew.elements,l=t&&R.a.isSelected(t);if(s)if(v.default.isString(s))r=s.split(" ").filter((function(e){return!!e}));else if(t){var c=t.pane.searchingPaneObjects.get();r=c.isSearching?c.text.split(" ").filter((function(e){return!!e})):t.pane.search.getSearchWords()}for(var d=0;d<u.length;d++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var h=u[d];if(!o||!h.props.prefixType){var f=h.getStyledText(e,n);if(f){var p=this.renderElToJSX(u,d,e,t,f,l,r,n);a.push(p)}}}return a}},{key:"renderElToJSX",value:function(e,t,r,i,a,o,s,u){var l=e[t],c=l.props,d=c.plugin||c.date;if(i&&l.isImage())return M.a.createElement(bo,{key:t,paneObject:i,el:l});if(d){var h="mobutton "+d.displayElement.attrs.cls.join(" ");return t>0&&(h+=" padB"),t<e.length-1&&(h+=" padA"),M.a.createElement("span",{key:t,className:h,plugin:d.p,"plugin-id":d.id,onClick:i&&this.onClickHandler.bind(this,l,i)},M.a.createElement("span",null,a))}if(c.itemLink||c.link&&c.link.appLink){var f=l.getClassNames(!0);return t>0&&(f+=" padB"),t<e.length-1&&(f+=" padA"),M.a.createElement("span",{key:t,className:f,onClick:i&&this.onClickHandler.bind(this,l,i)},M.a.createElement("span",null,a))}var p=r.isPrefixCodeBlock();p&&!i&&(a=a.slice(0,Math.min(a.length,100)).replace(/\n/g," "));var g=!u.highlightSearch||p&&i?a:this.replaceTextWithSearchJSX(a,s,t),m={};c.link&&(m["data-href"]=c.link.href),c.code&&i&&(m.style={fontSize:Xh.DisplaySettings.fontSizeForItem(i)-y.a.SizeReductionInlineCode});var _=!u.noFormat&&l.getClassNames(!1,o);if(_)return M.a.createElement("span",L()({key:t,className:_.trim()},m,{onClick:this.onClickHandler.bind(this,l,i)}),g);if(p&&i){var b=v.default.lazyLoad("ReactCodeBlock",(function(){return n.e(0).then(n.bind(null,234))}));return M.a.createElement(O.Suspense,{key:t,fallback:M.a.createElement("div",null,M.a.createElement("pre",null,g))},M.a.createElement(b,{paneObject:i},a))}return g}},{key:"replaceTextWithSearchJSX",value:function(e,t,n){for(var r=0,i=e.toLowerCase(),a=[],o=e.length+1,s=0;s<t.length;s++){var u=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var l=t[s],c=void 0,d=void 0;(c=i.indexOf(l,d))>=0;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(c>=0)for(var h=0,f=c;f<c+l.length;f++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;(isNaN(o)||f<o)&&(o=f),a[f]=!0}d=c+1}}if(o<=e.length){for(var p=0,g=-1,v=!0,m=e.length-1;m>=o-1;m--){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;if(g>=0&&(m<0||!a[m])){var y=e.substring(m+1,g+1),_=e.substr(g+1),b=e.substr(0,m+1);v&&(v=!1),e=b+'<span class="c-search-highlight">'+y+"</span>"+_,g=-1}a[m]&&g<0&&(g=m)}return M.a.createElement("span",{key:n,dangerouslySetInnerHTML:{__html:e}})}return e}},{key:"renderElNew",value:function(e,t,n,r,i,a){var o=e[t],s=o.props,u=s.plugin||s.date;if(u&&i&&!i.plugin&&u.displayElement.attrs.cls.includes("plugin_drive_image_inline")){var l=Xh.pluginManager.getPluginDrive(),c=l.getAttachment(u.id);if(l.getAttachUrl(c))return o.getText()}else if(o.isImage()&&!s.plugin)return n||s.link.href;if(u)return this.renderPlugin(n,o,t,e.length);if(s.itemLink||s.link&&s.link.appLink){var d=o.getClassNames(!0),h=s.itemLink?' data-itemid="'.concat(s.itemLink,'"'):' data-href="'.concat(s.link.href,'"');return t>0&&(d+=" padB"),t<e.length-1&&(d+=" padA"),'<span class="'.concat(d,'"').concat(h,"><span>").concat(n,"</span></span>")}var f=a.highlightSearch,p=a.convertSpaces,g=a.fontSize;n=f?this.replaceTextWithSearch(n,i):v.default.escape(n),p&&(n=n&&n.replace(/ /g,"&nbsp;"));var m="";s.link&&(m=' data-href="'.concat(s.link.href,'"')),s.code&&g&&(m+=' style="font-size: '.concat(g-y.a.SizeReductionInlineCode,'px"'));var _=!a.noFormat&&o.getClassNames();return _?'<span class="'+_.trim()+'"'+m+">"+n+"</span>":n}},{key:"renderNew",value:function(e,t,n,r){for(var i=0,a=[],o=r.noPrefix,s=r.forHiddenInput,u=0;u<e.length;u++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=e[u];if(!o||!l.props.prefixType){var c=l.getStyledText(t,r);if(c){var d=this.renderElNew(e,u,c,t,n,r);a.push(d),s&&u===e.length-1&&(null===t||void 0===t?void 0:t.isPrefixCodeBlock())&&a.push(y.a.TextSpace)}}}return a.join("")}},{key:"renderPlugin",value:function(e,t,n,r){var i=t.props.plugin||t.props.date,a=i.displayElement.attrs.cls.join(" ");return n>0&&(a+=" padB"),n<r-1&&(a+=" padA"),'<span class="'.concat(a,'" plugin="').concat(i.p,'" plugin-id="').concat(i.id,'"><span>').concat(e,"</span></span>")}},{key:"replaceTextWithSearch",value:function(e,t){for(var n=0,r=t.searchingPaneObjects.get(),i=r.isSearching?r.text.split(" ").filter((function(e){return!!e})):t.search.getSearchWords(),a=e.toLowerCase(),o=[],s=e.length+1,u=0;u<i.length;u++){var l=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var c=i[u],d=void 0,h=void 0;(d=a.indexOf(c,h))>=0;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(d>=0)for(var f=0,p=d;p<d+c.length;p++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;(isNaN(s)||p<s)&&(s=p),o[p]=!0}h=d+1}}if(s<=e.length)for(var g=0,m=-1,y=!0,_=e.length-1;_>=s-1;_--){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(m>=0&&(_<0||!o[_])){var b=e.substring(_+1,m+1),w=e.substr(m+1),k=e.substr(0,_+1);_===s&&(k=v.default.escape(k)),y&&(w=v.default.escape(w),y=!1),e=k+'<span class="c-search-highlight">'+v.default.escape(b)+"</span>"+w,m=-1}o[_]&&m<0&&(m=_)}else e=v.default.escape(e);return e}}]),e}(),b()(co.prototype,"renderElNew",[w.a],Object.getOwnPropertyDescriptor(co.prototype,"renderElNew"),co.prototype),co),ko=n(33),So=n.n(ko),Eo=n(36),Po=n(27),Io=n(55),Do=new(ho=function(){function e(){a()(this,e),this.pluginsAvailable=[y.a.PluginID.Contacts,y.a.PluginID.Drive,y.a.PluginID.GCalendar,y.a.PluginID.Gmail],this.pluginsAvailableNew=[y.a.PluginID.Contacts,y.a.PluginID.Drive,y.a.PluginID.GCalendar],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new E.a(!1),this.GCalendarsAvailable=new Y.a,this.GCalendarSyncErrors=new Y.a(void 0),this.GCalendarAddFailure=new E.a(!1),this.GCalendarListFailure=new E.a(!1),this.GCalendarListLoading=new E.a(!1),this.GmailNumSyncd=new E.a(0),this.GmailCacheSize=new E.a(0),this.GmailSyncAccounts=new Y.a,this.isSaveEnabled=new E.a(!1),this.hasRefreshed=!1,G.a.forceBind("calendarComparator",this)}return s()(e,[{key:"init",value:function(){var e=Xh.pluginManager.getPluginGCalendar().getImportCalendarList();e&&this.GCalendarsAvailable.set(e)}},{key:"checkRefresh",value:function(){this.hasRefreshed||this.refreshPluginStatus()}},{key:"refreshPluginStatus",value:function(e){var t=0;this.hasRefreshed=!0;for(var n=0;n<this.pluginsAvailable.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.pluginsAvailable[n],i=void 0;i=r===y.a.PluginID.Contacts?F.a.isEnabled():Xh.pluginManager.isAuthorized(r),this.updatePluginStatus(r,i)}e&&e!==y.a.PluginID.GCalendar||(this.updatePluginOptionStatus(y.a.PluginID.GCalendar,y.a.PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(y.a.PluginID.GCalendar,y.a.PluginSettingsID.GCalendar.ExportCalendar))}},{key:"refresh",value:function(e){this.refreshPluginStatus(),e&&e!==y.a.PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),e&&e!==y.a.PluginID.Gmail||this.updateGmailInfo()}},{key:"calendarComparator",value:function(e,t){return e.summary.localeCompare(t.summary)}},{key:"updateGmailInfo",value:function(){var e=Xh.pluginManager.getPluginGmail();this.GmailNumSyncd.set(e.getSyncdMessageCount()),this.GmailSyncAccounts.set(e.getSyncAccounts())}},{key:"updateCalendarList",value:function(){var e=this;if(Xh.pluginManager.isAuthorized(y.a.PluginID.GCalendar)){var t=Xh.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),t.getFullCalendarList((function(t){e.GCalendarListLoading.set(!1,!1),t?(t.sort(e.calendarComparator),e.GCalendarsAvailable.set(t),e.GCalendarListFailure.set(!1)):e.GCalendarListFailure.set(!0)}))}}},{key:"getEnabledPlugins",value:function(){this.checkRefresh();var e=this._pluginEnabledObservables;return Object.keys(e).filter((function(t){return e[t].get()}))}},{key:"getPluginEnabledObservable",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e]}},{key:"isPluginEnabled",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e].get()}},{key:"getPluginOptionObservable",value:function(e,t){return this.checkRefresh(),this._pluginOptionObservables[e][t]}},{key:"getPluginOptions",value:function(e){return this.checkRefresh(),this._pluginOptionObservables[e]}},{key:"isPluginAnOption",value:function(e){return e===y.a.PluginID.Mailbird?k.a.embed===y.a.EmbedApps.Mailbird:this.pluginsAvailable.indexOf(e)>=0}},{key:"updatePluginStatus",value:function(e,t,n){this._pluginEnabledObservables[e]?this._pluginEnabledObservables[e].set(t,n):this._pluginEnabledObservables[e]=new E.a(t)}},{key:"updatePluginOptionStatus",value:function(e,t,n){var r=Xh.pluginManager.getSetting(e,t);this._pluginOptionObservables[e]||(this._pluginOptionObservables[e]={}),this._pluginOptionObservables[e][t]?this._pluginOptionObservables[e][t].set(r||n&&[]):this._pluginOptionObservables[e][t]=n?new Y.a(r):new E.a(r)}},{key:"onFailedAuthenticate",value:function(e){Xh.toasts.pushMessage({text:"We failed to successfully authenticate you for "+e+", please try again.",actionText:"OKAY"})}},{key:"_wasPluginAuthorized",value:function(e,t){var n;if(e===y.a.PluginID.Contacts)t.indexOf(y.a.GScope.Contacts)>=0&&(n=!0);else{var r=Xh.pluginManager.getPlugin(e),i=Eo.a.getUserSync();i&&(n=r.verifyAuthorization(i.email))}try{v.default.PAssert(748,n,"Should always be successful at authorizing plugins")}catch(a){v.default.reportError(a)}return n}},{key:"_enablePlugin",value:function(e){var t=this,n=this.getPluginEnabledObservable(e),r=Xh.pluginManager.getPlugin(e);Xh.pluginManager.authorizePlugin(e,!0,(function(i){i?(n.set(!0),Xh.pluginManager.onPluginAuthorized(r,!0),t.refresh(e),v.default.sendEvent(e,"PluginEnabled")):(t.onFailedAuthenticate(e),v.default.sendEvent(e,"PluginEnableFailed"))}))}},{key:"enablePlugin",value:function(e){e!==y.a.PluginID.Contacts&&this._enablePlugin(e)}},{key:"disablePlugin",value:function(e){var t=this.getPluginEnabledObservable(e);e===y.a.PluginID.Contacts?(v.default.sendEvent("Settings","DisableContacts"),F.a.clearContacts(),t.set(!1)):Xh.pluginManager.deauthorizePlugin(e,(function(){t.set(!1),v.default.sendEvent(e,"PluginDisabled")}))}},{key:"togglePlugin",value:function(e){!this._pluginEnabledObservables[e].get()?this.enablePlugin(e):this.disablePlugin(e)}},{key:"togglePluginOption",value:function(e,t){var n=this,r=this._pluginOptionObservables[e][t],i=!r.get();Xh.pluginManager.setSetting(e,t,i),i?Xh.pluginManager.authorizePlugin(e,!0,(function(a){a?(Xh.pluginManager.onAuthorizedSetting(e,t,i),r.set(!0),v.default.sendEvent(e,"OptionEnabled_"+t)):(n.onFailedAuthenticate(t),Xh.pluginManager.setSetting(e,t,!i),v.default.sendEvent(e,"OptionEnableFailed_"+t))})):(r.set(!1),v.default.sendEvent(e,"OptionDisabled_"+t))}},{key:"setPluginOption",value:function(e,t,n,r,i){var a=this,o=this._pluginOptionObservables[e][t],s=o.get();Xh.pluginManager.setSetting(e,t,n),n&&r?Xh.pluginManager.authorizePlugin(e,!0,(function(r){r?(Xh.pluginManager.onAuthorizedSetting(e,t,n),o.set(n),v.default.sendEvent(e,"OptionSet_"+t+"_"+n),i&&i(!0)):(a.onFailedAuthenticate(t),Xh.pluginManager.setSetting(e,t,s),v.default.sendEvent(e,"OptionEnableFailed_"+t+"_"+n),i&&i(!1))})):(o.set(n),v.default.sendEvent(e,"OptionSet_"+t+"_"+n),i&&i(!0))}},{key:"isNotificationsEnabled",value:function(){return!Xh.settings.disableNotifications.get()}},{key:"toggleNotifications",value:function(){var e=Xh.settings.disableNotifications.get();Xh.settings.disableNotifications.set(!e),e?Xh.timeline.updateNotifications():Xh.timeline.clearNotifications()}},{key:"onTapRefreshContacts",value:function(e,t){var n=this,r=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),r=!0,F.a.refreshContacts((function(){n.isRefreshingContacts.set(!1),t&&t()})),v.default.sendEvent("Menu","RefreshContacts")),r}},{key:"addCalendar",value:function(e,t){var n=this,r=Xh.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),r.createCalendar(e,t,(function(e){n.GCalendarListLoading.set(!1),e?n.updateCalendarList():n.GCalendarAddFailure.set(!0)}))}},{key:"notifySyncError",value:function(e){this.GCalendarSyncErrors.set(e||[])}},{key:"updatePluginsEnabled",value:function(){var e=this,t=v.default.clone(Xh.settings.syncAccounts.get()||{});[y.a.PluginID.Contacts].forEach((function(n){var r=Object.keys(t).some((function(e){return t[e][n]}));r!==e.isPluginEnabled(n)&&(r?(console.log("Enabling",n),e.enablePlugin(n)):(console.log("Disabling",n),e.disablePlugin(n)))}))}}]),e}(),b()(ho.prototype,"onTapRefreshContacts",[w.a],Object.getOwnPropertyDescriptor(ho.prototype,"onTapRefreshContacts"),ho.prototype),ho);function To(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var xo,Co,Ao=(fo=function(){function e(){a()(this,e),this.modalStack=new Y.a,this.contextMenuStack=new Y.a,this.emailComposeStack=new Y.a}return s()(e,[{key:"openAddPaneMenu",value:function(e){e.componentName="ReactContextMenuPaneView",e.isAddPane=!0,this.openContextMenu(e)}},{key:"openContextMenu",value:function(e){e.element&&v.default.isString(e.element)&&(e.element=v.default.element(e.element)),e.element&&v.default.findParent(e.element,"desktopSidebar")&&(e.pos={left:Xh.DesktopUI.getSidebarWidth()+4},e.side="right",v.default.findParent(e.element,"desktopMenuBottom")&&(e.openFromBottom=!0)),this.contextMenuStack.push(e)}},{key:"indexOfContextMenu",value:function(e){var t=this.contextMenuStack.get(),n=t.indexOfWithProperty("fn",e);return n<0&&(n=t.indexOfWithProperty("componentName",e)),n}},{key:"closeContextMenu",value:function(e,t,n){if(e){var r=this.indexOfContextMenu(e);try{v.default.PAssert(839,r>=0,"Tried to close a context menu that was not open")}catch(s){v.default.reportError(s)}if(r>=0){var i=this.contextMenuStack.get()[r];this.contextMenuStack.removeAt(r),i.onClosed&&i.onClosed(t,n)}}else{var a,o=this.contextMenuStack.pop();if(o)null===(a=o.onClosed)||void 0===a||a.call(o,!1,n)}0===this.contextMenuStack.length()&&R.a.updateCaret()}},{key:"getTopContextMenu",value:function(){var e=this.contextMenuStack.get();if(e&&e.length){var t=e[e.length-1];return t.componentName||t.fn}}},{key:"closeTopContextMenu",value:function(){var e=this.getTopContextMenu();e&&this.closeContextMenu(e)}},{key:"isAutocompleteOpen",value:function(){return this.indexOfContextMenu("ReactAutocomplete")>=0||this.indexOfContextMenu("ReactContextMenuDate")>=0}},{key:"isOnlyAutocompleteOpen",value:function(){return this.isAutocompleteOpen()&&1===this.contextMenuStack.get().length}},{key:"isContextMenuOpen",value:function(e){return e?this.indexOfContextMenu(e)>=0:this.contextMenuStack.get().length>0}},{key:"isModalOpen",value:function(e){var t=this.modalStack.get();if(!e)return t.length>0;for(var n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t[r].id===e)return!0}}},{key:"openModal",value:function(e,t){try{v.default.PAssert(840,void 0===t||v.default.isObject(t),"Must always pass in a valid object for params")}catch(n){v.default.reportError(n)}if(!this.isModalOpen(e)){t=t||{};try{v.default.PAssert(841,void 0===t.id,"Should not already have an ID defined with modal params")}catch(n){v.default.reportError(n)}t.id=e,R.a.reset(),this.modalStack.push(t)}}},{key:"closeModal",value:function(e,t){var n=this.modalStack.get().indexOfWithProperty("id",e);if(n>=0){var r=this.modalStack.get()[n],i=!0;r.onClosing&&(i=r.onClosing()),i&&(this.modalStack.removeAt(n),r.callback&&r.callback(t))}}},{key:"confirm",value:function(e,t,n){var r=this;return new Promise((function(i){r.openModal(y.a.Modals.Confirm,function(e){for(var t=0,n=1;n<arguments.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=null!=arguments[n]?arguments[n]:{};n%2?To(Object(r),!0).forEach((function(t){So()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):To(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({text:e,callback:function(e){i(e),t&&t(e)}},n||{}))}))}},{key:"prompt",value:function(e){var t=e.title,n=e.text,r=e.cb,i=e.value;try{v.default.PAssert(842,r,"Prompt modals should have callbacks",t)}catch(a){v.default.reportError(a)}this.openModal(y.a.Modals.Prompt,{title:t,text:n,fields:[{value:i}],callback:function(e){return r(e?e[0]:void 0)}})}},{key:"promptComplex",value:function(e){this.openModal(y.a.Modals.Prompt,e)}},{key:"alert",value:function(e){try{v.default.PAssert(843,!e.action,"Still using an old style alert",e)}catch(t){v.default.reportError(t)}e.action&&(e.callback=e.action),this.openModal(y.a.Modals.Alert,e)}},{key:"options",value:function(e,t,n){try{v.default.PAssert(844,v.default.isArray(t),"Must have valid options array")}catch(r){v.default.reportError(r)}try{v.default.PAssert(845,n,"Options modal must have a callback")}catch(r){v.default.reportError(r)}this.openModal(y.a.Modals.Options,{text:e,options:t,callback:n})}},{key:"openSettings",value:function(e){Xh.onIntroAction("SettingsMenu"),this.openModal(y.a.Modals.Settings,{section:e,onClosing:this.onClosingSettings})}},{key:"onClosingSettings",value:function(){var e=!Do.isSaveEnabled.get();return e||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(e){e&&(Do.isSaveEnabled.set(!1),this.closeModal(y.a.Modals.Settings))}.bind(this)),e}},{key:"openDisplaySettings",value:function(){R.a.reset(),Xh.DisplaySettings.isOpen.set(!0),Xh.onIntroAction("DisplaySettings")}},{key:"getUserName",value:function(){return v.default.isDemoMode()?"Demo":Eo.a.getAccountName()}},{key:"_indexOfCompose",value:function(e){for(var t=0,n=this.emailComposeStack.get(),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(n[r].draftMsg.id===e)return r}return-1}},{key:"isComposeOpenForEmail",value:function(e){return e?this._indexOfCompose(e)>=0:this.emailComposeStack.length()>0}},{key:"openComposeEmail",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.threadID,i=n.messageID,a=n.initData,o=n.accountID;try{v.default.PAssert(846,e,"Must have a valid email plugin")}catch(s){v.default.reportError(s)}try{v.default.PAssert(847,!r||v.default.isString(r),"Must have a string threadID")}catch(s){v.default.reportError(s)}try{v.default.PAssert(848,!i||v.default.isString(i),"Must have a string messageID")}catch(s){v.default.reportError(s)}R.a.reset(),this.isComposeOpenForEmail()||Po.a.onLoaded((function(){var n=e.getDraftByID(o||e.getDefaultAccount(),r,i,a);try{v.default.PAssert(849,n,"Must always create a valid draft")}catch(s){v.default.reportError(s)}try{v.default.PAssert(850,t.emailComposeStack.indexOf(n)<0,"Must not double-open drafts, should re-use")}catch(s){v.default.reportError(s)}t.emailComposeStack.get().indexOfWithProperty("attach",n.attach)<0&&t.emailComposeStack.push(n)}))}},{key:"closeComposeEmail",value:function(e,t){var n=this._indexOfCompose(t.id);try{v.default.PAssert(851,n>=0,"Must have found a valid composing email to remove")}catch(r){v.default.reportError(r)}this.emailComposeStack.removeAt(n)}},{key:"openItemEditor",value:function(e){try{v.default.PAssert(852,!e.item===!!e.addOnSave,"Must be adding item if no item prop")}catch(r){v.default.reportError(r)}if(!e.item){e.parent||(e.parent=e.pane&&e.pane.type===y.a.PaneMode.Task?e.pane.getRootItem():N.a.getDefaultDocument().getRootItem());var t=N.a.createTempVMLI({text:e.text||Xh.settings.getDefaultItemText(),date:e.mooDate},{changeType:y.a.ChangeType.AllLocal});e.item=t;var n=e.endSave;e.endSave=function(e){setTimeout((function(){N.a.destroyTempVMLI(t.id)}),0),n&&n(e)}}e.componentName="ReactItemDetailsPopup",this.openContextMenu(e)}},{key:"openLightbox",value:function(e,t,n){this.openModal(y.a.Modals.Lightbox,{src:e,buttonText:t,buttonAction:n})}},{key:"confirmEncrypt",value:function(e,t){this.openModal(y.a.Modals.ConfirmEncrypt,{password:e,onYes:function(){return t(!0)},onCancel:function(){return t(!1)}})}},{key:"openModalPaneHighlightingItem",value:function(e){var t=e.zoomItem,n=e.highlightItem,r=Io.a.createPane(y.a.PaneMode.Task,{id:"TEMP_Pane"+Date.now(),document:(t||n).getDocumentOwner(),item:t,rect:{left:0,right:0,width:1e3,height:1e3},viewState:{viewMode:"Outline"}});return r.init(),this.openModal(y.a.Modals.ModalPane,{pane:r,scrollToItem:n}),R.a.setFocusedPane(r),r}},{key:"getModalPanes",value:function(){return this.modalStack.get().filter((function(e){return e.id===y.a.Modals.ModalPane})).map((function(e){return e.pane}))}},{key:"openDate",value:function(e){var t=e.item,n=e.paneObject,r=e.onClosed,i=e.selectAfter,a=V()(e,["onClosed","selectAfter"]);this.openContextMenu(Object.assign({componentName:"ReactContextMenuDate",onUnmount:function(){if(n){if(i){var e=n&&t.elsNew.findElement(n,(function(e){return!!e.props.date}));e&&R.a.selectIndex(R.a.getStartIndex(),e.offset+e.length+1)}R.a.updateHiddenInput()}null===r||void 0===r||r()}},a))}},{key:"openOptions",value:function(){this.openContextMenu({componentName:"ReactContextMenuOptions",element:v.default.element("optionsButton")})}},{key:"openItemContextMenu",value:function(e,t,n){var r=e.pane,i=e.item,a=e.index,o=(null===n||void 0===n?void 0:n.element)||r.listManager.getElementByIndex(a);this.openContextMenu(Object.assign({componentName:"ReactContextMenuItem",key:"menu"+i.id+(t||""),item:i,pane:r,paneObject:e,element:o},n))}},{key:"openContextMenuList",value:function(e,t,n,r,i,a){var o=this,s=v.default.isString(n[0]),u=n;return s&&(u=n.map((function(e){return{id:e,value:e}}))),v.default.promisify((function(n){o.openContextMenu({componentName:"ReactContextMenuList",element:t,title:e,fromHotkey:a,onSelect:function(e){var t=e.id;n(t)},options:u})}))}},{key:"openContact",value:function(e,t){this.openContextMenu({componentName:"ReactContextMenuContactDetails",element:t.target,contact:e})}},{key:"openLink",value:function(e,t){I.b.openMenu({type:"OpenUrl",element:t.target,href:e})}}]),e}(),b()(fo.prototype,"onClosingSettings",[w.a],Object.getOwnPropertyDescriptor(fo.prototype,"onClosingSettings"),fo.prototype),fo),Lo=(xo=function(){function e(){a()(this,e),this.enableTempPanePosition=!1,this.totalWidth=new E.a(0),this._panesById={},this._panes=new Y.a,this.displayPanes=new Y.a,this.isLoading=new E.a(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0}return s()(e,[{key:"init",value:function(){}},{key:"load",value:function(){Xh.settings.activeUser.get()&&this.setupInitialTimeout(),this.isLoaded||(this._panes.listen(this.updateDisplayPanes),k.a.windowSize.listen(this.onResize),K.a.listen("panesChanged",this.updateDisplayPanes),this.onResize(),this.isLoaded=!0)}},{key:"getStats",value:function(e){var t={};return void 0===e?this.runForEachPane((function(e){t[e.id]=e.getStats()})):t=this.getPaneById(e).getStats(),t}},{key:"setupInitialTimeout",value:function(){0===this._panes.length()&&(clearTimeout(this._initialTimeout),this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))}},{key:"notifyPanes",value:function(){this._panes.notify()}},{key:"onResize",value:function(){this.updatePaneRects()}},{key:"getNextPaneID",value:function(){return++v.default.totalPanes+"P"+Date.now()}},{key:"getAllPerPaneState",value:function(e,t){for(var n=0,r=[],i=this.paneCount(),a=0;a<i;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this.getPaneAtIndex(a);r.push(o.getPerPaneState(e,t))}return r}},{key:"setAllPerPaneState",value:function(e,t,n){for(var r=0,i=this.paneCount(),a=0;a<i;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.getPaneAtIndex(a).setPerPaneState(e,t,n)}}},{key:"deletePerPaneState",value:function(e,t){var n=this.getPaneById(e);n&&n.deletePerPaneState(t)}},{key:"updatePaneStateForPane",value:function(e,t){try{v.default.PAssert(1045,e,"Must pass in a valid pane to update")}catch(n){v.default.reportError(n)}this._isLoading||this.savePaneState(t)}},{key:"recreatePaneState",value:function(){var e=[];return this.runForEachPane((function(t){e.push(t.getSaveInfo())})),e}},{key:"isPaneActive",value:function(e){return!!this._panesById[e]}},{key:"createPaneAtIndex",value:function(e,t,n,r){try{v.default.PAssert(1046,e,"Must supply a valid pane type")}catch(a){v.default.reportError(a)}try{v.default.PAssert(1047,!this._iteratingPanes,"Should not change pane array while iterating")}catch(a){v.default.reportError(a)}isNaN(t)&&(t=this.paneCount()),(n=n||{}).id=n.id||this.getNextPaneID(),n.document=n.document||N.a.getDefaultDocument(),v.default.isString(n.item)&&(n.item=N.a.getItem(n.item));var i=Io.a.createPane(e,n);return i?this.addPaneAtIndex(i,t,!1,r):v.default.reportError(new Error("Invalid pane created: "+e+" | "+t)),i}},{key:"addPaneAtIndex",value:function(e,t,n,r){try{v.default.PAssert(1048,e,"Must supply a valid pane")}catch(o){v.default.reportError(o)}this._panesById[e.id]&&(e.id=this.getNextPaneID());try{v.default.PAssert(1049,!this._panesById[e.id],"Should never add the same pane twice")}catch(o){v.default.reportError(o)}if(this._panesById[e.id]=e,this.enableTempPanePosition&&this._panes.length()>0&&t===this._panes.length()){var i=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:i,left:i.rect.get().left}}if(isNaN(t)?this._panes.push(e,r):this._panes.splice(t,0,e,r),this._initPane(e),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(e),!n){var a=this.getPaneState();isNaN(t)?a.push(e.getSaveInfo()):a.splice(t,0,e.getSaveInfo()),this.savePaneState()}}},{key:"_initPane",value:function(e){e.init(),e.isExpanded.listen(this.onResize),this._panesById[e.id]=e}},{key:"unloadPane",value:function(e){e.unload(),e.isExpanded.unlisten(this.onResize),K.a.fireEvent("paneRemoved",[e]);try{v.default.PAssert(1050,this._panesById[e.id],"Should never unload a pane that does not exist")}catch(t){v.default.reportError(t)}this._panesById[e.id]=void 0,e.destroy()}},{key:"removePaneAtIndex",value:function(e,t){try{v.default.PAssert(1051,!isNaN(e),"Must supply a valid index to remove from")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1052,!this._iteratingPanes,"Should not change pane array while iterating")}catch(i){v.default.reportError(i)}var n,r=this._panes.splice(e,1,void 0,t)[0];try{v.default.PAssert(1053,r,"Must have removed a valid pane")}catch(i){v.default.reportError(i)}return this.unloadPane(r),this.getPaneState().splice(e,1),this.savePaneState(),n=r.id,this.ensurePaneInView(),n}},{key:"loadPaneFromState",value:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,n=t&&N.a.getItem(t),r=e.document,i=N.a.getDocumentById(r);n&&n.isDeleted()&&(n=void 0);var a,o=e.type||"PaneTask",s=v.default.clone(e);return s.item=n,s.document=i,s.deferredItemID=n?void 0:t,s.offset=e.offset,s.id&&this.isPaneActive(s.id)||(a=Io.a.createPane(o,s))&&(e.id=a.id,e.showarch&&a.showArchived.set(!0),a.applyItemState(e.itemState)),a}},{key:"removeFocusedPane",value:function(){return this.removePane(v.default.focusedPane)}},{key:"removePane",value:function(e){var t=this.getPaneIndex(e);return this.removePaneAtIndex(t)}},{key:"clearPanes",value:function(e){try{v.default.PAssert(1054,v.default.isDemoMode(),"Should only be clearing panes in demo mode")}catch(t){v.default.reportError(t)}R.a.setFocusedPane(void 0),this.runForEachPane((function(e){e.destroy()})),this._panesById={},this._panes.set([],e)}},{key:"clearPaneCaches",value:function(){this.runForEachPane((function(e){e.listManager.clearCache()}))}},{key:"getPaneAtIndex",value:function(e){return this._panes.get()[e]}},{key:"getPaneIndex",value:function(e){return this._panes.get().indexOf(e)}},{key:"getFocusedPaneIndex",value:function(){return this.getPaneIndex(v.default.focusedPane)}},{key:"hasPaneById",value:function(e){return!!this._panesById[e]}},{key:"getPaneById",value:function(e){try{v.default.PAssert(1057,this._panesById[e],"Should never request a pane that is not currently loaded")}catch(t){v.default.reportError(t)}return this._panesById[e]}},{key:"getPaneByName",value:function(e){try{v.default.PAssert(1058,this._panesByName[e],"Should never request a pane that is not currently loaded")}catch(t){v.default.reportError(t)}return this._panesByName[e]}},{key:"getPanesByType",value:function(e){for(var t=0,n=[],r=this.paneCount(),i=0;i<r;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=this.getPaneAtIndex(i);e&&a.type!==e||n.push(a)}return n}},{key:"paneCount",value:function(){return this._panes.get().length}},{key:"runForEachPane",value:function(e,t){var n=0;this._iteratingPanes=!0;for(var r=this._panes.get().concat(Xh.menus.getModalPanes()),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];try{v.default.PAssert(1059,!a.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(o){v.default.reportError(o)}if(!t||a.type===t)try{e(a)}catch(s){v.default.reportError(s)}}this._iteratingPanes=!1}},{key:"distance",value:function(e,t){return Math.abs(e-t)}},{key:"findIndex",value:function(e,t){var n=this._panes.get(),r=n.map((function(e){return e.rect.get()})),i=n.indexOf(e),a=i,o=r[a],s=o.left,u=s+o.width;if(t>0){var l=r[i+1];if(void 0===l)return i;t>this.distance(u,l.left+l.width/2)+5&&(a=i+1)}else if(t<0){var c=r[i-1];if(void 0===c)return i;var d=c.left+c.width;t<-(this.distance(s,d-c.width/2)+5)&&(a=i-1)}return v.default.clamp(a,0,r.length)}},{key:"dragPaneTo",value:function(e,t){var n,r=this._panes.get(),i=this.findIndex(e,t);if(i>=0){var a=r.indexOf(e);a!==i&&(r.splice(i,0,r.splice(a,1)[0]),this._panes.set(r),this.savePaneState(),n=!0)}return n}},{key:"movePaneTo",value:function(e,t){var n=this._panes.get(),r=n.indexOf(e);n.splice(t,0,n.splice(r,1)[0]),this._panes.set(n),this.savePaneState()}},{key:"paneSortFn",value:function(e,t){return e.uniquePaneID-t.uniquePaneID}},{key:"clearLoadTimeout",value:function(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0,Xh.toasts.clearMessage(y.a.MessageID.PaneLoadTimeout)}},{key:"updateDisplayPanes",value:function(){var e=0;this._initialTimeout&&this.clearLoadTimeout();for(var t=this._panes.get().slice(0).sort(this.paneSortFn),n=[],r=0;r<t.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t[r];i.isOverviewVisible()&&n.push({type:"overview",pane:i}),n.push({type:"pane",pane:i}),i.isExpanded.get()&&n.push({type:"emailPreview",pane:i})}this.updatePaneRects(),this.displayPanes.set(n),this.isLoading.set(!1)}},{key:"hasScrollbar",value:function(){return this.totalWidth.get()>k.a.windowWidth()}},{key:"onBoardChanged",value:function(){this.loadPanesFromState()}},{key:"_addPaneByButton",value:function(e,t,n,r){var i=this.createPaneAtIndex(e,void 0,{viewState:{viewMode:t},item:n});return R.a.setFocusedPane(i),i.onAdded(),i}},{key:"addPaneByButton",value:function(e,t,n){var r=Io.a.canCreatePane(e);if(!0===r)return this._addPaneByButton(e,t,n);Xh.toasts.pushMessage("Cannot create pane because ".concat(r))}},{key:"emailPreviewSize",value:function(e){var t=this._panes.length()>1?y.a.EmailPreviewSizeMaxFlex:y.a.EmailPreviewSizeMax,n=e.widthManual||y.a.ExpandedPaneWidth;return e.getOverview().isVisible.get()&&(n+=y.a.OverviewWidth),Math.max(Math.min(t,k.a.windowWidth()-n),y.a.EmailPreviewSizeMin)}},{key:"onLoadRemote",value:function(){}}]),e}(),b()(xo.prototype,"onResize",[w.a],Object.getOwnPropertyDescriptor(xo.prototype,"onResize"),xo.prototype),b()(xo.prototype,"updateDisplayPanes",[w.a],Object.getOwnPropertyDescriptor(xo.prototype,"updateDisplayPanes"),xo.prototype),b()(xo.prototype,"onBoardChanged",[w.a],Object.getOwnPropertyDescriptor(xo.prototype,"onBoardChanged"),xo.prototype),xo),Oo=n(40);function Mo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Ro,Fo=(Co=function(e){d()(n,e);var t=Mo(n);function n(){return a()(this,n),t.call(this)}return s()(n,[{key:"load",value:function(){this.isLoaded||(Oo.a.init(),l()(g()(n.prototype),"load",this).call(this),Xh.DesktopUI.sidebarChanged.listen(this.onResize))}},{key:"onPluginGmailToggled",value:function(){this.savePaneState(),this.loadPanesFromState()}},{key:"loadPanesFromState",value:function(){var e=this;this.load();var t=this.getPaneState();if(t){var n=0,r=0,i=!1;this._isLoading=!0,Xh.PaneUpdateBatcher.beginUpdateItems();for(var a={},o=function(r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.getPaneAtIndex(r),o=t.find((function(e){return e.id===i.id}));o?(i.onRemoteUpdate(o),a[i.id]=i):e.unloadPane(i)},s=0;s<this.paneCount();++s)o(s);this._panes.set([],!1);for(var u=[],l=0;l<t.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=t[l];if(k.a.supportsMultiplePanes.get()||(c.isOverviewVisible=!1),a[c.id])u[l]=a[c.id];else{var d=this.loadPaneFromState(c);if(d){if(u[l]=d,this._initPane(d),d.usesVMLIs){var h=d.getItem(!0);if(!h&&d.type===y.a.PaneMode.Task)h=N.a.getDefaultDocument().getRootItem();d.zoomIn(h,{forLoad:!0})}}else i=!0}}u=v.default.arrayUniques(u.filter((function(e){return!!e})),"id"),this._panes.set(u),this.paneCount()>0&&R.a.setFocusedPane(this.getPaneAtIndex(0)),this._isLoading=!1,i&&this.savePaneState(),Xh.PaneUpdateBatcher.commitUpdateItems()}}},{key:"loadPaneFromState",value:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,n=t&&N.a.getItem(t);n&&n.isDeleted()&&(n=void 0);var r=e.type||"PaneTask";n||(r===y.a.PaneMode.Task?n=N.a.getDefaultDocument().getRootItem():r===y.a.PaneMode.Inbox&&(n=t));var i,a=v.default.clone(e);return a.item=n,a.deferredItemID=n?void 0:t,a.scrollIndex=e.scrollIndex,this._panesById[e.id]&&(e.id=this.getNextPaneID()),a.id&&this.isPaneActive(a.id)||(i=Io.a.createPane(r,a))&&(e.id=i.id,e.showarch&&i.showArchived.set(!0),i.applyItemState(e.itemState)),i}},{key:"savePaneState",value:function(e){try{v.default.PAssert(819,!this._isLoading,"Bad stuff! Saving pane state during load")}catch(n){v.default.reportError(n)}if(v.default.isDemoMode()||this._isInitialStateLoaded&&Xh.settings.activeUser.get()){var t=this.recreatePaneState();Oo.a.savePaneState(t,e)}}},{key:"getPaneState",value:function(){return Oo.a.getPaneState()}},{key:"hasLoadedPaneState",value:function(){return Oo.a.hasLoadedPaneState()}},{key:"loadInitialState",value:function(){this._isInitialStateLoaded||(this.loadPanesFromState(),Oo.a.selected.listen(this.onBoardChanged),this._isInitialStateLoaded=!0)}},{key:"addBoard",value:function(){var e=Oo.a.add();return this.selectBoard(e),Xh.onIntroAction("AddBoard"),e}},{key:"selectBoard",value:function(e){Oo.a.selectBoard(e)}},{key:"removePanesByType",value:function(e){var t=0,n=[];this.runForEachPane((function(e){n.push(e)}),e);for(var r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.removePane(n[r])}}},{key:"getAvailableArea",value:function(){return Xh.DesktopUI.getSidebarWidth()-2}},{key:"updatePaneRects",value:function(e){this.isResizingPane=e;var t=this._panes.get(),n=k.a.windowHeight()-Xh.DesktopUI.topBarHeight(),r=k.a.windowWidth()-Xh.DesktopUI.getSidebarWidth();if(k.a.supportsMultiplePanes.get()){var i,a,o=Xh.DesktopUI.getSidebarWidth();if(r+=2,v.default.isDemoInIframe()&&(r-=5),t.length>0){var s,u,l=0,c=0,d=0,h=[],f=[],p=0;for(i=0;i<t.length;i++){var g;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var m=t[i];m.widthManual?(f[i]=m.widthManual,p+=m.widthManual):m.isExpanded.get()?(f[i]=y.a.ExpandedPaneWidth,p+=y.a.ExpandedPaneWidth):h.push({index:i,pane:m}),m.isExpanded.get()&&(p+=m.widthManualExpanded||this.emailPreviewSize(m)),(null===(g=m.getOverview())||void 0===g?void 0:g.isVisible.get())&&(p+=y.a.OverviewWidth)}for(var _=r-p;h.length>0;){var b=0;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var w=Math.floor(_/h.length),S=-1,E=w;for(i=0;i<h.length;i++){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;var P=h[i].pane;P.maxWidthFlex<E&&(S=i,E=P.maxWidthFlex)}if(S>=0){var I=h[S].pane;s=Math.min(1===t.length?I.widthBiggerInSingle?I.maxWidthSingle:I.maxWidthFlex:h[S].pane.maxWidthFlex,_),f[h[S].index]=s,p+=s,_-=s,h.splice(S,1)}else{var D=0,T=-1,x=w;for(i=0;i<h.length;i++){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;var C=h[i].pane;C.minWidthFlex>x&&(T=i,x=C.minWidthFlex)}if(!(T>=0)){var A=0;for(i=0;i<h.length;i++){if(A++>5e3&&__infLoop&&__infLoop(A))throw new RangeError;f[h[i].index]=w,p+=w}break}s=h[T].pane.minWidthFlex,f[h[T].index]=s,p+=s,_-=s,h.splice(T,1)}}var L=Math.max((r-p)/2,0),O=!1;for((a=Math.floor(L)+o)!==Math.round(L)&&(O=p+1===r),v.default.isDemoInIframe()&&(a+=2),i=0;i<t.length;i++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var M=t[i];s=f[i]+(O&&i===t.length-1?1:0),u=M.isExpanded.get()?M.widthManualExpanded||this.emailPreviewSize(M):0,M.isOverviewVisible()&&(a+=y.a.OverviewWidth),this.tempPositionForNewPane&&M.rect.get()?(M.rect.get().width=s,M.rect.notify()):M.setRect({left:a,top:0,width:s-(0===i?2:1),height:n,right:a+s,bottom:n,isFirst:0===i,widthExpanded:u}),i>0&&M.isOverviewVisible()&&s++,a+=s,M.isExpanded.get()&&(a+=u)}}if(this.tempPositionForNewPane){var F=t[t.length-1].rect.get(),N=this.tempPositionForNewPane;F.left=N.left+N.pane.rect.get().width}this.totalWidth.set(a),e||K.a.fireEvent("paneSizeChanged",[]),R.a.updateCaretAndCaretItem(),setTimeout((function(){R.a.updateCaretAndCaretItem()}),500)}else t.forEach((function(e){return e.rect.set({left:0,right:0,width:r,top:0,bottom:n,height:n})}))}},{key:"ensurePaneInView",value:function(e){if(v.default.vmMain.panesContainer){if(!e){var t=this._panes.get();e=t[t.length-1]}if(e){var n=e.rect.get();if(n){var r=n.width+(e.isExpanded.get()?n.widthExpanded:0),i=k.a.windowWidth()-(Xh.DesktopUI.getSidebarWidth()-2),a=v.default.vmMain.getScrollOffset(),o=n.left-a,s=n.left+r-a;(o<0||s>i)&&v.default.vmMain.setScrollOffset(n.left+r-i)}}}}},{key:"scrollToAndHighlightItem",value:function(e,t){e.highlight(),this.runForEachPane((function(n){n!==t&&n.type===y.a.PaneMode.Task&&n.isViewOutline()&&n.scrollToMiddle(e)}))}},{key:"_timeoutLoadFailed",value:function(){0===this._panes.length()&&0===Xh.menus.modalStack.length()&&(v.default.reportError(new Error("Pane Load Timeout")),Xh.toasts.pushMessage(y.a.MessageID.PaneLoadTimeout))}},{key:"onRemoteUpdate",value:function(e){var t=this;e.forEach((function(e){if(t.hasPaneById(e.id)){var n=t.getPaneById(e.id);n&&(n.applyItemState(e.itemState),n.updateItemsImmediate())}}))}},{key:"clonePane",value:function(e,t){var n=this.getPaneIndex(e),r=e.getSaveInfoForClone();return t&&(r=Object.assign(r,t)),this.createPaneAtIndex(r.type,n+1,r)}}]),n}(Lo),b()(Co.prototype,"savePaneState",[w.a],Object.getOwnPropertyDescriptor(Co.prototype,"savePaneState"),Co.prototype),Co),No=n(3),jo=n.n(No),Uo=n(10),Bo=n.n(Uo),Vo=n(51),Ho=n(58),Wo=["4.95","49.95","5","49"],qo=k.a.demo,zo=(Ro=function(){function e(){var t=this;a()(this,e),this._premiumStatus=new E.a(y.a.PremiumStatus.Unknown),this.userProperties=new Ho.a,this.appleIAPPurchase=new E.a,qo&&this._premiumStatus.set(y.a.PremiumStatus.Active),this.hasPremiumFeaturesObservable=new P.a([this._premiumStatus],(function(){return t.hasPremiumFeatures()})),this._lastSignupError=-1,this._earlyAdopter=!1,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._pricingSelected=y.a.Pricing.None,this._billingIdentifier=void 0,this._hasValidBillingData=new E.a(!1),this.daysLeftInTrial=new E.a(-1),this.inviteCodeError=new E.a,this.inviteEmailError=new E.a,this.inviteEmailSuccess=new E.a,this.init()}return s()(e,[{key:"init",value:function(){var e=this;this._premiumStatus.listen((function(t,n){e.hasPremiumFeatures()?(Xh.pluginManager.notifyDependencyLoad(y.a.PluginDependency.EarlyAccess),Xh.pluginManager.notifyDependencyLoad(y.a.PluginDependency.PremiumSub)):e.hasEarlyAccess()&&Xh.pluginManager.notifyDependencyLoad(y.a.PluginDependency.EarlyAccess),t!==n&&n&&Xh.DisplaySettings.onSettingChanged()})),qo||Xh.settings.onLoaded((function(){if(e.userProperties.set(Xh.settings.userProperties.get()),e.userProperties.get()){e.updateBillingData(),v.default.shouldLog(y.a.LogLevels.Account)&&v.default.log("Premium Status (Local): ",e.userProperties.get().premiumStatus);var t=G.a.getURLParam("premium");void 0!==t&&G.a.removeURLParam("premium",!0),t&&setTimeout((function(){Xh.menus.openSettings("Account")}),100)}}))}},{key:"setLastSignupError",value:function(e){this._lastSignupError=e}},{key:"_reportRemoteStatusFailure",value:function(){v.default.sendEvent("Billing","RemoteStatusFailure")}},{key:"getBillingIdentifier",value:function(){var e;this._billingIdentifier;return this._billingIdentifier}},{key:"onBillingIdentifierAvailable",value:function(e){}},{key:"onConnected",value:function(e){}},{key:"hasPremium",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.Active||this._premiumStatus.get()===y.a.PremiumStatus.PastDue}},{key:"isTrialState",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.Trial||this._premiumStatus.get()===y.a.PremiumStatus.TrialOver}},{key:"isCanceledState",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===y.a.PremiumStatus.CanceledPastDue}},{key:"canceledUserHasPremiumAccess",value:function(){var e=this.getPremiumEndDate();return this.isCanceledState()&&e&&e.getTime()>Date.now()}},{key:"isInFreeMonthAndPremium",value:function(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts>=100}},{key:"hasSubscription",value:function(){return!!this._subscriptionID||!!this._appleIAP}},{key:"updateBillingData",value:function(){var e,t=this.userProperties.get(),n=t.premiumStatus;this._earlyAdopter=t.earlyAdopter,this._joinDate=t.joinDate?new Date(t.joinDate):new Date,this._premiumStartDate=t.premiumSignupDate?new Date(t.premiumSignupDate):new Date,this._premiumEndDate=t.premiumEndDate?new Date(t.premiumEndDate):void 0,this._premiumCode=t.premiumCode,this._nextBillingDate=t.nextBillingDate?new Date(t.nextBillingDate):void 0,this._trialStart=t.trialStart?new Date(t.trialStart):new Date,this._trialDuration=t.trialDuration||y.a.TrialDuration,this._trialExtended=t.trialExtended||!1,this._subscriptionID=t.subscriptionID,this._appleIAP={plan:t.appleIAPPlan,transactionID:t.appleIAPTransactionId},e=n===y.a.PremiumStatus.CanceledPastDue||n===y.a.PremiumStatus.CanceledUser?-1:Math.round(this._trialDuration-(Date.now()-this._trialStart.getTime())/864e5);try{v.default.PAssert(592,e<=320,"Sanity check on trial length",e)}catch(r){v.default.reportError(r)}this.daysLeftInTrial.set(e),n===y.a.PremiumStatus.Trial&&e<0?(n=y.a.PremiumStatus.TrialOver,Vo.a.updatePremiumStatus(),this.notifyTrialOver()):n===y.a.PremiumStatus.Trial&&e<5&&this.notifyTrialEndSoon(),!qo&&n&&this.setPremiumStatus(n),this._hasValidBillingData.set(!0)}},{key:"setPremiumStatus",value:function(e){if(!qo){try{v.default.PAssert(593,v.default.isNumber(e),"Status must be a valid number",e)}catch(t){v.default.reportError(t)}try{v.default.PAssert(594,e>0&&e<8,"Should be a valid status identifier",e)}catch(t){v.default.reportError(t)}e!==this._premiumStatus.get()&&(this._premiumStatus.set(e),v.default.setDimension(y.a.Analytics.Dimensions.PremiumStatus,e))}}},{key:"hasValidBillingData",value:function(){return this._hasValidBillingData.get()}},{key:"getPremiumStatus",value:function(){return this._premiumStatus.get()}},{key:"getInviteCode",value:function(){return this._inviteCode}},{key:"getJoinDate",value:function(){return this._joinDate||new Date}},{key:"getPremiumStartDate",value:function(){return this._premiumStartDate||new Date}},{key:"getPremiumEndDate",value:function(){return this._premiumEndDate}},{key:"hasTrialExtended",value:function(){return this._trialExtended||!1}},{key:"isEligibleForTrialExtension",value:function(){return!1}},{key:"getNextBillingDate",value:function(){return this._nextBillingDate}},{key:"hasEarlyAccess",value:function(){return this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()}},{key:"cancelSubscription",value:function(e,t){v.default.sendEvent("Billing","SubCancelTapped");var n=function(){t&&v.default.isFunction(t)&&t()};return Xh.menus.confirm("Are you sure you want to cancel your subscription?",(function(e){e?(v.default.sendEvent("Billing","SubCancelYES"),Vo.a.cancelPremium().then((function(e){var t=e.value?"Your premium subscription has been canceled. Please contact support@moo.do if you need assistance.":"There was a server error, please try again in a few minutes or contact support@moo.do.";Xh.menus.alert({text:t}),n()}))):(n(),v.default.sendEvent("Billing","SubCancelNO"))})),!0}},{key:"getCustomPurchaseURL",value:function(){}},{key:"_openPaymentWindow",value:function(e){Xh.menus.openModal(y.a.Modals.Billing,{isUpdate:e})}},{key:"onTapUpdatePaymentMethod",value:function(){this._openPaymentWindow(!0)}},{key:"onTapViewInvoices",value:function(e,t){return Vo.a.listTransactions().then((function(e){if(e&&e.value)try{Xh.menus.openModal(y.a.Modals.Invoices,e.value)}catch(n){v.default.reportError(n)}else Xh.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do."});t()})),!0}},{key:"onTapDeleteAccount",value:function(e,t){return Xh.menus.openModal(y.a.Modals.DeleteAccount,{callback:function(e){e?Vo.a.deleteAccount().then((function(e){e.value?N.a.clearLocalData():Xh.menus.alert({text:"There was a server error. Please try again in a few minutes or contact support@moo.do."}),t()})):t()}}),!0}},{key:"getInviteUrl",value:function(){return"https://www.moo.do/"}},{key:"getSelectText",value:function(){return"Select and press "+k.a.cmdChar+" + C to copy to clipboard"}},{key:"wasInvited",value:function(){return!!this._referredBy}},{key:"sendInviteEmail",value:function(e,t){}},{key:"joinDateText",value:function(){return this.getJoinDate().toString(Xh.International.getFormat(y.a.DFormat.LongStrDate))}},{key:"premiumStartDateText",value:function(){return this.getPremiumStartDate().toString(Xh.International.getFormat(y.a.DFormat.LongStrDate))}},{key:"premiumEndDateText",value:function(){var e=this.getPremiumEndDate();return e?e.toString(Xh.International.getFormat(y.a.DFormat.LongStrDate)):"Never"}},{key:"nextBillingDateText",value:function(){var e=this.getNextBillingDate();return e?e.toString(Xh.International.getFormat(y.a.DFormat.LongStrDate)):"Never"}},{key:"shareTwitter",value:function(){var e="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(e,550,420),v.default.sendEvent("Billing","ShareTwitter")}},{key:"shareFacebook",value:function(){var e="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(e,600,303),v.default.sendEvent("Billing","ShareFacebook")}},{key:"shareGoogle",value:function(){var e="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(e,500,650),v.default.sendEvent("Billing","ShareGoogle")}},{key:"showPopup",value:function(e,t,n){var r=t,i=n,a=window.screen.height,o=window.screen.width,s="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+r+",height="+i+",left="+Math.round(o/2-r/2)+",top="+Math.round(a/2-i/2);window.open(e,null,s)}},{key:"onTapSignupMonth",value:function(){this._pricingSelected=this.getMonthlyPricing(),this._openPaymentWindow(!1),v.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapSignupYear",value:function(){this._pricingSelected=this.getYearlyPricing(),this._openPaymentWindow(!1),v.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapSignupThreeYear",value:function(){this._pricingSelected=this.getThreeYearPricing(),this._openPaymentWindow(!1),v.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapCodeSignup",value:function(){Xh.menus.alert({text:"Redeeming code is not ready yet in the new backend. Please contact support.",callback:function(){Xh.menus.openModal(y.a.Modals.ReportBug)}})}},{key:"getMonthlyPricing",value:function(){return this._earlyAdopter?y.a.Pricing.EarlyMonthly:y.a.Pricing.RegMonthly}},{key:"getYearlyPricing",value:function(){return this._earlyAdopter?y.a.Pricing.EarlyYearly:y.a.Pricing.RegYearly}},{key:"getThreeYearPricing",value:function(){return y.a.Pricing.ThreeYear}},{key:"getMonthlyPrice",value:function(){return Wo[this.getMonthlyPricing()]}},{key:"getYearlyPrice",value:function(){return Wo[this.getYearlyPricing()]}},{key:"getPlanPrice",value:function(e){return Wo[e]}},{key:"notifyTrialOver",value:function(){var e=this;Xh.settings.onLoaded((function(){if(!Xh.settings.notifiedTrialOver.get()){if(!Xh.toasts)return void setTimeout(e.notifyTrialOver.bind(e),0);Xh.toasts.pushMessage(y.a.MessageID.TrialOver),Xh.settings.notifiedTrialOver.set(!0)}}))}},{key:"notifyTrialEndSoon",value:function(){if(!Xh.settings.notifiedTrialEndSoon.get()){if(!Xh.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);Xh.toasts.pushMessage(y.a.MessageID.TrialEndSoon),Xh.settings.notifiedTrialEndSoon.set(!0)}}},{key:"isTrialOver",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.TrialOver||(this._premiumStatus.get()===y.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===y.a.PremiumStatus.CanceledPastDue)&&!this.canceledUserHasPremiumAccess()}},{key:"isTrialPossible",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.Unknown||this._premiumStatus.get()===y.a.PremiumStatus.Never}},{key:"startTrial",value:function(){var e=Bo()(jo.a.mark((function e(){var t;return jo.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:try{v.default.PAssert(599,!this.isTrialOver(),"Should never try to start a trial once it is over")}catch(r){v.default.reportError(r)}return e.next=3,Vo.a.startTrial();case 3:if((t=e.sent).error)if(t.errorCode===y.a.PrivateAPIErrorCodes.TrialOver)Xh.toasts.pushMessage({text:"Your free trial of Premium has ended. Please contact support@moo.do to extend.",actionText:"OKAY"}),this._premiumStatus.set(y.a.PremiumStatus.TrialOver);else{try{v.default.PAssert(600,!1,"Failed to start trial for user")}catch(r){v.default.reportError(r)}Xh.toasts.pushMessage({text:"There was an error starting your trial. Please contact support@moo.do.<br><br>"+t.error,action:y.a.MessageAction.Contact})}case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasPremiumFeatures",value:function(){return this.hasPremium()||this._premiumStatus.get()===y.a.PremiumStatus.Trial||this.canceledUserHasPremiumAccess()}},{key:"getBillingPeriod",value:function(){return this._pricingSelected}},{key:"loadUserProperties",value:function(e){var t=Xh.settings.userProperties.get();t=Object.assign({},t,e),Xh.settings.userProperties.set(t),this.userProperties.set(t),this.updateBillingData()}},{key:"setJoinDate",value:function(e){this.userProperties.setProperty("joinDate",e),Vo.a.setUserProperties({joinDate:e})}},{key:"updateUserProfile",value:function(e){var t=this,n=v.default.removeNullUndefined(e);this.userProperties.onHasValue((function(e){var r=Object.keys(n).filter((function(t){return n[t]&&!e[t]}));if(r.length>0){t.userProperties.set(Object.assign({},e,n));var i={};r.forEach((function(e){return i[e]=n[e]})),Vo.a.setUserProperties(i)}}))}}]),e}(),b()(Ro.prototype,"cancelSubscription",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"cancelSubscription"),Ro.prototype),b()(Ro.prototype,"onTapUpdatePaymentMethod",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"onTapUpdatePaymentMethod"),Ro.prototype),b()(Ro.prototype,"onTapViewInvoices",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"onTapViewInvoices"),Ro.prototype),b()(Ro.prototype,"onTapDeleteAccount",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"onTapDeleteAccount"),Ro.prototype),b()(Ro.prototype,"onTapSignupMonth",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"onTapSignupMonth"),Ro.prototype),b()(Ro.prototype,"onTapSignupYear",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"onTapSignupYear"),Ro.prototype),b()(Ro.prototype,"onTapSignupThreeYear",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"onTapSignupThreeYear"),Ro.prototype),b()(Ro.prototype,"onTapCodeSignup",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"onTapCodeSignup"),Ro.prototype),b()(Ro.prototype,"startTrial",[w.a],Object.getOwnPropertyDescriptor(Ro.prototype,"startTrial"),Ro.prototype),Ro),Go=n(20),Ko=function(){function e(t,n){a()(this,e),this._id=t,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._useInMemoryStore=!n||!n.noInMemoryCache,this._useMetadataInMemoryStore=!n||!n.noMetadataInMemoryCache,this._metadataKeys=n&&n.metadataKeys?n.metadataKeys:[]}return s()(e,[{key:"getStats",value:function(){var e=this;return this.getFilterEntriesSync((function(){return!0})).map((function(t){return{id:e._id,count:t.length,size:JSON.stringify(t).length}}))}},{key:"getState",value:function(){return{isAllLoaded:this._isAllLoaded,storageError:this._storageError}}},{key:"enableLogging",value:function(){this._loggingEnabled=!0}},{key:"disableLogging",value:function(){this._loggingEnabled=!1}},{key:"isLoggingEnabled",value:function(){return this._loggingEnabled}},{key:"usesDiskSpace",value:function(){return this._usesDiskSpace}},{key:"_cacheInMemory",value:function(){return this._useInMemoryStore}},{key:"_cacheMetadataInMemory",value:function(){return this._useMetadataInMemoryStore}},{key:"_hasLoadedAll",value:function(){return this._isAllLoaded}},{key:"getStorageType",value:function(){try{v.default.PAssert(1823,!1,"SubClass must override")}catch(e){v.default.reportError(e)}}},{key:"_setRawInMemoryCache",value:function(e){try{v.default.PAssert(1824,this._cacheInMemory(),"Must be running an in-memory cache")}catch(t){v.default.reportError(t)}this._cache=e}},{key:"_getRawInMemoryCache",value:function(){return this._cacheInMemory()?this._cache:void 0}},{key:"count",value:function(e){e(this._cacheInMemory()?Object.keys(this._cache).length:void 0)}},{key:"size",value:function(e){e(this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0)}},{key:"loadAll",value:function(e){this._isAllLoaded=!0}},{key:"getEntrySync",value:function(e){return this._cacheInMemory()?this._cache[e]:void 0}},{key:"getBoundEntries",value:function(e,t,n,r){try{v.default.PAssert(1825,!r,"In memory query is sync")}catch(o){v.default.reportError(o)}var i;if(this._cacheInMemory())for(var a in i=[],this._cache)this._cache[a][e]>=t&&this._cache[a][e]<=n&&i.push(this._cache[a]);return i}},{key:"getFilterEntriesSync",value:function(e){var t,n=this;return this._cacheInMemory()&&(t=[],Object.keys(this._cache).forEach((function(r){e&&!e(n._cache[r])||t.push(n._cache[r])}))),t}},{key:"removeEntrySync",value:function(e){delete this._cache[e]}},{key:"hasEntrySync",value:function(e){return!!this._cacheInMemory()&&this._cache.hasOwnProperty(e)}},{key:"saveEntrySync",value:function(e){try{v.default.PAssert(1826,e,"Must be saving data")}catch(t){v.default.reportError(t)}try{v.default.PAssert(1827,e&&e.id,"Saved data must have id")}catch(t){v.default.reportError(t)}this.isLoggingEnabled()&&v.default.log("Cache Entry: ",e),this._cacheInMemory()&&e&&(this._cache[e.id]=e)}},{key:"clearCacheSync",value:function(){this._cache={}}},{key:"clearBackingStore",value:function(){try{v.default.PAssert(1828,!1,"SubClass must override")}catch(e){v.default.reportError(e)}}},{key:"dumpData",value:function(e){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)}},{key:"onCacheError",value:function(e){v.default.reportError(e)}}]),e}();function Yo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Qo,Xo=function(e){d()(n,e);var t=Yo(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,e,r)).keyFieldsRN=r.keyFieldsRN,i}return s()(n,[{key:"getPreloadData",value:function(){return Go.a.getTableData(this._id)}},{key:"getMetadata",value:function(e){return Go.a.getValue(this._id+"_"+e)}},{key:"setMetadata",value:function(e,t){Go.a.setValue(this._id+"_"+e,t)}},{key:"removeMetadata",value:function(e){Go.a.deleteValue(this._id+"_"+e)}},{key:"clearMetadata",value:function(){var e=this;this._metadataKeys&&this._metadataKeys.forEach((function(t){return e.removeMetadata(t)}))}},{key:"hasEntry",value:function(){var e=Bo()(jo.a.mark((function e(t){var n;return jo.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getEntry(t);case 2:return n=e.sent,e.abrupt("return",void 0!==n);case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEntry",value:function(){var e=Bo()(jo.a.mark((function e(t,n){var r;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(this._useInMemoryStore&&(r=this.getEntrySync(t)),void 0===r&&(r=Go.a.getTableValue(this._id,t)),void 0!==r){e.next=6;break}return e.next=5,Go.a.tableGet(this._id,t);case 5:r=e.sent;case 6:return r&&n&&(r=v.default.clone(r)),e.abrupt("return",r);case 8:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeEntry",value:function(){var e=Bo()(jo.a.mark((function e(t){var r;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return this._useInMemoryStore?l()(g()(n.prototype),"removeEntrySync",this).call(this,t):(r=Go.a.getTableData(this._id))&&delete r[t],e.abrupt("return",Go.a.tableDelete(this._id,t));case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveEntry",value:function(){var e=Bo()(jo.a.mark((function e(t,r){var i;return jo.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:0,i=Go.a.getTableValue(this._id,t.id),(!i||(r?r(i,t):i!==t&&!v.default.deepEqual(i,t,!0)))&&(this._useInMemoryStore&&l()(g()(n.prototype),"saveEntrySync",this).call(this,t),Go.a.setTableValue(this._id,t.id,t));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){var e=Bo()(jo.a.mark((function e(){return jo.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return this._useInMemoryStore&&l()(g()(n.prototype),"clearCacheSync",this).call(this),e.abrupt("return",Go.a.tableClear(this._id));case 2:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFilterEntries",value:function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Go.a.tableFilter(this._id,t));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ensureTableLoaded",value:function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Go.a.ensureTableLoaded(this._id,t));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Ko);function $o(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Jo,Zo=(Qo=function(e){d()(n,e);var t=$o(n);function n(e,r){var i;if(a()(this,n),r){try{v.default.PAssert(955,!r.noInMemoryCache,"Invalid in-memory cache option")}catch(s){v.default.reportError(s)}try{v.default.PAssert(956,!r.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(s){v.default.reportError(s)}r.noInMemoryCache=!1,r.noMetadataInMemoryCache=!1}if(i=t.call(this,e,r),r?(i.saveTime=isNaN(r.saveTime)?5e3:r.saveTime,r.writeOnUnload&&K.a.listen("onUnload",i.writeCache),r.clearBackingOnLoad&&(i.clearBackingOnLoad=!0,K.a.listen("enterForeground",i.clearBackingStore))):i.saveTime=5e3,i.storageKey="MDC_"+i._id,i._cache=Go.a.getValue(i.storageKey)||{},v.default.isString(i._cache))try{var o=JSON.parse(i._cache);i._cache=o}catch(u){}return i._saveTimeout=void 0,i}return s()(n,[{key:"_onWrite",value:function(e){e||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))}},{key:"writeCache",value:function(){if(Xh.settings.activeUser.get()){var e=this._getRawInMemoryCache();try{Go.a.setValue(this.storageKey,e)}catch(t){v.default.reportError(t)}}}},{key:"getStorageType",value:function(){return y.a.StorageType.LocalStorage}},{key:"removeEntrySync",value:function(e){delete this._cache[e],this._onWrite()}},{key:"getEntrySync",value:function(e){return this._cache[e]}},{key:"saveEntrySync",value:function(e){var t=e.id,n=e.value;void 0===n||null===n?delete this._cache[t]:this._cache[t]=n,this._onWrite()}},{key:"clearCacheSync",value:function(){l()(g()(n.prototype),"clearCacheSync",this).call(this),this._onWrite(!0)}},{key:"clearBackingStore",value:function(){Go.a.deleteValue(this.storageKey)}}]),n}(Ko),b()(Qo.prototype,"writeCache",[w.a],Object.getOwnPropertyDescriptor(Qo.prototype,"writeCache"),Qo.prototype),b()(Qo.prototype,"clearBackingStore",[w.a],Object.getOwnPropertyDescriptor(Qo.prototype,"clearBackingStore"),Qo.prototype),Qo),es=function(){function e(){a()(this,e),this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[]}return s()(e,[{key:"init",value:function(){this._storageReady[y.a.StorageType.InMemory]=!0,this._storageReady[y.a.StorageType.LocalStorage]=!0}},{key:"getInfo",value:function(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}}},{key:"registerLocalCache",value:function(e,t,n){try{v.default.PAssert(610,e,"Must provide a valid cache ID")}catch(i){v.default.reportError(i)}try{v.default.PAssert(611,void 0===this._registeredCaches[e],"Must not have a previously registered cache with the same id")}catch(i){v.default.reportError(i)}var r;switch(t){case y.a.StorageType.InMemory:0;break;case y.a.StorageType.LocalStorage:r=new Zo(e,n);break;case y.a.StorageType.IndexedDB:r=new Xo(e,n)}try{v.default.PAssert(612,r,"Must have valid cache after creation")}catch(i){v.default.reportError(i)}return this._registeredCaches[e]=r,r}},{key:"_notifyIDBReady",value:function(e){}},{key:"notifyMigrationRequired",value:function(){this._migrationRequired=!0}},{key:"needsMigration",value:function(){return this._migrationRequired||1!==Xh.settings.localDataVersion.get()}},{key:"hasReportedQuotaError",value:function(){return this._reportedQuotaError}},{key:"reportQuotaExceeded",value:function(){this._reportedQuotaError||(this._reportedQuotaError=!0,v.default.reportError(new Error("Quota exceeded!")))}}]),e}(),ts=n(35),ns=function(){function e(){a()(this,e)}return s()(e,[{key:"init",value:function(){this.isEnabled=!v.default.isDemoMode(),this.isEnabled&&(this.storage=ts.a.storage())}},{key:"uploadString",value:function(){var e=Bo()(jo.a.mark((function e(t,n){var r=this;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=2;break}return e.abrupt("return",new Promise((function(e,i){var a=r.storage.ref(t).putString(n);a.on("state_changed",(function(e){}),(function(e){i(e)}),(function(){a.snapshot.ref.getDownloadURL().then((function(t){return e(t)}))}))})));case 2:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getString",value:function(){var e=Bo()(jo.a.mark((function e(t){var n,r;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=15;break}return e.next=3,this.storage.ref(t).getDownloadURL();case 3:if(!(n=e.sent)){e.next=15;break}return e.prev=5,e.next=8,fetch(n);case 8:return r=e.sent,e.abrupt("return",r.text());case 12:e.prev=12,e.t0=e.catch(5),v.default.reportError(e.t0);case 15:case"end":return e.stop()}}}),e,this,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),rs=(Jo=function(){function e(t,n,r,i,o,s,u,l,c){a()(this,e),this._id=t,this._remoteID=o,this._type=n;try{v.default.PAssert(959,v.default.isDateValid(r),"Must specify a valid schedule date for deferred task")}catch(d){v.default.reportError(d)}this._scheduleDate=r,this._timeout=void 0,this._data=s,this._cbRun=u,this._cbCancel=l,this._cbPersistRemote=c,this._hasRun=!1,this._isCanceled=i,this._destroyed=!1}return s()(e,[{key:"schedule",value:function(){var e=this;try{v.default.PAssert(960,!this._timeout,"Should not schedule the same task multiple times")}catch(n){v.default.reportError(n)}try{v.default.PAssert(961,!this._hasRun,"Should not schedule a task once it has already run once")}catch(n){v.default.reportError(n)}try{v.default.PAssert(962,!this._isCanceled,"Should not schedule canceled tasks")}catch(n){v.default.reportError(n)}var t=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,t),!this._remoteID&&t>0&&Po.a.onLoaded((function(){try{e._cbPersistRemote(e,e._onPersistedRemote)}catch(t){v.default.reportError(t)}}))}},{key:"_onCanceled",value:function(e){e&&(this._destroyed=!0,Xh.deferredTaskManager._notifyTaskComplete(this._id))}},{key:"_onPersistedRemote",value:function(e,t){e&&(this._remoteID=t,Xh.deferredTaskManager._updateTask(this._id))}},{key:"reschedule",value:function(e){try{v.default.PAssert(963,!this._hasRun,"Should never reschedule a task that has already run")}catch(t){v.default.reportError(t)}try{v.default.PAssert(964,!this._isCanceled,"Should not reschedule canceled tasks")}catch(t){v.default.reportError(t)}try{v.default.PAssert(965,this._timeout,"Must always have already schedule a task that is being rescheduled")}catch(t){v.default.reportError(t)}clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=e,this.schedule()}},{key:"cancel",value:function(){var e=this;try{v.default.PAssert(966,this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled")}catch(t){v.default.reportError(t)}try{v.default.PAssert(967,!this._hasRun,"Should not cancel tasks that have already been run")}catch(t){v.default.reportError(t)}this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&Po.a.onLoaded((function(){try{e._cbCancel(e,e._onCanceled)}catch(t){v.default.reportError(t)}})),Xh.deferredTaskManager._updateTask(this._id)}},{key:"runTask",value:function(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(e){v.default.reportError(e)}Xh.deferredTaskManager._notifyTaskComplete(this._id)}},{key:"getData",value:function(){return this._data}},{key:"getType",value:function(){return this._type}},{key:"getScheduleDate",value:function(){return this._scheduleDate}},{key:"getSaveData",value:function(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}}},{key:"isPersistedRemote",value:function(){return!!this._remoteID}}]),e}(),b()(Jo.prototype,"_onCanceled",[w.a],Object.getOwnPropertyDescriptor(Jo.prototype,"_onCanceled"),Jo.prototype),b()(Jo.prototype,"_onPersistedRemote",[w.a],Object.getOwnPropertyDescriptor(Jo.prototype,"_onPersistedRemote"),Jo.prototype),b()(Jo.prototype,"runTask",[w.a],Object.getOwnPropertyDescriptor(Jo.prototype,"runTask"),Jo.prototype),Jo),is=function(){function e(){a()(this,e),this._registeredTypes={},this._deferredTasks={},this._stats={}}return s()(e,[{key:"init",value:function(){var e=0;this._taskCache=Xh.cacheManager.registerLocalCache("DeferredTasks",y.a.StorageType.LocalStorage);for(var t=this._taskCache.getFilterEntriesSync(),n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[n];this.scheduleTask(r.id,r.type,new Date(r.scheduleDate),r.isCanceled,r.remoteID,r.data,!0)}}},{key:"getLastSyncDate",value:function(){var e=Xh.settings.lastTaskSync.get();try{v.default.PAssert(618,!e||v.default.isString(e),"Must have a valid string sync date")}catch(t){v.default.reportError(t)}return e}},{key:"getStats",value:function(){return{}}},{key:"registerTaskType",value:function(e,t,n,r){try{v.default.PAssert(619,!this._registeredTypes[e],"Must not double register task type")}catch(i){v.default.reportError(i)}try{v.default.PAssert(620,v.default.isFunction(t),"Must register a valid run callback")}catch(i){v.default.reportError(i)}try{v.default.PAssert(621,v.default.isFunction(n),"Must register a valid cancel callback")}catch(i){v.default.reportError(i)}try{v.default.PAssert(622,v.default.isFunction(r),"Must register a valid persist callback")}catch(i){v.default.reportError(i)}this._registeredTypes[e]={cbRun:t,cbCancel:n,cbPersistRemote:r}}},{key:"_notifyTaskComplete",value:function(e){this._removeTask(e)}},{key:"scheduleTask",value:function(e,t,n,r,i,a,o){try{v.default.PAssert(623,e,"Must supply a valid task ID")}catch(c){v.default.reportError(c)}try{v.default.PAssert(624,t,"Must supply a valid task type")}catch(c){v.default.reportError(c)}try{v.default.PAssert(625,v.default.isDateValid(n),"Must always have a valid scheduled date available")}catch(c){v.default.reportError(c)}try{v.default.PAssert(626,this._registeredTypes[t],"Must request a valid registered task type")}catch(c){v.default.reportError(c)}if(this._deferredTasks[e]){var s=this._deferredTasks[e];try{v.default.PAssert(627,s.getType()===t,"Task types must match")}catch(c){v.default.reportError(c)}try{v.default.PAssert(628,s.getScheduleDate().equals(n),"Task schedule dates must match")}catch(c){v.default.reportError(c)}}else{var u=this._registeredTypes[t];if(u){var l=new rs(e,t,n,r,i,a,u.cbRun,u.cbCancel,u.cbPersistRemote);if(this._deferredTasks[e]){v.default.log("Overriding existing task");try{v.default.PAssert(629,this._deferredTasks[e].type===t,"Should only update deferred tasks of the same type")}catch(c){v.default.reportError(c)}}this._addTask(e,l,o),r?l.cancel():l.schedule()}}}},{key:"cancelTask",value:function(e,t){this._deferredTasks[e].cancel()}},{key:"_updateTask",value:function(e){var t=this._deferredTasks[e];this._taskCache.saveEntrySync(t.getSaveData())}},{key:"_addTask",value:function(e,t,n){this._deferredTasks[e]=t,n||this._updateTask(e)}},{key:"_removeTask",value:function(e){this._deferredTasks[e]=void 0,this._taskCache.removeEntrySync(e)}}]),e}(),as=function(){function e(){a()(this,e),this.items=new Y.a}return s()(e,[{key:"addItemEntry",value:function(e,t){this.hasItemEntry(e)||this.items.push({id:e.id,item:e,pane:t})}},{key:"removeItemEntry",value:function(e){var t=this.items.indexOfWithProperty("id",e);if(t>=0)return this.items.splice(t,1)[0]}},{key:"hasItemEntry",value:function(e){return!!this.getItemEntry(e)}},{key:"getItemEntry",value:function(e){var t=this.items.indexOfWithProperty("id",e.id);return this.items.get()[t]}},{key:"getItems",value:function(){return this.items}},{key:"hasItems",value:function(){return this.items.get().length>0}}]),e}(),os=/^<(.*)>$/,ss=/^[^:]+(?=:)/,us=0,ls={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}},cs=function(){function e(t,n){a()(this,e),this._reportError=t,this._assert=n}return s()(e,[{key:"update",value:function(e){var t,n=e.decoded,r=e.resources,i=e.options,a=e.mimeType;return this._assert(r,"Must supply a valid resource lib"),this._assert(i,"Must supply a valid options obj"),"text/plain"===a?t=this._parsePlain(n):"text/html"===a?t=this._parseHTML(n,r,i):this._reportError(new Error("Unknown email mimeType"),"Unknown email mimeType: "+a),t?t.parsed=this._escapeHTMLEntities(t.parsed):t={parsed:void 0,missingResourceData:!0},t}},{key:"getAttachmentLinks",value:function(e){var t=e.decoded,n=e.options,r=[],i=this._createDoc(t);if(i){var a=this._findLinkElements(i),o=this._findQuoteElements(i);try{r=this._findSpecialLinks(a,o,n).attachments}catch(s){this._reportError(s)}}return r}},{key:"generatePlaintext",value:function(e){var t=e.decoded;return this._createDoc(t).body.textContent}},{key:"replaceSignature",value:function(e){var t,n=e.decoded,r=e.newSignature,i=this._createDoc(n),a=this._findActiveSignature(i);if(a){var o=!!a.innerHTML;if(a.innerHTML=r||"",r)o||(a.parentNode.insertBefore(i.createElement("br"),a),a.parentNode.insertBefore(i.createElement("br"),a),a.parentNode.insertBefore(i.createTextNode("--"),a),a.parentNode.insertBefore(i.createElement("br"),a));else{var s=a.previousSibling;if(s&&"BR"===s.nodeName){var u=s.previousSibling;if(u&&3===u.nodeType&&"--"===u.textContent){var l=u.previousSibling;if(l){var c=l.previousSibling;"BR"===l.nodeName&&(l.parentElement.removeChild(l),c&&"BR"===c.nodeName&&c.parentElement.removeChild(c))}s.parentElement.removeChild(s),u.parentElement.removeChild(u)}}}t=i.body.outerHTML}else t=n;return t}},{key:"combineParts",value:function(e){var t=e.partList;this._assert(this._isArray(t)&&t.length>0,"Must always supply a valid part list with contents");var n=this._createDoc("<head></head><body></body>");if(this._assert(n,"Must always be able to create a valid document for first part in list"),n)for(var r=0,i=0;i<t.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=this._ensurePartDoc(t[i]);if(a)try{this._mergeDocs(a,n)}catch(o){this._reportError(o)}}return n?n.body.outerHTML:" "}},{key:"removeElementsByAttribute",value:function(e){var t=e.decoded,n=e.attr,r=e.value;this._assert(this.isString(t),"Must pass in a valid decoded HTML email string"),this._assert(this.isString(n),"Must provide a valid item ID");var i=!1;try{var a=this._createDoc(t);a&&(i=this._removeElementsByAttribute(a,n,r))}catch(o){this._reportError(o)}return i?a.body.outerHTML:t}},{key:"sanitizeContent",value:function(e){var t,n=e.decoded;if(n){var r=this._createDoc(n);try{var i=r.body;this._traverseNode(i,(function(e){e.nodeType===Node.TEXT_NODE?e.textContent=new Array(e.textContent.length+1).join("#"):"A"===e.nodeName&&e.removeAttribute("href")})),t=i.outerHTML}catch(a){this._reportError(a),t="<<SANITIZED>>"}}else t="<<NO HTML CONTENT>>";return t}},{key:"getComposeBody",value:function(e){var t=e.decoded,n=e.resources,r=!1;try{var i=this._createDoc(t);if(i){r=this._removeElementsByAttribute(i,"moodoAttach","true");var a=this._updateResourceImages(i,n);r=r||a.didUpdate}}catch(o){this._reportError(o)}return r?i.body.outerHTML:t}},{key:"parseResourceID",value:function(e){var t;os.lastIndex=0;var n=os.exec(e);return n&&n[1]&&(t=n[1]),t}},{key:"_escapeHTMLEntities",value:function(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,(function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"})).replace(/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,(function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}))}},{key:"_ensurePartDoc",value:function(e){var t;switch(e.mimeType){case"text/plain":t=this._createDoc(this._parsePlain(e.decoded).parsed);break;case"text/html":t=this._createDoc(e.decoded);break;default:this._assert(!1,"Unknown display part mimeType: "+e.mimeType)}return t}},{key:"_hasClass",value:function(e,t){return e.classList.contains(t)}},{key:"_mergeDocs",value:function(e,t){var n=e.body,r=t.body;if(n){var i=t.importNode(n,!0),a=t.createElement("div");try{for(var o=0,s=0;s<i.attributes.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=i.attributes[s];a.setAttribute(u.name,u.value)}}catch(c){this._reportError(c)}try{for(var l=0;i.childNodes&&i.childNodes.length>0;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;a.appendChild(i.firstChild)}}catch(c){this._reportError(c)}try{r.appendChild(a)}catch(c){this._reportError(c)}}}},{key:"_removeElementById",value:function(e,t){var n=!1,r=e.getElementById(t);return r&&(r.parentNode.removeChild(r),n=!0),n}},{key:"_removeElementsByAttribute",value:function(e,t,n){var r,i=0,a=!1;r=void 0!==n&&null!==n?e.querySelectorAll("["+t+'="'+n+'"]'):e.querySelectorAll("["+t+"]");for(var o=0;o<r.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=r[o];s.parentNode.removeChild(s),a=!0}return a}},{key:"_createFragment",value:function(){return{lines:[],isQuote:!1}}},{key:"_createPlainFragments",value:function(e){var t=0,n=[],r=e.split("\n"),i=this._createFragment();n.push(i);for(var a=0;a<r.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=r[a].trim(),s=new RegExp(/^>+/).test(o);i.lines.length>0&&s!==i.isQuote&&""!==o&&(i=this._createFragment(),n.push(i)),i.lines.push(o),i.isQuote=i.isQuote||s}return n}},{key:"_getFragmentText",value:function(e){var t,n,r=0,i="";if(e.isQuote){var a=this._generatePlaceholderID();t='<div id="'+a+'" place="true"></div><p quote="collapsed" group="'+a+'">',n="</p>"}else t="",n="";for(var o=0;o<e.lines.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i+=e.lines[o]+"\n"}return t+i+n}},{key:"_joinPlainFragments",value:function(e){for(var t=0,n="",r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];n+=this._getFragmentText(i)}return n}},{key:"_parsePlain",value:function(e){var t,n=this._escapeHTMLEntities(e),r=this._createPlainFragments(n);try{t=this._joinPlainFragments(r);t=t.replace(/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,'<a mlink="true" href="$1">$1</a>')}catch(i){this._reportError(i),t="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+t+"</body><html>"}}},{key:"_parseHTML",value:function(e,t,n){var r={parsed:void 0},i=this._createDoc(e),a=this._findQuoteElements(i);if(a=this._cleanupDocQuotes(i,a),this._isFullQuote(i,a)||this._collapseAndMarkQuotes(i,a,!!n.collapseQuotes),n.createLinksFromText)try{this._createLinksFromText(i)}catch(d){this._reportError(d)}var o=this._findLinkElements(i);this._markLinks(o);try{r.specialLinks=this._findSpecialLinks(o,a,n)}catch(d){this._reportError(d)}try{r.parsedMetadata=this._parseMetadata(i)}catch(d){this._reportError(d)}try{var s=this._updateResourceImages(i,t);r.missingResourceData=s.missingData}catch(d){this._reportError(d)}if(this._trimTrailingWhitespace(i),this._trimQuoteWhitespace(a),r.parsed=i.body.outerHTML,i.head.childElementCount>0)for(var u=0,l=i.head.getElementsByTagName("style"),c=0;c<l.length;c++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;l[c]&&(r.parsed="<style>".concat(l[c].innerText,"</style>")+r.parsed)}return r}},{key:"_traverseNode",value:function(e,t){if(!1!==t(e)&&e.childNodes)for(var n=0,r=e.childNodes.length-1;r>=0;r--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._traverseNode(e.childNodes[r],t)}}},{key:"_sanitizeInputDoc",value:function(e,t){var n=this,r=ls[t],i=e.body;i&&this._traverseNode(i,(function(e){if(e.nodeType===Node.COMMENT_NODE)n._assert(!e.childNodes||0===e.childNodes.length,"A comment node should never have children"),e.parentNode.removeChild(e);else if(e.nodeType===Node.TEXT_NODE);else if(r.bannedTags.indexOf(e.tagName.toLowerCase())>=0)e.parentNode.removeChild(e);else if(e.attributes.length>0){for(var t=0,i=r.allowedTagAttributes[e.tagName],a=e.attributes.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e.attributes[a].name;if(r.allowedAttributes.indexOf(o)<0&&(!i||i.indexOf(o)<0))e.removeAttribute(o);else{var s=e.getAttribute(o);s&&s.startsWith("javascript:")&&(console.log("Remove Inline JS: ",e.tagName,o),e.removeAttribute(o))}}var u=e.getAttribute("height");u&&u.indexOf("%")>=0&&e.removeAttribute("height")}}))}},{key:"_createDoc",value:function(e){var t,n=new DOMParser;try{if(t=n.parseFromString(e,"text/html")){var r=this._parseJSONLD(t);this._sanitizeInputDoc(t,"Default"),r&&r.length>0&&this._reportMetadata(t,r)}}catch(i){this._reportError(i);try{t=n.parseFromString("Error parsing email message","text/html")}catch(a){this._reportError(a)}}return t}},{key:"_updateResourceImages",value:function(e,t){for(var n=0,r={missingData:!1,didUpdate:!1},i=this._findImageElements(e),a=0;a<i.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[a],s=o.src;if(s.startsWith("cid:")){var u=s.substr(4);if(u){o.setAttribute("cid",u);var l=t[u];if(l&&l.data){var c="data:"+l.mimeType+";base64,"+l.data;o.src=c,r.didUpdate=!0}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",r.didUpdate=!0,l||(r.missingData=!0)}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",r.didUpdate=!0}}return r}},{key:"_findImageElements",value:function(e){return e.querySelectorAll("img")}},{key:"_findLinkElements",value:function(e){return Array.prototype.slice.call(e.querySelectorAll("a"))}},{key:"_sanitizeLink",value:function(e){if(e&&e.hasAttribute("href")){e.setAttribute("mlink","true");var t=e.getAttribute("href");if(t.startsWith("file:"))e.setAttribute("href","");else ss.exec(t)||e.setAttribute("href","https://"+t)}}},{key:"_createLinksFromText",value:function(e){var t=e.body;this._traverseNode(t,(function(t){var n=!0;if(t.nodeType===Node.TEXT_NODE){var r=t.textContent;if(r.indexOf("http")>=0||r.indexOf("www.")>=0){var i=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,a=t.textContent.replace(i,'<a href="$1">$1</a>'),o=e.createElement("div");o.innerHTML=a;var s=o.childNodes?o.childNodes.length:0;if(s>1||1===s&&"A"===o.childNodes[0].nodeName){for(var u=0;o.firstChild;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;t.parentNode.insertBefore(o.firstChild,t)}t.parentNode.removeChild(t)}}}else"A"===t.tagName&&(n=!1);return n}))}},{key:"_markLinks",value:function(e){for(var t=0,n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._sanitizeLink(e[n])}}},{key:"_isAttachmentURL",value:function(e){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(e)}},{key:"_findSpecialLinks",value:function(e,t,n){for(var r=0,i={unsubscribe:[],twitter:[],attachments:[]},a=0;a<e.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=e[a];o.href&&this._isAttachmentURL(o.href)&&(n.ignoreQuotedAttachments&&this._isInsideQuote(o,t)||i.attachments.push({href:o.href,cid:o.id,name:o.innerText,type:"application/octet-stream"}))}return i}},{key:"_parseMetadata",value:function(e){var t=this._parseMicrodata(e);return t&&t.length>0&&this._reportMetadata(e,t),t}},{key:"_reportMetadata",value:function(e,t){}},{key:"_parseJSONLD",value:function(e){for(var t=0,n=[],r=e.getElementsByTagName("script"),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=r[i];if("application/ld+json"===a.getAttribute("type")){var o=a.textContent.trim();if(o)try{var s=JSON.parse(o);n.push(s)}catch(u){this._reportError(new Error("Invalid JSONLD Schema String"),o)}}}return n}},{key:"_parseMicrodata",value:function(e){var t=this,n=e.querySelectorAll("[itemscope]");return Array.prototype.map.call(n,(function(e){if(!e.hasAttribute("itemprop"))return t._parseMicrodataScope(e)})).filter((function(e){return!!e}))}},{key:"_parseMicrodataScope",value:function(e){var t={type:e.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(t,e),t}},{key:"_recurseMicrodataScope",value:function(e,t){for(var n=0,r=t.children,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if(a.hasAttribute("itemprop")){var o,s=a.getAttribute("itemprop");if(a.hasAttribute("itemscope"))o=this._parseMicrodataScope(a);else switch(a.tagName.toLowerCase()){case"a":case"area":case"link":o=a.getAttribute("href");break;case"meta":o=a.getAttribute("content");break;case"img":o=a.getAttribute("src");break;case"data":case"meter":o=a.getAttribute("value");break;case"time":o=a.getAttribute("datetime");break;default:o=a.hasAttribute("content")?a.getAttribute("content"):a.textContent}s&&o&&(e.properties[s]=o)}else this._recurseMicrodataScope(e,a)}}},{key:"_cleanupDocQuotes",value:function(e,t){var n=this;return t.filter((function(e){var t=!1;"BLOCKQUOTE"===e.nodeName&&"cite"===e.getAttribute("type")&&(n.parseResourceID(e.innerText)&&e&&e.parentNode&&(e.parentNode.removeChild(e),t=!0));return!t}))}},{key:"_generatePlaceholderID",value:function(){return"~T"+Date.now()+ ++us}},{key:"_createQuotePlaceholder",value:function(e){var t=e.createElement("div");return t.id=this._generatePlaceholderID(),t.setAttribute("place","true"),t}},{key:"_findFirstSiblingQuote",value:function(e,t){for(var n=0,r=e;r.previousElementSibling&&t.indexOf(r.previousElementSibling)>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r=r.previousElementSibling}return r}},{key:"_markAdjacentQuotes",value:function(e,t,n,r){for(var i=0;e&&n.indexOf(e)>=0;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.setAttribute("quote",r),e.setAttribute("group",t),e=e.nextElementSibling}}},{key:"_collapseAndMarkQuotes",value:function(e,t,n){for(var r=0,i=0;i<t.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=t[i];if(!a.getAttribute("quote")){var o=this._findFirstSiblingQuote(a,t),s=this._createQuotePlaceholder(e),u=0===i&&n?"collapsed":"uncollapsed";this._markAdjacentQuotes(o,s.id,t,u),o.parentNode.insertBefore(s,a)}}}},{key:"_removeQuote",value:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},{key:"_isFullQuote",value:function(e,t){for(var n=0,r=!0,i=e.body,a=0;i.children&&a<i.children.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i.children[a];if(o&&""!==o.textContent.trim()&&t.indexOf(o)<0&&t.indexOf(o.firstElementChild)<0){r=!1;break}}return r}},{key:"_findQuoteElements",value:function(e){var t=this._findGmailQuotes(e),n=this._findOffice365Quotes(e),r=this._findBlockquoteQuotes(e),i=[];return this.pushOnlyUniques(i,t),this.pushOnlyUniques(i,n),this.pushOnlyUniques(i,r),i=this._cleanupGmail(i),i=this._removeEmptyQuotes(i)}},{key:"_cleanupGmail",value:function(e){var t=this;return e.filter((function(n){var r=!1;if("BLOCKQUOTE"===n.nodeName&&t._hasClass(n,"gmail_quote"))for(var i=0,a=0;a<e.length;++a){var o=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var s=n.parentElement;s;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(t._hasClass(s,"gmail_quote")){"DIV"===s.nodeName&&(r=!0);break}s=s.parentElement}}return!r}))}},{key:"_removeEmptyQuotes",value:function(e){return e}},{key:"_findGmailQuotes",value:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_quote"))}},{key:"_findOffice365Quotes",value:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),n=e.getElementById('3D"divRplyFwdMsg"');return n&&t.push(n),t=t.map((function(e){return e.previousElementSibling&&"HR"===e.previousElementSibling.nodeName?e.parentElement:e}))}},{key:"_findBlockquoteQuotes",value:function(e){return Array.prototype.slice.call(e.querySelectorAll("blockquote"))}},{key:"_findGmailSignatures",value:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_signature"))}},{key:"_findActiveSignature",value:function(e){for(var t,n=0,r=this._findGmailSignatures(e),i=this._findQuoteElements(e),a=r.length-1;a>=0&&!t;a--){var o=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var s=r[a],u=!0,l=0;l<i.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(this._isAncestor(s,i[l])){u=!1;break}}u&&(t=s)}return t}},{key:"_isAncestor",value:function(e,t){for(var n=0;e&&e!==t;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e=e.parentElement}return!!e}},{key:"_trimTrailingWhitespace",value:function(e){for(var t=0,n=e.body.childNodes,r=[],i=n.length-1;i>=0;i--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i],o=n[i-1];if(!a||"BR"!==a.nodeName||!o||"BR"!==o.nodeName)break;r.push(a)}this._removeElements(r)}},{key:"_trimQuoteWhitespace",value:function(e){for(var t=0,n=[],r=0;r<e.length;++r){var i=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var a=e[r].previousElementSibling;a;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;"BR"===a.nodeName&&a.previousElementSibling&&"BR"===a.previousElementSibling.nodeName&&n.push(a),a=a.previousElementSibling}}this._removeElements(n)}},{key:"_removeElements",value:function(e){for(var t=0,n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];try{r.parentNode&&r.parentNode.removeChild(r)}catch(i){}}}},{key:"_isInsideQuote",value:function(e,t){for(var n=0;e.parentNode;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t.indexOf(e.parentNode)>=0)return!0;e=e.parentNode}return!1}},{key:"_isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isString",value:function(e){return"string"===typeof e}},{key:"pushOnlyUniques",value:function(e,t,n){var r=0;if(!t)return e;for(var i=0,a=t.length;i<a;++i){var o=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var s=!0,u=0,l=e.length;u<l;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(n&&n(t[i],e[u])||!n&&t[i]===e[u]){s=!1;break}}s&&e.push(t[i])}return e}}]),e}();function ds(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var hs,fs=new(function(e){d()(n,e);var t=ds(n);function n(){var e;return a()(this,n),(e=t.call(this)).helper=new cs(v.default.reportError,v.default.Assert),e}return s()(n,[{key:"update",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r,i){return jo.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.update({decoded:t,resources:n,options:r,mimeType:i}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"getAttachmentLinks",value:function(){var e=Bo()(jo.a.mark((function e(t,n){return jo.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.getAttachmentLinks({decoded:t,options:n}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"generatePlaintext",value:function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.generatePlaintext({decoded:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceSignature",value:function(){var e=Bo()(jo.a.mark((function e(t,n){return jo.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.replaceSignature({decoded:t,newSignature:n}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"combineParts",value:function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.combineParts({partList:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeElementsByAttribute",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.removeElementsByAttribute({decoded:t,attr:n,value:r}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sanitizeContent",value:function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.sanitizeContent({decoded:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getComposeBody",value:function(){var e=Bo()(jo.a.mark((function e(t,n){return jo.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.getComposeBody({decoded:t,resources:n}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(function(){function e(){a()(this,e)}return s()(e,[{key:"sanitizePlaintext",value:function(e){return e?/^\s*$/.test(e)?"":"<<NonHTML-Sanitized: "+e.length+">>":"<<NO CONTENT>>"}}]),e}())),ps=n(80),gs=n(64),vs=(hs=function(){function e(){a()(this,e),this.openOnPane=void 0,this.messageIDs=new Y.a,this.messagesLoaded=new E.a(!1),this.isLoading=new E.a(!1),this.errorMessage=new E.a(""),this.threadAttachObs=new E.a,this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,G.a.binder(this,"onAttachmentUpdate","reset","_onWindowResizeTimeout")}return s()(e,[{key:"init",value:function(){var e=this;Xh.DisplaySettings.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),window.addEventListener("message",(function(t){if(v.default.getLocationOrigin()===t.origin&&t.data&&t.data.startsWith&&t.data.startsWith("-")){var n=t.data.indexOf("-",1),r=t.data.indexOf("-",n+1);r<0&&(r=void 0);var i=t.data.substring(1,n),a=t.data.substring(n+1,r),o=r?t.data.substring(r+1):void 0;v.default.batchRenderUpdates((function(){e.handleFrameMessage(a,i,o,t)}))}})),K.a.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),k.a.windowSize.listen(this._onWindowResize)}},{key:"reset",value:function(e,t){if(this.threadAttach){for(var n=0,r=this.threadAttach.getField("messages"),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i].initializedForDisplay&&this._destroyMessageDisplay(r[i])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(t,!1),this.messagesLoaded.set(!1,!1),this.messageIDs.get().length>0&&this.messageIDs.set([],e)}},{key:"_onWindowResizeTimeout",value:function(){if(this.threadAttach)for(var e=0,t=this.threadAttach.getField("messages"),n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.updateMessageHeight(t[n].id,!0)}}},{key:"_onWindowResize",value:function(){v.default.timeoutOnce("email resize",this._onWindowResizeTimeout,0)}},{key:"getPlugin",value:function(){return this.threadAttach?this.threadAttach.getPlugin():Xh.pluginManager.getPluginGmail()}},{key:"_sendReply",value:function(e,t,n){try{v.default.PAssert(652,e,"Must supply a valid target")}catch(i){v.default.reportError(i)}try{v.default.PAssert(653,t,"Must supply a valid action")}catch(i){v.default.reportError(i)}try{var r="-"+t+(void 0!==n?"-"+n:"");e.postMessage(r,"*")}catch(a){v.default.reportError(a)}}},{key:"handleFrameMessage",value:function(e,t,n,r){var i=this;switch(t){case"resize":try{var a=JSON.parse(n);this.updateMessageHeight(e,!0===a.canBeShorter,a.scale)}catch(f){v.default.reportError(f)}break;case"click":K.a.fireEvent("tapMain",[]);break;case"keypress":try{var o=JSON.parse(n);k.a.normalizeKeys(o),R.a.fireKeyEvent(document.documentElement,o)}catch(f){v.default.reportError(f)}break;case"href":if(n.startsWith("mailto:")){var s=this.parseMailtoURL(n.replace(/^mailto:/gi,"")),u={to:[{email:s.to}],subject:s.subject&&unescape(s.subject),body:s.body&&unescape(s.body).replace(/\r?\n/g,"<br>")};Xh.menus.openComposeEmail(this.getPlugin(),{initData:u})}else Xh.openUrl(n);break;case"epLoaded":this.onMessageLoaded(e);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(e,this.threadAttach,e);break;case"reqResource":try{try{v.default.PAssert(654,r,"Must provide a valid request event")}catch(p){v.default.reportError(p)}if(this.threadAttach)for(var l=0,c=JSON.parse(n),d=function(t){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var n=c[t],a=!1;n.startsWith("attach:")&&(n=n.replace(/^attach:/gi,""),a=!0),i.getPlugin().loadResource(i.threadAttach.id,e,n,function(){var e=Bo()(jo.a.mark((function e(t,n){var o,s,u,l;return jo.a.wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!t){e.next=10;break}if(!a){e.next=8;break}return e.next=4,i._createMessageHTML(i.getPlugin()._decodeEmail(t.data,void 0,{}),{},"text/html");case 4:u=e.sent,s=u.parsed,e.next=9;break;case 8:s=t.data;case 9:o={cid:n,data:s,mimeType:t.mimeType};case 10:try{r&&r.source&&o&&(l=a?"contentLoad":"resLoad",i._sendReply(r.source,l,o?JSON.stringify(o):void 0))}catch(d){v.default.reportError(d)}case 11:case"end":return e.stop()}}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},h=0;h<c.length;++h)d(h)}catch(f){v.default.reportError(f)}break;default:v.default.log("Unknown message from child frame: ",e,t,n,r)}}},{key:"isOpen",value:function(){return this.openOnPane&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnPane",value:function(e){return this.openOnPane===e&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnThread",value:function(e){return this.isOpen()&&this.threadAttach===e}},{key:"close",value:function(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),Xh.supportGmailViews()?(this.threadAttachObs.set(void 0),this.threadAttach=void 0):this.reset(),this.wantsPaneTransition=!1,K.a.fireEvent("EmailPreview","onClosed",[]))}},{key:"setOpenPane",value:function(e,t){this.openOnPane&&this.openOnPane!==e&&this.openOnPane.setExpanded(!1,t),this.openOnPane=e,e&&e.setExpanded(!0,t)}},{key:"_openPane",value:function(e,t){var n=this;try{v.default.PAssert(655,t,"Must supply a valid cb to openPane")}catch(r){v.default.reportError(r)}e!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout((function(){n.wantsPaneTransition=!1,t()}),y.a.EmailOpenTime+100)):t(),this.setOpenPane(e)}},{key:"getPane",value:function(){try{v.default.PAssert(656,this.openOnPane,"Should not be trying to get pane if email preview is not open")}catch(e){v.default.reportError(e)}return this.openOnPane}},{key:"startOpenOnLoad",value:function(e){this.setOpenPane(e,!1)}},{key:"open",value:function(e,t,n,r){var i=this;if(Xh.supportGmailViews())Xh.PaneManager.ensurePaneInView(n),this.threadAttach=t,this._openPane(n,(function(){i.threadAttachObs.set(t)}));else if(t!==this.threadAttach||n!==this.openOnPane){var a=t.getPlugin();this.reset(!0,!0),this.threadAttachLoading=t,Xh.PaneManager.ensurePaneInView(n);var o=2,s=!1;if(r){this.messageIDs.listen((function(){var e=i.getMessages();if(e.length>0)return e[e.length-1].labelIds.indexOf("DRAFT")<0&&i.setLastMessageResponseMode(r),!1}))}var u=function(){0===--o&&t===i.threadAttachLoading&&(s?i._setThread(t,e):i.errorMessage.get()?i.isLoading.set(!1):Xh.menus.alert({text:"Unable to load email messages. You may be offline.",actionText:"OKAY"}))};this._openPane(n,(function(){u()})),a.loadThread(t,(function(e,t,n){s=e,!e&&n?i.errorMessage.set(n):i.errorMessage.set(""),u()}))}else r&&this.isOpen()&&this.setLastMessageResponseMode(r)}},{key:"_getReplyToFromMessage",value:function(e){return this._selfSentMessage(e)?e.to:e.replyTo?[e.replyTo]:[e.from]}},{key:"_getSenderFromMessage",value:function(e){var t=this.threadAttachLoading||this.threadAttach;return this._findSelf(t.getField("accountID"),e)}},{key:"_selfSentMessage",value:function(e){return this.getPlugin().isMyAccountID(e.from.email)}},{key:"_removeSelf",value:function(e){if(e){for(var t=0,n=e.slice(0),r=this.getPlugin(),i=0;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r.isMyAccountID(n[i].email)&&(n.splice(i,1),i--)}return n}}},{key:"_findSelf",value:function(e,t){var n,r=this.getPlugin(),i=r.getSendingAccounts(e);if(i.indexOf(t.from.email)>=0)n=t.from.email;else{if(t.to)for(var a=0,o=0;o<t.to.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i.indexOf(t.to[o].email)>=0){n=t.to[o].email;break}}if(!n&&t.cc)for(var s=0,u=0;u<t.cc.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(i.indexOf(t.cc[u].email)>=0){n=t.cc[u].email;break}}if(!n&&t.bcc)for(var l=0,c=0;c<t.bcc.length;++c){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(i.indexOf(t.bcc[c].email)>=0){n=t.bcc[c].email;break}}}return n||(n=r.getDefaultSendingAccount(e)),{text:r.getDisplayName(n),email:n}}},{key:"_updateDraftFromMessage",value:function(e,t,n){var r,i,a,o,s=this.getPlugin(),u=e.subject,l=this._getSenderFromMessage(e);try{v.default.PAssert(657,n!==y.a.EmailResponseMode.Compose,"Should never pass Compose mode to _updateDraftFromMessage")}catch(d){v.default.reportError(d)}n===y.a.EmailResponseMode.Reply?r=this._getReplyToFromMessage(e):n===y.a.EmailResponseMode.ReplyAll?(r=this._removeSelf(this._getReplyToFromMessage(e).concat(e.to)),i=this._removeSelf(e.cc)):n===y.a.EmailResponseMode.Forward&&(o=Object.assign({},e.resources)),n&&(a=s.createMessageBody(e,t.from.email,n)),r=v.default.arrayUniques(r||[],"email"),i=v.default.arrayUniques(i||[],"email"),n===y.a.EmailResponseMode.Reply||n===y.a.EmailResponseMode.ReplyAll?(0!==u.toLowerCase().indexOf("re")&&(u="Re: "+u),o=t.resources):n===y.a.EmailResponseMode.Forward&&0!==u.toLowerCase().indexOf("fwd")&&(u="Fwd: "+u);var c={id:t.id,to:r,from:l,cc:i,bcc:void 0,subject:u,decoded:a,resources:o||{}};this.getPlugin().updateDraft(this.threadAttach,t.id,t.draftID,c,!0,!1,(function(e){try{v.default.PAssert(658,e,"Should always be able to update a draft")}catch(d){v.default.reportError(d)}}))}},{key:"requestAttachment",value:function(e,t,n,r){this.getPlugin().loadResource(e,t,n,r)}},{key:"getAttachmentURL",value:function(e,t,n){return this.getPlugin().getAttachmentURL(e,t,n)}},{key:"getPreviewURL",value:function(e){return this.getPlugin().getPreviewURL(e)}},{key:"reportMessage",value:function(e,t,n,r,i){this.getPlugin().reportMessage(e,t,n,r,i)}},{key:"dumpMessage",value:function(e,t,n){try{v.default.PAssert(659,!1,"Should not be dumping message in non-__DEV__ modes")}catch(r){v.default.reportError(r)}this.getPlugin().dumpMessage(e,t,n)}},{key:"parseMailtoURL",value:function(e){var t={to:void 0,subject:void 0,body:void 0},n=e.split("?");if(t.to=n[0],n[1])for(var r=0,i=n[1].split("&"),a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i[a].split("=");switch(o[0].toUpperCase()){case"SUBJECT":t.subject=o[1];break;case"BODY":t.body=o[1]}}return t}},{key:"parseListUnsubscribe",value:function(e){for(var t=0,n={emailData:void 0,url:void 0},r=e.split(","),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=/^<?(http|https|mailto):([^<>]*)>?/gi.exec(r[i]);if(a)switch(a[1]){case"http":case"https":n.url=a[1]+":"+a[2];break;case"mailto":n.emailData=this.parseMailtoURL(a[2]);break;default:try{v.default.PAssert(660,!1,"Unknown List Unsubscribe Format: "+e)}catch(o){v.default.reportError(o)}}}return n}},{key:"setMessageResponseMode",value:function(e,t){var n=this.getMessages(),r=n[n.indexOfWithProperty("id",e)];try{v.default.PAssert(661,r,"Must be able to find a valid reply message to update response mode for")}catch(o){v.default.reportError(o)}if(r){var i,a=this.getPlugin();if(t!==y.a.EmailResponseMode.None){try{v.default.PAssert(662,r.initializedForDisplay,"Must be initialized for display to set response mode")}catch(o){v.default.reportError(o)}i=a.getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,e,this._getSenderFromMessage(r)),this._updateDraftFromMessage(r,i,t)}r.responseMode&&r.responseMode.set(t)}}},{key:"setLastMessageResponseMode",value:function(e){if(e){var t=this.getMessages(),n=t[t.length-1];try{v.default.PAssert(663,n,"Setting message response mode when there are no messages")}catch(r){v.default.reportError(r)}n&&this.setMessageResponseMode(n.id,e)}}},{key:"_createErrorHTML",value:function(){var e=Bo()(jo.a.mark((function e(){return jo.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",fs.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_createMessageHTML",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r,i){var a,o;return jo.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(a={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0},i)for(o in i)i.hasOwnProperty(o)&&(a[o]=i[o]);return e.abrupt("return",fs.update(t,n,a,r));case 3:case"end":return e.stop()}}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_generateCSS",value:function(){if(!this._cachedCSS){var e={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};Xh.DisplaySettings.isDark()&&(e.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",e.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var t="";Object.keys(e).forEach((function(n){t+=n+"{",Object.keys(e[n]).forEach((function(r){var i=e[n][r];t+=r+":"+i+";"})),t+="}"})),this._cachedCSS="<style>"+t+"</style>"}return this._cachedCSS}},{key:"_createFrameBlob",value:function(e,t,n){var r={isApp:k.a.app},i=this._generateCSS(),a="<script>("+ms+')("'+n+'",'+JSON.stringify(r)+");<\/script>",o="<!DOCTYPE html>";return t='<meta http-equiv="Content-Type" content="'+t+'">',k.a.supportBlobURLIFrame?new Blob([o,"<html>","<head>",t,i,a,"</head>",e,"</html>"],{type:"text/html"}):[o,"<html>","<head>",t,i,a,"</head>",e,"</html>"].join("")}},{key:"onMessageLoaded",value:function(e){this.updateMessageHeight(e),this.messagesLoaded.set(!0)}},{key:"getPreviewIFrame",value:function(e){return document.getElementById("emailPreview_"+e)}},{key:"updateMessageHeight",value:function(e,t,n){var r=this.getPreviewIFrame(e);if(r){var i=this.getMessages(),a=i[i.indexOfWithProperty("id",e)];t&&(r.style.height="0px");try{var o=r.contentDocument.documentElement;if(o){var s=n||a.defaultScale.get(),u=Math.ceil(o.scrollWidth*s),l=Math.ceil(o.scrollHeight*s);t&&l===a.height.get()&&(r.style.height=l+"px"),a.width.set(u),a.height.set(l),n&&a.defaultScale.get()!==n&&a.defaultScale.set(n)}}catch(c){v.default.reportError(c)}}}},{key:"_generateAltParts",value:function(e,t){var n=this.getPlugin().getMessageAttachments(t);if(n)for(var r=0,i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n[i];"application/ics"===a.mimeType&&this.getPlugin().loadResource(e.id,t.id,a.cid,(function(e){if(e){var t=ps.a.parseICS(v.default.b64_to_utf8(e.data));v.default.log("Parsed ICS Data: ",t)}}))}}},{key:"_computeResponseMode",value:function(e){var t=y.a.EmailResponseMode.None;return e&&e.labelIds.indexOf("DRAFT")>=0&&(t=e.subject.startsWith("Fwd:")?y.a.EmailResponseMode.Forward:e.subject.startsWith("Re:")?1===e.to.length?y.a.EmailResponseMode.Reply:y.a.EmailResponseMode.ReplyAll:y.a.EmailResponseMode.Compose),t}},{key:"_createMessageDisplay",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r,i){var a,o;return jo.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:try{v.default.PAssert(664,!n.initializedForDisplay,"Should only initialize message for display once")}catch(u){v.default.reportError(u)}try{v.default.PAssert(665,n.to,"Must have a valid to object")}catch(u){v.default.reportError(u)}try{v.default.PAssert(666,n.from,"Mus have a valid from object")}catch(u){v.default.reportError(u)}if(a=!0,!n.decoded){e.next=12;break}return n.isErrorMessage=!1,e.next=8,this._createMessageHTML(n.decoded,n.resources,n.mimeType,i);case 8:(o=e.sent).missingResourceData&&(a=!1),e.next=17;break;case 12:return v.default.reportError(new Error("Missing message decoded data"),"Missing message decoded data: "+v.default.isString(n.decoded)),n.isErrorMessage=!0,e.next=16,this._createErrorHTML();case 16:o=e.sent;case 17:0;try{v.default.PAssert(667,o.parsed,"Must have valid parsed data")}catch(u){v.default.reportError(u)}return n.blob=this._createFrameBlob(o.parsed,n.contentType,n.id),v.default.isString(n.blob)||(n.blobURL&&(k.a.URL.revokeObjectURL(n.blobURL),n.blobURL=void 0),n.blobURL=k.a.URL.createObjectURL(n.blob)),n.specialLinks=o.specialLinks,n.width||(n.width=new E.a(0)),n.height||(n.height=new E.a(0)),n.defaultScale||(n.defaultScale=new E.a(1)),n.responseMode||(n.responseMode=new E.a(this._computeResponseMode(r))),n.initializedForDisplay=!0,a||this.getPlugin().reportMessage(t.getField("accountID"),t.id,n.id,"Error creating display",!1),e.abrupt("return",n);case 29:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_destroyMessageDisplay",value:function(e){try{v.default.PAssert(668,e.initializedForDisplay,"Message must first be initialized before being destroyed")}catch(t){v.default.reportError(t)}e.initializedForDisplay=!1,e.isErrorMessage=!1,e.width=void 0,e.height=void 0,e.defaultScale=void 0,e.responseMode&&(e.responseMode=void 0),e.specialLinks=void 0,e.blob=void 0,e.blobURL&&(k.a.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0)}},{key:"ensureDisplayMessages",value:function(){var e=Bo()(jo.a.mark((function e(t){var n,r=this;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(t!==this.threadAttach){e.next=11;break}return e.prev=1,n=this.getMessages(),e.next=5,Promise.all(n.map((function(e,i){if(!t.getPlugin().isMessageDraft(e)&&!e.initializedForDisplay){try{r._generateAltParts(t,e)}catch(a){v.default.reportError(a)}return r._createMessageDisplay(t,e,n[i+1],0===i?{collapseQuotes:!1}:void 0)}})));case 5:n.equals(this.messageIDs.get())||this.messageIDs.set(n.map((function(e){return e.id}))),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),v.default.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMessages",value:function(){return this.threadAttach&&this.threadAttach.getField("messages")||[]}},{key:"_requestMessageReload",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){var i=this;return jo.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:n.getPlugin().forceReloadMessage(n,r,function(){var e=Bo()(jo.a.mark((function e(a){var o,s,u,l,c;return jo.a.wrap((function(e){for(var d=0,h=0;;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:try{v.default.PAssert(669,a,"Must be able to re-load message data")}catch(f){v.default.reportError(f)}if(n!==i.threadAttach){e.next=12;break}if(o=n.getField("messages"),s=o.indexOfWithProperty("id",r),!(u=o[s])){e.next=12;break}if(!(l=i.getPreviewIFrame(t))){e.next=12;break}return u.initializedForDisplay=!1,e.next=11,i.ensureDisplayMessages(n);case 11:k.a.supportBlobURLIFrame?l.src=u.blobURL:((c=l.contentWindow.document).documentElement.innerHTML="",c.open(),c.write(u.blob),c.close());case 12:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onAttachmentUpdate",value:function(e,t,n){var r=this;(!t||t.indexOf("messages")>=0)&&setTimeout((function(){e.getPlugin().loadThread(e,(function(t,n){try{v.default.PAssert(670,t,"Must be able to re-load thread data")}catch(i){v.default.reportError(i)}n&&e===r.threadAttach&&r.ensureDisplayMessages(e)}))}),0)}},{key:"getThreadAttach",value:function(){return this.threadAttach}},{key:"_setThread",value:function(){var e=Bo()(jo.a.mark((function e(t,n){var r;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:try{v.default.PAssert(671,t.hasField("messages"),"Must supply valid messages to the email preview")}catch(a){v.default.reportError(a)}try{v.default.PAssert(672,t.getPlugin().shouldUseNewPlugin(t)||this.errorMessage.get()||t.getField("dataLoaded"),"Must have loaded remote data or have an error")}catch(a){v.default.reportError(a)}if(this.threadAttach&&this.threadAttach.id===t.id){e.next=12;break}return this.reset(),this.threadAttach=t,this.threadItem=n,t.subscribe(this),e.next=9,this.ensureDisplayMessages(t);case 9:(r=t.getPlugin()).attachmentHasLabelByID(t,"UNREAD")&&r.performAction(y.a.PluginAction.Gmail.MarkRead,!0,t),K.a.fireEvent("EmailPreview","openThreadChanged",[]);case 12:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onSelectedIndexChanged",value:function(e,t,n){this.isOpen()&&t===this.openOnPane&&(n&&n.hasAttachmentType(y.a.PluginType.Email)?n.getAttachmentByType(y.a.PluginType.Email).getPlugin()===this.getPlugin()&&this.getPlugin().openEmailByItem(n,t):"PaneGmail"===t.type&&this.reset())}},{key:"onDisplaySettingsChanged",value:function(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}}]),e}(),b()(hs.prototype,"_onWindowResize",[w.a],Object.getOwnPropertyDescriptor(hs.prototype,"_onWindowResize"),hs.prototype),hs);var ms=function(e,t){!function(){function n(e){console.log("ERROR: ",e)}var r,i=window.InjectedJS={postMessage:function(t,r){try{var i;if(void 0!==r)if("string"===typeof r)i=r;else try{i=JSON.stringify(r)}catch(a){n(a),i=""}else i="";window.parent.postMessage("-"+t+"-"+e+"-"+i,"*")}catch(a){n(a)}}};r=function(e){var n=1;t.isAndroid&&(n=function(e){var t=document.documentElement.clientWidth/e;return Math.max(t,.25)}(document.documentElement.scrollWidth))<1&&(document.documentElement.style.transform="scale("+n+")"),i.postMessage("resize",{canBeShorter:e,scale:n})};var a=!1;function o(){document.removeEventListener("DOMContentLoaded",o,!1),a?r():(a=!0,function(){var e=0,t=0,n=0;document.documentElement.addEventListener("click",(function(e){i.postMessage("click")})),document.addEventListener("keydown",(function(e){var t={type:e.type,keyCode:e.keyCode,charCode:e.charCode,which:e.which,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey};i.postMessage("keypress",t)}),!0);for(var a=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=this.getAttribute("href");return t.startsWith("attach:")?i.postMessage("reqResource",[t]):t.startsWith("moodoAction:")?i.postMessage(t.replace(/^moodoAction:/gi,"")):i.postMessage("href",t),!1},o=document.querySelectorAll("[mlink]"),s=0;s<o.length;++s){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;o[s].addEventListener("click",a)}for(var u=document.querySelectorAll("[place]"),l=0;l<u.length;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;u[l].addEventListener("click",(function(e){for(var t=0,n=this.id,i=this.nextElementSibling,a=!1;i&&i.getAttribute("group")===n;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o="collapsed"===i.getAttribute("quote")?"uncollapsed":"collapsed";"collapsed"===o&&(a=!0),i.setAttribute("quote",o),i=i.nextElementSibling}return setTimeout((function(){r(a)}),0),e.stopImmediatePropagation(),e.preventDefault(),!1}))}for(var c=[],d=document.querySelectorAll("img"),h=0;h<d.length;++h){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var f=d[h].getAttribute("cid");f&&c.push(f),d[h].addEventListener("load",(function(){r()}))}c.length>0&&i.postMessage("reqResource",c)}(),i.postMessage("epLoaded"))}window.addEventListener("message",(function(e){if(e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),i=e.data.substring(1,t),a=e.data.substring(t+1);switch(i){case"resLoad":try{if(a)for(var o=0,s=JSON.parse(a),u=document.querySelectorAll('[cid="'+s.cid+'"]'),l="data:"+s.mimeType+";base64,"+s.data,c=0;c<u.length;++c){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;u[c].src=l}}catch(h){n(h)}break;case"contentLoad":try{if(a){var d=JSON.parse(a);document.open(),document.write(d.data),document.close(),setTimeout(r,0)}}catch(h){n(h)}break;default:n(new Error("Unknown PreviewFrame message: "+i))}}})),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(o):(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1))}()}.toString(),ys=vs,_s=n(22),bs=function(){function e(){a()(this,e),this._localized=[],this._loadedDateFormat=void 0}return s()(e,[{key:"init",value:function(){var e=this,t=Xh.settings.dateFormat.get()||y.a.DateFormat.MDY;this._loadLocalized(t),Xh.settings.dateFormat.listen((function(t){e._loadLocalized(t||y.a.DateFormat.MDY),N.a.parseAll(y.a.ChangeType.Auto),Xh.PaneUpdateBatcher.updateAllItems(!1,!0)}))}},{key:"parseDate",value:function(e,t){return Date.parse(this.normalizeDateString(e,t))}},{key:"parseDateDefaultFormat",value:function(e){return Date.parse(this.normalizeDateString(e,this.getCurrentDateFormat()))}},{key:"getFormat",value:function(e){try{v.default.PAssert(694,this._localized[e],"Invalid format request")}catch(t){v.default.reportError(t)}return this._localized[e]}},{key:"getCurrentDateFormat",value:function(){return this._loadedDateFormat||y.a.DateFormat.MDY}},{key:"_loadLocalized",value:function(e){if(this._loadedDateFormat=e,this._localized[y.a.DFormat.LongDayTime]="dddd h:mm tt",this._localized[y.a.DFormat.ShortTime]="h:mm tt",this._localized[y.a.DFormat.MonthDay]="MMM d",this._localized[y.a.DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[y.a.DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[y.a.DFormat.MonthDayLong]="MMMM d",this._localized[y.a.DFormat.MonthDayYearLong]="MMMM d, yyyy",e===y.a.DateFormat.MDY)this._localized[y.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[y.a.DFormat.ShortDate]="MM/dd",this._localized[y.a.DFormat.MonthDayYear]="MM/dd/yy",this._localized[y.a.DFormat.MonthDayYearShort]="M/d/yy",this._localized[y.a.DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd M/d",this._localized[y.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="M/d";else if(e===y.a.DateFormat.DMY)this._localized[y.a.DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[y.a.DFormat.ShortDate]="dd/MM",this._localized[y.a.DFormat.MonthDayYear]="dd/MM/yy",this._localized[y.a.DFormat.MonthDayYearShort]="d/M/yy",this._localized[y.a.DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd d/M",this._localized[y.a.DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="d/M";else if(e===y.a.DateFormat.DMYDot)this._localized[y.a.DFormat.ShortDayTime]="dd.MM h:mm tt",this._localized[y.a.DFormat.ShortDate]="dd.MM",this._localized[y.a.DFormat.MonthDayYear]="dd.MM.yy",this._localized[y.a.DFormat.MonthDayYearShort]="d.M.yy",this._localized[y.a.DFormat.DayYearTime]="dd.MM.yy h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd d.M",this._localized[y.a.DFormat.NoPadShortDayTime]="dd.M h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="d.M";else if(e===y.a.DateFormat.YMD)this._localized[y.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[y.a.DFormat.ShortDate]="MM/dd",this._localized[y.a.DFormat.MonthDayYear]="yy/MM/dd",this._localized[y.a.DFormat.MonthDayYearShort]="yy/M/d",this._localized[y.a.DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd M/d",this._localized[y.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="M/d";else if(e===y.a.DateFormat.YMDDot)this._localized[y.a.DFormat.ShortDayTime]="MM.dd h:mm tt",this._localized[y.a.DFormat.ShortDate]="MM.dd",this._localized[y.a.DFormat.MonthDayYear]="yy.MM.dd",this._localized[y.a.DFormat.MonthDayYearShort]="yy.M.d",this._localized[y.a.DFormat.DayYearTime]="yy.MM.dd h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd M.d",this._localized[y.a.DFormat.NoPadShortDayTime]="M.dd h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="M.d";else try{v.default.PAssert(695,!1,"Unsupport date format requested: "+e)}catch(t){v.default.reportError(t)}}},{key:"formatDate",value:function(e,t,n){try{v.default.PAssert(696,v.default.isDateValid(e),"Must provide a valid date to format")}catch(a){v.default.reportError(a)}try{v.default.PAssert(697,t,"Must provide a valid format for the date")}catch(a){v.default.reportError(a)}var r;if(v.default.isDateValid(e)){var i=e.toString(this.getFormat(t));r=n&&n!==this._loadedDateFormat?this.convertDateFormat(i,this._loadedDateFormat,n):i}return r}},{key:"_isParsedDateValid",value:function(e,t,n){var r=!0,i=v.default.parseInt(e),a=v.default.parseInt(t),o=v.default.parseInt(n);return(void 0!==e&&i<13||a<=0||a>12||o<=0||o>31)&&(r=!1),r}},{key:"_detectDelim",value:function(e){var t="/";return e.indexOf("-")>=0?t="-":e.indexOf(".")>=0&&(t="."),t}},{key:"convertDateFormat",value:function(e,t,n){try{v.default.PAssert(698,t,"Must provide a date format to convert from")}catch(h){v.default.reportError(h)}try{v.default.PAssert(699,n,"Must provide a date format to convert to")}catch(h){v.default.reportError(h)}var r=e;if(t!==n){var i,a,o=0;for(ks.lastIndex=0,ws.lastIndex=0,i=t===y.a.DateFormat.YMD||t===y.a.DateFormat.YMDDot?ks:ws;null!==(a=i.exec(r));){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var s,u,l,c,d=this._detectDelim(r);if(t===y.a.DateFormat.DMYDot?t=y.a.DateFormat.DMY:t===y.a.DateFormat.YMDDot&&(t=y.a.DateFormat.YMD),n===y.a.DateFormat.MDY)switch(t){case y.a.DateFormat.DMY:a[4]?(u=a[4],s=(l=a[3])+d+(c=a[2])+d+u):a[2]&&a[3]&&(s=(l=a[3])+d+(c=a[2]));break;case y.a.DateFormat.YMD:a[2]?(u=a[2],s=(l=a[3])+d+(c=a[4])+d+u):a[3]&&a[4]&&(s=(l=a[3])+d+(c=a[4]));break;default:try{v.default.PAssert(700,!1,"Invalid date format requested from MDY: ",t)}catch(h){v.default.reportError(h)}}else if(n===y.a.DateFormat.DMY)switch(t){case y.a.DateFormat.MDY:a[4]?(u=a[4],l=a[2],s=(c=a[3])+d+l+d+u):a[2]&&a[3]&&(l=a[2],s=(c=a[3])+d+l);break;case y.a.DateFormat.YMD:a[2]?(u=a[2],l=a[3],s=(c=a[4])+d+l+d+u):a[3]&&a[4]&&(l=a[3],s=(c=a[4])+d+l);break;default:try{v.default.PAssert(701,!1,"Invalid date format requested from DMY: ",t)}catch(h){v.default.reportError(h)}}else if(n===y.a.DateFormat.YMD)switch(t){case y.a.DateFormat.MDY:a[4]?s=(u=a[4])+d+(l=a[2])+d+(c=a[3]):a[2]&&a[3]&&(s=(l=a[2])+d+(c=a[3]));break;case y.a.DateFormat.DMY:a[4]?s=(u=a[4])+d+(l=a[3])+d+(c=a[2]):a[2]&&a[3]&&(s=(l=a[3])+d+(c=a[2]));break;default:try{v.default.PAssert(702,!1,"Invalid date format requested from YMD: ",t)}catch(h){v.default.reportError(h)}}else try{v.default.PAssert(703,!1,"Invalid date format requested: ",n)}catch(h){v.default.reportError(h)}s&&this._isParsedDateValid(u,l,c)&&(r=r.substr(0,a.index)+a[1]+s+r.substr(a.index+a[0].length))}}return r}},{key:"normalizeDateString",value:function(e,t){var n=e;return this.convertDateFormat(n,t,y.a.DateFormat.MDY)}},{key:"getAppendDateText",value:function(e,t,n){var r,i=_s.a.getToday();r=e<i||e.getFullYear()!==i.getFullYear()?this.getFormat(y.a.DFormat.MonthDayYearShort):this.getFormat(y.a.DFormat.MonthDayShort);var a=e.toString(r);if(t instanceof Date)r=0===t.getMinutes()?" htt":" h:mmtt",a+=t.toString(r);else if(v.default.isNumber(t)){var o=Math.floor(t),s=o%12;0===s&&(s=12),a+=" "+s+":"+v.default.pad2(60*(t-o))+(o>11?"pm":"am")}return isNaN(n)||(a+=" "+v.default.round(n,2)+"hr"),a}}]),e}(),ws=/([\s]|^)(\d{1,2})[-/.](\d{1,2})(?:[-/.](\d{2,4}))?/g,ks=/([\s]|^)(?:(\d{2,4})[-/.])?(\d{1,2})(?:[-/.](\d{1,2}))/g,Ss=bs;function Es(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Ps=n(43),Is=n(54),Ds=n(25);function Ts(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var xs=n(38),Cs=n(53),As=n(52);function Ls(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Os,Ms=n(67),Rs=new Date(9e12),Fs=y.a.VMLIFlag,Ns=(Os=function(){function e(t,n){a()(this,e),G.a.binder(this,"sizeInPane","onInsertLink"),"dragScroll"in this&&G.a.binder(this,"dragScroll"),this.__ISVMLI=!0,this.isInitialized=!1;try{v.default.PAssert(1835,n,"Each VMLI must be given a set of additional info")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1836,v.default.isValidChangeType(n.changeType),"Must specify a valid change type when creating a VMLI")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1837,n.store,"Must supply a valid itemStore for each VMLI")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1838,!n.parent||n.parent._store===n.store,"All VMLIs in a tree must share the same owner")}catch(i){v.default.reportError(i)}this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1;try{v.default.PAssert(1839,void 0===t.v,"We should never be passing in 'v'")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1840,void 0===t.extern,"We should never be passing in 'extern'")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1841,n.store,"Must specify a valid item store this item belongs to")}catch(i){v.default.reportError(i)}this._store=n.store,this._parent=n.parent,this._documentOwner=n.documentOwner,this._rawText=t.text||"",this._searchText=t.text?t.text.toLowerCase():"",this._parsedText=void 0,this._notePreviewText=void 0,this.elsNew=void 0,this.id=void 0,this.index=t.index,this.regexpFlags=t.regexpFlags,this._isArchived=t.isArchived||!1,this.items=new Y.a([],this.itemsHasMutated),this._note=new E.a,this.itemChanged=new Q.a,this._demandLoadChildren=t.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=n.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._attachments=void 0,this.draggedInPane=new E.a;var r=t.flags;t.isNote&&(r|=y.a.VMLIFlag.Note),t.isComplete&&(r|=y.a.VMLIFlag.Complete),t.isStarred&&(r|=y.a.VMLIFlag.Starred),t.priority&&(r|=t.priority),this._cachedFlagProps={},this.flags=new E.a(r),this._updateCachedFlagProps(r),this.prefix=void 0,this._favorites=void 0,this.dateCreated=t.dateCreated?new Date(t.dateCreated):new Date,this.dateCompleted=t.dateCompleted?new Date(t.dateCompleted):void 0,this.dateModified=t.dateModified?new Date(t.dateModified):this.dateCreated,this._activeTags=void 0,this.isRoot=t.isRoot||n.isRoot,this._isDeleted=t.isDeleted||!1,this.highlightTimeout=void 0,this._version=y.a.UninitializedVersion,this._versionText=y.a.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new E.a(n.isEditable||!1),this.levelsDeep=new E.a(this._parent?this._parent.levelsDeep.get()+1:0),this.isHighlighted=new E.a,v.default.totalItems++,t.isArchived&&v.default.totalArchivedItems++,this._needsParse=!1,this.isLoaded=void 0,this.init(t,n),this.isInitialized=!0}return s()(e,[{key:"getReactKey",value:function(){return this._store.id+this.id}},{key:"notifyDemandLoadUpdate",value:function(e,t){e&&!this._loadedOnDemandData&&(t.requestDemandLoadData(this),this.notifyLoadedData())}},{key:"notifyLoadedData",value:function(){this._loadedOnDemandData=!0}},{key:"notifyLoadDataFailed",value:function(e){this.setCollapsed(!1,e,!1),this._loadedOnDemandData=!1}},{key:"isDemandLoad",value:function(){return this._demandLoadChildren}},{key:"isDemandNotYetLoaded",value:function(){return this._demandLoadChildren&&!this._loadedOnDemandData}},{key:"showInOverview",value:function(){return this.numItems()>0||this._demandLoadChildren}},{key:"paginationTokenInUse",value:function(){try{v.default.PAssert(1842,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){v.default.reportError(e)}return this._paginationToken.isInUse()}},{key:"hasPaginationToken",value:function(){return!!(this.flags.get()&y.a.VMLIFlag.HasPageToken)}},{key:"needsPaginationToken",value:function(){return!this.hasPaginationToken()&&!this._paginationToken}},{key:"setPaginationToken",value:function(e){try{v.default.PAssert(1843,e,"Should never be setting an undefined token - use clear instead")}catch(t){v.default.reportError(t)}try{v.default.PAssert(1844,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(t){v.default.reportError(t)}this._paginationToken=e,this.setFlags(this.flags.get()|y.a.VMLIFlag.HasPageToken)}},{key:"clearPaginationToken",value:function(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0,this.setFlags(this.flags.get()&~y.a.VMLIFlag.HasPageToken)}},{key:"beginDataPageLoad",value:function(){try{v.default.PAssert(1846,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){v.default.reportError(e)}try{v.default.PAssert(1847,!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load")}catch(e){v.default.reportError(e)}return this._paginationToken.notifyBeginUse(),this._paginationToken}},{key:"endDataPageLoad",value:function(e){try{v.default.PAssert(1849,this._paginationToken,"Should always have a valid pagination token when done loading a data page")}catch(t){v.default.reportError(t)}try{v.default.PAssert(1850,this._paginationToken.isInUse(),"Token should always be in use when running a request")}catch(t){v.default.reportError(t)}e?this._paginationToken.notifyEndUse():this.setFlags(this.flags.get()&~y.a.VMLIFlag.HasPageToken)}},{key:"canHaveNote",value:function(){var e=this.belongsToItemStore(Xh.itemStoreManager.getDefaultItemStore()),t=this.belongsToItemStore(Xh.itemStoreManager.getTempItemStore());return e||t}},{key:"createNote",value:function(){try{v.default.PAssert(1851,!this.isNote(),"Should never create a note on a note item")}catch(t){v.default.reportError(t)}var e;return this.hasNote()?e=this.getNote():(e=this._store.createItemRaw({id:void 0,text:"",isNote:!0},{parent:this,documentOwner:this._documentOwner,changeType:y.a.ChangeType.AllLocal}),this.setNote(e,y.a.ChangeType.Local)),e}},{key:"hasNote",value:function(){return void 0!==this._note.get()}},{key:"getNote",value:function(){try{v.default.PAssert(1852,this.hasNote(),"Must have a note to get one")}catch(e){v.default.reportError(e)}return this._note.get()}},{key:"getNoteIfExists",value:function(){return this._note.get()}},{key:"setNote",value:function(t,n){try{v.default.PAssert(1853,v.default.isValidChangeType(n),"Must supply a valid changeType")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1854,!t||this.belongsToSameItemStore(t),"Note must belong to the same item store")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1855,!this.isNote(),"Should never set a note on a note")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1856,!this._note.get()||!t,"Should never set a note multiple times on a single item")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1857,!t||t.isNote(),"Should only set items that are notes as notes")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1858,!t||!t.isDeleted(),"Should note set a deleted note")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1859,!t||t instanceof e,"Note must be a valid VMLI")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1860,!t||t.parent()===this,"Should always have a valid parent set before setting note on item")}catch(i){v.default.reportError(i)}var r=this._note.get();Ms.a.animateNext(),this._note.set(t),this.shouldSave()&&N.a.setNote(this,t,r,n)}},{key:"isNote",value:function(e){return this._cachedFlagProps.isNote}},{key:"shouldSave",value:function(){return this._shouldSave}},{key:"canDestroy",value:function(){return this._canDestroy}},{key:"getPadding",value:function(e,t,n){try{v.default.PAssert(1864,e,"Invalid pane")}catch(r){v.default.reportError(r)}return this.isNote()?this.parent().getPadding(e,t,n):Xh.DisplaySettings.getPaddingForLevel(n,t)}},{key:"_updateStylePadding",value:function(e,t){try{v.default.PAssert(1865,this._parent,"Must have a valid parent to update padding, root should never change")}catch(s){v.default.reportError(s)}var n=e+(this.isNote()?0:1),r=this.levelsDeep.get()!==n;if(r||t){var i=0;r&&this.levelsDeep.set(n);for(var a=this.getItems(),o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a[o]._updateStylePadding(n,t)}}}},{key:"setFlags",value:function(e){this._updateCachedFlagProps(e),this.flags.set(e)}},{key:"_updateCachedFlagProps",value:function(e){this._cachedFlagProps={isComplete:!!(e&Fs.Complete),isStarred:!!(e&Fs.Starred),isNote:!!(e&Fs.Note),isDisplayComplete:!!(e&Fs.DisplayComplete)}}},{key:"getPriorityProps",value:function(){var e=this.flags.get();return y.a.PriorityClass[e&y.a.PMask]+" "}},{key:"styleProps",value:function(e,t){var n=this.flags.get(),r=this.isHeader()&&!e.isViewFlatList()?"pHeader ":"";e.isItemBold(this)&&(r+="font-bold "),this.prefix&&(r+="hasPrefix ",this.isPrefixCodeBlock()&&(r+="codeBlock rounded "));var i=!1;if((n&y.a.VMLIFlag.Complete||!(n&y.a.VMLIFlag.Note)&&n&y.a.VMLIFlag.DisplayComplete)&&(i=!0),i?(r+="pComplete ",e.search.isMatchStuckHiding(this)||(r+="pDisplayComplete c-foreground-super-faded c-before-super-faded ")):!t&&n&y.a.PMask?r+=y.a.PriorityClass[n&y.a.PMask]+" ":r+="pNormal ",n&y.a.VMLIFlag.Starred&&!(n&y.a.VMLIFlag.Complete||n&y.a.VMLIFlag.DisplayComplete)&&(r+="pStar c-star "),n&y.a.VMLIFlag.Note){r+="pNote c-foreground-faded ";var a=this.parent().flags.get();(a&y.a.VMLIFlag.Complete||a&y.a.VMLIFlag.DisplayComplete)&&(r+="pComplete c-foreground-super-faded c-before-super-faded "),a&y.a.PMask&&(r+=y.a.PriorityClass[a&y.a.PMask]+" "),a&y.a.VMLIFlag.Starred&&!(a&y.a.VMLIFlag.Complete||a&y.a.VMLIFlag.DisplayComplete)&&(r+="pStar c-star ")}var o=this.getAttachments();if(o)for(var s=0,u=0;u<o.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=o[u];if(l.isLoaded()){var c=l.getPlugin().getCssClass(l,e);c&&(r+=c)}}return r}},{key:"onAttachmentIDChange",value:function(e,t){if(e.getPlugin().id===y.a.PluginID.GCalendar){var n=this.getMooDate();n&&(n.setGCalId(e.id),this.onMooDateUpdated(y.a.ChangeType.Local,!0))}this.setTextToWhatItAlreadyIs(y.a.ChangeType.Local)}},{key:"onAttachmentUpdate",value:function(e,t,n){var r=e.getPlugin();if(r===Xh.pluginManager.getPluginGCalendar()){var i=this.getMooDate();if(i&&!i.getGCalCalendar()&&e.hasField("calendarID")){var a=e.getField("calendarID");if(i.setGCalCalendar(a),this.shouldSave()){var o={date:this._date?this._date.toData():null};N.a.saveItem(this,o,y.a.ChangeType.Local,y.a.SaveFlag.Text)}}}else r===Xh.pluginManager.getPluginGmail()&&t&&(t.includes("accountID")||t.includes("subject"))&&this.onAttachInlineUpdate();t&&e.fieldsHaveParseEffect(t)&&(this.parseText(this.getRawText(),n),Ps.a.beginBatch(this),Ps.a.itemTextChanged(this))}},{key:"setAttachments",value:function(e,t,n){var r=!1;if(!this._attachments&&e&&(this._attachments=[]),this._attachments){for(var i=0,a=0,o=this._attachments,s=0;s<o.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.indexOf(o[s])<0&&(o[s].unsubscribe(this),o[s].notifyItemTextChanged(this,!0),this.shouldSave()&&o[s].markUnused(t),r=!0)}for(var u=0;u<e.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=e[u];if(o.indexOf(l)<0){if(l.shouldBeDeleted()){var c=l.getEmbedString(),d=this.getRawText().replace(c,"File failed to upload");return void this.setText(d,y.a.ChangeType.Local)}l.subscribe(this),this.shouldSave()&&l.markInUse(t),r=!0}}r&&(this._attachments=e)}r&&!1!==n&&this.itemChanged.notify()}},{key:"getAttachment",value:function(e){try{v.default.PAssert(1866,this._attachments,"Must have valid attachments in order to query")}catch(t){v.default.reportError(t)}if(this._attachments)return this._attachments[e]}},{key:"hasAttachment",value:function(e){if(this._attachments)for(var t=0,n=0;n<this._attachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[n].id===e)return!0}return!1}},{key:"hasPluginAttachment",value:function(e){try{v.default.PAssert(1867,e,"Must provide a valid plugin type to query")}catch(r){v.default.reportError(r)}if(this._attachments)for(var t=0,n=0;n<this._attachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[n].getPlugin().id===e)return!0}return!1}},{key:"getAttachmentByType",value:function(e){try{v.default.PAssert(1868,e,"Must provide a valid plugin type to query")}catch(i){v.default.reportError(i)}if(this._attachments)for(var t=0,n=0;n<this._attachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._attachments[n];if(r.isType(e))return r}}},{key:"getAttachmentByPlugin",value:function(e){try{v.default.PAssert(1869,e,"Must provide a valid plugin type to query")}catch(i){v.default.reportError(i)}if(this._attachments)for(var t=0,n=0;n<this._attachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._attachments[n];if(r.isPlugin(e))return r}}},{key:"getAttachments",value:function(){if(this._attachments&&this._attachments.length>0)return this._attachments}},{key:"hasAttachments",value:function(){return this._attachments&&this._attachments.length>0}},{key:"getNumAttachments",value:function(){return this._attachments?this._attachments.length:0}},{key:"hasAttachmentType",value:function(e){return Xh.pluginManager.hasAttachmentType(this,e)}},{key:"copyProperties",value:function(e){this.setStarred(e.isStarred(),y.a.ChangeType.Auto),this.setComplete(e.isComplete(),y.a.ChangeType.Auto),this.setPriority(e.getPriority(),y.a.ChangeType.Auto)}},{key:"moveNote",value:function(e,t){try{v.default.PAssert(1870,e.hasNote(),"Must have a note to move")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1871,!this.hasNote(),"Must not already have a note")}catch(r){v.default.reportError(r)}var n=e.getNote();e.setNote(void 0,t),n&&(n.setParent(this),this.setNote(n,t))}},{key:"parent",value:function(){return this._parent}},{key:"setParent",value:function(e){var t=this._parent;return this._parent=e,e&&e!==t&&this._updateStylePadding(this._parent.levelsDeep.get(),!1),this._parent}},{key:"requireStoredEls",value:function(){var e=this.getItemStore();return!!e&&e.requireStoredEls()}},{key:"getItemStore",value:function(){try{v.default.PAssert(1872,this._store,"Should never be getting the item store from a destroyed VMLI")}catch(e){v.default.reportError(e)}return this._store}},{key:"belongsToSameItemStore",value:function(e){return this.getItemStore()===e.getItemStore()}},{key:"belongsToItemStore",value:function(e){return this.getItemStore()===e}},{key:"notifyItemPropertyChanged",value:function(e,t){if(this.hasAttachments())for(var n=0,r=this.getAttachments(),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i].notifyItemPropertyChanged(this,e,t)}}},{key:"unArchive",value:function(e){this._documentOwner.unArchiveItem(this,e)}},{key:"archiveSelf",value:function(e){try{v.default.PAssert(1873,this._documentOwner,"Trying to archive item without a document")}catch(t){v.default.reportError(t)}this._documentOwner&&this._documentOwner.archiveItem(this,e)}},{key:"isArchived",value:function(){return this._isArchived}},{key:"setArchived",value:function(e,t){this._isArchived=e}},{key:"isHidden",value:function(e){try{v.default.PAssert(1874,e,"Must specify the pane for the item being checked")}catch(t){v.default.reportError(t)}try{v.default.PAssert(1875,!e||e.search,"Pane search obj must exist: ",e.isDestroyed())}catch(t){v.default.reportError(t)}return!(!e||!e.search)&&!e.search.isMatched(this)}},{key:"getRawText",value:function(){return this._rawText}},{key:"getParsedText",value:function(){try{v.default.PAssert(1876,!1===this._needsParse,"Text should be parsed before calling get")}catch(e){v.default.reportError(e)}return void 0!==this._parsedText?this._parsedText:this._rawText}},{key:"getSearchText",value:function(e){if(e){var t=e.search.getItemSearchText(this);if(t)return t}try{v.default.PAssert(1877,void 0!==this._searchText,"Item should always have search text")}catch(n){v.default.reportError(n)}return this._searchText}},{key:"setRawText",value:function(e){void 0!==e&&null!==e||(e="");try{v.default.PAssert(1878,e.indexOf(y.a.AttachChar)<0,"Should never have an AttachChar present in raw text")}catch(t){v.default.reportError(t)}this._rawText=e,this._searchText=void 0,this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0}},{key:"setParsedText",value:function(e){this._parsedText=e,this._needsParse=!1}},{key:"setElsNew",value:function(e){this.elsNew=e,this._searchText=this.generateSearchText()}},{key:"generateSearchText",value:function(){return this.elsNew.getDisplayText(this,!1,!0,!0,!0).toLowerCase()}},{key:"getPriority",value:function(e){if(e){var t=e.search.getItemPriority(this);if(void 0!==t)return t}return this.flags.get()&y.a.PMask}},{key:"setPriority",value:function(e,t){try{v.default.PAssert(1880,v.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(i){v.default.reportError(i)}try{v.default.PAssert(1881,null===e||y.a.PriorityClass[e],"Priority must be defined in globals")}catch(i){v.default.reportError(i)}if(e!==this.getPriority()){var n=this.flags.get()&~y.a.PMask|e;if(this.setFlags(n),this.shouldSave()){var r={flags:n};N.a.saveItem(this,r,t,y.a.SaveFlag.Text)}this.notifyItemPropertyChanged(t,"priority"),Ps.a.itemPriorityChanged(this),Xh.onIntroAction("Priority")}}},{key:"isScheduled",value:function(){return!!this._date}},{key:"getDuration",value:function(e,t){if(e){var n=e.search.getItemDuration(this);if(n)return n}if(this._date)return this._date.duration||y.a.DefaultEventDuration}},{key:"setDuration",value:function(e){this._date?this._date.setDuration(e):this._date=new Is.a(void 0,{duration:e})}},{key:"getEndDate",value:function(e){if(this._date)return this._date.getEnd()}},{key:"isMultidayEvent",value:function(){var e=!1;if(this.getDate()&&this.getDuration()>0){var t=this.getEndDate();_s.a.isSameDay(this.getDate(),t)||(e=!0)}return e}},{key:"getStickySearchInfo",value:function(){return{prefix:this.getPrefix(),date:this.getDate(),duration:this.getDuration(),tagsLower:this.getTagsLower(),contacts:this.getContacts(),searchText:this.getSearchText(),priority:this.getPriority(),isComplete:this.isComplete(),isStarred:this.isStarred()}}},{key:"onMooDateUpdated",value:function(e,t){var n=this;if(Xh.timeline.updateNotifications(this),t||v.default.isFlagSet(e,y.a.ChangeType.ItemLoad)||Ps.a.itemDateChanged(this),this.itemChanged.notify(),this.shouldSave()||this._attachments){var r={date:this._date?this._date.toData():null};this.shouldSave()&&N.a.saveItem(this,r,e,y.a.SaveFlag.Text),!t&&this._attachments&&v.default.isLocalChange(e)&&this._attachments.forEach((function(e){e.getPlugin().id===y.a.PluginID.GCalendar&&e.notifyItemDateChanged(n)}))}}},{key:"setMooDate",value:function(e,t,n){if(e!==this._date){this._date&&e?this._date.copyFrom(e,n):this._date=e;var r=this.getRawText();this.onMooDateUpdated(t),!e&&r.includes(y.a.CharDate)&&(r=v.default.trimRight(r.replace(new RegExp(y.a.CharDate,"g"),"").replace(/' {2}'/g," ")),this.setText(r,t))}}},{key:"setDate",value:function(e,t,n){if(this._date)e!==this._date.getDate()&&(this._date.setDate(e),this._date.setDuration(t),this.onMooDateUpdated(n));else if(this.setMooDate(new Is.a(e),n,[]),this.getRawText().indexOf(y.a.CharDate)<0){this.getParsedText();this.setText(this.getParsedText()+" "+y.a.CharDate,y.a.ChangeType.Local)}}},{key:"getMooDate",value:function(){return this._date}},{key:"getNextDate",value:function(e){return this._date?this._date.getNext(e):void 0}},{key:"getDate",value:function(e){if(e){var t=e.search.getItemDate(this);if(t)return t}return this._date?this._date.getDate():void 0}},{key:"allDayDate",value:function(){return!!this._date&&!this._date.getTime()}},{key:"_setFlagHelper",value:function(e,t){var n=t?this.flags.get()|e:this.flags.get()&~e;this.setFlags(n)}},{key:"isDeleted",value:function(){return this._isDeleted}},{key:"setDeleted",value:function(e,t){try{v.default.PAssert(1882,v.default.isValidChangeType(t),"Must supply a valid changetype to delete an item: "+t)}catch(a){v.default.reportError(a)}if(this._isDeleted=e,e&&(e!==this._isDeleted&&this.shouldSave()&&N.a.deleteItem(this.parent(),this,t),this._attachments)){for(var n=0,r=this._attachments,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e?(r[i].unsubscribe(this),this.shouldSave()&&r[i].markUnused(t)):(r[i].subscribe(this),this.shouldSave()&&r[i].markInUse(t))}e&&(this._attachments=[])}}},{key:"isImportant",value:function(e){return this.getPriority(e)}},{key:"forceComplete",value:function(e,t){return this.setComplete(e,t,!0)}},{key:"isDisplayComplete",value:function(){return this._cachedFlagProps.isDisplayComplete}},{key:"computeDisplayComplete",value:function(){var e=this.parent(),t=e&&!this.isComplete()&&(e.isComplete()||e.isDisplayComplete());this._setFlagHelper(y.a.VMLIFlag.DisplayComplete,t)}},{key:"propagateDisplayComplete",value:function(){var e=0;this.computeDisplayComplete();for(var t=0;t<this.numItems();t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.itemAtIndex(t);n.isComplete()||n.propagateDisplayComplete()}}},{key:"isComplete",value:function(){return this._cachedFlagProps.isComplete}},{key:"setComplete",value:function(e,t,n){var r=e,i={};try{v.default.PAssert(1883,v.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(o){v.default.reportError(o)}if(e){var a=!1;this.isRepeatDate()&&this._date.complete()&&(a=!0,this.onMooDateUpdated(t),Ps.a.itemRepeatDateCompleted(this),r=!1,Xh.toasts.pushMessage({text:"Completed. Next occurrence: "+_s.a.toHumanText(this._date.getNext()),action:y.a.MessageAction.Undo,hold:!1})),a||this.dateCompleted||(this.dateCompleted=new Date,i.dateCompleted=this.getDateCompletedTime()),v.default.isLocalChange(t)&&v.default.aggregateEvent("ItemCompleted")}else this.dateCompleted=void 0,i.dateCompleted=null,!0;this._setFlagHelper(y.a.VMLIFlag.Complete,r),v.default.isRemoteChange(t)||(i.flags=this.flags.get(),this.shouldSave()&&N.a.saveItem(this,i,t,y.a.SaveFlag.Text),Xh.onIntroAction("Complete")),this.notifyItemPropertyChanged(t,"isComplete"),this.propagateDisplayComplete(),Xh.timeline.updateNotifications(this),Ps.a.itemCompleteChanged(this),Ps.a.itemSearchChanged(this)}},{key:"setStarred",value:function(e,t){if(void 0!==e){try{v.default.PAssert(1884,v.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(a){v.default.reportError(a)}if(e!==this._cachedFlagProps.isStarred){var n=this.flags.get(),r=e?n|y.a.VMLIFlag.Starred:n&~y.a.VMLIFlag.Starred;this.setFlags(r);var i={flags:r};this.shouldSave()&&N.a.saveItem(this,i,t,y.a.SaveFlag.Text),this.notifyItemPropertyChanged(t,"isStarred"),Ps.a.itemPriorityChanged(this)}}}},{key:"isStarred",value:function(e){if(e){var t=e.search.getItemStarred(this);if(void 0!==t)return t}return this._cachedFlagProps.isStarred}},{key:"isHeader",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"getVisibleChildren",value:function(e){if(!this.isNote()){for(var t=0,n=this.getItems(),r=[],i=0;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n[i].isHidden(e)||r.push(n[i])}return r}}},{key:"hasVisibleChildren",value:function(e){if(this.isNote())return!1;for(var t=0,n=this.getItems(),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!n[r].isHidden(e))return!0}return!1}},{key:"hasHeaderChildren",value:function(){if(this.isNote())return!1;for(var e=0,t=this.getItems(),n=0;n<t.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t[n].isHeader())return!0}return!1}},{key:"getCollapsedField",value:function(e,t){return t?y.a.PerPaneStateField.CollapsedOverview:e.collapsedFieldName}},{key:"isCollapsed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{v.default.PAssert(1885,e,"Must specify the pane for the item being checked for collapsed")}catch(r){v.default.reportError(r)}if(!e||!t&&!e.canCollapse()||this.isNote())return!1;var n=e.isSearchedText()?e.getPerPaneState(this.id,y.a.PerPaneStateField.CollapsedSearch):void 0;return void 0===n&&void 0===(n=e.getPerPaneState(this.id,this.getCollapsedField(e,t)))&&(n=this.isDemandLoad()?0===this.numItems()||!e.isSearched()&&!t:e.getCollapsedDefault(this,t)),!!n}},{key:"setCollapsed",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;try{v.default.PAssert(1886,t,"Must specify the pane for the item being checked for collapsed")}catch(a){v.default.reportError(a)}if(!t||e&&!this.isCollapsible())return!1;var i=this.isCollapsed(t,n);void 0!==e&&(t.isSearchedText()&&t.setPerPaneState(this.id,y.a.PerPaneStateField.CollapsedSearch,void 0),t.setPerPaneState(this.id,this.getCollapsedField(t,n),e),!1!==r&&Xh.PaneManager.updatePaneStateForPane(t),n?t.updateHeaders():(Xh.onIntroAction("Collapse"),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!e,v.default.focusedPane),e!==i&&t.updateItems())),this.itemChanged.notify()}},{key:"setCollapsedQuiet",value:function(e,t){t.setPerPaneState(this.id,this.getCollapsedField(t,!1),e)}},{key:"toggleCollapsed",value:function(e){try{v.default.PAssert(1887,e,"Must specify the pane that this item is being collapsed in")}catch(t){v.default.reportError(t)}this.setCollapsed(!this.isCollapsed(e),e)}},{key:"isCollapsible",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"isDraggable",value:function(){return!this.isNote()}},{key:"setTags",value:function(e,t){var n=this._activeTags&&!e&&this._activeTags||!this._activeTags&&e&&e||v.default.arrayDiff(this._activeTags,e);this._activeTags=e,this._activeTagsLower=e?e.map((function(e){return e.toLowerCase()})):void 0,n&&n.length>0&&!v.default.isFlagSet(t,y.a.ChangeType.ItemLoad)&&Ps.a.itemTagsChanged(this,n)}},{key:"getTags",value:function(){return this._activeTags}},{key:"getTagsLower",value:function(e){if(e){var t=e.search.getItemTagsLower(this);if(t)return t}return this._activeTagsLower}},{key:"setContacts",value:function(e,t){var n=!(this._activeContacts&&e&&this._activeContacts.equals(e));if(this._activeContacts=e,n&&!v.default.isFlagSet(t,y.a.ChangeType.ItemLoad))return!0}},{key:"getContacts",value:function(e){if(e){var t=e.search.getItemContacts(this);if(t)return t}return this._activeContacts}},{key:"hasCompletedAncestor",value:function(){for(var e=0,t=this.parent();t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t.isComplete())return!0;t=t.parent()}}},{key:"hasTime",value:function(){return this._date&&!!this._date.getTime()}},{key:"getTimeOfDay",value:function(){return this._date?this._date.getTime():this.dateCompleted?this.dateCompleted.getTimeOfDay():0}},{key:"_formatDateTime",value:function(e){return e.toString(Xh.International.getFormat(y.a.DFormat.ShortTime))}},{key:"getDisplayDateWithDuration",value:function(e,t){var n=this,r=this.getDate(t);if(r){var i=this.getEndDate(t);+_s.a.clearTime(r)===+r||+_s.a.clearTime(i)===+r&&(r=i)}else if(this.isRepeatDate()){var a=this.getMooDate();a&&(r=a.getNext(e))}try{v.default.PAssert(1888,r,"No display date with duration",(function(){return n.getMooDate()&&n.getMooDate().toData()}))}catch(o){v.default.reportError(o)}return r}},{key:"getTime",value:function(){var e="",t=this.getNextDate();if(this.dateCompleted&&this.isComplete())e=this._formatDateTime(this.dateCompleted);else if(t){var n;if(t.hasTimeOfDay())this.getDuration()>0&&(n=this.getDisplayDateWithDuration()),n?n.equals(t)?e=[this._formatDateTime(t),this._formatDateTime(this.getEndDate())]:n.equals(this.getEndDate())&&(e="Ends "+this._formatDateTime(this.getEndDate())):e=this._formatDateTime(t)}return e}},{key:"createDateString",value:function(e){return e.isBefore(_s.a.getTodayPlusDays(7))?e.toString(Xh.International.getFormat(y.a.DFormat.LongDayTime)):e.toString(Xh.International.getFormat(y.a.DFormat.ShortDayTime))}},{key:"fullTime",value:function(){var e=this.getDate();if(!e)return"";this.createDateString(e)}},{key:"init",value:function(e,t){this._shouldSave=!(t&&t.noSave);try{v.default.PAssert(1889,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(i){v.default.reportError(i)}if(this.id=e.id||N.a.generateID(),e.date&&"undefined"!==e.date){var n=e.date instanceof Is.a?e.date.clone():Is.a.fromData(e.date);n?this._date=n:v.default.reportError(new Error("Initial invalid date: "+e.date))}e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),this.computeDisplayComplete(),(e.items&&e.items.length>0||e.note)&&this.initItems(e.items,e.note,t.changeType),this.__TEMP_InitCalled=!0;try{v.default.PAssert(1890,t,"Missing required properties in extraInfo")}catch(i){v.default.reportError(i)}var r=t?t.changeType:y.a.ChangeType.Auto;try{v.default.PAssert(1891,v.default.isValidChangeType(r),"Must supply a valid changetype to VMLIs")}catch(i){v.default.reportError(i)}(this.__TEMP_InitParseCalled=!0,this.shouldSave()&&!v.default.isAutoChange(t.changeType))?(v.default.isLocalChange(t.changeType)?y.a.SaveFlag.All:y.a.SaveFlag.None,this.getItemStore().trackGlobally()&&N.a.setItem(this)):this.getItemStore().trackGlobally()&&N.a.setItem(this);this.parseText(this.getRawText(),t.changeType|y.a.ChangeType.ItemLoad),v.default.isLocalChange(t.changeType)&&v.default.aggregateEvent("ItemCreated")}},{key:"onLoad",value:function(e){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(e,!1)||e.isSearched()||this.notifyDemandLoadUpdate(!0,e),this.isLoaded=!0)}},{key:"destroy",value:function(e){try{v.default.PAssert(1892,this._canDestroy||e,"VMLI must be explicitly marked as destroyable")}catch(a){v.default.reportError(a)}try{v.default.PAssert(1893,e||!this.shouldSave()||v.default.isDemoMode(),"Should never destroy a saveable VMLI")}catch(a){v.default.reportError(a)}var t=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var n=0,r=this._attachments,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i].unsubscribe(this)}this._attachments=void 0}t.trackGlobally()&&N.a.clearItem(this.id),this.items.unlisten(this.itemsHasMutated),Ps.a.itemSearchChanged(this),this._store=void 0}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"isFullscreen",value:function(){return v.default.focusedItem===this}},{key:"findItem",value:function(e){var t=this.getIndexOf(e.id);if(t>=0)return{index:t,arr:this.items,isArchived:!1}}},{key:"setItems",value:function(e){for(var t=0,n=this.items.get(),r=n.length>0,i=!1,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e[a],s=n.indexOfWithProperty("id",o.id);if(s>=0){var u=n[s];o.items&&u.setItems(o.items)}else n.push(this._store.createItemRaw(o,{documentOwner:this._documentOwner,parent:this,changeType:y.a.ChangeType.Auto})),i=!0}i&&(r&&n.sort(Ds.a.compareItemIndex),this.items.set(n),this.itemsHasMutated())}},{key:"initItems",value:function(t,n,r){var i=!1;if(t&&t.length>0){var a=0;try{v.default.PAssert(1894,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(g){v.default.reportError(g)}for(var o=0;o<t.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t[o],u=void 0;if(s instanceof e?u=s:v.default.isString(s)&&(u=N.a.getItem(s)),u){var l=N.a.getItem(u.parent().id);if(l&&l.id!==this.id){var c=l.items.indexOf(u.id);try{v.default.PAssert(1897,-1===c,"Expect that the old parent has been notified")}catch(g){v.default.reportError(g)}var d=u.getIndex();d>-1&&u.parent().removeChildAtIndex(d,r)}u.setParent(this)}else if("object"!==z()(s)){var h=N.a.getItemDataLocal(this._documentOwner,s);try{v.default.PAssert(1895,h,"Referenced item doesn't exist",s)}catch(g){v.default.reportError(g)}h&&(u=this._store.createItemRaw(h,{documentOwner:this._documentOwner,parent:this,changeType:r}))}else{try{v.default.PAssert(1896,s,"Item must exist otherwise we arent creating anything")}catch(g){v.default.reportError(g)}s&&(u=this._store.createItemRaw(s,{documentOwner:this._documentOwner,parent:this,changeType:r}))}try{v.default.PAssert(1898,u,"There must be a model at this point")}catch(g){v.default.reportError(g)}if(u){if(u.isNote()){n=u.id;continue}i=!0,this.items.push(u)}}}if(n){try{v.default.PAssert(1899,!this._note.get(),"Must not already have a valid note set")}catch(g){v.default.reportError(g)}try{v.default.PAssert(1900,v.default.isString(n)||v.default.isObject(n),"Note must be a valid ID")}catch(g){v.default.reportError(g)}var f;if(v.default.isString(n)){if(!(f=N.a.getItem(n))){var p=N.a.getItemDataLocal(this._documentOwner,n);try{v.default.PAssert(1901,p,"Referenced note doesn't exist",n)}catch(g){v.default.reportError(g)}p&&(p.isDeleted?f=null:(p=Object.assign({isNote:!0},p),f=this._store.createItemRaw(p,{documentOwner:this._documentOwner,parent:this,changeType:r})))}}else v.default.isObject(n)&&(f=this._store.createItemRaw(n,{documentOwner:this._documentOwner,parent:this,changeType:r}));try{v.default.PAssert(1902,void 0!==f,"Must have a valid note VM at this point")}catch(g){v.default.reportError(g)}f&&(this._note.set(f),i=!0)}i&&this.itemsHasMutated()}},{key:"addItemAtIndex",value:function(e,t,n){try{v.default.PAssert(1903,n,"Must pass pane when adding item at index")}catch(i){v.default.reportError(i)}var r=n.createVMLI(e,{documentOwner:this._documentOwner,parent:this,changeType:y.a.ChangeType.AllLocal,isEditable:!0});return this.insertItem(r,t),this.isCollapsed(n,!1)&&this.setCollapsed(!1,n),r}},{key:"insertItem",value:function(e,t,n){try{v.default.PAssert(1904,!this.isNote(),"Notes cannot use this function")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1905,e,"Must specify a valid item to be inserted")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1906,this!==e,"Should not insert an item into itself")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1907,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(r){v.default.reportError(r)}this!==e&&(isNaN(t)||t<0?this.items.push(e):this.items.splice(t,0,e),this.shouldSave()&&N.a.addItem(this,e,t,n))}},{key:"insertSorted",value:function(e,t,n){try{v.default.PAssert(1908,!this.isNote(),"Notes cannot use this function")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1909,e,"Must specify a valid item to be inserted")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1910,t,"Must supply a valid comparator")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1911,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(i){v.default.reportError(i)}var r=this.items.insertSorted(e,t,n);this.shouldSave()&&N.a.addItem(this,e,r)}},{key:"moveTo",value:function(t,n){var r=t.parent,i=t.index,a=t.shouldBeArchived;try{v.default.PAssert(1912,r instanceof e,"New parent must be a valid VMLI")}catch(h){v.default.reportError(h)}void 0===i&&(i=-1),void 0===a&&(a=!1);var o=this.parent(),s=o.findItem(this),u=this.index;if(s)if(r.getDocumentOwner().getBacking()!==o.getDocumentOwner().getBacking())Xh.toasts.pushMessage({text:"Moving items between local and synced documents is not yet supported. Please copy and paste these items for now."});else{var l=i;if(o===r){if(s.index===l)return;s.index<l&&l--}Ms.a.animateNext(this.id),Xh.PaneUpdateBatcher.beginUpdateItems(),s.arr.splice(s.index,1);var c=r.items;l<0?c.push(this,!1):c.splice(l,0,this,!1);var d=r.getDocumentOwner();d!==this.getDocumentOwner()&&this.forEachChildRecursive((function(e){return e.setDocumentOwner(d)}),!0,!0),this.setParent(r),c.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),Xh.PaneUpdateBatcher.commitUpdateItems(),Ps.a.itemSearchChanged(this),Ps.a.itemIndentChanged(this);try{v.default.PAssert(1913,this.shouldSave(),"Item must be marked as saveable")}catch(h){v.default.reportError(h)}try{v.default.PAssert(1914,o.shouldSave(),"Old parent must be marked as saveable")}catch(h){v.default.reportError(h)}try{v.default.PAssert(1915,this.parent().shouldSave(),"New parent must be marked as saveable")}catch(h){v.default.reportError(h)}this.shouldSave()&&N.a.moveItem(this,o,u,n),o!==r&&(o.propagateDisplayComplete(),r.propagateDisplayComplete()),this.isInitialized&&this.isPrefixNumList()&&K.a.fireEvent("numListChanged",[])}else Xh.toasts.pushMessage({text:"Error moving item"})}},{key:"getItemsArrayForSave",value:function(){var e=0;try{v.default.PAssert(1916,!this.isNote(),"Notes cannot use this function")}catch(i){v.default.reportError(i)}for(var t=[],n=this.getItems(),r=0;r<n.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(n[r].id)}return t}},{key:"getDateTime",value:function(){if(this.getDate())return this.getDate().getTime()}},{key:"getDateCompletedTime",value:function(){if(this.dateCompleted)return this.dateCompleted.getTime()}},{key:"isForceCompleted",value:function(){return!(!this.dateCompleted||!this.dateCompleted.equals(Rs))}},{key:"getMetaTextSaveData",value:function(){this.getDate();return{date:this._date?this._date.toData():void 0,dateCompleted:this.getDateCompletedTime()}}},{key:"_generateNotificationEntry",value:function(e,t){var n=new Date(e);try{v.default.PAssert(1917,v.default.isDateValid(n),"Must provide a valid alert date: "+e)}catch(r){v.default.reportError(r)}return n=e.hasTimeOfDay()?n.addMinutes(-Xh.settings.notificationDelay.get()):_s.a.clearTime(n.addDays(-1)).addHours(17),{id:this.id,text:this.generateTitleText(void 0,!0),date:e,alertDate:n,endDate:t}}},{key:"getNotificationEntry",value:function(){try{v.default.PAssert(1918,this.getNextDate(),"Must have a valid date")}catch(t){v.default.reportError(t)}try{v.default.PAssert(1919,!this.allDayDate(),"All day dates should not be scheduled")}catch(t){v.default.reportError(t)}if(!this.allDayDate())try{var e=this.getNextDate();if(e&&e>new Date)return this._generateNotificationEntry(e,this.getEndDate())}catch(n){return void v.default.reportError(n)}}},{key:"getDebugData",value:function(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isDeleted:this.isDeleted()}}},{key:"getFullSaveData",value:function(e,t){var n=this;try{v.default.PAssert(1920,e||this.shouldSave(),"Item must be marked as saveable")}catch(o){v.default.reportError(o)}var r=this.flags.get();try{v.default.PAssert(1921,this._documentOwner,"Item has no document")}catch(o){v.default.reportError(o)}var i={id:this.id,index:this.index,text:this.getRawText(),date:this._date?this._date.toData():void 0,dateCreated:this.dateCreated.getTime(),dateModified:this.dateModified.getTime(),dateCompleted:this.getDateCompletedTime(),flags:r||void 0,isRoot:this.isRoot,docId:this._documentOwner?this._documentOwner.id:void 0,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,parent:this.parent()?this.parent().id:void 0,regexpFlags:this.regexpFlags};if(Object.keys(i).forEach((function(e){void 0===i[e]&&delete i[e]})),this.isNote()&&(i.text=i.text.replace(/\n/g,"<br>")),t){var a=this.elsNew.elements.reduce((function(e,t){var r=t.props.itemLink;return r&&e.push({id:r,text:t.getStyledText(n)}),e}),[]);a&&a.length>0&&(i.itemLinks=a)}return i}},{key:"highlight",value:function(){var e=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout((function(){e.isHighlighted.set(!0)}),0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout((function(){e.isHighlighted.set(!1)}),2e3)}},{key:"removeChild",value:function(e,t){try{v.default.PAssert(1922,!this.isNote(),"Notes cannot use this function")}catch(n){v.default.reportError(n)}try{v.default.PAssert(1923,!e.isNote(),"Do not use remove child to remove notes from items")}catch(n){v.default.reportError(n)}return this.items.remove(e)}},{key:"removeChildAtIndex",value:function(e,t){try{v.default.PAssert(1924,!this.isNote(),"Notes cannot use this function")}catch(n){v.default.reportError(n)}try{v.default.PAssert(1925,!this.itemAtIndex(e).isArchived())}catch(n){v.default.reportError(n)}this.items.removeAt(e)}},{key:"_moveChildrenHelper",value:function(e,t){var n=e.newParent,r=e.index,i=e.isArchived;try{v.default.PAssert(1926,void 0!==n&&void 0!==i,"_moveChildrenHelper is missing parameters")}catch(c){v.default.reportError(c)}var a=this.getItems();if(a.length>0){var o=0,s=n.getItems();!i&&(isNaN(r)||r<0)&&(r=s.length);for(var u=0;a.length>0;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=a[0];try{v.default.PAssert(1927,l!==n,"Should never be reparenting to a child")}catch(c){v.default.reportError(c)}l.moveTo({parent:n,index:r+u,shouldBeArchived:i},t),u++}}}},{key:"moveChildren",value:function(e,t,n){try{v.default.PAssert(1928,!this.isNote(),"Notes cannot use this function")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1929,this.id!==e.id,"Do not use moveChildren to move a child to the same parent")}catch(r){v.default.reportError(r)}e.parent()===this&&this.removeChild(e,n),Xh.PaneUpdateBatcher.beginUpdateItems(),this._moveChildrenHelper({newParent:e,index:t,isArchived:!1},n),this._moveChildrenHelper({newParent:e,index:t,isArchived:!0},n),Xh.PaneUpdateBatcher.commitUpdateItems()}},{key:"deleteSelf",value:function(e){this.parent()&&this.parent().deleteChild(this,void 0,void 0,e)}},{key:"deleteChild",value:function(e,t,n,r,i){try{v.default.PAssert(1930,e,"Must provide a valid child to delete")}catch(l){v.default.reportError(l)}try{v.default.PAssert(1931,!this.isNote(),"Notes cannot use this function")}catch(l){v.default.reportError(l)}if(Xh.PaneUpdateBatcher.beginUpdateItems(),e.isNote())this.setNote(void 0,r);else if(e.hasChildren())if(t)e.moveChildren(t,n,r);else for(var a=0,o=e.getItems(),s=o.length-1;s>=0;s--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e.deleteChild(o[s],void 0,void 0,r,!0)}e.hasNote()&&e.getNote().setDeleted(!0,r);if(e.setAttachments([],r),!e.isDeleted())if(e.isNote()||i||this.removeChild(e,r),this._documentOwner)this._documentOwner.deleteItem(e,r,i);else{var u=this.getItemStore();u&&u.destroyItem(e.id)}e.notifyItemPropertyChanged(r,"isDeleted"),Ps.a.itemItemsChanged(this),Xh.timeline.updateNotifications(e),Xh.PaneUpdateBatcher.commitUpdateItems()}},{key:"unDelete",value:function(e){if(this._documentOwner.unDeleteItem(this,e),this.hasNote()){var t=this.getNote();t.isDeleted()&&this._documentOwner.unDeleteItem(t,e)}}},{key:"replaceChild",value:function(e,t,n){try{v.default.PAssert(1932,!this.isNote(),"Notes cannot use this function")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1933,!e.isNote(),"Old child should not be a note")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1934,!t.isNote(),"New child should not be a note")}catch(i){v.default.reportError(i)}var r=e.getIndex();this.items.removeAt(r),N.a.deleteItem(this,e,n),t.moveTo({parent:this,index:r},n),e.moveChildren(t,t.numChildren(),n),t.parent().id!==this.id&&t.parent().items.remove(t)}},{key:"forEachChildRecursive",value:function(e,t,n){n&&e(this),t&&this.hasNote()&&e(this.getNote()),this.items.forEach((function(n){return n.forEachChildRecursive(e,t,!0)}))}},{key:"getChildren",value:function(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()}},{key:"getChild",value:function(e){try{v.default.PAssert(1935,!this.isNote(),"Notes cannot use this function")}catch(t){v.default.reportError(t)}try{v.default.PAssert(1936,e>=0,"Child index is out of range: ",e)}catch(t){v.default.reportError(t)}try{v.default.PAssert(1937,e<this.numItems(),"Child index out of range: ",e,this.numItems())}catch(t){v.default.reportError(t)}return this.itemAtIndex(e)}},{key:"getFirstChild",value:function(){try{v.default.PAssert(1938,!this.isNote(),"Notes cannot use this function")}catch(e){v.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(0):void 0}},{key:"isFirstChild",value:function(){try{v.default.PAssert(1939,!this.isNote(),"Notes cannot use this function")}catch(e){v.default.reportError(e)}return!!this.parent()&&this.parent().getFirstChild()===this}},{key:"getLastChild",value:function(){try{v.default.PAssert(1940,!this.isNote(),"Notes cannot use this function")}catch(e){v.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0}},{key:"isLastChild",value:function(){try{v.default.PAssert(1941,!this.isNote(),"Notes cannot use this function")}catch(e){v.default.reportError(e)}return!!this.parent()&&this.parent().getLastChild()===this}},{key:"isDescendantOf",value:function(e){for(var t=0,n=this.parent();n&&n!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n=n.parent()}return void 0!==n}},{key:"hasChild",value:function(e){return this.getIndexOf(e.id)>=0}},{key:"getChildIndex",value:function(e){try{v.default.PAssert(1942,!this.isNote(),"Notes cannot use this function")}catch(t){v.default.reportError(t)}try{v.default.PAssert(1943,!e.isNote(),"Should not get the index of an item note")}catch(t){v.default.reportError(t)}return this.getIndexOf(e.id)}},{key:"getIndexOf",value:function(e){try{v.default.PAssert(1944,!this.isNote(),"Notes cannot use this function")}catch(a){v.default.reportError(a)}try{v.default.PAssert(1945,v.default.isString(e),(function(){return"ID must be a valid string: "+v.default.getObjectInfo(e)}))}catch(a){v.default.reportError(a)}var t=-1,n=this.getItems();if(n)for(var r=0,i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n[i].id===e){t=i;break}}return t}},{key:"getIndex",value:function(){try{v.default.PAssert(1946,!this.isNote(),"Should never be getting a child index of a note")}catch(e){v.default.reportError(e)}return this.parent().getChildIndex(this)}},{key:"indexInItemFromStringIndex",value:function(e){var t={index:e},n=this.items.get(),r=n.findIndex((function(e){return Ds.a.compareItemIndex(e,t)>0}));return r>=0?r:n.length}},{key:"hasChildren",value:function(){return!this.isNote()&&this.numItems()>0}},{key:"numChildren",value:function(){try{v.default.PAssert(1947,!this.isNote(),"Notes cannot use this function")}catch(e){v.default.reportError(e)}return this.numItems()}},{key:"canZoom",value:function(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)}},{key:"parents",value:function(e){for(var t=0,n=[],r=this.parent();r&&r!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n.splice(0,0,r),r=r.parent()}return n}},{key:"getSiblings",value:function(e){try{v.default.PAssert(1948,!this.isNote(),"Notes cannot use this function")}catch(o){v.default.reportError(o)}e=e||0;var t=[];if(this.parent())for(var n=0,r=this.parent().getItems(),i=e,a=r.length;i<a;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i]!==this&&t.push(r[i])}return t}},{key:"nextSibling",value:function(){var e=this.getIndex();return this.parent().getItems()[e+1]}},{key:"isRootItem",value:function(){var e=this.getItemStore();return!!e&&e.isRoot(this)}},{key:"clone",value:function(e,t){var n=0;try{v.default.PAssert(1949,!v.default.isAutoChange(t),"Cloning should always be a user action")}catch(s){v.default.reportError(s)}for(var r=e.getItemStore().createItemRaw({id:void 0,text:this.getRawText(),isComplete:this.isComplete(),date:this._date?this._date.clone():void 0,priority:this.getPriority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:e,documentOwner:e.getDocumentOwner()||this._documentOwner,changeType:t}),i=0;i<this.numItems();++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.itemAtIndex(i).clone(r,t);r.insertItem(a)}if(this.hasNote()){var o=this.getNote().clone(r,t);r.setNote(o,t)}return r}},{key:"getItems",value:function(){return this.items.get()}},{key:"itemAtIndex",value:function(e){return this.items.get()[e]}},{key:"numItems",value:function(){return this.items.length()}},{key:"itemsHasMutated",value:function(){try{v.default.PAssert(1950,!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id)}catch(e){v.default.reportError(e)}!this._destroyed&&this.isInitialized&&Ps.a.itemItemsChanged(this)}},{key:"numChildrenRecursive",value:function(){var e=0,t={item:this,each:function(t){e++}};return v.default.searchVMLIs(t),e}},{key:"isOnDate",value:function(e){return!!this._date&&this._date.isOnDate(e)}},{key:"getCalendarColor",value:function(){var e,t=Xh.pluginManager.getPluginGCalendar();if(this.isComplete())e="#ddd";else if(this.hasAttachmentType(y.a.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var n=this.getAttachmentByType(y.a.PluginType.Calendar);e=t.getCalendarBackgroundColor(n.getField("calendarID"))}else e="rgba(0, 153, 221, 0.85)";return e}},{key:"getCalendarDisplayProps",value:function(){var e,t=Xh.pluginManager.getPluginGCalendar();if(this.hasAttachmentType(y.a.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var n=this.getAttachmentByType(y.a.PluginType.Calendar);e=t.getCalendarDisplayProps(n.getField("calendarID"))}return e}},{key:"allowTextEditing",value:function(){return!0}},{key:"getPreviousItem",value:function(){var e=this.parent(),t=e.getChildIndex(this);if(t>0)return e.getChild(t-1)}},{key:"isRepeatDate",value:function(){return this._date&&this._date.isRepeatDate()}},{key:"getDocumentOwner",value:function(){return this._documentOwner}},{key:"setDocumentOwner",value:function(e){this._documentOwner=e}},{key:"onAttachInlineUpdate",value:function(){this.setTextToWhatItAlreadyIs(y.a.ChangeType.Local)}},{key:"setDateModified",value:function(e){this.dateModified=e,Ps.a.itemModifiedChanged(this)}},{key:"getDisplayText",value:function(e,t,n){var r;return(null===(r=this.elsNew)||void 0===r?void 0:r.getDisplayText(this,e,t,n))||""}},{key:"getHTML",value:function(e,t){return this.elsNew.getHTML(this,e,t)}},{key:"getPlaintext",value:function(e){return this.elsNew.getPlaintext(this,e)}},{key:"getItemsLinkedTo",value:function(){return this._itemsLinkedTo}},{key:"addLinkedTo",value:function(e){this._itemsLinkedTo||(this._itemsLinkedTo=[]),this._itemsLinkedTo.push(e)}},{key:"removeLinkedTo",value:function(e){this._itemsLinkedTo||(this._itemsLinkedTo=[]),this._itemsLinkedTo.remove(e)}},{key:"setItemsLinked",value:function(e){var t=this;this._itemsLinked&&this._itemsLinked.forEach((function(n){e&&!e.includes(n.id)&&n.removeLinkedTo(t)})),e&&N.a.isLoadedLocal.onValue(!0,(function(){var n=e.map((function(e){if(!t._itemsLinked||!t._itemsLinked.find((function(t){return t.id===e}))){var n=N.a.getItem(e);if(n)return n.addLinkedTo(t),n}}));t._itemsLinked=n.filter((function(e){return!!e}))}))}},{key:"checkDeleteProblem",value:function(){var e;if((null===(e=this._itemsLinkedTo)||void 0===e?void 0:e.length)>0)return"linked to another item"}}]),e}(),b()(Os.prototype,"itemsHasMutated",[w.a],Object.getOwnPropertyDescriptor(Os.prototype,"itemsHasMutated"),Os.prototype),Os);G.a.extendClass(Ns,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Us,t=function(e){d()(n,e);var t=Ls(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"_runAndGetSaveData",value:function(e,t){var n=this.shouldSave()&&this.getMetaTextSaveData();this.regexpFlags=void 0;var r,i=this.getRawText();if(this.setRawText(this.generateSaveText(e)),this.parseText(i,t),this.shouldSave()){var a=this.getMetaTextSaveData();for(var o in r={},a)n[o]!==a[o]&&(r[o]=a[o])}return r}},{key:"setText",value:function(e,t){var n=this.isPrefixCodeBlock()||e.startsWith(y.a.Prefix.CodeBlock);try{v.default.PAssert(2529,v.default.isLocalChange(t)||!e||e.indexOf(y.a.AttachChar)<0,"Should never be setting text with an attach char in it")}catch(a){v.default.reportError(a)}try{v.default.PAssert(2530,this.isNote()||n||!e||e.indexOf("\n")<0,"Non-notes should never have newlines")}catch(a){v.default.reportError(a)}try{v.default.PAssert(2531,!e||v.default.isRemoteChange(t)||e.indexOf(y.a.TextSpace)<0,"Should never insert text space into item when editing locally")}catch(a){v.default.reportError(a)}t|=y.a.ChangeType.Text;var r=this.isPrefixHeader();!this.isNote()&&!n&&e&&e.indexOf("\n")>=0&&(e=e.replace(/\n/g," ")),Ps.a.beginBatch(this);var i=this._runAndGetSaveData(e,t);this.shouldSave()&&(i.text=this.generateSaveText(e),i.regexpFlags=this.regexpFlags,N.a.saveItem(this,i,t,y.a.SaveFlag.Text)),Ps.a.itemTextChanged(this),this.isPrefixHeader()!==r&&Ps.a.itemHeaderChanged(this),Ps.a.commitBatch(this)}},{key:"setTextFromEls",value:function(e){var t=this.elsNew.getRawText();this.setText(t,e)}},{key:"sizeInPane",value:function(e,t,n){if(n)return y.a.OverviewItemHeightDesktop;if(this.isNote()){var r=e.objectAtIndex(t);return Xh.DisplaySettings.lineItemHeight(r,1)}var i=e.objectAtIndex(t),a=this.metricsInPane(e,t).height;return this.shouldShowParents(i,e)&&(a+=y.a.HeightAgendaParents),a}},{key:"shouldShowParents",value:function(e,t){return t.type===y.a.PaneMode.Task&&e.item&&!t.isViewFlatList()&&(t.isViewTag()||t.isViewAgenda()||t.isViewContact()||t.isViewPriority())&&!e.item.isNote()&&0===e.levelsDeepNew()&&e.item.getItemStore()===Xh.itemStoreManager.getDefaultItemStore()&&e.item.parent()!==t.getItem()}},{key:"generateSaveText",value:function(e){return void 0!==e&&null!==e?this._generateUsableText(e,"getEmbedString"):null}},{key:"generateTitleText",value:function(e,t){var n=this.parent();return e&&!n?e.titleOfFirstItem():!n&&this.getDocumentOwner()?this.getDocumentOwner().text.get():(this.elsNew?this.elsNew.getDisplayText(this,!1,!0,t):this.getParsedTextWithoutPrefix()).trim()}},{key:"_generateUsableText",value:function(e,t,n,r){var i=this;try{v.default.PAssert(2532,this.hasAttachments()||e.indexOf(y.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(u){v.default.reportError(u)}var a=e;if(this.hasAttachments()&&e.indexOf(y.a.AttachChar)>=0){var o=n||0,s=this.getNumAttachments();a=e.replace(new RegExp(y.a.AttachChar,"g"),(function(){if(o<s){var e=i.getAttachment(o);return o++,!e.isLoaded()&&!e.hasInlineData()||r&&e.getPlugin().id===y.a.PluginID.Date?"":e[t]()}try{v.default.PAssert(2533,!1,"Unable to find valid attachment for AttachChar")}catch(u){v.default.reportError(u)}return""}));try{v.default.PAssert(2534,a.indexOf(y.a.AttachChar)<0,"Should convert all attachments to their string form")}catch(u){v.default.reportError(u)}}return a}},{key:"parseText",value:function(e,t,n){if(!this._isParsing){try{v.default.PAssert(2535,!this.isDestroyed(),"Must not parse a destroyed VMLI")}catch(u){v.default.reportError(u)}try{v.default.PAssert(2536,v.default.isValidChangeType(t),"Must specify a valid changetype")}catch(u){v.default.reportError(u)}var r;this._isParsing=!0;try{var i,a;this.__TEMP_ParseCalled=!0,a=this.isNote()?(i=Cs.a.parseNoteNew(this)).elsNew:(i=Cs.a.runParseTextNew(this,n)).elsNew,this.isInitialized&&xs.a.beginAction();var o=this.isPrefixNumList();if(r=this.styleText(i,e,t,a),this.isInitialized){var s;if(this.itemChanged.notify(),this.isNote())null===(s=this.parent())||void 0===s||s.itemChanged.notify();this.isInitialized&&this.isPrefixNumList()!==o&&K.a.fireEvent("numListChanged",[]),xs.a.endAction()}}catch(l){v.default.reportError(l)}return this._isParsing=!1,r}}},{key:"styleText",value:function(e,t,n,r){try{v.default.PAssert(2537,v.default.isValidChangeType(n),"Must specify a valid changetype")}catch(S){v.default.reportError(S)}var i=!1,a=[];if(e){this.prefix=e.prefix;var o=(!t.includes(y.a.CharDate)||this.getRawText().includes(y.a.CharDate))&&this.getMooDate();if(o&&""!==e.parsedText){var s=o.getGCalId();if(s){var u=o.getGCalCalendar();e.attachments||(e.attachments=[]);var l=e.attachments.indexOfWithProperty("p",y.a.PluginID.GCalendar);l>=0&&e.attachments.splice(l,1),e.attachments.push({p:y.a.PluginID.GCalendar,id:s,calendarID:u,hasInlineData:!0})}}if(e.attachments||this.hasAttachments()){for(var c=0,d=[],h=0;e.attachments&&h<e.attachments.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=e.attachments[h];f.p===y.a.PluginID.Date&&(f.id=this.id);var p=Xh.pluginManager.getAttachment(f,f.hasInlineData);p&&(d.push(p),v.default.isLocalChange(n)&&!p.getOldID()&&a.push(p))}i=!0,this.setAttachments(d,n,!1)}(e.itemLinks||this._itemsLinked&&this._itemsLinked.length>0)&&this.setItemsLinked(e.itemLinks),this.setParsedText(e.parsedText);try{v.default.PAssert(2538,e.elsNew||v.default.isFlagSet(n,y.a.ChangeType.ItemLoad),"Must always return an els list")}catch(S){v.default.reportError(S)}r&&this.setElsNew(r),(e.tags||this._activeTags)&&this.setTags(e.tags,n),(e.contacts||this._activeContacts)&&this.setContacts(e.contacts,n)&&(i=!0),this.regexpFlags=e.regexpFlags;var g=this.getRawText();!(t&&this.getMooDate()&&t.includes(y.a.CharDate))||g&&g.includes(y.a.CharDate)||this.setMooDate(void 0,n,!0)}if(this.isInitialized){if(a.length>0)for(var m=0,_=0;_<a.length;_++){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;a[_].notifyItemTextChanged(this,!1)}if(v.default.isLocalChange(n)&&this.isNote()&&this.parent().hasAttachments())for(var b=0,w=this.parent().getAttachments(),k=0;k<w.length;++k){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;w[k].notifyItemNoteChanged(this)}i&&this.itemChanged.notify()}return!1}},{key:"getCalendarRawText",value:function(){return this.getRawText().replace(/^ +/g,"").replace(/ +$/g,"")}},{key:"getCalendarParsedText",value:function(){return this.getDisplayText(!1,!0,!0).trim()}},{key:"getUnstyledText",value:function(){var e=this;return this.elsNew.elements.map((function(t){return t.getStyledText(e)})).join("")}},{key:"getStyledTextAsOneLine",value:function(e,t,n){var r,i=this.getDocumentOwner();if(this.isRoot&&i)return i.text.get();t&&(r='<span class="numChildren c-foreground-super-faded">'+this.numItems()+"</span>");var a=this.elsNew.elements;return n&&(a=a.filter(this.overviewElsFilter)),Xh.ElementRenderer.renderNew(a,this,void 0,{convertSpaces:!1,noPrefix:e,suffix:r,noFormat:n})}},{key:"overviewElsFilter",value:function(e){return!e.props.date&&!e.props.prefixType}},{key:"hasText",value:function(){var e=this.getParsedText();return(e=e.replace(/ /g,"")).length>0}},{key:"hasTextWithoutPrefix",value:function(){var e=this.getParsedTextWithoutPrefix();return(e=e.replace(/ /g,"")).length>0}},{key:"setPrefix",value:function(e){var t=this.getRawText(),n=this.getPrefix();n&&(t=t.substr(n.length)),this.prefix=e,t=(e?e+" ":"")+t,this.setText(t,y.a.ChangeType.Local)}},{key:"getPrefix",value:function(){return this.prefix?this.prefix+" ":""}},{key:"getPrefixLength",value:function(){return this.prefix?this.prefix.length+1:0}},{key:"isPrefixHeader",value:function(e){var t;return e&&(t=e.search.getItemPrefix(this)),void 0===t&&(t=this.prefix),t&&(t[0]===y.a.Prefix.Header||t[0]===y.a.Prefix.Header2)}},{key:"isPrefixTask",value:function(){return this.prefix&&v.default.isPrefixTask(this.prefix)}},{key:"isPrefixBullet",value:function(){return this.prefix&&this.prefix===y.a.Prefix.Bullet||this.prefix===y.a.Prefix.Bullet2}},{key:"isPrefixNumList",value:function(){return!!(this.prefix&&+this.prefix[0]>=0&&+this.prefix[0]<10)}},{key:"isPrefixCodeBlock",value:function(){var e;return null===(e=this.prefix)||void 0===e?void 0:e.startsWith(y.a.Prefix.CodeBlock)}},{key:"hasPrefix",value:function(){return!!this.prefix}},{key:"numListNumber",value:function(){if(this.isPrefixNumList()){for(var e=0,t=1,n=this.parent(),r=this.getIndex()-1;r>=0;--r,++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=n.getChild(r);if(!i||!i.isPrefixNumList())break}return t}}},{key:"shouldCopyPrefix",value:function(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()}},{key:"getParsedTextWithoutPrefix",value:function(){var e=this.getPrefix(),t=this.getParsedText();return e?t.substr(e.length):t}},{key:"applyFormatToSelection",value:function(e,t,n,r,i){n+=this.getPrefixLength(),r+=this.getPrefixLength(),"toggle"===i&&(i=this.elsNew.displayRangeHasFormat(e,t,n,r)?"no":"yes");var a,o="yes"===i||null;if(Xh.settings.showMarkdown.get()&&r-n===0){var s=y.a.Markdown[e];this.elsNew.insertEl(new As.a(s+s),t,n),a=n+s.length}else this.elsNew.insert(n,r-n,So()({},e,o),t);var u=this.elsNew.getRawText();return this.setText(u,y.a.ChangeType.Local),void 0!==a&&R.a.selectObject(t,a-this.getPrefixLength()),"yes"===i}},{key:"insertLinkAtSelection",value:function(){var e=R.a.getStartIndex();if(R.a.isValid()&&e===R.a.getEndIndex()){var t,n,r=R.a.getStartOffset(),i=R.a.getStartOffsetWithPrefix(),a=R.a.getEndOffsetWithPrefix(),o=R.a.getEndTotal(),s=R.a.getStartObject(),u=s.getDisplayText();if(i!==a)t=u.substr(i,a-i);else if(u.length>0&&r>=0&&r<=o){var l=s.item.elsNew.elementAtOffset(s,r),c=l&&l.props.link;c&&(n=c.href,t=c.text)}Xh.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:R.a.getEndElement(),onInsertLink:this.onInsertLink,text:t,href:n})}}},{key:"onInsertLink",value:function(e,t){var n=e.text,r=e.href,i=e.isUpdate;if(R.a.isValid()&&R.a.getStartIndex()===R.a.getEndIndex()){t&&!n&&(n=r);var a=R.a.getStartOffset(),o=R.a.getStartOffsetWithPrefix(),s=R.a.getEndOffsetWithPrefix(),u=R.a.getStartObject(),l=u.getDisplayText().substr(o,s-o),c=s+n.length-l.length,d=r&&v.default.isUrlImage(r);if(i){var h=u.item.elsNew.elementAtOffset(u,a);if(h&&h.props.link)if(r){h.props.link.text=n,h.props.link.href=r;var f=u.item.elsNew.findElement(u,(function(e){return e===h}));f&&(c=f.offset+f.length)}else delete h.props.link,h.setText(n,u.showMarkdown())}else s!==o?this.elsNew.insert(o,s-o,{link:{text:n,href:r}},u):this.elsNew.insertEl(new As.a(n,{link:{href:r,text:n,showImage:t,isImage:d}}),u,o);this.setTextFromEls(y.a.ChangeType.Local),R.a.selectObject(u,c-u.item.getPrefixLength())}}},{key:"getTextLength",value:function(){return this.getParsedText().length}},{key:"getNotePreviewMultiline",value:function(){var e=this.getParsedText();if(e){e=e.substr(0,Math.min(e.length,4e3));var t=0,n=e.split(/<\/?(?:div|p|br|li)[^>]*>\s*/im).map((function(e){if(!(t>280)){var n=document.createElement("div");n.innerHTML=e;var r=n.textContent||n.innerText;return t+r.length>280&&(r=r.slice(0,280-t)+"..."),t+=r.length,r}})).filter((function(e){return!!e}));return n.length>4&&((n=n.slice(0,4))[3]+="..."),n}}},{key:"getNotePreviewText",value:function(){if(this._notePreviewText)return this._notePreviewText;var e=this.getParsedText();if(e){var t=(e=e.substr(0,Math.min(e.length,5e3))).match(/[^\r\n]+/);if(t){for(var n=0,r=(e=t[0]).split(/<\/?(?:div|p|br|li)[^>]*>\s*/im),i=0;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if(a){var o=document.createElement("div");o.innerHTML=a;var s=o.textContent||o.innerText;if(s){if(e&&e!==t[0]){e+="...";break}e=s}}}e=e.substr(0,Math.min(e.length,200))}}return this._notePreviewText=e,e}},{key:"setTextToWhatItAlreadyIs",value:function(e){var t=this.getParsedText();this.setText(t,e)}},{key:"getPrefixForExport",value:function(){var e=this.prefix;return this.isPrefixNumList()?e=this.numListNumber()+".":this.isPrefixTask()&&(e=this.isComplete()?"[x]":"[ ]"),e?e+" ":""}}]),n}(e);return t}(Ns),!0),G.a.extendClass(Ns,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Us,t=function(e){d()(n,e);var t=Es(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"dragStart",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.pane||v.default.focusedPane;try{v.default.PAssert(2521,r.isItemDraggable(),"Pane must be draggable in order to start a drag")}catch(g){v.default.reportError(g)}try{v.default.PAssert(2522,Xh.DragDrop.startDragItem,"Should always have a valid item to start dragging from")}catch(g){v.default.reportError(g)}var i=v.default.getElementParent(e.startSrc||e.target);try{v.default.PAssert(2523,i,"Must have a valid target node")}catch(g){v.default.reportError(g)}if(i){Xh.DragDrop.startDragItem=void 0,Xh.DragDrop.dragItem=this;var a,o,s,u=v.default.getPaneObjectForElement(i);if(r.isViewCalendar()||n||v.default.findParent(i,"itemNotInPane"))a=[{item:this,pane:r}],o=[this];else{s=u.block;var l=R.a.getSelectedObjects();0!==l.length&&l.find((function(e){return e.id===u.id}))?(a=[],o=[],l.forEach((function(e){a.includes(e)||(o.push(e.item),a=a.concat(e).concat(r.getChildrenOfPaneObject(e)))}))):(a=[u].concat(r.getChildrenOfPaneObject(u)),o=[u.item])}var c=v.default.offset(i),d=c.left,h=c.top;Xh.PaneManager.runForEachPane((function(e){e.addScrollListener(t.dragScroll)}));var f={x:e.clientX,y:e.clientY,items:a},p={dropEffect:r.dropEffect(this),itemsDragging:o,element:i,block:s,pane:r};Xh.DragDrop.start(this,a,d,h,r,f,p,n),v.default.disableMouseMove=!0}}},{key:"dragMove",value:function(e){try{v.default.PAssert(2524,Xh.DragDrop.startInfo,"Must have started a drag to be valid")}catch(i){v.default.reportError(i)}if(Xh.DragDrop.startInfo){"touchmove"===e.type&&(e.returnValue=!1,e.returnFalse=!0,v.default.preventAndStop(e));var t=e.clientX-Xh.DragDrop.startInfo.x,n=e.clientY-Xh.DragDrop.startInfo.y,r=v.default.elementFromPoint(e.clientX,e.clientY);Xh.DragDrop.setTransform(t,n),r&&Xh.DragDrop.handleDragOver({item:this,dataTransfer:Xh.DragDrop.dataTransfer,clientX:e.clientX,clientY:e.clientY})}}},{key:"dragScroll",value:function(){var e=this;!Xh.DragDrop.isDragging||isNaN(R.a.mousePos.x)||isNaN(R.a.mousePos.y)||v.default.animationFrameOnce("DragOnScroll",(function(){var t={clientX:R.a.mousePos.x,clientY:R.a.mousePos.y,preventDefault:v.default.emptyFn,stopPropagation:v.default.emptyFn,diffY:0};e.dragMove(t)}))}},{key:"dragEnd",value:function(e){var t=this;v.default.disableMouseMove=!1,Xh.DragDrop.stop(),e&&(v.default.findParent(e.target,"paneContent")||v.default.findParent(e.target,"paneOverviewScroller"))&&Xh.DragDrop.handleDrop({target:e.target,dataTransfer:Xh.DragDrop.dataTransfer,fromDropBucket:e.fromDropBucket,ctrlKey:e.ctrlKey,altKey:e.altKey}),Xh.DragDrop.finish(),Xh.PaneManager.runForEachPane((function(e){e.removeScrollListener(t.dragScroll)})),v.default.disableMouseMove=!1}},{key:"checkDragOnStart",value:function(e,t){var n=this;Xh.DragDrop.escapedDragging=!1,Xh.DragDrop.startDragItem=this,v.default.preventAndStop(e),R.a.addMouseHandler({move:function(e){n.checkDragOnMove(e,t)},up:function(e){n.checkDragOnEnd(e)}})}},{key:"checkDragOnMove",value:function(e,t){if(Xh.DragDrop.startDragItem&&!Xh.DragDrop.escapedDragging&&(!k.a.touch||v.default.distance(e.distanceX,e.distanceY)>v.default.ClickThreshold)){var n=e.pane||v.default.focusedPane;Xh.DragDrop.startDragItem===this&&this.isDraggable()&&n.isItemDraggable(this)&&this.dragStart(e,t)}Xh.DragDrop.isDragging&&(this.dragMove(e),v.default.preventAndStop(e))}},{key:"checkDragOnEnd",value:function(e){Xh.DragDrop.startDragItem=void 0,Xh.DragDrop.isDragging&&this.dragEnd(e)}}]),n}(e);return t}(Ns),!0),G.a.extendClass(Ns,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Us,t=function(e){d()(n,e);var t=Ts(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"onChangeRemote",value:function(e,t){var n=this,r=!1,i=this.getRawText();Object.keys(e).map((function(a){var o,s=e[a];switch(a){case"text":n.onChangeRemoteText(s,t);break;case"parent":r||n.parent()&&n.parent().id===s&&(n.parent().hasChild(n)||n.isNote())||(n.onChangeRemoteParentOrIndex(e),r=!0);break;case"index":r||n.index===s||(n.onChangeRemoteParentOrIndex(e),r=!0);break;case"priority":n.setPriority(s||0,t);break;case"isComplete":n.setComplete(s||!1,t);break;case"isStarred":n.setStarred(s||!1,t);break;case"dateCompleted":n.dateCompleted=s?new Date(s):null,o=!0;break;case"date":n.setMooDate(Is.a.fromData(s),t,!0),o=!0;break;case"note":s?n.addRemoteNote(s,t):n.hasNote()&&n.removeRemoteNote(t);break;case"dateModified":n.setDateModified(new Date(s));break;case"flags":var u=v.default.isFlagSet(s,y.a.VMLIFlag.Complete);n.isComplete()!==u?n.setComplete(u,t):n.setFlags(s),Ps.a.itemSearchChanged(n);break;case"isArchived":s!==n.isArchived()&&(s?n.archiveSelf(t):n.unArchive(t));break;case"isDeleted":s!==n.isDeleted()&&(s?n.deleteSelf(t):n.unDelete(t));break;case"id":case"items":case"dateCreated":case"pendingSync":case"docId":break;default:0}o&&n.parseText(i,t)}))}},{key:"onChangeRemoteText",value:function(e,t){this.setText(e,t)}},{key:"onChangeRemoteParentOrIndex",value:function(e){var t=this.parent(),n=e.parent?N.a.getItem(e.parent):t;try{v.default.PAssert(2511,n,"Must have a new parent")}catch(s){v.default.reportError(s)}if(n){if(Xh.PaneUpdateBatcher.beginUpdateItems(),32===(32&e.flags)||this.isNote())this.setParent(n),n.hasNote()&&n.getNote()===this||this.isDeleted()||n.setNote(this,y.a.ChangeType.Remote);else{if(void 0===e.index){var r=N.a.getItemDataLocal(this.getDocumentOwner(),e.id);r&&(e.index=r.index)}try{v.default.PAssert(2512,void 0!==e.index,"Index is undefined")}catch(s){v.default.reportError(s)}if(void 0!==e.index&&(this.index=e.index),!0!==e.isDeleted&&!this.isDeleted()&&!0!==e.isArchived&&!this.isArchived())if(t===n&&n.hasChild(this))n.items.sort(Ds.a.compareItemIndex);else{var i=n.getDocumentOwner();i!==this.getDocumentOwner()&&this.forEachChildRecursive((function(e){return e.setDocumentOwner(i)}),!0,!0),this.setParent(n);var a=void 0!==e.index?e.index:this.index,o=n.indexInItemFromStringIndex(a);n.items.splice(o,0,this),t&&t!==n&&t.items.remove(this)}}Ps.a.itemSearchChanged(this),Xh.PaneUpdateBatcher.commitUpdateItems()}}},{key:"addRemoteNote",value:function(e,t){}},{key:"removeRemoteNote",value:function(e){}}]),n}(e);return t}(Ns),!0);var js,Us=Ns,Bs=(js=function(){function e(t,n,r,i,o,s,u,l){a()(this,e),this.id=t,this.numItems=0,this._readonly=!!n,this._isDestructible=!!r,this._enabledFilters=u,this._trackGlobally=!!i,this._requireStoredEls=!!o,this._owner=l,this._root=void 0,this._data={},this._destroyed=!1}return s()(e,[{key:"areFiltersEnabled",value:function(e){return v.default.isAtLeastOneFlagSet(this._enabledFilters,e)}},{key:"getEnabledFilters",value:function(){return this._enabledFilters}},{key:"isOwner",value:function(e){return this._owner===e}},{key:"destroy",value:function(){try{v.default.PAssert(977,this._isDestructible,"Item store must be destructible to destroy")}catch(e){v.default.reportError(e)}this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0}},{key:"checkDestroyed",value:function(){try{v.default.PAssert(978,!this._destroyed,"Should not be using a destroyed item store")}catch(e){v.default.reportError(e)}}},{key:"trackGlobally",value:function(){return this._trackGlobally}},{key:"requireStoredEls",value:function(){return this._requireStoredEls}},{key:"clearStore",value:function(){if(this._isDestructible){for(var e in Xh.PaneUpdateBatcher.beginUpdateItems(),this._data)this._root&&e===this._root.id||this._data[e].destroy();Xh.PaneUpdateBatcher.commitUpdateItems()}this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)}},{key:"createRoot",value:function(e,t){return this.checkDestroyed(),this._root=this.createItem(e,t,void 0,{isRoot:!0},y.a.ChangeType.None),this._root}},{key:"createItem",value:function(e,t,n,r,i,a){try{v.default.PAssert(979,n||r&&r.isRoot,"Must always specify a valid parentID when creating a new item")}catch(c){v.default.reportError(c)}this.checkDestroyed();try{v.default.PAssert(980,!this._data[e],"Should never double-create for the same item, should use update instead")}catch(c){v.default.reportError(c)}var o;if(void 0===i&&(i=y.a.ChangeType.None),n){o=this._data[n];try{v.default.PAssert(981,o,"Parent must be valid if defined")}catch(c){v.default.reportError(c)}}var s={id:e,text:t};if(r)for(var u in r)r.hasOwnProperty(u)&&(s[u]=r[u]);var l=new Us(s,{store:this,parent:o,changeType:i,canDestroy:this._isDestructible,noSave:this._readonly,documentOwner:a});return this.numItems++,this._data[l.id]=l,l}},{key:"createItemRaw",value:function(e,t){try{v.default.PAssert(982,t.parent||t&&(t.isRoot||t.noSave||t.noParentOkay),"Must always specify a valid parentID when creating a new item")}catch(r){v.default.reportError(r)}this.checkDestroyed();try{v.default.PAssert(983,!!t.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(r){v.default.reportError(r)}try{v.default.PAssert(984,!!t.noSave===this._readonly,"When creating raw items, noSave must match")}catch(r){v.default.reportError(r)}t.store=this;var n=new Us(e,t);try{v.default.PAssert(985,!this._data[n.id],"Should not create an item that already exists in this store",(function(){var t=Object.assign({},e,{text:null,items:null});return v.default.safeStringify(t)}))}catch(r){v.default.reportError(r)}return this._data[n.id]=n,this.numItems++,n}},{key:"destroyItem",value:function(e){try{v.default.PAssert(986,this._isDestructible,"ItemStore must be destructible to destroy items")}catch(n){v.default.reportError(n)}var t=this._data[e];try{v.default.PAssert(987,t,"Must always destroy a valid item")}catch(n){v.default.reportError(n)}if(t){try{v.default.PAssert(988,!t.isDestroyed(),"Should never destroy an item twice")}catch(n){v.default.reportError(n)}t.parent()&&(t.parent().getChildIndex(t)>=0&&t.parent().removeChild(t,y.a.ChangeType.Local),t.setParent(void 0)),t.destroy()}delete this._data[e]}},{key:"removeItemFromStore",value:function(e){this._data[e].destroy(!0),delete this._data[e]}},{key:"modifyItemID",value:function(e,t){try{v.default.PAssert(989,e.belongsToItemStore(this),"Item must belong to this item store")}catch(n){v.default.reportError(n)}try{v.default.PAssert(990,e.id!==t,"Must actually be modifying the item ID")}catch(n){v.default.reportError(n)}try{v.default.PAssert(991,this._data[e.id],"Must have a valid item stored under the current ID: "+e.id+" - "+t+" - "+e.isDestroyed())}catch(n){v.default.reportError(n)}try{v.default.PAssert(992,!this._data[t],"Must not be overwriting an existing item"+e.id+" - "+t+" - "+e.isDestroyed())}catch(n){v.default.reportError(n)}delete this._data[e.id],this._data[t]=e}},{key:"manualModifyItemID",value:function(e,t){try{v.default.PAssert(993,!this._data[t],"Must not be overwriting an existing item"+e+" - "+t)}catch(r){v.default.reportError(r)}var n=this._data[e];try{v.default.PAssert(994,n,"Must have valid item to change its ID")}catch(r){v.default.reportError(r)}n&&(delete this._data[e],this._data[t]=n)}},{key:"addItemToRoot",value:function(e){this._root.items.push(e)}},{key:"removeItemFromRoot",value:function(e){this._root.items.remove(e)}},{key:"getItem",value:function(e){return this.checkDestroyed(),this._data[e]}},{key:"hasItem",value:function(e){return this.checkDestroyed(),!!this._data[e]}},{key:"getRoot",value:function(){return this.checkDestroyed(),this._root}},{key:"isRoot",value:function(e){return this.checkDestroyed(),this._root===e}},{key:"getCount",value:function(){return this.checkDestroyed(),Object.keys(this._data).length}},{key:"forEach",value:function(e){for(var t in this.checkDestroyed(),this._data)this._data[t]&&e(this._data[t])}},{key:"_markPaneDirty",value:function(e){e.usesItemStore(this)&&e!==v.default.focusedPane&&e.setItemsDirty()}},{key:"updateItems",value:function(e){var t=this;e&&!e.belongsToItemStore(this)||(Xh.PaneManager.runForEachPane((function(n){n.usesItemStore(t,e)&&(n.preventUpdateItemsForItem&&n.preventUpdateItemsForItem.item===e||n.setItemsDirty())})),Xh.PaneUpdateBatcher.updateAllItems())}},{key:"onItemChanged",value:function(e,t){var n,r=this;e&&!e.belongsToItemStore(this)||(Xh.PaneManager.runForEachPane((function(i){if(i.usesItemStore(r,e)){var a=i.handleItemChanged(e,t),o=e.getItemsLinkedTo();o&&o.forEach((function(e){e&&(e.itemChanged.notify(),i.handleItemChanged(e,t))})),n=n||a}})),Xh.PaneUpdateBatcher.updateAllItemHeights()),n&&Xh.PaneUpdateBatcher.updateAllItems()}}]),e}(),b()(js.prototype,"_markPaneDirty",[w.a],Object.getOwnPropertyDescriptor(js.prototype,"_markPaneDirty"),js.prototype),b()(js.prototype,"updateItems",[w.a],Object.getOwnPropertyDescriptor(js.prototype,"updateItems"),js.prototype),js);function Vs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Hs,Ws,qs,zs="DefaultStore",Gs=function(e){d()(n,e);var t=Vs(n);function n(){var e;return a()(this,n),(e=t.call(this))._itemStores={},e._iteratingStores=!1,e.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},e}return s()(n,[{key:"init",value:function(){var e=y.a.ItemStoreFilter.Dates|y.a.ItemStoreFilter.Priority;this.registerItemStore(zs,void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:e}).createRoot("Item store root","Item store root"),this._tempItemStore=this.registerItemStore("TempStore",void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})}},{key:"registerItemStore",value:function(e,t,n){try{v.default.PAssert(642,!this._itemStores[e],"Should only register a single item store per plugin: ",e)}catch(c){v.default.reportError(c)}try{v.default.PAssert(643,!this._iteratingStores,"Should never add a store while iterating")}catch(c){v.default.reportError(c)}var r=!0,i=!0,a=!0,o=!0,s=!1,u=y.a.ItemStoreFilter.None;Cs.a.runParseTextNew;n&&(void 0!==n.isReadonly&&(r=n.isReadonly),void 0!==n.isDestructible&&(i=n.isDestructible),void 0!==n.enabledFilters&&(u=n.enabledFilters),void 0!==n.parserFn&&n.parserFn,void 0!==n.trackGlobally&&(a=n.trackGlobally),void 0!==n.requireStoredEls&&(o=n.requireStoredEls),void 0!==n.listenToItemStateChanged&&(s=n.listenToItemStateChanged));var l=new Bs(e,r,i,a,o,s,u,t);return n&&n.noRegister||(this._itemStores[e]=l,this.fireEvent(this.Events.StoreAdded,l.getEnabledFilters(),[l])),l}},{key:"unregisterItemStore",value:function(e){try{v.default.PAssert(644,this._itemStores[e],"Must register an item store before destroying it")}catch(n){v.default.reportError(n)}try{v.default.PAssert(645,!this._iteratingStores,"Should never remove a store while iterating")}catch(n){v.default.reportError(n)}var t=this._itemStores[e];delete this._itemStores[e],t.destroy(),this.fireEvent(this.Events.StoreRemoved,t.getEnabledFilters(),[t])}},{key:"getItemStore",value:function(e){try{v.default.PAssert(646,this._itemStores[e],"Must register an item store before using it")}catch(t){v.default.reportError(t)}return this._itemStores[e]}},{key:"getDefaultItemStore",value:function(){return this._itemStores.DefaultStore}},{key:"getTempItemStore",value:function(){return this._tempItemStore}},{key:"runForEachStore",value:function(e,t){for(var n in t=t||y.a.ItemStoreFilter.None,this._iteratingStores=!0,this._itemStores)if(this._itemStores.hasOwnProperty(n)){var r=this._itemStores[n];if(t===y.a.ItemStoreFilter.None||r.areFiltersEnabled(t))try{e(r)}catch(i){v.default.reportError(i)}}this._iteratingStores=!1}}]),n}(S.a),Ks=n(46),Ys=(Hs=function(){function e(){a()(this,e),this._numTimesItemsUpdated=0,this._itemsUpdateTimeout=void 0,this._queuedPaneUpdates={},this.itemFlushStacks=[],this.EnableItemFlushStacks=!0,this._isUpdating=!1,this._numFlushesInCommit=0,this._isWaitingUpdateItems=0,this._itemsDirty=!1,this._itemHeightsDirty=!1,this._forceNotify=!1,this._updateSearch=!1,this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0}return s()(e,[{key:"checkItemsUpdated",value:function(){0}},{key:"notifyItemsUpdated",value:function(e,t){this._numTimesItemsUpdated++,this.EnableItemFlushStacks&&this.itemFlushStacks.push({stack:v.default.getCurrentStack("Update Items Stack"),panes:e,forceNotify:t}),this._itemsUpdateTimeout||(this._itemsUpdateTimeout=setTimeout(this.checkItemsUpdated,0))}},{key:"_updateAllItems",value:function(){var e=this._forceNotify;this._forceNotify=!1;var t=this._updateSearch;(this._updateSearch=!1,this._itemsDirty||e)&&(this._itemsDirty=!1,this._isUpdating=!0,Ks.a.beginBatch(),Xh.PaneManager.runForEachPane((function(n){(e||n.isItemsDirty())&&n.updateItemsImmediate(t,e)})),Ks.a.endBatch(),this._isUpdating=!1)}},{key:"queuePaneUpdate",value:function(e,t,n){var r=this._queuedPaneUpdates[e.id];r||(r=this._queuedPaneUpdates[e.id]={}),r.forceNotify=r.forceNotify||n,r.updateSearch=r.updateSearch||t}},{key:"flushQueuedUpdates",value:function(e){var t=this._queuedPaneUpdates[e.id];t&&(e.updateItemsImmediate(t.updateSearch,t.forceNotify),delete this._queuedPaneUpdates[e.id])}},{key:"updateWatchdog",value:function(){v.default.log("Last Update Items Stack: "+this._lastUpdateItemsStack);try{v.default.PAssert(721,!1,"Update Watchdog Triggered - This should never happen.",this._isWaitingUpdateItems)}catch(e){v.default.reportError(e)}this._isWaitingUpdateItems=1,this.commitUpdateItems()}},{key:"isUpdatingItems",value:function(){return this._isWaitingUpdateItems>0&&this._itemsDirty}},{key:"beginUpdateItems",value:function(){this._isWaitingUpdateItems++,Ks.a.beginBatch(),1===this._isWaitingUpdateItems&&(this._lastUpdateItemsStack=v.default.getCurrentStack("Update Items Stack"),this._itemsUpdateWatchdog=setTimeout(this.updateWatchdog,0))}},{key:"commitUpdateItems",value:function(e,t){try{v.default.PAssert(724,this._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",this._isWaitingUpdateItems)}catch(n){v.default.reportError(n)}this._isWaitingUpdateItems--,0===this._isWaitingUpdateItems&&(clearTimeout(this._itemsUpdateWatchdog),this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0,this._numFlushesInCommit=0,!this._itemsDirty&&this._itemHeightsDirty&&this._updateAllItemHeights(),this._itemHeightsDirty=!1),this._itemsDirty&&this.updateAllItems(e,t),Ks.a.endBatch()}},{key:"flushItemsUpdate",value:function(e){return!!this.isUpdatingItems()&&(e?e.isItemsDirty()&&(this._itemsDirty||this._forceNotify)&&(this._numFlushesInCommit++,e.updateItemsImmediate(this._updateSearch,this._forceNotify)):(this._numFlushesInCommit++,this._updateAllItems()),!0)}},{key:"updateAllItems",value:function(e,t){try{v.default.PAssert(725,void 0===e||v.default.isBoolean(e),"Must supply a bool param for updateSearch")}catch(n){v.default.reportError(n)}try{v.default.PAssert(726,void 0===t||v.default.isBoolean(t),"Must supply a bool param for forceNotify")}catch(n){v.default.reportError(n)}this._itemsDirty=!0,t&&(this._forceNotify=t),e&&(this._updateSearch=e),0===this._isWaitingUpdateItems&&this._updateAllItems()}},{key:"_updateAllItemHeights",value:function(){Xh.PaneManager.runForEachPane((function(e){e.itemsHeightDirty&&e.updateItemHeights()}))}},{key:"updateAllItemHeights",value:function(){0===this._isWaitingUpdateItems?this._updateAllItemHeights():this._itemHeightsDirty=!0}}]),e}(),b()(Hs.prototype,"checkItemsUpdated",[w.a],Object.getOwnPropertyDescriptor(Hs.prototype,"checkItemsUpdated"),Hs.prototype),b()(Hs.prototype,"updateWatchdog",[w.a],Object.getOwnPropertyDescriptor(Hs.prototype,"updateWatchdog"),Hs.prototype),Hs),Qs=n(76),Xs="Suspend",$s="Resume",Js="AsyncSkip",Zs="SyncSkip",eu="Run",tu="AsyncBegin",nu="AsyncComplete",ru="AsyncAbort",iu="AsyncTimeout",au=(Ws=function(){function e(t,n){a()(this,e);try{v.default.PAssert(1013,n,"Must provide a valid set of task options: "+t)}catch(r){v.default.reportError(r)}this._id=t,this._iterationID=void 0,this._isAsync=n.async,this._isAsyncRunning=!1;try{v.default.PAssert(1015,n.task&&v.default.isFunction(n.task),"Must provide a valid task function")}catch(r){v.default.reportError(r)}this._task=n.task,this._delay=n.delay;try{v.default.PAssert(1016,void 0===n.asyncTimeout||n.async,"Should never specify an async timeout for a non-async task")}catch(r){v.default.reportError(r)}this._asyncTimeout=n.asyncTimeout||0,this._pauseWhileIdle=n.pauseWhileIdle||!1,this._minDelayOnResume=n.minDelayOnResume||!1;try{v.default.PAssert(1017,this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume")}catch(r){v.default.reportError(r)}this._suspended=!1,this._remainingTime=0,this._lastUpdate=n.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=n.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new Qs.a(10),this._actions=new Qs.a(20),this.init()}return s()(e,[{key:"init",value:function(){this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()}},{key:"getStats",value:function(){return{numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()}}},{key:"cancel",value:function(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0}},{key:"abortAsync",value:function(){this._numAsyncAborts++,this.performAction(ru),this._notifyAsyncAborted()}},{key:"performAction",value:function(e){try{v.default.PAssert(1018,e,"Invalid action reported")}catch(t){v.default.reportError(t)}this._actions.push({action:e,time:Date.now()})}},{key:"notifyOfSuspend",value:function(){this._pauseWhileIdle&&(this.performAction(Xs),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)}},{key:"notifyOfResume",value:function(){if(this._pauseWhileIdle){this.performAction($s);var e,t=!this._suspended;if(this._suspended=!1,this._minDelayOnResume)e=Math.max(0,this._minDelay-this._timeSinceLastUpdate());else{try{v.default.PAssert(1019,t||this._remainingTime>=0,"Must have a valid remaining time set for task")}catch(n){v.default.reportError(n)}e=this._remainingTime,this._remainingTime=-1}e=Math.max(500,e),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e)}}},{key:"isAsync",value:function(){return this._isAsync}},{key:"isAsyncRunning",value:function(){return this.isAsync()&&this._isAsyncRunning}},{key:"_notifyUpdateAsyncSkipped",value:function(){this._numUpdatesAsyncSkipped++,this.performAction(Js)}},{key:"_notifyUpdateSkipped",value:function(){this._numUpdatesSkipped++,this.performAction(Zs)}},{key:"_notifyUpdateRun",value:function(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(eu)}},{key:"_timeSinceLastUpdate",value:function(){return Date.now()-this._lastUpdate}},{key:"_asyncRunTime",value:function(){var e=0;return this._asyncStartTime>0&&(e=Date.now()-this._asyncStartTime),e}},{key:"_notifyAsyncBegin",value:function(){return this.performAction(tu),this._isAsyncRunning=!0,this._iterationID=v.default.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID}},{key:"_notifyAsyncComplete",value:function(){this.performAction(nu),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_notifyAsyncAborted",value:function(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_handleAsyncAbortTimeout",value:function(){this._numAsyncTimeouts++,this.performAction(iu),this._notifyAsyncAborted()}},{key:"_runUpdate",value:function(e){var t=arguments,n=this;try{v.default.PAssert(1020,!this._isCancelled,"Should never run a cancelled task")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1022,!this._updateIsRunning,"Should not run another update while already running one: "+this._id)}catch(i){v.default.reportError(i)}if(!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,e),0)):this._notifyUpdateAsyncSkipped();else{var r=this._notifyAsyncBegin();try{this._task((function(){try{v.default.PAssert(1024,r===n._iterationID,"Callback is only valid while task is considered running")}catch(i){v.default.reportError(i)}n._notifyAsyncComplete(),e&&e.apply(n,t)}))}catch(a){v.default.reportError(a),this._notifyAsyncComplete()}}else try{this._task()}catch(a){v.default.reportError(a)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}}},{key:"requestUpdate",value:function(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var e=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e),this._lastSetDelay=this._minDelay}}},{key:"forceUpdate",value:function(e){this._runUpdate(e)}},{key:"breakOnNextUpdate",value:function(){0}}]),e}(),b()(Ws.prototype,"_notifyAsyncComplete",[w.a],Object.getOwnPropertyDescriptor(Ws.prototype,"_notifyAsyncComplete"),Ws.prototype),b()(Ws.prototype,"_handleAsyncAbortTimeout",[w.a],Object.getOwnPropertyDescriptor(Ws.prototype,"_handleAsyncAbortTimeout"),Ws.prototype),b()(Ws.prototype,"_runUpdate",[w.a],Object.getOwnPropertyDescriptor(Ws.prototype,"_runUpdate"),Ws.prototype),Ws),ou=function(){function e(){a()(this,e),this._tasks={}}return s()(e,[{key:"init",value:function(){window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this))}},{key:"getStats",value:function(){var e=this,t={};return Object.keys(this._tasks).forEach((function(n){return t[n]=e._tasks[n].getStats()})),t}},{key:"createRecurringTask",value:function(e,t){try{v.default.PAssert(714,!this._tasks[e],"Must not register multiple tasks with the same ID")}catch(r){v.default.reportError(r)}var n=new au(e,t);return this._tasks[e]=n,n}},{key:"getRecurringTask",value:function(e){try{v.default.PAssert(715,this._tasks[e],"Must only retreive a valid recurring task")}catch(t){v.default.reportError(t)}return this._tasks[e]}},{key:"hasRecurringTask",value:function(e){return!!this._tasks[e]}},{key:"cancelRecurringTask",value:function(e){try{v.default.PAssert(716,this._tasks[e],"Must only cancel a valid recurring task")}catch(t){v.default.reportError(t)}this._tasks[e].cancel(),delete this._tasks[e]}},{key:"_handleFocus",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfResume()}},{key:"_handleBlur",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfSuspend()}}]),e}(),su=1e5,uu=new(function(){function e(){a()(this,e)}return s()(e,[{key:"ensurePolyfill",value:function(){var e=Bo()(jo.a.mark((function e(t,r){var i,a,o;return jo.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:e.next=5;break;case 5:if(window.TextEncoder&&window.TextDecoder){e.next=12;break}return window.TextEncoder=window.TextDecoder=null,e.next=9,n.e(2).then(n.t.bind(null,233,7));case 9:o=e.sent,window.TextEncoder=o.TextEncoder,window.TextDecoder=o.TextDecoder;case 12:i=window.TextEncoder,a=window.TextDecoder;case 14:this.textEncoder=new i,this.textDecoder=new a,r();case 17:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"ab2str",value:function(e){var t="";try{var n=new Uint8Array(e);if(n.length>su){var r,i,a,o=0;for(r=0,i=n.length;r<i;r+=su){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;a=n.slice(r,r+su),t+=String.fromCharCode.apply(null,a)}}else t=String.fromCharCode.apply(null,n)}catch(s){v.default.reportError(s)}return t}},{key:"str2ab",value:function(e){for(var t=0,n=new ArrayBuffer(e.length),r=new Uint8Array(n),i=0,a=e.length;i<a;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[i]=e.charCodeAt(i)}return r}},{key:"unicode2ab",value:function(e){return this.textEncoder.encode(e)}},{key:"ab2unicode",value:function(e){return this.textDecoder.decode(e)}}]),e}()),lu=new(function(){function e(){a()(this,e)}return s()(e,[{key:"deriveKey",value:function(e,t){var n=uu.textEncoder.encode(e),r=uu.str2ab(t);return crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then((function(e){return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:2e5,hash:"SHA-512"},e,{name:"AES-CTR",length:256},!1,["encrypt","decrypt"])})).then((function(e){return e}))}},{key:"importKey",value:function(e){return crypto.subtle.importKey("raw",e,"AES-CTR",!0,["encrypt","decrypt"])}},{key:"exportKey",value:function(e){return crypto.subtle.exportKey("raw",e)}},{key:"encrypt",value:function(e,t,n){var r={name:"AES-CTR",counter:n,length:128};return crypto.subtle.encrypt(r,t,e)}},{key:"decrypt",value:function(e,t,n){var r={name:"AES-CTR",counter:n,length:128};return crypto.subtle.decrypt(r,t,e)}}]),e}()),cu=new(function(){function e(){a()(this,e)}return s()(e,[{key:"key",value:function(e,t){return lu.deriveKey(e,t)}},{key:"saltToCounter",value:function(e){var t=uu.str2ab(e);if(t.length>16)t=t.slice(0,16);else if(t.length<16){for(var n=0,r=new Uint8Array(16),i=0;i<t.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i]=t[i]}t=r}return t}},{key:"encrypt",value:function(e,t,n){var r=this.saltToCounter(n),i=uu.unicode2ab(e);return lu.encrypt(i,t,r).then((function(e){return uu.ab2str(e)}))}},{key:"decrypt",value:function(e,t,n){var r=this.saltToCounter(n),i=uu.str2ab(e);return lu.decrypt(i,t,r).then((function(e){return uu.ab2unicode(e)}))}}]),e}()),du="afolaw8klslbsahgbeoiya4pifoqlncduzvxgze60lvk17sevauroatsxm8qqia",hu=new Uint8Array([76,30,217,70,117,53,119,240,33,22,147,24,106,228,253,86,175,251,159,47,232,124,89,230,19,65,243,211,58,83,88,158]).buffer;function fu(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,fu):this.stack=(new Error).stack}function pu(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,pu):this.stack=(new Error).stack}fu.prototype=Object.create(Error.prototype),fu.prototype.name="InvalidArgumentError",fu.prototype.constructor=fu,pu.prototype=Object.create(fu.prototype),pu.prototype.name="InvalidPasswordError",pu.prototype.constructor=pu;var gu,vu=(qs=function(){function e(){var t=this;a()(this,e),this.sentinel=y.a.EncryptionSentinel,this.keys={},this.onLoadCbs=[],this.onUpdated=new Q.a,this.importKeys({}).then((function(){t.isLoaded=!0,t.onLoadCbs.forEach((function(e){return e()}))}))}return s()(e,[{key:"onLoad",value:function(e){this.isLoaded?e():this.onLoadCbs.push(e)}},{key:"canDecryptSentinel",value:function(e){return!!this.getKeyBySentinel(e)}},{key:"getKeyBySentinel",value:function(e){for(var t in this.keys)if(this.keys[t].sentinel===e)return this.keys[t].key}},{key:"encryptSentinel",value:function(e,t){return cu.encrypt(this.sentinel,e,t)}},{key:"createKeyInfo",value:function(e){var t=this,n=e.name,r=e.password,i=e.sentinelSalt;return cu.key(r,du).then((function(e){return t.encryptSentinel(e,i).then((function(t){return{name:n,key:e,sentinel:t}}))}))}},{key:"importKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.keys.Global||(t[y.a.EncryptionKeys.Global]=hu),t[y.a.EncryptionKeys.UserPassword]&&!Eo.a.getEncryptionUid()?new Promise((function(n){Xh.settings.userId.onHasValue((function(r){e.importKeys(t).then((function(e){return n(e)}))}))})):Promise.all(Object.keys(t).map((function(n){var r=t[n],i=(n===y.a.EncryptionKeys.Global?du:n===y.a.EncryptionKeys.UserPassword&&Eo.a.getEncryptionUid())||n;return r instanceof CryptoKey?e.encryptSentinel(r,i).then((function(t){e.keys[n]={name:n,key:r,sentinel:t}})):(v.default.isString(r)&&(r=uu.str2ab(r)),lu.importKey(r).then((function(t){return e.encryptSentinel(t,i).then((function(r){e.keys[n]={name:n,key:t,sentinel:r}}))})))}))).then((function(){return e.keys})).catch((function(t){return console.log(t),e.onUpdated.notify(),e.keys}))}},{key:"getGlobalKeyInfo",value:function(){return this.keys[y.a.EncryptionKeys.Global]}},{key:"getGlobalKey",value:function(){return this.keys[y.a.EncryptionKeys.Global].key}},{key:"getKey",value:function(e){return this.keys[e].key}},{key:"getKeyInfo",value:function(e){return this.keys[e]}},{key:"setKey",value:function(e){var t=this,n=e.name,r=e.password,i=e.sentinelSalt;return this.createKeyInfo({name:n,password:r,sentinelSalt:i}).then((function(e){return t.keys[n]=e,t.onUpdated.notify(),e}))}},{key:"canDecrypt",value:function(e){var t=e.source,n=e.target,r=e.key;return cu.decrypt(t,r.key,r.salt).then((function(e){return e===n}))}},{key:"findDecryptKeys",value:function(e){var t=e.source,n=e.target,r=e.keys,i=v.default.objectValues(r).map((function(e){return cu.decrypt(t,e.key,e.salt).then((function(t){return{name:e,text:t}}))}));return Promise.all(i).then((function(e){return e.filter((function(e){return e.text===n})).map((function(e){return e.name}))}))}},{key:"addKey",value:function(e){var t=e.name,n=e.password,r=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new fu("Name must be a string. Saw: ".concat(t))):t in this.keys?Promise.reject(new fu("".concat(t," exists. Use 'updateKey' to change existing keys."))):this.setKey({name:t,password:n,sentinelSalt:r})}},{key:"updateKey",value:function(e){var t=e.name,n=e.password,r=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new fu("Name must be a string. Saw: ".concat(t))):t in this.keys?this.setKey({name:t,password:n,sentinelSalt:r}):Promise.reject(new fu("".concat(t," does not exist. Use 'addKey' to add new key.")))}},{key:"removeKey",value:function(e){delete this.keys[e]}},{key:"createKey",value:function(e){var t=e.name,n=e.password,r=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new fu("Name must be a string. Saw: ".concat(t))):this.createKeyInfo({name:t,password:n,sentinelSalt:r})}},{key:"exists",value:function(e){return!!(e in this.keys)}},{key:"encryptText",value:function(e,t,n){var r="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;try{v.default.PAssert(734,r,"No valid encryption key")}catch(i){v.default.reportError(i)}return"string"!==typeof t?Promise.reject(new fu("Text must be a string. Saw: ".concat(t))):cu.encrypt(t,r,n)}},{key:"decryptText",value:function(e,t,n){var r="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;return"string"!==typeof t?Promise.reject(new fu("Text must be a string. Saw: ".concat(t))):cu.decrypt(t,r,n)}},{key:"exportKey",value:function(e){return lu.exportKey(e)}}]),e}(),b()(qs.prototype,"addKey",[w.a],Object.getOwnPropertyDescriptor(qs.prototype,"addKey"),qs.prototype),b()(qs.prototype,"updateKey",[w.a],Object.getOwnPropertyDescriptor(qs.prototype,"updateKey"),qs.prototype),qs);function mu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var yu,_u,bu=["platforms","appHotkeys","hotkeys","syncAccounts","documentIndices","font","syncAccountRefreshParts","driveFolders"],wu=["emailViewAccounts"],ku=["syncAccountRefreshParts"],Su=(gu=function(e){d()(n,e);var t=mu(n);function n(){var e;return a()(this,n),(e=t.call(this)).oldSettings={c:!0,u:!0,aA:!0,t:!0,z:!0,aX:!0},e.onLoadCbs=[],e.onLoadRemoteCbs=[],e.init(),e}return s()(n,[{key:"init",value:function(){var e=this;this._allSettings=[],this._allGroups=[],this._groupAbbrevs={},this._groupAbbrevsIn={},this.registerGroup(this,""),this.registerGroup("ui","u");var t=[["agendaSort","a",this.createDefaultAgendaSort()],["backupFrequency","d",0],["calendarCustomDays","e",3],["closedImport","f"],["closedHelps","g"],["closedVideo","h"],["dateFormat","i",y.a.DateFormat.MDY],["dayWeekStart","j",0],["defaultItemPrefix","k",""],["helpPaneState","l"],["helpState","m"],["inTooltipIntro","n"],["backupsDrive","o"],["needsBackup","p"],["notificationDelay","q",30],["openEvernoteApp","r",!0],["panesMobile","s"],["showFormattingToolbar","v",1],["showMarkdown","w"],["showImagesInline","x",!0],["shownTutorial","y"],["trialOverHidden","A"],["userEncryptionSentinel","aE"],["encryptBackup","aH"],["driveFolders","aI"],["fixedMissingCalendars","aJ"],["platforms","aK"],["encryptLocalFiles","aM"],["syncAccounts","aN",{}],["panesRN","aO"],["testBetaFeatures","aQ"],["appSystemDarkMode","aS",!0],["appHotkeys","aT"],["showDebugInfo","aU"],["hotkeys","aV"],["documentIndices","aW"],["alignIndentToPrefix","bc"],["syncAccountRefreshParts","be",{}],["useServerAuth","bf",!0],["emailViewAccounts","bi",[]],["archiveEmailsOnOrganize","bj"]],n=[["activeUser","b"],["cacheSizeRatio","B",1],["disableNotifications","C"],["displayName","D"],["lastContactSync","I"],["lastServerVersion","J"],["lastTaskSync","K"],["lastQuickAddSync","L"],["localDataVersion","M",7],["localIntegrity","N"],["localPaneState","O"],["localRecoverVersion","P"],["notifiedTrialOver","R"],["notifiedTrialEndSoon","S"],["selectedBoard","V"],["showSidebar","W",!1],["sidebarWidth","X",y.a.DesktopMenuWidthDefault],["userId","ab"],["encryptionKeys","aD"],["lastSync","aF"],["userProperties","aG"],["backupLocal","aL",!0],["refreshTokensRN","aR"],["disableAnimations","bd"],["panesInViewMobile","bg"]],r=[["boldHeaders","ac",!1],["bulletOpacity","ad",30],["checkboxOpacity","ae",30],["checkboxBackgroundOpacity","af",0],["contactColor","ag","#22AA66"],["dateColor","ah","#AA3300"],["displayPrefixes","ai",y.a.DisplayTheme.PrefixesFaded],["displaySpacing","aj",y.a.DisplayTheme.SpacingComfortable],["fontSize","ak",14],["fontSizeHeader","al",16],["fontSizeHeaderTopLevel","am",18],["grayscale","an",!1],["itemIndentSize","ao",30],["itemLineHeight","ap",18],["itemPadding","aq",5],["linkColor","ar","#3333BB"],["noteFontSize","as",12],["noteLineHeight","at",18],["notePadding","au",0],["projectOpacity","av",30],["showVerticalLines","aw",!0],["tagColor","ax","#0099DD"],["themeDesktop","ay","auto"],["underlineP","az",!1],["verticalLinesOpacity","aC",6],["cursorBlink","aP",!0],["font","aY",{}],["fontWeight","aZ","normal"],["numListOpacity","ba",30],["collapserOpacity","bb",30],["themeMobile","bh","auto"]];this.registerSettings(t,this,!0),this.registerSettings(n,this,!1),this.registerSettings(r,this.ui,!0),v.default.isDemoMode()&&this.activeUser.set("demo"),this.syncAccounts.listen((function(t){if(t){var n=!1;if(void 0!==t.undefined){try{v.default.PAssert(736,!1,"Sync account is somehow undefined")}catch(r){v.default.reportError(r)}e.syncAccounts.deleteProperty("undefined"),n=!0}else Object.keys(t).forEach((function(e){var r=e.toLowerCase();e!==e.toLowerCase()&&(t[r]=t[e],delete t[e],n=!0)}));n&&setTimeout((function(){e._save("syncAccounts",void 0,e.syncAccounts.get())}),0)}})),this.encryptionKeys.listen(this._onEncryptionKeysChange)}},{key:"load",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){var i,a,o=this;return jo.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(i=[],!n&&!r){e.next=4;break}return e.next=4,Promise.all(Object.keys(t).filter((function(e){return ku.includes(o.getSettingInfoFromAbbrev(e).key)})).map(function(){var e=Bo()(jo.a.mark((function e(n){var r,i;return jo.a.wrap((function(e){for(var a=0,s=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return r=o.getSettingInfoFromAbbrev(n),i=r.key,e.next=3,o.decryptValue(i,t[n].v,Xh.crypto.getKeyInfo(o.getBestUserEncryption()));case 3:t[n].v=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:this.isLoading=!0,Object.keys(t).map((function(e){var n=o.getSettingInfoFromAbbrev(e),r=n.group,a=n.key,s=t[e].v;if(r&&r[a])if("isEnabled"===a)i.push({group:r,key:a,value:s});else{var u=r[a].get();if(void 0===s||null===s)void 0!==s&&null!==s||(s=r._settingsDefault[a]),r[a].set(s);else if(!v.default.isObject(u)||!v.default.isObject(s)||!v.default.deepEqual(u,s)){if(v.default.isString(s)&&(bu.includes(a)||wu.includes(a)))try{s=JSON.parse(s)}catch(l){}r[a].set(s)}}})),i.forEach((function(e){var t=e.group,n=e.key,r=e.value;t[n].set(r)})),a=function(){return JSON.stringify({uid:o.userId.get(),name:o.displayName.get(),email:o.activeUser.get()})};try{v.default.PAssert(737,!this.userId.get()||this.userId.get().length>4,"Bad UID",a)}catch(u){v.default.reportError(u)}n&&(this._allSettings.forEach((function(e){if(!t[e.path]){var n=e.group._settingsDefault[e.key];e.setting.get()!==n&&e.setting.set(n)}})),!this.userEncryptionSentinel.get()&&Xh.crypto.getKeyInfo(y.a.EncryptionKeys.UserPassword)&&this.removeEncryptionKey(y.a.EncryptionKeys.UserPassword),setTimeout((function(){"string"===typeof o.platforms.get()&&o.platforms.set({},!1),o.platforms.setProperty(k.a.getUserPlatformConfig(),{d:Date.now(),v:y.a.jsVersion})}),0)),"Sunday"===this.dayWeekStart.get()&&this.dayWeekStart.set(0),"Monday"===this.dayWeekStart.get()&&this.dayWeekStart.set(1),Xh.DisplaySettings.init(),this.isLoading=!1,this._isLoaded=!0,this.onLoadCbs.forEach((function(e){return e()})),this.onLoadCbs=[],n&&(this.onLoadRemoteCbs.forEach((function(e){return e()})),this.onLoadRemoteCbs=[],this._isLoadedRemote=!0);case 18:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"registerGroup",value:function(e,t,n){var r,i=this,a=[];v.default.isString(e)&&(v.default.shouldLog(y.a.LogLevels.Settings)&&v.default.log("SETTINGS: Registered Group - ",e),r=e,this[e]={oldSettings:n},e=this[e]),e.listen=function(e){a.push(e)},e.unlisten=function(e){a.remove(e)},e.onChange=function(e,t,n){if(i._isLoaded&&(v.default.isObject(t)?!v.default.deepEqual(t,n):t!==n)){var o=0;i._save(e,r,t);for(var s=0;s<a.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;a[s](t,n)}}},e._settingsDefault||(e._settingsRemote={},e._settingsDefault={},e._settingsAbbrevs={},e._settingsAbbrevsIn={}),this._allGroups.push({id:t,group:e}),r&&(this._groupAbbrevs[r]=t,this._groupAbbrevsIn[t]=r)}},{key:"registerSettings",value:function(e,t,n){for(var r=0,i=0;i<e.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i],o=a[0],s=a[1],u=a[2];this.registerSetting(o,s,t,n,u)}}},{key:"registerSetting",value:function(e,t,n,r,i){if(v.default.isString(n)&&(n=this[n]),r&&(n._settingsRemote[e]=!0),void 0!==i&&(n._settingsDefault[e]=i),n._settingsAbbrevs[e]=t,n._settingsAbbrevsIn[t]=e,bu.includes(e)?n[e]=new Ho.a(i,n.onChange.bind(this,e)):wu.includes(e)?n[e]=new Y.a(i,n.onChange.bind(this,e)):n[e]=new E.a(i,n.onChange.bind(this,e),!0),r){var a=this._allGroups.indexOfWithProperty("group",n);if(a>=0){var o=this._allGroups[a].id;this._allSettings.push({path:(o?o+"\\":"")+t,group:n,key:e,abbrev:t,setting:n[e]})}else 0}}},{key:"getDefaultItemText",value:function(e){return(e=e||this.defaultItemPrefix.get())?e+" ":""}},{key:"getSettingAbbrev",value:function(e,t){return(t?this[t]:this)._settingsAbbrevs[e]}},{key:"getSettingInfoFromAbbrev",value:function(e){var t,n,r=e.split("\\");if(r.length>1?(n=this[n=this._groupAbbrevsIn[r[0]]],t=r[1]):(n=this,t=r[0]),(!n.oldSettings||!n.oldSettings[t])&&(t=n._settingsAbbrevsIn[t],!e.includes("\\")||!e.endsWith("w"))){0;try{v.default.PAssert(738,n&&n[t],"Missing group for setting",e)}catch(i){v.default.reportError(i)}}return{group:n,key:t}}},{key:"getValueFromAbbrev",value:function(e){var t=this.getSettingInfoFromAbbrev(e),n=t.group,r=t.key;if(n&&n[r])return n[r].get()}},{key:"_save",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){var i,a,o,s,u,l;return jo.a.wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(i=n?this[n]:this,a=!this.isLoading&&i._settingsRemote[t],o=i._settingsAbbrevs[t],s=n?this._groupAbbrevs[n]+"\\":"",u=s+o,!ku.includes(t)){e.next=14;break}return e.next=11,this.getEncryptedValue(t,r,Xh.crypto.getKeyInfo(this.getBestUserEncryption()));case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=r;case 15:l=e.t0,N.a.setSetting(u,r,a,l);case 17:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEncryptionKey",value:function(e){var t=this._encryptionKeyInfo;return t&&t[e]?t[e].key:void 0}},{key:"removeEncryptionKey",value:function(e){var t=Object.assign({},this.encryptionKeys.get());Xh.crypto.removeKey(e),delete t[e],this.encryptionKeys.set(t)}},{key:"addEncryptionKey",value:function(){var e=Bo()(jo.a.mark((function e(t,n){var r;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:(r=Object.assign({},this.encryptionKeys.get()))[t]=n,e.next=6;break;case 6:return e.abrupt("return",this.setEncryptionKeys(r));case 7:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setEncryptionKeys",value:function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return this._isSettingEncryptionKeys=!0,this.encryptionKeys.set(t),this._isSettingEncryptionKeys=!1,e.abrupt("return",this._onEncryptionKeysChange(t));case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"shouldShowHelp",value:function(e){var t=this.closedHelps.get();return!t||!t[e]}},{key:"closeHelp",value:function(e){var t=v.default.clone(this.closedHelps.get())||{};t[e]=!0,this.closedHelps.set(t)}},{key:"uncloseHelp",value:function(e){var t=v.default.clone(this.closedHelps.get())||{};delete t[e],this.closedHelps.set(t)}},{key:"isBackupEnabled",value:function(){return this.backupFrequency.get()>0}},{key:"hasUserPassword",value:function(){var e=this.encryptionKeys.get();return e&&!!e[y.a.EncryptionKeys.UserPassword]}},{key:"getBestUserEncryption",value:function(){var e=this.encryptionKeys.get();return e&&e[y.a.EncryptionKeys.UserPassword]?y.a.EncryptionKeys.UserPassword:y.a.EncryptionKeys.Global}},{key:"createDefaultAgendaSort",value:function(){return{overdue:-2,"#now":-1,starred:1,important:2,"#next":3,"#soon":101,"#later":301,"#someday":1401}}},{key:"getUserIdentifier",value:function(){return v.default.isDemoMode()?"demouser":this.activeUser.get()}},{key:"onLoaded",value:function(e){this._isLoaded?e():this.onLoadCbs.push(e)}},{key:"onLoadedRemote",value:function(e){this._isLoadedRemote?e():this.onLoadRemoteCbs.push(e)}},{key:"_onEncryptionKeysChange",value:function(){var e=Bo()(jo.a.mark((function e(t){var n,r;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(this._isSettingEncryptionKeys){e.next=8;break}return this._encryptionKeyInfo={},n={},Object.keys(t).forEach((function(e){n[e]=t[e]})),e.next=6,Xh.crypto.importKeys(n);case 6:r=e.sent,this._encryptionKeyInfo=r;case 8:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedSettings",value:function(){var e=this;return ku.map((function(t){var n=e.getSettingAbbrev(t),r=e.getValueFromAbbrev(n);if(r)return[t,n,r]})).filter((function(e){return!!e}))}},{key:"getRemoteSaveValue",value:function(){var e=Bo()(jo.a.mark((function e(t,n){var r;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(r=this[t].get(),!ku.includes(t)){e.next=3;break}return e.abrupt("return",this.getEncryptedValue(t,r,n));case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getEncryptedValue",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){var i;return jo.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!v.default.isObject(n)){e.next=7;break}return i=v.default.clone(n),e.next=4,Promise.all(Object.keys(n).map(function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var a=0,o=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,Xh.crypto.encryptText(r.key,n[t],t);case 2:i[t]=e.sent;case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",i);case 7:return e.abrupt("return",Xh.crypto.encryptText(r.key,n,t));case 8:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"decryptValue",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!v.default.isObject(n)){e.next=6;break}return e.next=3,Promise.all(Object.keys(n).map(function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,Xh.crypto.decryptText(r.key,n[t],t);case 2:n[t]=e.sent;case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",n);case 6:return e.abrupt("return",Xh.crypto.decryptText(r.key,n,t));case 7:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"addEmailViewAccount",value:function(e,t,n,r){this.emailViewAccounts.find((function(n){return n.e===e&&n.s===t}))||this.emailViewAccounts.push(v.default.removeNullUndefined({e:e,s:t,n:n,b:r}))}}]),n}(S.a),b()(gu.prototype,"_onEncryptionKeysChange",[w.a],Object.getOwnPropertyDescriptor(gu.prototype,"_onEncryptionKeysChange"),gu.prototype),gu),Eu=0,Pu=(yu=function(){function e(t,n){a()(this,e);try{v.default.PAssert(1037,t,"Must provide valid message info")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1038,n,"Must provide a valid message owner")}catch(r){v.default.reportError(r)}if(this.info=t,this.id=t.id||"Message_"+Eu++,this.owner=n,this.timeout=t.timeout||y.a.ToastTimeoutDefault,this.text=new E.a(t.text),this.action=t.action||y.a.MessageAction.Default,this.action2=t.action2,this.isBig=t.big,this.noClose=t.noClose,this.data=t.data,this.hold=!t.timeout&&!1!==t.hold&&(t.hold||this.action!==y.a.MessageAction.Default),this.hold&&(this.timeout=Number.MAX_SAFE_INTEGER),this.noIgnore=t.noIgnore,this.onCloseFn=t.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=t.actionText,!this.actionText)switch(this.action){case y.a.MessageAction.Default:this.actionText="";break;case y.a.MessageAction.Reload:case y.a.MessageAction.ResetClient:this.actionText="RELOAD";break;case y.a.MessageAction.Okay:this.actionText="OKAY";break;case y.a.MessageAction.Blog:this.actionText="BLOG";break;case y.a.MessageAction.Undo:this.actionText="UNDO";break;case y.a.MessageAction.LoginScreen:this.actionText="LOGIN";break;case y.a.MessageAction.Contact:this.actionText="CONTACT";break;case y.a.MessageAction.OpenSettings:case y.a.MessageAction.OpenAccountSettings:case y.a.MessageAction.OpenGeneralSettings:case y.a.MessageAction.OpenCalendarSettings:this.actionText="SETTINGS";break;case y.a.MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case y.a.MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case y.a.MessageAction.StartDemo:this.actionText="START DEMO"}}return s()(e,[{key:"show",value:function(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide,this.timeout)),this.owner.onMessageShow(this))}},{key:"hide",value:function(){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),this.owner.onMessageHide(this))}},{key:"isVisible",value:function(){return this._isVisible}},{key:"doAction",value:function(e){if(this.isVisible()){if(v.default.isFunction(this.action))this.action();else switch(this.action){case y.a.MessageAction.None:case y.a.MessageAction.Okay:case y.a.MessageAction.Default:break;case y.a.MessageAction.Reload:v.default.reload();break;case y.a.MessageAction.LoginScreen:G.a.removeURLParam("demo"),G.a.removeURLParam("demo",!0);break;case y.a.MessageAction.Demo:G.a.insertURLParam("demo","true");break;case y.a.MessageAction.ResetClient:break;case y.a.MessageAction.OpenURL:var t=this.data?this.data.url:void 0;try{v.default.PAssert(1039,t,"Should always have a valid URL to navigate")}catch(n){v.default.reportError(n)}t&&Xh.openUrl(t);break;case y.a.MessageAction.Blog:Xh.openUrl("https://www.moo.do/blog/updates");break;case y.a.MessageAction.Undo:xs.a.undo();break;case y.a.MessageAction.Contact:Xh.menus.openModal(y.a.Modals.ReportBug);break;case y.a.MessageAction.OpenSettings:Xh.menus.openSettings("Plugins");break;case y.a.MessageAction.OpenGeneralSettings:Xh.menus.openSettings("General");break;case y.a.MessageAction.OpenAccountSettings:Xh.menus.openSettings("Account");break;case y.a.MessageAction.OpenCalendarSettings:Xh.menus.openSettings("Calendar");break;case y.a.MessageAction.OpenGoogleDrive:Xh.openUrl("https://drive.google.com");break;case y.a.MessageAction.OpenDisplaySettings:Xh.DisplaySettings.isOpen.set(!0);break;case y.a.MessageAction.StartDemo:window.postMessage("resume","*");break;default:try{v.default.PAssert(1040,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(n){v.default.reportError(n)}}e&&v.default.stopPropagation(e),this.info.holdOnAction||this.hide()}}},{key:"onTapIgnore",value:function(e){this.isVisible()&&!this.noIgnore&&this.hide()}},{key:"setText",value:function(e){this.text.set(e)}}]),e}(),b()(yu.prototype,"hide",[w.a],Object.getOwnPropertyDescriptor(yu.prototype,"hide"),yu.prototype),b()(yu.prototype,"doAction",[w.a],Object.getOwnPropertyDescriptor(yu.prototype,"doAction"),yu.prototype),b()(yu.prototype,"onTapIgnore",[w.a],Object.getOwnPropertyDescriptor(yu.prototype,"onTapIgnore"),yu.prototype),yu),Iu=function(){function e(){a()(this,e),this.queue=new Y.a,this.queueUpdateMessages=new Y.a,this.defaultMessages=[],this.defaultMessages[y.a.MessageID.Undefined]=void 0}return s()(e,[{key:"getMessageById",value:function(e){void 0===this.defaultMessages[e]&&this.initMessageById(e);try{v.default.PAssert(749,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(t){v.default.reportError(t)}return this.defaultMessages[e]}},{key:"testMessageById",value:function(e){return!!this.defaultMessages[e]}},{key:"initMessageById",value:function(e){var t;switch(e){case y.a.MessageID.ConnectionError:t={text:"Connection error detected. Please reload to try again.",action:y.a.MessageAction.Reload};break;case y.a.MessageID.OfflineUndo:t={text:"Offline undo/redo has been disabled temporarily.",hold:!0};break;case y.a.MessageID.FatalError:t={text:"There was a fatal error in the application. "+k.a.actionVerbCaps()+" to restart.",action:y.a.MessageAction.Reload};break;case y.a.MessageID.MailbirdClick:t={text:"Sorry, emails can currently only be opened from inside Mailbird.",action:y.a.MessageAction.Okay};break;case y.a.MessageID.ExitDemo:t={text:"Changes are not saved in demo",action:y.a.MessageAction.LoginScreen,hold:!0,noIgnore:!0};break;case y.a.MessageID.ShareFailure:t={text:"There was an error sharing the file you attached.",action:y.a.MessageAction.OpenSettings,timeout:8e3};break;case y.a.MessageID.ThisIsDemo:t={text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:function(){window.parent.postMessage("userInteracted","*")},hold:!0,big:!0};break;case y.a.MessageID.InviteFailure:t={text:"Failed to use referral code. Please try again in your account settings.",action:y.a.MessageAction.OpenAccountSettings};break;case y.a.MessageID.InviteSuccess:t={text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:y.a.MessageAction.Okay};break;case y.a.MessageID.PremiumRequired:t={text:"You must be a premium subscriber to use plugins.",action:y.a.MessageAction.OpenAccountSettings,actionText:"LEARN MORE"};break;case y.a.MessageID.TrialOver:t={text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:y.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case y.a.MessageID.TrialEndSoon:t={text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:y.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case y.a.MessageID.WarnLargeFile:t={text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:y.a.MessageAction.OpenGoogleDrive};break;case y.a.MessageID.InviteInvalid:t={text:"Invalid referral code. Please try again in your account settings.",action:y.a.MessageAction.OpenAccountSettings,actionText:"OKAY"};break;case y.a.MessageID.NoSharingWarning:t={text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:y.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case y.a.MessageID.LostPermission:0,v.default.log("Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings."),console.trace(),t={text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:y.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case y.a.MessageID.CalendarSync:t={text:"There was an error syncing your calendars.",action:y.a.MessageAction.OpenCalendarSettings,actionText:"SETTINGS"};break;case y.a.MessageID.EmailSendFail:t={text:"Your email was not sent, there was an error contacting the remote server."};break;case y.a.MessageID.EmailUpdateFail:t={text:"Unable to save draft to Gmail. Your draft is still saved locally."};break;case y.a.MessageID.EmailLabelFail:t={text:"Unable to sync you changes to Gmail. Your changes are still saved locally."};break;case y.a.MessageID.EmailSyncFail:t={text:"There was an error syncing your Gmail data.",action:function(){Xh.pluginManager.getPluginGmail().runThreadSync()},actionText:"RETRY"};break;case y.a.MessageID.DemoPluginClick:t={text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3};break;case y.a.MessageID.PromptScriptStart:t={text:"Start demo",hold:!0,big:!0,action:y.a.MessageAction.StartDemo};break;case y.a.MessageID.SnoozeOffline:t={text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:y.a.MessageAction.Okay};break;case y.a.MessageID.NeedDrivePermission:t={text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:y.a.MessageAction.OpenSettings};break;case y.a.MessageID.SetupGmailViews:t={text:"Sending email requires setting up Gmail accounts in settings.",action:y.a.MessageAction.OpenSettings};break;case y.a.MessageID.LostLinked:t={text:"Moo.do has lost access to one of your linked accounts.",action:y.a.MessageAction.OpenSettings};break;case y.a.MessageID.GmailDisabled:t={text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:y.a.MessageAction.Okay};break;case y.a.MessageID.LocalWritesDisabled:t={text:"There was an error writing to the local cache. Please restart Moo.do.",action:y.a.MessageAction.Reload};break;case y.a.MessageID.FlatSearchMultiSelect:t={text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."};break;case y.a.MessageID.FlatSearchTab:t={text:"Indenting is not supported in List view because it would have unpredictable results."};break;case y.a.MessageID.ReadOnlyCalendar:t={text:"You do not have write permission for the calendar you are trying to modify."};break;case y.a.MessageID.CalendarSaveFail:t={text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."};break;case y.a.MessageID.QuotaError:t={text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3};break;case y.a.MessageID.ReselectEmail:t={text:"Please re-select the email item and try again."};break;case y.a.MessageID.ReactError:t={text:"The application has encountered an error. The developers have been notified, but sending a bug report describing what happened would be very helpful!",actionText:"REPORT",action:function(){Xh.menus.openModal(y.a.Modals.ReportBug)}};break;case y.a.MessageID.PaneLoadTimeout:t={text:"The file is taking an unusually long time to load. Please try loading again.",actionText:"RELOAD",action:v.default.reload};break;case y.a.MessageID.GmailViewsNeedSignin:v.default.log("Moo.do is not signed into your Gmail account. Please open settings and click FIX in the Gmail accounts to continue syncing your emails."),t={text:"Moo.do is not signed into your Gmail account. Please open settings and click FIX in the Gmail accounts to continue syncing your emails.",action:y.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case y.a.MessageID.OutlookViewsNeedSignin:v.default.log("Moo.do is not signed into your Outlook account. Please open settings and click FIX in the Outlook accounts to continue syncing your emails."),t={text:"Moo.do is not signed into your Outlook account. Please open settings and click FIX in the Outlook accounts to continue syncing your emails.",action:y.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;default:try{v.default.PAssert(750,!1,"Invalid MessageID: ",e)}catch(n){v.default.reportError(n)}}t&&(this.defaultMessages[e]=new Pu(t,this))}},{key:"pushMessage",value:function(e){try{v.default.PAssert(751,e,"Must supply a valid message to display")}catch(n){v.default.reportError(n)}var t;if(e instanceof Pu)t=e;else if(v.default.isObject(e))this.hasMsgWithText(e.text)||(t=new Pu(e,this));else if(v.default.isString(e))this.hasMsgWithText(e)||(t=new Pu({text:e},this));else if(!(t=this.getMessageById(e))){try{v.default.PAssert(752,!1,"Invalid data passed to message creation")}catch(n){v.default.reportError(n)}v.default.log("Message not created properly",e)}return t&&t.show(),t}},{key:"clearMessageByID",value:function(e){this.queue.get().some((function(t){if(t.id===e)return t.hide(),!0}))}},{key:"clearMessage",value:function(e){var t;return e instanceof Pu?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t}},{key:"isMessageVisible",value:function(e){var t=!1;e instanceof Pu?t=e.isVisible():this.testMessageById(e)&&(t=this.getMessageById(e).isVisible());return t}},{key:"onMessageShow",value:function(e){try{v.default.PAssert(753,e,"Must pass in a valid message to add to the queue")}catch(t){v.default.reportError(t)}try{v.default.PAssert(754,e&&e.doAction,"Message added to queue must have valid API exposed - doAction")}catch(t){v.default.reportError(t)}e instanceof Pu?this.queue.push(e):v.default.reportError(new Error("Toast message must be an instance of Toast"),e)}},{key:"onMessageHide",value:function(e){try{v.default.PAssert(755,e,"Must pass in a valid message to be removed from the queue")}catch(n){v.default.reportError(n)}var t=this.queue.indexOf(e);if(t<0)try{v.default.PAssert(756,!1,"Trying to remove an invalid message from the queue")}catch(n){v.default.reportError(n)}else this.queue.splice(t,1)}},{key:"hasMsgWithText",value:function(e){return!!this.queue.get().find((function(t){return t.text.get()===e}))}},{key:"pushUpdateMessage",value:function(e){var t=this,n=e;n.onClose=function(){t.queueUpdateMessages.remove(n)},this.queueUpdateMessages.push(n)}}]),e}(),Du=n(30),Tu=(_u=function(){function e(t){a()(this,e),this._taskCB=t,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,K.a.listen("lowImpactBegin",this.handleLowImpactBegin)}return s()(e,[{key:"getStats",value:function(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}}},{key:"disable",value:function(){this._disabled=!0}},{key:"enable",value:function(){this._disabled=!1}},{key:"handleLowImpactBegin",value:function(){this._startTaskRun()}},{key:"requestRun",value:function(){this._forceRun=!0,this._startTaskRun()}},{key:"notifyWorkAvailable",value:function(){this._workAvailable=!0,v.default.isLowImpact()&&!this._isRunning&&this._startTaskRun()}},{key:"_startTaskRun",value:function(){if(!this._isRunning&&!this._disabled&&this._workAvailable){try{v.default.PAssert(2661,this._forceRun||v.default.isLowImpact(),"Must always run a task during a low impact timeframe")}catch(e){v.default.reportError(e)}this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun)}}},{key:"_onTaskEndRun",value:function(e){try{v.default.PAssert(2662,this._isRunning,"Must be currently running task to finish")}catch(t){v.default.reportError(t)}this._isRunning=!1,this._forceRun=!1,(e||this._workAvailable)&&(this._workAvailable=!0,v.default.isLowImpact()&&this._startTaskRun())}}]),e}(),b()(_u.prototype,"handleLowImpactBegin",[w.a],Object.getOwnPropertyDescriptor(_u.prototype,"handleLowImpactBegin"),_u.prototype),b()(_u.prototype,"_onTaskEndRun",[w.a],Object.getOwnPropertyDescriptor(_u.prototype,"_onTaskEndRun"),_u.prototype),_u);function xu(e,t,n,r,i,a){try{v.default.PAssert(2665,v.default.isFunction(i),"Must supply a valid entry CB")}catch(o){v.default.reportError(o)}try{v.default.PAssert(2666,v.default.isFunction(a),"Must supply a valid done CB")}catch(o){v.default.reportError(o)}this._nextPageToken=e,this._inUse=!1,this._q=t,this._info=n,this._maxResults=r,this._entryCB=i,this._doneCB=a}var Cu={updateToken:function(e){try{v.default.PAssert(2667,this._nextPageToken!==e,"Should never update token to be same value")}catch(t){v.default.reportError(t)}this._nextPageToken=e},getNextPageToken:function(){return this._nextPageToken},getInfo:function(){return this._info},getQuery:function(){return this._q},getEntryCB:function(){return this._entryCB},getDoneCB:function(){return this._doneCB},getMaxResults:function(){return this._maxResults},hasMorePages:function(){return!!this._nextPageToken},notifyBeginUse:function(){try{v.default.PAssert(2668,!this._inUse,"Should not currently be in use")}catch(e){v.default.reportError(e)}this._inUse=!0},notifyEndUse:function(){try{v.default.PAssert(2669,this._inUse,"Should always be using token when done")}catch(e){v.default.reportError(e)}this._inUse=!1},isInUse:function(){return this._inUse}};G.a.defineBase(xu),G.a.extend(xu.prototype,Cu);var Au,Lu=xu,Ou=1,Mu=2,Ru=3,Fu=4,Nu=5,ju=6,Uu=function(){function e(t,n,r){a()(this,e),this.id=n,this._oldLocalID=void 0,this._plugin=t,this._loadState=Ou,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=r,this.load()}return s()(e,[{key:"load",value:function(e){this._loadState=Mu,this._plugin.requestData(this,e)}},{key:"notifyDataRequested",value:function(){try{v.default.PAssert(2355,!this.isLoaded(),"Should not request additional data once loaded")}catch(e){v.default.reportError(e)}this._numRemoteRequests++,this._loadState=Ru}},{key:"notifyDataLoaded",value:function(e,t,n,r){try{v.default.PAssert(2356,t||this._loadState!==Nu||v.default.isFlagSet(e,y.a.PluginLoad.Full),"Should not load preview data after full data has been loaded")}catch(i){v.default.reportError(i)}try{v.default.PAssert(2357,!t||this._loadState===Fu||v.default.isFlagSet(e,y.a.PluginLoad.Full),"Incoming update much match previous type")}catch(i){v.default.reportError(i)}this._loadState=v.default.isFlagSet(e,y.a.PluginLoad.Full)?Nu:Fu,this.onUpdate(!0,n,r)}},{key:"notifyDataMutated",value:function(e,t){try{v.default.PAssert(2358,e&&v.default.isArray(e),"Must specify valid update fields when mutating attachment state manually")}catch(n){v.default.reportError(n)}this.onUpdate(!0,e,t)}},{key:"notifyDataRequestFailed",value:function(){try{v.default.PAssert(2359,this._loadState===ju||this._loadState===Ru||this._loadState===Fu,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(e){v.default.reportError(e)}if(this._loadState===ju);else if(this._loadState===Ru)this._loadState=ju;else if(this._loadState===Fu)try{v.default.PAssert(2360,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(e){v.default.reportError(e)}else try{v.default.PAssert(2361,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(e){v.default.reportError(e)}}},{key:"isLoaded",value:function(){return this._loadState===Fu||this._loadState===Nu}},{key:"needsRemoteData",value:function(){return this._loadState!==Nu}},{key:"getOldID",value:function(){return this._oldLocalID}},{key:"changeID",value:function(e){try{v.default.PAssert(2362,this.id!==e,"Change the ID of an attachment to the same value")}catch(i){v.default.reportError(i)}if(this.id!==e){var t=0,n=this.id;this.id=e,this._oldLocalID=n;try{v.default.PAssert(2363,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(i){v.default.reportError(i)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._subscribers[r].onAttachmentIDChange(this,n)}catch(a){v.default.reportError(a)}}this._iteratingSubscribers=!1,this._oldLocalID=void 0}}},{key:"delayChangeID",value:function(){var e=0;try{v.default.PAssert(2364,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(i){v.default.reportError(i)}this._iteratingSubscribers=!0;for(var t=0;t<this._subscribers.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._subscribers[t];try{var r=n.onAttachmentIDChange.bind(n,this,this.id);setTimeout(r,0)}catch(a){v.default.reportError(a)}}this._iteratingSubscribers=!1}},{key:"isFieldDefined",value:function(e){return this._plugin.isFieldDefined(e)}},{key:"hasField",value:function(e){return this._plugin.hasAttachField(this,e)}},{key:"getField",value:function(e){return this._plugin.getAttachField(this,e)}},{key:"updateField",value:function(e,t,n,r){return this._plugin.updateAttachField(this,e,t,n,r)}},{key:"updateInlineField",value:function(e,t){this._inlineData&&(this._inlineData[e]=t,this.onUpdate(!0,[e],y.a.ChangeType.Local))}},{key:"fieldsHaveParseEffect",value:function(e){return this._plugin.fieldsHaveParseEffect(e)}},{key:"isFieldDefault",value:function(e){return this._plugin.isAttachFieldDefault(this,e)}},{key:"fieldNeedsWrite",value:function(e,t){return this._plugin.fieldNeedsWrite(this,e,t)}},{key:"getFieldAsDate",value:function(e){var t=this._plugin.getAttachField(this,e);if(t)return new Date(t).toString(Xh.International.getFormat(y.a.DFormat.MonthDay));try{v.default.PAssert(2365,!1,"Invalid attachment date field: ",this._plugin.id,e)}catch(n){v.default.reportError(n)}}},{key:"getPlugin",value:function(){return this._plugin}},{key:"getData",value:function(){return this._plugin.getCacheData(this.id)}},{key:"getEmbedString",value:function(){return this._plugin.getAttachmentEmbedString(this)}},{key:"getTitleString",value:function(){return this._plugin.getAttachmentTitleString(this)}},{key:"unload",value:function(){this._loadState=Ou,this._plugin.releaseAttachment(this)}},{key:"match",value:function(e){return!!this.isLoaded()&&this._plugin.matchAttachment(this,e)}},{key:"markInUse",value:function(e){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,e),this._countInUse++}},{key:"markUnused",value:function(e){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,e);try{v.default.PAssert(2366,this._countInUse>=0,"Should never have negative users of the attachment")}catch(t){v.default.reportError(t)}}},{key:"isInUse",value:function(){return this._countInUse>0}},{key:"subscribe",value:function(e){try{v.default.PAssert(2367,this._subscribers.indexOf(e)<0,"Must not double subscribe")}catch(t){v.default.reportError(t)}try{v.default.PAssert(2368,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){v.default.reportError(t)}try{v.default.PAssert(2369,e.onAttachmentUpdate,"Must specify a valid subscriber callback")}catch(t){v.default.reportError(t)}this._subscribers.push(e)}},{key:"unsubscribe",value:function(e){try{v.default.PAssert(2371,this._subscribers.indexOf(e)>=0,"Subscriber should be active")}catch(t){v.default.reportError(t)}try{v.default.PAssert(2372,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){v.default.reportError(t)}this._subscribers.remove(e)}},{key:"forEachItem",value:function(e,t){var n=0;try{v.default.PAssert(2374,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(i){v.default.reportError(i)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(v.default.isVMLI(this._subscribers[r])&&(!e||this._subscribers[r].belongsToItemStore(e)))try{t(this._subscribers[r])}catch(a){v.default.reportError(a)}}this._iteratingSubscribers=!1}},{key:"onUpdate",value:function(e,t,n){var r=0;try{v.default.PAssert(2375,!t||v.default.isArray(t),"Must supply a valid value for updateFields:",t)}catch(s){v.default.reportError(s)}if(n=n||y.a.ChangeType.Remote,e&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(u){v.default.reportError(u)}if(e||(n|=y.a.ChangeType.PluginLoad),t)for(var i=0,a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;try{v.default.PAssert(2376,this._plugin.isFieldDefined(t[a]),"Invalid field supplied to be updated: ",t[a])}catch(s){v.default.reportError(s)}}try{v.default.PAssert(2377,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(s){v.default.reportError(s)}this._iteratingSubscribers=!0;for(var o=0;o<this._subscribers.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{this._subscribers[o].onAttachmentUpdate(this,t,n)}catch(u){v.default.reportError(u)}}this._iteratingSubscribers=!1}},{key:"notifyItemNoteChanged",value:function(e){this._plugin.notifyItemNoteChanged(this,e)}},{key:"notifyItemTextChanged",value:function(e,t){this._plugin.notifyItemTextChanged(this,e,t)}},{key:"notifyItemDateChanged",value:function(e){this._plugin.notifyItemDateChanged(this,e)}},{key:"notifyItemPropertyChanged",value:function(e,t,n){this._plugin.notifyItemPropertyChanged(this,e,t,n)}},{key:"isLocalOnlyAttachment",value:function(){return v.default.isTempId(this.id)}},{key:"isType",value:function(e){return this._plugin.getType()===e}},{key:"isPlugin",value:function(e){return this._plugin.id===e}},{key:"shouldBeDeleted",value:function(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()}},{key:"hasFatalError",value:function(){return this._loadState===ju&&this._numRemoteRequests>3}},{key:"hasInlineData",value:function(){return!!this._inlineData}},{key:"getInlineData",value:function(){return this._inlineData}},{key:"setInlineData",value:function(e){this._inlineData=e,this._loadState=Nu}},{key:"clearInlineData",value:function(){this._inlineData=void 0}}]),e}(),Bu=[1,5,20,40,80,170],Vu=[y.a.HTTPStatusCode.Network,y.a.HTTPStatusCode.Timeout,y.a.HTTPStatusCode.TooMany,y.a.HTTPStatusCode.ServerError,y.a.HTTPStatusCode.BadGateway,y.a.HTTPStatusCode.Unavailable,y.a.HTTPStatusCode.GatewayTimeout,null],Hu=[y.a.HTTPStatusCode.Forbidden,y.a.HTTPStatusCode.TooMany],Wu={};Wu[y.a.PluginDependency.DemoMode]={online:!1},Wu[y.a.PluginDependency.PremiumSub]={online:!1},Wu[y.a.PluginDependency.EarlyAccess]={online:!1};var qu=y.a.DETAILED_STATS,zu=(Au=function(){function e(t,n,r,i,o){var s=this;a()(this,e);try{v.default.PAssert(2091,t,"Must supply a valid id")}catch(u){v.default.reportError(u)}try{v.default.PAssert(2092,r,"Must supply a valid name")}catch(u){v.default.reportError(u)}this.id=t,this.name=r,this.isBuiltin=i,this.DefaultRequestTimeout=v.default.seconds(15),this.LongWaitThreshold=v.default.seconds(7),this._paneType="Pane"+t,this._acProviderId="AC"+t,this._settingsGroup="plugin"+this.id,this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new E.a(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._attachKeys=[],this._attachCache={},this._dataCache={},this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._requiresOfflineAuth=!1,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this._requestsInProgress={},this.Settings={},G.a.binder(this,"_retryRemoteRequest","_reqSortFn"),Xh.settings.registerGroup(this._settingsGroup,n,o),this.registerSetting("IsEnabled","isEnabled","e",!0,i),this.getDataPane()&&Io.a.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),qu&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,combinedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0},this.__TrackedStats={},this.__ReqStats=[]),Xh.settings.syncAccounts.listen(this._onSyncAccountsChanged),this.onSettingChanged(this.Settings.IsEnabled,(function(e,t){e&&Xh.pluginManager.activatePlugin(s)}))}return s()(e,[{key:"getType",value:function(){return y.a.PluginType.Unknown}},{key:"sendEvent",value:function(e,t){return v.default.sendEvent(this.id,e,t)}},{key:"getSettingObs",value:function(e){return Xh.settings[this._settingsGroup][e]}},{key:"getSetting",value:function(e){return Xh.settings[this._settingsGroup][e].get()}},{key:"setSetting",value:function(e,t,n){return Xh.settings[this._settingsGroup][e].set(t,n)}},{key:"registerSetting",value:function(e,t,n,r,i){this.Settings[e]=t,Xh.settings.registerSetting(t,n,this._settingsGroup,r,i)}},{key:"onSettingChanged",value:function(e,t){Xh.settings[this._settingsGroup][e].listen(t)}},{key:"getCacheStats",value:function(e){var t={},n=Object.keys(this._registeredCaches).length,r=0,i=function(i){t[i.id]=i,n===++r&&e(t)};if(n>0)for(var a in this._registeredCaches){if(this._registeredCaches.hasOwnProperty(a))this._registeredCaches[a].getStats(i)}else e()}},{key:"getCacheState",value:function(){var e={};for(var t in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(t)){var n=this._registeredCaches[t];e[t]=n.getState()}return e}},{key:"registerLocalCache",value:function(e,t,n){var r=Xh.cacheManager.registerLocalCache(e,t,n);return this._registeredCaches[e]=r,r}},{key:"registerDeferredTaskType",value:function(e,t,n,r){try{v.default.PAssert(2093,e,"Must specify a valid deferred task type")}catch(i){v.default.reportError(i)}Xh.deferredTaskManager.registerTaskType(e,t,n,r)}},{key:"scheduleDeferredTask",value:function(e,t,n,r){try{v.default.PAssert(2094,e,"Must supply a valid local ID for deferred task")}catch(i){v.default.reportError(i)}try{v.default.PAssert(2095,t,"Must specify a valid deferred task type")}catch(i){v.default.reportError(i)}Xh.deferredTaskManager.scheduleTask(e,t,n,!1,void 0,r)}},{key:"cancelDeferredTask",value:function(e,t){Xh.deferredTaskManager.cancelTask(e,t)}},{key:"createRecurringTask",value:function(e,t){var n,r=this.id+"_"+e;return this.hasRecurringTask(e)?n=Xh.recurringTaskManager.getRecurringTask(r):(this._recurringTasks.push(e),n=Xh.recurringTaskManager.createRecurringTask(r,t)),n}},{key:"getRecurringTask",value:function(e){return Xh.recurringTaskManager.getRecurringTask(this.id+"_"+e)}},{key:"hasRecurringTask",value:function(e){return Xh.recurringTaskManager.hasRecurringTask(this.id+"_"+e)}},{key:"cancelRecurringTask",value:function(e){var t=this.id+"_"+e;return this._recurringTasks.remove(e),Xh.recurringTaskManager.cancelRecurringTask(t)}},{key:"cancelRecurringTasks",value:function(){for(var e=0;this._recurringTasks.length>0;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.cancelRecurringTask(this._recurringTasks[0])}}},{key:"getRecurringStats",value:function(){for(var e=0,t={},n=0;n<this._recurringTasks.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._recurringTasks[n],i=this.getRecurringTask(r);t[r]=i.getStats()}return t}},{key:"registerLowImpactTask",value:function(e,t){try{v.default.PAssert(2096,!this._lowImpactTasks[e],"Must specify different IDs for each task: ",e)}catch(r){v.default.reportError(r)}var n=new Tu(t);return this._lowImpactTasks[e]=n,n}},{key:"getLowImpactStats",value:function(){var e={};for(var t in this._lowImpactTasks)if(this._lowImpactTasks.hasOwnProperty(t)){var n=this._lowImpactTasks[t];e[t]=n.getStats()}return e}},{key:"getTrackedStat",value:function(e){if(qu)return this.__TrackedStats[e]}},{key:"addTrackedStat",value:function(e){if(qu){try{v.default.PAssert(2097,!this.__TrackedStats.hasOwnProperty(e),"Should not double define a tracked stat for a plugin")}catch(t){v.default.reportError(t)}this.__TrackedStats[e]=0}}},{key:"reportTrackedStat",value:function(e){if(qu){try{v.default.PAssert(2098,this.__TrackedStats.hasOwnProperty(e),"Must first register a tracked stat before reporting instantces of it")}catch(t){v.default.reportError(t)}this.__TrackedStats[e]++}}},{key:"getStats",value:function(){return{fnCalls:qu?this.__Stats:void 0,tracked:qu?this.__TrackedStats:void 0,remoteReqs:qu?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._numSendRequests>0?this._totalRequestSendTime/this._numSendRequests:0,avgRequestHandleTime:this._numHandledRequests>0?this._totalRequestHandleTime/this._numHandledRequests:0,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}}},{key:"getState",value:function(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState()}}},{key:"isPluginPane",value:function(e){return e.type===this._paneType}},{key:"getPaneType",value:function(){return this._paneType}},{key:"activate",value:function(e){var t=this.isActiveObs.get();if(t||(this.isActiveObs.set(!0),this.useItemStore()&&(this._defaultItemStore=Xh.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions()),this._defaultItemStore.createRoot(this.isActive()?this.useItemStore():this.id+"Root","")),this._hasLoadedCaches||(this.supportUsageCache()&&v.default.shouldWriteLocal()&&this.loadUsageCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive()),this._unloadedDependencies)for(var n in e)e.hasOwnProperty(n)&&this.onDependencyLoaded(n,e[n]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),this._activate&&this._activate(),t||Xh.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),!t}},{key:"deactivate",value:function(){try{v.default.PAssert(2099,this.isActiveObs.get(),"Must be active in order to deactivate pane")}catch(e){v.default.reportError(e)}return this.isActiveObs.set(!1),Xh.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.getDataPane()&&Io.a.deactivatePaneType(this._paneType),this.useItemStore()&&(Xh.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0}},{key:"ensurePaneTypeIsActive",value:function(){(!this.hasDependency(y.a.PluginDependency.PremiumSub)||Xh.billingManager.hasPremiumFeatures())&&this.getDataPane()&&!Io.a.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||v.default.isDemoMode())&&Io.a.activatePaneType(this._paneType)}},{key:"isActive",value:function(){return this.isActiveObs.get()}},{key:"isReady",value:function(){return this._isReady}},{key:"isEnabled",value:function(){return v.default.isDemoMode()&&this.id!==y.a.PluginID.Gmail||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)}},{key:"isAvailable",value:function(){var e=!1,t=this.hasDependency(y.a.PluginDependency.EarlyAccess),n=this.hasDependency(y.a.PluginDependency.PremiumSub);try{v.default.PAssert(2100,!n||!t,"Must not require both early access and premium sub: "+this.id)}catch(a){v.default.reportError(a)}var r=Xh.billingManager.hasEarlyAccess(),i=Xh.billingManager.hasPremiumFeatures();return t&&r||n&&i?e=!0:t||n?v.default.isDemoMode()&&(e=!0):e=!0,e}},{key:"isOn",value:function(){return this.isActive()&&!this.isPluginBlocked()}},{key:"hasSettingsError",value:function(){return!1}},{key:"isSyncAccountEnabled",value:function(e){if(!e)return!1;var t=Xh.settings.syncAccounts.get();if(t){var n=t[e];return n&&n[this.id]}}},{key:"isCurrentlyAuthorized",value:function(e){var t=this.googleScopes();return!t||Po.a.isAuthorizedForScopes(e,t)}},{key:"shouldUseNewPlugin",value:function(e){return!!gs.a.getPluginData(e.id)}},{key:"onAuthorized",value:function(e){this._pendingRequests.length>0&&Xh.pluginManager.notifyHasPendingRemoteRequest()}},{key:"verifyAuthorization",value:function(e){return!0}},{key:"notifyUnauthorized",value:function(e,t){}},{key:"isOnline",value:function(){return Xh.pluginManager.isOnline()}},{key:"goOnline",value:function(){}},{key:"onDocumentShared",value:function(e){}},{key:"onShutdown",value:function(){}},{key:"onDependencyLoaded",value:function(e,t){if(this._unloadedDependencies){var n=this._unloadedDependencies.indexOf(e);if(n>=0&&(v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Plugin Dependency Loaded: ",this.id,e),this._unloadedDependencies.removeAt(n),e===y.a.PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var r=0,i=!1,a=0;a<this._unloadedDependencies.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this._unloadedDependencies[a];Wu[o].online||(i=!0)}!i&&this.isActiveObs.get()&&this.offlineLoad()}}}},{key:"onAllDependenciesLoaded",value:function(){this.isActiveObs.get()&&(v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Plugin All Dependencies Loaded: ",this.id),this._isReady=!0,this._updateAttachmentStates(),this.offlineLoad(),this.load())}},{key:"areDependenciesLoaded",value:function(){return void 0===this._unloadedDependencies}},{key:"hasDependencyBeenLoaded",value:function(e){var t=!1;return this.hasDependency(e)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(e)<0&&(t=!0):t=!0),t}},{key:"getUnloadedDependencies",value:function(){return this._unloadedDependencies}},{key:"areRemoteAPIsLoaded",value:function(){return!0}},{key:"forceLoad",value:function(){this._loadedInitialData=!1,this.activate({}),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())}},{key:"hasDependency",value:function(e){var t=this.getDependencies();return!!t&&t.indexOf(e)>=0}},{key:"migrateOldOfflineCache",value:function(){if(this.supportUsageCache()&&v.default.shouldWriteLocal()){var e="ocache_"+this.id,t=Go.a.getLegacyLocalStorage(e);if(t)try{var n=JSON.parse(t);if(n){var r=0;try{v.default.PAssert(2101,n,"Must provide a valid dataset to load")}catch(l){v.default.reportError(l)}n.props;var i=n.data;try{v.default.PAssert(2102,i,"Load object must contain valid data")}catch(l){v.default.reportError(l)}for(var a=Object.keys(i),o=0;o<a.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a[o],u=this.createEntryFromLocal(s,i[s]);u.id=s,Go.a.savePluginUsage(this.id,u)}Go.a.deleteLegacyLocalStorage(e)}}catch(c){v.default.reportError(c)}else v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("No offline cache present: ",this.id)}}},{key:"loadUsageCache",value:function(){var e=this;if(this.supportUsageCache()&&v.default.shouldWriteLocal()){this.migrateOldOfflineCache();var t=Go.a.getPluginTableUsage(this.id);t&&Object.keys(t).forEach((function(n){return e._dataCache[n]=e.createEntryFromLocal(n,t[n])}))}}},{key:"supportOfflineLoad",value:function(){return!1}},{key:"supportUsageCache",value:function(){return!1}},{key:"createEntryFromLocal",value:function(e,t){try{v.default.PAssert(2103,!1,"SubClass must override createEntryFromLocal",this.id)}catch(n){v.default.reportError(n)}}},{key:"clearData",value:function(){for(var e=0,t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._attachCache[this._attachKeys[t]].unload()}this._attachKeys=[],this._attachCache={},this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]}},{key:"onCacheLimitExceeded",value:function(){for(var e in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(e)){var t=this._registeredCaches[e];t.usesDiskSpace()&&t.clearCache()}}},{key:"changeID",value:function(e,t,n){try{v.default.PAssert(2104,t!==n,"Should never be switching to the same ID")}catch(o){v.default.reportError(o)}if(this._attachCache[n])e.delayChangeID(),delete this._attachCache[t],this._attachKeys.remove(t),delete this._dataCache[t];else{var r=this._attachCache[t];try{v.default.PAssert(2105,e===r,"Attach entries must match")}catch(o){v.default.reportError(o)}r&&(delete this._attachCache[t],this._attachCache[n]=r,this._attachKeys.remove(t),this._attachKeys.push(n));var i=this._dataCache[t];delete this._dataCache[t],i&&(i.id===t&&(i.id=n),this._dataCache[n]=i);var a=e.isLocalOnlyAttachment();e.isInUse()&&a&&this.deleteAttachmentFromUsageCache(e),e.changeID(n),e.isInUse()&&a&&this.saveAttachmentToUsageCache(e)}}},{key:"_isFullData",value:function(e){for(var t=0,n=this.getPropertySet(y.a.PluginLoad.Full),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.getPropertyDescriptor(n[r]).isOpt&&!e.hasOwnProperty(n[r]))return!1}return!0}},{key:"cacheData",value:function(e,t,n,r,i){try{v.default.PAssert(2106,e,"Must supply a valid key for data")}catch(s){v.default.reportError(s)}if(qu&&this.__Stats.cacheWrites++,this._dataCache[e]=t,this._attachCache[e]){var a=this._attachCache[e],o=this._getPluginLoadType(t);try{v.default.PAssert(2108,o,"Must contain valid full data")}catch(s){v.default.reportError(s)}a.notifyDataLoaded(o,n,r,i)}}},{key:"getCacheData",value:function(e){var t=gs.a.getPluginDataTranslated(e);return!t||this._dataCache[e]&&this.isSyncAccountEnabled(this._dataCache[e].accountID)?this._dataCache[e]:t}},{key:"_attachMetadataFields",value:function(){}},{key:"fieldsHaveParseEffect",value:function(e){var t=!1;if(e){var n=this._attachMetadataFields();if(n)for(var r=0,i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n.indexOf(e[i])<0){t=!0;break}}else t=!0}else t=!0;return t}},{key:"isFieldDefined",value:function(e){return!!this.getPropertyDescriptor(e)}},{key:"hasAttachField",value:function(e,t){var n=!1,r=this.getCacheData(e.id);if(r&&r.hasOwnProperty(t))n=!0;else{var i=this.getPropertyDescriptor(t);try{v.default.PAssert(2110,i,"Must have a valid field descriptor",t)}catch(o){v.default.reportError(o)}if(i&&i.isOpt)n=!0;else{var a=e.getInlineData();a&&a.hasOwnProperty(t)&&void 0!==a[t]&&(n=!0)}}return n}},{key:"getAttachField",value:function(e,t){var n,r=this.getCacheData(e.id);if(r&&r.hasOwnProperty(t))n=r[t];else{var i=this.getPropertyDescriptor(t);try{v.default.PAssert(2111,i,"Must have a valid field descriptor",t)}catch(o){v.default.reportError(o)}var a=e.getInlineData();n=a&&a.hasOwnProperty(t)?a[t]:i?i.defaultValue:void 0}return n}},{key:"updateAttachField",value:function(e,t,n,r,i){var a=!1;try{v.default.PAssert(2113,this.isFieldDefined(t),"Must be updating a valid attachment field")}catch(u){v.default.reportError(u)}var o=this.getCacheData(e.id);try{v.default.PAssert(2114,o,"Invalid field request: ",this.id,t)}catch(u){v.default.reportError(u)}o&&((i||this.dataFieldNeedsWrite(o,t,n))&&(o[t]=n,this.cacheData(e.id,o,!0,[t])),a=!0);var s=e.getInlineData();if(s&&s.hasOwnProperty(t)&&!r)try{v.default.PAssert(2117,s[t]===n,"Should never change inline field value")}catch(u){v.default.reportError(u)}return a}},{key:"isAttachFieldDefault",value:function(e,t){var n=!1,r=this.getCacheData(e.id);try{v.default.PAssert(2118,r,"Invalid field request: ",this.id,t)}catch(a){v.default.reportError(a)}if(r){var i=this.getPropertyDescriptor(t);try{v.default.PAssert(2119,i,"Must have a valid field descriptor",t)}catch(a){v.default.reportError(a)}r.hasOwnProperty(t)?i&&i.isOpt&&i.defaultValue===r[t]&&(n=!0):i&&i.isOpt&&(n=!0)}return n}},{key:"fieldNeedsWrite",value:function(e,t,n){var r=this.getCacheData(e.id);try{v.default.PAssert(2120,r,"Invalid field request: ",this.id,t)}catch(i){v.default.reportError(i)}return this.dataFieldNeedsWrite(r,t,n)}},{key:"dataFieldNeedsWrite",value:function(e,t,n){var r=!1;if(e){var i=this.getPropertyDescriptor(t);try{v.default.PAssert(2121,i,"Must have a valid field descriptor",t)}catch(o){v.default.reportError(o)}var a=this.compactCacheField(e,t);e.hasOwnProperty(t)?void 0===n&&a===i.defaultValue||(i&&i.comparator?i.comparator(a,n)||(r=!0):(a!==n||v.default.isObject(a)||v.default.isObject(n)||v.default.isArray(a)||v.default.isArray(n))&&(r=!0)):void 0!==n&&(i&&i.isOpt&&i.defaultValue===n||(r=!0))}return r}},{key:"hasCacheData",value:function(e){return!!this._dataCache[e]}},{key:"findCachedItemsByField",value:function(e,t,n){var r=this;qu&&this.__Stats.findByField++;var i=[];return Object.keys(this._dataCache).some((function(a){var o=r._dataCache[a];if(o&&o[e]===t&&(i.push(o),i.length>=n))return!0})),i}},{key:"findCachedItemsByFn",value:function(e,t){var n=this;try{v.default.PAssert(2122,e,"Must supply a valid match function")}catch(i){v.default.reportError(i)}try{v.default.PAssert(2123,v.default.isFunction(e),"Match function must be a valid function")}catch(i){v.default.reportError(i)}qu&&this.__Stats.findByFn++;var r=[];return Object.keys(this._dataCache).some((function(i){var a=n._dataCache[i];if(e(a)&&(r.push(a),r.length>=t))return!0})),r}},{key:"notifyAttachmentInUse",value:function(e,t){try{v.default.PAssert(2124,this._activeAttachments.indexOf(e)<0,"Attachment should not already be active")}catch(n){v.default.reportError(n)}this._activeAttachments.push(e),v.default.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e,!0)}},{key:"notifyAttachmentUpdated",value:function(e){this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e)}},{key:"notifyAttachmentUnused",value:function(e,t){try{v.default.PAssert(2125,this._activeAttachments.indexOf(e)>=0,"Attachment should be marked active")}catch(n){v.default.reportError(n)}this._activeAttachments.remove(e),v.default.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.deleteAttachmentFromUsageCache(e)}},{key:"onAuthorizedSetting",value:function(e,t){}},{key:"notifyItemNoteChanged",value:function(e,t){}},{key:"notifyItemDateChanged",value:function(e,t){}},{key:"notifyItemTextChanged",value:function(e,t,n){}},{key:"notifyItemPropertyChanged",value:function(e,t,n,r){}},{key:"getAttachment",value:function(e,t){try{v.default.PAssert(2126,e,"Must provide a valid key")}catch(n){v.default.reportError(n)}return e&&(this._attachCache[e]?t&&!this._attachCache[e].hasInlineData()&&this._attachCache[e].setInlineData(t):(this._attachCache[e]=this._requestAttachment(e,t),this._attachKeys.push(e))),this._attachCache[e]}},{key:"hasAttachment",value:function(e){return!!this._attachCache[e]}},{key:"forEachActiveAttachment",value:function(e){for(var t=0,n=0;n<this._activeAttachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._activeAttachments[n])}}},{key:"forEachAttachment",value:function(e){for(var t=0,n=0;n<this._attachKeys.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._attachCache[this._attachKeys[n]])}}},{key:"numActiveAttachments",value:function(){return this._activeAttachments.length}},{key:"getAttachmentEmbedString",value:function(e){for(var t=0,n=y.a.EmbedAttachChar+"p:"+this.id+",id:"+e.id,r=this.getPropertySet(y.a.PluginLoad.Inline),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=r[i],o=this.getPropertyDescriptor(a),s=encodeURIComponent(e.getField(a));try{v.default.PAssert(2127,o.isOpt||s&&s.indexOf(":")<0&&s.indexOf(" ")<0,"Property value is invalid: "+a+", "+s)}catch(u){v.default.reportError(u)}void 0!==s&&"undefined"!==s&&(n+=","+a+":"+s)}return n+=y.a.EmbedAttachChar}},{key:"getAttachmentTitleString",value:function(e){return this.getUnstyledText(e)}},{key:"_getTextForItem",value:function(e,t){try{v.default.PAssert(2128,e,"Must pass in a valid item to get text for")}catch(n){v.default.reportError(n)}return v.default.isString(e),y.a.EmbedAttachChar+"p:"+this.id+",id:"+e+(t?",accountID:"+t:"")+y.a.EmbedAttachChar}},{key:"_requestAttachment",value:function(e,t){try{v.default.PAssert(2129,e,"Must provide a valid key")}catch(n){v.default.reportError(n)}return qu&&this.__Stats.createdAttachments++,new Uu(this,e,t)}},{key:"releaseAttachment",value:function(e){}},{key:"saveAttachmentToUsageCache",value:function(e,t){this.supportUsageCache()&&v.default.shouldWriteLocal()&&!this.shouldUseNewPlugin(e)&&(t&&Go.a.getPluginUsage(this.id,e.id)||Go.a.savePluginUsage(this.id,this.serializeEntry(e.id)))}},{key:"deleteAttachmentFromUsageCache",value:function(e){this.supportUsageCache()&&v.default.shouldWriteLocal()&&Go.a.deletePluginUsage(this.id,e.id)}},{key:"dataHasChanged",value:function(e,t){for(var n=0,r=!e,i=this.getPropertySet(y.a.PluginLoad.Full),a=0;!r&&a<i.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[a];this.dataFieldNeedsWrite(e,o,t[o])&&(r=!0)}return r}},{key:"getChangedFields",value:function(e,t){for(var n=0,r=[],i=this.getPropertySet(y.a.PluginLoad.Full),a=0;a<i.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[a];this.dataFieldNeedsWrite(e,o,t[o])&&r.push(o)}return r}},{key:"matchAttachment",value:function(e,t){try{v.default.PAssert(2130,!1,"SubClass must override matchAttachment",this.id)}catch(n){v.default.reportError(n)}}},{key:"getStyledText",value:function(e,t,n,r){try{v.default.PAssert(2131,!1,"SubClass must override getStyledText",this.id)}catch(i){v.default.reportError(i)}return""}},{key:"getUnstyledText",value:function(e,t){try{v.default.PAssert(2132,!1,"SubClass must override getUnstyledText",this.id)}catch(n){v.default.reportError(n)}return""}},{key:"getRichText",value:function(e){try{v.default.PAssert(2133,!1,"SubClass must override getRichText",this.id)}catch(t){v.default.reportError(t)}return""}},{key:"getBlockedText",value:function(e){return"Blocked"}},{key:"getDisplayText",value:function(e,t){return this.getUnstyledText(e,t)}},{key:"createDisplayElement",value:function(e){var t=this.getAttachmentClass(e);try{v.default.PAssert(2134,v.default.isArray(t),"Must have a valid class list")}catch(a){v.default.reportError(a)}try{v.default.PAssert(2135,t.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(a){v.default.reportError(a)}t.push("plugin inlineBordered"),this.isPluginBlocked()&&t.push("blocked");var n=this.getDisplayText(e),r={attrs:{cls:t,plugin:this.id,"plugin-id":e.id},text:n},i=this.getAttachmentTooltip(e);return i&&(r.attrs["data-tooltip"]=i),r}},{key:"getAttachmentClass",value:function(e){return[]}},{key:"getAttachmentTooltip",value:function(e){}},{key:"isPluginBlocked",value:function(){var e=!1;return Xh.billingManager.hasPremiumFeatures()||!this.hasDependency(y.a.PluginDependency.PremiumSub)&&!this.hasDependency(y.a.PluginDependency.EarlyAccess)||(e=!0),e}},{key:"_displayMissingProperties",value:function(e,t,n){var r=0,i=!1,a=this.getPropertySet(n);v.default.log("Displaying Missing Properties: ",e);for(var o=0;o<a.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.getPropertyDescriptor(a[o]).isOpt||t.hasOwnProperty(a[o])||(v.default.log(" Missing Property: ",a[o]),i=!0)}try{v.default.PAssert(2136,i,"Must be missing props to run this")}catch(s){v.default.reportError(s)}}},{key:"_getPluginLoadType",value:function(e){try{v.default.PAssert(2137,e,"Must be querying loaded data for load state with valid data")}catch(n){v.default.reportError(n)}var t=y.a.PluginLoad.None;return this._isFullData(e)&&(t|=y.a.PluginLoad.Full),t}},{key:"requestData",value:function(e,t){var n=this;qu&&this.__Stats.requestData++,t=t||y.a.PluginLoad.Full;var r,i=this.getCacheData(e.id);i?(r=this._getPluginLoadType(i),v.default.isFlagSet(r,t)?e.notifyDataLoaded(r,!1,void 0,y.a.ChangeType.Remote):(v.default.forEachFlagSet(t,(function(t){n._displayMissingProperties(e.id,i,t)})),!e.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(e,t))):e.isLocalOnlyAttachment()||(r=y.a.PluginLoad.None,this.allowRemoteRequests()&&!v.default.isFlagSet(r,t)&&this._getRemoteAttachmentData(e,t))}},{key:"_getRemoteAttachmentData",value:function(e,t){this.getRemoteAttachmentData(e,t)}},{key:"getRemoteAttachmentData",value:function(e,t){try{v.default.PAssert(2138,!1,"SubClass must override getRemoteAttachmentData",this.id)}catch(n){v.default.reportError(n)}}},{key:"_appendDupeRequest",value:function(e,t){try{v.default.PAssert(2139,e,"Must provide a valid queued request")}catch(n){v.default.reportError(n)}try{v.default.PAssert(2140,t,"Must provide a valid duped request")}catch(n){v.default.reportError(n)}try{v.default.PAssert(2141,!e.duped,"Must never use an already duped request as a dupe for another request")}catch(n){v.default.reportError(n)}t.attach&&(e.attach||(e.attach=[]),e.attach.pushOnlyUniques(t.attach)),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestFnsEqual",value:function(e,t){var n=!1;return e===t?n=!0:v.default.isArray(e)&&v.default.isArray(t)&&(n=e.equals(t)),n}},{key:"_areRequestsEqual",value:function(e,t){try{v.default.PAssert(2142,e,"Must have a valid request A")}catch(a){v.default.reportError(a)}try{v.default.PAssert(2143,t,"Must have a valid request B")}catch(a){v.default.reportError(a)}var n=!0;if(e.accountID!==t.accountID)n=!1;else if(e.forceNoDupe||t.forceNoDupe)n=!1;else if(e.id!==t.id&&this._areRequestFnsEqual(e.requestFn,t.requestFn))if(e.data===t.data)n=!0;else{for(var r in e.data){if(!e.data.hasOwnProperty(r)||!t.data.hasOwnProperty(r)){n=!1;break}if(e.data[r]!==t.data[r]){n=!1;break}}if(n)for(var i in t.data){if(!e.data.hasOwnProperty(i)||!t.data.hasOwnProperty(i)){n=!1;break}if(e.data[i]!==t.data[i]){n=!1;break}}}else n=!1;return n}},{key:"_getDupeRequest",value:function(e){for(var t,n=0,r=0,i=0;!t&&i<this._outstandingRequests.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;!this._outstandingRequests[i].duped&&this._areRequestsEqual(this._outstandingRequests[i],e)&&(t=this._outstandingRequests[i])}for(var a=0;!t&&a<this._pendingRequests.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;!this._pendingRequests[a].duped&&this._areRequestsEqual(this._pendingRequests[a],e)&&(t=this._pendingRequests[a])}return t}},{key:"_combineRequest",value:function(e,t){try{v.default.PAssert(2144,e,"Must provide a valid queued request")}catch(n){v.default.reportError(n)}try{v.default.PAssert(2145,t,"Must provide a valid combine request")}catch(n){v.default.reportError(n)}try{v.default.PAssert(2146,!e.combined,"Must never use an already combined request as a target for another request")}catch(n){v.default.reportError(n)}e.data=v.default.mergeObjects(e.data,t.data),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestsCombinable",value:function(e,t){try{v.default.PAssert(2147,e,"Must have a valid request A")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2148,t,"Must have a valid request B")}catch(r){v.default.reportError(r)}var n=!1;return e.id!==t.id&&e.combinable&&t.combinable&&e.accountID===t.accountID&&this._areRequestFnsEqual(e.requestFn,t.requestFn)&&e.type===t.type&&(e.attach||t.attach?e.attach&&t.attach&&e.attach.equals(t.attach)&&(n=!0):n=!0),n}},{key:"_getCombineRequest",value:function(e){var t;if(e.combinable)for(var n=0,r=0;!t&&r<this._pendingRequests.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;!this._pendingRequests[r].combined&&this._areRequestsCombinable(this._pendingRequests[r],e)&&(t=this._pendingRequests[r])}return t}},{key:"_handleBatchRequestResponse",value:function(e){this._numOutstandingReqs--;try{v.default.PAssert(2149,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){v.default.reportError(t)}}},{key:"_handleRequestResponse",value:function(e,t){if(!t){this._numOutstandingReqs--;try{v.default.PAssert(2150,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(n){v.default.reportError(n)}}}},{key:"_queueRemoteRequestMulti",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r,i,a,o,s,u){var l,c=this;return jo.a.wrap((function(e){for(var d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:try{v.default.PAssert(2151,t,"Missing accountID parameter")}catch(h){v.default.reportError(h)}try{v.default.PAssert(2152,!v.default.isArray(t),"Missing accountID paramter")}catch(h){v.default.reportError(h)}try{v.default.PAssert(2153,!v.default.isFunction(t),"Missing accountID parameter")}catch(h){v.default.reportError(h)}try{v.default.PAssert(2154,!u||void 0===u.accountID,"AccountID is specified as a separate param")}catch(h){v.default.reportError(h)}return(l=u?v.default.clone(u):{}).accountID=t,e.next=8,v.default.promisify((function(e){Po.a.getAccountAuthToken(t,c.googleScopes(),e)}));case 8:return e.abrupt("return",this._queueRemoteRequest(n,r,i,a,o,s,l));case 9:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i,a,o,s,u){return e.apply(this,arguments)}}()},{key:"_queueRemoteRequest",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r,i,a,o,s){var u,l;return jo.a.wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(u=t.join("")+JSON.stringify(n)+JSON.stringify(s||{}),this._requestsInProgress[u]){e.next=25;break}try{v.default.PAssert(2155,r,"Must supply a callback for request success")}catch(d){v.default.reportError(d)}try{v.default.PAssert(2156,v.default.isFunction(r),"Success callback must be a valid function")}catch(d){v.default.reportError(d)}try{v.default.PAssert(2157,i,"Must supply a callback for request failure")}catch(d){v.default.reportError(d)}try{v.default.PAssert(2158,v.default.isFunction(i),"Failure callback must be a valid function")}catch(d){v.default.reportError(d)}s=s||{};try{v.default.PAssert(2159,t&&v.default.isArray(t),"RequestFn must be a valid packed function")}catch(d){v.default.reportError(d)}try{v.default.PAssert(2160,n,"Must provide valid data for the request")}catch(d){v.default.reportError(d)}try{v.default.PAssert(2162,o,"Request type must be specified")}catch(d){v.default.reportError(d)}try{v.default.PAssert(2163,s.accountID||s.token,"Must have an accountID")}catch(d){v.default.reportError(d)}try{v.default.PAssert(2164,!s.combinable,"Combinable is not currently a valid option. Do not use.")}catch(d){v.default.reportError(d)}try{v.default.PAssert(2165,!a||!a.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",a?a.id:"UNDEFINED")}catch(d){v.default.reportError(d)}if(!s.accountID||this.hasSyncAccount(s.accountID)){e.next=16;break}return e.abrupt("return");case 16:s.token&&!s.accountID&&(s.accountID="from_token"),qu&&(this.__ReqStats[o]=this.__ReqStats[o]?this.__ReqStats[o]+1:1),l={id:++this._requestCounter,plugin:this,attach:a?[a]:void 0,request:void 0,requestFn:t,data:n,successCB:[r],failureCB:[i],type:o,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,noBatch:s.noBatch,requestsBehind:this._pendingRequests.length,token:s.token,accountID:s.accountID,scopes:this.googleScopes(),combinable:s.combinable,forceNoDupe:s.forceNoDupe,priority:s.priority?s.priority:y.a.RequestPriority.Default},v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Request Queued: ",this.name,o,l.id,l),this._insertPendingRequest(l),Xh.pluginManager.notifyHasPendingRemoteRequest();case 25:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i,a,o,s){return e.apply(this,arguments)}}()},{key:"_insertPendingRequest",value:function(e){e.priority++;var t=this._pendingRequests.insertSorted(e,this._reqSortFn);return e.priority--,t}},{key:"_reqSortFn",value:function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1}},{key:"_queuePagedRemoteRequestMulti",value:function(e,t,n,r,i,a,o,s){try{v.default.PAssert(2166,e,"Missing accountID parameter")}catch(l){v.default.reportError(l)}try{v.default.PAssert(2167,!v.default.isArray(e),"Missing accountID paramter")}catch(l){v.default.reportError(l)}try{v.default.PAssert(2168,!v.default.isFunction(e),"Missing accountID parameter")}catch(l){v.default.reportError(l)}try{v.default.PAssert(2169,!s||void 0===s.accountID,"AccountID is specified as a separate param")}catch(l){v.default.reportError(l)}var u=s?v.default.clone(s):{};return u.accountID=e,this._queuePagedRemoteRequest(t,n,r,i,a,o,u)}},{key:"_queuePagedRemoteRequest",value:function(e,t,n,r,i,a,o){var s=this;try{v.default.PAssert(2170,o,"Must supply a valid options param")}catch(p){v.default.reportError(p)}try{v.default.PAssert(2171,!o.getAllPages||!o.maxPages,"Should only define either maxPages or getAllPages: ",o.getAllPages,o.maxPages)}catch(p){v.default.reportError(p)}o.maxPages=o.maxPages||1,o.getAllPages=o.getAllPages||!1,o.maxPageResults=o.maxPageResults||(o.maxResults?o.maxResults:100),o.maxResults=o.maxResults||1/0,o.resultsField=o.resultsField||"items";var u,l=0,c=[],d=v.default.clone(t);d.maxResults=o.maxPageResults;var h=function(e){e[o.resultsField]?c.pushArray(e[o.resultsField]):e.items?c.pushArray(e.items):e.history&&c.pushArray(e.history),e.nextPageToken&&(o.getAllPages||o.maxPages>l)&&c.length<o.maxResults?u(e.nextPageToken):e.nextPageToken||e.nextSyncToken||e.historyId?n(c,t,e):n(c)},f=function(e){var t,n;(null===(t=e.error)||void 0===t||null===(n=t.message)||void 0===n?void 0:n.startsWith("Request had invalid authentication credentials."))||r(e,c)};(u=function(t){t&&(d.pageToken=t),l++,s._queueRemoteRequest(e,d,h,f,void 0,a,o)})()}},{key:"_retryRemoteRequest",value:function(e,t){var n=this;v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Request Re-Queued: ",this.name,e.type,e.id,e),qu&&this.__Stats.remoteRetries++,e.request=void 0,e.wasBatched=void 0,e.batchID=void 0,e.batchRequestID=void 0,setTimeout((function(){e.currentRetries=e.currentRetries?e.currentRetries+1:1,n._insertPendingRequest(e),Xh.pluginManager.notifyHasPendingRemoteRequest()}),this._getRetryDelay(e,t))}},{key:"getNumOutstandingReqs",value:function(){return this._numOutstandingReqs}},{key:"_pumpRequestQueue",value:function(e,t,n,r){var i=0,a=0,o=this;try{v.default.PAssert(2172,this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue")}catch(A){v.default.reportError(A)}var s=0,u=0,l=0,c=0,d=0,h=0,f=0;try{v.default.PAssert(2173,this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests")}catch(A){v.default.reportError(A)}var p=t;try{v.default.PAssert(2174,p>0,"Should never have more than max outstanding requests for a given plugin")}catch(A){v.default.reportError(A)}for(var g={},m=this._pendingRequests.filter((function(e){return!e.noBatch})),_=p>1&&m.length>1,b=[],w=0;p>0&&w<this._pendingRequests.length&&f<y.a.MaxBatchSize;++w){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var k=this._pendingRequests[w],S=void 0;if(_&&!k.noBatch&&((S=g[k.accountID])||(S=g[k.accountID]=this.createBatch({accountID:k.accountID,scopes:k.scopes}))),k.priority<e)h++;else{v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Request Pumped: ",this.name,k.type,k.id,k);try{v.default.PAssert(2175,!v.default.isFunction(k),"Should never use a deferred request")}catch(A){v.default.reportError(A)}try{v.default.PAssert(2176,!1===k.handled,"Should never service a request that has already been handled")}catch(A){v.default.reportError(A)}var E=this._getDupeRequest(k);if(E)qu&&this.__Stats.dupedRequests++,k.duped=!0,b.push(k),l++,this._appendDupeRequest(E,k);else{var P=this._getCombineRequest(k);if(P)qu&&this.__Stats.combinedRequests++,k.combined=!0,b.push(k),c++,this._combineRequest(P,k);else{var I=!1;if(k.attach)for(var D=0,T=0;T<k.attach.length;++T){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;k.attach[T].needsRemoteData()&&(k.attach[T].notifyDataRequested(),I=!0)}else I=!0;if(I)if(k.token||this.isCurrentlyAuthorized(k.accountID)){var x=this._runRemoteRequest(S,k,n);if(qu&&this.__Stats.remoteRequests++,x.isNewRequest||0===f){try{v.default.PAssert(2177,t>s,"Should not be making more requests for plugin than allowed")}catch(A){v.default.reportError(A)}s++,p--,this._numOutstandingReqs++,qu&&this.__Stats.actualRemoteCallsSent++}x.wasBatched&&f++,b.push(k)}else Po.a.notifyUnauthorizedRequest(k.accountID),d++;else qu&&this.__Stats.canceledRequests++,k.canceled=!0,u++,b.push(k)}}}}this._pendingRequests=this._pendingRequests.removeArray(b);for(var C=0;C<b.length;++C){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;b[C].canceled||b[C].duped||this._addRequest(this._outstandingRequests,b[C])}return Object.keys(g).forEach((function(e){var t=g[e];try{v.default.PAssert(2178,!t||f+u+l+c+d+h>1,"Batches should always have multiple items in them")}catch(A){v.default.reportError(A)}t&&(f>0?(qu&&o.__Stats.remoteBatches++,o.commitBatch(t,r)):qu&&o.__Stats.canceledBatches++)})),s}},{key:"_clearRequestQueue",value:function(){v.default.log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0}},{key:"_addRequest",value:function(e,t){try{v.default.PAssert(2179,e.indexOf(t)<0,"Should never re-add a request to a queue without removing it first")}catch(n){v.default.reportError(n)}return e.push(t)}},{key:"_removeRequest",value:function(e,t){return e.remove(t)}},{key:"isRateLimited",value:function(){return this._isRateLimited}},{key:"_notifyRateLimitedOver",value:function(){this._isRateLimited=!1}},{key:"_notifyRateLimited",value:function(e){this._isRateLimited=!0,this._lastRateLimitTime=new Date}},{key:"isRateLimitError",value:function(e){var t=!1;return e&&Hu.indexOf(e.status)>=0&&(e.status===y.a.HTTPStatusCode.Forbidden?(v.default.hasGoogleError(e,y.a.GoogleErrorDomain.UsageLimits,y.a.GoogleError.UserRateLimitExceeded)||v.default.hasGoogleError(e,y.a.GoogleErrorDomain.UsageLimits,y.a.GoogleError.RateLimitExceeded)||v.default.hasGoogleError(e,y.a.GoogleErrorDomain.UsageLimits,y.a.GoogleError.QuotaExceeded))&&(t=!0):t=!0),t}},{key:"_getRetryDelay",value:function(e,t){var n=e.currentRetries;return t&&(n=Math.max(2,e.currentRetries)),v.default.seconds(Bu[n])}},{key:"_notifyRequestSuccess",value:function(e,t){var n={cbList:e.successCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(n)):this._handleResponse(n)}},{key:"_notifyRequestFailure",value:function(e,t){var n={cbList:e.failureCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(n)):this._handleResponse(n)}},{key:"_handleResponse",value:function(e){for(var t=0,n=0;n<e.cbList.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{var r=e.result;e.cbList[n](r)}catch(i){v.default.reportError(i)}}}},{key:"_notifyBatchCompleted",value:function(e){var t=this._batchedResponses[e.getBatchID()];if(delete this._batchedResponses[e.getBatchID()],t){var n=0;Xh.PaneUpdateBatcher.beginUpdateItems(),Go.a.beginBatch();for(var r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._handleResponse(t[r])}Go.a.commitBatch(),Xh.PaneUpdateBatcher.commitUpdateItems()}}},{key:"computeBatchGroupID",value:function(e){return e.accountID}},{key:"computeRequestID",value:function(e){return e.id+"-"+Date.now()}},{key:"_setSendTime",value:function(e){var t=Date.now();if(0===e.sendTimes.length){var n=t-e.queueTime;this._numSendRequests++,this._totalRequestSendTime+=n,n>this.LongWaitThreshold&&this._numLongWaitRequests++}e.sendTimes.push(t)}},{key:"_setHandleTime",value:function(e){var t=Date.now();if(0===e.handleTimes.length){var n=t-e.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=n}e.handleTimes.push(t)}},{key:"_runRemoteRequest",value:function(e,t,n){var r,i=this,a={wasBatched:!1,isNewRequest:!1};if(Du.a.canConstruct(t.requestFn))r=t.request=Du.a.createRequest(t.accountID,t.requestFn,t.data,t.token,this.googleScopes());else{0;var o=v.default.unpackFn(t.requestFn);try{v.default.PAssert(2180,v.default.isFunction(o),"Must specify a valid packed function: ",t.requestFn)}catch(c){v.default.reportError(c)}o&&(r=t.request=o(t.data))}if(r){try{v.default.PAssert(2181,r.then,"Remote request must be thenable")}catch(c){v.default.reportError(c)}if(e){var s=this.computeBatchGroupID(t),u=this.computeRequestID(t);a.isNewRequest=e.add(r,s,u);try{v.default.PAssert(2182,v.default.isBoolean(a.isNewRequest),"Add must return whether it will create a new remote request for this request")}catch(c){v.default.reportError(c)}a.wasBatched=!0,t.wasBatched=!0,t.batchID=e.getBatchID(),t.batchRequestID=u}else t.wasBatched=!1,t.batchID=void 0,t.batchRequestID=void 0;v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Request Run: ",this.name,t.type,t.id,t);try{v.default.PAssert(2183,t.token||this.isCurrentlyAuthorized(t.accountID),"Must be currently authorized to make this request")}catch(c){v.default.reportError(c)}this._setSendTime(t);var l=function(e){try{v.default.PAssert(2184,!1===t.handled,"Must not handle the same request multiple times")}catch(c){v.default.reportError(c)}v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Request Failed: ",i.name,t.type,t.id,t,e),i._setHandleTime(t);var r=i.isRateLimitError(e);if(r&&i._notifyRateLimited(e),(r||Vu.indexOf(e.status)>=0)&&t.autoRetry&&t.currentRetries<t.numRetries)n(t.attach,t.plugin,t.wasBatched),i._removeRequest(i._outstandingRequests,t),i._retryRemoteRequest(t,r);else{if(t.handled=!0,t.failed=!0,t.attach)for(var a=0,o=0;o<t.attach.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.attach[o].notifyDataRequestFailed()}i._notifyRequestFailure(t,e.result),n(t.attach,t.plugin,t.wasBatched),i._removeRequest(i._outstandingRequests,t)}};t.request.then((function(e){var r=e.result;if(r&&!r.error||204===e.status){try{v.default.PAssert(2185,!1===t.handled,"Must not handle the same request multiple times")}catch(c){v.default.reportError(c)}v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Request Success: ",i.name,t.type,t.id,t,e),i._setHandleTime(t),t.handled=!0,i._notifyRateLimitedOver(),i._notifyRequestSuccess(t,r),n(t.attach,t.plugin,t.wasBatched),i._removeRequest(i._outstandingRequests,t)}else l(e)}),l)}return a}},{key:"createPaginationToken",value:function(e,t,n,r,i,a){return new Lu(e,t,n,r,i,a)}},{key:"updatePaginationToken",value:function(e,t){try{v.default.PAssert(2186,e,"Must specify a valid token to update")}catch(n){v.default.reportError(n)}try{v.default.PAssert(2187,t,"Must update the pagination token with a valid next page token")}catch(n){v.default.reportError(n)}return e.updateToken(t),e}},{key:"createBatch",value:function(e){return Du.a.createBatch(e)}},{key:"commitBatch",value:function(e,t){var n=this;try{v.default.PAssert(2188,e,"Batch to commit must be specified")}catch(r){v.default.reportError(r)}e.then((function(){n._notifyBatchCompleted(e),t(n,!0)}),(function(){n._notifyBatchCompleted(e),t(n,!1)}))}},{key:"addModifiedOffline",value:function(e,t){try{v.default.PAssert(2189,e,"Must have a valid cache entry to update")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2190,v.default.isBoolean(t)||v.default.isArray(t),"Incoming fields must be valid")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2191,!1!==t,"Use removeModifiedOffline to clear data instead")}catch(r){v.default.reportError(r)}if(e){var n=e.modifiedOffline||!1;try{v.default.PAssert(2192,v.default.isBoolean(n)||v.default.isArray(n),"Previous fields must be valid")}catch(r){v.default.reportError(r)}!1===n?e.modifiedOffline=t:!0===n||(!0===t?e.modifiedOffline=!0:e.modifiedOffline?e.modifiedOffline.pushOnlyUniques(t):e.modifiedOffline=t)}}},{key:"removeModifiedOffline",value:function(e,t){try{v.default.PAssert(2193,e,"Must have a valid cache entry to update")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2194,v.default.isBoolean(t)||v.default.isArray(t),"Incoming fields must be valid")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2195,!0!==t,"Use addModifiedOffline to add data instead")}catch(r){v.default.reportError(r)}if(e){var n=e.modifiedOffline||!1;try{v.default.PAssert(2196,v.default.isBoolean(n)||v.default.isArray(n),"Previous fields must be valid")}catch(r){v.default.reportError(r)}!1===n||(!0===n?!1===t&&(e.modifiedOffline=!1):!1===t?e.modifiedOffline=!1:(e.modifiedOffline=e.modifiedOffline.removeArray(t),0===e.modifiedOffline.length&&(e.modifiedOffline=!1)))}}},{key:"compactCacheField",value:function(e,t){return e[t]}},{key:"_serializeObj",value:function(e,t){var n=0;try{v.default.PAssert(2197,e,"Must specify a valid entry to serialize")}catch(l){v.default.reportError(l)}try{v.default.PAssert(2198,t,"Must provide a valid property list")}catch(l){v.default.reportError(l)}for(var r={},i=0;i<t.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=t[i],o=this.getPropertyDescriptor(a);if(!o.isOpt||o.defaultValue!==e[a]){var s=this.compactCacheField(e,a);void 0!==s&&(r[a]=s)}}var u=this.getBlobData(e);return u&&(r._blob=u),r}},{key:"serializeEntry",value:function(e){var t=this.getPropertySet(y.a.PluginLoad.Full),n=this.getCacheData(e);if(n){var r=this._serializeObj(n,t);return r.id=e,r.plugin=this.id,r}}},{key:"serializeExternalData",value:function(e){try{v.default.PAssert(2199,e,"Must supply valid data to serialize")}catch(r){v.default.reportError(r)}var t=this.getPropertySet(y.a.PluginLoad.Full),n=this._serializeObj(e,t);return n.id=e.id,e.parents&&(n.parents=e.parents),n}},{key:"declareProperty",value:function(e,t,n,r,i){var a=this;try{v.default.PAssert(2200,!this._propertyDescriptors[e],"Should not declare the same property twice")}catch(o){v.default.reportError(o)}t=t||y.a.PluginLoad.Full,n=n||!1,v.default.forEachFlagSet(t,(function(t){a._propertySets[t]||(a._propertySets[t]=[]),a._propertySets[t].push(e)})),this._propertyDescriptors[e]={isOpt:n,defaultValue:r,comparator:i}}},{key:"getPropertySet",value:function(e){return this._propertySets[e]||[]}},{key:"getPropertyDescriptor",value:function(e){return this._propertyDescriptors[e]}},{key:"getBlobData",value:function(e){}},{key:"_updateAttachmentStates",value:function(){try{var e=0;Xh.PaneUpdateBatcher.beginUpdateItems();for(var t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._attachCache[this._attachKeys[t]];n.isInUse()&&n.onUpdate(!1,void 0,y.a.ChangeType.Auto)}Xh.PaneUpdateBatcher.commitUpdateItems()}catch(r){v.default.reportError(r)}}},{key:"offlineLoad",value:function(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad())try{this._offlineLoad&&(this._hasRunOfflineLoad=this._offlineLoad())}catch(e){v.default.reportError(e)}}},{key:"load",value:function(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(e){v.default.reportError(e)}}this._loadedInitialData||!v.default.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()}},{key:"loadInitialData",value:function(){try{v.default.PAssert(2202,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(e){v.default.reportError(e)}try{v.default.PAssert(2203,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(e){v.default.reportError(e)}this._loadedInitialData=!0}},{key:"getDataPane",value:function(){}},{key:"getPaneIcon",value:function(){return"icon-question"}},{key:"getPanePriority",value:function(){return 0}},{key:"getDefaultDisplayItem",value:function(e){}},{key:"useItemStore",value:function(){}},{key:"itemStoreOptions",value:function(){}},{key:"getDefaultItemStore",value:function(){try{v.default.PAssert(2204,this.useItemStore(),"Must request an item store")}catch(e){v.default.reportError(e)}return this._defaultItemStore}},{key:"getActiveItemStore",value:function(e){try{v.default.PAssert(2205,e,"Must specify a valid paneID to get the item store for")}catch(n){v.default.reportError(n)}try{v.default.PAssert(2206,this.useItemStore(),"Must request item store usage")}catch(n){v.default.reportError(n)}var t=this._activeItemStore[e];return t||this._defaultItemStore}},{key:"getBucketItemStore",value:function(e){return this._searchBuckets[e]}},{key:"allowRemoteRequests",value:function(){return!1}},{key:"handleDropEvent",value:function(e,t){return!1}},{key:"handleTapClick",value:function(e,t,n,r){return!1}},{key:"notifyPaneCreated",value:function(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||this.areDependenciesLoaded()&&this.loadInitialData()}},{key:"notifyPaneDestroyed",value:function(){this._numActivePanes--;try{v.default.PAssert(2209,this._numActivePanes>=0,"Should never have negative active panes")}catch(e){v.default.reportError(e)}}},{key:"notifyPanesReadyForLoad",value:function(){Xh.PaneManager.runForEachPane((function(e){e.notifyPluginLoaded()}),this.getPaneType())}},{key:"hasActiveDataPanes",value:function(){return this._numActivePanes>0}},{key:"allowTextEditing",value:function(e,t){return!0}},{key:"_createSearchBucket",value:function(e,t){var n;n=v.default.generateTempId();var r=Xh.itemStoreManager.registerItemStore(n,this,{trackGlobally:!1});return r.createRoot(t||v.default.generateTempId(),"Search Results"),this._searchBuckets[n]=r,n}},{key:"_destroySearchBucket",value:function(e){this._searchBuckets[e].clearStore()}},{key:"swapInSearchBucket",value:function(e,t){try{v.default.PAssert(2210,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(a){v.default.reportError(a)}if(v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Swap IN search bucket: ",e),Xh.PaneManager.isPaneActive(t)){var n=Xh.PaneManager.getPaneById(t),r=this._searchBuckets[e];if(!this._activeSearchBucket[t]||this._activeSearchBucket[t].id!==e){var i=r.getRoot();this._activeSearchBucket[t]||(this._defaultZoomItems[t]=n.getItem()),this._activeItemStore[t]=r,this._activeSearchBucket[t]=r,n.setRootItem(i,!0),n.useItemStore(r)}}}},{key:"swapOutSearchBucket",value:function(e,t){try{v.default.PAssert(2211,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){v.default.reportError(o)}var n=this._activeSearchBucket[e].id;v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Swap OUT search bucket: ",n);var r=Xh.PaneManager.getPaneById(e),i=this._searchBuckets[n];try{v.default.PAssert(2212,i,"Must have a valid bucket we are swapping from")}catch(o){v.default.reportError(o)}var a=r.getRootItem();try{v.default.PAssert(2213,a===i.getRoot(),"Current root for pane should match bucket root")}catch(o){v.default.reportError(o)}t=t||this._defaultZoomItems[e];try{v.default.PAssert(2214,t,"Must always be able to get a valid default zoom item")}catch(o){v.default.reportError(o)}this._activeItemStore[e]=void 0,this._activeSearchBucket[e]=void 0,this._defaultZoomItems[e]=void 0,r.setItem(t,!0),r.stopUsingItemStore(i),this._destroySearchBucket(n)}},{key:"runSearch",value:function(e,t,n,r,i){try{v.default.PAssert(2215,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){v.default.reportError(o)}var a;return r&&(a=this._createSearchBucket(e,n)),this.runRemoteSearch(e,t,a,i)}},{key:"getSearchRoot",value:function(e){var t=this._searchBuckets[e];try{v.default.PAssert(2216,t,"Should always reference a valid search bucket")}catch(n){v.default.reportError(n)}return t.getRoot()}},{key:"isRemoteSearchBucketActive",value:function(e){return!!this._activeSearchBucket[e]}},{key:"clearSearch",value:function(e,t){this._activeSearchBucket[e]&&this.swapOutSearchBucket(e,t)}},{key:"refreshCurrentView",value:function(e){try{v.default.PAssert(2217,!1,"SubClass must override refreshCurrentView",this.id)}catch(t){v.default.reportError(t)}}},{key:"dumpRequestQueue",value:function(e){var t=0,n=0;console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(var r=0;r<this._outstandingRequests.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._outstandingRequests[r];console.log("  ",i.requestFn,":",i.id," - ",i.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(var a=0;a<this._pendingRequests.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this._pendingRequests[a];console.log("  ",o.requestFn,":",o.id," - ",o.data)}if(e){var s=0;try{v.default.PAssert(2218,!1,"Must be in __DEV__ mode to display info on handled requests")}catch(c){v.default.reportError(c)}console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(var u=0;u<this._handledRequests.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=this._handledRequests[u];l.failed?console.log(" !",l.requestFn,":",l.id," - ",l.data):console.log("  ",l.requestFn,":",l.id," - ",l.data)}}}},{key:"dumpQueueStats",value:function(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)}},{key:"getCssClass",value:function(e,t){return""}},{key:"getSyncAccounts",value:function(){var e=this,t=[],n=Xh.settings.syncAccounts.get();return n&&(t=Object.keys(n).filter((function(t){return!!n[t][e.id]}))),t}},{key:"numSyncAccounts",value:function(){return this.getSyncAccounts().length}},{key:"hasSyncAccount",value:function(e,t){var n=!1,r=Xh.settings.syncAccounts.get();if(r){var i=r[e];n=i&&i[this.id]}return n||t||e!==Po.a.getDefaultAccountID()||(n=!0),n}},{key:"_onSyncAccountsChanged",value:function(e,t){var n=this;if(!Xh.settings.isLoading&&!this.isBuiltin){var r=Object.keys(e).some((function(t){return e[t][n.id]}));r!==this.isEnabled()&&(r?(console.log("Enabling",this.id),Do.enablePlugin(this.id)):(console.log("Disabling",this.id),Do.disablePlugin(this.id)));var i=[],a=[];Object.keys(e).forEach((function(r){var a,o;(null===(a=e[r])||void 0===a?void 0:a[n.id])&&!(null===(o=t[r])||void 0===o?void 0:o[n.id])&&i.push(r)})),t&&Object.keys(t).forEach((function(r){var i,o;(null===(i=t[r])||void 0===i?void 0:i[n.id])&&!(null===(o=e[r])||void 0===o?void 0:o[n.id])&&a.push(r)})),this.onSyncAccountsChanged(i,a)}}},{key:"_getVMLIForAccount",value:function(e){var t=this.getDefaultItemStore(),n="A~"+e;return null===t||void 0===t?void 0:t.getItem(n)}},{key:"_ensureVMLIsForAccount",value:function(e,t){try{v.default.PAssert(2220,e,"Must specify a valid account ID")}catch(a){v.default.reportError(a)}var n="A~"+e,r=(t=t||this.getDefaultItemStore()).getItem(n);if(!r){var i=t.getRoot();r=t.createItem(n,e,i.id),i.insertSorted(r,this.sortFn)}return r}},{key:"getAccountIDFromItem",value:function(e){var t,n=e.id;if(n.startsWith("R~")&&(n=n.substr(2)),n.startsWith("A~"))(t=n.substr(2)).startsWith("S~")&&(t=t.substr(2));else if(n.startsWith("L~"))t=n.substring(2,n.indexOf("~",2));else if(n.startsWith("T~"))t=n.substring(2,n.indexOf("~",2));else{var r=e.getAttachmentByPlugin(this.id);t=null===r||void 0===r?void 0:r.getField("accountID")}try{v.default.PAssert(2221,!t||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(i){v.default.reportError(i)}return t}},{key:"getAccountIDForPane",value:function(e){var t;return(null===(t=e.plugin)||void 0===t?void 0:t.getAccountIDFromItem(e.item.get()))||Po.a.getDefaultAccountID()}},{key:"sortFn",value:function(e,t){return e.getParsedText().localeCompare(t.getParsedText())}},{key:"onPaneActivated",value:function(e){}},{key:"getWordStyles",value:function(){return{}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"_offlineLoad",value:function(){}},{key:"_load",value:function(){}},{key:"runRemoteSearch",value:function(e,t,n,r){}},{key:"googleScopes",value:function(e){return[]}},{key:"getDependencies",value:function(){return[]}},{key:"getTextIconPadding",value:function(){return 0}},{key:"getURLForAttachment",value:function(e){return""}},{key:"onSyncAccountsChanged",value:function(e,t){}}]),e}(),b()(Au.prototype,"_onSyncAccountsChanged",[w.a],Object.getOwnPropertyDescriptor(Au.prototype,"_onSyncAccountsChanged"),Au.prototype),Au);G.a.defineBase(zu);var Gu=zu;function Ku(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Yu=function(e){d()(n,e);var t=Ku(n);function n(){var e;return a()(this,n),(e=t.call(this,y.a.PluginID.Date,"t","Date",!0)).pluginMargin=0,e.pluginPadding=8,e.declareProperty("itemID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1),e}return s()(n,[{key:"getDisplayText",value:function(e,t){return this.getUnstyledText(e,t)}},{key:"getStyledText",value:function(e,t,n){return this.getUnstyledText(e,n)}},{key:"getUnstyledText",value:function(e,t){if(t=t||N.a.getItem(e.id)){var n=t.getMooDate();if(n)return n.toText(!0)}return""}},{key:"getWordStyles",value:function(){return{fontSize:11}}},{key:"getAttachmentEmbedString",value:function(){return y.a.CharDate}},{key:"_getTextForItem",value:function(e){try{v.default.PAssert(1098,e,"Must pass in a valid item to get text for")}catch(t){v.default.reportError(t)}return y.a.CharDate}},{key:"getAttachmentClass",value:function(e){var t=["inlineDate","c-date","c-border-light","pressable"],n=N.a.getItem(e.id);if(n){var r=n.getMooDate();r&&r.getGCalId()&&(t=t.concat("syncedToCalendar"))}return t}},{key:"requestData",value:function(e){e.notifyDataLoaded(y.a.PluginLoad.Full,!1,void 0,y.a.ChangeType.Remote)}}]),n}(Gu),Qu={renderPlain:function(e){return e.hasField("title")?e.getField("title"):"Loading..."},renderPaneJSX:function(e){var t=e.item,n=e.pane,r=t.getAttachmentByPlugin(y.a.PluginID.Drive);if(!r)return M.a.createElement("div",null);var i,a=r.getPlugin();r.isLoaded()?(i=r.getField("title"),r.hasField("isDeleted")&&r.getField("isDeleted")&&(i+="  (Deleted)")):(r.hasField("title")&&(i=r.getField("title")+"  (Loading...)"),r.isLocalOnlyAttachment()&&(i="Failed upload"),i="Loading...");var o=t.elsNew.findElement(e,(function(e){return!!e.props.plugin})),s=v.default.classNames("paneDriveItem",null===o||void 0===o?void 0:o.el.props.plugin.displayElement.attrs.cls.join(" "),a.getCssClass(r,n));return M.a.createElement("div",{className:s},M.a.createElement("span",{className:"truncate ib"},i))},renderStyled:function(e,t,n,r){if(e.isLoaded()){var i=e.getField("title");return r&&r.highlightSearch&&(i=Xh.ElementRenderer.replaceTextWithSearch(i,t)),e.hasField("isDeleted")&&e.getField("isDeleted")?i+"  (Deleted)":i}return e.hasField("title")?e.getField("title")+"  (Loading...)":e.isLocalOnlyAttachment()?"Failed upload":"Loading..."}};function Xu(e){this._cb=e,this._pageToken=void 0,this._validToken=!1}G.a.defineBase(Xu),G.a.extend(Xu.prototype,{hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(e){this._pageToken=e,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(e){e?this._pageToken.notifyEndUse():this._validToken=!1}});var $u=Xu;function Ju(e,t,n){this._super.constructor.call(this),this._searchQuery=e,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=n,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=t,G.a.forceBind("onEntry",this)}var Zu={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(e,t){try{v.default.PAssert(2083,v.default.isFunction(e)&&v.default.isFunction(t)||this._lastPageRequest,"Must provide valid callbacks")}catch(s){v.default.reportError(s)}try{v.default.PAssert(2084,!this._invalid,"Should never request another page from an invalidated search")}catch(s){v.default.reportError(s)}try{v.default.PAssert(2085,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(s){v.default.reportError(s)}try{v.default.PAssert(2086,!this._activePageRequest,"Should only run a single request at a time")}catch(s){v.default.reportError(s)}if(e||t||!this._lastPageRequest||(e=this._lastPageRequest.entryCB,t=this._lastPageRequest.doneCB),this._activePageRequest)t(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var n=0,r=0;r<this._pageSize;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this._cachedResults[this._localPageOffset+r];try{e(i)}catch(u){v.default.reportError(u)}}this._localPageOffset+=this._pageSize,t(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:e,doneCB:t},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(var a=0,o=this._localPageOffset;o<this._cachedResults.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=this._cachedResults[o];try{e(i)}catch(u){v.default.reportError(u)}this._localPageOffset++}t(!0)}},onEntry:function(e){this._invalid||this._cachedResults.push(e)},onDone:function(e){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,e?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,this._lastPageRequest.doneCB(e)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};G.a.inherit($u,Ju),G.a.extend(Ju.prototype,Zu);var el,tl=Ju,nl=n(87),rl=n(83),il=n(62),al=n(75);function ol(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var sl,ul=(el=function(e){d()(n,e);var t=ol(n);function n(e){var r;a()(this,n);var i={title:"Files",contextMenuMode:"Drive",paneEmptyMessage:"Loading Google Drive...",paneEmptySearchMessage:"",titleContextMenuHeader:"Open folder",dropEffect:function(){return y.a.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:"Drive",supportPagination:!0,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,searchFilters:[],supportsDocuments:!1};return e.plugin=Xh.pluginManager.getPlugin(y.a.PluginID.Drive),(r=t.call(this,e,i)).type=r.plugin._paneType,r.paneClass="paneOutline panePlugin paneDrive noComplete",r._isSearchingRemote=new E.a(!1),r._currentSearch=void 0,r.initDrive(),r}return s()(n,[{key:"initDrive",value:function(){this.search.onChanged.listen(this.notifySearchChanged),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.item.get()===this.plugin.getDefaultItemStore().getRoot()&&this.setItem(this.getDefaultDisplayItem())}},{key:"destroy",value:function(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,l()(g()(n.prototype),"destroy",this).call(this)}},{key:"_getNotReadyStatus",value:function(){var e="Unknown Error: Unable to load pane data.",t=this.plugin.getUnloadedDependencies();return t&&t.indexOf(y.a.PluginDependency.PremiumSub)>=0&&(e="Only available to premium subscribers."),e}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(e){return this.plugin.getDefaultDisplayItem(e)}},{key:"bottomListMessage",value:function(){var e;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(e="LOAD MORE"),{text:e,clickable:!0}}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDemandLoadData",value:function(e){this.plugin.requestDemandLoadData(this.id,e)}},{key:"requestDataPage",value:function(e){this.plugin.requestDataPage(e)}},{key:"onClose",value:function(){l()(g()(n.prototype),"onClose",this).call(this)}},{key:"_runRemoteSearch",value:function(){var e=this;if(Xh.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getValue();this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(t,this.id,void 0,!1,(function(t){switch(e.isLoading.set(!1),t){case y.a.SearchResultStatus.Done:e.paneTopText.set("");break;case y.a.SearchResultStatus.TooMany:e.paneTopText.set("Too many search results! Be more specific.");break;case y.a.SearchResultStatus.None:e.paneTopText.set("There were no search results");break;case y.a.SearchResultStatus.Error:e.paneTopText.set("There was an error running your search, try again.");break;default:try{v.default.PAssert(2079,!1,"Invalid search state: ",t)}catch(n){v.default.reportError(n)}}}))}}},{key:"notifySearchChanged",value:function(e){var t=this.search.getValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var n=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),n)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"_refreshPaneData",value:function(){this.plugin.refreshCurrentView()}},{key:"notifyDropFrom",value:function(e,t){this.plugin.notifyDropFrom(e,t)}},{key:"applyDropOnBlock",value:function(e,t){if(e.isDate){var n,r=e.dateTime||e.date;n=v.default.isString(r)?Xh.International.parseDate(r,y.a.DateFormat.MDY):r;try{v.default.PAssert(2080,v.default.isDateValid(n),"Must provide a valid date when scheduling an email",e.dateTime,e.date)}catch(i){v.default.reportError(i)}v.default.isDateValid(n)&&this.plugin.scheduleFile(t,n)}}},{key:"dropEffectCopyBehavior",value:function(e,t){return l()(g()(n.prototype),"dropEffectCopyBehavior",this).call(this,e,t)}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"isItemHeader",value:function(e,t){if(e.id.startsWith("A~"))return!0;var n=this.plugin,r=e.getAttachmentByPlugin(n.id),i=r&&n.getCacheData(r.id);return i&&n.isFolder(i)}},{key:"titleOfFirstItem",value:function(){return"My Drive Files"}},{key:"getPaddingForPaneObject",value:function(e){return l()(g()(n.prototype),"getPaddingForPaneObject",this).call(this,e)-(e.overview?10:0)}},{key:"getMobileIcon",value:function(){return"FaFile"}}]),n}(al.a),b()(el.prototype,"notifySearchChanged",[w.a],Object.getOwnPropertyDescriptor(el.prototype,"notifySearchChanged"),el.prototype),el);function ll(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var cl,dl="application/octet-stream",hl="application/vnd.google-apps.folder",fl="application/vnd.google-apps.spreadsheet",pl="application/vnd.google-apps.presentation",gl="application/vnd.google-apps.document",vl="application/vnd.google-apps.drive-sdk.597847337936",ml="image/png",yl="image/jpg",_l="image/jpeg",bl="image/gif",wl="S~SharedWithMe",kl="https://drive.google.com/open?id=",Sl=1e8,El=(sl=function(e){d()(n,e);var t=ll(n);function n(){var e;return a()(this,n),(e=t.call(this,y.a.PluginID.Drive,"d","Files",!1)).displaySharedWithMe=!v.default.isDemoMode(),e._requiresOfflineAuth=!0,e.doesRender=!0,e.isLoadingFiles=new E.a(!1),e.registerSetting("LastChangeId","lastChangeId","i"),e.registerSetting("DriveRootId","driveRootId","d"),e._folderCache=e.registerLocalCache(e.id,y.a.StorageType.IndexedDB,{metadataKeys:["isSyncd"],keyFieldsRN:[]}),e.declareProperty("accountID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,v.default.isDemoMode(),v.default.isDemoMode()?"me":void 0),e.declareProperty("showInline",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0),e.declareProperty("imageWidth",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0),e.declareProperty("titleLower",y.a.PluginLoad.Runtime,!1,""),e.declareProperty("dataUrl",y.a.PluginLoad.Preview|y.a.PluginLoad.Runtime,!0),e.declareProperty("pinToTop",y.a.PluginLoad.Runtime,!0,!1),e.declareProperty("title"),e.declareProperty("mimeType"),e.declareProperty("fileSize",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("alternateLink",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("webContentLink",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("isDeleted",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("modifiedDate",y.a.PluginLoad.Autocomplete,!0),e.declareProperty("parents",y.a.PluginLoad.Autocomplete,!0),e}return s()(n,[{key:"getType",value:function(){return y.a.PluginType.Storage}},{key:"getDataPane",value:function(){try{v.default.PAssert(1100,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){v.default.reportError(e)}return ul}},{key:"getPaneIcon",value:function(){return"icon-drive-file"}},{key:"getPanePriority",value:function(){return 96}},{key:"useItemStore",value:function(){return"Google Drive"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,parserFn:Cs.a.runParseSinglePlugin}}},{key:"getSettingForAccount",value:function(e,t){var n=this.getSetting(t);return null===n||void 0===n?void 0:n[e]}},{key:"setSettingForAccount",value:function(e,t,n,r){var i=this.getSetting(t);i&&v.default.isObject(i)||(i={}),i=Object.assign({},i,So()({},e,n)),this.setSetting(t,i,r)}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"_ensureSpecialFolders",value:function(){}},{key:"_load",value:function(){var e=this;this._ensureSpecialFolders(),this.getSyncAccounts().forEach((function(t){return e._ensureVMLIsForAccount(t)})),v.default.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:v.default.minutes(15),minDelay:v.default.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate})}},{key:"getDefaultDisplayItem",value:function(e){return e||(e=this.getSyncAccounts()[0]),this._ensureVMLIsForAccount(e)}},{key:"_notifyFailedRequest",value:function(e){e&&e.error&&v.default.reportError(new Error("Failed Drive request: "+e.error.code))}},{key:"refreshCurrentView",value:function(){this.hasRecurringTask("ChangeListUpdates")&&this.getRecurringTask("ChangeListUpdates").forceUpdate()}},{key:"loadInitialData",value:function(){var e=this;l()(g()(n.prototype),"loadInitialData",this).call(this);new $u((function(){}));setTimeout((function(){if(!e._folderCache.getMetadata("isSyncd")){v.default.log("Folder cache unsyncd - running folder sync");var t="trashed=false and mimeType contains '"+hl+"'";e._requestRemoteFiles(il.a.FolderStruct,t,999,(function(t,n){e._folderCache.saveEntry(e.serializeExternalData(n))}),(function(){0})),e._folderCache.setMetadata("isSyncd",!0)}}),100);var t=!1,r="trashed=false and 'root' in parents and mimeType != '"+vl+"'";this._requestRemoteFiles(il.a.SubFolder,r,70,(function(t,n){if(e.hasCacheData(n.id)||e._addRemoteEntry(t,n),e.createItem(t,void 0,n),!e.getSettingForAccount(t,e.Settings.DriveRootId)&&n.parents)for(var r=0,i=0;i<n.parents.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n.parents[i].isRoot&&e.setSettingForAccount(t,e.Settings.DriveRootId,n.parents[i].id)}}),(function(){t||(t=!0)}))}},{key:"performChangeListUpdate",value:function(){var e=this;this.getSyncAccounts().forEach((function(t){var n,r=e.getSettingForAccount(t,e.Settings.LastChangeId);e._requestChangeList(t,r,(function(t,i){try{v.default.PAssert(1101,!r||parseInt(i.id)>parseInt(r),"Must have correctly ordered change entry")}catch(a){v.default.reportError(a)}n=i.id;try{!i.fileId||i.file&&i.file.mimeType===vl||e._handleChange(t,i)}catch(o){v.default.reportError(o)}}),(function(r){r&&-1!==n&&e.setSettingForAccount(t,e.Settings.LastChangeId,n)}))}))}},{key:"_deleteFile",value:function(e){e.forEachItem(this.getDefaultItemStore(),(function(e){e.parent().removeChild(e,y.a.ChangeType.Remote),e.setParent(void 0)})),e.updateField("isDeleted",!0)}},{key:"_handleChange",value:function(e,t){var n=this;try{v.default.PAssert(1102,t&&(t.deleted||t.file),"Must have a valid formed change entry to handle")}catch(g){v.default.reportError(g)}if((t.deleted||t.file.mimeType===hl)&&(t.deleted?this._folderCache.hasEntry(t.fileId).then((function(e){e&&n._folderCache.removeEntry(t.fileId)})):this._folderCache.saveEntry(this.serializeExternalData(t.file))),!this.hasCacheData(t.fileId)&&!t.deleted&&t.file){for(var r=0,i=t.file.parents,a=!1,o=0;o<i.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(this.hasCacheData(i[o].id)||i[o].isRoot){a=!0;break}}a&&this._addRemoteEntry(e,t.file)}var s=this.getCacheData(t.fileId);if(s){t.deleted||this.dataHasChanged(s,t.file)&&this._addRemoteEntry(e,t.file);var u=this.getDefaultItemStore();if(t.deleted){var l=this.getAttachment(t.fileId);this._deleteFile(l)}else{var c=0,d=[];this.getAttachment(t.fileId).forEachItem(u,(function(e){for(var r=0,i=!1,a=0;a<t.file.parents.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=t.file.parents[a];if(o.isRoot&&e.parent()&&e.parent().isRootItem()||e.parent()&&e.parent().hasAttachment(o.id)){i=!0,d.push(o.id);break}}e.parent()&&n._isSpecialFolder(e.parent().id)&&(i=!0,d.push(e.parent().id)),!i&&e.parent()&&(e.parent().removeChild(e,y.a.ChangeType.Remote),e.setParent(void 0))}));for(var h=0;h<t.file.parents.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=t.file.parents[h];if(d.indexOf(f.id)<0)if(f.isRoot)this.createItem(e,void 0,{id:t.fileId,mimeType:t.file.mimeType});else this.getAttachment(f.id).forEachItem(u,(function(r){n.createItem(e,r,{id:t.fileId,mimeType:t.file.mimeType})}))}if(this.displaySharedWithMe&&t.file.sharedWithMeDate&&d.indexOf(wl)<0){var p=u.getItem(wl);this.createItem(e,p,{id:t.fileId,mimeType:t.file.mimeType})}}}}},{key:"_isValidFileID",value:function(e){return e.indexOf("~")<0}},{key:"_createItemID",value:function(e,t){var n=0;try{v.default.PAssert(1103,e,"Must provide a fileID")}catch(a){v.default.reportError(a)}try{v.default.PAssert(1104,this._isValidFileID(e),"Invalid fileID - "+e)}catch(a){v.default.reportError(a)}try{v.default.PAssert(1105,t,"Must provide a valid itemStore")}catch(a){v.default.reportError(a)}for(var r=e,i=0;t.hasItem(r)&&i<50;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r=e+"~"+ ++i}try{v.default.PAssert(1106,i<50,"SANITY: Should not have items with 50+ parents")}catch(a){v.default.reportError(a)}return r}},{key:"_hasSameItem",value:function(e,t,n){for(var r=0,i=!1,a=e,o=0;n.hasItem(a)&&o<50;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=n.getItem(a);if(s&&s.parent()&&s.parent().id===t){i=!0;break}a=e+"~"+ ++o}return i}},{key:"_isSpecialFolder",value:function(e){return e.startsWith("S~")}},{key:"requestDemandLoadData",value:function(e,t){var n=this;try{v.default.PAssert(1107,1===t.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(u){v.default.reportError(u)}var r,i=Xh.PaneManager.getPaneById(e),a=t.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(t.id))switch(t.id){case wl:r="trashed=false and sharedWithMe and mimeType != '"+vl+"'";break;default:try{v.default.PAssert(1108,!1,"Invalid special folder ID")}catch(u){v.default.reportError(u)}}r||(r="trashed=false and '"+a.id+"' in parents and mimeType != '"+vl+"'");var o=this.getActiveItemStore(e),s=this.getAccountIDFromItem(t);this._requestRemoteFilesForAccount(s,il.a.SubFolder,t,r,70,(function(e,r){n.hasCacheData(r.id)||n._addRemoteEntry(e,r),n._hasSameItem(r.id,t.id,o)||n.createItem(e,t,r)}),(function(e,n){n||t.hasPaginationToken()||t.notifyLoadDataFailed(i)})),this.sendEvent("RequestDemandLoadData")}},{key:"requestDataPage",value:function(e){this._requestRemoteFiles(il.a.DataPage,e)}},{key:"_ensureAncestorChain",value:function(e,t,n,r,i){var a=this;try{v.default.PAssert(1109,r,"Must provide a valid success callback")}catch(g){v.default.reportError(g)}try{v.default.PAssert(1110,i,"Must provide a valid error callback")}catch(g){v.default.reportError(g)}if(n.parents&&n.parents.length)for(var o=0,s=n.parents.length,u=0,l=function(){++u===s&&r()},c=function(n){try{v.default.PAssert(1111,n,"Must provide valid fileInfo up ancestor chain")}catch(g){v.default.reportError(g)}a.hasCacheData(n.id)||a._addRemoteEntry(e,n),a._ensureAncestorChain(e,t,n,l,i)},d=function(e){if(e){var t=a.serializeExternalData(e);a._folderCache.saveEntry(t),c(t)}else i({error:"Undefined success result."})},h=function(t){if(t)c(t);else{var n=Du.a.fns("drive").files.get.packedFn,r={fileId:t.id};a._queueRemoteRequestMulti(e,n,r,d,i,void 0,il.a.SingleFolder)}},f=0;f<n.parents.length;++f){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var p=n.parents[f].id;try{v.default.PAssert(1112,p,"Must supply a valid parent ID to query")}catch(g){v.default.reportError(g)}h(this._folderCache.getEntry(p))}else r()}},{key:"_hasAttachmentChild",value:function(e,t){for(var n=0,r=!1,i=0;i<e.numItems();++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e.itemAtIndex(i).hasAttachment(t)){r=!0;break}}return r}},{key:"_attachAncestorChain",value:function(e,t,n){var r=this;try{v.default.PAssert(1113,n,"Must provide a valid cache entry to create items for")}catch(s){v.default.reportError(s)}if(n.parents&&n.parents.length>0)for(var i=0,a=0;a<n.parents.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=n.parents[a];try{v.default.PAssert(1114,o&&o.id,"Must supply a valid parent ID to query")}catch(s){v.default.reportError(s)}o.isRoot?this.createItem(e,void 0,n):this._folderCache.getEntry(o.id).then((function(i){r._attachAncestorChain(e,t,i),r.getAttachment(i.id).forEachItem(t,(function(t){r._hasAttachmentChild(t,n.id)||r.createItem(e,t,n)}))}))}}},{key:"getNextSearchPage",value:function(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()}},{key:"runRemoteSearch",value:function(e,t,n,r){var i=this;try{v.default.PAssert(1115,e,"Must provide a valid search")}catch(m){v.default.reportError(m)}try{v.default.PAssert(1116,t,"Must provide a valid pane")}catch(m){v.default.reportError(m)}try{v.default.PAssert(1117,v.default.isFunction(r),"Must provide a valid search callback")}catch(m){v.default.reportError(m)}var a=!1,o=0,s=0,u=0,l=new tl(e,10,this.requestDataPage.bind(this)),c=function(){if(o===s&&a){v.default.log("Done Searching! "+o);var e=y.a.SearchResultStatus.Done;if(l.isValid())Xh.PaneManager.getPaneById(t).search.update(!0),l.isValid()&&l.hasMoreResults()?(v.default.log("Too many search results"),e=y.a.SearchResultStatus.TooMany):l.hasError()||u>0?e=y.a.SearchResultStatus.Error:0===o&&(e=y.a.SearchResultStatus.None),i._lastCompletedSearch=l;r(e)}},d=function(e){a=!0,c()},h=!1,f="trashed=false and (fullText contains '"+e+"')",p=Xh.PaneManager.getPaneById(t),g=this.getAccountIDForPane(p);return this._requestRemoteFilesForAccount(g,il.a.Search,l,f,100,l.onEntry,(function(e,n){l.onDone(n),h||(h=!0,l.isValid()&&(l.hasResults()?l.getNextPage((function(n){return function(e,n){o++,i.hasCacheData(n.id)||i._addRemoteEntry(e,n);var r=i.getActiveItemStore(t);i._ensureAncestorChain(e,r,n,(function(){l.isValid()&&i._attachAncestorChain(e,r,n),s++,c()}),(function(e){v.default.reportError(new Error("Error during remote search: "+e)),s++,u++,c()}))}(e,n)}),d):d()))})),this.sendEvent("RemoteSearch"),l}},{key:"_requestRemoteFiles",value:function(e,t,n,r,i){var a=this;this.getSyncAccounts().forEach((function(o){return a._requestRemoteFilesForAccount(o,e,a._ensureVMLIsForAccount(o,a.getDefaultItemStore()),t,n,r,i)}))}},{key:"_requestRemoteFilesForAccount",value:function(e,t,n,r,i,a,o){var s=this;this.isLoadingFiles.set(!0);var u,l=function(e,t,n){o(e,t,n),s.isLoadingFiles.set(!1)};n&&n.hasPaginationToken()&&!n.paginationTokenInUse()?(r=(u=n.beginDataPageLoad()).getQuery(),i=u.getMaxResults(),a=u.getEntryCB(),l=u.getDoneCB()):n&&n.needsPaginationToken()&&(u=this.createPaginationToken(void 0,r,{},i,a,l),n.setPaginationToken(u),n.beginDataPageLoad()),i=i||70;try{v.default.PAssert(1118,a&&v.default.isFunction(a),"Must define a valid entry callback")}catch(p){v.default.reportError(p)}try{v.default.PAssert(1119,l&&v.default.isFunction(l),"Must define a valid done callback")}catch(p){v.default.reportError(p)}var c,d,h=Du.a.fns("drive").files.list.packedFn,f={fields:"items,nextPageToken",maxResults:i,q:r,pageToken:u&&u.hasMorePages()?u.getNextPageToken():void 0};Po.a.onLoaded((function(){e&&(u||!n?(c=function(t){if(t.items){var r=0;Xh.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<t.items.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a(e,t.items[i])}Xh.PaneUpdateBatcher.commitUpdateItems()}t.nextPageToken&&u&&s.updatePaginationToken(u,t.nextPageToken),n&&u&&n.endDataPageLoad(!!t.nextPageToken),l(e,!0)},d=function(){console.log(e,"failure"),u&&n.endDataPageLoad(!!u),l(e,!1)}):(c=function(){l(e,!0)},d=function(){l(e,!1)}),s._queueRemoteRequestMulti(e,h,f,c,d,void 0,t))}))}},{key:"getRemoteAttachmentData",value:function(e){var t=this,n=Du.a.fns("drive").files.get.packedFn,r={fileId:e.id},i=e.getField("accountID");Po.a.onLoaded((function(){var a=function(n){try{v.default.PAssert(1120,!n||n.id===e.id,"If valid result, attachment should match remote file ID")}catch(r){v.default.reportError(r)}n&&!n.error&&(t._addRemoteEntry(i,n),(n.deleted||n.mimeType===hl)&&(n.deleted?t._folderCache.hasEntry(n.id).then((function(e){e&&t._folderCache.removeEntry(n.id)})):t._folderCache.saveEntry(t.serializeExternalData(n))),e.forEachItem(void 0,(function(e){e.itemChanged.notify()})))};if(i){t._queueRemoteRequestMulti(i,n,r,a,(function(n){if(v.default.isHTTPStatusCode(n,y.a.HTTPStatusCode.NotFound)){var r={id:e.id,mimeType:dl,title:"Unknown",titleLower:"unknown",fileSize:0};t._addRemoteEntry(i,r),t._deleteFile(e)}else e.notifyDataRequestFailed(),t._notifyFailedRequest(n)}),e,il.a.SingleFile)}else t.getSyncAccounts().forEach((function(o){t._queueRemoteRequestMulti(o,n,r,(function(t){i=o,t.accountID=i,a(t),e.notifyDataMutated(["accountID"],y.a.ChangeType.Local)}),(function(){}),e,il.a.SingleFile)}))}))}},{key:"_requestChangeList",value:function(e,t,n,r){var i,a,o,s,u=this;Po.a.onLoaded((function(){if(e){if(t&&t>=0){try{v.default.PAssert(1121,n,"Must supply a valid entry CB")}catch(l){v.default.reportError(l)}try{v.default.PAssert(1122,r,"Must provide a valid done CB")}catch(l){v.default.reportError(l)}i=Du.a.fns("drive").changes.list.packedFn,a={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+t+1,fields:"items,nextPageToken"},o=function(i){var a=0,o=t;Xh.PaneUpdateBatcher.beginUpdateItems();for(var s=0;s<i.items.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=i.items[s];try{v.default.PAssert(1123,c,"Must have a valid change entry")}catch(l){v.default.reportError(l)}try{v.default.PAssert(1124,parseInt(c.id)<Sl,"Must have a valid entry ID")}catch(l){v.default.reportError(l)}try{v.default.PAssert(1125,parseInt(c.id)>parseInt(o),"Must be ordered monotonic increasing")}catch(l){v.default.reportError(l)}o=c.id,n(e,c)}Xh.PaneUpdateBatcher.commitUpdateItems(),i.nextPageToken&&o!==t?u._requestChangeList(e,o,n,r):r(!0)},s=function(e){r(!1)}}else i=Du.a.fns("drive").changes.list.packedFn,a={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:Sl},o=function(t){var i=t.largestChangeId;n(e,{id:i}),r(!0)},s=function(e){r(!1)};u._queueRemoteRequestMulti(e,i,a,o,s,void 0,il.a.ChangeList)}}))}},{key:"_createRemoteEntry",value:function(e,t){var n={accountID:e,id:t.id,mimeType:t.mimeType,title:t.title,titleLower:t.title.toLowerCase(),alternateLink:t.alternateLink,webContentLink:t.webContentLink||t.alternateLink,dataUrl:t.dataUrl,fileSize:+t.fileSize,parents:t.parents,modifiedDate:t.modifiedDate?new Date(t.modifiedDate):void 0};if(n.parents)for(var r=0,i=0;i<n.parents.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._updateParentsEntry(n.parents[i])}return this.isFolder(n)&&(n.items=[]),n}},{key:"_addRemoteEntry",value:function(e,t){var n=this._createRemoteEntry(e,t);this.cacheData(n.id,n)}},{key:"createEntryFromLocal",value:function(e,t){if(this.isFolder(t)&&(t.items=[]),t.titleLower=t.title.toLowerCase(),t.modifiedDate=t.modifiedDate?new Date(t.modifiedDate):void 0,t.isDeleted=t.isDeleted||v.default.isTempId(e),t.parents)for(var n=0,r=0;r<t.parents.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._updateParentsEntry(t.parents[r])}return t}},{key:"_updateParentsEntry",value:function(e){this._folderCache.getEntry(e.id).then((function(t){t&&(e.title=t.title)}))}},{key:"isFolder",value:function(e){return e.mimeType===hl}},{key:"_getCompStringForItem",value:function(e){return e.hasPluginAttachment(this.id)?e.getAttachmentByPlugin(this.id).getTitleString():e.getParsedText()}},{key:"_isItemPinnedToTop",value:function(e){return!!e.hasPluginAttachment(this.id)&&e.getAttachmentByPlugin(this.id).getField("pinToTop")}},{key:"sortFn",value:function(e,t){return this._isItemPinnedToTop(e)?-1:this._isItemPinnedToTop(t)?1:this._getCompStringForItem(e).localeCompare(this._getCompStringForItem(t))}},{key:"getAttachmentClass",value:function(e){var t=["plugin_drive"];return e.hasField("mimeType")?t.push(this.getMimetypeClass(e)):t.push("plugin_drive_unk"),e.hasField("isDeleted")&&e.getField("isDeleted")&&t.push("fileDeleted"),t}},{key:"getMimetypeClass",value:function(e){var t=e.getField("mimeType");if(this.isMimetypeImage(t))return e.getField("showInline")?"plugin_drive_image_inline":"plugin_drive_image";switch(t){case hl:return"plugin_drive_folder";case fl:return"plugin_drive_sheet";case pl:return"plugin_drive_slide";case gl:return"plugin_drive_doc";default:return"plugin_drive_unk"}}},{key:"isMimetypeImage",value:function(e){switch(e){case ml:case bl:case yl:case _l:return!0}}},{key:"isImage",value:function(e){var t=this.getMimetypeClass(e);return e.hasField("mimeType")&&("plugin_drive_image"===t||"plugin_drive_image_inline"===t)}},{key:"googleScopes",value:function(e){return e?[y.a.GScope.DriveFull]:[y.a.GScope.Drive]}},{key:"getDependencies",value:function(){return[y.a.PluginDependency.PremiumSub]}},{key:"verifyAuthorization",value:function(e){return Po.a.isAuthorizedForScopes(e,this.googleScopes())}},{key:"handleDropEvent",value:function(e,t){var n,r,i=e.dataTransfer,a=e.target,o=e.clipboardData,s=null===i||void 0===i?void 0:i.getData("text/uri-list"),u=v.default.getPaneForElement(a);if(s&&s.startsWith(kl)){var l=s.replace(kl,""),c=l.indexOf("&"),d=l.substr(0,c);return v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Dropped File: ",d),t(this.getAttachment(d).getEmbedString()),!0}if((null===i||void 0===i||null===(n=i.files)||void 0===n?void 0:n.length)>0){for(var h=0,f=0;f<i.files.length;++f){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var p=i.files[f];this.handleDropFile(p,u,{target:a},t)}return Xh.onIntroAction("DragFromComp"),!0}if((null===o||void 0===o||null===(r=o.items)||void 0===r?void 0:r.length)>0){for(var g=0,m=0;m<o.items.length;++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var _=o.items[m],b=null===_||void 0===_?void 0:_.getAsFile();b&&(b.customName="Moo.do Upload "+Date.now(),this.handleDropFile(b,u,{target:a},t))}return Xh.onIntroAction("DragFromComp"),!0}return!1}},{key:"highlightItem",value:function(e){e.highlight()}},{key:"handleDropFile",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r,i){var a,o,s,u,l,c,d,h,f,p,g,m=0,_=this;return jo.a.wrap((function(e){for(var b=0;;){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;switch(e.prev=e.next){case 0:a=t.customName||t.name,o=this.findCachedItemsByField("title",a),s=this.getDefaultItemStore(),u=n.type===y.a.PaneMode.Task&&this.isMimetypeImage(t.type)&&Xh.settings.showImagesInline.get()?{showInline:!0}:void 0,l=!1,c=0;case 6:if(!(c<o.length)){e.next=20;break}if(!(m++>5e3&&__infLoop&&__infLoop(m))){e.next=9;break}throw new RangeError;case 9:if((d=o[c]).fileSize!==t.size||d.isDeleted){e.next=17;break}return h=this.getAttachment(d.id,u),n&&n.isWriteable&&n.plugin!==this?i(this.getAttachmentEmbedString(h),!1):n&&n.plugin===this&&(f=this.getDefaultItemStore(),h.forEachItem(f,this.highlightItem)),l=!0,e.abrupt("break",20);case 17:++c,e.next=6;break;case 20:if(l){e.next=28;break}if(p=v.default.generateTempId(),g=(n.plugin||1===this.getSyncAccounts().length)&&this.getAccountIDForPane(n)){e.next=27;break}return e.next=26,Xh.menus.openContextMenuList("Select a Google Drive account to upload to",r.target,this.getSyncAccounts());case 26:g=e.sent;case 27:Po.a.onLoaded((function(){if(g){_.cacheData(p,{accountID:g,title:a,titleLower:a.toLowerCase(),mimeType:t.type});var e,o,l=_.getAttachment(p,u),c=n&&n.isWriteable&&n.plugin!==_,d=!1,h=null===r||void 0===r?void 0:r.target;if(n&&n.isWriteable&&n.plugin!==_?d=!0:h&&(e=v.default.hasClass(h,"paneContent")?n.getItem():v.default.getItemForElement(h))&&!e.isHeader()&&(e=e.parent()),e){if(!e.isRootItem()){var f=e.getAttachmentByPlugin(_.id);try{v.default.PAssert(1126,f,"Drive items must have valid attachments")}catch(y){v.default.reportError(y)}o=f.id}}else e=s.getRoot(),o=_.getSettingForAccount(g,_.Settings.DriveRootId);var m=n.getDocument();_._upload(g,t,l,c,m,o,(function(){try{v.default.PAssert(1127,!s.hasItem(l.id),"When uploading a new file, should never have duplicated items")}catch(y){v.default.reportError(y)}var t=s.createItem(l.id,_.getAttachmentEmbedString(l),e.id);e.insertSorted(t,_.sortFn),d&&i(_.getAttachmentEmbedString(l),!0),(null===m||void 0===m?void 0:m.isShared())&&Xh.toasts.pushMessage({text:"Note: Sharing files with collaborators is temporarily disabled while we rebuild it for the new backend",timeout:8e3})}))}}));case 28:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"notifyDropFrom",value:function(e,t){try{v.default.PAssert(1128,e,"Must have a valid item that was dropped")}catch(a){v.default.reportError(a)}try{v.default.PAssert(1129,t,"Must have a valid pane the item was dropped on")}catch(a){v.default.reportError(a)}if(!v.default.isDemoMode()){var n=e.getAttachmentByPlugin(this.id),r=t.getDocument();if(r){var i=this.getAccountIDForPane(t);rl.a.getDocumentFolder(i,r.id,(function(e){rl.a.copyFileToFolder(i,n.id,e,(function(e,t){}))}))}this.sendEvent("AttachmentDropped")}}},{key:"getAttachUrl",value:function(e){var t=this.getCacheData(e.id);if(t)return t.webContentLink&&t.webContentLink.replace("export=download","")||t.dataUrl}},{key:"getAttachDataUrl",value:function(e){var t=this.getCacheData(e.id);return t&&t.dataUrl}},{key:"handleTapClick",value:function(e,t,n,r){var i=this.getAttachment(n);if(k.a.mac&&r.metaKey||!k.a.mac&&r.ctrlKey||this.isPluginPane)return this.openAttach(i,e,t,!0,r)}},{key:"getURLForAttachment",value:function(e){var t,n=this.getCacheData(e.id);return null!==(t=null===n||void 0===n?void 0:n.alternateLink)&&void 0!==t?t:this._createDriveURL(e.id,null===n||void 0===n?void 0:n.mimeType)}},{key:"openAttach",value:function(e,t,n,r,i){var a=this.getCacheData(e.id);if(a&&this.isPluginPane(n)&&this.isFolder(a))n.zoomIn(t),this.sendEvent("Tap_FolderZoom");else{var o=this.getURLForAttachment(e);o&&(r&&!(k.a.mac&&i.metaKey||!k.a.mac&&i.ctrlKey)&&this.isImage(e)?(o="https://drive.google.com/uc?export=view&id="+a.id,Xh.menus.openLightbox(o)):o&&(v.default.isDemoMode()?Xh.toasts.pushMessage(y.a.MessageID.DemoPluginClick):(Xh.openUrl(o,i),this.sendEvent("Tap_OpenFileDesktop"))))}return!0}},{key:"createFolderURL",value:function(e){return"https://drive.google.com/drive/folders/"+e}},{key:"_createDriveURL",value:function(e,t){var n="https://docs.google.com/";switch(t){case hl:return n+"folderview?id="+e+"&usp=drivesdk";case fl:return n+"spreadsheets/d/"+e+"/edit?usp=drivesdk";case gl:return n+"document/d/"+e+"/edit?usp=drivesdk";case pl:return n+"presentation/d/"+e+"/edit?usp=drivesdk";default:return n+"file/d/"+e+"/edit?usp=drivesdk"}}},{key:"compactCacheField",value:function(e,t){var n;switch(t){case"alternateLink":e[t]!==this._createDriveURL(e.id,e.mimeType)&&(n=e[t]);break;default:n=e[t]}return n}},{key:"supportUsageCache",value:function(){return!0}},{key:"matchAttachment",value:function(e,t){return e.getField("titleLower").indexOf(t)>=0}},{key:"getBlockedText",value:function(e){return"Go Premium to view Drive files"}},{key:"onDocumentShared",value:function(e){e&&this._ensureAttachmentsAreShared()}},{key:"_ensureAttachmentsAreShared",value:function(){}},{key:"notifyAttachmentUnused",value:function(e,t){l()(g()(n.prototype),"notifyAttachmentUnused",this).call(this,e,t),v.default.isDemoMode()}},{key:"_upload",value:function(e,t,n,r,i,a,o){var s=this;t.size>20971520?(Xh.toasts.pushMessage(y.a.MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var u=this.isMimetypeImage(t.type)&&Xh.settings.showImagesInline.get();if(u){var l=new FileReader;l.onload=function(e){var t=s.getCacheData(n.id);t.dataUrl=e.target.result,s.cacheData(n.id,t),o(e)},l.readAsDataURL(t)}var c=new FileReader;c.readAsBinaryString(t),c.onload=function(r){Po.a.onLoaded((function(){Po.a.getAccountAuthToken(e,s.googleScopes(),(function(r){var a=function(i){r?function(r){new nl.a(t,e,{id:r},void 0,(function(){}),(function(t){s.changeID(n,n.id,t.id),Xh.remoteAPI().drivePermissionsPublic(e,t.id,(function(){var r=s.getAttachDataUrl(n);r&&(t.dataUrl=r),s._addRemoteEntry(e,t)}),(function(e){v.default.reportError(new Error("Error adding permission"))}))}),(function(){})).upload()}(i):Xh.toasts.pushMessage({text:"Uploading file failed because of missing authorization. Please check the Drive plugin is enabled.",action:y.a.MessageAction.OpenSettings})};i?s.getDocumentFolder(e,i,a):rl.a.getRootFolder(e,a)}))}))},u||o()}},{key:"getDocumentFolder",value:function(e,t,n){return rl.a.getDocumentFolder(e,t.id,n)}},{key:"scheduleFile",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);try{v.default.PAssert(1130,n,"Must be able to get a valid attachment from item")}catch(u){v.default.reportError(u)}var r=y.a.MSPerHour,i=Xh.pluginManager.getPluginGCalendar();if(i){var a=i.getDefaultExportCalendarID();if(a){var o=n.getField("title"),s=this._createDriveURL(n.id,n.getField("mimeType"));i.createEventForEmail(a,o,s,t,r,(function(e,t,n,r){e||t?t||Xh.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:y.a.MessageAction.Okay}):Xh.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){Xh.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:y.a.MessageAction.Okay})}})}))}else Xh.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:y.a.MessageAction.OpenCalendarSettings})}else Xh.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:y.a.MessageAction.OpenSettings})}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var n=e.toLowerCase(),r=this.findCachedItemsByFn((function(e){return e.titleLower.indexOf(n)>=0}),t);return r.sort((function(e,t){return e.modifiedDate&&t.modifiedDate?Date.compare(e.modifiedDate,t.modifiedDate):e.modifiedDate?-1:t.modifiedDate?1:e.titleLower.localeCompare(t.titleLower)})),r}},{key:"getAttachWidth",value:function(e){return e.hasField("imageWidth")&&e.getField("imageWidth")?+e.getField("imageWidth"):void 0}},{key:"setAttachWidth",value:function(e,t,n){t.updateField("imageWidth",n,!0),e.onAttachInlineUpdate()}},{key:"setShowInline",value:function(e,t,n){t.updateField("showInline",n,!0),e.onAttachInlineUpdate()}},{key:"getStyledText",value:function(e,t,n,r){return Qu.renderStyled(e,t,n,r)}},{key:"getUnstyledText",value:function(e){return Qu.renderPlain(e)}},{key:"getTextIconPadding",value:function(){return 24}},{key:"hasCacheData",value:function(e){var t;return!!(null===(t=this._dataCache[e])||void 0===t?void 0:t.accountID)}},{key:"createItem",value:function(e,t,n){var r=this.getDefaultItemStore();if(t||(t=this._ensureVMLIsForAccount(e,r)),!this._hasAttachmentChild(t,n.id)){var i=r.createItem(this._createItemID(n.id,r),this._getTextForItem(n.id,e),t.id,{demandLoadChildren:n.mimeType===hl});t.insertSorted(i,this.sortFn)}}},{key:"pickFilesFromDrive",value:function(){var e=Bo()(jo.a.mark((function e(t,n){var r,i=this;return jo.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,Po.a.ensureGapiLib("picker");case 2:if((r=(t.plugin||1===this.getSyncAccounts().length)&&this.getAccountIDForPane(t))||!n){e.next=7;break}return e.next=6,Xh.menus.openContextMenuList("Select a Google Drive account",n,this.getSyncAccounts());case 6:r=e.sent;case 7:return e.abrupt("return",new Promise((function(e){Po.a.getAccountAuthToken(r,[y.a.GScope.Drive],(function(t){var n=window.google;if(n&&n.picker&&n.picker.PickerBuilder){(new n.picker.PickerBuilder).addView(n.picker.ViewId.DOCS).setAppId(y.a.FirebaseAppID).enableFeature(n.picker.Feature.MULTISELECT_ENABLED).setOAuthToken(null===t||void 0===t?void 0:t.access_token).setCallback((function(t){"picked"===t.action&&t.docs&&v.default.isArray(t.docs)&&(e(t.docs.map((function(e,t){return i._getTextForItem(e.id,r)}))),i.performChangeListUpdate())})).setSize(1051,650).hideTitleBar().build().setVisible(!0)}}))})));case 8:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onSyncAccountsChanged",value:function(e,t){var r=this;l()(g()(n.prototype),"onSyncAccountsChanged",this).call(this,e,t),e.length>0&&(this._loadedInitialData=!1,this.loadInitialData()),t.forEach((function(e){var t=r._getVMLIForAccount(e);t&&t.deleteSelf(y.a.ChangeType.Remote)}))}}]),n}(Gu),b()(sl.prototype,"performChangeListUpdate",[w.a],Object.getOwnPropertyDescriptor(sl.prototype,"performChangeListUpdate"),sl.prototype),b()(sl.prototype,"sortFn",[w.a],Object.getOwnPropertyDescriptor(sl.prototype,"sortFn"),sl.prototype),sl);function Pl(e){var t=function(e,t){if("object"!==z()(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==z()(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===z()(t)?t:String(t)}function Il(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Dl=["description","end","start","status","summary","extendedProperties"],Tl="syncTokens",xl="calendarList",Cl="MDCProp_",Al="isComplete",Ll="priority",Ol="isStarred",Ml="isArchived",Rl=["modifiedOffline"],Fl=2,Nl=3,jl=4,Ul=6,Bl=7,Vl=8,Hl=9,Wl=10,ql=11,zl=12,Gl=13,Kl=14,Yl=y.a.DefaultEventDuration,Ql=(cl=function(e){d()(n,e);var t=Il(n);function n(){var e;return a()(this,n),(e=t.call(this,y.a.PluginID.GCalendar,"c","Calendar",!1)).pluginMargin=4,e.pluginPadding=14,e._requiresOfflineAuth=!0,e._numEntriesSyncd=0,e._calendarList={},e.declareProperty("accountID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,v.default.isDemoMode()),e.registerSetting("ImportCalendars","importCalendars","i",!0),e.registerSetting("ExportCalendar","exportCalendar","x",!0),e.registerSetting("WeeksPast","weeksPast","p",!0,1),e.registerSetting("WeeksFuture","weeksFuture","f",!0,4),e.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda","o",!0,!1),e.registerSetting("SyncNewEvents","syncNewEvents","n",!0,!0),e.registerSetting("SyncDraggedEvents","syncDraggedEvents","d",!0,!0),e.registerSetting("SyncPopup","syncPopup","y",!0,!0),e.registerSetting("CreateLocalEvents","createLocalEvents","l",!0,!0),e._updateSyncTimes(),e.onCalendarsSynced=new Q.a,e._eventCache=e.registerLocalCache(e.id,y.a.StorageType.IndexedDB,{metadataKeys:[Tl,xl],keyFieldsRN:["startTime","calendarID","modifiedOffline"]}),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._purgeOldData),e.declareProperty("isInvalid",y.a.PluginLoad.Runtime,!0,!1),v.default.isDemoMode()?e.declareProperty("calendarID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0,"me"):e.declareProperty("calendarID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline),e.declareProperty("summary",y.a.PluginLoad.Preview|y.a.PluginLoad.Full),e.declareProperty("status",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,"confirmed"),e.declareProperty("startTime",y.a.PluginLoad.Preview|y.a.PluginLoad.Full),e.declareProperty("endTime",y.a.PluginLoad.Preview|y.a.PluginLoad.Full),e.declareProperty("allDayEvent",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("recurringEventId",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("eid",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("isComplete",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("isArchived",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("isStarred",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("priority",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,y.a.VMLIFlag.None),e.declareProperty("locked",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("modifiedOffline",y.a.PluginLoad.Full,!0,!1),e.declareProperty("source",y.a.PluginLoad.Full,!0),e.declareProperty("location",y.a.PluginLoad.Full,!0),e.declareProperty("description",y.a.PluginLoad.Full,!0),e.declareProperty("attendees",y.a.PluginLoad.Full,!0),e.declareProperty("organizer",y.a.PluginLoad.Full,!0),e._pendingCreates={},e._syncingOfflineChanges=!1,e._hasInitializedTasks=!1,e._purgeOldDataTimeout=void 0,e._eventUpdateTimeout=void 0,e._eventUpdateQueue={},e._propConverter={},e._propConverter[Al]=v.default.parseDate,e._propConverter[Ml]=v.default.parseBoolean,e._propConverter[Ol]=v.default.parseBoolean,e._propConverter[Ll]=e.parsePriority,e}return s()(n,[{key:"getType",value:function(){return y.a.PluginType.Calendar}},{key:"_attachMetadataFields",value:function(){return Rl}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"useItemStore",value:function(){return"Google Calendar"}},{key:"itemStoreOptions",value:function(){return{listenToItemStateChanged:!0,enabledFilters:y.a.ItemStoreFilter.Dates}}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"supportUsageCache",value:function(){return!0}},{key:"googleScopes",value:function(){return[y.a.GScope.Calendar]}},{key:"getDependencies",value:function(){return[y.a.PluginDependency.PremiumSub]}},{key:"hasSettingsError",value:function(){return!1}},{key:"verifyAuthorization",value:function(e){var t=this.googleScopes();return Po.a.isAuthorizedForScopes(e,t)}},{key:"getBlockedText",value:function(){return""}},{key:"computeBatchGroupID",value:function(e){var t="me";return e.data&&e.data.calendarId&&(t=e.data.calendarId),t}},{key:"_serializeDate",value:function(e){return e instanceof Date?e.toISOString():v.default.isNumber(e)?new Date(e).toISOString():e}},{key:"compactCacheField",value:function(e,t){var n;switch(t){case"startTime":case"endTime":n=this._serializeDate(e[t]);break;default:n=e[t]}return n}},{key:"_updateSyncTimes",value:function(){var e=-(this.getSetting(this.Settings.WeeksPast)||1),t=this.getSetting(this.Settings.WeeksFuture)||4;try{v.default.PAssert(1662,v.default.isNumber(e)&&e<=0,"Invalid value for weeksPast: ",e)}catch(n){v.default.reportError(n)}try{v.default.PAssert(1663,v.default.isNumber(t)&&t>=0,"Invalid valid for weeksFuture: ",t)}catch(n){v.default.reportError(n)}this._syncTokenDuration=v.default.weeks(10),this._minSyncStartTime=this._minDisplayStartTime=_s.a.getTodayPlusDays(7*e),this._maxSyncStartTime=this._maxDisplayStartTime=_s.a.getTodayPlusDays(7*t);try{v.default.PAssert(1664,this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}catch(n){v.default.reportError(n)}}},{key:"_shouldDisplayTime",value:function(e,t){return t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime||e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime}},{key:"_filterDates",value:function(e,t,n){return function(r){var i=new Date(r[e]);return i>=t&&i<=n}}},{key:"_purgeOldData",value:function(e){var t=this,n=this._minDisplayStartTime.clone().addDays(-1);this._eventCache.getFilterEntries((function(e){return new Date(e.endTime||e.startTime)<=n})).then((function(n){if(n){var r=0;v.default.log("Removing "+n.length+" old calendar entries.");for(var i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t._eventCache.removeEntry(n[i].id)}}e&&e(!1)}))}},{key:"_offlineLoad",value:function(){var e,t=this;if(this.isEnabled()){var n=this._eventCache.getMetadata(xl);v.default.isEmpty(this._calendarList)&&(this._calendarList=n||{});var r=this._filterDates("startTime",this._minDisplayStartTime,this._maxDisplayStartTime),i=this._eventCache.getPreloadData();if(i){try{v.default.PAssert(1666,v.default.isObject(i),"Calendar preload is not object")}catch(a){v.default.reportError(a)}e=i,v.default.batchRenderUpdates((function(){Xh.PaneUpdateBatcher.beginUpdateItems();var n=t.getDefaultItemStore(),i=n.getRoot();Object.keys(e).forEach((function(o){var s=e[o];if(r(s)){var u=t.createEntryFromLocal(s.id,s);t.cacheData(u.id,u,void 0,void 0,y.a.ChangeType.Auto);try{v.default.PAssert(1665,!n.hasItem(u.id),"Load should never try to create a VMLI that has already been created")}catch(a){v.default.reportError(a)}if(t._eventNeedsItem(u)){if(u.source){var l=Xh.pluginManager.parseEmailURL(u.source.url);if(l.plugin&&!l.plugin.hasCacheData(l.threadID)){var c=l.plugin.createEntryFromLocal(l.threadID,{accountID:l.accountID,subject:u.source.title});l.plugin.cacheData(l.threadID,c)}}var d=t._createItem(n,u,i.id);i.insertItem(d)}}})),Xh.PaneUpdateBatcher.commitUpdateItems(),t._cacheCleanup.notifyWorkAvailable()}))}return!0}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){Xh.PaneUpdateBatcher.beginUpdateItems(),this._hasInitializedTasks=!1,Xh.PaneUpdateBatcher.updateAllItems(!0,!0),Xh.PaneUpdateBatcher.commitUpdateItems()}},{key:"_load",value:function(){!v.default.isDemoMode()&&this.isEnabled()&&(this.createRecurringTask("CalendarListSync",{delay:v.default.hours(2),minDelay:v.default.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:v.default.minutes(2),task:this.runCalendarListSync}),this.createRecurringTask("CalendarEventSync",{delay:v.default.minutes(15),minDelay:v.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:v.default.minutes(2),task:this.runCalendarSync}),this._hasInitializedTasks=!0)}},{key:"goOnline",value:function(){this._hasInitializedTasks&&this.getRecurringTask("CalendarEventSync").forceUpdate()}},{key:"handleTapClick",value:function(e,t,n,r){var i=this.getCacheData(n);if(i){var a=this.getAttachment(n).getField("calendarID"),o=this._getCalendarInfo(a);if(o)try{v.default.PAssert(1667,o.accountID,"Should have an accountID on the calendar")}catch(u){v.default.reportError(u)}if(i.eid&&o.accountID){var s="https://www.google.com/calendar/event?eid="+i.eid+"&authuser="+o.accountID;v.default.isDemoMode()?Xh.toasts.pushMessage(y.a.MessageID.DemoPluginClick):(Xh.openUrl(s,r),this.sendEvent("Tap_OpenGCalendarDesktop"))}return!0}return!1}},{key:"_durationToString",value:function(e){var t=Math.round(e/6e4),n=0,r=0;t>0&&(t-=60*(n=Math.floor(t/60)),n>0&&(n-=24*(r=Math.floor(n/24))));var i="";return r>0&&(i+=r+"d "),n>0&&(i+=n+"h "),t>0&&(i+=t+"m "),i.trim()}},{key:"_createItemDateText",value:function(e){return e.allDayEvent?e.startTime.toString(Xh.International.getFormat(y.a.DFormat.MonthDayYear)):e.startTime.toString(Xh.International.getFormat(y.a.DFormat.DayYearTime))}},{key:"_createItemDurationText",value:function(e){var t,n=e.endTime-e.startTime;if(e.allDayEvent)if(n>v.default.days(1)){var r=e.endTime.clone();r.addMilliseconds(-1),t="until "+r.toString(Xh.International.getFormat(y.a.DFormat.MonthDayYear))}else t="";else t=this._durationToString(n);return t}},{key:"_createItemSummaryText",value:function(e){var t;if(e.source&&e.source.url){var n=Xh.pluginManager.parseEmailURL(e.source.url);n.plugin&&(t=n.plugin._getTextForItem({id:n.threadID}))}return t||(t=e.summary?e.summary.replace(/\u2000/g,""):""),t+" "+y.a.CharDate}},{key:"_createItemText",value:function(e){try{v.default.PAssert(1668,e,"Must specify a valid attachment")}catch(t){v.default.reportError(t)}return this._createItemSummaryText(e)}},{key:"_eventNeedsItem",value:function(e){return"cancelled"!==e.status&&!e.isArchived}},{key:"mooDateFromCacheEntry",value:function(e){var t=!e.allDayEvent&&e.endTime-e.startTime||void 0;return new Is.a(new Date(e.startTime.getTime()),{gcalId:e.id,duration:t,gcalCalendar:e.calendarID})}},{key:"_createItem",value:function(e,t,n){var r;try{v.default.PAssert(1669,this._eventNeedsItem(t),"Item must always be required to cause create")}catch(s){v.default.reportError(s)}v.default.isDateValid(t.isComplete)&&(r=t.isComplete);var i={date:this.mooDateFromCacheEntry(t).toData(),priority:t.priority,isComplete:!!t.isComplete,isArchived:t.isArchived,dateCompleted:r,isStarred:t.isStarred},a=e.createItem(t.id,this._createItemText(t),n,i,y.a.ChangeType.Auto);if(t.description){var o=e.createItem(t.id+"_note",t.description,a.id,{isNote:!0},y.a.ChangeType.Auto);a.setNote(o,y.a.ChangeType.Auto)}return a}},{key:"getRemoteAttachmentData",value:function(e){var t=this;if(e.hasField("calendarID")){var n=e.getField("calendarID"),r=this._getCalendarInfo(n);if(r)try{v.default.PAssert(1671,r.accountID,"Should have an accountID on the calendar")}catch(o){v.default.reportError(o)}var i=Du.a.fns("calendar").events.get.packedFn,a={eventId:e.id,calendarId:n};r&&this._queueRemoteRequestMulti(r.accountID,i,a,(function(i){try{v.default.PAssert(1672,!i||i.id===e.id,"If valid result, attachment should match remote event ID")}catch(o){v.default.reportError(o)}if(i){var a=t._addRemoteEntry(r.accountID,n,i);t._eventCache.saveEntry(t.serializeExternalData(a))}}),(function(){e.notifyDataRequestFailed()}),e,Ul)}else Xh.settings.fixedMissingCalendars.get()?e.isLoaded()&&e.updateField("status","cancelled"):(this.needsFixMissingData||(this.needsFixMissingData=[]),this.needsFixMissingData.push(e),v.default.timeoutOnce("fixcalendar",this.fixMissingCalendars,5e3,(function(){return t.needsFixMissingData=void 0}),this.needsFixMissingData))}},{key:"_createRemoteEntry",value:function(e,t,n){var r,i,a,o=!1;try{v.default.PAssert(1673,n.start,"Must always have valid start date",Object.keys(n))}catch(c){v.default.reportError(c)}if(n.start)if(n.start.dateTime){try{v.default.PAssert(1674,n.end.dateTime,"End date format should always match start")}catch(c){v.default.reportError(c)}r=new Date(n.start.dateTime),i=new Date(n.end.dateTime)}else if(n.start.date){try{v.default.PAssert(1675,n.end.date,"End date format should always match start")}catch(c){v.default.reportError(c)}var s=n.start.date.split("-"),u=n.end.date.split("-");r=new Date(s[0],s[1]-1,s[2]),i=new Date(u[0],u[1]-1,u[2]),o=!0}n.htmlLink&&(a=n.htmlLink.split("?eid=")[1]);var l={id:n.id,accountID:e,calendarID:t,status:n.status,summary:n.summary,startTime:r,endTime:i,allDayEvent:o,recurringEventId:n.recurringEventId,eid:a,isComplete:this._getRemoteProperty(n,Al),isArchived:this._getRemoteProperty(n,Ml),isStarred:this._getRemoteProperty(n,Ol),priority:this._getRemoteProperty(n,Ll),locked:n.locked||!1,attendees:n.attendees,location:n.location,description:n.description,organizer:n.organizer?n.organizer.displayName||n.organizer.email||n.organizer.id:"Unknown"};return n.source&&(l.source={title:n.source.title,url:n.source.url}),l}},{key:"_addRemoteEntry",value:function(e,t,n){var r=this._createRemoteEntry(e,t,n);return this.cacheData(r.id,r),r}},{key:"createEntryFromLocal",value:function(e,t){return t.startTime=t.startTime?new Date(t.startTime):void 0,t.endTime=t.endTime?new Date(t.endTime):void 0,t.isComplete=this._propConverter[Al](t.isComplete),t.isArchived=this._propConverter[Ml](t.isArchived),t.isStarred=this._propConverter[Ol](t.isStarred),t.priority=this._propConverter[Ll](t.priority),t}},{key:"_notifyFailedRequest",value:function(e,t){e&&e.error&&!e.isInvalidToken&&"Invalid Credentials"!==e.error.message&&(e.error.code===y.a.HTTPStatusCode.Unauthorized?(v.default.log("LostPermission",t,e),Xh.toasts.pushMessage(y.a.MessageID.LostPermission)):e.error.code>=400&&e.error.code<500&&v.default.reportError(new Error("Failed GCalendar request: "+e.error.code),e))}},{key:"_getRemoteProperty",value:function(e,t){try{v.default.PAssert(1676,e,"Must provide valid event info")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1677,t,"Must provide valid remote prop")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1678,this._propConverter[t],"Missing prop converter: ",t)}catch(r){v.default.reportError(r)}var n;return e.extendedProperties&&e.extendedProperties.private&&(n=e.extendedProperties.private[Cl+t]),this._propConverter[t]&&(n=this._propConverter[t](n)),n}},{key:"_updateAttachFromData",value:function(e,t){var n=[];for(var r in t)t.hasOwnProperty(r)&&e.isFieldDefined(r)&&(e.updateField(r,t[r]),n.push(r));return n}},{key:"_runRemoteUpdate",value:function(e,t,n,r,i,a){var o,s,u,l,c=arguments,d=this;try{v.default.PAssert(1679,!e.getField("locked"),"Should never try to modify an event that is locked")}catch(p){v.default.reportError(p)}try{v.default.PAssert(1680,v.default.isBoolean(t)||v.default.isArray(t),"Must specify a boolean or list of fields for modified value")}catch(p){v.default.reportError(p)}try{v.default.PAssert(1681,v.default.isFunction(r),"Must provide a valid localDoneCB")}catch(p){v.default.reportError(p)}try{v.default.PAssert(1682,v.default.isFunction(i),"Must provide a valid remoteDoneCB")}catch(p){v.default.reportError(p)}try{v.default.PAssert(1683,v.default.isFunction(a),"Must provide a valid allDoneCB")}catch(p){v.default.reportError(p)}var h=function(e,t,n){try{v.default.PAssert(1684,v.default.isFunction(e),"Must supply a valid CB function")}catch(p){v.default.reportError(p)}try{v.default.PAssert(1685,void 0!==t,"Must always pass success back from CB")}catch(p){v.default.reportError(p)}if(e.apply(d,Array.prototype.slice.call(c,1)),e===r){try{v.default.PAssert(1686,void 0===o,"Local CB called twice")}catch(p){v.default.reportError(p)}o=t,u=n}else if(e===i){try{v.default.PAssert(1687,void 0===s,"Remote CB called twice")}catch(p){v.default.reportError(p)}s=t,l=n}void 0!==o&&void 0!==s&&a(o,s,u,l)},f=this.getCacheData(e.id);try{v.default.PAssert(1688,f,"Performing update on event that does not have local data")}catch(p){v.default.reportError(p)}f?(this.addModifiedOffline(f,t),this._eventCache.saveEntry(this.serializeExternalData(f)),n((function(n,a){if(n){var o=d.getCacheData(e.id),s=!0!==t&&t;d.removeModifiedOffline(o,s),d._eventCache.saveEntry(d.serializeExternalData(o)),h(i,!0)}else h(r,!1),h(i,!1,a)}))):(h(r,!1),h(i,!1))}},{key:"_updateEvent",value:function(e,t,n,r,i,a){var o=this,s=this._updateAttachFromData(e,t);this._runRemoteUpdate(e,s,(function(r){o._updateRemoteEvent(e.getField("calendarID"),e.id,t,n,r)}),r,i,a)}},{key:"_updateRemoteEvent",value:function(e,t,n,r,i){var a=this;try{v.default.PAssert(1689,this.hasWritePermissionForCalendar(e),"Should not be calling _updateRemoteEvent for a read-only calendar")}catch(c){v.default.reportError(c)}var o=this._createEventUpdateInfo(n),s=this._getCalendarInfo(e);try{v.default.PAssert(1690,s,"Missing calendar "+e)}catch(c){v.default.reportError(c)}if(s){try{v.default.PAssert(1691,s.accountID,"Should have an accountID on the calendar")}catch(c){v.default.reportError(c)}var u=Du.a.fns("calendar").events.patch.packedFn,l={calendarId:e,eventId:t,resource:o};this._queueRemoteRequestMulti(s.accountID,u,l,(function(){i(!0)}),(function(n){if(n&&n.error&&n.error.code===y.a.HTTPStatusCode.NotFound)a._eventCache.removeEntry(t),i(!0);else{var r=Object.keys(o);if(v.default.log("Failed Update: ",e,t,r),v.default.isHTTPStatusCode(n,y.a.HTTPStatusCode.Forbidden)&&!a.isRateLimitError(n)){var s=a.getCacheData(t);s&&(s.locked=!0),a.cacheData(t,s,!0,["locked"])}i(!1,n),a._notifyFailedRequest(n,e)}}),void 0,Vl||r)}}},{key:"_updateRemoteProperty",value:function(e,t,n,r,i,a){var o=this;e.updateField(t,n);var s={},u=void 0===n?null:n;s[Cl+t]=u;var l={extendedProperties:{private:s}};this._runRemoteUpdate(e,[t],(function(t){o._updateRemoteEvent(e.getField("calendarID"),e.id,l,Nl,t)}),r,i,a)}},{key:"_getStartEndFromDateInfo",value:function(e,t){var n,r,i,a=!1;if(e instanceof Date)e.hasTimeOfDay()||(a=!0),n=e,r=e.clone().addMilliseconds(t);else if(e instanceof Is.a)n=e.getStart(),r=e.getEnd(),i=e.toICal();else try{v.default.PAssert(1692,!1,"Should always have a valid date")}catch(o){v.default.reportError(o)}return{startTime:n,endTime:r,allDayEvent:a,recurrence:i}}},{key:"deleteCalendarEventForItem",value:function(e,t,n,r,i){var a=this;this.sendEvent("DeleteEvent");this._runRemoteUpdate(t,["status"],(function(n){e.getMooDate().removeGCal(),e.getDocumentOwner()&&(e.onMooDateUpdated(y.a.ChangeType.Local,!0),e.onAttachInlineUpdate()),t.isLocalOnlyAttachment()?(t.updateField("status","cancelled"),n(!0)):a.deleteCalendarEvent(t,n)}),n,r,i)}},{key:"deleteCalendarEvent",value:function(e,t){var n=this;try{v.default.PAssert(1693,!e.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event")}catch(u){v.default.reportError(u)}var r=e.getField("calendarID"),i=this._getCalendarInfo(r);try{v.default.PAssert(1694,r&&i,"Tried to delete calendar event with no calendar")}catch(u){v.default.reportError(u)}if(i){try{v.default.PAssert(1695,i.accountID,"Should have an accountID on the calendar")}catch(u){v.default.reportError(u)}var a=Du.a.fns("calendar").events.delete.packedFn,o={calendarId:r,eventId:e.id},s=function(){var r=n.getDefaultItemStore();e.updateField("status","cancelled"),e.forEachItem(r,(function(e){e.parent()&&(e.parent().removeChild(e,y.a.ChangeType.Local),e.setParent(void 0))})),n._eventCache.saveEntry(n.serializeExternalData(e.getData())),t(!0)};this._queueRemoteRequestMulti(i.accountID,a,o,(function(){s()}),(function(r){r&&r.error&&r.error.code===y.a.HTTPStatusCode.Gone||r&&r.error&&r.error.code===y.a.HTTPStatusCode.NotFound?s():(t(!1,r),n._notifyFailedRequest(r,e.getField("calendarID")))}),void 0,Wl)}else t(!0)}},{key:"forceRemoteEventSync",value:function(e){if(!v.default.isDemoMode()&&this._hasInitializedTasks){if(e&&this._eventCache.setMetadata(Tl,{}),this.hasRecurringTask("CalendarEventSync"))this.getRecurringTask("CalendarEventSync").forceUpdate();if(this.hasRecurringTask("CalendarListSync"))this.getRecurringTask("CalendarListSync").forceUpdate()}}},{key:"getDefaultExportCalendarID",value:function(){return v.default.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)}},{key:"isExportCalendarID",value:function(e){return this.getSetting(this.Settings.ExportCalendar)===e}},{key:"hasWritePermissionForAttach",value:function(e){var t=!1,n=e.getField("calendarID"),r=this._getCalendarInfo(n);return r&&("writer"!==r.accessRole&&"owner"!==r.accessRole||(t=!0)),t}},{key:"hasWritePermissionForCalendar",value:function(e){var t=!1,n=this._getCalendarInfo(e);return n&&("writer"!==n.accessRole&&"owner"!==n.accessRole||(t=!0)),t}},{key:"getCalendarBackgroundColor",value:function(e){var t="rgba(0, 120, 255, 0.75)",n=this._getCalendarInfo(e);return n&&n.backgroundColor&&(t=n.backgroundColor),t}},{key:"getCalendarForegroundColor",value:function(e){var t="#000000",n=this._getCalendarInfo(e);return n&&n.foregroundColor&&(t=n.foregroundColor),t}},{key:"getCalendarDisplayProps",value:function(e){var t,n=this._getCalendarInfo(e);return n&&"reader"===n.accessRole&&(t={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),t}},{key:"shouldDisplayOverdueInAgenda",value:function(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)}},{key:"createEventForEmail",value:function(e,t,n,r,i,a){var o=this;try{v.default.PAssert(1696,v.default.isString(e),"Must provide a valid calendarID for email")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1697,v.default.isString(t),"Must provide a valid subject")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1698,v.default.isString(n),"Must provide a valid email url")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1699,v.default.isDateValid(r),"Must provide a valid schedule date")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1700,v.default.isNumber(i),"Must provide a valid event duration")}catch(u){v.default.reportError(u)}this.sendEvent("AddEmailEvent");var s={duration:i,summary:t,date:r,source:{title:t,url:n}};this.createNewCalendarEvent(e,s,(function(e){if(e){var t=o.getDefaultItemStore();if(!t.hasItem(e.id)){Xh.PaneUpdateBatcher.beginUpdateItems();var n=t.getRoot(),r=o._createItem(t,e,n.id);n.insertItem(r),Xh.PaneUpdateBatcher.commitUpdateItems()}}}),v.default.newEmptyFn(),a)}},{key:"createEventForItem",value:function(e,t){!e.hasPluginAttachment(this.id)&&e.getNextDate()&&((t=t||this.getDefaultExportCalendarID())?e.getDate()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(t,e,(function(e,t,n,r){e||t?t||r&&r.error&&-1===r.error.code?Xh.onIntroAction("AddCalendar"):Xh.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:y.a.MessageAction.Okay}):n&&!1===n.isValid?Xh.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:y.a.MessageAction.Okay}):Xh.toasts.pushMessage({text:'There was an error creating your calendar event. There may be a problem with your authorization. Please try toggling your "Save To" calendar off and back on, or try toggling the Google Calendar plugin off and on. Contact support@moo.do if you have questions',action:y.a.MessageAction.OpenCalendarSettings})}))):(this.sendEvent("AddRepeatEvent"),Xh.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:y.a.MessageAction.Okay})):Xh.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:y.a.MessageAction.OpenCalendarSettings}))}},{key:"newCalendarEventForItem",value:function(e,t,n){var r=this;try{v.default.PAssert(1701,t,"Must provide a valid item")}catch(s){v.default.reportError(s)}try{v.default.PAssert(1702,t.getNextDate(),"Item must have a valid date")}catch(s){v.default.reportError(s)}try{v.default.PAssert(1703,!t.hasPluginAttachment(y.a.PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item")}catch(s){v.default.reportError(s)}var i=t.getDuration();i||(i=t.allDayDate()?v.default.days(1):Yl);var a={duration:i,summary:t.getCalendarParsedText()};if(t.getDate()&&(a.date=t.getDate()),t.hasNote()&&(a.description=t.getNote().getParsedText()),t.hasAttachmentType(y.a.PluginType.Email)){var o=t.getAttachmentByType(y.a.PluginType.Email);a.source={title:o.getField("subject"),url:o.getPlugin().getURLForAttachment(o)}}this.createNewCalendarEvent(e,a,(function(e){if(e)if(t.isDestroyed()){var n=r.getDefaultItemStore();if(!n.hasItem(e.id)){Xh.PaneUpdateBatcher.beginUpdateItems();var i=n.getRoot(),a=r._createItem(n,e,i.id);i.insertItem(a),Xh.PaneUpdateBatcher.commitUpdateItems()}}else t.getMooDate().setGCalIdAndCalendar(e.id,e.calendarID),t.onMooDateUpdated(y.a.ChangeType.Local,!0),t.setTextToWhatItAlreadyIs(y.a.ChangeType.Local)}),v.default.newEmptyFn(),n)}},{key:"createNewCalendarEvent",value:function(e,t,n,r,i){var a=this;try{v.default.PAssert(1705,t,"Must have valid event info passed in")}catch(d){v.default.reportError(d)}try{v.default.PAssert(1706,t.date,"Must have valid date for event")}catch(d){v.default.reportError(d)}try{v.default.PAssert(1707,void 0!==t.duration,"Must have a valid event duration")}catch(d){v.default.reportError(d)}try{v.default.PAssert(1708,t.summary,"Must have a valid event summary")}catch(d){v.default.reportError(d)}try{v.default.PAssert(1709,v.default.isFunction(n),"Must supply a valid local done CB")}catch(d){v.default.reportError(d)}try{v.default.PAssert(1710,v.default.isFunction(r),"Must supply a valid remote done CB")}catch(d){v.default.reportError(d)}var o=v.default.generateTempId(),s=this._getStartEndFromDateInfo(t.date,t.duration),u=this._getCalendarInfo(e);if(u){try{v.default.PAssert(1711,u.accountID,"Should have an accountID on the calendar")}catch(d){v.default.reportError(d)}var l={id:o,accountID:u.accountID,calendarID:e,status:"confirmed",summary:t.summary,source:t.source,description:t.description,startTime:s.startTime,endTime:s.endTime,allDayEvent:s.allDayEvent,recurrence:s.recurrence,organizer:u.accountID,modifiedOffline:!0};this.cacheData(o,l),this._eventCache.saveEntry(l),n(l,!0);var c=this.getAttachment(l.id);v.default.isDemoMode()?(r(!0),i(!0,!0)):this._runRemoteUpdate(c,!0,(function(t){a._createRemoteEventFromCacheData(u.accountID,e,l,v.default.newEmptyFn(),t,i)}),v.default.newEmptyFn(),r,(function(){a.getDefaultItemStore().updateItems()}))}}},{key:"_createRemoteEventFromCacheData",value:function(e,t,n,r,i,a){var o,s,u,l,c=arguments,d=this;try{v.default.PAssert(1712,!this._pendingCreates[n.id],"Should never try and double create a calendar event")}catch(f){v.default.reportError(f)}this._pendingCreates[n.id]=!0;var h=function(e,t,n){try{v.default.PAssert(1713,v.default.isFunction(e),"Must supply a valid CB function")}catch(f){v.default.reportError(f)}try{v.default.PAssert(1714,void 0!==t,"Must always pass success back from CB")}catch(f){v.default.reportError(f)}if(e.apply(d,Array.prototype.slice.call(c,1)),e===r){try{v.default.PAssert(1715,void 0===o,"Local CB called twice")}catch(f){v.default.reportError(f)}o=t,u=n}else if(e===i){try{v.default.PAssert(1716,void 0===s,"Remote CB called twice")}catch(f){v.default.reportError(f)}s=t,l=n}void 0!==o&&void 0!==s&&a(o,s,u,l)};this._createNewRemoteEvent(t,n,(function(a,o){delete d._pendingCreates[n.id],Xh.PaneUpdateBatcher.beginUpdateItems();var s=d.getAttachment(n.id);if(a){var u=n.id;d.changeID(s,s.id,a.id);var l=d.getDefaultItemStore(),c=l.getRoot();l.hasItem(u)&&l.destroyItem(u),d._eventCache.removeEntry(u);var f=d._addRemoteEntry(e,t,a),p=d._createItem(l,f,c.id);c.insertItem(p),d._eventCache.saveEntry(d.serializeExternalData(f)),h(r,!0),s.updateField("isInvalid",!1),h(i,!0)}else s.updateField("isInvalid",!0),h(r,!1),h(i,!1,o);Xh.PaneUpdateBatcher.commitUpdateItems()}))}},{key:"_createNewRemoteEvent",value:function(e,t,n){var r=this;try{v.default.PAssert(1717,t,"Must specify valid event info")}catch(l){v.default.reportError(l)}try{v.default.PAssert(1718,t.startTime instanceof Date,"Must have a valid start time")}catch(l){v.default.reportError(l)}try{v.default.PAssert(1719,t.endTime instanceof Date,"Must have a valid end time")}catch(l){v.default.reportError(l)}try{v.default.PAssert(1720,t.summary,"Must have a valid event title")}catch(l){v.default.reportError(l)}var i,a,o=this._getCalendarInfo(e);try{v.default.PAssert(1721,o.accountID,"Should have an accountID on the calendar")}catch(l){v.default.reportError(l)}t.allDayEvent?(i={date:t.startTime.toString("yyyy-MM-dd")},a={date:t.endTime.toString("yyyy-MM-dd")}):(i={dateTime:t.startTime.toISOString()},a={dateTime:t.endTime.toISOString()});var s=Du.a.fns("calendar").events.insert.packedFn,u={calendarId:e,resource:{start:i,end:a,recurrence:t.recurrence,summary:t.summary,description:t.description,status:t.status,source:t.source}};this._queueRemoteRequestMulti(o.accountID,s,u,(function(e){n(e)}),(function(t){n(void 0,t),r._notifyFailedRequest(t,e)}),void 0,Bl)}},{key:"getImportCalendarList",value:function(){var e=this,t=this.getSetting(this.Settings.ImportCalendars);return t?t.filter((function(t){return e.hasSyncAccount(t.accountID,!0)})):[]}},{key:"getReadableCalendarList",value:function(e){return this._getCalendarList("reader",e)}},{key:"getWritableCalendarList",value:function(e){return this._getCalendarList("writer",e)}},{key:"getWritableCalendarListSync",value:function(e){var t=this.getImportCalendarList();return t?t.filter((function(t){return(!e||t.accountID===e||!t.accountID&&e===Po.a.getDefaultAccountID())&&("writer"===t.accessRole||"owner"===t.accessRole)})):[]}},{key:"getFullCalendarList",value:function(e){var t=this,n=this.getImportCalendarList();this.getReadableCalendarList((function(r){if(n&&r){var i=n.map((function(e){var t=v.default.clone(e);return t.accessRole="none",t})).filter((function(e){if(t.hasSyncAccount(e.accountID)){for(var n=0,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r[i].id===e.id)return!1}return!0}}));r.pushArray(i)}e(r)}))}},{key:"createCalendar",value:function(e,t,n){var r=this,i=Du.a.fns("calendar").calendars.insert.packedFn,a={resource:{summary:t}};this._queueRemoteRequestMulti(e,i,a,(function(e){n(e)}),(function(e){n(),r._notifyFailedRequest(e,void 0)}),void 0,ql,{}),this.sendEvent("CreateCalendar")}},{key:"_getCalendarList",value:function(e,t){var n=this.getSyncAccounts(),r=n.length,i=[],a=function(e){if(r--,e&&(i=v.default.arrayUniques(i.concat(e))),0===r){var n={};i=i.filter((function(e,t){var r=i.find((function(n,r){return t!==r&&n.id===e.id}));return r&&n[e.backgroundColor]&&(e.backgroundColor=r.backgroundColor),n[e.backgroundColor]=!0,!r||"owner"===e.accessRole||"owner"!==r.accessRole})),t(i)}};if(0===n.length)t([]);else for(var o=0,s=0;s<n.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;this._getCalendarListForAccount(n[s],e,a)}}},{key:"_getCalendarListForAccount",value:function(e,t,n){var r=this,i=Du.a.fns("calendar").calendarList.list.packedFn,a={minAccessRole:t,userId:"me"};this._queuePagedRemoteRequestMulti(e,i,a,(function(t){t=t.map((function(t){return t.accountID=e,t})),n(t)}),(function(e){r._notifyFailedRequest(e,void 0),n([])}),void 0,jl,{getAllPages:!0,timeoutMS:0})}},{key:"handleEventUpdate",value:function(e,t,n){this._numEntriesSyncd++;var r=this.getDefaultItemStore();if("cancelled"===n.status){if(this.hasAttachment(n.id)){var i=this.getAttachment(n.id);i.getField("calendarID")===t&&(this._eventCache.removeEntry(n.id),this.hasCacheData(n.id)&&(i.updateField("status","cancelled"),i.forEachItem(r,(function(e){e.parent()&&(e.parent().removeChild(e,y.a.ChangeType.Remote),e.setParent(void 0))}))))}}else{var a=this.getCacheData(n.id),o=this._createRemoteEntry(e,t,n);a&&a.modifiedOffline&&this._mergeEventData(a,o),this.cacheData(o.id,o),this._eventCache.saveEntry(this.serializeExternalData(o),this.compareCachedData);var s=r.getRoot(),u=this.getAttachment(n.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(u,a,o)}catch(c){v.default.reportError(c)}if(this._endIgnorePropertyChanges(),!r.hasItem(o.id)&&this._shouldDisplayTime(o.startTime,o.endTime)&&this._eventNeedsItem(o)){var l=this._createItem(r,o,s.id);s.insertItem(l)}}}},{key:"compareCachedData",value:function(e,t){return this._propertySets[y.a.PluginLoad.Full].some((function(n){var r=e[n];return"endTime"===n&&(r=v.default.isString(r)?new Date(r):r),(r||t[n])&&!v.default.deepEqual(r,t[n])}))}},{key:"_mergeEventData",value:function(e,t){var n=0;try{v.default.PAssert(1724,e.modifiedOffline,"Should only merge events that were locally modified")}catch(o){v.default.reportError(o)}var r=e.modifiedOffline;try{v.default.PAssert(1725,v.default.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(o){v.default.reportError(o)}for(var i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];0,t[a]=e[a]}t.modifiedOffline=e.modifiedOffline}},{key:"updateVMLIsFromUpdate",value:function(e,t,n){var r=this;try{v.default.PAssert(1726,e,"Must provide a valid attachment")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1727,n,"Must provide valid new data")}catch(i){v.default.reportError(i)}if(t)e.forEachItem(void 0,(function(e){e.getParsedText();if(e.belongsToItemStore(Xh.itemStoreManager.getTempItemStore()),t.summary!==n.summary&&!e.hasAttachmentType(y.a.PluginType.Email)){var i=n.summary?n.summary.replace(/\u2000/g,""):"",a=e.getPrefix()+i+" "+y.a.CharDate;e.setText(a,y.a.ChangeType.Remote)}var o=r.mooDateFromCacheEntry(n);if(e.setMooDate(o,y.a.ChangeType.Remote,["gcalCalendar","gcalId","duration"]),t.description!==n.description&&e.belongsToItemStore(r.getDefaultItemStore()))if(e.hasNote())n.description?e.getNote().setText(n.description,y.a.ChangeType.Remote):e.setNote(void 0,y.a.ChangeType.Remote);else if(n.description){var s,u=n.id+"_note";r.getDefaultItemStore().hasItem(u)?(s=r.getDefaultItemStore().getItem(u)).setText(n.description,y.a.ChangeType.Remote):s=r.getDefaultItemStore().createItem(u,n.description,e.id,{isNote:!0},y.a.ChangeType.Remote),e.setNote(s,y.a.ChangeType.Remote)}r.areDatesEqual(t.isComplete,n.isComplete)||e.setComplete(!!n.isComplete,y.a.ChangeType.Remote),t.isArchived!==n.isArchived&&e.setArchived(n.isArchived),t.isStarred!==n.isStarred&&e.setStarred(n.isStarred,y.a.ChangeType.Remote),t.priority!==n.priority&&e.setPriority(n.priority,y.a.ChangeType.Remote)}));else{this._createItemText(n);e.forEachItem(void 0,(function(e){e.setTextToWhatItAlreadyIs(y.a.ChangeType.Remote)}))}}},{key:"setSyncToken",value:function(e,t){try{v.default.PAssert(1728,v.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1729,v.default.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(i){v.default.reportError(i)}var n=this._eventCache.getMetadata(Tl)||{},r=Date.now()+this._syncTokenDuration;n=Object.assign({},n,So()({},e,{token:t,date:Date.now(),expires:r})),this._eventCache.setMetadata(Tl,n)}},{key:"clearSyncToken",value:function(e){try{v.default.PAssert(1730,v.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(r){v.default.reportError(r)}var t=this._eventCache.getMetadata(Tl);if(t){t[e];var n=V()(t,[e].map(Pl));this._eventCache.setMetadata(Tl,n)}}},{key:"clearCalendarEventCache",value:function(e,t){var n=this;try{v.default.PAssert(1731,v.default.isString(e),"Must provide a valid calendar ID to clear event cache for")}catch(r){v.default.reportError(r)}this._eventCache.getFilterEntries((function(t){return t.calendarID===e})).then((function(e){if(e){for(var r=0,i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n._eventCache.removeEntry(e[i].id)}t&&t(!0)}else t&&t(!1)}))}},{key:"_calendarSyncComplete",value:function(e,t){if(t.length>0){if(Do.notifySyncError(t),this.isOnline())for(var n=0,r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=t[r];i.result!==y.a.SyncResult.FailureNetwork&&i.result!==y.a.SyncResult.Success&&Xh.toasts.pushMessage(y.a.MessageID.CalendarSync)}}else Do.notifySyncError(void 0),Xh.toasts.clearMessage(y.a.MessageID.CalendarSync);var a=this.getSetting(this.Settings.ExportCalendar);if(a){for(var o=0,s=!1,u=0;u<t.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(t[u].id===a){s=!0;break}}s||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}e.length>0&&this.onCalendarsSynced.notify()}},{key:"_shouldExpireToken",value:function(e){var t=!0;return e&&(e.expires?t=e.expires<Date.now():e.date&&(t=e.date+this._syncTokenDuration<Date.now())),t}},{key:"_getCalendarInfo",value:function(e){return this._calendarList[e]}},{key:"allowTextEditing",value:function(e,t){var n=t.getField("calendarID");return this.hasWritePermissionForCalendar(n)||t.isLocalOnlyAttachment()}},{key:"_createCalendarFromRemote",value:function(e){var t={id:e.id,accountID:e.accountID,summary:e.summary,accessRole:e.accessRole};return v.default.isValidColor(e.backgroundColor)&&(t.backgroundColor=e.backgroundColor),v.default.isValidColor(e.foregroundColor)&&(t.foregroundColor=e.foregroundColor),t}},{key:"runCalendarListSync",value:function(e){var t=this;this.getReadableCalendarList((function(n){if(n){var r=0;0,t._calendarList={};for(var i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n[i];t._calendarList[a.id]=t._createCalendarFromRemote(a)}Xh.toasts.clearMessage(y.a.MessageID.CalendarSync);var o=t.getDefaultExportCalendarID();o&&!t._calendarList[o]&&(t.setSetting(t.Settings.ExportCalendar,void 0),Xh.toasts.pushMessage({text:"Your Default Save calendar is no longer accessible. Please select another or update your sync accounts.",action:y.a.MessageAction.OpenCalendarSettings})),t._eventCache.setMetadata(xl,t._calendarList)}else t.isOnline()&&Xh.toasts.pushMessage(y.a.MessageID.CalendarSync);e&&e()}))}},{key:"_notifyTokenExpired",value:function(e){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)}},{key:"_notifyCalendarUnsyncd",value:function(e){v.default.log("Detected calendar "+e+" is no longer syncd"),this._clearCachedData(e,(function(t){t||v.default.log("Failure unsyncing calendar "+e)})),this._clearCalendarItems(e)}},{key:"_clearCalendarItems",value:function(e){var t=this.getDefaultItemStore();Xh.PaneUpdateBatcher.beginUpdateItems(),t.forEach((function(n){n.hasAttachments()&&(n.getAttachment(0).getField("calendarID")===e&&t.destroyItem(n.id))})),Xh.PaneUpdateBatcher.commitUpdateItems()}},{key:"_getSyncResultFromResult",value:function(e,t){var n=y.a.SyncResult.Success;if(t&&t.error&&t.error.code){var r=t.error.code;if(r===y.a.HTTPStatusCode.Unauthorized){var i=this._getCalendarInfo(e);n=i&&"owner"===i.accessRole?y.a.SyncResult.FailureOAuth:i&&"writer"===i.accessRole?y.a.SyncResult.FailureNoWrite:y.a.SyncResult.FailureNoRead}else n=r===y.a.HTTPStatusCode.NotFound?y.a.SyncResult.FailureNoRead:r===y.a.HTTPStatusCode.Network?y.a.SyncResult.FailureNetwork:r===y.a.HTTPStatusCode.Forbidden?y.a.SyncResult.FailureNoRead:y.a.SyncResult.FailureUnknown}return n}},{key:"runCalendarSync",value:function(e,t){var n=this,r=0,i=0,a=[],o=[],s=function(t,s,u){try{v.default.PAssert(1732,i<r,"Should never have more calendars syncd than we tried to sync")}catch(l){v.default.reportError(l)}t?a.push({id:s,result:y.a.SyncResult.Success}):o.push({id:s,result:n._getSyncResultFromResult(s,u)}),++i===r&&(n._calendarSyncComplete(a,o),e&&e())},u=this._eventCache.getMetadata(Tl);this._updateSyncTimes();var l=this.getImportCalendarList();if(l&&l.length>0){var c=0;r=l.length;for(var d=0;d<l.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var h=l[d];v.default.isObject(h)||(h={id:l[d]});var f=u?u[h.id]:void 0,p=void 0;this._shouldExpireToken(f)?(this._notifyTokenExpired(h.id),p=void 0):p=f.token,this.performCalendarSync(h,p,s,t)}for(var g in u)if(u.hasOwnProperty(g)){for(var m=0,_=!1,b=0;b<l.length;++b){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var w=l[b];if(v.default.isObject(w)||(w={id:l[b]}),w.id===g){_=!0;break}}_||this._notifyCalendarUnsyncd(g)}}else this._clearAllData(),this._calendarSyncComplete([],[]),e&&e()}},{key:"performCalendarSync",value:function(e,t,n,r){var i=this,a=e.id,o=e.accountID;try{v.default.PAssert(1733,v.default.isString(a),"Must provide a valid calendar ID for each sync op")}catch(c){v.default.reportError(c)}if(!o){var s=this._getCalendarInfo(e.id);s&&(o=s.accountID),o||(o=Po.a.getDefaultAccountID())}var u=Du.a.fns("calendar").events.list.packedFn,l={calendarId:a,singleEvents:!0};r||(t?l.syncToken=t:(l.timeMin=this._minSyncStartTime.toISOString(),l.timeMax=this._maxSyncStartTime.toISOString()));this._queuePagedRemoteRequestMulti(o,u,l,(function(e,t,r){var s,u=0;r&&(s=r.nextSyncToken,i.setSyncToken(a,s)),Xh.PaneUpdateBatcher.beginUpdateItems();for(var l=0;l<e.length;++l){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;i.handleEventUpdate(o,a,e[l])}Xh.PaneUpdateBatcher.commitUpdateItems(),n(!0,a)}),(function(t){t&&t.error&&t.error.code===y.a.HTTPStatusCode.Gone?i._clearCachedData(a,(function(o){o?i.performCalendarSync(e,void 0,n,r):n(!1,a,t)})):(n(!1,a,t),i._notifyFailedRequest(t,a))}),void 0,Fl,{getAllPages:!0,timeoutMS:0})}},{key:"_createEventUpdateInfo",value:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&Dl.indexOf(n)>=0&&(t[n]=e[n]);return t}},{key:"_notifyOfflineSyncFailures",value:function(e,t,n){t>0&&(Do.notifySyncError(n),v.default.log("Failed to sync offlineChanges: ",t))}},{key:"_syncOfflineChanges",value:function(e){var t=this;if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var n=0,r=0,i=0,a=[],o=function(o,s){s===y.a.SyncResult.Success?r++:(i++,a.push({id:o,result:s})),n===r+i&&(t._syncingOfflineChanges=!1,e(r,i,a))};this._eventCache.getFilterEntries((function(e){return!!e.modifiedOffline})).then((function(e){n=e.length,e.forEach((function(e){var n=t.createEntryFromLocal(e.id,e);if(!n.isInvalid){var r=n.calendarID,i=n.accountID;v.default.isTempId(n.id)&&!t._pendingCreates[n.id]?t._createRemoteEventFromCacheData(i,n.calendarID,n,v.default.newEmptyFn(),(function(e,n){o(r,t._getSyncResultFromResult(r,n))}),v.default.newEmptyFn()):t.hasWritePermissionForCalendar(r)?t._updateRemoteEvent(r,n.id,n,Hl,(function(e,i){e?(delete n.modifiedOffline,t._eventCache.saveEntry(n).then((function(){return o(r,y.a.SyncResult.Success)})).catch((function(){return o(r,y.a.SyncResult.FailureUnknown)}))):o(r,t._getSyncResultFromResult(r,i))})):(delete n.modifiedOffline,t._eventCache.saveEntry(n),o(n.calendarID,y.a.SyncResult.Success))}}))}))}}},{key:"_getEventDuration",value:function(e){try{v.default.PAssert(1734,!e.getField("allDayEvent"),"All day events do not have valid durations")}catch(r){v.default.reportError(r)}var t=e.getField("startTime"),n=e.getField("endTime");try{v.default.PAssert(1735,t&&n,"Must always have valid start and end times")}catch(r){v.default.reportError(r)}return n-t}},{key:"_computeItemDates",value:function(e,t,n){var r,i;t.getDate()&&(i=(r=t.getDate().clone()).clone().addMilliseconds(t.getDuration())),r&&i&&(t.allDayDate()?(e.start={date:r.toString("yyyy-MM-dd"),dateTime:null},e.end={date:i.toString("yyyy-MM-dd"),dateTime:null}):(e.start={dateTime:r.toISOString(),date:null},e.end={dateTime:i.toISOString(),date:null})),e.startTime=r,e.endTime=i}},{key:"_queueEventUpdate",value:function(e,t){if(this._updateAttachFromData(e,t),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!e.isLocalOnlyAttachment()){var n=this._eventUpdateQueue[e.id];if(n)for(var r in t)t.hasOwnProperty(r)&&(n.info[r]=t[r]);else this._eventUpdateQueue[e.id]={attach:e,info:t}}}},{key:"onShutdown",value:function(){}},{key:"_flushEventUpdateQueue",value:function(){this._eventUpdateTimeout=void 0;var e=function(e,t){e||t?Xh.toasts.clearMessage(y.a.MessageID.CalendarSaveFail):Xh.toasts.pushMessage(y.a.MessageID.CalendarSaveFail)};for(var t in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(t)){var n=this._eventUpdateQueue[t];this._updateEvent(n.attach,n.info,zl,v.default.newEmptyFn(),v.default.newEmptyFn(),e)}this._eventUpdateQueue={}}},{key:"_handleAttachDeleted",value:function(e,t){var n=this,r=e.getField("status");this.deleteCalendarEvent(e,(function(i){if(i){Xh.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:function i(){n._updateEvent(e,{status:r},Gl,v.default.newEmptyFn(),(function(e){e||Xh.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:i,timeout:1e4})}),v.default.newEmptyFn());var a=n._createItemText(e.getData());t.setText(a,y.a.ChangeType.Local),t.parent()||t.setParent(n.getDefaultItemStore().getRoot()),t.getIndex()<0&&t.parent().insertItem(t)},timeout:1e4})}else Xh.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:n._handleAttachDeleted.bind(n,e,t),timeout:1e4})}))}},{key:"notifyItemNoteChanged",value:function(e,t){this._queueEventUpdate(e,{description:t.getRawText()})}},{key:"notifyItemDateChanged",value:function(e,t){var n={};this._computeItemDates(n,t,e),this._queueEventUpdate(e,n)}},{key:"notifyItemTextChanged",value:function(e,t,n){if(n)this._handleAttachDeleted(e,t);else if(e.getField("recurringEventId")&&t.getCalendarParsedText()===e.getField("summary"))Xh.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!v.default.isDemoMode())if(t.getDate()){var r,i=t.getCalendarParsedText(),a=e.getField("summary"),o=e.getField("source");if(t.hasAttachmentType(y.a.PluginType.Email)){var s=t.getAttachmentByType(y.a.PluginType.Email);r={title:s.getField("subject"),url:s.getPlugin().getURLForAttachment(s)}}var u={summary:i,start:void 0,end:void 0,source:void 0},l=!1;i!==a&&(l=!0),o&&!r||!o&&r?l=!0:o&&r&&(o.title===r.title&&o.url===r.url||(l=!0));var c=t.getDate(),d=e.getField("startTime");this.areDatesEqual(d,c)||(l=!0);var h=t.getEndDate(),f=e.getField("endTime");this.areDatesEqual(f,h)||(l=!0),l&&(this._computeItemDates(u,t,e),u.source=r,this._queueEventUpdate(e,u)),e.updateField("isInvalid",!1)}else e.updateField("isInvalid",!0)}},{key:"_beginIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!0}},{key:"_endIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!1}},{key:"_isIgnoringPropertyChanges",value:function(){return this._ignoringPropertyChanges}},{key:"notifyItemPropertyChanged",value:function(e,t,n){if(!e.getField("locked")&&this.hasWritePermissionForCalendar(e.getField("calendarID"))&&(!v.default.isRemoteChange(n)||!this._isIgnoringPropertyChanges())){var r=e.getField("isComplete"),i=e.getField("isArchived"),a=e.getField("isStarred"),o=e.getField("priority"),s=t.dateCompleted,u=t.isArchived(),l=t.isStarred(),c=t.getPriority(),d=v.default.newEmptyFn(),h=v.default.newEmptyFn(),f=function(e,t,n,r){e||t?Xh.toasts.clearMessage(y.a.MessageID.CalendarSaveFail):Xh.toasts.pushMessage(y.a.MessageID.CalendarSaveFail)};this.areDatesEqual(r,s)||(v.default.isLocalChange(n)?this._updateRemoteProperty(e,"isComplete",s,d,h,f):e.updateField("isComplete",s)),i!==u&&(v.default.isLocalChange(n)?this._updateRemoteProperty(e,"isArchived",u,d,h,f):e.updateField("isArchived",u)),a!==l&&(v.default.isLocalChange(n)?this._updateRemoteProperty(e,"isStarred",l,d,h,f):e.updateField("isStarred",l)),o!==c&&(v.default.isLocalChange(n)?this._updateRemoteProperty(e,"priority",c,d,h,f):e.updateField("priority",c))}}},{key:"_clearCachedData",value:function(e,t){this.clearSyncToken(e),this.clearCalendarEventCache(e,t)}},{key:"_clearAllData",value:function(e){this._eventCache.clearMetadata(),this._eventCache.clearCache().then((function(){e&&e(!0)})),this.getDefaultItemStore().clearStore()}},{key:"getAttachmentClass",value:function(e){var t=["plugin_gcalendar","c-date"];return e.isLoaded()&&(e.getField("isInvalid")&&t.push("invalid"),"cancelled"===e.getField("status")&&t.push("eventDeleted")),t}},{key:"getAttachmentTooltip",value:function(e){var t;return this.isPluginBlocked()?t="Go premium to view calendar events":e.isLoaded()?(e.isLocalOnlyAttachment()?t="Syncing event...":e.getField("isInvalid")&&(t="Item has an invalid date"),"cancelled"===e.getField("status")&&(t="Item was deleted from Google Calendar")):t="Plugin is loading data",t}},{key:"areDatesEqual",value:function(e,t){var n=!1;return e&&t?v.default.isDateValid(e)&&v.default.isDateValid(t)&&(n=e.equals(t)):n=!e&&!t,n}},{key:"parsePriority",value:function(e){var t=v.default.parseInt(e);return isNaN(t)&&(t=y.a.VMLIFlag.None),t}},{key:"fieldsHaveParseEffect",value:function(e){return(!e||1!==e.length||"isComplete"!==e[0])&&l()(g()(n.prototype),"fieldsHaveParseEffect",this).call(this,e)}},{key:"changeCalendarForEvent",value:function(e,t){var n=this,r=e.getField("calendarID"),i=this._getCalendarInfo(r),a=i.id;try{v.default.PAssert(1738,i.accountID,"Should have an accountID on the calendar")}catch(l){v.default.reportError(l)}var o=Du.a.fns("calendar").events.move.packedFn,s={eventId:e.id,calendarId:r,destination:t};e.updateField("calendarID",t,!0);var u=function(){e.forEachItem(Xh.itemStoreManager.getDefaultItemStore(),(function(e){var n=e.getMooDate();n&&(n.setGCalCalendar(t),e.onMooDateUpdated(y.a.ChangeType.Local,!0),e.setTextToWhatItAlreadyIs(y.a.ChangeType.Local))}))};this._queueRemoteRequestMulti(i.accountID,o,s,u,(function(t){e.updateField("calendarID",a,!0),t&&t.error&&t.error.code===y.a.HTTPStatusCode.Gone?u():(t&&t.error&&(t.error.code,y.a.HTTPStatusCode.NotFound),n._notifyFailedRequest(t,e.getField("calendarID")))}),void 0,Kl)}},{key:"getCalendarForAttach",value:function(e){if(e.hasField("calendarID"))return this._getCalendarInfo(e.getField("calendarID"))}},{key:"fixMissingCalendars",value:function(){this.runCalendarSync(),Xh.settings.fixedMissingCalendars.set(!0)}},{key:"getWriteableCalendarsForItem",value:function(e){var t,n,r;if(this.isAvailable()&&this.isEnabled()){if(e.hasPluginAttachment(y.a.PluginID.GCalendar)){var i=e.getAttachmentByPlugin(y.a.PluginID.GCalendar),a=this.getCalendarForAttach(i);a&&(n=a.id,t=a.accountID)}r=this.getWritableCalendarListSync(t)}return{selected:n,calendars:r}}},{key:"setCalendarForItem",value:function(e,t){var n=e.getAttachmentByPlugin(y.a.PluginID.GCalendar);t?e.hasPluginAttachment(y.a.PluginID.GCalendar)?this.changeCalendarForEvent(n,t):this.createEventForItem(e,t):e.hasPluginAttachment(y.a.PluginID.GCalendar)&&this.deleteCalendarEventForItem(e,n,v.default.newEmptyFn(),v.default.newEmptyFn(),(function(){console.log("Done")}))}},{key:"onSyncAccountsChanged",value:function(e,t){var r=this;l()(g()(n.prototype),"onSyncAccountsChanged",this).call(this,e,t),t.forEach((function(e){r._clearCachedData(e)})),this.isActive()&&e.length>0&&this.runCalendarSync()}},{key:"getUnstyledText",value:function(e){return""}}]),n}(Gu),b()(cl.prototype,"_purgeOldData",[w.a],Object.getOwnPropertyDescriptor(cl.prototype,"_purgeOldData"),cl.prototype),b()(cl.prototype,"createEventForItem",[w.a],Object.getOwnPropertyDescriptor(cl.prototype,"createEventForItem"),cl.prototype),b()(cl.prototype,"compareCachedData",[w.a],Object.getOwnPropertyDescriptor(cl.prototype,"compareCachedData"),cl.prototype),b()(cl.prototype,"runCalendarListSync",[w.a],Object.getOwnPropertyDescriptor(cl.prototype,"runCalendarListSync"),cl.prototype),b()(cl.prototype,"runCalendarSync",[w.a],Object.getOwnPropertyDescriptor(cl.prototype,"runCalendarSync"),cl.prototype),b()(cl.prototype,"_flushEventUpdateQueue",[w.a],Object.getOwnPropertyDescriptor(cl.prototype,"_flushEventUpdateQueue"),cl.prototype),b()(cl.prototype,"parsePriority",[w.a],Object.getOwnPropertyDescriptor(cl.prototype,"parsePriority"),cl.prototype),b()(cl.prototype,"fixMissingCalendars",[w.a],Object.getOwnPropertyDescriptor(cl.prototype,"fixMissingCalendars"),cl.prototype),cl),Xl={renderPlain:function(e){if(e.isLoaded()){var t=e.getField("subject");return t&&""!==t||(t="(no subject)"),t}var n=e.getInlineData();return(null===n||void 0===n?void 0:n.subject)||(null===n||void 0===n?void 0:n.text)||"Loading..."},renderPaneJSX:function(e){var t,n=e.item,r=e.pane,i=n.getAttachmentByPlugin(y.a.PluginID.Gmail),a=Xl.renderPlain(i),o=i.getPlugin(),s=o.getDisplayTags(i,r),u=o.getDisplayParticipants(i),l=i.getField("count"),c=i.hasField("snippet")&&i.getField("snippet"),d=v.default.classNames("paneGmailItemContent flex flex-col justify-center border-b c-border-light"),h=i.getField("date");return t=_s.a.isToday(h)?Xh.International.getFormat(y.a.DFormat.ShortTime):h.getYear()!==(new Date).getYear()?Xh.International.getFormat(y.a.DFormat.MonthDayYearShort):Xh.International.getFormat(y.a.DFormat.MonthDay),M.a.createElement("div",{className:d},M.a.createElement("div",{className:"flex flex-row justify-between line1"},M.a.createElement("div",{className:"from"},u),M.a.createElement("div",{className:"emailDate c-foreground-faded"},h.toString(t))),M.a.createElement("div",{className:"flex flex-row justify-between line2"},M.a.createElement("div",{className:"subject c-foreground"},a),M.a.createElement("div",{className:"flex items-center"},i.getField("hasAttachments")&&M.a.createElement("div",{className:"attach icon-attach_file"}),l>1&&M.a.createElement("div",{className:"count"},l))),M.a.createElement("div",{className:"flex flex-row justify-between line3"},c&&M.a.createElement("div",{className:"snippet c-foreground-faded"},i.getField("snippet")),(null===s||void 0===s?void 0:s.length)>0&&M.a.createElement("div",{className:"tags"},s.map((function(e){return M.a.createElement("span",{key:e,className:"emailLabel c-tag"},e)})))))},renderStyled:function(e,t,n,r){var i="";if(e&&e.isLoaded()){var a=e.getField("count"),o=e.getPlugin(),s=Xl.renderPlain(e);r&&r.highlightSearch&&(s=Xh.ElementRenderer.replaceTextWithSearch(s,t)),s='<span class="subject c-foreground">'+s+"</span>";var u=o.getDisplayTags(e,t);i+='<span class="line1"><span class="from">'+o.getDisplayParticipants(e)+"</span>";var l,c=e.getField("date");if(l=_s.a.isToday(c)?Xh.International.getFormat(y.a.DFormat.ShortTime):c.getYear()!==(new Date).getYear()?Xh.International.getFormat(y.a.DFormat.MonthDayYearShort):Xh.International.getFormat(y.a.DFormat.MonthDay),i+='<span class="emailDate c-foreground-faded">'+c.toString(l)+"</span></span>",i+='<span class="line2">'+s,(e.getField("hasAttachments")||a>1)&&(i+='<span class="line2Right">',e.getField("hasAttachments")&&(i+='<span class="attach icon-attach_file"></span>'),a>1&&(i+='<span class="count">'+a+"</span>"),i+="</span>"),i+="</span>",e.hasField("snippet")||u.length){if(i+='<span class="line3">',e.hasField("snippet")&&(i+='<span class="snippet c-foreground-faded">'+e.getField("snippet")+"</span>"),u.length){var d=0;i+='<span class="tags">';for(var h=0;h<u.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;i+='<span class="emailLabel c-tag">'+u[h]+"</span>"}i+="</span>"}i+="</span>"}}else{var f;i=(null===(f=e.getInlineData())||void 0===f?void 0:f.subject)||"Loading..."}return i}},$l=Xl,Jl=function(){function e(t,n,r){a()(this,e);try{v.default.PAssert(2479,v.default.isFunction(t),"Must provide a valid entry callback")}catch(i){v.default.reportError(i)}try{v.default.PAssert(2480,v.default.isFunction(n),"Must provide a valid done callback")}catch(i){v.default.reportError(i)}this._entryCB=t,this._doneCB=n,this._delay=r||5e3,this._flushTimeout=void 0,this._entries=[],G.a.binder(this,"_onEntry","_onDone","_flushEntries","_flushEntriesWatchdog")}return s()(e,[{key:"getEntryCB",value:function(){return this._onEntry}},{key:"getDoneCB",value:function(){return this._onDone}},{key:"_onEntry",value:function(e){e&&this._entries.push(e),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))}},{key:"_onDone",value:function(e,t){Xh.PaneUpdateBatcher.beginUpdateItems(),this._flushEntries();try{0,this._doneCB(e,t)}catch(n){v.default.reportError(n)}Xh.PaneUpdateBatcher.commitUpdateItems()}},{key:"_flushEntriesWatchdog",value:function(){0}},{key:"_flushEntries",value:function(){var e=0;this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),Xh.PaneUpdateBatcher.beginUpdateItems(),Go.a.beginBatch();for(var t=0;t<this._entries.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{this._entryCB(this._entries[t])}catch(n){v.default.reportError(n)}}this._entries=[],Go.a.commitBatch(),Xh.PaneUpdateBatcher.commitUpdateItems()}}]),e}();function Zl(){this._favMap={}}Zl.prototype={_ensureGroup:function(e){var t=[];return this._favMap[e]||(this._favMap[e]=t),t},notifyAdd:function(e,t){var n=this._ensureGroup(t);try{v.default.PAssert(2447,n.indexOf(e)<0,"Should not double add item to group")}catch(r){v.default.reportError(r)}n.push(e)},notifyRemove:function(e,t){var n=this._ensureGroup(t);try{v.default.PAssert(2448,n.indexOf(e)>=0,"Must have been added to group before removing")}catch(r){v.default.reportError(r)}n.remove(e)},getItems:function(e){return this._favMap[e]},hasItems:function(e){var t=this.getItems(e);return t&&t.length>0}};var ec,tc=new Zl,nc="Moo.do",rc={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},ic={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},ac={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},oc={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},sc={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0},uc=function(){function e(t,n,r,i,o,s){a()(this,e);try{v.default.PAssert(2451,t,"Must specify a valid account ID")}catch(u){v.default.reportError(u)}try{v.default.PAssert(2452,n,"Must specify a valid label ID")}catch(u){v.default.reportError(u)}try{v.default.PAssert(2454,!i||v.default.isDateValid(i),"Must provide a valid oldestSync date")}catch(u){v.default.reportError(u)}try{v.default.PAssert(2455,s,"Must supply a valid label store this label belongs to")}catch(u){v.default.reportError(u)}this._labelStore=s,this._accountID=t,this._labelID=n,this._fullName=r,this._minName=void 0,this._matchName=null===r||void 0===r?void 0:r.toUpperCase(),this._oldestSync=i,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!o||!o.isDeleted),this._labelListVisibility=o&&o.labelListVisibility?o.labelListVisibility:y.a.LabelListVisibility.Show,this._messageListVisibility=o&&o.messageListVisibility?o.messageListVisibility:y.a.MessageListVisibility.Show,this._origLabelID=void 0}return s()(e,[{key:"_getDisplayPriority",value:function(){return ic[this.getLabelID()]||-1}},{key:"displayCompare",value:function(e){var t=this.isSystemOrSpecialLabel(),n=e.isSystemOrSpecialLabel();return t&&n?this._getDisplayPriority()<e._getDisplayPriority()?1:-1:t?-1:n?1:this.getName().localeCompare(e.getName())}},{key:"isDropTarget",value:function(){return!sc[this.getLabelID()]}},{key:"_getStoreLabel",value:function(e){var t,n=this,r=e.toUpperCase();return Object.keys(this._labelStore).some((function(e){var i=n._labelStore[e].getRawName();if(i&&i.toUpperCase()===r)return t=n._labelStore[e],!0})),t}},{key:"_computeAncestors",value:function(){try{v.default.PAssert(2456,this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors")}catch(a){v.default.reportError(a)}if(this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var e=0,t=this._fullName.split("/"),n="",r=0;r<t.length-1;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n+=t[r];var i=this._getStoreLabel(n);i&&i!==this&&this._ancestors.push(i),n+="/"}this._computeMinName()}try{v.default.PAssert(2457,this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")}catch(a){v.default.reportError(a)}}},{key:"_computeMinName",value:function(){for(var e=0,t=this.getRawName(),n=0;n<this._ancestors.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._ancestors[n].getMinName()+"/",i=t.indexOf(r);t=t.substr(i+r.length)}this._minName=t}},{key:"getAccountID",value:function(){return this._accountID}},{key:"getLabelID",value:function(){return this._labelID}},{key:"getRawName",value:function(){return this._fullName}},{key:"getMinName",value:function(){var e;return null!==(e=this._minName)&&void 0!==e?e:this._fullName}},{key:"getMatchName",value:function(){return this._matchName}},{key:"isMatched",value:function(e){try{v.default.PAssert(2458,v.default.isString(e),"Must pass in a valid string for label name")}catch(r){v.default.reportError(r)}var t=!1,n=this.getMatchName();return e&&n&&n.indexOf(e.toUpperCase())>=0&&(t=!0),t}},{key:"isNamed",value:function(e){try{v.default.PAssert(2459,v.default.isString(e),"Must pass in a valid string for label name")}catch(r){v.default.reportError(r)}var t=!1,n=this.getMatchName();return e&&n&&n===e.toUpperCase()&&(t=!0),t}},{key:"getName",value:function(e){var t;if(rc[this.getLabelID()])t=rc[this.getLabelID()];else if(ac[this.getLabelID()])t=ac[this.getLabelID()];else if(e&&this._minName)t=this.getMinName();else if(this._fullName)t=this._fullName;else{try{v.default.PAssert(2460,!this.isLocalOnly(),"Should not have a local-only label without a name")}catch(n){v.default.reportError(n)}t=this.getLabelID()}return t||""}},{key:"hasName",value:function(){return rc[this.getLabelID()]||ac[this.getLabelID()]||!!this._fullName}},{key:"clearOldestSync",value:function(){this._oldestSync=void 0}},{key:"getOldestSync",value:function(){return this._oldestSync}},{key:"setOldestSync",value:function(e){try{v.default.PAssert(2461,v.default.isDateValid(e),"Must provide a valid oldestSync date")}catch(t){v.default.reportError(t)}this._oldestSync=e}},{key:"getMessageListVisibility",value:function(){return this._messageListVisibility}},{key:"getLabelListVisibility",value:function(){return this._labelListVisibility}},{key:"isLocalOnly",value:function(){return v.default.isTempId(this.getLabelID())}},{key:"updateLabelID",value:function(e){try{v.default.PAssert(2463,this.isLocalOnly(),"Should only ever modify local labels")}catch(t){v.default.reportError(t)}this._origLabelID=this.getLabelID(),this._labelID=e}},{key:"updateLabelName",value:function(e){this._fullName=e,this._matchName=e.toUpperCase(),this._computeAncestors()}},{key:"getSaveData",value:function(){var e={id:this.getLabelID(),name:this._fullName,messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted};return this.getOldestSync()&&(e.oldestSync=this.getOldestSync()),e}},{key:"getDisplayText",value:function(e){var t;return this.getName()&&(t=this.getName().startsWith("Moo.do/")?this.getName().substr(nc.length+1):this.getName(e)),t}},{key:"getOutlineText",value:function(){var e=this.getDisplayText();return null===e||void 0===e?void 0:e.replace(/ /g,"_")}},{key:"matchesText",value:function(e){return this.getDisplayText().toLowerCase().indexOf(e)>=0}},{key:"hasAncestors",value:function(){return!!this._fullName&&this.getAncestors().length>0}},{key:"getAncestors",value:function(){return this._computeAncestors(),this._ancestors}},{key:"getParent",value:function(){var e=this.getAncestors();return e[e.length-1]}},{key:"isSystemLabel",value:function(){return!!rc[this.getLabelID()]}},{key:"isSpecialLabel",value:function(){return!!ac[this.getLabelID()]}},{key:"isSystemOrSpecialLabel",value:function(){return this.isSystemLabel()||this.isSpecialLabel()}},{key:"isCategoryLabel",value:function(){return!!oc[this.getLabelID()]}},{key:"isArchived",value:function(){return"Archived"===this.getName()}},{key:"isStarred",value:function(){return"Starred"===this.getName()}},{key:"isInbox",value:function(){return"Inbox"===this.getName()}},{key:"isDraft",value:function(){return"Draft"===this.getName()}},{key:"isTrash",value:function(){return"Trash"===this.getName()}},{key:"isCustom",value:function(){return!this.isSystemLabel()&&!this.isSpecialLabel()}},{key:"getUnreadCount",value:function(){return this._numUnread}},{key:"shouldDisplayInLabelList",value:function(){var e=!1;return this._isDeleted||(this.getLabelListVisibility()===y.a.LabelListVisibility.Show||this.getLabelListVisibility()===y.a.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0)&&(e=!0),e}},{key:"shouldDisplayInMessageList",value:function(){return this._messageListVisibility===y.a.MessageListVisibility.Show}},{key:"delete",value:function(){try{v.default.PAssert(2464,!this.isSystemOrSpecialLabel(),"Should never delete a special or system label")}catch(e){v.default.reportError(e)}this._isDeleted=!0}}]),e}(),lc=n(26),cc=n(65),dc=n(48);function hc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var fc=(ec=function(e){d()(n,e);var t=hc(n);function n(e){var r;a()(this,n);var i={title:"Legacy Email",contextMenuMode:"Gmail",paneEmptyMessage:"No emails here",paneEmptySearchMessageDefault:"Press enter to search",paneEmptySearchMessage:"Press enter to search",titleContextMenuHeader:"Open label",dropEffect:function(){return y.a.DropEffect.Copy},isWriteable:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!1,supportCompleting:!0,supportCheckbox:!0,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:"Emails",supportReportError:!0,supportCompose:!0,supportPagination:!0,supportVertLines:!1,supportSearchItemAutocomplete:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportLocalSearch:!1,supportClone:!1,supportDeferredItemLoad:!0,supportCellTransition:!1,shouldSearchMatchParents:!1,noOverviewStyle:!0,supportStarClick:!0,supportClickOverviewScroll:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,overviewHasPaneItems:!1,overviewPadLevels:-1,maxWidthFlex:y.a.ExpandedPaneWidth,maxWidth:y.a.ExpandedPaneWidth+200,maxWidthSingle:y.a.ExpandedPaneWidth,widthBiggerInSingle:!1,supportsDocuments:!1,_topBoxHeight:0,searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-in:trash -is:unread";break;case 1:t="-in:trash is:unread";break;default:t=""}return t},matchFn:function(e,t){var n=r.plugin.isItemUnread(t);if(e)return n&&e>0||!n&&e<0?y.a.MatchState.Yes:y.a.MatchState.No}},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-is:starred";break;case 1:t="is:starred";break;default:t=""}return t},matchFn:function(e,t){var n=r.plugin.isItemStarred(t);if(e)return n&&e>0||!n&&e<0?y.a.MatchState.Yes:y.a.MatchState.No}},{name:"priority",remoteStringFn:function(e){var t;switch(e){case y.a.VMLIFlag.P0:t="label:Moo.do/Priority High";break;case y.a.VMLIFlag.P1:t="label:Moo.do/Priority Medium";break;case y.a.VMLIFlag.P2:t="label:Moo.do/Priority Low";break;default:t=""}return t},matchFn:function(e,t){return r.plugin.getItemPriority(t)>=e?y.a.MatchState.Yes:y.a.MatchState.No}},{name:"category",remoteStringFn:function(e){return e?"category:"+e:""},matchFn:function(e,t){return e?r.plugin.itemHasLabel(t,e)?y.a.MatchState.Yes:y.a.MatchState.No:y.a.MatchState.Yes}}]};return e.plugin=Xh.pluginManager.getPlugin(n.getPluginID()),(r=t.call(this,e,i)).type=r.plugin._paneType,r.paneClass="panePlugin paneGmail",r.isInitializing=!0,r._lines=[{text:"\u2000",start:0,length:1,width:0}],r.dragMarginTop=25,r.blocks=[],r.blocksByKey={},r._focusedTrash=!1,r.shouldCheckHeight=!0,r.maxScrollOffset=0,r.selectedIndex=new E.a(-1,r.onSelectedIndexChanged.bind(W()(r))),r._isSearchingRemote=new E.a(!1),r._overviewAccount=new E.a,r._currentSearch=void 0,r._ignoreRestoreScroll=!0,r._failedPageRequest=new E.a(!1),r.viewState=new E.a(e.viewState&&e.viewState.viewMode?e.viewState:{viewMode:y.a.GmailViewMode.Date}),r.item.get()||r.item.set(r.plugin.tempRootVMLI),r.item.listen((function(e){return r._onItemChange(e,!1)})),r.viewState.listen(r._onViewStateChange.bind(W()(r))),G.a.binder(W()(r),"_runRemoteSearch","searchCompare","onTopTextChanged","headerSearchCompare","onMultiselectReset","changeView","onEmailComposeClosed","onEmailPreviewClosed"),r.initGmail(),r._firstSelectedItemID=void 0,e.isExpanded&&(Xh.EmailPreview.startOpenOnLoad(W()(r)),r._firstSelectedItemID=e.selectedItem),r.isInitializing=void 0,r}return s()(n,[{key:"initGmail",value:function(){lc.a.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),K.a.listen("EmailCompose","onClosed",this.onEmailComposeClosed),K.a.listen("EmailPreview","onClosed",this.onEmailPreviewClosed)}},{key:"destroy",value:function(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),K.a.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),K.a.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),lc.a.unlisten("reset",this.onMultiselectReset),l()(g()(n.prototype),"destroy",this).call(this)}},{key:"onLoad",value:function(){l()(g()(n.prototype),"onLoad",this).call(this),this._onItemChange(this.getItem(),!0)}},{key:"notifyPluginLoaded",value:function(){var e=this.deferredItemState;if(e){var t=this.getItemStore().getItem(e.itemID);t&&(this.setItem(t,!0),this.updateHeaders(!0))}}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(e){return this.plugin.getDefaultDisplayItem(e)}},{key:"searchCompare",value:function(e){var t=!1,n=e.getAttachmentByPlugin(this.plugin.id);if(n){var r=n.getField("accountID");this.plugin.hasSyncAccount(r)&&(this.plugin.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0):this.search.isMatched(e)&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0))}return t}},{key:"runItemSearch",value:function(e){try{v.default.PAssert(2483,e,"Must supply a valid param set for local item search")}catch(t){v.default.reportError(t)}try{v.default.PAssert(2484,e.item,"Gmail pane always expects a valid item when running local item search")}catch(t){v.default.reportError(t)}return e.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(e):l()(g()(n.prototype),"runItemSearch",this).call(this,e)}},{key:"getItemSearchParams",value:function(){var e=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=e&&e.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}}},{key:"setOverviewAccount",value:function(e){this._overviewAccount.set(e),this.updateHeaders(!0)}},{key:"headerSearchCompare",value:function(e){if(this.plugin.isLabelItem(e)){var t=this.plugin.getLabelForVMLI(e);return!t||t.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(e)}},{key:"getHeaderSearchParams",value:function(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?1:NaN,overview:!0,pane:this}}},{key:"saveSelection",value:function(){return lc.a.getSelectedItems(this)}},{key:"restoreSelection",value:function(e){if(e.length>0){for(var t=0,n=[],r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.indexOfItem(e[r]);i>=0&&n.push(i)}if(n.length>1)this.selectedIndex.set(n[0],!1),lc.a.setSelected(n,this);else if(1===n.length)this.selectIndex(n[0]);else{var a=this.selectedIndex.get();a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0)}}}},{key:"_setItems",value:function(e,t){for(var n,r=0,i=this.saveSelection(),a=[],o={},s=this.getViewMode()===y.a.GmailViewMode.Date?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn,u=0;u<e.length;++u){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=e[u],c=this.plugin._getThreadIDFromItem(l);c&&!o[c]&&(a.insertSorted(l,s),this._firstSelectedItemID&&l.id===this._firstSelectedItemID&&(n=l),o[c]=!0)}if(this.updateOutline(a),this.restoreSelection(i),n&&e.length>0){var d=this.indexOfItem(n);d>=0&&(this.selectIndex(d),this.scrollToIndex(d,"start")),this._firstSelectedItemID=void 0}}},{key:"setHeaders",value:function(e,t){var n=0,r=this;if(!this._overviewAccount.get()||"me"===this._overviewAccount.get()){var i=this.plugin.getDescriptorForItem(this.getItem());this._overviewAccount.set(i.accountID)}this._allHeaders=e;for(var a=[],o={},s={},u=0;u<this._allHeaders.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=this._allHeaders[u],c=this.plugin.getAccountIDFromItem(l);if(o[c]||(o[c]=[]),this.plugin.isAccountItem(l))s[c]=l;else{var d=o[c];this.plugin.isDisplayHeader(l)&&d.insertSorted(l,this.plugin.labelVMLISortFn)}}var h=this._overviewAccount.get(),f=o[this._overviewAccount.get()];if(f){var p=s[h];try{v.default.PAssert(2485,p,"Must have valid account item")}catch(k){v.default.reportError(k)}if(p)for(var g=0,m=0;m<f.length;++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(m>0){var _=this.plugin.getLabelForVMLI(f[m-1]),b=this.plugin.getLabelForVMLI(f[m]);(_.isSystemOrSpecialLabel()&&!b.isSystemOrSpecialLabel()||!_.isCategoryLabel()&&b.isCategoryLabel())&&a.push(new dc.a({type:"hr",id:"hr"+h+m,pane:this,index:m,overview:!0,sizeInPane:this.heightOverviewHR}))}a.push(f[m])}}this.headersArr=a;var w=a.map((function(e,t){return v.default.isVMLI(e)?new dc.a({type:"blockItem",item:e,id:e.id,pane:r,index:t,overview:!0,sizeInPane:y.a.OverviewItemHeightDesktop}):new dc.a(Object.assign({pane:r,overview:!0},e))}));this.headerPaneObjects.set(w)}},{key:"heightOverviewHR",value:function(){return 4}},{key:"getTitleList",value:function(){var e=this.getItem();if(e===this.plugin.tempRootVMLI)return[e];var t=this.plugin.getDescriptorForItem(e),n=this.plugin.getVMLIForAccount(t.accountID);return n===e?[e]:[n,e]}},{key:"onClickTitle",value:function(e){return this.plugin.isAccountItem(e)?e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(e)):e===this.getRootItem()?e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(e)||(e=this.plugin.getDefaultDisplayItem(this.plugin.getDefaultAccount())),l()(g()(n.prototype),"onClickTitle",this).call(this,e)}},{key:"onTopTextChanged",value:function(){this.topBoxHeight.set(this.paneTopText.get()?36:0)}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDataPage",value:function(e){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(e,this.onDataPagedIn.bind(this))}},{key:"dropEffectCopyBehavior",value:function(e,t){if(!this.plugin.isLabelItem(t)||!e.belongsToItemStore(this.getItemStore())){try{v.default.PAssert(2486,!e.belongsToSameItemStore(t),"Dropping onto a Gmail pane is not supported")}catch(i){v.default.reportError(i)}return this.plugin.createOutlinePaneItem(e,t)}var n=this.plugin.getLabelForVMLI(t),r=e.getAttachmentByPlugin(this.plugin.id);r&&(null===n||void 0===n?void 0:n.isDropTarget())&&this.plugin.addLabelToAttachment(r,n.getName())}},{key:"_refreshPaneData",value:function(){this.plugin.refreshCurrentView()}},{key:"reportPaneError",value:function(){Xh.menus.openModal(y.a.Modals.ReportBug)}},{key:"_onItemChange",value:function(e,t){var n=this;lc.a.reset(this);var r=this.plugin.getAccountIDFromItem(this.getRootItem());this.setOverviewAccount(r),this._clearCurrentSearch();var i=this.plugin.getLabelForVMLI(e);this._focusedTrash=i&&i.isTrash(),e.hasPaginationToken()||this.plugin.handleItemChange(e,(function(){n.isLoading.set(!1)})),this.numItems()>0&&this.selectIndex(0)}},{key:"_onViewStateChange",value:function(){lc.a.reset(this),this.plugin.handleViewModeChange(this.getItem(),this.getViewMode()),this.updateItemsImmediate(!0,void 0,void 0,!0),Xh.PaneManager.updatePaneStateForPane(this),this.scrollToIndex(0,"start")}},{key:"getItemLabel",value:function(e){var t=e?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(t)}},{key:"onDataPagedIn",value:function(e){e?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)}},{key:"onScrollEnd",value:function(){this.isLoadingNewPage.get()||this.isSearched()||this.requestDataPage(this.getItem())}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){var e=this.plugin.getAccountIDFromItem(this.getItem());return Po.a.isAuthorizedForScopes(e,[y.a.GScope.GmailModify])?"Loading...":"Authorizing..."}},{key:"bottomListMessage",value:function(){var e;return this.getItem().hasPaginationToken()&&(e=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),{text:e,clickable:!0}}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"onClickItem",value:function(e,t,n,r){if(r.shiftKey){var i=lc.a.getFirstSelectedIndex(this),a=lc.a.getLastSelectedIndex(this);e<i?i=e:e>a&&(a=e),lc.a.selectInOrder(i,a,this),!1}else if(v.default.hasClass(r.target,"emailLabel")){var o=r.target.textContent,s=t.getAttachmentByPlugin(this.plugin.id).getField("accountID"),u=this.plugin._getLabelByName(s,o);try{v.default.PAssert(2487,u,"Must be able to get a valid label if clicking a valid label: ",o)}catch(c){v.default.reportError(c)}if(u){var l=this.plugin.getVMLIForLabel(s,u);this.zoomIn(l),!1}}else v.default.hasClass(r.target,"itemCheckbox")||this.selectIndex(e)}},{key:"handleRightSideTap",value:function(e){if(e&&e.hasPluginAttachment(this.plugin.id)){this.archiveEmailFromCurrentLabel(e);var t=this.selectedIndex.get();t>=this.numItems()&&(t=this.numItems()-1),this.selectIndex(t,!0),v.default.vmMain.redoLastMouseMove()}}},{key:"onMultiselectReset",value:function(e){this===e&&this.selectedIndex.set(-1)}},{key:"selectIndex",value:function(e,t,n){var r=this.selectedIndex.get();this.selectedIndex.set(e,t),e>=0?lc.a.setSelected([e],this):lc.a.reset(this),(t||r!==e)&&this.selectedIndex.notify(),n||Xh.PaneManager.updatePaneStateForPane(this)}},{key:"selectItem",value:function(e,t){if(e){var n=this.indexOfItem(e);n>=0&&this.selectIndex(n,t)}else this.selectIndex(-1,t)}},{key:"onSelectedIndexChanged",value:function(e){if(Xh.EmailPreview.isOpenOnPane(this))if(e>=0){var t=this.itemAtIndex(e);this.openEmailByItem(t)}else e<0&&Xh.EmailPreview.reset()}},{key:"_runRemoteSearch",value:function(){var e=this;if(Xh.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getRemoteValue(),n=this.plugin.getDescriptorForItem(this.item.get());if(n.labelID){var r=this.plugin._getLabelByID(n.accountID,n.labelID);r.isSpecialLabel()||r.isInbox()||!r.hasName()||(t+=" label:"+r.getName())}this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var i="R~"+this.getActualPaneItem().id+"~"+v.default.generateTempId();v.default.log("Gmail Remote Search ItemID: ",i),this._currentSearch=this.plugin.runSearch(t,this.id,i,!0,(function(t){if(!e._destroyed&&e._isSearchingRemote.get())switch(e.paneEmptySearchMessage=t===y.a.SearchResultStatus.Done?e.paneEmptySearchMessageDefault:"",e.isLoading.set(!1),t){case y.a.SearchResultStatus.Done:e.paneTopText.set(""),e.scrollToIndex(0,"start");break;case y.a.SearchResultStatus.TooMany:e.paneTopText.set("Too many search results! Be more specific.");break;case y.a.SearchResultStatus.None:e.paneTopText.set("There were no search results");break;case y.a.SearchResultStatus.Error:e.paneTopText.set("There was an error running your search, try again.");break;default:try{v.default.PAssert(2488,!1,"Invalid search state: ",t)}catch(n){v.default.reportError(n)}}}))}}},{key:"_clearCurrentSearch",value:function(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)}},{key:"onSearchChanged",value:function(e){var t=this.search.getRemoteValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var n=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,n)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"isRemoteSearchActive",value:function(){return this.plugin.isRemoteSearchBucketActive(this.id)}},{key:"onEmailComposeClosed",value:function(){var e=this.plugin,t=e.getDefaultAccount(),n=e._getLabelByID(t,wc.DRAFT),r=e.getVMLIForLabel(t,n);this.item.get()===r&&this.selectIndex(-1)}},{key:"onEmailPreviewClosed",value:function(){0}},{key:"applyToSelection",value:function(e){var t=this.saveSelection();lc.a.forEach(this,e),this.restoreSelection(t)}},{key:"_autocompletePopup",value:function(e,t,n){var r=this;if(!e.elementDisplay){var i=lc.a.getFirstSelectedIndex(this),a=this.elementAtIndex(i);e.elementDisplay=a}var o=[];lc.a.forEach(this,(function(e){o.push(e)})),e.items=o,e.onSelected=function(i){r.plugin.beginAction(),e.item?t(e.item,i):lc.a.forEach(r,(function(e){t(e,i)})),n&&n(),r.plugin.endAction()},cc.a.showPopup(e)}},{key:"getPaddingForPaneObject",value:function(e){return e.overview?l()(g()(n.prototype),"getPaddingForPaneObject",this).call(this,e)-20:0}},{key:"getWidth",value:function(){return this.rect.get().width}},{key:"getFirstSelectedItem",value:function(){return lc.a.getFirstSelectedItem(this)}},{key:"getFirstSelectedIndex",value:function(){return lc.a.getFirstSelectedIndex(this)}},{key:"autocompleteSchedule",value:function(e){var t=this,r=e.onClose,i=this.selectedIndex.get();e.element=e.element||this.elementAtIndex(i),e.onClose=function(){i>=t.numItems()&&(i=t.numItems()-1),t.selectIndex(i,!0),r&&r()},l()(g()(n.prototype),"autocompleteSchedule",this).call(this,e)}},{key:"autocompleteMove",value:function(e,t){var r=this;e=e||{};var i=this.selectedIndex.get();e.positionOffset={left:40},l()(g()(n.prototype),"autocompleteMove",this).call(this,e,(function(){i>=r.numItems()&&(i=r.numItems()-1),r.selectIndex(i,!0),t&&t()}))}},{key:"autocompleteCreateTask",value:function(){var e=this,t=this.selectedIndex.get();if(!isNaN(t)){var n=this.elementAtIndex(t),r=lc.a.getSelectedItems(this);Xh.menus.openItemEditor({element:n,pane:this,selectIndex:0,addOnSave:!0,selectDocument:!0,side:"bottom",children:r,positionOffset:{left:10},options:[{text:"Archive email",value:Xh.pluginManager.getSetting(y.a.PluginID.Gmail,y.a.PluginSettingsID.Gmail.ArchiveOnOrganize)||!1,cb:function(){for(var t=0,n=0;n<r.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=r[n].getAttachmentByPlugin(e.plugin.id);e.plugin.performAction(y.a.PluginAction.Gmail.Archive,!1,i)}}}],beginSave:function(){var t=0;Xh.PaneUpdateBatcher.beginUpdateItems(),e.plugin.beginAction();for(var n=0;n<r.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=r[n].getAttachmentByPlugin(e.plugin.id);e.plugin.attachmentHasLabel(i,"Moo.do/Handled")||e.plugin.performAction(y.a.PluginAction.Gmail.AddLabel,!1,i,"Moo.do/Handled")}},endSave:function(){e.plugin.endAction(),Xh.PaneUpdateBatcher.commitUpdateItems()}})}}},{key:"toggleStarSelected",value:function(){l()(g()(n.prototype),"toggleStarSelected",this).call(this),this.updateItems()}},{key:"toggleStar",value:function(e){var t=e.getAttachmentByPlugin(this.plugin.id);try{v.default.PAssert(2490,t,"Must be able to get a valid attachment")}catch(r){v.default.reportError(r)}var n=t.getPlugin();n.isItemStarred(e)?n.performAction(y.a.PluginAction.Gmail.Unstar,!1,t):n.performAction(y.a.PluginAction.Gmail.Star,!1,t),this.updateItems()}},{key:"_openSelectedInMode",value:function(e){var t=lc.a.getFirstSelectedIndex(this);this.selectIndex(t);var n=this.itemAtIndex(t);this.openEmailByItem(n,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(y.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(y.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(y.a.EmailResponseMode.Forward)}},{key:"archiveSelected",value:function(e){this.plugin.beginAction(),this.applyToSelection(this.archiveEmailFromCurrentLabel),this.plugin.endAction()}},{key:"archiveItem",value:function(e,t){var n=t.getAttachmentByPlugin(this.plugin.id);try{v.default.PAssert(2491,n,"Must be able to get a valid attachment")}catch(r){v.default.reportError(r)}!e&&this.plugin.isItemArchived(t)?this.plugin.performAction(y.a.PluginAction.Gmail.Unarchive,!1,n):e&&!this.plugin.isItemArchived(t)&&this.plugin.performAction(y.a.PluginAction.Gmail.Archive,!1,n)}},{key:"deleteSelected",value:function(e,t){this.plugin.beginAction(),this.applyToSelection(this.deleteEmailFromCurrentLabel),this.plugin.endAction()}},{key:"applyPriorityToSelection",value:function(e,t){var n=this,r=e,i=!0;this.plugin.beginAction(),this.applyToSelection((function(a){var o=a.getAttachmentByPlugin(n.plugin.id);try{v.default.PAssert(2492,o,"Must be able to get a valid attachment")}catch(s){v.default.reportError(s)}t&&i&&(n.plugin.getAttachmentPriority(o)===e&&(r=y.a.VMLIFlag.None),i=!1),n.plugin.performAction(y.a.PluginAction.Gmail.SetPriority,!1,o,r),n.updateItems()})),this.plugin.endAction()}},{key:"handleUndo",value:function(){this.plugin.handleUndo()}},{key:"handleRedo",value:function(){this.plugin.handleRedo()}},{key:"keyMoveDown",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(lc.a.isInverted(this)&&1===lc.a.numSelectedInPane(this)&&lc.a.setInverted(!1,this),lc.a.isInverted(this)?(t=lc.a.getFirstSelectedIndex(this),lc.a.removeSelected(t,this)):(t=this.indexOfNextVMLI(lc.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(lc.a.addSelected(t,this),this.scrollIndexIntoView(t))):(t=this.indexOfNextVMLI(lc.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(this.selectIndex(t),this.scrollIndexIntoView(t))}},{key:"keyMoveUp",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(lc.a.isInverted(this)||1!==lc.a.numSelectedInPane(this)||lc.a.setInverted(!0,this),lc.a.isInverted(this)?(t=this.indexOfPrevVMLI(lc.a.getFirstSelectedIndex(this)))>=0&&(lc.a.addSelected(t,this),this.scrollIndexIntoView(t,"smooth")):(t=lc.a.getLastSelectedIndex(this),lc.a.removeSelected(t,this))):(t=this.indexOfPrevVMLI(lc.a.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(t),this.scrollIndexIntoView(t,"smooth"))}},{key:"onHotkey",value:function(e,t){if(this.selectedIndex.get()>=0&&!Xh.menus.isContextMenuOpen()){var n=this.objectAtIndex(this.selectedIndex.get()),r=n.item,i=!0;if(r){if("Up"===e)this.keyMoveUp(t);else if("Down"===e)this.keyMoveDown(t);else if("Open"===e)Xh.EmailPreview.isOpenOnPane(this)||this.openEmailByItem(r);else if("Archive"===e){t.shiftKey&&Xh.EmailPreview.isOpenOnPane(this)&&Xh.EmailPreview.close();var a=!this.getItemLabel(!0).isArchived();this.archiveSelected(a)}else if("Delete"===e)this.deleteSelected(this.plugin.isGmailItem,!0);else if("Schedule"===e)this.autocompleteSchedule({item:r});else if("Move"===e)this.autocompleteMove();else if("Task"===e)this.autocompleteCreateTask();else if("Label"===e)this.autocompleteLabel({item:r});else if("MarkRead"===e)this.markReadSelected(!0);else if("MarkUnread"===e)this.markReadSelected(!1);else if("Star"===e)this.toggleStarSelected();else if("Reply"===e)this.replySelected();else if("ReplyAll"===e)this.replyAllSelected();else if("Forward"===e)this.forwardSelected();else if("Priority1"===e)this.applyPriorityToSelection(y.a.VMLIFlag.P0,!0);else if("Priority2"===e)this.applyPriorityToSelection(y.a.VMLIFlag.P1,!0);else if("Priority3"===e)this.applyPriorityToSelection(y.a.VMLIFlag.P2,!0);else if("RemoveFromLabel"===e)this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel),this.plugin.endAction());else if("Undo"===e)this.handleUndo();else if("Print"===e){if(1===lc.a.numSelectedInPane(this)){var o=lc.a.getFirstSelectedItem(this),s=this.plugin.createPrintURLForThread(o.getAttachmentByPlugin(this.plugin.id));v.default.printPage(s)}}else if("OpenInGmail"===e){if(1===lc.a.numSelectedInPane(this)){var u=lc.a.getFirstSelectedItem(this),l=this.plugin.getURLForAttachment(u.getAttachmentByPlugin(this.plugin.id));Xh.openUrl(l)}}else"Menu"===e?Xh.menus.openItemContextMenu(n):i=!1;i&&v.default.preventDefault(t)}}}},{key:"archiveEmailFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0),n=!t.isArchived();this.archiveItem(n,e),t.isInbox()||t.isArchived()||this.plugin.removeItemFromLabel(t,e)}},{key:"deleteEmailFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);this.plugin.deleteItem(e,t)}},{key:"removeItemFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);this.plugin.removeItemFromLabel(t,e)}},{key:"canAcceptDragOver",value:function(e,t,n,r){if(this.type===(null===e||void 0===e?void 0:e.type)&&r&&(n||e&&this!==e)){var i,a=e.getItemLabel();if(n){var o=v.default.getElementParent(t);i=o&&v.default.getItemForElement(o)}else i=this.getItem();if(i&&this.plugin.isLabelItem(i)&&this.plugin.areItemsFromSameAccount(r,i)){var s=this.plugin.getLabelForVMLI(i);if(s!==a&&s.isDropTarget())return!0}}else if(this.type!==e.type){if(r.getAttachmentByPlugin(this.plugin.id))return!0}return!1}},{key:"_handleDragOverPane",value:function(e,t,n,r,i,a,o){return{targetPane:this,targetElement:t,targetItem:this.getItem()}}},{key:"_handleDragDrop",value:function(e,t,n,r,i){var a=this,o=n.targetItem,s=n.overview,u=(r.ctrlKey,r.altKey,s?o:this.getActualPaneItem()),l=this.plugin.getLabelForVMLI(u);return e.forEach((function(e){var t=e.getAttachmentByPlugin(a.plugin.id);if(t&&(t.getField("accountID")===l.getAccountID()&&(null===l||void 0===l?void 0:l.isDropTarget()))){var n=l.getName();a.plugin.attachmentHasLabel(t,n)||a.plugin.addLabelToAttachment(t,n)}})),!0}},{key:"_handleDragDropItem",value:function(e,t,n,r,i){r.ctrlKey,r.altKey;var a=!1;if(n){var o=t.pane,s=o.getItemLabel(),u=n.targetItem,l=this.plugin.getLabelForVMLI(u);if(e.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(e,u)){var c=e.getAttachmentByPlugin(this.plugin.id);try{v.default.PAssert(2493,c,"Must be able to get a valid attachment")}catch(d){v.default.reportError(d)}this.plugin.beginAction(),this.plugin.performAction(y.a.PluginAction.Gmail.RemoveLabel,!1,c,s.getName()),this.plugin.attachmentHasLabel(c,l.getName())||this.plugin.performAction(y.a.PluginAction.Gmail.AddLabel,!1,c,l.getName()),o.notifyDropFrom(e,this),this.plugin.endAction(),a=!0}}return a}},{key:"notifyDropFrom",value:function(e,t){if(this.selectIndex(-1),t.type===y.a.PaneMode.Task){var n=e.getAttachmentByPlugin(this.plugin.id);try{v.default.PAssert(2494,n,"Must be able to get a valid attachment")}catch(i){v.default.reportError(i)}this.plugin.attachmentHasLabel(n,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(y.a.PluginAction.Gmail.RemoveLabel,!1,n,"Inbox"),this.plugin.performAction(y.a.PluginAction.Gmail.AddLabel,!1,n,"Moo.do/Handled"),this.plugin.endAction());var r=this.plugin.getAttachmentPriority(n);r!==y.a.VMLIFlag.None&&e.setPriority(r,y.a.ChangeType.Local),this.plugin.attachmentHasLabelByID(n,"STARRED")&&e.setStarred(!0,y.a.ChangeType.Local)}}},{key:"maxWidthOfPaneObject",value:function(){return this.getWidth()-56}},{key:"allowZoom",value:function(e){var t=!1;return this.plugin.isLabelItem(e)&&(t=!0),t}},{key:"performOverviewAction",value:function(e){if(this.plugin.isAccountItem(e)){e.setCollapsed(!e.isCollapsed(this,!0),this,!0);var t=e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(e));this.zoomIn(t),v.default.sendEvent("Menu","OverviewZoom_Gmail")}}},{key:"setItem",value:function(e,t){return this.selectIndex(-1,void 0,!0),l()(g()(n.prototype),"setItem",this).call(this,e,t)}},{key:"isItemHeader",value:function(e,t){if(!t)return e.isHeader();for(var n=0,r=this.plugin,i=e.getItems(),a=0;a<i.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r.isLabelItem(i[a])||r.isAccountItem(i[a]))return!0}}},{key:"getActualPaneItem",value:function(){return this.plugin._defaultZoomItems[this.id]||this.item.get()}},{key:"canResetMultiselect",value:function(){return!Xh.EmailPreview.isOpenOnPane(this)||0===this.numItems()}},{key:"setExpanded",value:function(e,t){l()(g()(n.prototype),"setExpanded",this).call(this,e,t),e||this===v.default.focusedPane||lc.a.reset(this)}},{key:"_applyDropOnBlockItem",value:function(e,t,n,r){var i=e,a=t.getAttachmentByPlugin(this.plugin.id);try{v.default.PAssert(2495,a,"Must be able to get a valid attachment")}catch(l){v.default.reportError(l)}if(i.isDate){var o,s=i.dateTime||i.date;o=v.default.isString(s)?Xh.International.parseDate(s,y.a.DateFormat.MDY):s;try{v.default.PAssert(2496,v.default.isDateValid(o),"Must provide a valid date when scheduling an email",i.dateTime,i.date)}catch(l){v.default.reportError(l)}v.default.isDateValid(o)&&this.plugin.scheduleEmail(t,o)}else{var u;i.isStarred?this.plugin.performAction(y.a.PluginAction.Gmail.Star,!1,a):i.isImportant&&(u=y.a.VMLIFlag.P0),u&&this.plugin.performAction(y.a.PluginAction.Gmail.SetPriority,!1,a,u)}}},{key:"getSaveInfo",value:function(){var e=l()(g()(n.prototype),"getSaveInfo",this).call(this);e.viewState=this.viewState.get();var t=lc.a.getFirstSelectedItem(this);return e.selectedItem=t?t.id:void 0,e}},{key:"setIgnoreRestoreScroll",value:function(){}},{key:"getSwipeMenuItems",value:function(e){var t=this,n=e.item;return{left:[{icon:"check",text:"Archive",backgroundColor:"#0c0",onActivated:function(){t.archiveEmailFromCurrentLabel(n)}}],right:[{icon:"format-align-left",backgroundColor:"#09d",onActivated:function(){Xh.menus.openItemAutocomplete((function(e){t.plugin.moveEmailToItem(n,e.extraInfo)}))}},{icon:"delete",backgroundColor:"#a30",onActivated:function(){t.deleteEmailFromCurrentLabel(n)}}]}}},{key:"titleOfFirstItem",value:function(){return this.getItem().getParsedText()}},{key:"onTapAddItem",value:function(){Xh.menus.openComposeEmail(Xh.pluginManager.getPluginGmail())}},{key:"isOverviewVisibleInPane",value:function(){return!0}},{key:"getMinItemSize",value:function(){return y.a.EmailItemHeight}},{key:"widthOfDrag",value:function(e){return this.getWidth()}},{key:"viewModeIcon",value:function(){return"Date"===this.getViewMode()?"icon-access_time":"icon-exclamation"}},{key:"viewModeColor",value:function(){return y.a.Colors.Red}},{key:"changeView",value:function(e){this.viewMode.set(e),this.updateItems(!1,!0)}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){var t=this.viewState.get();t.viewMode!==e&&this.viewState.set(Object.assign({},t,{viewMode:e}),!this.isFakePane)}},{key:"becomeReal",value:function(){this.getItem()&&this.setItem(this.getItem(),!0)}},{key:"setDocument",value:function(){}},{key:"getItemHeight",value:function(){return y.a.EmailItemHeight}},{key:"getStatusMessage",value:function(e){return this.paneTopText.get()?"":l()(g()(n.prototype),"getStatusMessage",this).call(this,e)}},{key:"getDeferredItem",value:function(e){for(var t=0,n=e.split("~"),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if("L"===n[r]){var i=n[r+1],a=n[r+2];if(i&&a){var o=this.plugin._getLabelByID(i,a);return o&&this.plugin.getVMLIForLabel(i,o)}}}}},{key:"itemLevelsDeep",value:function(e){return e.levelsDeep.get()-1}},{key:"getMobileIcon",value:function(){return"MdEmail"}}],[{key:"getPluginID",value:function(){return y.a.PluginID.Gmail}}]),n}(al.a),b()(ec.prototype,"archiveEmailFromCurrentLabel",[w.a],Object.getOwnPropertyDescriptor(ec.prototype,"archiveEmailFromCurrentLabel"),ec.prototype),b()(ec.prototype,"deleteEmailFromCurrentLabel",[w.a],Object.getOwnPropertyDescriptor(ec.prototype,"deleteEmailFromCurrentLabel"),ec.prototype),b()(ec.prototype,"removeItemFromCurrentLabel",[w.a],Object.getOwnPropertyDescriptor(ec.prototype,"removeItemFromCurrentLabel"),ec.prototype),ec),pc=0,gc=function(){function e(t){a()(this,e),this._plugin=t,this._headers=[],this._mimeTree=void 0}return s()(e,[{key:"reset",value:function(){this._headers=[],this._mimeTree=void 0}},{key:"getMessageText",value:function(e){return e.decoded}},{key:"updateFromDraft",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r,i,a,o){var s,u,l,c,d,h,f,p,g,m,y,_,b,w,k,S,E,P,I,D,T,x=this;return jo.a.wrap((function(e){for(var C=0;;){if(C++>5e3&&__infLoop&&__infLoop(C))throw new RangeError;switch(e.prev=e.next){case 0:if(this.reset(),this.addHeader("From",this._plugin._formatAddressText(r,i,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(n.to,!0)),n.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(n.cc,!0)),n.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(n.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",v.default.encodeMIMEHeader(n.subject||"(no subject)")),n.inReplyTo){this.addHeader("In-Reply-To",n.inReplyTo.trim()),u=t.messages.indexOfWithProperty("messageID",n.inReplyTo);try{v.default.PAssert(2431,u>=0,"Must always be able to find the message being replied to")}catch(A){v.default.reportError(A)}s=t.messages[u]}return n.references?l=n.references:s&&(l=(v.default.isTempId(s.messageID)?"":s.messageID)+(s.references?" "+s.references:"")),l&&this.addHeader("References",l.trim()),e.next=12,fs.generatePlaintext(this.getMessageText(n));case 12:if(c=e.sent,(h=this._getAttachedResources(n)).length>0&&(d=this.createMimePart("multipart/mixed"),this.addMimePart(d)),!c){e.next=43;break}if(f=this.createMimePart("multipart/alternative"),this.addMimePart(f,d),p=this.createMimePart("text/plain",c,"7bit"),this.addMimePart(p,f),!((g=this._getInlineResources(n)).length>0)){e.next=39;break}m=0,y=this.createMimePart("multipart/related"),this.addMimePart(y,f),_=this.createMimePart("text/html",this.getMessageText(n),"7bit"),this.addMimePart(_,y),b=0;case 28:if(!(b<g.length)){e.next=37;break}if(!(m++>5e3&&__infLoop&&__infLoop(m))){e.next=31;break}throw new RangeError;case 31:w=g[b],(k=this.createResourcePart(w))&&this.addMimePart(k,y);case 34:++b,e.next=28;break;case 37:e.next=41;break;case 39:S=this.createMimePart("text/html",this.getMessageText(n),"7bit"),this.addMimePart(S,f);case 41:e.next=45;break;case 43:E=this.createMimePart(n.contentType||"text/html",this.getMessageText(n),"7bit"),this.addMimePart(E,d);case 45:if(!d||!a){e.next=59;break}P=0,I=0,D=function(){if(++I===h.length){for(var e=0,t=0,n=0;n<h.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=h[n];if(r.id&&v.default.isTempId(!r.id)){var i=x.createResourcePart(r);i&&x.addMimePart(i,d)}}o()}},T=0;case 50:if(!(T<h.length)){e.next=57;break}if(!(P++>5e3&&__infLoop&&__infLoop(P))){e.next=53;break}throw new RangeError;case 53:this._plugin.loadResource(t.id,n.id,h[T].cid,D);case 54:++T,e.next=50;break;case 57:e.next=60;break;case 59:setTimeout(o,0);case 60:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()},{key:"_getInlineResources",value:function(e){var t=[];return v.default.forEachValue(e.resources,(function(e){"inline"===e.disposition&&t.push(e)})),t}},{key:"_getAttachedResources",value:function(e){var t=[];return v.default.forEachValue(e.resources,(function(e){"attachment"===e.disposition&&e.id&&t.push(e)})),t}},{key:"addHeader",value:function(e,t){try{v.default.PAssert(2432,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(r){v.default.reportError(r)}var n=t.trim().replace(/[\r\n]/g,"");this._headers.push(e+": "+n)}},{key:"_generateBoundary",value:function(){return"=========3141592653589moodo"+Date.now()+ ++pc}},{key:"createMimePart",value:function(e,t,n,r){try{v.default.PAssert(2433,e,"Must supply a valid content type")}catch(i){v.default.reportError(i)}try{v.default.PAssert(2434,void 0===t||n,"Must supply a valid content encoding")}catch(i){v.default.reportError(i)}return{boundary:this._generateBoundary(),contentType:e,content:t,contentEncoding:n,contentDisposition:r,children:[]}}},{key:"createResourcePart",value:function(e){try{v.default.PAssert(2435,e&&e.data,"Must have valid data loaded for resource to embed it in message")}catch(i){v.default.reportError(i)}var t;if(e&&e.data){var n=e.mimeType+'; name="'+e.cid+'"',r=e.disposition+'; filename="'+e.cid+'"';(t=this.createMimePart(n,e.data,e.contentEncoding,r)).contentID=e.cid}return t}},{key:"addMimePart",value:function(e,t){try{v.default.PAssert(2436,e,"Must supply a valid mime part")}catch(n){v.default.reportError(n)}if(t)t.children.push(e);else{try{v.default.PAssert(2437,!this._mimeTree,"Must not yet have a valid mime tree root")}catch(n){v.default.reportError(n)}this._mimeTree=e}}},{key:"_mimePartToBlob",value:function(e){var t="\r\n",n=[];function r(e,t){if(t){try{v.default.PAssert(2438,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(i){v.default.reportError(i)}var r=t.trim().replace(/[\r\n]/g,"");n.push(e+": "+r)}}var i=e.contentType;(e.content||(i+='; boundary="'+e.boundary+'"'),r("MIME-Version","1.0"),r("Content-Type",i),r("Content-Transfer-Encoding",e.contentEncoding),r("Content-Disposition",e.contentDisposition),e.contentID)&&r("Content-ID","<"+e.contentID+">");if(t=n.join("\r\n").trim(),t+="\r\n",e.content)t+="\r\n"+e.content+"\r\n";else if(e.children&&e.children.length>0){for(var a=0,o=0;o<e.children.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+="\r\n--"+e.boundary+"\r\n",t+=this._mimePartToBlob(e.children[o])}t+="--"+e.boundary+"--\r\n"}else t+="\r\n(no text)\r\n";return t}},{key:"generateBlob",value:function(){var e=this._headers.join("\r\n").trim();return e+="\r\n"+this._mimePartToBlob(this._mimeTree)}}]),e}();function vc(e){this._maxSize=e,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}vc.prototype={registerOwner:function(e,t){try{v.default.PAssert(2401,e,"Must supply a valid owner object")}catch(n){v.default.reportError(n)}try{v.default.PAssert(2402,!this._registeredOwners[t],"Must not double define an owner")}catch(n){v.default.reportError(n)}this._registeredOwners[t]=e,this._registeredActions[t]={}},registerAction:function(e,t,n){try{v.default.PAssert(2403,e,"Must provide a valid owner")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2404,t,"Must provide a valid action ID")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2405,this._registeredOwners[e],"Must have already registered a valid owner")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2406,!this._registeredActions[e][t],"Must not double define an action for an owner")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2407,n,"Must pass in a valid undo/redo descriptor")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2408,v.default.isFunction(n.undo),"Must provide a valid undo fn")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2409,v.default.isFunction(n.redo),"Must provide a valid redo fn")}catch(r){v.default.reportError(r)}this._registeredActions[e][t]=n},_getOwner:function(e){try{v.default.PAssert(2410,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){v.default.reportError(t)}return this._registeredOwners[e.ownerID]},_getActionData:function(e){try{v.default.PAssert(2411,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){v.default.reportError(t)}try{v.default.PAssert(2412,this._registeredActions[e.ownerID][e.actionID],"Must have previously registered action for owner")}catch(t){v.default.reportError(t)}return this._registeredActions[e.ownerID][e.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(e){return{id:this._useNextGroupID(),events:e||[]}},_pushNewGroup:function(e){var t=this._createGroup(e);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(t),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(e){if(0===this._aggregateActions){try{v.default.PAssert(2413,0===this._currentAction.length,"Current actions should be flushed")}catch(t){v.default.reportError(t)}this._actionsPreventUndo=!!e}this._aggregateActions++},runAction:function(e,t,n){var r={ownerID:e,actionID:t},i=this._getOwner(r);return this._getActionData(r).redo.apply(i,n)},performAction:function(e,t,n){try{v.default.PAssert(2414,this._aggregateActions>0,"Must be in a begin/end action block")}catch(r){v.default.reportError(r)}try{v.default.PAssert(2415,n,"Must provide valid data for the action")}catch(r){v.default.reportError(r)}this._currentAction.push({ownerID:e,actionID:t,data:n})},performActions:function(e){if(e&&e.length>0){var t=0;this.beginAction();for(var n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];this.performAction(r.ownerID,r.actionID,r.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var e=0,t=this._groups[this._cursor--],n=t.events.length-1;n>=0;n--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.events[n],i=this._getOwner(r);this._getActionData(r).undo.apply(i,r.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var e=0,t=this._groups[++this._cursor],n=0;n<t.events.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.events[n],i=this._getOwner(r);this._getActionData(r).redo.apply(i,r.data.redoParams)}}};var mc,yc=vc;function _c(e){var t=function(e,t){if("object"!==z()(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==z()(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===z()(t)?t:String(t)}function bc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var wc,kc="EnsureLabelVMLI",Sc="CreateLabelVMLI",Ec="MergeThread",Pc="SyncdMessage",Ic="ErrorSyncdMessage",Dc="UnsyncdMessage",Tc="OldUnsyncdMessage",xc="MessagesSyncd",Cc="MessageDataCached",Ac="snoozemail",Lc="sendmail",Oc=1,Mc=2,Rc=3,Fc=4,Nc=5,jc=6,Uc=7,Bc=8,Vc=9,Hc=10,Wc=11,qc=12,zc=13,Gc=14,Kc=15,Yc=16,Qc=17,Xc=18,$c=19,Jc=20,Zc="historyIDs",ed="labels",td="sendAs",nd="Moo.do";!function(e){e.INBOX="INBOX",e.SPAM="SPAM",e.TRASH="TRASH",e.UNREAD="UNREAD",e.STARRED="STARRED",e.IMPORTANT="IMPORTANT",e.SENT="SENT",e.DRAFT="DRAFT",e.CHAT="CHAT",e.CATEGORY_PERSONAL="CATEGORY_PERSONAL",e.CATEGORY_SOCIAL="CATEGORY_SOCIAL",e.CATEGORY_PROMOTIONS="CATEGORY_PROMOTIONS",e.CATEGORY_UPDATES="CATEGORY_UPDATES",e.CATEGORY_FORUMS="CATEGORY_FORUMS"}(wc||(wc={}));var rd,id={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},ad="==MOODO_ARCHIVED==",od="==MOODO_ALLMAIL==",sd={PRI0:"Moo.do/Priority High",PRI1:"Moo.do/Priority Medium",PRI2:"Moo.do/Priority Low"},ud="Moo.do/Handled",ld=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError","modifiedOffline"],cd="multipart/signed",dd="multipart/related",hd="message/partial",fd="multipart/mixed",pd="multipart/report",gd="multipart/parallel",vd="multipart/alternative",md="multipart/digest",yd="multipart/encrypted",_d="multipart/voice-message",bd="text/calendar",wd="text/plain",kd="text/html",Sd="text/watch-html",Ed="text/x-watch-html";!function(e){e.Unknown="unknown",e.Inline="inline",e.FormData="form-data",e.Attachment="attachment"}(rd||(rd={}));var Pd,Id="text/html;charset=utf-8",Dd=["application","audio","example","image","message","model","video","text"],Td=[vd,fd,wd,kd,pd],xd=[wd,kd],Cd=[bd,_d,yd,fd],Ad=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],Ld=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,Od=/\'(.*)\'/g,Md=(mc=function(e){d()(n,e);var t=bc(n);function n(){var e;return a()(this,n),(e=t.call(this,y.a.PluginID.Gmail,"g","Email",!1,{s:!0}))._lastSyncTime=void 0,e._requiresOfflineAuth=!0,e.doesRender=!0,G.a.binder(W()(e),"threadSortFn","threadSortPriorityFn","labelSortFn","labelVMLISortFn","sortFn","_fromComparator","_toComparator","_dateComparator","_messagesComparator","_shallowObjComparator","isGmailItem","_flushPendingDraftUpdates","driveMessageContentSync","_cleanupLocalCaches","_handleDeferredSnoozeTask","_cancelDeferredSnoozeTask","_persistRemoteSnoozeTask","_handleDeferredSendMailTask","_cancelDeferredSendMailTask","_persistRemoteSendMailTask"),e._emailCache={},e._labelsByID={},e._labelsByName={},e._priorityLabels={},e._creatingDrafts={},e._pendingDraftUpdates={},e._pendingThreadLoads={},e._loadThreadMutex=0,e._activeDraftUpdates=0,e._accountSettings={},e._pendingSends={},e._draftCache={},e._unsyncdMessages={},e._pendingSyncdMessages={},e._numUnsyncdMessages=0,e._numSyncdMessages=0,e._outstandingContentSync=!1,e.isLoadingThreads=new E.a(!1),e._undoStack=new yc(10),e._generateUndoRedo(),e._syncingOfflineChanges=!1,e._draftFlushTimer=void 0,e.registerSetting("SyncTime","syncTime","t",!0,y.a.MaxGmailSyncTime.Free),e.registerSetting("ArchiveOnSchedule","archiveOnSchedule","a",!0,!1),e.registerSetting("ArchiveOnOrganize","archiveOnOrganize","o",!0,!1),e.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies","i",!0,!1),e.addTrackedStat(kc),e.addTrackedStat(Sc),e.addTrackedStat(Ec),e.addTrackedStat(Pc),e.addTrackedStat(Ic),e.addTrackedStat(Dc),e.addTrackedStat(Tc),e.addTrackedStat(xc),e.addTrackedStat(Cc),e._threadCache=e.registerLocalCache(e.id,y.a.StorageType.IndexedDB,{noInMemoryCache:!0,metadataKeys:[Zc,ed,td],keyFieldsRN:["date","accountID","modifiedOffline"]}),e._rawCache=e.registerLocalCache(e.id+"Messages",y.a.StorageType.IndexedDB,{noInMemoryCache:!0,keyFieldsRN:["internalDate"]}),e.registerDeferredTaskType(Ac,e._handleDeferredSnoozeTask,e._cancelDeferredSnoozeTask,e._persistRemoteSnoozeTask),e.registerDeferredTaskType(Lc,e._handleDeferredSendMailTask,e._cancelDeferredSendMailTask,e._persistRemoteSendMailTask),e._contentSyncTask=e.registerLowImpactTask("ContentSync",e.driveMessageContentSync),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._cleanupLocalCaches),e._lastCacheCleanup=0,e.declareProperty("accountID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1),e.declareProperty("from",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!1,void 0,e._fromComparator),e.declareProperty("to",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!1,void 0,e._toComparator),e.declareProperty("subject",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline),e.declareProperty("service",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1,"g"),e.declareProperty("date",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,new Date(0),e._dateComparator),e.declareProperty("lastModifiedDate",y.a.PluginLoad.Full,!0,void 0,e._dateComparator),e.declareProperty("modifiedOffline",y.a.PluginLoad.Full,!0,!1),e.declareProperty("pendingSend",y.a.PluginLoad.Full,!0,!1),e.declareProperty("messages",y.a.PluginLoad.Full,!0,[],e._messagesComparator),e.declareProperty("snippet",y.a.PluginLoad.Full),e.declareProperty("participants",y.a.PluginLoad.Runtime,!0,[]),e.declareProperty("subjectLower",y.a.PluginLoad.Runtime),e.declareProperty("count",y.a.PluginLoad.Runtime),e.declareProperty("dataLoaded",y.a.PluginLoad.Runtime,!0,!1),e.declareProperty("isDeleted",y.a.PluginLoad.Runtime,!0,!1),e.declareProperty("labelIds",y.a.PluginLoad.Runtime,!0,[]),e.declareProperty("hasAttachments",y.a.PluginLoad.Full,!0,!1),e.tempRootVMLI=N.a.createTempVMLI({id:"loading",text:"Loading emails"},{changeType:y.a.ChangeType.Auto}),e}return s()(n,[{key:"getType",value:function(){return y.a.PluginType.Email}},{key:"_attachMetadataFields",value:function(){return Ad}},{key:"getDataPane",value:function(){try{v.default.PAssert(1187,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){v.default.reportError(e)}return fc}},{key:"getPaneIcon",value:function(){return"icon-mail_outline"}},{key:"getPanePriority",value:function(){return 97}},{key:"useItemStore",value:function(){return"Gmail"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,enabledFilters:y.a.ItemStoreFilter.Priority,parserFn:Cs.a.runParseSinglePlugin}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"ensureAccountEmail",value:function(e){return"me"===e?this.getDefaultAccount():e}},{key:"getDefaultAccount",value:function(e){var t,n=Po.a.getDefaultAccountID();if(n){try{v.default.PAssert(1188,"me"!==n,'Should never return "me" as a valid user')}catch(r){v.default.reportError(r)}this.hasSyncAccount(n)&&(t=n)}else if(!e){try{v.default.PAssert(1189,!1,'Unable to get default account name, returning "me"')}catch(r){v.default.reportError(r)}t="me"}return t||(t=Object.keys(Po.a.authTokens)[0]),t||(t=n),t}},{key:"isSameAccount",value:function(e,t){return"me"===e&&(e=this.getDefaultAccount()),"me"===t&&(t=this.getDefaultAccount()),e===t}},{key:"areItemsFromSameAccount",value:function(e,t){var n=this.getAccountIDFromItem(e),r=this.getAccountIDFromItem(t);return this.isSameAccount(n,r)}},{key:"_handleAccountChanges",value:function(){var e=this,t=0,n=[];Xh.PaneManager.runForEachPane((function(t){var r=e.getAccountIDFromItem(t.getItem());try{v.default.PAssert(1190,r,"Missing Account ID: ",t.id,t.getItem().id)}catch(i){v.default.reportError(i)}e.hasSyncAccount(r)||n.push(t)}),this.getPaneType());for(var r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;Xh.PaneManager.removePane(n[r])}0===n.length&&Xh.PaneManager.notifyPanes()}},{key:"onSyncAccountsChanged",value:function(e,t){var r=this;l()(g()(n.prototype),"onSyncAccountsChanged",this).call(this,e,t),Xh.PaneUpdateBatcher.beginUpdateItems(),t.forEach((function(e){if(r._clearCachedData(e),r.getDefaultItemStore()){var t=r.getVMLIForAccount(e);t&&(t.deleteSelf(y.a.ChangeType.Local),t.isDestroyed()||t.getItemStore().destroyItem(t.id))}r._handleAccountChanges()})),e.forEach((function(e){r.isActive()&&(r._ensureLabel(e,wc.INBOX,"Inbox",void 0,void 0,y.a.ChangeType.Local),r._ensureLabel(e,wc.UNREAD,"Unread",void 0,void 0,y.a.ChangeType.Local),r._ensureLabel(e,ad,"Archived",void 0,void 0,y.a.ChangeType.Local),r._ensureLabel(e,od,"All Mail",void 0,void 0,y.a.ChangeType.Local),r._forceLabelSync((function(){r._forceThreadSync()}))),r._handleAccountChanges()})),Xh.PaneUpdateBatcher.commitUpdateItems()}},{key:"_iterateSendAs",value:function(e){for(var t=0,n=this.getSyncAccounts(),r=!1,i=0;!r&&i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=this.getAccountSetting(n[i],"sendAs");if(a)for(var o=0,s=0;s<a.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=a[s];if(e(n[i],u)){r=!0;break}}else e(n[i])}}},{key:"getSignature",value:function(e){var t;return this._iterateSendAs((function(n,r){if(r&&r.sendAsEmail===e)return t=r.signature,!0})),t}},{key:"getReplyToAddress",value:function(e){var t;return this._iterateSendAs((function(n,r){if(r&&r.sendAsEmail===e&&r.replyToAddress)return t=r.replyToAddress,!0})),t}},{key:"_computeDisplayName",value:function(e,t){var n;return!t.displayName&&t.isPrimary||(n=t.displayName),n}},{key:"getDisplayName",value:function(e){var t,n=this;return this._iterateSendAs((function(r,i){if(i&&i.sendAsEmail===e)return t=n._computeDisplayName(r,i),!0})),t}},{key:"getDefaultSendingAccount",value:function(e){var t;return this._iterateSendAs((function(n,r){if(n===e&&r&&r.isDefault)return t=r.sendAsEmail,!0})),t||(t=e),t}},{key:"getDefaultFromInfo",value:function(e){var t=this.getDefaultSendingAccount(e);try{v.default.PAssert(1191,t,"Must have found a valid account to send from")}catch(n){v.default.reportError(n)}return{text:this.getDisplayName(t),email:t}}},{key:"getSendingAccounts",value:function(e){var t=[];return this._iterateSendAs((function(n,r){e&&e!==n||(r?"pending"!==r.verificationStatus&&t.push(r.sendAsEmail):t.push(n))})),t}},{key:"getSyncAccount",value:function(e){var t;return this._iterateSendAs((function(n,r){if(r){if(r.sendAsEmail===e)return t=n,!0}else if(e===n)return t=n,!0})),t}},{key:"getSendingAccountInfo",value:function(e){var t,n=this;return this._iterateSendAs((function(r,i){if(i){if(i.sendAsEmail===e)return t={text:n._computeDisplayName(r,i),email:e},!0}else if(e===r)return!0})),t}},{key:"_getSettingsSendAs",value:function(e){var t=this,n=this.getSyncAccounts(),r=n.length,i=0,a={},o=function(t,n,o){t&&(a[n]=o.sendAs),++i===r&&e(a)};n.forEach((function(e){t._requestSettings(e,o)}))}},{key:"_requestSettings",value:function(e,t){var n=this,r=Du.a.fns("gmail").users.settings.sendAs.list.packedFn,i={userId:e};this._queueRemoteRequestMulti(e,r,i,(function(n){t(!0,e,n)}),(function(r){t(!1,e,r),n._notifyFailedRequest(e,r)}),void 0,Jc)}},{key:"_emailComparator",value:function(e,t){var n=v.default.isString(e)?this.parseEmailAddress(e):e,r=v.default.isString(t)?this.parseEmailAddress(t):t;return n.text===r.text&&n.email===r.email}},{key:"_fromComparator",value:function(e,t){var n=!1;return e||t?e&&t&&(n=this._emailComparator(e,t)):n=!0,n}},{key:"_toComparator",value:function(e,t){var n=!1;return e||t?e&&t&&(n=this._emailComparator(e,t)):n=!0,n}},{key:"_dateComparator",value:function(e,t){var n=!1;if(e||t){if(e&&t){v.default.isString(e)&&(e=this.parseDateHeader(e)),v.default.isString(t)&&(t=this.parseDateHeader(t));try{v.default.PAssert(1192,v.default.isDateValid(e),"Must be an old valid date to compare")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1193,v.default.isDateValid(t),"Must be a new valid date to compare")}catch(r){v.default.reportError(r)}v.default.isDateValid(e)&&v.default.isDateValid(t)&&(n=e.equals(t))}}else n=!0;return n}},{key:"_messagesComparator",value:function(e,t){var n=!0;if(e&&t)if(e.length===t.length)for(var r=0,i=0;n&&i<t.length;++i){var a=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var o=e[i],s=t[i],u=0;u<ld.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=ld[u],c=!0;switch(l){case"from":c=this._fromComparator(o[l],s[l]);break;case"to":c=this._toComparator(o[l],s[l]);break;case"resources":case"listUnsubscribe":c=this._shallowObjComparator(o[l],s[l]);break;case"labelIds":c=s[l].equals(o[l]);break;case"date":case"internalDate":c=this._dateComparator(o[l],s[l]);break;default:c=o[l]===s[l]}c||(n=!1)}}else n=!1;else n=!1;return n}},{key:"_shallowObjComparator",value:function(e,t){var n=!1;if(e||t){if(e&&t)if(e===t)n=!0;else for(var r in n=!0,e)if(!t.hasOwnProperty(r)){n=!1;break}}else n=!0;return n}},{key:"onPaneActivated",value:function(e){this._offlineLoad(),e&&e()}},{key:"_offlineLoad",value:function(){var e=this,t=0;if(this._isOfflineLoaded)return!0;if(!v.default.isDemoMode()){var n=this._threadCache.getMetadata(td);n&&Object.keys(n).forEach((function(t){return e.setAccountSetting(t,"sendAs",n[t])}))}var r=this._threadCache.getMetadata(ed),i=this.getSyncAccounts();!v.default.isDemoMode()&&r||(r={}),r.me&&!r[this.getDefaultAccount()]&&(r[this.getDefaultAccount()]=r.me),Xh.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<i.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=i[a];this._ensureLabel(o,wc.INBOX,"Inbox",void 0,void 0,y.a.ChangeType.Local),this._ensureLabel(o,wc.UNREAD,"Unread",void 0,void 0,y.a.ChangeType.Local),this._ensureLabel(o,ad,"Archived",void 0,void 0,y.a.ChangeType.Local),this._ensureLabel(o,od,"All Mail",void 0,void 0,y.a.ChangeType.Local);var s=r[o];if(s){for(var u in s)if(s.hasOwnProperty(u)){var l=s[u];if(!wc[l.id]){var c=l.name||"LocalLabel"+Date.now();v.default.isString(l.oldestSync)&&(l.oldestSync=new Date(l.oldestSync)),this._ensureLabel(o,u,c,l.oldestSync,l,y.a.ChangeType.Local)}}for(var d in wc)if(wc.hasOwnProperty(d)){var h=id[d];this._ensureLabel(o,d,h,void 0,void 0,y.a.ChangeType.Local)}}this._ensureLabelVMLIsForAccount(o)}var f=+this._getMetadataSyncTime(),p=+this._getUnreadSyncTime(),g=this._threadCache.getPreloadData();if(g){v.default.isArray(g)&&(g=v.default.arrayToObjectById(g));try{v.default.PAssert(1194,v.default.isObject(g),"Thread preload is not object")}catch(_){v.default.reportError(_)}this._isLoadingLocal=!0;var m=[];Object.keys(g).forEach((function(t){var n=g[t];try{v.default.PAssert(1195,n,"Must always contain a valid entry when retreiving data from preload")}catch(_){v.default.reportError(_)}if(n&&(e.ensureThreadDates(n),function(t){var n=e.getEntryDateAsNumber(t.date);return i.indexOf(t.accountID)>=0&&n>p}(n))){var r=e.createEntryFromLocal(n.id,n);(e.isPriorityData(r)||+n.date>f)&&(e.cacheData(r.id,r)&&m.push(r),e._updateSpecialLabels(r))}})),this._isLoadingLocal=!1,this._isOfflineLoaded=!0,v.default.scheduleIdleTask((function(){var t=0;Go.a.beginBatch();for(var n=0;n<m.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e._checkUnsyncdMessageContent(m[n])}Go.a.commitBatch()}))}return Xh.PaneUpdateBatcher.commitUpdateItems(),this.notifyPanesReadyForLoad(),!0}},{key:"isPriorityData",value:function(e){var t=!1;return(e.labelIds.indexOf(wc.UNREAD)>=0||e.labelIds.indexOf(sd.PRI0)>=0||e.labelIds.indexOf(sd.PRI1)>=0||e.labelIds.indexOf(sd.PRI2)>=0)&&(t=!0),t}},{key:"_load",value:function(){v.default.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:v.default.minutes(15),minDelay:v.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:v.default.minutes(2),task:this.runThreadSync}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:v.default.minutes(30),minDelay:v.default.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync})}},{key:"_notifyFailedRequest",value:function(e,t){try{v.default.PAssert(1196,v.default.isString(e),"Must supply a valid accountID string")}catch(u){v.default.reportError(u)}if(t&&t.error)if(t.error.code===y.a.HTTPStatusCode.Unauthorized)Xh.pluginManager.verifyAuthorization(e);else if(t.error.code===y.a.HTTPStatusCode.BadRequest)for(var n=0,r=t.error.errors,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i].reason===y.a.GoogleError.FailedPrecondition&&(Xh.toasts.pushMessage(y.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else if(t.error.code===y.a.HTTPStatusCode.Forbidden)for(var a=0,o=t.error.errors,s=0;s<o.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;o[s].reason===y.a.GoogleError.InsufficientPermissions&&(Xh.toasts.pushMessage(y.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else t.error.code>=400&&t.error.code<500&&this._reportErrorCode(t.error.code)&&v.default.reportError(new Error("Failed Gmail request: "+t.error.code),t)}},{key:"_reportErrorCode",value:function(e){var t=!1;return e!==y.a.HTTPStatusCode.NotFound&&(t=!0),t}},{key:"_notifySendFailed",value:function(){Xh.toasts.pushMessage(y.a.MessageID.EmailSendFail)}},{key:"_createResourceCID",value:function(e,t){var n=0;t||(t="UnnamedFile");for(var r=t,i=1;e[r];){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=t.split(".");r=a[0]+"_"+i,a[1]&&(r+="."+a[1]),i++}return r}},{key:"_createResource",value:function(e,t){try{v.default.PAssert(1197,e,"Must have valid resources lib to add to")}catch(n){v.default.reportError(n)}return{cid:this._createResourceCID(e,t.name),id:v.default.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:rd.Attachment,parentType:fd,mimeType:t.type,contentEncoding:void 0}}},{key:"_getLinkedResourceString",value:function(e){return'<a cid="'+e.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+e.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+e.cid+"</a>"}},{key:"_removeAttachContent",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){var i,a;return jo.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return i=!1,e.next=3,fs.removeElementsByAttribute(n.decoded,"cid",r.cid);case 3:return a=e.sent,i=a!==n.decoded,n.decoded=a,e.abrupt("return",i);case 7:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"notifyAttachLinkedFile",value:function(e,t,n,r){var i={name:n.getField("title"),type:n.getField("mimeType")},a=this._createResource(t.resources,i);a.size=n.getField("fileSize"),a.link=n.getField("alternateLink"),this._shareAttachment(e,n.id,a,r),t.resources[a.cid]=a,e.notifyDataMutated(["hasAttachments"],y.a.ChangeType.Local)}},{key:"notifyAttachFiles",value:function(e,t,n,r){for(var i=0,a=this,o=e.getField("accountID"),s=0;s<n.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=n[s],l=this._createResource(t.resources,u);l.size=u.size,l.uploader=new nl.a(u,o,{named:y.a.DriveFolder.Attach},void 0,(function(){e.notifyDataMutated(["hasAttachments"],y.a.ChangeType.Local)}),function(t,n){t.error=!1,t.link=n.alternateLink,t.thumbnail=n.thumbnailLink,a._shareAttachment(e,n.id,t,r)}.bind(this,l),function(t){t.error=!0,Xh.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:function(){t.uploader.resume()}}),e.notifyDataMutated(["hasAttachments"],y.a.ChangeType.Local),r&&r(!1)}.bind(this,l)),l.uploader.upload(),t.resources[l.cid]=l}e.notifyDataMutated(["messages"],y.a.ChangeType.Local)}},{key:"_shareAttachment",value:function(e,t,n,r){var i=this;try{v.default.PAssert(1198,t,"Must supply a valid fileID to share")}catch(o){v.default.reportError(o)}try{v.default.PAssert(1199,n,"Must supply a valid resource object to share")}catch(o){v.default.reportError(o)}var a=e.getField("accountID");Xh.remoteAPI().drivePermissionsPublic(a,t,(function(){n.error=!1,e.notifyDataMutated(["messages"],y.a.ChangeType.Local),r&&r(!0)}),(function(a){n.error=!0,v.default.isHTTPStatusCode(a,y.a.HTTPStatusCode.Forbidden)?Xh.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):Xh.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:function(){i._shareAttachment(e,t,n,r)}}),e.notifyDataMutated(["hasAttachments"],y.a.ChangeType.Local),r&&r(!1)}))}},{key:"removeAttachFiles",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){var i;return jo.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:try{v.default.PAssert(1200,r,"Must always specify a valid resource to remove from the message")}catch(o){v.default.reportError(o)}return i=!1,r.uploader&&!r.uploader.isDone()&&(r.uploader.cancel(),i=!0),n.resources[r.cid]&&delete n.resources[r.cid],e.next=6,this._removeAttachContent(t,n,r);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=i;case 9:return i=e.t0,t.notifyDataMutated(["messages"],y.a.ChangeType.Local),e.abrupt("return",i);case 12:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"notifyItemPropertyChanged",value:function(e,t,n,r){var i=e.getField("accountID");if(this.hasSyncAccount(i)){var a=this.attachmentIsArchived(e);if(t.belongsToItemStore(this.getDefaultItemStore()))t.dateCompleted&&!a&&this.archiveAttachment(e);if("priority"===r)this.getAttachmentPriority(e)!==t.getPriority()&&this.setAttachmentPriority(e,t.getPriority());else"isArchived"===r&&(a&&!t.isArchived()?this.unarchiveAttachment(e):!a&&t.isArchived()&&(this.archiveAttachment(e),Xh.EmailPreview.isOpenOnThread(e)&&Xh.EmailPreview.reset()))}}},{key:"createLabelString",value:function(e){if(!id[e.toUpperCase()])return e}},{key:"isDisplayTag",value:function(e,t){var n=!1;if(e&&e.shouldDisplayInMessageList()){var r=e.isCustom()||e.getLabelID()===wc.DRAFT,i=t&&!t.isInbox()&&e.isInbox();if(r||i)switch(n=!0,e.getName()){case sd.PRI0:case sd.PRI1:case sd.PRI2:case ud:case id.STARRED:n=!1}}return n}},{key:"isDisplayHeader",value:function(e){var t=!1;this.isLabelItem(e)&&(this._getLabelIDFromItem(e)!==wc.UNREAD&&(t=!0));return t}},{key:"isMessageDraft",value:function(e){return e&&e.labelIds&&e.labelIds.indexOf(wc.DRAFT)>=0}},{key:"getDisplayTags",value:function(e,t,n){var r,i=0,a=e.getField("labelIds"),o=e.getField("accountID"),s=[];t&&(r=t.getItemLabel(!0));for(var u=0;u<a.length;++u){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=this._getLabelByID(o,a[u]);if(l&&this.isDisplayTag(l,r)){var c=n?l.getOutlineText():l.getDisplayText();c&&s.push(c)}}return s}},{key:"_getParticipantDisplayName",value:function(e,t){var n;if(this.isMyAccountID(e.email))n="me";else if(e.text)if(1===t)n=e.text;else{var r=e.text.split(" ");n=r&&r.length>0?r[0]:e.email}else n=e.email;return n}},{key:"getDisplayParticipants",value:function(e){for(var t=0,n=e.getField("participants"),r=[],i=0;i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r.push(this._getParticipantDisplayName(n[i],n.length))}return r.join(", ")}},{key:"getDefaultDisplayItem",value:function(e){e=e||this.getDefaultAccount(!0);try{v.default.PAssert(1201,e,"Should not be getting default display item without accountID")}catch(n){v.default.reportError(n)}if(e){var t=this._getLabelByID(e,wc.INBOX);return t&&this.getVMLIForLabel(e,t)}return this.tempRootVMLI}},{key:"getEmailRootItem",value:function(){return tc.getItems(y.a.FavoriteGroup.EmailRoot)[0]}},{key:"hasEmailRootItem",value:function(){return tc.hasItems(y.a.FavoriteGroup.EmailRoot)}},{key:"createEmailRootItem",value:function(){try{v.default.PAssert(1202,!this.hasEmailRootItem(),"Should not create email root if it already exists")}catch(n){v.default.reportError(n)}var e=Xh.itemStoreManager.getDefaultItemStore().getRoot(),t=N.a.createVMLI({text:"Email"},{parent:e,changeType:y.a.ChangeType.AllLocal,documentOwner:void 0});return e.insertItem(t,0),Xh.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:y.a.MessageAction.Okay,hold:!0}),t}},{key:"ensureEmailItem",value:function(e){var t=0;this.hasEmailRootItem()||this.createEmailRootItem();for(var n,r=this.getEmailRootItem(),i=r.getItems(),a=0;a<i.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(i[a].getRawText()===e){n=i[a];break}}return n||(n=N.a.createVMLI({text:e},{parent:r,changeType:y.a.ChangeType.AllLocal,documentOwner:void 0}),r.insertItem(n,0)),n}},{key:"getWaitingItem",value:function(e){e(this.ensureEmailItem("Waiting"))}},{key:"allowTextEditing",value:function(e){var t=!0,n=this.getDefaultItemStore();return e.belongsToItemStore(n)&&(t=!1),t}},{key:"getDraftForMessage",value:function(e,t,n,r){try{v.default.PAssert(1203,t,"Must have a valid thread ID")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1204,n,"Must have a valid message ID")}catch(u){v.default.reportError(u)}var i,a=this.getAttachment(t).getField("messages"),o=a.indexOfWithProperty("id",n);try{v.default.PAssert(1205,o>=0,"Must be able to find the requested message")}catch(u){v.default.reportError(u)}var s=a[o+1];s&&s.labelIds.indexOf(wc.DRAFT)>=0?i=s:(this.createDraft(e,t,n,{from:r}),i=a[o+1]);try{v.default.PAssert(1206,i.labelIds.indexOf(wc.DRAFT)>=0,"Must return a valid draft")}catch(u){v.default.reportError(u)}return i}},{key:"getDraftByID",value:function(e,t,n,r){var i,a;if(t){var o=(i=this.getAttachment(t)).getField("messages");a=n?this._getMessageFromAttachment(i,n):o[0];try{v.default.PAssert(1207,a.labelIds.indexOf(wc.DRAFT)>=0,"Must be a valid draft")}catch(u){v.default.reportError(u)}}else{var s=this.createDraft(e,void 0,void 0,r);a=(i=this.getAttachment(s.threadID)).getField("messages")[0]}return{attach:i,draftMsg:a}}},{key:"_notifyDraftMessage",value:function(e,t,n){var r=this;try{v.default.PAssert(1208,e,"Must supply a valid accountID")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1209,t&&!v.default.isTempId(t),"Must supply a valid threadID: ",t)}catch(i){v.default.reportError(i)}try{v.default.PAssert(1210,n&&!v.default.isTempId(n),"Must supply a valid messageID: ",n)}catch(i){v.default.reportError(i)}setTimeout((function(){r.hasCacheData(t)&&r._getRemoteDraftID(e,t,n,(function(e,n){n&&(v.default.log("DraftID: ",e),r.cacheData(t,r.getCacheData(t),!0,["messages"]))}))}),0)}},{key:"_getInlineResources",value:function(e){var t={};return v.default.forEachValue(e.resources,(function(e){e.disposition===rd.Inline&&(t[e.cid]=Object.assign({},e))})),t}},{key:"createDraft",value:function(e,t,n,r){r=r||{};try{v.default.PAssert(1211,!r.body||!r.decoded,"Must not supply both a decoded field and a body")}catch(f){v.default.reportError(f)}this.sendEvent("CreateDraft");var i=v.default.generateTempId(),a=r.from||this.getDefaultFromInfo(e),o=r.body||r.decoded||"";""===o&&(o=this.createSignature(a.email));var s,u,l={id:i,modifiedOffline:!0,labelIds:[wc.DRAFT],messageID:void 0,raw:"",decoded:o,mimeType:kd,contentType:Id,from:a,replyTo:this.getReplyToAddress(a.email),to:r.to||[],cc:r.cc||[],bcc:r.bcc||[],snippet:"",subject:r.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:{}};if(t){s=this.getCacheData(t);try{v.default.PAssert(1212,n,"When supplying a thread ID, must also supply a valid message ID")}catch(f){v.default.reportError(f)}var c=s.messages.indexOfWithProperty("id",n);try{v.default.PAssert(1213,c>=0,"If requesting a reply to a message, it must exist in the thread")}catch(f){v.default.reportError(f)}var d=s.messages[c];if(d&&(l.references=(v.default.isTempId(d.messageID)?"":d.messageID)+(d.references?" "+d.references:""),v.default.isTempId(d.messageID)||(l.inReplyTo=d.messageID),l.resources=this._getInlineResources(d)),s.messages.splice(c+1,0,l),this.hasAttachment(t)){var h=this.getAttachment(t);this._updateAttachmentFromMessages(h,y.a.ChangeType.Local),h.notifyDataMutated(["messages"],y.a.ChangeType.Local)}this.addModifiedOffline(s,["messages"]),u=s}else s={id:i,accountID:e,modifiedOffline:!0,messages:[l],labelIds:[wc.DRAFT],subject:r.subject||"",from:e},u=this.createEntryFromLocal(i,s),this.cacheData(u.id,u);return this.cacheThreadData(u.id,this.serializeExternalData(u)),{threadID:u.id,draftID:i,messageID:n}}},{key:"_updateDraftID",value:function(e,t,n){try{v.default.PAssert(1214,n,"Must provide a valid set of draft info")}catch(a){v.default.reportError(a)}try{v.default.PAssert(1215,n.id&&n.message,"Draft info must contain valid data")}catch(a){v.default.reportError(a)}var r=e.isLocalOnlyAttachment();r&&(this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,n.message.threadId),this._threadCache.removeEntry(t));var i=this._findDraft(e,t,n.id);if(i){i.id=n.message.id;try{v.default.PAssert(1216,i.draftID===n.id,"Should have valid draft ID associated with the message")}catch(a){v.default.reportError(a)}this._draftCache[i.id]=n.id,r&&this.cacheData(e.id,e.getData()),this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[i.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[i.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],y.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}}},{key:"_updateDraftFromSend",value:function(e,t,n){try{v.default.PAssert(1217,n,"Must provide a valid set of draft info")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1218,n.id&&n.threadId,"Draft info must contain valid data")}catch(i){v.default.reportError(i)}if(e.isLocalOnlyAttachment()){this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,n.threadId);try{v.default.PAssert(1219,!v.default.isTempId(e.id),"After an ID change, should never be a temp ID")}catch(i){v.default.reportError(i)}this._threadCache.removeEntry(t)}var r=this._getMessageFromAttachment(e,t);r.id=n.id,r.labelIds=n.labelIds||[],this._updateAttachmentFromMessages(e,y.a.ChangeType.Remote),this._draftCache[r.id]=n.id,this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[r.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[r.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],y.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}},{key:"_createRemoteDraft",value:function(e,t,n){var r=this;if(this._creatingDrafts[t])n(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[t]=!0;var i=this._getMessageFromAttachment(e,t);if(i)this._createRFC822Message(e.getData(),i,!1,(function(a){var o={raw:a};e.isLocalOnlyAttachment()||(o.threadId=e.id);var s=Du.a.fns("gmail").users.drafts.create.packedFn,u={userId:e.getField("accountID"),resource:{message:o}};r._queueRemoteRequestMulti(e.getField("accountID"),s,u,(function(a){r._attachmentHasMessage(e,t)&&(delete r._creatingDrafts[t],i.draftID=a.id,r.removeModifiedOffline(e.getData(),!1),r.removeModifiedOffline(i,!1),r._pendingDraftUpdates[t]&&r._notifyPendingDraftUpdate(),r._updateDraftID(e,t,a),r._updateIsSavingDrafts()),n(!0)}),(function(i){delete r._creatingDrafts[t],r._updateIsSavingDrafts(),n(!1,i),r._notifyFailedRequest(e.getField("accountID"),i)}),void 0,zc,{noBatch:!0})}));else{try{var a={length:e.getField("messages").length};v.default.reportError(new Error("Unable to find valid draft for creation"),a)}catch(o){v.default.reportError(o)}n(!1,{msg:"Unable to find requested message in thread"})}}}},{key:"_updateIsSavingDrafts",value:function(){v.default.isSavingDrafts=this._activeDraftUpdates>0||!v.default.isEmpty(this._pendingDraftUpdates)||!v.default.isEmpty(this._creatingDrafts)}},{key:"_notifyPendingDraftUpdate",value:function(e,t,n,r){e&&t&&(this._pendingDraftUpdates[t]={attach:e,draftID:n,lastUpdate:Date.now()},r&&this._runDraftUpdate(t)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()}},{key:"_flushPendingDraftUpdates",value:function(){if(this.isOnline()){for(var e in this._pendingDraftUpdates)this._pendingDraftUpdates.hasOwnProperty(e)&&this._runDraftUpdate(e);this._draftFlushTimer=void 0}}},{key:"_runDraftUpdate",value:function(e){var t=this;if(!this._creatingDrafts[e]){var n=this._pendingDraftUpdates[e];try{v.default.PAssert(1220,n,"Must be able to find valid draft info for pending draft update")}catch(r){v.default.reportError(r)}this._updateRemoteDraft(n.attach,e,n.draftID,!1,(function(e,n){e||v.default.isHTTPStatusCode(n,y.a.HTTPStatusCode.NotFound)?Xh.toasts.clearMessage(y.a.MessageID.EmailUpdateFail):Xh.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),t._updateIsSavingDrafts()})),delete this._pendingDraftUpdates[e],this.sendEvent("UpdateDraft")}}},{key:"_clearPendingDraftUpdate",value:function(e,t){var n=this._pendingDraftUpdates[t];if(n){try{v.default.PAssert(1221,n.attach===e,"Must have the correct attachment for the draft update")}catch(r){v.default.reportError(r)}delete this._pendingDraftUpdates[t]}}},{key:"hasPendingSends",value:function(){return Object.keys(this._pendingSends).length>0}},{key:"notifyPendingSend",value:function(e,t){try{v.default.PAssert(1222,!this._pendingSends[t],"Must not have an already pending send for a message")}catch(n){v.default.reportError(n)}this._pendingSends[t]=e,v.default.isSendingEmail=!0}},{key:"notifySent",value:function(e,t){try{v.default.PAssert(1223,this._pendingSends[t],"Must have a pending send to be sent")}catch(n){v.default.reportError(n)}delete this._pendingSends[t],this.hasPendingSends()||(v.default.isSendingEmail=!1)}},{key:"notifySendError",value:function(e,t){try{v.default.PAssert(1224,this._pendingSends[t],"Must have a pending send to have an error")}catch(n){v.default.reportError(n)}delete this._pendingSends[t],this.hasPendingSends()||(v.default.isSendingEmail=!1)}},{key:"onShutdown",value:function(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()}},{key:"_getLinkedResources",value:function(e){var t=[];return v.default.forEachValue(e,(function(e){"attachment"===e.disposition&&e.link&&t.push(e)})),t}},{key:"_createDraftBody",value:function(e,t){var n;if(t){var r=this._getLinkedResources(t);if(r.length>0){for(var i=0,a="<br/><br/>",o=0;o<r.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a+=this._getLinkedResourceString(r[o])}n=e+'<var id="moodoAttach" moodoAttach="true">'+a+"</var>"}else n=e}else n=e;return n}},{key:"updateDraft",value:function(e,t,n,r,i,a,o){try{v.default.PAssert(1225,v.default.isBoolean(i),"Must supply a valid bool for updateRemoteDraft")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1226,v.default.isBoolean(a),"Must supply a valid bool for forceFlush")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1227,v.default.isFunction(o),"Must supply a valid bool for cb")}catch(u){v.default.reportError(u)}var s=this._findDraft(e,t,n);if(s)return s.to=r.to,s.from=r.from||s.from,s.cc=r.cc,s.bcc=r.bcc,s.subject=r.subject,s.decoded=this._createDraftBody(r.decoded,s.resources),s.snippet=r.snippet?v.default.escape(r.snippet.substring(0,60)):"",s.modifiedOffline=!0,r.hasOwnProperty("resources")&&(s.resources=r.resources),this._updateAttachmentFromMessages(e,y.a.ChangeType.Local),e.notifyDataMutated(["messages"],y.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(this.getCacheData(e.id))),!this._creatingDrafts[s.id]&&i?v.default.isTempId(s.id)?this._createRemoteDraft(e,s.id,(function(e,t){e||Xh.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),o(e,t)})):(this._notifyPendingDraftUpdate(e,s.id,s.draftID,a),o(!0)):(i&&this._notifyPendingDraftUpdate(e,s.id,s.draftID,a),o(!0)),this._updateIsSavingDrafts(),{threadID:e.id,draftID:s.draftID,messageID:s.id};try{v.default.PAssert(1228,!1,"Unable to update draft as expected from compose window")}catch(u){v.default.reportError(u)}o(!1)}},{key:"_updateRemoteDraft",value:function(e,t,n,r,i){var a=this;try{v.default.PAssert(1229,t&&n,"Must specify both a valid messageID and draftID"+t+"."+n)}catch(s){v.default.reportError(s)}var o=this._findDraft(e,t,n);try{v.default.PAssert(1230,o&&o.labelIds.indexOf(wc.DRAFT)>=0,"Must be updating a valid draft"+!!o)}catch(s){v.default.reportError(s)}try{v.default.PAssert(1231,!this._creatingDrafts[o.id],"Should not send a remote update while the original draft is being created")}catch(s){v.default.reportError(s)}this._activeDraftUpdates++,this._getRemoteDraftID(e.getField("accountID"),e.id,o.id,(function(t){if(t)a._createRFC822Message(e.getData(),o,r,(function(n){var r=Du.a.fns("gmail").users.drafts.update.packedFn,s={userId:e.getField("accountID"),id:t,resource:{message:{raw:n,threadId:e.id}}};a._queueRemoteRequestMulti(e.getField("accountID"),r,s,(function(t){a._updateDraftID(e,o.id,t),a._activeDraftUpdates--,i(t)}),(function(t){i(void 0,t),a._activeDraftUpdates--,a._notifyFailedRequest(e.getField("accountID"),t)}),void 0,Gc)}));else{try{v.default.PAssert(1232,!1,"Must always be able to get a valid draft ID when updating")}catch(s){v.default.reportError(s)}i(!1)}}))}},{key:"sendDraft",value:function(e,t,n,r,i){var a=this;try{v.default.PAssert(1233,!e.getField("pendingSend"),"Should not try to re-send a message after it has already been sent")}catch(h){v.default.reportError(h)}var o=!0,s=this._findDraft(e,t,n),u=function(t,n){t?(e.updateField("pendingSend",!1),a.removeModifiedOffline(e.getData(),!1),a.removeModifiedOffline(s,!1),a.notifySent(e,s.id)):(v.default.isHTTPStatusCode(n,y.a.HTTPStatusCode.Network)||e.updateField("pendingSend",!1),a.notifySendError(e,s.id)),i(t,n)},l=this._verifyEmailRecipients(e,s.id,s.draftID);if(l||(l=this._verifyEmailAttachments(e,s.id,s.draftID)),l){o=!1;var c=Xh.toasts.pushMessage({text:l.message,action:y.a.MessageAction.Okay});l.handleMessageFn&&l.handleMessageFn(c),this.notifyPendingSend(e,s.id),u(!1)}else if(!r){e.updateField("pendingSend",!0),this.notifyPendingSend(e,s.id);var d=!1;this.onEmailReadyToSend(s,(function(){try{v.default.PAssert(1234,!d,"Should not send an email twice")}catch(h){v.default.reportError(h)}d||(d=!0,e.isLocalOnlyAttachment()||v.default.isTempId(s.id)?a._sendEmail(e,s.id,s.draftID,u):a._sendRemoteDraft(e,s.id,u))}))}return o}},{key:"onEmailReadyToSend",value:function(e,t){var n=this,r=!0;v.default.forEachValue(e.resources,(function(i){if(i.uploader&&!i.uploader.isDone())if(r=!1,i.uploader.hasError())try{v.default.PAssert(1235,!1,"Attachment has error when sending.")}catch(a){v.default.reportError(a)}else i.uploader.notifyOnComplete(n.onEmailReadyToSend.bind(n,e,t))})),r&&setTimeout(t,0)}},{key:"_sendRemoteDraft",value:function(e,t,n){var r=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t),this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(i){if(i)r._updateRemoteDraft(e,t,i,!0,(function(t){if(t&&t.message){var a=Du.a.fns("gmail").users.drafts.send.packedFn,o={userId:e.getField("accountID"),resource:{id:i}};r._queueRemoteRequestMulti(e.getField("accountID"),a,o,(function(i){r._updateLocalDraftFromSend(e,t.message.id,i,n)}),(function(t){r._notifySendFailed(),n(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)}),void 0,Yc)}else Xh.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),n(!1)}));else{try{v.default.PAssert(1236,!1,"Must always be able to get a valid draft ID when sending")}catch(a){v.default.reportError(a)}Xh.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),n(!1)}}))}},{key:"_updateLocalDraftFromSend",value:function(e,t,n,r){try{v.default.PAssert(1237,n,"Must have a valid draft result")}catch(a){v.default.reportError(a)}var i=this._getMessageFromAttachment(e,t);try{v.default.PAssert(1238,i,"Must always be able to find the sent message")}catch(a){v.default.reportError(a)}i&&(this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(i,!1),this._updateDraftFromSend(e,t,n)),v.default.isDemoMode()||this._requestRemoteMessageData(e,n.id,(function(e){try{v.default.PAssert(1239,e,"Should always be able to update message data after send")}catch(a){v.default.reportError(a)}})),r(!0)}},{key:"runDiscardDraft",value:function(e){var t=this._getDraftFromAttachment(e);this.discardDraft(e,t.id,t.draftID,(function(e){try{v.default.PAssert(1240,e,"Must be able to discard message draft")}catch(t){v.default.reportError(t)}}))}},{key:"discardDraft",value:function(e,t,n,r){var i=e.getData(),a=this._findDraft(e,t,n),o=i.messages.indexOf(a);v.default.isTempId(t)?r(!0):this._deleteRemoteDraft(e,t,r);var s=i.messages[o];i.messages.splice(o,1),this._removeRemoteResources(s),this._updateAttachmentFromMessages(e,y.a.ChangeType.Local),this._clearPendingDraftUpdate(e,t),e.notifyDataMutated(["messages"],y.a.ChangeType.Local),this.cacheThreadData(i.id,this.serializeExternalData(i)),this.sendEvent("DiscardDraft")}},{key:"_removeRemoteResources",value:function(e){e&&v.default.forEachValue(e.resources,(function(e){e.uploader&&!e.uploader.isDone()&&e.uploader.cancel()}))}},{key:"_deleteRemoteDraft",value:function(e,t,n){var r=this;try{v.default.PAssert(1241,!v.default.isTempId(t),"Should not try to remotely delete a local message")}catch(i){v.default.reportError(i)}this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(t){if(t){var a=Du.a.fns("gmail").users.drafts.delete.packedFn,o={userId:e.getField("accountID"),id:t};r._queueRemoteRequestMulti(e.getField("accountID"),a,o,(function(){n(!0)}),(function(t){v.default.isHTTPStatusCode(t,y.a.HTTPStatusCode.NotFound)?n(!0):n(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)}),void 0,Kc)}else{try{v.default.PAssert(1242,!1,"Must always be able to get a valid draft ID when deleting")}catch(i){v.default.reportError(i)}Xh.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),n(!1)}}))}},{key:"_getRemoteDraftIDRaw",value:function(e,t,n,r){var i=Du.a.fns("gmail").users.drafts.list.packedFn,a={userId:e,q:"rfc822msgid:"+t};this._queuePagedRemoteRequestMulti(e,i,a,n,r,void 0,Qc,{getAllPages:!0,resultsField:"drafts"})}},{key:"_getRemoteDraftID",value:function(e,t,n,r){var i=this;try{v.default.PAssert(1243,v.default.isString(e),"Must provide a valid accountID")}catch(s){v.default.reportError(s)}try{v.default.PAssert(1244,v.default.isString(t)&&!v.default.isTempId(t),"Should not try to remotely get the draft ID of a local thread: ",t)}catch(s){v.default.reportError(s)}try{v.default.PAssert(1245,v.default.isString(n)&&!v.default.isTempId(n),"Should not try to remotely get the draft ID of a local draft: ",n)}catch(s){v.default.reportError(s)}var a=this.getAttachment(t);try{v.default.PAssert(1246,a,"Must be able to find a valid attachment for the requested thread")}catch(s){v.default.reportError(s)}if(!a)return setTimeout(r,0,void 0,!1);var o=this._getMessageFromAttachment(a,n);try{v.default.PAssert(1247,o,"Must be able to find a valid message for the requested draft")}catch(s){v.default.reportError(s)}if(!o)return setTimeout(r,0,void 0,!1);if(o.draftID)setTimeout(r,0,o.draftID,!1);else{try{v.default.PAssert(1248,o.messageID&&!v.default.isTempId(o.messageID),"Must have a valid messageID for the draft being queried")}catch(s){v.default.reportError(s)}if(!o.messageID||v.default.isTempId(o.messageID))return setTimeout(r,0,void 0,!1);this._getRemoteDraftIDRaw(e,o.messageID,(function(u){try{v.default.PAssert(1249,u&&u.length<=1,"Must find only a single draft ID for a given message: ",u.length,o.messageID)}catch(s){v.default.reportError(s)}if(u){for(var l=0,c=0;c<u.length;++c){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=u[c];if(1===u.length||d.message.threadId===t){try{v.default.PAssert(1250,!o.draftID||o.draftID===d.id,"Draft ID must either match or not be known yet")}catch(s){v.default.reportError(s)}o.draftID=d.id}}try{v.default.PAssert(1251,0===u.length||o.draftID,"Draft returned but IDs dont match: ",u[0]?u[0].message.threadId:"NO RESULT",t,u[0]?u[0].message.id:"NO RESULT",n)}catch(s){v.default.reportError(s)}}return o.draftID?r(o.draftID,!0):o.contentType&&o.mimeType&&o.decoded?void i._createRemoteDraft(a,o.id,(function(n,a){return n?r(o.draftID,!0):(v.default.isHTTPStatusCode(a,y.a.HTTPStatusCode.NotFound)&&i._deleteCachedThread(e,t),r(void 0,!1))})):r(void 0,!1)}),(function(t){return i._notifyFailedRequest(e,t),r(void 0,!1)}))}}},{key:"_attachmentHasMessage",value:function(e,t){return e.getField("messages").indexOfWithProperty("id",t)>=0}},{key:"_getMessageFromAttachment",value:function(e,t){var n=e.getField("messages"),r=n.indexOfWithProperty("id",t);try{v.default.PAssert(1252,r>=0,"Must have a vald draft")}catch(i){v.default.reportError(i)}return n[r]}},{key:"_getDraftFromAttachment",value:function(e,t){for(var n,r=0,i=e.getField("messages"),a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i[a].labelIds.indexOf(wc.DRAFT)>=0){t&&t!==i[a].draftID||(n=i[a]);break}}return n}},{key:"_findDraft",value:function(e,t,n){var r,i=e.getField("messages"),a=i.indexOfWithProperty("id",t);if(a>=0)r=i[a];else if(n){var o=i.indexOfWithProperty("draftID",n);o>=0&&(r=i[o])}try{v.default.PAssert(1253,r,"Must be able to find a valid draft for given messageID/draftID")}catch(s){v.default.reportError(s)}return r}},{key:"isAttachmentDraftOnly",value:function(e){return!this.shouldUseNewPlugin(e)&&this.attachmentHasLabel(e,id.DRAFT)&&1===e.getField("messages").length}},{key:"archiveAttachment",value:function(e){try{v.default.PAssert(1254,!this.attachmentIsArchived(e),"Should not archive a thread that is already archived")}catch(t){v.default.reportError(t)}return this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(e,id.INBOX)}},{key:"unarchiveAttachment",value:function(e){try{v.default.PAssert(1255,this.attachmentIsArchived(e),"Thread must be unarchived to archive it")}catch(t){v.default.reportError(t)}return this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(e,id.INBOX)}},{key:"trashAttachment",value:function(e){return this.sendEvent("TrashMail"),this.trashMail(e.getField("accountID"),e.id,void 0,(function(e){try{v.default.PAssert(1256,e,"Must have successfully trashed remote thread")}catch(t){v.default.reportError(t)}}))}},{key:"untrashAttachment",value:function(e){return this.sendEvent("UntrashMail"),this.untrashMail(e.getField("accountID"),e.id,void 0,(function(e){try{v.default.PAssert(1257,e,"Must have successfully untrashed remote thread")}catch(t){v.default.reportError(t)}}))}},{key:"markAttachmentRead",value:function(e){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(e,id.UNREAD)}},{key:"markAttachmentUnread",value:function(e){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(e,id.UNREAD)}},{key:"snoozeAttachment",value:function(e,t){}},{key:"unsnoozeAttachment",value:function(e){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(e,"Moo.do/Snoozed"),this.addLabelToAttachment(e,id.INBOX),this.addLabelToAttachment(e,id.UNREAD),this.cancelDeferredTask(e.id,Ac)}},{key:"_handleDeferredSnoozeTask",value:function(e){}},{key:"scheduleSendMessage",value:function(e,t,n){}},{key:"cancelSendMessage",value:function(e,t){var n=this;this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(e,"Moo.do/ScheduledSend"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(e){e&&n.cancelDeferredTask(e,Lc)}))}},{key:"_handleDeferredSendMailTask",value:function(e){var t=e.getData();try{v.default.PAssert(1260,t.gidLinked,"Must have valid gidLinked")}catch(n){v.default.reportError(n)}try{v.default.PAssert(1261,t.threadID,"Must have a valid threadID")}catch(n){v.default.reportError(n)}v.default.log("Handling deferred send mail: ",t)}},{key:"_ensureNoPriority",value:function(e){var t=y.a.VMLIFlag.None;return this.attachmentHasLabel(e,sd.PRI0)&&(this.removeLabelFromAttachment(e,sd.PRI0),t=y.a.VMLIFlag.P0),this.attachmentHasLabel(e,sd.PRI1)&&(this.removeLabelFromAttachment(e,sd.PRI1),t=y.a.VMLIFlag.P1),this.attachmentHasLabel(e,sd.PRI2)&&(this.removeLabelFromAttachment(e,sd.PRI2),t=y.a.VMLIFlag.P2),t}},{key:"getAttachmentPriority",value:function(e){return this._attachmentHasPriorityLabel(e,y.a.VMLIFlag.P0)&&y.a.VMLIFlag.P0||this._attachmentHasPriorityLabel(e,y.a.VMLIFlag.P1)&&y.a.VMLIFlag.P1||this._attachmentHasPriorityLabel(e,y.a.VMLIFlag.P2)&&y.a.VMLIFlag.P2||y.a.VMLIFlag.None}},{key:"setAttachmentPriority",value:function(e,t){this.sendEvent("SetMailPriority");var n=this._ensureNoPriority(e);switch(t){case y.a.VMLIFlag.None:break;case y.a.VMLIFlag.P0:this.addLabelToAttachment(e,sd.PRI0);break;case y.a.VMLIFlag.P1:this.addLabelToAttachment(e,sd.PRI1);break;case y.a.VMLIFlag.P2:this.addLabelToAttachment(e,sd.PRI2);break;default:try{v.default.PAssert(1262,!1,"Invalid priority for email attachment")}catch(r){v.default.reportError(r)}}return n}},{key:"markAttachmentStarred",value:function(e){return this.sendEvent("StarMail"),this.addLabelToAttachment(e,id.STARRED)}},{key:"markAttachmentUnstarred",value:function(e){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(e,id.STARRED)}},{key:"attachmentHasLabelByID",value:function(e,t){return this.hasLabelByID(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasLabel",value:function(e,t){return this.hasLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasFullLabel",value:function(e,t){return this.hasFullLabel(e.getField("accountID"),e.id,t)}},{key:"attachmentIsArchived",value:function(e){return this._threadIsArchived(e.getData())}},{key:"addLabelToAttachment",value:function(e,t){return this.addLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"removeLabelFromAttachment",value:function(e,t){return this.removeLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"trashMail",value:function(e,t,n,r){var i=this.getAttachment(t);if(this.isAttachmentDraftOnly(i)){var a=i.getField("messages")[0];this.discardDraft(i,a.id,a.draftID,r)}else this.removeLabelsFromMessage(e,t,n,[wc.INBOX],y.a.ChangeType.Local),this.addLabelsToMessage(e,t,n,[wc.TRASH],y.a.ChangeType.Local),v.default.isTempId(t)?r(!0):this._trashRemoteMail(e,t,n,r)}},{key:"untrashMail",value:function(e,t,n,r){this.removeLabelsFromMessage(e,t,n,[wc.TRASH],y.a.ChangeType.Local),v.default.isTempId(t)?(this.addLabelsToMessage(e,t,n,[wc.INBOX],y.a.ChangeType.Local),r(!0)):(this.addLabel(e,t,n,id.INBOX),this._untrashRemoteMail(e,t,n,r))}},{key:"moveItem",value:function(e,t,n){return n.insertItem(t,0),[t,n]}},{key:"unmoveItem",value:function(e,t,n){return n.removeChild(t,y.a.ChangeType.Local),[t,n]}},{key:"hasLabelByID",value:function(e,t,n,r){try{v.default.PAssert(1263,!n,"We don't support individual queries on messages, only threads")}catch(i){v.default.reportError(i)}return this.getAttachment(t).getField("labelIds").indexOf(r)>=0}},{key:"hasLabel",value:function(e,t,n,r){try{v.default.PAssert(1264,!n,"We don't support individual queries on messages, only threads")}catch(o){v.default.reportError(o)}var i=!1;if(!n){var a=this._getLabelByName(e,r,!0);a&&(i=this.hasLabelByID(e,t,n,a.getLabelID()))}return i}},{key:"hasFullLabel",value:function(e,t,n){var r=!1,i=this.getCacheData(t),a=this._getLabelByName(e,n,!0);if(a&&i){var o=0,s=i.messages;r=!0;for(var u=0;u<s.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(!s[u].labelIds||s[u].labelIds.indexOf(a.getLabelID())<0){r=!1;break}}}return r}},{key:"hasLabelLike",value:function(e,t,n){var r=!1,i=this.getAttachment(t);if(i){var a=i.getField("labelIds"),o=this._getAccountLib(e,this._labelsByID);if(o)for(var s=0,u=0;u<a.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=o[a[u]];l&&l.isMatched(n)&&(r=!0)}}return r}},{key:"addLabel",value:function(e,t,n,r){var i=this;try{v.default.PAssert(1265,!n,"We currently do not support setting labels on single messages")}catch(s){v.default.reportError(s)}try{v.default.PAssert(1266,!this.hasLabel(e,t,n,r),"Should not add the same label to a thread/message twice")}catch(s){v.default.reportError(s)}var a=this._getLabelByName(e,r,!0);if(a)a.isLocalOnly()?this._createRemoteLabel(e,r,!1,(function(n){if(n){try{v.default.PAssert(1268,n,"Should have successfully created the remote label")}catch(s){v.default.reportError(s)}i._changeLabelID(e,a.getLabelID(),n.id),i._modifyRemoteThreadLabels(e,t,[n.id],void 0)}})):this._modifyRemoteThreadLabels(e,t,[a.getLabelID()],void 0);else{var o=v.default.generateTempId();a=this._ensureLabel(e,o,r,void 0,void 0,y.a.ChangeType.Local),this._ensureVMLIsForLabel(e,a),this._writeLabelsToCache(),this._createRemoteLabel(e,r,!1,(function(n){try{v.default.PAssert(1267,n,"Should have successfully created the remote label")}catch(s){v.default.reportError(s)}n&&(i._changeLabelID(e,o,n.id),i._modifyRemoteThreadLabels(e,t,[n.id],void 0))}))}return this.addLabelsToMessage(e,t,n,[a.getLabelID()],y.a.ChangeType.Local),r}},{key:"removeLabel",value:function(e,t,n,r){try{v.default.PAssert(1269,!n,"We currently do not support setting labels on single messages")}catch(a){v.default.reportError(a)}var i=this._getLabelByName(e,r);try{v.default.PAssert(1270,i,"Must have valid label for gmail in order to remove")}catch(a){v.default.reportError(a)}return i&&(i.isLocalOnly()||this._modifyRemoteThreadLabels(e,t,void 0,[i.getLabelID()]),this.removeLabelsFromMessage(e,t,n,[i.getLabelID()],y.a.ChangeType.Local)),r}},{key:"_threadIsArchived",value:function(e){if(e){var t=e.labelIds.indexOf(wc.INBOX)>=0,n=this.hasFullLabel(e.accountID,e.id,id.TRASH),r=e.labelIds.indexOf(wc.SPAM)>=0,i=this.hasFullLabel(e.accountID,e.id,id.DRAFT);return!v.default.isTempId(e.id)&&!t&&!n&&!r&&!i}return!1}},{key:"_trashRemoteMail",value:function(e,t,n,r){var i,a,o=this;try{v.default.PAssert(1271,!v.default.isTempId(t),"Should not try to trash local only threads")}catch(s){v.default.reportError(s)}try{v.default.PAssert(1272,!n||!v.default.isTempId(n),"Should not try to trash local only messages")}catch(s){v.default.reportError(s)}n?(i=Du.a.fns("gmail").users.messages.trash.packedFn,a={userId:e,id:n}):(i=Du.a.fns("gmail").users.threads.trash.packedFn,a={userId:e,id:t});this._queueRemoteRequestMulti(e,i,a,(function(){r(!0)}),(function(t){r(!1,t),o._notifyFailedRequest(e,t)}),void 0,Wc)}},{key:"_untrashRemoteMail",value:function(e,t,n,r){var i,a,o=this;try{v.default.PAssert(1273,!v.default.isTempId(t),"Should not try to untrash local only threads")}catch(s){v.default.reportError(s)}try{v.default.PAssert(1274,!n||!v.default.isTempId(n),"Should not try to untrash local only messages")}catch(s){v.default.reportError(s)}n?(i=Du.a.fns("gmail").users.messages.untrash.packedFn,a={userId:e,id:n}):(i=Du.a.fns("gmail").users.threads.untrash.packedFn,a={userId:e,id:t});this._queueRemoteRequestMulti(e,i,a,(function(){r(!0)}),(function(t){r(!1,t),o._notifyFailedRequest(e,t)}),void 0,Wc)}},{key:"_createRemoteLabel",value:function(e,t,n,r){var i=this,a=Du.a.fns("gmail").users.labels.create.packedFn,o={userId:e,resource:{name:t,labelListVisibility:n?"labelHide":"labelShowIfUnread",messageListVisibility:n?"hide":"show"}};this._queueRemoteRequestMulti(e,a,o,(function(e){r&&r(e)}),(function(t){v.default.isHTTPStatusCode(t,y.a.HTTPStatusCode.Conflict)?r&&r(void 0,t):(r&&r(void 0,t),i._notifyFailedRequest(e,t))}),void 0,Vc)}},{key:"_modifyRemoteThreadLabels",value:function(e,t,n,r,i){var a=this,o=Du.a.fns("gmail").users.threads.modify.packedFn,s={userId:e,id:t,resource:{addLabelIds:n,removeLabelIds:r}};this._queueRemoteRequestMulti(e,o,s,(function(e){i&&i(e)}),(function(t){i&&i(void 0,t),a._notifyFailedRequest(e,t)}),void 0,Hc)}},{key:"_ensureRemoteLabel",value:function(e,t,n,r,i){this._getLabelByName(e,t,!0)?i&&i(!0):(this._ensureLabel(e,v.default.generateTempId(),t,void 0,void 0,n),this._createRemoteLabel(e,t,r,(function(e,t){try{v.default.PAssert(1275,e||v.default.isHTTPStatusCode(t,y.a.HTTPStatusCode.Conflict),"Should have successful root label creation")}catch(n){v.default.reportError(n)}i&&i(!!e)})))}},{key:"_createInMemoryLabel",value:function(e,t,n,r,i,a){var o=new uc(e,t,n,this._clampSyncTime(r),i,a);a[t]=o,this._ensureAccountLib(e,this._labelsByName)[n]=o}},{key:"_updateLabelName",value:function(e,t){var n=e.getAccountID(),r=this._getAccountLib(n,this._labelsByName);try{v.default.PAssert(1276,r,"Must have valid label name bucket")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1277,r[e.getRawName()],"Must have valid label in bucket")}catch(i){v.default.reportError(i)}e.updateLabelName(t),delete r[e.getRawName()],r[t]=e}},{key:"_ensureLabel",value:function(e,t,n,r,i,a){try{v.default.PAssert(1278,t.length>3,"Label ID should be longer than a couple of chars")}catch(u){v.default.reportError(u)}var o=this._ensureAccountLib(e,this._labelsByID);if(o[t])!v.default.isRemoteChange(a)&&o[t].hasName()||o[t].isSystemLabel()||this._updateLabelName(o[t],n);else{var s=this._getLabelByName(e,n,!0);if((null===s||void 0===s?void 0:s.isLocalOnly())&&!v.default.isTempId(t))this._changeLabelID(e,s.getLabelID(),t);else{try{v.default.PAssert(1280,n||!v.default.isTempId(t),"All local labels must have a valid name")}catch(u){v.default.reportError(u)}this._createInMemoryLabel(e,t,n,r,i,o)}}return o[t]}},{key:"_clampSyncTime",value:function(e){return e&&e.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():e}},{key:"_ensureLabelVMLIsForAccount",value:function(e){var t=this._getAccountLib(e,this._labelsByID);for(var n in t)t.hasOwnProperty(n)&&this._ensureVMLIsForLabel(e,t[n])}},{key:"_changeLabelID",value:function(e,t,n){var r=this._getLabelByID(e,t);Xh.PaneUpdateBatcher.beginUpdateItems(),null===r||void 0===r||r.updateLabelID(n),this._getAccountLib(e,this._labelsByID)[n]=r,this._ensureVMLIsForLabel(e,r),Xh.PaneUpdateBatcher.commitUpdateItems(),this.forEachAttachment((function(e){var r=e.getField("labelIds");if(r.remove(t)>=0){for(var i=0,a=e.getField("messages"),o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a[o].labelIds.remove(t)>=0&&a[o].labelIds.push(n)}r.push(n),e.updateField("labelIds",r)}}));var i=this.getDefaultItemStore(),a="L~"+e+"~"+t;i.hasItem(a)&&i.destroyItem(a)}},{key:"labelExists",value:function(e,t){var n=this._getAccountLib(e,this._labelsByID);return n&&n[t]}},{key:"_getLabelByID",value:function(e,t){try{v.default.PAssert(1281,e,"Must supply a valid accountID")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1282,t,"Must supply a valid labelID")}catch(i){v.default.reportError(i)}var n=this._ensureAccountLib(e,this._labelsByID);if(!n[t]){var r=id[t];r&&this._createInMemoryLabel(e,t,r,void 0,void 0,n)}return n[t]}},{key:"_getLabelByName",value:function(e,t,n){try{v.default.PAssert(1283,this.hasSyncAccount(e),"Must provide a valid accountID with a matching sync account: "+e)}catch(a){v.default.reportError(a)}var r,i=this._getAccountLib(e,this._labelsByName);try{v.default.PAssert(1284,n||i,"Unable to find labelsByName for given account: "+e)}catch(a){v.default.reportError(a)}return i&&(r=i[t]),r}},{key:"_getPriorityLabel",value:function(e,t){var n=this._ensureAccountLib(e,this._priorityLabels);if(!n[t]){var r;switch(t){case y.a.VMLIFlag.P0:r=sd.PRI0;break;case y.a.VMLIFlag.P1:r=sd.PRI1;break;case y.a.VMLIFlag.P2:r=sd.PRI2;break;default:try{v.default.PAssert(1285,!1,"Invalid priority for email attachment")}catch(i){v.default.reportError(i)}}n[t]=this._getLabelByName(e,r)}return n[t]}},{key:"_getAccountLib",value:function(e,t){try{v.default.PAssert(1286,e,"Must provide valid accountID")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1287,t,"Must provide valid lib object")}catch(i){v.default.reportError(i)}var n;if(e)if(t[e])n=t[e];else for(var r in t)r.toLowerCase()===e.toLowerCase()&&(n=t[r]);return n}},{key:"_ensureAccountLib",value:function(e,t){try{v.default.PAssert(1289,e,"Must provide valid accountID")}catch(i){v.default.reportError(i)}try{v.default.PAssert(1290,t,"Must provide valid lib object")}catch(i){v.default.reportError(i)}var n;if(e)if(t[e=e.toLowerCase()])n=t[e];else{for(var r in t)if(t.hasOwnProperty(r))try{v.default.PAssert(1291,!e||!r||r.toUpperCase()!==e.toUpperCase(),"Dupe accountID found with non-matching case: "+e,r)}catch(i){v.default.reportError(i)}n=t[e]={}}return n}},{key:"_deleteAccountLib",value:function(e,t){try{v.default.PAssert(1292,e,"Must provide valid accountID")}catch(n){v.default.reportError(n)}try{v.default.PAssert(1293,t,"Must provide valid lib object")}catch(n){v.default.reportError(n)}try{v.default.PAssert(1294,t[e],"Trying to delete an account lib that doesnt exist: ",e)}catch(n){v.default.reportError(n)}delete t[e]}},{key:"_attachmentHasPriorityLabel",value:function(e,t){var n=this._getPriorityLabel(e.getField("accountID"),t);return!!n&&e.getField("labelIds").indexOf(n.getLabelID())>=0}},{key:"getLabels",value:function(e,t,n){var r=[],i=t.toLowerCase(),a=0,o=this._labelsByID[e];for(var s in o)if(o.hasOwnProperty(s)){var u=o[s];if(u.matchesText(i)&&this.isDisplayTag(u)&&r.indexOf(u)<0&&(r.push(u),a++),n&&a>=n)break}return r}},{key:"_writeLabelsToCache",value:function(){var e={};for(var t in this._labelsByID)if(this._labelsByID.hasOwnProperty(t)){e[t]={};var n=this._labelsByID[t];for(var r in n)n.hasOwnProperty(r)&&(e[t][r]=n[r].getSaveData())}this._threadCache.setMetadata(ed,e)}},{key:"_writeSendAsToCache",value:function(){var e={};this._iterateSendAs((function(t,n){e[t]||(e[t]=[]),e[t].push(n)})),this._threadCache.setMetadata(td,e)}},{key:"runLabelSync",value:function(){var e=Bo()(jo.a.mark((function e(t){var n=this;return jo.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,v.default.runSingletonPromise("runLabelSync",(function(){return new Promise((function(e){var t=n.getSyncAccounts(),r=t.length,i=0,a=0,o=function(t,o){if(n.hasSyncAccount(t)){Xh.PaneUpdateBatcher.beginUpdateItems();var s={};if(o)for(var u=0,l=0,c=0;c<o.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d,h=o[c];s[h.id]=!0,d="system"===h.type&&id[h.id]?id[h.id]:h.name,n._ensureLabel(t,h.id,d,void 0,h,y.a.ChangeType.Remote)}n._ensureLabelVMLIsForAccount(t),n._ensureRemoteLabel(t,nd,y.a.ChangeType.Local,!0),n._ensureRemoteLabel(t,sd.PRI0,y.a.ChangeType.Local,!0),n._ensureRemoteLabel(t,sd.PRI1,y.a.ChangeType.Local,!0),n._ensureRemoteLabel(t,sd.PRI2,y.a.ChangeType.Local,!0),n._ensureRemoteLabel(t,ud,y.a.ChangeType.Local,!0),n._ensureRemoteLabel(t,"Moo.do/Scheduled",y.a.ChangeType.Local,!0);var f=n._getAccountLib(t,n._labelsByID);if(f)for(var p in f)if(f.hasOwnProperty(p)){var g=f[p];if(g.isLocalOnly()){try{v.default.PAssert(1295,g.hasName(),"Label must have a valid name to be created on remote")}catch(m){v.default.reportError(m)}n._createRemoteLabel(t,g.getName(),!1,function(e,n){n&&!n.error&&this._changeLabelID(t,e,n.id)}.bind(n,p))}else 0!==a||s[p]||g.isSystemOrSpecialLabel()||v.default.isDemoMode()||g.delete()}Xh.PaneUpdateBatcher.commitUpdateItems(),n._writeLabelsToCache(),a+i===r&&e()}else e()},s=function(e,t){a++,o(e),n._notifyFailedRequest(e,t)},u=function(e,t){t?(i++,o(e,t.labels)):s(e,t)},l=Du.a.fns("gmail").users.labels.list.packedFn;t.forEach((function(e){var t={userId:e,timeoutMS:0};n._queueRemoteRequestMulti(e,l,t,u.bind(n,e),s.bind(n,e),void 0,Bc)}))}))}));case 2:t&&t();case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDescriptorForItem",value:function(e){try{v.default.PAssert(1297,e,"Must have a valid item to get a description for")}catch(a){v.default.reportError(a)}var t=this.getAccountIDFromItem(e),n=this._getLabelIDFromItem(e),r={accountID:t,labelID:n,threadID:this._getThreadIDFromItem(e)};if(t&&n){var i=this._getLabelByID(t,n);r.labelName=null===i||void 0===i?void 0:i.getName()}return r}},{key:"handleItemChange",value:function(e,t){var n=this,r=this.getDescriptorForItem(e);if(r.labelID){try{v.default.PAssert(1298,r.accountID,"Must specify a valid accountID")}catch(i){v.default.reportError(i)}setTimeout((function(){n._getThreadsForLabel(r.accountID,n._getLabelByID(r.accountID,r.labelID),e,!1,(function(e){try{v.default.PAssert(1299,e,"Expected success when querying for remote threads")}catch(i){v.default.reportError(i)}t&&t()}))}),0)}}},{key:"handleViewModeChange",value:function(e,t){if(t===y.a.GmailViewMode.Priority){var n=this.getAccountIDFromItem(e);try{v.default.PAssert(1300,n,"Missing Account ID: ",e.id)}catch(o){v.default.reportError(o)}var r=this._getLabelByName(n,sd.PRI0);r&&this._getThreadsForLabel(n,r,void 0,!1,(function(e){try{v.default.PAssert(1301,e,"Expected success when querying for remote PRI0 threads")}catch(o){v.default.reportError(o)}}));var i=this._getLabelByName(n,sd.PRI1);i&&this._getThreadsForLabel(n,i,void 0,!1,(function(e){try{v.default.PAssert(1302,e,"Expected success when querying for remote PRI1 threads")}catch(o){v.default.reportError(o)}}));var a=this._getLabelByName(n,sd.PRI2);a&&this._getThreadsForLabel(n,a,void 0,!1,(function(e){try{v.default.PAssert(1303,e,"Expected success when querying for remote PRI2 threads")}catch(o){v.default.reportError(o)}}))}}},{key:"_getThreadsForLabel",value:function(e,t,n,r,i){var a=this;try{v.default.PAssert(1304,t,"Must provide a valid label to get thrads for")}catch(c){v.default.reportError(c)}var o="-in:chats -in:spam label:"+t.getName(),s=t.getOldestSync();v.default.isDateValid(s)&&(o+=" before:"+Math.floor(s.getTime()/1e3));var u=new Date,l=new Jl((function(t){if(t){var n=a._addRemoteEntry(e,t);n.internalDate.isBefore(u)&&(u=n.internalDate),a.cacheThreadData(n.id,a.serializeExternalData(n))}}),(function(e){t.setOldestSync(u),a._writeLabelsToCache(),i(e)}));this._requestRemoteThreads(e,qc,n,o,r?999:25,void 0,l.getEntryCB(),l.getDoneCB())}},{key:"createOutlinePaneItem",value:function(e,t){for(var n=0,r=t.getItemStore(),i=e.getRawText(),a=e.getAttachmentByPlugin(this.id),o=this.getDisplayTags(a,void 0,!0),s=0;s<o.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i+=" #"+o[s]}return r.createItem(v.default.generateTempId(),i,t.id,void 0,y.a.ChangeType.Local,t.getDocumentOwner())}},{key:"refreshCurrentView",value:function(e){this._forceThreadSync(e)}},{key:"goOnline",value:function(){this._forceThreadSync(this._notifyPendingDraftUpdate)}},{key:"loadInitialData",value:function(){l()(g()(n.prototype),"loadInitialData",this).call(this),v.default.isDemoMode()&&this._forceThreadSync()}},{key:"_forceThreadSync",value:function(e){this.hasRecurringTask("GmailThreadSync")&&this.getRecurringTask("GmailThreadSync").forceUpdate(e)}},{key:"_forceLabelSync",value:function(e){this.hasRecurringTask("GmailLabelSync")&&this.getRecurringTask("GmailLabelSync").forceUpdate(e)}},{key:"_syncOfflineChanges",value:function(){try{v.default.PAssert(1305,!1,"Currently we do not perform a sync offline step for Gmail changes")}catch(e){v.default.reportError(e)}this._syncingOfflineChanges||(this._syncingOfflineChanges=!0)}},{key:"_cleanupLocalCaches",value:function(e){var t=this;try{v.default.PAssert(1306,v.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(s){v.default.reportError(s)}var n=0,r=0,i=+this._getFullSyncTime(),a=this._getUnreadSyncTime(),o=this._getMetadataSyncTime();this._threadCache.getFilterEntries((function(e){if(e&&e.date)return t.getEntryDateAsNumber(e.date)<i})).then((function(i){if(i)for(var s=0,u=0;u<i.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=i[u],c=!0;if(t.ensureThreadDates(l),!l.date.isBefore(a))for(var d=0,h=0;c&&h<l.messages.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=l.messages[h];if(t.isPriorityData(f)){c=!1;break}}if(c){var p=0;l.date.isBefore(o)&&(t._threadCache.removeEntry(l.id),n++);for(var g=0;g<l.messages.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var m=l.messages[g];t._rawCache.removeEntry(m.id),r++}}}v.default.log("Gmail Cache Pruned: ",n,r),e(!1)}))}},{key:"_cleanupRawCache",value:function(e){var t=this;try{v.default.PAssert(1307,v.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(i){v.default.reportError(i)}var n=0,r=+this._getUnreadSyncTime();this._rawCache.getFilterEntries((function(e){return!e.internalDate||t.getEntryDateAsNumber(e.internalDate)<r})).then((function(r){if(r)for(var i=0,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a];t._rawCache.removeEntry(o.id),n++}v.default.log("Raw Cache Pruned: ",n),e()}))}},{key:"getAccountSetting",value:function(e,t){var n,r=this._getAccountLib(e,this._accountSettings);return r&&(n=r[t]),n}},{key:"setAccountSetting",value:function(e,t,n){var r,i=this._ensureAccountLib(e,this._accountSettings);return r=i[t],i[t]=n,r}},{key:"runSettingsSync",value:function(){var e=this;this._getSettingsSendAs((function(t){for(var n in t)t.hasOwnProperty(n)&&e.setAccountSetting(n,"sendAs",t[n]);e._writeSendAsToCache()}))}},{key:"_getSyncDays",value:function(){var e=this.getSetting(this.Settings.SyncTime);Xh.billingManager.isTrialOver()&&(e=y.a.MaxGmailSyncTime.Free);var t=Xh.pluginManager.getCacheSizeRatio();return t<1&&t>0&&(e=Math.round(e*t)),e}},{key:"_getMetadataSyncDays",value:function(){var e=Math.max(this.getSetting(this.Settings.SyncTime),15),t=Xh.pluginManager.getCacheSizeRatio();return t<.5&&(e=Math.max(Math.round(e*t),7)),e}},{key:"_getUnreadSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-1.5*e)}},{key:"_getFullSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-e)}},{key:"_getMetadataSyncTime",value:function(){var e=this._getMetadataSyncDays();return(new Date).addDays(-e)}},{key:"_getFullSyncTimeStr",value:function(){return this._getSyncDays()+"d"}},{key:"_getMetadataSyncTimeStr",value:function(){return this._getMetadataSyncDays()+"d"}},{key:"runThreadSync",value:function(){var e=Bo()(jo.a.mark((function e(t){var n,r=this;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,v.default.runSingletonPromise("runThreadSync",(function(){return new Promise((function(e){var t,n=0,i=0,a=[],o=[],s=function(s,u,l){s?(n++,a.push(u)):(i++,!v.default.isHTTPStatusCode(l,y.a.HTTPStatusCode.Network)&&r.isOnline()&&o.push(u)),i+n===t&&(o.length>0?Xh.toasts.pushMessage(y.a.MessageID.EmailSyncFail):Xh.toasts.clearMessage(y.a.MessageID.EmailSyncFail),a.length>0&&r._contentSyncTask.requestRun(),e(0===o.length))},u=!1,l=r._getSyncDays();void 0!==r._lastSyncTime&&r._lastSyncTime<l&&(u=!0,v.default.log("Forcing full gmail sync")),r._lastSyncTime=l;var c=r._threadCache.getMetadata(Zc),d=r.getSyncAccounts();t=d.length,d.forEach((function(e){var t;if(!u){var n=c?c[e]:void 0;t=n?n.historyID:void 0}r.performThreadSync(e,t,s)}))}))}));case 2:n=e.sent,t&&t(n);case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncAllAccountsFull",value:function(e){this._lastSyncTime=0,this.runThreadSync(e)}},{key:"performThreadSync",value:function(e,t,n){t?(Date.now()-this._lastCacheCleanup>v.default.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(e,t,n)):this._performThreadSyncFull(e,n)}},{key:"_performThreadSyncFull",value:function(e,t){var n,r=this,i="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),a=this.getDefaultItemStore(),o=this._ensureVMLIsForAccount(e,a);o.clearPaginationToken();var s=new Jl((function(t){if(t&&(!n&&t.historyId&&(n=t.historyId,r.setHistoryID(e,n)),r._shouldCacheThread(t))){var i=r._addRemoteEntry(e,t);r.cacheThreadData(i.id,r.serializeExternalData(i))}}),(function(n){t(n,e)}));this._requestRemoteThreads(e,Oc,o,i,999,0,s.getEntryCB(),s.getDoneCB()),this.runLabelSync((function(){var t=r._getLabelByName(e,ud,!0);t&&r._getThreadsForLabel(e,t,void 0,!0,(function(e){try{v.default.PAssert(1308,e,"Expect to be able to get all handled messages")}catch(t){v.default.reportError(t)}})),r._getThreadsForLabel(e,r._getLabelByID(e,wc.UNREAD),void 0,!1,(function(e){try{v.default.PAssert(1309,e,"Expect to be able to get all unread messages")}catch(t){v.default.reportError(t)}}))}))}},{key:"_compactHistoryEntries",value:function(e){for(var t=0,n={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r],a=0;if(i.messagesAdded){for(var o=0,s=0;s<i.messagesAdded.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=i.messagesAdded[s].message,l=n.messagesAdded[u.threadId];l||(l=n.messagesAdded[u.threadId]=[]),l.indexOf(u.id)<0&&l.push(u.id)}a+=i.messagesAdded.length}if(i.messagesDeleted){for(var c=0,d=0;d<i.messagesDeleted.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var h=i.messagesDeleted[d].message,f=n.messagesDeleted[h.threadId];f||(f=n.messagesDeleted[h.threadId]=[]),f.indexOf(h.id)<0&&f.push(h.id)}a+=i.messagesDeleted.length}if(i.labelsAdded){for(var p=0,g=0;g<i.labelsAdded.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var m=i.labelsAdded[g].message,y=n.labelsAdded[m.threadId];y||(y=n.labelsAdded[m.threadId]={}),y[m.id]||(y[m.id]=[]),y[m.id].pushOnlyUniques(i.labelsAdded[g].labelIds)}a+=i.labelsAdded.length}if(i.labelsRemoved){for(var _=0,b=0;b<i.labelsRemoved.length;++b){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;var w=i.labelsRemoved[b].message,k=n.labelsRemoved[w.threadId];k||(k=n.labelsRemoved[w.threadId]={}),k[w.id]||(k[w.id]=[]),k[w.id].pushOnlyUniques(i.labelsRemoved[b].labelIds)}a+=i.labelsRemoved.length}try{v.default.PAssert(1310,0===a||a===i.messages.length,"Must have handled all or none of the generic messages")}catch(R){v.default.reportError(R)}if(0===a)for(var S=0,E=0;E<i.messages.length;++E){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;var P=i.messages[E],I=n.messages[P.threadId];I||(I=n.messages[P.threadId]=[]),I.indexOf(P.id)<0&&I.push(P.id)}}var D={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(var T in n.messages)n.messages.hasOwnProperty(T)&&D.messages.push({id:T,msgIDs:n.messages[T]});for(var x in n.messagesAdded)n.messagesAdded.hasOwnProperty(x)&&!n.messages[x]&&D.messagesAdded.push({id:x,msgIDs:n.messagesAdded[x]});for(var C in n.messagesDeleted)n.messagesDeleted.hasOwnProperty(C)&&!n.messages[C]&&D.messagesDeleted.push({id:C,msgIDs:n.messagesDeleted[C]});for(var A in n.labelsAdded)if(n.labelsAdded.hasOwnProperty(A)&&!n.labelsAdded[A])for(var L in n.labelsAdded[A])n.labelsAdded[A].hasOwnProperty(L)&&D.labelsAdded.push({id:A,msgID:L,labelIDs:n.labelsAdded[A][L]});for(var O in n.labelsRemoved)if(n.labelsRemoved.hasOwnProperty(O)&&!n.messages[O])for(var M in n.labelsRemoved[O])n.labelsRemoved[O].hasOwnProperty(M)&&D.labelsRemoved.push({id:O,msgID:M,labelIDs:n.labelsRemoved[O][M]});return D}},{key:"_performThreadSyncPartial",value:function(e,t,n){var r=this,i=Du.a.fns("gmail").users.history.list.packedFn,a={userId:e,startHistoryId:t},o={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},s=function(e,t){v.default.log("History Sync Request Failed: ",e,t)};this._queuePagedRemoteRequestMulti(e,i,a,(function(t,i,a){var o;a&&(o=a.historyId,r.setHistoryID(e,o)),Xh.PaneUpdateBatcher.beginUpdateItems();var u=r._compactHistoryEntries(t);r._handleCompactHistory(e,u,s),Xh.PaneUpdateBatcher.commitUpdateItems(),n(!0,e)}),(function(t){t&&t.error&&t.error.code===y.a.HTTPStatusCode.NotFound?r._clearCachedData(e,(function(i){i?r.performThreadSync(e,void 0,n):n(!1,e,t)})):(n(!1,e,t),r._notifyFailedRequest(e,t))}),void 0,Mc,o)}},{key:"_handleCompactHistory",value:function(e,t,n){for(var r=0,i=0,a=0,o=0,s=0,u=0,l=0;l<t.messages.length;++l){var c=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var d=t.messages[l],h=0;h<d.msgIDs.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;this._handleMessageUpdated(e,d.id,d.msgIDs[h],n),u++}}for(var f=0;f<t.messagesAdded.length;++f){var p=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var g=t.messagesAdded[f],v=0;v<g.msgIDs.length;++v){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;this._handleMessageAdded(e,g.id,g.msgIDs[v],n),u++}}for(var m=0;m<t.messagesDeleted.length;++m){var y=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var _=t.messagesDeleted[m],b=0;b<_.msgIDs.length;++b){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;this._handleMessageDeleted(e,_.id,_.msgIDs[b]),u++}}for(var w=0;w<t.labelsAdded.length;++w){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var k=t.labelsAdded[w];this._handleLabelsAdded(e,k.id,k.msgID,k.labelIDs),u++}for(var S=0;S<t.labelsRemoved.length;++S){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var E=t.labelsRemoved[S];this._handleLabelsRemoved(e,E.id,E.msgID,E.labelIDs),u++}return u}},{key:"_handleMessageAdded",value:function(e,t,n,r){this.refreshThreadCacheData(e,t,n,r)}},{key:"_handleMessageDeleted",value:function(e,t,n){this._deleteCachedMessage(e,t,n)}},{key:"_handleLabelsAdded",value:function(e,t,n,r){this.addLabelsToMessage(e,t,n,r,y.a.ChangeType.Remote)}},{key:"_handleLabelsRemoved",value:function(e,t,n,r){this.removeLabelsFromMessage(e,t,n,r,y.a.ChangeType.Remote)}},{key:"_handleMessageUpdated",value:function(e,t,n,r){this.refreshThreadCacheData(e,t,n,r)}},{key:"getLastSyncTime",value:function(e){var t,n=this._threadCache.getMetadata(Zc);if(n){var r=n[e];r&&r.date&&(t=new Date(r.date))}return t}},{key:"getAllLastSyncTimes",value:function(){for(var e=0,t=this._threadCache.getMetadata(Zc),n={},r=this.getSyncAccounts(),i=0;i<r.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=r[i],o=t?t[a]:void 0;o&&o.date?n[a]=new Date(o.date):n[a]=void 0}return n}},{key:"setHistoryID",value:function(e,t){try{v.default.PAssert(1312,v.default.isString(e),"Must provide a valid account ID to set history ID")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1313,v.default.isString(t),"Must provide a valid history ID to set")}catch(r){v.default.reportError(r)}var n=Object.assign({},this._threadCache.getMetadata(Zc));n[e]={historyID:t,date:Date.now()},this._threadCache.setMetadata(Zc,n)}},{key:"clearHistoryID",value:function(e){try{v.default.PAssert(1314,v.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(r){v.default.reportError(r)}var t=this._threadCache.getMetadata(Zc);if(t){t[e];var n=V()(t,[e].map(_c));this._threadCache.setMetadata(Zc,n)}}},{key:"clearCachedLabel",value:function(e){try{v.default.PAssert(1315,v.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(r){v.default.reportError(r)}var t=this._threadCache.getMetadata(ed);if(t){t[e];var n=V()(t,[e].map(_c));this._threadCache.setMetadata(ed,n)}}},{key:"_clearCachedData",value:function(e,t){this.clearHistoryID(e),this.clearCachedLabel(e),this.clearAccountThreadCache(e,t)}},{key:"clearAccountThreadCache",value:function(e,t){var n=this;try{v.default.PAssert(1316,v.default.isString(e),"Must provide a valid account ID to clear thread cache for")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1317,!t||v.default.isFunction(t),"Must provide valid CB function when clearing thread cache")}catch(r){v.default.reportError(r)}this._threadCache.getFilterEntries((function(t){return t.accountID===e})).then((function(r){if(r){var i=0;v.default.log("Clearing account thread cache: "+e);for(var a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a];if(n._threadCache.removeEntry(o.id),o.messages)for(var s=0,u=0;u<o.messages.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;n._rawCache.removeEntry(o.messages[u].id)}}t&&t(!0)}else t&&t(!1)}))}},{key:"requestDataPage",value:function(e,t){v.default.log("Data Page: ",e.hasPaginationToken()),e.hasPaginationToken()&&!e.paginationTokenInUse()&&e?this._requestRemoteThreads(void 0,jc,e,void 0,25,void 0,void 0,t):t(!0)}},{key:"_requestRemoteThreads",value:function(e,t,n,r,i,a,o,s){var u=this;this.isLoadingThreads.set(!0);var l,c=function(e){s(e),u.isLoadingThreads.set(!1)};if(n&&n.hasPaginationToken()&&!n.paginationTokenInUse()){l=n.beginDataPageLoad();try{v.default.PAssert(1320,!r,"Should not define a new q for paged token")}catch(m){v.default.reportError(m)}try{v.default.PAssert(1321,!o,"Should not define a new entryCB for paged token")}catch(m){v.default.reportError(m)}if(r=l.getQuery(),i=l.getMaxResults(),o=l.getEntryCB(),c){var d=c;c=function(){for(var e=0,t=0,n=arguments.length,r=new Array(n),i=0;i<n;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r[i]=arguments[i]}l.getDoneCB().apply(null,r),d.apply(null,r)}}else c=l.getDoneCB();e=e||l.getInfo().accountID}else n&&n.needsPaginationToken()&&(l=this.createPaginationToken(void 0,r,{accountID:e},i,o,c),n.setPaginationToken(l),n.beginDataPageLoad());i=i||25;try{v.default.PAssert(1322,o&&v.default.isFunction(o),"Must define a valid entry callback")}catch(m){v.default.reportError(m)}try{v.default.PAssert(1323,c&&v.default.isFunction(c),"Must define a valid done callback")}catch(m){v.default.reportError(m)}var h,f,p=Du.a.fns("gmail").users.threads.list.packedFn,g={userId:e,maxResults:i,timeoutMS:a,q:r,pageToken:l&&l.hasMorePages()?l.getNextPageToken():void 0};l||!n?(h=function(t){if(t.nextPageToken&&l&&u.updatePaginationToken(l,t.nextPageToken),n&&l&&n.endDataPageLoad(!!t.nextPageToken),t.threads)for(var r=0,i=t.threads.length,a=0,s=0,d=function(e){e?(o(e),a++):(o(void 0),s++),a+s===i&&c(!0)},h=0;h<t.threads.length;++h){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var f=t.threads[h];u._requestRemoteThreadMetadata(e,f.id,void 0,d)}else c(!0)},f=function(t){n&&l&&n.endDataPageLoad(l),c(!1),u._notifyFailedRequest(e,t)}):(h=function(){c(!0)},f=function(t){c(!1),u._notifyFailedRequest(e,t)}),this._queueRemoteRequestMulti(e,p,g,h,f,void 0,t)}},{key:"_requestRemoteMessageData",value:function(e,t,n){var r=this;try{v.default.PAssert(1324,!e.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment")}catch(s){v.default.reportError(s)}var i=Du.a.fns("gmail").users.messages.get.packedFn,a={userId:e.getField("accountID"),id:t,format:"full"},o=function(){var i=Bo()(jo.a.mark((function i(a){var o;return jo.a.wrap((function(i){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(i.prev=i.next){case 0:return i.next=2,r._parseMailMessage(a);case 2:o=i.sent;try{v.default.PAssert(1325,o,"Must be able to parse message")}catch(s){v.default.reportError(s)}r._updateMessageData(e,t,o),n(!0);case 6:case"end":return i.stop()}}}),i)})));return function(e){return i.apply(this,arguments)}}();this._queueRemoteRequestMulti(e.getField("accountID"),i,a,o,(function(t){n(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)}),void 0,$c)}},{key:"_requestRemoteMessageDataRaw",value:function(e,t,n,r,i){var a=this,o=Du.a.fns("gmail").users.messages.get.packedFn,s={userId:e,id:n,format:"full"};this._queueRemoteRequestMulti(e,o,s,(function(n){n&&a._handleContentSyncdMessage(e,t,n),i(n)}),(function(t){i(!1,t,"This thread belongs to an account ("+e+") you are not authorized to access."),a._notifyFailedRequest(e,t)}),void 0,$c,{priority:r?y.a.RequestPriority.UserBlocking:y.a.RequestPriority.Default})}},{key:"_requestRemoteThreadDataRaw",value:function(e,t,n){var r=this,i=Du.a.fns("gmail").users.threads.get.packedFn,a={userId:e,id:t,format:"full"};this._queueRemoteRequestMulti(e,i,a,n,(function(t){n(void 0,t),r._notifyFailedRequest(e,t)}),void 0,Rc)}},{key:"_requestRemoteThreadMetadata",value:function(e,t,n,r){var i=this,a=Du.a.fns("gmail").users.threads.get.packedFn,o={userId:e,id:t,format:"metadata"};this._queueRemoteRequestMulti(e,a,o,(function(e){r(e)}),(function(t){r(void 0,t),i._notifyFailedRequest(e,t)}),n,Fc)}},{key:"_persistRemoteSnoozeTask",value:function(e,t){e.getData()}},{key:"_cancelDeferredSnoozeTask",value:function(e,t){e.getData()}},{key:"_persistRemoteSendMailTask",value:function(e,t){e.getData()}},{key:"_cancelDeferredSendMailTask",value:function(e,t){e.getData()}},{key:"_handleRemotePersist",value:function(e,t){if(t.status!==y.a.HTTPStatusCode.Success)return e(!1);try{return e(!0,JSON.parse(t.response).data.messageID)}catch(n){return v.default.reportError(n),e(!1)}}},{key:"_parseMailThread",value:function(){var e=Bo()(jo.a.mark((function e(t,n){var r,i,a=this;return jo.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return r=[],e.next=3,Promise.all(n.messages.map(function(){var e=Bo()(jo.a.mark((function e(t){var n;return jo.a.wrap((function(e){for(var i=0,o=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,a._parseMailMessage(t);case 2:n=e.sent;try{v.default.PAssert(1326,n,"Must be able to parse each message")}catch(s){v.default.reportError(s)}n&&r.push(n);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return i=t.getField("messages"),this._mergeMessagesData(i,r,["labelIds","draftID"]),t.updateField("messages",r),t.updateField("dataLoaded",!0),this._updateAttachmentFromMessages(t,y.a.ChangeType.Remote),e.abrupt("return",r);case 9:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAttachmentURL",value:function(e,t,n){return"https://mail.google.com/mail/b/"+e+"/?ui=2&view=att&disp=safe&zw"+("&th="+t)+("&attid="+n)}},{key:"getPreviewURL",value:function(e){return e.link}},{key:"reportMessage",value:function(e,t,n,r,i){var a=Du.a.fns("gmail").users.messages.get.packedFn,o={userId:e,id:n,format:"full",forceNoDupe:!0};this._queueRemoteRequestMulti(e,a,o,this._sendReport.bind(this,i,r),(function(){try{v.default.PAssert(1327,!1,"Failed to report message")}catch(e){v.default.reportError(e)}}),void 0,$c)}},{key:"dumpMessage",value:function(e,t,n){var r=this.getAttachment(t),i=this._getMessageFromAttachment(r,n);console.log("Message Dump: ",i)}},{key:"_sanitizeMessage",value:function(){var e=Bo()(jo.a.mark((function e(t){var n,r,i,a,o,s=this;return jo.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.parts){e.next=3;break}return e.next=3,Promise.all(t.parts.map((function(e){return s._sanitizeMessage(e)})));case 3:if(!t.body||!t.body.data){e.next=13;break}if(!(n=this._runDecodeEmail(t))||n.mimeType!==kd){e.next=11;break}return e.next=8,fs.sanitizeContent(n.decoded);case 8:r=e.sent,e.next=12;break;case 11:t.body.data=this._encodeEmail(fs.sanitizePlaintext(n.decoded));case 12:t.body.data=this._encodeEmail(r);case 13:if(!t.headers){e.next=30;break}i=0,a=0;case 16:if(!(a<t.headers.length)){e.next=30;break}if(!(i++>5e3&&__infLoop&&__infLoop(i))){e.next=19;break}throw new RangeError;case 19:o=t.headers[a],e.t0=o.name.toUpperCase(),e.next="TO"===e.t0||"CC"===e.t0||"BCC"===e.t0||"FROM"===e.t0?23:"SUBJECT"===e.t0||"SNIPPET"===e.t0?25:27;break;case 23:return o.value=o.value.replace(/[A-Za-z0-9]/g,"#"),e.abrupt("break",27);case 25:return o.value=new Array(o.name.length+1).join("#"),e.abrupt("break",27);case 27:++a,e.next=16;break;case 30:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sendReport",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r){var i;return jo.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:try{v.default.PAssert(1328,v.default.isBoolean(t),"Must provide a valid boolean for sendContent")}catch(o){v.default.reportError(o)}try{v.default.PAssert(1329,v.default.isString(n),"Must provide a valid description string")}catch(o){v.default.reportError(o)}try{v.default.PAssert(1330,v.default.isObject(r),"Must provide valid raw data")}catch(o){v.default.reportError(o)}if(e.prev=3,v.default.log("Sending Message Report",r),t){e.next=8;break}return e.next=8,this._sanitizeMessage(r.payload);case 8:i={description:n,payload:r.payload},v.default.reportError(new Error("Report Message"),i),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),v.default.reportError(e.t0);case 15:case"end":return e.stop()}}}),e,this,[[3,12]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadResource",value:function(e,t,n,r){if(this.hasCacheData(e)){var i=this.getAttachment(e),a=this._getMessageFromAttachment(i,t).resources[n];a?(a.data?r(a,n):this._requestRemoteAttachment(i.getField("accountID"),t,a.id,(function(e,t){e&&(a.data=e,a.size=t),r(a,n)})),this.sendEvent("FetchAttachment")):r(void 0,n)}else r(void 0,n)}},{key:"_requestRemoteAttachment",value:function(e,t,n,r){var i=this,a=Du.a.fns("gmail").users.messages.attachments.get.packedFn,o={id:n,messageId:t,userId:e};this._queueRemoteRequestMulti(e,a,o,(function(e){r(e.data.replace(/-/g,"+").replace(/_/g,"/"),e.size)}),(function(t){r(void 0),i._notifyFailedRequest(e,t)}),void 0,Xc)}},{key:"_parseAttachment",value:function(e,t,n){try{v.default.PAssert(1331,e,"Must have valid multipart lib")}catch(g){v.default.reportError(g)}try{v.default.PAssert(1332,n.body,"Must have a valid attachment body")}catch(g){v.default.reportError(g)}try{v.default.PAssert(1333,n.body.attachmentId,"Must have a valid attachment ID")}catch(g){v.default.reportError(g)}var r,i,a,o,s,u="0."+n.partId;if(n.headers)for(var l=0,c=0;c<n.headers.length;++c){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=n.headers[c];switch(d.name.toUpperCase()){case"CONTENT-ID":var h=/^<(.*)>$/.exec(d.value);i=r=h?h[1]:d.value;break;case"CONTENT-TRANSFER-ENCODING":s=d.value;break;case"CONTENT-DISPOSITION":var f=d.value.split(";");o=f[0]?f[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":a=d.value}}r&&o!==rd.Attachment||!n.filename?!r&&n.body.attachmentId&&(r=n.body.attachmentId):r=n.filename;try{v.default.PAssert(1334,r,"Must be able to find a valid resource ID")}catch(g){v.default.reportError(g)}var p={cid:r,rawContentID:i,id:n.body.attachmentId,attID:u,realAttrID:a,data:void 0,size:n.body.size,uploader:void 0,disposition:o,parentType:t.mimeType,mimeType:n.mimeType,contentEncoding:s};e[p.cid]=p}},{key:"_decodeFlowed",value:function(e,t){return e.split(/\r?\n/).reduce((function(e,n,r){var i=e;return t&&(i=i.replace(/[ ]+$/,"")),/ $/.test(e)&&!/(^|\n)\-\- $/.test(e)||1===r?i+n:i+"\n"+n})).replace(/^ /gm,"")}},{key:"_decodeEmail",value:function(e,t,n){try{v.default.PAssert(1335,v.default.isString(e),"Passing in an invalid string to decode")}catch(i){v.default.reportError(i)}var r;if(e)try{r=v.default.b64_to_utf8(e),"FLOWED"===n.format&&(r=this._decodeFlowed(r,n.delSp))}catch(a){v.default.reportError(a)}return r}},{key:"_encodeEmail",value:function(e){var t;try{t=v.default.utf8_to_b64(e)}catch(n){v.default.reportError(n)}return t}},{key:"_runDecodeEmail",value:function(e){try{v.default.PAssert(1336,e&&e.body,"Must pass in a valid part")}catch(o){v.default.reportError(o)}var t,n=this._getHeader(e,"Content-Transfer-Encoding"),r=!1;if(Cd.indexOf(e.mimeType)>=0)return{decoded:t=this._generateMessageDisplayNode(e),mimeType:kd,contentType:Id,name:"GeneratedContent",hasError:r};var i=this._getHeader(e,"Content-Type")||Id;try{v.default.PAssert(1337,i,"Must have a valid contentType")}catch(o){v.default.reportError(o)}var a=this._sanitizeContentType(i);return e.body&&e.body.data?t=this._decodeEmail(e.body.data,n,a):e.body&&e.body.attachmentId?t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>':(t="Unable to decode email content",r=!0),{decoded:t,mimeType:e.mimeType,contentType:a.type,name:a.name,hasError:r}}},{key:"_runDecodeMessage",value:function(e){var t=this._decodeMessagePart(e);return 0===t.length&&e?Td.indexOf(e.mimeType)>=0||Cd.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:[]:t}},{key:"_decodeMessagePart",value:function(e){var t=[];if(e)if(e.mimeType===fd||e.mimeType===pd||e.mimeType===hd)for(var n=0,r=0;r<e.parts.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this._decodeMessagePart(e.parts[r]);t.pushArray(i)}else if(e.mimeType===dd||e.mimeType===cd||e.mimeType===cd||e.mimeType===vd)for(var a=0,o=e.parts.length-1;o>=0;o--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this._isValidDisplayPart(e.parts[o])){var s=this._decodeMessagePart(e.parts[o]);if(s.length>0){t.pushArray(s);break}}}else this._isValidDisplayPart(e)&&t.push(this._runDecodeEmail(e));return t}},{key:"_combineMessageParts",value:function(){var e=Bo()(jo.a.mark((function e(t){var n,r,i,a,o,s;return jo.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(n="",r=wd,i=Id,a=!1,!(t&&t.length>0)){e.next=22;break}o=0,r=t[0].mimeType,i=t[0].contentType,t.length,s=0;case 10:if(!(s<t.length)){e.next=17;break}if(!(o++>5e3&&__infLoop&&__infLoop(o))){e.next=13;break}throw new RangeError;case 13:xd.indexOf(t[s].mimeType)<0&&(a=!0);case 14:++s,e.next=10;break;case 17:return e.next=19,fs.combineParts(t);case 19:n=e.sent,e.next=23;break;case 22:n=" ";case 23:return r===wd&&(r=kd,i=kd+";charset="+i.split(";charset=")[1]),e.abrupt("return",{decoded:n,mimeType:r,contentType:i,reportMessage:a});case 25:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isValidDisplayPart",value:function(e){var t=!1;return!this._isResourcePart(e)&&Td.indexOf(e.mimeType)>=0&&(t=!0),t}},{key:"_isResourcePart",value:function(e){var t=!1;return(e.filename||this._getHeader(e,"CONTENT-ID")&&(this._getHeader(e,"CONTENT-DISPOSITION")||Td.indexOf(e.mimeType)<0))&&(t=!0),t}},{key:"_parseMessagePart",value:function(e,t){var n=0,r=0,i={parent:t,raw:e,mimeType:e.mimeType,children:[],resources:[]};switch(e.mimeType){case wd:case kd:case md:break;case cd:case hd:case yd:case dd:case gd:case pd:case _d:case fd:for(var a=0;a<e.parts.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e.parts[a],s=this._parseMessagePart(o,i);this._isResourcePart(o)?i.resources.push(s):i.children.push(s)}break;case vd:for(var u=0;u<e.parts.length;++u){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=this._parseMessagePart(e.parts[u],i);i.children.push(l)}break;default:var c=e.mimeType.split("/")[0];Dd.indexOf(c)<0&&(v.default.log("Unknown Part Mimetype: ",e),v.default.reportError(new Error("Unknown attachment mimetype: "+e.mimeType)))}return i}},{key:"_getMessageDisplay",value:function(e,t){var n=0;switch(e.mimeType){case wd:case kd:case fd:case pd:case gd:t.push(e);break;case dd:case cd:case vd:case hd:for(var r=0;r<e.children.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._getMessageDisplay(e.children[r],t)}break;case Sd:case Ed:break;case yd:case bd:case _d:t.push(e);break;default:try{v.default.PAssert(1338,!1,"Should never have an unknown multipart mimetype in the tree: ",e.mimeType)}catch(i){v.default.reportError(i)}}}},{key:"_getResourcesForNode",value:function(e,t){for(var n=0,r=e.resources,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i].raw;this._parseAttachment(t,e,a)}e.raw&&e.raw.body&&e.raw.body.attachmentId&&this._parseAttachment(t,e.parent,e.raw)}},{key:"_getResourcesForPart",value:function(e){var t=0,n={};if(e.mimeType===fd||e.mimeType===pd)for(var r=0,i=0;i<e.children.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._getResourcesForNode(e.children[i],n)}for(;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._getResourcesForNode(e,n),e=e.parent}return n}},{key:"_displayAttachment",value:function(e,t){var n=!1;return e.cid===t&&(e.disposition===rd.Attachment||e.disposition===rd.Inline&&e.parentType===fd)&&(n=!0),n}},{key:"getMessageAttachments",value:function(e){var t=this,n=[];return e.resources&&v.default.forEachValue(e.resources,(function(e){t._displayAttachment(e,e.cid)&&n.push(e)})),n}},{key:"getMessageDisplayAttachments",value:function(){var e=Bo()(jo.a.mark((function e(t){var n,r,i,a,o,s,u=0;return jo.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(n=this.getMessageAttachments(t),!t.initializedForDisplay){e.next=5;break}r=t.specialLinks?t.specialLinks.attachments:[],e.next=9;break;case 5:return i={ignoreQuotedAttachments:!!(t.labelIds.indexOf(wc.DRAFT)>=0)},e.next=8,fs.getAttachmentLinks(t.decoded,i);case 8:r=e.sent;case 9:a=0;case 10:if(!(a<r.length)){e.next=18;break}if(!(u++>5e3&&__infLoop&&__infLoop(u))){e.next=13;break}throw new RangeError;case 13:o=r[a],t.resources[o.name]||((s=this._createResource(t.resources,o)).link=o.href,n.push(s));case 15:++a,e.next=10;break;case 18:return e.abrupt("return",n);case 19:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_verifyDKIM",value:function(e){var t;if(e)for(var n=0,r=e.split(";"),i=/([a-z]+)[=](.*)/i,a=0;a<r.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[a].trim();if(o){var s=i.exec(o);if(s)switch(t={},s[1]){case"d":t.domain=s[2];break;case"h":t.headers=s[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return t}},{key:"_sanitizeContentType",value:function(e){var t=Id;try{var n,r,i,a,o=0,s=e.replace(/[\"\']/g,"").split(";"),u=s[0].trim().toLowerCase();try{v.default.PAssert(1339,u===wd||u===kd,"Unknown ContentType MediaType: "+u)}catch(p){v.default.reportError(p)}for(var l=1;l<s.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=s[l].trim();if(c){var d=c.indexOf("=");if(d>=1){var h=c.substr(0,d).trim(),f=c.substr(d+1).trim();if(h&&f)switch(h.toUpperCase()){case"CHARSET":n=f;break;case"FORMAT":r=f.toUpperCase();break;case"DELSP":i="YES"===f.toUpperCase();break;case"NAME":a=f;break;case"BOUNDARY":break;default:try{v.default.PAssert(1340,!1,"Unknown param in ContentType: "+c)}catch(p){v.default.reportError(p)}}else try{v.default.PAssert(1341,!1,"Malformed contentType part: ",e)}catch(p){v.default.reportError(p)}}else try{v.default.PAssert(1342,!1,"Invalid contentType part: ",e)}catch(p){v.default.reportError(p)}}}n||(n="utf-8"),u&&n&&(t=u+";charset="+n)}catch(g){v.default.reportError(g)}return{type:t,format:r,delSp:i,name:a}}},{key:"_getHeader",value:function(e,t){var n;if(e&&e.headers)for(var r=0,i=0;i<e.headers.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e.headers[i].name.toUpperCase()===t.toUpperCase()){n=e.headers[i].value;break}}return n}},{key:"_generateMessageDisplayNode",value:function(e){try{v.default.PAssert(1344,Cd.indexOf(e.mimeType)>=0,"Must be a valid mimeType to generate content from")}catch(r){v.default.reportError(r)}var t;if(e.body&&e.body.attachmentId)t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>';else{var n;switch(e.mimeType){case bd:case _d:case fd:n="&nbsp;";break;case yd:n="Unable to display encrypted message content.";break;default:n="Unable to display unknown content type: "+e.mimeType}t="<html><body>"+n+"</body></html>"}return t}},{key:"_parseMailMessage",value:function(){var e=Bo()(jo.a.mark((function e(t){return jo.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this._parseMailMessageInternal(t));case 4:e.prev=4,e.t0=e.catch(0),v.default.reportError(e.t0);case 7:case"end":return e.stop()}}}),e,this,[[0,4]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_parseMailMessageInternal",value:function(){var e=Bo()(jo.a.mark((function e(t){var n,r,i,a,o,s,u,l,c,d,h,f,p,g,m,y,_=0;return jo.a.wrap((function(e){for(var b=0;;){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;switch(e.prev=e.next){case 0:n=t.payload,r=!!n.body&&n.body.size>0;try{v.default.PAssert(1345,r!==n.mimeType.startsWith("multipart/")||n.mimeType===hd,"Checking the body size should be the same as checking whether this is a multipart message")}catch(w){v.default.reportError(w)}this._verifyDKIM(this._getHeader(t.payload,"DKIM-Signature")),i=t.payload.headers,a=0;case 6:if(!(a<i.length)){e.next=40;break}if(!(_++>5e3&&__infLoop&&__infLoop(_))){e.next=9;break}throw new RangeError;case 9:o=i[a],e.t0=o.name.toUpperCase(),e.next="FROM"===e.t0?13:"REPLY-TO"===e.t0?15:"TO"===e.t0?17:"CC"===e.t0?19:"BCC"===e.t0?21:"SUBJECT"===e.t0?23:"DATE"===e.t0?25:"MESSAGE-ID"===e.t0?28:"REFERENCES"===e.t0?30:"IN-REPLY-TO"===e.t0?32:"LIST-UNSUBSCRIBE"===e.t0?34:36;break;case 13:return t.from=this.parseEmailAddress(o.value),e.abrupt("break",37);case 15:return t.replyTo=this.parseEmailAddress(o.value),e.abrupt("break",37);case 17:return t.to=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 19:return t.cc=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 21:return t.bcc=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 23:return t.subject=o.value,e.abrupt("break",37);case 25:t.date=this.parseDateHeader(o.value);try{v.default.PAssert(1346,v.default.isDateValid(t.date),"Must have a valid message date3: ",t.date)}catch(w){v.default.reportError(w)}return e.abrupt("break",37);case 28:return t.messageID=o.value,e.abrupt("break",37);case 30:return t.references=o.value,e.abrupt("break",37);case 32:return t.inReplyTo=o.value,e.abrupt("break",37);case 34:return t.listUnsubscribe=o.value,e.abrupt("break",37);case 36:return e.abrupt("break",37);case 37:++a,e.next=6;break;case 40:if(t.messageID||(t.messageID=v.default.generateTempId()),!r){e.next=45;break}u=n,e.next=64;break;case 45:l=0,c=this._parseMessagePart(n),d=[],this._getMessageDisplay(c,d),f=d.length-1;case 50:if(h||!(f>=0)){e.next=57;break}if(!(l++>5e3&&__infLoop&&__infLoop(l))){e.next=53;break}throw new RangeError;case 53:if(Td.indexOf(d[f].mimeType)>=0)h=d[f];else if(Cd.indexOf(d[f].mimeType)>=0)h=d[f];else{v.default.log("Unknown bestNode mimepart: ",d[f]);try{v.default.PAssert(1347,!1,"Unknown mimePart display type: ",d[f].mimeType)}catch(w){v.default.reportError(w)}}case 54:f--,e.next=50;break;case 57:if(!h){e.next=62;break}s=this._getResourcesForPart(h),u=h.raw,e.next=64;break;case 62:return e.next=64,this._sendReport(!1,"Missing bestNode",t);case 64:try{v.default.PAssert(1348,u,"Must have found a valid message part to display")}catch(w){v.default.reportError(w)}p=this._runDecodeMessage(u);try{v.default.PAssert(1349,p.length>0,"Should have at least one decoded message part available")}catch(w){v.default.reportError(w)}if(0!==p.length){e.next=77;break}return e.prev=68,g=JSON.parse(JSON.stringify(t)),e.next=72,this._sendReport(!0,"No valid decoded part",g);case 72:e.next=77;break;case 74:e.prev=74,e.t1=e.catch(68),v.default.reportError(e.t1);case 77:return e.next=79,this._combineMessageParts(p);case 79:if(!(m=e.sent)){e.next=87;break}if(y={id:t.id,labelIds:t.labelIds,messageID:t.messageID,decoded:m.decoded,mimeType:m.mimeType,contentType:m.contentType,from:t.from,to:t.to||[],cc:t.cc,bcc:t.bcc,snippet:t.snippet,subject:t.subject||"",date:t.date,internalDate:t.internalDate?v.default.isDateValid(t.internalDate)?t.internalDate:new Date(v.default.parseInt(t.internalDate)):new Date,references:t.references,inReplyTo:t.inReplyTo,listUnsubscribe:t.listUnsubscribe,resources:s||{}},!m.reportMessage){e.next=85;break}return e.next=85,this._sendReport(!1,"Mismatch mimeType/contentType",t);case 85:return e.abrupt("return",y);case 87:case"end":return e.stop()}}}),e,this,[[68,74]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseEmailAddress",value:function(e){if(v.default.isObject(e))return e;Ld.lastIndex=0;var t=Ld.exec(e),n={};if(t){var r=Od.exec(t[1]);n.text=r?r[1]:t[1],n.email=t[2]}else n.email=e;return n.email&&(n.email=n.email.replace(/[\r\n]/g,"")),n.text&&(n.text=n.text.replace(/[\r\n]/g,"")),n}},{key:"parseEmailAddresses",value:function(e){for(var t=0,n=[],r=v.default.parseEmailAddresses(e),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=r[i];"contact"===a.type&&a.email&&n.push(a)}return n}},{key:"parseDateHeader",value:function(e){var t=_s.a.parseDate(e);return v.default.isDateValid(t)||(t=Xh.International.parseDate(e,y.a.DateFormat.MDY)),t}},{key:"runRemoteSearch",value:function(e,t,n,r){var i=this;try{v.default.PAssert(1351,e,"Must provide a valid search")}catch(_){v.default.reportError(_)}try{v.default.PAssert(1352,t,"Must provide a valid pane")}catch(_){v.default.reportError(_)}try{v.default.PAssert(1353,n,"Must provide a valid bucket ID")}catch(_){v.default.reportError(_)}try{v.default.PAssert(1354,v.default.isFunction(r),"Must provide a valid search callback")}catch(_){v.default.reportError(_)}var a="-in:chats -in:spam "+e,o=Xh.PaneManager.getPaneById(t),s=this.getAccountIDFromItem(o.getItem())||this.getDefaultAccount(),u=!1,l=0,c=0,d=new tl(e,25,this.requestDataPage.bind(this)),h=function(e){if(l===c&&u){v.default.log("Done Searching: ",l);var a=e?y.a.SearchResultStatus.Error:l>0?y.a.SearchResultStatus.Done:y.a.SearchResultStatus.None;d.isValid()&&i.swapInSearchBucket(n,t),r(a)}},f=function(e){if(l++,e){var t=i._addRemoteEntry(s,e),r=i.getBucketItemStore(n);i._ensureVMLIsForSearchResult(t,r),c++}else c++;h()},p=function(e){u=!0,h(!e)},g=!1,m=new Jl(d.onEntry,(function(e){d.onDone(e),g||(g=!0,d.isValid()&&d.hasResults()?d.getNextPage(f,p):p(e))}));return this._requestRemoteThreads(s,Nc,void 0,a,25,void 0,m.getEntryCB(),m.getDoneCB()),d}},{key:"_addSearchCacheEntryInternal",value:function(e,t,n){var r=!1,i=this._ensureAccountLib(e,this._emailCache);return i[t]||(i[t]={}),i[t][n]||(i[t][n]=!0,r=!0),r}},{key:"_removeSearchCacheEntryInternal",value:function(e,t,n){var r,i=this._getAccountLib(e,this._emailCache);return i&&i[t]&&(r=i[t][n],delete i[t][n]),r}},{key:"_getSearchCacheLabelEntryInternal",value:function(e,t){var n,r=this._getAccountLib(e,this._emailCache);return r&&r[t]&&(n=r[t]),n}},{key:"_addEmailToSearchCache",value:function(e,t){var n=!1;if(t&&v.default.isArray(t.labelIds))for(var r=0,i=0;i<t.labelIds.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n=this._addSearchCacheEntryInternal(t.accountID,t.labelIds[i],e)||n}return n}},{key:"_removeEmailFromSearchCache",value:function(e,t){var n=!1;if(t&&v.default.isArray(t.labelIds))for(var r=0,i=0;i<t.labelIds.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=!!this._removeSearchCacheEntryInternal(t.accountID,t.labelIds[i],e);n=n||a,a&&this._removeThreadLabelVMLI(t.accountID,e,t.labelIds[i])}return n}},{key:"_addEmailLabelToSearchCache",value:function(e,t,n){return this._addSearchCacheEntryInternal(e,n,t)}},{key:"_removeEmailLabelFromSearchCache",value:function(e,t,n){var r=!!this._removeSearchCacheEntryInternal(e,n,t);return r&&this._removeThreadLabelVMLI(e,t,n),r}},{key:"runLocalItemSearch",value:function(e){var t=this.getDescriptorForItem(e.item),n=this._getSearchCacheLabelEntryInternal(t.accountID,t.labelID);if(n)for(var r in n)if(n.hasOwnProperty(r)){var i=this.getCacheData(r);try{v.default.PAssert(1355,i,"Must have valid data for search entry")}catch(o){v.default.reportError(o)}if(i){var a=this._ensureThreadLabelVMLI(i,t.labelID);e.comparator&&!e.comparator(a)||e.each&&e.each(a)}}}},{key:"getRemoteAttachmentData",value:function(e){var t,n=this;try{v.default.PAssert(1356,e.hasField("accountID"),"Must have a valid accountID for a thread")}catch(i){v.default.reportError(i)}var r=function(r,i){r?n._addRemoteEntry(t,r):(e.notifyDataRequestFailed(),n._notifyFailedRequest(t,i))};e.hasField("accountID")?(t=e.getField("accountID"),this.getSyncAccounts().includes(t)&&this._requestRemoteThreadMetadata(t,e.id,e,r)):this.getSyncAccounts().forEach((function(i){n._requestRemoteThreadMetadata(i,e.id,e,(function(n,a){n&&(t=i,n.accountID=t,r(n,a),e.notifyDataMutated(["accountID"],y.a.ChangeType.Local))}))}))}},{key:"_updateThreadFromMessages",value:function(e){var t,n=0,r=this;try{v.default.PAssert(1357,!e.isDeleted||0===e.messages.length,"Should never run an update on a deleted thread with messages")}catch(m){v.default.reportError(m)}var i=e.labelIds,a=Po.a.getDefaultAccountID();"me"===e.accountID&&"me"!==a&&(e.accountID=a),e.labelIds=[],e.date=void 0,e.participants=[],e.count=e.messages.length,e.snippet=e.count>0?e.messages[e.messages.length-1].snippet:"",e.hasPriority=!1;for(var o=0;o<e.messages.length;++o){var s,u,l;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=e.messages[o];try{v.default.PAssert(1358,c.id,"Each message must have a valid ID")}catch(m){v.default.reportError(m)}null===(s=e.labelIds)||void 0===s||s.pushOnlyUniques(c.labelIds);var d=(null===(u=c.labelIds)||void 0===u?void 0:u.indexOf(wc.DRAFT))>=0,h=!1;if((null===(l=c.labelIds)||void 0===l?void 0:l.indexOf(wc.SENT))>=0)for(var f=0,p=0;p<c.to.length;++p){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var g=c.to[p];if(this.isMyAccountID(g.email)){h=!0;break}}else h=!0;(!e.date||c.date&&e.date.isBefore(c.date)&&!d&&h)&&(e.date=c.date),(!e.internalDate||c.internalDate&&e.internalDate.isBefore(c.internalDate))&&(e.internalDate=c.internalDate),c.from&&e.participants.indexOfWithProperty("email",c.from.email)<0&&e.participants.push(c.from),c.resources&&v.default.forEachValue(c.resources,(function(t){r._displayAttachment(t,t.cid)&&(e.hasAttachments=!0)}))}return e.date=e.date?new Date(e.date):new Date(0),v.default.isDateValid(e.date)||(e.date=new Date(0)),e.internalDate=e.internalDate?new Date(e.internalDate):new Date,v.default.isDateValid(e.internalDate)||(e.internalDate=new Date),e.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):e.date,v.default.isDateValid(e.lastModifiedDate)&&!e.lastModifiedDate.isBefore(e.date)||(e.lastModifiedDate=e.date),e.messages.length>0&&(e.subject=e.messages[0].subject,e.subjectLower=e.subject.toLowerCase(),e.from=e.messages[e.messages.length-1].from,e.to=e.messages[0].to),{labelsAdded:i?null===(t=e.labelIds)||void 0===t?void 0:t.removeArray(i):e.labelIds,labelsRemoved:i?i.removeArray(e.labelIds):void 0}}},{key:"_updateAttachmentFromMessages",value:function(e,t){var n=this._updateThreadFromMessages(e.getData());this._handleThreadLabelUpdates(e.getData(),n.labelsAdded,n.labelsRemoved),e.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],t)}},{key:"_createRemoteEntry",value:function(e,t){var n={id:t.id,accountID:e,messages:[],labelIds:[]};try{v.default.PAssert(1359,t.messages,"_createRemoteEntry with no messages",Object.keys(t))}catch(c){v.default.reportError(c)}if(t.messages)for(var r=0,i=0;i<t.messages.length;++i){var a=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=t.messages[i];try{v.default.PAssert(1360,o.id,"Message must have a valid id")}catch(c){v.default.reportError(c)}try{v.default.PAssert(1361,!o.labelIds||o.labelIds.indexOf(wc.CHAT)<0,"Should never receive a chat message")}catch(c){v.default.reportError(c)}o.labelIds&&o.labelIds.indexOf(wc.DRAFT)>=0&&this._notifyDraftMessage(e,t.id,o.id);for(var s={id:o.id,messageID:void 0,internalDate:o.internalDate?new Date(v.default.parseInt(o.internalDate)):new Date,snippet:o.snippet,labelIds:o.labelIds||[],to:[],resources:{},subject:""},u=0;u<o.payload.headers.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=o.payload.headers[u];switch(l.name.toUpperCase()){case"TO":s.to=this.parseEmailAddresses(l.value);break;case"FROM":s.from=this.parseEmailAddress(l.value);break;case"SUBJECT":s.subject=l.value;break;case"MESSAGE-ID":s.messageID=l.value;break;case"IN-REPLY-TO":s.inReplyTo=l.value;break;case"DATE":s.date=this.parseDateHeader(l.value);try{v.default.PAssert(1362,v.default.isDateValid(s.date),"Must have a valid message date1: ",l.value)}catch(c){v.default.reportError(c)}}}v.default.isDateValid(s.date)||(s.date=s.internalDate),s.subject||(s.subject=""),s.messageID||(s.messageID=v.default.generateTempId()),n.messages.push(s)}return this._updateThreadFromMessages(n),n}},{key:"_addRemoteEntry",value:function(e,t){var n=this._createRemoteEntry(e,t);if(this.hasCacheData(n.id)){var r=this.getCacheData(n.id);if(r){this._mergeThreadData(r,n);var i=this._updateThreadFromMessages(n);this._handleThreadLabelUpdates(n,i.labelsAdded,i.labelsRemoved)}var a=this.getChangedFields(r,n);if(this.cacheData(n.id,n,!!r,a),this.fieldsHaveParseEffect(a))if(this.hasAttachment(n.id))this.getAttachment(n.id).notifyDataMutated(a,y.a.ChangeType.Remote)}else this.cacheData(n.id,n),this._updateSearchPanes(n,n.labelIds,[]);return n}},{key:"cacheData",value:function(e,t,r,i){this._verifyMessageState(t,!1);var a=this._addEmailToSearchCache(e,t);if(l()(g()(n.prototype),"cacheData",this).call(this,e,t,r,i),t.messages&&!this._isLoadingLocal&&this._checkUnsyncdMessageContent(t),a){var o=this.getDefaultItemStore();o&&o.updateItems()}return!!t.messages}},{key:"cacheThreadData",value:function(e,t){this._verifyMessageState(t,!0),"string"===typeof t.date&&(t.date=+new Date(t.date)),"string"===typeof t.internalDate&&(t.internalDate=+new Date(t.internalDate)),this._threadCache.saveEntry(t,this.compareCachedData)}},{key:"compareCachedData",value:function(e,t){return this._propertySets[y.a.PluginLoad.Full].some((function(n){return!v.default.deepEqual(e[n],t[n])}))}},{key:"_verifyMessageState",value:function(e,t){}},{key:"ensureThreadDates",value:function(e){(v.default.isString(e.internalDate)||v.default.isNumber(e.internalDate))&&(e.internalDate=new Date(e.internalDate)),(v.default.isString(e.date)||v.default.isNumber(e.date))&&(e.date=new Date(e.date))}},{key:"createEntryFromLocal",value:function(e,t){var n=0;t.subjectLower=t.subject.toLowerCase(),this.ensureThreadDates(t),t.messages=t.messages||[];for(var r=0;r<t.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=t.messages[r];v.default.isString(i.date)?i.date=this.parseDateHeader(i.date):i.date||(i.date=new Date),v.default.isString(i.internalDate)?i.internalDate=new Date(i.internalDate):i.internalDate||(i.internalDate=new Date),v.default.isString(i.to)&&(i.to=this.parseEmailAddresses(i.to)),v.default.isString(i.cc)&&(i.cc=this.parseEmailAddresses(i.cc)),v.default.isString(i.bcc)&&(i.bcc=this.parseEmailAddresses(i.bcc)),v.default.isString(i.from)&&(i.from=this.parseEmailAddress(i.from)),i.to||(i.to=[]),i.resources?(i.resources=Object.assign({},i.resources),delete i.resources._lib):i.resources={};try{v.default.PAssert(1366,i.draftID||i.messageID||v.default.isTempId(i.id),"Remotely saved messages must have a valid message ID")}catch(a){v.default.reportError(a)}try{v.default.PAssert(1367,v.default.isDateValid(i.date),"Must have a valid message date2: ",i.date)}catch(a){v.default.reportError(a)}try{v.default.PAssert(1368,v.default.isDateValid(i.internalDate),"Must have a valid internal message date: ",i.internalDate)}catch(a){v.default.reportError(a)}!v.default.isTempId(i.id)&&!i.draftID&&i.labelIds&&i.labelIds.indexOf(wc.DRAFT)>=0&&this._notifyDraftMessage(t.accountID,e,i.id),i.decoded&&this.reportTrackedStat(Cc)}return this._updateThreadFromMessages(t),t}},{key:"_updateMessageData",value:function(e,t,n){var r=e.getField("messages"),i=r.indexOfWithProperty("id",t);try{v.default.PAssert(1369,i>=0,"Must always be able to find the message being updated")}catch(a){v.default.reportError(a)}i>=0&&(this._mergeMessageData(r[i],n,["labelIds"]),r[i]=n,e.updateField("messages",r),this._updateAttachmentFromMessages(e,y.a.ChangeType.Remote))}},{key:"_mergeMessageData",value:function(e,t,n){try{v.default.PAssert(1370,v.default.isObject(e),"Must pass in a valid old message")}catch(s){v.default.reportError(s)}try{v.default.PAssert(1371,v.default.isObject(t),"Must pass in a valid new message")}catch(s){v.default.reportError(s)}if(e.modifiedOffline){var r=e.modifiedOffline;if(v.default.isArray(r))for(var i=0,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t[r[a]]=e[r[a]]}else Object.keys(e).forEach((function(n){t[n]=e[n]})),Object.keys(t).forEach((function(n){t[n]=e[n]}));t.modifiedOffline=e.modifiedOffline}for(var o in n&&n.forEach((function(n){return t[n]=e[n]})),e)if(e.hasOwnProperty(o))switch(o){case"snippet":this._pendingDraftUpdates[e.id]&&(t[o]=e[o]);break;default:t.hasOwnProperty(o)||(t[o]=e[o])}}},{key:"_mergeMessagesData",value:function(e,t,n){var r=0;try{v.default.PAssert(1372,v.default.isArray(e),"Must have a valid old messages array")}catch(d){v.default.reportError(d)}try{v.default.PAssert(1373,v.default.isArray(t),"Must have a valid new messages array")}catch(d){v.default.reportError(d)}try{v.default.PAssert(1374,e!==t,"Should not pass in the same array for old and new")}catch(d){v.default.reportError(d)}for(var i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i],o=t.indexOfWithProperty("id",a.id);if(o>=0){var s=t[o];try{v.default.PAssert(1375,s,"Must have a valid new message")}catch(d){v.default.reportError(d)}this._mergeMessageData(a,s,n)}else if(a.labelIds.indexOf(wc.DRAFT)>=0)if(v.default.isTempId(a.id)){var u=t.indexOfWithProperty("messageID",a.inReplyTo);try{v.default.PAssert(1376,u>=0,"Must be able to find the message being replied to")}catch(d){v.default.reportError(d)}u>=0&&t.splice(u+1,0,a)}else if(a.inReplyTo){var l=t.indexOfWithProperty("inReplyTo",a.inReplyTo);if(l>=0){var c=t[l];try{v.default.PAssert(1377,c,"Must have a valid new message")}catch(d){v.default.reportError(d)}this._mergeMessageData(a,c,n)}}}}},{key:"_mergeThreadData",value:function(e,t){this.reportTrackedStat(Ec);try{v.default.PAssert(1379,!e.isDeleted,"Should never merge message data in a deleted thread")}catch(s){v.default.reportError(s)}if(this._mergeMessagesData(e.messages,t.messages,["resources","draftID"]),e.modifiedOffline){var n=0,r=e.modifiedOffline;try{v.default.PAssert(1380,v.default.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(s){v.default.reportError(s)}for(var i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];switch(a){case"messages":break;default:t[a]=e[a]}}t.modifiedOffline=e.modifiedOffline}for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o]);t.labelIds=e.labelIds}},{key:"_shouldCacheThread",value:function(e){var t=!0;try{v.default.PAssert(1381,e&&e.messages,"Thread should have messages",e&&Object.keys(e))}catch(a){v.default.reportError(a)}if(e.messages)for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.messages[r];if(i.labelIds&&(i.labelIds.indexOf(wc.SPAM)>=0||i.labelIds.indexOf(wc.CHAT)>=0)){t=!1;break}}return t}},{key:"_shouldCacheMessageData",value:function(e){var t=!1,n=this._getFullSyncTime(),r=this._getUnreadSyncTime();if(e.date.isAfter(n))t=!0;else if(e.date.isAfter(r))for(var i=0,a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e.messages[a];if(this.isPriorityData(o)){t=!0;break}}return t}},{key:"refreshThreadCacheData",value:function(e,t,n,r,i){var a=this;this._requestRemoteThreadMetadata(e,t,void 0,(function(n,o){if(n)if(a._shouldCacheThread(n)){var s=a._addRemoteEntry(e,n);a.cacheThreadData(t,a.serializeExternalData(s)),i&&i(!0)}else a._deleteCachedThread(e,t,i);else o&&o.error&&o.error.code===y.a.HTTPStatusCode.NotFound?a._deleteCachedThread(e,t,i):(r(e,t),i&&i(!1))}))}},{key:"_deleteCachedThread",value:function(e,t,n){if(this.hasCacheData(t)){for(var r=0,i=this.getAttachment(t),a=i.getField("messages"),o=0;o<a.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;Xh.menus.isComposeOpenForEmail(a[o].id)&&(this._clearPendingDraftUpdate(i,a[o].id),K.a.fireEvent("EmailCompose","onClosed",[]),Xh.menus.closeComposeEmail(i,a[o])),this._rawCache.removeEntry(a[o].id)}i.updateField("isDeleted",!0),i.updateField("messages",[]),this._updateAttachmentFromMessages(i,y.a.ChangeType.Remote)}this._threadCache.removeEntry(t),n&&n(!0)}},{key:"_deleteCachedMessage",value:function(e,t,n){var r=this;try{v.default.PAssert(1382,n,"Must specify a valid message ID to remove from thread")}catch(u){v.default.reportError(u)}if(this.hasCacheData(t))for(var i=0,a=this.getAttachment(t),o=a.getField("messages"),s=0;s<o.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o[s].id===n){o.removeAt(s),this._updateAttachmentFromMessages(a,y.a.ChangeType.Remote),a.updateField("messages",o);break}}this._threadCache.getEntry(t,!0).then((function(e){if(e)for(var i=0,a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.messages[a].id===n){e.messages.removeAt(a),r.cacheThreadData(t,e);break}}})),this._rawCache.removeEntry(n)}},{key:"setLastModifiedDate",value:function(e,t,n){var r=this;this.hasCacheData(t)&&this.getAttachment(t).updateField("lastModifiedDate",n);this._threadCache.getEntry(t,!0).then((function(e){e&&(e.lastModifiedDate=n,r.cacheThreadData(t,e))}))}},{key:"addLabelsToMessage",value:function(e,t,n,r,i){var a=this;if(this.hasCacheData(t)){for(var o=0,s=this.getAttachment(t),u=s.getField("messages"),l=0;l<u.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if((!n||u[l].id===n)&&(u[l].labelIds.pushOnlyUniques(r),n))break}this._updateAttachmentFromMessages(s,i),s.updateField("messages",u,void 0,!0);var c=s.getField("labelIds");c&&(c.pushOnlyUniques(r),s.updateField("labelIds",c,void 0,!0))}this._threadCache.getEntry(t,!0).then((function(e){if(e){var i=0,o=!1;e.labelIds&&e.labelIds.pushOnlyUniques(r);for(var s=0;s<e.messages.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!n||e.messages[s].id===n){e.messages[s].labelIds.pushOnlyUniques(r),a.cacheThreadData(t,e),o=!0;break}}try{v.default.PAssert(1384,o,"Must have found message to add labels to")}catch(u){v.default.reportError(u)}}}))}},{key:"removeLabelsFromMessage",value:function(e,t,n,r,i){var a=this;if(this.hasCacheData(t)){for(var o=0,s=this.getAttachment(t),u=s.getField("messages"),l=0;l<u.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(!n||u[l].id===n){for(var c=0,d=0;d<r.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;u[l].labelIds.remove(r[d])}if(n)break}}this._updateAttachmentFromMessages(s,i),s.updateField("messages",u,void 0,!0);var h=s.getField("labelIds");if(h){for(var f=0,p=0;p<r.length;++p){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;h.remove(r[p])}s.updateField("labelIds",h,void 0,!0)}}this._threadCache.getEntry(t,!0).then((function(e){if(e){var i=0,o=!1;if(e.labelIds)for(var s=0,u=0;u<r.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e.labelIds.remove(r[u])}for(var l=0;l<e.messages.length;++l){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!n||e.messages[l].id===n){for(var c=0,d=0;d<r.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;e.messages[l].labelIds.remove(r[d])}a.cacheThreadData(t,e),o=!0;break}}try{v.default.PAssert(1385,o,"Must have found message to remove labels from")}catch(h){v.default.reportError(h)}}}))}},{key:"changeMessageAccount",value:function(){var e=Bo()(jo.a.mark((function e(t,n,r,i,a,o){var s,u,l;return jo.a.wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:try{v.default.PAssert(1386,o,"Must supply a valid from contact")}catch(d){v.default.reportError(d)}return u=i!==t.getField("accountID"),l=this._findDraft(t,n,r),u&&this.discardDraft(t,l.id,l.draftID,(function(e){try{v.default.PAssert(1387,e,"Must successfully delete remote draft")}catch(d){v.default.reportError(d)}})),l.from=o,l.replyTo=this.getReplyToAddress(o.email),e.next=8,fs.replaceSignature(l.decoded,this.getSignature(a));case 8:return l.decoded=e.sent,s=u?this.createDraft(i,void 0,void 0,l):this.updateDraft(t,l.id,l.draftID,l,!0,!0,(function(e){try{v.default.PAssert(1388,e,"Must be able to successfully update the draft when swiching sending accounts")}catch(d){v.default.reportError(d)}})),e.abrupt("return",s);case 11:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()},{key:"_ensureVMLIsForSearchResult",value:function(e,t){try{v.default.PAssert(1389,t,"Should never be ensuring a search VMLI in the default item store")}catch(o){v.default.reportError(o)}var n="S~"+e.accountID,r=this._ensureVMLIsForAccount(n,t),i=this._createThreadID(n,"",e.id);if(!t.hasItem(i)){var a=t.createItem(i,this._getTextForItem(e.id,e.accountID),r.id);r.insertSorted(a,this.sortFn)}}},{key:"_removeVMLIFromSearchResult",value:function(e,t){try{v.default.PAssert(1390,t,"Should never be ensuring a search VMLI in the default item store")}catch(i){v.default.reportError(i)}var n="S~"+e.accountID,r=this._createThreadID(n,"",e.id);t.hasItem(r)&&t.destroyItem(r)}},{key:"_createThreadID",value:function(e,t,n){return"T~"+e+"~"+t+"~"+n}},{key:"_getItemProps",value:function(e,t){var n;return t.isNamed(sd.PRI0)?n={priority:y.a.VMLIFlag.P0}:t.isNamed(sd.PRI1)?n={priority:y.a.VMLIFlag.P1}:t.isNamed(sd.PRI2)&&(n={priority:y.a.VMLIFlag.P2}),n}},{key:"_ensureThreadLabelVMLI",value:function(e,t,n){n=n||this.getDefaultItemStore();var r,i=this._getLabelByID(e.accountID,t),a=this._ensureVMLIsForLabel(e.accountID,i,n),o=this._createThreadID(e.accountID,t,e.id);if(this.reportTrackedStat(kc),n.hasItem(o))r=n.getItem(o);else{this.reportTrackedStat(Sc);var s=this._getItemProps(e,i);r=n.createItem(o,this._getTextForItem(e.id,e.accountID),a.id,s),a.insertSorted(r,this.threadSortFn,!1)}return r}},{key:"_removeThreadLabelVMLI",value:function(e,t,n,r){r=r||this.getDefaultItemStore();var i=this._createThreadID(e,n,t);r.hasItem(i)&&r.destroyItem(i)}},{key:"_getRequiredSearchLabels",value:function(e){for(var t=0,n=[wc.INBOX],r=e.split(" "),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=r[i].split(":");a&&2===a.length&&("label"!==a[0]&&"category"!==a[0]&&"is"!==a[0]||n.push(a[1].toUpperCase()))}return n}},{key:"_handleThreadLabelUpdates",value:function(e,t,n){Xh.PaneUpdateBatcher.beginUpdateItems();var r=!1;if(t)for(var i=0,a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r=this._addEmailLabelToSearchCache(e.accountID,e.id,t[a])||r}if(n)for(var o=0,s=0;s<n.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;r=this._removeEmailLabelFromSearchCache(e.accountID,e.id,n[s])||r}this._updateSpecialLabels(e),this._updateSearchPanes(e,t,n),r&&this.getDefaultItemStore().updateItems(),Xh.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSearchPanes",value:function(e,t,n){var r=this;Xh.PaneUpdateBatcher.beginUpdateItems(),Xh.PaneManager.runForEachPane((function(i){if(i.isSearchingRemote()){var a=r.getActiveItemStore(i.id),o=i.search.getRemoteValue(),s=r._getRequiredSearchLabels(o),u=!1,l=!1;s.forEach((function(e){n&&n.indexOf(e)>=0?u=!0:t&&t.indexOf(e)>=0&&(l=!0)})),u?a!==r.getDefaultItemStore()&&(v.default.focusedPane===i&&0===t.length&&n&&1===n.length&&n[0]===wc.UNREAD||r._removeVMLIFromSearchResult(e,a)):l&&a!==r.getDefaultItemStore()&&r._ensureVMLIsForSearchResult(e,a)}}),this.getPaneType()),Xh.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSpecialLabels",value:function(e){this._threadIsArchived(e)?this._addEmailLabelToSearchCache(e.accountID,e.id,ad):this._removeEmailLabelFromSearchCache(e.accountID,e.id,ad),this._addEmailLabelToSearchCache(e.accountID,e.id,od)}},{key:"_ensureVMLIsForLabel",value:function(e,t,n){try{v.default.PAssert(1391,t,"Must specify a valid label")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1392,t instanceof uc,"Must pass in a valid label object")}catch(u){v.default.reportError(u)}n=n||this.getDefaultItemStore();var r="L~"+e+"~"+t.getLabelID(),i=n.getItem(r),a=t.getDisplayText(!0);if(i)i.getParsedText()!==a&&i.setText(a,y.a.ChangeType.Auto);else{var o;if(t.hasAncestors()){var s=this._getLabelByName(e,t.getParent().getRawName(),!0);o=s?this._ensureVMLIsForLabel(e,s,n):this._ensureVMLIsForAccount(e,n)}else o=this._ensureVMLIsForAccount(e,n);i=n.createItem(r,a,o.id),o.insertSorted(i,this.sortFn)}return i}},{key:"getVMLIForAccount",value:function(e){if(e)return this._ensureVMLIsForAccount(e)}},{key:"getVMLIForLabel",value:function(e,t){return this._ensureVMLIsForLabel(e,t)}},{key:"getLabelForVMLI",value:function(e){var t,n=this.getDescriptorForItem(e);return n.accountID&&n.labelID&&(t=this._getLabelByID(n.accountID,n.labelID)),t}},{key:"_getLabelIDFromItem",value:function(e){var t,n=e.id;(n.startsWith("L~")||n.startsWith("T~"))&&(t=n.substr(n.indexOf("~",2)+1));try{v.default.PAssert(1393,!t||v.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(r){v.default.reportError(r)}try{v.default.PAssert(1394,!t||t.length>3,"Label ID should be longer than a couple of chars")}catch(r){v.default.reportError(r)}return t}},{key:"_getThreadIDFromItem",value:function(e){return this._getThreadID(e.id)}},{key:"_getThreadID",value:function(e){var t;e.startsWith("T~")?t=e.substr(e.lastIndexOf("~")+1):e.startsWith("A~")||e.startsWith("L~")||e.startsWith("R~")||(t=e);try{v.default.PAssert(1395,!t||v.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in thread ID")}catch(n){v.default.reportError(n)}try{v.default.PAssert(1396,!t||t.length>3,"Thread ID should be longer than a couple of chars")}catch(n){v.default.reportError(n)}return t}},{key:"isAccountItem",value:function(e){return e.id.startsWith("A~")}},{key:"isLabelItem",value:function(e){return e.id.startsWith("L~")}},{key:"isThreadItem",value:function(e){return e.id.startsWith("T~")}},{key:"getAttachmentClass",value:function(){return["plugin_gmail"]}},{key:"googleScopes",value:function(){return[y.a.GScope.GmailModify,y.a.GScope.GmailCompose]}},{key:"getDependencies",value:function(){return[]}},{key:"verifyAuthorization",value:function(e){return!this.getSetting(this.Settings.IsEnabled)||this.isCurrentlyAuthorized(e)}},{key:"handleUnauthorized",value:function(e){0}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"handleTapClick",value:function(e,t,n,r){var i=r.target;try{v.default.PAssert(1397,t,"Gmail tapped but is not actually a pane",v.default.getElementPath(i))}catch(a){v.default.reportError(a)}if(t)return this.openEmailByItem(e,t)}},{key:"isMyAccountID",value:function(e){try{v.default.PAssert(1398,"me"!==e||v.default.isDemoMode(),"Should not be checking me")}catch(n){v.default.reportError(n)}var t=Po.a.getDefaultAccountID();try{v.default.PAssert(1399,v.default.isDemoMode()||"me"!==t,"Should not be checking against current account until loaded")}catch(n){v.default.reportError(n)}return e===t}},{key:"getURLForAttachment",value:function(e){var t=e.getField("accountID");return t&&"me"!==t||(t=Po.a.getDefaultAccountID()),t?"https://mail.google.com/mail/u/"+t+"#inbox/"+e.id:"https://mail.google.com/mail/u/0/#all/"+e.id}},{key:"createPrintURLForThread",value:function(e){var t=e.getField("accountID");return"me"===t&&(t=Po.a.getDefaultAccountID()),"https://mail.google.com/mail/b/"+t+"/?ui=2&view=pt&search=all&th="+e.id}},{key:"openEmailByItem",value:function(e,t,n){var r=this,i=e.getAttachmentByPlugin(y.a.PluginID.Gmail);if(Xh.supportGmailViews())Xh.EmailPreview.open(e,i,t,n);else if(i&&(i!==Xh.EmailPreview.getThreadAttach()||!Xh.EmailPreview.isOpen()||n)){var a=this.getCacheData(i.id),o=i.getField("accountID");if(a&&o&&this.hasSyncAccount(o))return this.isAttachmentDraftOnly(i)?(this.sendEvent("Tap_DesktopDraft"),this.loadThread(i,(function(){Xh.menus.openComposeEmail(r,{threadID:i.id})}))):Xh.EmailPreview.open(e,i,t,n),!0;var s=this.getURLForAttachment(i);Xh.openUrl(s)}}},{key:"isEmailOpenByItem",value:function(e,t){var n=e.getAttachmentByPlugin(y.a.PluginID.Gmail);return n&&Xh.EmailPreview.isOpenOnPane(t)&&Xh.EmailPreview.isOpenOnThread(n)}},{key:"_convertRawMessage",value:function(e,t,n,r){var i={id:t,payload:n},a=this._getMessageFromAttachment(e,t);try{v.default.PAssert(1400,a,"Must be able to get message metadata")}catch(o){v.default.reportError(o)}i.labelIds=a.labelIds,i.messageID=a.messageID,i.snippet=a.snippet,i.internalDate=n.internalDate,r(i)}},{key:"getThreadData",value:function(e,t,n){var r=this;if(0!==e.getField("messages").length)return this._getThreadData(e,t,n);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,void 0,(function(i,a){var o=!0;i?r._addRemoteEntry(e.getField("accountID"),i):a&&a.error&&a.error.code===y.a.HTTPStatusCode.NotFound&&(o=!1),o?r._getThreadData(e,t,n):t(!1,"The conversation that you requested no longer exists.")}))}},{key:"_getThreadData",value:function(e,t,n){for(var r=0,i=e.getField("messages"),a=i.length,o=0,s=!1,u=!1,l={},c=function(){if(!u&&o===a&&s){var e=0;u=!0;for(var n={messages:[]},r=0,c=0;c<i.length;++c){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var d=l[i[c].id];d?n.messages.push(d):++r}try{v.default.PAssert(1401,n.messages.length+r===i.length,"Messages should always be found for thread")}catch(h){v.default.reportError(h)}0===i.length?t(void 0,"This message is not cached locally and we could not contact the remote server."):t(n)}},d=function(e){e&&(l[e.id]=e),++o,c()},h=0;h<i.length;++h){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var f=i[h];this.getMessageData(e,f.id,d)}s=!0,setTimeout(c,0)}},{key:"getMessageData",value:function(e,t,n){var r=this;this._rawCache.getEntry(t).then((function(i){i?r._convertRawMessage(e,t,i,n):(v.default.log("Warning: Local message cache missing email display data: ",e.id,t),r._requestRemoteMessageDataRaw(e.getField("accountID"),e.id,t,!0,n))}))}},{key:"_handleThreadLoaded",value:function(e,t,n,r){var i=this._pendingThreadLoads[e];try{v.default.PAssert(1402,i,"Must always have a valid pending load when handling laod")}catch(s){v.default.reportError(s)}if(delete this._pendingThreadLoads[e],i)for(var a=0,o=0;o<i.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;try{i[o](t,n,r)}catch(u){v.default.reportError(u)}}}},{key:"loadThread",value:function(e,t){try{v.default.PAssert(1403,0===this._loadThreadMutex,"Should never have an outstanding lock on thread load")}catch(n){v.default.reportError(n)}this._loadThreadMutex++;e.getField("accountID");this._loadThread(e,t,8e3),this._loadThreadMutex--}},{key:"_loadThread",value:function(e,t,n){var r=this,i=this.isAttachmentDraftOnly(e),a=this._pendingThreadLoads[e.id];if(a)v.default.log("Duped pending thread load: ",e.id),a.push(t);else if(this._pendingThreadLoads[e.id]=[t],e.getField("dataLoaded")||e.isLocalOnlyAttachment()){for(var o=0,s=e.getField("messages"),u=!1,l=!1,c=0,d=0,h=s.length,f=0,p=function(){u&&c===d&&(h===f&&(l=!0),r._handleThreadLoaded(e.id,!0,l))},g=function(){var t=Bo()(jo.a.mark((function t(n){var i;return jo.a.wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:if(d++,!n){t.next=9;break}return""===n.decoded&&(n.decoded=void 0),t.next=5,r._parseMailMessage(n);case 5:i=t.sent;try{v.default.PAssert(1404,i,"Must be able to parse message")}catch(o){v.default.reportError(o)}r._updateMessageData(e,i.id,i),l=!0;case 9:p();case 10:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=0;m<s.length;++m){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var y=s[m];void 0===y.decoded?(y.decoded="",c++,this.getMessageData(e,y.id,g)):(y.decoded||y.labelIds.indexOf(wc.DRAFT)>=0)&&f++}u=!0,p()}else if(i){var _=e.getField("messages")[0];this.getMessageData(e,_.id,function(){var t=Bo()(jo.a.mark((function t(n){var i;return jo.a.wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return t.next=3,r._parseMailMessage(n);case 3:i=t.sent;try{v.default.PAssert(1405,i,"Must be able to parse message")}catch(o){v.default.reportError(o)}r._updateMessageData(e,i.id,i);case 6:l=!0,r._handleThreadLoaded(e.id,!0,l);case 8:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}())}else this.getThreadData(e,function(){var t=Bo()(jo.a.mark((function t(n,i){return jo.a.wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:if(!n){t.next=3;break}return t.next=3,r._parseMailThread(e,n);case 3:l=!0,r._handleThreadLoaded(e.id,!!e.getField("dataLoaded"),l,i);case 5:case"end":return t.stop()}}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),n)}},{key:"forceReloadMessage",value:function(e,t,n){this._requestRemoteMessageData(e,t,n)}},{key:"_verifyEmailAttachments",value:function(e,t,n){var r,i,a=this,o=this._findDraft(e,t,n);return o?v.default.forEachValue(o.resources,(function(e){e.uploader&&(e.uploader.hasError()?r="There was an error uploading one or more attachments. Please remove them or try uploading again.":e.uploader.isDone()||(r="One or more of your attachments is still uploading.",i=function(e){a.onEmailReadyToSend(o,(function(){Xh.toasts.clearMessage(e)}))}))})):r="Could not find message to verify attachments.",r?{message:r,handleMessageFn:i}:void 0}},{key:"_verifyEmailRecipients",value:function(e,t,n){var r,i=this._findDraft(e,t,n);if(i)if(i.to&&0!==i.to.length)for(var a=0,o=0;o<i.to.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i.to[o];s&&s.email?v.default.isEmail(s.email)||(r="You have entered an invalid email"):r="You have entered a contact with an invalid email address"}else r="You must enter at least one person to send this email to";else r="Unable to find the message you are trying to send";return r?{message:r}:void 0}},{key:"_formatAddressText",value:function(e,t,n){return e?n?'"'+v.default.encodeMIMEHeader(e)+'" <'+t+">":'"'+e+'" <'+t+">":t}},{key:"_createAddressTextFromTokens",value:function(e,t){var n="";if(e)for(var r=0,i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i];v.default.isEmail(a.email)&&(0!==i&&(n+=", "),n+=this._formatAddressText(a.text,a.email,t))}try{v.default.PAssert(1406,!n.startsWith(","),"Should not start with a comma")}catch(o){v.default.reportError(o)}try{v.default.PAssert(1407,!n.endsWith(","),"Should not end with a comma")}catch(o){v.default.reportError(o)}try{v.default.PAssert(1408,n.indexOf(",,")<0,"Should not have two commas in a row")}catch(o){v.default.reportError(o)}return n.trim()}},{key:"_createRFC822Message",value:function(e,t,n,r){var i=this;try{v.default.PAssert(1409,t,"Must specify a valid draft")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1410,t.contentType,"Must specify a valid content type for the draft")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1411,t.from,"Must be able to get the from information for a user.")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1412,!t.inReplyTo||t.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+t.inReplyTo)}catch(u){v.default.reportError(u)}try{v.default.PAssert(1413,!t.references||t.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+t.references)}catch(u){v.default.reportError(u)}var a=t.from.text,o=t.from.email,s=new gc(this);s.updateFromDraft(e,t,a,o,n,(function(){var e=s.generateBlob();r(i._encodeEmail(e))}))}},{key:"createSignature",value:function(e){var t=this.getSignature(e);return t?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+t+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+t+"</div>":'<div class="gmail_signature"></div>'}},{key:"createReplyQuote",value:function(e){var t;e&&(t='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+e.date.toString("MMM dd, y")+" at "+e.date.toString("hh:mm tt")+", "+v.default.escape(this._createAddressTextFromTokens([e.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+e.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n");return t}},{key:"createForwardQuote",value:function(e){var t,n=v.default.isArray(e.to)?e.to:[e.to];return e&&(t='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+v.default.escape(this._createAddressTextFromTokens([e.from]))+"<br>\nDate: "+e.date.toString("ddd, MMM dd, y")+" at "+e.date.toString("hh:mm tt")+"<br>\nSubject: "+e.subject+"<br>\nTo: "+v.default.escape(this._createAddressTextFromTokens(n))+"\n<br>\n<br>\n"+e.decoded+"\n</div>\n<br>\n"),t}},{key:"createMessageBody",value:function(e,t,n){var r,i=this.createSignature(t);if(n===y.a.EmailResponseMode.Reply||n===y.a.EmailResponseMode.ReplyAll)r=this.createReplyQuote(e);else if(n===y.a.EmailResponseMode.Forward)r=this.createForwardQuote(e);else try{v.default.PAssert(1414,!1,"Invalid email response mode: "+n)}catch(a){v.default.reportError(a)}return this.getSetting(this.Settings.InsertSignatureAboveReplies)?i+r:r+i}},{key:"_sendEmail",value:function(e,t,n,r){var i=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t);var a=this._findDraft(e,t,n);this._createRFC822Message(e.getData(),a,!0,(function(t){var n={raw:t};e.isLocalOnlyAttachment()||(n.threadId=e.id);var o=Du.a.fns("gmail").users.messages.send.packedFn,s={userId:e.getField("accountID"),resource:n};i._queueRemoteRequestMulti(e.getField("accountID"),o,s,(function(t){i._updateLocalDraftFromSend(e,a.id,t,r)}),(function(t){i._notifySendFailed(),r(!1,t),i._notifyFailedRequest(e.getField("accountID"),t)}),void 0,Uc)}))}},{key:"_shouldSaveMessageContent",value:function(e,t){var n;return(null===(n=t.labelIds)||void 0===n?void 0:n.indexOf(wc.DRAFT))>=0}},{key:"compactCacheField",value:function(e,t){var n,r=0;switch(t){case"messages":n=[];for(var i=e[t],a={},o=function(e){var t=v.default.clone(e);delete t.data,delete t.size,delete t.uploader,a[e.id]=t},s=0;s<i.length;++s){var u=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var l=i[s],c={},d=0;d<ld.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=l[ld[d]];void 0!==h&&null!==h&&(c[ld[d]]=l[ld[d]])}this._shouldSaveMessageContent(e,l)||(delete c.decoded,delete c.mimeType,delete c.contentType,delete c.listUnsubscribe),c.resources&&(v.default.forEachValue(c.resources,o),c.resources=a),n.push(c)}break;default:n=e[t]}return n}},{key:"_generateUndoRedo",value:function(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.DiscardDraft,{undo:v.default.emptyFn,redo:this.runDiscardDraft})}},{key:"performAction",value:function(e,t,n,r,i){try{v.default.PAssert(1415,e,"Must supply a valid action")}catch(u){v.default.reportError(u)}try{v.default.PAssert(1416,v.default.isBoolean(t),"Invalid preventUndo param")}catch(u){v.default.reportError(u)}var a;this.beginAction(t);var o=[n,r,i];try{a=this._undoStack.runAction(this.id,e,o)}catch(l){v.default.reportError(l)}if(this._undoStack.isUndoableAction()){var s=[n];v.default.isArray(a)?s.pushArray(a):s.push(a),this._undoStack.performAction(this.id,e,{undoParams:s,redoParams:o})}this.endAction()}},{key:"performActions",value:function(e,t){var n=0;this.beginAction(t);for(var r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this.performAction(e[r].action,!1,e[r].attach,e[r].param)}this.endAction()}},{key:"beginAction",value:function(e){this._undoStack.beginAction(e)}},{key:"endAction",value:function(){this._undoStack.endAction()}},{key:"handleUndo",value:function(){this._undoStack.undoAction()}},{key:"handleRedo",value:function(){this._undoStack.redoAction()}},{key:"supportUsageCache",value:function(){return!0}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"_matchParticipant",value:function(e,t){var n=!1;return e&&(e.text&&(n=e.text.toLowerCase().indexOf(t)>=0),!n&&e.email&&(n=e.email.toLowerCase().indexOf(t)>=0)),n}},{key:"_matchLabels",value:function(e,t){return this.hasLabelLike(e.accountID,e.id,t)}},{key:"_matchEntry",value:function(e,t){return e.subjectLower.indexOf(t)>=0||this._matchParticipant(e.from,t)||this._matchLabels(e,t)}},{key:"matchAttachment",value:function(e,t){return this._matchEntry(e.getData(),t)}},{key:"findMatchExact",value:function(){}},{key:"findMatchLike",value:function(e,t){var n=this,r=e.toLowerCase();return this.findCachedItemsByFn((function(e){return n._matchEntry(e,r)}),t)}},{key:"isGmailItem",value:function(e){return!!e.getAttachmentByPlugin(this.id)}},{key:"itemHasLabelByID",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);return!!n&&this.attachmentHasLabelByID(n,t)}},{key:"itemHasLabel",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);return!!n&&this.attachmentHasLabel(n,t)}},{key:"itemHasFullLabel",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);return!!n&&this.attachmentHasFullLabel(n,t)}},{key:"itemHasDraft",value:function(e){return this.itemHasLabelByID(e,wc.DRAFT)}},{key:"isItemUnread",value:function(e){return this.itemHasLabelByID(e,wc.UNREAD)}},{key:"isItemImportant",value:function(e){return this.itemHasLabelByID(e,wc.IMPORTANT)}},{key:"isItemStarred",value:function(e){return this.itemHasLabelByID(e,wc.STARRED)}},{key:"isItemArchived",value:function(e){var t=e.getAttachmentByPlugin(this.id);return!!t&&this.attachmentIsArchived(t)}},{key:"isItemTrashed",value:function(e){return this.itemHasLabelByID(e,wc.TRASH)}},{key:"isItemFullTrashed",value:function(e){return this.itemHasFullLabel(e,id.TRASH)}},{key:"isItemSpam",value:function(e){return this.itemHasLabelByID(e,wc.SPAM)}},{key:"isDisplayItem",value:function(e,t){var n=!1;return this.isItemSpam(e)||!this.isThreadItem(e)||this.isItemFullTrashed(e)&&!t||(n=!0),n}},{key:"getItemPriority",value:function(e){return e.hasPluginAttachment(this.id)?this.getAttachmentPriority(e.getAttachmentByPlugin(this.id)):0}},{key:"_getCompDateForItem",value:function(e){var t=0,n=e.getAttachmentByPlugin(this.id);if(n){var r=n.getField("lastModifiedDate");if(r)t=r.getTime();else{var i=n.getField("internalDate");i&&(t=i.getTime())}}return t}},{key:"_timeCompare",value:function(e,t){return e>t?1:e<t?-1:0}},{key:"threadSortFn",value:function(e,t){return this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"threadSortPriorityFn",value:function(e,t){var n=e.getAttachmentByPlugin(this.id),r=t.getAttachmentByPlugin(this.id),i=this.getAttachmentPriority(n),a=this.getAttachmentPriority(r),o=this.attachmentHasLabelByID(n,wc.STARRED),s=this.attachmentHasLabelByID(r,wc.STARRED);return i>a?-1:i<a?1:o&&!s?-1:s&&!o?1:this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"labelSortFn",value:function(e,t){return e.displayCompare(t)}},{key:"labelVMLISortFn",value:function(e,t){var n=this._getLabelByID(this.getAccountIDFromItem(e),this._getLabelIDFromItem(e)),r=this._getLabelByID(this.getAccountIDFromItem(t),this._getLabelIDFromItem(t));return this.labelSortFn(n,r)}},{key:"getCssClass",value:function(e,t){if(t&&t.type===this.getPaneType())return v.default.classNames({starred:this.attachmentHasLabelByID(e,wc.STARRED)},{unread:this.attachmentHasLabelByID(e,wc.UNREAD)},{p0:this.attachmentHasLabel(e,sd.PRI0)},{p1:this.attachmentHasLabel(e,sd.PRI1)},{p2:this.attachmentHasLabel(e,sd.PRI2)})}},{key:"getUnsyncdMessageCount",value:function(){return this._numUnsyncdMessages}},{key:"getSyncdMessageCount",value:function(){return this._numSyncdMessages}},{key:"_checkUnsyncdMessageContent",value:function(e){var t=this;e.messages.forEach((function(n){n.cached?(t.reportTrackedStat(Pc),t._numSyncdMessages++):n.cachedError?t.reportTrackedStat(Ic):t._shouldCacheMessageData(e)?t._rawCache.getEntry(n.id).then((function(r){r||(t.reportTrackedStat(Dc),t._notifyUnsyncdMessage(e.accountID,e.id,n.id))})):t.reportTrackedStat(Tc)}))}},{key:"_notifyUnsyncdMessage",value:function(e,t,n){v.default.isTempId(t)||v.default.isTempId(n)||(this._handleSyncContentCacheOp(this._unsyncdMessages,e,t,n),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())}},{key:"_notifyContentCached",value:function(e,t,n){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,e,t,n)}},{key:"_handleSyncContentCacheOp",value:function(e,t,n,r){var i=this._ensureAccountLib(t,e);i[n]?!0!==i[n]&&i[n].indexOf(r)<0&&i[n].push(r):i[n]=!r||[r]}},{key:"_removeUnsyncdMessage",value:function(e,t,n){this.reportTrackedStat(xc),this._numUnsyncdMessages--;var r=this._getAccountLib(e,this._unsyncdMessages);if(n){var i=r[t];i.remove(n),0===i.length&&delete r[t]}else delete r[t];v.default.isEmpty(r)&&this._deleteAccountLib(e,this._unsyncdMessages)}},{key:"_setCachedFieldForMessage",value:function(e,t,n){var r=this;if(this.hasCacheData(t))for(var i=0,a=this.getAttachment(t).getField("messages"),o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;(!0===n||n.indexOf(a[o].id)>=0)&&(a[o].cached=!0)}this._threadCache.getEntry(t,!0).then((function(e){if(e){for(var i=0,a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e.messages[a];(!0===n||n.indexOf(o.id)>=0)&&(o.cached=!0)}r.cacheThreadData(t,e)}}))}},{key:"_updateCachedErrorFieldForMessage",value:function(e,t,n){var r=this;if(this.hasCacheData(t))for(var i=0,a=this.getAttachment(t).getField("messages"),o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;(!0===n||n.indexOf(a[o].id)>=0)&&(a[o].cachedError?a[o].cachedError++:a[o].cachedError=1)}this._threadCache.getEntry(t,!0).then((function(e){if(e){for(var i=0,a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e.messages[a];(!0===n||n.indexOf(o.id)>=0)&&(o.cached?o.cachedError++:o.cachedError=1)}r.cacheThreadData(t,e)}}))}},{key:"_processSyncdContent",value:function(){for(var e in this._pendingSyncdMessages)if(this._pendingSyncdMessages.hasOwnProperty(e)){var t=this._pendingSyncdMessages[e];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(v.default.isArray(r)){for(var i=0,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a];this._removeUnsyncdMessage(e,n,o)}this._setCachedFieldForMessage(e,n,r)}else!0===r&&this._removeUnsyncdMessage(e,n)}}this._pendingSyncdMessages={}}},{key:"_processSyncErrors",value:function(e){for(var t in v.default.log("Process Sync Errors: ",e),e)if(e.hasOwnProperty(e)){var n=e[t];for(var r in n)if(n.hasOwnProperty(r)){var i=0,a=n[r];try{v.default.PAssert(1417,v.default.isArray(a),"Must have a valid message ID list")}catch(u){v.default.reportError(u)}for(var o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o];this._removeUnsyncdMessage(t,r,s)}this._updateCachedErrorFieldForMessage(t,r,a)}}}},{key:"driveMessageContentSync",value:function(e){var t=this;if(Xh.cacheManager.hasReportedQuotaError())return e(!1);this._outstandingContentSync=!0,this._runMessageContentSync(35,(function(n,r){if(!n)try{t._processSyncErrors(r)}catch(i){v.default.reportError(i)}return t._processSyncdContent(),t._outstandingContentSync=!1,e(!v.default.isEmpty(t._unsyncdMessages))}))}},{key:"_runMessageContentSync",value:function(e,t){var n=0,r=0,i=!1,a=0,o=0,s={},u=function(e,n,u){if(e?a++:(o++,s[n]=u),i&&a+o===r){var l=0===o;t(l,l?void 0:s)}},l=this.getSyncAccounts();for(var c in this._unsyncdMessages)if(l.indexOf(c)>=0&&(n+=this._syncMessageContentForAccount(c,this._unsyncdMessages[c],e-n,u),r++,n>=e))break;return i=!0,0===n&&setTimeout((function(){t(!0)}),0),n}},{key:"_syncMessageContentForAccount",value:function(e,t,n,r){var i=0,a=0,o=0,s=0,u={},l=function(t,n,i){if(t?o++:(s++,u[n]=i),o+s===a){var l=0===s;r(l,e,l?void 0:u)}};for(var c in t)if(t.hasOwnProperty(c)&&(i+=this._syncMessageContentForThread(e,c,t[c],n-i,l),a++,i>=n))break;return i}},{key:"_syncMessageContentForThread",value:function(e,t,n,r,i){var a=this,o=0;if(v.default.isArray(n)){var s=!1,u=0,l=[],c=function(n,r){if(r?(u++,a._notifyContentCached(e,t,n)):l.push(n),s&&u+l.length===o){var c=0===l.length;i(c,t,c?void 0:l)}};n.forEach((function(n){o<r&&a._requestRemoteMessageDataRaw(e,t,n,!1,(function(e,t){c(n,!!e)})),o++})),s=!0}else this._requestRemoteThreadDataRaw(e,t,(function(n,r){n?a._handleContentSyncdThread(e,n,(function(n){a._notifyContentCached(e,t),i(n,t)})):i(!1,t,!0)})),o++;return o}},{key:"_handleContentSyncdMessage",value:function(e,t,n,r){n.error||(n.internalDate=new Date(+n.internalDate),n.payload.id=n.id,n.payload.internalDate=n.internalDate,this._rawCache.saveEntry(n.payload)),r&&r(!0)}},{key:"_handleContentSyncdThread",value:function(e,t,n){for(var r=0,i=0;i<t.messages.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=t.messages[i];this._handleContentSyncdMessage(e,t.id,a,n)}}},{key:"scheduleEmail",value:function(e,t){var n=this,r=e.getAttachmentByPlugin(this.id);try{v.default.PAssert(1418,r,"Must be able to get a valid attachment from item")}catch(l){v.default.reportError(l)}var i=r.getField("subject"),a=this.getURLForAttachment(r),o=y.a.MSPerHour,s=Xh.pluginManager.getPluginGCalendar();if(s){var u=s.getDefaultExportCalendarID();u?s.createEventForEmail(u,i,a,t,o,(function(e,t){e||t?t?(n.addLabelToAttachment(r,"Moo.do/Scheduled"),n.getSetting(n.Settings.ArchiveOnSchedule)&&n.archiveAttachment(r)):t||Xh.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:y.a.MessageAction.Okay}):Xh.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){Xh.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:y.a.MessageAction.Okay})}})})):Xh.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:y.a.MessageAction.OpenCalendarSettings})}else Xh.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:y.a.MessageAction.OpenSettings})}},{key:"getIconInfoForLabel",value:function(e){var t,n,r=!1,i=16;switch(e.getParsedText()){case"Inbox":n="inbox2",t=y.a.ColorBrand;break;case"Starred":n="star",t="#fd3";break;case"Important":n="exclamation",t="#d43";break;case"Sent Mail":n="send",t="#08c",i=13;break;case"Draft":n="drafts",t="#fafafa";break;case"Archived":n="task",i=13;break;case"Trash":n="delete",t="#ff738c";break;case"Primary":n="user";break;case"Social":n="group",i=13;break;case"Promotions":n="tag";break;case"Updates":n="flag";break;case"Forums":n="question_answer";break;case"Chat":n="chat";break;case"Spam":n="warning";break;default:r}return{icon:n,color:t,size:i}}},{key:"archiveItem",value:function(e,t){var n=t.getAttachmentByPlugin(this.id);try{v.default.PAssert(1419,n,"Must be able to get a valid attachment")}catch(r){v.default.reportError(r)}!e&&this.isItemArchived(t)?this.performAction(y.a.PluginAction.Gmail.Unarchive,!1,n):e&&!this.isItemArchived(t)&&this.performAction(y.a.PluginAction.Gmail.Archive,!1,n)}},{key:"deleteItem",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);try{v.default.PAssert(1420,n,"Must be able to get a valid attachment")}catch(r){v.default.reportError(r)}t&&t.isDraft()&&this.itemHasDraft(e)?this.performAction(y.a.PluginAction.Gmail.DiscardDraft,!0,n):t&&t.isTrash()&&this.isItemFullTrashed(e)?this.performAction(y.a.PluginAction.Gmail.Untrash,!1,n):this.isItemFullTrashed(e)||this.performAction(y.a.PluginAction.Gmail.Trash,!1,n)}},{key:"undeleteItem",value:function(e){var t=e.getAttachmentByPlugin(this.id);try{v.default.PAssert(1421,t,"Must be able to get a valid attachment")}catch(n){v.default.reportError(n)}this.isItemFullTrashed(e)&&this.performAction(y.a.PluginAction.Gmail.Untrash,!1,t)}},{key:"removeItemFromLabel",value:function(e,t){var n=t.getAttachmentByPlugin(this.id);try{v.default.PAssert(1422,n,"Must be able to get a valid attachment")}catch(r){v.default.reportError(r)}e&&(e.isCustom()?this.performAction(y.a.PluginAction.Gmail.RemoveLabel,!1,n,e.getName()):e.isInbox()?this.performAction(y.a.PluginAction.Gmail.Archive,!1,n):e.isArchived()?this.performAction(y.a.PluginAction.Gmail.Unarchive,!1,n):e.isStarred()&&this.performAction(y.a.PluginAction.Gmail.Unstar,!1,n))}},{key:"moveEmailToItem",value:function(e,t,n){this.beginAction(),n||(e=e.clone(t,y.a.ChangeType.Local));var r=e.getAttachmentByPlugin(this.id);try{v.default.PAssert(1423,r,"Must be able to get a valid attachment")}catch(i){v.default.reportError(i)}this.performAction(y.a.PluginAction.Gmail.Move,!1,r,e,t),this.getSetting(this.Settings.ArchiveOnOrganize)&&this.performAction(y.a.PluginAction.Gmail.Archive,!1,r),this.attachmentHasLabel(r,"Moo.do/Handled")||this.performAction(y.a.PluginAction.Gmail.AddLabel,!1,r,"Moo.do/Handled"),this.endAction()}},{key:"getLastMessage",value:function(e){var t=e.getField("messages")||[],n=t.length-1;return this.isMessageDraft(t[n])&&!this.getAttachField(e,"pendingSend")&&n--,t[n]}},{key:"sendEmail",value:function(){var e=Bo()(jo.a.mark((function e(t,n){var r=this;return jo.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){r.sendDraft(t,n.id,n.draftID,void 0,(function(n,r){Xh.EmailPreview.ensureDisplayMessages(t),n||(v.default.isHTTPStatusCode(r,y.a.HTTPStatusCode.Network)?Xh.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:y.a.MessageAction.Okay,hold:!0}):r&&Xh.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:y.a.MessageAction.Okay})),e(!!n)}))||e(!1)})));case 1:case"end":return e.stop()}}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getStyledText",value:function(e,t,n,r){return $l.renderStyled(e,t,n,r)}},{key:"getUnstyledText",value:function(e){return $l.renderPlain(e)}},{key:"getTextIconPadding",value:function(){return 24}},{key:"getEntryDateAsNumber",value:function(e){return"number"===typeof e&&e||"string"===typeof e&&+new Date(e)||+e}}]),n}(Gu),b()(mc.prototype,"_notifyPendingDraftUpdate",[w.a],Object.getOwnPropertyDescriptor(mc.prototype,"_notifyPendingDraftUpdate"),mc.prototype),b()(mc.prototype,"runLabelSync",[w.a],Object.getOwnPropertyDescriptor(mc.prototype,"runLabelSync"),mc.prototype),b()(mc.prototype,"runThreadSync",[w.a],Object.getOwnPropertyDescriptor(mc.prototype,"runThreadSync"),mc.prototype),b()(mc.prototype,"compareCachedData",[w.a],Object.getOwnPropertyDescriptor(mc.prototype,"compareCachedData"),mc.prototype),b()(mc.prototype,"removeItemFromLabel",[w.a],Object.getOwnPropertyDescriptor(mc.prototype,"removeItemFromLabel"),mc.prototype),mc);function Rd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Fd="Gmail";function Nd(e){var t={subject:e.subject||"",from:e.from||"",id:e.mailMessageId?e.mailMessageId:"mailbird_"+e.id,latestMessageAt:e.latestMessageAt};return e.gmailID&&(t.provider="Gmail",t.threadID=e.gmailID),t}var jd=new(function(){function e(){a()(this,e)}return s()(e,[{key:"dragOver",value:function(e){var t=v.default.elementFromPoint(e.x,e.y);if(t){var n=void 0!==this._prevX?e.x-this._prevX:0,r=void 0!==this._prevY?e.y-this._prevY:0;this._prevX=e.x,this._prevY=e.y;var i={clientX:e.x,clientY:e.y,diffX:n,diffY:r,target:t,dataTransfer:{}};Xh.DragDrop.handleDragOver(i)}}},{key:"drop",value:function(e){var t=v.default.elementFromPoint(e.x,e.y);var n={clientX:e.x,clientY:e.y,target:t,dataTransfer:{getData:function(t){if("mailbird/email"===t)return Nd(e)}}};setTimeout((function(){Xh.DragDrop.handleDrop(n)}),0)}},{key:"dragLeave",value:function(){Xh.DragDrop.handleDragLeave({target:document.getElementById("container")})}},{key:"reportError",value:function(e){v.default.reportError(new Error(e))}}]),e}()),Ud=(Pd=function(e){d()(n,e);var t=Rd(n);function n(){var e;if(a()(this,n),(e=t.call(this,y.a.PluginID.Mailbird,"b","Mailbird",!0)).declareProperty("subject",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1,""),e.declareProperty("from",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1,""),e.declareProperty("date",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,new Date),e.declareProperty("subjectLower",y.a.PluginLoad.Runtime,!1,""),e.declareProperty("fromLower",y.a.PluginLoad.Runtime,!1,""),e.declareProperty("unread",y.a.PluginLoad.Runtime,!0,!1),e.declareProperty("snippet",y.a.PluginLoad.Runtime,!0,""),e.declareProperty("count",y.a.PluginLoad.Runtime,!0,1),e.declareProperty("latestMessageAt",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1),e.declareProperty("provider",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0),e.declareProperty("threadID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0),e.declareProperty("hasAttachments",y.a.PluginLoad.Full,!0,!1),e.isMailbirdEmbed=k.a.embed===y.a.EmbedApps.Mailbird,e.isMailbirdEmbed){e.setSetting(e.Settings.IsEnabled,!0),e._needInlineDataUpdate=[],Xh.nativeBridge.registerEmbedBridge(W()(e));var r=Xh.nativeBridge.registerInboundAPI("mailbird");try{v.default.PAssert(1162,r,"Error creating native inbound API for mailbird")}catch(i){v.default.reportError(i)}r&&(r.registerVariable("_prevX"),r.registerVariable("_prevY"),r.registerFunction("dragOver",jd.dragOver,!0),r.registerFunction("drop",jd.drop,!0),r.registerFunction("dragLeave",jd.dragLeave,!0),r.registerFunction("reportError",jd.reportError,!0)),e._mailbirdOutAPI=Xh.nativeBridge.registerOutboundAPI("mailbird");try{v.default.PAssert(1163,e._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(i){v.default.reportError(i)}e._mailbirdOutAPI&&(e._mailbirdOutAPI.requireFunction("selectConversation"),e._mailbirdOutAPI.requireFunction("selectConversationEx",!0),e._mailbirdOutAPI.requireFunction("scheduleNotifications",!0),e._mailbirdOutAPI.requireFunction("getByIdEx",!0),e._canUpdateInlineData=e._mailbirdOutAPI.hasOptionalFunction("getByIdEx"))}return e}return s()(n,[{key:"getPaneIcon",value:function(){return"icon-envelope"}},{key:"useItemStore",value:function(){return"Mailbird"}},{key:"_addRemoteEntry",value:function(e){var t={id:e.id,provider:e.provider,threadID:e.threadID,subject:e.subject,subjectLower:e.subject.toLowerCase(),from:e.from,fromLower:e.from.toLowerCase(),latestMessageAt:e.latestMessageAt};return this.cacheData(t.id,t),t}},{key:"createEntryFromLocal",value:function(e,t){return t.subjectLower=t.subject.toLowerCase(),t.fromLower=t.from.toLowerCase(),t}},{key:"getAttachmentClass",value:function(e){return["plugin_mailbird"]}},{key:"isPluginBlocked",value:function(){return!1}},{key:"handleEmbedMessage",value:function(e,t){switch(e){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var n=JSON.stringify(t);this._mailbirdOutAPI.call("scheduleNotifications",n)}catch(r){v.default.reportError(r)}break;default:try{v.default.PAssert(1164,!1,"Unknown embed message: "+e)}catch(i){v.default.reportError(i)}}}},{key:"handleDropEvent",value:function(e,t){try{v.default.PAssert(1165,t,"Must provide a valid callback to the drop event")}catch(a){v.default.reportError(a)}if(e.dataTransfer){var n=e.dataTransfer.getData("mailbird/email");if(n){var r=this._addRemoteEntry(n),i=this.getAttachment(r.id,r);try{v.default.PAssert(1166,i.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(a){v.default.reportError(a)}return t(this.getAttachmentEmbedString(i)),!0}}return!1}},{key:"handleTapClick",value:function(e,t,n,r){var i=this.getCacheData(n);if(!i){var a=this.getAttachment(n);a&&(i=a.getInlineData())}if(i){if(this.isMailbirdEmbed){var o;if(!i.id.startsWith("mailbird_")&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var s=null;if("Gmail"===i.provider){try{v.default.PAssert(1167,i.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(l){v.default.reportError(l)}s=parseInt(i.threadID)}var u=i.id;o=this._mailbirdOutAPI.call("selectConversationEx",s,u,+i.latestMessageAt)}else{u=i.id.replace("mailbird_","");o=this._mailbirdOutAPI.call("selectConversation",u)}try{v.default.PAssert(1168,void 0!==o,"Must always receive a value back from Mailbird")}catch(l){v.default.reportError(l)}if(!0===o||!1===o)try{v.default.PAssert(1169,o,"Must have successfully selected the email conversation in Mailbird: ",i.id,i.provider)}catch(l){v.default.reportError(l)}else{try{v.default.PAssert(1170,o&&o.then,"Must have a valid promise object returned")}catch(l){v.default.reportError(l)}o.then((function(e){try{v.default.PAssert(1171,e,"Must have successfully selected the email conversation in Mailbird: ",i.id,i.provider)}catch(l){v.default.reportError(l)}}),(function(e){try{v.default.PAssert(1172,!1,"Failed to successfully select the email conversation in Mailbird: ",i.id,i.provider)}catch(l){v.default.reportError(l)}}))}}else switch(i.provider){case Fd:v.default.openUrl("https://mail.google.com/mail/u/0/#inbox/"+i.threadID);break;default:Xh.toasts.pushMessage(y.a.MessageID.MailbirdClick)}return!0}return!1}},{key:"getDisplayTags",value:function(e){return[]}},{key:"getDisplayParticipants",value:function(e){return""}},{key:"matchAttachment",value:function(e,t){return e.getField("fromLower").indexOf(t)>=0||e.getField("subjectLower").indexOf(t)>=0}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var n=e.toLowerCase();return this.findCachedItemsByFn((function(e){return e.subjectLower.indexOf(n)>=0||e.fromLower.indexOf(n)>=0}),t)}},{key:"requestData",value:function(e,t){e.hasField("subject")?(e.notifyDataLoaded(y.a.PluginLoad.Full,!1,void 0,y.a.ChangeType.Remote),e.hasInlineData()||!this.isMailbirdEmbed||this._needInlineDataUpdate.includes(e)||(this._needInlineDataUpdate.push(e),this._timeoutInlineDataUpdate||(this._timeoutInlineDataUpdate=setTimeout(this.processMissingInlineUpdates,1e3))),e.hasField("latestMessageAt")||this.requestMissingData(e)):this.requestMissingData(e)}},{key:"requestMissingData",value:function(e){var t=this;this._canUpdateInlineData&&setTimeout((function(){t._mailbirdOutAPI.call("getByIdEx",e.id).then((function(n){try{var r=JSON.parse(n);if(r){var i=Nd(r);t.cacheData(i.id,i),t.fixAttach(e)}}catch(a){v.default.reportError(a)}}))}),1e3)}},{key:"processMissingInlineUpdates",value:function(){var e=this._needInlineDataUpdate;if(e.length>0)for(var t=0,n=0;n<e.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];r.isLoaded()&&this.fixAttach(r)}}},{key:"fixAttach",value:function(e){var t=this;e.forEachItem(Xh.itemStoreManager.getDefaultItemStore(),(function(n){var r=n.getRawText();r=r.replace(t._getTextForItem(e.getData().id,e.getData().accountID),t.getAttachmentEmbedString(e)),n.setText(n.getParsedText(),y.a.ChangeType.Local)}))}},{key:"getStyledText",value:function(e,t,n,r){return $l.renderStyled(e,t,n,r)}},{key:"getUnstyledText",value:function(e){return $l.renderPlain(e)}}]),n}(Gu),b()(Pd.prototype,"processMissingInlineUpdates",[w.a],Object.getOwnPropertyDescriptor(Pd.prototype,"processMissingInlineUpdates"),Pd.prototype),Pd);function Bd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Vd,Hd=1,Wd=3,qd=4,zd=5,Gd=6,Kd=7,Yd=8,Qd=9,Xd=10,$d=11,Jd=12,Zd=13,eh=6,th="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)",nh=function(e){d()(n,e);var t=Bd(n);function n(){var e;return a()(this,n),(e=t.call(this,y.a.PluginID.Moodo,"m","Moodo",!0)).setSetting(e.Settings.IsEnabled,!0,!1),e}return s()(n,[{key:"isPluginBlocked",value:function(){return!1}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"hasSyncAccount",value:function(e,t){return l()(g()(n.prototype),"hasSyncAccount",this).call(this,e,t)||Xh.pluginManager.getPluginDrive().hasSyncAccount(e,t)}},{key:"getRemoteAttachmentData",value:function(e){this.cacheData(e.id,{})}},{key:"runRemoteSingleRequest",value:function(e,t,n,r,i,a,o){this._queueRemoteRequestMulti(e,t,n,r,i,void 0,a||Hd,o)}},{key:"runRemotePagedRequest",value:function(e,t,n,r,i,a,o){a||(a={}),this._queuePagedRemoteRequestMulti(e,t,n,r,i,void 0,o,a)}},{key:"drivePermissionsInsert",value:function(e,t,n,r,i,a){try{v.default.PAssert(1184,v.default.isEmail(n),"Should pass in a valid email address")}catch(u){v.default.reportError(u)}var o=Du.a.fns("drive").permissions.insert.packedFn,s={fileId:t,sendNotificationEmails:r,resource:{value:n,type:"user",role:"writer",withLink:!1}};this.runRemoteSingleRequest(e,o,s,i,a,void 0,Wd)}},{key:"drivePermissionsDelete",value:function(e,t,n,r,i){var a=Du.a.fns("drive").permissions.delete.packedFn,o={fileId:t,permissionId:n};this.runRemoteSingleRequest(e,a,o,r,i,void 0,qd)}},{key:"drivePermissionsList",value:function(e,t,n,r){var i=Du.a.fns("drive").permissions.list.packedFn,a={fileId:t,fields:"items(id,name,role,type,emailAddress)"};this.runRemoteSingleRequest(e,i,a,n,r,void 0,zd)}},{key:"drivePermissionsPublic",value:function(e,t,n,r){var i=Du.a.fns("drive").permissions.insert.packedFn,a={fileId:t,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this.runRemoteSingleRequest(e,i,a,n,r,void 0,Wd)}},{key:"driveFilesGet",value:function(e,t,n,r,i){var a=Du.a.fns("drive").files.get.packedFn,o={fileId:t,fields:th};i&&i.props&&Object.assign(o,i.props),this.runRemoteSingleRequest(e,a,o,n,r,void 0,Gd)}},{key:"driveFilesExport",value:function(e,t,n,r,i){var a=Du.a.fns("drive").files.export.packedFn,o={fileId:t,mimeType:"application/vnd.google-apps.drive-sdk.597847337936"};this.runRemoteSingleRequest(e,a,o,n,r,void 0,eh)}},{key:"driveFilesList",value:function(e,t,n,r,i){var a=Du.a.fns("drive").files.list.packedFn,o={q:t,fields:"items(createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)),nextPageToken"};i&&i.props&&Object.assign(o,i.props),this.runRemotePagedRequest(e,a,o,n,r,void 0,Kd)}},{key:"driveFilesTrash",value:function(e,t,n,r){var i=Du.a.fns("drive").files.trash.packedFn,a={fileId:t};this.runRemoteSingleRequest(e,i,a,n,r,void 0,Kd)}},{key:"driveFilesUntrash",value:function(e,t,n,r){var i=Du.a.fns("drive").files.untrash.packedFn,a={fileId:t};this.runRemoteSingleRequest(e,i,a,n,r,void 0,Yd)}},{key:"drivePropertiesInsert",value:function(e,t,n,r,i,a){var o=Du.a.fns("drive").properties.insert.packedFn,s={fileId:t,resource:{key:n,value:r,visibility:"PRIVATE"}};this.runRemoteSingleRequest(e,o,s,i,a,void 0,Qd)}},{key:"drivePropertiesUpdate",value:function(e,t,n,r,i,a){var o=Du.a.fns("drive").properties.update.packedFn,s={fileId:t,propertyKey:n,resource:{key:n,value:r,visibility:"PRIVATE"}};this.runRemoteSingleRequest(e,o,s,i,a,void 0,Xd)}},{key:"driveParentsInsert",value:function(e,t,n,r,i){var a=Du.a.fns("drive").parents.insert.packedFn,o={fileId:t,resource:{id:n}};this.runRemoteSingleRequest(e,a,o,r,i,void 0,$d)}},{key:"driveParentsDelete",value:function(e,t,n,r,i){var a=Du.a.fns("drive").parents.delete.packedFn,o={fileId:t,parentId:n};this.runRemoteSingleRequest(e,a,o,r,i,void 0,Jd)}},{key:"driveChildrenList",value:function(e,t,n,r,i){var a=Du.a.fns("drive").children.list.packedFn,o={folderId:t,fields:"items(id),nextPageToken"};this.runRemoteSingleRequest(e,a,o,n,r,void 0,Zd)}}]),n}(Gu);function rh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var ih,ah,oh,sh=v.default.seconds(30),uh={Email:{a:"accountID",t:"text",s:"service"},Gmail:{a:"accountID",s:"subject"}},lh=(Vd=function(e){d()(n,e);var t=rh(n);function n(){var e;return a()(this,n),(e=t.call(this))._plugins={},e._activePlugins=[],e._loadedDependencies={},e._iteratingPlugins=!1,e._hasAdjustedCacheSizeRatio=!1,e._queueTimeout=void 0,e._forcedLastPossible=!1,e._numOutstandingReqs=0,Po.a.onAuthTokensUpdated.listen(e.pokeRequestQueues),e}return s()(n,[{key:"init",value:function(){var e=this;this._setupRequestQueues(),v.default.isDemoMode()&&this.notifyDependencyLoad(y.a.PluginDependency.DemoMode);var t=function(){"Online"===N.a.onlineStatus.get()&&Po.a.isLoaded.get()&&e.goOnline()};N.a.onlineStatus.listen(t),Po.a.isLoaded.listen(t),k.a.onForeground.listen(t),K.a.listen("resetEverything",this._clearRequestQueues),this.registerPlugins()}},{key:"printStats",value:function(e){if(v.default.log("---- Plugin Stats ----"),void 0!==e){var t=this._plugins[e];v.default.log(t.name),v.default.log(" Stats: ",t.getStats())}else for(var n=0,r=Object.keys(this._plugins),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._plugins[r[i]],o=a.getStats();v.default.log(a.name),v.default.log(" Stats: ",o)}v.default.log("----------------------")}},{key:"dumpQueueState",value:function(){var e=0,t=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._plugins[t[n]];console.log(r.name),r.dumpRequestQueue(!1)}}},{key:"dumpQueueStats",value:function(){for(var e=0,t=Object.keys(this._plugins),n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._plugins[t[n]];console.log(r.name),r.dumpQueueStats()}}},{key:"getStats",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getStats();else for(var n=0,r=Object.keys(this._plugins),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._plugins[r[i]];t[a.id]=a.getStats()}return t}},{key:"getCacheStats",value:function(e,t){var n=this,r={};void 0!==e?this._plugins[e].getCacheStats(t):function(){for(var e=0,i=Object.keys(n._plugins),a=0,o=0;o<i.length;++o){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n._plugins[i[o]].getCacheStats(function(e,n){n&&(r[e]=n),i.length===++a&&t(r)}.bind(n,i[o]))}}()}},{key:"getState",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getState();else for(var n=0,r=Object.keys(this._plugins),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._plugins[r[i]];t[a.id]=a.getState()}return t}},{key:"registerPlugins",value:function(){try{this.registerPlugin(new nh)}catch(t){v.default.reportError(t)}try{this.registerPlugin(new El)}catch(t){v.default.reportError(t)}try{var e=new Md;this.registerPlugin(e),this._plugins[y.a.PluginID.Email]=e}catch(t){v.default.reportError(t)}try{this.registerPlugin(new Ql)}catch(t){v.default.reportError(t)}try{this.registerPlugin(new Ud)}catch(t){v.default.reportError(t)}this.registerPlugin(new Yu)}},{key:"registerPlugin",value:function(e){try{v.default.PAssert(765,!this._plugins[e.id],"Should never double-register a plguin")}catch(t){v.default.reportError(t)}this._plugins[e.id]=e,this.isAuthorized(e.id)&&this.loadPlugin(e.id)}},{key:"getPlugin",value:function(e){return this._plugins[e]}},{key:"getPluginGmail",value:function(){return this._plugins[y.a.PluginID.Gmail]}},{key:"getPluginDrive",value:function(){return this._plugins[y.a.PluginID.Drive]}},{key:"getPluginGCalendar",value:function(){return this._plugins[y.a.PluginID.GCalendar]}},{key:"loadPlugin",value:function(e){var t=this.getPlugin(e);try{v.default.PAssert(766,t,"Must register a plugin before loading it")}catch(n){v.default.reportError(n)}this.activatePlugin(t)}},{key:"unloadPlugin",value:function(e){}},{key:"authorizePlugin",value:function(e,t,n){n(!0)}},{key:"deauthorizePlugin",value:function(e,t){try{v.default.PAssert(769,t&&v.default.isFunction(t),"Must provide a valid callback fn")}catch(r){v.default.reportError(r)}var n=this.getPlugin(e);try{v.default.PAssert(770,n,"Must register a plugin before loading it")}catch(r){v.default.reportError(r)}n.setSetting(n.Settings.IsEnabled,!1),v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Plugin Deauthorized: ",e),this.deactivatePlugin(n),t(!0)}},{key:"onPluginAuthorized",value:function(e,t){e.setSetting(e.Settings.IsEnabled,t),v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Plugin Authorized: ",e.id,t),t&&this.activatePlugin(e)}},{key:"activatePlugin",value:function(e){try{v.default.PAssert(771,e,"Plugin must be valid to be activated")}catch(t){v.default.reportError(t)}e.activate(this._loadedDependencies)&&this._activePlugins.indexOf(e.id)<0&&this._activePlugins.push(e.id),e.ensurePaneTypeIsActive(),v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Plugin Activated: ",e.id)}},{key:"deactivatePlugin",value:function(e){try{v.default.PAssert(772,e,"Plugin must be valid to be deactivated")}catch(t){v.default.reportError(t)}this._activePlugins.indexOf(e.id)>=0&&(e.deactivate()&&this._activePlugins.remove(e.id),v.default.shouldLog(y.a.LogLevels.Plugin)&&v.default.log("Plugin Deactivated: ",e.id))}},{key:"isOnline",value:function(){return N.a.isConnected()||v.default.isDemoMode()}},{key:"goOnline",value:function(){var e=this;setTimeout((function(){var t=0;e._setupRequestQueues(!0);for(var n=0;n<e._activePlugins.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e._plugins[e._activePlugins[n]];try{r.goOnline()}catch(i){e._reportPluginError(i)}}}),0)}},{key:"onDocumentShared",value:function(e){for(var t=0,n=0;n<this._activePlugins.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._plugins[this._activePlugins[n]];try{r.onDocumentShared(e)}catch(i){this._reportPluginError(i)}}}},{key:"onShutdown",value:function(){for(var e=0,t=[],n=0;n<this._activePlugins.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._plugins[this._activePlugins[n]];try{var i=r.onShutdown();i&&t.push(i)}catch(a){this._reportPluginError(a)}}return t.length>0?t:void 0}},{key:"onClearData",value:function(){for(var e=0,t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._plugins[this._activePlugins[t]];try{n.clearData()}catch(r){this._reportPluginError(r)}}}},{key:"getCacheSizeRatio",value:function(){var e=Xh.settings.cacheSizeRatio.get()||1;try{v.default.PAssert(773,e>=0&&e<=1,"Invalid ratio value: "+e)}catch(t){v.default.reportError(t)}return e}},{key:"hasAdjustedCacheSizeRatio",value:function(){return this._hasAdjustedCacheSizeRatio}},{key:"_adjustCacheSizeRatio",value:function(){var e=this.getCacheSizeRatio();1===e&&v.default.sendEvent("CacheRatioChange","FromDefault");e>.35?e-=.1:v.default.sendEvent("CacheRatioChange","Minimum"),v.default.sendEvent("CacheRatioChange","Change",e),Xh.settings.cacheSizeRatio.set(e)}},{key:"onCacheLimitExceeded",value:function(){if(!this._hasAdjustedCacheSizeRatio){var e=0;this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._plugins[this._activePlugins[t]];try{n.onCacheLimitExceeded()}catch(r){this._reportPluginError(r)}}}}},{key:"getPluginsForType",value:function(e){var t;switch(e){case y.a.PluginType.Calendar:t=[y.a.PluginID.GCalendar];break;case y.a.PluginType.Email:t=[y.a.PluginID.Gmail];break;case y.a.PluginType.Storage:t=[y.a.PluginID.Drive];break;case y.a.PluginType.Unknown:t=[y.a.PluginID.Mailbird,y.a.PluginID.Moodo]}return t}},{key:"hasAttachmentType",value:function(e,t){var n=!1;if(e.hasAttachments())for(var r=0,i=this.getPluginsForType(t),a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e.hasPluginAttachment(i[a])){n=!0;break}}return n}},{key:"allowTextEditing",value:function(e){var t=!0;if(e&&e.hasAttachments())for(var n=0,r=e.getAttachments(),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!r[i].getPlugin().allowTextEditing(e,r[i])){t=!1;break}}return t}},{key:"validatePlugin",value:function(e){}},{key:"runForEachPlugin",value:function(e){var t=0;this._iteratingPlugins=!0;for(var n=0;n<this._activePlugins.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e(this.getPlugin(this._activePlugins[n]))}catch(r){v.default.reportError(r)}}this._iteratingPlugins=!1}},{key:"getAttachment",value:function(e,t){try{v.default.PAssert(774,e.p,"Must specify the plugin string to be used: ",e)}catch(r){v.default.reportError(r)}try{v.default.PAssert(775,e.id,"Must specify the ID of the data to use from the plugin: ",e)}catch(r){v.default.reportError(r)}var n=this.getPlugin("Email"===e.p?"Gmail":e.p);try{v.default.PAssert(776,n,"Must specify a valid plugin: ",e)}catch(r){v.default.reportError(r)}if(n)return n.getAttachment(e.id,t?e:void 0)}},{key:"createDisplayElement",value:function(e,t){try{v.default.PAssert(777,e.p,"Must specify the plugin string to be used")}catch(a){v.default.reportError(a)}try{v.default.PAssert(778,e.id,"Must specify the ID of the data to use from the plugin")}catch(a){v.default.reportError(a)}var n,r=this.getPlugin(e.p);if(r){var i=this.getAttachment(e,t);if(i)try{n=r.createDisplayElement(i)}catch(o){this._reportPluginError(o),n=this.createUnknownPluginElement(e.p)}else n=this.createUnknownPluginElement(e.p)}else n=this.createUnknownPluginElement(e.p);return n}},{key:"createUnknownPluginElement",value:function(e){return{attrs:{cls:[],isUnknown:!0,plugin:y.a.PluginID.Moodo,"plugin-id":"Invalid"}}}},{key:"parseAttachmentEmbedString",value:function(e,t){try{v.default.PAssert(779,e,"Must provide a valid string to parse")}catch(o){v.default.reportError(o)}var n,r=e.replace(/&quot;/g,'"').split(","),i={};if(r.forEach((function(e){var t,r=e.indexOf(":"),a=e.substr(0,r);a=n&&(null===(t=uh[n])||void 0===t?void 0:t[a])||a;var o=e.substr(r+1,e.length-r-1);if("p"!==a&&"id"!==a)try{o=decodeURIComponent(o)}catch(s){}i[a]=o,"p"===a&&(n=o)})),t){var a=r.length>2;i.displayElement=this.createDisplayElement(i,a),i.hasInlineData=a}return i}},{key:"createSimpleAttachment",value:function(e){return e.isSimpleAttachment=!0,e}},{key:"handleDropEvent",value:function(e,t){for(var n,r,i=0,a=e.dataTransfer,o=e.clipboardData,s=e.target,u=!1,l=!1,c=0;c<this._activePlugins.length&&!u;++c){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var d=this._activePlugins[c],h=this.getPlugin(d);try{u=h.handleDropEvent({dataTransfer:a,clipboardData:o,target:s},t)}catch(p){this._reportPluginError(p),l=!0}}if(!u&&((null===a||void 0===a||null===(n=a.files)||void 0===n?void 0:n.length)>0||(null===o||void 0===o||null===(r=o.items)||void 0===r?void 0:r.length)>0)){var f=l?{text:"An error was detected handling drag drop and the developers have been notified",action:y.a.MessageAction.OpenSettings}:{text:"Attaching files is a Premium feature, using the Drive plugin. Please enable Drive in the settings.",action:y.a.MessageAction.OpenSettings};Xh.toasts.pushMessage(f),u=!0}return u}},{key:"handleTapClick",value:function(e,t,n){var r=!1,i=e.props.plugin,a=i.p,o=i.id,s=this.getPlugin(a);try{v.default.PAssert(780,s,"Must be able to get a valid plugin from a plugin element")}catch(d){v.default.reportError(d)}if(s.isPluginBlocked())Xh.toasts.pushMessage(y.a.MessageID.PremiumRequired),r=!0;else{try{v.default.PAssert(781,o,"Must have a valid item ID for a plugin element")}catch(d){v.default.reportError(d)}try{var u,l=t.item,c=t.pane;r=null===(u=s.handleTapClick)||void 0===u?void 0:u.call(s,l,c,o,n)}catch(h){this._reportPluginError(h)}}return r}},{key:"isAuthorized",value:function(e){return!(!v.default.isDemoMode()||e===y.a.PluginID.Gmail)||!!this.getPlugin(e)&&!!this.getSetting(e,this.getPlugin(e).Settings.IsEnabled)}},{key:"getSetting",value:function(e,t){return this.getPlugin(e).getSetting(t)}},{key:"setSetting",value:function(e,t,n){return this.getPlugin(e).setSetting(t,n)}},{key:"onAuthorizedSetting",value:function(e,t,n){this.getPlugin(e).onAuthorizedSetting(t,n)}},{key:"notifyDependencyLoad",value:function(e,t){for(var n in this._loadedDependencies[e]=t||!0,this._plugins)if(this._plugins.hasOwnProperty(n))try{this.getPlugin(n).onDependencyLoaded(e,t)}catch(r){this._reportPluginError(r)}}},{key:"notifyDependencyUnload",value:function(e,t){}},{key:"_handleBatchRequestResponse",value:function(e,t){try{v.default.PAssert(783,e,"Plugin must be passed to response to know who is handling it")}catch(n){v.default.reportError(n)}this._numOutstandingReqs--;try{v.default.PAssert(784,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(n){v.default.reportError(n)}try{e._handleBatchRequestResponse(t)}catch(r){this._reportPluginError(r)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"_handleRequestResponse",value:function(e,t,n){try{v.default.PAssert(785,t,"Plugin must be passed to response to know who is handling it")}catch(r){v.default.reportError(r)}if(!n){this._numOutstandingReqs--;try{v.default.PAssert(786,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(r){v.default.reportError(r)}}try{t._handleRequestResponse(e,n)}catch(i){this._reportPluginError(i)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"notifyNoOutstandingReqs",value:function(){try{v.default.PAssert(787,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(e){v.default.reportError(e)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)}},{key:"notifyHasPendingRemoteRequest",value:function(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)}},{key:"notifyAuthorizationAdded",value:function(e){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(e)}},{key:"verifyAuthorization",value:function(e,t){for(var n,r,i=0,a=0;a<this._activePlugins.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this._activePlugins[a],s=this.getPlugin(o);if(s.isEnabled())!s.verifyAuthorization(e)&&(r=(r||[]).concat(s.googleScopes())),n=n||!s.verifyAuthorization(e)}}},{key:"pokeRequestQueues",value:function(){this._setupRequestQueues(!0)}},{key:"_setupRequestQueues",value:function(e){var t=e?1:sh;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,t)),this._forcedLastPossible=this._forcedLastPossible||!!e}},{key:"_pumpRequestQueues",value:function(){this._runPumpRequestQueues(y.a.RequestPriority.UserBlocking),this._runPumpRequestQueues(y.a.RequestPriority.Default),this._runPumpRequestQueues(y.a.RequestPriority.Low)}},{key:"_runPumpRequestQueues",value:function(e){var t=0;if(this.isOnline()){var n=0,r=6-this._numOutstandingReqs;try{v.default.PAssert(788,r>=0,"Should never have more than max outstanding requests at any given point in time")}catch(c){v.default.reportError(c)}for(var i=0;r>0&&i<this._activePlugins.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._activePlugins[i],o=this.getPlugin(a),s=4-o.getNumOutstandingReqs();try{v.default.PAssert(789,s>=0,"Must always have a postiive number of available plugin reqs")}catch(c){v.default.reportError(c)}var u=Math.min(r,s);if(u>0&&o.isReady()){var l=0;try{l=o._pumpRequestQueue(e,u,this._handleRequestResponse,this._handleBatchRequestResponse);try{v.default.PAssert(790,l>=0,"Number of requests sent can never be negative")}catch(c){v.default.reportError(c)}}catch(d){this._reportPluginError(d)}try{v.default.PAssert(791,r-l>=0,"Too Many requests sent")}catch(c){v.default.reportError(c)}t+=l,r-=l,this._numOutstandingReqs+=l}}}else 0;return this._forcedLastPossible=!1,this._setupRequestQueues(),t}},{key:"_clearRequestQueues",value:function(){var e=0;this._numOutstandingReqs=0;for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._activePlugins[t],r=this.getPlugin(n);try{r._clearRequestQueue()}catch(i){this._reportPluginError(i)}}}},{key:"_reportPluginError",value:function(e){v.default.reportError(e)}},{key:"parseEmailURL",value:function(e){var t={accountID:void 0,threadID:void 0,plugin:void 0},n=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g.exec(e);return n&&(t.accountID=n[1],t.threadID=n[2],t.plugin=this.getPlugin(y.a.PluginID.Gmail)),t}},{key:"isAvailable",value:function(e){return this.getPlugin(e).isAvailable()}},{key:"isActive",value:function(e){return this.getPlugin(e).isActive()}},{key:"isEnabled",value:function(e){return this.getPlugin(e).isEnabled()}},{key:"isGmailEnabled",value:function(){return this.isEnabled(y.a.PluginID.Gmail)}},{key:"isDriveEnabled",value:function(){return this.isEnabled(y.a.PluginID.Drive)}},{key:"getPluginScopes",value:function(e,t){return e===y.a.PluginID.Contacts?[y.a.GScope.Contacts]:this.getPlugin(e).googleScopes(e===y.a.PluginID.Drive&&t)}},{key:"getAllPluginScopes",value:function(e,t){return y.a.ScopesDefault.concat(v.default.arrayFlat(e.map((function(e){return Xh.pluginManager.getPluginScopes(e,t)}))))}}]),n}(S.a),b()(Vd.prototype,"goOnline",[w.a],Object.getOwnPropertyDescriptor(Vd.prototype,"goOnline"),Vd.prototype),b()(Vd.prototype,"_handleBatchRequestResponse",[w.a],Object.getOwnPropertyDescriptor(Vd.prototype,"_handleBatchRequestResponse"),Vd.prototype),b()(Vd.prototype,"_handleRequestResponse",[w.a],Object.getOwnPropertyDescriptor(Vd.prototype,"_handleRequestResponse"),Vd.prototype),b()(Vd.prototype,"pokeRequestQueues",[w.a],Object.getOwnPropertyDescriptor(Vd.prototype,"pokeRequestQueues"),Vd.prototype),b()(Vd.prototype,"_pumpRequestQueues",[w.a],Object.getOwnPropertyDescriptor(Vd.prototype,"_pumpRequestQueues"),Vd.prototype),b()(Vd.prototype,"_clearRequestQueues",[w.a],Object.getOwnPropertyDescriptor(Vd.prototype,"_clearRequestQueues"),Vd.prototype),b()(Vd.prototype,"getPluginScopes",[w.a],Object.getOwnPropertyDescriptor(Vd.prototype,"getPluginScopes"),Vd.prototype),Vd),ch=new(ih=function(){function e(){a()(this,e),this.scheduledItems=[],this.notifiedItems={},this.timeouts={},this.timeoutNextNotification=void 0,this.frequency=15*y.a.MSPerMinute}return s()(e,[{key:"scheduleItems",value:function(e){var t=this;this.scheduledItems=e,k.a.hasNotificationPermission()?this.runNotifications():Notification.requestPermission((function(){t.runNotifications()}))}},{key:"runNotifications",value:function(){for(var e=0,t=0;t<this.scheduledItems.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.scheduledItems[t];this.notifiedItems[n.id]&&this.notifiedItems[n.id]===n.date||this.runNotification(n)}v.default.shouldLog(y.a.LogLevels.Timeline)&&v.default.log("Next Notifications in: ",this.frequency),clearTimeout(this.timeoutNextNotification),this.timeoutNextNotification=setTimeout(this.runNotifications,this.frequency)}},{key:"runNotification",value:function(e){var t=e.id,n=new Date,r=e.alertDate,i=Math.max(r.getTime()-n.getTime(),0);i<0?this.doNotification(e):i<=this.frequency?(clearTimeout(this.timeouts[t]),this.timeouts[t]=setTimeout(this.doNotification.bind(this,e),i)):this.notifiedItems[t]=e.date}},{key:"doNotification",value:function(e){var t=e.date,n=Math.ceil((t.getTime()-Date.now())/y.a.MSPerMinute);new Notification(e.text,{body:n>0?"in "+n+" minutes":"now",icon:k.a.isNativeApp()?void 0:"/img/favicon-96x96.png",requireInteraction:!0});this.notifiedItems[e.id]=e.date,v.default.shouldLog(y.a.LogLevels.Timeline)&&v.default.log("Show HTML5 Notification: ",e)}}]),e}(),b()(ih.prototype,"runNotifications",[w.a],Object.getOwnPropertyDescriptor(ih.prototype,"runNotifications"),ih.prototype),ih),dh=new(function(){function e(){a()(this,e)}return s()(e,[{key:"setNotifications",value:function(e){k.a.usesHTML5Notifications()?(ch.scheduleItems(e),v.default.shouldLog(y.a.LogLevels.Timeline)&&v.default.log("HTML5 Scheduling Completed: ",e.length)):Xh.nativeBridge.isEnabled()?Xh.nativeBridge.sendToApp("scheduledItems",this.convertForSend(e)):Xh.nativeBridge.hasEmbedBridge()&&Xh.nativeBridge.sendToEmbed("scheduledItems",this.convertForSend(e))}},{key:"convertForSend",value:function(e){return e.map((function(e){return{id:e.id,text:e.text,date:e.date.toJSON(),alertDate:e.date.toJSON()}}))}}]),e}()),hh=5e3,fh=(ah=function(){function e(){a()(this,e),this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,this.oldSoftDates=["now","next","soon","later","someday"],this.agendaSort=Xh.settings.agendaSort}return s()(e,[{key:"clearDailyCaches",value:function(){}},{key:"addNotification",value:function(e){try{v.default.PAssert(742,e,"Must provide a valid item to schedule notifications for")}catch(t){v.default.reportError(t)}this.notificationItems[e.id]=e,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,hh),v.default.shouldLog(y.a.LogLevels.Timeline)&&v.default.log("Add Notification: ",e)}},{key:"removeNotification",value:function(e){try{v.default.PAssert(743,e,"Must provide a valid item to unschedule notifications for")}catch(t){v.default.reportError(t)}this.notificationItems[e.id]&&(this.notificationItems[e.id]=void 0,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,hh),v.default.shouldLog(y.a.LogLevels.Timeline)&&v.default.log("Remove Notification: ",e))}},{key:"clearNotifications",value:function(){var e=this;Object.keys(this.notificationItems).forEach((function(t){e.notificationItems[t]=void 0,e.numNotificationItemsChanged++})),clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,hh),v.default.shouldLog(y.a.LogLevels.Timeline)&&v.default.log("Clear Notifications")}},{key:"shouldNotify",value:function(e,t){var n=e.getNextDate();return!e.isDestroyed()&&!e.isDeleted()&&!e.isComplete()&&!e.hasCompletedAncestor()&&!e.allDayDate()&&n&&n>t&&+n-Date.now()<864e5}},{key:"updateNotifications",value:function(e){var t=this;if(k.a.supportsNotifications()&&Do.isNotificationsEnabled()&&!v.default.isDemoMode()){var n=new Date;e?(v.default.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(e,n)?this.addNotification(e):this.removeNotification(e)):(v.default.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),N.a.runOnAllDocumentRoots((function(e){v.default.searchVMLIs({item:e,each:function(e){t.shouldNotify(e,n)&&t.addNotification(e)}})})))}}},{key:"setupNotifications",value:function(){var e=this;try{v.default.PAssert(744,k.a.supportsNotifications(),"Platform must support notifications")}catch(n){v.default.reportError(n)}var t=[];Object.keys(this.notificationItems).forEach((function(n){var r=e.notificationItems[n];if(r&&r.getNotificationEntry){var i=r.getNotificationEntry();i&&t.push(i)}else delete e.notificationItems[n]})),dh.setNotifications(t),v.default.shouldLog(y.a.LogLevels.Timeline)&&v.default.log("Notifications Scheduled: "+this.numNotificationItemsChanged),this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,v.default.shouldLog(y.a.LogLevels.Timeline)&&v.default.log("Scheduled Notifications: ",t)}},{key:"getDateForKey",value:function(e){return this.oldSoftDates.indexOf(e)>=0&&(e="#"+e),this.agendaSort.get()[e]}},{key:"saveAgendaSort",value:function(e){this.agendaSort.set(e),Xh.settings.agendaSort.set(e),Xh.PaneManager.runForEachPane((function(e){e.isViewAgenda()&&e.setItemsDirty()})),Xh.PaneUpdateBatcher.updateAllItems()}}]),e}(),b()(ah.prototype,"updateNotifications",[w.a],Object.getOwnPropertyDescriptor(ah.prototype,"updateNotifications"),ah.prototype),b()(ah.prototype,"setupNotifications",[w.a],Object.getOwnPropertyDescriptor(ah.prototype,"setupNotifications"),ah.prototype),ah),ph=function(){function e(){a()(this,e)}return s()(e,[{key:"init",value:function(){this.settings=new Su,this.International=new Ss,this.billingManager=new zo,this.pluginManager=new lh,this.DisplaySettings=new x,this.itemStoreManager=new Gs,this.PaneUpdateBatcher=new Ys,this.PaneManager=new Fo,this.DragDrop=new C.default,this.timeline=new fh,this.cacheManager=new es,this.recurringTaskManager=new ou,this.deferredTaskManager=new is,this.toasts=new Iu,this.ElementRenderer=new wo,this.crypto=new vu,this.cloudStorage=new ns,this.dropBucket=new as,this.menus=new Ao,this.EmailPreview=new ys,this.International.init(),this.itemStoreManager.init(),this.cacheManager.init(),this.pluginManager.init(),this.PaneManager.init(),this.recurringTaskManager.init(),this.deferredTaskManager.init(),this.cloudStorage.init(),this.EmailPreview.init(),F.a.init(),gs.a.init()}},{key:"sendFeedback",value:function(e,t){var n={};m.default.getAppInfo(n),n.eventStream=void 0;var r={name:e,message:t,appInfo:n,email:this.settings.getUserIdentifier(),premiumStatus:this.billingManager.getPremiumStatus()};return Vo.a.sendFeedback(r)}},{key:"remoteAPI",value:function(){return this.pluginManager.getPlugin(y.a.PluginID.Moodo)}},{key:"onIntroAction",value:function(e){}}]),e}(),gh=function(){function e(){a()(this,e),this.sidebarTransitioning=!1,this.isDraggingSidebar=new E.a(!1),this.lightboxPosition=new E.a,this.lightboxSrc=new E.a,this.lightboxElement=void 0,this.sidebarChanged=new Q.a,this.resizingPane=new E.a,this.cursor=new E.a}return s()(e,[{key:"init",value:function(){var e=this;this.showSidebar=k.a.isMailbirdSidebar()||v.default.isDemoInIframe()?new E.a(!1):Xh.settings.showSidebar,this._savedSidebarWidth=y.a.DesktopMenuWidthDefault,this.sidebarWidth=Xh.settings.sidebarWidth,Xh.settings.onLoaded((function(){var t=Xh.settings.sidebarWidth.get();e._savedSidebarWidth=t===y.a.DesktopMenuWidthSmall?y.a.DesktopMenuWidthDefault:t}))}},{key:"toggleSidebar",value:function(e){this.sidebarTransitioning=!0;var t=void 0!==e?e:!this.showSidebar.get();t&&(!0===e&&this._savedSidebarWidth===y.a.DesktopMenuWidthSmall&&(this._savedSidebarWidth=y.a.DesktopMenuWidthDefault),this.sidebarWidth.set(this._savedSidebarWidth)),this._setSidebarVisible(t),this.sidebarChanged.notify()}},{key:"minimize",value:function(){this.sidebarTransitioning=!0;var e=y.a.DesktopMenuWidthSmall;this.sidebarWidth.set(e),this.sidebarChanged.notify()}},{key:"restore",value:function(){this.toggleSidebar(!0)}},{key:"getSidebarWidth",value:function(){return k.a.isMailbirdSidebar()||!this.showSidebar.get()?0:this.sidebarWidth.get()}},{key:"setSidebarWidthMoving",value:function(e){this.showSidebar.set(!0),this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarWidth.set(e)}},{key:"setSidebarWidthUp",value:function(){var e=this.sidebarWidth.get();e<20?e=0:e<y.a.DesktopMenuWidthMinBig&&(e=y.a.DesktopMenuWidthSmall),e!==this.sidebarWidth.get()&&(this.sidebarTransitioning=!0,this.sidebarWidth.set(e)),e>0&&(this._savedSidebarWidth=e),this._setSidebarVisible(e>0),this.isDraggingSidebar.set(!1),this.sidebarChanged.notify()}},{key:"_setSidebarVisible",value:function(e){Xh.settings.showSidebar.set(e),this.showSidebar.set(e)}},{key:"shouldShowTopBar",value:function(){return!v.default.isDemoInIframe()&&(!this.showSidebar.get()||k.a.isNativeMac()&&this.sidebarWidth.get()<y.a.DesktopMenuWidthMinBig)}},{key:"topBarHeight",value:function(){return this.shouldShowTopBar()?k.a.isNativeMac()?36:32:0}}]),e}(),vh=(oh=function(){function e(){a()(this,e)}return s()(e,[{key:"setup",value:function(){var e=this;this.downloadToasts={},this.callbacks={},this.nextId=0,this.ipcBridge=window.___electronIPCBridge;try{v.default.PAssert(294,this.ipcBridge,"IPC bridge was not created")}catch(t){v.default.reportError(t)}this.ipcBridge&&(this.ipcBridge.onElectronMessage=this.handleMessage),setTimeout((function(){Xh.settings.onLoaded((function(){Xh.settings.appHotkeys.listen((function(){return e.sendHotkeys()})),e.sendHotkeys()}))}),100)}},{key:"handleMessage",value:function(e,t){try{if(v.default.isString(t)&&"{"===t[0]&&"}"===t[t.length-1])try{t=JSON.parse(t)}catch(i){v.default.reportError(i)}if(isNaN(+e)){try{v.default.PAssert(295,this["onEvent_"+e],"Missing handler for native event")}catch(a){v.default.reportError(a)}this["onEvent_"+e](t)}else{var n=this.callbacks[+e],r=!1;n&&(v.default.isObject(t)&&("error"in t||"value"in t)&&(n(t.error,t.value),r=!0),!r&&n&&n(t))}}catch(i){v.default.reportError(i)}}},{key:"sendMessage",value:function(e,t,n){if(this.ipcBridge){var r=this.nextId++,i=r+"~"+e;void 0!==t&&(i+="~"+(v.default.isString(t)?t:JSON.stringify(t))),n&&(this.callbacks[r]=n),this.ipcBridge.send("moodo-message",i)}}},{key:"sendHotkeys",value:function(){var e=Xh.settings.appHotkeys.get();if(e&&!v.default.isEmpty(e)){var t=Object.keys(e).map((function(t){return Xh.hotkeys.convertToElectron(e[t])}));this.sendMessage("setShortcuts",t)}}},{key:"saveBackup",value:function(e,t,n){this.sendMessage("saveBackup",{filename:e,data:t},n)}},{key:"saveDoc",value:function(e,t,n){this.sendMessage("saveDoc",{filename:e,data:t},n)}},{key:"listDocss",value:function(e,t){this.sendMessage("listDocs",{folder:e},t)}},{key:"getDoc",value:function(e,t){this.sendMessage("getDoc",{filename:e},t)}},{key:"deleteDoc",value:function(e,t){this.sendMessage("deleteDoc",{filename:e},t)}},{key:"renameDoc",value:function(e,t,n){this.sendMessage("renameDoc",{filenameOld:e,filenameNew:t},n)}},{key:"openDirectoryDialog",value:function(e){this.sendMessage("openDirectoryDialog",{},e)}},{key:"getAllDocs",value:function(e){this.sendMessage("getAllDocs",void 0,(function(t,n){t?e(t):e(void 0,n)}))}},{key:"listenToDocChanges",value:function(e){this._fileListener=e}},{key:"getPrefs",value:function(e){this.sendMessage("getPrefs",void 0,e)}},{key:"setDocsFolder",value:function(e,t,n){this.sendMessage("setDocsFolder",{folder:e,moveFiles:t},n)}},{key:"onEvent_fullscreen",value:function(e){k.a.isNativeFullscreen.set(e)}},{key:"onEvent_features",value:function(e){try{e.version&&k.a.recordAppSubVersion(e.version),!1===e.notifications&&k.a.disallowNativeNotifications(),void 0!==e.darkMode&&this.onEvent_darkMode(e.darkMode),void 0!==e.fullscreen&&this.onEvent_fullscreen(e.fullscreen)}catch(t){v.default.reportError(t)}}},{key:"downloadFile",value:function(e,t){try{v.default.PAssert(296,!this.downloadToasts[e],"Should not double create a download for the same file")}catch(n){v.default.reportError(n)}this.downloadToasts[e]=Xh.toasts.pushMessage({text:"Downloading "+t+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),this.sendMessage("downloadURL",{url:e,name:t})}},{key:"onEvent_downloadProgress",value:function(e){var t=this,n=e.url,r=e.name,i=e.progress,a=e.filename,o=this.downloadToasts[n];if(o)if(1===i)a?(console.log(a),o.action=function(){console.log("toast action"),t.sendMessage("openFile",{filename:a})},o.actionText="OPEN",o.setText("Downloaded: ".concat(r))):o.hide(),delete this.downloadToasts[n];else{var s=isNaN(i)?"...":Math.round(100*i)+"%";o.setText("Downloading "+r+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+s)}}},{key:"onEvent_reportError",value:function(e){v.default.reportError(new Error("Native Error"),e)}},{key:"onEvent_onMenuClick",value:function(e){"NewMessage"===e||"NewEmail"===e?Xh.hotkeys.hotkeyEmailCompose():"NewPane"===e?Xh.hotkeys.hotkeyAddPane():"NewItem"===e?Xh.hotkeys.hotkeyNewItem():"Preferences"===e?Xh.menus.openSettings():"GoPremium"===e?Xh.menus.openSettings("Account"):"DisplaySettings"===e?Xh.menus.openDisplaySettings():"ToggleSidebar"===e?Xh.DesktopUI.toggleSidebar():v.default.reportError(new Error("Unknown Native Menu Click: "+e))}},{key:"onEvent_darkMode",value:function(e){this._darkMode=e,Xh.DisplaySettings.setSystemDarkMode(e)}},{key:"onEvent_fileChanged",value:function(e){try{this._fileListener(y.a.CrudActions.Modified,e)}catch(t){Xh.toasts.pushMessage("A local document has gotten corrupted. Please check the Moo.do documents saved on your computer."),v.default.reportError(t)}}},{key:"onEvent_fileDeleted",value:function(e){try{this._fileListener(y.a.CrudActions.Removed,e)}catch(t){v.default.reportError(t)}}},{key:"onEvent_hotkeyPressed",value:function(e){Xh.menus.isModalOpen()||setTimeout((function(){var t=Xh.settings.appHotkeys.get(),n=t.newItem,r=t.newEmail;if(n&&Xh.hotkeys.convertToElectron(n)===e)Xh.menus.openItemEditor({addOnSave:!0,selectDocument:!0,element:"newItemButton"});else if(r&&Xh.hotkeys.convertToElectron(r)===e)Xh.menus.openComposeEmail(Xh.pluginManager.getPluginGmail());else try{v.default.PAssert(297,!1,"Missing action for hotkey")}catch(i){v.default.reportError(i)}}),10)}},{key:"getDarkMode",value:function(){return this._darkMode}}]),e}(),b()(oh.prototype,"handleMessage",[w.a],Object.getOwnPropertyDescriptor(oh.prototype,"handleMessage"),oh.prototype),oh);function mh(e){try{v.default.PAssert(821,void 0===window.__MoodoBridge[e],"Registering an Inbound API that already exists on the window object",e)}catch(t){v.default.reportError(t)}this._name=e,this._publicObj={},this._privateObj={},window.__MoodoBridge[e]=this._publicObj,this.init()}mh.prototype={init:function(){},_createWrapper:function(e){return function(){try{return e.apply(this,arguments)}catch(t){v.default.reportError(t)}}},registerFunction:function(e,t,n){try{v.default.PAssert(822,e,"Name must be provided to register function")}catch(r){v.default.reportError(r)}try{v.default.PAssert(823,t,"A valid function must be provided to register")}catch(r){v.default.reportError(r)}try{v.default.PAssert(824,void 0===this._privateObj[e],"Re-registering an api function on private obj",e)}catch(r){v.default.reportError(r)}try{v.default.PAssert(825,void 0===this._publicObj[e],"Re-registering an api function on public obj",e)}catch(r){v.default.reportError(r)}this._privateObj[e]=t.bind(this._privateObj),n&&(this._publicObj[e]=this._createWrapper(this._privateObj[e]))},registerVariable:function(e,t,n){try{v.default.PAssert(826,e,"Name must be provided to register variable")}catch(r){v.default.reportError(r)}try{v.default.PAssert(827,!n,"Public variables are not currently supported")}catch(r){v.default.reportError(r)}try{v.default.PAssert(828,void 0===this._privateObj[e],"Re-registering an api variable on private obj")}catch(r){v.default.reportError(r)}try{v.default.PAssert(829,void 0===this._publicObj[e],"Re-registering an api variable on public obj")}catch(r){v.default.reportError(r)}this._privateObj[e]=t}},G.a.defineBase(mh);var yh=mh;function _h(e){this._name=e,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}_h.prototype={init:function(){v.default.isObject(window[this._name])?this.onAPILoaded():(G.a.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){try{v.default.PAssert(867,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(e){v.default.reportError(e)}v.default.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){var e=0;this._apiLoaded=!0;for(var t=0;t<this._requiredFns.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._requiredFns[t];v.default.isFunction(window[this._name][n])||(this._apiError=!0,this._addMissingFn(n))}this.notifyListeners()},requestNotification:function(e){this._apiLoaded?setTimeout(e,0):this._listeners?this._listeners.push(e):this._listeners=[e]},notifyListeners:function(){try{v.default.PAssert(868,this._apiLoaded,"API must be loaded to notify listeners")}catch(n){v.default.reportError(n)}if(this._listeners)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._listeners[t]()}this._listeners=void 0},requireFunction:function(e,t){try{v.default.PAssert(869,this._requiredFns.indexOf(e)<0,"Should not double require a single function")}catch(n){v.default.reportError(n)}this._requiredFns.push(e),this._apiLoaded&&(v.default.isFunction(window[this._name][e])||t||(this._apiError=!0,this._addMissingFn(e)))},_addMissingFn:function(e){if(this._missingFns){try{v.default.PAssert(870,this._missingFns.indexOf(e)<0,"Should not be missing the same function multiple times")}catch(t){v.default.reportError(t)}this._missingFns.push(e)}else this._missingFns=[e]},hasOptionalFunction:function(e){try{v.default.PAssert(871,this._requiredFns.indexOf(e)>=0,"Must be querying for a registered function")}catch(t){v.default.reportError(t)}return!!window[this._name]&&!!window[this._name][e]},call:function(e){try{v.default.PAssert(872,this._apiLoaded,"Trying to call an API function before it is loaded",e)}catch(n){v.default.reportError(n)}if(this._apiLoaded){var t=Array.prototype.slice.call(arguments,1);try{return window[this._name][e].apply(window[this._name],t)}catch(r){v.default.reportError(r)}}}},G.a.defineBase(_h);var bh,wh,kh=_h,Sh=(bh=function(){function e(){if(a()(this,e),k.a.app)try{this.flushingBacklog=!1,this.isPokingBackground=!1,this.setupFns=[],this.setupFns[y.a.AppPlatform.Electron]=this.setupElectron,this.sendFns=[],this.sendFns[y.a.AppPlatform.Electron]=this.sendToAppElectron,this.setupFn=this.setupFns[k.a.appPlatform],this.sendFn=this.sendFns[k.a.appPlatform],this.init(),this._isEnabled=!0}catch(t){v.default.log("Native API Bridge Disabled"),v.default.reportError(t)}else this._isEnabled=!1;if(this._embedBridge=void 0,k.a.app||k.a.embed){try{v.default.PAssert(280,void 0===window.__MoodoBridge,"Must not have a previous bridge in place")}catch(n){v.default.reportError(n)}window.__MoodoBridge={},this._canRegisterAPIs=!0,this._inboundAPIs={},this._outboundAPIs={}}}return s()(e,[{key:"init",value:function(){if(!k.a.isMobile){try{v.default.PAssert(281,this.setupFn,"Must have a valid setup function")}catch(e){v.default.reportError(e)}try{v.default.PAssert(282,this.sendFn,"Must have a valid send function")}catch(e){v.default.reportError(e)}if(!this.setupFn||!this.sendFn)return;this.setupFn()}}},{key:"isEnabled",value:function(){return this._isEnabled}},{key:"registerEmbedBridge",value:function(e){try{v.default.PAssert(283,e,"Must supply a valid embed bridge")}catch(t){v.default.reportError(t)}try{v.default.PAssert(284,k.a.embed,"Must be embedded")}catch(t){v.default.reportError(t)}this._embedBridge=e}},{key:"hasEmbedBridge",value:function(){return!!this._embedBridge}},{key:"sendToEmbed",value:function(e,t){try{v.default.PAssert(285,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",e)}catch(n){v.default.reportError(n)}this._embedBridge.handleEmbedMessage(e,t)}},{key:"registerInboundAPI",value:function(e){try{v.default.PAssert(286,!this._inboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(n){v.default.reportError(n)}if(this._canRegisterAPIs){var t=new yh(e);return this._inboundAPIs[e]=t,t}}},{key:"registerOutboundAPI",value:function(e){try{v.default.PAssert(287,!this._outboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(n){v.default.reportError(n)}if(this._canRegisterAPIs){var t=new kh(e);return this._outboundAPIs[e]=t,t}}},{key:"setupElectron",value:function(){Xh.ElectronBridge.setup()}},{key:"sendToApp",value:function(e,t){try{v.default.PAssert(288,k.a.app,"Only use native bridge when creating an app")}catch(i){v.default.reportError(i)}try{v.default.PAssert(289,this.sendFn,"Must have a valid send method for the native bridge")}catch(i){v.default.reportError(i)}var n=!1;try{var r;t&&(r=v.default.isString(t)?t:JSON.stringify(t)),this.sendFn&&(this.sendFn(e,r),n=!0)}catch(a){v.default.reportError(a)}return n}},{key:"sendToAppElectron",value:function(e,t){Xh.ElectronBridge.sendMessage(e,t)}}]),e}(),b()(bh.prototype,"setupElectron",[w.a],Object.getOwnPropertyDescriptor(bh.prototype,"setupElectron"),bh.prototype),b()(bh.prototype,"sendToApp",[w.a],Object.getOwnPropertyDescriptor(bh.prototype,"sendToApp"),bh.prototype),b()(bh.prototype,"sendToAppElectron",[w.a],Object.getOwnPropertyDescriptor(bh.prototype,"sendToAppElectron"),bh.prototype),bh),Eh=y.a.TooltipDelay,Ph=function(){function e(){a()(this,e),this.tooltip=new E.a,this.tooltipsSticky=new Y.a,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,k.a.touch||(K.a.listen("mouseover",this.handleEleOver.bind(this)),K.a.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))}return s()(e,[{key:"windowOut",value:function(e){(e.pageX>=k.a.windowWidth()||e.pageY>=k.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.hideTip()}},{key:"register",value:function(e,t){this.update(e,t)}},{key:"update",value:function(e,t){e.setAttribute("tooltip",t)}},{key:"displayTipSticky",value:function(e){e.sticky=!0,this.displayTip(e)}},{key:"displayTip",value:function(e){try{v.default.PAssert(301,e,"When display a tooltip, must pass in some info")}catch(i){v.default.reportError(i)}clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var t=this.displayElement=e.element;if(e&&t&&t.offsetWidth>0&&t.offsetHeight>0){var n=e.text;this.isSticky=e.sticky;try{v.default.PAssert(302,n,"When display a tooltip, elements should always have valid data set")}catch(i){v.default.reportError(i)}if(n){var r={text:n,hotkey:e.hotkey,element:t,blue:e.blue,sticky:e.sticky,maxWidth:e.maxWidth,onRight:e.onRight,arrowClass:e.arrowDirection||"hidden"};e.sticky?this.tooltipsSticky.push(r):this.tooltip.set(r)}}}},{key:"tipOut",value:function(e){var t=!0;e.target&&(t=v.default.isAttachedToDoc(e.target)&&!v.default.findParent(e.target,"tooltip")),t&&this.hideTip()}},{key:"getAttr",value:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltip")||e.getAttribute("data-tooltip"))}},{key:"getAttrHotkey",value:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltipHotkey")||e.getAttribute("data-tooltiphotkey"))}},{key:"getByClassName",value:function(e,t){var n,r=k.a.priModKey,i=e.parentElement,a=e.textContent,o=k.a.mac?"Option":"Alt";if(!v.default.findParent(e,"fancyInputInner")&&!v.default.findParentID(e,"ReactAutocomplete")&&!Xh.menus.isModalOpen()){var s=v.default.getPaneObjectForElement(e),u=s&&R.a.isSelected(s);if(v.default.hasClass(e,"linkImage"))n="<b>Click</b> to open image.<br><b>"+r+" + Click</b> to open in "+(k.a.app?"browser":"new tab")+".";else if(v.default.findParent(e,"itemLink"))n="<b>Click</b> to open linked item<br><b>".concat(r," + Click</b> to open linked item in popup pane<br><b>").concat(r," + Shift + Click</b> to open linked item in new pane");else if(i&&v.default.hasClass(i,"appLink")){n="<b>"+r+" + Click</b> to open in "+((v.default.hasClass(i,"evernote")?"Evernote":v.default.hasClass(i,"onenote")&&"OneNote")||v.default.hasClass(i,"bear")&&"Bear"||"")}else if(v.default.hasClass(e,"link")&&e.getAttribute("data-href")){var l=e.getAttribute("data-href"),c=u?"".concat(r," + "):"";n=(l!==a?l+"<br>":"")+"<b>".concat(c,"Click</b> to open")}else v.default.hasClass(e,"tag")?n="<b>Click</b> to show only "+a+"<br><b>Shift + Click</b> to hide "+a+"<br><b>"+o+" + Click</b> to remove "+a:v.default.hasClass(e,"contact")?n="<b>"+r+"+ Click</b> to show only "+a+"<br><b>"+r+" + Shift + Click</b> to hide "+a+"<br><b>"+o+" + Click</b> to remove "+a:v.default.hasClass(e,"email")?n="<b>"+r+"+ Click</b> to email "+a:v.default.hasClass(e,"prefixHeader")||v.default.hasClass(e,"prefixBullet")?n="<b>Click</b> to zoom in":v.default.hasClass(e,"prefixTask")?n="<b>Click</b> to toggle complete.<br><b>"+r+" + Click</b> to zoom in.":v.default.hasClass(e,"prefixNumList")?n="<b>"+r+" + Click</b> to zoom in":v.default.hasClass(e,"inlineDate")?n="<b>Click</b> to edit date<br><b>"+o+" + Click</b> to remove date":v.default.hasClass(e,"plugin")&&(n=(t>0?"<b>"+r+" + Click</b>":"<b>Click icon</b>")+" to open")}return n}},{key:"getTooltipText",value:function(e,t){return this.getAttr(e)||this.getByClassName(e,t)}},{key:"handleEleOver",value:function(e){try{v.default.PAssert(303,v.default.isDOMNode(e.target),"Must have a valid DOM node: ",z()(e.target))}catch(o){v.default.reportError(o)}if(e.target){for(var t,n,r=0,i=e.target,a=0;!t&&i&&a<3;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t=this.getTooltipText(i,a),n=this.getAttrHotkey(i),t||n||(i=i.parentElement)}if(i&&(!t&&n&&(t=n,n=void 0),t&&this.displayElement!==i&&!Xh.DragDrop.isDragging&&!R.a.isMouseDown())){clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),Eh,{element:i,offset:{y:5},text:t,hotkey:n})}}}},{key:"handleEleOut",value:function(e){this.tipOut(e)}},{key:"isOpenSticky",value:function(){return this.tooltipsSticky.get().length>0}},{key:"hideSticky",value:function(e){for(var t=0,n=this.tooltipsSticky.get(),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(n[r].text===e){this.tooltipsSticky.removeAt(r);break}}}},{key:"hideTip",value:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}}]),e}(),Ih=function(){function e(){a()(this,e),this.popupClosedError=new E.a,this.gapiFailedToLoad=new E.a,this.loggedOutByAuthFailure=new E.a,this.isLoggingOut=new E.a,this.downloadIcon=this.getDownloadIcon(),this.showDownload=k.a.canDownloadNativeApp(),this.loginRequested=!1,this.loginRequestTimer=void 0}return s()(e,[{key:"getDownloadIcon",value:function(){return k.a.getPlatformIcon()}},{key:"logout",value:function(){var e=Bo()(jo.a.mark((function e(){return jo.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(!Xh.settings.activeUser.get()){e.next=7;break}return v.default.log("Logging out"),this.isLoggingOut.set(!0),e.next=5,N.a.clearLocalData();case 5:return e.next=7,Eo.a.signOut();case 7:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutClicked",value:function(){var e=this;v.default.isDemoMode()?G.a.removeURLParam("demo"):N.a.hasPendingRemoteUpdates()?Xh.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",(function(t){t&&e.logout()})):this.logout()}},{key:"_reportLoginTapSkip",value:function(e){}},{key:"closeConnectionError",value:function(){Xh.tooltip.hideSticky(this.textErrorConnecting)}}]),e}(),Dh=(wh=function(){function e(){a()(this,e),this.useServiceWorker="serviceWorker"in navigator,this.notifiedOfNew=!1,this.hasUpdate=new E.a,setInterval(this.update,y.a.MSPerHour)}return s()(e,[{key:"init",value:function(){var e=this;this.useServiceWorker&&navigator.serviceWorker.addEventListener("message",(function(t){Xh.settings.activeUser.get()&&("ServiceWorker_Activated"===t.data?e.onUpdateReady():"ServiceWorker_Installed"===t.data&&setTimeout(e.onUpdateReady,2e3))}))}},{key:"update",value:function(){var e=Bo()(jo.a.mark((function e(t){var n;return jo.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(this.hasUpdate.get()){e.next=12;break}if(e.prev=1,!this.useServiceWorker){e.next=8;break}if(!(n=window.__registeredServiceWorker)){e.next=8;break}return e.next=7,n.update();case 7:null===t||void 0===t||t(!!n.installing);case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(1);case 12:case"end":return e.stop()}}}),e,this,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onUpdateReady",value:function(){v.default.log("Cache: New version available"),this.useServiceWorker&&v.default.log("Service worker has update"),this.updateAction()}},{key:"onFirstUpdateReady",value:function(){v.default.log("Cache: first update")}},{key:"onUpdateError",value:function(e){!k.a.demo&&N.a.isConnected()&&(v.default.log("Update Error: ",e),"quota"===e.reason&&Xh.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"}))}},{key:"onUpdateDownloading",value:function(){v.default.log("Cache: New version downloading")}},{key:"updateAction",value:function(){this.hasUpdate.set(!0),Xh.toasts.pushUpdateMessage({text:"A new update is available",action1Text:"LOG",action1Click:function(){return Xh.openUrl(location.origin+"/changelog/")},action2Text:"UPDATE",action2Click:function(){return v.default.reload()}})}}]),e}(),b()(wh.prototype,"update",[w.a],Object.getOwnPropertyDescriptor(wh.prototype,"update"),wh.prototype),b()(wh.prototype,"onUpdateReady",[w.a],Object.getOwnPropertyDescriptor(wh.prototype,"onUpdateReady"),wh.prototype),wh),Th=n(85),xh=n.n(Th);function Ch(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Ah=function(e){d()(n,e);var t=Ch(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"init",value:function(){this.createObservables({ripples:[]}),this.rippleNum=0}},{key:"getElement",value:function(){return xh.a.findDOMNode(this)}},{key:"onMouseDown",value:function(e){var t=this.props;if(!1!==t.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(e),this.props.children&&!e.defaultPrevented&&!1!==t.ripple){var n,r,i=this.refs.element,a=i.offsetWidth,o=i.offsetHeight,s=Math.min(a,o);if(this.props.center)n="50%",r="50%";else{var u=v.default.offset(i);n=e.clientX-u.left,r=e.clientY-u.top}var l={id:this.rippleNum++,left:n,top:r,width:s,height:s};this.ripples.push(l),setTimeout(this.removeRipple,1e3)}e.stopPropagation()}}},{key:"onRightClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onRightClick(e)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){for(var e=0,t=this.state,n=this.props,r=n.center,i=n.onClick,a=(n.enabled,n.ripple,n.onRightClick),o=n.rippleColor,s=n.className,u=n.children,l=V()(n,["center","onClick","enabled","ripple","onRightClick","rippleColor","className","children"]),c=[],d=0;d<t.ripples.length;d++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var h=t.ripples[d],f={left:h.left,top:h.top,width:h.width,height:h.height,marginLeft:-h.width/2,marginTop:-h.height/2},p=v.default.classNames("fancyRipple",o||"defaultColor");c.push(M.a.createElement("div",{key:"ripple_"+h.id,className:p,style:f}))}var g=v.default.classNames(s,"fancyRippler",{rippleCenter:r});return M.a.createElement("div",L()({},l,{className:g,onMouseDown:this.onMouseDown,onClick:i,onContextMenu:a?this.onRightClick:void 0,ref:"element"}),u,c.length>0&&M.a.createElement("div",{className:"fancyRipples"},c))}}]),n}(te);function Lh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Oh,Mh,Rh=function(e){d()(n,e);var t=Lh(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"init",value:function(){this.createObservables({isLoading:!1})}},{key:"getElement",value:function(){return Th.findDOMNode(this)}},{key:"onClick",value:function(e){this.isLoading.get()||!1===this.props.enabled||(this.props.onClick||this.props.onMouseDown)(e,this.onButtonClickCallback)&&this.isLoading.set(!0)}},{key:"onMouseDown",value:function(e){if(!1!==this.props.enabled&&e.button===y.a.ButtonCode.Left&&this.props.onHold){var t={target:e.target,preventDefault:e.preventDefault};this._holdTimeout=setTimeout(this.onHold,150,t)}}},{key:"onMouseUp",value:function(e){this._clearHoldTimeout(),this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onHold",value:function(e){this._clearHoldTimeout(),this.props.onHold(e)}},{key:"_clearHoldTimeout",value:function(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)}},{key:"onKeyDown",value:function(e){e.keyCode===y.a.KeyCode.Enter&&this.onClick(e)}},{key:"focus",value:function(){this.getElement().focus()}},{key:"onButtonClickCallback",value:function(){this.isLoading.set(!1)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){var e,t,n,r=this.state,i=this.props,a=!1===i.enabled,o=0===(null===(e=i.color)||void 0===e?void 0:e.indexOf("#"));i.color&&!o?n=i.color:i.primary?n=i.raised?"c-button-raised-primary":"c-button-primary":i.heavy?i.raised||(n="c-button-heavy"):n=i.cancel?i.raised?"c-button-raised-cancel":"c-button-cancel":i.raised?"c-button-raised":"c-button";var s={display:i.display,lineHeight:i.height?"auto"===i.height?null:i.height+"px":"36px",height:i.height,width:i.width,minWidth:i.width,textAlign:null!==(t=i.textAlign)&&void 0!==t?t:"center",margin:i.margin,paddingLeft:i.paddingLeft,paddingTop:i.paddingTop,paddingRight:i.paddingRight,paddingBottom:i.paddingBottom,fontWeight:i.fontWeight,fontSize:i.fontSize,color:i.color};void 0===i.margin&&(s.marginLeft=i.marginLeft,s.marginTop=i.marginTop,s.marginRight=i.marginRight,s.marginBottom=i.marginBottom),s=v.default.extend(s,this.props.style),i.raised&&!i.children&&i.icon&&!1!==i.round&&(s.borderRadius="50%");var u,l={fontSize:i.fontSize};if(i.icon){var c={height:i.height,fontSize:i.iconSize,color:i.color},d=v.default.classNames("fancyButtonIcon",i.icon,{"c-button":!!i.color});i.children?0!==i.padding&&(l.paddingLeft="6px",l.paddingRight=0,s.paddingLeft="16px",s.paddingRight="16px"):(s.width=i.width||36,s.height=i.height||36,s.maxWidth=i.width||36,s.maxHeight=i.height||36,s.textAlign="center"),u=M.a.createElement("i",{className:d,style:c})}isNaN(i.padding)||(l.padding="0 "+i.padding+"px"),i.paddingText&&(l.paddingLeft=i.paddingText);var h=i.children&&M.a.Children.count(i.children)>0,f=v.default.classNames("fancyButtonText align-middle"),p=h&&M.a.createElement("div",{className:f,style:l},i.children),g=v.default.classNames("fancyButton",n,{raised:i.raised},{loading:r.isLoading},{primary:i.primary},{cancel:i.cancel},{hasText:h},{hasIcon:!!i.icon||!!i.iconComponent},{disabled:a},{selected:i.selected},i.className),m=r.isLoading&&M.a.createElement(yo,{center:!0,color:"#fff",size:6}),y=i.tooltipHotkey,_=y?v.default.isString(y)?y:Xh.hotkeys.printHotkeyByName(y.name,y.group):void 0;return M.a.createElement(Ah,{className:g,style:s,enabled:i.enabled,onPointerDown:void 0,onMouseEnter:i.onMouseEnter,onMouseLeave:i.onMouseLeave,onMouseDown:i.onMouseDown&&this.onClick||i.onHold&&this.onMouseDown||void 0,onMouseUp:i.onHold||i.onMouseUp?this.onMouseUp:void 0,onClick:i.onClick?this.onClick:void 0,onDoubleClick:i.onDoubleClick,onRightClick:i.onRightClick,onKeyDown:this.onKeyDown,id:i.id,center:i.center||(!!i.icon||!!i.iconComponent)&&!h,ripple:i.ripple,tabIndex:i.tabIndex,"data-tooltip":!a&&i.tooltip?i.tooltip:null,"data-tooltiphotkey":a?null:_},u,i.iconComponent&&M.a.createElement(i.iconComponent,{size:i.iconSize,style:{height:s.lineHeight}}),p,m)}}]),n}(te),Fh={display:"inline-block",height:"24px"},Nh=function(e){return'<span class="introHotkey c-bg-light c-blue">'.concat(e,"</span>")},jh=(Oh=function(){function e(){a()(this,e)}return s()(e,[{key:"init",value:function(){var e=this;this.itemsByAction={},this.itemsByID={},this.isHelpOpen=new E.a(!1,this.saveHelpPaneState),this.isHotkeysOpen=new E.a(!1,this.saveHelpPaneState),this.priKey=k.a.priModKey,this.secKey=k.a.secModKey,this.secKeyForce=k.a.secModKeyForce,this.tooltipIntroSection=void 0;var t=Xh.settings.helpPaneState.get();void 0===t&&(t={e:!1,o:!1}),this.initHelp(),v.default.isDemoMode()||(this.loadState(),Xh.settings.inTooltipIntro.get()&&this.tooltipIntroSection.isComplete.get()&&Xh.settings.inTooltipIntro.set(!1)),Xh.settings.helpPaneState.listen((function(t,n){void 0===t||v.default.deepEqual(t,n)||(e.isHelpOpen.set(t.e),e.isHotkeysOpen.set(t.o))})),Xh.settings.helpState.listen((function(t,n){t&&t!==n&&e.loadState()}))}},{key:"getItem",value:function(e){return this.itemsByAction[e]}},{key:"createItem",value:function(e,t){var n=t;return n.isComplete=new E.a(!1),n.isDisabled=new E.a(!1),n.show=function(){return n.isDisabled.set(!1)},this.itemsByAction[e]=n,this.itemsByID[n.id]=n,n}},{key:"saveHelpPaneState",value:function(){Xh.settings.helpPaneState.set({o:this.isHotkeysOpen.get(),e:this.isHelpOpen.get()})}},{key:"showHelp",value:function(){this.isHelpOpen.set(!0)}},{key:"toggleHelp",value:function(){this.isHelpOpen.set(!this.isHelpOpen.get())}},{key:"showHotkeys",value:function(){this.isHotkeysOpen.set(!0)}},{key:"toggleHotkeys",value:function(){this.isHotkeysOpen.set(!this.isHotkeysOpen.get())}},{key:"_getHelpStateObj",value:function(){var e={},t=Xh.settings.helpState.get();if(v.default.isString(t)){if(t)try{(e=JSON.parse(t))&&!v.default.isString(e)||(e={})}catch(n){v.default.reportError(n)}}else e=t;return e||{}}},{key:"loadState",value:function(){var e=this._getHelpStateObj();if(e&&!v.default.isEmpty(e)){var t=this.itemsByID;Object.keys(e).forEach((function(n){return e[n]&&t[n]&&t[n].isComplete.set(!0)}))}}},{key:"saveState",value:function(){if(v.default.shouldWriteLocal())try{var e=v.default.clone(this._getHelpStateObj()),t=!1,n=this.itemsByID;Object.keys(n).forEach((function(r){return n[r].isComplete.get()&&!e[r]&&(t=!0,e[r]=1)})),t&&Xh.settings.helpState.set(JSON.stringify(e))}catch(r){v.default.reportError(r)}}},{key:"getState",value:function(){var e=v.default.clone(this._getHelpStateObj()),t=this.itemsByAction;return Object.keys(t).forEach((function(n){return t[n].isComplete.get()&&(e[t[n].id]=1)})),e}},{key:"initHelp",value:function(){this.createItem("PluginSettings",{id:"pS",jsx:M.a.createElement("span",null,"Open the ",M.a.createElement(Rh,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return Xh.menus.openSettings("Plugins")}},"Settings")," to setup sync with Google services.")}),this.createItem("Encryption",{id:"en",jsx:M.a.createElement("span",null,"Optionally ",M.a.createElement(Rh,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return Xh.menus.openSettings("Security")}},"Enable Encryption")," to add an extra layer of security to your data.")}),this.createItem("Import",{id:"i",jsx:M.a.createElement("span",null,M.a.createElement(Rh,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return Xh.menus.openModal(y.a.Modals.ImportData)}},"Import your data")," from another app or just start typing to get started.")}),this.createItem("Demo",{id:"d",jsx:M.a.createElement("span",null,"Try the ",M.a.createElement(Rh,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){Xh.openUrl("/demo")}},"Demo")," to explore all of Moo.do's features.")}),this.createItem("AddItem",{id:"a",text:"Moo.do works like a text editor. Type some text to get started and press ".concat(Nh("Enter")," to add a new item.")}),this.createItem("SlashHelp",{id:"h",text:"Type ".concat(Nh("/")," in an empty item to see available options.")}),this.createItem("Search",{id:"s",text:"Use search to focus on a subset of your items. Click the search box at the top of the pane to see search options."}),this.createItem("ViewMode",{id:"v",text:"Click the <b>Outline</b> button at the top of a pane to explore view modes."}),this.createItem("AddPane",{id:"aP",jsx:M.a.createElement("span",null,"Click the ",M.a.createElement(Rh,{icon:"icon-add-pane",className:"align-text-bottom",iconSize:15,width:28,height:16,onClick:function(){return Xh.menus.openAddPaneMenu({element:"addPaneButton"})}})," button to add a new pane.")}),this.createItem("AddBoard",{id:"aB",jsx:M.a.createElement("span",null,"Click the ",M.a.createElement(Rh,{icon:"icon-add",className:"align-text-bottom",iconSize:15,width:28,height:16,onClick:function(){Xh.PaneManager.addBoard()}})," button to add a new board.")}),this.createItem("Email",{id:"e",text:"Use the Email pane to read and reply to your emails. Double click an email to open it."}),this.createItem("EmailCompose",{id:"eC",jsx:M.a.createElement("span",null,"Click the ",M.a.createElement(Rh,{icon:"icon-mail_outline",className:"mx-1 align-middle",iconSize:14,width:16,height:16,onClick:function(){return Xh.menus.openComposeEmail(Xh.pluginManager.getPluginGmail())}})," button to compose a new email, and use the Email pane to read and reply to your emails.")}),this.createItem("NewDoc",{id:"nD",text:'Click the <i class="icon-menu g mx-1"></i> button in a pane to open the documents list and click <i class="icon-add mx-1"></i> to add a new document.'}),this.createItem("ShareDoc",{id:"sD",text:"Right click on a document and select Share to collaborate on a document."}),this.createItem("ChangeDoc",{id:"cD",text:"Select a document in the document list or click on the document name at the top of a pane to change documents."}),this.createItem("Indent",{id:"458052715",text:"Moo.do has infinite hierarchy. Press ".concat(Nh("Tab")," to indent an item under its parent and ").concat(Nh("Shift + Tab")," unindent it.")}),this.createItem("Drag",{id:"3825397189",text:"Click and drag the left edge of an item to move it around or to another pane."}),this.createItem("Collapse",{id:"441256378",text:'Click <i class="icon-angle-down font-bold"></i> next to an item or press '.concat(Nh(Xh.hotkeys.printHotkeyByName("Collapse"))," to collapse its subitems.")}),this.createItem("Date",{id:"321249113",text:"Add a date by typing ".concat(Nh("!")," in the text of an item or pressing ").concat(Nh(this.priKey+" + Shift + D")," to add it to your calendar.")}),this.createItem("AddCalendar",{id:"adc2",text:"Add an item with a date to Google Calendar by pressing ".concat(Nh(this.secKeyForce+" C")," or selecting the calendar in the date popup.")}),this.createItem("RightClickItem",{id:"3288459206",text:"Right click an item to explore more options."}),this.createItem("Priority",{id:"215510164",text:"Set a priority with the right click menu or ".concat(Nh(this.secKey+" 1|2|3"),"</span>.")}),this.createItem("Complete",{id:"2165585377",text:"Click the right edge of an item or ".concat(Nh(this.secKey+" /"),"</span> to complete it.")}),this.createItem("Zoom",{id:"1829655333",text:"Zoom into an item to focus on only its children. Press ".concat(Nh(this.priKey+" Enter")," or hold ").concat(Nh(this.priKey)," and click its left edge.")}),this.createItem("Overview",{id:"801492595",text:'The overview shows only parents for easy scrolling and zooming. Click the <i class="icon-menu g mx-1"></i> button in a pane to open the documents list, and click <i class="icon-format_list_bulleted g mx-1"></i> to open the overview.'}),this.createItem("Tag",{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag.'}),this.createItem("DragFromComp",{id:"drDr",text:"Drag a file from your computer to upload it to Drive and add it to a list."}),this.createItem("SettingsMenu",{id:"oS",jsx:M.a.createElement("span",null,"Click ",M.a.createElement("span",{style:Fh},M.a.createElement(Rh,{icon:"icon-settings",className:"align-text-bottom",width:16,height:16,onClick:function(){return Xh.menus.openOptions()}}))," and select Settings to customize Moo.do's various options.")}),this.createItem("DisplaySettings",{id:"oDS",jsx:M.a.createElement("span",null,"Click ",M.a.createElement("span",{style:Fh},M.a.createElement(Rh,{icon:"icon-settings",className:"align-text-bottom",width:16,height:16,onClick:function(){return Xh.menus.openOptions()}}))," and select Display Settings to customize your view.")})}},{key:"onAction",value:function(e){if(!Xh.menus.isModalOpen(y.a.Modals.ImportData)||"Import"===e){var t=this.itemsByAction[e];t.isComplete.get()||(t.isComplete.set(!0),this.saveState())}}}]),e}(),b()(Oh.prototype,"getItem",[w.a],Object.getOwnPropertyDescriptor(Oh.prototype,"getItem"),Oh.prototype),b()(Oh.prototype,"saveHelpPaneState",[w.a],Object.getOwnPropertyDescriptor(Oh.prototype,"saveHelpPaneState"),Oh.prototype),Oh),Uh=n(49),Bh=function(){function e(){a()(this,e),this.stack=[]}return s()(e,[{key:"push",value:function(e){this.stack.push(e)}},{key:"pop",value:function(e){this.stack.remove(e)}},{key:"peek",value:function(){return this.stack[this.stack.length-1]}},{key:"contains",value:function(e){return this.stack.indexOf(e)>=0}},{key:"forEach",value:function(e){for(var t=0,n=this.stack.length-1;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!1===e(this.stack[n],n))break}}}]),e}(),Vh={},Hh=0,Wh=1,qh=2,zh=3,Gh={Pane:{Search:["Pr+F"],Filter:["Se+F"],Overview:["Se+O"],Complete:["Pr+Enter"],ZoomOut:["Se+Sh+Enter","Se+ArrowLeft"],ZoomIn:["Se+Enter","Se+ArrowRight"],EditNote:["Sh+Enter"],Collapse:["Pr+Period","mac:Se+Space"],CollapseRecursive:["Pr+Sh+Period","mac:Se+Sh+Space"],CollapseAll:["Pr+Se+Period","mac:Pr+Se+Sh+Space"],Unindent:["Sh+Tab"],Indent:["Tab"],UnindentWithoutChildren:["Pr+BracketLeft","Se+BracketLeft","Se+Sh+ArrowLeft"],IndentWithoutChildren:["Pr+BracketRight","Se+BracketRight","Se+Sh+ArrowRight"],MoveUp:["win:Se+Sh+ArrowUp","mac:Op+ArrowUp","win:Pr+Sh+ArrowUp"],MoveDown:["win:Se+Sh+ArrowDown","mac:Op+ArrowDown","win:Pr+Sh+ArrowDown"],Priority1:["Pr+D1"],Priority2:["Pr+D2"],Priority3:["Pr+D3"],PriorityNone:["Pr+D0","Pr+D4"],Star:["Pr+D8","win:Pr+Tilde"],NextPane:["mac:app:Se+Tilde","mac:app:Pr+Op+ArrowRight","win:Se+Tilde"],PreviousPane:["mac:app:Se+Sh+Tilde","mac:app:Pr+Op+ArrowLeft","win:Se+Sh+Tilde"],SelectItem:["Se+L"],ClosePane:["Sh+F4"],Bold:["Pr+B"],Italic:["Pr+I"],Underline:["Pr+U"],Strike:["Pr+Sh+X"],InlineCode:["Pr+Sh+C"],CodeBlock:["Pr+Sh+Se+C","mac:Pr+Sh+Op+C"],InsertLink:["Pr+K"],MoveAutocomplete:["Se+M"],HighlightInAllPanes:["Se+G"],PrefixHeader:["Pr+Sh+D6","Pr+Sh+P","Pr+Sh+H","win:Pr+Sh+D3"],PrefixTask:["mac:app:Pr+Sh+BracketLeft","win:Pr+Sh+BracketLeft","Se+Sh+BracketLeft","Pr+Sh+D9","Pr+Sh+D0"],PrefixBullet:["Pr+Sh+D8"],PrefixNumList:["Pr+Sh+D1"],AddToCalendar:["Se+C"],DeleteItem:["Pr+Sh+Backspace","Pr+Sh+K"],Date:["Pr+Sh+D"]},Global:{GlobalSearch:["Pr+P","Pr+Sh+F","Se+J"],SelectPane1:["app:Se+D1"],SelectPane2:["app:Se+D2"],SelectPane3:["app:Se+D3"],SelectPane4:["app:Se+D4"],SelectPane5:["app:Se+D5"],SelectPane6:["app:Se+D6"],SelectPane7:["app:Se+D7"],SelectPane8:["app:Se+D8"],SelectPane9:["app:Se+D9"],SelectPane10:["app:Se+D0"],Undo:["Pr+Z"],Redo:["Pr+Y","Pr+Sh+Z"],AddPane:["app:Pr+T","Se+T"],NewItem:["app:Pr+N","Se+N"],EmailCompose:["Pr+E"],NextBoard:["mac:app:Se+Tab","win:app:Pr+Tab"],PreviousBoard:["mac:app:Se+Sh+Tab","win:app:Pr+Sh+Tab"],SelectBoard1:["Se+Sh+D1"],SelectBoard2:["Se+Sh+D2"],SelectBoard3:["Se+Sh+D3"],SelectBoard4:["Se+Sh+D4"],SelectBoard5:["Se+Sh+D5"],SelectBoard6:["Se+Sh+D6"],SelectBoard7:["Se+Sh+D7"],SelectBoard8:["Se+Sh+D8"],SelectBoard9:["Se+Sh+D9"],SelectBoard10:["Se+Sh+D0"],HelpHotkeys:["Pr+Slash","Se+Slash"],Help:["Pr+Sh+Slash","Se+Sh+Slash"],Settings:["mac:app:Pr+Comma"]},Email:{Down:["ArrowDown","J"],Up:["ArrowUp","K"],Open:["Enter"],Archive:["E","Slash"],Delete:["Delete","Backspace","Sh+D3"],Schedule:["C"],Move:["M","V"],Task:["T"],Label:["L"],MarkRead:["I"],MarkUnread:["U"],Star:["S","D8"],Reply:["R"],ReplyAll:["Sh+R","A"],Forward:["F"],Priority1:["D1"],Priority2:["D2"],Priority3:["D3"],RemoveFromLabel:["Y"],Undo:["Z"],Print:["P"],OpenInGmail:["G"],Menu:["win:ContextMenu"]},Inbox:{Down:["ArrowDown","Sh+ArrowDown","J","Sh+J"],Up:["ArrowUp","Sh+ArrowUp","K","Sh+K"],Open:["Enter"],Archive:["E","Slash","Pr+Enter"],MarkRead:["I"],MarkUnread:["U"],OpenInGmail:["G"],CopyToItem:["M"],CopyToNewItem:["T"],Star:["S","D8"],Delete:["Backspace","Delete"]}},Kh=(Mh=function(){function e(){var t,n=this;a()(this,e),this.currentArrowsMode=void 0,this.platformPrimaryKey=k.a.mac?Wh:Hh,this.platformSecondaryKey=k.a.mac?Hh:qh;var r=function(e,t,r){var i=0;if(r||!Xh.menus.isContextMenuOpen()&&!Xh.menus.isModalOpen()){for(var a,o=e,s=o.ctrlKey,u=o.metaKey,l=o.altKey,c=o.shiftKey,d=0;d<t.length;d++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var h,f=t[d],p=!f.mods,g=void 0,m=void 0,_=void 0,b=void 0;if(p||(g=!!f.mods[Hh]===!!s,m=!!f.mods[Wh]===!!u||f.keyCode===y.a.KeyCode.ContextMenu,_=!!f.mods[qh]===!!l,b=!!f.mods[zh]===!!c),p||g&&m&&_&&b)if(f.isGlobal||e.target===document.body&&!Xh.menus.isContextMenuOpen()&&!Xh.menus.isModalOpen()||v.default.findParent(e.target,"paneContent")||v.default.findParent(e.target,"paneHiddenInput"))if(!f.isOnPane||f.group===(null===(h=v.default.focusedPane)||void 0===h?void 0:h.title)){a=f;break}}if(a){n.currentArrowsMode&&!a.isOnPane&&(n._exitingArrowsMode=n.currentArrowsMode,n._exitArrowsMode());var w=a.callback.call(n,e);return(a.stopPropagation||r)&&e.stopPropagation(),n._exitingArrowsMode=void 0,!1===w||(e.handled=!0,v.default.preventDefault(e),!1)}}},i=function(e){if(Xh.setup&&Xh.settings.activeUser.get()){k.a.normalizeKeys(e);var i,a=e.normCode;if(k.a.mac&&e.altKey&&e.code){var o=y.a.KeyCode[e.code.replace("Key","")];o&&(a=o)}if(t=a,n.currentArrowsMode&&n._updateArrowsMode(e),n.hotkeyStack.forEach((function(t){if(t&&t[a]&&(i=r(e,[t[a]],!0)),void 0!==i)return!1})),void 0===i){var s=Vh[a];s&&(i=r(e,s))}return i}};this.hotkeyStack=new Bh,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},G.a.binder(this,"onMouseDownArrowsMode"),document.addEventListener("keydown",i,!0),document.addEventListener("keyup",(function(e){Xh.setup&&Xh.settings.activeUser.get()&&(k.a.normalizeKeys(e),k.a.windows&&t!==e.normCode&&(e.normCode!==y.a.KeyCode.D1&&e.normCode!==y.a.KeyCode.D2&&e.normCode!==y.a.KeyCode.D3&&e.normCode!==y.a.KeyCode.D8||Vh[e.normCode]&&(i(e),t=void 0)))}),!0),Xh.settings.onLoaded((function(){n.updateConfig(),Xh.settings.hotkeys.listen(n.updateConfig)})),this.loadDefaultConfig(),this.updateConfig()}return s()(e,[{key:"loadDefaultConfig",value:function(){this.defaultConfig=Gh}},{key:"updateConfig",value:function(){var e=this,t=Xh.billingManager.hasPremiumFeatures()&&Xh.settings.hotkeys.get()||{};this.config={},Vh={},Object.keys(this.defaultConfig).forEach((function(n){return e.config[n]=Object.assign({},e.defaultConfig[n],t[n])})),Object.keys(this.config.Email).forEach((function(t){return e.createAndAddHotkeyNew("Email",t,e.config.Email[t],!1,!0,"Email")})),Object.keys(this.config.Inbox).forEach((function(t){return e.createAndAddHotkeyNew("Inbox",t,e.config.Inbox[t],!1,!0,"Inbox")})),Object.keys(this.config.Pane).forEach((function(t){return e.createAndAddHotkeyNew("Pane",t,e.config.Pane[t],!1)})),Object.keys(this.config.Global).forEach((function(t){return e.createAndAddHotkeyNew("Global",t,e.config.Global[t],!0)})),this.createAndAddHotkeyNew("None","Noop",["Pr+S"],!0)}},{key:"createAndAddHotkeyNew",value:function(e,t,n,r){var i=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.createHotkeyNew(e,t,n,r,a,o);s.forEach((function(e){return i.addHotkeyNew(e)}))}},{key:"createHotkeyNew",value:function(e,t,n,r){var i=0,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=[],s=a?this.callbackOnPane.bind(this,t):this["hotkey"+t];try{v.default.PAssert(204,s&&v.default.isFunction(s),"Missing hotkey handler",t)}catch(p){v.default.reportError(p)}for(var u=0;u<n.length;u++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=n[u],c=l.split(":"),d=c[c.length-1].split("+"),h=y.a.KeyCode[d[d.length-1]];try{v.default.PAssert(205,h,"Key code must be defined",l)}catch(p){v.default.reportError(p)}if(this.isValidPlatform(l)){var f={group:e,name:u>0?t+u:t,isGlobal:r,keyCode:h,primary:d.indexOf("Pr")>=0,secondary:d.indexOf("Se")>=0,shift:d.indexOf("Sh")>=0,option:d.indexOf("Op")>=0,isOnPane:a,callback:s,mods:{}};f.mods={},f.primary&&(f.mods[this.platformPrimaryKey]=!0),f.secondary&&(f.mods[this.platformSecondaryKey]=!0),f.option&&(f.mods[qh]=!0),f.shift&&(f.mods[zh]=!0),o.push(f)}}return o}},{key:"isValidPlatform",value:function(e){var t=e.split(":");return 1===t.length||(t.indexOf("win")<0||!k.a.mac)&&(t.indexOf("mac")<0||k.a.mac)&&(t.indexOf("app")<0||k.a.isNativeApp())}},{key:"pushStack",value:function(e){for(var t=0,n={},r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];n[i.keyCode]=i}return this.hotkeyStack.push(n),n}},{key:"pushStackEscape",value:function(e){return this.pushStack([this.createEscape(e)])}},{key:"popStack",value:function(e){this.hotkeyStack.pop(e)}},{key:"getHotkey",value:function(e){var t,n=Vh[e.normCode];if(n)for(var r=0,i=0;i<n.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n[i],o=!a.mods,s=void 0,u=void 0,l=void 0,c=void 0;if(o||(s=!!a.mods[Hh]===!!e.ctrlKey,u=!!a.mods[Wh]===!!e.metaKey,l=!!a.mods[qh]===!!e.altKey,c=!!a.mods[zh]===!!e.shiftKey),o||s&&u&&l&&c){t=a.name;break}}return t}},{key:"create",value:function(e,t,n,r,i,a){try{v.default.PAssert(206,v.default.isNumber(e),"Invalid keyCode")}catch(s){v.default.reportError(s)}try{v.default.PAssert(207,v.default.isBoolean(t),"Invalid isGlobal")}catch(s){v.default.reportError(s)}try{v.default.PAssert(208,v.default.isFunction(i),"Invalid callback")}catch(s){v.default.reportError(s)}var o={group:"",name:"",keyCode:e,mods:{},callback:i,isGlobal:t};return n!==y.a.Primary.Yes&&n!==y.a.Primary.Both&&n!==y.a.Primary.Only||(o.mods[this.platformPrimaryKey]=!0),n!==y.a.Primary.No&&n!==y.a.Primary.Never&&n!==y.a.Primary.Both||(o.mods[this.platformSecondaryKey]=!0),a&&k.a.mac&&(o.mods[qh]=!0),r===y.a.Shift.Yes&&(o.mods[zh]=!0),o}},{key:"addHotkeyNew",value:function(e){var t=e.keyCode;return Vh[t]||(Vh[t]=[]),Vh[t].push(e),e}},{key:"createEscape",value:function(e){return this.create(y.a.KeyCode.Escape,!0,y.a.Primary.Either,y.a.Shift.Either,e)}},{key:"_addHotkey",value:function(e,t,n,r,i,a,o){try{v.default.PAssert(209,n,"Must supply a valid keycode")}catch(u){v.default.reportError(u)}if(Vh[n]=Vh[n]||[],r===y.a.Primary.Either)return this._addHotkey(e,t,n,y.a.Primary.No,i,a,o),void this._addHotkey(e,t,n,y.a.Primary.Yes,i,a,o);if(i===y.a.Shift.Either)return this._addHotkey(e,t,n,r,y.a.Shift.No,a,o),void this._addHotkey(e,t,n,r,y.a.Shift.Yes,a,o);try{v.default.PAssert(210,!k.a.windows||r!==y.a.Primary.Both,"Should never require AltGr combo on windows")}catch(u){v.default.reportError(u)}var s=this.create(n,t,r,i,a);s.stopPropagation=o,s.name=e,Vh[n].push(s)}},{key:"registerArrowsMode",value:function(e,t,n,r,i,a){var o=this["arrowsModeIndex"+e]=new E.a(-1);return!0===t?this._enterArrowsMode(e,n,r,i):this._addHotkey(e,!0,t.keyCode,t.primary,t.shift,this._onKeyDownArrowsMode.bind(this,e,n,r,i,a)),o}},{key:"getArrowsModeObs",value:function(e){return this["arrowsModeIndex"+e]}},{key:"isInArrowsMode",value:function(e){return this.currentArrowsMode&&this.currentArrowsMode.name===e}},{key:"exitArrowsMode",value:function(e){this.isInArrowsMode(e)&&this._exitArrowsMode()}},{key:"_onKeyDownArrowsMode",value:function(e,t,n,r,i){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===e||this._enterArrowsMode(e,t,n,r,i)}},{key:"_enterArrowsMode",value:function(e,t,n,r,i){this.currentArrowsMode={name:e,cbGetMax:t,cbSelect:n,cbKey:r,cbOnHotkey:i},i&&i(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+e].set(-1)}},{key:"_exitArrowsMode",value:function(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)}},{key:"onMouseDownArrowsMode",value:function(e){this._exitArrowsMode()}},{key:"_updateArrowsMode",value:function(e){var t=this.currentArrowsMode,n=this.getArrowsModeObs(t.name),r=k.a.getKeyCode(e),i=n.get(),a=t.cbGetMax();if(r===y.a.KeyCode.Enter)i>=0&&t.cbSelect(i),this._exitArrowsMode(),v.default.preventAndStop(e);else if(r===y.a.KeyCode.Escape)this._exitArrowsMode();else if(r===y.a.KeyCode.ArrowUp)i>0&&n.set(i-1);else if(r===y.a.KeyCode.ArrowDown)i<a-1&&n.set(i+1);else if(t.cbKey){var o=t.cbKey(r,e);o>=0&&(t.cbSelect(o),this._exitArrowsMode(),v.default.preventAndStop(e))}}},{key:"checkToggleSearchFilter",value:function(e){var t=v.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.toggleFilterDefault(e),!0)}},{key:"checkToggleSearchPriority",value:function(e){var t=v.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.getFilterValue("priority")===e&&(e=0),t.search.setFilter("priority",e),!0)}},{key:"hotkeyNewItem",value:function(){Xh.menus.closeContextMenu(),Xh.menus.openItemEditor({addOnSave:!0,selectDocument:!0,element:"newItemButton"})}},{key:"hotkeyAddPane",value:function(){Xh.menus.closeContextMenu(),Xh.menus.openAddPaneMenu({element:"addPaneButton"})}},{key:"hotkeyFilter",value:function(){var e=v.default.focusedPane||Xh.PaneManager.getPaneAtIndex(0);if(e){var t=e.search;t.isFocused.get()||t.focus()}}},{key:"hotkeySearch",value:function(){var e=v.default.focusedPane||Xh.PaneManager.getPaneAtIndex(0);null===e||void 0===e||e.searchingPaneObjects.setProperty("isSearching",!0,!0)}},{key:"hotkeyHighlightInAllPanes",value:function(){v.default.focusedPane.applyToSelection((function(e){return Xh.PaneManager.scrollToAndHighlightItem(e,v.default.focusedPane),!1}))}},{key:"hotkeyOverview",value:function(){v.default.focusedPane&&v.default.focusedPane.toggleOverviewVisibility()}},{key:"hotkeyComplete",value:function(){var e,t=R.a.getPane(),n=R.a.getSelectedItems(),r=R.a.getStartObject(),i=t.findNextSiblingItem(r);if(R.a.isValid()&&1===n.length&&!n[0].isComplete()&&(e=!0),v.default.beginCompleteAction(),t.applyFnToSelection("setComplete",{toggle:"isComplete",value2:y.a.ChangeType.Local,noRestoreSel:!0}),e&&i){var a=t.findPaneObject(i.id);0,R.a.selectObject(a,0)}v.default.endCompleteAction(),v.default.sendEvent("Hotkey","Complete")}},{key:"_hotkeyPriorityHelper",value:function(e){v.default.focusedPane&&!this.checkToggleSearchPriority(e)&&v.default.focusedPane.applyPriorityToSelection(e,!0)}},{key:"hotkeyPriority1",value:function(){this._hotkeyPriorityHelper(y.a.VMLIFlag.P0)}},{key:"hotkeyPriority2",value:function(){this._hotkeyPriorityHelper(y.a.VMLIFlag.P1)}},{key:"hotkeyPriority3",value:function(){this._hotkeyPriorityHelper(y.a.VMLIFlag.P2)}},{key:"hotkeyPriorityNone",value:function(){v.default.focusedPane.applyPriorityToSelection(y.a.VMLIFlag.None)}},{key:"hotkeyStar",value:function(){this.checkToggleSearchFilter("starred")||v.default.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",value2:y.a.ChangeType.Local})}},{key:"selectPaneAtIndex",value:function(e){if(e>=0&&e<Xh.PaneManager.paneCount()){var t=Xh.PaneManager.getPaneAtIndex(e);if(t&&(R.a.focusPaneAndRestoreSelection(t),!R.a.isValid()&&t.isEditable)){var n=t.indexOfFirstItem();t.selectIndex(n),t.scrollIndexIntoView(n,"smooth")}}}},{key:"hotkeySelectPane1",value:function(){this.selectPaneAtIndex(0)}},{key:"hotkeySelectPane2",value:function(){this.selectPaneAtIndex(1)}},{key:"hotkeySelectPane3",value:function(){this.selectPaneAtIndex(2)}},{key:"hotkeySelectPane4",value:function(){this.selectPaneAtIndex(3)}},{key:"hotkeySelectPane5",value:function(){this.selectPaneAtIndex(4)}},{key:"hotkeySelectPane6",value:function(){this.selectPaneAtIndex(5)}},{key:"hotkeySelectPane7",value:function(){this.selectPaneAtIndex(6)}},{key:"hotkeySelectPane8",value:function(){this.selectPaneAtIndex(7)}},{key:"hotkeySelectPane9",value:function(){this.selectPaneAtIndex(8)}},{key:"hotkeySelectPane10",value:function(){this.selectPaneAtIndex(9)}},{key:"hotkeyPreviousPane",value:function(){var e=Xh.PaneManager,t=e.getFocusedPaneIndex()-1;t<0&&(t=e.paneCount()-1),this.selectPaneAtIndex(t)}},{key:"hotkeyNextPane",value:function(){var e=Xh.PaneManager,t=e.getFocusedPaneIndex()+1;t>=e.paneCount()&&(t=0),this.selectPaneAtIndex(t)}},{key:"hotkeyZoomIn",value:function(){v.default.focusedPane&&v.default.focusedPane.applyToSelection((function(e){return e.isNote()||v.default.focusedPane.zoomIn(e),!1}))}},{key:"hotkeyZoomOut",value:function(){var e=v.default.focusedItem;e&&e.parent()&&v.default.focusedPane.zoomOut(e.parent())}},{key:"hotkeyCollapse",value:function(){v.default.focusedPane.applyToSelection((function(e){v.default.focusedPane.supportCollapsing&&e.toggleCollapsed(v.default.focusedPane)}))}},{key:"hotkeyCollapseAll",value:function(){v.default.focusedItem&&v.default.focusedPane&&v.default.focusedPane.supportCollapsing&&v.default.focusedPane.toggleCollapseAll()}},{key:"hotkeyCollapseRecursive",value:function(){var e,t=v.default.focusedPane;v.default.focusedPane.applyToSelection((function(n,r,i,a){t.supportCollapsing&&(void 0===e&&(e=!t.isPaneObjectCollapsed(a)),t.collapseAll(n,e,!0))}))}},{key:"hotkeyIndent",value:function(){Uh.a.compoundOperation((function(){R.a.isValid()&&Uh.a.handleTab(!0)}))}},{key:"hotkeyUnindent",value:function(){Uh.a.compoundOperation((function(){R.a.isValid()&&Uh.a.handleTab(!0,!0)}))}},{key:"hotkeyIndentWithoutChildren",value:function(){Uh.a.compoundOperation((function(){R.a.isValid()&&Uh.a.handleTab(!1)}))}},{key:"hotkeyUnindentWithoutChildren",value:function(){Uh.a.compoundOperation((function(){R.a.isValid()&&Uh.a.handleTab(!1,!0)}))}},{key:"hotkeyMoveUp",value:function(){Uh.a.moveUp()}},{key:"hotkeyMoveDown",value:function(){Uh.a.moveDown()}},{key:"hotkeySelectItem",value:function(){Uh.a.handleSelectAllItem()}},{key:"hotkeyClosePane",value:function(e){void 0!==Xh.PaneManager.removeFocusedPane()&&(Xh.tooltip.hideTip(),e.stopImmediatePropagation())}},{key:"hotkeyBold",value:function(e){return R.a.isValid()&&R.a.applyFormatToSelection("bold"),v.default.preventDefault(e),!1}},{key:"hotkeyItalic",value:function(e){return R.a.isValid()&&R.a.applyFormatToSelection("italic"),v.default.preventDefault(e),!1}},{key:"hotkeyUnderline",value:function(e){return R.a.isValid()&&R.a.applyFormatToSelection("underline"),v.default.preventDefault(e),!1}},{key:"hotkeyStrike",value:function(e){return R.a.isValid()&&R.a.applyFormatToSelection("strike"),v.default.preventDefault(e),!1}},{key:"hotkeyInlineCode",value:function(e){return R.a.isValid()&&R.a.applyFormatToSelection("code"),v.default.preventDefault(e),!1}},{key:"hotkeyInsertLink",value:function(e){R.a.isValid()&&R.a.getStartItem().insertLinkAtSelection();return v.default.preventDefault(e),!1}},{key:"hotkeyMoveAutocomplete",value:function(){v.default.focusedPane&&R.a.isValid()&&v.default.focusedPane.autocompleteMove()}},{key:"hotkeyGlobalSearch",value:function(){var e=v.default.focusedPane||Xh.PaneManager.getPaneAtIndex(0);null===e||void 0===e||e.isSearchingGlobal.set(!0,!0)}},{key:"hotkeyUndo",value:function(){v.default.focusedPane?v.default.focusedPane.handleUndo():xs.a.undo()}},{key:"hotkeyRedo",value:function(){v.default.focusedPane?v.default.focusedPane.handleRedo():xs.a.redo()}},{key:"hotkeyPrefixHeader",value:function(){R.a.applyPrefixToSelection(y.a.Prefix.Header)}},{key:"hotkeyPrefixTask",value:function(){R.a.applyPrefixToSelection(y.a.Prefix.Task)}},{key:"hotkeyPrefixBullet",value:function(){R.a.applyPrefixToSelection(y.a.Prefix.Bullet)}},{key:"hotkeyPrefixNumList",value:function(){R.a.applyPrefixToSelection(y.a.Prefix.NumList)}},{key:"hotkeyCodeBlock",value:function(){R.a.applyPrefixToSelection(y.a.Prefix.CodeBlock)}},{key:"hotkeyEmailCompose",value:function(){var e=Xh.supportGmailViews();if(e&&Xh.settings.emailViewAccounts.length()>0)gs.a.getPluginNew("Email").composeEmail(!0);else{var t=Xh.pluginManager.getPluginGmail();t.isEnabled()?Xh.menus.openComposeEmail(t):!v.default.isDemoMode()&&e&&Xh.toasts.pushMessage(y.a.MessageID.SetupGmailViews)}}},{key:"hotkeyPreviousBoard",value:function(){Oo.a.hotkeyPrevBoard()}},{key:"hotkeyNextBoard",value:function(){Oo.a.hotkeyNextBoard()}},{key:"hotkeySelectBoard1",value:function(){Oo.a.selectBoardAtIndex(0)}},{key:"hotkeySelectBoard2",value:function(){Oo.a.selectBoardAtIndex(1)}},{key:"hotkeySelectBoard3",value:function(){Oo.a.selectBoardAtIndex(2)}},{key:"hotkeySelectBoard4",value:function(){Oo.a.selectBoardAtIndex(3)}},{key:"hotkeySelectBoard5",value:function(){Oo.a.selectBoardAtIndex(4)}},{key:"hotkeySelectBoard6",value:function(){Oo.a.selectBoardAtIndex(5)}},{key:"hotkeySelectBoard7",value:function(){Oo.a.selectBoardAtIndex(6)}},{key:"hotkeySelectBoard8",value:function(){Oo.a.selectBoardAtIndex(7)}},{key:"hotkeySelectBoard9",value:function(){Oo.a.selectBoardAtIndex(8)}},{key:"hotkeySelectBoard10",value:function(){Oo.a.selectBoardAtIndex(9)}},{key:"hotkeyAddToCalendar",value:function(){var e=Xh.pluginManager.getPluginGCalendar();e&&e.isOn()&&v.default.focusedPane.applyToSelection((function(t){return e.createEventForItem(t)}))}},{key:"hotkeyEditNote",value:function(){v.default.focusedPane&&(Xh.PaneUpdateBatcher.beginUpdateItems(),v.default.focusedPane.clearPreventUpdate(),v.default.focusedPane.applyToSelection((function(e,t,n,r){e.isNote()||v.default.focusedPane.openNoteContextMenuByPaneObject(r)})),Xh.PaneUpdateBatcher.commitUpdateItems())}},{key:"hotkeyHelp",value:function(){Xh.intro.toggleHelp()}},{key:"hotkeyHelpHotkeys",value:function(){Xh.intro.toggleHotkeys()}},{key:"hotkeySettings",value:function(){Xh.menus.openSettings()}},{key:"hotkeyDeleteItem",value:function(){v.default.focusedPane.deleteSelected()}},{key:"hotkeyDate",value:function(){if(R.a.isValid()){var e=R.a.getStartIndex(),t=R.a.getStartItem(),n=R.a.getStartObject(),r=R.a.getPane(),i=R.a.getStartOffsetWithPrefix();if(e>=0){var a=r.elementAtIndex(e);a&&Xh.menus.openDate({element:a,item:t,pane:r,paneObject:n,textOffset:i>=0?i:t.getParsedText().length,selectAfter:!0})}}}},{key:"hotkeyNoop",value:function(){}},{key:"callbackOnPane",value:function(e,t){var n=v.default.focusedPane;return n&&n.onHotkey&&n.onHotkey(e,t),!1}},{key:"printHotkeyByName",value:function(e,t){var n=this.config[t||"Pane"][e];try{v.default.PAssert(211,n,"Getting an invalid hotkey")}catch(o){v.default.reportError(o)}if(n)for(var r=0,i=0;i<n.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n[i];if(this.isValidPlatform(a))return this.printHotkey(a)}}},{key:"convertToElectron",value:function(e){return e.replace(/ /g,"").replace("Pr",k.a.mac?"Cmd":"Ctrl").replace("Se",k.a.mac?"Ctrl":"Alt").replace("Op","Option").replace("Sh","Shift")}},{key:"printHotkey",value:function(e){for(var t=0,n=e.split(":"),r=n[n.length-1].split("+"),i="",a=0;a<r.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=r[a];a>0&&(i+=k.a.windows?" + ":" "),i+="Pr"===o?k.a.priModKey:"Se"===o?k.a.secModKeyForce:"Sh"===o?k.a.mac?"\u21e7":"Shift":"Op"===o?"\u2325":2===o.length&&"D"===o[0]?o[1]:"Slash"===o?"/":"Tilde"===o?"~":"ArrowLeft"===o?"\u2190":"ArrowRight"===o?"\u2192":"ArrowUp"===o?"\u2191":"ArrowDown"===o?"\u2193":"Period"===o?".":"Comma"===o?",":"Equal"===o?"=":"Plus"===o?"+":"Dash"===o?"-":"Backspace"===o?k.a.mac?"Delete":o:o.startsWith("Bracket")||o.endsWith("Bracket")?o.startsWith("L")?"[":"]":o}return i}},{key:"checkHotkeyOverlap",value:function(e,t){var n=t.mods,r=Vh[e];if(r)for(var i=0,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a],s=o.mods,u=!0;if(!v.default.isEmpty(n)||!v.default.isEmpty(s))for(var l=0,c=0;c<4;c++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(n[c]!==s[c]){u=!1;break}}if(u&&(o.group!==t.group||o.name!==t.name)&&!o.isOnPane&&!t.isOnPane)return!0}}},{key:"setHotkey",value:function(e,t,n){var r=this;if(this.createHotkeyNew(e,t,n,"Global"===e,"Email"===e,e).some((function(e){return r.checkHotkeyOverlap(e.keyCode,e)})))return!1;var i=v.default.cloneDeep(Xh.settings.hotkeys.get());i[e]||(i[e]={}),v.default.deepEqual(this.defaultConfig[e][t],n)?delete i[e][t]:i[e][t]=n,console.log("setting to",i),Xh.settings.hotkeys.set(i)}},{key:"resetHotkey",value:function(e,t){var n=v.default.cloneDeep(Xh.settings.hotkeys.get());n[e]&&delete n[e][t],Xh.settings.hotkeys.set(n)}}]),e}(),b()(Mh.prototype,"updateConfig",[w.a],Object.getOwnPropertyDescriptor(Mh.prototype,"updateConfig"),Mh.prototype),Mh);function Yh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var Qh=function(e){d()(n,e);var t=Yh(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"init",value:function(){this.rollbar=window.Rollbar,this.ElectronBridge=new vh,this.nativeBridge=new Sh,l()(g()(n.prototype),"init",this).call(this),this.setup=new Ih,this.DesktopUI=new gh,this.DesktopUI.init(),this.tooltip=new Ph,this.AppCache=new Dh,this.intro=new jh,this.hotkeys=new Kh,Po.a.init()}},{key:"onIntroAction",value:function(e){this.intro&&this.intro.onAction(e)}},{key:"openUrl",value:function(e,t,n){v.default.openUrl(e)}},{key:"supportGmailViews",value:function(){return k.a.app&&k.a.appv>=5}}]),n}(ph),Xh=t.default=new Qh},function(e,t,n){e.exports=n(113)},function(e,t,n){"use strict";var r,i=n(59),a=n.n(i),o=n(33),s=n.n(o),u=n(5),l=n.n(u),c=n(6),d=n.n(c),h=n(42),f=n.n(h),p=n(17),g=n.n(p),v=n(18),m=n.n(v),y=n(19),_=n.n(y),b=n(11),w=n.n(b),k=n(7),S=n.n(k),E=n(8),P=n(1),I=n(0),D=n(12),T=n(2),x=n(38),C=n(23),A=[" ","-","/","[","]","(",")","*","_","@",".",":"],L=new(function(){function e(){l()(this,e)}return d()(e,[{key:"getPreviousWord",value:function(e,t){var n=0,r=e.getDisplayTextWithoutPrefix();t<0&&(t=r.length);for(var i=t-1;i>=0;i--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if(I.default.shouldLog(P.a.LogLevels.Edit)&&console.log(i,a),A.indexOf(a)>=0&&this.isElementEditable(e,i))return i}return-1}},{key:"getNextWord",value:function(e,t){for(var n=0,r=e.getDisplayTextWithoutPrefix(),i=t+1;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if(A.indexOf(a)>=0&&this.isElementEditable(e,i))return i}return r.length}},{key:"isElementEditable",value:function(e,t){return e.item.elsNew.isElementAtOffsetEditable(e,t)}}]),e}()),O=new(function(){function e(){l()(this,e),this.listeners={}}return d()(e,[{key:"onEvent",value:function(e,t,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({persistent:n,cb:t})}},{key:"offEvent",value:function(e,t){if(this.listeners[e]){var n=this.listeners[e].indexOfWithProperty("cb",t);n>=0&&this.listeners[e].removeAt(n)}}},{key:"hasEvent",value:function(e,t){return this.listeners[e].indexOfWithProperty("cb",t)>=0}},{key:"fireEvent",value:function(e){var t=this.listeners[e];if(t){for(var n=0,r=0,i=0,a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o[s-1]=arguments[s]}for(var u=t.length-1;u>=0;u--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=t[u];l.cb.apply(l,o),l.persistent||t.splice(u,1)}}}}]),e}()),M=n(26),R=n(13),F=n(48),N=function(){function e(){l()(this,e),this.pane=new R.a}return d()(e,[{key:"setSelectedPaneObject",value:function(e){}},{key:"scrollStartIntoView",value:function(){}},{key:"scrollEndIntoView",value:function(){}},{key:"updateCaret",value:function(){}},{key:"checkValid",value:function(){}},{key:"getPane",value:function(){try{I.default.PAssert(575,this.pane.get()===I.default.focusedPane,"Should these always match?")}catch(e){I.default.reportError(e)}return this.pane.get()}},{key:"setFocusedPane",value:function(e){I.default.focusedPane=e,this.pane.set(e)}},{key:"applyFormatToSelection",value:function(e,t){var n=this,r=!1,i=0,a=!1;if(I.default.focusedPane.applyToSelection((function(t,o,s,u){var l=0===o?n.getStartOffset():0,c=o===s-1?n.getEndOffset():t.getParsedText().length;if(0===o){var d=t.elsNew.elementInfoAtOffset(u,l),h=d.el;d.offset;h&&(a=!!h.props[e])}var f=t.applyFormatToSelection(e,u,l,c,0===o?"toggle":r?"yes":"no");if(r=f,0===o&&u.showMarkdown()){var p=("bold"===e||"underline"===e||"strike"===e?2:("italic"===e||"code"===e)&&1)||0;0,i=f&&!a&&p||!f&&a&&-p||0}})),i){var o=function(){return n.selectIndices(n.getStartIndex(),n.getStartOffset()+i,n.getEndIndex(),n.getEndOffset()+i)};t?requestAnimationFrame(o):o()}else this.updateCaret()}},{key:"applyPrefixToSelection",value:function(e,t){var n;if(this.isValid()&&(n=this.getStartItem().getPrefixLength(),this.getEndItem().getPrefixLength()),t)e=t.prefix===e?null:e,t.setPrefix(e);else{var r=!0;I.default.focusedPane.applyToSelection((function(t){if(t.prefix!==e)return r=!1,!1})),r&&(e=null),I.default.focusedPane.applyFnToSelection("setPrefix",{value:e,noRestoreSel:!0})}isNaN(n)||this.updateCaret()}},{key:"selectIndex",value:function(e,t,n,r){return void 0===n&&(n=t),this.selectIndices(e,t,e,n,r)}}]),e}(),j=n(93),U=n(56);function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var i=w()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _()(this,n)}}var V=[["ignoreSel",!0],"mdImageResizer","emptyItemAddButton",["itemNotInPane",!0],"itemCheckbox","itemPrefix","itemPrefixNew",["searchWrap",!0],"collapser","collapserNew","itemMenuIcon",["formattingToolbar",!0],"itemTime","paneFooter","fab",["inlineDate",!0],["itemLink",!0],["plugin",!0],["dropBucket",!0]],H=["contact","tag","inlineDate"];var W=(r=function(e){m()(r,e);var t=B(r);function r(){var e;l()(this,r),(e=t.call(this))._isValid=!1,e._isDirty=!1,e._isWatchingChange=!0,e._isMouseDown=!1,e._isTouchDown=!1,e.modifiersDown={},e.isWindowFocused=new R.a(!0),e._previousSelectedObject=void 0,e._previousIsValid=void 0,e._previousSelectedMap={},e._selectedMap={},e.selectedMapObs=new R.a(e._selectedMap),e.mouseHandlers=[],e.mousePos={x:-1,y:-1},e.mouseDownPos={x:-1,y:-1},e._downOffset={start:0,end:0},e._lastClickTime=0,e._numClicks=0,e._isMouseDownDisabled=!1,e._savedPaneSels={};var n={};return n.onStart=e.handleMouseDown,n.onEnd=e.handleMouseUp,n.onRightStart=e.handleRightMouseDown,n.onMove=e.handleMouseMove,document.addEventListener("mousemove",e.handleMouseMoveDocument,!0),window.addEventListener("blur",e.onWindowBlur),window.addEventListener("focus",e.onWindowFocus),document.addEventListener("touchstart",(function(){e._isTouchDown=!0}),!0),document.addEventListener("touchend",(function(t){0===t.touches.length&&(e._isTouchDown=!1,O.fireEvent("SelOnTouchUp"))}),!0),document.addEventListener("keydown",(function(t){e.setModifiersDown(t.ctrlKey,t.metaKey,t.altKey,t.shiftKey)})),document.addEventListener("keyup",(function(){e.setModifiersDown()})),I.default.setupClick(document,f()(e),n),C.a.listen("paneAdded",e.onPaneAdded.bind(f()(e))),C.a.listen("paneRemoved",e.onPaneRemoved.bind(f()(e))),e}return d()(r,[{key:"reset",value:function(e,t){if(this._isValid){I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::reset");var n=!t&&this.save();n&&(this._previousSelection=n),this._selectedMap={},this._dblClickOffsets=void 0,this.isMultiselecting=!1,this._isValid=!1,this.isKeyboardOpen=!1,this._isArrowSelectInverted=!1;var r=this.getPane();!r||r.isUnloaded()||r.isDestroyed()||(this._isDirty=!0,this._updateSelection(),this.updateHiddenInput())}}},{key:"getPreviousSelection",value:function(){return this._previousSelection}},{key:"dumpState",value:function(){var e={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.getStartIndex(),offset:this.getStartOffset()},end:{index:this.getEndIndex(),offset:this.getEndOffset()}};try{var t=!!this.pane.get();e.paneInfo=t?{hasPane:t,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop()}:"No Pane Set"}catch(n){e.paneInfo="Invalid Pane"}try{void 0!==this.getStartIndex()&&(e.start.item=this.pane.get().items.get()[this.getStartIndex()].id)}catch(n){e.start.item="Invalid Item"}try{void 0!==this.getEndIndex()&&(e.end.item=this.pane.get().items.get()[this.getEndIndex()].id)}catch(n){e.end.item="Invalid Item"}return e}},{key:"setValid",value:function(e){if(e){try{I.default.PAssert(213,!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex())}catch(r){I.default.reportError(r)}try{I.default.PAssert(214,!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex())}catch(r){I.default.reportError(r)}try{if(this.getStartObject()instanceof F.a){var t=this.pane.get().items.get()[this.getStartIndex()];try{I.default.PAssert(215,t&&(I.default.isVMLI(t)||I.default.isVMLI(t.item)),"Valid selection must always be into a VMLI for start item")}catch(r){I.default.reportError(r)}var n=this.pane.get().items.get()[this.getEndIndex()];try{I.default.PAssert(216,n&&(I.default.isVMLI(n)||I.default.isVMLI(n.item)),"Valid selection must always be into a VMLI for end item")}catch(r){I.default.reportError(r)}}}catch(i){I.default.reportError(i)}}else this.reset();this._isValid=e}},{key:"isArrowSelectInverted",value:function(){return this._isArrowSelectInverted}},{key:"setArrowSelectInverted",value:function(e){this._isArrowSelectInverted=e}},{key:"getStartItem",value:function(){var e;return null===(e=this.getStartObject())||void 0===e?void 0:e.item}},{key:"getStartObject",value:function(){var e;return null===(e=this.getStartSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject}},{key:"getStartOffset",value:function(e){var t=this.getStartSelectionOfMap(this._selectedMap),n=t?t.full?0:t.start:-1;return e||(this.getStartIndex()!==this.getEndIndex()&&this.isValid()?n=0:-1===n&&t&&(n=this.getStartTotal())),n}},{key:"getStartOffsetWithPrefix",value:function(){var e=this.getStartOffset();return e>=0?e+this.getStartObject().item.getPrefixLength():e}},{key:"getStartIndex",value:function(){var e;return null===(e=this.getStartSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject.index}},{key:"getStartSelectionOfMap",value:function(e){var t=I.default.minObject(Object.values(e),(function(e){return e.paneObject.index}));if(t&&this.updatePaneObjectFromSelectedMap(t),null===t||void 0===t?void 0:t.paneObject)return t}},{key:"getStartTotal",value:function(){var e=this.getStartSelectionOfMap(this._selectedMap);return e?e.total:0}},{key:"getEndItem",value:function(){var e;return null===(e=this.getEndObject())||void 0===e?void 0:e.item}},{key:"getEndObject",value:function(){var e;return null===(e=this.getEndSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject}},{key:"getEndOffset",value:function(e){var t=this.getEndSelectionOfMap(this._selectedMap),n=t?t.full?this.getEndTotal():t.end:-1;return e||(this.getStartIndex()!==this.getEndIndex()&&this.isValid()&&this.getEndObject()||-1===n)&&(n=this.getEndTotal()),n}},{key:"getEndOffsetWithPrefix",value:function(){var e=this.getEndOffset();return e>=0?e+this.getEndObject().item.getPrefixLength():e}},{key:"getEndIndex",value:function(){var e;return null===(e=this.getEndSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject.index}},{key:"getEndSelectionOfMap",value:function(e){var t=I.default.maxObject(Object.values(e),(function(e){return e.paneObject.index}));if(t&&this.updatePaneObjectFromSelectedMap(t),null===t||void 0===t?void 0:t.paneObject)return t}},{key:"getEndTotal",value:function(){var e=this.getEndSelectionOfMap(this._selectedMap);return e?e.total:0}},{key:"getEndTotalWithPrefix",value:function(){var e,t=this.getEndSelectionOfMap(this._selectedMap),n=(null===t||void 0===t||null===(e=t.paneObject.item)||void 0===e?void 0:e.getPrefix().length)||0;return t?t.total+n:0}},{key:"isMouseDown",value:function(){return this._isMouseDown}},{key:"isTouchDown",value:function(){return this._isTouchDown}},{key:"setSelectionObjects",value:function(e,t,n,r,i){var a,o,u,l,c,d,h,f,p,g,v,m;(this.isMultiselecting=!1,I.default.shouldLog(P.a.LogLevels.Selection))&&console.log("setSelectionObjects1",!!e,!!n,null===(c=e)||void 0===c?void 0:c.index,null===(d=n)||void 0===d?void 0:d.index,t,r,null===(h=e)||void 0===h?void 0:h.id,null===(f=e)||void 0===f?void 0:f.item.getRawText(),this._downOffset);(e=null!==(a=e)&&void 0!==a?a:this.getStartObject(),n=null!==(o=n)&&void 0!==o?o:this.getEndObject(),t=null!==(u=t)&&void 0!==u?u:e?this.getStartOffset(!0):void 0,r=null!==(l=r)&&void 0!==l?l:n?this.getEndOffset(!0):void 0,e&&t<0&&(t=e.getDisplayLengthWithoutPrefix()),n&&r<0&&(r=n.getDisplayLengthWithoutPrefix()),I.default.shouldLog(P.a.LogLevels.Selection))&&console.log("setSelectionObjects2",null===(p=e)||void 0===p?void 0:p.index,null===(g=n)||void 0===g?void 0:g.index,t,r,null===(v=e)||void 0===v?void 0:v.id,null===(m=e)||void 0===m?void 0:m.item.getRawText());var y={};if(e&&n){var _,b,w=e.index,k=n.index,S=e.getDisplayLengthWithoutPrefix();if((null===(_=e)||void 0===_?void 0:_.id)!==(null===(b=n)||void 0===b?void 0:b.id)||0===t&&r>0&&r===S){for(var E=0,D=w;D<=k;D++){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;var T=this.objectAtIndex(D);T.item&&(y[T.id]={paneObject:T,full:!0,total:T.getDisplayLengthWithoutPrefix()})}I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::setSelectionObjects2",y,this._selectedMap)}else y=s()({},e.id,{paneObject:e,start:t,end:r,total:S}),I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::setSelectionObjects1",this._selectedMap);this.setArrowSelectInverted(w<this._downIndex&&w===this._downIndex&&t<this._downOffset.start)}else I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("setSelectionObjects {}"),this.setArrowSelectInverted(!1);return n&&void 0!==i&&(n=this.adjustSelectionBelow(y,n,i,!0)),this._setSelectedMap(y),this._isDirty=!0,n}},{key:"setSelectionIndices",value:function(e,t,n,r){var i=void 0!==e?this.getPane().objectAtIndex(e):void 0,a=void 0!==n?this.getPane().objectAtIndex(n):void 0;this.setSelectionObjects(i,t,a,r)}},{key:"isValid",value:function(){return this._isValid&&!T.default.menus.isContextMenuOpen("ReactContextMenuDate")}},{key:"checkValid",value:function(){var e=this.getPane(),t=!1;if(e&&this.getStartIndex()>=0&&this.getStartIndex()<e.numItems()&&this.getEndIndex()>=0&&this.getEndIndex()<e.numItems())if(this.getStartItem()&&this.getEndItem()){var n=this.getStartObject();if(n instanceof F.a){var r=n.getDisplayText(!0,!0),i=this.getEndObject().getDisplayText(!0,!0),a=this.getStartOffset(),o=this.getEndOffset();a>=0&&o>=0&&(void 0===r||a<=r.length)&&(void 0===i||o<=i.length)&&(t=!0)}else t=!0}else t=!1;return!t&&this.isValid()&&this.reset(void 0,!0),t}},{key:"clearSelection",value:function(e){this.reset(e)}},{key:"onPaneAdded",value:function(e){e.addScrollListener(this.onScroll)}},{key:"onPaneRemoved",value:function(e){e.removeScrollListener(this.onScroll),this.getPane()===e&&this.setFocusedPane(void 0)}},{key:"onScroll",value:function(e){var t=this;this._isMouseDown&&e===this.getPane()&&e.isWriteable&&!T.default.DragDrop.isDragging&&I.default.animationFrameOnce("SelOnScroll",(function(){var e=t.getMousePos(),n=document.elementFromPoint(e.x,e.y),r={clientX:e.x,clientY:e.y,target:n,shiftKey:t.modifiersDown.shiftKey};t._updateFromMouse(r),t._updateSelection()}))}},{key:"handleRightMouseDown",value:function(e){var t=!I.default.hasClass(e.target,"mdImage"),n=I.default.findParent(e.target,"item")&&I.default.getElementParent(e.target);if(n&&!I.default.findParent(n,"autocompleteItem",2)&&!I.default.hasClass(n,"itemNotInPane")){var r=I.default.getPaneObjectForElement(n);r&&this.isSelected(r)&&(t=!1)}t&&this.handleMouseDown(e,!0)}},{key:"checkDoubleClick",value:function(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0}},{key:"handleMouseDown",value:function(e,t){var n=I.default.getPaneForElement(e.target);if(this.isWindowFocused.set(!0),t||(this._isMouseDown=!0),this.selectedBeforeThisMouseEvent=this.save(),n&&!this._isMouseDownDisabled){this.setFocusedPane(n);var r=e.target;if(I.default.findParent(r,"itemInPaneNote")){if(!T.default.DragDrop.isDraggingDelayed){var i=I.default.getPaneObjectForElement(e.target);this.selectObject(i,-1),n.openNoteContextMenuByPaneObject(i),I.default.preventAndStop(e)}}else if(I.default.findParent(r,"itemInPaneText")&&n.supportSel&&!V.some((function(e){return I.default.isArray(e)?I.default.findParent(r,e[0]):I.default.hasClass(r,e)}))){0,this.setArrowSelectInverted(!1);var a=this.mouseDownPos.x,o=this.mouseDownPos.y,s=I.default.getElementParent(r),u=!1;if(this.mouseDownPos.x=e.pageX,this.mouseDownPos.y=e.pageY,I.default.findParent(r,"paneContent"))if(n&&n.isWriteable&&n.isEditable&&s){if(t)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var l=Date.now();l-this._lastClickTime<P.a.DoubleClickTime&&Math.abs(e.pageX-this.mouseDownPos.x)<2&&Math.abs(e.pageY-this.mouseDownPos.y)<2&&Math.abs(e.pageX-a)<2&&Math.abs(e.pageY-o)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=l}var c=U.default.getCursorSelectionRange(e);if(c){I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::handleMouseDown - Default");var d=I.default.getPaneObjectForElement(e.target);if(!d||d.overview||t&&this.isSelected(d))return;if(e.shiftKey&&this._downObject||(this._downIndex=d.index,this._downObject=d),D.a.isPriModKey(e))!this.hasFullSelection()&&H.some((function(t){return I.default.hasClass(e.target,t)}))||(this.multiselect(d),u=!0,this._downOffset={start:0,end:this._downObject.getDisplayLengthWithoutPrefix()});else{var h=n.listManager?I.default.findChild(s,"itemInPaneText"):s;if(e.shiftKey&&!(D.a.mac&&e.metaKey||!D.a.mac&&e.ctrlKey))this._updateFromMouse(e);else if(1===this._numClicks||this._numClicks>3){try{I.default.PAssert(217,this._downIndex>=0,"Must have a valid index in react item")}catch(y){I.default.reportError(y)}if(this._downIndex<0)try{I.default.PAssert(218,this._downIndex>=0,"Dead cell error",I.default.getElementPath(c.getStartElement()),I.default.getElementPath(e.target))}catch(y){I.default.reportError(y)}var f=this._downObject.item;try{I.default.PAssert(219,this._downObject,"Must have a valid item in react item")}catch(y){I.default.reportError(y)}var p=c.getSelectOffsetsInElement(h);T.default.settings.showMarkdown.get()&&!this._selectedMap[d.id]&&(this._downObject.forceIsSelected=!0,p.start+=f.elsNew.numFormattingCharsBeforeOffset(this._downObject,p.start),p.end+=f.elsNew.numFormattingCharsBeforeOffset(this._downObject,p.end)),p.start=f.elsNew.adjustOffsetAroundUneditables(this._downObject,p.start),p.end=f.elsNew.adjustOffsetAroundUneditables(this._downObject,p.end),0===f.getParsedTextWithoutPrefix().length?this._downOffset={start:p.total,end:p.total}:this._downOffset={start:p.start,end:p.start},this.preferEndLine=Math.abs(e.clientX-I.default.offset(h).right)<30&&{index:this._downIndex,offset:this._downOffset.start},this.setSelectionObjects(this._downObject,this._downOffset.start,this._downObject,this._downOffset.end)}else if(2===this._numClicks){var g=L.getPreviousWord(this._downObject,this._downOffset.start)+1,v=L.getNextWord(this._downObject,this._downOffset.end);this.setSelectionObjects(this._downObject,g,this._downObject,v),this._downOffset={start:g,end:v}}else if(3===this._numClicks){var m=this._downObject.getDisplayLengthWithoutPrefix();this.setSelectionObjects(this._downObject,0,this._downObject,m),this._downOffset={start:0,end:m}}u=!0}}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}else I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::handleMouseDown - Skip");else I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::handleMouseDown - Skip header");this.setValid(u&&this.checkValid()),this.isValid()&&this._updateSelection(),this._downObject&&delete this._downObject.forceIsSelected}}}},{key:"setDownIndex",value:function(){this._downIndex=this.getStartIndex(),this._downObject=this.getStartObject(),this._downOffset={start:this.getStartOffset(),end:this.getEndOffset()}}},{key:"getMousePos",value:function(){return this.mousePos}},{key:"handleMouseMoveDocument",value:function(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY}},{key:"handleMouseMove",value:function(e){var t=this;if(this.mouseHandlers.forEach((function(t){return t.move(e)})),this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),e.target!==document.documentElement&&e.target.parentElement&&!I.default.isDraggingImage){var r=I.default.getPaneForElement(e.target);if(this._isValid&&this._isMouseDown&&r===this.getPane()&&r.supportSel&&r.isWriteable&&!n(99).default.isDragging)return this.isSelecting=!0,r.scrollFromMousePosition(e.pageX,e.pageY,!1),this._updateFromMouse(e),this._updateSelection(),I.default.preventDefault(e),I.default.timeoutOnce("selUpdating",(function(){return t.isSelecting=!1}),100),!1}}},{key:"handleMouseUp",value:function(e){this.mouseHandlers.forEach((function(t){return t.up(e)}));var t=I.default.isAttachedToDoc(e.target)&&I.default.getPaneForElement(e.target),n=t&&I.default.getElementParent(e.target);this._isMouseDown=!1,t&&t.supportSel&&!V.some((function(t){return I.default.isArray(t)?I.default.findParent(e.target,t[0]):I.default.hasClass(e.target,t)}))&&(I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::handleMouseDown - handleMouseUp"),!n||I.default.hasClass(e.target,"contact")||I.default.hasClass(n,"itemNotInPane")||I.default.findParent(e.target,"inlineDate")||this.updateCaret(),I.default.cancelRepeatScrolls())}},{key:"focusPaneAndRestoreSelection",value:function(e){this.setFocusedPane(e),this.restoreSavedSelection(e),this.updateCaret()}},{key:"setFocusedPane",value:function(e){if(!e||!I.default.focusedPane||I.default.focusedPane.id!==e.id){var t=I.default.focusedPane;t&&!t.isUnloaded()&&(t.setFocused(!1),t.isEditable&&this.isValid()&&(this._savedPaneSels[t.id]=this.save())),T.default.PaneUpdateBatcher.beginUpdateItems(),this.reset(),M.a.reset(t),I.default.focusedPane=e,I.default.focusedItem=e?e.getItem():void 0,g()(w()(r.prototype),"setFocusedPane",this).call(this,e),e&&e.setFocused(!0),T.default.PaneUpdateBatcher.commitUpdateItems()}}},{key:"restoreSavedSelection",value:function(e){if(e){var t=this._savedPaneSels[e.id];t?(t.pane=e,e.isLoaded?this.restore(t):setTimeout(this.restore,0,t),this._savedPaneSels[e.id]=void 0):this.reset()}}},{key:"_updateWith",value:function(e,t){var n="start"===e?t.getStartElement():t.getEndElement();try{I.default.PAssert(220,n,"Trying to select in invalid container")}catch(u){I.default.reportError(u)}if(n){var r=I.default.getElementParent(n),i=I.default.findChild(r,"itemInPaneText"),a=I.default.getPaneObjectForElement(r),o=t.getSelectOffsetsInElement(i),s="start"===e?o.start:o.end;try{I.default.PAssert(221,a.item,"Should not be updating ReactCells without VMLIs")}catch(u){I.default.reportError(u)}if(I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::_updateWith["+e+"] - ",s,a.index),this._dblClickOffsets&&a.index===this._dblClickOffsets.index)if("start"===e)s=Math.min(s,this._dblClickOffsets.start);else if("end"===e)s=Math.max(s,this._dblClickOffsets.end);else try{I.default.PAssert(222,!1,"Invalid toUpdate value")}catch(u){I.default.reportError(u)}this._downOffset.start!==this._downOffset.end&&(s="start"===e?L.getPreviousWord(a,s)+1:L.getNextWord(a,s-1));try{I.default.PAssert(223,!isNaN(s),"Selection offsets should not be undefined")}catch(u){I.default.reportError(u)}return{paneObject:a,offsetsValue:s}}}},{key:"_updateFromMouse",value:function(e){var t=e.target;if(t&&!T.default.DragDrop.isDragging&&!this.isMultiselecting){var n=I.default.focusedPane;if(!I.default.getElementParent(t)&&e.clientY<n.contentTop()){if(I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::_updateFromMouse - outOfPane"),t=I.default.elementFromPoint(e.clientX,n.contentTop()+1),I.default.getElementParent(t)){var r=I.default.getPaneObjectForElement(t).item;try{I.default.PAssert(224,r,"If it is an LI it should be an item",t)}catch(E){I.default.reportError(E)}this.setSelectionIndices(0,0,void 0,void 0)}}else{var i,a,o,s=I.default.getElementParent(t);if(s){if(t=s.getElementsByClassName("itemInPaneText")[0],(o=U.default.getCursorSelectionRange(e))&&o.getStartElement()){var u=I.default.getPaneObjectForElement(e.target);try{I.default.PAssert(225,u,"Must be able to find a valid reactCell for the start element")}catch(E){I.default.reportError(E)}if(u){if((i=u.index)<0)try{I.default.PAssert(227,i>=0,"Dead cell error",I.default.getElementPath(o.getStartElement()),I.default.getElementPath(t))}catch(E){I.default.reportError(E)}var l="itemInPane";if(I.default.findParent(o.getStartContainer(),l)&&I.default.findParent(o.getEndContainer(),l))a=o.getSelectOffsetsInElement(t).start;else i<=this._downIndex?this.setSelectionIndices(i,0,void 0,void 0):this.setSelectionIndices(void 0,void 0,i,0)}}}else if(n.hasNonVMLIs){var c=I.default.getPaneObjectForElement(t);if(c){var d=c.index;if(d>=0)if(!n.itemAtIndex(d))if(d<this._downIndex){var h=n.indexOfNextVMLI(d);h>=0&&this.setSelectionIndices(h,0,void 0,void 0)}else{var f=n.indexOfPrevVMLI(d);if(f>=0){var p=n.objectAtIndex(f);this.setSelectionIndices(void 0,void 0,f,p.getDisplayLengthWithoutPrefix())}}}}else if(I.default.hasClass(t,"paneContent")){I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::_updateFromMouse - paneContent");var g=n.getLastObject();this.setSelectionIndices(void 0,void 0,n.numItems()-1,g?-1:0)}if(!isNaN(i)&&!isNaN(a)&&o){var v;if(i<this._downIndex||i===this._downIndex&&a<this._downOffset.start){v="end";var m=this._updateWith("start",o),y=m.paneObject,_=m.offsetsValue;this.setSelectionObjects(y,_,void 0,void 0)}else if(i>this._downIndex||i===this._downIndex&&a>=this._downOffset.start){v="start";var b=this._updateWith("end",o),w=b.paneObject,k=b.offsetsValue;this.setSelectionObjects(void 0,void 0,w,k),a===this._downOffset.start&&(this._isDirty=!0)}if(void 0!==v){if(!e.shiftKey){I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::_updateFromMouse - RunAfterUpdates");var S=this._dblClickOffsets?this._dblClickOffsets[v]:"start"===v?this._downOffset.start:this._downOffset.end;"start"===v?this.setSelectionObjects(this._downObject,S,void 0,void 0):this.setSelectionObjects(void 0,void 0,this._downObject,S)}this.setValid(!0)}}}}}},{key:"setSelectionFromNativeRange",value:function(e){var t=this._updateWith("start",e),n=t.paneObject,r=t.offsetsValue,i=this._updateWith("end",e),a=i.paneObject,o=i.offsetsValue;this.setSelectionObjects(n,r,a,o),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))}},{key:"_updateSelection",value:function(e){if(this._isDirty&&!this.isMultiselecting){var t=this.getPane(),n=this.getStartIndex(),r=this.getEndIndex(),i=this.getStartObject(),a=this.getEndObject(),o=i;if(this.originalStartIndex=n,this.originalEndIndex=r,this.setValid(!isNaN(n)&&!isNaN(r)),n===r&&void 0!==n)try{I.default.PAssert(228,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(y){I.default.reportError(y)}else{for(var s=0,u=0,l=Number.MAX_SAFE_INTEGER,c=n;c<=r;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=t.itemAtIndex(c);d&&(l=Math.min(l,d.levelsDeep.get()))}for(var h=n;h>=0;h--){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var f=t.objectAtIndex(h);if(f.item&&(o=f,f.item.levelsDeep.get()<=l))break}var p=this.setSelectionObjects(o,void 0,a,void 0,l);void 0!==o&&(i=o),void 0!==p&&(a=p)}e&&e.fromInput||this.updateCaret(),this.updateSelectedMap(),this._isDirty=!1;var g=this.isValid();if(i===a||!g){if(i!==this._previousSelectedObject||g!==this._previousIsValid){var v,m=g?i.item:void 0;C.a.fireEvent("selectedIndexChanged",[null===(v=i)||void 0===v?void 0:v.index,t,m])}this._previousSelectedObject=i,this._previousIsValid=g}i===a&&this.getStartOffset()===this.getEndOffset()&&(this.lastSingleSelection=this.save())}}},{key:"updateCaret",value:function(){if(this.isValid()){var e=this.getPane();if(!e||!e.isWriteable)return;e.hiddenInput&&this.updateHiddenInput()}}},{key:"updateCaretAndCaretItem",value:function(){this.isValid()&&1===Object.keys(this._selectedMap).length&&(this.updateCaret(),this.notifyItemChanged(this.getStartItem()))}},{key:"updateHiddenInput",value:function(){var e=this.getPane();if(e&&e.isEditable&&e.hiddenInput)if(this.isValid()&&this.getStartItem()===this.getEndItem()){this.setArrowSelectInverted(!1);var t=this.getStartObject(),n=this.getStartOffset(),r=this.getEndOffset();n===r&&this.setDownIndex(),j.a.updateFromPaneObject(t,n,r),this.notifyItemChanged(this.getStartItem())}else j.a.blur(e)}},{key:"wasSelectedBeforeThisMouseEvent",value:function(e){var t=this.selectedBeforeThisMouseEvent;if(t&&void 0!==t.selectedMap[e.id])return!0}},{key:"isSelected",value:function(e){return!!this._selectedMap[e.id]}},{key:"isSelectedFully",value:function(e){var t,n,r=e.id;if(e.pane!==this.getPane())return!1;var i=this._selectedMap[r];return!!i&&(i.full||0===i.start&&i.end>0&&i.end===(null===(t=(n=e).getDisplayLengthWithoutPrefix)||void 0===t?void 0:t.call(n)))}},{key:"getSelection",value:function(e){return this._selectedMap[e.id]}},{key:"selectObjects",value:function(e,t,n,r,i){try{I.default.PAssert(229,e&&n,"Must be selecting a start object and an end object")}catch(d){I.default.reportError(d)}var a=!1,o=e.pane;if(o&&o.isWriteable){var s,u,l=e.item,c=n.item;if(!l||!c||this.isValid()&&e.id===(null===(s=this.getStartObject())||void 0===s?void 0:s.id)&&n.id===(null===(u=this.getEndObject())||void 0===u?void 0:u.id)&&t===this.getStartOffset()&&r===this.getEndOffset())this.updateHiddenInput();else{I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::selectObjects -",t,r),t=Math.min(t,e.getDisplayLengthWithoutPrefix()),r=Math.min(r,n.getDisplayLengthWithoutPrefix()),this.setSelectionObjects(e,t,n,r);try{I.default.PAssert(230,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(d){I.default.reportError(d)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(i),a=!0}}else i&&i.fromInput||this.updateHiddenInput();return a}},{key:"selectObject",value:function(e,t,n,r){return void 0===n&&(n=t),this.selectObjects(e,t,e,n,r)}},{key:"selectIndices",value:function(e,t,n,r,i){try{I.default.PAssert(231,e>=0,"Must supply a valid start index")}catch(d){I.default.reportError(d)}try{I.default.PAssert(232,n>=0,"Must supply a valid end index")}catch(d){I.default.reportError(d)}try{I.default.PAssert(233,n>e||n===e&&(r>=t||-1===r),"Must not pass reversed selection")}catch(d){I.default.reportError(d)}if(!(e<0||n<0)){var a,o,s,u,l=this.getPane(),c=!1;if(l&&l.isWriteable){s=l.objectAtIndex(e),u=l.objectAtIndex(n),a=l.itemAtIndex(e),o=l.itemAtIndex(n);try{I.default.PAssert(234,a,"Trying to select invalid start index")}catch(d){I.default.reportError(d)}try{I.default.PAssert(235,o,"Trying to select invalid end index")}catch(d){I.default.reportError(d)}}if(!a||!o||this.isValid()&&e===this.getStartIndex()&&t===this.getStartOffset()&&n===this.getEndIndex()&&r===this.getEndOffset()&&a===this.getStartItem()&&o===this.getEndItem())i&&i.fromInput||this.updateHiddenInput();else{I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::selectIndices -",t,r),t=Math.min(t,s.getDisplayLengthWithoutPrefix()),r=Math.min(r,u.getDisplayLengthWithoutPrefix()),this.setSelectionIndices(e,t,n,r);try{I.default.PAssert(236,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(d){I.default.reportError(d)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(i),c=!0}return c}}},{key:"selectItem",value:function(e,t,n){try{I.default.PAssert(237,I.default.isNumber(t),"Must pass a valid start offset")}catch(r){I.default.reportError(r)}try{I.default.PAssert(238,I.default.isNumber(n)||void 0===n,"Must pass a valid end offset")}catch(r){I.default.reportError(r)}return void 0===n&&(n=t),this.selectItems(e,t,e,n)}},{key:"selectItems",value:function(e,t,n,r){try{I.default.PAssert(239,I.default.isVMLI(e),"Should only be passing VMLIs to start this fn")}catch(s){I.default.reportError(s)}try{I.default.PAssert(240,I.default.isVMLI(n),"Should only be passing VMLIs to end this fn")}catch(s){I.default.reportError(s)}var i=this.getPane();if(i){var a=i.indexOfItem(e);try{I.default.PAssert(241,a>=0,"Must be able to find the start item in the pane")}catch(s){I.default.reportError(s)}var o=i.indexOfItem(n);try{I.default.PAssert(242,o>=0,"Must be able to find the end item in the pane")}catch(s){I.default.reportError(s)}return this.selectIndices(a,t,o,r)}}},{key:"save",value:function(){if(this._isValid){var e=this.getPane();if(!e.isDestroyed()&&!e.isUnloaded()){try{I.default.PAssert(243,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(n){I.default.reportError(n)}try{I.default.PAssert(244,!isNaN(this.getEndIndex()),"End index must be valid")}catch(n){I.default.reportError(n)}var t={pane:e,selectedMap:I.default.clone(this._selectedMap)};return this._savedSelection=t,t}}}},{key:"getSavedSelection",value:function(){return this._savedSelection}},{key:"restore",value:function(e){var t=this,n=!1,r=null===e||void 0===e?void 0:e.pane;if(e&&!r.isDestroyed()){try{I.default.PAssert(245,r,"Must have a valid pane to restore selection to")}catch(o){I.default.reportError(o)}var i=I.default.focusedPane;I.default.focusedPane=r,I.default.focusedItem=r.getItem(),i&&!i.isUnloaded()&&i!==r&&i.setFocused(!1),r.setFocused(!0),this.pane.set(r)}if(e&&!I.default.isEmpty(e.selectedMap)){var a={};Object.values(e.selectedMap).forEach((function(e){t.updatePaneObjectFromSelectedMap(e);var n=e.paneObject;n||(n=r.findItem(n.item)),n&&(a[n.id]=Object.assign({},e,{paneObject:n,total:n.getDisplayLengthWithoutPrefix()}))})),I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::restore",a,this._selectedMap),this._setSelectedMap(a),this.isValid()&&this._updateSelection(),I.default.isEmpty(this._selectedMap)?this.reset():(this._isDirty=!0,this._updateSelection(),n=!0)}else this.reset();return this._savedSelection=void 0,n}},{key:"scrollStartIntoView",value:function(e){if(this._isValid){try{I.default.PAssert(246,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){I.default.reportError(t)}try{I.default.PAssert(247,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){I.default.reportError(t)}I.default.focusedPane.scrollIndexIntoView(this.getStartIndex(),e?"auto":"smooth")}}},{key:"scrollEndIntoView",value:function(){if(this._isValid){try{I.default.PAssert(248,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){I.default.reportError(e)}try{I.default.PAssert(249,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){I.default.reportError(e)}I.default.focusedPane.scrollIndexIntoView(this.getEndIndex(),"smooth")}}},{key:"onWindowBlur",value:function(){this.isWindowFocused.set(!1)}},{key:"onWindowFocus",value:function(){this.isWindowFocused.set(!0)}},{key:"isMultiselected",value:function(){return this.getStartIndex()!==this.getEndIndex()}},{key:"isInMobileMultiselect",value:function(){return!this.isKeyboardOpen&&this.hasFullSelection()}},{key:"isSingleSelect",value:function(){var e=Object.values(this._selectedMap);return(null===e||void 0===e?void 0:e.length)>0&&1===e.length&&!e[0].full}},{key:"hasFullSelection",value:function(){var e=Object.values(this._selectedMap);return(null===e||void 0===e?void 0:e.length)>0&&(e.length>1||e[0].full)}},{key:"getSelectedObjects",value:function(){var e=this;if(!this._isValid)return[];var t=[];return Object.values(this._selectedMap).forEach((function(n){e.updatePaneObjectFromSelectedMap(n);var r=n.paneObject,i=r.item;i&&!i.isNote()&&t.push(r)})),t}},{key:"getSelectedItems",value:function(e,t){var n=this;if(!this._isValid)return[];var r=[],i=this.getPane(),a=this.getStartIndex(),o=this.getStartOffset(),s=this.getEndOffset(),u=this.getEndTotal();return Object.values(this._selectedMap).forEach((function(l){n.updatePaneObjectFromSelectedMap(l);var c=l.paneObject,d=c.item,h=c.index;if(d&&(e||!d.isNote())){var f=h>a||0===o&&s===u,p=f&&i.isPaneObjectCollapsed(c);r.push(d),t&&f&&(d.hasNote()&&r.push(d.getNote()),p&&d.forEachChildRecursive((function(e){return r.push(e)}),f))}})),r}},{key:"getStartElement",value:function(){var e=this.getStartIndex();if(this._isValid&&!isNaN(e))return this.getPane().elementAtIndex(e)}},{key:"getEndElement",value:function(){var e=this.getEndIndex();if(this._isValid&&!isNaN(e))return this.getPane().elementAtIndex(e)}},{key:"fireKeyEvent",value:function(e,t,n){this.fireKeyEventInternal(e,"keydown",t),this.fireKeyEventInternal(e,"keypress",n||t),this.fireKeyEventInternal(e,"keyup",t)}},{key:"fireKeyEventInternal",value:function(e,t,n){try{I.default.PAssert(250,void 0!==n,"Must pass in valid key data to type")}catch(i){I.default.reportError(i)}if(e||(e=this.getStartElement()),document.createEvent&&e){var r=document.createEvent("Event");r.normCode=n.normCode,r.shiftKey=!!n.shiftKey,r.altKey=!!n.altKey,r.ctrlKey=!!n.ctrlKey,r.metaKey=!!n.metaKey,r.synthetic=!0,r.initEvent(t,!0,!0),e.dispatchEvent(r)}else if(e)try{I.default.PAssert(251,!1,"Unable to fire key event")}catch(i){I.default.reportError(i)}else try{I.default.PAssert(252,!1,"No element available to fire key event on")}catch(i){I.default.reportError(i)}}},{key:"fireClickEvent",value:function(e,t){this.fireClickEventInternal(e,"mousedown",t),this.fireClickEventInternal(e,"mouseup",t),this.fireClickEventInternal(e,"mouseclick",t)}},{key:"fireClickEventInternal",value:function(e,t,n,r){try{I.default.PAssert(253,void 0!==n,"Must pass in a valid button to click with")}catch(o){I.default.reportError(o)}if(e||(e=U.default.getSelectionNode()),document.createEvent&&e){var i=document.createEvent("Event");if(i.button=n,i.synthetic=!0,r)for(var a in r)r.hasOwnProperty(a)&&(i[a]=r[a]);i.initEvent(t,!0,!0),e.dispatchEvent(i)}else if(e)try{I.default.PAssert(254,!1,"Unable to fire click event")}catch(o){I.default.reportError(o)}else try{I.default.PAssert(255,!1,"No element available to fire click event on")}catch(o){I.default.reportError(o)}}},{key:"fireMouseUp",value:function(e,t){this.fireClickEventInternal(e,"mouseclick",t)}},{key:"confirmDangerousSelection",value:function(e){var t=this,n=this.isMultiselectDangerous();if(n){var r=this.save();T.default.menus.confirm(n,(function(n){t.restore(r),n&&e()}))}else e()}},{key:"isMultiselectDangerous",value:function(){var e=this.pane.get(),t=this.getSelectedItems(!0,!0).length;return t>(e.isViewOutline()||e.isViewProject()?6:1)&&"Are you sure you want to delete ".concat(t," items?")}},{key:"onPressEnter",value:function(){this.isValid()&&this.selectIndex(this.getStartIndex(),this.getStartOffset())}},{key:"setModifiersDown",value:function(e,t,n,r){this.modifiersDown={ctrlKey:e,metaKey:t,altKey:n,shiftKey:r}}},{key:"addMouseHandler",value:function(e){var t=this,n=e.move,r=e.up,i={move:n,up:function(e){r(e),t.mouseHandlers.remove(i)}};this.mouseHandlers.push(i)}},{key:"selectUpDown",value:function(e,t,n){var r,i,o,s=0,u=this.pane.get(),l=this.isArrowSelectInverted()||"up"===e&&this.getStartIndex()===this.getEndIndex(),c=l?this.originalStartIndex:this._downIndex,d=l?this._downIndex:this.originalEndIndex,h=l?c:d,f={fromArrows:!0},p=0,g=u.itemAtIndex(h);o=Number.MAX_SAFE_INTEGER;for(var v=c;v<=d;++v){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var m=u.itemAtIndex(v);m&&("up"===e&&l||m!==g)&&(o=Math.min(o,m.levelsDeep.get()))}o===Number.MAX_SAFE_INTEGER&&(o=g.levelsDeep.get());var y=function(e){var i=u.itemAtIndex(e);if(i.levelsDeep.get()<=o&&(!t||i.isPrefixHeader())&&(r=e,p++,!n||p>5))return!0};if("down"===e){for(var _=0,b=u.numItems(),w=h+1;w<b;w++){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;if(y(w))break}if(r){var k=u.indexOfLastItem();i=l?[Math.min(r,d),0,Math.max(r,d),-1,f]:[Math.min(c,r),0,Math.min(Math.max(r,c),k),-1,f]}}else if("up"===e){for(var S=0,E=h-1;E>=0;E--){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;if(y(E))break}void 0!==r&&(i=l?[Math.max(0,Math.min(r,d)),0,Math.max(r,d),-1,f]:[Math.min(c,r),0,Math.max(c,r),-1,f])}return i&&(this.selectIndices.apply(this,a()(i)),this.setArrowSelectInverted(r<this._downIndex)),l?this.getStartIndex():this.getEndIndex()}},{key:"adjustSelectionBelow",value:function(e,t,n,r){for(var i=0,a=this.getPane(),o=a.numItems(),s=t,u=t.index+1;u<o;u++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=a.objectAtIndex(u),c=null===l||void 0===l?void 0:l.item;if(c){if(c.levelsDeep.get()<=n||l.block!==t.block)break;r?(e[l.id]={paneObject:l,full:!0,total:l.getDisplayLengthWithoutPrefix()},s=l):delete e[l.id]}}return s}},{key:"multiselect",value:function(e){var t,n=e,r=n.item,i=n.id,a=null===(t=r.levelsDeep)||void 0===t?void 0:t.get(),o=!this.isSelectedFully(n);this.isMultiselecting=!0;var s,u,l=Object.assign({},this._selectedMap),c=void 0!==a;if(o)Object.values(l).forEach((function(e){e.full||delete l[e.paneObject.id]})),l[i]={full:!0,paneObject:n,total:null===(s=(u=n).getDisplayLengthWithoutPrefix)||void 0===s?void 0:s.call(u)},c&&this.adjustSelectionBelow(l,n,a,!0);else if(delete l[i],c){this.adjustSelectionBelow(l,n,a,!1);var d=n.parentObject;d&&this.isSelected(d)&&(delete l[d.id],this.adjustSelectionBelow(l,d,a-1,!1))}this._setSelectedMap(l),this.setValid(this.checkValid()),this.updateCaret(),this.updateSelectedMap()}},{key:"updateSelectedMap",value:function(){var e=this;I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log(this._selectedMap);var t=this.save(),n=this.getPane();if(n){var r={};Object.values(this._previousSelectedMap).concat(Object.values(this._selectedMap)).forEach((function(t){var n=t.paneObject;r[n.id]||(r[n.id]=!0),e.notifyItemChanged(n.item)}))}this._previousSelectedMap=I.default.clone(this._selectedMap),C.a.fireEvent("selectionChanged",[t,n]),this.selectedMapObs.set(this._selectedMap)}},{key:"objectAtIndex",value:function(e){var t;return null===(t=this.getPane())||void 0===t?void 0:t.objectAtIndex(e)}},{key:"updatePaneObjectFromSelectedMap",value:function(e){var t=e.paneObject.pane.findPaneObject(e.paneObject.id);return t&&(e.paneObject=t,e.total=t.getDisplayLengthWithoutPrefix()),e}},{key:"_setSelectedMap",value:function(e){this._selectedMap=e}},{key:"forEach",value:function(e,t){var n=0;try{I.default.PAssert(256,!t||!t.restoreSelection,"restoreSelection is no longer a valid option")}catch(o){I.default.reportError(o)}x.a.beginAction();var r=this.getSelectedObjects(),i=r.map((function(e){return e.item}));T.default.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<r.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!1===e(r[a].item,a,r.length,r[a],i))break}T.default.PaneUpdateBatcher.commitUpdateItems(),x.a.endAction()}},{key:"notifyItemChanged",value:function(e){e.itemChanged.notify()}},{key:"insertTextAtSelection",value:function(e){var t=this.getStartObject(),n=this.getStartObject(),r=this.getStartOffsetWithPrefix(),i=this.getStartOffset(),a=this.getEndOffsetWithPrefix();if(t===n){var o=t.item,s=o.elsNew,u=t.getDisplayText(!0,!0),l=u[i-1];" "!==l&&i>0&&(e=" "+e),console.log(l,u);var c=s.spliceText(e,r,a-r,t);o.setText(c,P.a.ChangeType.Local),this.selectObject(t,i+e.length)}}},{key:"onTouchUp",value:function(e,t){O.onEvent("SelOnTouchUp",e,t)}},{key:"disableMouseDown",value:function(e){var t=this;this._isMouseDownDisabled=!0,I.default.timeoutOnce("disableMouseDown",(function(){return t._isMouseDownDisabled=!1}),e)}}]),r}(N),S()(r.prototype,"onScroll",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"onScroll"),r.prototype),S()(r.prototype,"handleRightMouseDown",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"handleRightMouseDown"),r.prototype),S()(r.prototype,"handleMouseDown",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"handleMouseDown"),r.prototype),S()(r.prototype,"handleMouseMoveDocument",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"handleMouseMoveDocument"),r.prototype),S()(r.prototype,"handleMouseMove",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"handleMouseMove"),r.prototype),S()(r.prototype,"handleMouseUp",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"handleMouseUp"),r.prototype),S()(r.prototype,"restore",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"restore"),r.prototype),S()(r.prototype,"onWindowBlur",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"onWindowBlur"),r.prototype),S()(r.prototype,"onWindowFocus",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"onWindowFocus"),r.prototype),r);t.a=new W},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){e.exports=function(e,t,n,r,i){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}},function(e,t,n){"use strict";function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){var i=n.value;if("function"!==typeof i)throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(r(i)));var a=!1;return{configurable:!0,get:function(){if(a||this===e.prototype||this.hasOwnProperty(t)||"function"!==typeof i)return i;var n=i.bind(this);return a=!0,Object.defineProperty(this,t,{configurable:!0,get:function(){return n},set:function(e){i=e,delete this[t]}}),a=!1,n},set:function(e){i=e}}}function a(e){var t;return"undefined"!==typeof Reflect&&"function"===typeof Reflect.ownKeys?t=Reflect.ownKeys(e.prototype):(t=Object.getOwnPropertyNames(e.prototype),"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(e.prototype)))),t.forEach((function(t){if("constructor"!==t){var n=Object.getOwnPropertyDescriptor(e.prototype,t);"function"===typeof n.value&&Object.defineProperty(e.prototype,t,i(e,t,n))}})),e}function o(){return 1===arguments.length?a.apply(void 0,arguments):i.apply(void 0,arguments)}n.d(t,"a",(function(){return o}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return S})),n.d(t,"c",(function(){return k})),n.d(t,"d",(function(){return F})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return d})),n.d(t,"i",(function(){return A})),n.d(t,"j",(function(){return N})),n.d(t,"k",(function(){return f})),n.d(t,"l",(function(){return p})),n.d(t,"m",(function(){return V})),n.d(t,"n",(function(){return C})),n.d(t,"o",(function(){return _})),n.d(t,"p",(function(){return O})),n.d(t,"q",(function(){return m})),n.d(t,"r",(function(){return y})),n.d(t,"s",(function(){return w})),n.d(t,"t",(function(){return b})),n.d(t,"u",(function(){return x})),n.d(t,"v",(function(){return I})),n.d(t,"w",(function(){return M})),n.d(t,"x",(function(){return R})),n.d(t,"y",(function(){return L})),n.d(t,"z",(function(){return z})),n.d(t,"A",(function(){return q})),n.d(t,"B",(function(){return D})),n.d(t,"C",(function(){return B})),n.d(t,"D",(function(){return H})),n.d(t,"E",(function(){return W}));var r=n(29),i=!1,a=!1,o="${JSCORE_VERSION}",s=function(e,t){if(!e)throw u(t)},u=function(e){return new Error("Firebase Database ("+o+") INTERNAL ASSERT FAILED: "+e)},l=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,l=u?e[i+2]:0,c=a>>2,d=(3&a)<<4|s>>4,h=(15&s)<<2|l>>6,f=63&l;u||(f=64,o||(h=64)),r.push(n[c],n[d],n[h],n[f])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(l(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&(a=e[n++]))<<12|(63&(s=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{a=e[n++];var s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&a)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==s||null==u)throw Error();var l=a<<2|o>>4;if(r.push(l),64!==s){var c=o<<4&240|s>>2;if(r.push(c),64!==u){var d=s<<6&192|u;r.push(d)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},d=function(e){var t=l(e);return c.encodeByteArray(t,!0)},h=function(e){try{return c.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function f(e){return p(void 0,e)}function p(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&(e[n]=p(e[n],t[n]));return e}var g=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},e}();function v(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())}function y(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(t){return!1}}function _(){return"object"===typeof self&&self.self===self}function b(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function w(){return!0===i||!0===a}var k=function(e){function t(n,r,i){var a=e.call(this,r)||this;return a.code=n,a.customData=i,a.name="FirebaseError",Object.setPrototypeOf(a,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,S.prototype.create),a}return Object(r.c)(t,e),t}(Error),S=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=t[0]||{},i=this.service+"/"+e,a=this.errors[e],o=a?E(a,r):"Error",s=this.serviceName+": "+o+" ("+i+").",u=new k(i,s,r);return u},e}();function E(e,t){return e.replace(P,(function(e,n){var r=t[n];return null!=r?String(r):"<"+n+"?>"}))}var P=/\{\$([^}]+)}/g;function I(e){return JSON.parse(e)}function D(e){return JSON.stringify(e)}var T=function(e){var t={},n={},r={},i="";try{var a=e.split(".");t=I(h(a[0])||""),n=I(h(a[1])||""),i=a[2],r=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:r,signature:i}},x=function(e){var t=T(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")},C=function(e){var t=T(e).claims;return"object"===typeof t&&!0===t.admin};function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function O(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function M(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function R(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},r=0,i=Object.entries(e);r<i.length;r++){var a=i[r];n(a[0],a[1])}return t.length?"&"+t.join("&"):""}var F=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"===typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var a,o,s=this.chain_[0],u=this.chain_[1],l=this.chain_[2],c=this.chain_[3],d=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(a=c^u&(l^c),o=1518500249):(a=u^l^c,o=1859775393):r<60?(a=u&l|c&(u|l),o=2400959708):(a=u^l^c,o=3395469782);i=(s<<5|s>>>27)+a+d+o+n[r]&4294967295;d=c,c=l,l=4294967295&(u<<30|u>>>2),u=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+d&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,a=this.inbuf_;r<t;){if(0===a)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[a]=e.charCodeAt(r),++r,++a===this.blockSize){this.compress_(i),a=0;break}}else for(;r<t;)if(i[a]=e[r],++r,++a===this.blockSize){this.compress_(i),a=0;break}}this.inbuf_=a,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},e}();function N(e,t){var n=new j(e,t);return n.subscribe.bind(n)}var j=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((function(){e(n)})).catch((function(e){n.error(e)}))}return e.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))},e.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)},e.prototype.complete=function(){this.forEachObserver((function(e){e.complete()})),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!==typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"===typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=U),void 0===r.error&&(r.error=U),void 0===r.complete&&(r.complete=U);var a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}})),this.observers.push(r),a},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!==typeof console&&console.error&&console.error(r)}}))},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))},e}();function U(){}var B=function(e,t,n,r){var i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function V(e,t,n){var r="";switch(t){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";return i+=r+" argument "}function H(e,t,n,r){if((!r||n)&&"function"!==typeof n)throw new Error(V(e,t,r)+"must be a valid function.")}function W(e,t,n,r){if((!r||n)&&("object"!==typeof n||null===n))throw new Error(V(e,t,r)+"must be a valid context object.")}var q=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var a=i-55296;r++,s(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},z=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t}}).call(this,n(89))},function(e,t){function n(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,u,"next",e)}function u(e){n(o,i,a,s,u,"throw",e)}s(void 0)}))}}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){"use strict";var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(42),l=n.n(u),c=n(18),d=n.n(c),h=n(19),f=n.n(h),p=n(11),g=n.n(p),v=n(7),m=n.n(v),y=n(0),_=n(21),b=n(44),w=n(1),k=n(13),S=function(){function e(){a()(this,e),this.onResize=new b.a,this.onForeground=new b.a,this.windowSize=new k.a({width:0,height:0})}return s()(e,[{key:"windowWidth",value:function(){return this.windowSize.get().width}},{key:"windowHeight",value:function(){return this.windowSize.get().height}}]),e}(),E=n(8);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var I=(r=function(e){d()(r,e);var t=P(r);function r(){var e;return a()(this,r),e=t.call(this),_.a.binder(l()(e),"normalizeKeys","getKeyCode"),e.blockedReason=new k.a,e.supportsMultiplePanes=new k.a(!0),e.versionRequired=[],e.versionAvailable=[],e.versionRequired[w.a.AppPlatform.Electron]=1,e.versionAvailable[w.a.AppPlatform.Electron]=5,e.versionCurrent=20,e.versionMessages={19:"We just released a big update with changes to selection and indenting, and many other changes. See the blog post for more details.",20:"New search options: normal search and global search. See the Hotkey help or the blog post for more details."},e.appSubVersion=void 0,e.setDeployEnvironments(),e.appPlatform=void 0,e.bodyClass=void 0,e.b=document.documentElement,e.orientation=w.a.Orientation.Portrait,e.isNativeFullscreen=new k.a(!1),e.onResize=new b.a,e.appState=void 0,e.isHosted=!1,e.hostedBy=void 0,e.initStorageQuota={quota:NaN,usage:NaN},e.isNearStorageQuota=!1,e.pageVisibilityHidden=void 0,e.pageVisibilityChange=void 0,e._allowNativeNotifications=!0,e.isDevURL="localhost"===window.location.hostname||"dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,e.isBeta="beta.moo.do"===window.location.hostname,e._features={},e.init(),e.app&&(e.customRedirectState={app:!0,appv:e.appv,webview:e.getAppState("webview")}),window.addEventListener("resize",e._onResize),e._onResize(),e}return s()(r,[{key:"_onResize",value:function(){var e=this,t=this.windowSize.get(),n=window.innerWidth,r=window.innerHeight;t.width===n&&t.height===r||this.windowSize.set({width:n,height:r}),this.isNativeApp()&&this.appv<4&&setTimeout((function(){e.screenTop!==window.screenTop&&(e.screenTop=window.screenTop,e.isNativeFullscreen.set(0===e.screenTop))}),100)}},{key:"getDeployVar",value:function(e){return this.deployEnvironment[e]}},{key:"setDeployEnvironments",value:function(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[w.a.DeployVariable.Environment]="dev",this.deployEnvironment[w.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[w.a.DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[w.a.DeployVariable.Environment]="beta",this.deployEnvironment[w.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[w.a.DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[w.a.DeployVariable.Environment]="local",this.deployEnvironment[w.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[w.a.DeployVariable.APIHost]="//api-dev.moo.do"):(this.deployEnvironment[w.a.DeployVariable.Environment]=this.isMobile?"mobile":"web",this.deployEnvironment[w.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[w.a.DeployVariable.APIHost]="//api-old.moo.do")}},{key:"getLocaleInfo",value:function(e){try{e.lang=navigator.language||navigator.userLanguage}catch(t){e.lang="EXCEPTION"}}},{key:"getPlatformInfo",value:function(e){e.os=this.OSName,e.browser=this.browser,e.majorVersion=this.majorVersion,e.minorVersion=this.minorVersion,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.appState=this.appState,e.isHosted=this.isHosted,e.hostedBy=this.hostedBy,e.embed=this.embed,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent,e.referrer=document.referrer,e.devicePixelRatio=window.devicePixelRatio,e.pageVisibilityChange=!!this.pageVisibilityChange,e.appSubVersion=this.appSubVersion,e.initStorageQuota=this.initStorageQuota,e.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(e)}},{key:"getUserPlatformConfig",value:function(){return(this.platformBrowser&&this.platformOS?this.platformOS+""+this.platformBrowser:navigator.userAgent)+(this.isBeta?"b":"")}},{key:"getAppDownloadURL",value:function(){return window.location.origin+"/download/"}},{key:"getChromeExtensionURL",value:function(){return"https://chrome.google.com/webstore/detail/moodo/dfphnckjoinkfflhfbnjoiggfflnekcb"}},{key:"getGmailAddonURL",value:function(){return"https://gsuite.google.com/marketplace/app/moodo/597847337936"}},{key:"getPrivacyPolicyURL",value:function(){return"https://www.moo.do/privacy/"}},{key:"supportsNativeApp",value:function(){switch(this.OSName){case"Windows":case"MacOS":return!0;default:return!1}}},{key:"isNativeApp",value:function(){return this.appPlatform===w.a.AppPlatform.Electron}},{key:"supportLocalFiles",value:function(){return this.isNativeApp()&&this.appv>=3}},{key:"isNativeMac",value:function(){return this.isNativeApp()&&this.mac}},{key:"canDownloadNativeApp",value:function(){return this.supportsNativeApp()&&!this.isNativeApp()}},{key:"init",value:function(){var e=this;this.initAppState(),this.initHostState(),this.initFeatures();var t,r,i=navigator.userAgent,a="";((_.a.getURLParam("rn")||window.ReactNativeWebView)&&(this.isRNApp=!0,this.isMobile=!0,this.app=!0),this.OSName="Unknown OS",this.app&&(a+=" app"),i.includes("Win")?(this.platformOS=w.a.PlatformOS.Windows,this.OSName="Windows",this.windows=!0):i.includes("iPhone")?(this.platformOS=w.a.PlatformOS.iPhone,this.OSName="iPhone"):i.includes("iPod")?(this.platformOS=w.a.PlatformOS.iPod,this.OSName="iPod"):-1!==i.indexOf("Mac")?(this.platformOS=w.a.PlatformOS.Mac,this.OSName="MacOS",this.mac=!0):-1!==i.indexOf("X11")?-1!==i.indexOf("CrOS")?(this.platformOS=w.a.PlatformOS.ChromeOS,this.OSName="ChromeOS",this.chromeOS=!0):(this.platformOS=w.a.PlatformOS.Linux,this.OSName="Linux",this.linux=!0):-1!==i.indexOf("Linux")&&(this.platformOS=w.a.PlatformOS.Linux,this.OSName="Linux",this.linux=!0,i.indexOf("Android")&&(this.isMobile=!0,this.isAndroid=!0)),this.majorVersion=1e3,this.minorVersion=1e3,-1!==i.indexOf("MSIE")||-1!==i.indexOf("Trident"))&&(this.platformBrowser=w.a.PlatformBrowser.IE,this.browser="Trident",this.ie=!0,(null!==("Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(i)||null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(i))&&(this.majorVersion=parseFloat(RegExp.$1)));if(this.app||-1===i.indexOf("Edge/")&&-1===i.indexOf("Edg/")?-1!==i.indexOf("Chrome")||-1!==i.indexOf("CriOS")?(this.platformBrowser=w.a.PlatformBrowser.Chrome,this.browser="Chrome",this.isChrome=!0,null!==new RegExp("Chrome/([0-9]{1,}).").exec(i)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==i.indexOf("Firefox")?(this.platformBrowser=w.a.PlatformBrowser.Firefox,this.browser="Firefox",this.isFirefox=!0,null!==new RegExp("Firefox/([0-9]{1,}).").exec(i)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==i.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName?(this.platformBrowser=w.a.PlatformBrowser.Safari,this.browser="Safari",this.safari=!0,null!==new RegExp("Version/([0-9]{1,}).([0-9]{1,}).").exec(i)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2)),"iPad"!==this.OSName&&"iPhone"!==this.OSName&&"iPod"!==this.OSName||(this.isMobile=!0,this.isiOS=!0)):-1!==i.indexOf("Opera")?(this.platformBrowser=w.a.PlatformBrowser.Opera,this.browser="Opera"):-1!==i.indexOf("Edge")&&(this.ieEdge=!0,this.platformBrowser=w.a.PlatformBrowser.Edge):(this.ieEdge=!0,this.platformBrowser=w.a.PlatformBrowser.Edge,this.browser="Edge",null!==/Edg(?:e)*\/([0-9]{1,})\./i.exec(i)&&(this.majorVersion=parseFloat(RegExp.$1))),i.indexOf(w.a.ProductName)>=0){if(this.platformBrowser=w.a.PlatformBrowser.Electron,this.app=!0,this.appPlatform=w.a.AppPlatform.Electron,a+=" electron",null!==new RegExp("Moo\\.do/([^\\s]+)\\s").exec(navigator.userAgent)){var o,s=function(e,t){for(var n=0,r=e.split("."),i=t.split("."),a=0;a<3;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=+r[a],s=+i[a];if(o>s)return 1;if(s>o)return-1;if(!isNaN(o)&&isNaN(s))return 1;if(isNaN(o)&&!isNaN(s))return-1}return 0},u=RegExp.$1;(o=s(u,"1.6.0")>=0?5:s(u,"1.4.2")>=0?4:s(u,"1.2.1")>=0?3:s(u,"1.1.0")>=0?2:1)<4&&setTimeout((function(){Promise.resolve().then(n.bind(null,2)).then((function(t){t.default.toasts.pushMessage({text:"A new version is available with important fixes. Future versions will update themselves, but please download this manually.",hold:!0,holdOnAction:!0,actionText:"DOWNLOAD",action:function(){t.default.openUrl(e.getAppDownloadURL())}})}))}),2e3),this.appv=o}this.mac&&(a+=" electronMac"),this.appState||(this.appState={}),this.appState.appType||(this.appState.appType="electron"),this._enableFeature(w.a.Feature.OAuth)}if(this.isTouchDevice=!(!("ontouchstart"in window)&&!navigator.msMaxTouchPoints),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.isMobile&&(a+=" moweb"),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),_.a.hasURLParam("touch","false")?this.touch=!1:_.a.hasURLParam("touch","true")&&(this.touch=!0),this.mac){a+=" mac";(function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var r=n.offsetWidth;return e.parentNode.removeChild(e),t-r})()>0&&(a+=" showScrollbars")}if(this.windows&&(a+=" windows",this.ie&&(a+=" ie")),"Firefox"===this.browser&&(a+=" firefox"),this.safari&&(a+=" safari"),this.embed===w.a.EmbedApps.Mailbird&&(this.platformBrowser=w.a.PlatformBrowser.Mailbird,a+=" mailbird",this.isMailbirdSidebar()&&(a+=" mailbirdSidebar")),this.demo&&(a+=" demoMode"),this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"\u2318":"ctrl",this.priModKey=this.mac?"\u2318":"Ctrl",this.secModKeyForce=this.mac?"\u2303":"Alt",this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,a&&a.length>0&&(this.bodyClass=a,this.b.className+=a),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!(this.ie||this.ieEdge),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){clearTimeout(e)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",(function(e){e.preventDefault()}),!1),document.documentElement.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),"undefined"!==typeof document.hidden?(t="hidden",r="visibilitychange"):["moz","ms","webkit"].forEach((function(e){if("undefined"!==document[e+"Hidden"])return t=e+"Hidden",r=e+"visibilitychange",!1})),void 0!==t&&(this.pageVisibilityHidden=t,this.pageVisibilityChange=r),this.supportsEstimatedStorage()){this.estimateAvailableStorage((function(t){e.initStorageQuota=t,t.usage/t.quota>.9&&(e.isNearStorageQuota=!0)}),(function(){}))}}},{key:"updateBodyClass",value:function(){this.bodyClass&&(document.body.className+=this.bodyClass)}},{key:"supportsNotifications",value:function(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()}},{key:"supportsNativeNotifications",value:function(){var e=!1;return this._allowNativeNotifications&&(this.app&&this.appPlatform!==w.a.AppPlatform.Electron&&this.isChrome||this.embed===w.a.EmbedApps.Mailbird)&&(e=!0),e}},{key:"supportsHTML5Notifications",value:function(){return"Notification"in window}},{key:"usesHTML5Notifications",value:function(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()}},{key:"hasNotificationPermission",value:function(){return!this.usesHTML5Notifications()||"granted"===Notification.permission}},{key:"disallowNativeNotifications",value:function(){this._allowNativeNotifications=!1}},{key:"supportsPersistedStorage",value:function(){var e=!1;return"storage"in navigator&&"persist"in navigator.storage&&(e=!0),e}},{key:"requestStoragePersistence",value:function(e,t){navigator.storage.persisted().then((function(n){n?e():navigator.storage.persist().then(e,t)}))}},{key:"isStoragePersisted",value:function(e){this.supportsPersistedStorage()?navigator.storage.persisted().then(e):setTimeout(e,0,!1)}},{key:"supportsNativePromises",value:function(){return!!window.Promise}},{key:"supportsEstimatedStorage",value:function(){var e=!1;return("storage"in navigator&&"estimate"in navigator.storage||"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage)&&(e=!0),e&&this.supportsNativePromises()}},{key:"estimateAvailableStorage",value:function(e,t){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(e,t):setTimeout(t,0)}},{key:"_estimateAvailableStorage",value:function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise((function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota((function(t,n){e({usage:t,quota:n})}),t)})):Promise.resolve({usage:NaN,quota:NaN})}},{key:"supportsWebworkers",value:function(){var e=!1;return window.Worker&&(e=!0),e}},{key:"supportsNativeDownload",value:function(){return this.isNativeApp()&&this.appv>=2}},{key:"supportsIDBWebworkers",value:function(){var e=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":e=this.majorVersion>=37;break;case"Chrome":e=this.majorVersion>=24}return e}},{key:"supportsPassiveListeners",value:function(){if(void 0===this._supportsPassiveListeners){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(n){}this._supportsPassiveListeners=e}return this._supportsPassiveListeners}},{key:"addPassiveListener",value:function(e,t,n){this.supportsPassiveListeners()?e.addEventListener(t,n,{passive:!0}):e.addEventListener(t,n)}},{key:"isMobro",value:function(){var e,t=null;try{new ActiveXObject("")}catch(n){e=n.name}try{t=!!new ActiveXObject("htmlfile")}catch(n){t=!1}return!(t="ReferenceError"===e||!1!==t)}},{key:"normalizeKeys",value:function(e){var t=e;return void 0!==t.normCode&&(e.synthetic||t instanceof KeyboardEvent)||(t.normCode=this.getKeyCode(e)),t}},{key:"getKeyCode",value:function(e){var t;return 46===(t=null===e.keyCode||0===e.keyCode?null!==e.charCode?e.charCode:e.which:e.keyCode)&&"keypress"===e.type&&(t=190),t}},{key:"initAppState",value:function(){var e=location.hash.substring(1);if(e)for(var t,n=0,r=/([^&=]+)=([^&]*)/g;null!==(t=r.exec(e));){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if("state"===decodeURIComponent(t[1])){var i=decodeURIComponent(t[2]);if(i){var a=function(t){try{e=JSON.parse(t)}catch(n){}};a(i),e||a(i.replace(/\\"/g,'"')),e&&(this.app=!0===e.app,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.test=e.test,this.embed=e.embed,this.appState=e)}break}}this.live=this.live||_.a.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||_.a.hasURLParam("offline","true")||!1,this.demo=_.a.hasURLParam("demo","true")||_.a.hasURLParam("template")||!1,this.app=this.app||!1}},{key:"getAppState",value:function(e){return this.appState?this.appState[e]:void 0}},{key:"_enableFeature",value:function(e){this._features[e]=!0}},{key:"_disableFeature",value:function(e){this._features[e]=!1}},{key:"initFeatures",value:function(){this._enableFeature(w.a.Feature.ClonePane)}},{key:"isMailbirdSidebar",value:function(){return this.embed===w.a.EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")}},{key:"initHostState",value:function(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)}},{key:"addPrefix",value:function(e,t){var n="",r=["ms","webkit","moz","o"],i=this.b.style;if(t||(t=e),"string"===typeof i[e])n="";else for(var a=0,o=0;o<r.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("string"===typeof i["-"+r[o]+"-"+t]){n=r[o];break}}var s=n.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;if(n){var u=n.length>0?n.charAt(0).toUpperCase()+n.slice(1):e;return{prop:"-"+n+"-"+t,style:n+s,react:u+s}}return{prop:e,style:s,react:s}}},{key:"blockClient",value:function(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":return{platform:"Internet Explorer",browser:this.browser,update:!1};case"Safari":if(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};break;case"Edge":if(!y.default.isDemoMode()&&this.windows&&this.majorVersion<70)return{platform:this.browser,browser:this.browser,update:!1}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){n(0).default.log("App Version out of date.");var e={version:this.versionRequired[this.appPlatform]};return n(0).default.nativeBridge.sendToApp("updateRequired"),e}if(this.appv>this.versionAvailable[this.appPlatform])return n(0).default.log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0}}}},{key:"actionVerb",value:function(){return this.touch?"tap":"click"}},{key:"actionVerbCaps",value:function(){return this.touch?"Tap":"Click"}},{key:"updateOrientation",value:function(){return this.orientation=90===Math.abs(window.orientation)?w.a.Orientation.Landscape:w.a.Orientation.Portrait,this.orientation}},{key:"isPageVisible",value:function(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]}},{key:"getUpdateMessages",value:function(e){for(var t=0,n=[],r=(e||0)+1;r<=this.versionCurrent;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.versionMessages[r];i&&n.push(i)}return n}},{key:"isFeatureEnabled",value:function(e){return this._features[e]}},{key:"recordAppSubVersion",value:function(e){this.appSubVersion=e}},{key:"getPlatformName",value:function(){return this.mac?"Mac":this.windows?"Windows":"Chrome"}},{key:"getPlatformIcon",value:function(){return this.mac?"FaApple":this.windows?"FaWindows":this.linux?"FaLinux":"FaChrome"}},{key:"getActualWindowWidth",value:function(){return document.body&&document.body.clientWidth||0}},{key:"getActualWindowHeight",value:function(){return document.body&&document.body.clientHeight||0}},{key:"hasBetaFeatures",value:function(){return this.isDevURL}},{key:"isPriModKey",value:function(e){return this.mac&&e.metaKey||!this.mac&&e.ctrlKey}},{key:"isSecModKey",value:function(e){return this.mac&&e.ctrlKey||!this.mac&&e.altKey}},{key:"supportSmoothScrollWithKeyboard",value:function(){return!this.isiOS||this.app}}]),r}(S),m()(r.prototype,"_onResize",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"_onResize"),r.prototype),r);t.a=new I},function(e,t,n){"use strict";n(39);var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(92),u=function(){function e(t,n,r){i()(this,e),this._value=t,this._listeners=n?[new s.a(this,n)]:void 0,this._shouldFreeze=r}return o()(e,[{key:"ignoreLoopingListenersError",value:function(){0}},{key:"get",value:function(){return this._value}},{key:"countProperties",value:function(){return Object.keys(this._value).length}},{key:"set",value:function(e,t){var n=this._value;return this._value=e,!1!==t&&this.notify(e,n,t),e}},{key:"hasValue",value:function(){return void 0!==this._value}},{key:"onHasValue",value:function(e){if(this.hasValue())e(this._value);else var t,n=this.listen((function(r,i){void 0===r||t||(t=!0,e(r,i),setTimeout((function(){n.dispose()}),0))}))}},{key:"onValue",value:function(e,t){if(this._value===e)t();else var n,r=this.listen((function(i,a){i!==e||n||(n=!0,t(),setTimeout((function(){r.dispose()}),0))}))}},{key:"hasListeners",value:function(){return this._listeners&&this._listeners.length>0}},{key:"listen",value:function(e){this._listeners||(this._listeners=[]);var t=new s.a(this,e);return this._listeners.push(t),t}},{key:"unlistenListener",value:function(e){this._listeners&&this._listeners.remove(e)}},{key:"unlisten",value:function(e){if(this._listeners){var t=this._listeners.findIndex((function(t){return t.cb===e}));t>=0&&this._listeners.removeAt(t)}}},{key:"notify",value:function(e,t,n){0===arguments.length&&(e=this._value,t=this._value,n=!0);var r=this._listeners;if(r&&r.length>0&&(e!==t||!0===n)){var i=0;0;for(var a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a];!1===(0===arguments.length?o.cb(this._value,void 0,n):o.cb(e,t,n))&&(r.splice(a,1),a--)}0}}}]),e}();t.a=u},function(e,t,n){"use strict";e.exports=n(116)},function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return a})),n.d(t,"g",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"k",(function(){return u})),n.d(t,"l",(function(){return l})),n.d(t,"n",(function(){return c})),n.d(t,"i",(function(){return d})),n.d(t,"m",(function(){return h})),n.d(t,"j",(function(){return f})),n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return g})),n.d(t,"h",(function(){return v})),n.d(t,"c",(function(){return m}));var r=n(45),i=function(e){return null!==e&&void 0!==e},a=function(e){return"number"===typeof e},o=function(e){return r.a.indexOf(e)>=0},s=Array.isArray,u=function(e,t){void 0===t&&(t=e),1===arguments.length&&(t=e,e=0);for(var n=[],r=e;r<t;r++)n.push(r);return n},l=function(e,t){var n=0,r=[];if(s(e))for(;n<t;n++)r[n]=[].concat(e);else for(;n<t;n++)r[n]=e;return r},c=function(e){return s(e)?e:[e]};function d(e,t,n){void 0===n&&(n=" ");var r=String(e);return t>>=0,r.length>t?String(r):((t-=r.length)>n.length&&(n+=l(n,t/n.length)),n.slice(0,t)+String(r))}var h=function(e,t,n){var r=e.split(t);return n?r.slice(0,n).concat([r.slice(n).join(t)]):r},f=function(e,t){var n=e%t;return n*t<0?n+t:n},p=function(e,t){return{div:Math.floor(e/t),mod:f(e,t)}},g=function(e){return!i(e)||0===e.length},v=function(e){return!g(e)},m=function(e,t){return v(e)&&-1!==e.indexOf(t)}},function(e,t,n){"use strict";var r,i=n(3),a=n.n(i),o=n(10),s=n.n(o),u=n(5),l=n.n(u),c=n(6),d=n.n(c),h=n(7),f=n.n(h),p=n(36),g=n(8),v=n(33),m=n.n(v),y=n(18),_=n.n(y),b=n(19),w=n.n(b),k=n(11),S=n.n(k),E=n(1),P=n(20),I=n(35),D=n(0),T=n(2),x=n(21),C=n(40),A=n(50),L=n(86),O=n(22),M=n(66),R=n(25),F=n(54),N=n(69),j=n(13);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S()(e);if(t){var i=S()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w()(this,n)}}var B,V=new(r=function(e){_()(n,e);var t=U(n);function n(){var e;return l()(this,n),(e=t.call(this,!0)).dataCache={settings:{},items:{},documents:{},boards:{},contacts:[],localStorage:{},user:{}},e._demoId=1,e.demoError=new j.a,e}return d()(n,[{key:"init",value:function(e,t){var n={displayName:"Demo User",activeUser:"demoemail@moo.do",userId:"demouid"},r={};Object.keys(n).forEach((function(e){return r[T.default.settings.getSettingAbbrev(e)]={v:n[e]}})),T.default.settings.load(r,!1,!1);this.loadDemoContacts(["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"]);var i=function(t){e(t),ae.isLoaded.onValue(!0,(function(){T.default.PaneManager.loadInitialState(),C.a.ensureSelected()}))},a=x.a.getURLParam("template");if(a)this.loadCloudTemplate(a,i);else{var o,s=null!==(o=x.a.getURLParam("data"))&&void 0!==o?o:"demo-basic";this.loadDemoTemplate(s,i)}}},{key:"loadCloudTemplate",value:function(){var e=s()(a.a.mark((function e(t,n){var r,i,o;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return p.a.initializeFirebase(),e.next=3,I.a.database().ref("templates/".concat(t)).once("value");case 3:if(r=e.sent.val())try{i=JSON.parse(r.v),o=Object.assign(r.p,i),this.loadDemoData(o,n)}catch(s){0,this.demoError.set("Error loading template: "+JSON.stringify(s))}else this.demoError.set("Error loading template. A template with this id does not exist.");case 5:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadDemoTemplate",value:function(e,t){var n=this;D.default.XHR({type:"GET",url:"".concat(window.location.protocol,"//").concat(window.location.host,"/data/").concat(e.toLowerCase(),".json")}).then(function(){var e=s()(a.a.mark((function e(r){var i;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(200!==r.status){e.next=5;break}return e.next=3,r.json();case 3:i=e.sent,n.loadDemoData(i,t);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"loadDemoData",value:function(e,t){var n=this;if(e){var r=e.documents,i=e.boards,a=e.dateBasis,o=+O.a.getToday()-a,s=r.map((function(e){var t=e.doc,r=e.items.map((function(e){var t=R.a.itemIn(e);if(t.date){var r=F.a.fromData(t.date);r&&!r.isRepeatDate()&&(r.getDate().addMilliseconds(o),t.date=r.toData())}return t.dateCompleted&&(t.dateCompleted+=o),t.dateCreated&&(t.dateCreated+=o),t.dateModified&&(t.dateModified+=o),n.dataCache.items[t.id]=t,t}));M.a.createItemHierarchy(r,P.a.getItemsMap());var i=n.getItemData(t.root),a={id:t.id,text:t.text,acl:m()({},p.a.getUid(),{e:p.a.getAccountEmail(),t:p.a.getAccountName(),r:E.a.DocumentAccessRoles.Admin}),backing:n,dateModified:Date.now(),rootData:i},s=N.a.fromData(a,n);return s.createVMLIs(),s})),u=D.default.isDemoMode()&&x.a.getURLParam("panes");if(u&&s[0]){var l={id:ae.generateID(),name:"My Board",index:"0",panes:this.loadDemoPanesFromHash(u,s[0].id)};this.dataCache.boards=m()({},l.id,l)}else this.dataCache.boards=i;t(s)}}},{key:"loadDemoPanesFromHash",value:function(e,t){for(var n=0,r=e.split(","),i=[],a=0;a<r.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[a].split(":");if("help"===o[0])T.default.intro.showHelp();else{var s=o[0],u={id:ae.generateID(),document:t};if("1"===s||"Outline"===s?(s=E.a.PaneMode.Task,u.viewState={viewMode:"Outline"}):"2"!==s&&"Calendar"!==s||(s=E.a.PaneMode.Task,u.viewState={viewMode:"Calendar_Week"}),u.type=s,o.length>1){if(o[1]){for(var l=0,c={text:o[1]},d=o[1].split(" "),h=0;h<d.length;h++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var f=!1,p="-"===d[h][0],g=d[h].replace("-","");if(g.indexOf("//")>=0)f=!0,c.complete=p?-1:1;else if(g.indexOf("*")>=0)f=!0,c.starred=p?-1:1;else if(g.indexOf("!")>=0){f=!0;var v=void 0;3===g.length?v=E.a.VMLIFlag.P0:2===g.length?v=E.a.VMLIFlag.P1:1===g.length&&(v=E.a.VMLIFlag.P2),c.priority=v}f&&(c.text=c.text.replace(d[h],""))}u.search=c}o[2]&&(u.item=o[2])}i.push(u)}}return i}},{key:"loadDemoContacts",value:function(e){var t=0,n=e.map((function(e){return{id:"contact_"+t++,name:e,isDemo:!0,emails:[{address:"test-"+e.split(" ")[0].toLowerCase()+"@moo.do",primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]}}));A.a.loadContacts(n)}},{key:"getItemData",value:function(e){return this.dataCache.items[e]}},{key:"saveItem",value:function(e,t,n,r,i){var a=this.dataCache.items[t.id];if(a)Object.assign(a,n);else{var o=t.getFullSaveData(),s=t.getItems().map((function(e){return e.getFullSaveData()}));a=Object.assign(o,{items:s})}return this.dataCache.items[t.id]=a,Promise.resolve()}},{key:"deleteItem",value:function(e,t,n){var r=t.parent();this.saveItem(e,r,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop),delete this.dataCache.items[t.id]}},{key:"addItem",value:function(e,t){this.saveItem(e,t.parent(),void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop),this.saveItem(e,t,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop)}},{key:"moveItem",value:function(e,t){var n=e.getDocumentOwner();this.saveItem(n,e,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop)}},{key:"setNote",value:function(e,t,n,r,i){this.saveItem(e,t,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop),n?this.saveItem(e,n,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop):r&&delete this.dataCache.items[r.id]}},{key:"addDocument",value:function(e){var t=e.getRootItem();return this.documents[e.id]=e,this.saveItem(e,t,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop)}},{key:"saveDocument",value:function(e){}},{key:"deleteDocument",value:function(e){}},{key:"undeleteDocument",value:function(e){}},{key:"unlistenDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){}},{key:"saveBoard",value:function(e){}},{key:"deleteBoard",value:function(e){}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"clearAllData",value:function(){var e=s()(a.a.mark((function e(){return a.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"generateId",value:function(){return"id_"+this._demoId++}}]),n}(L.b),f()(r.prototype,"generateId",[g.a],Object.getOwnPropertyDescriptor(r.prototype,"generateId"),r.prototype),r),H=n(79),W=n(23),q=n(80);function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S()(e);if(t){var i=S()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w()(this,n)}}var G,K,Y=new(B=function(e){_()(n,e);var t=z(n);function n(){var e;return l()(this,n),(e=t.call(this,!0)).dataCache={},e.dirtyDocs={},W.a.listen("onUnload",e.writeDocuments),e}return d()(n,[{key:"init",value:function(){var e=s()(a.a.mark((function e(t,n){var r,i=this;return a.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:this.cbOnDocumentsChanged=n,r=window.___electronAllDocs,T.default.ElectronBridge.listenToDocChanges(this.onFileChanged),T.default.crypto.onLoad((function(){T.default.crypto.onUpdated.listen(i.reload);var e=function(){var e=s()(a.a.mark((function e(n){var r;return a.a.wrap((function(e){for(var o=0,u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!n){e.next=7;break}return e.next=3,Promise.all(n.map(function(){var e=s()(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(var r=0,a=0,o=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,i.parseJSON(t);case 2:if(!(n=e.sent)){e.next=6;break}return n.items&&n.items.forEach((function(e){i.dataCache[e.id]=e})),e.abrupt("return",i.createDoc(n,n.id));case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:r=e.sent.filter((function(e){return void 0!==e})),t(r),e.next=8;break;case 7:t([]);case 8:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}();r?r.value?e(r.value):(T.default.toasts.pushMessage({text:"Error loading local files. Please check that the directory is correct in the settings.",actionText:"SETTINGS",action:function(){return T.default.menus.openSettings("Desktop")},hold:!0}),t([])):T.default.ElectronBridge.getAllDocs(e)}));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createDoc",value:function(e,t){if(!ae.getDocumentById(e.id)){var n=N.a.create(e);return n.createVMLIs(),this.documents[n.id]=n,n}T.default.toasts.pushMessage("Detected duplicate document data in local document:<br/>".concat(t,".json"))}},{key:"parseJSON",value:function(){var e=s()(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,n=JSON.parse(t),e.abrupt("return",this.parseJSONObject(n));case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseJSONObject",value:function(){var e=s()(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(e.prev=0,!(t.moodoVer&&t.doc&&t.doc.root&&t.doc.id)){e.next=10;break}return e.next=4,q.a.parseJSON(t);case 4:if(!(n=e.sent)){e.next=9;break}return n.id=t.doc.id,n.backing=this,e.abrupt("return",n);case 9:console.log("No data for",t);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(0);case 14:case"end":return e.stop()}}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=this,t={};Object.keys(this.documents).forEach((function(e){return t[e]=!0})),T.default.ElectronBridge.getAllDocs(function(){var n=s()(a.a.mark((function n(r,i){return a.a.wrap((function(n){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(n.prev=n.next){case 0:return i=i||[],n.next=3,Promise.all(i.map(function(){var n=s()(a.a.mark((function n(r){var i,o;return a.a.wrap((function(n){for(var a=0,s=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(n.prev=n.next){case 0:return n.prev=0,i=JSON.parse(r),n.next=4,e.onFileChanged(E.a.CrudActions.Modified,i);case 4:(o=n.sent)&&delete t[o.id],n.next=10;break;case 8:n.prev=8,n.t0=n.catch(0);case 10:case"end":return n.stop()}}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}()));case 3:Object.keys(t).forEach((function(t){return e.onFileChanged(E.a.CrudActions.Removed,t)})),e.cbOnDocumentsChanged({documents:e.documents,documentsEncrypted:{},documentsDeleted:{}});case 5:case"end":return n.stop()}}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"onFileChanged",value:function(){var e=s()(a.a.mark((function e(t,n){var r,i,o,s,u,l=this;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(t!==E.a.CrudActions.Removed||"string"!==typeof n){e.next=6;break}r=n,(i=this.documents[r])&&(i.delete(!0),delete this.documents[r]),e.next=14;break;case 6:return e.next=8,this.parseJSONObject(n);case 8:if(!(o=e.sent)){e.next=14;break}return(s=this.documents[o.id])?(u=o.items,s.text.set(o.text),this.checkFileItems(s,u)):(s=this.createDoc(o,n.id),this.cbOnDocumentsChanged({documents:this.documents,documentsEncrypted:{},documentsDeleted:{}})),s&&o.items&&o.items.forEach((function(e){l.dataCache[e.id]=e})),e.abrupt("return",s);case 14:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkFileItems",value:function(e,t){var n=0,r=this,i={};e.getAllItems().forEach((function(e){return i[e.id]=!0}));for(var a=function(a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t[a];if(!o.isRoot){var s=r.getItemData(t[a].id),u=!1,l={id:o.id};s?Object.keys(o).forEach((function(e){s[e]!==o[e]&&("id"!==e&&(u=!0),l[e]=o[e])})):(l=o,u=!0),u&&H.a.onRemoteChange(e,s,o.id,l)}delete i[o.id]},o=0;o<t.length;o++)a(o);Object.keys(i).forEach((function(t){var n=r.getItemData(t),i={id:t,isDeleted:!0};H.a.onRemoteChange(e,n,t,i)}))}},{key:"writeDocuments",value:function(){var e=this;Object.keys(this.dirtyDocs).forEach((function(t){var n=e.dirtyDocs[t];delete e.dirtyDocs[t],n.dateModified.set(Date.now()),n.toJSON({exportArchived:!0,includeNotes:!0,encrypt:T.default.settings.encryptLocalFiles.get()}).then((function(e){T.default.ElectronBridge.saveDoc("".concat(n.id,".json"),e,(function(e){e&&(console.log(e),T.default.toasts.pushMessage("Error saving ".concat(n.text.get(),". Please check that the destination file is writeable.")))}))}))}))}},{key:"setDocNeedsWrite",value:function(e){this.dirtyDocs[e.id]=e,clearTimeout(this.timeoutWrite),this.timeoutWrite=setTimeout(this.writeDocuments,1e3)}},{key:"getItemData",value:function(e){return this.dataCache[e]}},{key:"saveItem",value:function(e,t,n,r,i){var a=new Date;t.dateModified=a,this.dataCache[t.id]=t.getFullSaveData(),D.default.isLocalChange(r)&&!D.default.isUndoRedoChange(r)&&this.setDocNeedsWrite(e)}},{key:"deleteItem",value:function(e,t,n){delete this.dataCache[t.id],D.default.isLocalChange(n)&&!D.default.isUndoRedoChange(n)&&this.setDocNeedsWrite(e)}},{key:"addItem",value:function(e,t){var n=this;t.forEachChildRecursive((function(t){n.saveItem(e,t,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop)}),!0,!0)}},{key:"moveItem",value:function(e,t){var n=this,r=e.getDocumentOwner(),i=t.getDocumentOwner();r===i?this.saveItem(e.getDocumentOwner(),e,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop):(e.forEachChildRecursive((function(e){n.saveItem(r,e,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop)}),!0,!0),this.setDocNeedsWrite(i))}},{key:"setNote",value:function(e,t,n,r,i){this.saveItem(e,t,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop),n&&this.saveItem(e,n,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop)}},{key:"addDocument",value:function(){var e=s()(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:n=t.getRootItem(),this.documents[t.id]=t,this.saveItem(t,n,void 0,E.a.ChangeType.Local,E.a.SaveFlag.Prop);case 3:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveDocument",value:function(e){this.setDocNeedsWrite(e)}},{key:"deleteDocument",value:function(e,t){T.default.ElectronBridge.deleteDoc("".concat(e.id,".json"))}},{key:"undeleteDocument",value:function(e,t){}},{key:"renameDocument",value:function(e,t){this.setDocNeedsWrite(e)}},{key:"unlistenDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){0}},{key:"saveBoard",value:function(e){0}},{key:"deleteBoard",value:function(e){0}},{key:"getBoards",value:function(){return[]}},{key:"clearAllData",value:function(){return Promise.resolve()}},{key:"generateId",value:function(){return D.default.generateTempId()}},{key:"numDocuments",value:function(){return Object.keys(this.documents).length}}]),n}(L.a),f()(B.prototype,"reload",[g.a],Object.getOwnPropertyDescriptor(B.prototype,"reload"),B.prototype),f()(B.prototype,"onFileChanged",[g.a],Object.getOwnPropertyDescriptor(B.prototype,"onFileChanged"),B.prototype),f()(B.prototype,"writeDocuments",[g.a],Object.getOwnPropertyDescriptor(B.prototype,"writeDocuments"),B.prototype),B),Q=n(12),X=n(38),$=n(27),J=n(87),Z=n(70),ee=10*E.a.MSPerMinute,te=new(G=function(){function e(){l()(this,e)}return d()(e,[{key:"init",value:function(){T.default.settings.backupFrequency.listen(this.onTimeChanged),D.default.isBoolean(T.default.settings.needsBackup.get())&&T.default.settings.needsBackup.set({}),this.needsBackupDrive=Object.assign({},T.default.settings.needsBackup.get()||{}),p.a.onAuthed(this.checkBackup),setInterval(this.checkBackup,ee)}},{key:"docNeedsBackup",value:function(e){var t=T.default.settings.needsBackup.get();return t&&t[e.id]&&Date.now()-t[e.id]>ee}},{key:"setNeedsBackup",value:function(e,t){var n=Date.now();if(t){if(!e.isLocalOnly()||T.default.settings.backupLocal.get()){var r=T.default.settings.needsBackup.get();r&&r[e.id]||T.default.settings.needsBackup.set(Object.assign(m()({},e.id,n),r))}}else{var i=D.default.clone(T.default.settings.needsBackup.get());delete i[e.id],T.default.settings.needsBackup.set(i)}}},{key:"onTimeChanged",value:function(){this.needsBackupDrive={},$.a.onLoaded(this.checkBackupDrive)}},{key:"onDataSaved",value:function(e){this.setNeedsBackup(e,!0)}},{key:"checkBackup",value:function(){this.checkBackupAuto(),T.default.settings.backupFrequency.get()>0&&$.a.onLoaded(this.checkBackupDrive)}},{key:"checkBackupAutoDoc",value:function(e){this.docNeedsBackup(e)&&this.backupDocumentAuto(e)}},{key:"checkBackupAuto",value:function(){ae.getDocumentsArray().forEach(this.checkBackupAutoDoc)}},{key:"checkBackupDriveDoc",value:function(e){var t=T.default.settings.backupsDrive.get(),n=t&&t[e.id];if(isNaN(n)||Date.now()-n>T.default.settings.backupFrequency.get())return this.backupDocumentDrive(e),!0}},{key:"checkBackupDrive",value:function(){T.default.settings.backupFrequency.get()>0&&ae.getDocumentsArray().forEach(this.checkBackupDriveDoc)}},{key:"backupDrive",value:function(){var e=s()(a.a.mark((function e(){return a.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(ae.getDocumentsArray().map(this.backupDocumentDrive)));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupAuto",value:function(){var e=s()(a.a.mark((function e(){return a.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(ae.getDocumentsArray().map(this.backupDocumentAuto)));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupAll",value:function(){var e=s()(a.a.mark((function e(){return a.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.backupAuto(),this.backupDrive()]));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupDocumentAll",value:function(){var e=s()(a.a.mark((function e(t){return a.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.backupDocumentAuto(t),this.backupDocumentDrive(t)]));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentStorage",value:function(){var e=s()(a.a.mark((function e(t){var n,r,i;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(t.isLocalOnly()){e.next=22;break}return n=Date.now(),r=this.getCloudBackupFilename(t,n),e.next=5,t.toJSON({includeNotes:!0,encrypt:!0});case 5:return i=e.sent,e.prev=6,e.next=9,T.default.cloudStorage.uploadString(r,i);case 9:if(!e.sent){e.next=17;break}return t.addBackup(n),e.next=14,Z.a.getAPIForDocument(t);case 14:e.sent.addBackup(n),this.setNeedsBackup(t,!1);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),D.default.reportError(e.t0);case 22:case"end":return e.stop()}}}),e,this,[[6,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentAuto",value:function(){var e=s()(a.a.mark((function e(t){var n=this;return a.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return Q.a.isNativeApp()&&T.default.settings.backupLocal.get()&&t.toJSON({includeNotes:!0,encrypt:T.default.settings.encryptLocalFiles.get()}).then((function(e){var r=(new Date).toString("yy-MM-dd h-mm tt"),i=t.text.get()+" "+r+".json";T.default.ElectronBridge.saveBackup(i,e,(function(e){e?D.default.reportError(e,"Backup error"):t.isLocalOnly()&&n.setNeedsBackup(t,!1)}))})),e.abrupt("return",this.backupDocumentStorage(t));case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentDrive",value:function(){var e=s()(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!(T.default.settings.backupFrequency.get()>0)||t.isLocalOnly()){e.next=6;break}if(!(n=T.default.pluginManager.getPluginDrive().getSyncAccounts()[0])){e.next=5;break}return e.next=5,t.toJSON({includeNotes:!0,encrypt:!1}).then((function(e){var r=new Blob([e],{type:"application/json"}),i=(new Date).toString("yy/MM/dd h:mm tt");return r.name=t.text.get()+" "+i,new Promise((function(e){new J.a(r,n,{named:E.a.DriveFolder.Backup},{docId:t.id},(function(){}),(function(){var n=T.default.settings.backupsDrive.get();n&&D.default.isObject(n)||(n={}),T.default.settings.backupsDrive.set(Object.assign({},n,m()({},t.id,Date.now()))),e()}),(function(t){D.default.reportError(t,"Backup error"),e()})).upload()}))}));case 5:delete this.needsBackupDrive[t.id];case 6:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"downloadBackup",value:function(){var e=s()(a.a.mark((function e(t,n){var r,i;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return r=this.getCloudBackupFilename(t,n),e.next=3,T.default.cloudStorage.getString(r);case 3:if(!(i=e.sent)){e.next=12;break}return e.prev=5,e.abrupt("return",JSON.parse(i));case 9:e.prev=9,e.t0=e.catch(5),D.default.reportError(e.t0);case 12:case"end":return e.stop()}}}),e,this,[[5,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCloudBackupFilename",value:function(e,t){return"users/".concat(p.a.getUid(),"/documents/").concat(e.id,"/").concat(t,".json")}},{key:"isDriveBackupAuthorized",value:function(){return $.a.getDefaultAccountID()&&$.a.isAuthorizedForScopes($.a.getDefaultAccountID(),[E.a.GScope.Drive])}},{key:"authorize",value:function(e){$.a.getDefaultAccountID()?$.a.authAccount($.a.getDefaultAccountID(),[E.a.GScope.Drive],(function(t){e(t)})):e(void 0)}},{key:"enable",value:function(){var e=this;this.authorize((function(t){t&&(T.default.settings.backupFrequency.set(E.a.DefaultBackupFrequency),e.backupDrive())}))}},{key:"getLastBackup",value:function(){return ae.getDocumentsArray().reduce((function(e,t){return Math.max(e,t.getLastBackup())}),0)}}]),e}(),f()(G.prototype,"onTimeChanged",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"onTimeChanged"),G.prototype),f()(G.prototype,"checkBackup",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackup"),G.prototype),f()(G.prototype,"checkBackupAutoDoc",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackupAutoDoc"),G.prototype),f()(G.prototype,"checkBackupAuto",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackupAuto"),G.prototype),f()(G.prototype,"checkBackupDriveDoc",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackupDriveDoc"),G.prototype),f()(G.prototype,"checkBackupDrive",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackupDrive"),G.prototype),f()(G.prototype,"backupDocumentStorage",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"backupDocumentStorage"),G.prototype),f()(G.prototype,"backupDocumentAuto",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"backupDocumentAuto"),G.prototype),f()(G.prototype,"backupDocumentDrive",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"backupDocumentDrive"),G.prototype),G),ne=n(32),re=n(82),ie=(K=function(){function e(){l()(this,e),this.isLoaded=new j.a(!1),this._isRemoteEnabled=!D.default.isDemoMode(),this._documentsById={},this._itemCache={},this.documentsArray=new ne.a,this.documentsEncryptedArray=new ne.a,this.documentsDeletedArray=new ne.a,this._sources=[],this.settingProvider=D.default.isDemoMode()?V:Z.a,this._idProvider=this.settingProvider.generateId,this.loadState=Z.a.loadState,this.onlineStatus=new j.a(p.a.isOnline()?"Connecting":"Offline"),this.isLoadedLocal=new j.a(!1),this.isLoadedRemote=new j.a(!1),this.loadProgress=new j.a,D.default.isDemoMode()?this._sources=[V]:(this._sources.push(Z.a),Q.a.supportLocalFiles()&&this._sources.push(Y))}return d()(e,[{key:"init",value:function(){this._emptyDocument=this.createEmptyDocument("Empty",V),window.__clearLocalData=this.clearLocalData}},{key:"loadLocal",value:function(e){var t=this;this._cbOnLoad=e,this._sourcesWaiting=this._sources.length,this._sources.forEach((function(e){return e.init(t.onSourceLoaded,t.onSourceDocumentsChanged)})),this._isRemoteEnabled&&te.init(),D.default.registerEvent("ItemCreated","ItemAction","Create"),D.default.registerEvent("ItemCompleted","ItemAction","Complete"),this.isLoadedLocal.set(!0)}},{key:"onSourceLoaded",value:function(e){var t=this;T.default.crypto.onLoad((function(){if(t._sourcesWaiting--,e.forEach((function(e){e.canDecrypt()&&(t._documentsById[e.id]=e,t.documentsArray.includes(e)||t.documentsArray.push(e,!1))})),0===t._sourcesWaiting){var n=t.documentsArray.get().filter((function(e){return void 0===e.index}));n.length>0&&((n=n.sort((function(e,t){return t.dateModified.get()-e.dateModified.get()}))).forEach((function(e,t){return e.setIndex(t+"")})),t.documentsArray.set(n,!1)),t.documentsArray.sort(R.a.compareItemIndex),void 0!==T.default.settings.lastSync.get()&&T.default.PaneManager.loadInitialState(),t.isLoaded.set(!0),setTimeout((function(){return T.default.timeline.updateNotifications()}),1e3),t._cbOnLoad&&t._cbOnLoad(e)}}))}},{key:"onSourceDocumentsChanged",value:function(e){var t=this,n=e.documents,r=e.documentsEncrypted,i=e.documentsDeleted,a=this.documentsArray.get();Object.keys(n).forEach((function(e){var r=n[e];t._documentsById[r.id]&&a.includes(r)?r.canDecrypt()||a.remove(r):r.canDecrypt()&&(t._documentsById[r.id]=r,a.push(r))})),(a=a.filter((function(e){return e.canDecrypt()}))).sort(R.a.compareItemIndex),this.documentsArray.set(a),r&&this.documentsEncryptedArray.set(D.default.objectToArray(r)),i&&this.documentsDeletedArray.set(D.default.objectToArray(i)),this.isLoadedRemote.set(!0)}},{key:"getDefaultBacking",value:function(){return this._sources[0]}},{key:"getDocumentById",value:function(e){return this._documentsById[e]}},{key:"getDefaultDocument",value:function(){var e=this.documentsArray.get().find((function(e){return!e.isDeleted.get()}));return e||this.addEmptyDocument("My First Document",this.getDefaultBacking())}},{key:"getDocumentsArray",value:function(e){var t=this.documentsArray.get();return e||(t=t.filter((function(e){return!e.isDeleted.get()}))),t}},{key:"getDeletedDocuments",value:function(){return this.documentsArray.get().filter((function(e){return e.isDeleted.get()}))}},{key:"hasDocuments",value:function(){return this.getDocumentsArray().length>0}},{key:"runOnAllDocuments",value:function(e){this.getDocumentsArray().forEach((function(t){return e(t)}))}},{key:"parseAll",value:function(e){this.runOnAllDocuments((function(t){t.parseAll(e)}))}},{key:"runOnAllDocumentRoots",value:function(e){this.getDocumentsArray().forEach((function(t){return e(t.getRootItem())}))}},{key:"getItemDataLocal",value:function(e,t){return e.getBacking().getItemData(t)}},{key:"getDocumentBacking",value:function(e){return e.getBacking()}},{key:"getItemBacking",value:function(e){var t=e.getDocumentOwner();try{D.default.PAssert(257,t,"Item document must exist")}catch(n){D.default.reportError(n)}return t.getBacking()}},{key:"_getPreviousState",value:function(e,t){try{D.default.PAssert(258,e.getDocumentOwner(),"Missing document owner",e.getRawText())}catch(i){D.default.reportError(i)}var n=e.getDocumentOwner().getBacking().getItemData(e.id),r={};return n&&Object.keys(t).forEach((function(e){r[e]=n[e]})),r}},{key:"saveItem",value:function(e,t,n,r,i){var a=e.parent()||e.isRoot;try{D.default.PAssert(259,a,"Item must have parent unless root")}catch(s){D.default.reportError(s)}if(a&&(e.index||e.isNote()||(this.updateItemIndex(e),t.index=e.index),t.id=e.id,D.default.isLocalChange(n)&&X.a.pushModified(e,t,this._getPreviousState(e,t)),e.shouldSave())){var o=e.getDocumentOwner();o.getBacking().saveItem(o,e,D.default.clone(t),n,r),D.default.isDemoMode()||te.onDataSaved(o)}}},{key:"updateItemIndex",value:function(e){var t=e.parent();if(!e.isNote())if(t&&t.items.length()>1){var n=t.items.get(),r=n.indexOf(e),i=!e.isNote()&&r>0?n[r-1]:null,a=!e.isNote()&&r<n.length-1?n[r+1]:null;0,e.index=Object(re.a)(i?i.index:null,a?a.index:null)}else e.index="0"}},{key:"addItem",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!r){this.updateItemIndex(t),X.a.pushAdded(e,t);var i=t.getDocumentOwner();i.getBacking().addItem(i,t)}}},{key:"deleteItem",value:function(e,t,n){if(D.default.isLocalChange(n)){X.a.pushRemoved(e,t);var r=t.getDocumentOwner();r.getBacking().deleteItem(r,t,n)}}},{key:"moveItem",value:function(e,t,n,r){if(this.updateItemIndex(e),D.default.isLocalChange(r)){var i=e.getDocumentOwner(),a={parent:e.parent().id,index:e.index},o={parent:t.id,index:n};X.a.pushModified(e,a,o),i.getBacking().moveItem(e,t)}}},{key:"setNote",value:function(e,t,n,r){var i=e.getDocumentOwner();i.getBacking().setNote(i,e,t,n,r)}},{key:"generateID",value:function(){return this._idProvider()}},{key:"getEmptyDocument",value:function(){return this._emptyDocument}},{key:"addDocument",value:function(e){e.createVMLIs();var t=e.getBacking().addDocument(e);this._documentsById[e.id]=e;var n=this.documentsArray.get()[0];if(n){var r=Object(re.a)(null,n.index);e.setIndex(r)}else e.setIndex("0");return this.documentsArray.splice(0,0,e,!1),t}},{key:"createEmptyDocument",value:function(e,t){t=t||this.getDefaultBacking();var n={id:this.generateID(),isRoot:!0,text:"Root",items:[{id:this.generateID(),text:""}]},r=N.a.create({text:e,rootData:n,backing:t});return r.createVMLIs(),r}},{key:"addEmptyDocument",value:function(e,t){var n=this.createEmptyDocument(e,t);return this.addDocument(n),n}},{key:"saveDocument",value:function(e){e.getBacking().saveDocument(e)}},{key:"renameDocument",value:function(e,t){e.setText(t),this.saveDocument(e)}},{key:"removeDocument",value:function(e){this.documentsArray.remove(e)}},{key:"moveDocument",value:function(e,t){var n=this.documentsArray.get(),r=n.map((function(e){return e.id})),i=n.indexOf(e);D.default.arrayMove(n,t,i);var a=n.map((function(e){return e.id}));if(!r.equals(a)){var o=this.documentsArray.get(),s=n.indexOf(e),u=s>=1&&o[s-1],l=s<o.length-1&&o[s+1],c=Object(re.a)(null===u||void 0===u?void 0:u.index,null===l||void 0===l?void 0:l.index);e.setIndex(c),this.documentsArray.notify()}}},{key:"setSetting",value:function(e,t,n,r){n?this.settingProvider.setSetting(e,t,r):P.a.setSetting(e,{v:t})}},{key:"saveBoard",value:function(e,t){this.settingProvider.saveBoard(e,t)}},{key:"deleteBoard",value:function(e){return this.settingProvider.deleteBoard(e)}},{key:"getBoards",value:function(){return this.settingProvider.getBoards()}},{key:"setItem",value:function(e){this._itemCache[e.id]=e}},{key:"getItem",value:function(e){return this._itemCache[e]}},{key:"clearItem",value:function(e){delete this._itemCache[e]}},{key:"createVMLI",value:function(e,t){return T.default.itemStoreManager.getDefaultItemStore().createItemRaw(e,t)}},{key:"createTempVMLI",value:function(e,t){return t.noSave=!0,t.canDestroy=!0,t.isTemp=!0,e.id||(e.id=this.generateID()),T.default.itemStoreManager.getTempItemStore().createItemRaw(e,t)}},{key:"destroyTempVMLI",value:function(e){T.default.itemStoreManager.getTempItemStore().destroyItem(e)}},{key:"clearLocalData",value:function(){var e=s()(a.a.mark((function e(){return a.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return C.a.clear(),e.next=3,P.a.clearAllData();case 3:setTimeout((function(){D.default.reload()}),0);case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"hasPendingRemoteUpdates",value:function(){return Object.keys(Z.a.itemsPending).length>0}},{key:"isConnected",value:function(){return"Online"===this.onlineStatus.get()}},{key:"onConnectedPromise",value:function(){var e=s()(a.a.mark((function e(){var t=this;return a.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.isConnected()?Promise.resolve():new Promise((function(e){t.onlineStatus.onValue("Online",(function(){return e()}))})));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"__clearAllData",value:function(){confirm("Are you sure you want to clear everything?")&&(C.a.clear(),Promise.all(this._sources.map((function(e){return e.clearAllData()}))).then((function(){D.default.reload()})))}},{key:"getBackingRemote",value:function(){return D.default.isDemoMode()?V:Z.a}},{key:"getBackingLocal",value:function(){return Q.a.supportLocalFiles()?Y:void 0}},{key:"onlineText",value:function(){var e=this.onlineStatus.get();return D.default.isDemoMode()?"DEMO":e}},{key:"setLoadProgress",value:function(e){this.loadProgress.set(e)}}]),e}(),f()(K.prototype,"onSourceLoaded",[g.a],Object.getOwnPropertyDescriptor(K.prototype,"onSourceLoaded"),K.prototype),f()(K.prototype,"onSourceDocumentsChanged",[g.a],Object.getOwnPropertyDescriptor(K.prototype,"onSourceDocumentsChanged"),K.prototype),f()(K.prototype,"clearLocalData",[g.a],Object.getOwnPropertyDescriptor(K.prototype,"clearLocalData"),K.prototype),f()(K.prototype,"__clearAllData",[g.a],Object.getOwnPropertyDescriptor(K.prototype,"__clearAllData"),K.prototype),K),ae=t.a=new ie},function(e,t,n){var r=n(114);function i(t,n,a){return"undefined"!==typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}},i(t,n,a||t)}e.exports=i},function(e,t,n){var r=n(115);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(39),i=n(42);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?i(e):t}},function(e,t,n){"use strict";var r,i=n(3),a=n.n(i),o=n(10),s=n.n(o),u=n(33),l=n.n(u),c=n(5),d=n.n(c),h=n(6),f=n.n(h),p=n(17),g=n.n(p),v=n(18),m=n.n(v),y=n(19),_=n.n(y),b=n(11),w=n.n(b),k=n(0),S=n(7),E=n.n(S),P=n(2),I=n(36),D=n(8),T=n(1),x=n(12),C=n(25),A=n(69),L=n(50),O=(r=function(){function e(){d()(this,e),this.documentsPreloaded=[],this.dataCache={settings:{},items:{},documents:{},boards:{},contacts:[],localStorage:{},user:{},pluginsNew:{}}}return f()(e,[{key:"init",value:function(e,t){this._backing=e,this.cbOnLoad=t,this.onDataReady()}},{key:"transformFieldsDocument",value:function(e){var t=k.default.clone(e);return k.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.archivedItems,delete t.deletedItems,t=C.a.documentOut(t,{forLocal:!0})}},{key:"transformFieldsItem",value:function(e){var t=k.default.clone(e);return k.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.noteItem,delete t.archivedItems,delete t.deletedItems,C.a.itemOut(t)}},{key:"getItemData",value:function(e,t){return this.dataCache.items[e]}},{key:"getDocumentData",value:function(e){return this.dataCache.documents[e]}},{key:"getSetting",value:function(e){return this.dataCache.settings[e]}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"getBoard",value:function(e){return this.dataCache.boards[e]}},{key:"getContacts",value:function(){return this.dataCache.contacts}},{key:"saveDocument",value:function(e,t){var n=e.getSaveInfo();t&&(n=Object.assign(n,t)),k.default.deepEqual(this.dataCache.documents[e.id],n,!0,["rootData"])||(this.dataCache.documents[e.id]=n,this._saveDocumentDataToDB(C.a.documentOut(n,{forLocal:!0})))}},{key:"setSetting",value:function(e,t){this.dataCache.settings[e]=t}},{key:"saveSettings",value:function(e){Object.assign(this.dataCache.settings,e)}},{key:"saveBoard",value:function(e){this.dataCache.boards[e.id]=Object.assign(this.dataCache.boards[e.id]||{},e)}},{key:"saveContacts",value:function(e,t){this.dataCache.contacts=e}},{key:"clearContacts",value:function(){this.dataCache.contacts=[]}},{key:"cacheItem",value:function(e){this.dataCache.items[e.id]=e}},{key:"saveItem",value:function(e,t,n){t||delete e.dateModified;var r=this.dataCache.items[e.id];if(r)e.docId=e.docId||r.docId,e.docId||n&&(e.docId=n.getDocumentOwner().id),Object.assign(r,e);else if(n){var i=n.getFullSaveData(),a=n.getItems().map((function(e){return e.getFullSaveData()}));r=Object.assign(i,{items:a})}else 0;try{k.default.PAssert(260,r.id,"Saved item must have id")}catch(u){k.default.reportError(u)}try{k.default.PAssert(261,r.isDeleted||r.isRoot||r.parent,"Saved item must have parent or be root")}catch(u){k.default.reportError(u)}try{k.default.PAssert(262,r.docId,"Saved item must have docId")}catch(u){k.default.reportError(u)}if((!r.docId||!r.isRoot&&!r.parent)&&n){var o=n.getItems().map((function(e){return e.getFullSaveData()}));r=Object.assign(n.getFullSaveData(),{items:o},e);try{k.default.PAssert(263,r.isRoot||r.parent,"Saved item had root or parent overridden")}catch(u){k.default.reportError(u)}try{k.default.PAssert(264,r.docId,"Saved item had docId overridden")}catch(u){k.default.reportError(u)}}this.dataCache.items[r.id]=r;var s=this.transformFieldsItem(r);this._saveItemDataToDB(s)}},{key:"deleteItem",value:function(e){var t=this.dataCache.items[e.id];if(t){this.dataCache.items[t.id].isDeleted=!0,t.isDeleted=!0;var n=this.transformFieldsItem(t);this._saveItemDataToDB(n)}else{0,e.isDeleted=!0;var r=this.transformFieldsItem(e);this._saveItemDataToDB(r)}}},{key:"deleteBoard",value:function(e){delete this.dataCache.boards[e]}},{key:"deleteDocument",value:function(e){var t=this;e.getAllItems().forEach((function(e){delete t.dataCache.items[e.id]})),delete this.dataCache.documents[e.id]}},{key:"deleteSettings",value:function(e){var t=this;Object.keys(e).forEach((function(e){delete t.dataCache.settings[e]}))}},{key:"clearAllData",value:function(){var e=s()(a.a.mark((function e(){return a.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureMirror",value:function(){var e=s()(a.a.mark((function e(t,n){var r,i,o,s,u,l,c,d,h,f,p=0,g=arguments;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:r=g.length>2&&void 0!==g[2]&&g[2],i=[],o=[],s=!this.TEST_DOC_ID,u=t.length>0&&!!t[0].id,l=0;case 7:if(!(l<t.length)){e.next=17;break}if(!(p++>5e3&&__infLoop&&__infLoop(p))){e.next=10;break}throw new RangeError;case 10:if(c=u?t[l]:t[l].value,d=u?"load":t[l].type,h=this.dataCache.items[c.id],"Removed"===d)o.push(c.id);else if(!h||!this.areObjectsEqual(c,h)){r&&!s&&console.log("THIS IS BAD, document mismatch"),f=Object.assign(h||{},c),n&&delete f.pendingSync;try{k.default.PAssert(265,f.id,"Saved item must have id")}catch(v){k.default.reportError(v)}try{k.default.PAssert(266,f.isDeleted||f.isRoot||f.parent,"Saved item must have parent or be root")}catch(v){k.default.reportError(v)}try{k.default.PAssert(267,f.docId,"Saved item must have docId")}catch(v){k.default.reportError(v)}void 0!==f.text&&f.date&&!f.text.includes(T.a.CharDate)&&delete f.date,this.dataCache.items[c.id]=f,i.push(f)}case 14:l++,e.next=7;break;case 17:return e.abrupt("return",this.bulkSave(i,o));case 18:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"areObjectsEqual",value:function(e,t){return delete(t=Object.assign({},t)).items,delete t.archivedItems,delete t.deletedItems,delete(e=Object.assign({},e)).items,delete e.archivedItems,delete e.deletedItems,e.parent===t.parent&&(delete e.parent,delete t.parent,k.default.deepEqual(e,t))}},{key:"onDataReady",value:function(){this.dataCache.settings&&P.default.settings.load(this.dataCache.settings,!1,!1),this.dataCache.contacts&&L.a.loadContacts(),this.fireLocalLoaded()}},{key:"fireLocalLoaded",value:function(){var e=this;I.a.onActiveUser((function(){try{k.default.PAssert(268,e.dataCache.documents,"Must be documents in cache at this point")}catch(i){k.default.reportError(i)}if(e.dataCache.documents){var t=k.default.objectValues(e.dataCache.documents),n=k.default.filterWithNonMatches(t,e.checkDocHasRoot);if(n.fail.length>0&&(console.log("Failed docs",n.fail),n.fail.forEach((function(t){delete e.dataCache.documents[t.id]}))),t=n.match.map((function(t){var n=e.dataCache.items[t.root];t.rootData=n;var r=A.a.fromData(t,e._backing);return r.createVMLIs(),r})),e.cbOnLoad){var r={documentsPending:e.dataCache.documentsPending,itemsPending:e.dataCache.itemsPending,settingsPending:e.dataCache.settingsPending,boardsPending:e.dataCache.boardsPending,isPreload:e.isPreload};e.cbOnLoad(t,r)}e.isPreload?e.documentsPreloaded=t:e.cbOnLoad=void 0}}))}},{key:"checkDocHasRoot",value:function(e){return!!this.dataCache.items[e.root]}},{key:"getLegacyLocalStorage",value:function(e){return this.dataCache.localStorage[e]}},{key:"setLegacyLocalStorage",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"deleteLegacyLocalStorage",value:function(e){delete this.dataCache.localStorage[e]}},{key:"getValue",value:function(e){return this.dataCache.localStorage[e]}},{key:"setValue",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"deleteValue",value:function(e){delete this.dataCache.localStorage[e]}},{key:"onPreload",value:function(e,t){if(e&&e.error){try{k.default.PAssert(269,"OpenFailedError"===e.error.name,"Unknown error in Dexie",e.error)}catch(n){k.default.reportError(n)}x.a.blockedReason&&x.a.blockedReason.set("Moo.do cannot run because it is unable to access data storage in your browser. This could be because you are in Private mode, you have disabled history, or your hard drive is full. Please try Moo.do in a normal browsing session or download the app.")}else{try{["Gmail","GmailMessages","plugins"].forEach((function(t){e[t]&&"string"===typeof e[t]&&(e[t]=JSON.parse(e[t]))}))}catch(r){}this.dataCache=e}t()}},{key:"saveEncryptionKey",value:function(e,t){}},{key:"bulkSave",value:function(){var e=s()(a.a.mark((function e(t,n){var r,i=this;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return n&&n.length>0&&n.forEach((function(e){delete i.dataCache.items[e]})),t.forEach((function(e){i.dataCache.items[e.id]=e})),r=t.map(this.transformFieldsItem),e.abrupt("return",this._bulkSaveItems(r,n));case 5:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getItemsMap",value:function(){return this.dataCache.items}},{key:"getAllPluginsNew",value:function(){return this.dataCache.pluginsNew}},{key:"savePluginNew",value:function(e){this.dataCache.pluginsNew[e.id]=e}},{key:"getPluginNew",value:function(e){return this.dataCache.pluginsNew[e]}},{key:"deletePluginNew",value:function(e){delete this.dataCache.pluginsNew[e]}},{key:"savePluginUsage",value:function(e,t){this.dataCache.plugins[e]||(this.dataCache.plugins[e]={}),this.dataCache.plugins[e][t.id]=t}},{key:"getPluginTableUsage",value:function(e){return this.dataCache.plugins[e]}},{key:"getPluginUsage",value:function(e,t){if(this.dataCache.plugins[e])return this.dataCache.plugins[e][t]}},{key:"deletePluginUsage",value:function(e,t){this.dataCache.plugins[e]&&delete this.dataCache.plugins[e][t]}},{key:"getTableData",value:function(e){return this.dataCache[e]}},{key:"getTableValue",value:function(e,t){var n=this.getTableData(e);if(n){var r=n[t];if(void 0!==r)return r}}},{key:"setTableValue",value:function(e,t,n){var r=this.getTableData(e);r&&(r[t]=n),this.tablePut(e,n)}},{key:"ensureTableLoaded",value:function(){var e=s()(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return n(),e.abrupt("return",!0);case 2:case"end":return e.stop()}}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"beginBatch",value:function(){}},{key:"commitBatch",value:function(){}}]),e}(),E()(r.prototype,"checkDocHasRoot",[D.a],Object.getOwnPropertyDescriptor(r.prototype,"checkDocHasRoot"),r.prototype),r),M=n(66);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=0,n=1;n<arguments.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=null!=arguments[n]?arguments[n]:{};n%2?R(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var i=w()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _()(this,n)}}var j=function(e){m()(n,e);var t=N(n);function n(){var e;return d()(this,n),(e=t.call(this)).TEST_DOC_ID="",e.canWrite=!k.default.isDemoMode(),e.clearOldDatabases(),e}return f()(n,[{key:"clearOldDatabases",value:function(){window.indexedDB&&(this.deleteDatabase("Drive"),this.deleteDatabase("GCalendar"),this.deleteDatabase("Gmail"),this.deleteDatabase("Gmail_RawCache"),this.deleteDatabase("QuickAdd"))}},{key:"deleteDatabase",value:function(e){this.canWrite&&window.indexedDB.deleteDatabase(e)}},{key:"preload",value:function(e){var t=this;if(this.canWrite){this.db=M.a.createDB();var n=window.__preload;n?n.data?this.onPreload(n.data,e):n.worker.onmessage=function(n){t.onPreload(n.data,e)}:M.a.load(this.db,(function(n){t.onPreload(n,e)}))}}},{key:"_saveItemDataToDB",value:function(e){this.canWrite&&this.db.items.put(e)}},{key:"_deleteItemData",value:function(e){this.canWrite&&this.db.items.delete(e)}},{key:"_saveDocumentDataToDB",value:function(e){this.canWrite&&this.db.documents.put(e)}},{key:"setSetting",value:function(e,t){g()(w()(n.prototype),"setSetting",this).call(this,e,t),this.canWrite&&(null!=t&&void 0!==t?this.db.settings.put(F({id:e},t)):this.db.settings.delete(e))}},{key:"deleteSettings",value:function(e){var t=this;g()(w()(n.prototype),"deleteSettings",this).call(this,e),this.canWrite&&Object.keys(e).forEach((function(e){return t.db.settings.delete(e)}))}},{key:"saveSettings",value:function(e){g()(w()(n.prototype),"saveSettings",this).call(this,e);var t=Object.keys(e).map((function(t){return F({id:t},e[t])}));this.canWrite&&this.db.settings.bulkPut(t)}},{key:"saveBoard",value:function(e){if(g()(w()(n.prototype),"saveBoard",this).call(this,e),this.canWrite){var t=C.a.boardOut(e);this.db.boards.put(t)}}},{key:"deleteBoard",value:function(e){g()(w()(n.prototype),"deleteBoard",this).call(this,e),this.canWrite&&this.db.boards.delete(e)}},{key:"deleteDocument",value:function(e){var t=this;g()(w()(n.prototype),"deleteDocument",this).call(this,e),this.canWrite&&(e.getAllItems().forEach((function(e){t.db.items.delete(e.id)})),this.db.documents.delete(e.id))}},{key:"saveContacts",value:function(e,t){if(g()(w()(n.prototype),"saveContacts",this).call(this,e,t),this.canWrite){var r=t.map((function(e){return C.a.contactOut(e)}));this.db.contacts.bulkPut(r)}}},{key:"clearContacts",value:function(){g()(w()(n.prototype),"clearContacts",this).call(this),this.canWrite&&this.db.contacts.clear()}},{key:"_bulkSaveItems",value:function(){var e=s()(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(r=[],n&&n.length>0&&r.push(this.db.items.bulkDelete(n)),t.length>0&&this.canWrite&&r.push(this.db.items.bulkPut(t)),!(r.length>0)){e.next=5;break}return e.abrupt("return",Promise.all(r));case 5:return e.abrupt("return",Promise.resolve());case 6:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getLegacyLocalStorage",value:function(e){var t=g()(w()(n.prototype),"getLegacyLocalStorage",this).call(this,e);return t||(t=localStorage.getItem(e))&&g()(w()(n.prototype),"setLegacyLocalStorage",this).call(this,e,t),t}},{key:"setLegacyLocalStorage",value:function(e,t){g()(w()(n.prototype),"setLegacyLocalStorage",this).call(this,e,t),k.default.isString(t)||(t=JSON.stringify(t)),localStorage.setItem(e,t)}},{key:"deleteLegacyLocalStorage",value:function(e){g()(w()(n.prototype),"deleteLegacyLocalStorage",this).call(this,e),localStorage.removeItem(e)}},{key:"setValue",value:function(e,t){if(this.canWrite){var r=this.getValue(e);r===t||k.default.deepEqual(r,t)||(g()(w()(n.prototype),"setValue",this).call(this,e,t),this.db.localStorage.put({id:e,value:t}))}}},{key:"clearAllData",value:function(){var e=s()(a.a.mark((function e(){return a.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.canWrite){e.next=3;break}return this.canWrite=!1,e.abrupt("return",Promise.all(this.db.tables.map((function(e){return e.clear()}))));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deletePluginUsage",value:function(e,t){g()(w()(n.prototype),"deletePluginUsage",this).call(this,e,t),this.canWrite&&this.db.plugins.delete(t)}},{key:"savePluginUsage",value:function(e,t){g()(w()(n.prototype),"savePluginUsage",this).call(this,e,t),this.canWrite&&this.db.plugins.put(t)}},{key:"savePluginNew",value:function(e){g()(w()(n.prototype),"savePluginNew",this).call(this,e),this.canWrite&&this.db.pluginsNew.put(e)}},{key:"deletePluginNew",value:function(e){g()(w()(n.prototype),"deletePluginNew",this).call(this,e),this.canWrite&&this.db.pluginsNew.delete(e)}},{key:"tablePut",value:function(e,t){if(this.canWrite)return this.db[e].put(t)}},{key:"tableClear",value:function(e){if(this.canWrite)return this.db[e].clear()}},{key:"tableFilter",value:function(e,t){if(this.canWrite)return this.db[e].filter(t).toArray()}},{key:"tableGet",value:function(e,t){if(this.canWrite)return this.db[e].get(t)}},{key:"tableDelete",value:function(e,t){if(this.canWrite)return this.db[e].delete(t)}}]),n}(O);t.a=new j},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(18),u=n.n(s),l=n(19),c=n.n(l),d=n(11),h=n.n(d),f=function(){function e(){i()(this,e),this.storage={getItem:function(){console.log("refactor this")},setItem:function(){console.log("refactor this")}}}return o()(e,[{key:"extendPrototype",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.prototype[n]=t[n])}},{key:"extendClass",value:function(e,t,n){for(var r=0,i=Object.getOwnPropertyNames(t.prototype),a=0;a<i.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i[a];n&&e[o]||(e.prototype[o]=t.prototype[o])}}},{key:"defineBase",value:function(e){e.prototype.constructor=e}},{key:"extend",value:function(e,t,n,r){if(t)for(var i in t)if(t.hasOwnProperty(i)&&(!r||!e[i])){var a=t[i],o=n&&a&&a.bind?a.bind(e):a;e[i]=o}return e}},{key:"inherit",value:function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype}},{key:"binder",value:function(e){var t=0;for(var n=0;n<(arguments.length<=1?0:arguments.length-1);n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];e[r]=e[r].bind(e)}}},{key:"forceBind",value:function(e,t){var n=t[e].bind(t);return t[e]=n,n}}]),e}();function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c()(this,n)}}var g=n(1).a.URLPart;function v(e,t){e===g.Search?window.location.search=t:e===g.Hash&&(window.location.hash=t)}function m(e){return e===g.Search?window.location.search:e===g.Hash?window.location.hash:void 0}function y(e){return"state"===e?g.Search:g.Hash}var _=function(e){u()(r,e);var t=p(r);function r(){return i()(this,r),t.call(this)}return o()(r,[{key:"hasURLParam",value:function(e,t){var n=e+"=";return t&&(n+=t),m(y(e)).indexOf(n)>=0}},{key:"getURLParam",value:function(e,t){var r=t||y(e);if(r===g.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp('[\\?&]" + key + "=([^&#]*)').exec(window.location.href);return null===i?void 0:decodeURIComponent(i[1].replace(/\+/g," "))}if(r!==g.Hash)n(0).default.log("Invalid URL part");else for(var a,o=0,s=m(g.Hash).substring(1),u=/([^&=]+)=([^&]*)/g;a=u.exec(s);){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(decodeURIComponent(a[1])===e)return decodeURIComponent(a[2])}}},{key:"insertURLParam",value:function(e,t,n){var r=0;e=encodeURIComponent(e),t=encodeURIComponent(t);for(var i=y(e),a=m(i).substr(1).split("&"),o=a.length-1;o>=0;o--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a[o].split("=");if(s[0]==e){s[1]=t,a[o]=s.join("=");break}}o<0&&(a[a.length]=[e,t].join("=")),v(i,a.join("&")),i!==g.Hash||n||window.location.reload()}},{key:"removeURLParam",value:function(e,t){for(var n=0,r=y(e=encodeURIComponent(e)),i=m(r).substr(1).split("&"),a=i.length-1;a>=0;a--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i[a].split("=")[0]==e){i.splice(a,1),v(r,i.join("&")),r!==g.Hash||t||window.location.reload();break}}}},{key:"genPromise",value:function(e){e.then=function(e,t,n){},e.execute=function(e,t,n){}}}]),r}(f);t.a=new _},function(e,t,n){"use strict";var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(7),l=n.n(u),c=n(8),d=n(88),h=n.n(d),f=n(1),p=(n(37),n(0)),g=n(28),v=n(2),m=n(54),y=n(23),_=n(13),b=(r=function(){function e(){a()(this,e),this.todayObs=new _.a(this.today),this.resetToday(),y.a.listen("beforeDateChanged",this.resetToday)}return s()(e,[{key:"parseDate",value:function(e){return new Date(e)}},{key:"parseText",value:function(e){var t,n=(e=e.toLowerCase()).substring(e.indexOf("every")),r=e.includes("every")&&g.b.parseText(n,void 0);if(r){try{p.default.PAssert(925,!(r.options.interval<0),"Interval set to negative",e)}catch(k){p.default.reportError(k)}var i=r.options,a=r.fromDate,o=r.duration;a||(a=new Date,a=this.toUTCDate(a));var s=Object.assign({dtstart:a},i);delete s.interval;var u=new g.b(s).after(a,!0);if(u){u=this.UTCtoLocal(u);var l=i.byhour?i.byhour[0]:0,c=i.byminute?i.byminute[0]:0;u.setHours(l),u.setMinutes(c),u.setSeconds(0),u.setMilliseconds(0),u=new Date(this.toUTCDate(u).getTime()),i.dtstart=u,i.until&&(i.until=new Date(u.getTime()+i.until.getTime()-a.getTime())),t=m.a.fromRRuleOptions(i,o?o*f.a.MSPerMinute:void 0)}}else{var d=e.replace(/\./g,"/"),y=h.a.parse(d,void 0,{forwardDate:!0})[0];if(y){var _=v.default.International.parseDate(y.text,v.default.settings.dateFormat.get());if(_){var b,w=e.substring(y.index+y.text.length).trim().match(g.f.tokens.duration);w&&(b=Math.round(+w[1]*("h"===w[2][0]?f.a.MSPerHour:f.a.MSPerMinute))),t=new m.a(_,{duration:b})}}}return t}},{key:"toUTCDate",value:function(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()))}},{key:"UTCtoLocal",value:function(e){return new Date(e.getTime()+e.getTimezoneOffset()*f.a.MSPerMinute)}},{key:"toHumanText",value:function(e,t){if(!e)return"";var n=+this.clearTime(e)-this.todayTime,r="";return t||(n<0&&n>=-864e5?r="Yesterday":this.isToday(e)?r="Today":n>0&&n<1728e5&&(r="Tomorrow")),r||(r=this.getHumanText(e)),e.hasTimeOfDay()&&(r+=" "+this.getTimeText(e)),r}},{key:"resetToday",value:function(){this.today=Date.today(),this.todayTime=this.today.getTime(),this.datesCleared={},this.humanText={},this.timeText={},this.todayObs.set(this.today)}},{key:"getToday",value:function(){return this.today}},{key:"getTodayTime",value:function(){return this.todayTime}},{key:"isToday",value:function(e){try{p.default.PAssert(926,e&&p.default.isDateValid(e),"Date is invalid",e)}catch(n){p.default.reportError(n)}var t=+e;return t>=this.todayTime&&t<this.todayTime+f.a.MSPerDay}},{key:"_clearTime",value:function(e){return this.datesCleared[e]=new Date(e),this.datesCleared[e].setHours(0,0,0,0),this.datesCleared[e]}},{key:"clearTime",value:function(e){var t=+e;return this.datesCleared[t]||this._clearTime(t)}},{key:"clearTimeClone",value:function(e){return this.clearTime(e).clone()}},{key:"getTodayPlusDays",value:function(e){return this.getDatePlusDays(this.getToday(),e)}},{key:"getDatePlusDays",value:function(e,t){var n=+e+t*f.a.MSPerDay;return this.datesCleared[n]||(this.datesCleared[n]=new Date(n))}},{key:"getDatePlusMS",value:function(e,t){return new Date(+e+t)}},{key:"getTodayPlusMS",value:function(e){return this.getDatePlusMS(this.getToday(),e)}},{key:"isSameDay",value:function(e,t){return+this.clearTime(e)===+this.clearTime(t)}},{key:"getHumanText",value:function(e){var t=+e;return this.humanText[t]||(this.humanText[t]=e.toString(v.default.International.getFormat(e.getFullYear()!==this.today.getFullYear()?f.a.DFormat.MonthDayYear:f.a.DFormat.MonthDay))),this.humanText[t]}},{key:"getTimeText",value:function(e){var t=+e;return this.timeText[t]||(this.timeText[t]=e.toString("h:mmtt").toLowerCase())}},{key:"getNextRoundTime",value:function(e){var t=(null===e||void 0===e?void 0:e.clone())||new Date;return t.setHours(t.getHours()+1,0,0,0),t}},{key:"parseInternationalDate",value:function(e){return h.a.parseDate(e)}},{key:"testGetNext",value:function(e,t,n){}},{key:"testOnDate",value:function(e,t,n){}}]),e}(),l()(r.prototype,"resetToday",[c.a],Object.getOwnPropertyDescriptor(r.prototype,"resetToday"),r.prototype),l()(r.prototype,"_clearTime",[c.a],Object.getOwnPropertyDescriptor(r.prototype,"_clearTime"),r.prototype),r);t.a=new b},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(18),o=n.n(a),s=n(19),u=n.n(s),l=n(11),c=n.n(l);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c()(e);if(t){var i=c()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}var h=function(e){o()(n,e);var t=d(n);function n(){return i()(this,n),t.apply(this,arguments)}return n}(n(60).a);t.a=new h},function(e,t,n){const r=n(37);function i(e){e=e||{},this.ref=e.ref,this.index=e.index,this.text=e.text,this.tags=e.tags||{},this.start=new a(e.start,e.ref),e.end&&(this.end=new a(e.end,e.ref))}function a(e,t){if(this.knownValues={},this.impliedValues={},e)for(key in e)this.knownValues[key]=e[key];t&&(t=r(t),this.imply("day",t.date()),this.imply("month",t.month()+1),this.imply("year",t.year())),this.imply("hour",12),this.imply("minute",0),this.imply("second",0),this.imply("millisecond",0)}i.prototype.clone=function(){var e=new i(this);return e.tags=JSON.parse(JSON.stringify(this.tags)),e.start=this.start.clone(),this.end&&(e.end=this.end.clone()),e},i.prototype.date=function(){return this.start.date()},i.prototype.hasPossibleDates=function(){return this.start.isPossibleDate()&&(!this.end||this.end.isPossibleDate())},i.prototype.isOnlyWeekday=function(){return this.start.isOnlyWeekdayComponent()},i.prototype.isOnlyDayMonth=function(){return this.start.isOnlyDayMonthComponent()},a.prototype.clone=function(){var e=new a;return e.knownValues=JSON.parse(JSON.stringify(this.knownValues)),e.impliedValues=JSON.parse(JSON.stringify(this.impliedValues)),e},a.prototype.get=function(e,t){return e in this.knownValues?this.knownValues[e]:e in this.impliedValues?this.impliedValues[e]:void 0},a.prototype.assign=function(e,t){this.knownValues[e]=t,delete this.impliedValues[e]},a.prototype.imply=function(e,t){e in this.knownValues||(this.impliedValues[e]=t)},a.prototype.isCertain=function(e){return e in this.knownValues},a.prototype.isOnlyWeekdayComponent=function(){return this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")},a.prototype.isOnlyDayMonthComponent=function(){return this.isCertain("day")&&this.isCertain("month")&&!this.isCertain("year")},a.prototype.isPossibleDate=function(){var e=this.dayjs();if(this.isCertain("timezoneOffset")){const t=this.get("timezoneOffset")-e.utcOffset();e=e.add(t,"minutes")}return e.get("year")==this.get("year")&&(e.get("month")==this.get("month")-1&&(e.get("date")==this.get("day")&&(e.get("hour")==this.get("hour")&&e.get("minute")==this.get("minute"))))},a.prototype.date=function(){return this.dayjs().toDate()},a.prototype.dayjs=function(){var e=r(),t=(e=(e=(e=(e=(e=(e=(e=e.year(this.get("year"))).month(this.get("month")-1)).date(this.get("day"))).hour(this.get("hour"))).minute(this.get("minute"))).second(this.get("second"))).millisecond(this.get("millisecond"))).utcOffset(),n=(void 0!==this.get("timezoneOffset")?this.get("timezoneOffset"):t)-t;return e=e.add(-n,"minute")},a.prototype.moment=function(){return this.dayjs()},t.ParsedComponents=a,t.ParsedResult=i},function(e,t,n){"use strict";var r=n(0),i=function(e){var t={};return Object.keys(e).forEach((function(n){t[e[n]]=n})),t},a=function(e){return"string"===typeof e},o={billingID:"b",displayName:"n",gid:"g",earlyAdopter:"x",email:"e",fname:"f",lname:"l",inviteCode:"i",invoiceAddress:"a",invoiceCompany:"c",invoiceEmail:"d",joinDate:"j",monthlyInvoice:"m",nextBillingDate:"o",planID:"h",picture:"p",premiumCode:"k",premiumSignupDate:"q",premiumEndDate:"r",premiumStatus:"s",subscriptionID:"v",trialDuration:"u",trialExtended:"w",trialStart:"t",isUnsubscribed:"y",appleIAPPlan:"z",appleIAPTransactionId:"aa"},s=i(o),u={items:!0},l={dateCreated:"c",dateCompleted:"e",dateModified:"d",date:"b",flags:"f",id:"id",index:"i",isArchived:"r",isDeleted:"x",note:"n",parent:"p",pendingSync:"m",text:"t",docId:"o",isRoot:"q",itemLinks:"l",regexpFlags:"g",oldDocId:"h"},c=i(l),d={id:"id",accountID:"a",text:"t",emails:"e",phoneNumbers:"p"},h=i(d),f={id:"id",data:"a",cmpData:"b",dateCreated:"c",dateModified:"d",dateCompleted:"f",plugin:"l",docId:"o",parent:"p",notInDoc:"e",itemId:"i",isComplete:"x",isRead:"r",origin:"g"},p=i(f),g={service:"s",accountID:"a",subject:"t",plaintext:"p",date:"d",contacts:"c",snippet:"n",labels:"l",numMessages:"m",hasAttachment:"h"},v=i(g),m={validateInFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach((function(e){if(e.length<2||"undefined"===e)return!1})),!0)},validateOutFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach((function(e){if(e.length>2||"undefined"===e)return!1})),!0)},itemFieldMapIn:c,itemFieldMapOut:l,documentIn:function(e){return{id:e.id,acl:e.a,dateModified:e.p.d,text:e.p.t,encryptionSentinel:e.p.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c,isDeleted:e.p.x,itemsPlaintext:e.z}},documentOut:function(e,t){var n={id:e.id,p:{t:e.text}};return e.isDeleted&&(n.p.x=e.isDeleted),e.dateModified&&(n.p.d=e.dateModified),e.encryptionSentinel&&(n.p.s=e.encryptionSentinel),t&&t.onlyUpdate||(n.a=e.acl,n.r=e.root,n.v=e.version),t&&t.forLocal&&e.pendingSync&&(n.m=e.pendingSync),n},documentInFlat:function(e,t){return{id:e.id,acl:e.a,dateModified:e.d,text:e.t,encryptionSentinel:e.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c,isDeleted:e.x}},documentOutFlat:function(e,t){var n={id:e.id,d:e.dateModified,t:e.text,x:e.isDeleted};return e.encryptionSentinel&&(n.s=e.encryptionSentinel),t||(n.a=e.acl,n.r=e.root,n.v=e.version),e.pendingSync&&(n.m=e.pendingSync),n},userIn:function(e){var t={};return Object.keys(e).forEach((function(n){s[n]&&"undefined"!==s[n]&&(t[s[n]]=e[n])})),t},userOut:function(e){var t={};return Object.keys(e).forEach((function(n){o[n]&&void 0!==o[n]&&"undefined"!==o[n]&&(t[o[n]]=e[n])})),t},itemIn:function(e){var t={};return Object.keys(e).forEach((function(n){c[n]&&"undefined"!==c[n]&&(t[c[n]]=e[n])})),t},itemOut:function(e){var t={};return Object.keys(e).forEach((function(n){void 0!==e[n]&&!u[n]&&l[n]&&"undefined"!==l[n]&&(t[l[n]]=e[n])})),t},decryptItem:function(e,t,n){return e.text?t.decryptText(n,e.text,e.id).then((function(t){return e.text=t,e})):Promise.resolve(e)},encryptItem:function(e,t,n){return e.text?t.encryptText(n,e.text,e.id).then((function(t){return e.text=t,e})):Promise.resolve(e)},encryptItemOut:function(e,t,n){return m.encryptItem(e,t,n).then((function(e){return m.itemOut(e)}))},decryptItemIn:function(e,t,n){return e=m.itemIn(e),m.decryptItem(e,t,n)},boardIn:function(e){var t=Object.assign({},e);return a(e.panes)&&(t.panes=JSON.parse(e.panes)),a(e.defaultPanes)&&(t.defaultPanes=JSON.parse(e.defaultPanes)),t},boardOut:function(e){var t=Object.assign({},e);return e.panes&&(t.panes=JSON.stringify(e.panes)),e.defaultPanes&&(t.defaultPanes=JSON.stringify(e.defaultPanes)),t},compareItemIndex:function(e,t){var n=0,r=null!==e.index?e.index:0,i=null!==t.index?t.index:0;if(void 0===r||void 0===i)return 0;"number"===typeof r&&(r=""+r),"number"===typeof i&&(i=""+i);for(var a=r.split(","),o=i.split(","),s=0;s<a.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(void 0===o[s])return 1;var u=+a[s],l=+o[s];if(u!==l)return u-l}return-1},_baseIn:function(e,t,n){if(e[n]){var r={};return Object.keys(e).forEach((function(n){t[n]&&"undefined"!==t[n]&&(r[t[n]]=e[n])})),r}return e},_baseOut:function(e,t){var n={};return Object.keys(e).forEach((function(r){t[r]&&void 0!==t[r]&&"undefined"!==t[r]&&(n[t[r]]=e[r])})),n},contactIn:function(e){return m._baseIn(e,h,"t")},contactOut:function(e){return m._baseOut(e,d)},pluginIn:function(e){return m._baseIn(e,p,"a")},pluginOut:function(e){return m._baseOut(e,f)},emailMetaDataIn:function(e){var t=m._baseIn(e,v,"a");return t.contacts=e.c.map((function(e){return{text:e.t,email:e.e}})),t},emailMetaDataOut:function(e){var t=m._baseOut(e,g);return t.c=e.contacts.map((function(e){return r.default.removeNullUndefined({t:e.text,e:e.email})})),t}};t.a=m},function(e,t,n){"use strict";var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(18),l=n.n(u),c=n(19),d=n.n(c),h=n(11),f=n.n(h),p=n(7),g=n.n(p),v=n(8),m=n(1),y=n(0),_=n(2),b=n(60),w=n(13),k=n(32);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var E=(r=function(e){l()(n,e);var t=S(n);function n(){var e;return a()(this,n),(e=t.call(this)).selected={},e.numSelected=new w.a(0),e._queueRemoveEditables=[],e}return s()(n,[{key:"_selectedObjForPane",value:function(e){try{y.default.PAssert(585,e,"Multiselect should always pass in a pane")}catch(n){y.default.reportError(n)}e=e||y.default.focusedPane;var t=this.selected[e.id];return t||(t=this.selected[e.id]={arr:new k.a,isInverted:!1}),t}},{key:"getSelectedForPaneObs",value:function(e){return this._selectedObjForPane(e).arr}},{key:"_selectedForPane",value:function(e){return this._selectedObjForPane(e).arr.get()}},{key:"onChanged",value:function(e){this.numSelected.set(this.numSelectedInPane(e))}},{key:"isInverted",value:function(e){return this._selectedObjForPane(e).isInverted}},{key:"setInverted",value:function(e,t){this._selectedObjForPane(t).isInverted=e}},{key:"isSelected",value:function(e,t){return this._selectedForPane(t).indexOf(e)>=0}},{key:"hasSelection",value:function(e){return this._selectedForPane(e).length>0}},{key:"getSelected",value:function(e){return this._selectedForPane(e)}},{key:"getSelectedItems",value:function(e,t){return this.getSelectedObjects(e,t).map((function(e){return e.item}))}},{key:"getSelectedObjects",value:function(e,t){for(var n=0,r=this._selectedForPane(e),i=[],a=0;a<r.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[a];if(e.numItems()>o)if(e.usesVMLIs){var s=e.objectAtIndex(o),u=s.item;!u||!t&&u.isNote()||i.push(s)}else{var l=e.itemsSimple.get()[o];l.item&&i.push(l)}}return i}},{key:"numSelectedInPane",value:function(e){for(var t=0,n=0,r=this._selectedForPane(e),i=0;i<r.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=e.itemAtIndex(r[i]);!a||a.isNote&&a.isNote()||n++}return n}},{key:"getFirstSelectedIndex",value:function(e){var t=0;e=e||y.default.focusedPane;for(var n=this._selectedForPane(e),r=Number.MAX_VALUE,i=!1,a=0;a<n.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=n[a];o<r&&(r=o,i=!0)}return i?r:-1}},{key:"getFirstSelectedItem",value:function(e){e=e||y.default.focusedPane;var t=this.getFirstSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"getLastSelectedIndex",value:function(e){var t=0;e=e||y.default.focusedPane;for(var n=this._selectedForPane(e),r=-1,i=0;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i];a>r&&(r=a)}return r}},{key:"getLastSelectedItem",value:function(e){e=e||y.default.focusedPane;var t=this.getLastSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"_resetPaneID",value:function(e){var t=_.default.PaneManager,n=!0;if(t.isPaneActive(e)){var r=t.getPaneById(e);r.canResetMultiselect()?(this.setSelected([],r),this.selected[e].isInverted=!1):n=!1}else delete this.selected[e];return n}},{key:"reset",value:function(e){var t=!0;if(e)e.canResetMultiselect()?this._resetPaneID(e.id):t=!1;else for(var n in this.selected)this.selected.hasOwnProperty(n)&&(t=t&&this._resetPaneID(n));t&&this.fireEvent("reset",[e])}},{key:"setSelected",value:function(e,t,n){var r=0;t=t||y.default.focusedPane;var i=this._selectedForPane(t),a=y.default.arrayDiff(i,e);this.setInverted(!1,t),this.getSelectedForPaneObs(t).set(e);for(var o=0;o<a.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a[o];if(s<t.numItems()){var u=t.itemAtIndex(s);if(u)u.itemChanged.notify()}}}},{key:"toggleSelected",value:function(e,t,n){t=t||y.default.focusedPane;var r=this.getSelectedForPaneObs(t),i=r.indexOf(e);i>=0&&!0!==n?r.remove(e):i<0&&!1!==n&&r.push(e);var a=t.itemAtIndex(e);a&&a.itemChanged.notify()}},{key:"addSelected",value:function(e,t){this.toggleSelected(e,t,!0)}},{key:"removeSelected",value:function(e,t){this.toggleSelected(e,t,!1)}},{key:"selectInOrder",value:function(e,t,n){var r=0;n=n||y.default.focusedPane;for(var i=[],a=e;a<=t;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i.push(a)}this.setSelected(i,n)}},{key:"forEach",value:function(e,t){var n=0;_.default.PaneUpdateBatcher.beginUpdateItems(),e=e||y.default.focusedPane;for(var r,i=this.getSelectedObjects(e),a=i.map((function(e){return e.item})),o=0;o<i.length&&!1!==r;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[o];r=t(s.item,o,i.length,s,a)}_.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"map",value:function(e,t){var n=this.getSelectedItems(e);return n.map((function(e,r){return t(e,r,n.length)}))}},{key:"setSelectedNew",value:function(e,t){this.setInverted(!1,t),this.getSelectedForPaneObs(t).set(e)}},{key:"onClick",value:function(e,t,n){if(n.shiftKey){var r=this.getFirstSelectedIndex(t),i=this.getLastSelectedIndex(t);e<r?r=e:e>i&&(i=e),this.selectInOrder(r,i,t)}else this.setSelectedNew([e],t)}},{key:"onKeyDown",value:function(e,t){var n,r=Math.max(this.getFirstSelectedIndex(e),0),i=Math.max(this.getLastSelectedIndex(e),0);t.keyCode===m.a.KeyCode.ArrowUp?n=Math.max(0,r-1):t.keyCode===m.a.KeyCode.ArrowDown&&(n=Math.min(i+1,e.numItems()-1)),t.shiftKey?(this.isInverted(e)&&1===this.numSelectedInPane(e)&&this.setInverted(!1,e),this.isInverted(e)?(n=this.getFirstSelectedIndex(e),this.removeSelected(n,e)):n>=0&&n<e.numItems()&&(this.addSelected(n,e),e.scrollIndexIntoView(n))):n>=0&&this.setSelectedNew([n],e)}}]),n}(b.a),g()(r.prototype,"reset",[v.a],Object.getOwnPropertyDescriptor(r.prototype,"reset"),r.prototype),r);t.a=new E},function(e,t,n){"use strict";var r,i,a=n(3),o=n.n(a),s=(n(41),n(10)),u=n.n(s),l=n(5),c=n.n(l),d=n(6),h=n.n(d),f=n(17),p=n.n(f),g=n(18),v=n.n(g),m=n(19),y=n.n(m),_=n(11),b=n.n(_),w=n(7),k=n.n(w),S=n(8),E=n(1),P=n(0),I=(n(12),n(2)),D=n(33),T=n.n(D),x=n(36),C=n(13),A=n(58),L=n(44),O=n(51),M=n(16),R=(r=function(){function e(){c()(this,e),this.isLoaded=new C.a(!1),this.isGapiLoaded=new C.a(!1),this._handlersOnLoaded=[],this.authTokens={},this.erroredAuthTokens=new A.a,this.onAccountsUpdated=new L.a,this.onAuthTokensUpdated=new L.a,this._serverTokens=new C.a,this._refreshPromises={}}return h()(e,[{key:"init",value:function(){var e=this;P.default.isDemoMode()?this._init():I.default.settings.onLoadedRemote((function(){x.a.onAuthed((function(){M.a.onlineStatus.onValue("Online",(function(){e._init()}))}))}))}},{key:"_onLoaded",value:function(){var e,t=this,n=null===(e=x.a.getGoogleProvider())||void 0===e?void 0:e.email;n?this.defaultAccount=n:(I.default.settings.syncAccounts.listen((function(e){t.defaultAccount=Object.keys(e)[0]})),this.defaultAccount=Object.keys(I.default.settings.syncAccounts.get())[0]),this.isLoaded.get()||(I.default.settings.syncAccountRefreshParts.listen((function(){t._serverTokens.onHasValue((function(){setTimeout(t.updateAllServerTokens,2e3)}))})),this.isLoaded.set(!0),this._runOnSyncHandlers())}},{key:"updateAllServerTokens",value:function(){var e=u()(o.a.mark((function e(){var t,n=this;return o.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return t=this._serverTokens.get(),e.next=3,Promise.all(Object.keys(t).map((function(e){if(I.default.settings.syncAccounts.getProperty(e))return n.refreshAuthServerToken(e,t[e])})));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWithTokens",value:function(){var e=u()(o.a.mark((function e(t){var n,r,i=this;return o.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:n=!!this._serverTokens.get(),I.default.settings.syncAccounts.get()||(r={},Object.keys(t).forEach((function(e){var n,i=t[e];r[e]=(n={},T()(n,E.a.PluginID.Gmail,i.scopes.includes(E.a.GScope.GmailModify)),T()(n,E.a.PluginID.GCalendar,i.scopes.includes(E.a.GScope.Calendar)||i.scopes.includes(E.a.GScope.CalendarRO)),n)})),I.default.settings.syncAccounts.set(r)),this._serverTokens.set(t),I.default.settings.onLoadedRemote((function(){n?setTimeout(i.updateAllServerTokens,2e3):i.updateAllServerTokens()}));case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAuthServerToken",value:function(){var e=u()(o.a.mark((function e(t,n){var r,i,a,s;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:0,!1;try{P.default.PAssert(879,t,"Trying to get account auth token for undefined")}catch(u){P.default.reportError(u)}if(!t){e.next=34;break}if(this._refreshPromises[t]){e.next=12;break}r=I.default.settings.syncAccountRefreshParts.getProperty(t);try{P.default.PAssert(880,r,"Missing refresh part for account: "+t,(function(){return Object.keys(I.default.settings.syncAccountRefreshParts.get())}))}catch(u){P.default.reportError(u)}if(r){e.next=9;break}return e.abrupt("return",void 0);case 9:0,this._refreshPromises[t]=O.a.getAccessToken(t,r),!0;case 12:return e.prev=12,e.next=15,this._refreshPromises[t];case 15:if(i=e.sent,delete this._refreshPromises[t],!i.value){e.next=27;break}return a=i.value,(s=this.convertScopeToScopes(a)).email=s.email||t,this.authTokens[t]=s,e.abrupt("return",a);case 27:if(console.log(i.error),i.error&&i.error.includes("invalid_grant"))this.redoAuth(t,n.scopes);else{try{P.default.PAssert(881,!1,"Error refreshing token",i.error)}catch(u){P.default.reportError(u)}0}case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(12),delete this._refreshPromises[t];case 34:case"end":return e.stop()}}}),e,this,[[12,31]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"authAccount",value:function(e,t,n){var r=this,i=function(){var i=u()(o.a.mark((function i(a){return o.a.wrap((function(i){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(i.prev=i.next){case 0:a?n(a):r.doAuthForAccount(e,t,n);case 1:case"end":return i.stop()}}}),i)})));return function(e){return i.apply(this,arguments)}}();this.authTokens[e]?this.getAccountAuthToken(e,t,i,!0):i()}},{key:"authAccountPrimary",value:function(){var e=u()(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:(r=this.getDefaultAccountID())?this.doAuthForAccount(r,t,n):n(void 0);case 2:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeAccount",value:function(e){delete this.authTokens[e],this.onAccountsUpdated.notify()}},{key:"redoAuth",value:function(){var e=u()(o.a.mark((function e(t,n){var r=this;return o.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.erroredAuthTokens.getProperty(t)){e.next=2;break}return e.abrupt("return");case 2:this.erroredAuthTokens.setProperty(t,!0),n.remove(E.a.GScope.GmailCompose),n.remove(E.a.GScope.GmailModify),n.remove(E.a.GScope.DriveFull),n.remove(E.a.GScope.DriveMetadataRO),n.remove(E.a.GScope.DriveInstall),n.remove(E.a.GScope.DriveAppData),n=n.filter((function(e){return!!e})),P.default.log("redoAuth",n);try{P.default.PAssert(882,!1,"redoAuth")}catch(a){P.default.reportError(a)}return e.abrupt("return",new Promise((function(e){I.default.settings.useServerAuth.get()?I.default.toasts.pushMessage({id:"redoAuth_"+t,text:"Error authorizing for: ".concat(t,". Please reauthorize this account to keep syncing its data with Google. If you have been seeing a lot of reauthorization messages, this should fix it for good."),actionText:"REAUTHORIZE",action:function(){r.doAuthForAccount(t,n,(function(){e(),I.default.toasts.clearMessageByID("redoAuth_"+t)}))}}):I.default.toasts.pushMessage({id:"redoAuth_"+t,text:"Error authorizing for: ".concat(t,". This can be caused by a connection error or signing out of Gmail. If retrying does not close this message, you may need to reauthorize."),actionText:"RETRY",holdOnAction:!0,action:function(){r.refreshAuthToken(t,n)},action2:{text:"REAUTHORIZE",action:function(){r.doAuthForAccount(t,n,(function(){e()}))}}})})));case 13:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAccountAuthToken",value:function(e,t,n,r){var i=this;try{P.default.PAssert(883,e,"Trying to get account auth token for undefined")}catch(a){P.default.reportError(a)}e?this.onLoaded(u()(o.a.mark((function a(){var s;return o.a.wrap((function(a){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(a.prev=a.next){case 0:if((s=i.authTokens[e])&&!(s.expires_at<Date.now()+1e4)){a.next=8;break}return a.next=5,i.refreshAuthToken(e,t);case 5:s=a.sent,a.next=22;break;case 8:if(i._verifyScopes(t,s)){a.next=17;break}if(s=void 0,!r){a.next=15;break}return n(void 0),a.abrupt("return");case 15:a.next=22;break;case 17:if(s.expires_at&&!(s.expires_at-Date.now()<E.a.MinimumTokenExpireTimeMS)){a.next=22;break}return P.default.logQuiet("Token needs refresh",s.expires_at,s.expires_at-Date.now()),a.next=21,i.refreshAuthToken(e,t);case 21:s=a.sent;case 22:n(s);case 23:case"end":return a.stop()}}}),a)})))):n(void 0)}},{key:"isAuthorizedForScopes",value:function(e,t){var n=this.authTokens&&this.authTokens[e];return!!n&&this._verifyScopes(t,n)}},{key:"notifyUnauthorizedRequest",value:function(e){}},{key:"_verifyScopes",value:function(e,t){var n=0;if(!t||!t.scopes)return!1;for(var r=t.scopes,i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i];if(!r.includes(a)&&(a!==E.a.GScope.Drive&&a!==E.a.GScope.DriveMetadataRO||!r.includes(E.a.GScope.DriveFull)))return!1}return!0}},{key:"onLoaded",value:function(e){this.isLoaded.get()?e():this._handlersOnLoaded.push(e)}},{key:"_runOnSyncHandlers",value:function(){this._handlersOnLoaded.forEach((function(e){return e()})),this._handlersOnLoaded=[]}},{key:"getDefaultAuthToken",value:function(e,t){var n=this.getDefaultAccountID();n?this.getAccountAuthToken(n,e,(function(e){e&&t(e)})):t(void 0)}},{key:"hasError",value:function(){return!1}},{key:"getError",value:function(e){return""}},{key:"accountHasError",value:function(e){return!!this.erroredAuthTokens.getProperty(e)}},{key:"getGoogleUserInfo",value:function(e){this.getDefaultAuthToken(["profile"],(function(t){t?fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=".concat(t.access_token)).then((function(t){200===t.status&&t.json().then((function(t){return e(t)}))})):e(void 0)}))}},{key:"isEmailAuthed",value:function(e){var t=e.toLowerCase();return Object.keys(this.authTokens).some((function(e){return e.toLowerCase()===t}))}},{key:"_saveAuthToken",value:function(e,t){this.authTokens[e]=t,this.erroredAuthTokens.deleteProperty(e),this.onAuthTokensUpdated.notify()}},{key:"getDefaultAccountID",value:function(){return this.defaultAccount}},{key:"convertScopeToScopes",value:function(e){var t,n=null===(t=e.scope)||void 0===t?void 0:t.split(" ");return e.scopes=null===n||void 0===n?void 0:n.map((function(e){return E.a.GScopeArray[e]})),e}},{key:"convertScopesToScope",value:function(e){return e.map((function(e){return E.a.GScopeArray.indexOf(e)})).join(" ")}}]),e}(),k()(r.prototype,"updateAllServerTokens",[S.a],Object.getOwnPropertyDescriptor(r.prototype,"updateAllServerTokens"),r.prototype),k()(r.prototype,"refreshAuthServerToken",[S.a],Object.getOwnPropertyDescriptor(r.prototype,"refreshAuthServerToken"),r.prototype),r);n(47);function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var N=(i=function(e){v()(n,e);var t=F(n);function n(){var e;return c()(this,n),(e=t.call(this)).retryAttempt=0,e}return h()(n,[{key:"_init",value:function(){var e=u()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:I.default.settings.syncAccounts.listen(this.refreshAllSyncAccounts),I.default.settings.syncAccounts.get(),e.next=9;break;case 7:e.next=12;break;case 9:return e.next=12,this.refreshAllSyncAccounts();case 12:this._onLoaded();case 13:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAuthToken",value:function(){var e=u()(o.a.mark((function e(t,n){var r,i,a,s;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(r=this._serverTokens.get()[t],!this._serverTokens.get()[t]){e.next=6;break}return e.next=4,this.refreshAuthServerToken(t,r);case 4:e.next=20;break;case 6:e.next=11;break;case 9:e.next=20;break;case 11:return e.next=13,this.refreshAllSyncAccounts();case 13:if(this.authTokens[t]){e.next=20;break}if(!(i=I.default.settings.syncAccounts.get())[t]){e.next=20;break}return a=Object.keys(i[t]),s=a&&I.default.pluginManager.getAllPluginScopes(a,!1),e.next=20,this.redoAuth(t,s||n);case 20:return e.abrupt("return",this.authTokens[t]);case 21:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doAuthForAccountLegacy",value:function(e,t,n){var r=this;this.gapiAuthorizePrompt(e,t,(function(e){r.onAccountsUpdated.notify(),n&&n(e)}))}},{key:"doAuthForAccountServer",value:function(){var e=u()(o.a.mark((function e(t,n,r){var i,a,s,l,c=this;return o.a.wrap((function(e){for(var d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:e.next=13;break;case 3:i=e.sent,a=i.authToken,s=i.refreshToken,(l=P.default.clone(I.default.settings.refreshTokensRN.get())||{})[t]={refreshToken:s,scopes:n},I.default.settings.refreshTokensRN.set(l),this._saveAuthToken(t,a),r&&r(a),e.next=16;break;case 13:return e.next=15,this.ensureGapiClient();case 15:window.gapi.auth2.authorize({client_id:E.a.ClientID,scope:n.join(" "),response_type:"id_token code",access_type:"offline",prompt:"consent",login_hint:t},function(){var e=u()(o.a.mark((function e(i){var a,s,u;return o.a.wrap((function(e){for(var o=0,l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!i.error&&P.default.isString(i.code)){e.next=5;break}t&&"popup_closed_by_user"!==i.error&&c.redoAuth(t,n),r&&r(void 0),e.next=19;break;case 5:if(!(a=P.default.decodeIDToken(i.id_token))||a.toLowerCase()===a.toLowerCase()){e.next=11;break}I.default.toasts.pushMessage("Reauthorized with the wrong account. Expected ".concat(a," but got ").concat(a,".")),r&&r(void 0),e.next=19;break;case 11:return e.next=13,O.a.onAuthCode({code:i.code,email:a});case 13:s=e.sent,I.default.settings.syncAccountRefreshParts.setProperty(a,s.value.refresh_part),u=c.convertScopeToScopes(s.value),r&&r(u);case 19:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}());case 16:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"doAuthForAccount",value:function(e,t,n){I.default.settings.useServerAuth.get()?this.doAuthForAccountServer(e,t,n):this.doAuthForAccountLegacy(e,t,n)}},{key:"authAccountAnonymous",value:function(){var e=u()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=[E.a.GScope.Profile,E.a.GScope.UserInfoEmail,E.a.GScope.Email,E.a.GScope.UserInfoProfile];window.gapi.auth2.authorize({client_id:E.a.ClientID,scope:t.join(" "),response_type:"id_token"},(function(t){e(t)}))})));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"authAccountTemp",value:function(){var e=u()(o.a.mark((function e(t){return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",P.default.promisify((function(e){var n=[E.a.GScope.Profile,E.a.GScope.UserInfoEmail,E.a.GScope.Email,E.a.GScope.UserInfoProfile];window.gapi.auth2.authorize({client_id:E.a.ClientID,scope:n.join(" "),response_type:"id_token",login_hint:t},(function(t){e(t)}))})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"promisifyAuthorize",value:function(){var e=u()(o.a.mark((function e(t){var n=this;return o.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",P.default.promisify((function(e){window.gapi.auth2.authorize({client_id:E.a.ClientID,scope:"profile",response_type:"id_token permission",prompt:"none",authuser:""+t,include_granted_scopes:!0},(function(t){if(t.id_token&&t.access_token){var r=P.default.decodeIDToken(t.id_token),i={email:r,access_token:t.access_token,scopes:t.scope.split(" "),expires_at:t.expires_at};n._saveAuthToken(r,i),e(i)}else P.default.logQuiet("authorize: "+JSON.stringify(t)),e(void 0)}))})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAllSyncAccounts",value:function(){var e=u()(o.a.mark((function e(){var t,n,r,i=this;return o.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return P.default.logQuiet("refreshing all sync accounts"),e.next=3,this.ensureGapiClient();case 3:if(t=I.default.settings.syncAccounts.get(),n={},!((r=Object.keys(t).filter((function(e){return!P.default.isEmpty(t[e])&&!i._serverTokens.get()[e]})).map((function(e){return e.toLowerCase()}))).length>0)){e.next=10;break}return r.forEach((function(e){n[e]=!1})),e.next=10,P.default.runSingletonPromise("refreshAllSyncAccounts",u()(o.a.mark((function e(){var t,a,s,l=0;return o.a.wrap((function(e){for(var c=0,d=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<20)){e.next=15;break}if(!(l++>5e3&&__infLoop&&__infLoop(l))){e.next=4;break}throw new RangeError;case 4:return e.next=6,i.promisifyAuthorize(t);case 6:if((a=e.sent)&&(s=a.email.toLowerCase(),!1===n[s]&&(n[s]=!0,I.default.toasts.clearMessageByID("redoAuth_"+s))),!r.every((function(e){return!0===n[e]}))){e.next=12;break}return i.retryAttempt=0,P.default.logQuiet("all refreshed"),e.abrupt("break",15);case 12:t++,e.next=1;break;case 15:if(!r.some((function(e){return!n[e]}))){e.next=19;break}return P.default.logQuiet("Accounts failed, trying the legacy way"),e.next=19,Promise.all(r.map(function(){var e=u()(o.a.mark((function e(t){var r,a,s;return o.a.wrap((function(e){for(var o=0,u=0,l=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(n[t]){e.next=6;break}return P.default.logQuiet("Trying the legacy way: ",t),r=I.default.settings.syncAccounts.get(),a=Object.keys(r[t]),s=a&&I.default.pluginManager.getAllPluginScopes(a,!1),e.abrupt("return",i.gapiAuthorizeImmediateLegacy(t,s));case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 19:r.some((function(e){return!n[e]}))&&(P.default.logQuiet("Accounts still failed, need redoAuth"),i.retryAttempt++,i.retryAttempt>5?Promise.all(r.map(function(){var e=u()(o.a.mark((function e(t){var r,a,s;return o.a.wrap((function(e){for(var o=0,u=0,l=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(n[t]){e.next=5;break}return r=I.default.settings.syncAccounts.get(),a=Object.keys(r[t]),s=a&&I.default.pluginManager.getAllPluginScopes(a,!1),e.abrupt("return",i.redoAuth(t,s));case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())):setTimeout((function(){i.refreshAllSyncAccounts()}),5e3));case 20:case"end":return e.stop()}}}),e)}))));case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gapiAuthorizeImmediateLegacy",value:function(){var e=u()(o.a.mark((function e(t,n){var r=this;return o.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiClient();case 2:return e.next=4,M.a.onConnectedPromise();case 4:return e.abrupt("return",new Promise((function(e){var i=!1,a=function(){r._doAuthorization(t,n,"none",(function(t){i||(i=!0,e(t))}))};a(),setTimeout((function(){i||a()}),2e3)})));case 5:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_doAuthorization",value:function(e,t,n,r){var i=this;try{window.gapi.auth2.authorize({client_id:E.a.ClientID,scope:t.join(" "),response_type:"id_token permission",prompt:n,login_hint:e,authuser:e?-1:void 0,include_granted_scopes:!0},(function(a){var o;if(!P.default.isString(a.access_token)||a.error)P.default.logQuiet("immediate failed",e,a),"access_denied"===a.error_subtype&&"consent"===n&&i.redoAuth(e,t);else{var s=P.default.decodeIDToken(a.id_token)||e;o={access_token:a.access_token,email:s,scopes:a.scope.split(" "),expires_at:a.expires_at},P.default.logQuiet("token",e,o),i._saveAuthToken(e,o)}r(o)}))}catch(a){"Cookies are not enabled in current environment."===a.error&&I.default.menus.openModal(E.a.Modals.ErrorCookies)}}},{key:"gapiAuthorizePrompt",value:function(e,t,n){this._doAuthorization(e,t,"consent",n)}},{key:"ensureGapiBase",value:function(){var e=u()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(window.gapi||this.isGapiLoaded.get()){e.next=3;break}return e.next=3,P.default.runSingletonPromise("gapiScript",(function(){return new Promise((function(e){var t=!1,n=0;!function r(){if(!t||navigator.onLine){var i=document.getElementById("gapiScript");i&&i.remove(),P.default.addScript("https://apis.google.com/js/api.js","gapiScript",(function(){e()}),(function(){t=!0,++n<3&&setTimeout(r,2e3)}))}else setTimeout(r,2e3)}()}))}));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureGapiClient",value:function(){var e=u()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiLib("client");case 2:this.isGapiLoaded.get()||this.isGapiLoaded.set(!0);case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureGapiLib",value:function(){var e=u()(o.a.mark((function e(t){return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiBase();case 2:if(!window.gapi||window.gapi[t]){e.next=5;break}return e.next=5,P.default.runSingletonPromise("ensureGapiLib"+t,(function(){return new Promise((function(e){window.gapi.load(t,{callback:function(){e()},onerror:function(){return!1},timeout:2e4,ontimeout:function(){return!1}})}))}));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authAccount",value:function(e,t,r,i){var a=!I.default.settings.useServerAuth.get()||this._serverTokens.get()[e];!i&&a?p()(b()(n.prototype),"authAccount",this).call(this,e,t,r):this.doAuthForAccount(e,t,r)}}]),n}(R),k()(i.prototype,"refreshAuthToken",[S.a],Object.getOwnPropertyDescriptor(i.prototype,"refreshAuthToken"),i.prototype),k()(i.prototype,"refreshAllSyncAccounts",[S.a],Object.getOwnPropertyDescriptor(i.prototype,"refreshAllSyncAccounts"),i.prototype),i);t.a=new N},function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"d",(function(){return g.b})),n.d(t,"b",(function(){return ie})),n.d(t,"c",(function(){return de})),n.d(t,"f",(function(){return ge.a}));var r,i,a=n(15);(i=r||(r={})).MONTH_DAYS=[31,28,31,30,31,30,31,31,30,31,30,31],i.ONE_DAY=864e5,i.MAXYEAR=9999,i.ORDINAL_BASE=new Date(Date.UTC(1970,0,1)),i.PY_WEEKDAYS=[6,0,1,2,3,4,5],i.getYearDay=function(e){var t=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.ceil((t.valueOf()-new Date(e.getUTCFullYear(),0,1).valueOf())/i.ONE_DAY)+1},i.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},i.isDate=function(e){return e instanceof Date},i.isValidDate=function(e){return i.isDate(e)&&!isNaN(e.getTime())},i.tzOffset=function(e){return 60*e.getTimezoneOffset()*1e3},i.daysBetween=function(e,t){var n=e.getTime()-i.tzOffset(e)-(t.getTime()-i.tzOffset(t));return Math.round(n/i.ONE_DAY)},i.toOrdinal=function(e){return i.daysBetween(e,i.ORDINAL_BASE)},i.fromOrdinal=function(e){return new Date(i.ORDINAL_BASE.getTime()+e*i.ONE_DAY)},i.getMonthDays=function(e){var t=e.getUTCMonth();return 1===t&&i.isLeapYear(e.getUTCFullYear())?29:i.MONTH_DAYS[t]},i.getWeekday=function(e){return i.PY_WEEKDAYS[e.getUTCDay()]},i.monthRange=function(e,t){var n=new Date(Date.UTC(e,t,1));return[i.getWeekday(n),i.getMonthDays(n)]},i.combine=function(e,t){return t=t||e,new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))},i.clone=function(e){return new Date(e.getTime())},i.cloneDates=function(e){for(var t=[],n=0;n<e.length;n++)t.push(i.clone(e[n]));return t},i.sort=function(e){e.sort((function(e,t){return e.getTime()-t.getTime()}))},i.timeToUntilString=function(e,t){void 0===t&&(t=!0);var n=new Date(e);return[Object(a.i)(n.getUTCFullYear().toString(),4,"0"),Object(a.i)(n.getUTCMonth()+1,2,"0"),Object(a.i)(n.getUTCDate(),2,"0"),"T",Object(a.i)(n.getUTCHours(),2,"0"),Object(a.i)(n.getUTCMinutes(),2,"0"),Object(a.i)(n.getUTCSeconds(),2,"0"),t?"Z":""].join("")},i.untilStringToDate=function(e){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/.exec(e);if(!t)throw new Error("Invalid UNTIL value: "+e);return new Date(Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[5],10)||0,parseInt(t[6],10)||0,parseInt(t[7],10)||0))};var o=r,s=function(){function e(e,t){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=e,this.args=t,"between"===e?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):"before"===e?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):"after"===e&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))}return e.prototype.accept=function(e){++this.total;var t=this.minDate&&e<this.minDate,n=this.maxDate&&e>this.maxDate;if("between"===this.method){if(t)return!0;if(n)return!1}else if("before"===this.method){if(n)return!1}else if("after"===this.method)return!!t||(this.add(e),!1);return this.add(e)},e.prototype.add=function(e){return this._result.push(e),!0},e.prototype.getValue=function(){var e=this._result;switch(this.method){case"all":case"between":return e;case"before":case"after":default:return e.length?e[e.length-1]:null}},e.prototype.clone=function(){return new e(this.method,this.args)},e}(),u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function l(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function d(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var h,f=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.iterator=r,i}return l(t,e),t.prototype.add=function(e){return!!this.iterator(e,this._result.length)&&(this._result.push(e),!0)},t}(s);function p(e){return e<h.HOURLY}!function(e){e[e.YEARLY=0]="YEARLY",e[e.MONTHLY=1]="MONTHLY",e[e.WEEKLY=2]="WEEKLY",e[e.DAILY=3]="DAILY",e[e.HOURLY=4]="HOURLY",e[e.MINUTELY=5]="MINUTELY",e[e.SECONDLY=6]="SECONDLY"}(h||(h={}));var g=n(45),v=function(){function e(e,t,n,r){this.hour=e,this.minute=t,this.second=n,this.millisecond=r||0}return e.prototype.getHours=function(){return this.hour},e.prototype.getMinutes=function(){return this.minute},e.prototype.getSeconds=function(){return this.second},e.prototype.getMilliseconds=function(){return this.millisecond},e.prototype.getTime=function(){return 1e3*(60*this.hour*60+60*this.minute+this.second)+this.millisecond},e}(),m=function(e){function t(t,n,r,i,a,o,s){var u=e.call(this,i,a,o,s)||this;return u.year=t,u.month=n,u.day=r,u}return l(t,e),t.fromDate=function(e){return new this(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.valueOf()%1e3)},t.prototype.getWeekday=function(){return r.getWeekday(new Date(this.getTime()))},t.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},t.prototype.getDay=function(){return this.day},t.prototype.getMonth=function(){return this.month},t.prototype.getYear=function(){return this.year},t.prototype.addYears=function(e){this.year+=e},t.prototype.addMonths=function(e){if(this.month+=e,this.month>12){var t=Math.floor(this.month/12),n=Object(a.j)(this.month,12);this.month=n,this.year+=t,0===this.month&&(this.month=12,--this.year)}},t.prototype.addWeekly=function(e,t){t>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-t))+7*e:this.day+=-(this.getWeekday()-t)+7*e,this.fixDay()},t.prototype.addDaily=function(e){this.day+=e,this.fixDay()},t.prototype.addHours=function(e,t,n){for(t&&(this.hour+=Math.floor((23-this.hour)/e)*e);;){this.hour+=e;var r=Object(a.a)(this.hour,24),i=r.div,o=r.mod;if(i&&(this.hour=o,this.addDaily(i)),Object(a.b)(n)||Object(a.c)(n,this.hour))break}},t.prototype.addMinutes=function(e,t,n,r){for(t&&(this.minute+=Math.floor((1439-(60*this.hour+this.minute))/e)*e);;){this.minute+=e;var i=Object(a.a)(this.minute,60),o=i.div,s=i.mod;if(o&&(this.minute=s,this.addHours(o,!1,n)),(Object(a.b)(n)||Object(a.c)(n,this.hour))&&(Object(a.b)(r)||Object(a.c)(r,this.minute)))break}},t.prototype.addSeconds=function(e,t,n,r,i){for(t&&(this.second+=Math.floor((86399-(3600*this.hour+60*this.minute+this.second))/e)*e);;){this.second+=e;var o=Object(a.a)(this.second,60),s=o.div,u=o.mod;if(s&&(this.second=u,this.addMinutes(s,!1,n,r)),(Object(a.b)(n)||Object(a.c)(n,this.hour))&&(Object(a.b)(r)||Object(a.c)(r,this.minute))&&(Object(a.b)(i)||Object(a.c)(i,this.second)))break}},t.prototype.fixDay=function(){if(!(this.day<=28)){var e=r.monthRange(this.year,this.month-1)[1];if(!(this.day<=e))for(;this.day>e;){if(this.day-=e,++this.month,13===this.month&&(this.month=1,++this.year,this.year>r.MAXYEAR))return;e=r.monthRange(this.year,this.month-1)[1]}}},t.prototype.add=function(e,t){var n=e.freq,r=e.interval,i=e.wkst,a=e.byhour,o=e.byminute,s=e.bysecond;switch(n){case h.YEARLY:return this.addYears(r);case h.MONTHLY:return this.addMonths(r);case h.WEEKLY:return this.addWeekly(r,i);case h.DAILY:return this.addDaily(r);case h.HOURLY:return this.addHours(r,t,a);case h.MINUTELY:return this.addMinutes(r,t,a,o);case h.SECONDLY:return this.addSeconds(r,t,a,o,s)}},t}(v);function y(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];Object(a.c)(re,i)||t.push(i),o.isDate(e[i])&&!o.isValidDate(e[i])&&t.push(i)}if(t.length)throw new Error("Invalid options: "+t.join(", "));return c({},e)}function _(e){var t,n,r=c(c({},ne),y(e));if(Object(a.f)(r.byeaster)&&(r.freq=ie.YEARLY),!Object(a.f)(r.freq)||!ie.FREQUENCIES[r.freq])throw new Error("Invalid frequency: "+r.freq+" "+e.freq);if(r.dtstart||(r.dtstart=new Date((new Date).setMilliseconds(0))),Object(a.f)(r.wkst)?Object(a.e)(r.wkst)||(r.wkst=r.wkst.weekday):r.wkst=ie.MO.weekday,Object(a.f)(r.bysetpos)){Object(a.e)(r.bysetpos)&&(r.bysetpos=[r.bysetpos]);for(var i=0;i<r.bysetpos.length;i++){if(0===(l=r.bysetpos[i])||!(l>=-366&&l<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(Boolean(r.byweekno)||Object(a.h)(r.byweekno)||Object(a.h)(r.byyearday)||Boolean(r.bymonthday)||Object(a.h)(r.bymonthday)||Object(a.f)(r.byweekday)||Object(a.f)(r.byeaster)))switch(r.freq){case ie.YEARLY:r.bymonth||(r.bymonth=r.dtstart.getUTCMonth()+1),r.bymonthday=r.dtstart.getUTCDate(),31===r.bymonthday&&(t=r.bymonth-1,n=r.dtstart.getUTCFullYear(),new Date(n,t+1,0).getDate()<r.bymonthday&&(r.bymonthday=1));break;case ie.MONTHLY:r.bymonthday=r.dtstart.getUTCDate();break;case ie.WEEKLY:r.byweekday=[o.getWeekday(r.dtstart)]}if(Object(a.f)(r.bymonth)&&!Object(a.d)(r.bymonth)&&(r.bymonth=[r.bymonth]),Object(a.f)(r.byyearday)&&!Object(a.d)(r.byyearday)&&Object(a.e)(r.byyearday)&&(r.byyearday=[r.byyearday]),Object(a.f)(r.bymonthday))if(Object(a.d)(r.bymonthday)){var s=[],u=[];for(i=0;i<r.bymonthday.length;i++){var l;(l=r.bymonthday[i])>0?s.push(l):l<0&&u.push(l)}r.bymonthday=s,r.bynmonthday=u}else r.bymonthday<0?(r.bynmonthday=[r.bymonthday],r.bymonthday=[]):(r.bynmonthday=[],r.bymonthday=[r.bymonthday]);else r.bymonthday=[],r.bynmonthday=[];if(Object(a.f)(r.byweekno)&&!Object(a.d)(r.byweekno)&&(r.byweekno=[r.byweekno]),Object(a.f)(r.byweekday))if(Object(a.e)(r.byweekday))r.byweekday=[r.byweekday],r.bynweekday=null;else if(Object(a.g)(r.byweekday))r.byweekday=[g.b.fromStr(r.byweekday).weekday],r.bynweekday=null;else if(r.byweekday instanceof g.b)!r.byweekday.n||r.freq>ie.MONTHLY?(r.byweekday=[r.byweekday.weekday],r.bynweekday=null):(r.bynweekday=[[r.byweekday.weekday,r.byweekday.n]],r.byweekday=null);else{var d=[],h=[];for(i=0;i<r.byweekday.length;i++){var f=r.byweekday[i];Object(a.e)(f)?d.push(f):Object(a.g)(f)?d.push(g.b.fromStr(f).weekday):!f.n||r.freq>ie.MONTHLY?d.push(f.weekday):h.push([f.weekday,f.n])}r.byweekday=Object(a.h)(d)?d:null,r.bynweekday=Object(a.h)(h)?h:null}else r.bynweekday=null;return Object(a.f)(r.byhour)?Object(a.e)(r.byhour)&&(r.byhour=[r.byhour]):r.byhour=r.freq<ie.HOURLY?[r.dtstart.getUTCHours()]:null,Object(a.f)(r.byminute)?Object(a.e)(r.byminute)&&(r.byminute=[r.byminute]):r.byminute=r.freq<ie.MINUTELY?[r.dtstart.getUTCMinutes()]:null,Object(a.f)(r.bysecond)?Object(a.e)(r.bysecond)&&(r.bysecond=[r.bysecond]):r.bysecond=r.freq<ie.SECONDLY?[r.dtstart.getUTCSeconds()]:null,{parsedOptions:r}}function b(e){var t=e.split("\n").map(k).filter((function(e){return null!==e}));return c(c({},t[0]),t[1])}function w(e){var t={},n=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(e);if(!n)return t;n[0];var r=n[1],i=n[2];return r&&(t.tzid=r),t.dtstart=o.untilStringToDate(i),t}function k(e){if(!(e=e.replace(/^\s+|\s+$/,"")).length)return null;var t=/^([A-Z]+?)[:;]/.exec(e.toUpperCase());if(!t)return S(e);t[0];var n=t[1];switch(n.toUpperCase()){case"RRULE":case"EXRULE":return S(e);case"DTSTART":return w(e);default:throw new Error("Unsupported RFC prop "+n+" in "+e)}}function S(e){var t=w(e.replace(/^RRULE:/i,""));return e.replace(/^(?:RRULE|EXRULE):/i,"").split(";").forEach((function(n){var r=n.split("="),i=r[0],a=r[1];switch(i.toUpperCase()){case"FREQ":t.freq=h[a.toUpperCase()];break;case"WKST":t.wkst=te[a.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var s=function(e){if(-1!==e.indexOf(",")){return e.split(",").map(E)}return E(e)}(a),u=i.toLowerCase();t[u]=s;break;case"BYWEEKDAY":case"BYDAY":t.byweekday=function(e){return e.split(",").map((function(e){if(2===e.length)return te[e];var t=e.match(/^([+-]?\d{1,2})([A-Z]{2})$/),n=Number(t[1]),r=t[2],i=te[r].weekday;return new g.b(i,n)}))}(a);break;case"DTSTART":case"TZID":var l=w(e);t.tzid=l.tzid,t.dtstart=l.dtstart;break;case"UNTIL":t.until=o.untilStringToDate(a);break;case"BYEASTER":t.byeaster=Number(a);break;default:throw new Error("Unknown RRULE property '"+i+"'")}})),t}function E(e){return/^[+-]?\d+$/.test(e)?Number(e):e}var P=function(){function e(e,t){this.date=e,this.tzid=t}return Object.defineProperty(e.prototype,"isUTC",{get:function(){return!this.tzid||"UTC"===this.tzid.toUpperCase()},enumerable:!0,configurable:!0}),e.prototype.toString=function(){var e=o.timeToUntilString(this.date.getTime(),this.isUTC);return this.isUTC?":"+e:";TZID="+this.tzid+":"+e},e.prototype.getTime=function(){return this.date.getTime()},e.prototype.rezonedDate=function(){return this.isUTC,this.date},e}();function I(e,t){for(var n=[],r="",i=Object.keys(e),s=Object.keys(ne),u=0;u<i.length;u++)if("tzid"!==i[u]&&Object(a.c)(s,i[u])){var l=i[u].toUpperCase(),c=e[i[u]],d="";if(Object(a.f)(c)&&(!Object(a.d)(c)||c.length)){switch(l){case"FREQ":d=ie.FREQUENCIES[e.freq];break;case"WKST":d=Object(a.e)(c)?new g.b(c).toString():c.toString();break;case"BYWEEKDAY":l="BYDAY",d=Object(a.n)(c).map((function(e){return e instanceof g.b?e:Object(a.d)(e)?new g.b(e[0],e[1]):new g.b(e)})).toString();break;case"DTSTART":r=D(c,e.tzid);break;case"UNTIL":d=o.timeToUntilString(c,!e.tzid);break;default:if(Object(a.d)(c)){for(var h=[],f=0;f<c.length;f++)h[f]=String(c[f]);d=h.toString()}else d=String(c)}d&&n.push([l,d])}}t&&n.sort((function(e,t){return e[0].localeCompare(t[0])}));var p=n.map((function(e){return e[0]+"="+e[1].toString()})).join(";"),v="";return""!==p&&(v="RRULE:"+p),[r,v].filter((function(e){return!!e})).join("\n")}function D(e,t){return e?"DTSTART"+new P(new Date(e),t).toString():""}var T=function(){function e(){this.all=!1,this.before=[],this.after=[],this.between=[]}return e.prototype._cacheAdd=function(e,t,n){t&&(t=t instanceof Date?o.clone(t):o.cloneDates(t)),"all"===e?this.all=t:(n._value=t,this[e].push(n))},e.prototype._cacheGet=function(e,t){var n=!1,r=t?Object.keys(t):[],i=function(e){for(var n=0;n<r.length;n++){var i=r[n];if(String(t[i])!==String(e[i]))return!0}return!1},u=this[e];if("all"===e)n=this.all;else if(Object(a.d)(u))for(var l=0;l<u.length;l++){var c=u[l];if(!r.length||!i(c)){n=c._value;break}}if(!n&&this.all){var d=new s(e,t);for(l=0;l<this.all.length&&d.accept(this.all[l]);l++);n=d.getValue(),this._cacheAdd(e,n,t)}return Object(a.d)(n)?o.cloneDates(n):n instanceof Date?o.clone(n):n},e}(),x=d(Object(a.l)(1,31),Object(a.l)(2,28),Object(a.l)(3,31),Object(a.l)(4,30),Object(a.l)(5,31),Object(a.l)(6,30),Object(a.l)(7,31),Object(a.l)(8,31),Object(a.l)(9,30),Object(a.l)(10,31),Object(a.l)(11,30),Object(a.l)(12,31),Object(a.l)(1,7)),C=d(Object(a.l)(1,31),Object(a.l)(2,29),Object(a.l)(3,31),Object(a.l)(4,30),Object(a.l)(5,31),Object(a.l)(6,30),Object(a.l)(7,31),Object(a.l)(8,31),Object(a.l)(9,30),Object(a.l)(10,31),Object(a.l)(11,30),Object(a.l)(12,31),Object(a.l)(1,7)),A=Object(a.k)(1,29),L=Object(a.k)(1,30),O=Object(a.k)(1,31),M=Object(a.k)(1,32),R=d(M,L,M,O,M,O,M,M,O,M,O,M,M.slice(0,7)),F=d(M,A,M,O,M,O,M,M,O,M,O,M,M.slice(0,7)),N=Object(a.k)(-28,0),j=Object(a.k)(-29,0),U=Object(a.k)(-30,0),B=Object(a.k)(-31,0),V=d(B,j,B,U,B,U,B,B,U,B,U,B,B.slice(0,7)),H=d(B,N,B,U,B,U,B,B,U,B,U,B,B.slice(0,7)),W=[0,31,60,91,121,152,182,213,244,274,305,335,366],q=[0,31,59,90,120,151,181,212,243,273,304,334,365],z=function(){for(var e=[],t=0;t<55;t++)e=e.concat(Object(a.k)(7));return e}();function G(e,t){var n,r,i=new Date(Date.UTC(e,0,1)),s=o.isLeapYear(e)?366:365,u=o.isLeapYear(e+1)?366:365,l=o.toOrdinal(i),d=o.getWeekday(i),h=c(c({yearlen:s,nextyearlen:u,yearordinal:l,yearweekday:d},function(e){var t=o.isLeapYear(e)?366:365,n=new Date(Date.UTC(e,0,1)),r=o.getWeekday(n);if(365===t)return{mmask:x,mdaymask:F,nmdaymask:H,wdaymask:z.slice(r),mrange:q};return{mmask:C,mdaymask:R,nmdaymask:V,wdaymask:z.slice(r),mrange:W}}(e)),{wnomask:null});if(Object(a.b)(t.byweekno))return h;h.wnomask=Object(a.l)(0,s+7);var f=n=Object(a.j)(7-d+t.wkst,7);f>=4?(f=0,r=h.yearlen+Object(a.j)(d-t.wkst,7)):r=s-f;for(var p=Math.floor(r/7),g=Object(a.j)(r,7),v=Math.floor(p+g/4),m=0;m<t.byweekno.length;m++){var y=t.byweekno[m];if(y<0&&(y+=v+1),y>0&&y<=v){var _=void 0;y>1?(_=f+7*(y-1),f!==n&&(_-=7-n)):_=f;for(var b=0;b<7&&(h.wnomask[_]=1,_++,h.wdaymask[_]!==t.wkst);b++);}}if(Object(a.c)(t.byweekno,1)){_=f+7*v;if(f!==n&&(_-=7-n),_<s)for(m=0;m<7&&(h.wnomask[_]=1,_+=1,h.wdaymask[_]!==t.wkst);m++);}if(f){var w=void 0;if(Object(a.c)(t.byweekno,-1))w=-1;else{var k=o.getWeekday(new Date(Date.UTC(e-1,0,1))),S=Object(a.j)(7-k.valueOf()+t.wkst,7),E=o.isLeapYear(e-1)?366:365,P=void 0;S>=4?(S=0,P=E+Object(a.j)(k-t.wkst,7)):P=s-f,w=Math.floor(52+Object(a.j)(P,7)/4)}if(Object(a.c)(t.byweekno,w))for(_=0;_<f;_++)h.wnomask[_]=1}return h}var K=function(){function e(e){this.options=e}return e.prototype.rebuild=function(e,t){var n=this.options;if(e!==this.lastyear&&(this.yearinfo=G(e,n)),Object(a.h)(n.bynweekday)&&(t!==this.lastmonth||e!==this.lastyear)){var r=this.yearinfo,i=r.yearlen,o=r.mrange,s=r.wdaymask;this.monthinfo=function(e,t,n,r,i,o){var s={lastyear:e,lastmonth:t,nwdaymask:[]},u=[];if(o.freq===ie.YEARLY)if(Object(a.b)(o.bymonth))u=[[0,n]];else for(var l=0;l<o.bymonth.length;l++)t=o.bymonth[l],u.push(r.slice(t-1,t+1));else o.freq===ie.MONTHLY&&(u=[r.slice(t-1,t+1)]);if(Object(a.b)(u))return s;for(s.nwdaymask=Object(a.l)(0,n),l=0;l<u.length;l++)for(var c=u[l],d=c[0],h=c[1]-1,f=0;f<o.bynweekday.length;f++){var p=void 0,g=o.bynweekday[f],v=g[0],m=g[1];m<0?(p=h+7*(m+1),p-=Object(a.j)(i[p]-v,7)):(p=d+7*(m-1),p+=Object(a.j)(7-i[p]+v,7)),d<=p&&p<=h&&(s.nwdaymask[p]=1)}return s}(e,t,i,o,s,n)}Object(a.f)(n.byeaster)&&(this.eastermask=function(e,t){void 0===t&&(t=0);var n=e%19,r=Math.floor(e/100),i=e%100,a=Math.floor(r/4),o=r%4,s=Math.floor((r+8)/25),u=Math.floor((r-s+1)/3),l=Math.floor(19*n+r-a-u+15)%30,c=Math.floor(i/4),d=i%4,h=Math.floor(32+2*o+2*c-l-d)%7,f=Math.floor((n+11*l+22*h)/451),p=Math.floor((l+h-7*f+114)/31),g=(l+h-7*f+114)%31+1,v=Date.UTC(e,p-1,g+t),m=Date.UTC(e,0,1);return[Math.ceil((v-m)/864e5)]}(e,n.byeaster))},Object.defineProperty(e.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!0,configurable:!0}),e.prototype.ydayset=function(){return[Object(a.k)(this.yearlen),0,this.yearlen]},e.prototype.mdayset=function(e,t,n){for(var r=this.mrange[t-1],i=this.mrange[t],o=Object(a.l)(null,this.yearlen),s=r;s<i;s++)o[s]=s;return[o,r,i]},e.prototype.wdayset=function(e,t,n){for(var r=Object(a.l)(null,this.yearlen+7),i=o.toOrdinal(new Date(Date.UTC(e,t-1,n)))-this.yearordinal,s=i,u=0;u<7&&(r[i]=i,++i,this.wdaymask[i]!==this.options.wkst);u++);return[r,s,i]},e.prototype.ddayset=function(e,t,n){var r=Object(a.l)(null,this.yearlen),i=o.toOrdinal(new Date(Date.UTC(e,t-1,n)))-this.yearordinal;return r[i]=i,[r,i,i+1]},e.prototype.htimeset=function(e,t,n,r){var i=this,a=[];return this.options.byminute.forEach((function(t){a=a.concat(i.mtimeset(e,t,n,r))})),o.sort(a),a},e.prototype.mtimeset=function(e,t,n,r){var i=this.options.bysecond.map((function(n){return new v(e,t,n,r)}));return o.sort(i),i},e.prototype.stimeset=function(e,t,n,r){return[new v(e,t,n,r)]},e.prototype.getdayset=function(e){switch(e){case h.YEARLY:return this.ydayset.bind(this);case h.MONTHLY:return this.mdayset.bind(this);case h.WEEKLY:return this.wdayset.bind(this);case h.DAILY:default:return this.ddayset.bind(this)}},e.prototype.gettimeset=function(e){switch(e){case h.HOURLY:return this.htimeset.bind(this);case h.MINUTELY:return this.mtimeset.bind(this);case h.SECONDLY:return this.stimeset.bind(this)}},e}();function Y(e,t,n,r,i,s){for(var u=[],l=0;l<e.length;l++){var c=void 0,d=void 0,h=e[l];h<0?(c=Math.floor(h/t.length),d=Object(a.j)(h,t.length)):(c=Math.floor((h-1)/t.length),d=Object(a.j)(h-1,t.length));for(var f=[],p=n;p<r;p++){var g=s[p];Object(a.f)(g)&&f.push(g)}var v=void 0;v=c<0?f.slice(c)[0]:f[c];var m=t[d],y=o.fromOrdinal(i.yearordinal+v),_=o.combine(y,m);Object(a.c)(u,_)||u.push(_)}return o.sort(u),u}function Q(e,t){var n=t.dtstart,r=t.freq,i=t.interval,s=t.until,u=t.bysetpos,l=t.count;if(0===l||0===i)return J(e);var c=m.fromDate(n),d=new K(t);d.rebuild(c.year,c.month);for(var h=function(e,t,n){var r=n.freq,i=n.byhour,o=n.byminute,s=n.bysecond;if(p(r))return function(e){var t=e.dtstart.getTime()%1e3;if(!p(e.freq))return[];var n=[];return e.byhour.forEach((function(r){e.byminute.forEach((function(i){e.bysecond.forEach((function(e){n.push(new v(r,i,e,t))}))}))})),n}(n);if(r>=ie.HOURLY&&Object(a.h)(i)&&!Object(a.c)(i,t.hour)||r>=ie.MINUTELY&&Object(a.h)(o)&&!Object(a.c)(o,t.minute)||r>=ie.SECONDLY&&Object(a.h)(s)&&!Object(a.c)(s,t.second))return[];return e.gettimeset(r)(t.hour,t.minute,t.second,t.millisecond)}(d,c,t);;){var f=d.getdayset(r)(c.year,c.month,c.day),g=f[0],y=f[1],_=f[2],b=Z(g,y,_,d,t);if(Object(a.h)(u))for(var w=Y(u,h,y,_,d,g),k=0;k<w.length;k++){var S=w[k];if(s&&S>s)return J(e);if(S>=n){var E=$(S,t);if(!e.accept(E))return J(e);if(l&&!--l)return J(e)}}else for(k=y;k<_;k++){var P=g[k];if(Object(a.f)(P))for(var I=o.fromOrdinal(d.yearordinal+P),D=0;D<h.length;D++){var T=h[D];S=o.combine(I,T);if(s&&S>s)return J(e);if(S>=n){E=$(S,t);if(!e.accept(E))return J(e);if(l&&!--l)return J(e)}}}if(0===t.interval)return J(e);if(c.add(t,b),c.year>o.MAXYEAR)return J(e);p(r)||(h=d.gettimeset(r)(c.hour,c.minute,c.second,0)),d.rebuild(c.year,c.month)}}function X(e,t,n){var r=n.bymonth,i=n.byweekno,o=n.byweekday,s=n.byeaster,u=n.bymonthday,l=n.bynmonthday,c=n.byyearday;return Object(a.h)(r)&&!Object(a.c)(r,e.mmask[t])||Object(a.h)(i)&&!e.wnomask[t]||Object(a.h)(o)&&!Object(a.c)(o,e.wdaymask[t])||Object(a.h)(e.nwdaymask)&&!e.nwdaymask[t]||null!==s&&!Object(a.c)(e.eastermask,t)||(Object(a.h)(u)||Object(a.h)(l))&&!Object(a.c)(u,e.mdaymask[t])&&!Object(a.c)(l,e.nmdaymask[t])||Object(a.h)(c)&&(t<e.yearlen&&!Object(a.c)(c,t+1)&&!Object(a.c)(c,-e.yearlen+t)||t>=e.yearlen&&!Object(a.c)(c,t+1-e.yearlen)&&!Object(a.c)(c,-e.nextyearlen+t-e.yearlen))}function $(e,t){return new P(e,t.tzid).rezonedDate()}function J(e){return e.getValue()}function Z(e,t,n,r,i){for(var a=!1,o=t;o<n;o++){var s=e[o];(a=X(r,s,i))&&(e[s]=null)}return a}var ee=function(){return ee._nlp||(ee._nlp=n(204)),ee._nlp},te={MO:new g.b(0),TU:new g.b(1),WE:new g.b(2),TH:new g.b(3),FR:new g.b(4),SA:new g.b(5),SU:new g.b(6)},ne={freq:h.YEARLY,dtstart:null,interval:1,wkst:te.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},re=Object.keys(ne),ie=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t=!1),this._cache=t?null:new T,this.origOptions=y(e);var n=_(e).parsedOptions;this.options=n}return e.parseText=function(e,t){return ee().parseText(e,t)},e.fromText=function(e,t){return ee().fromText(e,t)},e.fromString=function(t){return new e(e.parseString(t)||void 0)},e.prototype._iter=function(e){return Q(e,this.options)},e.prototype._cacheGet=function(e,t){return!!this._cache&&this._cache._cacheGet(e,t)},e.prototype._cacheAdd=function(e,t,n){if(this._cache)return this._cache._cacheAdd(e,t,n)},e.prototype.all=function(e){if(e)return this._iter(new f("all",{},e));var t=this._cacheGet("all");return!1===t&&(t=this._iter(new s("all",{})),this._cacheAdd("all",t)),t},e.prototype.between=function(e,t,n,r){if(void 0===n&&(n=!1),!o.isValidDate(e)||!o.isValidDate(t))throw new Error("Invalid date passed in to RRule.between");var i={before:t,after:e,inc:n};if(r)return this._iter(new f("between",i,r));var a=this._cacheGet("between",i);return!1===a&&(a=this._iter(new s("between",i)),this._cacheAdd("between",a,i)),a},e.prototype.before=function(e,t){if(void 0===t&&(t=!1),!o.isValidDate(e))throw new Error("Invalid date passed in to RRule.before");var n={dt:e,inc:t},r=this._cacheGet("before",n);return!1===r&&(r=this._iter(new s("before",n)),this._cacheAdd("before",r,n)),r},e.prototype.after=function(e,t){if(void 0===t&&(t=!1),!o.isValidDate(e))throw new Error("Invalid date passed in to RRule.after");var n={dt:e,inc:t},r=this._cacheGet("after",n);return!1===r&&(r=this._iter(new s("after",n)),this._cacheAdd("after",r,n)),r},e.prototype.count=function(){return this.all().length},e.prototype.toString=function(e){return I(this.origOptions,e)},e.prototype.toText=function(e,t,n){return ee().toText(this,e,t,n)},e.prototype.toTextShort=function(){return ee().toTextShort(this)},e.prototype.isFullyConvertibleToText=function(){return ee().isFullyConvertible(this)},e.prototype.clone=function(){return new e(this.origOptions)},e.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],e.YEARLY=h.YEARLY,e.MONTHLY=h.MONTHLY,e.WEEKLY=h.WEEKLY,e.DAILY=h.DAILY,e.HOURLY=h.HOURLY,e.MINUTELY=h.MINUTELY,e.SECONDLY=h.SECONDLY,e.MO=te.MO,e.TU=te.TU,e.WE=te.WE,e.TH=te.TH,e.FR=te.FR,e.SA=te.SA,e.SU=te.SU,e.parseString=b,e.optionsToString=I,e}();var ae={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function oe(e,t){var n=[],r=[],i=[],o=[],s=w(e),u=s.dtstart,l=s.tzid;return function(e,t){void 0===t&&(t=!1);if(!(e=e&&e.trim()))throw new Error("Invalid empty string");if(!t)return e.split(/\s/);var n=e.split("\n"),r=0;for(;r<n.length;){var i=n[r]=n[r].replace(/\s+$/g,"");i?r>0&&" "===i[0]?(n[r-1]+=i.slice(1),n.splice(r,1)):r+=1:n.splice(r,1)}return n}(e,t.unfold).forEach((function(e){if(e){var t=function(e){var t=function(e){if(-1===e.indexOf(":"))return{name:"RRULE",value:e};var t=Object(a.m)(e,":",1),n=t[0],r=t[1];return{name:n,value:r}}(e),n=t.name,r=t.value,i=n.split(";");if(!i)throw new Error("empty property name");return{name:i[0].toUpperCase(),parms:i.slice(1),value:r}}(e),s=t.name,u=t.parms,c=t.value;switch(s.toUpperCase()){case"RRULE":if(u.length)throw new Error("unsupported RRULE parm: "+u.join(","));n.push(b(e));break;case"RDATE":var d=/RDATE(?:;TZID=([^:=]+))?/i.exec(e),h=(d[0],d[1]);h&&!l&&(l=h),r=r.concat(le(c,u));break;case"EXRULE":if(u.length)throw new Error("unsupported EXRULE parm: "+u.join(","));i.push(b(c));break;case"EXDATE":o=o.concat(le(c,u));break;case"DTSTART":break;default:throw new Error("unsupported property: "+s)}}})),{dtstart:u,tzid:l,rrulevals:n,rdatevals:r,exrulevals:i,exdatevals:o}}function se(e,t){return void 0===t&&(t={}),function(e,t){var n=oe(e,t),r=n.rrulevals,i=n.rdatevals,a=n.exrulevals,o=n.exdatevals,s=n.dtstart,u=n.tzid,l=!1===t.cache;if(t.compatible&&(t.forceset=!0,t.unfold=!0),t.forceset||r.length>1||i.length||a.length||o.length){var c=new de(l);return c.dtstart(s),c.tzid(u||void 0),r.forEach((function(e){c.rrule(new ie(ue(e,s,u),l))})),i.forEach((function(e){c.rdate(e)})),a.forEach((function(e){c.exrule(new ie(ue(e,s,u),l))})),o.forEach((function(e){c.exdate(e)})),t.compatible&&t.dtstart&&c.rdate(s),c}var d=r[0]||{};return new ie(ue(d,d.dtstart||t.dtstart||s,d.tzid||t.tzid||u),l)}(e,function(e){var t=[],n=Object.keys(e),r=Object.keys(ae);if(n.forEach((function(e){Object(a.c)(r,e)||t.push(e)})),t.length)throw new Error("Invalid options: "+t.join(", "));return c(c({},ae),e)}(t))}function ue(e,t,n){return c(c({},e),{dtstart:t,tzid:n})}function le(e,t){return function(e){e.forEach((function(e){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(e))throw new Error("unsupported RDATE/EXDATE parm: "+e)}))}(t),e.split(",").map((function(e){return o.untilStringToDate(e)}))}function ce(e){var t=this;return function(n){if(void 0!==n&&(t["_"+e]=n),void 0!==t["_"+e])return t["_"+e];for(var r=0;r<t._rrule.length;r++){var i=t._rrule[r].origOptions[e];if(i)return i}}}var de=function(e){function t(t){void 0===t&&(t=!1);var n=e.call(this,{},t)||this;return n.dtstart=ce.apply(n,["dtstart"]),n.tzid=ce.apply(n,["tzid"]),n._rrule=[],n._rdate=[],n._exrule=[],n._exdate=[],n}return l(t,e),t.prototype._iter=function(e){return function(e,t,n,r,i,a){var s={},u=e.accept;function l(e,t){n.forEach((function(n){n.between(e,t,!0).forEach((function(e){s[Number(e)]=!0}))}))}i.forEach((function(e){var t=new P(e,a).rezonedDate();s[Number(t)]=!0})),e.accept=function(e){var t=Number(e);return isNaN(t)?u.call(this,e):!(!s[t]&&(l(new Date(t-1),new Date(t+1)),!s[t]))||(s[t]=!0,u.call(this,e))},"between"===e.method&&(l(e.args.after,e.args.before),e.accept=function(e){var t=Number(e);return!!s[t]||(s[t]=!0,u.call(this,e))});for(var c=0;c<r.length;c++){var d=new P(r[c],a).rezonedDate();if(!e.accept(new Date(d.getTime())))break}t.forEach((function(t){Q(e,t.options)}));var h=e._result;switch(o.sort(h),e.method){case"all":case"between":return h;case"before":return h.length&&h[h.length-1]||null;case"after":default:return h.length&&h[0]||null}}(e,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},t.prototype.rrule=function(e){he(e,this._rrule)},t.prototype.exrule=function(e){he(e,this._exrule)},t.prototype.rdate=function(e){fe(e,this._rdate)},t.prototype.exdate=function(e){fe(e,this._exdate)},t.prototype.rrules=function(){return this._rrule.map((function(e){return se(e.toString())}))},t.prototype.exrules=function(){return this._exrule.map((function(e){return se(e.toString())}))},t.prototype.rdates=function(){return this._rdate.map((function(e){return new Date(e.getTime())}))},t.prototype.exdates=function(){return this._exdate.map((function(e){return new Date(e.getTime())}))},t.prototype.valueOf=function(e){var t=[];return!this._rrule.length&&this._dtstart&&(t=t.concat(I({dtstart:this._dtstart}))),this._rrule.forEach((function(n){t=t.concat(n.toString(e).split("\n"))})),this._exrule.forEach((function(e){t=t.concat(e.toString().split("\n").map((function(e){return e.replace(/^RRULE:/,"EXRULE:")})).filter((function(e){return!/^DTSTART/.test(e)})))})),this._rdate.length&&t.push(pe("RDATE",this._rdate,this.tzid())),this._exdate.length&&t.push(pe("EXDATE",this._exdate,this.tzid())),t},t.prototype.toString=function(e){return this.valueOf(e).join("\n")},t.prototype.clone=function(){var e=new t(!!this._cache);return this._rrule.forEach((function(t){return e.rrule(t.clone())})),this._exrule.forEach((function(t){return e.exrule(t.clone())})),this._rdate.forEach((function(t){return e.rdate(new Date(t.getTime()))})),this._exdate.forEach((function(t){return e.exdate(new Date(t.getTime()))})),e},t}(ie);function he(e,t){if(!(e instanceof ie))throw new TypeError(String(e)+" is not RRule instance");Object(a.c)(t.map(String),String(e))||t.push(e)}function fe(e,t){if(!(e instanceof Date))throw new TypeError(String(e)+" is not Date instance");Object(a.c)(t.map(Number),Number(e))||(t.push(e),o.sort(t))}function pe(e,t,n){var r=!n||"UTC"===n.toUpperCase();return""+(r?e+":":e+";TZID="+n+":")+t.map((function(e){return o.timeToUntilString(e.valueOf(),r)})).join(",")}var ge=n(71);t.e=ie},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return c})),n.d(t,"g",(function(){return d}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(t){a(t)}}function s(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}function d(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}},function(e,t,n){"use strict";var r,i,a=n(5),o=n.n(a),s=n(6),u=n.n(s),l=n(0),c=n(7),d=n.n(c),h=n(8),f=n(1),p=(r=function(){function e(t,n){o()(this,e),this._batchConstructor=t,this._batchParams=n,this._batchedRequests={},this._successCB=l.default.emptyFn,this._failureCB=l.default.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=l.default.generateTempId()}return u()(e,[{key:"add",value:function(e,t,n){try{l.default.PAssert(2643,e,"Must provide a valid request to add to batch")}catch(i){l.default.reportError(i)}try{l.default.PAssert(2644,t,"Must supply a valid group ID when adding to a batch")}catch(i){l.default.reportError(i)}try{l.default.PAssert(2645,!this._hasRun,"Should never add new requests to a batch that has already run")}catch(i){l.default.reportError(i)}var r=this._ensureGroup(t);return this._addRequestToGroup(t,n,e),r}},{key:"then",value:function(e,t,n){this._successCB=e||l.default.newEmptyFn(),this._failureCB=t||l.default.newEmptyFn(),this._context=n,this._run()}},{key:"execute",value:function(e){this._successCB=e,this._failureCB=e,this._run()}},{key:"getBatchID",value:function(){return this._batchID}},{key:"_ensureGroup",value:function(e){var t=!1;return this._batchedRequests[e]||(this._batchedRequests[e]={size:0,batch:this._createBatchInternal()},t=!0),t}},{key:"_addRequestToGroup",value:function(e,t,n){var r=this._getGroupBatch(e),i=this._getGroupSize(e);try{l.default.PAssert(2646,i<=f.a.MaxBatchSize,"Too many requests for a single batch")}catch(a){l.default.reportError(a)}t?r.add(n,{id:t}):r.add(n)}},{key:"_getGroupBatch",value:function(e){try{l.default.PAssert(2647,this._batchedRequests[e],"Must ensure before querying")}catch(t){l.default.reportError(t)}return this._batchedRequests[e].batch}},{key:"_getGroupSize",value:function(e){try{l.default.PAssert(2648,this._batchedRequests[e],"Must ensure before querying")}catch(t){l.default.reportError(t)}return this._batchedRequests[e].size}},{key:"_run",value:function(){try{l.default.PAssert(2649,!this._hasRun,"Should never run a batch twice")}catch(t){l.default.reportError(t)}for(var e in this._hasRun=!0,this._batchedRequests){this._getGroupBatch(e).then(this._handleSuccess,this._handleFailure)}}},{key:"_createBatchInternal",value:function(){return new this._batchConstructor(this._batchParams)}},{key:"_handleSuccess",value:function(e){try{l.default.PAssert(2650,this._hasRun,"Must run batch before success")}catch(t){l.default.reportError(t)}this._successCB.call(this._context,e)}},{key:"_handleFailure",value:function(e){try{l.default.PAssert(2651,this._hasRun,"Must run batch before failure")}catch(t){l.default.reportError(t)}this._failureCB.call(this._context,e)}}]),e}(),d()(r.prototype,"_handleSuccess",[h.a],Object.getOwnPropertyDescriptor(r.prototype,"_handleSuccess"),r.prototype),d()(r.prototype,"_handleFailure",[h.a],Object.getOwnPropertyDescriptor(r.prototype,"_handleFailure"),r.prototype),r),g=n(3),v=n.n(g),m=n(10),y=n.n(m),_=n(27),b=function(){function e(t){var n=t.path,r=t.type,i=t.data,a=t.headers,s=t.accountID,u=t.scopes;o()(this,e),this.numRetries=0,this.path=n,this.type=r,this.data=i,this.headers=a,this.accountID=s,this.scopes=u}return u()(e,[{key:"setInBatch",value:function(e){this.idInBatch=e}},{key:"getAuthorizationHeader",value:function(){var e=y()(v.a.mark((function e(){var t=this;return v.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(this.accessToken){e.next=4;break}return e.next=3,new Promise((function(e){return _.a.getAccountAuthToken(t.accountID,t.scopes,(function(t){return e(null===t||void 0===t?void 0:t.access_token)}))}));case 3:this.accessToken=e.sent;case 4:return e.abrupt("return",this.accessToken?"Bearer "+this.accessToken:void 0);case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"then",value:function(){var e=y()(v.a.mark((function e(t,n){var r=this;return v.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.idInBatch){e.next=5;break}this.onFullfilled=t,this.onRejected=n,e.next=13;break;case 5:if(this.headers||(this.headers={}),this.headers["Content-Type"]||(this.headers["Content-Type"]="application/json"),this.headers.Authorization){e.next=11;break}return e.next=10,this.getAuthorizationHeader();case 10:this.headers.Authorization=e.sent;case 11:this.data&&l.default.isObject(this.data)&&(this.data=JSON.stringify(this.data)),l.default.XHR({url:"https://www.googleapis.com".concat(this.path),type:this.type,data:this.data,headers:this.headers}).then(function(){var e=y()(v.a.mark((function e(i){var a,o,s,u,l;return v.a.wrap((function(e){for(var c=0,d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!i.text){e.next=5;break}return e.next=3,i.text();case 3:a=e.sent;try{(a&&"{"===a[0]||"["===a[0])&&(o=JSON.parse(a))}catch(h){}case 5:i.error?n(i.error):(null===(s=o)||void 0===s||null===(u=s.error)||void 0===u||null===(l=u.message)||void 0===l?void 0:l.startsWith("Request had invalid authentication credentials."))&&r.numRetries<5?r.retry(t,n):t({body:a,status:i.status,result:o,headers:r.headers});case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),n);case 13:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"retry",value:function(e,t){var n=this;this.numRetries++,this.headers.Authorization=void 0,this.accessToken=void 0,setTimeout((function(){n.then(e,t)}),5e3)}},{key:"resolve",value:function(e){this.onFullfilled(e)}},{key:"reject",value:function(e){this.onRejected(e)}}]),e}(),w="MOOBOUNDARY",k=(i=function(){function e(t){var n=t.accountID,r=t.scopes;o()(this,e),this.requests={},this.accountID=n,this.scopes=r}return u()(e,[{key:"add",value:function(e,t){var n=t.id;this.requests[n]=e,e.setInBatch(n)}},{key:"then",value:function(){var e=y()(v.a.mark((function e(t,n){var r,i,a,o,s=this;return v.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:return this.onFulfilled=t,this.onRejected=n,r=this.requests[Object.keys(this.requests)[0]],this.requests,i="",e.next=7,r.getAuthorizationHeader();case 7:a=e.sent,Object.keys(this.requests).forEach((function(e){var t=s.requests[e],n="--".concat(w,"\n");n+="Content-Type: application/http\n",n+="Content-ID: <".concat(t.idInBatch,">\n");var r=t.type+" "+t.path+"\n";"GET"!==t.type&&(t.headers&&(t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json"),r+=Object.keys(t.headers).map((function(e){if("Authorization"!==e)return"".concat(e,": ").concat(t.headers[e],"\n")})).filter((function(e){return!!e})).join("")+"\n"),t.data&&(r+=JSON.stringify(t.data))),i+=n+="\n"+r+"\n",o||(o=t.path.split("/").slice(1,3).join("/"))})),i+="--".concat(w,"--");try{l.default.PAssert(2641,o&&"v"===o[o.length-2],"batch root does not have a version")}catch(c){l.default.reportError(c)}new b({path:"/batch/".concat(o),type:"POST",data:i,headers:{Authorization:a,"Content-Type":'multipart/mixed; boundary="MOOBOUNDARY"'},accountID:this.accountID,scopes:this.scopes}).then(this._handleSuccess,this._handleFail);case 13:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_handlePart",value:function(e){var t,n;try{var r=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1);t=e.match(/Content-ID: <response-([^>]+)>/)[1],n=e.match(/204 No Content/)?{status:204}:JSON.parse(r),e.includes('WWW-Authenticate: Bearer realm="https://accounts.google.com/", error=invalid_token')&&(n.isInvalidToken=!0),this.requests[t].resolve({result:n})}catch(i){t&&this.requests[t].reject({errors:[{message:e}]})}}},{key:"_handleSuccess",value:function(){var e=y()(v.a.mark((function e(t){var n,r,i;return v.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:n=t.body.trim(),r=n.substr(0,n.indexOf("\r\n")),(i=n.split(r)).shift(),i.pop(),i.forEach(this._handlePart),this.onFulfilled();case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleFail",value:function(e){this.onRejected(e)}}]),e}(),d()(i.prototype,"_handlePart",[h.a],Object.getOwnPropertyDescriptor(i.prototype,"_handlePart"),i.prototype),d()(i.prototype,"_handleSuccess",[h.a],Object.getOwnPropertyDescriptor(i.prototype,"_handleSuccess"),i.prototype),d()(i.prototype,"_handleFail",[h.a],Object.getOwnPropertyDescriptor(i.prototype,"_handleFail"),i.prototype),i),S=function(){function e(){o()(this,e),this._data={gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},export:{path:"/drive/v2/files/{fileId}/export",method:"GET",packedFn:["gapi","client","drive","files","export"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}},realtime:{get:{path:"/drive/v2/files/{fileId}/realtime",method:"GET",packedFn:["gapi","client","drive","realtime","get"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},move:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}/move",method:"POST",packedFn:["gapi","client","calendar","events","move"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}}return u()(e,[{key:"fns",value:function(e){return this._data.gapi.client[e]}},{key:"_constructPath",value:function(e,t){var n=l.default.clone(t);return Object.keys(t).forEach((function(r){var i=new RegExp("\\{"+r+"\\}"),a=e.replace(i,encodeURIComponent(t[r]));a!==e&&delete n[r],e=a})),delete n.resource,delete n.timeoutMS,delete n.forceNoDupe,{path:e,fields:n}}},{key:"_constructHeaders",value:function(e,t,n){try{l.default.PAssert(2073,t||n,"Must have either accountID or token")}catch(i){l.default.reportError(i)}var r={};return n&&(r.Authorization="Bearer "+n),e&&Object.keys(e).forEach((function(t){r[t]=e[t]})),r}},{key:"canConstruct",value:function(e){var t=!1;return l.default.isFunction(e)||(t=!!l.default.unpackFn(e,this._data)),t}},{key:"createRequest",value:function(e,t,n,r,i){var a,o=l.default.unpackFn(t,this._data);try{l.default.PAssert(2074,o,"Function should always be unpackable")}catch(d){l.default.reportError(d)}if(o){var s=this._constructPath(o.path,n),u=this._constructHeaders(o.headers,e,r),c={path:s.path,type:o.method||"GET",params:s.fields,data:n.resource,headers:u,accountID:e,scopes:i};a=this._sendRequest(c)}return a}},{key:"getAPIForRequest",value:function(e){try{l.default.PAssert(2075,l.default.isDemoMode(),"Must only reverse the path in demo mode")}catch(t){l.default.reportError(t)}return l.default.unpackFn(e.__packedFn)}},{key:"_sendRequest",value:function(e){var t=e.path,n=e.type,r=e.data,i=e.headers,a=e.params,o=e.accountID,s=e.scopes,u=Object.keys(a).filter((function(e){return void 0!==a[e]})).map((function(e){return"".concat(e,"=").concat(escape(a[e]))}));return u.length>0&&(t+="?"+u.join("&")),new b({accountID:o,scopes:s,path:t,type:n,data:r,headers:i})}},{key:"createBatch",value:function(e){return new p(k,e)}}]),e}();t.a=new S},function(e,t,n){const r=n(37);t.Parser=function(e){var t=(e=e||{}).strict;this.isStrictMode=function(){return 1==t},this.pattern=function(){return/./i},this.extract=function(e,t,n,r){return null},this.execute=function(e,t,n){for(var r=[],i=this.pattern(),a=e,o=i.exec(a);o;){o.index+=e.length-a.length;var s=this.extract(e,t,o,n);s?(a=e.substring(s.index+s.text.length),this.isStrictMode()&&!s.hasPossibleDates()||r.push(s)):a=e.substring(o.index+1),o=i.exec(a)}return this.refiners&&this.refiners.forEach((function(){r=refiner.refine(r,e,options)})),r}},t.findYearClosestToRef=function(e,t,n){const i=r(e);var a=i;const o=(a=(a=(a=a.month(n-1)).date(t)).year(i.year())).add(1,"y"),s=a.add(-1,"y");return Math.abs(o.diff(i))<Math.abs(a.diff(i))?a=o:Math.abs(s.diff(i))<Math.abs(a.diff(i))&&(a=s),a.year()},t.ENISOFormatParser=n(137).Parser,t.ENDeadlineFormatParser=n(138).Parser,t.ENRelativeDateFormatParser=n(139).Parser,t.ENMonthNameLittleEndianParser=n(140).Parser,t.ENMonthNameMiddleEndianParser=n(141).Parser,t.ENMonthNameParser=n(142).Parser,t.ENSlashDateFormatParser=n(143).Parser,t.ENSlashDateFormatStartWithYearParser=n(144).Parser,t.ENSlashMonthFormatParser=n(145).Parser,t.ENTimeAgoFormatParser=n(146).Parser,t.ENTimeExpressionParser=n(147).Parser,t.ENTimeLaterFormatParser=n(148).Parser,t.ENWeekdayParser=n(90).Parser,t.ENCasualDateParser=n(149).Parser,t.ENCasualTimeParser=n(150).Parser,t.JPStandardParser=n(151).Parser,t.JPCasualDateParser=n(153).Parser,t.PTCasualDateParser=n(154).Parser,t.PTDeadlineFormatParser=n(155).Parser,t.PTMonthNameLittleEndianParser=n(156).Parser,t.PTSlashDateFormatParser=n(158).Parser,t.PTTimeAgoFormatParser=n(159).Parser,t.PTTimeExpressionParser=n(160).Parser,t.PTWeekdayParser=n(161).Parser,t.ESCasualDateParser=n(162).Parser,t.ESDeadlineFormatParser=n(163).Parser,t.ESTimeAgoFormatParser=n(164).Parser,t.ESTimeExpressionParser=n(165).Parser,t.ESWeekdayParser=n(166).Parser,t.ESMonthNameLittleEndianParser=n(167).Parser,t.ESSlashDateFormatParser=n(169).Parser,t.FRCasualDateParser=n(170).Parser,t.FRDeadlineFormatParser=n(171).Parser,t.FRMonthNameLittleEndianParser=n(172).Parser,t.FRSlashDateFormatParser=n(173).Parser,t.FRTimeAgoFormatParser=n(174).Parser,t.FRTimeExpressionParser=n(175).Parser,t.FRWeekdayParser=n(176).Parser,t.FRRelativeDateFormatParser=n(177).Parser,t.ZHHantDateParser=n(179).Parser,t.ZHHantWeekdayParser=n(180).Parser,t.ZHHantTimeExpressionParser=n(181).Parser,t.ZHHantCasualDateParser=n(182).Parser,t.ZHHantDeadlineFormatParser=n(183).Parser,t.DEDeadlineFormatParser=n(184).Parser,t.DEMonthNameLittleEndianParser=n(185).Parser,t.DEMonthNameParser=n(186).Parser,t.DESlashDateFormatParser=n(187).Parser,t.DETimeAgoFormatParser=n(188).Parser,t.DETimeExpressionParser=n(189).Parser,t.DEWeekdayParser=n(190).Parser,t.DECasualDateParser=n(191).Parser},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(17),u=n.n(s),l=n(18),c=n.n(l),d=n(19),h=n.n(d),f=n(11),p=n.n(f),g=n(0);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var m=function(e){c()(n,e);var t=v(n);function n(e,r,a){var o;return i()(this,n),(o=t.call(this,e,r,a))._value=e||[],o.version=0,o}return o()(n,[{key:"notify",value:function(e,t,r){0===arguments.length&&this.version++,u()(p()(n.prototype),"notify",this).apply(this,arguments)}},{key:"length",value:function(){return this._value.length}},{key:"set",value:function(e,t){try{g.default.PAssert(417,e&&g.default.isArray(e),"Value set on an Observable array must be an array",e)}catch(n){g.default.reportError(n)}return this._value=e,this.version++,!1!==t&&this.notify(this._value),e}},{key:"clear",value:function(e){this.set([],e)}},{key:"pop",value:function(e){this.version++;var t=this._value.pop();return!1!==e&&this.notify(this._value),t}},{key:"remove",value:function(e,t){var n;if(g.default.isFunction(e))for(var r=0,i=0;i<this._value.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e(this._value[i])&&(void 0===n&&(n=i),this._value.splice(i,1),i--)}else n=this._value.remove(e);return this.version++,n>=0&&!1!==t&&this.notify(this._value),n}},{key:"removeAt",value:function(e,t){var n=this._value.removeAt(e);return this.version++,!1!==t&&this.notify(this._value),n}},{key:"push",value:function(e,t){var n=this._value.push(e);return this.version++,!1!==t&&this.notify(this._value),n}},{key:"pushArray",value:function(e,t){var n=this._value.pushArray(e);return this.version++,!1!==t&&this.notify(this._value),n}},{key:"insertSorted",value:function(e,t,n){var r=this._value.insertSorted(e,t);return this.version++,!1!==n&&this.notify(this._value),r}},{key:"sort",value:function(e,t){return this._value.sort(e),this.version++,!1!==t&&this.notify(this._value),this}},{key:"splice",value:function(e,t,n,r){var i;return i=n?this._value.splice(e,t,n):this._value.splice(e,t),this.version++,!1!==r&&this.notify(this._value),i}},{key:"indexOf",value:function(e){return this._value.indexOf(e)}},{key:"indexOfWithProperty",value:function(e,t){return this._value.indexOfWithProperty(e,t)}},{key:"includes",value:function(e){return this._value.includes(e)}},{key:"some",value:function(e){return this._value.some(e)}},{key:"forEach",value:function(e){return this._value.forEach(e)}},{key:"map",value:function(e){return this._value.map(e)}},{key:"find",value:function(e){return this._value.find(e)}},{key:"findIndex",value:function(e){return this._value.findIndex(e)}},{key:"hasValue",value:function(){return this._value.length>0}}]),n}(n(13).a);t.a=m},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";var r,i,a=n(29),o=n(9),s=n(61),u=n(81),l=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r["invalid-log-argument"]="First argument to `onLog` must be null or a function.",r),c=new o.b("app","Firebase",l),d="@firebase/app",h="[DEFAULT]",f=((i={})[d]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),p=new u.b("@firebase/app"),g=function(){function e(e,t,n){var r,i,u=this;this.firebase_=n,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=Object(o.k)(e),this.container=new s.b(t.name),this._addComponent(new s.a("app",(function(){return u}),"PUBLIC"));try{for(var l=Object(a.h)(this.firebase_.INTERNAL.components.values()),c=l.next();!c.done;c=l.next()){var d=c.value;this._addComponent(d)}}catch(h){r={error:h}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_(),t()})).then((function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map((function(e){return e.delete()})))})).then((function(){e.isDeleted_=!0}))},e.prototype._getService=function(e,t){return void 0===t&&(t=h),this.checkDestroyed_(),this.container.getProvider(e).getImmediate({identifier:t})},e.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=h),this.container.getProvider(e).clearInstance(t)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){p.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw c.create("app-deleted",{appName:this.name_})},e}();g.prototype.name&&g.prototype.options||g.prototype.delete||console.log("dc");var v=function e(){var t=function(e){var t={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"===typeof i&&null!==i||(i={name:i});var a=i;void 0===a.name&&(a.name=h);var s=a.name;if("string"!==typeof s||!s)throw c.create("bad-app-name",{appName:String(s)});if(Object(o.i)(t,s))throw c.create("duplicate-app",{appName:s});var u=new e(n,a,r);return t[s]=u,u},app:i,registerVersion:function(e,t,n){var r,i=null!==(r=f[e])&&void 0!==r?r:e;n&&(i+="-"+n);var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var u=['Unable to register library "'+i+'" with version "'+t+'":'];return a&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),a&&o&&u.push("and"),o&&u.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void p.warn(u.join(" "))}l(new s.a(i+"-version",(function(){return{library:i,version:t}}),"VERSION"))},setLogLevel:u.c,onLog:function(e,t){if(null!==e&&"function"!==typeof e)throw c.create("invalid-log-argument",{appName:name});Object(u.d)(e,t)},apps:null,SDK_VERSION:"8.0.0",INTERNAL:{registerComponent:l,removeApp:function(e){delete t[e]},components:n,useAsService:function(e,t){return"serverAuth"===t?null:t}}};function i(e){if(e=e||h,!Object(o.i)(t,e))throw c.create("no-app",{appName:e});return t[e]}function l(s){var u,l,d=s.name;if(n.has(d))return p.debug("There were multiple attempts to register component "+d+"."),"PUBLIC"===s.type?r[d]:null;if(n.set(d,s),"PUBLIC"===s.type){var h=function(e){if(void 0===e&&(e=i()),"function"!==typeof e[d])throw c.create("invalid-app-argument",{appName:d});return e[d]()};void 0!==s.serviceProps&&Object(o.l)(h,s.serviceProps),r[d]=h,e.prototype[d]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._getService.bind(this,d).apply(this,s.multipleInstances?e:[])}}try{for(var f=Object(a.h)(Object.keys(t)),g=f.next();!g.done;g=f.next()){var v=g.value;t[v]._addComponent(s)}}catch(m){u={error:m}}finally{try{g&&!g.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}return"PUBLIC"===s.type?r[d]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(t).map((function(e){return t[e]}))}}),i.App=e,r}(g);return t.INTERNAL=Object(a.a)(Object(a.a)({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(o.l)(t,e)},createSubscribe:o.j,ErrorFactory:o.b,deepExtend:o.l}),t}(),m=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return t.library+"/"+t.version}return null})).filter((function(e){return e})).join(" ")},e}();if(Object(o.o)()&&void 0!==self.firebase){p.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var y=self.firebase.SDK_VERSION;y&&y.indexOf("LITE")>=0&&p.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var _=v.initializeApp;v.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(o.r)()&&p.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),_.apply(void 0,e)};var b=v;!function(e,t){e.INTERNAL.registerComponent(new s.a("platform-logger",(function(e){return new m(e)}),"PRIVATE")),e.registerVersion(d,"0.6.12",t),e.registerVersion("fire-js","")}(b),t.a=b},function(e,t,n){"use strict";var r=n(34);r.a.registerVersion("firebase","8.0.0","app");n(132);var i=n(29),a=n(9),o=n(61),s="firebasestorage.googleapis.com",u=function(e){function t(n,r){var i=e.call(this,I(n),"Firebase Storage: "+r)||this;return i.customData={serverResponse:null},Object.setPrototypeOf(i,t.prototype),i}return Object(i.c)(t,e),t.prototype.codeEquals=function(e){return I(e)===this.code},Object.defineProperty(t.prototype,"message",{get:function(){return this.customData.serverResponse?this.message+"\n"+this.customData.serverResponse:this.message},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(e){this.customData.serverResponse=e},enumerable:!1,configurable:!0}),t}(a.c),l="unknown",c="object-not-found",d="quota-exceeded",h="unauthenticated",f="unauthorized",p="retry-limit-exceeded",g="canceled",v="invalid-url",m="invalid-default-bucket",y="cannot-slice-blob",_="server-file-wrong-size",b="no-download-url",w="invalid-argument",k="app-deleted",S="invalid-root-operation",E="invalid-format",P="internal-error";function I(e){return"storage/"+e}function D(){return new u(l,"An unknown error occurred, please check the error payload for server response.")}function T(){return new u(g,"User canceled the upload/download.")}function x(){return new u(y,"Cannot slice blob for upload. Please retry the upload.")}function C(){return new u(k,"The Firebase app was deleted.")}function A(e,t){return new u(E,"String does not match format '"+e+"': "+t)}function L(e){throw new u(P,"Internal error: "+e)}var O={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},M=function(e,t){this.data=e,this.contentType=t||null};function R(e,t){switch(e){case O.RAW:return new M(F(t));case O.BASE64:case O.BASE64URL:return new M(N(e,t));case O.DATA_URL:return new M(function(e){var t=new j(e);return t.base64?N(O.BASE64,t.rest):function(e){var t;try{t=decodeURIComponent(e)}catch(n){throw A(O.DATA_URL,"Malformed data URL.")}return F(t)}(t.rest)}(t),new j(t).contentType)}throw D()}function F(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296===(64512&r))if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else t.push(239,191,189);else 56320===(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function N(e,t){switch(e){case O.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw A(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case O.BASE64URL:var i=-1!==t.indexOf("+"),a=-1!==t.indexOf("/");if(i||a)throw A(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var o;try{o=atob(t)}catch(l){throw A(e,"Invalid character found")}for(var s=new Uint8Array(o.length),u=0;u<o.length;u++)s[u]=o.charCodeAt(u);return s}var j=function(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw A(O.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=t[1]||null;null!=n&&(this.base64=(r=n,i=";base64",r.length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1);var r,i};var U,B={STATE_CHANGED:"state_changed"},V="running",H="pausing",W="paused",q="success",z="canceling",G="canceled",K="error",Y={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Q(e){switch(e){case V:case H:case z:return Y.RUNNING;case W:return Y.PAUSED;case q:return Y.SUCCESS;case G:return Y.CANCELED;case K:default:return Y.ERROR}}function X(e){return null!=e}function $(e){return"string"===typeof e||e instanceof String}function J(e){return Z()&&e instanceof Blob}function Z(){return"undefined"!==typeof Blob}function ee(e,t,n,r){if(r<t)throw new u(w,"Invalid value for '"+e+"'. Expected "+t+" or greater.");if(r>n)throw new u(w,"Invalid value for '"+e+"'. Expected "+n+" or less.")}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(U||(U={}));var te=function(){function e(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=U.NO_ERROR,this.sendPromise_=new Promise((function(t){e.xhr_.addEventListener("abort",(function(){e.errorCode_=U.ABORT,t(e)})),e.xhr_.addEventListener("error",(function(){e.errorCode_=U.NETWORK_ERROR,t(e)})),e.xhr_.addEventListener("load",(function(){t(e)}))}))}return e.prototype.send=function(e,t,n,r){if(this.sent_)throw L("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),X(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return X(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},e.prototype.getErrorCode=function(){if(!this.sent_)throw L("cannot .getErrorCode() before sending");return this.errorCode_},e.prototype.getStatus=function(){if(!this.sent_)throw L("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}},e.prototype.getResponseText=function(){if(!this.sent_)throw L("cannot .getResponseText() before sending");return this.xhr_.responseText},e.prototype.abort=function(){this.xhr_.abort()},e.prototype.getResponseHeader=function(e){return this.xhr_.getResponseHeader(e)},e.prototype.addUploadProgressListener=function(e){X(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",e)},e.prototype.removeUploadProgressListener=function(e){X(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",e)},e}(),ne=function(){function e(){}return e.prototype.createXhrIo=function(){return new te},e}();function re(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function ie(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=re();if(void 0!==n){for(var r=new n,i=0;i<e.length;i++)r.append(e[i]);return r.getBlob()}if(Z())return new Blob(e);throw Error("This browser doesn't seem to support creating Blobs")}var ae=function(){function e(e,t){var n=0,r="";J(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}return e.prototype.size=function(){return this.size_},e.prototype.type=function(){return this.type_},e.prototype.slice=function(t,n){if(J(this.data_)){var r=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,t,n);return null===r?null:new e(r)}return new e(new Uint8Array(this.data_.buffer,t,n-t),!0)},e.getBlob=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(Z()){var r=t.map((function(t){return t instanceof e?t.data_:t}));return new e(ie.apply(null,r))}var i=t.map((function(e){return $(e)?R(O.RAW,e).data:e.data_})),a=0;i.forEach((function(e){a+=e.byteLength}));var o=new Uint8Array(a),s=0;return i.forEach((function(e){for(var t=0;t<e.length;t++)o[s++]=e[t]})),new e(o,!0)},e.prototype.uploadData=function(){return this.data_},e}(),oe=function(){function e(e,t){this.bucket=e,this.path_=t}return Object.defineProperty(e.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),e.prototype.fullServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)},e.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},e.makeFromBucketSpec=function(t){var n;try{n=e.makeFromUrl(t)}catch(r){return new e(t,"")}if(""===n.path)return n;throw new u(m,"Invalid default bucket '"+t+"'.")},e.makeFromUrl=function(t){var n=null,r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function a(e){e.path_=decodeURIComponent(e.path)}for(var o=s.replace(/[.]/g,"\\."),l=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+o+"/v[A-Za-z0-9_]+/b/"+r+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:a},{regex:new RegExp("^https?://(?:storage.googleapis.com|storage.cloud.google.com)/"+r+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:a}],c=0;c<l.length;c++){var d=l[c],h=d.regex.exec(t);if(h){var f=h[d.indices.bucket],p=h[d.indices.path];p||(p=""),n=new e(f,p),d.postModify(n);break}}if(null==n)throw function(e){return new u(v,"Invalid URL '"+e+"'.")}(t);return n},e}();function se(e){var t,n;try{t=JSON.parse(e)}catch(r){return null}return"object"!==typeof(n=t)||Array.isArray(n)?null:t}function ue(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function le(e){return"https://"+s+"/v0"+e}function ce(e){var t=encodeURIComponent,n="?";for(var r in e){if(e.hasOwnProperty(r))n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1)}function de(e,t){return t}var he=function(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||de},fe=null;function pe(){if(fe)return fe;var e=[];e.push(new he("bucket")),e.push(new he("generation")),e.push(new he("metageneration")),e.push(new he("name","fullPath",!0));var t=new he("name");t.xform=function(e,t){return function(e){return!$(e)||e.length<2?e:ue(e)}(t)},e.push(t);var n=new he("size");return n.xform=function(e,t){return X(t)?Number(t):t},e.push(n),e.push(new he("timeCreated")),e.push(new he("updated")),e.push(new he("md5Hash",null,!0)),e.push(new he("cacheControl",null,!0)),e.push(new he("contentDisposition",null,!0)),e.push(new he("contentEncoding",null,!0)),e.push(new he("contentLanguage",null,!0)),e.push(new he("contentType",null,!0)),e.push(new he("metadata","customMetadata",!0)),fe=e}function ge(e,t,n){for(var r={type:"file"},i=n.length,a=0;a<i;a++){var o=n[a];r[o.local]=o.xform(r,t[o.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){var n=e.bucket,r=e.fullPath,i=new oe(n,r);return t.makeStorageReference(i)}})}(r,e),r}function ve(e,t,n){var r=se(t);return null===r?null:ge(e,r,n)}function me(e,t){for(var n={},r=t.length,i=0;i<r;i++){var a=t[i];a.writable&&(n[a.server]=e[a.local])}return JSON.stringify(n)}function ye(e,t,n){var r=se(n);return null===r?null:function(e,t,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(var i=0,a=n.prefixes;i<a.length;i++){var o=a[i].replace(/\/$/,""),s=e.makeStorageReference(new oe(t,o));r.prefixes.push(s)}if(n.items)for(var u=0,l=n.items;u<l.length;u++){var c=l[u];s=e.makeStorageReference(new oe(t,c.name)),r.items.push(s)}return r}(e,t,r)}var _e=function(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function be(e){if(!e)throw D()}function we(e,t){return function(n,r){var i=ve(e,r,t);return be(null!==i),i}}function ke(e,t){return function(n,r){var i=ve(e,r,t);return be(null!==i),function(e,t){var n=se(t);if(null===n)return null;if(!$(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map((function(t){var n=e.bucket,r=e.fullPath;return le("/b/"+i(n)+"/o/"+i(r))+ce({alt:"media",token:t})}))[0]}(i,r)}}function Se(e){return function(t,n){var r,i,a;return 401===t.getStatus()?r=new u(h,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(a=e.bucket,r=new u(d,"Quota for bucket '"+a+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new u(f,"User does not have permission to access '"+i+"'.")):r=n,r.serverResponse=n.serverResponse,r}}function Ee(e){var t=Se(e);return function(n,r){var i,a=t(n,r);return 404===n.getStatus()&&(i=e.path,a=new u(c,"Object '"+i+"' does not exist.")),a.serverResponse=r.serverResponse,a}}function Pe(e,t,n){var r=le(t.fullServerUrl()),i=e.maxOperationRetryTime,a=new _e(r,"GET",we(e,n),i);return a.errorHandler=Ee(t),a}function Ie(e,t,n,r,i){var a={};t.isRoot?a.prefix="":a.prefix=t.path+"/",n&&n.length>0&&(a.delimiter=n),r&&(a.pageToken=r),i&&(a.maxResults=i);var o=le(t.bucketOnlyServerUrl()),s=e.maxOperationRetryTime,u=new _e(o,"GET",function(e,t){return function(n,r){var i=ye(e,t,r);return be(null!==i),i}}(e,t.bucket),s);return u.urlParams=a,u.errorHandler=Se(t),u}function De(e,t,n){var r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}var Te=function(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null};function xe(e,t){var n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(r){be(!1)}return be(!!n&&-1!==(t||["active"]).indexOf(n)),n}var Ce=262144;function Ae(e,t,n,r,i,a,o,s){var l=new Te(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw new u(_,"Server recorded incorrect upload file size, please retry the upload.");var c=l.total-l.current,d=c;i>0&&(d=Math.min(d,i));var h=l.current,f=h+d,p={"X-Goog-Upload-Command":d===c?"upload, finalize":"upload","X-Goog-Upload-Offset":l.current},g=r.slice(h,f);if(null===g)throw x();var v=t.maxUploadRetryTime,m=new _e(n,"POST",(function(e,n){var i,o=xe(e,["active","final"]),s=l.current+d,u=r.size();return i="final"===o?we(t,a)(e,n):null,new Te(s,u,"final"===o,i)}),v);return m.headers=p,m.body=g.uploadData(),m.progressCallback=s||null,m.errorHandler=Se(e),m}var Le=function(e,t,n){if("function"===typeof e||X(t)||X(n))this.next=e,this.error=t||null,this.complete=n||null;else{var r=e;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},Oe=function(e,t,n,r,i,a){this.bytesTransferred=e,this.totalBytes=t,this.state=n,this.metadata=r,this.task=i,this.ref=a};function Me(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Promise.resolve().then((function(){return e.apply(void 0,t)}))}}var Re=function(){function e(e,t,n,r,i,a){var o=this;void 0===a&&(a=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=e,this.service_=t,this.location_=n,this.blob_=i,this.metadata_=a,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=V,this.errorHandler_=function(e){o.request_=null,o.chunkMultiplier_=1,e.codeEquals(g)?(o.needToFetchStatus_=!0,o.completeTransitions_()):(o.error_=e,o.transition_(K))},this.metadataErrorHandler_=function(e){o.request_=null,e.codeEquals(g)?o.completeTransitions_():(o.error_=e,o.transition_(K))},this.promise_=new Promise((function(e,t){o.resolve_=e,o.reject_=t,o.start_()})),this.promise_.then(null,(function(){}))}return e.prototype.makeProgressCallback_=function(){var e=this,t=this.transferred_;return function(n){return e.updateProgress_(t+n)}},e.prototype.shouldDoResumable_=function(e){return e.size()>262144},e.prototype.start_=function(){this.state_===V&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},e.prototype.resolveToken_=function(e){var t=this;this.service_.getAuthToken().then((function(n){switch(t.state_){case V:e(n);break;case z:t.transition_(G);break;case H:t.transition_(W)}}))},e.prototype.createResumable_=function(){var e=this;this.resolveToken_((function(t){var n=function(e,t,n,r,i){var a=t.bucketOnlyServerUrl(),o=De(t,r,i),s={name:o.fullPath},u=le(a),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},c=me(o,n),d=e.maxUploadRetryTime,h=new _e(u,"POST",(function(e){var t;xe(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(n){be(!1)}return be($(t)),t}),d);return h.urlParams=s,h.headers=l,h.body=c,h.errorHandler=Se(t),h}(e.service_,e.location_,e.mappings_,e.blob_,e.metadata_),r=e.service_.makeRequest(n,t);e.request_=r,r.getPromise().then((function(t){e.request_=null,e.uploadUrl_=t,e.needToFetchStatus_=!1,e.completeTransitions_()}),e.errorHandler_)}))},e.prototype.fetchStatus_=function(){var e=this,t=this.uploadUrl_;this.resolveToken_((function(n){var r=function(e,t,n,r){var i=e.maxUploadRetryTime,a=new _e(n,"POST",(function(e){var t=xe(e,["active","final"]),n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(a){be(!1)}n||be(!1);var i=Number(n);return be(!isNaN(i)),new Te(i,r.size(),"final"===t)}),i);return a.headers={"X-Goog-Upload-Command":"query"},a.errorHandler=Se(t),a}(e.service_,e.location_,t,e.blob_),i=e.service_.makeRequest(r,n);e.request_=i,i.getPromise().then((function(t){t=t,e.request_=null,e.updateProgress_(t.current),e.needToFetchStatus_=!1,t.finalized&&(e.needToFetchMetadata_=!0),e.completeTransitions_()}),e.errorHandler_)}))},e.prototype.continueUpload_=function(){var e=this,t=Ce*this.chunkMultiplier_,n=new Te(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_((function(i){var a;try{a=Ae(e.location_,e.service_,r,e.blob_,t,e.mappings_,n,e.makeProgressCallback_())}catch(s){return e.error_=s,void e.transition_(K)}var o=e.service_.makeRequest(a,i);e.request_=o,o.getPromise().then((function(t){e.increaseMultiplier_(),e.request_=null,e.updateProgress_(t.current),t.finalized?(e.metadata_=t.metadata,e.transition_(q)):e.completeTransitions_()}),e.errorHandler_)}))},e.prototype.increaseMultiplier_=function(){Ce*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},e.prototype.fetchMetadata_=function(){var e=this;this.resolveToken_((function(t){var n=Pe(e.service_,e.location_,e.mappings_),r=e.service_.makeRequest(n,t);e.request_=r,r.getPromise().then((function(t){e.request_=null,e.metadata_=t,e.transition_(q)}),e.metadataErrorHandler_)}))},e.prototype.oneShotUpload_=function(){var e=this;this.resolveToken_((function(t){var n=function(e,t,n,r,i){var a=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var e="",t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+s;var u=De(t,r,i),l="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+me(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",c="\r\n--"+s+"--",d=ae.getBlob(l,r,c);if(null===d)throw x();var h={name:u.fullPath},f=le(a),p=e.maxUploadRetryTime,g=new _e(f,"POST",we(e,n),p);return g.urlParams=h,g.headers=o,g.body=d.uploadData(),g.errorHandler=Se(t),g}(e.service_,e.location_,e.mappings_,e.blob_,e.metadata_),r=e.service_.makeRequest(n,t);e.request_=r,r.getPromise().then((function(t){e.request_=null,e.metadata_=t,e.updateProgress_(e.blob_.size()),e.transition_(q)}),e.errorHandler_)}))},e.prototype.updateProgress_=function(e){var t=this.transferred_;this.transferred_=e,this.transferred_!==t&&this.notifyObservers_()},e.prototype.transition_=function(e){if(this.state_!==e)switch(e){case z:case H:this.state_=e,null!==this.request_&&this.request_.cancel();break;case V:var t=this.state_===W;this.state_=e,t&&(this.notifyObservers_(),this.start_());break;case W:this.state_=e,this.notifyObservers_();break;case G:this.error_=T(),this.state_=e,this.notifyObservers_();break;case K:case q:this.state_=e,this.notifyObservers_()}},e.prototype.completeTransitions_=function(){switch(this.state_){case H:this.transition_(W);break;case z:this.transition_(G);break;case V:this.start_()}},Object.defineProperty(e.prototype,"snapshot",{get:function(){var e=Q(this.state_);return new Oe(this.transferred_,this.blob_.size(),e,this.metadata_,this,this.ref_)},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t,n,r){var i=this,a=new Le(t,n,r);return this.addObserver_(a),function(){i.removeObserver_(a)}},e.prototype.then=function(e,t){return this.promise_.then(e,t)},e.prototype.catch=function(e){return this.then(null,e)},e.prototype.addObserver_=function(e){this.observers_.push(e),this.notifyObserver_(e)},e.prototype.removeObserver_=function(e){var t=this.observers_.indexOf(e);-1!==t&&this.observers_.splice(t,1)},e.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach((function(t){e.notifyObserver_(t)}))},e.prototype.finishPromise_=function(){if(null!==this.resolve_){var e=!0;switch(Q(this.state_)){case Y.SUCCESS:Me(this.resolve_.bind(null,this.snapshot))();break;case Y.CANCELED:case Y.ERROR:Me(this.reject_.bind(null,this.error_))();break;default:e=!1}e&&(this.resolve_=null,this.reject_=null)}},e.prototype.notifyObserver_=function(e){switch(Q(this.state_)){case Y.RUNNING:case Y.PAUSED:e.next&&Me(e.next.bind(e,this.snapshot))();break;case Y.SUCCESS:e.complete&&Me(e.complete.bind(e))();break;case Y.CANCELED:case Y.ERROR:e.error&&Me(e.error.bind(e,this.error_))();break;default:e.error&&Me(e.error.bind(e,this.error_))()}},e.prototype.resume=function(){var e=this.state_===W||this.state_===H;return e&&this.transition_(V),e},e.prototype.pause=function(){var e=this.state_===V;return e&&this.transition_(H),e},e.prototype.cancel=function(){var e=this.state_===V||this.state_===H;return e&&this.transition_(z),e},e}(),Fe=function(){function e(e,t){this.service=e,this.location=t instanceof oe?t:oe.makeFromUrl(t)}return e.prototype.toString=function(){return"gs://"+this.location.bucket+"/"+this.location.path},e.prototype.newRef=function(t,n){return new e(t,n)},e.prototype.mappings=function(){return pe()},e.prototype.child=function(e){var t=function(e,t){var n=t.split("/").filter((function(e){return e.length>0})).join("/");return 0===e.length?n:e+"/"+n}(this.location.path,e),n=new oe(this.location.bucket,t);return this.newRef(this.service,n)},Object.defineProperty(e.prototype,"parent",{get:function(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this.location.path);if(null===e)return null;var t=new oe(this.location.bucket,e);return this.newRef(this.service,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){var e=new oe(this.location.bucket,"");return this.newRef(this.service,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return ue(this.location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"storage",{get:function(){return this.service},enumerable:!1,configurable:!0}),e.prototype.put=function(e,t){return void 0===t&&(t=null),this.throwIfRoot_("put"),new Re(this,this.service,this.location,this.mappings(),new ae(e),t)},e.prototype.putString=function(e,t,n){void 0===t&&(t=O.RAW),this.throwIfRoot_("putString");var r=R(t,e),i=Object.assign({},n);return!X(i.contentType)&&X(r.contentType)&&(i.contentType=r.contentType),new Re(this,this.service,this.location,this.mappings(),new ae(r.data,!0),i)},e.prototype.delete=function(){var e=this;return this.throwIfRoot_("delete"),this.service.getAuthToken().then((function(t){var n=function(e,t){var n=le(t.fullServerUrl()),r=e.maxOperationRetryTime,i=new _e(n,"DELETE",(function(e,t){}),r);return i.successCodes=[200,204],i.errorHandler=Ee(t),i}(e.service,e.location);return e.service.makeRequest(n,t).getPromise()}))},e.prototype.listAll=function(){var e={prefixes:[],items:[]};return this.listAllHelper(e).then((function(){return e}))},e.prototype.listAllHelper=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var n,r,a,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n={pageToken:t},[4,this.list(n)];case 1:return r=i.sent(),(a=e.prefixes).push.apply(a,r.prefixes),(o=e.items).push.apply(o,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(e,r.nextPageToken)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},e.prototype.list=function(e){var t=this,n=e||{};return"number"===typeof n.maxResults&&ee("options.maxResults",1,1e3,n.maxResults),this.service.getAuthToken().then((function(e){var r=Ie(t.service,t.location,"/",n.pageToken,n.maxResults);return t.service.makeRequest(r,e).getPromise()}))},e.prototype.getMetadata=function(){var e=this;return this.throwIfRoot_("getMetadata"),this.service.getAuthToken().then((function(t){var n=Pe(e.service,e.location,e.mappings());return e.service.makeRequest(n,t).getPromise()}))},e.prototype.updateMetadata=function(e){var t=this;return this.throwIfRoot_("updateMetadata"),this.service.getAuthToken().then((function(n){var r=function(e,t,n,r){var i=le(t.fullServerUrl()),a=me(n,r),o=e.maxOperationRetryTime,s=new _e(i,"PATCH",we(e,r),o);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=a,s.errorHandler=Ee(t),s}(t.service,t.location,e,t.mappings());return t.service.makeRequest(r,n).getPromise()}))},e.prototype.getDownloadURL=function(){var e=this;return this.throwIfRoot_("getDownloadURL"),this.service.getAuthToken().then((function(t){var n=function(e,t,n){var r=le(t.fullServerUrl()),i=e.maxOperationRetryTime,a=new _e(r,"GET",ke(e,n),i);return a.errorHandler=Ee(t),a}(e.service,e.location,e.mappings());return e.service.makeRequest(n,t).getPromise().then((function(e){if(null===e)throw new u(b,"The given file does not have any download URLs.");return e}))}))},e.prototype.throwIfRoot_=function(e){if(""===this.location.path)throw function(e){return new u(S,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)},e}(),Ne=function(){function e(e){this.promise_=Promise.reject(e)}return e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){},e}();var je=function(){function e(e,t,n,r,i,a,o,s,u,l,c){var d=this;this.pendingXhr_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=a.slice(),this.callback_=o,this.errorCallback_=s,this.progressCallback_=l,this.timeout_=u,this.pool_=c,this.promise_=new Promise((function(e,t){d.resolve_=e,d.reject_=t,d.start_()}))}return e.prototype.start_=function(){var e=this;function t(t,n){var r,i=e.resolve_,a=e.reject_,o=n.xhr;if(n.wasSuccessCode)try{var s=e.callback_(o,o.getResponseText());void 0!==s?i(s):i()}catch(l){a(l)}else null!==o?((r=D()).serverResponse=o.getResponseText(),e.errorCallback_?a(e.errorCallback_(o,r)):a(r)):n.canceled?a(r=e.appDelete_?C():T()):a(r=new u(p,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new Ue(!1,null,!0)):this.backoffId_=function(e,t,n){var r=1,a=null,o=!1,s=0;function u(){return 2===s}var l=!1;function c(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];l||(l=!0,t.apply(null,e))}function d(t){a=setTimeout((function(){a=null,e(h,u())}),t)}function h(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!l)if(e)c.call.apply(c,Object(i.g)([null,e],t));else{var a;u()||o?c.call.apply(c,Object(i.g)([null,e],t)):(r<64&&(r*=2),1===s?(s=2,a=0):a=1e3*(r+Math.random()),d(a))}}var f=!1;function p(e){f||(f=!0,l||(null!==a?(e||(s=2),clearTimeout(a),d(0)):e||(s=1)))}return d(0),setTimeout((function(){o=!0,p(!0)}),n),p}((function(t,n){if(n)t(!1,new Ue(!1,null,!0));else{var r=e.pool_.createXhrIo();e.pendingXhr_=r,null!==e.progressCallback_&&r.addUploadProgressListener(i),r.send(e.url_,e.method_,e.body_,e.headers_).then((function(n){null!==e.progressCallback_&&n.removeUploadProgressListener(i),e.pendingXhr_=null;var r=(n=n).getErrorCode()===U.NO_ERROR,a=n.getStatus();if(r&&!e.isRetryStatusCode_(a)){var o=-1!==e.successCodes_.indexOf(a);t(!0,new Ue(o,n))}else{var s=n.getErrorCode()===U.ABORT;t(!1,new Ue(!1,null,s))}}))}function i(t){var n=t.loaded,r=t.lengthComputable?t.total:-1;null!==e.progressCallback_&&e.progressCallback_(n,r)}}),t,this.timeout_)},e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},e.prototype.isRetryStatusCode_=function(e){var t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r},e}(),Ue=function(e,t,n){this.wasSuccessCode=e,this.xhr=t,this.canceled=!!n};function Be(e,t,n,i){var a=ce(e.urlParams),o=e.url+a,s=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(s,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(s,n),function(e){var t="undefined"!==typeof r.a?r.a.SDK_VERSION:"AppManager";e["X-Firebase-Storage-Version"]="webjs/"+t}(s),new je(o,e.method,s,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i)}var Ve=function(){function e(t,n,r,i){var a;this.bucket_=null,this.appId_=null,this.deleted_=!1,this.app_=t,this.authProvider_=n,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requests_=new Set,this.pool_=r,this.bucket_=null!=i?oe.makeFromBucketSpec(i):e.extractBucket_(null===(a=this.app_)||void 0===a?void 0:a.options),this.internals_=new He(this)}return e.extractBucket_=function(e){var t=null===e||void 0===e?void 0:e.storageBucket;return null==t?null:oe.makeFromBucketSpec(t)},e.prototype.getAuthToken=function(){return Object(i.b)(this,void 0,void 0,(function(){var e,t;return Object(i.d)(this,(function(n){switch(n.label){case 0:return(e=this.authProvider_.getImmediate({optional:!0}))?[4,e.getToken()]:[3,2];case 1:if(null!==(t=n.sent()))return[2,t.accessToken];n.label=2;case 2:return[2,null]}}))}))},e.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requests_.forEach((function(e){return e.cancel()})),this.requests_.clear()},e.prototype.makeStorageReference=function(e){return new Fe(this,e)},e.prototype.makeRequest=function(e,t){var n=this;if(this.deleted_)return new Ne(C());var r=Be(e,this.appId_,t,this.pool_);return this.requests_.add(r),r.getPromise().then((function(){return n.requests_.delete(r)}),(function(){return n.requests_.delete(r)})),r},e.prototype.ref=function(e){if(/^[A-Za-z]+:\/\//.test(e))throw new u(w,"Expected child path but got a URL, use refFromURL instead.");if(null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var t=new Fe(this,this.bucket_);return null!=e?t.child(e):t},e.prototype.refFromURL=function(e){if(!/^[A-Za-z]+:\/\//.test(e))throw new u(w,"Expected full URL but got a child path, use ref instead.");try{oe.makeFromUrl(e)}catch(t){throw new u(w,"Expected valid full URL but got an invalid one.")}return new Fe(this,e)},Object.defineProperty(e.prototype,"maxUploadRetryTime",{get:function(){return this.maxUploadRetryTime_},enumerable:!1,configurable:!0}),e.prototype.setMaxUploadRetryTime=function(e){ee("time",0,Number.POSITIVE_INFINITY,e),this.maxUploadRetryTime_=e},Object.defineProperty(e.prototype,"maxOperationRetryTime",{get:function(){return this.maxOperationRetryTime_},enumerable:!1,configurable:!0}),e.prototype.setMaxOperationRetryTime=function(e){ee("time",0,Number.POSITIVE_INFINITY,e),this.maxOperationRetryTime_=e},Object.defineProperty(e.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!1,configurable:!0}),e}(),He=function(){function e(e){this.service_=e}return e.prototype.delete=function(){return this.service_.deleteApp(),Promise.resolve()},e}();function We(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal");return new Ve(n,r,new ne,t)}!function(e){var t={TaskState:Y,TaskEvent:B,StringFormat:O,Storage:Ve,Reference:Fe};e.INTERNAL.registerComponent(new o.a("storage",We,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion("@firebase/storage","0.4.0")}(r.a);n(135),t.a=r.a},function(e,t,n){"use strict";var r,i,a=n(3),o=n.n(a),s=n(10),u=n.n(s),l=n(5),c=n.n(l),d=n(6),h=n.n(d),f=n(18),p=n.n(f),g=n(19),v=n.n(g),m=n(11),y=n.n(m),_=n(7),b=n.n(_),w=n(27),k=n(8),S=n(1),E=n(35),P=n(0),I=(n(12),n(2)),D=n(47),T=n(13);function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v()(this,n)}}var C=(i=function(e){p()(n,e);var t=x(n);function n(){return c()(this,n),t.call(this)}return h()(n,[{key:"init",value:function(){var e=this;this.initializeFirebase(),window.firebase=E.a,E.a.auth().onAuthStateChanged((function(t){if(t&&I.default.settings.activeUser.get())e.onSignInWithUser(t);else{var n=!!I.default.settings.activeUser.get();I.default.settings.userId.set(void 0),I.default.settings.activeUser.set(void 0),I.default.settings.displayName.set(void 0),n&&setTimeout((function(){P.default.reload()}),100)}})),this._isOnline=navigator.onLine,window.addEventListener("online",(function(){e._isOnline=navigator.onLine}))}},{key:"initializeFirebase",value:function(){var e={clientId:S.a.ClientID,apiKey:S.a.APIKey,authDomain:S.a.APIBaseURL,databaseURL:"https://".concat(S.a.FirebaseProjectID,".firebaseio.com"),projectId:S.a.FirebaseProjectID,storageBucket:"".concat(S.a.FirebaseProjectID,".appspot.com"),messagingSenderId:S.a.FirebaseAppID,scopes:S.a.ScopesDefault};E.a.initializeApp(e)}},{key:"onSignInResult",value:function(e,t){var n=e.user;I.default.billingManager.updateUserProfile(t);try{P.default.PAssert(388,n,"Somehow signed in without a valid user")}catch(r){P.default.reportError(r)}n&&this.onSignInWithUser(n)}},{key:"onSignInFailure",value:function(e){var t,n=e.code,r=e.message;if("auth/popup-closed-by-user"===n)t="Error signing in. Please try again.";else if("auth/network-request-failed"===n)t="Connection error. Please try again.";else if("auth/web-storage-unsupported"===n){try{P.default.PAssert(389,!1,"Still getting web-storage-unsupported error")}catch(i){P.default.reportError(i)}t="There may be a configuration problem in your browser. Please contact support@moo.do and we can help you."}else if("auth/user-not-found"===n)t="An account with this email was not found.";else if("auth/invalid-email"===n)t="Invalid email address.";else if("auth/email-already-in-use"===n)t="This email address is already in use. You may have previously signed in with Google for this account.";else if("auth/wrong-password"===n)t="The password is incorrect, or you may have previously signed in with Google. Please try again.";else if(n&&"authentication_failed"!==n&&"authentication_error"!==n){try{P.default.PAssert(390,!1,"Error on signin",n,r)}catch(i){P.default.reportError(i)}t="Unexpected sign in error: ".concat(n,". Please try again.")}t&&I.default.setup.popupClosedError.set({message:t})}},{key:"_getUid",value:function(){return E.a.auth().getUid()}},{key:"getUserSync",value:function(){return this.user.get()}},{key:"signOut",value:function(){var e=u()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return P.default.log("signOut called"),I.default.settings.activeUser.set(void 0),e.abrupt("return",E.a.auth().signOut());case 3:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"isOnline",value:function(){return navigator.onLine}},{key:"reauthenticateGoogle",value:function(){var e=u()(o.a.mark((function e(){var t,n,r,i,a,s,u,l,c;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:n=null===(t=this.getGoogleProvider())||void 0===t?void 0:t.email,e.next=9;break;case 4:i=e.sent,(a=i.authToken)&&(r=a.idToken),e.next=21;break;case 9:return e.next=11,w.a.authAccountTemp(n);case 11:if(e.t1=s=e.sent,e.t0=null===e.t1,e.t0){e.next=15;break}e.t0=void 0===s;case 15:if(!e.t0){e.next=19;break}e.t2=void 0,e.next=20;break;case 19:e.t2=s.id_token;case 20:r=e.t2;case 21:if(!r){e.next=26;break}return u=E.a.auth().currentUser,l=E.a.auth.GoogleAuthProvider.credential(r),c=u.reauthenticateWithCredential(l),e.abrupt("return",c);case 26:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reauthenticateApple",value:function(){var e=u()(o.a.mark((function e(){var t,n,r,i,a,s;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:n=null===(t=this.getAppleProvider())||void 0===t?void 0:t.email,e.next=10;break;case 5:if(i=e.sent,a=i.credential,s=i.profile.email,n!==s||!a){e.next=10;break}return e.abrupt("return",r.reauthenticateWithCredential(a));case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"linkWithEmail",value:function(e,t){var n=E.a.auth.EmailAuthProvider.credential(e,t);return E.a.auth().currentUser.linkWithCredential(n)}},{key:"linkWithGoogle",value:function(){var e=u()(o.a.mark((function e(){var t,n,r,i,a,s,u,l,c;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:e.next=15;break;case 3:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=7;break}e.t0=void 0===n;case 7:if(!e.t0){e.next=11;break}e.t2=void 0,e.next=12;break;case 11:e.t2=n.idToken;case 12:t=e.t2,e.next=27;break;case 15:return e.next=17,w.a.authAccountAnonymous();case 17:if(e.t4=r=e.sent,e.t3=null===e.t4,e.t3){e.next=21;break}e.t3=void 0===r;case 21:if(!e.t3){e.next=25;break}e.t5=void 0,e.next=26;break;case 25:e.t5=r.id_token;case 26:t=e.t5;case 27:if(e.prev=27,!t){e.next=38;break}return a=E.a.auth.GoogleAuthProvider.credential(t),e.next=32,E.a.auth().currentUser.linkWithCredential(a);case 32:return s=e.sent,(u=null===(i=this.getGoogleProvider())||void 0===i?void 0:i.email)&&(I.default.settings.syncAccounts.setProperty(u,{}),l=this.createProfileFromGoogle(s),I.default.billingManager.updateUserProfile(l)),e.abrupt("return",s);case 38:I.default.menus.alert({text:"Signin error. Please try again."});case 39:e.next=45;break;case 41:if(e.prev=41,e.t6=e.catch(27),"auth/credential-already-in-use"===e.t6.code)c="This Google account is already in use.";else try{P.default.PAssert(391,e.t6)}catch(d){P.default.reportError(d)}c&&I.default.menus.alert({text:c});case 45:case"end":return e.stop()}}}),e,this,[[27,41]])})));return function(){return e.apply(this,arguments)}}()},{key:"linkWithApple",value:function(){var e=u()(o.a.mark((function e(){var t,n,r,i,a;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.createAppleCredential();case 2:if(t=e.sent,n=t.credential,r=t.profile,!n){e.next=10;break}return i=E.a.auth().currentUser,(a=i.linkWithCredential(n))&&I.default.billingManager.updateUserProfile(r),e.abrupt("return",a);case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unlinkEmail",value:function(){var e=u()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",E.a.auth().currentUser.unlink("password"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"unlinkGoogle",value:function(){var e=u()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",E.a.auth().currentUser.unlink("google.com"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"unlinkApple",value:function(){var e=u()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",E.a.auth().currentUser.unlink("apple.com"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithGoogle",value:function(){var e=u()(o.a.mark((function e(){var t,n,r,i,a,s,u;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:e.next=23;break;case 3:if(!(n=e.sent).error){e.next=8;break}this.onSignInFailure(n.error),e.next=21;break;case 8:if(r=n.idToken,i=n.accessToken,!(a=E.a.auth.GoogleAuthProvider.credential(r,i))){e.next=21;break}return e.prev=11,e.next=14,E.a.auth().signInWithCredential(a);case 14:t=e.sent,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(11),this.onSignInFailure(e.t0);try{P.default.PAssert(392,"auth/network-request-failed"===e.t0.code,"Other error code: "+e.t0.code,e.t0)}catch(l){P.default.reportError(l)}case 21:e.next=36;break;case 23:return(s=new E.a.auth.GoogleAuthProvider).addScope("email"),s.addScope("profile"),s.setCustomParameters({prompt:"consent"}),e.prev=27,e.next=30,E.a.auth().signInWithPopup(s);case 30:t=e.sent,e.next=36;break;case 33:e.prev=33,e.t1=e.catch(27),this.onSignInFailure(e.t1);case 36:return t?(I.default.PaneManager.setupInitialTimeout(),u=this.createProfileFromGoogle(t),this.onSignInResult(t,u)):this.onSignInFailure({code:""}),e.abrupt("return",t);case 38:case"end":return e.stop()}}}),e,this,[[11,17],[27,33]])})));return function(){return e.apply(this,arguments)}}()},{key:"createProfileFromGoogle",value:function(e){var t,n=e.user,r=(null===(t=e.additionalUserInfo)||void 0===t?void 0:t.profile)||{},i=r.family_name,a=r.given_name,o=r.name,s=r.picture,u=n.email,l=n.displayName,c=n.photoURL;if(!i&&!a){var d,h,f=null!==(d=null===(h=n.displayName)||void 0===h?void 0:h.split(" "))&&void 0!==d?d:"";2===f.length?(a=f[0],i=f[1]):a=f[0]}return o||(o=l),{email:u,lname:i,fname:a,displayName:o,picture:s||c}}},{key:"createAppleCredential",value:function(){var e=u()(o.a.mark((function e(){var t,n,r,i,a,s,u,l;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,D.a.signInWithApple();case 2:if(!(t=e.sent).error){e.next=7;break}return e.abrupt("return",{error:t.error});case 7:return n=t.identityToken,r=t.nonce,i=t.fname,a=t.lname,s=t.email,u=t.displayName,l=new E.a.auth.OAuthProvider("apple.com"),e.abrupt("return",{credential:l.credential({idToken:n,rawNonce:r}),profile:{email:s,fname:i,lname:a,displayName:u}});case 10:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithApple",value:function(){var e=u()(o.a.mark((function e(){var t,n,r,i,a;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:e.next=24;break;case 3:if(t=e.sent,n=t.error,r=t.credential,i=t.profile,!n){e.next=11;break}this.onSignInFailure(n),e.next=24;break;case 11:if(!r){e.next=24;break}return e.prev=12,e.next=15,E.a.auth().signInWithCredential(r);case 15:if(!(a=e.sent)){e.next=19;break}return a?(I.default.PaneManager.setupInitialTimeout(),this.onSignInResult(a,i)):this.onSignInFailure({code:""}),e.abrupt("return",a);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(12);try{P.default.PAssert(393,"auth/network-request-failed"===e.t0.code,"Other error code: "+e.t0.code,e.t0)}catch(s){P.default.reportError(s)}case 24:case"end":return e.stop()}}}),e,this,[[12,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithEmail",value:function(){var e=u()(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.a.auth().signInWithEmailAndPassword(t,n);case 3:return(r=e.sent)?(I.default.PaneManager.setupInitialTimeout(),this.onSignInResult(r,{email:t})):this.onSignInFailure({code:""}),e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(0),this.onSignInFailure(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createUserWithEmailAndPassword",value:function(){var e=u()(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.a.auth().createUserWithEmailAndPassword(t,n);case 3:return(r=e.sent)?(I.default.PaneManager.setupInitialTimeout(),this.onSignInResult(r,{email:t})):this.onSignInFailure({code:""}),e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(0),this.onSignInFailure(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendResetEmail",value:function(){var e=u()(o.a.mark((function e(t){return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.a.auth().sendPasswordResetEmail(t);case 3:return e.abrupt("return",!0);case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0),this.onSignInFailure(e.t0);case 10:case"end":return e.stop()}}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()}]),n}((r=function(){function e(){c()(this,e),this.user=new T.a,this.onAuthedCallbacks=[]}return h()(e,[{key:"onSignInWithUser",value:function(e){var t=this;this.user.set(e),I.default.settings.onLoaded((function(){I.default.settings.userId.set(e.uid),I.default.settings.activeUser.set(e.email),e.displayName&&I.default.settings.displayName.set(e.displayName);try{P.default.PAssert(889,e.uid===t._getUid())}catch(n){P.default.reportError(n)}t.runAuthedCallbacks()}))}},{key:"runAuthedCallbacks",value:function(){this.onAuthedCallbacks.length>0&&(this.onAuthedCallbacks.forEach((function(e){return e()})),this.onAuthedCallbacks=[])}},{key:"getUserSync",value:function(){return this.user.get()}},{key:"getUser",value:function(){var e=u()(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.user.get()){e.next=4;break}return e.abrupt("return",Promise.resolve(this.user.get()));case 4:return e.abrupt("return",new Promise((function(e){t.onAuthedCallbacks.push((function(){e(t.user.get())}))})));case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onAuthed",value:function(e){this.user.get()?e():this.onAuthedCallbacks.push(e)}},{key:"onActiveUser",value:function(e){I.default.settings.activeUser.onHasValue(e)}},{key:"getAccountName",value:function(){return I.default.settings.displayName.get()||""}},{key:"getAccountEmail",value:function(){return I.default.settings.activeUser.get()}},{key:"getUid",value:function(){return I.default.settings.userId.get()}},{key:"getEncryptionUid",value:function(){return I.default.settings.userId.get()}},{key:"getCurrentUser",value:function(){return P.default.isDemoMode()?null:E.a.auth().currentUser}},{key:"getEmailProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"password"===e.providerId}))}},{key:"getGoogleProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"google.com"===e.providerId}))}},{key:"getAppleProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"apple.com"===e.providerId}))}}]),e}(),b()(r.prototype,"getUser",[k.a],Object.getOwnPropertyDescriptor(r.prototype,"getUser"),r.prototype),r)),b()(i.prototype,"linkWithEmail",[k.a],Object.getOwnPropertyDescriptor(i.prototype,"linkWithEmail"),i.prototype),b()(i.prototype,"linkWithGoogle",[k.a],Object.getOwnPropertyDescriptor(i.prototype,"linkWithGoogle"),i.prototype),b()(i.prototype,"linkWithApple",[k.a],Object.getOwnPropertyDescriptor(i.prototype,"linkWithApple"),i.prototype),b()(i.prototype,"unlinkEmail",[k.a],Object.getOwnPropertyDescriptor(i.prototype,"unlinkEmail"),i.prototype),b()(i.prototype,"unlinkGoogle",[k.a],Object.getOwnPropertyDescriptor(i.prototype,"unlinkGoogle"),i.prototype),b()(i.prototype,"unlinkApple",[k.a],Object.getOwnPropertyDescriptor(i.prototype,"unlinkApple"),i.prototype),i);t.a=new C},function(e,t,n){e.exports=function(){"use strict";var e="millisecond",t="second",n="minute",r="hour",i="day",a="week",o="month",s="quarter",u="year",l=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,c=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},h={s:d,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+d(r,2,"0")+":"+d(i,2,"0")},m:function(e,t){var n=12*(t.year()-e.year())+(t.month()-e.month()),r=e.clone().add(n,o),i=t-r<0,a=e.clone().add(n+(i?-1:1),o);return Number(-(n+(t-r)/(i?r-a:a-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(l){return{M:o,y:u,w:a,d:i,D:"date",h:r,m:n,s:t,ms:e,Q:s}[l]||String(l||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p="en",g={};g[p]=f;var v=function(e){return e instanceof b},m=function(e,t,n){var r;if(!e)return p;if("string"==typeof e)g[e]&&(r=e),t&&(g[e]=t,r=e);else{var i=e.name;g[i]=e,r=i}return n||(p=r),r},y=function(e,t,n){if(v(e))return e.clone();var r=t?"string"==typeof t?{format:t,pl:n}:t:{};return r.date=e,new b(r)},_=h;_.l=m,_.i=v,_.w=function(e,t){return y(e,{locale:t.$L,utc:t.$u,$offset:t.$offset})};var b=function(){function d(e){this.$L=this.$L||m(e.locale,null,!0),this.parse(e)}var h=d.prototype;return h.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(_.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(l);if(r)return n?new Date(Date.UTC(r[1],r[2]-1,r[3]||1,r[4]||0,r[5]||0,r[6]||0,r[7]||0)):new Date(r[1],r[2]-1,r[3]||1,r[4]||0,r[5]||0,r[6]||0,r[7]||0)}return new Date(t)}(e),this.init()},h.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},h.$utils=function(){return _},h.isValid=function(){return!("Invalid Date"===this.$d.toString())},h.isSame=function(e,t){var n=y(e);return this.startOf(t)<=n&&n<=this.endOf(t)},h.isAfter=function(e,t){return y(e)<this.startOf(t)},h.isBefore=function(e,t){return this.endOf(t)<y(e)},h.$g=function(e,t,n){return _.u(e)?this[t]:this.set(n,e)},h.year=function(e){return this.$g(e,"$y",u)},h.month=function(e){return this.$g(e,"$M",o)},h.day=function(e){return this.$g(e,"$W",i)},h.date=function(e){return this.$g(e,"$D","date")},h.hour=function(e){return this.$g(e,"$H",r)},h.minute=function(e){return this.$g(e,"$m",n)},h.second=function(e){return this.$g(e,"$s",t)},h.millisecond=function(t){return this.$g(t,"$ms",e)},h.unix=function(){return Math.floor(this.valueOf()/1e3)},h.valueOf=function(){return this.$d.getTime()},h.startOf=function(e,s){var l=this,c=!!_.u(s)||s,d=_.p(e),h=function(e,t){var n=_.w(l.$u?Date.UTC(l.$y,t,e):new Date(l.$y,t,e),l);return c?n:n.endOf(i)},f=function(e,t){return _.w(l.toDate()[e].apply(l.toDate(),(c?[0,0,0,0]:[23,59,59,999]).slice(t)),l)},p=this.$W,g=this.$M,v=this.$D,m="set"+(this.$u?"UTC":"");switch(d){case u:return c?h(1,0):h(31,11);case o:return c?h(1,g):h(0,g+1);case a:var y=this.$locale().weekStart||0,b=(p<y?p+7:p)-y;return h(c?v-b:v+(6-b),g);case i:case"date":return f(m+"Hours",0);case r:return f(m+"Minutes",1);case n:return f(m+"Seconds",2);case t:return f(m+"Milliseconds",3);default:return this.clone()}},h.endOf=function(e){return this.startOf(e,!1)},h.$set=function(a,s){var l,c=_.p(a),d="set"+(this.$u?"UTC":""),h=(l={},l[i]=d+"Date",l.date=d+"Date",l[o]=d+"Month",l[u]=d+"FullYear",l[r]=d+"Hours",l[n]=d+"Minutes",l[t]=d+"Seconds",l[e]=d+"Milliseconds",l)[c],f=c===i?this.$D+(s-this.$W):s;if(c===o||c===u){var p=this.clone().set("date",1);p.$d[h](f),p.init(),this.$d=p.set("date",Math.min(this.$D,p.daysInMonth())).toDate()}else h&&this.$d[h](f);return this.init(),this},h.set=function(e,t){return this.clone().$set(e,t)},h.get=function(e){return this[_.p(e)]()},h.add=function(e,s){var l,c=this;e=Number(e);var d=_.p(s),h=function(t){var n=y(c);return _.w(n.date(n.date()+Math.round(t*e)),c)};if(d===o)return this.set(o,this.$M+e);if(d===u)return this.set(u,this.$y+e);if(d===i)return h(1);if(d===a)return h(7);var f=(l={},l[n]=6e4,l[r]=36e5,l[t]=1e3,l)[d]||1,p=this.$d.getTime()+e*f;return _.w(p,this)},h.subtract=function(e,t){return this.add(-1*e,t)},h.format=function(e){var t=this;if(!this.isValid())return"Invalid Date";var n=e||"YYYY-MM-DDTHH:mm:ssZ",r=_.z(this),i=this.$locale(),a=this.$H,o=this.$m,s=this.$M,u=i.weekdays,l=i.months,d=function(e,r,i,a){return e&&(e[r]||e(t,n))||i[r].substr(0,a)},h=function(e){return _.s(a%12||12,e,"0")},f=i.meridiem||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:_.s(s+1,2,"0"),MMM:d(i.monthsShort,s,l,3),MMMM:l[s]||l(this,n),D:this.$D,DD:_.s(this.$D,2,"0"),d:String(this.$W),dd:d(i.weekdaysMin,this.$W,u,2),ddd:d(i.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(a),HH:_.s(a,2,"0"),h:h(1),hh:h(2),a:f(a,o,!0),A:f(a,o,!1),m:String(o),mm:_.s(o,2,"0"),s:String(this.$s),ss:_.s(this.$s,2,"0"),SSS:_.s(this.$ms,3,"0"),Z:r};return n.replace(c,(function(e,t){return t||p[e]||r.replace(":","")}))},h.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},h.diff=function(e,l,c){var d,h=_.p(l),f=y(e),p=6e4*(f.utcOffset()-this.utcOffset()),g=this-f,v=_.m(this,f);return v=(d={},d[u]=v/12,d[o]=v,d[s]=v/3,d[a]=(g-p)/6048e5,d[i]=(g-p)/864e5,d[r]=g/36e5,d[n]=g/6e4,d[t]=g/1e3,d)[h]||g,c?v:_.a(v)},h.daysInMonth=function(){return this.endOf(o).$D},h.$locale=function(){return g[this.$L]},h.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=m(e,t,!0);return r&&(n.$L=r),n},h.clone=function(){return _.w(this.$d,this)},h.toDate=function(){return new Date(this.valueOf())},h.toJSON=function(){return this.isValid()?this.toISOString():null},h.toISOString=function(){return this.$d.toISOString()},h.toString=function(){return this.$d.toUTCString()},d}();return y.prototype=b.prototype,y.extend=function(e,t){return e(t,b,y),y},y.locale=m,y.isDayjs=v,y.unix=function(e){return y(1e3*e)},y.en=g[p],y.Ls=g,y}()},function(e,t,n){"use strict";var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(17),l=n.n(u),c=n(18),d=n.n(c),h=n(19),f=n.n(h),p=n(11),g=n.n(p),v=n(0),m=n(1),y=n(7),_=n.n(y),b=n(8),w=n(2),k=n(21),S=n(16),E=n(79),P=n(23),I=(r=function(){function e(){a()(this,e),this.undoStack=[],this.redoStack=[],this.isUndoing=!1,this._deleteSelection=void 0,this._batch=[],this.__numInBatch=0,this._batchPrevSel=void 0,this._groupTextChanges=!1,this._needsSelection=!1,k.a.binder(this,"_onSelectionChanged"),P.a.listen("selectionChanged",this._onSelectionChanged)}return s()(e,[{key:"_getLastState",value:function(){return this.undoStack[this.undoStack.length-1]}},{key:"_getLastAction",value:function(){var e=this.undoStack[this.undoStack.length-1];if(e&&1===e.actions.length)return e.actions[0]}},{key:"pushModified",value:function(e,t,n){if(!this.isUndoing){var r=Object.keys(t).filter((function(e){return"id"!==e&&"regexpFlags"!==e})).length;if(r>0){var i=!1;if("text"in t){var a=this._getLastAction(),o=this._getLastState();this._needsSelection=!0,this._groupTextChanges&&o&&a&&a.changes.text&&a.itemId===e.id&&(a.changes.text=t.text,i=1===r)}i||this._doPush(e,{itemId:e.id,type:"Modified",changes:t,prevState:n}),this.clearDeleteSelection()}}}},{key:"pushAdded",value:function(e,t){try{v.default.PAssert(931,void 0!==t.index,"Item should have index when adding")}catch(n){v.default.reportError(n)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Added",changes:{parent:e.id,index:t.index}}),this.clearDeleteSelection())}},{key:"pushRemoved",value:function(e,t){try{v.default.PAssert(932,void 0!==t.index,"Item should have index when removing")}catch(n){v.default.reportError(n)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Removed",changes:{parent:e.id,index:t.index}},this._deleteSelection),this.clearDeleteSelection())}},{key:"clearDeleteSelection",value:function(){this.__numInBatch<=0&&(this._deleteSelection=void 0)}},{key:"_doAction",value:function(e){if(!this.isUndoing)try{var t=e?this.redoStack:this.undoStack,n=e?this.undoStack:this.redoStack,r=t.pop();if(r){var i=r.actions;try{v.default.PAssert(933,i.length>0,"Undo state should have some actions")}catch(a){v.default.reportError(a)}i.length>0&&(this.isUndoing=!0,w.default.PaneUpdateBatcher.beginUpdateItems(),v.default.focusedPane.clearPreventUpdate(),i.forEach((function(t){var n=t.type,r=n===m.a.CrudActions.Added||n===m.a.CrudActions.Removed||e?t.changes:t.prevState;Object.keys(r).forEach((function(e){void 0===r[e]&&(r[e]=null)})),e?n===m.a.CrudActions.Added?r.isDeleted=!1:n===m.a.CrudActions.Removed&&(r.isDeleted=!0):n===m.a.CrudActions.Added?(n=m.a.CrudActions.Removed,r.isDeleted=!0):n!==m.a.CrudActions.Removed&&null!==r.isDeleted||(n=m.a.CrudActions.Added,r.isDeleted=!1);var i=S.a.getItem(t.itemId);if(i){var a=i.getDocumentOwner(),o=S.a.getItemDataLocal(a,t.itemId);E.a.onRemoteChange(a,o,t.itemId,r),S.a.saveItem(i,r,m.a.ChangeType.Local,m.a.SaveFlag.All)}})),w.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelFromState(e,r),n.push(r))}}finally{this.isUndoing=!1}}},{key:"restoreSelFromState",value:function(e,t){}},{key:"undo",value:function(){this._doAction(!1)}},{key:"redo",value:function(){this._doAction(!0)}},{key:"_onSelectionChanged",value:function(e){var t=this._getLastState();t&&this._needsSelection?(this._needsSelection=!1,t.selection=e,this._groupTextChanges=!0):this._groupTextChanges=!1}},{key:"saveDeleteSelection",value:function(){}},{key:"saveSelection",value:function(){}},{key:"beginAction",value:function(){this.__numInBatch++,v.default.timeoutOnce("batch_beginAction",this.onActionTimeout,0)}},{key:"endAction",value:function(e){this.__numInBatch--;try{v.default.PAssert(934,this.__numInBatch>=0,"Undo batch somehow went negative")}catch(t){v.default.reportError(t)}(this.__numInBatch<=0||e)&&(this.__numInBatch=0,this._batch.length>0&&(this.undoStack.push({selection:this.saveSelection(),prevSel:this._batchPrevSel,actions:this._batch}),this._batch=[]),this._batchPrevSel=void 0,this._deleteSelection=void 0)}},{key:"onActionTimeout",value:function(){this.__numInBatch>0&&this.endAction(!0)}},{key:"clearGroupTextChanges",value:function(){this._needsSelection=!1,this._groupTextChanges=!1}}]),e}(),_()(r.prototype,"onActionTimeout",[b.a],Object.getOwnPropertyDescriptor(r.prototype,"onActionTimeout"),r.prototype),r),D=n(4);function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var x=function(e){d()(n,e);var t=T(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"_doPush",value:function(e,t,n){if(this.redoStack=[],t.itemId=e.id,this.__numInBatch>0){var r=this._batch.indexOfWithProperty("itemId",e.id);if(r>=0){var i=this._batch[r];i.type===m.a.CrudActions.Modified&&"Removed"===t.type?t.changes.text=i.prevState.text:(Object.assign(t.changes,i.changes,t.changes),Object.assign(t.prevState,i.prevState,t.prevState),t.type=i.type),this._batch[r]=t}else this._batch.push(t)}else{var a=n||this._batchPrevSel||D.a.getSavedSelection()||this.saveSelection();this.undoStack.push({selection:a,prevSel:a,actions:[t]})}}},{key:"beginAction",value:function(){l()(g()(n.prototype),"beginAction",this).call(this),this._batchPrevSel||(this._batchPrevSel=D.a.isValid()?this.saveSelection():void 0)}},{key:"restoreSelFromState",value:function(e,t){var n=e?t.selection:t.prevSel;n&&D.a.restore(n)}},{key:"saveSelection",value:function(){return D.a.save()}},{key:"saveDeleteSelection",value:function(){this._deleteSelection=D.a.save()}},{key:"pushRemoved",value:function(e,t){if(!this.isUndoing)try{v.default.PAssert(423,this._deleteSelection,"Must have saved delete selection before deleting")}catch(r){v.default.reportError(r)}l()(g()(n.prototype),"pushRemoved",this).call(this,e,t)}}]),n}(I);t.a=new x},function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,n){"use strict";var r,i=n(3),a=n.n(i),o=n(10),s=n.n(o),u=n(5),l=n.n(u),c=n(6),d=n.n(c),h=n(7),f=n.n(h),p=n(8),g=n(1),v=n(0),m=n(2),y=n(13),_=function(){function e(t){l()(this,e),t.panes&&(t.panes=v.default.arrayUniques(t.panes,"id")),this.id=t.id,this.name=new y.a(t.name),this.panes=t.panes||[],this.index=t.index,this.defaultPanes=t.defaultPanes,this.parent=new y.a(t.parent)}return d()(e,[{key:"getSaveInfo",value:function(){var e={id:this.id,name:this.name.get(),index:this.index,parent:this.parent.get()||null};return this.panes&&(e.panes=this.panes.map(v.default.cloneWithoutUndefineds)),this.defaultPanes&&(e.defaultPanes=this.defaultPanes.map(v.default.cloneWithoutUndefineds)),e}}]),e}(),b=n(16),w=n(32),k=n(82),S=function(){function e(t){l()(this,e),this.id=t.id,this.name=new y.a(t.name),this.index=t.index,this.isCollapsed=new y.a(t.isCollapsed)}return d()(e,[{key:"getSaveInfo",value:function(){return{id:this.id,name:this.name.get(),index:this.index,isCollapsed:this.isCollapsed.get(),isFolder:!0}}}]),e}(),E=n(25),P=n(68),I="Mobile",D=1,T=(r=function(){function e(){var t=this;l()(this,e),this._isSaving=!1,this._isAdding=!1,this._localState=void 0,this._boards=new w.a,this.boardsSorted=new P.a([this._boards],(function(e){return e.filter((function(e){return e instanceof S||!e.parent||!t.getById(e.parent.get())})).reduce((function(t,n){return t.concat(n instanceof S?[n].concat(e.filter((function(e){return!n.isCollapsed.get()&&e instanceof _&&e.parent.get()===n.id}))):n)}),[])})),this.selected=new y.a,this.selectedFolder=new y.a}return d()(e,[{key:"init",value:function(){this.load()}},{key:"setIsAdding",value:function(e){this._isAdding=e}},{key:"isAdding",value:function(){return this._isAdding}},{key:"addFolder",value:function(e,t){var n=new S({id:this.getNextID(),name:e,index:""+this._boards.length()});return this._boards.push(n),this.moveTo(this._boards.length()-1,t),n}},{key:"addToFolder",value:function(e,t){e.parent.set(t.id),this.saveBoard(e),this._boards.notify()}},{key:"removeFromFolder",value:function(e){e.parent.set(void 0),this.saveBoard(e),this._boards.notify()}},{key:"add",value:function(e){this.setIsAdding(!0);var t=new _({id:this.getNextID(),name:this.getNextName(),panes:e||[],index:""+this._boards.length()});return this._boards.push(t),this.saveBoard(t),t}},{key:"removeBoard",value:function(e){this._boards.length()>1&&(this._boards.remove(e),this.selected.get()===e&&this.selectFirstBoard(),b.a.deleteBoard(e.id),this._localState&&delete this._localState[e.id])}},{key:"length",value:function(){return this._boards.length()}},{key:"ensureSelected",value:function(){this.selected.get()||this.selectFirstBoard(!0),m.default.PaneManager.updateDisplayPanes()}},{key:"selectFirstBoard",value:function(e){var t=this.getBoards();this.selectBoard(t[0],e)}},{key:"selectBoard",value:function(e,t){var n;e&&(this.selected.set(e,t),e.parent.get()&&(n=this.getById(e.parent.get())),this.selectedFolder.set(n),m.default.settings.selectedBoard.set(e.id))}},{key:"_findMatchingLocalPane",value:function(e,t){var n;if(t)for(var r=0,i=0;i<t.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t[i].id===e){n=t[i];break}}return n}},{key:"_generateUsablePaneState",value:function(e,t){for(var n=0,r=[],i=0;i<e.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i],o=this._findMatchingLocalPane(a.id,t)||a;r.push(v.default.cloneWithoutUndefineds({id:a.id,name:a.name,item:a.item,document:a.document||b.a.getDefaultDocument().id,type:a.type,showarch:a.showarch,search:a.search,viewState:a.viewState||(a.viewMode?{viewMode:a.viewMode}:void 0),displayLocalItems:a.displayLocalItems,displayCalendars:a.displayCalendars,blocksCollapsed:a.blocksCollapsed,documentSortMode:a.documentSortMode,itemState:a.itemState,isOverviewVisible:a.isOverviewVisible,widthManual:a.widthManual,widthManualExpanded:a.widthManualExpanded,scrollIndex:o?o.scrollIndex:0,isExpanded:!!o&&o.isExpanded,selectedItem:o?o.selectedItem:void 0}))}return r}},{key:"hasLoadedPaneState",value:function(){return!!this._localState}},{key:"getPaneState",value:function(){var e=this.get();return e?this._generateUsablePaneState(e.panes||[],this._localState[e.id]):[]}},{key:"_generateSyncPaneState",value:function(e){for(var t=0,n=[],r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];n.push({id:i.id,name:i.name,item:i.item,type:i.type,document:i.document,showarch:i.showarch,search:i.search,viewState:i.viewState,itemState:i.itemState,isOverviewVisible:i.isOverviewVisible,displayCalendars:i.displayCalendars,displayLocalItems:i.displayLocalItems,widthManual:i.widthManual,widthManualExpanded:i.widthManualExpanded,blocksCollapsed:i.blocksCollapsed,documentSortMode:i.documentSortMode})}return n}},{key:"_generateLocalPaneState",value:function(e){for(var t=0,n=[],r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];n.push({id:i.id,scrollIndex:i.scrollIndex,isExpanded:i.isExpanded,selectedItem:i.selectedItem})}return n}},{key:"savePaneState",value:function(e,t){if(this._boards.length()>0)try{this._saveSyncState(e),this._saveLocalState(e),this.saveBoard(this.get(),t)}catch(n){v.default.reportError(n,{numBoards:this._boards.length()})}}},{key:"_saveLocalState",value:function(e){var t=this.get().id;try{v.default.PAssert(413,t,"Must have a valid board ID")}catch(r){v.default.reportError(r)}var n=this._generateLocalPaneState(e);v.default.deepEqual(n,this._localState[t])||(this._localState=v.default.clone(this._localState),this._localState[t]=n)}},{key:"_saveSyncState",value:function(e){var t=this.get();try{v.default.PAssert(414,t,"Selected board does not exist")}catch(n){v.default.reportError(n)}t&&(t.panes=this._generateSyncPaneState(e))}},{key:"renameBoard",value:function(e,t){if(e.name.get()!==t){for(var n=0,r=!1,i=0;i<this._boards.length();i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._boards.get()[i];if(a!==e&&a.name.get()===t)return r=!0,!1}r||(e.name.set(t),this.saveBoard(e),this.selected.notify())}return!0}},{key:"saveBoardDefault",value:function(e){e.defaultPanes=v.default.clone(e.panes),this.saveBoard(e)}},{key:"restoreBoardDefault",value:function(e){e.panes=v.default.clone(e.defaultPanes),this.selected.notify()}},{key:"get",value:function(){return this.selected.get()}},{key:"createDefaultState",value:function(){if(0===this._boards.length()){var e=b.a.getDefaultDocument(),t=[];if(e){var n=e.getRootItem();t=[new _({id:b.a.generateID(),name:"Tasks",index:"0",panes:[{id:m.default.PaneManager.getNextPaneID(),document:e.id,item:n.id,type:g.a.PaneMode.Task,viewState:{viewMode:"Outline"},isOverviewVisible:!0}]}),new _({id:b.a.generateID(),name:"Today",index:"1",panes:[{id:m.default.PaneManager.getNextPaneID(),document:e.id,item:n.id,type:g.a.PaneMode.Task,viewState:{viewMode:"Agenda_Today"},isOverviewVisible:!0}]}),new _({id:b.a.generateID(),name:"Calendar",index:"2",panes:[{id:m.default.PaneManager.getNextPaneID(),document:e.id,item:n.id,type:g.a.PaneMode.Task,viewState:{viewMode:"Calendar_Week"}}]})],m.default.pluginManager.isEnabled(g.a.PluginID.Gmail)&&t.splice(2,0,new _({id:b.a.generateID(),name:"Email",index:"1,0",panes:[{id:m.default.PaneManager.getNextPaneID(),type:g.a.PaneMode.Gmail,isOverviewVisible:!0,isExpanded:!0}]}))}return this._boards.set(t),this.saveAll(),this.selectFirstBoard(!0),t}}},{key:"getNextName",value:function(){var e,t,n=0,r=this._boards.get(),i=1;do{var a=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e=!1,t="Board "+i,i++;for(var o=0;o<r.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r[o].name.get()===t){e=!0;break}}}while(e);return t}},{key:"getNextID",value:function(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++D}},{key:"load",value:function(){var e,t=b.a.getBoards(),n=Object.keys(t).map((function(e){var n=t[e];return n.isFolder?new S(n):new _(n)}));n.sort(E.a.compareItemIndex);try{e=m.default.settings.localPaneState.get()||{}}catch(a){e={}}if(this._localState=e,n&&n.length>0){var r=m.default.settings.selectedBoard.get();if(this._boards.set(n),v.default.isNumber(r))this.selectBoardAtIndex(r,!0);else{var i=this.getById(r);i instanceof _&&this.selectBoard(i,!0)}}}},{key:"setBoards",value:function(e){this._boards.set(e),this.ensureSelected()}},{key:"saveAll",value:function(){var e=this;this.trackPaneState()&&this._boards.forEach((function(t){e.saveBoard(t)}))}},{key:"saveBoard",value:function(e,t){if(this.trackPaneState()&&e){var n=e.getSaveInfo();b.a.saveBoard(n,t),m.default.settings.localPaneState.set(v.default.cloneWithoutUndefineds(this._localState))}}},{key:"trackPaneState",value:function(){return!v.default.isDemoMode()}},{key:"onSettingChanged",value:function(){this._isSaving||this.load()}},{key:"moveTo",value:function(e,t){if(e!==t){var n=this.boardsSorted.get(),r=n[e];n.splice(e,1);var i=n[t-1],a=n[t];if(r instanceof S){if(i instanceof _&&i.parent.get()===r.id)return}else{var o=i?i instanceof S?i.isCollapsed.get()?null:i.id:i.parent.get():null;r.parent.set(o)}var s=Object(k.a)(null===i||void 0===i?void 0:i.index,null===a||void 0===a?void 0:a.index);r.index=s,this._boards.sort(E.a.compareItemIndex),this.saveBoard(r)}}},{key:"cloneBoard",value:function(e,t){var n;(e=e||this.get(),t)?n=[t.getSaveInfoForClone()]:n=e.panes;try{v.default.PAssert(415,n,"Must have valid panes to clone a board")}catch(i){v.default.reportError(i)}var r=this.add(n);return this.selectBoard(r),r}},{key:"getById",value:function(e){return this._boards.get().find((function(t){return t.id===e}))}},{key:"onRemoteUpdate",value:function(e,t){var n=t.id,r=t.name,i=t.panes,a=t.parent,o=t.index,s=t.defaultPanes,u=this.getById(n),l=this.get();if(e===g.a.CrudActions.Removed)u&&this.removeBoard(u);else if(u)if(u instanceof _){var c,d=(null===(c=u.panes)||void 0===c?void 0:c.map((function(e){return v.default.removeNullUndefined(e)})))||[],h=u.index!==o||u.parent.get()!=a||!d.equals(i,!0);try{h&&(u.name.set(r),u.index=o,u.panes=i,u.parent.set(a),u.defaultPanes=s,this._boards.sort(E.a.compareItemIndex),l&&(this.selectBoard(l,u===l),m.default.PaneManager.onRemoteUpdate(i)))}catch(f){v.default.reportError(f,u.name)}}else u.name.set(r),u.index=o,this._boards.sort(E.a.compareItemIndex);else this._boards.insertSorted(new _({id:n,name:r,panes:i,index:o,defaultPanes:s}),E.a.compareItemIndex),this.selectBoard(l)}},{key:"ensureUniqueIndices",value:function(){for(var e=0,t=this._boards.get(),n=1;n<t.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[n-1],i=t[n],a=t[n+1];i.index&&i.index!==r.index||(i.index=Object(k.a)(null===r||void 0===r?void 0:r.index,null===a||void 0===a?void 0:a.index),this.saveBoard(i))}}},{key:"hotkeyPrevBoard",value:function(){var e=this.getSelectedIndex()-1;e<0&&(e=this.length()-1),this.selectBoardAtIndex(e)}},{key:"hotkeyNextBoard",value:function(){var e=this.getSelectedIndex()+1;e>=this.length()&&(e=0),this.selectBoardAtIndex(e)}},{key:"getSelectedIndex",value:function(){return this.getBoards().indexOf(this.get())}},{key:"getBoards",value:function(){return this._boards.get().filter((function(e){return e instanceof _}))}},{key:"selectBoardAtIndex",value:function(e,t){var n=this.boardsSorted.get().filter((function(e){return e instanceof _}));e>=0&&e<n.length&&this.selectBoard(n[e],t)}},{key:"clear",value:function(){this._boards.clear()}},{key:"setFolderCollapsed",value:function(e,t){e.isCollapsed.set(t),this.saveBoard(e),this._boards.notify()}},{key:"getFolders",value:function(){return this._boards.get().filter((function(e){return e instanceof S}))}},{key:"getBoardFolderAsTemplate",value:function(){var e=s()(a.a.mark((function e(t){var n,r,i,o,s,u;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return n=this._boards.get().filter((function(e){return e instanceof _&&e.parent.get()===t.id})),r=v.default.arrayUniques(v.default.arrayFlat(n.map((function(e){return e.panes.map((function(e){return e.type===g.a.PaneMode.Task&&e.document}))}))).filter((function(e){return!!e}))),i=r.map((function(e){return b.a.getDocumentById(e)})),e.next=5,Promise.all(i.map((function(e){return e.toJSONObject({includeNotes:!0})})));case 5:return o=e.sent,s={},n.forEach((function(e){return s[e.id]=e.getSaveInfo()})),u={version:1,dateBasis:Date.now(),documents:o,boards:s},e.abrupt("return",u);case 10:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDefaultMobileState",value:function(e){var t=b.a.getDefaultDocument(),n=t.getRootItem(),r=new _({id:I,name:I,index:""+e.length,panes:[{id:"Inbox",type:g.a.PaneMode.Inbox},{id:"Outline",document:t.id,item:n.id,type:g.a.PaneMode.Task,viewState:{viewMode:"Outline"}},{id:"Agenda",document:t.id,item:n.id,type:g.a.PaneMode.Task,viewState:{viewMode:"Agenda_All"}}]});return this.saveBoard(r),r}}]),e}(),f()(r.prototype,"saveAll",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"saveAll"),r.prototype),f()(r.prototype,"saveBoard",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"saveBoard"),r.prototype),f()(r.prototype,"hotkeyPrevBoard",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"hotkeyPrevBoard"),r.prototype),f()(r.prototype,"hotkeyNextBoard",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"hotkeyNextBoard"),r.prototype),f()(r.prototype,"selectBoardAtIndex",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"selectBoardAtIndex"),r.prototype),r);t.a=new T},function(e,t,n){var r=n(129),i=n(130),a=n(108),o=n(131);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){"use strict";var r,i=n(33),a=n.n(i),o=n(5),s=n.n(o),u=n(6),l=n.n(u),c=n(7),d=n.n(c),h=n(0),f=n(2),p=n(23),g=n(8),v=(r=function(){function e(){s()(this,e),this._batchTimeout=void 0,this.itemsBatchingUpdates={}}return l()(e,[{key:"beginBatch",value:function(e){h.default.isEmpty(this.itemsBatchingUpdates)&&(this._batchTimeout=setTimeout(this._runUpdates,500)),this.itemsBatchingUpdates[e.id]||(this.itemsBatchingUpdates[e.id]={item:e})}},{key:"commitBatch",value:function(e){var t=this.itemsBatchingUpdates[e.id];t&&(this._runUpdate(e,t),delete this.itemsBatchingUpdates[e.id])}},{key:"itemItemsChanged",value:function(e){this.updateItem(e,"Items")}},{key:"itemTextChanged",value:function(e){this.updateItem(e,"Text")}},{key:"itemDateChanged",value:function(e){this.updateItem(e,"Date")}},{key:"itemRepeatDateCompleted",value:function(e){this.updateItem(e,"RepeatDateCompleted")}},{key:"itemPriorityChanged",value:function(e){this.updateItem(e,"Priority")}},{key:"itemTagsChanged",value:function(e,t){this.updateItem(e,"Tags",t)}},{key:"itemModifiedChanged",value:function(e){this.updateItem(e,"Modified")}},{key:"itemFontChanged",value:function(e){this.updateItem(e,"Font")}},{key:"itemHeaderChanged",value:function(e){this.updateItem(e,"Header")}},{key:"itemSearchChanged",value:function(e){this.updateItem(e,"Search")}},{key:"itemCompleteChanged",value:function(e){this.updateItem(e,"Complete")}},{key:"itemIndentChanged",value:function(e){this.updateItem(e,"Indent")}},{key:"updateItem",value:function(e,t,n){if(n=n||!0,this.itemsBatchingUpdates[e.id]){var r=this.itemsBatchingUpdates[e.id];r||(r=this.itemsBatchingUpdates[e.id]={item:e}),r[t]=n,this._batchTimeout&&clearTimeout(this._batchTimeout),this._batchTimeout=setTimeout(this._runUpdates,500)}else this._runUpdate(e,a()({item:e},t,n))}},{key:"_runUpdate",value:function(e,t){p.a.fireEvent("clearMeasureCacheItem",[e.id]),!e.isDestroyed()&&e.getItemStore()&&e.getItemStore().onItemChanged(e,t)}},{key:"_runUpdates",value:function(){var e=this;h.default.batchRenderUpdates((function(){for(var t in f.default.PaneUpdateBatcher.beginUpdateItems(),e.itemsBatchingUpdates)if(e.itemsBatchingUpdates.hasOwnProperty(t)){var n=e.itemsBatchingUpdates[t];e._runUpdate(n.item,n)}e.itemsBatchingUpdates={},f.default.PaneUpdateBatcher.commitUpdateItems()}))}}]),e}(),d()(r.prototype,"_runUpdate",[g.a],Object.getOwnPropertyDescriptor(r.prototype,"_runUpdate"),r.prototype),d()(r.prototype,"_runUpdates",[g.a],Object.getOwnPropertyDescriptor(r.prototype,"_runUpdates"),r.prototype),r);t.a=new v},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(92),u=function(){function e(t){i()(this,e),this._listeners=[],this._enabled=!0,t&&this.listen(t)}return o()(e,[{key:"listen",value:function(e){var t=new s.a(this,e);return this._addListener(t),t}},{key:"_addListener",value:function(e){this._listeners.push(e)}},{key:"_hasListener",value:function(e){return this._listeners.indexOf(e)>=0}},{key:"unlisten",value:function(e){var t=this._listeners.findIndex((function(t){return t.cb===e}));t>=0&&this._listeners.removeAt(t)}},{key:"unlistenListener",value:function(e){this._listeners.remove(e)}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1}},{key:"notify",value:function(){if(this._enabled)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;arguments.length>0?this._listeners[t].cb(arguments.length<=0?void 0:arguments[0]):this._listeners[t].cb()}}}]),e}();t.a=u},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var r=["MO","TU","WE","TH","FR","SA","SU"],i=function(){function e(e,t){if(0===t)throw new Error("Can't create weekday with n == 0");this.weekday=e,this.n=t}return e.fromStr=function(t){return new e(r.indexOf(t))},e.prototype.nth=function(t){return this.n===t?this:new e(this.weekday,t)},e.prototype.equals=function(e){return this.weekday===e.weekday&&this.n===e.n},e.prototype.toString=function(){var e=r[this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},e.prototype.getJsWeekday=function(){return 6===this.weekday?0:this.weekday+1},e}()},function(e,t,n){"use strict";var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(7),l=n.n(u),c=n(8),d=n(0),h=(r=function(){function e(){a()(this,e),this._numInBatch=0,this.batch=[]}return s()(e,[{key:"isBatching",value:function(){return this._numInBatch>0}},{key:"beginBatch",value:function(){this._numInBatch++,d.default.timeoutOnce("batch_beginAction",this.onActionTimeout,0)}},{key:"handleChange",value:function(e){this._numInBatch>0?this.batch.includes(e)||this.batch.push(e):e()}},{key:"endBatch",value:function(e){this._numInBatch--,(this._numInBatch<=0||e)&&(this._numInBatch=0,this.batch.forEach((function(e){return e()})),this.batch=[])}},{key:"onActionTimeout",value:function(){this.batch.length>0&&this.endBatch(!0)}}]),e}(),l()(r.prototype,"onActionTimeout",[c.a],Object.getOwnPropertyDescriptor(r.prototype,"onActionTimeout"),r.prototype),r);t.a=new h},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var r=null,i=null},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(2),u=n(4),l=function(){function e(t){var n=this;i()(this,e),Object.keys(t).forEach((function(e){return n[e]=t[e]}))}return o()(e,[{key:"showMarkdown",value:function(e){return s.default.settings.showMarkdown.get()&&(this.forceIsSelected||e||u.a.isSelected(this))}},{key:"getDisplayText",value:function(e,t){return this.item.getDisplayText(this.showMarkdown(e),t)}},{key:"getDisplayLength",value:function(e,t){return this.getDisplayText(e,t).length}},{key:"getDisplayTextWithoutPrefix",value:function(){return this.item.getDisplayText(this.showMarkdown(),!0)}},{key:"getDisplayLengthWithoutPrefix",value:function(){return this.getDisplayTextWithoutPrefix().length}},{key:"levelsDeepNew",value:function(){return this.item?this.overview?this.item.levelsDeep.get()-1:this.pane.itemLevelsDeep(this.item,this.levelsDeepRoot):0}},{key:"getPrevious",value:function(){return this.pane.objectAtIndex(this.index-1)}}]),e}();t.a=l},function(e,t,n){"use strict";var r=n(59),i=n.n(r),a=n(5),o=n.n(a),s=n(6),u=n.n(s),l=n(1),c=n(0),d=n(67),h=n(12),f=n(4),p=n(2),g=n(38),v=n(65),m=[l.a.KeyCode.Tab,l.a.KeyCode.Backspace,l.a.KeyCode.Delete],y=[l.a.KeyCode.ArrowUp,l.a.KeyCode.ArrowDown,l.a.KeyCode.ArrowLeft,l.a.KeyCode.ArrowRight,l.a.KeyCode.Home,l.a.KeyCode.End,l.a.KeyCode.A,l.a.KeyCode.E,l.a.KeyCode.F,l.a.KeyCode.B,l.a.KeyCode.PageUp,l.a.KeyCode.PageDown],_=function(){function e(){o()(this,e)}return u()(e,[{key:"getNavigationAction",value:function(e){var t=h.a.mac,n=e.ctrlKey&&!e.altKey&&!e.metaKey,r=e.altKey&&!e.ctrlKey&&!e.metaKey,i=e.metaKey&&!e.ctrlKey&&!e.altKey,a=!e.ctrlKey&&!e.altKey&&!e.metaKey,o=e.normCode,s=l.a.KeyCode;if(o===s.ArrowLeft){if(n&&!h.a.mac||r&&h.a.mac)return"LeftWord";if(i&&t)return"StartLine";if(a)return"Left"}if(o===s.ArrowRight){if(n&&!h.a.mac||r&&h.a.mac)return"RightWord";if(i&&t)return"EndLine";if(a)return"Right"}if(o===s.ArrowUp){if(t&&i)return"Top";if(t&&n)return"PageUp";if(t&&r)return"StartLine";if(!t&&n)return"PrevHeader";if(a)return"Up"}if(o===s.ArrowDown){if(t&&i)return"Bottom";if(t&&n)return"PageDown";if(t&&r)return"EndLine";if(!t&&n)return"NextHeader";if(a)return"Down"}if(o===s.A&&n&&t)return"StartLine";if(o===s.E&&n&&t)return"EndLine";if(o===s.B&&n&&t)return"Left";if(o===s.F&&n&&t)return"Right";if(o===s.Home&&!t){if(n)return"Top";if(a)return"StartLine"}if(o===s.End&&!t){if(n)return"Bottom";if(a)return"EndLine"}return o===s.PageUp&&a?"PageUp":o===s.PageDown&&a?"PageDown":o===s.A&&i&&t||o===s.A&&n&&!t?"All":"None"}},{key:"updateAutocomplete",value:function(){if(!c.default.isDemoRunning&&f.a.isValid()){var e=f.a.getStartIndex(),t=f.a.getStartObject(),n=f.a.getStartOffset();f.a.isValid()&&t===f.a.getEndObject()&&n===f.a.getEndOffset()?v.a.updateFromPane({owner:t,index:e,start:n,element:f.a.getStartElement()}):v.a.hide()}}},{key:"keyup",value:function(e){if(e.normCode===l.a.KeyCode.Space&&g.a.clearGroupTextChanges(),c.default.preventAndStop(e),this.isTyping=!1,e.handled)return!0}},{key:"handleSelectAll",value:function(e){var t=e.indexOfFirstItem(),n=e.indexOfLastItem();return f.a.selectIndices(t,0,n,-1),!1}},{key:"handleSelectAllItem",value:function(){if(c.default.focusedPane&&c.default.focusedPane.isWriteable)return f.a.selectIndex(f.a.getStartIndex(),0,-1),!1}},{key:"_move",value:function(e){try{c.default.PAssert(508,e===l.a.Direction.Up||e===l.a.Direction.Down,"Must move in a direction")}catch(p){c.default.reportError(p)}var t,n,r=c.default.focusedPane,i=f.a.getStartIndex(),a=f.a.getEndIndex(),o=f.a.getStartItem(),s=f.a.getEndItem(),u=!1;if((o.parent()===s.parent()&&(u=!0),!u)&&!r.getNextItem(f.a.getEndIndex(),!0))for(var d=0;s;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(o.parent()===s.parent()){u=!0;break}s=s.parent()}if(u&&(e===l.a.Direction.Up?(t=r.getPreviousItem(i,!0),n=s.getIndex()+1):(t=r.getNextItem(a,!0),n=o.getIndex()),t)){r.setIgnoreRestoreScroll();var h=f.a.save();f.a.reset(),t.moveTo({parent:t.parent(),index:n},l.a.ChangeType.Local),f.a.restore(h),e===l.a.Direction.Up?f.a.scrollStartIntoView():f.a.scrollEndIntoView()}}},{key:"moveUp",value:function(){!c.default.focusedPane.isViewAgenda()&&f.a.isValid()&&this._move(l.a.Direction.Up)}},{key:"moveDown",value:function(){!c.default.focusedPane.isViewAgenda()&&f.a.isValid()&&this._move(l.a.Direction.Down)}},{key:"handleArrows",value:function(e){var t=c.default.focusedPane;if(!f.a.isValid())return!0;var n=this.getNavigationAction(e);this.lastNavigationAction=n;var r,a,o,s=f.a.getStartIndex(),u=f.a.getEndIndex(),l=f.a.getStartOffset(),d=f.a.getEndOffset(),h=f.a.getStartTotal(),p=f.a.getEndTotal(),g=t.indexOfLastItem(),v=s===u&&(0!==l||d!==p),m={fromArrows:!0},y=f.a.lastSingleSelection;if(e.shiftKey)if("Top"===n)a=[0,0,y?null===(o=f.a.getEndSelectionOfMap(y.selectedMap))||void 0===o?void 0:o.paneObject.index:u,-1,m];else if("Bottom"===n){var _;a=[y?null===(_=f.a.getStartSelectionOfMap(y.selectedMap))||void 0===_?void 0:_.paneObject.index:s,0,g,-1,m]}else(v||"Up"!==n&&"Left"!==n&&"LeftWord"!==n)&&"PageUp"!==n&&"PrevHeader"!==n?(v||"Down"!==n&&"Right"!==n&&"RightWord"!==n)&&"PageDown"!==n&&"NextHeader"!==n?v||("Left"===n||"LeftWord"===n||"StartLine"===n?a=[s,0,s,h]:"Right"!==n&&"RightWord"!==n&&"EndLine"!==n||(a=[u,0,u,p])):s===u?s+1<=g&&(a=[s,0,s+1,-1]):r=f.a.selectUpDown("down","NextHeader"===n,"PageDown"===n):r=f.a.selectUpDown("up","PrevHeader"===n,"PageUp"===n);else if("All"===n){var b=f.a.getStartItem();a=s!==u||!(null===b||void 0===b?void 0:b.isPrefixCodeBlock())||0===l&&d===p?[0,0,g,-1]:[s,0,s,-1]}else if("Top"===n)a=[0,0,0,0];else if("Bottom"===n)a=[g,-1,g,-1];else if(s!==u){if("Left"===n||"LeftWord"===n||"StartLine"===n)a=[s,0,s,0];else if("Right"===n||"RightWord"===n||"EndLine"===n)a=[u,-1,u,-1];else if("Up"===n||"PageUp"===n||"PrevHeader"===n){var w="PrevHeader"===n&&this.getPrevHeader(t,s)||"PageUp"===n&&this.getPageUp(t,s)||"Up"===n&&this.getPrevVMLI(t,s);a=[w,0,w,0]}else if("Down"===n||"PageDown"===n||"NextHeader"===n){var k="NextHeader"===n&&this.getNextHeader(t,u)||"PageDown"===n&&this.getPageDown(t,u)||"Down"===n&&this.getNextVMLI(t,u);a=[k,-1,k,-1]}}else if("PageUp"===n){var S=this.getPageUp(t,u);a=[S,0,S,0]}else if("PageDown"===n){var E=this.getPageDown(t,u);a=[E,-1,E,-1]}else if("PrevHeader"===n){var P=this.getPrevHeader(t,u);a=[P,0,P,0]}else if("NextHeader"===n){var I=this.getNextHeader(t,u);a=[I,-1,I,-1]}if(r)t.listManager.scrollToIndex(r,"auto","auto");else{if(!(a&&a[0]>=0&&a[2]>=0))return!0;t.listManager.scrollToIndex(a[0],"auto","auto"),f.a.selectIndices.apply(f.a,i()(a)),e.shiftKey||f.a.setDownIndex()}}},{key:"keydown",value:function(e){this.isTyping=!0;var t=!0;return this.lastNavigationAction=void 0,e.normCode===l.a.KeyCode.Escape?f.a.onPressEnter():m.indexOf(e.normCode)>=0||h.a.mac&&e.ctrlKey&&e.normCode===l.a.KeyCode.D?t=this.keypress(e,!0):y.indexOf(e.normCode)>=0?t=this.handleArrows(e):h.a.mac&&e.metaKey||!h.a.mac&&e.ctrlKey&&!e.altKey?e.normCode!==l.a.KeyCode.Y&&e.normCode!==l.a.KeyCode.Z||(t=this.keypress(e,!0)):h.a.mac&&e.ctrlKey&&e.normCode===l.a.KeyCode.H&&c.default.preventDefault(e),t&&this.keyWantsScrollIntoView(e,!0)&&f.a.scrollStartIntoView(),t}},{key:"checkKeypressSpecialCases",value:function(e,t){var n;return e.ctrlKey&&e.altKey&&t?n=!0:e.metaKey&&e.normCode===l.a.KeyCode.Tilde&&(n=!1),n}},{key:"keypress",value:function(e,t,n){var r=this,i=[l.a.KeyCode.Enter,l.a.KeyCode.D];c.default.stopPropagation(e);var a=!0,o=c.default.focusedPane,s=e.normCode>=32||i.indexOf(e.normCode)>=0;if(!(0===e.which)&&(t||s)){if(h.a.mac&&e.metaKey||!h.a.mac&&e.ctrlKey)switch(String.fromCharCode(e.normCode)){case"c":case"C":return e.handled=!0,!0;case"v":case"V":return e.handled=!0,!0;case"x":case"X":return e.handled=!0,!0;case"Y":case"y":case"Z":case"z":try{c.default.PAssert(509,!1,"Should not be handled undo/redo hotkeys here")}catch(v){c.default.reportError(v)}return e.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return e.handled=!0,!0}var u=f.a.getStartItem();g.a.saveDeleteSelection(),g.a.beginAction();var d=[l.a.KeyCode.Tab,l.a.KeyCode.Enter,l.a.KeyCode.Backspace,l.a.KeyCode.Delete,l.a.KeyCode.D];f.a.getStartIndex()!==f.a.getEndIndex()&&e.normCode!==l.a.KeyCode.Tab&&((e.metaKey||e.ctrlKey||e.altKey)&&!d.includes(e.normCode)||(o.isViewOutline()||o.isViewProject()?!n&&f.a.isMultiselectDangerous()?(o.isViewFlatList()?p.default.toasts.pushMessage(l.a.MessageID.FlatSearchMultiSelect):f.a.confirmDangerousSelection((function(){r.keypress(e,t,!0)})),a=!1):o.isEditable?p.default.menus.isContextMenuOpen()||p.default.menus.isModalOpen()||(a=a&&this.handleMultiselect(e)):a=!1:(p.default.toasts.pushMessage({text:"Editing multiple items from this view is not currently supported. Please edit them individually.",actionText:"OKAY"}),a=!1))),a&&d.indexOf(e.normCode)>=0&&(p.default.PaneUpdateBatcher.beginUpdateItems(),e.normCode===l.a.KeyCode.Enter?a=!!o.isEditable&&(a&&this.handleEnter(e)):e.normCode===l.a.KeyCode.Backspace?a=!!(u&&u.allowTextEditing()&&o.isEditable)&&(a&&this.handleBackspace(e)):(e.normCode===l.a.KeyCode.Delete||h.a.mac&&e.ctrlKey&&e.normCode===l.a.KeyCode.D)&&(a=!!(u&&u.allowTextEditing()&&o.isEditable)&&(a&&this.handleDelete())),p.default.PaneUpdateBatcher.commitUpdateItems()),g.a.endAction()}return this.keyWantsScrollIntoView(e,t)&&f.a.scrollStartIntoView(),a}},{key:"handleMultiselect",value:function(e,t){var n=c.default.focusedPane,r=n.indexOfNextVMLI(f.a.getStartIndex()-1),i=n.indexOfPrevVMLI(f.a.getEndIndex()+1),a=f.a.getStartOffset(),o=f.a.getStartOffsetWithPrefix(),s=f.a.getEndOffset(),u=f.a.getEndOffsetWithPrefix();f.a.selectIndices(r,a,i,s);var d=!0,h=f.a.getStartObject(),g=f.a.getStartItem(),v=f.a.getEndObject(),m=f.a.getEndItem(),y=function(){if(n.hasNonVMLIs){var e=n.closestIndexOfObject(h);try{c.default.PAssert(510,e>=0,"Could not find item to select")}catch(t){c.default.reportError(t)}e>=0&&f.a.selectIndex(e,a)}else f.a.selectIndex(r,a)};if(r!==i||!(f.a.getStartOffset()>0||f.a.getEndOffset()<f.a.getEndTotal())){var _,b=f.a.getSelectedItems(!1,!0),w=null===(_=b.find((function(e){return e.checkDeleteProblem()})))||void 0===_?void 0:_.checkDeleteProblem();e.normCode!==l.a.KeyCode.Backspace&&e.normCode!==l.a.KeyCode.Delete&&e.normCode!==l.a.KeyCode.Enter||(d=!1);var k=function(){var e=0;p.default.PaneUpdateBatcher.beginUpdateItems();var r=g.parent(),i=n.createVMLI({text:""},{parent:r,changeType:l.a.ChangeType.AllLocal,isEditable:!0});r.insertItem(i,g.getIndex());for(var a=0;a<b.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=b[a];try{c.default.PAssert(511,o,"Item must exist")}catch(s){c.default.reportError(s)}o.isDeleted()||o.parent().deleteChild(o,void 0,void 0,l.a.ChangeType.Local)}p.default.PaneUpdateBatcher.commitUpdateItems(),y(),t&&t()};return w?p.default.menus.confirm("One of the selected items is ".concat(w,". Are you sure you want to delete?"),(function(e){e&&k()})):k(),d}var S=g.elsNew.split(h,o),E=m.elsNew.split(v,u),P=S[0].getRawText(h.showMarkdown())+(E[1]?E[1].getRawText(v.showMarkdown()):"");g.setText(P,l.a.ChangeType.Local),y(),t&&t()}},{key:"handleTab",value:function(e,t){var n,r=f.a.getPane(),i=f.a.getStartIndex(),a=f.a.getStartObject(),o=f.a.getEndObject(),s=f.a.getStartOffset(),u=f.a.getEndOffset(),d=!t,h=f.a.getStartItem(),v=f.a.getEndItem(),m=d?0:1;if(r.isViewFlatList())p.default.toasts.pushMessage(l.a.MessageID.FlatSearchTab);else{if(a.levelsDeepNew()<m)return!1;if(d&&r.isViewAutoBlocks()&&a.levelsDeepNew()===m){var y=r.prevPaneObjectAtSameLevel(i);if(!y||y.block!==a.block||y.item.parent()!==h.parent())return!1}h&&h.isNote()&&(h=h.parent()),v&&v.isNote()&&(v=v.parent()),f.a.scrollStartIntoView();var _=f.a.getSelectedObjects(),b={},w=[];_.forEach((function(e){var t=e.item;if(t){var n=null===t||void 0===t?void 0:t.parent();b[n.id]||w.push(e),b[t.id]=t}}));var k=[],S=h.parent(),E=d?null===(n=r.prevPaneObjectAtSameLevel(a.index))||void 0===n?void 0:n.item:h.parent().parent();if(E){var P,I;p.default.PaneUpdateBatcher.beginUpdateItems(),g.a.beginAction();var D=E.getChildIndex(S);w.forEach((function(t,n){var i=t.item;try{c.default.PAssert(512,i,"Must always be tabbing/untabbing valid items")}catch(f){c.default.reportError(f)}var o=n===w.length-1,s=i.getIndex();if(d){if(s>0&&!t.isBlockHeader&&E&&(k.push({item:i,parent:E,index:void 0}),E.isCollapsed(r)&&E.setCollapsed(!1,r),p.default.onIntroAction("Indent"),!e&&o&&!r.isPaneObjectCollapsed(t))){var u=i.getItems(),l=E.numItems()+1;u.forEach((function(e){b[e.id]||k.push({item:e,parent:E,index:l++})}))}}else if(i.parent()!==c.default.focusedItem&&!(r.isViewProject()&&a.block.id!==r.blockNoKey&&i.parent().parent()===c.default.focusedItem)){if(!e)r.getSiblingsAfterPaneObject(t).forEach((function(e,t){b[e.id]||k.splice(t,0,{item:e.item,parent:i,index:void 0})}));var h=D+1;k.splice(0,0,{item:i,parent:E,index:h})}})),k.forEach((function(e){var t=e.item,n=e.parent,r=e.index;t.moveTo({parent:n,index:r},l.a.ChangeType.Local)})),S.itemChanged.notify(),E.itemChanged.notify(),r.setIgnoreRestoreScroll(),g.a.endAction(),p.default.PaneUpdateBatcher.commitUpdateItems(!1,!1);var T=null===(P=r.findPaneObject(a.id))||void 0===P?void 0:P.index,x=a===o?T:null===(I=r.findPaneObject(o.id))||void 0===I?void 0:I.index;T>=0&&x>=0?f.a.selectIndices(T,s,x,u):requestAnimationFrame((function(){return f.a.updateCaret()}))}}}},{key:"handleEnter",value:function(e){var t=c.default.focusedPane,n=f.a.getStartItem(),r=f.a.getStartObject(),i=f.a.getStartIndex(),a=f.a.getStartOffset(),o=f.a.getStartOffsetWithPrefix(),s=f.a.getStartTotal(),u=f.a.getEndOffset(),h=f.a.getEndTotal();if(!n){try{c.default.PAssert(513,!1,"Invalid item in handleEnter")}catch(j){c.default.reportError(j)}return!1}var g=n.parent();if(!g){try{c.default.PAssert(514,!1,"Invalid parent in handleEnter")}catch(j){c.default.reportError(j)}return!1}var v,m,y=n.getParsedText(),_=n.getMooDate(),b=g.getItems().indexOf(n),w=!1,k=g,S=0;if(t.clearPreventUpdate(),t.setIgnoreRestoreScroll(),null===e||void 0===e?void 0:e.shiftKey)return c.default.preventDefault(e),!1;if(n.isNote()){if(e)return c.default.preventDefault(e),!1}else if(t.isViewProject()&&t.isItemTopLevel(r)&&n.hasChildren()&&0===n.getChild(0).getParsedTextWithoutPrefix().length)m=i+1;else if(n.shouldCopyPrefix()&&y===n.getPrefix())n.setText("",l.a.ChangeType.Local),m=i;else if(n.getPrefix()&&0===a&&u===h)n.setText(n.getPrefix(),l.a.ChangeType.Local),m=i;else{if(n.isPrefixCodeBlock())return!0;var E,P,I=!0,D=!1,T={text:""},x=r.block;t.setIgnoreRestoreScroll(),p.default.PaneUpdateBatcher.beginUpdateItems(),t.isViewTag()&&y.indexOf(r.block.text)>=0&&(E=r.block.text,P=y[n.getPrefixLength()]===l.a.TagPrefix?0:-1);var C=u;if(d.a.animateNext(),!t.isViewAgenda()||0!==r.levelsDeepNew()||n.hasVisibleChildren(t)&&!n.isCollapsed(t))if(n.hasAttachmentType(l.a.PluginType.Calendar));else if(0===C&&""!==y)b--,I=!1;else if(a>=s)(w=!n.isCollapsed(t)&&(n.getVisibleChildren(t).length>0||n.isPrefixHeader()&&!t.isViewFlatList()))&&(k=n);else if(0===a&&u===h)n.setText(n.getPrefix(),l.a.ChangeType.Local);else{var A=n.elsNew.split(r,o),L=r.showMarkdown(),O=A[0].getRawText(L),M=A[1].getRawText(L);E&&O.indexOf(E)<0&&(0===P?O=E+" "+O:O+=" "+E),T.text=M,_&&M.includes(l.a.CharDate)&&(T.date=_),n.setText(O,l.a.ChangeType.Local),D=!0,(w=!n.isCollapsed(t)&&(n.numItems()>0||n.isHeader()))&&(k=n)}else x.isStarred?T.isStarred=!0:x.isImportant?T.priority=n.getPriority():x.isDate&&x.date&&n.getMooDate()?(T.date=n.getMooDate().toData(),T.text=" "+l.a.CharDate):T.text=" "+x.id,n.shouldSave()||(b=-1);!w&&E&&T.text.indexOf(E)<0&&(0===P?T.text=E+" "+T.text:T.text+=" "+E);var R=p.default.settings.defaultItemPrefix.get();if(w||!n.shouldCopyPrefix()&&!D?(!w||w&&R&&(n.isPrefixHeader()||n.shouldCopyPrefix()&&n.prefix===R))&&(T.text=(R&&R+" ")+T.text):T.text=n.getPrefix()+T.text,v=t.createVMLI(T,{parent:k,changeType:l.a.ChangeType.AllLocal,isEditable:!0}),D&&v.copyProperties(n),v.parseText("",l.a.ChangeType.Local|l.a.ChangeType.All),w)n.insertItem(v,0);else{try{c.default.PAssert(515,!v.isNote(),"Should never be inserting a note here")}catch(j){c.default.reportError(j)}k.insertItem(v,b+1)}p.default.PaneUpdateBatcher.commitUpdateItems();var F=I?v:n;try{c.default.PAssert(516,F,"Expected another item to exist")}catch(j){c.default.reportError(j)}var N=t.closestIndexOfObject(r);m=I?t.indexOfItem(v,x):N,S=0}return m>=0&&f.a.selectIndex(m,S,S),e&&c.default.preventDefault(e),!1}},{key:"handleBackspace",value:function(e){var t=f.a.getStartItem(),n=f.a.getStartIndex(),r=f.a.getStartOffset(),i=f.a.getEndOffset(),a=f.a.getStartObject(),o=c.default.focusedPane,s=r===i;if(!t){try{c.default.PAssert(517,!1,"Invalid item in handleBackspace")}catch(P){c.default.reportError(P)}return!1}var u=t.parent();try{c.default.PAssert(518,u,"Must always have a valid parent for an item")}catch(P){c.default.reportError(P)}h.a.ie&&c.default.preventAndStop(e);var v=t.getParsedText(),m=t.hasAttachmentType(l.a.PluginType.Calendar);if(0===r&&0===i||""===v){if(a.isBlockHeader&&t.hasChildren());else if(t.isNote()&&""!==v);else if(m);else if(s&&t.hasPrefix())a.isBlockHeader&&t.hasChildren()||(t.setText(v.substr(t.getPrefixLength()),l.a.ChangeType.Local),f.a.selectIndex(n,0),this.updateAutocomplete());else if(f.a.getStartIndex()>0){var y=c.default.focusedPane.indexOfPrevVMLI(f.a.getStartIndex(),!0),_=y>=0&&c.default.focusedPane.objectAtIndex(y);if(_&&_.item.allowTextEditing()){var b=!0;(o.isViewAgenda()||o.isViewFlatList())&&0!==v.length&&(b=!1),b&&this.confirmDelete(t,(function(){o.setIgnoreRestoreScroll(),d.a.animateNext(),p.default.PaneUpdateBatcher.beginUpdateItems(),g.a.saveDeleteSelection();var e=_.item,n=e.isFullscreen(),r=_.getDisplayLengthWithoutPrefix(),i=n?0:y,a=o.objectAtIndex(i),s=n?0:r;if(f.a.selectIndex(i,s),v.length>0&&""!==v){0===r&&e.copyProperties(t),e.setText(e.elsNew.combineWith(t.elsNew),l.a.ChangeType.Local);var c=t.getMooDate();c&&!e.getMooDate()&&e.setMooDate(c,l.a.ChangeType.Local,!0),t.hasNote()&&(e.hasNote()||e.moveNote(t,l.a.ChangeType.Local))}u.deleteChild(t,e,0,l.a.ChangeType.Local),p.default.PaneUpdateBatcher.commitUpdateItems(),i=a.index,f.a.selectIndex(i,s)}))}}}else{if(!(r>0)||e.metaKey||t.elsNew.isElementAtOffsetEditable(a,r-1))return!0;var w=a.showMarkdown(),k=t.elsNew.elementAtOffset(a,r-1);if(k){var S=r-k.getStyledText(t,{showMarkdown:w}).length,E=t.elsNew.removeElement(k).getRawText(w);t.setText(E,l.a.ChangeType.Local),f.a.selectIndex(n,S)}}return!1}},{key:"handleDelete",value:function(){var e=f.a.getStartItem(),t=c.default.focusedPane;if(!e)return!1;var n=e.parent(),r=f.a.getStartObject(),i=e.getParsedText(),a=f.a.getStartIndex(),o=f.a.getStartOffset(),s=f.a.getEndOffset(),u=f.a.getEndTotal(),d=!0;if(""===i)if(t.isViewOutline()){if(e.isNote())n.setNote(void 0,l.a.ChangeType.Local),f.a.selectItem(n,-1);else if(a<t.numItems()-1){var h=a;this.confirmDelete(e,(function(){t.setIgnoreRestoreScroll(),g.a.saveDeleteSelection(),t.numItems()>1&&(e.hasChildren()?n.replaceChild(e,e.getFirstChild(),l.a.ChangeType.Local):n.deleteChild(e,n,h,l.a.ChangeType.Local)),f.a.selectIndex(h,0)}))}}else d=!1;else if(o===f.a.getStartTotal()&&s===u)if(t.isViewOutline())if(e.isNote())d=!1;else{var p=t.indexOfNextVMLI(a,!0),v=p>=0&&t.itemAtIndex(p);v&&d&&this.confirmDelete(v,(function(){t.setIgnoreRestoreScroll();var n=v.hasNote()&&v.getNote();e.setText(e.elsNew.combineWith(v.elsNew,(function(e){return!e.props.prefixType})),l.a.ChangeType.Local);var r=v.getMooDate();if(r&&!e.getMooDate()&&e.setMooDate(r,l.a.ChangeType.Local,!0),n){var i=e.hasNote()&&e.getNote();if(i){var a=i.getRawText()+"\n\n--- merged note ---\n\n"+n.getRawText();i.setText(a,l.a.ChangeType.Local)}else n.setParent(e),e.setNote(n,l.a.ChangeType.Local)}g.a.saveDeleteSelection(),v.parent().deleteChild(v,e,0,l.a.ChangeType.Local),f.a.selectIndex(f.a.getEndIndex(),s)}))}else d=!1;else{if(!(o<u-1)||e.elsNew.isElementAtOffsetEditable(r,o))return!0;var m=e.elsNew.elementAtOffset(r,o);if(m){var y=e.elsNew.removeElement(m).getRawText(r.showMarkdown());e.setText(y,l.a.ChangeType.Local),console.log(e.elsNew),f.a.selectIndex(a,o)}}return!1}},{key:"keyWantsScrollIntoView",value:function(e,t){switch(e.normCode){case l.a.KeyCode.LeftMeta:case l.a.KeyCode.ContextMenu:case l.a.KeyCode.Alt:case l.a.KeyCode.Shift:case l.a.KeyCode.Ctrl:case l.a.KeyCode.ArrowLeft:case l.a.KeyCode.ArrowRight:case l.a.KeyCode.ArrowUp:case l.a.KeyCode.ArrowDown:return!1}return!(h.a.mac&&e.metaKey&&(t&&e.normCode===l.a.KeyCode.Tilde||!t&&"`"===String.fromCharCode(e.normCode)))&&((!(h.a.mac&&e.metaKey||!h.a.mac&&e.ctrlKey)||e.normCode!==l.a.KeyCode.Z&&e.normCode!==l.a.KeyCode.Y)&&!(e.normCode>=l.a.KeyCode.F1&&e.normCode<=l.a.KeyCode.F12))}},{key:"compoundOperation",value:function(e){p.default.PaneUpdateBatcher.beginUpdateItems(),e(),p.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"confirmDelete",value:function(e,t){var n=e.checkDeleteProblem();n?p.default.menus.confirm("This item is ".concat(n,". Are you sure you want to delete it?"),(function(e){e&&t()})):t()}},{key:"getPageUp",value:function(e,t){for(var n=0,r=0;r<5&&t>0;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.indexOfPrevVMLI(t);i>=0&&(t=i)}return t}},{key:"getPageDown",value:function(e,t){for(var n=0,r=e.items.length(),i=0;i<5&&t<r;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e.indexOfNextVMLI(t);a>=0&&(t=a)}return t}},{key:"getPrevVMLI",value:function(e,t){var n=e.indexOfPrevVMLI(t);return n>=0?n:t}},{key:"getPrevHeader",value:function(e,t){var n=e.indexOfPrevHeader(t);return n>=0?n:t}},{key:"getNextVMLI",value:function(e,t){var n=e.indexOfNextVMLI(t);return n>=0?n:t}},{key:"getNextHeader",value:function(e,t){var n=e.indexOfNextHeader(t);return n>=0?n:t}}]),e}();t.a=new _},function(e,t,n){"use strict";var r,i=n(3),a=n.n(i),o=n(10),s=n.n(o),u=n(5),l=n.n(u),c=n(6),d=n.n(c),h=n(7),f=n.n(h),p=n(27),g=n(8),v=n(1),m=n(20),y=n(0),_=n(2),b=n(16),w=n(32),k=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/,S=function(){function e(t){var n=0,r=0;l()(this,e);try{y.default.PAssert(937,y.default.isObject(t),"Should always supply a valid object to init a contact")}catch(s){y.default.reportError(s)}this.id=t.id,this.type="contact",this.text=t.text||"",this.phoneNumbers=t.phoneNumbers||[],this.emails=t.emails||[];for(var i=0;i<this.phoneNumbers.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.phoneNumbers[i];a.link=this.formatPhone(a.number),a.type=a.type?a.type[0].toLowerCase():""}for(var o=0;o<this.emails.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.emails[o].link="mailto:"+this.emails[o].address}}return d()(e,[{key:"formatPhone",value:function(e){if(k.test(e)){var t=e.match(k),n="";return t[1]&&(n+="+1-"+t[1]+"-"),"tel:"+(n+=t[2]+"-"+t[3])}var r=e.replace(/\D+/g,"");try{y.default.PAssert(938,r&&""!==r,"Invalid phone number format: "+e)}catch(i){y.default.reportError(i)}return e.startsWith("+")&&(r="+"+r),"tel:"+r}}]),e}(),E=(r=function(){function e(){l()(this,e),this._contactCache={},this._contacts=new w.a,this._contactsByID={},this._contactsByName={},this.areContactsLoaded=!1}return d()(e,[{key:"init",value:function(){var e=this;_.default.settings.syncAccounts.listen((function(){return e.refreshContacts()}))}},{key:"loadContacts",value:function(e){if(!this.areContactsLoaded){var t=e||m.a.getContacts();try{y.default.PAssert(432,0===this._contacts.get().length,"Should only load contacts once")}catch(o){y.default.reportError(o)}if(this.areContactsLoaded=!0,t){for(var n=0,r=[],i=0;i<t.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=t[i];a.name&&(a.text=a.name,t[i].text=a.name,delete t[i].name),a.text&&(this._contactsByName[y.default.escape(a.text)]=a,r.push(a));try{y.default.PAssert(433,a.id,"Each contact must have a valid id")}catch(o){y.default.reportError(o)}}this._contacts.set(r)}else this.clearContacts()}}},{key:"updateContact",value:function(e){try{y.default.PAssert(434,e.id,"Incoming contacts must have a valid id")}catch(i){y.default.reportError(i)}try{y.default.PAssert(435,e.text,"All contacts are expected to have a text")}catch(i){y.default.reportError(i)}var t,n=y.default.escape(e.text),r=this._contactsByName[n];return e.emails&&e.emails.length&&(e.emails.forEach((function(e){return e.address=e.address.toLowerCase()})),e.emails=y.default.arrayUniques(e.emails,"address")),r?(e.emails&&!y.default.deepEqual(e.emails,r.emails)&&(r.emails=y.default.arrayUnionByKey(r.emails||[],e.emails,"address"),t=!0),e.phoneNumbers&&!y.default.deepEqual(e.phoneNumbers,r.phoneNumbers)&&(r.phoneNumbers=y.default.arrayUnionByKey(r.phoneNumbers||[],e.phoneNumbers,"number"),t=!0)):(this._contacts.push(e),e.text&&(this._contactsByName[n]=e),t=!0),this._contactCache[e.id]&&(this._contactCache[e.id]=new S(e)),t}},{key:"clearContacts",value:function(){this._contactCache={},this._contacts.clear(),this._contactsByName={}}},{key:"numContacts",value:function(){return this._contacts.get().length}},{key:"getContacts",value:function(){return this._contactsByName}},{key:"getAll",value:function(){return this._contacts.get()}},{key:"contactComparator",value:function(e,t){return e.text&&t.text?e.text.localeCompare(t.text):e.text&&!t.text?1:!e.text&&t.text?-1:void 0}},{key:"getRNList",value:function(e){var t=[];return this.findMatchLike(e,{}).forEach((function(e){var n=e.text.split(" "),r=n.map((function(e){return e[0]})).slice(0,Math.min(2,n.length)).join(""),i=e.emails;t.push({text:e.text,iconText:r,subText:i.length?i[0].address:void 0})})),t.sort(this.contactComparator),t}},{key:"emailComparator",value:function(e,t){return e.address.toLowerCase()===t.address.toLowerCase()}},{key:"emailComparatorSort",value:function(e,t){return e.address&&t.address?e.address.toLowerCase().localeCompare(t.address.toLowerCase()):e.address&&!t.address?1:!e.address&&t.address?-1:void 0}},{key:"phoneComparator",value:function(e,t){return e===t||e.number===t.number}},{key:"ensureCacheObject",value:function(e){try{y.default.PAssert(436,e,"Must have valid data to store in cache")}catch(n){y.default.reportError(n)}if(this._contactCache[e.id])return this._contactCache[e.id];var t=new S(e);return this._contactCache[e.id]=t,t}},{key:"findMatchExact",value:function(e){var t=this._contactsByName[y.default.escape(e)];if(t)return this.ensureCacheObject(t)}},{key:"findMatchLike",value:function(e,t){var n=0,r=t.max;try{y.default.PAssert(437,void 0!==e,"Must provide a valid contact part")}catch(f){y.default.reportError(f)}for(var i=e.toUpperCase(),a=[],o=this._contacts.get(),s=0;s<o.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=o[s],l=!1;if(u.text.toUpperCase().indexOf(i)>=0&&(l=!0),!l&&u.emails)for(var c=0,d=0;!l&&d<u.emails.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(u.emails[d].address.toUpperCase().indexOf(i)>=0){l=!0;break}}if(!l&&u.phoneNumbers){var h=0;for(d=0;!l&&d<u.phoneNumbers.length;++d){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(u.phoneNumbers[d].number.indexOf(i)>=0){l=!0;break}}}if(l&&(a.push(this.ensureCacheObject(u)),a.length>=r))break}return a.sort(this.contactComparator),a}},{key:"findContactByEmail",value:function(e){for(var t=0,n=0;n<this._contacts.get().length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._contacts.get()[n];if(r.emails)for(var i=0,a=0;a<r.emails.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r.emails[a].address===e)return r}}}},{key:"findEmailsLike",value:function(e,t){var n=0;try{y.default.PAssert(438,void 0!==e,"Must provide a valid email part")}catch(d){y.default.reportError(d)}t=t||20;for(var r=[],i=e.toUpperCase(),a=0;a<this._contacts.get().length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this._contacts.get()[a];if(o&&o.emails){var s=0,u=!1;o.text&&o.text.toUpperCase().indexOf(i)>=0&&(u=!0);for(var l=0;l<o.emails.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=o.emails[l].address;(u||c.toUpperCase().indexOf(i)>=0)&&r.push({id:o.id,type:"contact",text:o.text,email:c})}}if(r.length>=t)break}return r.sort(this.emailComparatorSort),r}},{key:"save",value:function(e){m.a.saveContacts(this._contacts.get(),e)}},{key:"handleRemoteContactLoad",value:function(e,t){for(var n=0,r=(this.numContacts(),[]),i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i],o={id:a.resourceName.replace("people/",""),accountID:t,text:""};if(a.names&&a.names.length>0){var s=a.names[0].displayName;o.text=s,"'"===o.text[0]&&(o.text=o.text.substr(1))}if(!o.text&&a.organizations){for(var u=0,l=0;l<a.organizations.length;l++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var c=a.organizations[l];c.metadata&&c.metadata.primary&&(o.text=c.name)}o.text||(o.text=a.organizations[0].name)}if(a.emailAddresses){var d=0;o.emails=[];for(var h=0;h<a.emailAddresses.length;h++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=a.emailAddresses[h],p=f.metadata&&f.metadata.primary,g={address:f.value};p&&(g.isPrimary=p),f.type&&(g.type=f.type),o.emails.push(g),!o.text&&g.isPrimary&&(o.text=g.address)}!o.text&&o.emails.length>0&&(o.text=o.emails[0].address)}if(a.phoneNumbers){var m=0;o.phoneNumbers=[];for(var _=0;_<a.phoneNumbers.length;_++){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var b=a.phoneNumbers[_],w=b.metadata&&b.metadata.primary,k={number:b.value};w&&(k.isPrimary=w),b.type&&(k.type=b.type),o.phoneNumbers.push(k)}}o.text?this.updateContact(o)&&r.indexOfWithProperty("id",o.id)<0&&r.push(o):y.default.shouldLog(v.a.LogLevels.Data)&&y.default.log("Contact entry with no name or email address",a)}return r.length&&this.save(r),r}},{key:"syncContactInfo",value:function(){var e=s()(a.a.mark((function e(t){var n=this;return a.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){p.a.getAccountAuthToken(t,[v.a.GScope.Contacts],(function(r){var i,o=[],u=r&&r.access_token,l=function(){var r=s()(a.a.mark((function r(s){var u,l;return a.a.wrap((function(r){for(var a=0,c=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(r.prev=r.next){case 0:return r.next=2,s.json();case 2:if((u=r.sent)&&u.connections){try{y.default.PAssert(439,y.default.isArray(u.connections),"Connections are not array")}catch(d){y.default.reportError(d)}y.default.isArray(u.connections)&&o.pushArray(u.connections),u.nextPageToken?i(u.nextPageToken):(l=n.handleRemoteContactLoad(o,t),e(l))}case 4:case"end":return r.stop()}}}),r)})));return function(e){return r.apply(this,arguments)}}();i=function(){var e=s()(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return n="https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,phoneNumbers,organizations&access_token=".concat(u)+(t?"&pageToken=".concat(t):""),e.next=3,y.default.XHR({type:"GET",url:n});case 3:r=e.sent,l(r);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),u&&i()}))})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isEnabled",value:function(){return this.getSyncAccounts().length>0}},{key:"getSyncAccounts",value:function(){var e=_.default.settings.syncAccounts.get();return Object.keys(e).filter((function(t){return!!e[t][v.a.PluginID.Contacts]}))}},{key:"refreshContacts",value:function(e){var t=this;p.a.onLoaded(s()(a.a.mark((function n(){var r,i,o;return a.a.wrap((function(n){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(n.prev=n.next){case 0:if(!((r=t.getSyncAccounts()).length>0)){n.next=10;break}return n.next=4,Promise.all(r.map(t.syncContactInfo));case 4:i=n.sent,(o=i.flat()).length>0&&(_.default.PaneUpdateBatcher.beginUpdateItems(),b.a.parseAll(v.a.ChangeType.Auto),_.default.PaneUpdateBatcher.updateAllItems(!1,!0),_.default.PaneUpdateBatcher.commitUpdateItems()),e&&e(o),n.next=11;break;case 10:e&&e([]);case 11:case"end":return n.stop()}}}),n)}))))}}]),e}(),f()(r.prototype,"getRNList",[g.a],Object.getOwnPropertyDescriptor(r.prototype,"getRNList"),r.prototype),f()(r.prototype,"syncContactInfo",[g.a],Object.getOwnPropertyDescriptor(r.prototype,"syncContactInfo"),r.prototype),f()(r.prototype,"refreshContacts",[g.a],Object.getOwnPropertyDescriptor(r.prototype,"refreshContacts"),r.prototype),r);t.a=new E},function(e,t,n){"use strict";var r=n(3),i=n.n(r),a=n(10),o=n.n(a),s=n(5),u=n.n(s),l=n(6),c=n.n(l),d=n(0),h=n(1),f=n(36),p=(n(21),n(25)),g=function(){function e(){u()(this,e),this.url=h.a.CloudFunctionsURL}return c()(e,[{key:"run",value:function(){var e=o()(i.a.mark((function e(t){var n,r,a,o,s,u,l,c,d,f=arguments;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},r=n.query,a=n.body,o=n.retry,e.next=3,this.createURL(t,r,o);case 3:if(!(s=e.sent)){e.next=25;break}return u=a?{method:"POST",body:JSON.stringify(a)}:void 0,e.next=8,fetch(s,u);case 8:if(200!==(l=e.sent).status){e.next=16;break}return e.next=12,l.json();case 12:return c=e.sent,e.abrupt("return",{value:c,errorCode:void 0,error:void 0});case 16:return e.next=18,l.json();case 18:if(d=e.sent,o||"Unauthorized idToken"!==d.message){e.next=22;break}return console.log("Retrying becaus of invalid idToken"),e.abrupt("return",this.run(t,{query:r,body:a,retry:!0}));case 22:return e.abrupt("return",{value:void 0,errorCode:d.errorCode||d.status||l.status,error:d.message,braintreeError:d.braintreeError,braintreeErrorCode:d.braintreeErrorCode});case 23:e.next=26;break;case 25:return e.abrupt("return",{value:void 0,errorCode:h.a.PrivateAPIErrorCodes.MissingIDToken,error:"User does not have a valid id_token"});case 26:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createURL",value:function(){var e=o()(i.a.mark((function e(t){var n,r,a,o,s,u,l,c=arguments;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},r=c.length>2?c[2]:void 0,e.next=4,f.a.getUser();case 4:return a=e.sent,e.next=7,a.getIdToken(!!r);case 7:o=e.sent;try{d.default.PAssert(617,o,"User does not have a valid id_token")}catch(h){d.default.reportError(h)}if(!o){e.next=15;break}for(l in n.id_token=o,s=this.url+t+"?",u=[],n)n.hasOwnProperty(l)&&n[l]&&u.push(l+"="+encodeURIComponent(n[l]));return e.abrupt("return",s+u.join("&"));case 15:return e.abrupt("return",void 0);case 16:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendFeedback",value:function(e){return this.run("user/sendFeedback",{body:e})}},{key:"setUserProperties",value:function(e){var t=p.a.userOut(e);return this.run("user/setUserProperties",{body:t})}},{key:"shareDocument",value:function(e){return this.run("sharing/shareDocument",{body:e})}},{key:"listTransactions",value:function(){return this.run("billing/listTransactions")}},{key:"getBillingToken",value:function(){return this.run("billing/getBillingToken")}},{key:"updateOrPurchasePlan",value:function(e){return this.run("billing/updateOrPurchasePlan",{body:e})}},{key:"startTrial",value:function(){return this.run("billing/startTrial")}},{key:"cancelPremium",value:function(){return this.run("billing/cancelPremium")}},{key:"updatePremiumStatus",value:function(){return this.run("billing/updatePremiumStatus")}},{key:"deleteAccount",value:function(){return this.run("user/deleteAccount")}},{key:"acceptInvite",value:function(e){return this.run("sharing/acceptInvite",{body:{token:e}})}},{key:"todoistImport",value:function(e){return this.run("oauth/todoist",{body:{code:e}})}},{key:"getTemplateProperties",value:function(){var e=o()(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.run("templates/getProps",{query:{folderID:t}});case 2:return(n=e.sent).value&&(n.value.id=t),e.abrupt("return",n);case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTemplate",value:function(e,t,n,r){return this.run("templates/create",{body:{name:t,folderID:e,value:r,created:n}})}},{key:"updateIAP",value:function(){var e=o()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.run("billing/updateIAP",{body:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccessToken",value:function(e,t){return this.run("auth/getAccessToken",{query:{email:e,refresh_part:t}})}},{key:"onAuthCode",value:function(e){return this.run("auth/onAuthCode",{body:e})}},{key:"saveRefreshToken",value:function(e){return this.run("auth/saveRefreshToken",{body:e})}}]),e}();t.a=new g},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(1),u=n(0),l=n(2),c=n(16),d=function(){function e(t,n){i()(this,e),this.text=t,this.props=n||{}}return o()(e,[{key:"getText",value:function(){return this.text}},{key:"setText",value:function(e,t){var n=this.props;if(n.link)if(e){s.a.Regexp.MDLink.lastIndex=0;var r=s.a.Regexp.MDLink.exec(e);r?(n.link.text=r[2],n.link.href=r[3],n.link.showImage=n.link.isImage&&"!"===r[1]):void 0===n.link.text?n.link.href=e:t?delete n.link:n.link.text=e}else delete n.link;this.text=e}},{key:"setPropsText",value:function(e,t){var n=t||this.props;return n.link&&n.link.text&&(n.link.text=e),n}},{key:"canWrap",value:function(){var e=this.props;return!(e.date||this.isImage()||e.plugin||e.hr||e.itemLink||e.link&&e.link.appLink)}},{key:"mergeProps",value:function(e){this.props=Object.assign({},this.props,e)}},{key:"isBold",value:function(){var e=this.props;return!!(e.bold||e.contact||e.date||e.tag)}},{key:"isEditable",value:function(){var e=this.props;return!(e.plugin||e.date||e.itemLink||e.escaped||this.isImage())}},{key:"isImage",value:function(){var e=this.props;return e.link&&e.link.showImage&&e.link.isImage||e.plugin&&"Drive"===e.plugin.p&&!!e.plugin.showInline&&"false"!==e.plugin.showInline}},{key:"isEditableAtStart",value:function(){return!this.props.link}},{key:"isEditableAtEnd",value:function(){return!this.props.link}},{key:"getRawText",value:function(e){var t=this.props,n=this.text;if(t.formatting&&!e)return"";if(t.link){var r=t.link.text,i=t.link,a=i.href,o=i.imageSize,u=i.showImage,c=o?" =".concat(o,"x"):"";if(o&&!r)return r=a,"![](".concat(a).concat(c,")");if(r)return(u?"!":"")+(r!==a||o?"[".concat(r,"](").concat(a).concat(c,")"):a)}if(t.itemLink&&n)return"[[".concat(t.itemLink,"]]");if(n&&t.date)return s.a.CharDate;if(n&&t.plugin){var d=l.default.pluginManager.getPlugin(t.plugin.p),h=d.getAttachment(t.plugin.id);return d.getAttachmentEmbedString(h)}return n}},{key:"getStyledText",value:function(e,t){var n,r=this.props,i=r.plugin||r.date;if(i){var a=l.default.pluginManager.getPlugin(i.p);if(a&&(null===i||void 0===i?void 0:i.id)){try{u.default.PAssert(943,i.id,"If a plugin is specified, must have the ID for that plugin as well")}catch(p){u.default.reportError(p)}var o=a.getAttachment(i.id);n=a.getDisplayText(o,e)}else{try{u.default.PAssert(944,!1,"Plugin ".concat(null===i||void 0===i?void 0:i.p," failed to load ").concat(i.id))}catch(p){u.default.reportError(p)}n="Plugin ".concat(null===i||void 0===i?void 0:i.p," failed to load ").concat(i.id)}}else{var s=this.text;if(r.itemLink){var d,h,f=c.a.getItem(r.itemLink);if(f)h=f.getDisplayText(!1,!0)||"(Linked item has no text)";else;s=null!==(d=h)&&void 0!==d?d:"(Deleted item)"}else!r.prefixType||t&&t.noPrefix?t&&t.showMarkdown||(r.formatting?s="":r.escaped?s=r.escaped:(r.link&&r.link.text&&(s=r.link.text),"string"===typeof r.underline&&(s=r.underline),"string"===typeof r.bold&&(s=r.bold),"string"===typeof r.italic&&(s=r.italic),"string"===typeof r.strike&&(s=r.strike),"string"===typeof r.code&&(s=r.code))):"numList"===r.prefixType&&(s=e.numListNumber()+". ");n=s}return n}},{key:"getFixedWidth",value:function(e){return this.props.prefixType?s.a.PrefixWidth:this.props.hr?e.pane.maxWidthOfPaneObject(e):void 0}},{key:"getClassNames",value:function(e,t){var n=this.props,r="";if(n.prefixType&&(r+=" itemPrefix prefix"+n.prefixType.capitalize(),"task"===n.prefixType&&(r+=" icon-square-o")),n.link){r+=" mdSpan link c-link pressable"+(t?"":" cursor-pointer");var i=n.link.appLink;i&&(r+=" appLink inlineBordered heightLineHeight "+i)}return n.itemLink&&(r+=" itemLink inlineBordered heightLineHeight pressable"),n.email&&(r+=" email c-contact pressable"),n.contact&&(r+=" contact c-contact pressable"),n.tag&&(r+=" tag c-tag pressable"),n.hr&&(r+=" mdHR "+(n.hrHeavy?"heavy c-border-ultra-heavy":"c-border-heavy")),e||(n.formatting&&(r+=" mdFormat"),n.underline&&(r+=" mdUnderline"),n.bold&&(r+=" mdBold"),n.italic&&(r+=" mdItalic"),n.strike&&(r+=" mdStrike"),n.code&&(r+=" mdCode")),r}},{key:"getStyle",value:function(){}},{key:"hasFormat",value:function(){var e=this.props;return e.bold||e.underline||e.italic||e.strike||e.formatting||e.code}},{key:"getFormats",value:function(){var e=this.props;return{bold:e.bold,italic:e.italic,underline:e.underline,strike:e.strike,code:e.code}}},{key:"isFormatEqualTo",value:function(e){var t=this.props,n=e.props;return!t.bold===!n.bold&&!t.italic===!n.italic&&!t.underline===!n.underline&&!t.strike===!n.strike&&!t.code===!n.code}},{key:"padSpaces",value:function(e,t,n){return(t?" ":"")+e+(n?"":" ")}},{key:"getHTML",value:function(e,t,n,r){var i=this.props,a=this.text;if(i.prefixType||i.formatting)return"";if(i.link)return i.link.isImage&&i.link.showImage?'<img src="'.concat(i.link.href,'"></img>'):'<a href="'.concat(i.link.href,'">').concat(i.link.text||i.link.href,"</a>");if(i.date&&e.getMooDate())return this.padSpaces(e.getMooDate().toText(),t,n);if(i.plugin){var o=l.default.pluginManager.getPlugin(i.plugin.p),s=o.getAttachment(i.plugin.id),u=o.getURLForAttachment(s),d=o.getAttachmentTitleString(s);return this.padSpaces('<a href="'.concat(u,'">').concat(d,"</a>"),t,n)}if(i.itemLink){var h=c.a.getItem(i.itemLink);h&&(a=h.getStyledTextAsOneLine()),r&&(a="[[".concat(i.itemLink," ").concat(a,"]]"))}return"string"===typeof i.underline&&(a=i.underline),"string"===typeof i.bold&&(a=i.bold),"string"===typeof i.italic&&(a=i.italic),"string"===typeof i.strike&&(a=i.strike),"string"===typeof i.code&&(a=i.code),i.escaped&&(a=i.escaped),i.bold&&(a="<b>".concat(a,"</b>")),i.italic&&(a="<i>".concat(a,"</i>")),i.underline&&(a="<u>".concat(a,"</u>")),i.strike&&(a="<s>".concat(a,"</s>")),i.code&&(a='<span class="mdCode">'.concat(a,"</span>")),a}},{key:"getPlaintext",value:function(e){var t=this.props,n=this.text;if(t.prefixType)return"";if(t.link)return t.link.text||t.link.href;if(t.itemLink){var r=c.a.getItem(t.itemLink);r&&(n=r.getPlaintext())}if(t.escaped)return t.escaped;if(t.date&&e.getMooDate())return e.getMooDate().toText();if(t.plugin){var i=l.default.pluginManager.getPlugin(t.plugin.p),a=i.getAttachment(t.plugin.id);return i.getAttachmentTitleString(a)}return n}},{key:"split",value:function(t,n){var r,i,a=this.getStyledText(t.item,{showMarkdown:t.showMarkdown()});if(n>0){var o=a.slice(0,n);r=new e(o,this.setPropsText(o,u.default.cloneDeep(this.props)))}if(n<a.length){var s=a.slice(n);i=new e(s,this.setPropsText(s,u.default.cloneDeep(this.props)))}return[r,i]}},{key:"hasMobileExtraLength",value:function(){var e=this.props;if(e.plugin){var t=e.plugin.p;if(t===s.a.PluginID.Gmail||t===s.a.PluginID.Drive)return!0}return e.itemLink||e.link&&e.link.appLink}},{key:"getMobileRenderedText",value:function(e){return this.hasMobileExtraLength()?"".concat(s.a.RNSpace).concat(s.a.RNSpace).concat(s.a.RNSpace).concat(e).concat(s.a.RNSpace):e}},{key:"getMobileRenderedTextExtraLength",value:function(){return this.hasMobileExtraLength()?4:0}}]),e}();t.a=d},function(e,t,n){"use strict";var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(7),l=n.n(u),c=n(8),d=n(1),h=n(0),f=n(2),p=n(50),g=n(52),v=n(77),m=/(^|[\(\[\s-])(!?)(?:(?:(?:(https?|ftp|evernote|onenote|bear):\/\/)([^\s/$.?#'",]*[^\s'",]*))|((?:\w+\.)+(?:[a-zA-Z]{2,})+[\w/#?=&]*))(?=[ \.,'"\)\]]|$)/gi,y=", . ? ! ) ( : ; [ ] ' \" _".split(" "),_=", . ? ! ; :".split(" "),b=0,w=window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0},k=/(^#|[\(\s-]#)([^\s\[\]\(\)*#\'\"\uFEFE]+)/g,S=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,E=d.a.Regexp.Prefix,P=/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) (```[A-Za-z]*|\\`\\`\\`|\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) /gi,I=d.a.Regexp.MDLink,D=/^(-{3,})$/g,T=/^(={3,})$/g,x=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,C=d.a.Regexp.Interlink,A=/\\([\*_~`])/g,L=d.a.Regexp.DataImage,O=/file:\/\/\/(\S)*/,M=[{regexp:/(^|[^\\])(\*\*\*)(.+?)\2/g},{regexp:/(^|[^\\])(\*\*)(.+?)\2/g},{regexp:/(^|[^\\])(\*)(.+?)\2/g},{isStrike:!0,regexp:/(^|[^\\])(~~)(.+?)\2/g},{isCode:!0,regexp:/(^|[^\\])(`)([^`]+?)\2/g},{isUnderline:!0,regexp:/(^|[^\\])(__)(.+?)\2/g}],R=(r=function(){function e(){a()(this,e)}return s()(e,[{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"trimPunc",value:function(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}},{key:"insertElNew",value:function(e,t,n,r){return e.insert(t,n,r)}},{key:"_notifyParse",value:function(e){w.total++,w[e]++}},{key:"runParseSinglePlugin",value:function(e,t){return this.parseSinglePlugin(e.getRawText(),t)}},{key:"parseSinglePlugin",value:function(e,t){if(this._notifyParse("parseSinglePlugin"),!e||0===e.length)return{parsedText:void 0,els:void 0};try{h.default.PAssert(590,!b,"We do not support recursive calls to parse")}catch(o){h.default.reportError(o)}var n,r;if(b++,"\u2001"===e[0]||"\u2003"===e[0]){var i=!h.default.isFlagSet(t,d.a.ChangeType.ItemLoad),a=f.default.pluginManager.parseAttachmentEmbedString(e.slice(1,-1),i);r=[a],e=d.a.AttachChar,i&&(n=[new g.a(d.a.AttachChar,a.displayElement.attrs)])}else n=[new g.a(e)];return b--,{parsedText:e,attachments:r,elsNew:n}}},{key:"parseNoteNew",value:function(e){return this._notifyParse("parseNote"),{elsNew:new v.a(e.getRawText())}}},{key:"runParseTextNew",value:function(e,t){return this.parseTextNew(e,e.getRawText(),p.a.getContacts(),void 0,t)}},{key:"whiteoutText",value:function(e,t,n){return e=e.substr(0,t)+" ".repeat(n)+e.substr(t+n)}},{key:"insertLink",value:function(e,t,n,r,i,a,o){if(r){var s=!!h.default.parseEvernoteLink(r),u=h.default.isOneNoteLink(r),l=h.default.isBearLink(r),c={text:a,href:r,appLink:(s?"evernote":u&&"onenote")||l&&"bear"||void 0,isImage:i||h.default.isUrlImage(r),showImage:i,imageSize:o&&+o.replace(/\s|=|x/g,"")};return this.insertElNew(e,t,n,{link:c})}}},{key:"parseTextNew",value:function(e,t,n,r,i){e||(e={}),this._notifyParse("parseText");try{h.default.PAssert(591,!b,"We do not support recursive calls to parse")}catch(Le){h.default.reportError(Le)}b++;var a,o,s,u,l,c,p,g=t,w=t,P=0,R=0,F=i||!e.regexpFlags?d.a.RegexpFlags.All:e.regexpFlags,N=new v.a(t);if(t&&t.length>0&&(!r&&F>0&&(F&d.a.RegexpFlags.Prefix)===d.a.RegexpFlags.Prefix&&(E.lastIndex=0,null!==(a=E.exec(t))&&(c=a[1],P=a[0].length,c&&(p=0===c.indexOf("#")||0===c.indexOf("^")?"header":"["===c||"[]"===c||"[ ]"===c||"]"===c?"task":"*"===c||"-"===c?"bullet":c.startsWith("```")?"code":"numList",this.insertElNew(N,0,P,{prefixType:p}),w=(t=this.whiteoutText(t,a.index,P)).substr(P),R|=d.a.RegexpFlags.Prefix))),"code"!==p)){if(F>0&&(F&d.a.RegexpFlags.DataImage)===d.a.RegexpFlags.DataImage)for(var j=0;null!==(a=L.exec(t));){if(j++>5e3&&__infLoop&&__infLoop(j))throw new RangeError;this.insertLink(N,a.index,a[0].length,a[1],!0,void 0,a[2]),t=this.whiteoutText(t,a.index,a[0].length),R|=d.a.RegexpFlags.DataImage}if(F>0&&(F&d.a.RegexpFlags.Plugin)===d.a.RegexpFlags.Plugin){var U=0;for(S.lastIndex=0;null!==(a=S.exec(t));){if(U++>5e3&&__infLoop&&__infLoop(U))throw new RangeError;var B=f.default.pluginManager.parseAttachmentEmbedString(a[1],!0);this.insertElNew(N,a.index,a[0].length,{plugin:B}),t=this.whiteoutText(t,a.index,a[0].length),u?u.push(B):u=[B],R|=d.a.RegexpFlags.Plugin}}if(F>0&&(F&d.a.RegexpFlags.Date)===d.a.RegexpFlags.Date){var V=t.indexOf(d.a.CharDate);if(V>=0&&e){var H={p:d.a.PluginID.Date,id:e.id,itemID:e.id};H.displayElement=f.default.pluginManager.createDisplayElement(H,!0),this.insertElNew(N,V,1,{date:H}),u?u.push(H):u=[H],R|=d.a.RegexpFlags.Date}}if(F>0&&(F&d.a.RegexpFlags.MDLink)===d.a.RegexpFlags.MDLink){var W=0;for(I.lastIndex=0;null!==(a=I.exec(t));){if(W++>5e3&&__infLoop&&__infLoop(W))throw new RangeError;var q="!"===a[1],z=a[2],G=a[3];G&&(q?this.insertLink(N,a.index,a[0].length,G,!0,z,a[4]):this.insertLink(N,a.index,a[0].length,G,!1,z),t=this.whiteoutText(t,a.index,a[0].length),R|=d.a.RegexpFlags.MDLink)}}if(!e||F>0&&(F&d.a.RegexpFlags.WebUrl)===d.a.RegexpFlags.WebUrl){var K=0;for(m.lastIndex=0;null!==(a=m.exec(t));){if(K++>5e3&&__infLoop&&__infLoop(K))throw new RangeError;var Y=a[4]||a[5];if(!Y)break;var Q=a[1].length,X=(a[3]||"http")+"://"+Y,$="!"===a[2],J=a.index+Q,Z=a[0].length-Q;this.insertLink(N,J,Z,X,$)&&(t=this.whiteoutText(t,J,Z)),R|=d.a.RegexpFlags.WebUrl}}if(!e||F>0&&(F&d.a.RegexpFlags.FileUrl)===d.a.RegexpFlags.FileUrl){var ee=0;for(O.lastIndex=0;null!==(a=O.exec(t));){if(ee++>5e3&&__infLoop&&__infLoop(ee))throw new RangeError;var te=a[0];this.insertLink(N,a.index,a[0].length,te,!1)&&(t=this.whiteoutText(t,a.index,a[0].length)),R|=d.a.RegexpFlags.FileUrl}}if(F>0&&(F&d.a.RegexpFlags.MarkdownEscaped)===d.a.RegexpFlags.MarkdownEscaped)for(var ne=0;null!==(a=A.exec(t));){if(ne++>5e3&&__infLoop&&__infLoop(ne))throw new RangeError;this.insertElNew(N,a.index,2,{escaped:a[1]}),R|=d.a.RegexpFlags.MarkdownEscaped}if(F>0&&(F&d.a.RegexpFlags.Markdown)===d.a.RegexpFlags.Markdown)for(var re=0,ie=0;ie<M.length;ie++){var ae=0;if(re++>5e3&&__infLoop&&__infLoop(re))throw new RangeError;var oe=M[ie].regexp;for(oe.lastIndex=0;null!==(a=oe.exec(t));){if(ae++>5e3&&__infLoop&&__infLoop(ae))throw new RangeError;if(!this.isInTag(a)){var se=M[ie],ue=se.isUnderline,le=se.isStrike,ce=se.isCode,de=a[1].length,he=a[2].length,fe=a[3],pe={};ue?pe.underline=!0:le?pe.strike=!0:ce?pe.code=!0:(he>=2&&(pe.bold=!0),2!==he&&(pe.italic=!0));var ge=a.index+de;this.insertElNew(N,ge,he,Object.assign({formatting:!0},pe)),this.insertElNew(N,ge+he,fe.length,pe),this.insertElNew(N,ge+he+fe.length,he,Object.assign({formatting:!0},pe)),t=this.whiteoutText(t,ge+he+fe.length,he),t=this.whiteoutText(t,ge,he),oe.lastIndex=0,R|=d.a.RegexpFlags.Markdown}}}if(F>0&&(F&d.a.RegexpFlags.HR)===d.a.RegexpFlags.HR&&(D.lastIndex=0,null!==(a=D.exec(w))&&(this.insertElNew(N,a.index+P,a[0].length,{hr:!0}),R|=d.a.RegexpFlags.HR),T.lastIndex=0,null!==(a=T.exec(w))&&(this.insertElNew(N,a.index+P,a[0].length,{hr:!0,hrHeavy:!0}),R|=d.a.RegexpFlags.HR)),!u&&F>0&&(F&d.a.RegexpFlags.Email)===d.a.RegexpFlags.Email){var ve=0;for(x.lastIndex=0;null!==(a=x.exec(t));){if(ve++>5e3&&__infLoop&&__infLoop(ve))throw new RangeError;this.insertElNew(N,a.index,a[0].length,{email:!0}),R|=d.a.RegexpFlags.Email}}if(F>0&&(F&d.a.RegexpFlags.Contact)===d.a.RegexpFlags.Contact&&n&&Object.keys(n).length>0){var me=t.split(d.a.ContactPrefix);if(me.length>1){var ye=0,_e=me[0].length;me=me.slice(1);for(var be=0;be<me.length;be++){if(ye++>5e3&&__infLoop&&__infLoop(ye))throw new RangeError;var we=me[be],ke=void 0;if(" "!==we[0]&&!y.includes(we[0]))for(var Se=0,Ee=0;Ee<we.length;Ee++){if(Se++>5e3&&__infLoop&&__infLoop(Se))throw new RangeError;var Pe=we.substr(0,Ee+1);n[Pe]&&(ke=Pe)}ke&&(s?s.push(ke):s=[ke],this.insertElNew(N,_e,ke.length+1,{contact:!0}),R|=d.a.RegexpFlags.Contact),_e+=we.length+d.a.ContactPrefix.length}}}if(F>0&&(F&d.a.RegexpFlags.Tag)===d.a.RegexpFlags.Tag){var Ie=0;for(k.lastIndex=0;null!==(a=k.exec(t));){var De=0;if(Ie++>5e3&&__infLoop&&__infLoop(Ie))throw new RangeError;for(var Te=a.index+a[1].length-1,xe=a[2].length+1,Ce=a[2];_.indexOf(Ce.charAt(Ce.length-1))>=0;){if(De++>5e3&&__infLoop&&__infLoop(De))throw new RangeError;xe--,Ce=Ce.substr(0,Ce.length-1)}Ce&&(o?o.push(Ce):o=[Ce]),this.insertElNew(N,Te,xe,{tag:!0}),R|=d.a.RegexpFlags.Tag}}if(F>0&&(F&d.a.RegexpFlags.ItemLink)===d.a.RegexpFlags.ItemLink){var Ae=0;for(C.lastIndex=0;null!==(a=C.exec(t));){if(Ae++>5e3&&__infLoop&&__infLoop(Ae))throw new RangeError;l||(l=[]),l.push(a[1]),this.insertElNew(N,a.index,a[0].length,{itemLink:a[1]}),R|=d.a.RegexpFlags.ItemLink}}u&&(S.lastIndex=0,g=g.replace(S,d.a.AttachChar))}return b--,{tags:o,attachments:u,contacts:s,prefix:c,prefixType:p,elsNew:N,parsedText:g,itemLinks:l,regexpFlags:R}}},{key:"isInTag",value:function(e){for(var t=0,n=e.index;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "===e.input[n])return!1;if("#"===e.input[n])return!0}return!1}},{key:"checkMultiplePrefixes",value:function(e){P.lastIndex=0;var t=P.exec(e);return t&&(e=t[2]+" "+e.substr(t[0].length)),e=e.replace(/^\\`\\`\\` /,"``` ")}}]),e}(),l()(r.prototype,"runParseSinglePlugin",[c.a],Object.getOwnPropertyDescriptor(r.prototype,"runParseSinglePlugin"),r.prototype),l()(r.prototype,"runParseTextNew",[c.a],Object.getOwnPropertyDescriptor(r.prototype,"runParseTextNew"),r.prototype),r);t.a=new R},function(e,t,n){"use strict";var r=n(41),i=n.n(r),a=n(39),o=n.n(a),s=n(5),u=n.n(s),l=n(6),c=n.n(l),d=n(1),h=n(0),f=n(28),p=n(22),g=1e5,v={notify:"n",duration:"d",gcalId:"c",gcalCalendar:"b",completes:"x",repeatComplete:"r"},m=h.default.invertObject(v),y={freq:"f",byweekday:"w",byday:"b",byhour:"h",bymonth:"m",bymonthday:"t",byyearday:"y",byweekno:"n",byminute:"o",bysecond:"s",dtstart:"d",until:"u",interval:"i",count:"c"},_=h.default.invertObject(y),b=Object.keys(v),w=d.a.CalendarDayViewNumDaysPad,k=function(){function e(t,n){if(u()(this,e),t instanceof Date)this.date=t,this.dateCleared=p.a.clearTime(t);else{this.rruleset=t;try{h.default.PAssert(580,this.rruleset._rrule[0],"MooDate missing rrule in constructor",(function(){return o()(t)}))}catch(r){h.default.reportError(r)}}n&&this.copyOptionsFrom(n,!0)}return c()(e,[{key:"getNext",value:function(e,t,n){var r=this;if(this.date)return this.date;var i=this.rruleset._rrule[0];try{h.default.PAssert(581,i,(function(){return"MooDate missing rrule: "+r.toData()}))}catch(u){h.default.reportError(u)}if(i){e||(e=new Date);var a,o=this.rruleset._rrule[0].options;o.dtstart&&o.dtstart>e?(a=o.dtstart,n&&(a=p.a.getDatePlusMS(a,d.a.MSPerMinute))):(t||!(o.freq<f.a.DAILY)&&(o.freq!==f.a.DAILY||o.byhour&&0!==o.byhour[0])||(e=p.a.getToday()),a=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes())));var s=this.rruleset.after(a,!0);return s&&(s=p.a.UTCtoLocal(s)),s}}},{key:"getStart",value:function(){if(this.date)return this.date;var e,t,n=this.rruleset._rrule[0].options,r=p.a.UTCtoLocal(n.dtstart);return(null===(e=n.byhour)||void 0===e?void 0:e[0])&&r.setHours(n.byhour[0]),(null===(t=n.byminute)||void 0===t?void 0:t[0])&&r.setMinutes(n.byminute[0]),r}},{key:"getEnd",value:function(e){var t=this.getDuration()||(e?0:d.a.DefaultEventDuration);if(this.date)return new Date(this.date.getTime()+t);var n=this.rruleset._rrule[0].options;if(n.until){var r,i,a=p.a.UTCtoLocal(n.until);return(null===(r=n.byhour)||void 0===r?void 0:r[0])&&a.setHours(n.byhour[0]),(null===(i=n.byminute)||void 0===i?void 0:i[0])&&a.setMinutes(n.byminute[0]),a.addMilliseconds(t),a}return new Date(this.getStart().getTime()+t)}},{key:"isOnDate",value:function(e){if(this.date){if(this.duration){var t=this.date.clone().addMilliseconds(this.duration);return e>=this.dateCleared&&e<=t}return+e===+this.dateCleared}return this._nextDates||this._generateDates(),!0===this._nextDatesMap[+e]}},{key:"getDate",value:function(){return this.date}},{key:"getFirstDate",value:function(){return this._nextDates||this._generateDates(),this._nextDates[0]}},{key:"_generateDates",value:function(){var e=this;if(!this.date&&!this._nextDates){var t=Date.now()+w*d.a.MSPerDay,n=this.rruleset.all((function(e,n){return n<w&&+e<t}));this._nextDates=n.map((function(e){return p.a.clearTime(p.a.UTCtoLocal(e))})),this._nextDatesMap={},this._nextDates.forEach((function(t){return e._nextDatesMap[+t]=!0}))}}},{key:"getAllDates",value:function(){return this.date?[this.date]:(this._nextDates||this._generateDates(),this._nextDates)}},{key:"isSingleDate",value:function(){return!!this.date}},{key:"isRange",value:function(){if(this.date)return!1;var e=this.rruleset._rrule[0].options;return 3===e.freq&&1===e.interval&&e.until}},{key:"hasTime",value:function(){var e;return null===(e=this.date||this.getFirstDate())||void 0===e?void 0:e.hasTimeOfDay()}},{key:"setDate",value:function(e){if(this.date&&!e.hasTimeOfDay()){var t=this.date.getTimeOfDay();this.date=p.a.clearTime(e).clone().addMilliseconds(t)}else this.date=e;this.dateCleared=p.a.clearTime(this.date),this.rruleset=void 0,this._nextDates=void 0}},{key:"setDuration",value:function(e){this.duration=e}},{key:"getDuration",value:function(){return this.duration}},{key:"setUntil",value:function(e){if(this.rruleset){var t=p.a.toUTCDate(e),n=this.rruleset._rrule[0];n.options.until=t,n.origOptions.until=t,this._nextDates=void 0}}},{key:"hasUntil",value:function(){var e;return!!(null===(e=this.rruleset)||void 0===e?void 0:e._rrule[0].options.until)}},{key:"setHours",value:function(e){var t=Math.floor(e),n=Math.round(60*(e-t));if(this.date)this.date.setHours(t),this.date.setMinutes(n);else{var r=this.rruleset._rrule[0];r.options.byhour=[t],r.origOptions.byhour=[t],r.options.byminute=[n],r.origOptions.byminute=[n],this._nextDates=void 0}}},{key:"clearTime",value:function(){if(this.date)this.date.setHours(0,0,0,0);else{var e=this.rruleset._rrule[0];e.options.byhour=[0],delete e.origOptions.byhour,e.options.byminute=[0],delete e.origOptions.byminute,this._nextDates=void 0}this.duration=0}},{key:"toText",value:function(e){var t,n=this;if(this.date)t=p.a.toHumanText(this.date);else{var r=this.rruleset._rrule[0];try{h.default.PAssert(582,r,"MooDate has no rrule",(function(){return n.toData()}))}catch(a){h.default.reportError(a)}r&&(t=e?r.toTextShort():r.toText())}if(t&&!e&&this.duration){var i=Math.round(this.duration/d.a.MSPerMinute);t+=" "+(i>=60?h.default.round(i/60,2)+"hr":Math.round(i)+"m")}return t||""}},{key:"getGCalId",value:function(){return this.gcalId}},{key:"getGCalCalendar",value:function(){return this.gcalCalendar}},{key:"setGCalId",value:function(e){this.gcalId=e}},{key:"setGCalCalendar",value:function(e){this.gcalCalendar=e}},{key:"setGCalIdAndCalendar",value:function(e,t){this.gcalId=e,this.gcalCalendar=t}},{key:"removeGCal",value:function(){this.gcalId=void 0,this.gcalCalendar=void 0}},{key:"clone",value:function(){return e.fromData(this.toData())}},{key:"isRepeatDate",value:function(){return!!this.rruleset}},{key:"getTime",value:function(){if(this.date)return this.date.getTimeOfDay();var e=this.getNext();return e||(e=this.rruleset&&this.rruleset.before(new Date))&&(e=p.a.UTCtoLocal(e)),e?e.getTimeOfDay():void 0}},{key:"copyOptionsFrom",value:function(e,t){(!0===t||t.includes("notify"))&&(this.notify=e.notify),(!0===t||t.includes("duration"))&&(this.duration=e.duration),(!0===t||t.includes("gcalId"))&&(this.gcalId=e.gcalId),(!0===t||t.includes("gcalCalendar"))&&(this.gcalCalendar=e.gcalCalendar),!0===t&&(this.completes=e.completes,this.repeatComplete="true"===e.repeatComplete||e.repeatComplete)}},{key:"copyFrom",value:function(e,t){e.rruleset?(this.rruleset=e.rruleset,this.date=void 0):e.date&&(this.date=e.date,this.dateCleared=p.a.clearTime(e.date),this.rruleset=void 0),this.copyOptionsFrom(e,t),this._nextDates=void 0}},{key:"complete",value:function(){if(this.isRepeatDate()){var e=new Date;this.completes?this.completes.push(e):this.completes=[e];var t,n=this.rruleset._rrule[0];if(this.repeatComplete){var r=this.getTime(),i=e.addSeconds(1);0===r&&(i=p.a.clearTime(i));var a=p.a.toUTCDate(i);n.origOptions.dtstart=a,n.options.dtstart=a,n=this.rruleset._rrule[0]=f.b.fromString(this.rruleset.toString());var o=p.a.getTodayPlusDays(1);e=this.getNext(o,!0,!0)}return(t=this.getNext(e,!0,!0))&&(t=p.a.toUTCDate(t),n.origOptions.dtstart=t,n.options.dtstart=t,this._nextDates=void 0),!!t}}},{key:"setRepeatOnComplete",value:function(e){this.repeatComplete=e}},{key:"toICal",value:function(){if(this.isRepeatDate())return this.rruleset.toString()}},{key:"setRRuleOptions",value:function(e){var t=new f.c;t.rrule(new f.b(e)),this.rruleset=t,this.date=void 0,this._nextDates=void 0}},{key:"updateRRuleOptions",value:function(t){var n,r=null===(n=this.rruleset)||void 0===n?void 0:n._rrule[0];r?(r.options=Object.assign(r.options,t),r.origOptions=Object.assign(r.origOptions,t),this.date=void 0,this.rruleset.options=Object.assign(this.rruleset.options,t),this.rruleset.origOptions=Object.assign(this.rruleset.origOptions,t),this.rruleset=e.fromData(this.toData()).rruleset,this._nextDates=void 0):this.setRRuleOptions(t)}},{key:"setRange",value:function(t,n,r){var i=e.getOptionsFromRange(t,n,r);i instanceof Date?this.setDate(t):this.setRRuleOptions(i)}},{key:"getRRuleOptions",value:function(){if(this.rruleset)return this.rruleset._rrule[0].options}},{key:"toData",value:function(){var e=this,t=[],n=[];if(b.forEach((function(t){var r=e[t];r&&("completes"===t?r=r.filter((function(e){return!isNaN(+e)})).map((function(e){return+e})).join(","):"duration"===t&&(r=Math.round(r/g)),n.push("".concat(v[t],":").concat(r)))})),n.length&&t.push(n.join(";")),this.date){var r=+this.date;if(!n.length)return""+r;t.push(r)}else t.push(this.rruleset._rrule.map((function(e){var t=e.origOptions;return Object.keys(t).map((function(e){var n=t[e];if(!h.default.isNullOrUndefined(n))return e=e.toLowerCase(),n instanceof Date?n=Math.round(+n/g):h.default.isArray(n)&&n[0]&&n[0]instanceof f.d?n=n.map((function(e){return e.weekday+(e.n&&e.n>0?"-"+e.n:"")})).join(","):h.default.isNumber(n)&&(n=Math.round(n)),"".concat(y[e],":").concat(n)})).filter((function(e){return!!e})).join(";")})).join("\n"));return t.join("\\")}}],[{key:"fromData",value:function(t){if(t&&"NaN"!==t){var n,r,a=+t;if(!h.default.isNumber(a)){var o=t.split("\\");if(o.length>1)n={},o[0].split(";").forEach((function(e){var t=e.split(":"),r=i()(t,2),a=r[0],o=r[1];"completes"===m[a]?o=o.split(",").map((function(e){return new Date(e)})):"duration"===m[a]&&(o*=g),n[m[a]]=o})),t=o[1]}if(t&&"NaN"!==t){if(a=+t,h.default.isNumber(a))r=new Date(a);else try{r=new f.c,t.split("n").forEach((function(e){var n={};if(e.split(";").forEach((function(e){var t,r=e.split(":"),a=i()(r,2),o=a[0],s=a[1],u=_[o];if(o===y.byweekday)s=s.split(",").map((function(e){var t=e.split("-"),n=i()(t,2),r=n[0],a=n[1],o=""!==r&&h.default.isNumber(+r)?+r:void 0,s=""!==a&&h.default.isNumber(+a)&&+a>0?+a:void 0;return new f.d(o,s)}));else if((null===(t=s)||void 0===t?void 0:t.indexOf(","))>0)s=s.split(",").map((function(e){return+e}));else if(h.default.isNumber(+s)){var l=s.indexOf(".");l>0&&(s=s.substr(0,l)),"dtstart"===u||"until"===u||s.length>6?s=new Date(+s*g):(s=+s,"interval"===u&&s<0&&(s=Math.abs(s)))}u&&(n[u]=s)})),n&&!h.default.isEmpty(n)){r.rrule(new f.b(n));try{h.default.PAssert(583,r._rrule[0],"RRuleSet created with no rrule",t)}catch(a){h.default.reportError(a)}}r._rrule[0]}))}catch(s){h.default.reportError(s,"Error parsing date string: "+t)}return new e(r,n)}}}},{key:"fromRRuleOptions",value:function(t,n){var r=new f.c;return r.rrule(new f.b(t)),new e(r,{duration:n})}},{key:"getOptionsFromRange",value:function(e,t,n){var r,i,a;if(void 0!==n&&(i=60*(n-(r=Math.floor(n))),e.setHours(r),e.setMinutes(i)),e=e.clone(),t=t.clone(),!e.equals(t)){i&&(e.setHours(i),t.setHours(i));var o={freq:f.a.DAILY,dtstart:p.a.toUTCDate(e),until:p.a.toUTCDate(t)};r&&(o.byhour=r?[r]:void 0),i&&(o.byminute=i?[i]:void 0),a=o}return a}},{key:"fromRange",value:function(t,n,r){var i,a=e.getOptionsFromRange(t,n,r);return a?(i=new f.c).rrule(new f.b(a)):i=t,new e(i)}},{key:"now",value:function(){return new e(new Date)}}]),e}();t.a=k},function(e,t,n){"use strict";var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(0),l=n(1),c=n(2),d=n(42),h=n.n(d),f=n(17),p=n.n(f),g=n(18),v=n.n(g),m=n(19),y=n.n(m),_=n(11),b=n.n(_),w=n(12),k=n(4),S=n(21),E=n(16),P=n(23),I=n(13),D=n(48),T=n(7),x=n.n(T),C=n(8),A=n(22),L=(r=function(){function e(t){for(var n in a()(this,e),t)t.hasOwnProperty(n)&&(this[n]=t[n]);this.id=t.id,this.text=t.name,this.search=this.pane.search,this.items=[],this.numInstancesOfItem={};try{u.default.PAssert(2549,this.id,"Added an agenda block without an id")}catch(r){u.default.reportError(r)}}return s()(e,[{key:"shouldShowTime",value:function(){return!this.isOverdue&&this.isDate}},{key:"heightOfHeader",value:function(){return 32}},{key:"heightOfSpaceBetween",value:function(){return 16}},{key:"heightOfAddButton",value:function(){return this.heightOfHeader()+this.heightOfSpaceBetween()}},{key:"numItems",value:function(){return this.items.length}},{key:"getLastItem",value:function(){var e=this.items[this.items.length-1];return e&&e.isNote()&&(e=e.parent()),e}},{key:"comparePriority",value:function(e,t){var n=e.getPriority(),r=t.getPriority();return n>r?-1:n<r?1:0}},{key:"compareDate",value:function(e,t){try{u.default.PAssert(2550,this.date,"This block does not have a date",this.text)}catch(h){u.default.reportError(h)}var n=this.pane,r=e.getNextDate()||e.getDate(n),i=t.getNextDate()||t.getDate(n);if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(r&&!i)return-1;if(!r&&i)return 1;if(!r&&!i)return 0;if(e.getDuration(n)>0){var a=e.getDisplayDateWithDuration(this.date);a&&(r=a)}if(t.getDuration(n)>0){var o=t.getDisplayDateWithDuration(this.date);o&&(i=o)}var s=A.a.clearTime(r),l=A.a.clearTime(i);if(+s!==+l)return s<l?-1:1;if(r.hasTimeOfDay()&&i.hasTimeOfDay()){var c=r.getTimeOfDay(),d=i.getTimeOfDay();return c===d?0:c<d?-1:1}return r.hasTimeOfDay()?1:i.hasTimeOfDay()?-1:0}},{key:"compareOrder",value:function(e,t){return e.index-t.index}},{key:"compareItemsAgenda",value:function(e,t){var n=e.item,r=t.item;u.default.DAssert(n,"Must have a valid left item to compare"),u.default.DAssert(r,"Must have a valid right item to compare"),u.default.DAssert(!n||n.parent(),"Must have a valid left parent item"),u.default.DAssert(!r||r.parent(),"Must have a valid right parent item"),n.isNote()&&(n=n.parent()),r.isNote()&&(r=r.parent());var i=this.isStarred||this.isImportant?0:this.compareDate(n,r);if(0===i){var a=this.isStarred?0:this.comparePriority(n,r);return 0===a?this.compareOrder(e,t):a}return i}},{key:"compareItemsCreated",value:function(e,t){return this.pane.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"compareItemsCompleted",value:function(e,t){return this.pane.compareDate(e.item.dateCompleted,t.item.dateCompleted)}},{key:"compareItemsModified",value:function(e,t){return this.pane.compareDate(e.item.dateModified,t.item.dateModified)}},{key:"addItem",value:function(e){try{u.default.PAssert(2551,e&&u.default.isVMLI(e),"Must be adding a valid item: "+u.default.getObjectInfo(e))}catch(t){u.default.reportError(t)}this.items.indexOf(e)<0&&this.items.push(e)}},{key:"toggleCollapsed",value:function(){this.pane.setBlockCollapsed(this,!this.isCollapsed())}},{key:"isCollapsed",value:function(){return this.pane.isBlockCollapsed(this)}},{key:"getItemID",value:function(e){var t=this.numInstancesOfItem[e.id]||0;return this.numInstancesOfItem[e.id]=t+1,e.id+"_"+this.id+(t?"_"+t:"")}},{key:"sort",value:function(e){var t;if(this.pane.isViewAgenda()){var n=this.pane.getSortModeBlocks();"Date"===n?t=this.compareItemsAgenda:"Created"===n?t=this.compareItemsCreated:"Completed"===n?t=this.compareItemsCompleted:"Modified"===n&&(t=this.compareItemsModified)}else this.pane.isViewCalendarMonth()?t=this.compareItemsAgenda:this.sortMode&&"None"!==this.sortMode&&(t=this.pane.getItemComparator());if(t){var r=e.map((function(e,t){return{item:e,index:t}}));return r.sort(t),r.map((function(e){return e.item}))}return e}},{key:"_getAllItemsSorted",value:function(e,t,n){var r=this;t.isHidden(this.pane)||e.push(t),n&&!t.isCollapsed(this.pane)&&t.getItems().forEach((function(t){return r._getAllItemsSorted(e,t,!0)}))}},{key:"getAllItemsSorted",value:function(e){var t=this,n=[];return this.items.forEach((function(r){return t._getAllItemsSorted(n,r,e)})),n=this.sort(n)}}]),e}(),x()(r.prototype,"compareItemsAgenda",[C.a],Object.getOwnPropertyDescriptor(r.prototype,"compareItemsAgenda"),r.prototype),x()(r.prototype,"compareItemsCreated",[C.a],Object.getOwnPropertyDescriptor(r.prototype,"compareItemsCreated"),r.prototype),x()(r.prototype,"compareItemsCompleted",[C.a],Object.getOwnPropertyDescriptor(r.prototype,"compareItemsCompleted"),r.prototype),x()(r.prototype,"compareItemsModified",[C.a],Object.getOwnPropertyDescriptor(r.prototype,"compareItemsModified"),r.prototype),x()(r.prototype,"toggleCollapsed",[C.a],Object.getOwnPropertyDescriptor(r.prototype,"toggleCollapsed"),r.prototype),r),O=n(75),M=n(46),R=n(58);function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var N={Groups_Project:{Default:"None",Available:["None","Alphabetical","NumItems","Date","Priority","Created","Modified","Completed"]}};N.Groups_Tag=N.Groups_Contact={Default:"Alphabetical",Available:["Alphabetical","NumItems"]},N.Agenda_Today=N.Agenda_Week=N.Agenda_Month=N.Agenda_All={Default:"Date",Available:["Date","Created","Completed","Modified"]};var j=function(e){v()(n,e);var t=F(n);function n(e){var r;a()(this,n),e.document||(e.document=E.a.getDefaultDocument());(r=t.call(this,e,{isWriteable:!0,hasNonVMLIs:!0,supportCollapsing:!0,supportCompleting:!0,supportIndent:!1,supportOffline:!0,supportMenuIcon:!0,supportViewMenu:!0,supportMultiselect:!1,supportClickOverviewScroll:!1,isDraggable:!0,overviewTracksScroll:!1,overviewCanTrackScroll:!0,combineOverdue:!0,supportHistory:!0,searchFilters:["project","task","starred","complete","priority","showOnlyMatches","showOnlyAgendaDates","showOnlyMatchingTags","showChildProjects"]})).type=l.a.PaneMode.Task,r.paneClass="paneTask",S.a.binder(h()(r),"getDayWidth","updateAllDay","scrollToToday","setViewMode","compareBlockDate","compareBlockName","compareBlockItemPriority","compareBlockItemCreated","compareBlockItemModified","compareBlockItemCompleted","compareItemDate","compareItemName","_itemSearchComparator","onScroll","addFnProject","addFnTag","addFnDate","onGCalendarActiveChanged","onGmailActiveChanged","onCalendarCustomDaysChanged","switchToOutline","onViewStateChanged","getItemComparator","onDayWeekStartChanged","_onSelectionChanged","setGroupMode","setSortBlocks","setSortItems"),r.dragHoveredBlock=new I.a;var i=e.viewState||{};return i.viewMode=i.viewMode||"Outline",i.sortModeBlocks=i.sortModeBlocks||{mode:"None"},i.sortModeItems=i.sortModeItems||{mode:"None"},u.default.isString(i.sortModeBlocks)&&(i.sortModeBlocks={mode:i.sortModeBlocks}),u.default.isString(i.sortModeItems)&&(i.sortModeItems={mode:i.sortModeItems}),r.viewState=new R.a(i,r.onViewStateChanged),r.item.get()||r.item.set(r.getDefaultDisplayItem()),r._allPaneItems=[],r._isViewHelper={},r.topBoxHeight.set(0,!1),r.blocksCollapsed=e.blocksCollapsed||{},r.dropEffect=function(e){var t=l.a.DropEffect.Move;return r.isCalendarItem(e)&&(t=l.a.DropEffect.Copy),t},r.displayLocalItems=new I.a(void 0===e.displayLocalItems||e.displayLocalItems),r.displayCalendars=new I.a(e.displayCalendars||{}),r.numAllDay=new I.a(0),r.setupViewState(),r.initBlocks(),r}return s()(n,[{key:"initBlocks",value:function(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForItem=void 0;var e=c.default.pluginManager.getPlugin(l.a.PluginID.GCalendar);e.isActive()&&this.useItemStore(e.getDefaultItemStore());var t=c.default.pluginManager.getPlugin(l.a.PluginID.Gmail);t.isActive()&&this.useItemStore(t.getDefaultItemStore()),c.default.pluginManager.listen("pluginActiveChanged",l.a.PluginID.GCalendar,this.onGCalendarActiveChanged),c.default.pluginManager.listen("pluginActiveChanged",l.a.PluginID.Gmail,this.onGmailActiveChanged),P.a.listen("selectionChanged",this._onSelectionChanged),c.default.settings.dayWeekStart.listen(this.onDayWeekStartChanged),c.default.settings.calendarCustomDays.listen(this.onCalendarCustomDaysChanged),c.default.pluginManager.getPluginGCalendar().onCalendarsSynced.listen(this.updateItems)}},{key:"destroy",value:function(){c.default.pluginManager.unlisten("pluginActiveChanged",l.a.PluginID.GCalendar,this.onGCalendarActiveChanged),c.default.pluginManager.unlisten("pluginActiveChanged",l.a.PluginID.Gmail,this.onGmailActiveChanged),P.a.unlisten("selectionChanged",this._onSelectionChanged),c.default.settings.dayWeekStart.unlisten(this.onDayWeekStartChanged),c.default.settings.calendarCustomDays.unlisten(this.onCalendarCustomDaysChanged),c.default.pluginManager.getPluginGCalendar().onCalendarsSynced.unlisten(this.updateItems),p()(b()(n.prototype),"destroy",this).call(this)}},{key:"getPaneIcon",value:function(){return this.isViewAgenda()?"today":"format_list_bulleted"}},{key:"keydown",value:function(e){return k.a.isValid()&&k.a.getStartIndex()===k.a.getEndIndex()&&(this.preventUpdateItemsForItem=k.a.getStartObject(),this.search.stickMatch(k.a.getStartItem())),p()(b()(n.prototype),"keydown",this).call(this,e)}},{key:"handleLeftSideTap",value:function(e,t){return this.clearPreventUpdate(),p()(b()(n.prototype),"handleLeftSideTap",this).call(this,e,t)}},{key:"clearPreventUpdate",value:function(e){var t=this,n=this.preventUpdateItemsForItem;if(n&&c.default.DragDrop.isDragging){P.a.listen("endDrag",(function e(){P.a.unlisten("endDrag",e),t.clearPreventUpdate()}))}else{var r=e;n&&(r=r||this.search.unstickMatch(n.item),this.preventUpdateItemsForItem=void 0),r&&(this.setItemsDirty(),c.default.PaneUpdateBatcher.updateAllItems())}}},{key:"_onSelectionChanged",value:function(e){k.a.getPane()===this&&this.preventUpdateItemsForItem?k.a.isValid()?k.a.getStartObject().id!==this.preventUpdateItemsForItem.id&&(c.default.PaneUpdateBatcher.beginUpdateItems(),this.clearPreventUpdate(),c.default.PaneUpdateBatcher.updateAllItems(),e&&this.restoreSelection(e),c.default.PaneUpdateBatcher.commitUpdateItems()):(this.clearPreventUpdate(),this.updateItems()):this.clearPreventUpdate()}},{key:"isCalendarItem",value:function(e){return e.belongsToItemStore(c.default.pluginManager.getPlugin(l.a.PluginID.GCalendar).getDefaultItemStore())}},{key:"isEmailItem",value:function(e){return e.belongsToItemStore(c.default.pluginManager.getPlugin(l.a.PluginID.Gmail).getDefaultItemStore())}},{key:"_itemSearchComparator",value:function(e){var t=this,n=this.search.isMatched(e)||e.isNote()&&this.search.isMatched(e.parent()),r=!1,i=!1;if(this.isCalendarItem(e)){var a=e.getAttachmentByPlugin(l.a.PluginID.GCalendar);a&&("cancelled"===a.getField("status")?i=!0:a.forEachItem(void 0,(function(e){e.belongsToItemStore(a.getPlugin().getDefaultItemStore())||e.getDocumentOwner()!==t.getDocument()||(r=!0)})))}else if(this.isEmailItem(e)){var o=e.getAttachmentByPlugin(l.a.PluginID.Gmail);if(o){var s=c.default.pluginManager.getPluginGmail();if(s.isItemArchived(e))n=!1;else s.getAttachmentPriority(o)!==l.a.VMLIFlag.None&&(n=!0)}}return n&&!r&&!i}},{key:"getItemSearchParams",value:function(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.getItem(),comparator:this._itemSearchComparator,noCollapsed:this.isViewOutline(),includeNotes:!0,pane:this}}},{key:"_setItems",value:function(){this.updateBlockItems()}},{key:"getIndexOfToday",value:function(){var e;if(this.isViewCalendarMonth()){var t=this.getWeekStart(new Date);e=this.items.get().findIndex((function(e){return e.date.equals(t)}))}else if(this.isViewCalendarHoriz())e=l.a.CalendarDayViewNumDaysPad;else if(this.isViewAgenda())for(var n=0,r=this.items.get(),i=0;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if((a.isOverdue||a.isToday)&&"blockHeader"===a.type){e=i;break}}return e}},{key:"_getDateInMiddle",value:function(){var e=A.a.getToday(),t=this.getViewMode();return"Calendar_Month"===t?e=this.getMonthStart(e):"Calendar_Week"===t&&(e=this.getWeekStart(e)),e}},{key:"scrollToTop",value:function(e){this.isViewDates()?this.scrollToToday(e):p()(b()(n.prototype),"scrollToTop",this).call(this,e)}},{key:"onDayWeekStartChanged",value:function(){this.dateInMiddle=this._getDateInMiddle(),this.updateItemsImmediate(),this.scrollToToday()}},{key:"scrollToToday",value:function(e){if(this.isViewDates()){var t=this.getIndexOfToday();this.scrollIndexToTop(t,e)}}},{key:"weekCount",value:function(e,t,n){var r=new Date(e,t,1),i=n?new Date(e,t,n):new Date(e,t+1,0),a=r.getDay()+i.getDate();return Math.ceil(a/7)}},{key:"scrollJump",value:function(e,t){var n,r=this.getViewMode(),i=this.listManager.getScrollIndex(),a=this.objectAtIndex(i),o=i;if("Calendar_Month"===r){var s=a.date;if(e<0){var u=s.clone().addMonths(-1);n=this.weekCount(s.getFullYear(),s.getMonth(),s.getDate())-1,o-=this.weekCount(u.getFullYear(),u.getMonth())+n}else o+=this.weekCount(s.getFullYear(),s.getMonth())-(n=this.weekCount(s.getFullYear(),s.getMonth(),s.getDate())-1)}else if("Calendar_Custom"===r){o+=c.default.settings.calendarCustomDays.get()*e}else if("Calendar_Week"===r){var l=a.date.getDay(),d=c.default.settings.dayWeekStart.get();o+=e<0?l>d?-l+d:-7:7-l+d}else"Calendar_Day"===r&&(o+=e);this.setIgnoreRestoreScroll(),o>=0&&o<this.items.get().length&&this.scrollIndexToTop(o,t)}},{key:"compareDate",value:function(e,t){return e||t?e?t?e.compareTo(t):-1:1:0}},{key:"compareText",value:function(e,t){return e.localeCompare(t)}},{key:"comparePriority",value:function(e,t){var n=e.getPriority(this),r=t.getPriority(this);return r>n?1:r<n?-1:0}},{key:"compareBlockBase",value:function(e,t,n){try{u.default.PAssert(2067,e,"Comparator was invalid")}catch(s){u.default.reportError(s)}var r,i=this.getSortOrderBlocks()||1;if(e&&(r=this.compareNoKey(t,n)*i||e(t,n)),0===r||void 0===r){var a=N[this.getViewMode()].Default,o=this._getBlockSortComparator(a);if(o!==e)return o(t,n)}return r*i}},{key:"compareBlockPriority",value:function(e,t){return t.priority-e.priority}},{key:"compareNoKey",value:function(e,t){return e.id===this.blockNoKey?1:t.id===this.blockNoKey?-1:void 0}},{key:"compareNone",value:function(e,t){return e.originalIndex-t.originalIndex}},{key:"compareBlockDate",value:function(e,t){return this.compareDate(e.date,t.date)}},{key:"compareBlockName",value:function(e,t){return this.compareText(e.name,t.name)}},{key:"compareBlockNumItems",value:function(e,t){return t.items.length-e.items.length}},{key:"compareBlockItemPriority",value:function(e,t){return this.comparePriority(e.item,t.item)}},{key:"compareBlockItemCreated",value:function(e,t){return this.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"compareBlockItemModified",value:function(e,t){return this.compareDate(e.item.dateModified,t.item.dateModified)}},{key:"compareBlockItemCompleted",value:function(e,t){return this.compareDate(e.item.dateCompleted,t.item.dateCompleted)}},{key:"_getBlockSortComparator",value:function(e){return"Alphabetical"===e&&this.compareBlockName||"Date"===e&&this.compareBlockDate||"NumItems"===e&&this.compareBlockNumItems||"Priority"===e&&this.compareBlockItemPriority||"Created"===e&&this.compareBlockItemCreated||"Modified"===e&&this.compareBlockItemModified||"None"===e&&this.compareNone}},{key:"getBlockComparator",value:function(){var e=this.getSortModeBlocks();return this.compareBlockBase.bind(this,this._getBlockSortComparator(e))}},{key:"compareItemBase",value:function(e,t,n){try{u.default.PAssert(2068,e,"Comparator was invalid")}catch(a){u.default.reportError(a)}var r,i=this.getSortOrderItems();return e&&(r=e(t,n)*i),0===r||void 0===r?this.compareItemNone(t,n):r}},{key:"compareItemNone",value:function(e,t){return e.index-t.index}},{key:"compareItemDate",value:function(e,t){return this.compareDate(e.item.getNextDate(),t.item.getNextDate())}},{key:"compareItemName",value:function(e,t){return this.compareText(e.item.getSearchText(this),t.item.getSearchText(this))}},{key:"compareItemNumItems",value:function(e,t){return t.item.numItems()-e.item.numItems()}},{key:"_getItemSortComparator",value:function(e){return"Alphabetical"===e&&this.compareItemName||"Date"===e&&this.compareItemDate||"NumItems"===e&&this.compareItemNumItems||"Priority"===e&&this.compareBlockItemPriority||"Created"===e&&this.compareBlockItemCreated||"Modified"===e&&this.compareBlockItemModified||"Completed"===e&&this.compareBlockItemCompleted||"None"===e&&this.compareItemNone}},{key:"getItemComparator",value:function(){var e,t=this.getSortModeBlocks();if("Date"===t)e=this.compareItemDate;else if("Created"===t)e=this.compareBlockItemCreated;else if("Modified"===t)e=this.compareBlockItemModified;else if("Completed"===t)e=this.compareBlockItemCompleted;else{var n=this.getSortModeItems();e=this._getItemSortComparator(n)}return this.compareItemBase.bind(this,e)}},{key:"getItemsOnDate",value:function(e){var t=0,n=[];for(var r=0;r<this._itemsWithDates.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._itemsWithDates[r];i.getMooDate().isOnDate(e)&&n.push(i)}return n}},{key:"findIndexOfNextBlock",value:function(){for(var e=0,t=new Date,n=this.items.get(),r=0;r<n.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=n[r];if("blockHeader"===i.type){var a=i.block;if(a.isOverdue||a.isNow||a.isToday||a.isStarred||a.isImportant||a.date>=t)return r}}return-1}},{key:"_keyHelper",value:function(e,t){var n=e["get"+t](this);if(n){if("Priority"===t)n=[n];else if(n=n.map((function(e){return{value:e,lower:e.toLowerCase()}})),this.search.showOnlyMatchingTags()){var r=this.search["get"+t]();r&&r.length>0&&(r=r.map(u.default.toLowerCase),n=n.filter((function(e){for(var t=0,n=0;n<r.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.lower===r[n])return!0}})))}return n}if(this.search.isMatched(e,{isYes:!0})){var i=!0,a=e.parent();if(this.getBlock(this.blockNoKey)&&!this.isViewFlatList())for(var o=0;void 0!==a&&a!==this.getItem();){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(this.itemsInBlocks[a.id]){i=!1;break}a=a.parent()}if(i)return[this.blockNoKey]}}},{key:"_getKeysForItem",value:function(e){var t=this.getViewMode();if(this.isViewAgenda()||this.isViewCalendar()){var n=!0;if(this.isViewAgenda()&&e.hasAttachmentType(l.a.PluginType.Calendar)&&+e.getDate()<A.a.getTodayTime()){var r=e.getAttachmentByType(l.a.PluginType.Calendar),i=r.getPlugin();i.shouldDisplayOverdueInAgenda()&&i.hasWritePermissionForAttach(r)||(n=!1)}if(n){var a=this._getDatesForItem(e);if(this.isViewAgenda()&&"Date"===this.getSortModeBlocks()&&!this.search.showOnlyAgendaDates()){var o=[];if(!e.isComplete()){if(e.isStarred(this)){var s="starred";c.default.timeline.getDateForKey(s)&&o.push(s)}if(e.isImportant(this)){var u="important";c.default.timeline.getDateForKey(u)&&o.push(u)}}var d=e.getTagsLower();if(d)for(var h=0,f=0;d&&f<d.length;f++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var p="#"+d[f];c.default.timeline.getDateForKey(p)&&o.push(p)}o.length>0&&(a=a?a.concat(o):o)}return a}}else if("Groups_Project"===t){var g=this.getItem(),v=e.parent();if(v===g&&!e.isPrefixHeader())return[this.blockNoKey];if(v&&v.isPrefixHeader()&&v!==g&&(this.search.showChildProjects()||v.parent()===g))return[v.id]}else{if("Groups_Tag"===t)return this._keyHelper(e,"Tags");if("Groups_Contact"===t)return this._keyHelper(e,"Contacts");if("Groups_Priority"===t)return this._keyHelper(e,"Priority")}}},{key:"isOkOnAgenda",value:function(e){return!!this._getKeysForItem(e)||this.search.showHierarchy()&&e.parent()&&this.isOkOnAgenda(e.parent())}},{key:"_getDatesForItem",value:function(e){var t,n=this,r=this.getSortModeBlocks();if(this.isViewCalendar()||"Date"===r){var i=e.getMooDate();if(e.isComplete()&&this.isViewAgenda())+e.dateCompleted>=A.a.getTodayTime()&&(t=e.dateCompleted);else if(i){var a=i.getAllDates().filter((function(e){return n.isDateWithinRange(e)}));return a.length>10&&i.isRepeatDate()&&!i.isRange()&&(a=a.slice(0,10)),a}}else if("Created"===r||"Completed"===r||"Modified"===r){var o="Created"===r&&e.dateCreated||"Completed"===r&&e.dateCompleted||"Modified"===r&&e.dateModified;o&&(!this.startDate||o>=this.startDate)&&(t=o)}if(t&&this.isDateWithinRange(t))return[t]}},{key:"isDateWithinRange",value:function(e){return e&&(!this.endDate||+e<+this.endDate)&&this.search.isDateInRange(e)}},{key:"_getKeyForDate",value:function(e){var t=A.a.getToday();if(!(this.combineOverdue&&e<t)){var n=l.a.DFormat.MonthDayYearLong,r=c.default.International.getFormat(n);return e.toString(r)}return"overdue".toLowerCase()}},{key:"updateBlockItems",value:function(){var e,t=this.getViewMode();if(this.isViewOutline())this.updateOutline(this._allPaneItems,this.supportsSortItems()&&this.getItemComparator());else if(this.isViewCalendar()){var n=0;this._itemsWithDates=[];for(var r=0;r<this._allPaneItems.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this._allPaneItems[r];if(i.getMooDate()){var a=i.getAttachmentByType(l.a.PluginType.Calendar),o=a&&a.getField("calendarID");(o?!1!==this.displayCalendars.get()[o]:this.displayLocalItems.get())&&this._itemsWithDates.push(i)}}"Calendar_Month"===t?this.updateCalendarMonth():this.isViewCalendarHoriz()&&(this.updateCalendarWeek(),e=!0)}else this.updateBlocks(),this.updatePaneObjects();e&&this.updateAllDay()}},{key:"updateBlocks",value:function(){var e,t=0;this.blocks=[],this.blocksByKey={},this.itemsInBlocks={},this.isViewAgenda()&&this.getBlock(A.a.getToday());for(var n=0;n<this._allPaneItems.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._allPaneItems[n],i=!r.isNote();if(i)if(r.getMooDate()){var a=r.getAttachmentByType(l.a.PluginType.Calendar),o=a&&a.getField("calendarID");i=o?!1!==this.displayCalendars.get()[o]:this.displayLocalItems.get()}i&&this.addToBlock(this._allPaneItems[n])}this.isViewAgenda()?e=this.compareBlockDate:this.isViewPriority()?e=this.compareBlockBase.bind(this,this.compareBlockPriority):this.supportsSortBlocks()&&(e=this.getBlockComparator()),e&&this.blocks.sort(e)}},{key:"addItemToPaneObjects",value:function(e,t,n,r,i,a){var o=new D.a({type:"blockItem",item:n,id:t.getItemID(n)+(a?"_"+a.id:""),pane:this,block:t,parentObject:a,index:e.length,levelsDeepRoot:i,sizeInPane:n.sizeInPane});if(this.addPaneObject(e,o),r&&!n.isCollapsed(this)){var s=n.getVisibleChildren(this);if(s)for(var u=0,l=0;l<s.length;l++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;this.addItemToPaneObjects(e,t,s[l],r,i,o)}}return o}},{key:"updatePaneObjects",value:function(){for(var e,t,n,r=0,i=[],a=this.search.showHierarchy(),o=this.isViewAutoBlocks(),s=0;s<this.blocks.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=this.blocks[s],l=this.isBlockCollapsed(u)&&(s===this.blocks.length-1||!this.isBlockCollapsed(this.blocks[s+1]));if(u.item?(t=u.item).isNote()||(n=new D.a({type:"blockItem",item:t,id:t.id+"_"+u.id,pane:this,block:u,index:i.length,sizePad:l?u.heightOfSpaceBetween():u.isCollapsed()?0:4,sizeInPane:t.sizeInPane,levelsDeepRoot:t,isBlockHeader:!0,blockPrevious:this.blocks[s-1]}),this.addPaneObject(i,n)):this.isViewProjectNoBlocks()||this.addPaneObject(i,new D.a({type:"blockHeader",block:u,id:u.id,pane:this,index:i.length,isToday:u.isToday,isOverdue:u.isOverdue,isFirstCollapsed:e&&u.isCollapsed()&&!e.isCollapsed(),sizePad:l?u.heightOfSpaceBetween():this.isViewProject()||this.isViewAgenda()&&u.isDate?4:0,sizeInPane:u.heightOfHeader,blockPrevious:this.blocks[s-1]})),!this.isBlockCollapsed(u)){for(var c=0,d=!1,h=u.getAllItemsSorted(!a&&!o),f=0;f<h.length;f++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;t=h[f],n=this.addItemToPaneObjects(i,u,t,a,t),!d&&this.isViewAgenda()&&this.shouldShowTime(n)&&!t.getTime()&&(n.showAllDay=!0,d=!0)}this.isViewDateMetadata()&&!u.isToday||this.addPaneObject(i,new D.a({type:"blockAddItem",id:u.id+"_add",pane:this,block:u,index:i.length,sizeInPane:u.noAddButton?u.heightOfSpaceBetween():u.heightOfAddButton(),blockPrevious:this.blocks[s-1]}))}e=u}if(this.isViewProject()&&!this.isViewProjectNoBlocks()){var p=this.getBlock("newProject");p.isNewProject=!0,this.addPaneObject(i,new D.a({type:"blockHeader",block:p,id:p.id,pane:this,index:i.length,sizeInPane:p.heightOfHeader,blockPrevious:this.blocks[this.blocks.length-1]}))}this.items.set(i)}},{key:"addToBlock",value:function(e){this.isViewProject()&&e.isPrefixHeader()&&(this.search.showChildProjects()||e.parent()===this.getItem())&&this.getBlock(e.id,e);var t=this._getKeysForItem(e);if(t)for(var n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this.getBlock(t[r],e);i&&(i.addItem(e),this.itemsInBlocks[e.id]=!0)}}},{key:"_addFnBase",value:function(e,t,n,r,i){e=c.default.settings.getDefaultItemText(r)+e,this.clearPreventUpdate(),c.default.PaneUpdateBatcher.beginUpdateItems();var a={text:e};i&&(a=u.default.extend(a,i));var o=this.createVMLI(a,{parent:n,changeType:l.a.ChangeType.AllLocal,isEditable:!0});n.insertItem(o),c.default.PaneUpdateBatcher.commitUpdateItems();var s=this.indexOfItem(o,t);s>=0&&k.a.selectIndex(s,0)}},{key:"addFnProject",value:function(e){return this._addFnBase("",e,e.id===this.blockNoKey?this.getItem():E.a.getItem(e.id))}},{key:"addFnTag",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnDate",value:function(e){var t,n="";return this.isViewDateMetadata()||(e.isDate?(n=" "+l.a.CharDate,t={date:e.date}):e.isStarred?t={isStarred:!0}:e.isImportant?t={priority:l.a.VMLIFlag.P2}:n=" "+e.id),this._addFnBase(n,e,this.getItem(),void 0,t)}},{key:"addFnContact",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnPriority",value:function(e){return this._addFnBase("",e,this.getItem(),void 0,{priority:e.priority})}},{key:"getDateForSoftDate",value:function(e){var t=c.default.timeline.getDateForKey(e.toLowerCase());if(!isNaN(t)){var n=100*Math.round(t/100),r=Math.round(n/100),i=Math.round(t-n);return A.a.getTodayPlusMS(r*l.a.MSPerDay+i*l.a.MSPerMinute)}}},{key:"getBlock",value:function(e,t){var n,r,i=this.isViewDates(),a=this.isViewAgenda(),o=e;if(i&&!u.default.isString(e))n=e,o=e=this._getKeyForDate(n),"overdue"===e&&(!t.isComplete()&&c.default.timeline.getDateForKey(e)||(e=void 0),n=void 0);else if(u.default.isObject(e)){try{u.default.PAssert(2069,e.value&&e.lower,"If key is object it should have this form")}catch(p){u.default.reportError(p)}o=e.lower,e=e.value}if(e){var s,d=this.isViewAutoBlocks()?void 0:E.a.getItem(e),h=this.getViewMode();if(!(r=this.blocksByKey[o]))if(void 0!==(s=d?d.getStyledTextAsOneLine(!0):this.isViewPriority()?e===l.a.VMLIFlag.P0?"High Priority":e===l.a.VMLIFlag.P1?"Medium Priority":e===l.a.VMLIFlag.P2?"Low Priority":"(No priority)":e)){var f={pane:this,id:e,name:s,sortMode:this.supportsSortItems()&&this.getSortModeItems(),addFn:this.isViewProject()&&this.addFnProject.bind(this)||this.isViewTag()&&this.addFnTag.bind(this)||this.isViewContact()&&this.addFnContact.bind(this)||this.isViewPriority()&&this.addFnPriority.bind(this)||a&&this.addFnDate};this.isViewTag()?(f.name=e===this.blockNoKey?"(No tag)":"#"+f.name,f.isTag=!0):this.isViewContact()?(f.name=e===this.blockNoKey?"(No contact)":"+"+f.name,f.isContact=!0):this.isViewPriority()&&(f.isPriority=!0,f.priority=e),"Groups_Project"===h&&(f.name=e===this.blockNoKey?"(No project)":f.name,f.item=d,f.isEditable=!0,f.date=d&&d.getDate(this)),e===this.blockNoKey&&(f.isNoKey=!0),i&&(n?(f.date=A.a.clearTime(n),f.isDate=!0,f.date.equals(A.a.getToday())&&(f.isToday=!0)):(f.date=this.getDateForSoftDate(e),f.name=f.name.capitalize(),"now"===e?f.isNow=!0:"starred"===e?f.isStarred=!0:"important"===e?f.isImportant=!0:"overdue"===e&&(f.isOverdue=!0,f.noAddButton=!0))),r=new L(f),this.blocksByKey[o]=r,r.originalIndex=this.blocks.length,this.blocks.push(r)}}return r}},{key:"closestIndexOfObject",value:function(e){return this.isViewAutoBlocks()?this.indexOfItem(e.item,e.block,e.index):e.index}},{key:"onGCalendarActiveChanged",value:function(e,t){var n=e.getDefaultItemStore();t?this.useItemStore(n):this.stopUsingItemStore(n)}},{key:"onGmailActiveChanged",value:function(e,t){var n=e.getDefaultItemStore();t?this.useItemStore(n):this.stopUsingItemStore(n)}},{key:"_refreshPaneData",value:function(e){var t=c.default.pluginManager.getPluginGCalendar();t.isActive()&&t.forceRemoteEventSync(e)}},{key:"viewModeIcon",value:function(){var e=this.getViewMode();return l.a.TaskViewModeIcon[e]}},{key:"viewModeColor",value:function(){return l.a.Colors.Brand}},{key:"isViewDates",value:function(){return this._isViewHelper.dates}},{key:"isViewDateMetadata",value:function(){return this._isViewHelper.dateMetadata}},{key:"isViewAgenda",value:function(){return this._isViewHelper.agenda}},{key:"isViewCalendar",value:function(){return this._isViewHelper.calendar}},{key:"isViewCalendarHoriz",value:function(){return this._isViewHelper.calendarHoriz}},{key:"isViewCalendarMonth",value:function(){return this._isViewHelper.calendarMonth}},{key:"isViewProject",value:function(){return this._isViewHelper.project}},{key:"isViewProjectNoBlocks",value:function(){return this._isViewHelper.project&&(0===this.blocks.length||1===this.blocks.length&&this.blocks[0].id===this.blockNoKey)}},{key:"isViewOutline",value:function(){return this._isViewHelper.outline}},{key:"isViewFlatList",value:function(){return this._isViewHelper.flatList}},{key:"isViewTag",value:function(){return this._isViewHelper.tag}},{key:"isViewContact",value:function(){return this._isViewHelper.contact}},{key:"isViewPriority",value:function(){return this._isViewHelper.priority}},{key:"isViewAutoBlocks",value:function(){return this._isViewHelper.autoBlocks}},{key:"isViewText",value:function(){return this._isViewHelper.text}},{key:"isViewItems",value:function(){return this._isViewHelper.items}},{key:"isViewArchived",value:function(){return this._isViewHelper&&this._isViewHelper.archived}},{key:"isViewDeleted",value:function(){return this._isViewHelper&&this._isViewHelper.deleted}},{key:"canScrollToItem",value:function(){return!this.isViewCalendar()&&this.isViewItems()}},{key:"isViewPremiumBlocked",value:function(){return!c.default.billingManager.hasPremiumFeatures()&&l.a.TaskViewModesPremium[this.getViewMode()]}},{key:"shouldShowAddBox",value:function(){return this.canAddItem&&(this.isViewOutline()||this.isViewProject()||this.isViewAgenda())}},{key:"supportsGrouping",value:function(){return this._isViewHelper.supportGrouping}},{key:"isCalFilterActive",value:function(){var e=this.displayCalendars.get(),t=!this.displayLocalItems.get();for(var n in e)if(e.hasOwnProperty(n)&&!1===e[n]){t=!0;break}return t}},{key:"becomeReal",value:function(){p()(b()(n.prototype),"becomeReal",this).call(this),this.onViewStateChanged()}},{key:"onViewStateChanged",value:function(e,t){var n=this;this.isFakePane?this.setupViewStateMinor():(this.setIgnoreRestoreScroll(void 0,(function(){n.listManager.saveScrollOfTop()})),this.setupViewState(),this.listManager.clearCache(),this.updateItemsImmediate(!0,void 0,void 0,!0),c.default.PaneManager.updatePaneStateForPane(this),e&&t&&e.viewMode!==t.viewMode&&this.isViewCalendar()&&this.scrollToToday("auto"))}},{key:"setupViewStateMinor",value:function(){var e=this.getViewMode(),t=this.getSortModeBlocks(),n={agenda:"Agenda_Today"===e||"Agenda_Week"===e||"Agenda_Month"===e||"Agenda_All"===e,calendar:"Calendar_Day"===e||"Calendar_Week"===e||"Calendar_Month"===e||"Calendar_Custom"===e,calendarHoriz:"Calendar_Day"===e||"Calendar_Week"===e||"Calendar_Custom"===e,calendarMonth:"Calendar_Month"===e,project:"Groups_Project"===e,outline:"Outline"===e||"List_Flat"===e||"Archived"===e||"Deleted"===e,flatList:"List_Flat"===e||!this.search.showHierarchy(),tag:"Groups_Tag"===e,contact:"Groups_Contact"===e,priority:"Groups_Priority"===e,archived:"Archived"===e,deleted:"Deleted"===e,items:"Archived"!==e&&"Deleted"!==e,dateMetadata:"Created"===t||"Modified"===t||"Completed"===t};n.supportGrouping=!n.calendar,n.dates=n.agenda||n.calendar,n.autoBlocks=n.agenda||n.tag||n.contact||n.priority,n.text=!n.calendar,this._isViewHelper=n,this.supportsSortBlocks()&&(this.supportsSortBlocksMode(t)||this.setSortModeBlocks(N[e].Default,1,!1),"Completed"===(t=this.getSortModeBlocks())&&0===this.search.getFilterValue("completeOption")&&this.search.setFilter("completeOption",1)),this.search.setFilterEnabled("showOnlyAgendaDates",this.isViewAgenda()),this.search.setFilterEnabled("showOnlyMatchingTags",this.isViewTag()||this.isViewContact()),this.search.setFilterEnabled("showChildProjects",this.isViewProject()),(this.isViewTag()||this.isViewContact())&&this.search.setFilterTooltip("showOnlyMatchingTags","Show only matching "+(this.isViewTag()?"Tag":"Contact")+" blocks")}},{key:"setupViewState",value:function(){this.setupViewStateMinor();var e,t=this.getViewMode(),n=this.getSortModeBlocks(),r=this.isViewOutline(),i=this.isViewCalendar(),a=i?0:(this.isViewAgenda()||this.isViewProject()?48:l.a.TopBoxHeight)||!1,o=this.isViewItems();if(this.canAddItem=o,this.supportCompleting=o,this.supportCheckbox=o,this.supportPerformArchive=o,this.supportIndent=o,this.supportClone=o,this.contextMenuMode=(this.isViewArchived()?"Archived":this.isViewDeleted()&&"Deleted")||"Normal",this.isEditable=o,this.isDraggable=o,this.isDropTarget=o,this.scrollToStartOnSearch=!i,this.search.setFilterEnabled("complete",o),this.blockNoKey="__block_nokey_"+t,this.supportIndent=r,this.supportMultiselect=r,this.overviewTracksScroll=r,this.supportSearchFlat=!i,this.supportCheckbox=!i,this.topBoxHeight.set(a,!1),this.paneClass=this.getPaneClass(),this.paneEmptyMessage=(this.isViewArchived()?"No archived items":this.isViewDeleted()&&"No deleted items")||this.isViewAgenda()&&"Nothing on the agenda"||this.isViewOutline()&&"Write some things here to get started"||"",this.collapsedFieldName=l.a.PerPaneStateField.Collapsed+(this.viewState?t:""),this.isViewPremiumBlocked()?this.toast.set({text:new I.a("The "+l.a.TaskViewModeText[t]+" view is a Premium feature"),actionText:"GO TO OUTLINE",doAction:this.switchToOutline,noClose:!0}):this.toast.set(void 0),(this.isViewCalendar()||this.isViewAgenda())&&(e=l.a.ItemStoreFilter.Dates,(this.isViewCalendar()||"Date"===this.getSortModeBlocks())&&(e|=l.a.ItemStoreFilter.Priority)),this.search.itemStoreFilter=e,this.search.onlyMatchDates=this.isViewDates(),this.shouldUpdateOnTextChanged=this.isViewAgenda()||this.isViewTag(),this.combineOverdue=this.isViewAgenda()&&"Date"===n,this.showScrollbars.set(!this.isViewCalendar()),this.isViewAgenda()){var s,u;if("Agenda_All"!==t)"Agenda_Today"===t?u=1:"Agenda_Week"===t?u=7:"Agenda_Month"===t&&(u=30),s=A.a.getTodayPlusDays("Date"===n?u:-(u-1));"Date"===n?this.endDate=s:(this.startDate=s,this.endDate=A.a.getTodayPlusDays(1))}var d=c.default.pluginManager.getPluginGCalendar();this.supportDataRefresh=this.isViewDates()&&d.isOn()&&"Calendars",this.isEditable=this.supportSel=o&&!this.isViewCalendar(),this.orientation.set(this.isViewCalendarHoriz()?"horizontal":"vertical"),"Calendar_Week"===t||"Calendar_Month"===t?(this.minWidthFlex=700,this.maxWidthFlex=1200,this.maxWidthSingle=1600,this.minWidth=600,this.maxWidth=1600):(this.minWidth=l.a.PaneWidthMin,this.minWidthFlex=l.a.StdPaneWidthMin,this.maxWidth=l.a.PaneWidthMax,this.maxWidthFlex=this.maxWidthSingle=l.a.StdPaneWidthMax),this.dateInMiddle=this._getDateInMiddle(),c.default.PaneManager.updatePaneRects()}},{key:"getPaneClass",value:function(){return"paneTask "+(this.isViewCalendar()&&"paneCalendar c-background"+(this.isViewCalendarMonth()?" calendarMonthView c-bg-app":"")||this.isViewAgenda()&&"paneAgenda"||this.isViewProject()&&"paneProject"||this.isViewTag()&&"paneTag"||this.isViewContact()&&"paneContact"||this.isViewPriority()&&"panePriority"||this.isViewOutline()&&"paneOutline"||"")}},{key:"onScroll",value:function(){this.isViewCalendarHoriz()&&(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50))}},{key:"_handleDragOverPane",value:function(e,t,n,r,i,a,o){if(e&&r&&("blockHeader"===r.type||r.isBlockHeader)&&(this.isViewAgenda()&&e.supportDates||this.isViewAutoBlocks())){var s=r.block;return this.isViewAgenda()&&s.isOverdue&&(s=void 0),this.dragHoveredBlock.set(s),c.default.DragDrop.setBlockTarget(s),{block:s,targetPane:this}}if(!r||"blockItem"===r.type)return this.dragHoveredBlock.set(void 0),this.isViewCalendar()||c.default.DragDrop.setBlockTarget(void 0),this._handleDragOverTasks(t,n,r,i,a,o)}},{key:"_handleDragOverTasks",value:function(e,t,n,r,i,a){var o,s,c,d,h,f,p=!1,g=l.a.DragDropPosition.Below,v=!1,m=0;if(n){o=n.item,f=n.index,o.isNote()&&(f--,n=this.objectAtIndex(f),t=this.elementAtIndex(f),o=o.parent()),o.hasNote()&&(m=o.getNote().sizeInPane(this,f+1));var y=t.getBoundingClientRect(),_=y.height+m,b=this.isViewFlatList()||this.isViewAgenda()||this.isViewAutoBlocks(),w=o.hasText(),k=w?.38:.5;g=b?l.a.DragDropPosition.On:i<=y.top+_*k&&(!this.isViewProject()||0!==n.levelsDeepNew())?l.a.DragDropPosition.Above:i<y.top+_*(1-k)&&(b||w)&&o!==a?l.a.DragDropPosition.On:l.a.DragDropPosition.Below,c=t,p=!0}else if(0===this.numItems()||u.default.hasClass(e,"paneFooter"))o=this.getItem(),v=!0,d=!0;else if(this.isViewFlatList()||!u.default.findParent(e,"paneScroller")||this.isViewProject())if(this.isViewFlatList())o=this.getItem(),v=!0,d=!0;else{var S=this&&this.indexOfFirstItem();if(this&&S>=0)if((h=this.elementAtIndex(S))&&i<h.getBoundingClientRect().top)o=this.getFirstItem(),n=this.getFirstObject(),c=h,g=this.isViewProject()&&0===n.levelsDeepNew()?l.a.DragDropPosition.On:l.a.DragDropPosition.Above,p=!0}else{var E=this.indexOfLastItem();if(!p&&E>=0)if(i>=(h=this.elementAtIndex(E)).getBoundingClientRect().bottom)o=this.getLastItem(),n=this.getLastObject(),c=h,g=l.a.DragDropPosition.Below,p=!0}if(p){u.default.hasClass(c,"itemInPane")&&(c=u.default.findChild(c,"itemInPaneText"));var P,I=c.getBoundingClientRect(),D=g!==l.a.DragDropPosition.Below?I.top:I.top+I.height+m,T=g===l.a.DragDropPosition.On?I.height:void 0;if(D>this.contentTop())g===l.a.DragDropPosition.Below&&f+1<this.numItems()&&o.hasChildren()&&((P=this.objectAtIndex(f+1)).item||(P=void 0)),P=P||n,s={left:I.left,top:D,width:I.right-I.left,height:T}}return this.scrollFromMousePosition(r,i,"horizontal"===this.orientation.get()),{position:g,targetElement:c,targetItem:o,targetPane:this,linePosition:s,overview:!1,dropOnPane:v,atEnd:d}}},{key:"handleDragDrop",value:function(e,t,r,i){var a=this,o=c.default.DragDrop.blockTarget;if(!o)return p()(b()(n.prototype),"handleDragDrop",this).call(this,e,t,r,i);if(!o.date||!e.some((function(e){return e.isRepeatDate()}))){var s=function(){c.default.DragDrop.startPane.applyDropOnBlock(o,e,a,t.dataTransfer.block),a.revertDrag()},u=t.dataTransfer.pane,l=this.getDocument();return this!==u&&this.isViewCalendar()&&l!==u.getDocument()?(c.default.menus.confirm("You are dropping onto the calendar of a different document. Do you want to move this item to ".concat(l.text.get(),"?"),(function(n){n&&(a._handleDragDrop(e,t.dataTransfer,{targetPane:a,targetItem:a.getRootItem(),dropOnPane:!0},t,i),s())})),!0):(s(),!0)}c.default.toasts.pushMessage("Moo.do does not yet support moving repeat dates")}},{key:"revertDrag",value:function(){p()(b()(n.prototype),"revertDrag",this).call(this),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)}},{key:"getSaveInfo",value:function(){var e=p()(b()(n.prototype),"getSaveInfo",this).call(this);return e.viewState=this.viewState.get(),e.displayCalendars=this.displayCalendars.get(),e.displayLocalItems=this.displayLocalItems.get(),e.blocksCollapsed=this.blocksCollapsed,e}},{key:"isBlockCollapsed",value:function(e){return e.item?e.item.isCollapsed(this):this.blocksCollapsed[e.id]}},{key:"setBlockCollapsed",value:function(e,t){k.a.reset(),this.blocksCollapsed[e.id]=t,this.updateCollapsedObs(),this.updateBlockItems(),c.default.PaneManager.savePaneState()}},{key:"addProject",value:function(e,t,n){return this.addItem({index:e,prefix:l.a.Prefix.Header,text:t,toRoot:n})}},{key:"onTapAddItem",value:function(){p()(b()(n.prototype),"onTapAddItem",this).call(this)}},{key:"addItem",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.index,r=t.prefix,i=t.text,a=t.toRoot;n=n||0,i=i||"",void 0===r&&(r=c.default.settings.getDefaultItemText()),c.default.PaneUpdateBatcher.beginUpdateItems(),k.a.reset(),this.setIgnoreRestoreScroll();var o=a?this.getRootItem():this.getItem(),s={text:(r?r+" ":"")+i};this.isViewAgenda()&&(s.text=" "+l.a.CharDate,s.date=(new Date).clearTime()),1===this.search.getFilterValue("complete")&&(s.isComplete=!0),1===this.search.getFilterValue("starred")&&(s.isStarred=!0);var d=this.search.getFilterValue("priority");d&&(s.priority=d);var h=o.addItemAtIndex(s,n,this);if(this.isViewProject()&&r===l.a.Prefix.Header){var f=c.default.settings.getDefaultItemText();h.addItemAtIndex({text:f},n,this)}if(k.a.setFocusedPane(this),n>=0);c.default.PaneUpdateBatcher.commitUpdateItems();var p=this.indexOfItem(h);return p>=0&&(this.scrollIndexIntoView(p),k.a.selectIndex(p,0),w.a.isiOS&&!w.a.app&&(requestAnimationFrame((function(){e.scrollIndexIntoView(p)})),setTimeout((function(){k.a.selectIndex(p,0),e.scrollIndexIntoView(p)}),100))),u.default.sendEvent("Menu","AddItemButton"),h}},{key:"setDisplayLocal",value:function(e){this.displayLocalItems.set(e),this.updateItems()}},{key:"setDisplayCalendar",value:function(e,t){var n=u.default.clone(this.displayCalendars.get());n[e.id]=t,this.displayCalendars.set(n),this.updateItems()}},{key:"getCollapsedDefault",value:function(e,t){return t?e!==this.getRootItem():this.isViewOutline()?void 0:this.isViewProject()?!this.isItemTopLevel({item:e,isBlockHeader:e.isPrefixHeader()}):e.hasChildren()}},{key:"getWidthExtra",value:function(){if(this.isViewCalendar()&&!this.isViewCalendarMonth())return-l.a.CalendarTimesWidth}},{key:"getMonthStart",value:function(e){return A.a.getDatePlusDays(A.a.clearTime(e),1-e.getDate())}},{key:"getWeekStart",value:function(e){var t=A.a.clearTimeClone(e).previous();return 1===c.default.settings.dayWeekStart.get()?t.monday():t.sunday()}},{key:"doesWeekCrossMonth",value:function(e){if(e.clone().addDays(6).getDate()<e.getDate())return!0}},{key:"updateCalendarMonth",value:function(){var e,t,n,r=0,i=0,a=[],o=this.dateInMiddle,s=this.getWeekStart(o),u=l.a.CalendarMonthViewNumWeeksPad;for(n=0;n<=u;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=-u-1+n;e=s.clone().addWeeks(c),(t=this.doesWeekCrossMonth(e))&&a.push(this.updateCalendarMonthWeek(a.length,e,!0,!1)),a.push(this.updateCalendarMonthWeek(a.length,e,!1,t))}for(u=2*l.a.CalendarMonthViewNumWeeksPad+1,n=0;a.length<u;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e=s.clone().addWeeks(n),(t=this.doesWeekCrossMonth(e))&&a.length<u&&a.push(this.updateCalendarMonthWeek(a.length,e,!0,!1)),a.push(this.updateCalendarMonthWeek(a.length,e,!1,t))}this.items.set(a)}},{key:"updateCalendarMonthWeek",value:function(e,t,n,r){for(var i,a,o=0,s=[],u=1===t.getDate(),l=0;l<7;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=t.clone().addDays(l);i&&c.getDate()<i.getDate()&&(u=!0),!u&&r||u&&n||(s[l]={date:c,items:this.getItemsOnDate(c)},a||(a=c)),i=c}return new D.a({type:"calendarWeek",id:"week_"+t+(n?"_end":""),pane:this,date:a,dates:s,sizeInPane:this.heightWeek(),index:e})}},{key:"heightWeek",value:function(){return l.a.CalendarMonthViewWeekHeight}},{key:"updateCalendarWeek",value:function(){for(var e=0,t=[],n=l.a.CalendarDayViewNumDaysPad,r=this.dateInMiddle,i=this.getViewMode(),a=-n;a<n;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=r.clone().addDays(a),s=this.getItemsOnDate(o);t.push(new D.a({type:"calendarDay",id:i+"_day_"+(a+n),pane:this,date:o,items:s,sizeInPane:this.getDayWidth}))}this.items.set(t)}},{key:"getDatePlacementOnDate",value:function(e,t){var n=e.getHours()+e.getMinutes()/60,r=t?t/l.a.MSPerHour:1;if(r=Math.round(10*Math.min(r,24-e.getHours()))/10,n>0||r<24)return{time:n,duration:r}}},{key:"getItemPlacementOnDate",value:function(e,t){var n=!e.getDate(),r=e.getNextDate(t),i=e.getDuration()&&r&&e.getEndDate();if(r&&r.hasTimeOfDay()){if(n||A.a.isSameDay(r,t))return this.getDatePlacementOnDate(r,e.getDuration());if(i&&!A.a.isSameDay(r,t)&&A.a.isSameDay(i,t))return{time:0,duration:i.getHours()+i.getMinutes()/60};if(i&&!A.a.isSameDay(r,t)&&!A.a.isSameDay(i,t))return{time:0,duration:l.a.MSPerDay}}return!1}},{key:"numCalendarDaysInView",value:function(){var e=this.getViewMode();return("Calendar_Week"===e?7:"Calendar_Day"===e&&1)||"Calendar_Custom"===e&&c.default.settings.calendarCustomDays.get()||0}},{key:"updateAllDay",value:function(){if(!this._destroyed){for(var e=0,t=this.indexOfTop(),n=this.numCalendarDaysInView(),r=1,i=t;i<t+n;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.items.get()[i];if(a){for(var o=0,s=0,u=a.items||[],l=0;l<u.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=u[l];this.getItemPlacementOnDate(c,a.date)||s++}s>r&&(r=s)}}this.numAllDay.set(r)}}},{key:"getContentHeight",value:function(){return 1224+this.getHeightAllDay()+2}},{key:"getHeightAllDay",value:function(){return Math.min(l.a.CalendarDayViewMaxAllDayHeight,26*this.numAllDay.get())+1}},{key:"getDayViewY",value:function(){return 409}},{key:"getDayWidth",value:function(){var e=this.getWidth(),t=this.getViewMode(),n=("Calendar_Day"===t?1:"Calendar_Week"===t&&7)||"Calendar_Custom"===t&&c.default.settings.calendarCustomDays.get();return Math.max(e/n,40)}},{key:"extraPaddingForPaneObject",value:function(e){return this.isViewAgenda(),0}},{key:"shouldShowTime",value:function(e){var t="blockItem"===e.type&&e.item;return t&&!t.isNote()&&0===e.levelsDeepNew()&&e.block&&e.block.shouldShowTime()}},{key:"isItemTopLevel",value:function(e){var t=e.item,r=!0;if(this.isViewProject()){if(e)return e.isBlockHeader;r=t.isPrefixHeader()}return this.isViewProject()&&this.search.showChildProjects()||(r=p()(b()(n.prototype),"isItemTopLevel",this).call(this,e)),r}},{key:"calculateHasCollapsed",value:function(e){if(!e&&this.isViewAutoBlocks()){for(var t=0,n=0;this.blocks&&n<this.blocks.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.isBlockCollapsed(this.blocks[n]))return!0}return!1}}},{key:"toggleCollapseAll",value:function(){var e=!this.hasCollapsed();if(this.blocksCollapsed["__block_nokey_"+this.getViewMode()]=e,this.isViewAutoBlocks()){for(var t=0,r=0;r<this.blocks.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.blocksCollapsed[this.blocks[r].id]=e}e||(e=void 0),this.updateCollapsedObs()}p()(b()(n.prototype),"collapseAll",this).call(this,this.item.get(),e,void 0)}},{key:"getSupportedSortBlocksModes",value:function(){return N[this.getViewMode()].Available}},{key:"supportsSortBlocks",value:function(e){return e=e||this.getViewMode(),n.viewModeSupportsSortBlocks(e)}},{key:"supportsSortBlocksMode",value:function(e,t){return t=t||this.getViewMode(),n.viewModeSupportsSortBlocksMode(e,t)}},{key:"supportsSortItems",value:function(e){return e=e||this.getViewMode(),n.viewModeSupportsSortItems(e)||this.isViewFlatList()}},{key:"getSortModeBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.mode}},{key:"getSortOrderBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.order||1}},{key:"isSortedBlocks",value:function(){var e=this.getSortModeBlocks();return e&&"None"!==e}},{key:"setSortModeBlocks",value:function(e,t,n){this.setViewProp("sortModeBlocks",{mode:e,order:t},n)}},{key:"getSortModeItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.mode}},{key:"getSortOrderItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.order||1}},{key:"setSortModeItems",value:function(e,t,n){this.setViewProp("sortModeItems",{mode:e,order:t},n)}},{key:"isSortedItems",value:function(){var e=this.getSortModeItems();return e&&"None"!==e}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){this.setViewProp("viewMode",e)}},{key:"setViewProp",value:function(e,t,n){var r=this.viewState.get();if(r[e]!==t){var i=u.default.clone(r);i[e]=t,this.viewState.set(i,!1!==n)}}},{key:"createVMLI",value:function(e,t){var r=this.search.getTags();if(!this.isViewTag()&&r)for(var i=0,a=0;a<r.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a],s="#"+o;if(e.text.indexOf(s)<0){for(var u=0,l=!1,c=t&&t.parent;c;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var d=c.getTags();if(d&&d.indexOf(o)>=0){l=!0;break}c=c.parent()}l||(e.text+=" "+s)}}return p()(b()(n.prototype),"createVMLI",this).call(this,e,t)}},{key:"getItemDisplayTime",value:function(e){var t=this.getSortModeBlocks(),n=e.item;return"Date"===t?n.getTime()||(e.showAllDay?"All day":""):"Created"===t?n._formatDateTime(n.dateCreated):"Completed"===t?n.dateCompleted?n._formatDateTime(n.dateCompleted):"no time":"Modified"===t?n.dateModified?n._formatDateTime(n.dateModified):"no time":void 0}},{key:"onCalendarCustomDaysChanged",value:function(){"Calendar_Custom"===this.getViewMode()&&this.onViewStateChanged()}},{key:"switchToOutline",value:function(){this.setViewMode("Outline")}},{key:"shouldRenderPrefix",value:function(e){return!(this.isViewProject()&&e.isBlockHeader)}},{key:"bottomListMessage",value:function(){var e;if(!(this.numItems()>0)){var t=this.search.numUnmatchedItems();t&&(e=this.isSearched()?t+" items hidden by search / filters. Click the search box above to clear your search / filters, or click to add new items.":t+" completed items hidden by filter. Click the search box above and click the checkbox filter to show completed items.")}return{text:e,clickable:!1}}},{key:"needsUpdateForDate",value:function(){return this.isViewDates()}},{key:"needsUpdateForRepeatDateCompleted",value:function(){return!1}},{key:"needsUpdateForPriority",value:function(){return this.isViewPriority()||this.isViewAgenda()}},{key:"needsUpdateForModified",value:function(){return"Modified"===this.getSortModeBlocks()||"Modified"===this.getSortModeItems()}},{key:"_anyTagHasKey",value:function(e){return e&&e.some((function(e){return c.default.timeline.getDateForKey("#"+e)}))}},{key:"needsUpdateForTags",value:function(e){return this.isViewAgenda()&&this._anyTagHasKey(e)}},{key:"handleItemChanged",value:function(e,t){var r=!1;return(t.Tags&&this.isViewTag()||t.Text&&this.isViewContact())&&(r=!0),p()(b()(n.prototype),"handleItemChanged",this).call(this,e,t,r)}},{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.zoomItem,i=t.forLoad;p()(b()(n.prototype),"setDocument",this).call(this,e,{zoomItem:r,forLoad:i,noUpdateItems:!0}),this.onViewStateChanged()}},{key:"getItem",value:function(e){var t=this.getDocument();return e||this.isViewItems()?p()(b()(n.prototype),"getItem",this).call(this):this.isViewArchived()?t.getRootArchivedItem():this.isViewDeleted()?t.getRootDeletedItem():void 0}},{key:"getRootItem",value:function(){var e=this.getDocument();return this.isViewArchived()?e.getRootArchivedItem():this.isViewDeleted()?e.getRootDeletedItem():p()(b()(n.prototype),"getRootItem",this).call(this)}},{key:"handleRightSideTap",value:function(e){this.isViewArchived()?(e.unArchive(l.a.ChangeType.Local),k.a.reset()):this.isViewDeleted()?(e.unDelete(l.a.ChangeType.Local),k.a.reset()):p()(b()(n.prototype),"handleRightSideTap",this).call(this,e)}},{key:"getNewViewMode",value:function(){return this.isViewCalendar()?"Calendar":this.isViewArchived()?"Archived":this.isViewDeleted()?"Deleted":this.search.showHierarchy()?"Outline":"List"}},{key:"getNewViewGroup",value:function(){if(!this.isViewCalendar()){var e=this.getViewMode(),t=("Groups_Project"===e?"Project":"Groups_Tag"===e&&"Tag")||"Groups_Contact"===e&&"Contact"||"Groups_Priority"===e&&"Priority"||this.isViewAgenda()&&"Agenda"||"None";if("Agenda"===t){var n=this.getSortModeBlocks();"Created"===n?t="Created":"Modified"===n?t="Modified":"Completed"===n?t="Completed":this.search.showOnlyAgendaDates()&&(t="Date")}return t}}},{key:"setGroupMode",value:function(e){var t="Created"===e||"Modified"===e||"Completed"===e,n=("None"===e?"Outline":"Project"===e&&"Groups_Project")||"Tag"===e&&"Groups_Tag"||"Contact"===e&&"Groups_Contact"||"Priority"===e&&"Groups_Priority"||("Agenda"===e||"Date"===e||t)&&"Agenda_All",r=t?e:"None";M.a.beginBatch(),this.setViewMode(n),"Date"===e!==this.search.showOnlyAgendaDates()&&this.search.setFilter("showOnlyAgendaDates","Date"===e),this.setSortModeBlocks(r,1),M.a.endBatch()}},{key:"setSortBlocks",value:function(e){var t=this.getSortOrderBlocks();this.getSortModeBlocks()===e&&(t=-this.getSortOrderBlocks()),this.setSortModeBlocks(e,t)}},{key:"setSortItems",value:function(e){var t=this.getSortOrderItems();this.getSortModeItems()===e&&t>0&&(t=-this.getSortOrderItems()),this.setSortModeItems(e,t)}},{key:"getSortModeBlocksText",value:function(){return l.a.TaskSortModeText[this.getSortModeBlocks()]}},{key:"getSortModeItemsText",value:function(){return l.a.TaskSortModeText[this.getSortModeItems()]}},{key:"scrollToMiddle",value:function(e){var t=this.indexOfItem(e);if(t<0&&e.isDescendantOf(this.item.get())&&this.search.isMatched(e)){var n=0;c.default.PaneUpdateBatcher.beginUpdateItems();for(var r=e.parent();r&&r!==this.item.get();){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r.isCollapsed(this)&&(this.setIgnoreRestoreScroll(),r.setCollapsed(!1,this)),r=r.parent()}c.default.PaneUpdateBatcher.commitUpdateItems(),t=this.indexOfItem(e)}t>=0&&this.scrollIndexToMiddle(t,"smooth")}},{key:"updateCollapsedObs",value:function(e){this.isViewAutoBlocks()&&(e=this.calculateHasCollapsed()),e=e||this.blocksCollapsed["__block_nokey_"+this.getViewMode()],p()(b()(n.prototype),"updateCollapsedObs",this).call(this,e)}},{key:"canCollapse",value:function(){return!(this.isViewFlatList()&&"None"===this.getNewViewGroup())}},{key:"updateItemsImmediate",value:function(e,t,r,i){if(this.document.get()&&!this.document.get().isDeleted.get())return p()(b()(n.prototype),"updateItemsImmediate",this).call(this,e,t,r,i)}},{key:"updateHeadersOverride",value:function(){var e=this,t=[];return E.a.getDocumentsArray().forEach((function(n){var r=n.getRootItem();if(t.push(r),!r.isCollapsed(e,!0)){var i={item:n.getRootItem(),noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:e,each:function(e){e.isComplete()||t.push(e)}};u.default.searchVMLIs(i)}})),t}},{key:"zoomIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.getDocumentOwner()?p()(b()(n.prototype),"zoomIn",this).call(this,e,t):c.default.toasts.pushMessage("Cannot zoom into calendar events.")}},{key:"canZoomToItem",value:function(e){return e.getDocumentOwner()?p()(b()(n.prototype),"canZoomToItem",this).call(this,e):(c.default.toasts.pushMessage("Cannot zoom into calendar events."),!1)}},{key:"getMobileIcon",value:function(){return this.isViewCalendar()?"IoIosCalendar":this.isViewArchived()?"MdArchive":this.isViewDeleted()?"IoMdTrash":this.isViewAgenda()?"MdToday":this.search.showHierarchy()?"MdFormatListBulleted":"MdReorder"}}],[{key:"viewModeSupportsSortBlocks",value:function(e){return!!N[e]}},{key:"viewModeSupportsSortBlocksMode",value:function(e,t){return N[t]&&N[t].Available.indexOf(e)>=0}},{key:"viewModeSupportsSortItems",value:function(e){return"Groups_Project"===e||"Groups_Tag"===e||"Groups_Contact"===e||"Groups_Priority"===e}}]),n}(O.a),U=n(32),B=function(){function e(){a()(this,e),this._inactivePaneTypes={},this.activePaneTypes=new U.a,this._registeredTypes={},this.numInactivePanes=new I.a(0),this.registerPaneType(void 0,l.a.PaneMode.Task,"Task",j,"icon-align-left",99)}return s()(e,[{key:"paneSortCompare",value:function(e,t){return e.priority<t.priority?1:-1}},{key:"registerPaneType",value:function(e,t,n,r,i,a){this._registeredTypes[t]={plugin:e,constructor:r};var o={type:t,name:n,icon:i,text:n,priority:a,tooltip:"Add "+n+" Pane"};!e||e.isActive()?this.activePaneTypes.insertSorted(o,this.paneSortCompare):(this._inactivePaneTypes[t]=o,this.numInactivePanes.set(this.numInactivePanes.get()+1))}},{key:"activatePaneType",value:function(e){var t=this._inactivePaneTypes[e];try{u.default.PAssert(1075,t,"Must have previously registered pane type")}catch(n){u.default.reportError(n)}this._inactivePaneTypes[e]=void 0,this.activePaneTypes.insertSorted(t,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)}},{key:"deactivatePaneType",value:function(e){var t=this.activePaneTypes.get().find((function(t){return t.type===e}));this.activePaneTypes.remove((function(t){return t.type===e}));try{u.default.PAssert(1076,t,"Must have previously activated pane type")}catch(n){u.default.reportError(n)}c.default.PaneManager.removePanesByType(e),this._inactivePaneTypes[e]=t,this.numInactivePanes.set(this.numInactivePanes.get()+1)}},{key:"canCreatePane",value:function(e){var t=this._registeredTypes[e],n=t.plugin;return n&&!t.plugin.isActive()?"the ".concat(n.name," plugin is not active."):!n||!t.plugin.isPluginBlocked()||"the ".concat(n.name," pane is a premium feature.")}},{key:"createPane",value:function(e,t){(t=t||{}).id||(t.id=c.default.PaneManager.getNextPaneID()),"PaneTimeline"===e?(e=l.a.PaneMode.Task,t.viewState={viewMode:"Agenda_All"}):"PaneOutline"===e?(e=l.a.PaneMode.Task,t.viewState={viewMode:"Outline"}):"PaneArchived"===e&&(e="PaneTask",t.viewState={viewMode:"Archived"});var n=this._registeredTypes[e];if(n){if(!n.plugin||n.plugin.isActive()&&!n.plugin.isPluginBlocked())try{c.default.PaneUpdateBatcher.beginUpdateItems();var r=n.constructor.getPluginID();if(r)c.default.pluginManager.getPlugin(r).onPaneActivated();var i=new n.constructor(t);return c.default.PaneUpdateBatcher.commitUpdateItems(),i}catch(a){return void u.default.reportError(a)}}else try{u.default.PAssert(1077,!1,"Invalid pane type requested")}catch(o){u.default.reportError(o)}}},{key:"isPaneTypeActive",value:function(e){var t=!!this._registeredTypes[e],n=!!this._inactivePaneTypes[e];return t&&!n}},{key:"getRegisteredPanes",value:function(){return this.activePaneTypes.get()}},{key:"_getTaskView",value:function(e,t,n,r){for(var i=0,a=[],o=0;o<n.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n[o],u=l.a.TaskViewModeText[s];"Calendar_Custom"===s&&(u=u.replace("#",c.default.settings.calendarCustomDays.get())),a.push({text:u,type:l.a.PaneMode.Task,viewMode:s,icon:l.a.TaskViewModeIcon[s],premium:!!l.a.TaskViewModesPremium[s],canZoom:!0})}e.push({text:t,viewModes:a,border:!r})}},{key:"getAvailablePanes",value:function(e){var t=this.activePaneTypes.get(),n=this.numInactivePanes.get(),r=[];if(this._getTaskView(r,"List",["Outline","List_Flat","Archived","Deleted"]),this._getTaskView(r,"Grouped by",["Groups_Project","Groups_Tag","Groups_Contact","Groups_Priority"]),this._getTaskView(r,"Agenda",["Agenda_Today","Agenda_Week","Agenda_Month","Agenda_All"]),this._getTaskView(r,"Calendar",["Calendar_Day","Calendar_Custom","Calendar_Week","Calendar_Month"],e),!e){for(var i=0,a=0;a<t.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=t[a];if(o.type!==l.a.PaneMode.Task){var s=o.type===l.a.PaneMode.Gmail;r.push({text:o.text,type:o.type,icon:o.icon,canZoom:s,border:!0})}}r[r.length-1].border=!1,n>0&&r.push({enableMore:!0})}return r}}]),e}();t.a=new B},function(e,t,n){"use strict";n.r(t);var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(0),u=n(12),l=function(){function e(t){i()(this,e),this._range=t,this._range||(this._range=n(56).default.getSelectionRangeNative())}return o()(e,[{key:"isValid",value:function(){return!!this._range}},{key:"getNativeRange",value:function(){return this._range}},{key:"getStartContainer",value:function(){return this._range.startContainer}},{key:"getEndContainer",value:function(){return this._range.endContainer}},{key:"getStartElement",value:function(){return s.default.getElementParent(this.getStartContainer())}},{key:"getEndElement",value:function(){return s.default.getElementParent(this.getEndContainer())}},{key:"getSelectOffsetsInElement",value:function(e){return n(56).default.getSelectOffsetsInElement(e,this._range)}},{key:"getStartOffset",value:function(){return this._range.startOffset}},{key:"getEndOffset",value:function(){return this._range.endOffset}},{key:"getBoundingClientRect",value:function(){return this._range.getBoundingClientRect()}}]),e}(),c=n(1),d=function(){function e(){i()(this,e)}return o()(e,[{key:"createFakeRange",value:function(e,t,n,r){try{var i=this.createSelectionRange();return i.setStart(e,t),i.setEnd(n,r),new l(i)}catch(a){s.default.reportError(a)}}},{key:"createSelectionRange",value:function(){return document.createRange()}},{key:"setSelection",value:function(e,t,n,r){if("TEXTAREA"===e.nodeName){try{s.default.PAssert(547,e===n,"Cannot multiselect textareas")}catch(a){s.default.reportError(a)}e.focus(),e.selectionStart=t,e.selectionEnd=r}else{var i=this.createSelectionRange();this.setSelectionValues(i,e,t,n,r),this.setSelectionRange(i)}}},{key:"setSelectionRange",value:function(e){var t=window.getSelection();s.default.shouldLog(c.a.LogLevels.Selection)&&s.default.log("Set Selection to Range",e),t.removeAllRanges(),e instanceof l&&(e=e.getNativeRange()),t.addRange(e)}},{key:"insertNode",value:function(e){var t=this.getSelectionRangeNative();t&&t.insertNode(e)}},{key:"selectAfterNode",value:function(e){var t=document.createRange();t.setStartAfter(e),this.setSelectionRange(t)}},{key:"setSelectionRangeToWhatItAlreadyIs",value:function(){var e=this.getSelectionRangeNative();s.default.shouldLog(c.a.LogLevels.Selection)&&s.default.log("Set Selection to Same",e),e&&this.setSelectionRange(e)}},{key:"hasValidSelection",value:function(){return this.getSelectionRange(!0).isValid()}},{key:"getSelectionRange",value:function(e){var t;return e&&(t=this.getSelectionRangeNative()),new l(t)}},{key:"getSelectionRangeNative",value:function(){var e,t=window.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e}},{key:"getSelectionNode",value:function(){var e=window.getSelection().anchorNode;if(e)return e.nodeType===Node.TEXT_NODE?e.parentNode:e}},{key:"getSelectedText",value:function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!==document.selection.type?document.selection.createRange().text:void 0}},{key:"clearSelection",value:function(){var e=window.getSelection();s.default.shouldLog(c.a.LogLevels.Selection)&&s.default.log("Clear Selection"),e.removeAllRanges()}},{key:"getCursorSelectionRange",value:function(e){var t,n=e.target,r=s.default.ensureDOMNode(e.target);if(r){var i=s.default.getElementParent(n),a=0,o=s.default.getPaneObjectForElement(n);try{s.default.PAssert(548,i,"getCursorSelectionRange must only be called when hovered item is item",r)}catch(h){s.default.reportError(h)}o&&(r=s.default.findChild(i,"itemInPaneText"),a=0);var u=r.getBoundingClientRect(),c=s.default.clamp(e.clientY,u.top+9,u.bottom-9),d=s.default.clamp(e.clientX,u.left+a,u.right-1);t=this._getCursorSelectionRange(d,c)}return t?new l(t):void 0}},{key:"_safari_caretRangeFromPoint",value:function(e,t,n){var r=0;var i=function(n){var r=n.getClientRects()[0];return r&&t>=r.top&&t<=r.bottom?Math.abs(e-(r.left+r.width/2)):1e5},a=function e(t,n,r){var i=0,a=[];for(t=t.firstChild;t;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;3==t.nodeType&&a.push(t),1==t.nodeType&&(a=a.concat(e(t,n,r))),t=t.nextSibling}return a}(document.elementFromPoint(e,t),e,t);if(!a.length)return null;var o=a[0],s=document.createRange();s.setStart(o,0),s.setEnd(o,1);for(var u={range:void 0,distance:1e5},l=0;l<a.length;l++){var c=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var d=(o=a[l]).nodeValue,h=0;h<=d.length;h++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;(s=document.createRange()).setStart(o,h),s.setEnd(o,h);var f=i(s);f<u.distance&&(u={range:s,distance:f})}}return u.range}},{key:"_getCursorSelectionRange",value:function(e,t){var n;if(u.a.safari)n=this._safari_caretRangeFromPoint(e,t);else if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(e,t);else if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(e,t);r&&((n=document.createRange()).setStart(r.offsetNode,r.offset),n.setEnd(r.offsetNode,r.offset))}else if(document.body.createTextRange){var i=this.getSelectionRangeNative(),a=document.body.createTextRange();try{a.moveToPoint(e,t),a.select(),n=this.getSelectionRangeNative(),this.setSelectionRange(i)}catch(o){}}else try{s.default.PAssert(549,!1,"Unable to get selection range at cursor")}catch(l){s.default.reportError(l)}return n}},{key:"_getPreviousComponentNode",value:function(e){var t=e.previousSibling;return t&&!this._isComponentNode(t)&&1===t.childNodes.length&&this._isComponentNode(t.childNodes[0])&&(t=t.childNodes[0]),t}},{key:"_ensureSelectionInElement",value:function(e,t){try{s.default.PAssert(550,e,"Must have a valid element")}catch(i){s.default.reportError(i)}try{s.default.PAssert(551,t,"Must have a valid range")}catch(i){s.default.reportError(i)}if(s.default.isAncestor(t.startContainer,e)||t.setStart(e,0),s.default.isAncestor(t.endContainer,e)||t.setEnd(e,0),s.default.findParent(t.startContainer,"itemIgnoreText",2)){var n=this._getPreviousComponentNode(t.startContainer);n&&t.setStart(n,n.textContent.length)}if(s.default.findParent(t.endContainer,"itemIgnoreText",2)){var r=this._getPreviousComponentNode(t.endContainer);r&&t.setEnd(r,r.textContent.length)}}},{key:"getSelectOffsetsInElement",value:function(e,t){var n={start:0,end:0,total:0};if("TEXTAREA"===e.nodeName){n.start=e.selectionStart,n.end=e.selectionEnd,n.total=e.value.length;var r=e.value.indexOf("\n");r>=0&&n.start>r&&(n.start--,n.end--,n.total--)}else if(e){try{s.default.PAssert(552,t,"Must provide a valid range")}catch(v){s.default.reportError(v)}if(t){this._ensureSelectionInElement(e,t);var i=this._getComponentNodeInfo(t.startContainer,t.startOffset),a=i.node,o=i.offset,u=this._getComponentNodeInfo(t.endContainer,t.endOffset),l=u.node,d=u.offset;!a||a.textContent!==c.a.TextSpace&&0!==a.textContent.length||(o=0),!l||l.textContent!==c.a.TextSpace&&0!==l.textContent.length||(d=0);var h=0,f=this._getComponentNodesIn(e);if(f.length>0)for(var p=0,g=0;g<f.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;f[g]===a&&(n.start=h+o),f[g]===l&&(n.end=h+d),h+=this._getComponentNodeLength(f[g]),void 0===l&&(g===d-1?n.end=h:0===g&&0===d&&(n.end=0)),void 0===a&&(g===o-1?n.start=h:0===g&&0===o&&(n.start=0))}else n.start=0,n.end=0;n.total=h,isNaN(n.end)&&(n.end=h),n.start>n.total&&(n.start=n.total),n.end>n.total&&(n.end=n.total)}}try{s.default.PAssert(553,!isNaN(n.start)&&!isNaN(n.end),"Must have valid start and end",n)}catch(v){s.default.reportError(v)}return n}},{key:"getSelectOffsetsForMouseEvent",value:function(e){var t=s.default.getElementParent(e.target),n=this.getCursorSelectionRange(e);return n&&n.getSelectOffsetsInElement(t)}},{key:"getOffsetChildElement",value:function(e,t){try{s.default.PAssert(554,e,"Must supply a valid element")}catch(u){s.default.reportError(u)}if("TEXTAREA"===e.nodeName)return{element:e,offset:t};if(this._isComponentNode(e)){try{s.default.PAssert(556,this._isComponentSelectable(e),"Component must be selectable")}catch(u){s.default.reportError(u)}return{element:e,offset:t}}for(var n=0,r=0,i=this._getComponentNodesIn(e),a=0;a<i.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this._getComponentNodeLength(i[a]);if(r+o>=t)return{element:i[a],offset:t-r};r+=o}try{s.default.PAssert(555,0===t,"Unable to find offset child element")}catch(u){s.default.reportError(u)}return{element:e,offset:t}}},{key:"getChildNodeOffset",value:function(e,t){var n=0;try{s.default.PAssert(557,e,"Must supply a valid child element")}catch(u){s.default.reportError(u)}for(var r=0,i=this._getComponentNodesIn(s.default.getElementParent(e),t),a=this._getComponentNodesIn(e,t),o=0;o<i.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i[o]===a[0])break;r+=this._getComponentNodeLength(i[o])}return r}},{key:"_getComponentNodeLength",value:function(e){try{s.default.PAssert(558,this._isComponentNode(e),"Supplied node must be a valid component")}catch(t){s.default.reportError(t)}return s.default.hasClass(e,"mdImageWrapper")||1===e.length&&e.textContent===c.a.TextSpace?0:e.textContent.replace(c.a.TextSpace,"").length}},{key:"_getComponentNodesIn",value:function(e,t){if(this._isComponentNode(e,t))return[e];var n=[];return this._getComponentNodes(n,e,t),n}},{key:"_isComponentNode",value:function(e,t){var n=!1;return!e||s.default.findParent(e,"itemIgnoreText",2)||t&&s.default.findParent(e,"prefixNew",2)||(e.nodeType===Node.TEXT_NODE||s.default.hasClass(e,"mdImageWrapper"))&&(n=!0),n}},{key:"_isComponentSelectable",value:function(e){try{s.default.PAssert(559,!e||this._isComponentNode(e),"Must either be an invalid node (not-selectable) or a component")}catch(n){s.default.reportError(n)}var t=!1;return e&&e.nodeType===Node.TEXT_NODE&&(t=!0),t}},{key:"_getComponentNodes",value:function(e,t,n){if(t)if(this._isComponentNode(t,n))e.push(t);else if(!s.default.hasClass(t,"itemTime")&&t.childNodes)for(var r=0,i=0;i<t.childNodes.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=t.childNodes[i];this._getComponentNodes(e,a,n)}}},{key:"_getComponentNodeInfo",value:function(e,t){if(this._isComponentNode(e))return{node:e,offset:t};var n,r=e.firstChild;return r&&(r.nodeType===Node.TEXT_NODE&&1===t&&(t=r.textContent.length),n=this._getComponentNodeInfo(r,t)),n||{node:e,offset:t}}},{key:"setSelectionValues",value:function(e,t,n,r,i){try{s.default.PAssert(560,e,"Range must be supplied")}catch(a){s.default.reportError(a)}try{s.default.PAssert(561,this._isComponentNode(t),"Must be selecting a valid component")}catch(a){s.default.reportError(a)}try{s.default.PAssert(562,this._isComponentNode(r),"Must be selecting a valid component")}catch(a){s.default.reportError(a)}try{s.default.PAssert(563,t!==r||n<=i,"Select elements must be different, or selection must start before it ends")}catch(a){s.default.reportError(a)}if(t.nodeType===Node.TEXT_NODE)e.setStart(t,n);else{try{s.default.PAssert(564,s.default.hasClass(t,"plugin"),"Only other valid component is plugin")}catch(a){s.default.reportError(a)}try{s.default.PAssert(565,0===n||1===n,"Must eiter be selecting before or after the plugin")}catch(a){s.default.reportError(a)}0===n?this._selectBeforeComponent(e,t,"setStart"):1===n&&this._selectAfterComponent(e,t,"setStart")}if(r.nodeType===Node.TEXT_NODE)e.setEnd(r,i);else{try{s.default.PAssert(566,s.default.hasClass(r,"plugin"),"Only other valid component is plugin")}catch(a){s.default.reportError(a)}try{s.default.PAssert(567,0===i||1===i,"Must eiter be selecting before or after the plugin")}catch(a){s.default.reportError(a)}0===i?this._selectBeforeComponent(e,r,"setEnd"):1===i&&this._selectAfterComponent(e,r,"setEnd")}s.default.shouldLog(c.a.LogLevels.Selection)&&s.default.log("Set Selection: ["+n+","+i+"] - [",t+","+r+"]")}},{key:"_selectBeforeComponent",value:function(e,t,n){var r=this._getPrevComponent(t);if(this._isComponentSelectable(r))e[n](r,this._getComponentNodeLength(r));else{var i=document.createTextNode("");t.parentNode.insertBefore(i,t),e[n](i,0)}}},{key:"_selectAfterComponent",value:function(e,t,n){var r=this._getNextComponent(t);if(this._isComponentSelectable(r))e[n](r,0);else{var i=document.createTextNode("");t.parentNode.insertBefore(i,void 0),e[n](i,0)}}},{key:"_getPrevComponent",value:function(e){try{s.default.PAssert(568,e,"Must supply a valid node")}catch(n){s.default.reportError(n)}try{s.default.PAssert(569,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(n){s.default.reportError(n)}var t=e.previousSibling;try{s.default.PAssert(570,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(n){s.default.reportError(n)}return t}},{key:"_getNextComponent",value:function(e){try{s.default.PAssert(571,e,"Must supply a valid node")}catch(n){s.default.reportError(n)}try{s.default.PAssert(572,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(n){s.default.reportError(n)}var t=e.nextSibling;try{s.default.PAssert(573,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(n){s.default.reportError(n)}return t}},{key:"createRange",value:function(e,t,n){var r;if(isNaN(n)&&(n=t),isNaN(t))(r=this.createSelectionRange()).selectNodeContents(e);else{var i=this.getOffsetChildElement(e,t),a=t!==n?this.getOffsetChildElement(e,n):i;i&&(r=this.createFakeRange(i.element,i.offset,a.element,a.offset)._range)}return r}},{key:"selectElement",value:function(e,t,n){var r=this.createRange(e,t,n);return r&&this.setSelectionRange(r),r}},{key:"getSelectionInElement",value:function(e){var t=this.getSelectionRangeNative();if(t&&s.default.isAncestor(t.startContainer,e)&&s.default.isAncestor(t.endContainer,e))return this.getSelectOffsetsInElement(e,t)}},{key:"deleteRangeContents",value:function(){var e=this.getSelectionRangeNative();e&&e.deleteContents()}}]),e}();t.default=new d},function(e,t,n){t.Refiner=function(){this.refine=function(e,t,n){return t}},t.Filter=function(){t.Refiner.call(this),this.isValid=function(e,t,n){return!0},this.refine=function(e,t,n){for(var r=[],i=0;i<t.length;i++){var a=t[i];this.isValid(e,a,n)&&r.push(a)}return r}},t.OverlapRemovalRefiner=n(192).Refiner,t.ExtractTimezoneOffsetRefiner=n(193).Refiner,t.ExtractTimezoneAbbrRefiner=n(194).Refiner,t.ForwardDateRefiner=n(195).Refiner,t.UnlikelyFormatFilter=n(196).Refiner,t.ENMergeDateTimeRefiner=n(91).Refiner,t.ENMergeDateRangeRefiner=n(98).Refiner,t.ENPrioritizeSpecificDateRefiner=n(197).Refiner,t.JPMergeDateRangeRefiner=n(198).Refiner,t.FRMergeDateRangeRefiner=n(199).Refiner,t.FRMergeDateTimeRefiner=n(200).Refiner,t.DEMergeDateRangeRefiner=n(201).Refiner,t.DEMergeDateTimeRefiner=n(202).Refiner},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(17),u=n.n(s),l=n(18),c=n.n(l),d=n(19),h=n.n(d),f=n(11),p=n.n(f),g=n(0);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var m=function(e){c()(n,e);var t=v(n);function n(e,r){var a;return i()(this,n),(a=t.call(this,e||{},r)).version=0,a}return o()(n,[{key:"getProperty",value:function(e){return this._value[e]}},{key:"setProperty",value:function(e,t,n){if(g.default.isString(this._value)){try{g.default.PAssert(951,!1,"ObservableObject is string",e)}catch(i){g.default.reportError(i)}this._value={}}var r=!1;this._value[e]!==t&&(this._value[e]=t,this.version++,r=!0),(n||!1!==n&&r)&&this.notify(this._value)}},{key:"deleteProperty",value:function(e,t){delete this._value[e],this.version++,!1!==t&&this.notify(this._value)}},{key:"hasValue",value:function(){return Object.keys(this._value).length>0}},{key:"set",value:function(e,t){return void 0!==e&&null!==e||(e={}),u()(p()(n.prototype),"set",this).call(this,e,t)}},{key:"clear",value:function(e){return this.set({},e)}},{key:"isEmpty",value:function(){return 0===Object.keys(this._value).length}}]),n}(n(13).a);t.a=m},function(e,t,n){var r=n(126),i=n(127),a=n(108),o=n(128);e.exports=function(e){return r(e)||i(e)||a(e)||o()}},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(0),u=function(){function e(){i()(this,e)}return o()(e,[{key:"_ensureListeners",value:function(){return this._listeners||(this._listeners={}),this._listeners}},{key:"clearListeners",value:function(){this._listeners=void 0}},{key:"listen",value:function(){for(var e=0,t=0,n=0,r=this._ensureListeners(),i=arguments.length,a=new Array(i),o=0;o<i;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[o]=arguments[o]}for(var u=0;u<a.length-1;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.default.PAssert(471,"callbacks"!==a[u],"Invalid event name/grouping")}catch(c){s.default.reportError(c)}try{s.default.PAssert(472,s.default.isString(a[u])||s.default.isFunction(a[u]),"Only accept string or functions for listen")}catch(c){s.default.reportError(c)}r[a[u]]||(r[a[u]]={callbacks:[]}),r=r[a[u]]}var l=a[a.length-1];try{s.default.PAssert(473,s.default.isFunction(l),"Listeners must always be valid functions")}catch(c){s.default.reportError(c)}try{s.default.PAssert(474,r.callbacks.indexOf(l)<0,"Should never listen with the same function twice")}catch(c){s.default.reportError(c)}r.callbacks.push(l)}},{key:"isListening",value:function(){for(var e=0,t=0,n=0,r=this._ensureListeners(),i=arguments.length,a=new Array(i),o=0;o<i;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[o]=arguments[o]}var u=a[a.length-1];try{s.default.PAssert(475,s.default.isFunction(u),"Listeners must always be valid functions")}catch(c){s.default.reportError(c)}for(var l=0;l<a.length-1;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[a[l]]&&(r=r[a[l]])}return r&&r.callbacks&&r.callbacks.indexOf(u)>=0}},{key:"unlisten",value:function(){for(var e=0,t=0,n=0,r=this._ensureListeners(),i=arguments.length,a=new Array(i),o=0;o<i;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[o]=arguments[o]}var u=a[a.length-1];try{s.default.PAssert(476,s.default.isFunction(u),"Listeners must always be valid functions")}catch(c){s.default.reportError(c)}for(var l=0;l<a.length-1;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.default.PAssert(477,"callbacks"!==a[l],"Invalid event name/grouping")}catch(c){s.default.reportError(c)}try{s.default.PAssert(478,s.default.isString(a[l]),"Only accept string for unlisten")}catch(c){s.default.reportError(c)}try{s.default.PAssert(479,r[a[l]],"Cannot unlisten something that has never been listened")}catch(c){s.default.reportError(c)}r[a[l]]&&(r=r[a[l]])}try{s.default.PAssert(480,r&&r.callbacks&&r.callbacks.indexOf(u)>=0,"Cannot unlisten something that has never been listened")}catch(c){s.default.reportError(c)}r.callbacks&&r.callbacks.remove(u)}},{key:"fireEvent",value:function(){for(var e=0,t=0,n=0,r=!0,i=this._ensureListeners(),a=arguments.length,o=new Array(a),u=0;u<a;u++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;o[u]=arguments[u]}var l=o[o.length-1];try{s.default.PAssert(481,void 0===l||s.default.isArray(l),"Last argument to fireEvent must be an array")}catch(f){s.default.reportError(f)}for(var c=0;c<o.length-1;++c){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.default.PAssert(482,"callbacks"!==o[c],"Invalid event name/grouping")}catch(f){s.default.reportError(f)}try{s.default.PAssert(483,s.default.isString(o[c])||s.default.isArray(o[c]),"Only accept strings for firing event")}catch(f){s.default.reportError(f)}if(!i[o[c]])break;var d=0;i=i[o[c]];for(var h=0;h<i.callbacks.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;try{r=i.callbacks[h].apply(this,l)&&r}catch(p){s.default.reportError(p)}}}return r}}]),e}();t.a=u},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return s}));var r=n(29),i=n(9),a=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e}(),o="[DEFAULT]",s=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return e.prototype.get=function(e){void 0===e&&(e=o);var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new i.a;this.instancesDeferred.set(t,n);try{var r=this.getOrInitializeService(t);r&&n.resolve(r)}catch(a){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t=Object(r.a)({identifier:o,optional:!1},e),n=t.identifier,i=t.optional,a=this.normalizeInstanceIdentifier(n);try{var s=this.getOrInitializeService(a);if(!s){if(i)return null;throw Error("Service "+this.name+" is not available")}return s}catch(u){if(i)return null;throw u}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService(o)}catch(h){}try{for(var i=Object(r.h)(this.instancesDeferred.entries()),a=i.next();!a.done;a=i.next()){var s=Object(r.e)(a.value,2),u=s[0],l=s[1],c=this.normalizeInstanceIdentifier(u);try{var d=this.getOrInitializeService(c);l.resolve(d)}catch(h){}}}catch(f){t={error:f}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.clearInstance=function(e){void 0===e&&(e=o),this.instancesDeferred.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return Object(r.b)(this,void 0,void 0,(function(){var e;return Object(r.d)(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(Object(r.f)(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})),e.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()}))))];case 1:return t.sent(),[2]}}))}))},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.getOrInitializeService=function(e){var t=this.instances.get(e);return!t&&this.component&&(t=this.component.instanceFactory(this.container,function(e){return e===o?void 0:e}(e)),this.instances.set(e,t)),t||null},e.prototype.normalizeInstanceIdentifier=function(e){return this.component?this.component.multipleInstances?e:o:e},e}();var u=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new s(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}()},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.SingleFile=1]="SingleFile",e[e.FolderStruct=2]="FolderStruct",e[e.SubFolder=3]="SubFolder",e[e.Search=4]="Search",e[e.DataPage=5]="DataPage",e[e.ChangeList=6]="ChangeList",e[e.SingleFolder=7]="SingleFolder"}(r||(r={}))},function(e,t,n){var r=n(203);e.exports=function(e,t){if(null==e)return{};var n,i,a=r(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}},function(e,t,n){"use strict";var r=n(3),i=n.n(r),a=n(10),o=n.n(a),s=n(33),u=n.n(s),l=n(5),c=n.n(l),d=n(6),h=n.n(d),f=n(7),p=n.n(f),g=n(0),v=n(1),m=n(2),y=n(8),_=n(20),b=n(25),w=n(41),k=n.n(w),S=n(18),E=n.n(S),P=n(19),I=n.n(P),D=n(11),T=n.n(D),x=n(16),C=n(22),A=n(13),L=n(32),O=n(46),M=n(58),R=n(55),F=function e(t){c()(this,e),this.id=t},N=function(){function e(t,n){c()(this,e);var r,i=t.isRead,a=t.data,o=t.isComplete,s=a.subject,u=a.date,l=a.snippet,d=a.accountID,h=a.service,f=a.contacts,p=a.numMessages,v=a.labels,m=a.hasAttachment;if(this.plugin=n,this.pluginData=t,this.id=t.id,this.text=this.subject=s,this.accountID=d,this.service=h,this.subjectLower=s.toLowerCase(),this.isRead=new A.a(i),this.numMessages=new A.a(p),n.isOldEmail(a)&&a.messages){var y=a.messages,_=(y=y||[])[y.length-1],b=_.snippet,w=_.date;r=w,this.participants=a.participants||n.getParticipants(y),this.isComplete=o,this.snippet=null===b||void 0===b?void 0:b.replace(/[\r\n]/g,""),this.date=g.default.isNumber(w)?new Date(w):C.a.parseInternationalDate(w),this.labels=g.default.arrayUniques2(g.default.arrayFlat(y.map((function(e){return e.labelIds})).filter((function(e){return!!e}))))||[],this.numMessages.set(y.length)}else this.participants=f,this.snippet=l,this.date=g.default.isString(u)?C.a.parseInternationalDate(u):u,this.labels=v||[],this.hasAttachment=m;try{g.default.PAssert(2353,g.default.isDateValid(this.date),(function(){return function(e,t){return"Date is invalid: ".concat(e," ").concat(t)}(u,r)}))}catch(k){g.default.reportError(k)}this.isStarred=new A.a(this.labels.includes("starred"))}return h()(e,[{key:"updateFromData",value:function(e,t){this.hiddenBeforeRefresh=!1,this.text=this.subject=e.subject,this.date=C.a.parseInternationalDate(e.date),this.labels="g"!==t&&this.labels?this.updateLabels(this.labels,e.labels):e.labels,this.isRead.set(e.read),this.isStarred.set(e.labels.includes("starred"))}},{key:"updateLabels",value:function(e,t){var n=g.default.arrayUnion(e,t);return(t.includes("archive")||t.includes("deleted"))&&n.remove("inbox"),t.includes("inbox")&&n.remove("archive"),n}},{key:"setRead",value:function(e,t){if(this.isRead.get()!==e){this.isRead.set(e);var n={isRead:e};this.plugin.isItemSaved(this.id)&&g.default.isLocalChange(t)&&this.plugin.saveData(this.id,n),fe.onMetadataChanged(this,n)}}},{key:"archive",value:function(){this.plugin.sendAction(this.accountID,this.service,"archive",this.id),this.labels.remove("inbox")}},{key:"delete",value:function(){this.plugin.sendAction(this.accountID,this.service,"delete",this.id),this.labels.push("trash")}}]),e}(),j=n(59),U=n.n(j),B=n(42),V=n.n(B),H=n(17),W=n.n(H),q=n(12),z=n(65),G=n(53),K=n(26);function Y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T()(e);if(t){var i=T()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I()(this,n)}}var Q,X=function(e){E()(n,e);var t=Y(n);function n(e,r,i){var a;return c()(this,n),i=Object.assign({title:r,contextMenuMode:r,dropEffect:function(){return v.a.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,supportSel:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,searchFilters:[],supportsDocuments:!1,usesVMLIs:!1},i),(a=t.call(this,e,i)).allItemsSimple=[],a.itemsSimple=new L.a,a.titles=new A.a,a}return h()(n,[{key:"usesItemStore",value:function(){return!1}},{key:"simpleObjectAtIndex",value:function(e){return this.itemsSimple.get()[e]}},{key:"onMetadataChanged",value:function(e,t){}}]),n}(n(75).a),$=n(68);function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T()(e);if(t){var i=T()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I()(this,n)}}var Z,ee="All Accounts",te="Saved",ne=(Q=function(e){E()(n,e);var t=J(n);function n(e){var r,i;c()(this,n),(i=t.call(this,e,"Email",{maxWidthFlex:v.a.ExpandedPaneWidth,maxWidth:v.a.ExpandedPaneWidth+200,maxWidthSingle:v.a.ExpandedPaneWidth,widthBiggerInSingle:!1,supportDataRefresh:"Emails",searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",matchFnBoolean:function(e){return!e.isRead.get()}}]})).type=v.a.PaneMode.Inbox,i.paneClass="paneInbox",i.pluginNew=fe.getPluginNew("Email");var a=(null===(r=e.item)||void 0===r?void 0:r.split(":"))||[],o=k()(a,3),s=o[0],u=o[1],l=o[2];i._zoomedItem=new A.a({accountID:s||ee,label:u||"inbox",service:l||"g"},i.onZoomedItemChanged),i.zoomedItem=new $.a([i._zoomedItem],(function(e){return q.a.app?e:{accountID:te,label:"inbox"}})),i.onZoomedItemChanged(i.zoomedItem.get()),K.a.getSelectedForPaneObs(V()(i)).listen(i.onMultiselectChanged);var d=0;return window.addEventListener("focus",(function(){var e=Date.now();e-d>v.a.MSPerMinute&&(d=e,i._refreshPaneData())})),i}return h()(n,[{key:"init",value:function(){W()(T()(n.prototype),"init",this).call(this),this.updateItemsImmediate(),this.pluginNew.items.listen(this.onPluginItemsChange),this.updateLabel()}},{key:"destroy",value:function(){this.pluginNew.items.unlisten(this.onPluginItemsChange),W()(T()(n.prototype),"destroy",this).call(this)}},{key:"onPluginItemsChange",value:function(){this.updateItemsImmediate()}},{key:"updateItemsImmediate",value:function(e,t,n,r){var i=this,a=K.a.getSelectedObjects(this);this.checkChildren();var o=this.pluginNew.items.get(),s=[],u=0;o.forEach((function(e){i.isItemInView(e)&&i.search.isMatchedSimple(e.id)&&s.push({id:e.id,index:u++,item:e,pane:i,type:"item"})})),this.allItemsSimple=o,this.itemsSimple.set(s);var l=K.a.getSelectedObjects(this);if(a&&l&&!l.map((function(e){return e.id})).equals(a.map((function(e){return e.id})))){var c=a.find((function(e){return s.find((function(t){return e.id===t.id}))}));if(c){var d=s.find((function(e){return c.id===e.id}));d&&K.a.setSelectedNew([d.index],this)}else l.length>0&&m.default.EmailPreview.isOpenOnPane(this)&&this.openEmail(l[0].index)}}},{key:"isItemInView",value:function(e){var t=this.zoomedItem.get(),n=t.accountID,r=t.label,i=this.pluginNew.isItemSaved(e.id),a=e.labels.includes("trash"),o=e.labels.includes("spam");return!e.hiddenBeforeRefresh&&(n===te&&i&&!e.isComplete||(n===ee||e.accountID===n)&&(a&&"trash"===r||!a&&!o&&("all"===r||e.labels.includes(r))))}},{key:"createVMLIsToDrop",value:function(e,t){var n=this;return t.targetItem?e.items.map((function(e){return n.createVMLIFromItem(e.id,t.targetItem)})):void 0}},{key:"createVMLIFromItem",value:function(e,t){return x.a.createVMLI({text:this.pluginNew.getEmbedString(e)},{parent:t,documentOwner:t.getDocumentOwner(),changeType:v.a.ChangeType.Local})}},{key:"numItems",value:function(){return this.itemsSimple.length()}},{key:"checkChildren",value:function(){var e=this;this.pluginNew.items.get().forEach((function(t){return t&&e.search.checkItemSimple(t,[t.subjectLower].concat(U()(t.participants.map((function(e){return e.text}))),U()(t.participants.map((function(e){return e.email})))))}))}},{key:"autocompleteCopy",value:function(){var e=this,t=K.a.getFirstSelectedIndex(this);z.a.showPopup({pane:this,mode:"move",text:"Select item to move to",elementDisplay:this.listManager.getElementByIndex(t),documentSelector:!0,onSelected:function(t){var n=t.item;K.a.forEach(e,(function(t){var r=e.createVMLIFromItem(t.id,n);n.insertItem(r),e.onMoveToDocument(t)}))}})}},{key:"autocompleteCreateTask",value:function(){var e=this,t=K.a.getFirstSelectedIndex(this);m.default.menus.openItemEditor({element:this.listManager.getElementByIndex(t),pane:this,selectIndex:0,addOnSave:!0,selectDocument:!0,side:"bottom",positionOffset:{left:10},beginSave:function(){m.default.PaneUpdateBatcher.beginUpdateItems()},endSave:function(t){Date.now();K.a.forEach(e,(function(n){var r=e.createVMLIFromItem(n.id,t);t.insertItem(r),e.onMoveToDocument(n)})),m.default.PaneUpdateBatcher.commitUpdateItems()}})}},{key:"doMultiselectAction",value:function(){var e=o()(i.a.mark((function e(t){var n,r,a,o,s,u,l=this;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if("MarkRead"!==t){e.next=4;break}n=function(e){e.setRead(!0,v.a.ChangeType.Local),l.pluginNew.sendAction(e.accountID,e.service,"read",e.id)},e.next=37;break;case 4:if("MarkUnread"!==t){e.next=8;break}n=function(e){e.setRead(!1,v.a.ChangeType.Local),l.pluginNew.sendAction(e.accountID,e.service,"unread",e.id)},e.next=37;break;case 8:if("OpenInGmail"!==t){e.next=12;break}n=function(e){l.openInGmail(e)},e.next=37;break;case 12:if("CopyToItem"!==t){e.next=16;break}this.autocompleteCopy(),e.next=37;break;case 16:if("CopyToNewItem"!==t){e.next=20;break}this.autocompleteCreateTask(),e.next=37;break;case 20:if("Star"!==t){e.next=24;break}n=function(e){void 0===a&&(a=!e.isStarred.get()),e.isStarred.set(a),l.pluginNew.sendAction(e.accountID,e.service,a?"star":"unstar",e.id)},e.next=37;break;case 24:if("Archive"!==t){e.next=29;break}n=function(e){e.archive()},r=!0,e.next=37;break;case 29:if("Delete"!==t){e.next=37;break}if(s=(null===(o=this.zoomedItem.get())||void 0===o?void 0:o.accountID)===te,u=!0,!s){e.next=36;break}return e.next=35,m.default.menus.confirm("Are you sure you want to unsave this email?");case 35:u=e.sent;case 36:u&&(n=function(e){s?e.plugin.deleteItem(e.id):e.delete()},r=!0);case 37:n&&K.a.forEach(this,n),r&&this.updateItems();case 39:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onHotkey",value:function(e,t){if(K.a.hasSelection(this)){if("Up"===e||"Down"===e)K.a.onKeyDown(this,t);else if("Open"===e){var n=K.a.getSelected(this);1===n.length&&this.openEmail(n[0])}else this.doMultiselectAction(e);g.default.preventAndStop(t)}}},{key:"openInGmail",value:function(e){var t="https://mail.google.com/mail/u/".concat(e.pluginData.data.accountID,"#inbox/").concat(e.id);m.default.openUrl(t)}},{key:"openEmail",value:function(e,t){var n=this.itemsSimple.get()[e];if(n){var r=G.a.parseSinglePlugin(this.pluginNew.getEmbedString(n.id),v.a.ChangeType.ItemLoad).attachments;if(r){var i=m.default.pluginManager.getAttachment(r[0],!0);i&&(m.default.supportGmailViews()?t&&m.default.EmailPreview.isOpenOnPane(n.pane)&&m.default.EmailPreview.isOpenOnThread(i)?m.default.EmailPreview.close():(m.default.EmailPreview.open(void 0,i,this),n.item.setRead(!0,v.a.ChangeType.Local)):this.openInGmail(n.item))}}}},{key:"onMultiselectChanged",value:function(e){1===e.length?m.default.EmailPreview.isOpen()&&this.openEmail(e[0]):m.default.EmailPreview.reset()}},{key:"onDoubleClick",value:function(e){this.openEmail(e,!0)}},{key:"onMetadataChanged",value:function(e,t){var n=t.isComplete,r=t.isRead;(void 0!==n&&this.search.isFilteredOn("complete")||void 0!==r&&this.search.isFilteredOn("unread"))&&this.updateItems(!0)}},{key:"getMobileIcon",value:function(){return"MdInbox"}},{key:"getSwipeMenuItems",value:function(e){this.pluginNew.getById(e.id);return{left:[{icon:"check",text:"Complete",backgroundColor:"#0c0",onActivated:function(){}}],right:[{icon:"check",backgroundColor:"#0c0",onActivated:function(){}}]}}},{key:"getSaveInfo",value:function(){var e=W()(T()(n.prototype),"getSaveInfo",this).call(this),t=this._zoomedItem.get(),r=t.accountID,i=t.label;return e.item=r+":"+i,e}},{key:"onRemoteUpdate",value:function(e){var t;W()(T()(n.prototype),"onRemoteUpdate",this).call(this,e);var r=this.zoomedItem.get(),i=r.accountID,a=r.label,o=r.service,s=(null===(t=e.item)||void 0===t?void 0:t.split(":"))||[],u=k()(s,3),l=u[0],c=u[1],d=u[2];i===l&&a===c&&o===d||this.setAccountIDAndLabel(l,d,c,!0)}},{key:"setAccountIDAndLabel",value:function(e,t,n,r){var i={accountID:e,service:t,label:n};this._zoomedItem.set(i),this.updateLabel(),this.updateItemsImmediate(),r||this.saveState()}},{key:"updateLabel",value:function(){var e=this.zoomedItem.get(),t=e.accountID,n=e.label,r=e.service;"inbox"===n&&"g"===r||this.pluginNew.loadLabel(t,r,n)}},{key:"onEndReached",value:function(){var e=this,t=this.zoomedItem.get(),n=t.accountID,r=t.label,i=t.service;n!==te&&(n===ee?m.default.settings.emailViewAccounts.forEach((function(t){e.pluginNew.loadNextPage(t.e,t.s,r)})):this.pluginNew.loadNextPage(n,i,r))}},{key:"onZoomedItemChanged",value:function(e){var t=e.accountID,n=e.label;if(q.a.app){var r=t===ee||t===te?[t]:[t,this.pluginNew.getLabelName(n)];this.titles.set(r)}}},{key:"onMoveToDocument",value:function(e){m.default.settings.archiveEmailsOnOrganize.get()&&(e.archive(),this.updateItems())}},{key:"notifyDropFrom",value:function(e){var t=e.getAttachmentByType(v.a.PluginType.Email);if(t){var n=this.pluginNew.getById(t.id);n&&this.onMoveToDocument(n)}}},{key:"_refreshPaneData",value:function(){var e=this.zoomedItem.get(),t=e.accountID,n=e.label,r=e.service;t===ee?this.pluginNew.refreshAccounts():t!==te&&this.pluginNew.refreshAccount(t,r,n)}}]),n}(X),p()(Q.prototype,"onPluginItemsChange",[y.a],Object.getOwnPropertyDescriptor(Q.prototype,"onPluginItemsChange"),Q.prototype),p()(Q.prototype,"onMultiselectChanged",[y.a],Object.getOwnPropertyDescriptor(Q.prototype,"onMultiselectChanged"),Q.prototype),p()(Q.prototype,"onZoomedItemChanged",[y.a],Object.getOwnPropertyDescriptor(Q.prototype,"onZoomedItemChanged"),Q.prototype),p()(Q.prototype,"_refreshPaneData",[y.a],Object.getOwnPropertyDescriptor(Q.prototype,"_refreshPaneData"),Q.prototype),Q);function re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T()(e);if(t){var i=T()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I()(this,n)}}var ie,ae=["subject","accountID","snippet"],oe=["text","email"],se=["inbox","starred","all","sent","trash"],ue=["inbox","archive","sent","deleted"],le={inbox:"Inbox",starred:"Starred",all:"All Mail",sent:"Sent",trash:"Trash",archive:"Archive",deleted:"Deleted"},ce={star:"star",unstar:"unstar",archive:"archive",delete:"delete",unread:"mark_as_unread",read:"drafts",refresh:"refresh","open-page":""},de=(Z=function(e){E()(n,e);var t=re(n);function n(){var e;return c()(this,n),(e=t.call(this,"Email")).items=new L.a,e.savedItemsMap={},e.itemsHiddenViews={},e.apiPromises=[],e.pagesLoaded={},e.hiddenWebviews={},e.isFirstLoaded=new A.a,e.isLoadingMore=new A.a,e.accountsComposing=new M.a,e.accountsNeedSignin=new M.a,R.a.registerPaneType(void 0,v.a.PaneMode.Inbox,"Inbox",ne,"inbox",0),e.updateItems(),e}return h()(n,[{key:"initWithAPI",value:function(e){this.api=e,this.apiPromises.forEach((function(e){return e()}))}},{key:"awaitAPI",value:function(){var e=o()(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(this.api){e.next=2;break}return e.abrupt("return",new Promise((function(e){t.apiPromises.push(e)})));case 2:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateItems",value:function(){var e=this,t=_.a.getTableData("pluginsNew"),n=Object.keys(t).map((function(n){var r=t[n],i=e.savedItemsMap[n];if(!i)try{i=e.savedItemsMap[n]=new N(r,e)}catch(a){g.default.reportError(a)}return i})).filter((function(e){return!!e}));n.pushArray(Object.values(this.itemsHiddenViews)),n=n.sort(this.sortByDate),this.items.set(n)}},{key:"sortByDate",value:function(e,t){return!e.date||!t.date||isNaN(t.date.getTime())||isNaN(e.date.getTime())?0:t.date.compareTo(e.date)}},{key:"getById",value:function(e){return this.savedItemsMap[e]||this.itemsHiddenViews[e]}},{key:"isItemSaved",value:function(e){return!!this.savedItemsMap[e]}},{key:"getDataById",value:function(e){return _.a.getPluginNew(e)}},{key:"onUpdate",value:function(){var e=o()(i.a.mark((function e(t){var n,r,a,s,u,l,c,d,h,f,p,y,w,k,S,E,P,I,D,T,A,L,O,M,R;return i.a.wrap((function(e){for(var F=0;;){if(F++>5e3&&__infLoop&&__infLoop(F))throw new RangeError;switch(e.prev=e.next){case 0:if(e.prev=0,n=t.id,_.a.getPluginNew(n),r=t.data,a=!1,this.isOldEmail(r)?(a=!0,c=null===(s=r.messages)||void 0===s?void 0:s[r.messages.length-1],d={accountID:r.accountID,service:r.service,subject:r.subject,contacts:r.messages?this.getParticipants(r.messages):[],date:new Date(r.date||(null===c||void 0===c?void 0:c.date)),numMessages:r.numMessages||(null===(u=r.messages)||void 0===u?void 0:u.length),plaintext:r.plaintext,snippet:null===(l=r.snippet||(null===c||void 0===c?void 0:c.snippet))||void 0===l?void 0:l.trim()},r=d):r.a&&(r=b.a.emailMetaDataIn(r)),!r){e.next=36;break}if(h=g.default.cloneDeep(r),f=g.default.cloneDeep(r),p=m.default.crypto.getKeyInfo(m.default.settings.getBestUserEncryption()),y=p.key,g.default.isString(r.date)&&(r.date=C.a.parseInternationalDate(r.date)),!r.plaintext){e.next=23;break}return e.next=15,Promise.all(ae.map(function(){var e=o()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!r[t]){e.next=4;break}return e.next=3,m.default.crypto.encryptText(y,r[t],n);case 3:f[t]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:if(!f.contacts){e.next=18;break}return e.next=18,Promise.all(f.contacts.map(function(){var e=o()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var r=0,a=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,Promise.all(oe.map(function(){var e=o()(i.a.mark((function e(r){return i.a.wrap((function(e){for(var i=0,a=0,o=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!t[r]){e.next=4;break}return e.next=3,m.default.crypto.encryptText(y,t[r],n);case 3:t[r]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:delete h.plaintext,delete f.plaintext,a=!0,e.next=28;break;case 23:return e.next=25,Promise.all(ae.map(function(){var e=o()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!r[t]){e.next=4;break}return e.next=3,m.default.crypto.decryptText(y,r[t],n);case 3:h[t]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 25:if(!h.contacts){e.next=28;break}return e.next=28,Promise.all(h.contacts.map(function(){var e=o()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var r=0,a=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,Promise.all(oe.map(function(){var e=o()(i.a.mark((function e(r){return i.a.wrap((function(e){for(var i=0,a=0,o=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!t[r]){e.next=4;break}return e.next=3,m.default.crypto.decryptText(y,t[r],n);case 3:t[r]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 28:w=t.notInDoc,delete t.notInDoc,delete t.cmpData,t.data=h,_.a.savePluginNew(t),w&&(k=t.docId,S=t.parent,P=(E=r).accountID,I=E.subject,(D=x.a.getDocumentById(k))&&(T=D.getRootItem(),A={id:t.itemId,text:this.getAttachmentEmbedStringForID(n,P,I,"g"),dateCreated:t.dateCreated,dateModified:t.dateCreated,parent:S},L=x.a.createVMLI(A,{documentOwner:D,parent:T,changeType:v.a.ChangeType.Local}),T.insertItem(L,0),a=!0)),a&&(t.notInDoc=null,O=b.a.emailMetaDataOut(f)||f,M=Object.assign({},t,{data:O}),R=b.a.pluginOut(M),this.api.user.setPlugin(n,R)),this.updateItems();case 36:e.next=40;break;case 38:e.prev=38,e.t0=e.catch(0);case 40:case"end":return e.stop()}}}),e,this,[[0,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isOldEmail",value:function(e){return!(!e.id&&!e.messages)}},{key:"translateLocalData",value:function(e,t){if(this.isOldEmail(t)){t.messages.forEach((function(e){e.labelIds||(e.labelIds=[])}));var n=t.messages[0];return Object.assign({id:e||t.threadId,to:n.to,from:n.from,snippet:n.snippet,labelIds:[]},t)}var r;return Object.assign({id:e,to:t.accountID,from:null===(r=t.contacts)||void 0===r?void 0:r[0],snippet:t.snippet,labelIds:[]},t)}},{key:"getEmbedString",value:function(e){var t=this.getById(e),n=t.pluginData.data,r=n.accountID,i=n.subject,a=n.service;if(t&&r)return this.getAttachmentEmbedStringForID(e,r,i,a)}},{key:"getAttachmentEmbedStringForID",value:function(e,t,n,r){return"".concat(v.a.EmbedAttachChar,"p:").concat(v.a.PluginID.Email,",id:").concat(e,",a:").concat(t,",s:").concat(r,",t:").concat(encodeURIComponent(n)).concat(v.a.EmbedAttachChar)}},{key:"reEncrypt",value:function(){var e=o()(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return a=_.a.getAllPluginsNew(),e.next=3,Promise.all(Object.keys(a).map(function(){var e=o()(i.a.mark((function e(s){var u;return i.a.wrap((function(e){for(var l=0,c=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:return u=a[s].data,e.next=3,Promise.all(ae.map(function(){var e=o()(i.a.mark((function e(a){return i.a.wrap((function(e){for(var i=0,o=0,l=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(!u[a]||g.default.isNumber(u[a])){e.next=4;break}return e.next=3,m.default.crypto.encryptText(r.key,u[a],s);case 3:n["".concat(t).concat(s,"/a/").concat(a)]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getParticipants",value:function(e){return g.default.arrayUniques2(e.map((function(e){return e.from}))).filter((function(e){return!!e})).map((function(e){return g.default.parseEmailAddresses(e)[0]}))}},{key:"saveData",value:function(){var e=o()(i.a.mark((function e(t,n){var r,a,o;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.awaitAPI();case 2:(r=this.getDataById(t))&&(a=Object.assign({},r,n),_.a.savePluginNew(a),o=b.a.pluginOut(n),this.api.user.setPlugin(t,o));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteItem",value:function(){var e=o()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.awaitAPI();case 2:this.getDataById(t)&&(_.a.deletePluginNew(t),this.api.user.removePlugin(t),this.updateItems());case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addItemsFromViews",value:function(e,t,n){var r=this;n.forEach((function(n){var i,a=r.itemsHiddenViews[n.id]||r.savedItemsMap[n.id];a?a.updateFromData(n,t):(a=new N({id:n.id,plugin:"Email",cmpData:"",data:Object.assign(n,{accountID:e,service:t,date:C.a.parseInternationalDate(n.date),contacts:null===(i=n.contacts)||void 0===i?void 0:i.map((function(e){return{text:e.name,email:e.emailAddress}})),snippet:n.snippet,labels:n.labels}),isRead:n.read},r),r.itemsHiddenViews[n.id]=a)})),O.a.beginBatch(),this.isFirstLoaded.set(!0),this.isLoadingMore.set(!1),this.updateItems(),O.a.endBatch()}},{key:"setHiddenWebview",value:function(e,t,n){this.hiddenWebviews[t+":"+e]=n}},{key:"setResolver",value:function(e){this.resolverWebview=e}},{key:"sendAction",value:function(e,t,n,r){var i=this.hiddenWebviews[t+":"+e];if(i)if("refresh"===n){if("inbox"===r)return i.sendAction(ce[n]);this.loadLabel(e,t,r)}else{var a=r,o=this.getById(a);if(o)return i.sendAction(ce[n],a,o.subject,o.date.toString("yyyy/MM/dd"),o.date.clone().addDays(1).toString("yyyy/MM/dd"))}}},{key:"loadLabel",value:function(e,t,n,r){var i,a=this;this.isFirstLoaded.get()?(this.isLoadingMore.set(!0),null===(i=this.hiddenWebviews[t+":"+e])||void 0===i||i.openPage(n,r),g.default.timeoutOnce("email_loadNextPage",(function(){a.isLoadingMore.set(!1)}),5e3)):this.isFirstLoaded.onHasValue((function(){setTimeout((function(){a.loadLabel(e,t,n,r)}),0)}))}},{key:"loadNextPage",value:function(e,t,n){var r=this.pagesLoaded[e];r||(r=this.pagesLoaded[e]={}),r[n]=(r[n]||1)+1,this.loadLabel(e,t,n,r[n])}},{key:"resolveThreadHash",value:function(){var e=o()(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.resolverWebview.resolve(t,n));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getLabels",value:function(e){return"g"===e.s?se:ue}},{key:"getLabelName",value:function(e){return le[e]||e}},{key:"composeEmail",value:function(){var e=o()(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(1!==(n=m.default.settings.emailViewAccounts.get()).length){e.next=6;break}a=n[0],r=a.s+":"+a.e,e.next=9;break;case 6:return e.next=8,m.default.menus.openContextMenuList("Select account",g.default.element("newEmailButtonView"),n.map((function(e){return{id:e.s+":"+e.e,value:e.e}})),!1,void 0,t);case 8:r=e.sent;case 9:r&&this.accountsComposing.setProperty(r,!0);case 10:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAccounts",value:function(){var e=o()(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:m.default.settings.emailViewAccounts.forEach((function(e){return t.refreshAccount(e.e,e.s,"inbox")}));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccount",value:function(){var e=o()(i.a.mark((function e(t,n,r){var a=this;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:Object.entries(this.itemsHiddenViews).forEach((function(e){var n=k()(e,2),r=n[0],i=n[1];i.accountID===t&&"g"==i.service&&(a.itemsHiddenViews[r].hiddenBeforeRefresh=!0)})),this.sendAction(t,n,"refresh",r);case 2:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setAccountNeedsSignin",value:function(e,t){this.accountsNeedSignin.setProperty(t+":"+e,!0),m.default.toasts.pushMessage("g"===t?v.a.MessageID.GmailViewsNeedSignin:v.a.MessageID.OutlookViewsNeedSignin)}},{key:"setAccountFixed",value:function(e,t){var n;m.default.settings.addEmailViewAccount(e,t),this.accountsNeedSignin.deleteProperty(t+":"+e),null===(n=this.hiddenWebviews[t+":"+e])||void 0===n||n.reload()}},{key:"getURLForOutlookAccount",value:function(e){return"https://outlook.".concat(e.b?"office":"live",".com")}},{key:"getAccount",value:function(e,t){return m.default.settings.emailViewAccounts.find((function(n){return n.e===e&&n.s===t}))}}]),n}(F),p()(Z.prototype,"refreshAccounts",[y.a],Object.getOwnPropertyDescriptor(Z.prototype,"refreshAccounts"),Z.prototype),Z),he=(ie=function(){function e(){c()(this,e)}return h()(e,[{key:"init",value:function(){this.pluginNew_Email=new de,this.loadedRemote=new A.a}},{key:"initWithAPI",value:function(e,t){var n=this;this.pluginNew_Email.initWithAPI(e),t&&Object.keys(t).forEach((function(e){return n.onPluginsUpdate({type:"Added",value:u()({},e,t[e])})})),e.user.onPluginUpdate(this.onPluginsUpdate)}},{key:"onPluginsUpdate",value:function(e){var t=this,n=e.type,r=e.value,i=Object.keys(r)[0];if("Removed"===n)_.a.deletePluginNew(i);else{var a=r[i],o=Object.assign({id:i},b.a.pluginIn(a));this.onPluginUpdate(o)}g.default.timeoutOnce("PluginManagerNew_loadedRemote",(function(){return t.loadedRemote.set(!0)}),1e3)}},{key:"onPluginUpdate",value:function(){var e=o()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:this.getPluginNew(t.plugin).onUpdate(t);case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPluginNew",value:function(e){return this.pluginNew_Email}},{key:"getPluginDataTranslated",value:function(e){var t=this.getPluginInfo(e);if(t){var n=t.plugin,r=t.data;return n.translateLocalData(e,r)}}},{key:"getPluginData",value:function(e){return _.a.getPluginNew(e)}},{key:"getPluginInfo",value:function(e){var t=this.getPluginData(e);if(t){var n=this.getPluginNew(t.plugin);if(n)return{plugin:n,data:t.data}}}},{key:"reEncrypt",value:function(){var e=o()(i.a.mark((function e(t,n,r){return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.pluginNew_Email.reEncrypt(t,n,r));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onMetadataChanged",value:function(e,t){m.default.PaneManager.runForEachPane((function(n){return n.onMetadataChanged(e,t)}),v.a.PaneMode.Inbox)}}]),e}(),p()(ie.prototype,"onPluginsUpdate",[y.a],Object.getOwnPropertyDescriptor(ie.prototype,"onPluginsUpdate"),ie.prototype),ie),fe=t.a=new he},function(e,t,n){"use strict";var r,i,a,o=n(5),s=n.n(o),u=n(6),l=n.n(u),c=n(7),d=n.n(c),h=n(0),f=n(2),p=n(1),g=n(32),v=n(4),m=n(8),y=new(r=function(){function e(){s()(this,e)}return l()(e,[{key:"tagComparator",value:function(e,t){return e.localeCompare(t)}},{key:"tagComparatorNumber",value:function(e,t){var n=e.count,r=t.count;return n===r?e.text.localeCompare(t.text):r-n}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var n=t.max,r=t.root,i={},a=[],o=e.toLowerCase(),s={each:function(e){if(!e.isComplete()){var t=e.getTagsLower();if(t)for(var n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=t[r];if(!o||s.startsWith(o)){if(!i[s]){var u={id:s,type:"tag",text:s,count:0};i[s]=u,a.push(u)}i[s].count++}}}}};return r?s.item=r:s.itemStore=f.default.itemStoreManager.getDefaultItemStore(),h.default.searchVMLIs(s),a.sort(this.tagComparatorNumber),a.length>n&&(a=a.slice(0,n)),a}},{key:"printStats",value:function(e){var t=0;h.default.log("--- Tag stats ---",e);for(var n=this.findMatchLike("",{max:100}),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;console.log(n[r].text,n[r].count)}}},{key:"getAll",value:function(){return this.findMatchLike("",{})}},{key:"getRNList",value:function(e){var t=[];return this.findMatchLike(e,{}).forEach((function(e){t.push({text:e.text,rightText:e.count})})),t.sort(this.tagComparatorNumber),t}}]),e}(),d()(r.prototype,"tagComparatorNumber",[m.a],Object.getOwnPropertyDescriptor(r.prototype,"tagComparatorNumber"),r.prototype),d()(r.prototype,"getRNList",[m.a],Object.getOwnPropertyDescriptor(r.prototype,"getRNList"),r.prototype),r),_=n(16),b=n(73),w=new(i=function(){function e(){s()(this,e)}return l()(e,[{key:"findMatchLike",value:function(e,t){var n=t.max,r=t.root,i=t.owner,a=t.allDocs,o=[],s=0,u=b.a.getSearchArr(e).searchArr,l=function(e){var t=[];return h.default.searchVMLIs({item:e.getRootItem(),comparator:function(e){return e!==i&&!e.isComplete()&&!e.isDisplayComplete()},each:function(e){var r=!1;if(u.length>0){var i=e.getSearchText();r=b.a.checkItemTextSearchArr(e,i,u)}else r=e.isPrefixHeader();var a=e.elsNew.elements[0].props.link;if((r=r&&(!a||!a.showImage))&&(t.push({id:e.id,type:"item",text:e.getParsedText(),item:e}),s++),s>=n)return!1}}),t},c=r.getDocumentOwner();if(a){var d=function(e){var t=l(e);t.length&&(o.push({id:e.id,type:"header",text:e.text.get()}),o.pushArray(t))};d(c),_.a.getDocumentsArray().forEach((function(e){return e!==c&&d(e)}))}else o=l(c);return o}},{key:"findMatchExact",value:function(e,t){}},{key:"getRNList",value:function(e,t){var n=t.max,r=t.root,i=[];return this.findMatchLike(e,{max:n,root:r}).forEach((function(e){i.push({type:"item",text:e.text,extraInfo:e.item})})),i}}]),e}(),d()(i.prototype,"getRNList",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"getRNList"),i.prototype),i),k=new(function(){function e(){s()(this,e),this.accountID=void 0}return l()(e,[{key:"setAccountID",value:function(e){this.accountID=e}},{key:"findMatchLike",value:function(e,t){for(var n=0,r=t.max,i=f.default.pluginManager.getPluginGmail(),a=i.getLabels(this.accountID,e,r),o=[],s=0;s<a.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a[s].isSystemLabel()||o.insertSorted(a[s],i.labelSortFn)}return o.map((function(e){return{id:e.getLabelID(),type:"gmailLabel",text:e.getName()}}))}},{key:"findMatchExact",value:function(e){}},{key:"getRNList",value:function(){}}]),e}()),S=n(50),E=n(48),P=(n(23),"[["),I=(a=function(){function e(){s()(this,e),this.matches=new g.a,this._isShowing=!1,this._isTempDisabled=!1,this._showNoMatches=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[p.a.ContactPrefix,p.a.TagPrefix,p.a.PrefixItemAutocomplete,P],this._prefixMap={},this._prefixMap[p.a.ContactPrefix]=S.a,this._prefixMap[p.a.TagPrefix]=y,this._prefixMap[p.a.PrefixItemAutocomplete]=w,this._prefixMap["[["]=w,this.supportedModes=null}return l()(e,[{key:"isShowing",value:function(){return this._isShowing}},{key:"getText",value:function(){return this.text}},{key:"getProviderForPrefix",value:function(e){return this._prefixMap[e]}},{key:"_checkPrefixes",value:function(e,t){for(var n=0,r=e.startsWith("-")?1:0,i=this._prefixes,a=0;a<i.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[a];if((o!==p.a.PrefixItemAutocomplete||t)&&e.substr(r,o.length)===o)return{length:r+o.length,prefix:o}}}},{key:"_findClosestWithPrefix",value:function(e,t,n,r,i){for(var a,o=0,s=e.split(/ /),u=0,l=-1,c=-1,d=-1,f=0,g=0;g<s.length&&u<=t;++g){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var v=s[g],m=v.replace(/[*_]+$/,"");s[l]===a&&(f=0);var y=this._checkPrefixes(m,i.canAutocompleteItems);y?(l=g,d=(c=u)+v.length,f=y.length,a=y.prefix):f&&a!==p.a.TagPrefix&&(d+=v.length+1),u+=v.length+1}if(f&&t>=c&&t<=d){var _=e.substr(c+f,d-c-f);return h.default.shouldLog(p.a.LogLevels.Autocomplete)&&h.default.log("closest is",a,"--",_),{mode:n,text:e,prefix:a,searchText:_,start:c+f,end:d,paneObject:r}}}},{key:"_findClosestDelimited",value:function(e,t,n,r){var i,a=0;i="item"===n?[e]:e.split(",");for(var o=!1,s=0,u=-1,l=-1,c=0;c<i.length&&s<=t;++c){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var d=i[c];u=s+this._numStartSpaces(d),l=s+d.length-this._numEndSpaces(d),u<t&&t<=l&&d.length>0?(o=!0,h.default.shouldLog(p.a.LogLevels.Autocomplete)&&h.default.log("phrase",d,d.length),h.default.shouldLog(p.a.LogLevels.Autocomplete)&&h.default.log("start char",u,e[u]),h.default.shouldLog(p.a.LogLevels.Autocomplete)&&h.default.log("end char",l,e[l])):o=!1,s+=d.length+1}if(o||this._showNoMatches){var f=e.substr(u,l-u+1);return h.default.shouldLog(p.a.LogLevels.Autocomplete)&&h.default.log("closest is",f),{mode:n,text:e,searchText:f,start:u,end:l,paneObject:r}}}},{key:"_findClosestVMLIElement",value:function(e,t,n,r,i){for(var a,o,s,u=0,l=0,c=!1,d=t.elements,h=0;h<d.length&&!1===c;h++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var f=d[h].getStyledText(void 0);if(a=l+this._numStartSpaces(f),o=l+f.length-1-this._numEndSpaces(f),a<n&&n<=o+1&&f.length>0){c=h,s=f.trim();break}l+=f.length}if(!1!==c)return{mode:r,text:e,prefix:"",searchText:s,start:a,end:o,el:d[c],paneObject:i}}},{key:"_numStartSpaces",value:function(e){for(var t=0,n=0,r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[r])break;n++}return n}},{key:"_numEndSpaces",value:function(e){for(var t=0,n=0,r=e.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[r])break;n++}return n}},{key:"insertMatch",value:function(e){var t=this._searchInfo,n=t.start,r=t.end,i=t.paneObject,a=t.text;if(i){var o=i.item,s=n+e.length;return{text:o.elsNew.spliceText(e,n,r-n,i),offset:s}}return{text:a.substr(0,n)+(e+" ")+a.substr(r),offset:n+e.length+1}}},{key:"onSelectedFromPane",value:function(e){var t=e.owner.item;if(this._searchInfo.prefix===P){var n=v.a.getStartOffsetWithPrefix(),r=e.owner.getDisplayText(!0).prevIndexOf("[",n)-1,i=n-r,a=t.elsNew.spliceText("[[".concat(e.item.id,"]]"),r,i,e.owner);t.setText(a,p.a.ChangeType.Local);var o=t.elsNew.findElement(e.owner,(function(t){return t.props.itemLink===e.item.id}));o&&v.a.selectObject(e.owner,o.offset+o.length)}else t.setText(e.value,p.a.ChangeType.Local),v.a.selectObject(e.owner,e.offset)}},{key:"prefixForMode",value:function(e){return"contact"===e&&p.a.ContactPrefix||"tag"===e&&p.a.TagPrefix||void 0}},{key:"updateFromPane",value:function(e){var t=e.owner,n=e.index,r=e.start,i=e.element,a=e.forceShow;if(i&&!t.item.isPrefixCodeBlock()){var o=t.getDisplayText()||"";!a&&r<=1&&("#"===o||"+"===o)||this.update({mode:"all",text:o,pane:t.pane,item:t.item,offset:r,owner:t,paneObject:t,fromPane:!0,indexInPane:n,elementDisplay:i,position:void 0,onSelected:this.onSelectedFromPane})}}},{key:"update",value:function(e){var t=e.text,n=e.offset,r=e.mode,i=e.paneObject,a=e.item,o=n+(a?a.getPrefixLength():0);if(e.owner===this.owner&&e.elementInput===this.elementInput||(this._isTempDisabled=!1),e.showNoMatches&&(this._showNoMatches=!0),this.text=t,"/"===(a&&a.getParsedTextWithoutPrefix()))f.default.menus.openContextMenu({componentName:"ReactContextMenuSlashHelp",paneObject:i,element:e.elementDisplay});else if(this._isTempDisabled||!e.text&&!this._showNoMatches)this.matches.set([]),this._showNoMatches||this.hide();else{this.owner=e.owner,this.elementInput=e.elementInput;var s=null,u=null;this._searchInfo="all"===r?this._findClosestWithPrefix(t,o,r,i,e):this._findClosestDelimited(t,o,r,i);if(this._searchInfo){if(this.text=this._searchInfo.searchText,"all"===r)u=this.getProviderForPrefix(this._searchInfo.prefix);else switch(r){case"move":case"item":u=w;break;case"email":s=(u=this._prefixMap[p.a.ContactPrefix]).findEmailsLike(this._searchInfo.searchText.trim(),100);break;case"contact":u=this._prefixMap[p.a.ContactPrefix];break;case"tag":u=this._prefixMap[p.a.TagPrefix];break;case"gmailLabel":var l=f.default.pluginManager.getPluginGmail().getAccountIDFromItem(a);(u=k).setAccountID(l);break;default:try{h.default.PAssert(949,!1,"Unknown autocomplete mode: ",r)}catch(g){h.default.reportError(g)}}if(null===s){var c,d=e.pane;c=d&&d.type===p.a.PaneMode.Task?d.getRootItem():a||_.a.getDefaultDocument().getRootItem(),s=u.findMatchLike(this._searchInfo.searchText,{max:100,root:c,owner:a,allDocs:!!i})}1===s.length&&u.findMatchExact(this._searchInfo.searchText,s)&&(s=[])}this._searchInfo&&0!==s.length||!a||a.getRawText().includes(p.a.CharDate)||t[o-1]!==p.a.PrefixDate||!(o<2||" "===t[o-2]||t[o-2]===p.a.AttachChar)||t[o]&&" "!==t[o]&&t[o]!==p.a.AttachChar||f.default.menus.openDate(Object.assign({paneObject:i,item:a,textOffset:o,element:e.elementDisplay,selectAfter:!0,onClosed:function(){var t=e.owner&&e.owner.onDatePickerClosed;t&&t()}},e)),s=s||[],e.supportSearchItemAutocomplete&&"all"===r&&0===s.length&&e.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(t,e.parsedEls,o,r,i)),this.matches.set(s),!this._isShowing&&s.length>0&&!this._isTempDisabled&&!e.noShow?this.show(e):0===s.length&&(this._showNoMatches||this.hide(),this._isTempDisabled=!1)}}},{key:"clearDisabled",value:function(){this._isTempDisabled=!1}},{key:"onClosed",value:function(){this._isShowing=!1,this._owner=null,this.matches.clear()}},{key:"show",value:function(e){this._isShowing=!0,this._showNoMatches=!!e._showNoMatches,this._owner=e.owner,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,f.default.menus.openContextMenu(e)}},{key:"showPopup",value:function(e){this._isShowing=!0,this._showNoMatches=!0;var t=e;t.componentName="ReactAutocomplete",t.onClosed=this.onClosed,f.default.menus.openContextMenu(t)}},{key:"hide",value:function(){this._isShowing&&(this._isShowing=!1,f.default.menus.closeContextMenu("ReactAutocomplete")),this.matches.length&&this.matches.clear()}},{key:"getTextFromMatch",value:function(e){return e.text}},{key:"onSelectedMatch",value:function(e){var t=this.insertMatch(e.text),n={value:t.text,offset:t.offset,owner:this.owner,item:this.owner instanceof E.a?this.owner.item:void 0};this.owner.onAutocompleteSelected?this.owner.onAutocompleteSelected(n):this.onSelectedFromPane(n),this.onClosed()}}]),e}(),d()(a.prototype,"onSelectedFromPane",[m.a],Object.getOwnPropertyDescriptor(a.prototype,"onSelectedFromPane"),a.prototype),d()(a.prototype,"onClosed",[m.a],Object.getOwnPropertyDescriptor(a.prototype,"onClosed"),a.prototype),a);t.a=new I},function(e,t,n){"use strict";var r=n(25),i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(18),l=n.n(u),c=n(19),d=n.n(c),h=n(11),f=n.n(h),p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function g(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var v=Object.keys,m=Array.isArray,y="undefined"!==typeof self?self:"undefined"!==typeof window?window:global;function _(e,t){return"object"!==typeof t||v(t).forEach((function(n){e[n]=t[n]})),e}"undefined"===typeof Promise||y.Promise||(y.Promise=Promise);var b=Object.getPrototypeOf,w={}.hasOwnProperty;function k(e,t){return w.call(e,t)}function S(e,t){"function"===typeof t&&(t=t(b(e))),v(t).forEach((function(n){P(e,n,t[n])}))}var E=Object.defineProperty;function P(e,t,n,r){E(e,t,_(n&&k(n,"get")&&"function"===typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function I(e){return{from:function(t){return e.prototype=Object.create(t.prototype),P(e.prototype,"constructor",e),{extend:S.bind(null,e.prototype)}}}}var D=Object.getOwnPropertyDescriptor;function T(e,t){var n;return D(e,t)||(n=b(e))&&T(n,t)}var x=[].slice;function C(e,t,n){return x.call(e,t,n)}function A(e,t){return t(e)}function L(e){if(!e)throw new Error("Assertion Failed")}function O(e){y.setImmediate?setImmediate(e):setTimeout(e,0)}function M(e,t){return e.reduce((function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function R(e,t){if(k(e,t))return e[t];if(!t)return e;if("string"!==typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var a=R(e,t[r]);n.push(a)}return n}var o=t.indexOf(".");if(-1!==o){var s=e[t.substr(0,o)];return void 0===s?void 0:R(s,t.substr(o+1))}}function F(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!==typeof t&&"length"in t){L("string"!==typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)F(e,t[r],n[r])}else{var a=t.indexOf(".");if(-1!==a){var o=t.substr(0,a),s=t.substr(a+1);if(""===s)void 0===n?m(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var u=e[o];u||(u=e[o]={}),F(u,s,n)}}else void 0===n?m(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function N(e){var t={};for(var n in e)k(e,n)&&(t[n]=e[n]);return t}var j=[].concat;function U(e){return j.apply([],e)}var B="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(U([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return y[e]})),V=B.map((function(e){return y[e]})),H=M(B,(function(e){return[e,!0]}));function W(e){if(!e||"object"!==typeof e)return e;var t;if(m(e)){t=[];for(var n=0,r=e.length;n<r;++n)t.push(W(e[n]))}else if(V.indexOf(e.constructor)>=0)t=e;else for(var i in t=e.constructor?Object.create(e.constructor.prototype):{},e)k(e,i)&&(t[i]=W(e[i]));return t}var q={}.toString;function z(e){return q.call(e).slice(8,-1)}var G=function(e,t){return"Array"===t?""+e.map((function(e){return G(e,z(e))})):"ArrayBuffer"===t?""+new Uint8Array(e):"Date"===t?e.getTime():ArrayBuffer.isView(e)?""+new Uint8Array(e.buffer):e};function K(e,t,n,r){return n=n||{},r=r||"",v(e).forEach((function(i){if(k(t,i)){var a=e[i],o=t[i];if("object"===typeof a&&"object"===typeof o&&a&&o){var s=z(a),u=z(o);s===u?H[s]?G(a,s)!==G(o,u)&&(n[r+i]=t[i]):K(a,o,n,r+i+"."):n[r+i]=t[i]}else a!==o&&(n[r+i]=t[i])}else n[r+i]=void 0})),v(t).forEach((function(i){k(e,i)||(n[r+i]=t[i])})),n}var Y="undefined"!==typeof Symbol&&Symbol.iterator,Q=Y?function(e){var t;return null!=e&&(t=e[Y])&&t.apply(e)}:function(){return null},X={};function $(e){var t,n,r,i;if(1===arguments.length){if(m(e))return e.slice();if(this===X&&"string"===typeof e)return[e];if(i=Q(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"===typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var J="undefined"!==typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},Z="undefined"!==typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ee(e,t){Z=e,te=t}var te=function(){return!0},ne=!new Error("").stack;function re(){if(ne)try{throw new Error}catch(e){return e}return new Error}function ie(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(te).map((function(e){return"\n"+e})).join("")):""}var ae=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],oe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ae),se={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function ue(e,t){this._e=re(),this.name=e,this.message=t}function le(e,t){return e+". Errors: "+Object.keys(t).map((function(e){return t[e].toString()})).filter((function(e,t,n){return n.indexOf(e)===t})).join("\n")}function ce(e,t,n,r){this._e=re(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=le(e,t)}function de(e,t){this._e=re(),this.name="BulkError",this.failures=t,this.message=le(e,t)}I(ue).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+ie(this._e,2))}},toString:function(){return this.name+": "+this.message}}),I(ce).from(ue),I(de).from(ue);var he=oe.reduce((function(e,t){return e[t]=t+"Error",e}),{}),fe=ue,pe=oe.reduce((function(e,t){var n=t+"Error";function r(e,r){this._e=re(),this.name=n,e?"string"===typeof e?(this.message=e+(r?"\n "+r:""),this.inner=r||null):"object"===typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=se[t]||n,this.inner=null)}return I(r).from(fe),e[t]=r,e}),{});pe.Syntax=SyntaxError,pe.Type=TypeError,pe.Range=RangeError;var ge=ae.reduce((function(e,t){return e[t+"Error"]=pe[t],e}),{});var ve=oe.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=pe[t]),e}),{});function me(){}function ye(e){return e}function _e(e,t){return null==e||e===ye?t:function(n){return t(e(n))}}function be(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function we(e,t){return e===me?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?be(r,this.onsuccess):r),i&&(this.onerror=this.onerror?be(i,this.onerror):i),void 0!==a?a:n}}function ke(e,t){return e===me?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?be(n,this.onsuccess):n),r&&(this.onerror=this.onerror?be(r,this.onerror):r)}}function Se(e,t){return e===me?t:function(n){var r=e.apply(this,arguments);_(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?be(i,this.onsuccess):i),a&&(this.onerror=this.onerror?be(a,this.onerror):a),void 0===r?void 0===o?void 0:o:_(r,o)}}function Ee(e,t){return e===me?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Pe(e,t){return e===me?t:function(){var n=e.apply(this,arguments);if(n&&"function"===typeof n.then){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then((function(){return t.apply(r,a)}))}return t.apply(this,arguments)}}ve.ModifyError=ce,ve.DexieError=ue,ve.BulkError=de;var Ie={},De="undefined"===typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"===typeof crypto||!crypto.subtle)return[e,e.__proto__,e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,t.__proto__,e]}(),Te=De[0],xe=De[1],Ce=De[2],Ae=xe&&xe.then,Le=Te&&Te.constructor,Oe=!!Ce,Me=!1,Re=Ce?function(){Ce.then(it)}:y.setImmediate?setImmediate.bind(null,it):y.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){it(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(it,0)},Fe=function(e,t){ze.push([e,t]),je&&(Re(),je=!1)},Ne=!0,je=!0,Ue=[],Be=[],Ve=null,He=ye,We={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Tt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(e){try{Tt(e[0],e[1])}catch(t){}}))}},qe=We,ze=[],Ge=0,Ke=[];function Ye(e){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=me,this._lib=!1;var t=this._PSD=qe;if(Z&&(this._stackHolder=re(),this._prev=null,this._numPrev=0),"function"!==typeof e){if(e!==Ie)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Je(this,this._value))}this._state=null,this._value=null,++t.ref,$e(this,e)}var Qe={get:function(){var e=qe,t=pt;function n(n,r){var i=this,a=!e.global&&(e!==qe||t!==pt);a&&yt();var o=new Ye((function(t,o){et(i,new Xe(Pt(n,e,a),Pt(r,e,a),t,o,e))}));return Z&&rt(o,this),o}return n.prototype=Ie,n},set:function(e){P(this,"then",e&&e.prototype===Ie?Qe:{get:function(){return e},set:Qe.set})}};function Xe(e,t,n,r,i){this.onFulfilled="function"===typeof e?e:null,this.onRejected="function"===typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function $e(e,t){try{t((function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&at();t&&"function"===typeof t.then?$e(e,(function(e,n){t instanceof Ye?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Ze(e)),n&&ot()}}),Je.bind(null,e))}catch(n){Je(e,n)}}function Je(e,t){if(Be.push(t),null===e._state){var n=e._lib&&at();t=He(t),e._state=!1,e._value=t,Z&&null!==t&&"object"===typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}((function(){var n=T(t,"stack");t._promise=e,P(t,"stack",{get:function(){return Me?n&&(n.get?n.get.apply(t):n.value):e.stack}})})),function(e){Ue.some((function(t){return t._value===e._value}))||Ue.push(e)}(e),Ze(e),n&&ot()}}function Ze(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)et(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Ge&&(++Ge,Fe((function(){0===--Ge&&st()}),[]))}function et(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ge,Fe(tt,[n,e,t])}else e._listeners.push(t)}function tt(e,t,n){try{Ve=t;var r,i=t._value;t._state?r=e(i):(Be.length&&(Be=[]),r=e(i),-1===Be.indexOf(i)&&function(e){var t=Ue.length;for(;t;)if(Ue[--t]._value===e._value)return void Ue.splice(t,1)}(t)),n.resolve(r)}catch(a){n.reject(a)}finally{Ve=null,0===--Ge&&st(),--n.psd.ref||n.psd.finalize()}}function nt(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,a,o=e._value;null!=o?(i=o.name||"Error",a=o.message||o,r=ie(o,0)):(i=o,a=""),t.push(i+(a?": "+a:"")+r)}return Z&&((r=ie(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&nt(e._prev,t,n)),t}function rt(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function it(){at()&&ot()}function at(){var e=Ne;return Ne=!1,je=!1,e}function ot(){var e,t,n;do{for(;ze.length>0;)for(e=ze,ze=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(ze.length>0);Ne=!0,je=!0}function st(){var e=Ue;Ue=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Ke.slice(0),n=t.length;n;)t[--n]()}function ut(e){return new Ye(Ie,!1,e)}function lt(e,t){var n=qe;return function(){var r=at(),i=qe;try{return kt(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{kt(i,!1),r&&ot()}}}S(Ye.prototype,{then:Qe,_then:function(e,t){et(this,new Xe(null,null,e,t,qe))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"===typeof t?this.then(null,(function(e){return e instanceof t?n(e):ut(e)})):this.then(null,(function(e){return e&&e.name===t?n(e):ut(e)}))},finally:function(e){return this.then((function(t){return e(),t}),(function(t){return e(),ut(t)}))},stack:{get:function(){if(this._stack)return this._stack;try{Me=!0;var e=nt(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{Me=!1}}},timeout:function(e,t){var n=this;return e<1/0?new Ye((function(r,i){var a=setTimeout((function(){return i(new pe.Timeout(t))}),e);n.then(r,i).finally(clearTimeout.bind(null,a))})):this}}),"undefined"!==typeof Symbol&&Symbol.toStringTag&&P(Ye.prototype,Symbol.toStringTag,"Dexie.Promise"),We.env=St(),S(Ye,{all:function(){var e=$.apply(null,arguments).map(_t);return new Ye((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((function(i,a){return Ye.resolve(i).then((function(n){e[a]=n,--r||t(e)}),n)}))}))},resolve:function(e){if(e instanceof Ye)return e;if(e&&"function"===typeof e.then)return new Ye((function(t,n){e.then(t,n)}));var t=new Ye(Ie,!0,e);return rt(t,Ve),t},reject:ut,race:function(){var e=$.apply(null,arguments).map(_t);return new Ye((function(t,n){e.map((function(e){return Ye.resolve(e).then(t,n)}))}))},PSD:{get:function(){return qe},set:function(e){return qe=e}},newPSD:vt,usePSD:Et,scheduler:{get:function(){return Fe},set:function(e){Fe=e}},rejectionMapper:{get:function(){return He},set:function(e){He=e}},follow:function(e,t){return new Ye((function(n,r){return vt((function(t,n){var r=qe;r.unhandleds=[],r.onunhandled=n,r.finalize=be((function(){var e=this;!function(e){function t(){e(),Ke.splice(Ke.indexOf(t),1)}Ke.push(t),++Ge,Fe((function(){0===--Ge&&st()}),[])}((function(){0===e.unhandleds.length?t():n(e.unhandleds[0])}))}),r.finalize),e()}),t,n,r)}))}}),Le&&(Le.allSettled&&P(Ye,"allSettled",(function(){var e=$.apply(null,arguments).map(_t);return new Ye((function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach((function(e,i){return Ye.resolve(e).then((function(e){return r[i]={status:"fulfilled",value:e}}),(function(e){return r[i]={status:"rejected",reason:e}})).then((function(){return--n||t(r)}))}))}))})),Le.any&&"undefined"!==typeof AggregateError&&P(Ye,"any",(function(){var e=$.apply(null,arguments).map(_t);return new Ye((function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach((function(e,a){return Ye.resolve(e).then((function(e){return t(e)}),(function(e){i[a]=e,--r||n(new AggregateError(i))}))}))}))})));var ct={awaits:0,echoes:0,id:0},dt=0,ht=[],ft=0,pt=0,gt=0;function vt(e,t,n,r){var i=qe,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++gt;var o=We.env;a.env=Oe?{Promise:Ye,PromiseProp:{value:Ye,configurable:!0,writable:!0},all:Ye.all,race:Ye.race,allSettled:Ye.allSettled,any:Ye.any,resolve:Ye.resolve,reject:Ye.reject,nthen:It(o.nthen,a),gthen:It(o.gthen,a)}:{},t&&_(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=Et(a,e,n,r);return 0===a.ref&&a.finalize(),s}function mt(){return ct.id||(ct.id=++dt),++ct.awaits,ct.echoes+=100,ct.id}function yt(e){!ct.awaits||e&&e!==ct.id||(0===--ct.awaits&&(ct.id=0),ct.echoes=100*ct.awaits)}function _t(e){return ct.echoes&&e&&e.constructor===Le?(mt(),e.then((function(e){return yt(),e}),(function(e){return yt(),xt(e)}))):e}function bt(e){++pt,ct.echoes&&0!==--ct.echoes||(ct.echoes=ct.id=0),ht.push(qe),kt(e,!0)}function wt(){var e=ht[ht.length-1];ht.pop(),kt(e,!1)}function kt(e,t){var n,r=qe;if((t?!ct.echoes||ft++&&e===qe:!ft||--ft&&e===qe)||(n=t?bt.bind(null,e):wt,Ae.call(Te,n)),e!==qe&&(qe=e,r===We&&(We.env=St()),Oe)){var i=We.env.Promise,a=e.env;xe.then=a.nthen,i.prototype.then=a.gthen,(r.global||e.global)&&(Object.defineProperty(y,"Promise",a.PromiseProp),i.all=a.all,i.race=a.race,i.resolve=a.resolve,i.reject=a.reject,a.allSettled&&(i.allSettled=a.allSettled),a.any&&(i.any=a.any))}}function St(){var e=y.Promise;return Oe?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(y,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:xe.then,gthen:e.prototype.then}:{}}function Et(e,t,n,r,i){var a=qe;try{return kt(e,!0),t(n,r,i)}finally{kt(a,!1)}}function Pt(e,t,n){return"function"!==typeof e?e:function(){var r=qe;n&&mt(),kt(t,!0);try{return e.apply(this,arguments)}finally{kt(r,!1)}}}function It(e,t){return function(n,r){return e.call(this,Pt(n,t,!1),Pt(r,t,!1))}}-1===(""+Ae).indexOf("[native code]")&&(mt=yt=me);var Dt="unhandledrejection";function Tt(e,t){var n;try{n=t.onuncatched(e)}catch(a){}if(!1!==n)try{var r,i={promise:t,reason:e};if(y.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Dt,!0,!0),_(r,i)):y.CustomEvent&&_(r=new CustomEvent(Dt,{detail:i}),i),r&&y.dispatchEvent&&(dispatchEvent(r),!y.PromiseRejectionEvent&&y.onunhandledrejection))try{y.onunhandledrejection(r)}catch(o){}Z&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch(a){}}var xt=Ye.reject;function Ct(e,t,n,r){if(e._state.openComplete||qe.letThrough){var i=e._createTransaction(t,n,e._dbSchema);try{i.create()}catch(a){return xt(a)}return i._promise(t,(function(e,t){return vt((function(){return qe.trans=i,r(e,t,i)}))})).then((function(e){return i._completion.then((function(){return e}))}))}if(!e._state.isBeingOpened){if(!e._options.autoOpen)return xt(new pe.DatabaseClosed);e.open().catch(me)}return e._state.dbReadyPromise.then((function(){return Ct(e,t,n,r)}))}var At="3.0.2",Lt=String.fromCharCode(65535),Ot=-1/0,Mt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Rt="String expected.",Ft=[],Nt="undefined"!==typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),jt=Nt,Ut=Nt,Bt=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)},Vt="__dbnames",Ht="readonly",Wt="readwrite";function qt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var zt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1},Gt=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||qe.trans,i=this.name;function a(e,n,r){if(!r.schema[i])throw new pe.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}var o=at();try{return r&&r.db===this.db?r===qe.trans?r._promise(e,a,n):vt((function(){return r._promise(e,a,n)}),{trans:r,transless:qe.transless||qe}):Ct(this.db,e,[this.name],a)}finally{o&&ot()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(function(t){return n.core.get({trans:t,key:e}).then((function(e){return n.hook.reading.fire(e)}))})).then(t)},e.prototype.where=function(e){if("string"===typeof e)return new this.db.WhereClause(this,e);if(m(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var t=v(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(e){return e.compound&&t.every((function(t){return e.keyPath.indexOf(t)>=0}))&&e.keyPath.every((function(e){return t.indexOf(e)>=0}))}))[0];if(n&&this.db._maxKey!==Lt)return this.where(n.name).equals(n.keyPath.map((function(t){return e[t]})));!n&&Z&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+t.join("+")+"]");var r=this.schema.idxByName,i=this.db._deps.indexedDB;function a(e,t){try{return 0===i.cmp(e,t)}catch(n){return!1}}var o=t.reduce((function(t,n){var i=t[0],o=t[1],s=r[n],u=e[n];return[i||s,i||!s?qt(o,s&&s.multi?function(e){var t=R(e,n);return m(t)&&t.some((function(e){return a(u,e)}))}:function(e){return a(u,R(e,n))}):o]}),[null,null]),s=o[0],u=o[1];return s?this.where(s.name).equals(e[s.keyPath]).filter(u):n?this.filter(u):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,m(e)?"["+e.join("+")+"]":e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){this.schema.mappedClass=e;var t=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(k(t,r))try{n[r]=t[r]}catch(i){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e},e.prototype.defineClass=function(){return this.mapToClass((function(e){_(this,e)}))},e.prototype.add=function(e,t){var n=this;return this._trans("readwrite",(function(r){return n.core.mutate({trans:r,type:"add",keys:null!=t?[t]:null,values:[e]})})).then((function(e){return e.numFailures?Ye.reject(e.failures[0]):e.lastResult})).then((function(t){if(!n.core.schema.primaryKey.outbound)try{F(e,n.core.schema.primaryKey.keyPath,t)}catch(r){}return t}))},e.prototype.update=function(e,t){if("object"!==typeof t||m(t))throw new pe.InvalidArgument("Modifications must be an object.");if("object"!==typeof e||m(e))return this.where(":id").equals(e).modify(t);v(t).forEach((function(n){F(e,n,t[n])}));var n=R(e,this.schema.primKey.keyPath);return void 0===n?xt(new pe.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)},e.prototype.put=function(e,t){var n=this;return this._trans("readwrite",(function(r){return n.core.mutate({trans:r,type:"put",values:[e],keys:null!=t?[t]:null})})).then((function(e){return e.numFailures?Ye.reject(e.failures[0]):e.lastResult})).then((function(t){if(!n.core.schema.primaryKey.outbound)try{F(e,n.core.schema.primaryKey.keyPath,t)}catch(r){}return t}))},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})})).then((function(e){return e.numFailures?Ye.reject(e.failures[0]):void 0}))},e.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(t){return e.core.mutate({trans:t,type:"deleteRange",range:zt})})).then((function(e){return e.numFailures?Ye.reject(e.failures[0]):void 0}))},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",(function(n){return t.core.getMany({keys:e,trans:n}).then((function(e){return e.map((function(e){return t.hook.reading.fire(e)}))}))}))},e.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){if(!r.core.schema.primaryKey.outbound&&i)throw new pe.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new pe.InvalidArgument("Arguments objects and keys must have the same length");var n=e.length;return r.core.mutate({trans:t,type:"add",keys:i,values:e,wantResults:a}).then((function(e){var t=e.numFailures,i=e.results,o=e.lastResult,s=e.failures;if(0===t)return a?i:o;throw new de(r.name+".bulkAdd(): "+t+" of "+n+" operations failed",Object.keys(s).map((function(e){return s[e]})))}))}))},e.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){if(!r.core.schema.primaryKey.outbound&&i)throw new pe.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new pe.InvalidArgument("Arguments objects and keys must have the same length");var n=e.length;return r.core.mutate({trans:t,type:"put",keys:i,values:e,wantResults:a}).then((function(e){var t=e.numFailures,i=e.results,o=e.lastResult,s=e.failures;if(0===t)return a?i:o;throw new de(r.name+".bulkPut(): "+t+" of "+n+" operations failed",Object.keys(s).map((function(e){return s[e]})))}))}))},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:e})})).then((function(e){var r=e.numFailures,i=e.lastResult,a=e.failures;if(0===r)return i;throw new de(t.name+".bulkDelete(): "+r+" of "+n+" operations failed",a)}))},e}();function Kt(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,a=new Array(i-1);--i;)a[i-1]=arguments[i];return t[n].subscribe.apply(null,a),e}if("string"===typeof n)return t[n]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(e,r,i){if("object"===typeof e)return o(e);r||(r=Ee),i||(i=me);var a={subscribers:[],fire:i,subscribe:function(e){-1===a.subscribers.indexOf(e)&&(a.subscribers.push(e),a.fire=r(a.fire,e))},unsubscribe:function(e){a.subscribers=a.subscribers.filter((function(t){return t!==e})),a.fire=a.subscribers.reduce(r,i)}};return t[e]=n[e]=a,a}function o(e){v(e).forEach((function(t){var n=e[t];if(m(n))a(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new pe.InvalidArgument("Invalid event config");var r=a(t,ye,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){O((function(){e.apply(null,t)}))}))}))}}))}}function Yt(e,t){return I(t).from({prototype:e}),t}function Qt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Xt(e,t){e.filter=qt(e.filter,t)}function $t(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return qt(r(),t())}:t,e.justLimit=n&&!r}function Jt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new pe.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Zt(e,t,n){var r=Jt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function en(e,t,n,r){var i=e.replayFilter?qt(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},o=function(e,n,r){if(!i||i(n,r,(function(e){return n.stop(e)}),(function(e){return n.fail(e)}))){var o=n.primaryKey,s=""+o;"[object ArrayBuffer]"===s&&(s=""+new Uint8Array(o)),k(a,s)||(a[s]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(o,n),tn(Zt(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return tn(Zt(e,r,n),qt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function tn(e,t,n,r){var i=lt(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then((function(e){if(e)return e.start((function(){var n=function(){return e.continue()};t&&!t(e,(function(e){return n=e}),(function(t){e.stop(t),n=me}),(function(t){e.fail(t),n=me}))||i(e.value,e,(function(e){return n=e})),n()}))}))}var nn=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,xt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,xt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=qt(t.algorithm,e)},e.prototype._iterate=function(e,t){return en(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&_(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read((function(n){return en(t,e,n,t.table.core)}))},e.prototype.count=function(e){var t=this;return this._read((function(e){var n=t._ctx,r=n.table.core;if(Qt(n,!0))return r.count({trans:e,query:{index:Jt(n,r.schema),range:n.range}}).then((function(e){return Math.min(e,n.limit)}));var i=0;return en(n,(function(){return++i,!1}),e,r).then((function(){return i}))})).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function s(e,t){var n=a(e,i),r=a(t,i);return n<r?-o:n>r?o:0}return this.toArray((function(e){return e.sort(s)})).then(t)},e.prototype.toArray=function(e){var t=this;return this._read((function(e){var n=t._ctx;if("next"===n.dir&&Qt(n,!0)&&n.limit>0){var r=n.valueMapper,i=Jt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then((function(e){var t=e.result;return r?t.map(r):t}))}var a=[];return en(n,(function(e){return a.push(e)}),e,n.table.core).then((function(){return a}))}),e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Qt(t)?$t(t,(function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n((function(){e.advance(t),t=0})),!1))}})):$t(t,(function(){var t=e;return function(){return--t<0}}))),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),$t(this._ctx,(function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this},e.prototype.until=function(e,t){return Xt(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this},e.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){var t,n;return Xt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=qt(t.isMatch,n),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Qt(t,!0)&&t.limit>0)return this._read((function(e){var n=Jt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((function(e){return e.result})).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Xt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=k(n,t);return n[t]=!0,!r})),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write((function(r){var i;if("function"===typeof e)i=e;else{var a=v(e),o=a.length;i=function(t){for(var n=!1,r=0;r<o;++r){var i=a[r],s=e[i];R(t,i)!==s&&(F(t,i,s),n=!0)}return n}}var s=n.table.core,u=s.schema.primaryKey,l=u.outbound,c=u.extractKey,d="testmode"in Kn?1:2e3,h=t.db.core.cmp,f=[],p=0,g=[],m=function(e,t){var n=t.failures,r=t.numFailures;p+=e-r;for(var i=0,a=v(n);i<a.length;i++){var o=a[i];f.push(n[o])}};return t.clone().primaryKeys().then((function(e){var t=function(n){var a=Math.min(d,e.length-n);return s.getMany({trans:r,keys:e.slice(n,n+a)}).then((function(o){for(var u=[],f=[],p=l?[]:null,g=[],v=0;v<a;++v){var y=o[v],_={value:W(y),primKey:e[n+v]};!1!==i.call(_,_.value,_)&&(null==_.value?g.push(e[n+v]):l||0===h(c(y),c(_.value))?(f.push(_.value),l&&p.push(e[n+v])):(g.push(e[n+v]),u.push(_.value)))}return Promise.resolve(u.length>0&&s.mutate({trans:r,type:"add",values:u}).then((function(e){for(var t in e.failures)g.splice(parseInt(t),1);m(u.length,e)}))).then((function(e){return f.length>0&&s.mutate({trans:r,type:"put",keys:p,values:f}).then((function(e){return m(f.length,e)}))})).then((function(){return g.length>0&&s.mutate({trans:r,type:"delete",keys:g}).then((function(e){return m(g.length,e)}))})).then((function(){return e.length>n+a&&t(n+d)}))}))};return t(0).then((function(){if(f.length>0)throw new ce("Error modifying one or more objects",f,p,g);return e.length}))}))}))},e.prototype.delete=function(){var e=this._ctx,t=e.range;return Qt(e)&&(e.isPrimKey&&!Ut||3===t.type)?this._write((function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((function(e){var n=e.failures,r=(e.lastResult,e.results,e.numFailures);if(r)throw new ce("Could not delete some values",Object.keys(n).map((function(e){return n[e]})),t-r);return t-r}))}))})):this.modify((function(e,t){return t.value=null}))},e}();function rn(e,t){return e<t?-1:e===t?0:1}function an(e,t){return e>t?-1:e===t?0:1}function on(e,t,n){var r=e instanceof hn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function sn(e){return new e.Collection(e,(function(){return dn("")})).limit(0)}function un(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),s=-1,u=0;u<o;++u){var l=t[u];if(l!==r[u])return i(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):i(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[u],l)<0&&(s=u)}return o<r.length&&"next"===a?e+n.substr(e.length):o<e.length&&"prev"===a?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function ln(e,t,n,r){var i,a,o,s,u,l,c,d=n.length;if(!n.every((function(e){return"string"===typeof e})))return on(e,Rt);function h(e){i=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),a=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),o="next"===e?rn:an;var t=n.map((function(e){return{lower:a(e),upper:i(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));s=t.map((function(e){return e.upper})),u=t.map((function(e){return e.lower})),l=e,c="next"===e?"":r}h("next");var f=new e.Collection(e,(function(){return cn(s[0],u[d-1]+r)}));f._ondirectionchange=function(e){h(e)};var p=0;return f._addAlgorithm((function(e,n,r){var i=e.key;if("string"!==typeof i)return!1;var h=a(i);if(t(h,u,p))return!0;for(var f=null,g=p;g<d;++g){var v=un(i,h,s[g],u[g],o,l);null===v&&null===f?p=g+1:(null===f||o(f,v)>0)&&(f=v)}return n(null!==f?function(){e.continue(f+c)}:r),!1})),f}function cn(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function dn(e){return{type:1,lower:e,upper:e}}var hn=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!0,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?sn(this):new this.Collection(this,(function(){return cn(e,t,!n,!r)}))}catch(i){return on(this,Mt)}},e.prototype.equals=function(e){return new this.Collection(this,(function(){return dn(e)}))},e.prototype.above=function(e){return null==e?on(this,Mt):new this.Collection(this,(function(){return cn(e,void 0,!0)}))},e.prototype.aboveOrEqual=function(e){return null==e?on(this,Mt):new this.Collection(this,(function(){return cn(e,void 0,!1)}))},e.prototype.below=function(e){return null==e?on(this,Mt):new this.Collection(this,(function(){return cn(void 0,e,!1,!0)}))},e.prototype.belowOrEqual=function(e){return null==e?on(this,Mt):new this.Collection(this,(function(){return cn(void 0,e)}))},e.prototype.startsWith=function(e){return"string"!==typeof e?on(this,Rt):this.between(e,e+Lt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):ln(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],Lt)},e.prototype.equalsIgnoreCase=function(e){return ln(this,(function(e,t){return e===t[0]}),[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=$.apply(X,arguments);return 0===e.length?sn(this):ln(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=$.apply(X,arguments);return 0===e.length?sn(this):ln(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,Lt)},e.prototype.anyOf=function(){var e=this,t=$.apply(X,arguments),n=this._cmp;try{t.sort(n)}catch(a){return on(this,Mt)}if(0===t.length)return sn(this);var r=new this.Collection(this,(function(){return cn(t[0],t[t.length-1])}));r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm((function(e,r,a){for(var o=e.key;n(o,t[i])>0;)if(++i===t.length)return r(a),!1;return 0===n(o,t[i])||(r((function(){e.continue(t[i])})),!1)})),r},e.prototype.notEqual=function(e){return this.inAnyRange([[Ot,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=$.apply(X,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(n){return on(this,Mt)}var t=e.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[Ot,t]]}),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,a=this._descending,o=this._min,s=this._max;if(0===e.length)return sn(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0})))return on(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",pe.InvalidArgument);var u=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers;var c,d=i;function h(e,t){return d(e[0],t[0])}try{(c=e.reduce((function(e,t){for(var n=0,i=e.length;n<i;++n){var a=e[n];if(r(t[0],a[1])<0&&r(t[1],a[0])>0){a[0]=o(a[0],t[0]),a[1]=s(a[1],t[1]);break}}return n===i&&e.push(t),e}),[])).sort(h)}catch(y){return on(this,Mt)}var f=0,p=l?function(e){return i(e,c[f][1])>0}:function(e){return i(e,c[f][1])>=0},g=u?function(e){return a(e,c[f][0])>0}:function(e){return a(e,c[f][0])>=0};var v=p,m=new this.Collection(this,(function(){return cn(c[0][0],c[c.length-1][1],!u,!l)}));return m._ondirectionchange=function(e){"next"===e?(v=p,d=i):(v=g,d=a),c.sort(h)},m._addAlgorithm((function(e,t,r){for(var a=e.key;v(a);)if(++f===c.length)return t(r),!1;return!!function(e){return!p(e)&&!g(e)}(a)||(0===n._cmp(a,c[f][1])||0===n._cmp(a,c[f][0])||t((function(){d===i?e.continue(c[f][0]):e.continue(c[f][1])})),!1)})),m},e.prototype.startsWithAnyOf=function(){var e=$.apply(X,arguments);return e.every((function(e){return"string"===typeof e}))?0===e.length?sn(this):this.inAnyRange(e.map((function(e){return[e,e+Lt]}))):on(this,"startsWithAnyOf() only works with strings")},e}();function fn(e){return 1===e.length?e[0]:e}function pn(e){try{return e.only([[]]),[[]]}catch(t){return Lt}}function gn(e){return lt((function(t){return vn(t),e(t.target.error),!1}))}function vn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var mn=function(){function e(){}return e.prototype._lock=function(){return L(!qe.global),++this._reculock,1!==this._reculock||qe.global||(qe.lockOwnerFor=this),this},e.prototype._unlock=function(){if(L(!qe.global),0===--this._reculock)for(qe.global||(qe.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Et(e[1],e[0])}catch(t){}}return this},e.prototype._locked=function(){return this._reculock&&qe.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(L(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new pe.DatabaseClosed(r);case"MissingAPIError":throw new pe.MissingAPI(r.message,r);default:throw new pe.OpenFailed(r)}if(!this.active)throw new pe.TransactionInactive;return L(null===this._completion._state),(e=this.idbtrans=e||n.transaction(fn(this.storeNames),this.mode)).onerror=lt((function(n){vn(n),t._reject(e.error)})),e.onabort=lt((function(n){vn(n),t.active&&t._reject(new pe.Abort(e.error)),t.active=!1,t.on("abort").fire(n)})),e.oncomplete=lt((function(){t.active=!1,t._resolve()})),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return xt(new pe.ReadOnly("Transaction is readonly"));if(!this.active)return xt(new pe.TransactionInactive);if(this._locked())return new Ye((function(i,a){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,a)},qe])}));if(n)return vt((function(){var e=new Ye((function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var i=new Ye((function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Ye.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return n}));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Ye((function(e,r){n.then((function(n){return t._waitingQueue.push(lt(e.bind(null,n)))}),(function(e){return t._waitingQueue.push(lt(r.bind(null,e)))})).finally((function(){t._waitingFor===i&&(t._waitingFor=null)}))}))},e.prototype.abort=function(){this.active&&this._reject(new pe.Abort),this.active=!1},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(k(t,e))return t[e];var n=this.schema[e];if(!n)throw new pe.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function yn(e,t,n,r,i,a,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+_n(t)}}function _n(e){return"string"===typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function bn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:M(n,(function(e){return[e.name,e]}))}}function wn(e){return null==e?function(){}:"string"===typeof e?function(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return R(t,e)}}(e):function(t){return R(t,e)}}function kn(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}function Sn(e){return[].slice.call(e)}var En=0;function Pn(e){return null==e?":id":"string"===typeof e?e:"["+e.join("+")+"]"}function In(e,t,n,r){var i=t.cmp.bind(t);function a(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var t=e.lower,r=e.upper,i=e.lowerOpen,a=e.upperOpen;return void 0===t?void 0===r?null:n.upperBound(r,!!a):void 0===r?n.lowerBound(t,!!i):n.bound(t,r,!!i,!!a)}var o=function(e,t){var n=Sn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((function(e){return t.objectStore(e)})).map((function(e){var t=e.keyPath,n=e.autoIncrement,r=m(t),i=null==t,a={},o={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:wn(t)},indexes:Sn(e.indexNames).map((function(t){return e.index(t)})).map((function(e){var t=e.name,n=e.unique,r=e.multiEntry,i=e.keyPath,o={name:t,compound:m(i),keyPath:i,unique:n,multiEntry:r,extractKey:wn(i)};return a[Pn(i)]=o,o})),getIndexByKeyPath:function(e){return a[Pn(e)]}};return a[":id"]=o.primaryKey,null!=t&&(a[Pn(t)]=o.primaryKey),o}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!==typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),s=o.schema,u=o.hasGetAll,l=s.tables.map((function(e){return function(e){var t=e.name;return{name:t,schema:e,mutate:function(n){var r=n.trans,i=n.type,o=n.keys,s=n.values,u=n.range,l=n.wantResults;return new Promise((function(n,c){n=lt(n);var d=r.objectStore(t),h=null==d.keyPath,f="put"===i||"add"===i;if(!f&&"delete"!==i&&"deleteRange"!==i)throw new Error("Invalid operation type: "+i);var p=(o||s||{length:1}).length;if(o&&s&&o.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===p)return n({numFailures:0,failures:{},results:[],lastResult:void 0});var v,m=l&&g(o||kn(e.primaryKey,{type:i,keys:o,values:s})),y=[],_=0,b=function(e){++_,vn(e),m&&(m[e.target._reqno]=void 0),y[e.target._reqno]=e.target.error},w=function(e){var t=e.target;m[t._reqno]=t.result};if("deleteRange"===i){if(4===u.type)return n({numFailures:_,failures:y,results:m,lastResult:void 0});v=3===u.type?d.clear():d.delete(a(u))}else{var k=f?h?[s,o]:[s,null]:[o,null],S=k[0],E=k[1];if(f)for(var P=0;P<p;++P)(v=E&&void 0!==E[P]?d[i](S[P],E[P]):d[i](S[P]))._reqno=P,m&&void 0===m[P]&&(v.onsuccess=w),v.onerror=b;else for(P=0;P<p;++P)(v=d[i](S[P]))._reqno=P,v.onerror=b}var I=function(e){var t=e.target.result;m&&(m[p-1]=t),n({numFailures:_,failures:y,results:m,lastResult:t})};v.onerror=function(e){b(e),I(e)},v.onsuccess=I}))},getMany:function(e){var n=e.trans,r=e.keys;return new Promise((function(e,i){e=lt(e);for(var a,o=n.objectStore(t),s=r.length,u=new Array(s),l=0,c=0,d=function(t){var n=t.target;u[n._pos]=n.result,++c===l&&e(u)},h=gn(i),f=0;f<s;++f)null!=r[f]&&((a=o.get(r[f]))._pos=f,a.onsuccess=d,a.onerror=h,++l);0===l&&e(u)}))},get:function(e){var n=e.trans,r=e.key;return new Promise((function(e,i){e=lt(e);var a=n.objectStore(t).get(r);a.onsuccess=function(t){return e(t.target.result)},a.onerror=gn(i)}))},query:function(e){return function(n){return new Promise((function(r,i){r=lt(r);var o=n.trans,s=n.values,u=n.limit,l=n.query,c=u===1/0?void 0:u,d=l.index,h=l.range,f=o.objectStore(t),p=d.isPrimaryKey?f:f.index(d.name),g=a(h);if(0===u)return r({result:[]});if(e){var v=s?p.getAll(g,c):p.getAllKeys(g,c);v.onsuccess=function(e){return r({result:e.target.result})},v.onerror=gn(i)}else{var m=0,y=s||!("openKeyCursor"in p)?p.openCursor(g):p.openKeyCursor(g),_=[];y.onsuccess=function(e){var t=y.result;return t?(_.push(s?t.value:t.primaryKey),++m===u?r({result:_}):void t.continue()):r({result:_})},y.onerror=gn(i)}}))}}(u),openCursor:function(e){var n=e.trans,r=e.values,i=e.query,o=e.reverse,s=e.unique;return new Promise((function(e,u){e=lt(e);var l=i.index,c=i.range,d=n.objectStore(t),h=l.isPrimaryKey?d:d.index(l.name),f=o?s?"prevunique":"prev":s?"nextunique":"next",p=r||!("openKeyCursor"in h)?h.openCursor(a(c),f):h.openKeyCursor(a(c),f);p.onerror=gn(u),p.onsuccess=lt((function(t){var r=p.result;if(r){r.___id=++En,r.done=!1;var i=r.continue.bind(r),a=r.continuePrimaryKey;a&&(a=a.bind(r));var o=r.advance.bind(r),s=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=function(){throw new Error("Cursor not started")},r.fail=lt(u),r.next=function(){var e=this,t=1;return this.start((function(){return t--?e.continue():e.stop()})).then((function(){return e}))},r.start=function(e){var t=new Promise((function(e,t){e=lt(e),p.onerror=gn(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=s,e(t)}})),n=function(){if(p.result)try{e()}catch(t){r.fail(t)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=lt((function(e){p.onsuccess=n,n()})),r.continue=i,r.continuePrimaryKey=a,r.advance=o,n(),t},e(r)}else e(null)}),u)}))},count:function(e){var n=e.query,r=e.trans,i=n.index,o=n.range;return new Promise((function(e,n){var s=r.objectStore(t),u=i.isPrimaryKey?s:s.index(i.name),l=a(o),c=l?u.count(l):u.count();c.onsuccess=lt((function(t){return e(t.target.result)})),c.onerror=gn(n)}))}}}(e)})),c={};return l.forEach((function(e){return c[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!c[e])throw new Error("Table '"+e+"' not found");return c[e]},cmp:i,MIN_KEY:-1/0,MAX_KEY:pn(n),schema:s}}function Dn(e,t,n,r){var i=n.IDBKeyRange;return{dbcore:function(e,t){return t.reduce((function(e,t){var n=t.create;return p(p({},e),n(e))}),e)}(In(t,n.indexedDB,i,r),e.dbcore)}}function Tn(e,t){var n=t.db,r=Dn(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((function(t){var n=t.name;e.core.schema.tables.some((function(e){return e.name===n}))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function xn(e,t,n,r){n.forEach((function(n){var i=r[n];t.forEach((function(t){n in t||(t===e.Transaction.prototype||t instanceof e.Transaction?P(t,n,{get:function(){return this.table(n)},set:function(e){E(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))}))}))}function Cn(e,t){t.forEach((function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]}))}function An(e,t){return e._cfg.version-t._cfg.version}function Ln(e,t,n,r){var i=e._dbSchema,a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var o=a._reject.bind(a),s=qe.transless||qe;vt((function(){qe.trans=a,qe.transless=s,0===t?(v(i).forEach((function(e){On(n,e,i[e].primKey,i[e].indexes)})),Tn(e,n),Ye.follow((function(){return e.on.populate.fire(a)})).catch(o)):function(e,t,n,r){var i=[],a=e._versions,o=e._dbSchema=Rn(e,e.idbdb,r),s=!1;function u(){return i.length?Ye.resolve(i.shift()(n.idbtrans)).then(u):Ye.resolve()}return a.filter((function(e){return e._cfg.version>=t})).forEach((function(a){i.push((function(){var i=o,u=a._cfg.dbschema;Fn(e,i,r),Fn(e,u,r),o=e._dbSchema=u;var l=function(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],a=t[n];if(i){var o={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src===a.primKey.src||Nt){var s=i.idxByName,u=a.idxByName,l=void 0;for(l in s)u[l]||o.del.push(l);for(l in u){var c=s[l],d=u[l];c?c.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&r.change.push(o)}else o.recreate=!0,r.change.push(o)}else r.add.push([n,a])}return r}(i,u);l.add.forEach((function(e){On(r,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((function(e){if(e.recreate)throw new pe.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach((function(e){return Mn(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),Mn(t,e)})),e.del.forEach((function(e){return t.deleteIndex(e)}))}));var c=a._cfg.contentUpgrade;if(c&&a._cfg.version>t){Tn(e,r),s=!0;var d=N(u);l.del.forEach((function(e){d[e]=i[e]})),Cn(e,[e.Transaction.prototype]),xn(e,[e.Transaction.prototype],v(d),d),n.schema=d;var h,f=J(c);f&&mt();var p=Ye.follow((function(){if((h=c(n))&&f){var e=yt.bind(null,null);h.then(e,e)}}));return h&&"function"===typeof h.then?Ye.resolve(h):p.then((function(){return h}))}})),i.push((function(t){s&&jt||function(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var r=t.db.objectStoreNames[n];null==e[r]&&t.db.deleteObjectStore(r)}}(a._cfg.dbschema,t);Cn(e,[e.Transaction.prototype]),xn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),u().then((function(){var e,t;t=r,v(e=o).forEach((function(n){t.db.objectStoreNames.contains(n)||On(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,a,n).catch(o)}))}function On(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(e){return Mn(i,e)})),i}function Mn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Rn(e,t,n){var r={};return C(t.objectStoreNames,0).forEach((function(e){for(var t=n.objectStore(e),i=t.keyPath,a=yn(_n(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!==typeof i,!0),o=[],s=0;s<t.indexNames.length;++s){var u=t.index(t.indexNames[s]);i=u.keyPath;var l=yn(u.name,i,!!u.unique,!!u.multiEntry,!1,i&&"string"!==typeof i,!1);o.push(l)}r[e]=bn(e,a,o)})),r}function Fn(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],o=n.objectStore(a);e._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var u=o.indexNames[s],l=o.index(u).keyPath,c="string"===typeof l?l:"["+C(l).join("+")+"]";if(t[a]){var d=t[a].idxByName[c];d&&(d.name=u,delete t[a].idxByName[c],t[a].idxByName[u]=d)}}}"undefined"!==typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&y.WorkerGlobalScope&&y instanceof y.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}var Nn,jn=function(){function e(){}return e.prototype._parseStoresSpec=function(e,t){v(e).forEach((function(n){if(null!==e[n]){var r=e[n].split(",").map((function(e,t){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return yn(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),m(r),0===t)})),i=r.shift();if(i.multi)throw new pe.Schema("Primary key cannot be multi-valued");r.forEach((function(e){if(e.auto)throw new pe.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new pe.Schema("Index must have a name and cannot be an empty string")})),t[n]=bn(n,i,r)}}))},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?_(this._cfg.storesSource,e):e;var n=t._versions,r={},i={};return n.forEach((function(e){_(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,Cn(t,[t._allTables,t,t.Transaction.prototype]),xn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],v(i),i),t._storeNames=v(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=e,this},e}();function Un(e){return vt((function(){return qe.letThrough=!0,e()}))}function Bn(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?xt(t.dbOpenError):e}));Z&&(t.openCanceller._stackHolder=re()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.dbReadyResolve,i=null;return Ye.race([t.openCanceller,new Ye((function(r,a){if(!n)throw new pe.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var o=e.name,s=t.autoSchema?n.open(o):n.open(o,Math.round(10*e.verno));if(!s)throw new pe.MissingAPI("IndexedDB API not available");s.onerror=gn(a),s.onblocked=lt(e._fireOnBlocked),s.onupgradeneeded=lt((function(r){if(i=s.transaction,t.autoSchema&&!e._options.allowEmptyDB){s.onerror=vn,i.abort(),s.result.close();var u=n.deleteDatabase(o);u.onsuccess=u.onerror=lt((function(){a(new pe.NoSuchDatabase("Database "+o+" doesnt exist"))}))}else{i.onerror=gn(a);var l=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;e.idbdb=s.result,Ln(e,l/10,i,a)}}),a),s.onsuccess=lt((function(){i=null;var n=e.idbdb=s.result,a=C(n.objectStoreNames);if(a.length>0)try{var u=n.transaction(fn(a),"readonly");t.autoSchema?function(e,t,n){e.verno=t.version/10;var r=e._dbSchema=Rn(0,t,n);e._storeNames=C(t.objectStoreNames,0),xn(e,[e._allTables],v(r),r)}(e,n,u):Fn(e,e._dbSchema,u),Tn(e,u)}catch(l){}Ft.push(e),n.onversionchange=lt((function(n){t.vcFired=!0,e.on("versionchange").fire(n)})),Nn.add(o),r()}),a)}))]).then((function(){return t.onReadyBeingFired=[],Ye.resolve(Un(e.on.ready.fire)).then((function e(){if(t.onReadyBeingFired.length>0){var n=t.onReadyBeingFired.reduce(Pe,me);return t.onReadyBeingFired=[],Ye.resolve(Un(n)).then(e)}}))})).finally((function(){t.onReadyBeingFired=null})).then((function(){return t.isBeingOpened=!1,e})).catch((function(n){try{i&&i.abort()}catch(r){}return t.isBeingOpened=!1,e.close(),t.dbOpenError=n,xt(t.dbOpenError)})).finally((function(){t.openComplete=!0,r()}))}function Vn(e){var t=function(t){return e.next(t)},n=i(t),r=i((function(t){return e.throw(t)}));function i(e){return function(t){var i=e(t),a=i.value;return i.done?a:a&&"function"===typeof a.then?a.then(n,r):m(a)?Promise.all(a).then(n,r):n(a)}}return i(t)()}function Hn(e,t,n){var r=arguments.length;if(r<2)throw new pe.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=U(i);return[e,a,n]}function Wn(e,t,n,r,i){return Ye.resolve().then((function(){var a=qe.transless||qe,o=e._createTransaction(t,n,e._dbSchema,r),s={trans:o,transless:a};r?o.idbtrans=r.idbtrans:o.create();var u,l=J(i);l&&mt();var c=Ye.follow((function(){if(u=i.call(o,o))if(l){var e=yt.bind(null,null);u.then(e,e)}else"function"===typeof u.next&&"function"===typeof u.throw&&(u=Vn(u))}),s);return(u&&"function"===typeof u.then?Ye.resolve(u).then((function(e){return o.active?e:xt(new pe.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):c.then((function(){return u}))).then((function(e){return r&&o._resolve(),o._completion.then((function(){return e}))})).catch((function(e){return o._reject(e),xt(e)}))}))}function qn(e,t,n){for(var r=m(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var zn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return p(p({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function o(e,t,n){var r=Pn(e),s=i[r]=i[r]||[],u=null==e?0:"string"===typeof e?1:e.length,l=t>0,c=p(p({},n),{isVirtual:l,isPrimaryKey:!l&&n.isPrimaryKey,keyTail:t,keyLength:u,extractKey:wn(e),unique:!l&&n.unique});(s.push(c),c.isPrimaryKey||a.push(c),u>1)&&o(2===u?e[0]:e.slice(0,u-1),t+1,n);return s.sort((function(e,t){return e.keyTail-t.keyTail})),c}var s=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var u=0,l=r.indexes;u<l.length;u++){var c=l[u];o(c.keyPath,0,c)}function d(t){var n,r,i=t.query.index;return i.isVirtual?p(p({},t),{query:{index:i,range:(n=t.query.range,r=i.keyTail,{type:1===n.type?2:n.type,lower:qn(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,r),lowerOpen:!0,upper:qn(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,r),upperOpen:!0})}}):t}return p(p({},n),{schema:p(p({},r),{primaryKey:s,indexes:a,getIndexByKeyPath:function(e){var t=i[Pn(e)];return t&&t[0]}}),count:function(e){return n.count(d(e))},query:function(e){return n.query(d(e))},openCursor:function(t){var r=t.query.index,i=r.keyTail,a=r.isVirtual,o=r.keyLength;if(!a)return n.openCursor(t);return n.openCursor(d(t)).then((function(n){return n&&function(n){return Object.create(n,{continue:{value:function(r){null!=r?n.continue(qn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(qn(n.key,t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(qn(t,e.MAX_KEY,i),r)}},key:{get:function(){var e=n.key;return 1===o?e[0]:e.slice(0,o)}},value:{get:function(){return n.value}}})}(n)}))}})}})}},Gn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return p(p({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return p(p({},n),{mutate:function(e){var i=qe.trans,a=i.table(t).hook,o=a.deleting,s=a.creating,u=a.updating;switch(e.type){case"add":if(s.fire===me)break;return i._promise("readwrite",(function(){return l(e)}),!0);case"put":if(s.fire===me&&u.fire===me)break;return i._promise("readwrite",(function(){return l(e)}),!0);case"delete":if(o.fire===me)break;return i._promise("readwrite",(function(){return l(e)}),!0);case"deleteRange":if(o.fire===me)break;return i._promise("readwrite",(function(){return function(e){return c(e.trans,e.range,1e4)}(e)}),!0)}return n.mutate(e);function l(e){var t=qe.trans,i=e.keys||kn(r,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?p(p({},e),{keys:i,wantResults:!0}):p({},e)).type&&(e.values=g(e.values)),e.keys&&(e.keys=g(e.keys)),function(e,t,n){return"add"===t.type?Promise.resolve(new Array(t.values.length)):e.getMany({trans:t.trans,keys:n})}(n,e,i).then((function(a){var l=i.map((function(n,i){var l=a[i],c={onerror:null,onsuccess:null};if("delete"===e.type)o.fire.call(c,n,l,t);else if("add"===e.type||void 0===l){var d=s.fire.call(c,n,e.values[i],t);null==n&&null!=d&&(n=d,e.keys[i]=n,r.outbound||F(e.values[i],r.keyPath,n))}else{var h=K(l,e.values[i]),f=u.fire.call(c,h,n,l,t);if(f){var p=e.values[i];Object.keys(f).forEach((function(e){F(p,e,f[e])}))}}return c}));return n.mutate(e).then((function(t){for(var n=t.failures,r=t.results,o=t.numFailures,s=t.lastResult,u=0;u<i.length;++u){var c=r?r[u]:i[u],d=l[u];null==c?d.onerror&&d.onerror(n[u]):d.onsuccess&&d.onsuccess("put"===e.type&&a[u]?e.values[u]:c)}return{failures:n,results:r,numFailures:o,lastResult:s}})).catch((function(e){return l.forEach((function(t){return t.onerror&&t.onerror(e)})),Promise.reject(e)}))}))}function c(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then((function(n){var r=n.result;return l({type:"delete",keys:r,trans:e}).then((function(n){return n.numFailures>0?Promise.reject(n.failures[0]):r.length<i?{failures:[],numFailures:0,lastResult:void 0}:c(e,p(p({},t),{lower:r[r.length-1],lowerOpen:!0}),i)}))}))}}})}})}},Kn=function(){function e(t,n){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=n=p({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null;var o,s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:me,dbReadyPromise:null,cancelOpen:me,openCanceller:null,autoSchema:!0};s.dbReadyPromise=new Ye((function(e){s.dbReadyResolve=e})),s.openCanceller=new Ye((function(e,t){s.cancelOpen=t})),this._state=s,this.name=t,this.on=Kt(this,"populate","blocked","versionchange",{ready:[Pe,me]}),this.on.ready.subscribe=A(this.on.ready.subscribe,(function(t){return function(n,i){e.vip((function(){var e=r._state;if(e.openComplete)e.dbOpenError||Ye.resolve().then(n),i&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),i&&t(n);else{t(n);var a=r;i||t((function e(){a.on.ready.unsubscribe(n),a.on.ready.unsubscribe(e)}))}}))}})),this.Collection=(o=this,Yt(nn.prototype,(function(e,t){this.db=o;var n=zt,r=null;if(t)try{n=t()}catch(u){r=u}var i=e._ctx,a=i.table,s=a.hook.reading.fire;this._ctx={table:a,index:i.index,isPrimKey:!i.index||a.schema.primKey.keyPath&&i.index===a.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:s!==ye?s:null}}))),this.Table=function(e){return Yt(Gt.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Kt(null,{creating:[we,me],reading:[_e,ye],updating:[Se,me],deleting:[ke,me]})}))}(this),this.Transaction=function(e){return Yt(mn.prototype,(function(t,n,r,i){var a=this;this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.idbtrans=null,this.on=Kt(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ye((function(e,t){a._resolve=e,a._reject=t})),this._completion.then((function(){a.active=!1,a.on.complete.fire()}),(function(e){var t=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):t&&a.idbtrans&&a.idbtrans.abort(),xt(e)}))}))}(this),this.Version=function(e){return Yt(jn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Yt(hn.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};var i=e._deps.indexedDB;if(!i)throw new pe.MissingAPI("indexedDB API missing");this._cmp=this._ascending=i.cmp.bind(i),this._descending=function(e,t){return i.cmp(t,e)},this._max=function(e,t){return i.cmp(e,t)>0?e:t},this._min=function(e,t){return i.cmp(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+e.oldVersion/10)})),this._maxKey=pn(n.IDBKeyRange),this._createTransaction=function(e,t,n,i){return new r.Transaction(e,t,n,i)},this._fireOnBlocked=function(e){r.on("blocked").fire(e),Ft.filter((function(e){return e.name===r.name&&e!==r&&!e._state.vcFired})).map((function(t){return t.on("versionchange").fire(e)}))},this.use(zn),this.use(Gn),a.forEach((function(e){return e(r)}))}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new pe.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new pe.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter((function(t){return t._cfg.version===e}))[0];return n||(n=new this.Version(e),t.push(n),t.sort(An),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this._state.openComplete||qe.letThrough?e():new Ye((function(e,n){if(!t._state.isBeingOpened){if(!t._options.autoOpen)return void n(new pe.DatabaseClosed);t.open().catch(me)}t._state.dbReadyPromise.then(e,n)})).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var a=this._middlewares[t]||(this._middlewares[t]=[]);return a.push({stack:t,create:n,level:null==r?10:r,name:i}),a.sort((function(e,t){return e.level-t.level})),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(e){return r?e.create!==r:!!n&&e.name!==n}))),this},e.prototype.open=function(){return Bn(this)},e.prototype.close=function(){var e=Ft.indexOf(this),t=this._state;if(e>=0&&Ft.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(n){}this.idbdb=null}this._options.autoOpen=!1,t.dbOpenError=new pe.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError),t.dbReadyPromise=new Ye((function(e){t.dbReadyResolve=e})),t.openCanceller=new Ye((function(e,n){t.cancelOpen=n}))},e.prototype.delete=function(){var e=this,t=arguments.length>0,n=this._state;return new Ye((function(r,i){var a=function(){e.close();var t=e._deps.indexedDB.deleteDatabase(e.name);t.onsuccess=lt((function(){Nn.remove(e.name),r()})),t.onerror=gn(i),t.onblocked=e._fireOnBlocked};if(t)throw new pe.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(a):a()}))},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return v(this._allTables).map((function(t){return e._allTables[t]}))},enumerable:!0,configurable:!0}),e.prototype.transaction=function(){var e=Hn.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,i=qe.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var a,o,s=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(o=t.map((function(e){var t=e instanceof r.Table?e.name:e;if("string"!==typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===Ht)a=Ht;else{if("rw"!=e&&e!=Wt)throw new pe.InvalidArgument("Invalid transaction mode: "+e);a=Wt}if(i){if(i.mode===Ht&&a===Wt){if(!s)throw new pe.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach((function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!s)throw new pe.SubTransaction("Table "+e+" not included in parent transaction.");i=null}})),s&&i&&!i.active&&(i=null)}}catch(l){return i?i._promise(null,(function(e,t){t(l)})):xt(l)}var u=Wn.bind(null,this,a,o,i,n);return i?i._promise(a,u,"lock"):qe.trans?Et(qe.transless,(function(){return r._whenReady(u)})):this._whenReady(u)},e.prototype.table=function(e){if(!k(this._allTables,e))throw new pe.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},e}(),Yn=Kn;function Qn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}S(Yn,p(p({},ve),{delete:function(e){return new Yn(e).delete()},exists:function(e){return new Yn(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){return Nn?Nn.getDatabaseNames().then(e):Ye.resolve([])},defineClass:function(){return function(e){_(this,e)}},ignoreTransaction:function(e){return qe.trans?Et(qe.transless,e):e()},vip:Un,async:function(e){return function(){try{var t=Vn(e.apply(this,arguments));return t&&"function"===typeof t.then?t:Ye.resolve(t)}catch(n){return xt(n)}}},spawn:function(e,t,n){try{var r=Vn(e.apply(n,t||[]));return r&&"function"===typeof r.then?r:Ye.resolve(r)}catch(i){return xt(i)}},currentTransaction:{get:function(){return qe.trans||null}},waitFor:function(e,t){var n=Ye.resolve("function"===typeof e?Yn.ignoreTransaction(e):e).timeout(t||6e4);return qe.trans?qe.trans.waitFor(n):n},Promise:Ye,debug:{get:function(){return Z},set:function(e){ee(e,"dexie"===e?function(){return!0}:Bt)}},derive:I,extend:_,props:S,override:A,Events:Kt,getByKeyPath:R,setByKeyPath:F,delByKeyPath:function(e,t){"string"===typeof t?F(e,t,void 0):"length"in t&&[].map.call(t,(function(t){F(e,t,void 0)}))},shallowClone:N,deepClone:W,getObjectDiff:K,asap:O,minKey:Ot,addons:[],connections:Ft,errnames:he,dependencies:function(){try{return{indexedDB:y.indexedDB||y.mozIndexedDB||y.webkitIndexedDB||y.msIndexedDB,IDBKeyRange:y.IDBKeyRange||y.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:At,version:At.split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,n){return e+t/Math.pow(10,2*n)})),default:Yn,Dexie:Yn})),Yn.maxKey=pn(Yn.dependencies.IDBKeyRange),function(e){try{Nn=function(e){var t,n=e&&"function"===typeof e.databases;if(!n){var r=new Kn(Vt,{addons:[]});r.version(1).stores({dbnames:"name"}),t=r.table("dbnames")}return{getDatabaseNames:function(){return n?Ye.resolve(e.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return e!==Vt}))})):t.toCollection().primaryKeys()},add:function(e){return!n&&e!==Vt&&t.put({name:e}).catch(me)},remove:function(e){return!n&&e!==Vt&&t.delete(e).catch(me)}}}(e)}catch(t){}}(Kn.dependencies.indexedDB),Ye.rejectionMapper=function(e,t){if(!e||e instanceof ue||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ge[e.name])return e;var n=new ge[e.name](t||e.message,e);return"stack"in e&&P(n,"stack",{get:function(){return this.inner.stack}}),n},ee(Z,Bt);var Xn=function(e){l()(n,e);var t=Qn(n);function n(){var e;a()(this,n),(e=t.call(this,"moodonew")).version(1).stores({documents:"id",items:"id",settings:"id",boards:"id",localStorage:"id",contacts:"id"});var r={};["plugins","gmail","drive","gcal"].forEach((function(e){return r[e]="id"})),e.version(2).stores(r),e.tableNames=["documents","items","settings","boards","localStorage","contacts","plugins","Drive","GCalendar","Gmail"];var i={GmailMessages:"id",gmail:null,drive:null,gcal:null};return e.tableNames.forEach((function(e){return i[e]="id"})),i.Gmail="id,date",e.version(3).stores(i),i.pluginsNew="id",e.tableNames.push("pluginsNew"),e.version(4).stores(i),e}return s()(n,[{key:"beginBatch",value:function(){}},{key:"commitBatch",value:function(){}},{key:"getAsArray",value:function(e){return this[e].toArray()}}]),n}(Kn),$n=function(e,t,n){var r=function(e,t,n){for(var r=0,i=0,a=e.length-1;i<=a;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i+a>>1,s=n(e[o],t);if(s<0)i=o+1;else{if(!(s>0))return o;a=o-1}}return i}(e,t,n);return e.splice.apply(e,[r,0,t]),r},Jn=function(e,t){var n=0,i={},a={},o=function(e){i[e.id]||(i[e.id]=e,e.isRoot&&(a[e.docId]=e))};e.length>0&&(e.forEach(o),t&&Object.keys(t).forEach((function(e){o(t[e])})));for(var s=0;s<e.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=e[s],l=u.parent,c=i[l],d=!1;if(u.isArchived||u.isDeleted){var h=u.isDeleted,f=(h?"deleted":"archived")+"Items";if(!c||c.isRoot||(h?!c.isDeleted:!c.isArchived)){var p=a[u.docId];p&&(p[f]||(p[f]=[]),p[f].push(u)),d=!0}}d||(!c&&u.isRoot,u.note&&(u.noteItem=i[u.note]),c&&(32===(32&u.flags)?c.note=u.id:void 0!==u.text&&(c.items||(c.items=[]),void 0===u.index&&(u.index=""+c.items.length),$n(c.items,u,r.a.compareItemIndex))))}return i},Zn=function(e){for(var t=0,n=0;n<e.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e[n]=r.a.itemIn(e[n])}return Jn(e)},er=function(){return new Xn};t.a={load:function(e,t){e||(e=er());var n=e.tableNames,i={},a=n.length;n.forEach((function(e){return i[e]=void 0}));var o=function(e,n){if(n||(n=[]),i[e]=n,"documents"===e){for(var o=0,s=n,u={},l={},c=0;c<s.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=r.a.documentIn(s[c]);u[s[c].id]=d,d.pendingSync&&(l[d.id]=!0)}i.documentsPending=l,i.documents=u}else if("items"===e){var h=function(e){var t={};return e=Zn(e),Object.keys(e).forEach((function(n){var r=e[n],i=r.items;if(r.pendingSync&&(t[r.id]=r.pendingSync),i&&(Number.NEGATIVE_INFINITY,i.find((function(e){32!==(32&e.flags)&&e.index}))))for(var a=0,o=0;o<i.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i[o];s.pendingSync={index:s.index},s.index=o,t[s.id]=!0}})),{items:e,itemsPending:t}}(n),f=h.items,p=h.itemsPending;i.items=f,i.itemsPending=p}else if("settings"===e||"boards"===e){var g=function(e){var t={},n={};return e.forEach((function(e){t[e.id]=e,e.pendingSync&&(n[e.id]=e.pendingSync)})),{values:t,pending:n}}(n),v=g.values,m=g.pending;i[e]=v,i[e+"Pending"]=m,"boards"===e&&Object.keys(v).forEach((function(e){v[e]=r.a.boardIn(v[e])}))}else if("plugins"===e){var y={};n.forEach((function(e){y[e.plugin]||(y[e.plugin]={}),y[e.plugin][e.id]=e})),i[e]=y}else if("localStorage"===e){var _={};n.forEach((function(e){void 0!==e.value?_[e.id]=e.value:Object.keys(e).forEach((function(t){return _[t]=e[t]}))})),i[e]=_}else if("contacts"===e)i[e]=n.map((function(e){return r.a.contactIn(e)}));else if("GCalendar"===e||"Gmail"===e||"GmailMessages"===e||"pluginsNew"===e){var b={};n.forEach((function(e){return b[e.id]=e})),i[e]=b}0===--a&&t(i)},s=!1;for(var u in e.beginBatch(),i)e.getAsArray(u).then(o.bind(e[u],u)).catch((function(e){s||(s=!0,console.log(e),t({error:{name:e.name,message:e.message}}))}));e.commitBatch()},transformItems:Zn,createItemHierarchy:Jn,createDB:er}},function(e,t,n){"use strict";var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(7),l=n.n(u),c=n(8),d=n(44),h=(r=function(){function e(){a()(this,e),this.onDisableChanged=new d.a,this.state={except:{}}}return s()(e,[{key:"animateNext",value:function(e){this.state.disable||(this.state.enable=!0,this.state.except[e]=!0,this.prepTimeout())}},{key:"shouldAnimate",value:function(e){return this.state&&this.state.disable?null:this.state&&(!e||!this.state.except[e])}},{key:"disable",value:function(e){this.state.disable||(this.state.disable=!0,this.state.enable=!1,this.prepTimeout(),e&&this.onDisableChanged.notify())}},{key:"prepTimeout",value:function(){clearTimeout(this.timeout),this.timeout=setTimeout(this._onTimeout,1e3)}},{key:"_onTimeout",value:function(){var e=this.state.disable;this.state.disable=void 0,this.state.enable=!1,this.state.except={},this.timeout=void 0,e&&this.onDisableChanged.notify()}}]),e}(),l()(r.prototype,"_onTimeout",[c.a],Object.getOwnPropertyDescriptor(r.prototype,"_onTimeout"),r.prototype),r);t.a=new h},function(e,t,n){"use strict";var r,i=n(59),a=n.n(i),o=n(5),s=n.n(o),u=n(6),l=n.n(u),c=n(18),d=n.n(c),h=n(19),f=n.n(h),p=n(11),g=n.n(p),v=n(7),m=n.n(v),y=n(8);function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var b=(r=function(e){d()(n,e);var t=_(n);function n(e,r,i){var o,u,l=0;s()(this,n),u=t.call(this,void 0,i);for(var c=0;c<e.length;c++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;e[c].listen(u.onChanged)}return u._observables=e,u.checkFn=r,u._value=(o=u).checkFn.apply(o,a()(u._observables.map((function(e){return e.get()})))),u}return l()(n,[{key:"onChanged",value:function(e,t,n){var r=this._value,i=this.checkFn.apply(this,a()(this._observables.map((function(e){return e.get()}))));(i!==r||n)&&this.set(i,n)}}]),n}(n(13).a),m()(r.prototype,"onChanged",[y.a],Object.getOwnPropertyDescriptor(r.prototype,"onChanged"),r.prototype),r);t.a=b},function(e,t,n){"use strict";var r,i=n(3),a=n.n(i),o=n(10),s=n.n(o),u=n(33),l=n.n(u),c=n(5),d=n.n(c),h=n(6),f=n.n(h),p=n(7),g=n.n(p),v=n(36),m=n(8),y=n(1),_=n(0),b=n(2),w=n(16),k=n(70),S=n(25),E=n(78),P=n(43),I=n(13),D=n(51),T=(r=function(){function e(t){var n=t.id,r=t.text,i=t.dateModified,a=t.rootData,o=t.acl,s=t.backing,u=t.encryptionSentinel,l=t.backups,c=t.isDeleted;d()(this,e);try{_.default.PAssert(397,n,"Document must have id")}catch(h){_.default.reportError(h)}try{_.default.PAssert(398,o,"Document must have acl")}catch(h){_.default.reportError(h)}try{_.default.PAssert(399,a&&a.isRoot,"Document must have root item set to root")}catch(h){_.default.reportError(h)}a&&!a.isRoot&&(a.isRoot=!0),this.id=n,this.text=new I.a(r),this._root=a,this._backing=s,this._isLocalOnly=s.isLocalOnly,this.isSyncing=new I.a(!1),this.acl=new I.a(o),this.dateModified=new I.a(i),this.encryptionSentinel=new I.a(u),this.isDecrypted=this.canDecrypt(),this.backups=new I.a(l),this.isDeleted=new I.a(c),a.archivedItems&&(this._archivedItemsData=a.archivedItems,delete a.archivedItems),a.deletedItems&&(this._deletedItemsData=a.deletedItems,delete a.deletedItems),this._index=b.default.settings.documentIndices.getProperty(n)}return f()(e,[{key:"createVMLIs",value:function(){if(!this._rootItem&&!this.isDeleted.get()){var e=b.default.itemStoreManager.getDefaultItemStore();this._rootItem=e.createItemRaw(this._root,{documentOwner:this,changeType:y.a.ChangeType.Auto,isRoot:!0}),e.addItemToRoot(this._rootItem)}}},{key:"_ensureRootItem",value:function(e,t){e||(this["_root".concat(t,"Item")]=b.default.itemStoreManager.getDefaultItemStore().createItemRaw({id:void 0,text:"".concat(t," Root"),docId:this.id},{documentOwner:this,changeType:y.a.ChangeType.Auto,isRoot:!0}))}},{key:"ensureRootArchivedItem",value:function(){this._ensureRootItem(this._rootArchivedItem,"Archived")}},{key:"ensureRootDeletedItem",value:function(){this._ensureRootItem(this._rootDeletedItem,"Deleted")}},{key:"_ensureHelper",value:function(e,t,n,r){if(e(),this[t]){var i=this[t];delete this[t];var a=this[n];P.a.beginBatch(a),i.forEach(r),P.a.commitBatch(a)}}},{key:"ensureArchivedItems",value:function(){this._ensureHelper(this.ensureRootArchivedItem,"_archivedItemsData","_rootArchivedItem",this.createArchivedVMLI)}},{key:"ensureDeletedItems",value:function(){this._ensureHelper(this.ensureRootDeletedItem,"_deletedItemsData","_rootDeletedItem",this.createDeletedVMLI)}},{key:"_createVMLI",value:function(e,t,n){t.isNote||!t.text&&!("Deleted"===n?t.deletedItems:t.archivedItems)||e.items.push(b.default.itemStoreManager.getDefaultItemStore().createItemRaw(t,{parent:e,documentOwner:this,changeType:y.a.ChangeType.Auto}))}},{key:"createArchivedVMLI",value:function(e){this._createVMLI(this._rootArchivedItem,e,"Archived")}},{key:"createDeletedVMLI",value:function(e){this._createVMLI(this._rootDeletedItem,e,"Deleted")}},{key:"_archiveDeleteHelper",value:function(e,t,n,r,i,a,o){var s=e.parent();o||s[n]()||(s.items.remove(e),r(),this[i].items.push(e));a(e,!0,t)}},{key:"archiveItem",value:function(e,t,n){this._archiveDeleteHelper(e,t,"isArchived",this.ensureRootArchivedItem,"_rootArchivedItem",this.propagateArchive,n)}},{key:"_unActionHelper",value:function(e,t,n,r,i){var a=e.parent(),o=a&&!a[n]()&&a!==r?a:this._rootItem;a&&a!==o&&a.items.indexOf(e)>=0&&a.items.remove(e),r&&r.items.remove(e),e.setParent(o),o.items.includes(e)||e.isNote()||o.items.insertSorted(e,S.a.compareItemIndex),i(e,!1,t)}},{key:"_propagateHelper",value:function(e,t,n,r,i,a){var o=this;e[r](t,n);var s=l()({id:e.id},i,t);w.a.saveItem(e,s,n,y.a.SaveFlag.All),a&&e.items.get()&&e.items.forEach((function(e){return o._propagateHelper(e,t,n,r,i,a)}))}},{key:"unArchiveItem",value:function(e,t){this._unActionHelper(e,t,"isArchived",this._rootArchivedItem,this.propagateArchive)}},{key:"propagateArchive",value:function(e,t,n){this._propagateHelper(e,t,n,"setArchived","isArchived",!0)}},{key:"deleteItem",value:function(e,t,n){this._archiveDeleteHelper(e,t,"isDeleted",this.ensureRootDeletedItem,"_rootDeletedItem",this.propagateDelete,n)}},{key:"unDeleteItem",value:function(e,t){this._unActionHelper(e,t,"isDeleted",this._rootDeletedItem,this.propagateDelete)}},{key:"propagateDelete",value:function(e,t,n){this._propagateHelper(e,t,n,"setDeleted","isDeleted",!t)}},{key:"getRootData",value:function(){return this._root}},{key:"getRootItem",value:function(){return this._rootItem}},{key:"getRootArchivedItem",value:function(){return this.ensureArchivedItems(),this._rootArchivedItem}},{key:"getRootDeletedItem",value:function(){return this.ensureDeletedItems(),this._rootDeletedItem}},{key:"getBacking",value:function(){return this._backing}},{key:"getSaveInfo",value:function(e,t){var n={id:this.id,version:1,root:this._root.id,text:this.text.get(),dateModified:this.dateModified.get()||Date.now(),isDeleted:this.isDeleted.get()};return e||(n.acl=this.acl.get()),t||(n.encryptionSentinel=this.encryptionSentinel.get()),n}},{key:"setText",value:function(e,t){var n=this.text.get();this.text.set(e,t),this._isLocalOnly&&this.getBacking().renameDocument(this,n)}},{key:"setIndex",value:function(e){this._index=e,b.default.settings.documentIndices.setProperty(this.id,e)}},{key:"onRemoteUpdate",value:function(e){e.date,void 0!==e.backups&&this.backups.set(e.backups),void 0!==e.text&&this.setText(e.text),void 0!==e.isDeleted&&(e.isDeleted&&!this.isDeleted.get()?this.delete(!0):!e.isDeleted&&this.isDeleted.get()&&this.undelete(!0)),void 0!==e.acl&&this.acl.set(_.default.clone(e.acl)),void 0!==e.encryptionSentinel&&this.encryptionSentinel.set(e.encryptionSentinel),e.itemsPlaintext&&this.processPlaintextItems(e.itemsPlaintext)}},{key:"processPlaintextItems",value:function(e){var t=this;b.default.PaneUpdateBatcher.beginUpdateItems();var n=Object.keys(e);n.forEach((function(n){e[n].id=n;var r=S.a.itemIn(e[n]);if(!w.a.getItem(n)){var i=w.a.createVMLI(r,{documentOwner:t,parent:t._rootItem,changeType:y.a.ChangeType.Local});t._rootItem.insertItem(i,0)}})),b.default.PaneUpdateBatcher.commitUpdateItems(),this._backing.deleteDocAPIItems(this,n)}},{key:"getBestEncryptionInfo",value:function(){var e=b.default.crypto.getGlobalKeyInfo();return this.encryptionSentinel.get()?e.sentinel===this.encryptionSentinel.get()?e:b.default.crypto.getKeyInfo(this.id):this.isShared()?e:b.default.crypto.getKeyInfo(b.default.settings.getBestUserEncryption())}},{key:"getBestEncryption",value:function(){return this.getBestEncryptionInfo().key}},{key:"toJSONObject",value:function(){var e=s()(a.a.mark((function e(){var t,n,r,i,o,s=arguments;return a.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=this.getBestEncryptionInfo(),t.encryptionKey=n.key,e.next=5,E.a.getItemsData(this.getRootItem(),t);case 5:if(r=e.sent,!t.exportArchived){e.next=11;break}return e.next=9,E.a.getItemsData(this.getRootArchivedItem(),t);case 9:i=e.sent,r=r.concat(i);case 11:return o={moodoVer:b.default.settings.localDataVersion.get(),doc:this.getSaveInfo(!0,!t.encrypt),items:r},t.encrypt&&(o.sentinel=n.sentinel),e.abrupt("return",o);case 14:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){var e=s()(a.a.mark((function e(t){return a.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.toJSONObject(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.stringify.call(e.t0,e.t1));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"generateExport",value:function(e,t,n){return E.a.generateExport(this.getAllItems(t),e,void 0,void 0,void 0,void 0,n)}},{key:"toHTML",value:function(e,t,n){return this.generateExport({html:!0},{includeArchived:e,includeNotes:t,noSelf:!0},n).html}},{key:"toPlaintext",value:function(e,t,n){return this.generateExport({plain:!0},{includeArchived:e,includeNotes:t,noSelf:!0},n).plain}},{key:"toOPML",value:function(e,t,n){return E.a.generateOPML(this.getAllItems({includeArchived:e,includeNotes:t,noSelf:!0}),n)}},{key:"delete",value:function(e){var t=this;this.isDeleted.set(!0),this.getBacking().deleteDocument(this,e);var n=b.default.itemStoreManager.getDefaultItemStore();n.removeItemFromRoot(this._rootItem),this.getAllItems().forEach((function(e){return n.removeItemFromStore(e.id)})),delete this._rootItem,b.default.PaneManager.runForEachPane((function(e){if(e.document.get()===t){var n=w.a.getDefaultDocument();e.setDocument(n)}}))}},{key:"undelete",value:function(e){this.isDeleted.set(!1),this.createVMLIs(),this.getBacking().undeleteDocument(this,e)}},{key:"getAllItems",value:function(e){var t=[],n=this._rootItem;return this._getAllItems(t,n,e||{}),e&&e.includeArchived&&this._getAllItems(t,this.getRootArchivedItem(),e||{}),t}},{key:"_getAllItems",value:function(e,t,n){if(t){var r=0;n&&n.noSelf||e.push(t),delete n.noSelf,n&&!1===n.includeNotes||!t.hasNote()||e.push(t.getNote());for(var i=t.items.get(),a=0;a<i.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._getAllItems(e,i[a],n)}}}},{key:"updateModified",value:function(e){var t=e>this.dateModified.get();if(t){this.dateModified.set(e);var n=b.default.settings.lastSync;(!n.get()||e>n.get())&&n.set(e)}return t}},{key:"isShared",value:function(){return Object.keys(this.acl.get()).length>1}},{key:"isAdmin",value:function(){if(this._isLocalOnly)return!0;var e=this.acl.get()[v.a.getUid()];return e&&e.r===y.a.DocumentAccessRoles.Admin}},{key:"getCollaborators",value:function(){var e=this.acl.get();return Object.keys(e).filter((function(e){return e!==v.a.getEncryptionUid()})).map((function(t){return{uid:t,name:e[t].t,email:e[t].e,role:e[t].r}}))}},{key:"shareWithUser",value:function(e,t){return D.a.shareDocument({docID:this.id,docName:this.text.get(),encryptionSentinel:this.encryptionSentinel.get(),emails:e,accessRole:t})}},{key:"onAclUpdate",value:function(e){var t=_.default.clone(this.acl.get());if(Object.keys(e).forEach((function(n){e[n]?t[n]=e[n]:delete t[n]})),!_.default.deepEqual(t,this.acl.get()))return this.acl.set(t),!0}},{key:"canDecrypt",value:function(){var e=this.encryptionSentinel.get();return this.isDecrypted=!e||b.default.crypto.canDecryptSentinel(e),this.isDecrypted}},{key:"addBackup",value:function(e){this.backups.get()?this.backups.get()[e]="":this.backups.set(l()({},e,""))}},{key:"getLastBackup",value:function(){var e=this.backups.get();if(e){var t=Object.keys(e).sort();return+t[t.length-1]}return 0}},{key:"getLastBackupDrive",value:function(){var e=b.default.settings.backupsDrive.get();return e&&e[this.id]||0}},{key:"isLocalOnly",value:function(){return this._isLocalOnly}},{key:"parseAll",value:function(e){_.default.parseSubtree(this.getRootItem(),e)}},{key:"index",get:function(){return this._index}}],[{key:"create",value:function(t){var n=t.id,r=t.text,i=t.rootData,a=t.backing;return new e({id:n||w.a.generateID(),rootData:i,text:r,acl:l()({},v.a.getUid(),{r:y.a.DocumentAccessRoles.Admin,e:v.a.getAccountEmail(),t:v.a.getAccountName()}),dateModified:Date.now(),backing:a||k.a,encryptionSentinel:void 0})}},{key:"fromData",value:function(t,n){var r={};return Object.keys(t.acl).forEach((function(e){var n=t.acl[e];r[e]=_.default.isNumber(n)?{r:n,t:v.a.getAccountName(),e:v.a.getAccountEmail()}:n})),new e({id:t.id,rootData:t.rootData,text:t.text,acl:r,dateModified:t.dateModified,backing:n,encryptionSentinel:t.encryptionSentinel,isDeleted:t.isDeleted})}}]),e}(),g()(r.prototype,"ensureRootArchivedItem",[m.a],Object.getOwnPropertyDescriptor(r.prototype,"ensureRootArchivedItem"),r.prototype),g()(r.prototype,"ensureRootDeletedItem",[m.a],Object.getOwnPropertyDescriptor(r.prototype,"ensureRootDeletedItem"),r.prototype),g()(r.prototype,"createArchivedVMLI",[m.a],Object.getOwnPropertyDescriptor(r.prototype,"createArchivedVMLI"),r.prototype),g()(r.prototype,"createDeletedVMLI",[m.a],Object.getOwnPropertyDescriptor(r.prototype,"createDeletedVMLI"),r.prototype),g()(r.prototype,"propagateArchive",[m.a],Object.getOwnPropertyDescriptor(r.prototype,"propagateArchive"),r.prototype),g()(r.prototype,"propagateDelete",[m.a],Object.getOwnPropertyDescriptor(r.prototype,"propagateDelete"),r.prototype),r);t.a=T},function(e,t,n){"use strict";var r,i,a=n(41),o=n.n(a),s=n(3),u=n.n(s),l=n(10),c=n.n(l),d=n(5),h=n.n(d),f=n(6),p=n.n(f),g=n(18),v=n.n(g),m=n(19),y=n.n(m),_=n(11),b=n.n(_),w=n(7),k=n.n(w),S=n(36),E=n(27),P=n(8),I=n(1),D=n(20),T=n(35),x=n(0),C=n(2),A=n(21),L=n(40),O=n(51),M=n(16),R=n(86),F=n(79),N=n(66),j=n(25),U=n(69),B=n(13),V=(r=function(){function e(t){var n=t.path,r=t.orderBy,i=t.startAt,a=t.extraModifiedPath,o=t.encryptedFields;h()(this,e),this.path=n,this.session=T.a.database(),this.orderBy=r,this.startAt=i,this.extraModifiedPath=a,this.encryptedFields=o,this.updatesSent={},this.reqNum=0,this._batch=[]}return p()(e,[{key:"_getUpdateVals",value:function(e){var t=this;var n={},r=Object.assign({},e);return delete r.id,x.default.isObject(r)?Object.keys(r).forEach((function(i){n["".concat(t.path,"/").concat(e.id,"/").concat(i)]=r[i]})):n["".concat(this.path,"/").concat(e.id)]=r,this.extraModifiedPath&&(n[this.extraModifiedPath]=T.a.database.ServerValue.TIMESTAMP),n}},{key:"update",value:function(){var e=c()(u.a.mark((function e(t,n){var r,i,a=this;return u.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(r=this._getUpdateVals(t),!n){e.next=5;break}return e.abrupt("return",new Promise((function(e){a._batch.push({item:t,resolve:e}),x.default.timeoutOnce("FirebasePathUpdate_"+a.path,a._runUpdates,200)})));case 5:return i=this.setSent(t.id,r),e.prev=6,e.next=9,this.session.ref().update(r);case 9:delete this.updatesSent[t.id][i],e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),x.default.reportError(e.t0);case 15:return e.abrupt("return",x.default.isEmpty(this.updatesSent[t.id]));case 16:case"end":return e.stop()}}}),e,this,[[6,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_runUpdates",value:function(){var e=c()(u.a.mark((function e(){var t,n,r,i,a,o,s,l,c=0,d=this;return u.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:t=this._batch,n={},r=0;case 3:if(!(r<t.length)){e.next=13;break}if(!(c++>5e3&&__infLoop&&__infLoop(c))){e.next=6;break}throw new RangeError;case 6:i=t[r],a=i.item,o=i.remove,s=void 0,o?(n["".concat(this.path,"/").concat(a.id)]=null,s=this.setSent(a.id,{type:I.a.CrudActions.Removed,id:a})):(l=this._getUpdateVals(a),Object.assign(n,l),s=this.setSent(a.id,l)),t[r].sent=s;case 10:r++,e.next=3;break;case 13:return this._batch=[],e.prev=14,e.next=17,this.session.ref().update(n);case 17:(function(){for(var e=0,n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t[r],a=i.item,o=i.sent,s=i.resolve,u=a.id;delete d.updatesSent[u][o],s(x.default.isEmpty(d.updatesSent[u]))}})(),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),x.default.reportError(e.t0);case 24:case"end":return e.stop()}}}),e,this,[[14,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"getPathForItem",value:function(e){return"".concat(this.path,"/").concat(e.id,"/")}},{key:"remove",value:function(e,t){var n=this;if(t)return new Promise((function(t){n._batch.push({item:e,remove:!0,resolve:t}),x.default.timeoutOnce("FirebasePathUpdate_"+n.path,n._runUpdates,200)}));var r=this.setSent(e.id,{type:I.a.CrudActions.Removed,id:e});return this.session.ref("".concat(this.path,"/").concat(e.id)).remove().then((function(){return delete n.updatesSent[e.id][r],x.default.isEmpty(n.updatesSent[e.id])}))}},{key:"toChangeInternal",value:function(e,t,n){return t.id=e,{type:n,value:t}}},{key:"isChangeRemote",value:function(e){var t=e.key,n=(e.val(),this.updatesSent[t]);return!(n&&!x.default.isEmpty(n))}},{key:"onUpdate",value:function(e){var t=this;this.cbOnUpdate=e;var n=!1,r=this.session.ref(this.path);this.orderBy&&this.startAt&&(r=r.orderByChild(this.orderBy).startAt(this.startAt)),r.on("value",(function(r){if(!n){n=!0;var i=r.val(),a=Object.keys(i||{}).map((function(e){return t.toChangeInternal(e,i[e],"load")}));e(a,!0)}}),(function(e){console.log("Firebase error",e)})),r.on("child_added",(function(r){if(n){var i=[t.toChangeInternal(r.key,r.val(),"Added")];e(i,t.isChangeRemote(r))}}),(function(e){console.log("Firebase error",e)})),r.on("child_changed",(function(r){if(n){var i=[t.toChangeInternal(r.key,r.val(),"Modified")];e(i,t.isChangeRemote(r))}}),(function(e){console.log("Firebase error",e)})),r.on("child_removed",(function(r){if(n){var i=[t.toChangeInternal(r.key,r.val(),"Removed")];e(i,t.isChangeRemote(r))}}),(function(e){console.log("Firebase error",e)}))}},{key:"setSent",value:function(e,t){var n=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][n]=t,n}}]),e}(),k()(r.prototype,"_runUpdates",[P.a],Object.getOwnPropertyDescriptor(r.prototype,"_runUpdates"),r.prototype),r),H=new(i=function(){function e(){h()(this,e)}return p()(e,[{key:"init",value:function(){return this.session||(this.database=this.session=T.a.database()),this.serverTime=T.a.database.ServerValue.TIMESTAMP,this}},{key:"create",value:function(e){return new V(e)}},{key:"onOnlineChange",value:function(e){this.session.ref(".info/connected").on("value",(function(t){e(!0===t.val())}))}},{key:"generateId",value:function(){return T.a.database().ref().push().key}}]),e}(),k()(i.prototype,"onOnlineChange",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"onOnlineChange"),i.prototype),k()(i.prototype,"generateId",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"generateId"),i.prototype),i),W=n(33),q=n.n(W),z=n(39),G=n.n(z),K=function(){function e(t,n,r){h()(this,e),this.dateModifieds=n,this.path=t,this.session=T.a.database(),this.dataCache={},this.isLoaded=!1,this.isLoadedSubpath={},this.ignoreLocalChange=!1,this.cbsOnUpdate={},this.updatesSent={},this.reqNum=0,this.encryptedFields=r}return p()(e,[{key:"toChangeInternal",value:function(e,t,n){var r=e.ref.path.slice(2),i=e.val(),a={},o=this.dataCache,s="Removed"===t;if("object"===G()(i)){0;var u=r.slice(1),l={},c=l;u.forEach((function(e,t){t===u.length-1?c[e]=i:(c[e]={},c=c[e])})),a=l,r.forEach((function(e,n){n===r.length-1?"Removed"===t?delete o[e]:o[e]!==i&&(s=!0,o[e]=i):(o[e]||(o[e]={}),o=o[e])}))}else{var d=e.key;o[n]||(o[n]={}),o=o[n],"Removed"!==t?o[d]!==i&&(s=!0,o[d]=i):o&&delete o[d],a[d]=i}if(s)return{type:t,value:a}}},{key:"set",value:function(){var e=c()(u.a.mark((function e(t,n){var r,i,a,o,s,l,c,d=0;return u.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:r=t.split("/"),i=this.dataCache,a=r[r.length-1],o="".concat(this.path,"/").concat(t),s=0;case 3:if(!(s<r.length-1)){e.next=16;break}if(!(d++>5e3&&__infLoop&&__infLoop(d))){e.next=6;break}throw new RangeError;case 6:if(i){e.next=8;break}return e.abrupt("return",Promise.resolve(!1));case 8:if(r[s]){e.next=11;break}return e.abrupt("continue",13);case 11:i[r[s]]||(i[r[s]]={}),i=i[r[s]];case 13:s++,e.next=3;break;case 16:return i[a]=n,l=this.session.ref(o),c=this.setSent(t,n),e.prev=20,e.next=23,l.update(n);case 23:return delete this.updatesSent[t][c],e.abrupt("return",x.default.isEmpty(this.updatesSent[t]));case 27:e.prev=27,e.t0=e.catch(20),x.default.reportError(e.t0);case 30:return e.abrupt("return",!1);case 31:case"end":return e.stop()}}}),e,this,[[20,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=c()(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return n=this.setSent(t,{type:I.a.CrudActions.Removed,id:t}),e.prev=1,e.next=4,this.session.ref("".concat(this.path,"/").concat(t)).remove();case 4:return delete this.updatesSent[t][n],e.abrupt("return",x.default.isEmpty(this.updatesSent[t]));case 8:e.prev=8,e.t0=e.catch(1),x.default.reportError(e.t0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isChangeRemote",value:function(e){var t=this.updatesSent[e];return!(t&&!x.default.isEmpty(t))}},{key:"sendChangeCB",value:function(e,t,n){var r=e.ref.path;x.default.isString(r)&&(r=r.split("/"));var i=r.slice(2).join("/"),a=this.isChangeRemote(i);a&&n(t,a)}},{key:"onLoad",value:function(e,t){var n=this;this.session.ref(this.path).on("value",(function(t){if(!n.isLoaded){n.isLoaded=!0;var r=t.val()||{};n.dataCache=r,e(r)}}),(function(e){x.default.log("Firebase error",e),t?t(e):x.default.reportError(e,"Missing cbError handler: "+n.path)}))}},{key:"onLoadSubpath",value:function(e,t){var n=this,r=this.path+"/"+e;this.isLoadedSubpath[e]=!1;var i=this.session.ref(r);if(this.dateModifieds[e]){var a=this.dateModifieds[e];i=i.orderByChild("d").startAt(a)}i.on("value",(function(r){if(!n.isLoadedSubpath[e]){n.isLoadedSubpath[e]=!0,n.isLoaded=!0;var i=r.val()||{};n.dataCache[e]=i,t(i)}}),(function(e){x.default.log("Firebase error",e),x.default.reportError(e,"Missing cbError handler: "+n.path)}))}},{key:"onUpdate",value:function(e,t,n){var r=this;this.cbsOnUpdate[e]=t;var i=this.path+"/"+e,a=this.session.ref(i);if(this.dateModifieds[e]){var o=this.dateModifieds[e];a=a.orderByChild("d").startAt(o)}a.on("child_added",(function(n){if(r.isLoaded&&!1!==r.isLoadedSubpath[e]){var i=r.toChangeInternal(n,"Added",e);i&&r.sendChangeCB(n,i,t)}}),(function(e){console.log("Firebase error",e),n&&n(e)})),a.on("child_changed",(function(n){if(r.isLoaded&&!1!==r.isLoadedSubpath[e]){var i=r.toChangeInternal(n,"Modified",e);i&&r.sendChangeCB(n,i,t)}}),(function(e){console.log("Firebase error",e),n&&n(e)})),a.on("child_removed",(function(n){if(r.isLoaded&&!1!==r.isLoadedSubpath[e]){var i=r.toChangeInternal(n,"Removed",e);i&&r.sendChangeCB(n,i,t)}}),(function(e){console.log("Firebase error",e),n&&n(e)}))}},{key:"offUpdate",value:function(e,t){var n=this.path+"/"+e;this.session.ref(n).off("child_added",t),this.session.ref(n).off("child_changed",t),this.session.ref(n).off("child_removed",t)}},{key:"setSent",value:function(e,t){var n=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][n]=t,n}}]),e}(),Y={a:"AuthToken",b:"Board",p:"Property",s:"Setting",l:"Plugin"},Q=function(){function e(t,n){var r=this;h()(this,e),this.dateModifieds=n,this.uid=t,this.session=T.a.database(),this.treeApi=new K("users/".concat(t),n,{"s/aE/v":!0}),Object.keys(Y).forEach((function(e){var t=Y[e];r["on"+t+"Update"]=r.treeApi.onUpdate.bind(r.treeApi,e),r["set"+t]=function(t,n){return r.treeApi.set(e+"/"+t,n)},r["remove"+t]=function(t){return r.treeApi.remove(e+"/"+t)}}))}return p()(e,[{key:"onLoad",value:function(){var e=c()(u.a.mark((function e(t){var n,r,i=this;return u.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return n={},e.next=3,Promise.all(Object.keys(Y).map((function(e){return new Promise((function(t){return i.treeApi.onLoadSubpath(e,(function(r){n[e]=r,t()}))}))})));case 3:r={properties:n.p,settings:n.s,authTokens:n.a,boards:n.b,plugins:n.l},t(r);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPathForSettings",value:function(){return"users/".concat(this.uid,"/s/")}},{key:"deleteFully",value:function(){var e,t=(e={},q()(e,"/users/".concat(this.uid,"/a"),null),q()(e,"/users/".concat(this.uid,"/b"),null),q()(e,"/users/".concat(this.uid,"/s"),null),q()(e,"/users/".concat(this.uid,"/l"),null),e);return this.session.ref().update(t)}}]),e}();var X=function(e,t,n){return Object.assign(n,q()({},e,t))},$={identity:function(e){return e},true:function(e){return!0},index:function(e,t){return t}},J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$.identity,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$.true,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return X(e(r,i),t(r,i),n)},Z=function(e,t,n){return J(void 0,void 0,e,t,n)},ee=function(e,t){var n={id:e.id},r=function(r){void 0===t[r]?n[r]=null:e[r]!==t[r]&&(n[r]=t[r])};return Object.keys(e).forEach(r),Object.keys(t).forEach(r),n},te=function(e,t,n){return"Removed"===e||"Added"===e?{type:e,value:n}:{type:e,value:t?ee(t,n):n}},ne=function(e,t){return{type:t,value:e}},re=function(e,t){return function(t){return[t].map((n=e,function(e){return te(e.type,n[e.value.id],e.value)}))[0];var n}},ie=function(e,t){var n,r=t.value;return e=(n="id",function(e,t,r){return J(function(e){return function(t){return function(e,t){return t?t[e]:void 0}(e,t)}}(n),$.identity,e,t,r)})(e,r),"Removed"===t.type&&delete e[r.id],e},ae=function(e){return e.changes.map((function(e){return e.value}))},oe=function(e){var t=e.changes,n=e.prevStore;return t.map(re(n))},se=function(e){return e._store={},e},ue=function(e){var t=e.changes,n=(e.type,e.prevStore,e.api);return n._store=t.reduce(ie,n._store),n},le=function(e){var t=e.item,n=e.api,r=e.changeType,i=Object.assign({},n._store),a=ne(t,r);ue({changes:[a],prevStore:i,api:n})},ce=function(e){return function(t,n){return le({item:n,api:t,changeType:e})}},de={load:function(e){var t=e.changes,n=e.api,r=e.prevStore;return ue({api:n,type:"update",changes:t,prevStore:r})},normalizeChanges:oe,addItem:ce("Added"),removeItem:ce("Removed"),modifyItem:ce("Modified")},he={load:function(e){var t=e.changes,n=e.api,r=e.prevStore;return ue({changes:t,api:se(n),prevStore:r})},normalizeChanges:ae},fe=n(59),pe=n.n(fe);function ge(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ve(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ve(e,t){var n=0;(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i[r]=e[r]}return i}var me,ye,_e=function(e,t,n){return e.push(t),n},be=function(e,t,n){var r=e.indexOf(t);return r>-1&&e.splice(r,1),n},we=function(e,t,n){var r,i=ge(e);try{var a=0,o=function(){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var e=r.value;setTimeout((function(){return e.apply(void 0,pe()(t))}),0)};for(i.s();!(r=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}return n},ke=function(e){return function(t,n){return function(e,t,n){var r=Object.assign({},n._store),i=n._loadingState,a="load"===i?n._loader:n._updater,o="load"===i;if(o||(e=e.filter((function(e){var t=e.value;return"Removed"===e.type||!r[t.id]||t.d!==r[t.id].d}))),o&&(n._loadingState="update","load"===i&&n._earlyEdits.length&&(n._earlyEdits.forEach((function(e){we(n._callbacks.update,[e])})),n._earlyEdits=[])),"update"===n._loadingState){if(o||e.length>0){n=a.load({api:n,changes:e,prevStore:r});var s=a.normalizeChanges({api:n,changes:e,prevStore:r});we(n._callbacks[i],[{responses:s},t]),we(n._callbacks["".concat(i,"Debug")],[{responses:s,changes:e,api:n},t])}}else n._earlyEdits.push({changes:e,api:n});return n}(t,n,e)}},Se=function(e){var t=e.id,n=e.store;return n[t]?Object.assign({},n[t]):void 0},Ee=[],Pe=function(e){var t=e.db,n=e.config,r=e.ignore,i=void 0===r?Ee:r,a=e.backend,o=e.path,s=e.orderBy,u=e.startAt,l=e.extraModifiedPath,c=e.encryptedFields,d={_config:n,_database:t,_store:{},_callbacks:{update:[],load:[],updateDebug:[],loadDebug:[]},_ignore:i.reduce(Z,{}),_loadingState:"load",_earlyEdits:[],_backend:a.create({db:t,path:o,orderBy:s,startAt:u,extraModifiedPath:l,encryptedFields:c}),_loader:he,_updater:de};return d._backend.onUpdate(ke(d)),d.get=function(e){return Se({id:e,store:d._store})},d.getFromRemote=function(e){return d._backend.getFromRemote(e)},d.update=function(e,t){return function(e,t){var n,r=e.item,i=e.backend,a=e.api,o=(n=a._ignore,function(e){return function(e,t){if(!e)return e;var n={};for(var r in e)r in t||(n[r]=e[r]);return n}(e,n)})(r);return a._updater.modifyItem(a,o),i.update(o,t)}({item:e,backend:d._backend,api:d},t)},d.getPathForItem=function(e){return function(e){var t=e.item;return e.backend.getPathForItem(t)}({item:e,backend:d._backend,api:d})},d.remove=function(e,t){return function(e,t){var n=e.item,r=e.backend,i=e.api;return i._updater.removeItem(i,n),console.log("remove",n),r.remove(n,t)}({item:e,backend:d._backend,api:d},t)},d.onLoad=function(e){return _e(d._callbacks.load,e)},d.offLoad=function(e){return be(d._callbacks.load,e)},d.onUpdate=function(e){return _e(d._callbacks.update,e)},d.offUpdate=function(e){return be(d._callbacks.update,e)},d.onLoadDebug=function(e){return _e(d._callbacks.loadDebug,e)},d.offLoadDebug=function(e){return be(d._callbacks.loadDebug,e)},d.onUpdateDebug=function(e){return _e(d._callbacks.updateDebug,e)},d.offUpdateDebug=function(e){return be(d._callbacks.updateDebug,e)},d.setSent=function(e,t){return d._backend.setSent(e,t)},d},Ie=(me=function(){function e(t,n,r){h()(this,e),this.docID=t,this.uid=n,this.userDocuments=r,this.treeApi=new K("documents/".concat(t),{},{"p/s":!0}),this.cbs=[],this.cbsAcl=[]}return p()(e,[{key:"onLoad",value:function(e,t){this.treeApi.onLoad((function(t){e(t)}),t)}},{key:"onUpdate",value:function(e,t){this.cbs.push(e),this.treeApi.onUpdate("p",e,t)}},{key:"offUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("p",e)}},{key:"onAclUpdate",value:function(e,t){this.cbsAcl.push(e),this.treeApi.onUpdate("a",e,t)}},{key:"offAclUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("p",e)}},{key:"onAPIItemsUpdate",value:function(e,t){this.cbs.push(e),this.treeApi.onUpdate("z",e,t)}},{key:"offAPIItemsUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("z",e)}},{key:"deleteAPIItems",value:function(e,t){var n={};return t.forEach((function(t){return n["/documents/".concat(e,"/z/").concat(t)]=null})),H.database.ref().update(n)}},{key:"create",value:function(e,t){var n,r=Object.assign({},e),i={t:r.p.t};r.p.d&&(i.d=r.p.d),delete r.id;var a=(n={},q()(n,"/documents/".concat(this.docID),r),q()(n,"/userdocuments/".concat(this.uid,"/").concat(this.docID),i),n);if(t)for(var o=0,s=0;s<t.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=t[s],l=u.id;delete u.id,a["/items/".concat(this.docID,"/").concat(l)]=u}return this.userDocuments.setSent(this.docID,i),H.database.ref().update(a)}},{key:"unlisten",value:function(){this.cbs.forEach(this.offUpdate),H.database.ref("/items/".concat(this.docID)).off(),H.database.ref("/userdocuments/".concat(this.uid,"/").concat(this.docID)).off(),H.database.ref("/documents/".concat(this.docID,"/a")).off(),H.database.ref("/documents/".concat(this.docID)).off()}},{key:"deleteFully",value:function(){var e;this.unlisten();var t=(e={},q()(e,"/items/".concat(this.docID),null),q()(e,"/userdocuments/".concat(this.uid,"/").concat(this.docID),null),q()(e,"/documents/".concat(this.docID),null),e);return H.database.ref().update(t)}},{key:"update",value:function(e,t){var n=Object.assign({},e);delete n.id;var r={};t?r["/documents/".concat(this.docID,"/p")]=n.p:r["/documents/".concat(this.docID)]=n,n.p.d&&(r["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/d")]=n.p.d),n.p.t&&(r["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/t")]=n.p.t),H.database.ref().update(r)}},{key:"addBackup",value:function(e){H.database.ref("/documents/".concat(this.docID,"/c")).update(q()({},e,""))}}]),e}(),k()(me.prototype,"offUpdate",[P.a],Object.getOwnPropertyDescriptor(me.prototype,"offUpdate"),me.prototype),k()(me.prototype,"offAclUpdate",[P.a],Object.getOwnPropertyDescriptor(me.prototype,"offAclUpdate"),me.prototype),k()(me.prototype,"offAPIItemsUpdate",[P.a],Object.getOwnPropertyDescriptor(me.prototype,"offAPIItemsUpdate"),me.prototype),me),De=function(){function e(t,n){h()(this,e),this.uid=t,this.docs={},this.documentsWaiting={},this.db={firebase:T.a,session:T.a.database()},H.init(),this.onOnlineChange=H.onOnlineChange,this.serverTime=H.serverTime,this.generateId=H.generateId,this.user=new Q(t,n),this.userDocuments=Pe({db:this.db,backend:H,path:"userdocuments/".concat(t),encryptedFields:{s:!0}})}return p()(e,[{key:"loadDocuments",value:function(e){this.userDocuments.onLoad((function(t){var n=t.responses;e(n)}))}},{key:"onDocumentsUpdate",value:function(e){this.userDocuments.onUpdate(e)}},{key:"createDocumentAPI",value:function(e,t,n){var r=this;if(!(e in this.docs)){try{x.default.PAssert(942,!t||!isNaN(t)&&t<Date.now(),"Date modified is not number: "+t)}catch(s){x.default.reportError(s)}var i,a=n||new Ie(e,this.uid,this.userDocuments),o=t&&!isNaN(t)?t+1:void 0;this.docs[e]={info:a,items:function(){return i||(i=Pe({db:r.db,backend:H,path:"items/".concat(e),orderBy:"d",startAt:o,extraModifiedPath:"documents/".concat(e,"/p/d"),encryptedFields:{t:!0}})),i}}}return this.docs[e]}},{key:"getDocumentAPI",value:function(){var e=c()(u.a.mark((function e(t){var n,r=this;return u.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.docs[t]){e.next=4;break}return e.abrupt("return",this.docs[t]);case 4:return this.documentsWaiting[t]||(this.documentsWaiting[t]=[]),n=new Promise((function(e){r.documentsWaiting[t].push(e)})),e.abrupt("return",n);case 7:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onDocumentAPILoaded",value:function(){var e=this;Object.keys(this.documentsWaiting).forEach((function(t){var n=e.documentsWaiting[t];n&&n.forEach((function(n){return n(e.docs[t])}))}))}},{key:"addDocument",value:function(e,t){var n=this,r=e.id,i=this.docs[r];if(!i){var a=new Ie(r,this.uid,this.userDocuments);return a.create(e,t).then((function(){return n.createDocumentAPI(r,void 0,a)}))}return Promise.resolve(i)}},{key:"forgetDocument",value:function(e){this.docs[e];return delete this.docs[e],!0}},{key:"commitBatch",value:function(e){return this.db.session.ref().update(e)}}]),e}(),Te=n(46),xe=n(64);function Ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var Ae=(ye=function(e){v()(n,e);var t=Ce(n);function n(){var e;return h()(this,n),(e=t.call(this,!1)).documentsEncrypted={},e.documentsDeleted={},e._isLoaded=!1,e.loadState=new B.a(I.a.LoadState.Connecting),e}return p()(n,[{key:"init",value:function(e,t){if(this._seenLocal={},this._coalescedChanges={},this._itemsChangedQueue=[],this._isLoaded=!1,this.cbOnLoad=e,this.cbOnDocumentsChanged=t,this.savedDocInfo={},D.a.init(this,this.onLoadLocal),A.a.hasURLParam("invite")){var n=A.a.getURLParam("invite");S.a.onAuthed(c()(u.a.mark((function e(){return u.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,O.a.acceptInvite(n);case 2:e.sent.error||A.a.removeURLParam("invite");case 4:case"end":return e.stop()}}}),e)}))))}}},{key:"onLoadLocal",value:function(e,t){var n=this,r=t.documentsPending,i=t.itemsPending,a=t.settingsPending,o=t.boardsPending,s=t.isPreload;e||(e=[]),e.forEach((function(e){return n.documents[e.id]=e})),this.documentsPending=r,this.itemsPending=i,this.settingsPending=a,this.boardsPending=o,this.cbOnLoad&&this.cbOnLoad(e),s||(this.cbOnLoad=void 0,C.default.settings.userId.onHasValue((function(){n.createStore()})))}},{key:"notifyDocumentsChanged",value:function(){this.cbOnDocumentsChanged({documents:this.documents,documentsEncrypted:this.documentsEncrypted,documentsDeleted:this.documentsDeleted})}},{key:"onLoadRemoteDocuments",value:function(){this._isLoaded=!0,this.notifyDocumentsChanged(),C.default.PaneManager.loadInitialState(),L.a.ensureSelected(),C.default.settings.lastSync.set(Date.now()),this.api.onDocumentAPILoaded()}},{key:"createStore",value:function(){var e=this,t=0,n=D.a.getAllPluginsNew();n&&(t=x.default.max(Object.keys(n).map((function(e){return n[e].dateModified+1}))));var r,i,a=new De(S.a.getUid(),{l:t});this.api=a;var o=function(){var t=c()(u.a.mark((function t(){return u.a.wrap((function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return C.default.settings.lastSync.get()||M.a.setLoadProgress("Downloading and decrypting documents..."),Object.keys(e.documents).forEach((function(t){!e.documentsPending[t]&&i.indexOfWithProperty("id",t)<0&&(e.documentsPending[t]=!0)})),t.prev=2,t.next=5,Promise.all(Object.keys(e.documentsPending).map((function(t){var n=e.documents[t];if(n&&!n.isDeleted.get()&&(!i||i.indexOfWithProperty("id",n.id)<0))return e.addDocument(n,!1)})));case 5:return e.documentsPending={},D.a.beginBatch(),t.next=9,Promise.all(i.map((function(t){return e.loadDocumentData(j.a.documentInFlat(t))})));case 9:M.a.setLoadProgress(void 0),e.onLoadRemoteDocuments(),e.loadState.set(I.a.LoadState.Connected),D.a.commitBatch(),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),x.default.reportError(t.t0);case 18:case"end":return t.stop()}}}),t,null,[[2,15]])})));return function(){return t.apply(this,arguments)}}(),s=function(){r&&i&&o()};a.user.onLoad((function(t){var n=C.default.settings.getSettingAbbrev("userEncryptionSentinel"),i=t.settings,o=!1;t.properties?(e.userProperties=j.a.userIn(t.properties),C.default.billingManager.loadUserProperties(e.userProperties)):(o=!0,C.default.billingManager.loadUserProperties({})),t.boards&&!x.default.isEmpty(t.boards)||(o=!0),o&&e.onFirstSync(t),e.checkUserEncryption(i&&i[n]&&i[n].v,(function(){C.default.settings.lastSync.get()||M.a.setLoadProgress("Downloading documents..."),e.loadState.set(I.a.LoadState.LoadingDocs),i&&e.onSettingsChange("Modified",i,!0,!0),e.settingsPending&&Object.keys(e.settingsPending).forEach((function(t){var n=C.default.settings.getSettingInfoFromAbbrev(t),r=C.default.settings.getRemoteSaveValue(n.key,C.default.crypto.getKeyInfo(C.default.settings.getBestUserEncryption()));void 0!==r&&e._setSettingRemote(t,r)}));var n=t.boards;n&&e.onBoardsChange("Modified",n,!0),e.boardsPending&&Object.keys(e.boardsPending).forEach((function(t){var n=L.a.getById(t);try{x.default.PAssert(405,n,"Pending board that does not exist")}catch(r){x.default.reportError(r)}n&&e._saveBoardRemote(n.getSaveInfo())})),xe.a.initWithAPI(a,t.plugins),r=!0;var o=t.authTokens;e.onAuthTokensChange("Added",o,!0),s(),setTimeout((function(){C.default.settings.userEncryptionSentinel.listen((function(t){t?e.checkUserEncryption(t):C.default.settings.removeEncryptionKey(I.a.EncryptionKeys.UserPassword)}))}),0)}))})),a.user.onPropertyUpdate((function(e,t){var n=e.type,r=e.value;if(t){"Removed"===n&&Object.keys(r).forEach((function(e){return r[e]=null}));var i=j.a.userIn(r);C.default.billingManager.loadUserProperties(i)}})),a.user.onSettingUpdate((function(t,n){var r=t.type,i=t.value;e.onSettingsChange(r,i,n,!1)})),a.user.onBoardUpdate((function(t,n){var r=t.type,i=t.value;e.onBoardsChange(r,i,n)})),a.user.onAuthTokenUpdate((function(t,n){var r=t.type,i=t.value;e.onAuthTokensChange(r,i,n)})),a.loadDocuments((function(e){i=e,s()})),a.onDocumentsUpdate((function(t,n){var r=t.responses;D.a.beginBatch(),Promise.all(r.map((function(t){var n=t.type,r=t.value;if("Removed"!==n)return e.loadDocumentData(j.a.documentInFlat(r));e.documents[r.id]&&(e.documents[r.id].delete(!0),delete e.documents[r.id])}))).then((function(){D.a.commitBatch(),e.notifyDocumentsChanged()})).catch((function(e){return x.default.reportError(e)}))})),a.onOnlineChange((function(t){e.updateOnlineStatus(t)})),this._isLoaded||(this._isLoaded=!0),this._runCoalescedChanges()}},{key:"onFirstSync",value:function(){var e=c()(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:!(n=S.a.getGoogleProvider())||C.default.settings.syncAccounts.get()&&!x.default.isEmpty(C.default.settings.syncAccounts.get())||C.default.settings.syncAccounts.setProperty(n.email,{}),t.boards&&!x.default.isEmpty(t.boards)||L.a.createDefaultState(),C.default.intro.showHelp(),C.default.billingManager.setJoinDate(Date.now());case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadSingleDocument",value:function(){var e=c()(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadDocumentData(t,n);case 3:return r=e.sent,this.notifyDocumentsChanged(),e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(0),x.default.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadDocumentData",value:function(){var e=c()(u.a.mark((function e(t,n){var r,i,a,o,s,l,d,h,f,p,g=this;return u.a.wrap((function(e){for(var v=0;;){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;switch(e.prev=e.next){case 0:if(!(i=this.documents[t.id])){e.next=6;break}r=i.dateModified.get(),e.next=9;break;case 6:if(!t.encryptionSentinel||C.default.crypto.canDecryptSentinel(t.encryptionSentinel)){e.next=9;break}return this.documentsEncrypted[t.id]=t,e.abrupt("return",void 0);case 9:return e.prev=9,a=this.api.createDocumentAPI(t.id,r),e.next=13,new Promise((function(e){c()(u.a.mark((function r(){var o,s,l,c;return u.a.wrap((function(r){for(var u=0,d=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(r.prev=r.next){case 0:if(!g.savedDocInfo[t.id]){r.next=5;break}Object.assign(g.savedDocInfo[t.id].docProps,t),e(g.savedDocInfo[t.id]),r.next=15;break;case 5:if(s=a.info,!n){r.next=10;break}r.t0=t,r.next=13;break;case 10:return r.next=12,new Promise((function(e){s.onLoad((function(n){n.id=t.id;var r=j.a.documentIn(n);e(r)}),(function(t){e(null)}))}));case 12:r.t0=r.sent;case 13:l=r.t0,!n&&l.isDeleted?(g.documentsDeleted[t.id]={info:l,api:a},e(void 0)):(s.onUpdate(g.onDocInfoChange.bind(g,t),x.default.reportError),s.onAclUpdate(g.onDocAclChange.bind(g,t),x.default.reportError),s.onAPIItemsUpdate(g.onDocAPIItemsChange.bind(g,i),x.default.reportError),(c=a.items()).onLoad((function(n){var r=n.responses;if(o=r,null===l)e(void 0);else if(l&&o){var i={docProps:l,docItemsEncrypted:o};g.savedDocInfo[t.id]=i,e(i)}})),c.onUpdate(g.onItemsChange.bind(g,t)));case 15:case"end":return r.stop()}}}),r)})))()}));case 13:if(!(o=e.sent)){e.next=33;break}if(s=o.docProps,l=o.docItemsEncrypted,d=this.getEncryptionForDocument(s)){e.next=21;break}return t.encryptionSentinel=s.encryptionSentinel,this.documentsEncrypted[t.id]=t,e.abrupt("return",Promise.resolve(void 0));case 21:return h=r||0,e.next=24,Promise.all(l.map((function(e){return g.decryptItemIn(e,C.default.crypto,d)}))).then((function(e){return e.forEach((function(e){e.docId=s.id,h=Math.max(h,e.dateModified)})),N.a.createItemHierarchy(e,D.a.getItemsMap()),i&&e.length>0&&g.resolveItemConflicts(i,e),e}));case 24:return f=e.sent,i&&Object.keys(this.itemsPending).forEach((function(e){var t=D.a.getItemData(e),n=M.a.getItem(e),r=g.itemsPending[e];if(t&&t.docId===i.id){try{x.default.PAssert(406,n||t.isArchived||t.isDeleted,"Pending update that has no parent")}catch(s){x.default.reportError(s)}if(n||t.isArchived||t.isDeleted){var a=Object.keys(r);if(a.length>0){var o={id:e};a.forEach((function(e){o[e]=t[e]})),g._saveItemRemote(i,o,n)}}}})),f.length>0&&D.a.ensureMirror(f,!0,!1),s.dateModified=h,i?this.documentsPending[i.id]?(this._saveDocumentRemote(i),delete this.documentsPending[i.id]):i.onRemoteUpdate(s):s.root&&((p=x.default.clone(s)).backing=this,p.rootData=this.getItemData(s.root),p.rootData&&(delete p.pendingSync,(i=U.a.fromData(p,this)).createVMLIs())),i&&(this.documents[i.id]=i,delete this.documentsEncrypted[i.id],delete this.documentsDeleted[i.id],D.a.saveDocument(i)),i||console.log("Failed to find root item"),e.abrupt("return",i);case 33:e.next=40;break;case 35:e.prev=35,e.t0=e.catch(9),console.log(e.t0),x.default.reportError(e.t0);case 40:case"end":return e.stop()}}}),e,this,[[9,35]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getItemData",value:function(e){var t=this._coalescedChanges[e],n=D.a.getItemData(e,!0);return t&&"Removed"!==t.type&&(n=Object.assign({},n,t.info)),n}},{key:"getItemSaveData",value:function(e){return e.getFullSaveData()}},{key:"importItem",value:function(e,t){var n=this;e.getDocumentOwner(),e.parent();t.push(e),e.hasNote()&&this.importItem(e.getNote(),t),e.getItems().forEach((function(e,r){e.index=""+r,n.importItem(e,t)})),this._seenLocal[e.id]=!0}},{key:"onSettingsChange",value:function(e,t,n,r){var i=this,a=t;Object.keys(t).forEach((function(r){var o=t[r];n&&i.settingsPending[r]?(a===t&&(a=x.default.clone(t)),delete a[r],t[r]={v:C.default.settings.getValueFromAbbrev(r)}):delete i.settingsPending[r],o.v&&(o.v="Removed"===e?void 0:i.decodeValue(o.v))})),"Removed"===e&&D.a.deleteSettings(a),C.default.settings.load(t,r,n)}},{key:"onBoardsChange",value:function(e,t,n){var r=this;Object.keys(t).forEach((function(i){if(!n||!r.boardsPending[i]){t[i].id=i;var a=j.a.boardIn(t[i]);"Removed"===e?D.a.deleteBoard(i):D.a.saveBoard(a),n&&L.a.onRemoteUpdate(e,a)}})),L.a.ensureUniqueIndices()}},{key:"onAuthTokensChange",value:function(e,t,n){var r={};t&&"Removed"!==e&&Object.keys(t).forEach((function(e){var n=e.replace(/,/g,"."),i=t[e],a=i.s?i.s.split(" "):void 0,o={email:n,scopes:a?a.map((function(e){return I.a.GScopeArray[e]})):void 0};try{x.default.PAssert(408,"Have an auth token without scopes")}catch(s){x.default.reportError(s)}r[n]=o})),E.a.loadWithTokens(r)}},{key:"onDocAclChange",value:function(e,t,n){var r=t.type,i=t.value,a=this.documents[e.id];a&&("Removed"===r&&Object.keys(i).forEach((function(e){i[e]=void 0})),a.onAclUpdate(i)&&D.a.saveDocument(a))}},{key:"onDocInfoChange",value:function(e,t,n){var r=t.type,i=t.value,a=this.documents[e.id];if(a&&("Removed"===r&&Object.keys(i).forEach((function(e){i[e]=null})),i)){var o={text:i.t,encryptionSentinel:i.s,isDeleted:i.x};a&&(a.onRemoteUpdate(o),o.encryptionSentinel&&!a.canDecrypt()&&(this.documentsEncrypted[a.id]=a.getSaveInfo(),delete this.documents[a.id],delete this.savedDocInfo[a.id],this.notifyDocumentsChanged(),C.default.PaneManager.runForEachPane((function(e){e.document.get()===a&&e.setDocument(M.a.getDefaultDocument())}))),D.a.saveDocument(a))}}},{key:"onDocAPIItemsChange",value:function(e,t){var n=t.type,r=t.value;"Removed"!==n&&e.onRemoteUpdate({itemsPlaintext:r})}},{key:"deleteDocAPIItems",value:function(){var e=c()(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocument(t);case 2:e.sent.deleteAPIItems(t.id,n);case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_processItemsChange",value:function(){var e=c()(u.a.mark((function e(){var t,n,r,i,a,o,s,l,d,h,f,p,g,v,m,y,_=this;return u.a.wrap((function(e){for(var b=0;;){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;switch(e.prev=e.next){case 0:if(this._isProcessingItemsChanged||this._pauseProcessingItemsChanged||!(this._itemsChangedQueue.length>0)){e.next=34;break}if(this._isProcessingItemsChanged=!0,t=this._itemsChangedQueue[0],n=t.docInfo,r=t.responses,i=t.isRemote,this._itemsChangedQueue.splice(0,1),a=[],o=this.documents[n.id],e.prev=6,!o){e.next=27;break}return s=0,e.next=11,Promise.all(r.map(function(){var e=c()(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(var r=0,i=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.value.t){e.next=6;break}return e.next=3,_.decryptItemIn(t.value,C.default.crypto,o.getBestEncryption());case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=j.a.itemIn(t.value);case 7:return n=e.t0,e.abrupt("return",{type:t.type,value:n});case 9:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:l=e.sent,i&&C.default.PaneUpdateBatcher.beginUpdateItems(),d=o.dateModified.get()||0,h=0;case 15:if(!(h<l.length)){e.next=25;break}if(!(s++>5e3&&__infLoop&&__infLoop(s))){e.next=18;break}throw new RangeError;case 18:f=l[h],p=f.type,g=f.value,v=g,d=Math.max(d,g.dateModified),i?(m=M.a.getItem(v.id),"Removed"===p&&m.getDocumentOwner()!==M.a.getItem(g.parent).getDocumentOwner()||(this.handleRemoteItemChange(this.documents[n.id],g.id,g),"Removed"===p?D.a.deleteItem(g):(v.docId=n.id,m&&(v.regexpFlags=m.regexpFlags),a.push(v)))):(y=M.a.getItem(g.id))&&y.setDateModified(new Date(g.dateModified));case 22:h++,e.next=15;break;case 25:i&&(C.default.PaneUpdateBatcher.commitUpdateItems(),a.length>0&&D.a.ensureMirror(a,!0)),o&&(this._updateDocModified(o,d),D.a.saveDocument(o));case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(6),x.default.reportError(e.t0);case 32:this._isProcessingItemsChanged=!1,this._itemsChangedQueue.length>0&&this._processItemsChange();case 34:case"end":return e.stop()}}}),e,this,[[6,29]])})));return function(){return e.apply(this,arguments)}}()},{key:"onItemsChange",value:function(e,t,n){var r=t.responses;(r=r.filter((function(e){var t=e.value,n=Object.keys(t).length;return void 0!==t.id&&n--,n>0}))).length>0&&(this._itemsChangedQueue.push({docInfo:e,responses:r,isRemote:n}),this._processItemsChange())}},{key:"convertItemUndefineds",value:function(e,t){var n=this.getItemData(e.id);return Object.keys(t).forEach((function(e){void 0===t[e]&&(void 0===n[e]?delete t[e]:t[e]=null)})),t}},{key:"_coalesceChange",value:function(e,t,n,r){var i=this._coalescedChanges[t],a=!i;r.id||(r.id=t),i&&("Modified"===i.type?i.info=Object.assign(i.info,r):i.type),a&&(i=this._coalescedChanges[t]={id:t,time:Date.now(),doc:e,type:n,info:r}),this.isCoalescing?this.needsCoalesceAfterFinish=!0:this._timeoutCoalesce||(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0))}},{key:"_runCoalescedChanges",value:function(){var e=c()(u.a.mark((function e(){return u.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return this._timeoutCoalesce=void 0,this.needsCoalesceAfterFinish=!1,this.isCoalescing=!0,e.prev=3,e.next=6,this._runCoalescedChangesInside();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),x.default.reportError(e.t0);case 11:this.isCoalescing=!1,this.needsCoalesceAfterFinish&&!this._timeoutCoalesce&&(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0));case 13:case"end":return e.stop()}}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"_runCoalescedChangesInside",value:function(){var e=c()(u.a.mark((function e(){var t,n,r,i,a,o,s=this;return u.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!this._isLoaded){e.next=18;break}if(t=x.default.objectValues(this._coalescedChanges),this._coalescedChanges={},!(t.length>0)){e.next=18;break}if(n=t.sort((function(e,t){return e.time-t.time})),r=[],Te.a.beginBatch(),n.forEach((function(e){var t=e.id,n=e.doc,i=e.info,a=M.a.getItem(t);"Added"===e.type?s.importItem(a,r):"Modified"===e.type?a.isNote()&&!i.isDeleted?s.importItem(a,r):x.default.isEmpty(i)||s._saveItem(n,a,i):"Removed"===e.type&&s._saveItem(n,a,i)})),i=[],a=[],o={},r.map((function(e){if(!o[e.id]){o[e.id]=!0;var t=e.getFullSaveData(),n=s._prepDataSaveLocal(e,t),r=n.localChanges,u=n.remoteChanges;i.push(r),a.push({item:e,itemData:u})}})),Te.a.endBatch(),this.checkItemsPending(),!(i.length>0)){e.next=17;break}return e.next=17,D.a.ensureMirror(i,!1);case 17:a.forEach((function(e){var t=e.item,n=e.itemData;s._saveItemRemote(t._documentOwner,n,t)}));case 18:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveItem",value:function(e,t,n,r,i){x.default.isLocalChange(r)?x.default.isUndoRedoChange(r)||this._coalesceChange(e,t.id,"Modified",n):D.a.saveItem(n,!1,t)}},{key:"addItem",value:function(e,t){var n=this.getItemSaveData(t);this._coalesceChange(e,t.id,"Added",n)}},{key:"deleteItem",value:function(e,t,n){this._coalesceChange(e,t.id,"Modified",{id:t.id,isDeleted:!0})}},{key:"setNote",value:function(e,t,n,r,i){if(x.default.isLocalChange(i))if(n){var a=this.getItemSaveData(n);this._coalesceChange(e,n.id,"Modified",a)}else r&&this._coalesceChange(e,r.id,"Modified",{id:r.id,isDeleted:!0})}},{key:"moveItem",value:function(e,t){var n=e.parent(),r=e.index,i=e.getDocumentOwner(),a=t.getDocumentOwner(),o={id:e.id,parent:n.id,index:r};i!==a&&(o.docId=i.id,o.oldDocId=a.id),this._coalesceChange(i,e.id,"Modified",o)}},{key:"_prepDataSaveLocal",value:function(e,t){t.parent&&x.default.isVMLI(t.parent)&&(t.parent=t.parent.id);var n=x.default.extend({id:e.id},t),r=D.a.getItemData(e.id)||{},i=r.pendingSync||{};Object.keys(t).forEach((function(e){"id"!==e&&"dateModified"!==e&&void 0===i[e]&&(i[e]=r[e])}));var a=Object.assign({pendingSync:i},n);return this.itemsPending[e.id]=Object.assign(this.itemsPending[e.id]||{},i),{localChanges:a,remoteChanges:n}}},{key:"_saveItem",value:function(e,t,n){var r=this._prepDataSaveLocal(t,n),i=r.localChanges,a=r.remoteChanges;D.a.saveItem(i,!1,t),this._saveItemRemote(e,this.convertItemUndefineds(t,a),t),this.checkItemsPending()}},{key:"_saveItemRemote",value:function(){var e=c()(u.a.mark((function e(t,n,r){var i,a,o,s,l,c;return u.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.api){e.next=28;break}return i=n.docId,(a=n.oldDocId)&&r&&(n=Object.assign(r.getFullSaveData(),{oldDocId:a})),e.next=7,this.encryptItemForSaveRemote(t,n);case 7:if(o=e.sent,!j.a.validateOutFields(o,!0)){e.next=27;break}return e.next=12,this.getAPIForDocumentItems(t);case 12:if(s=e.sent,!i||!a){e.next=17;break}return e.next=16,this.getAPIForDocumentItems({id:a});case 16:l=e.sent;case 17:return e.next=19,s.update(o,!0);case 19:if(c=e.sent,!l){e.next=23;break}return e.next=23,l.remove({id:n.id},!0);case 23:return c&&(delete this.itemsPending[n.id],this.checkItemsPending(),D.a.saveItem({id:n.id,docId:t.id,pendingSync:void 0},!0)),e.abrupt("return",c);case 27:0;case 28:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"generateId",value:function(){return T.a.database().ref().push().key}},{key:"addDocument",value:function(){var e=c()(u.a.mark((function e(t,n){var r,i,a,o,s=this;return u.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:(r=t.getRootItem())||t.createVMLIs();try{x.default.PAssert(409,r,"Trying to add a document without a root item")}catch(l){x.default.reportError(l)}if(!r){e.next=11;break}if(i=t.getSaveInfo(),a=this.getItemSaveDataRecursive(r),!1!==n&&(this.documents[t.id]=t,D.a.saveDocument(t,{pendingSync:Date.now()}),D.a.ensureMirror(a,!0)),this.documentsPending&&(this.documentsPending[t.id]=t),!this.api){e.next=11;break}return o=j.a.documentOut(i),e.abrupt("return",Promise.all(a.map((function(e){return s.encryptItemForSaveRemote(t,e)}))).then((function(e){s.api.addDocument(o,e).then((function(e){var n=e.items();n.onLoad(x.default.emptyFn),n.onUpdate(s.onItemsChange.bind(s,i)),e.info.onLoad(x.default.emptyFn,x.default.reportError),e.info.onUpdate(s.onDocInfoChange.bind(s,i),x.default.reportError),e.info.onAclUpdate(s.onDocAclChange.bind(s,i),x.default.reportError),e.info.onAPIItemsUpdate(s.onDocAPIItemsChange.bind(s,t),x.default.reportError)}))})).catch((function(e){return x.default.reportError(e)})));case 11:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"encryptItemForSaveRemote",value:function(){var e=c()(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return n.dateModified=this.api.serverTime,delete n.pendingSync,delete n.docId,delete n.oldDocId,delete n.regexpFlags,delete n.noteItem,e.abrupt("return",j.a.encryptItemOut(n,C.default.crypto,t.getBestEncryption()));case 8:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveDocument",value:function(e,t){t?D.a.saveDocument(e):(this.documentsPending[e.id]=!0,D.a.saveDocument(e,{pendingSync:Date.now()}),this._saveDocumentRemote(e))}},{key:"_saveDocumentRemote",value:function(){var e=c()(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(delete(n=t.getSaveInfo()).dateModified,r=j.a.documentOut(n,{onlyUpdate:!0}),!j.a.validateOutFields(r,!0)){e.next=10;break}return e.next=6,this.getAPIForDocument(t);case 6:e.sent.update(r,!0),e.next=11;break;case 10:0;case 11:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItemSaveDataRecursive",value:function(e,t){var n=this,r=!t;return t||(t=[]),t.push(e),e.hasNote()&&t.push(e.getNote()),e.hasChildren()&&e.getItems().forEach((function(e){n.getItemSaveDataRecursive(e,t)})),r&&(t=t.map((function(e){return n.getItemSaveData(e)}))),t}},{key:"encodeValue",value:function(e){return x.default.isObject(e)||x.default.isArray(e)?JSON.stringify(e):e}},{key:"decodeValue",value:function(e){if(e&&e.length>1&&("{"===e[0]||"["===e[0]))try{e=JSON.parse(e)}catch(t){0}return e}},{key:"getSetting",value:function(e){return D.a.getSetting(e)}},{key:"setSetting",value:function(e,t,n){var r=Date.now();D.a.setSetting(e,{pendingSync:r,v:t}),this._setSettingRemote(e,n)}},{key:"_setSettingRemote",value:function(e,t){var n=this;if(this.api){var r;if(void 0===t||null===t)r=this.api.user.removeSetting(e);else{t=this.encodeValue(t),this.settingsPending[e]=!0;var i={v:t,d:this.api.serverTime};r=this.api.user.setSetting(e,i)}r.then((function(t){if(t){delete n.settingsPending[e];var r=D.a.getSetting(e);delete r.pendingSync,D.a.setSetting(e,r)}}))}}},{key:"encryptSettings",value:function(e,t,n){var r=this;return Promise.all(C.default.settings.getEncryptedSettings().map(function(){var i=c()(u.a.mark((function i(a){var s,l,c,d,h,f;return u.a.wrap((function(i){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(i.prev=i.next){case 0:return s=o()(a,3),l=s[0],c=s[1],d=s[2],i.next=3,C.default.settings.getEncryptedValue(l,d,n);case 3:h=i.sent,h=r.encodeValue(h),f={v:h,d:r.api.serverTime},t["users/".concat(e,"/s/").concat(c)]=f;case 7:case"end":return i.stop()}}}),i)})));return function(e){return i.apply(this,arguments)}}()))}},{key:"saveBoard",value:function(e,t){var n=Date.now(),r=Object.assign({pendingSync:n},e);D.a.saveBoard(r),t||this._saveBoardRemote(e)}},{key:"_saveBoardRemote",value:function(e){var t=this;if(this.api){var n=x.default.clone(e);delete n.id,delete n.pendingSync,this.boardsPending[e.id]=!0;var r=j.a.boardOut(n);r.d=this.api.serverTime,this.api.user.setBoard(e.id,r).then((function(n){if(n){delete t.boardsPending[e.id];var r=D.a.getBoard(e.id);delete r.pendingSync,D.a.saveBoard(r)}}))}}},{key:"deleteBoard",value:function(e){D.a.deleteBoard(e),this.api&&this.api.user.removeBoard(e)}},{key:"getBoards",value:function(){return D.a.getBoards()}},{key:"deleteAuthToken",value:function(e){this.api&&(e=e.replace(/\./g,","),this.api.user.removeAuthToken(e))}},{key:"getAPIForDocument",value:function(){var e=c()(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.api.getDocumentAPI(t.id);case 2:return n=e.sent,e.abrupt("return",n.info);case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAPIForDocumentItems",value:function(){var e=c()(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.api.getDocumentAPI(t.id);case 2:return n=e.sent,e.abrupt("return",n.items());case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAPIForItem",value:function(e){return this.getAPIForDocumentItems(e.getDocumentOwner())}},{key:"clearAllData",value:function(){var e=c()(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D.a.clearAllData();case 3:return e.next=5,Promise.all(Object.keys(this.documents).map(function(){var e=c()(u.a.mark((function e(n){return u.a.wrap((function(e){for(var r=0,i=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.documents[n].isAdmin()){e.next=6;break}return e.next=4,t.getAPIForDocument({id:n});case 4:e.sent.deleteFully();case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",this.api.user.deleteFully());case 8:e.prev=8,e.t0=e.catch(0),x.default.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"deleteDocument",value:function(e,t){e.isDeleted.set(!0),M.a.documentsArray.notify(),this.saveDocument(e,t),this.notifyDocumentsChanged()}},{key:"undeleteDocument",value:function(e,t){e.isDeleted.set(!1),M.a.documentsArray.notify(),this.saveDocument(e,t)}},{key:"unlistenDocument",value:function(){var e=c()(u.a.mark((function e(t){return u.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocument(t);case 2:e.sent.unlisten(),this.api.forgetDocument(t.id),delete this.documents[t.id];case 6:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateOnlineStatus",value:function(e){var t=M.a.onlineStatus,n=t.get();e||"Connecting"!==n?(x.default.clearTimeoutOnce("initialOffline"),t.set(e?"Online":"Offline")):S.a.isOnline()?x.default.timeoutOnce("initialOffline",(function(){return t.set("Offline")}),2e3):t.set("Offline")}},{key:"resolveItemConflicts",value:function(e,t){var n=this;C.default.PaneUpdateBatcher.beginUpdateItems();var r=e.dateModified.get()||0;t.forEach((function(t){var i=n.itemsPending[t.id],a=M.a.getItem(t.id),o=n.getItemData(t.id);i&&a&&(Object.keys(i).forEach((function(r){var s=o[r],u=t[r];if(u===i[r]||u===s)s===u&&delete i[r],delete t[r];else if("text"!==r||t.isDeleted)delete t[r];else{var l="Sync Conflict: ".concat(u,"  ;  ").concat(s);i[r]=t.text,n.handleRemoteItemChange(e,a.id,{text:l}),D.a.saveItem({id:a.id,text:l,docId:e.id},!0,a),delete t[r]}})),t.isDeleted&&(t.isDeleted=!1,i.isDeleted=!0,n.handleRemoteItemChange(e,t.id,t),a||(a=M.a.getItem(t.id)),a&&D.a.saveItem({id:a.id,isDeleted:!1,docId:e.id},!0,a))),r=Math.max(r,t.dateModified);var s=t.id;x.default.isEmpty(t)||n.handleRemoteItemChange(e,s,t)})),this._updateDocModified(e,r),C.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"handleRemoteItemChange",value:function(e,t,n){var r,i,a=this.getItemData(t);a?(i={id:t,docId:e.id},Object.keys(n).forEach((function(e){a[e]!==n[e]&&("dateModified"!==e&&"id"!==e&&(r=!0),i[e]=n[e])})),Object.keys(a).forEach((function(e){"items"!==e&&e in n&&void 0!==a[e]&&void 0===n[e]&&(i[e]=void 0,r=!0)})),r&&a.isDeleted&&!i.isDeleted&&(i.text||i.flags||i)&&(i.isDeleted=!1,D.a.saveItem({id:t,isDeleted:!1,docId:e.id},!0))):(r=!0,i=n),r&&F.a.onRemoteChange(e,a,t,i)}},{key:"getEncryptionForDocument",value:function(e){return e.encryptionSentinel?C.default.crypto.getKeyBySentinel(e.encryptionSentinel):e.acl&&Object.keys(e.acl).length>1?C.default.crypto.getGlobalKey():C.default.crypto.getKey(C.default.settings.getBestUserEncryption())}},{key:"_getItemWithText",value:function(e){return{id:e.id,text:e.getRawText()}}},{key:"checkUserEncryption",value:function(e,t){var n=this;if(e){var r=function(){var r;n.loadState.set(I.a.LoadState.NeedPassword),n._pauseProcessingItemsChanged=!0,C.default.menus.promptComplex({title:"Enter password",text:"Please enter your encryption password to unlock your data.",noCancel:!0,fields:[{type:"password"}],validate:function(){var t=c()(u.a.mark((function t(n){var i,a,s;return u.a.wrap((function(t){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(t.prev=t.next){case 0:if(i=o()(n,1),!(a=i[0])){t.next=19;break}return t.prev=2,t.next=5,C.default.crypto.setKey({name:I.a.EncryptionKeys.UserPassword,password:a,sentinelSalt:S.a.getEncryptionUid()});case 5:if(s=t.sent,e!==s.sentinel){t.next=10;break}r=s.key,t.next=12;break;case 10:return C.default.crypto.removeKey(I.a.EncryptionKeys.UserPassword),t.abrupt("return","The password was invalid. Please try again.");case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(2),console.log(t.t0);case 17:t.next=20;break;case 19:return t.abrupt("return","You must enter a password");case 20:case"end":return t.stop()}}}),t,null,[[2,14]])})));return function(e){return t.apply(this,arguments)}}(),callback:function(){var e=c()(u.a.mark((function e(){return u.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!r){e.next=6;break}return e.next=3,C.default.settings.addEncryptionKey(I.a.EncryptionKeys.UserPassword,r);case 3:t&&t(),n._pauseProcessingItemsChanged=!1,n._processItemsChange();case 6:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()})},i=C.default.settings.getEncryptionKey(I.a.EncryptionKeys.UserPassword);i?C.default.crypto.decryptText(i,e,S.a.getEncryptionUid()).then((function(e){e===I.a.EncryptionSentinel?t&&t():r()})):r()}else t&&t()}},{key:"_encryptDocumentItems",value:function(){var e=c()(u.a.mark((function e(t,n,r){var i;return u.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocumentItems(n);case 2:return i=e.sent,e.abrupt("return",Promise.all(n.getAllItems().map((function(e){var n={id:e.id,text:e.getRawText()};return new Promise((function(e){j.a.encryptItemOut(n,C.default.crypto,r.key).then((function(n){if(j.a.validateOutFields(n,!0)){var r=i.getPathForItem(n);t[r+"t"]=n.t,e()}}))}))}))));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateDocumentEncryption",value:function(e,t){var n,r=this,i={};return t&&t!==C.default.crypto.getKeyInfo(I.a.EncryptionKeys.Global)?(n=Object.assign({},C.default.settings.encryptionKeys.get()))[e.id]=t.key:t=C.default.crypto.getKeyInfo(I.a.EncryptionKeys.Global),i["documents/".concat(e.id,"/p/s")]=t.sentinel,i["userdocuments/".concat(S.a.getUid(),"/").concat(e.id,"/s")]=t.sentinel,this._encryptDocumentItems(i,e,t).then((function(){return r.api.commitBatch(i).then((function(){n&&(e.encryptionSentinel.set(t.sentinel),C.default.settings.setEncryptionKeys(x.default.clone(n)))})).catch((function(e){return x.default.reportError(e)}))})).catch((function(e){return x.default.reportError(e)}))}},{key:"updateUserEncryption",value:function(){var e=c()(u.a.mark((function e(t){var n,r,i,a,o,s,l,c=this;return u.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.api){e.next=34;break}return n={},i=x.default.clone(C.default.settings.encryptionKeys.get()),a=Object.assign({},C.default.settings.encryptionKeys.get()),t!==C.default.crypto.getGlobalKeyInfo()?(r=t.sentinel,a[t.name]=t.key):(r=null,delete a[I.a.EncryptionKeys.UserPassword]),o=C.default.settings.getSettingAbbrev("userEncryptionSentinel"),n[this.api.user.getPathForSettings()+o]={v:r,d:this.api.serverTime},s=Object.keys(this.documents).filter((function(e){return!c.documents[e].encryptionSentinel.get()&&!c.documents[e].isShared()})),e.prev=8,e.next=11,Promise.all(s.map((function(e){return c._encryptDocumentItems(n,c.documents[e],t)})));case 11:return l=S.a.getUid(),e.next=14,xe.a.reEncrypt("users/".concat(l,"/l/"),n,t);case 14:return e.next=16,this.encryptSettings(l,n,t);case 16:return e.next=18,C.default.settings.setEncryptionKeys(a);case 18:return e.prev=18,console.log("commiting batch",n),e.next=22,this.api.commitBatch(n);case 22:null===r&&C.default.crypto.removeKey(I.a.EncryptionKeys.UserPassword),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(18),C.default.settings.setEncryptionKeys(i),x.default.reportError(e.t0);case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(8),x.default.reportError(e.t1);case 34:case"end":return e.stop()}}}),e,this,[[8,31],[18,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkItemsPendingTimeout",value:function(){var e=this,t={};Object.keys(this.itemsPending).forEach((function(e){var n=D.a.getItemData(e).docId;n&&(t[n]=!0)})),Object.keys(this.documents).forEach((function(n){e.documents[n].isSyncing.set(!!t[n])}))}},{key:"checkItemsPending",value:function(){x.default.timeoutOnce("checkItemsPending",this._checkItemsPendingTimeout,100)}},{key:"decryptItemIn",value:function(e,t,n){return j.a.decryptItemIn(e,t,n)}},{key:"_updateDocModified",value:function(e,t){e.updateModified(t)&&D.a.saveDocument(e)}},{key:"commitBatch",value:function(e){return this.api.commitBatch(e)}}]),n}(R.b),k()(ye.prototype,"onLoadLocal",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"onLoadLocal"),ye.prototype),k()(ye.prototype,"onLoadRemoteDocuments",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"onLoadRemoteDocuments"),ye.prototype),k()(ye.prototype,"_runCoalescedChanges",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"_runCoalescedChanges"),ye.prototype),k()(ye.prototype,"clearAllData",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"clearAllData"),ye.prototype),k()(ye.prototype,"_checkItemsPendingTimeout",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"_checkItemsPendingTimeout"),ye.prototype),ye);t.a=new Ae},function(e,t,n){"use strict";t.a={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^(\d{1,2})/,time:/^(\d{1,2}):?(\d\d)?\s?((?:a|p)m)?/,numberAsText:/^(one|two|three|four|five|six|seven|eight|nine|ten)/i,every:/^every/i,other:/^other/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^((un)?til|end(ing)?)/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i,morning:/^morning?/i,night:/^(eve(ning)?|night)/i,starting:/^(from|start(ing)?)/i,duration:/^(\d{1,4}\.?\d?)\s?(h(?:ou)?r?s?|m(?:in)?s?)\b/i}}},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},function(e,t,n){"use strict";var r=n(41),i=n.n(r),a=n(5),o=n.n(a),s=n(6),u=n.n(s),l=n(1),c=n(0),d=n(22),h=/([^\+]+)\+(\d+)/,f=l.a.MatchState,p=function(){function e(){o()(this,e)}return u()(e,[{key:"checkItemTextSearchArr",value:function(e,t,n){for(var r=0,i=[],a=0;a<n.length;a++){var o=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var s=n[a],u=0;u<s.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=s[u],d=l.text;try{c.default.PAssert(2515,d,"Each value in the search array should be valid at this point")}catch(p){c.default.reportError(p)}if(!l.isNegated){var h=this.checkItemText(e,t,l);i[a]=h?f.Yes:f.No}if(i[a]===f.No)break}}return this.orMatchStates(i)}},{key:"getSearchArr",value:function(e){var t=0,n=0,r=e.toLowerCase().trim(),a=/(-*)["\u201c\u201d]([^"\u201c\u201d]*)["\u201c\u201d]|[^\s"\u201c\u201d]+/gi,o=[],s=0;do{if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var u=a.exec(r);null!=u&&o.push(u[2]?(u[1]?u[1]:"")+(u[2]?u[2]:""):u[0]),s++}while(null!=u&&s<1e3);for(var c=[],h=[],f=0,p=0;p<o.length;++p){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var g=o[p],v=g.length>1&&g.startsWith("-"),m=v?g.substr(1):g;if(m&&"and"!==m&&"$"!==m)if(p>0&&("or"===m||"|"===m||"||"===m))f++;else{c[f]||(c[f]=[]);var y={text:m,isNegated:v};if(m.startsWith(l.a.SearchDates.Before)||m.startsWith(l.a.SearchDates.After)||m.startsWith(l.a.SearchDates.Date)||m.startsWith(l.a.SearchDates.Between)){m.endsWith(":")&&(m+=o[++p]);var _=m.split(":"),b=i()(_,2),w=b[0],k=b[1],S=void 0,E=void 0;if(k){if("date"!==w||"overdue"!==k&&"any"!==k&&"none"!==k)if("between"===w){var P=k.split(","),I=i()(P,2),D=I[0],T=I[1];D&&T&&(S=this.dateFromSearchText(D),E=this.dateFromSearchText(T))}else S=this.dateFromSearchText(k);else S=k;S&&(y.dateInfo={prefix:w,dateText:k,date:S,date2:E,dateCleared:S&&d.a.clearTime(S),dateCleared2:E&&d.a.clearTime(E)})}}c[f].push(y),v||h.push(m)}}return{searchArr:c,searchWords:h}}},{key:"checkItemText",value:function(e,t,n,r){var i=!0,a=n.text;if(n.dateInfo)i=this._matchItemDate(e,n);else if(a.length>0){i=!1;var o=a===l.a.SearchFilterTexts.Pri0,s=a===l.a.SearchFilterTexts.Pri1,u=a===l.a.SearchFilterTexts.Pri2;if(c.default.isPrefixTask(a))i=e.isPrefixTask();else if(a===l.a.SearchFilterTexts.Star)i=e.isStarred(r);else if(o||s||u){i=e.getPriority(r)===(o&&l.a.VMLIFlag.P0||s&&l.a.VMLIFlag.P1||u&&l.a.VMLIFlag.P2)}else i=a===l.a.Prefix.Bullet?e.isPrefixBullet():a===l.a.Prefix.Header||a===l.a.Prefix.Header2?e.isPrefixHeader():i||t.indexOf(a)>=0}return i}},{key:"dateFromSearchText",value:function(e){var t=e.match(h);return t?Date.parse(t[1]).addDays(+t[2]):Date.parse(e)}},{key:"_matchItemDate",value:function(e,t){var n=e.getNextDate(),r=t.dateInfo,i=r.prefix,a=r.date,o=r.date2,s=r.dateCleared;r.dateCleared2;if(n){var u=e.getMooDate();if("any"===a)return!0;if("none"===a)return!1;if("overdue"===a&&(a=d.a.getToday(),i="before"),u.isRepeatDate()){if("before"===i)return u.getFirstDate()<a;if("date"===i)return u.isOnDate(a);if("after"===i)return!!u.getNext(a);if("between"===i)return!!u.getNext(a)&&u.getFirstDate()<o;0}return!a||"before"===i&&n<a||"date"===i&&+d.a.clearTime(n)===+s||"after"===i&&n>=a||"between"===i&&n>=a&&n<=o}if("none"===a)return!0}},{key:"orMatchStates",value:function(e){for(var t,n=0,r=0;r<e.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t===f.Unknown&&e[r]===f.Negated)t=f.Negated;else if(t!==f.Yes&&e[r]===f.No)t=f.No;else if(e[r]===f.Yes||e[r]===f.Unknown){t=f.Yes;break}}return t}}]),e}();t.a=new p},function(e,t){t.WEEKDAY_OFFSET={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,wednesday:3,wed:3,thursday:4,thur:4,thu:4,friday:5,fri:5,saturday:6,sat:6},t.MONTH_OFFSET={january:1,jan:1,"jan.":1,february:2,feb:2,"feb.":2,march:3,mar:3,"mar.":3,april:4,apr:4,"apr.":4,may:5,june:6,jun:6,"jun.":6,july:7,jul:7,"jul.":7,august:8,aug:8,"aug.":8,september:9,sep:9,"sep.":9,sept:9,"sept.":9,october:10,oct:10,"oct.":10,november:11,nov:11,"nov.":11,december:12,dec:12,"dec.":12},t.MONTH_PATTERN="(?:"+Object.keys(t.MONTH_OFFSET).join("|").replace(/\./g,"\\.")+")",t.INTEGER_WORDS={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12},t.INTEGER_WORDS_PATTERN="(?:"+Object.keys(t.INTEGER_WORDS).join("|")+")",t.ORDINAL_WORDS={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20,"twenty first":21,"twenty second":22,"twenty third":23,"twenty fourth":24,"twenty fifth":25,"twenty sixth":26,"twenty seventh":27,"twenty eighth":28,"twenty ninth":29,thirtieth:30,"thirty first":31},t.ORDINAL_WORDS_PATTERN="(?:"+Object.keys(t.ORDINAL_WORDS).join("|").replace(/ /g,"[ -]")+")";var n="("+t.INTEGER_WORDS_PATTERN+"|[0-9]+|[0-9]+.[0-9]+|an?(?:\\s*few)?|half(?:\\s*an?)?)\\s*(sec(?:onds?)?|min(?:ute)?s?|hours?|weeks?|days?|months?|years?)\\s*",r=new RegExp(n,"i");function i(e,n){var r=e[1].toLowerCase();return r=void 0!==t.INTEGER_WORDS[r]?t.INTEGER_WORDS[r]:"a"===r||"an"===r?1:r.match(/few/)?3:r.match(/half/)?.5:parseFloat(r),e[2].match(/hour/i)?n.hour=r:e[2].match(/min/i)?n.minute=r:e[2].match(/sec/i)?n.second=r:e[2].match(/week/i)?n.week=r:e[2].match(/day/i)?n.d=r:e[2].match(/month/i)?n.month=r:e[2].match(/year/i)&&(n.year=r),n}t.TIME_UNIT_PATTERN="(?:"+n+")+",t.TIME_UNIT_STRICT_PATTERN="(?:(?:[0-9]+|an?)\\s*(?:seconds?|minutes?|hours?|days?)\\s*)+",t.extractDateTimeUnitFragments=function(e){for(var t={},n=e,a=r.exec(n);a;)i(a,t),n=n.substring(a[0].length),a=r.exec(n);return t}},function(e,t,n){"use strict";var r=n(33),i=n.n(r),a=n(5),o=n.n(a),s=n(6),u=n.n(s),l=n(7),c=n.n(l),d=n(8),h=n(1),f=n(0),p=n(67),g=n(18),v=n.n(g),m=n(19),y=n.n(m),_=n(11),b=n.n(_);n(14);function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var k,S=function(e){v()(n,e);var t=w(n);function n(e){var r;return o()(this,n),(r=t.call(this,e)).elementsByID={},r.elementsByIndex={},r.scrollListeners=[],r}return u()(n,[{key:"getElementByID",value:function(e){return this.elementsByID[e]}},{key:"getElementByIndex",value:function(e){var t;return null===(t=this.elementsByIndex[e])||void 0===t?void 0:t.element}},{key:"setElement",value:function(e,t,n){this.elementsByID[t]=n,this.elementsByIndex[e]={paneObjectId:t,element:n}}},{key:"clearThisElement",value:function(e,t){var n;this.elementsByID[t]=void 0,(null===(n=this.elementsByIndex[e])||void 0===n?void 0:n.paneObjectId)===t&&(this.elementsByIndex[e]=void 0)}},{key:"setVirtualList",value:function(e){this._virtualList=e}},{key:"setScrollRange",value:function(e){var t=this;this.lastIndexScrolledTo=void 0,this.scrollRange=e,this.pane.saveState(!0),this.scrollListeners.forEach((function(n){return n(t.pane,e)}))}},{key:"getScrollOffset",value:function(){return this._virtualList.getScrollOffset()}},{key:"getScrollIndex",value:function(){var e,t,n;return null!==(e=null!==(t=this.lastIndexScrolledTo)&&void 0!==t?t:null===(n=this.scrollRange)||void 0===n?void 0:n.startIndex)&&void 0!==e?e:-1}},{key:"getScrollEndIndex",value:function(){var e,t;return null!==(e=null===(t=this.scrollRange)||void 0===t?void 0:t.endIndex)&&void 0!==e?e:-1}},{key:"scrollToOffset",value:function(e,t){this._virtualList.scrollTo(e,t)}},{key:"scrollToIndex",value:function(e,t,n,r){var i;if("start"===t&&(this.lastIndexScrolledTo=e),e!==(null===(i=this.scrollRange)||void 0===i?void 0:i.startIndex)&&t&&this._virtualList)return this._virtualList.scrollToIndex({index:e,align:t,behavior:n,offset:r}),!0}},{key:"addScrollListener",value:function(e){this.scrollListeners.push(e)}},{key:"removeScrollListener",value:function(e){this.scrollListeners.remove(e)}},{key:"indexOfTop",value:function(){var e;return(null===(e=this.scrollRange)||void 0===e?void 0:e.startIndex)||0}},{key:"offsetOfIndex",value:function(e){return this._virtualList.offsetByIndex(e)}}]),n}(function(){function e(t){var n=t.pane;o()(this,e),this.pane=n}return u()(e,[{key:"onListChanged",value:function(){}},{key:"isIndexInView",value:function(e){return!1}},{key:"clearItemInfoForItem",value:function(e){}},{key:"handleItemTextChanged",value:function(e){return!1}},{key:"clearCache",value:function(){}},{key:"saveScrollOfTop",value:function(){}}]),e}()),E=n(12),P=n(4),I=n(2),D=(n(47),n(38)),T=n(21),x=n(56),C=n(65),A=n(53),L=n(49),O=n(93),M=n(41),R=n.n(M),F=n(23),N=n(52),j=n(77),U=new(k=function(){function e(){o()(this,e),F.a.listen("selectionChanged",this.onSelectionChange),document.addEventListener("keydown",this.onKeyDown)}return u()(e,[{key:"onKeyDown",value:function(e){if(P.a.isValid()){var t;if(!I.default.settings.showMarkdown.get()&&(E.a.mac&&e.metaKey||!E.a.mac&&e.ctrlKey))if(e.normCode===h.a.KeyCode.B?t="bold":e.normCode===h.a.KeyCode.I?t="italic":e.normCode===h.a.KeyCode.U?t="underline":e.normCode===h.a.KeyCode.X&&e.shiftKey&&(t="strike"),t){var n=P.a.getStartObject(),r=P.a.getEndObject(),i=P.a.getStartOffset(),a=P.a.getEndOffset();if(this.formatHint||(this.formatHint={}),this.formatHint[t]=!0,n===r&&i===a&&n.item.getParsedText().length>0){var o=n.item.elsNew.elementAtOffset(n,i-1);o&&o.props[t]&&(this.formatHint[t]=!1)}}e.normCode===h.a.KeyCode.Enter?(I.default.onIntroAction("AddItem"),I.default.onIntroAction("Import")):e.normCode===h.a.KeyCode.Slash&&P.a.isValid()&&0===P.a.getStartOffset()&&0===P.a.getStartTotal()&&P.a.getStartIndex()===P.a.getEndIndex()&&I.default.onIntroAction("SlashHelp")}}},{key:"onSelectionChange",value:function(){this.formatHint=void 0}},{key:"getSelection",value:function(e,t,n){for(var r,i,a,o,s,u,l,c,d,h=0,f=e.item.elsNew.elements,p=e.showMarkdown(),g=0,v=0;v<f.length;v++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var m=f[v],y=m.getStyledText(e.item,{showMarkdown:p}).length,_=v===f.length-1;if(y&&!m.props.prefixType){if(d=m,a=g,u=v,!l&&(_||t>=g&&t<=g+y)&&(l=m,r=g,o=v),!c&&l&&(_||n>=g&&n<=g+y)){c=m,i=g,s=v;break}g+=y}}return l||(l=c=d,r=i=a,o=s=u),{startElement:l,startOffset:r,startIndex:o,endElement:c,endOffset:i,endIndex:s}}},{key:"setOffsetsBeforeInput",value:function(e){this.offsetsBeforeInput=e}},{key:"onInput",value:function(e,t,n,r,i,a){var o=a.data,s=0;r=Math.min(n,r);var u=e.getDisplayTextWithoutPrefix();n===r&&n===i&&t.length<u.length&&(i+=u.length-t.length);var l=this.getSelection(e,r,i),c=l.startElement,d=l.startOffset,p=l.startIndex,g=l.endElement,v=l.endOffset,m=l.endIndex,y=e.item,_=e.showMarkdown();if(c&&g){for(var b=0,w=e.item.elsNew,k=w.elements,S=p,E=u.substr(i),P=y.getPrefixLength();S<=m;){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;var D=k[S],T=S===p?r-d:-1,x=S===m?i-v:-1,C=D.getStyledText(e.item,{showMarkdown:_}),A=T>=0?C.substr(0,T):"",L=x>=0?C.substr(x):"",O=D.isEditable();if(S>p&&S<m)D.setText("",_);else{var M=A+L;if(!O&&M||D.setText(M,_),S===m){var F=e.getDisplayTextWithoutPrefix(),U=t.lastIndexOf(E)-F.lastIndexOf(E);if(0===U&&o)t.substr(A.length-o.length,o.length)===o&&(A=A.substr(0,A.length-o.length)+o);var B=t.substr(r,U);if(_||D.props.tag||(B=B.replace(h.a.Regexp.MDFormat,(function(e){return s++,"\\"+e}))),f.default.isEmpty(this.formatHint))O&&(A||D.isEditableAtStart())&&(L||D.isEditableAtEnd())?D.setText(A+B+L,_):k.splice(S+(A.length>0?1:0),0,new N.a(B,this.formatHint));else{var V=w.split(e,n+P-1),H=R()(V,2),W=H[0],q=H[1],z=new N.a(B,this.formatHint);w=new j.a((W?W.elements:[]).concat(z).concat(q?q.elements:[]))}B.includes(h.a.TagPrefix)&&I.default.onIntroAction("Tag")}}S++}return{newText:w.getRawText(e.showMarkdown()),selOffset:s}}return _||(t=t.replace(h.a.Regexp.MDFormat,(function(e){return"\\"+e}))),f.default.isEmpty(this.formatHint)||(t=new j.a([new N.a(t,this.formatHint)]).getRawText()),{newText:t=y.getPrefix()+t,selOffset:0}}}]),e}(),c()(k.prototype,"onKeyDown",[d.a],Object.getOwnPropertyDescriptor(k.prototype,"onKeyDown"),k.prototype),c()(k.prototype,"onSelectionChange",[d.a],Object.getOwnPropertyDescriptor(k.prototype,"onSelectionChange"),k.prototype),k);function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var V,H,W=n(16),q=n(26),z=n(13),G=n(32),K=n(48),Y=function(){function e(t,n,r){o()(this,e),this.pane=t,this.isVisible=new z.a(n),this.dragHoverItem=void 0}return u()(e,[{key:"destroy",value:function(){this.pane=void 0}},{key:"setVisibility",value:function(e){e&&P.a.reset(),e!==this.isVisible.get()&&(this.isVisible.set(e),F.a.fireEvent("panesChanged",[]),I.default.PaneManager.updatePaneStateForPane(this.pane))}},{key:"toggle",value:function(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),I.default.onIntroAction("Overview")}},{key:"updateDragHoverItem",value:function(e){var t=this.dragHoverItem;this.dragHoverItem=e,f.default.batchRenderUpdates((function(){t&&t.itemChanged.notify(),e&&t!==e&&e.itemChanged.notify()}))}},{key:"isItemDragHovered",value:function(e){return e===this.dragHoverItem}},{key:"getMinItemSize",value:function(){return I.default.DisplaySettings.itemLineHeight()+2*I.default.DisplaySettings.itemPadding()}}]),e}(),Q=n(50),X=n(44),$=n(22),J=n(73),Z=h.a.MatchState,ee=(V=function(){function e(t,n,r){var i=0;o()(this,e),this.callback=r,this.pane=t,this.searchArr=[],this.matches={},this.previousSearch="",this._stickyMatches={},this._stickyMatchesAwaitingClear=[],this.itemStoreFilter=void 0,this.UI=void 0,this.isFocused=new z.a,this._destroyed=!1;var a={priority:{name:"priority",matchFn:this._matchFnPriority},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFnBoolean:this._matchFnStarred},project:{name:"project",initialValue:1,icon:"icon-project",tooltip:"projects",matchFnBoolean:this._matchFnProject},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFnBoolean:this._matchFnTask},complete:{name:"complete",text:"Completed Items",initialValue:-1,defaultValue:-1,icon:"icon-check",tooltip:"completed items",matchFn:this._matchFnComplete},showOnlyMatches:{name:"showOnlyMatches",initialValue:1,icon:"icon-reorder",tooltip:"Flat mode: Show only matching items",canBeNegated:!1,isOption:!0,hideInView:!0},showOnlyAgendaDates:{name:"showOnlyAgendaDates",initialValue:1,icon:"icon-at",tooltip:"Show only dates on the Agenda",canBeNegated:!1,isOption:!0,hideInView:!0},showOnlyMatchingTags:{name:"showOnlyMatchingTags",initialValue:1,icon:"icon-short_text",tooltip:"Show only matching tag blocks",canBeNegated:!1,isOption:!0},showChildProjects:{name:"showChildProjects",initialValue:1,icon:"icon-project_half",tooltip:"Show all projects from anywhere in the hierarchy",canBeNegated:!1,isOption:!0}};if(n){!1===n.showHierarchy&&(n.showOnlyMatches=1);var s=n.completeOption;!isNaN(s)&&isNaN(n.complete)&&(n.complete=s<0?1:s-1),0===n.showOnlyTopLevelProjects&&(n.showChildProjects=1)}for(var u=[],l=0;l<t.searchFilters.length;l++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=t.searchFilters[l];f.default.isString(c)?u.push(a[c]):u.push(c)}if(this.setupFilters(u,n),this.value=n&&n.text||"",this.onChanged=new X.a(r),this._updateSearchArr(),this.value){var d=A.a.parseTextNew(void 0,this.value,Q.a.getContacts(),!0);d&&this.onParsed(d)}}return u()(e,[{key:"destroy",value:function(){this._destroyed=!0,this.onChanged.unlisten(this.callback),this.pane=void 0,this.UI=void 0}},{key:"setFilterTooltip",value:function(e,t){this.getFilter(e).tooltip=t}},{key:"getFilterTooltip",value:function(e){var t=e.value.get();return t?e.isOption?"<b>Click</b> to clear this option":(t>0?"Showing only":"Hiding")+" "+e.tooltip+".\n<b>Click</b> to clear this "+(e.isOption?"option":"filter."):e.isOption?e.tooltip:"<b>Click</b> to "+(e.initialValue>0?"show only ":"hide ")+e.tooltip+(t!==-e.initialValue?".\n<b>"+E.a.priModKey+" + click</b> to "+(e.initialValue<0?"show only ":"hide ")+e.tooltip+".":"")}},{key:"setupFilters",value:function(e,t){for(var n=0,r=[],i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i],o=a.name,s=t?t[o]:void 0,u=a;u.value=new z.a(isNaN(s)?a.defaultValue||0:s),u.enabled=new z.a(void 0===a.enabled||a.enabled);try{f.default.PAssert(2682,!this.hasOwnProperty("filter_"+o),"Should not double define filter properties")}catch(l){f.default.reportError(l)}this["filter_"+o]=u,r.push(u)}this.filters=r}},{key:"setFilterEnabled",value:function(e,t){var n=this.filters.indexOfWithProperty("name",e);n>=0&&this.filters[n].enabled.set(t)}},{key:"getValue",value:function(){return this.value}},{key:"isFiltered",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.filters[t].value.get())return!0}return!1}},{key:"isFilteredOn",value:function(e){return 0!==this.getFilterValue(e)}},{key:"getRemoteValue",value:function(){for(var e=0,t=this.value,n=0;n<this.filters.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this.filters[n];if(r.remoteStringFn&&r.enabled.get()){var i=r.remoteStringFn(r.value.get());i&&(t+=" "+i)}}return t.trim()}},{key:"getState",value:function(){for(var e=0,t={text:this.getValue(),showHierarchy:this.showHierarchy()},n=0;n<this.filters.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this.filters[n];t[r.name]=r.value.get()}return t}},{key:"focus",value:function(){this.UI.focus()}},{key:"blur",value:function(){this.UI.blur()}},{key:"onParsed",value:function(e){this.tags=e.tags,this.contacts=e.contacts}},{key:"setValue",value:function(e,t){this.updatingValue=this.value!==e,this.updatingValue&&this.pane.clearPerPaneStateSearch(),this.updateHistory(t),this.value=e,this._updateSearchArr(),this.pane.scrollToStartOnSearch&&this.pane.scrollToIndex(0,"start"),this.totalNumItems>5e3?f.default.timeoutOnce("searchDebounce",this.update,150,!0):this.update(!0),e&&I.default.onIntroAction("Search"),this.updatingValue=!1}},{key:"addToValue",value:function(e){var t=this,n=this.getSelectionOffset(),r=this.value;r.length>0&&"-"!==r[r.length-1]&&"!"!==r[r.length-1]&&(e=" "+e),r+=e,this.setValue(r),P.a.isKeyboardOpen&&requestAnimationFrame((function(){t.setSelectionOffset(n+e.length)}))}},{key:"toggleText",value:function(e,t){var n=this,r=this.value.trim(),i="\\B(-*)("+f.default.escapeRegExp(e.toLowerCase())+")\\b",a=r.toLowerCase().match(i);a?r=(r.substr(0,a.index)+r.substr(a.index+a[0].length)).replace(/  +/g," "):r+=" "+(t?"-":"")+e,r=r.trim(),this.setValue(r),requestAnimationFrame((function(){n.setSelectionOffset(r.length)}))}},{key:"getSelectionOffset",value:function(){return this.UI.getSelectionOffset()}},{key:"setSelectionOffset",value:function(e){this.UI.setSelectionOffset(e)}},{key:"getSearchBox",value:function(){return this.UI.refSearchBox}},{key:"isSearched",value:function(){var e=0;if(this.value.length>0)return!0;for(var t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.filters[t];if(n.enabled.get()&&n.value.get())return!0}}},{key:"reset",value:function(){this.setValue("")}},{key:"resetFilters",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.filters[t];n.isOption||n.value.set(n.defaultValue)}this.update(!0,!0)}},{key:"numUnmatchedItems",value:function(){var e=this,t=0,n={item:this.pane.getItem(),pane:this.pane,each:function(n){var r=n.id,i=e.matches[r];i!==Z.No&&i!==Z.Negated||t++}};return f.default.searchVMLIs(n),t}},{key:"isMatchStateMatch",value:function(e){return void 0===e||e===Z.Yes||e===Z.ChildYes||e===Z.Unknown}},{key:"isMatchedHeader",value:function(e){return this.isMatched(e,{isHeaderSearch:!0})}},{key:"isMatchedSimple",value:function(e){return this.isMatchStateMatch(this.matches[e])}},{key:"isMatched",value:function(e,t){if(e.isRoot)return!0;if(this.pane.supportLocalSearch){var n=this.matches[e.id];return((null===t||void 0===t?void 0:t.forceCheck)||!(null===t||void 0===t?void 0:t.noCheck)&&void 0===n&&e.hasText()&&!this.pane.isSettingTextFromInput&&((null===t||void 0===t?void 0:t.isHeaderSearch)||this.pane!==f.default.focusedPane))&&(n=this.checkItem(e)),(null===t||void 0===t?void 0:t.isYes)?n===Z.Yes:this.isMatchStateMatch(n)}return!0}},{key:"handleItemChanged",value:function(e){if(I.default.PaneManager.isPaneActive(this.pane.id)){var t,n=this.isMatched(e,{noCheck:!0});if(e.parent()?(this.checkItem(e),t=this.isMatched(e)):t=!1,!t&&n&&(this.isMatchStuck(e)||this.stickMatchAfterSearch(e,!0)),t!=n)return!0}}},{key:"handleItemTextChanged",value:function(e){if(this.getValue()||this.isFiltered())return this.handleItemChanged(e)}},{key:"_updateSearchArr",value:function(){var e=J.a.getSearchArr(this.value),t=e.searchArr,n=e.searchWords;this.searchArr=t,this.searchWords=n}},{key:"toggleFilterDefault",value:function(e){var t=this["filter_"+e],n=t.value.get();n=n?0:t.initialValue,this.setFilter(e,n)}},{key:"toggleFilter",value:function(e,t){var n=t?-1:1,r=this["filter_"+e].value.get();r=r===n?0:n,this.setFilter(e,r)}},{key:"getFilter",value:function(e){return this["filter_"+e]}},{key:"getFilterObs",value:function(e){var t=this["filter_"+e];return t?t.value:void 0}},{key:"getFilterValue",value:function(e){var t=this["filter_"+e];return t?t.value.get():void 0}},{key:"setFilter",value:function(e,t,n){this.updateHistory(),"showOnlyMatches"===e&&this.clearListCache(),this["filter_"+e].value.set(t,n),this.pane.scrollToIndex(0,"start"),this.update(!0,!0),I.default.onIntroAction("Search")}},{key:"update",value:function(e,t,n,r){var i=this;this.isRunningSearch=!0,I.default.PaneUpdateBatcher.beginUpdateItems(),(e||t)&&this.clearStickyMatches(),this.pane.supportLocalSearch&&(this.prevMatches=this.matches,this.matches={},this.isAnimatingSearch=n&&!e&&f.default.focusedPane===this.pane,this.checkChildren(),this.prevMatches={}),this.isUpdatingSearch=!0,this.pane.isLoaded&&e&&this.onChanged.notify(t),I.default.PaneUpdateBatcher.commitUpdateItems(),setTimeout((function(){i.isUpdatingSearch=!1}),0),this.isRunningSearch=!1}},{key:"clearStickyMatches",value:function(){this._stickyMatchesAwaitingClear=[],this._stickyMatches={},clearTimeout(this._timeoutHideNonMatches)}},{key:"_isMatchStateOk",value:function(e){return e===Z.Yes||e===Z.Unknown||e===Z.ChildYes}},{key:"_matchFilter",value:function(e,t){if(e)return t?e>0?Z.Unknown:Z.Negated:e>0?Z.No:Z.Unknown}},{key:"_matchFilters",value:function(e){for(var t=0,n=Z.Unknown,r=0;r<this.filters.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.filters[r];if((i.matchFn||i.matchFnBoolean)&&i.enabled.get()){var a=i.value.get();if(0!==a){var o=i.matchFnBoolean?this._matchFilter(a,i.matchFnBoolean(e)):i.matchFn(a,e);o===Z.Unknown||o!==Z.Negated&&!this._isMatchStateOk(n)||(n=o)}}}return n===Z.Yes&&(n=Z.Unknown),n}},{key:"_matchFnComplete",value:function(e,t){return"Completed"===this.pane.getSortModeBlocks()&&(e=1),this._matchFilter(e,t.isComplete())}},{key:"_matchFnStarred",value:function(e){return e.isStarred()}},{key:"_matchFnProject",value:function(e){return e.isPrefixHeader()}},{key:"_matchFnTask",value:function(e){return e.isPrefixTask()}},{key:"_matchFnPriority",value:function(e,t){var n=t.getPriority();return e>0?n>=e?Z.Yes:Z.No:Z.Unknown}},{key:"_matchFnEmail",value:function(e,t,n){var r=t.getAttachments(),i=r&&r[0],a=i&&i.getPlugin()===I.default.pluginManager.getPluginGmail();return this._matchFilter(e,a)}},{key:"isDateInRange",value:function(e){for(var t=0,n=!0,r=0;r<this.searchArr.length;r++){var i=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var a=this.searchArr[r],o=void 0,s=0;s<a.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=a[s],l=u.dateInfo,c=u.isNegated;if(l){var d=l.prefix,h=l.date,f=l.date2;"overdue"===h&&(d="before",h=$.a.getToday()),"any"===h?o=!0:"none"===h?o=!1:"before"===d?o=e<h:"date"===d?o=$.a.isSameDay(e,h):"after"===d?o=e>=h:"between"===d&&(o=e>=h&&e<=f),c&&(o=!o),o||(n=!1)}}if(o)return!0}return n}},{key:"checkItem",value:function(e,t){var n,r,i=this,a=t?t.root:this.pane.getRootItem(),o=t?t.showHierarchy:this.showHierarchy(),s=this.matches,u=e.isNote(),l=e.parent();if(e.isDestroyed())return n=Z.No;try{f.default.PAssert(2683,l||e.isRootItem(),"Item parent does not exist while being searched",e===a)}catch(m){f.default.reportError(m)}if(this._stickyMatches[e.id])n=this._stickyMatches[e.id].matchState;else if(e.isRootItem())n=Z.Yes;else if(l)if(s[l.id]===Z.Negated)n=Z.Negated;else{var c=e.getSearchText(this.pane),d=(n=this._matchFilters(e))===Z.Negated;if(this.isMatchStateMatch(n)&&this.searchArr.length){var p=this._checkMatchTextImpl((function(t){return J.a.checkItemText(e,c,t,i.pane)}),o,e,a);if(d=p.hasNegated,(n=p.matchState)===Z.Yes&&this.updatingValue&&this.getValue()){var g=0;for(r=l;r;){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;r.isCollapsed(this.pane,!1,!0)&&this.pane.setPerPaneState(r.id,h.a.PerPaneStateField.CollapsedSearch,!1),r=r.parent()}}}if(n===Z.Unknown&&(n=Z.Yes),!d&&this.pane.shouldSearchMatchParents&&l!==a&&o&&(s[l.id]===Z.Yes||this._stickyMatches[l.id]))return s[e.id]=Z.Yes,s[e.id];n===Z.No&&u&&(n=s[l.id]),n===Z.No&&e._itemsLinked&&e._itemsLinked.some((function(e){return i.isMatched(e,{forceCheck:!0})}))&&(n=Z.Yes)}else n=Z.No;if(this.isMatchStateMatch(n)&&this.onlyMatchDates&&!this.pane.isOkOnAgenda(e)&&(n=Z.No),n===Z.Yes){if(o){var v=0;for(r=l;r&&!r.isRootItem()&&s[r.id]!==Z.Negated&&s[r.id]!==Z.Yes;){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;s[r.id]=Z.ChildYes,r.hasNote()&&(s[r.getNote().id]=Z.Yes),r=r.parent()}}u&&(s[l.id]=Z.Yes)}return s[e.id]=n,s[e.id]}},{key:"setMatchState",value:function(e,t){this.matches[e]=t}},{key:"_checkMatchTextImpl",value:function(e,t,n,r){var i;var a=[],o=0;if(this.searchArr.length){for(var s=0,u=0;u<this.searchArr.length;u++){var l=0;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;for(var c=this.searchArr[u],d=0;d<c.length;d++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=c[d];if(h.isNegated){var p=h;try{f.default.PAssert(2684,p,"Each value in the search array should be valid at this point")}catch(E){f.default.reportError(E)}if(e(h)){a[u]=Z.Negated,o++;break}}}}if(o===this.searchArr.length&&(i=Z.Negated),this.isMatchStateMatch(i)){for(var g=0,v=0;v<this.searchArr.length;v++){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(a[v]!==Z.Negated)for(var m=0,y=this.searchArr[v],_=0;_<y.length;_++){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var b=y[_],w=b.text;try{f.default.PAssert(2685,w,"Each value in the search array should be valid at this point")}catch(E){f.default.reportError(E)}if(!b.isNegated)if(e(b))a[v]=Z.Yes;else if(t)for(var k=0,S=n;S;){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;if(!(S=S.parent())||S===r){a[v]=Z.No;break}if(J.a.checkItemText(S,S.getSearchText(),b,this.pane))break}else a[v]=Z.No;if(a[v]===Z.No)break}}i=J.a.orMatchStates(a)}}return{hasNegated:o>0,matchState:i}}},{key:"checkItemSimple",value:function(e,t){var n=this,r=this._matchFilters(e);if(this.isMatchStateMatch(r)){var i=t.filter((function(e){return!!e})).map((function(e){return n._checkMatchTextImpl((function(t){return null===e||void 0===e?void 0:e.includes(t.text)})).matchState}));r=J.a.orMatchStates(i)}this.matches[e.id]=r}},{key:"checkChildrenParams",value:function(e,t){var n=this.checkItem(e,t);return this.totalNumItems++,n!==Z.Negated}},{key:"checkChildren",value:function(){var e=this;if(this.pane.usesVMLIs){this.totalNumItems=0;var t={item:void 0,includeNotes:!0,comparator:this.checkChildrenParams,comparatorOptions:{root:this.pane.getRootItem(),showHierarchy:this.showHierarchy()}};this.itemStoreFilter&&(t.itemStoreFilter=this.itemStoreFilter),this.pane.getItemStore()!==I.default.itemStoreManager.getDefaultItemStore()?t.itemStore=this.pane.getItemStore():t.item=this.pane.getItem(),f.default.searchVMLIs(t),this.isAnimatingSearch&&Object.keys(this.matches).forEach((function(t){var n=e.prevMatches[t];if(void 0!==n&&e.isMatchStateMatch(n)&&!e.isMatchStateMatch(e.matches[t])){var r=W.a.getItem(t);r&&!e.isMatchStuck(r)&&e.stickMatchAfterSearch(r,n)}}))}else this.pane.checkChildren()}},{key:"setIsMatch",value:function(e,t){this.matches[e]=t?Z.Yes:Z.No}},{key:"_getMatchedItem",value:function(e){return this._stickyMatches[e.id]||e}},{key:"getItemDate",value:function(e){var t=this._stickyMatches[e.id];return t&&t.date}},{key:"getItemDuration",value:function(e){var t=this._stickyMatches[e.id];return t&&t.duration}},{key:"getItemTagsLower",value:function(e){var t=this._stickyMatches[e.id];return t&&t.tagsLower}},{key:"getItemContacts",value:function(e){var t=this._stickyMatches[e.id];return t&&t.contacts}},{key:"getItemSearchText",value:function(e){var t=this._stickyMatches[e.id];return t&&t.searchText}},{key:"getItemPrefix",value:function(e){var t=this._stickyMatches[e.id];return t&&t.prefix}},{key:"getItemPriority",value:function(e){var t=this._stickyMatches[e.id];return t&&t.priority}},{key:"getItemStarred",value:function(e){var t=this._stickyMatches[e.id];return t&&t.isStarred}},{key:"stickMatch",value:function(e,t){if(!this._stickyMatches[e.id]){var n=e.getStickySearchInfo();n.matchState=this.matches[e.id],t&&(n.isHiding=!0),f.default.isInCompleteAction()&&(n.wasCompleted=!0),this.matches[e.id]=Z.ChildYes,this._stickyMatches[e.id]=n,e.itemChanged.notify()}}},{key:"isMatchStuck",value:function(e){return!!this._stickyMatches[e.id]}},{key:"unstickMatch",value:function(e){var t=this._stickyMatches[e.id];if(t){var n=e.getStickySearchInfo();return delete this._stickyMatches[e.id],!f.default.deepEqual(t,n)}return!1}},{key:"unstickAllMatches",value:function(){this._stickyMatches={}}},{key:"isMatchStuckHiding",value:function(e){var t=this._stickyMatches[e.id];return t&&t.isHiding}},{key:"stickMatchAfterSearch",value:function(e,t){this.stickMatch(e,!0),t&&(this._timeoutHideNonMatches&&clearTimeout(this._timeoutHideNonMatches),this._stickyMatchesAwaitingClear.push(e),this._timeoutHideNonMatches=setTimeout(this.hideNonMatches,1500))}},{key:"hideNonMatches",value:function(){var e=this;if(!this._destroyed){var t=this.pane,n=this._stickyMatchesAwaitingClear,r=n.length,i=0;if(r>0){for(var a=0,o=0;o<r;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=n[o],u=this._stickyMatches[s.id];u&&u.wasCompleted&&i++,this.unstickMatch(s)}var l=r+(r>1?" items":" item"),c={hold:!1};this.pane===f.default.focusedPane&&(i!==r?(c.text=l+" hidden because "+(r>1?"they do":"it does")+" not match search",c.actionText="UNHIDE",c.action=function(){if(t&&t.setIgnoreRestoreScroll){var i=0,a=P.a.save();t.setIgnoreRestoreScroll();for(var o=0;o<r;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n[o];e.stickMatch(s),e._stickyMatchesAwaitingClear.push(s)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),P.a.restore(a)}}):(c.text=l+" completed",c.actionText="UNDO",c.action=function(){var i=0,a=P.a.save();t.setIgnoreRestoreScroll();for(var o=0;o<r;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n[o].setComplete(!1,h.a.ChangeType.Local)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),P.a.restore(a)}),I.default.toasts.pushMessage(c));var d=P.a.save();this._stickyMatchesAwaitingClear=[],t.setIgnoreRestoreScroll(),t.updateItemsImmediate(!0,void 0,void 0,!0),d&&d.pane===this.pane&&P.a.restore(d)}}}},{key:"showHierarchy",value:function(){return this.pane.type!==h.a.PaneMode.Task||1!==this.getFilterValue("showOnlyMatches")}},{key:"setShowHierarchy",value:function(e){this.pane.supportSearchFlat&&this.setFilter("showOnlyMatches",e?0:1)}},{key:"showOnlyAgendaDates",value:function(){return this.pane.type===h.a.PaneMode.Task&&this.getFilterValue("showOnlyAgendaDates")}},{key:"showOnlyMatchingTags",value:function(){return this.pane.type===h.a.PaneMode.Task&&this.getFilterValue("showOnlyMatchingTags")}},{key:"showChildProjects",value:function(){return this.pane.type===h.a.PaneMode.Task&&this.getFilterValue("showChildProjects")}},{key:"clearListCache",value:function(){this.pane.listManager.clearCache()}},{key:"getTags",value:function(){return this.tags}},{key:"getContacts",value:function(){return this.contacts}},{key:"getSearchWords",value:function(){return this.searchWords}},{key:"shouldHighlightSearch",value:function(){return this.isFocused.get()&&this.getValue()}},{key:"isSearchingDate",value:function(){return this.searchArr.some((function(e){return e.some((function(e){return!!e.dateInfo}))}))}},{key:"onRemoteUpdate",value:function(e,t){var n=!1;this.filters.forEach((function(t){e[t.name]!==t.value.get()&&(n=!0,t.value.set(e[t.name]))})),e.text!==this.getValue()&&(this.setValue(e.text,t),n=!1),n&&this.update(!0,!0)}},{key:"updateHistory",value:function(e){var t=this;e?f.default.clearTimeoutOnce("searchDebounceHistory"):(this._previousStateForHistory||(this._previousStateForHistory=this.getState()),f.default.timeoutOnce("searchDebounceHistory",(function(){var e;null===(e=t.pane)||void 0===e||e.pushHistory({search:t._previousStateForHistory}),t._previousStateForHistory=void 0}),1e3))}},{key:"updateAutocomplete",value:function(){this.UI.updateAutocomplete()}}]),e}(),c()(V.prototype,"isMatchedHeader",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"isMatchedHeader"),V.prototype),c()(V.prototype,"isMatchedSimple",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"isMatchedSimple"),V.prototype),c()(V.prototype,"isMatched",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"isMatched"),V.prototype),c()(V.prototype,"handleItemTextChanged",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"handleItemTextChanged"),V.prototype),c()(V.prototype,"update",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"update"),V.prototype),c()(V.prototype,"_matchFnComplete",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"_matchFnComplete"),V.prototype),c()(V.prototype,"_matchFnStarred",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"_matchFnStarred"),V.prototype),c()(V.prototype,"_matchFnProject",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"_matchFnProject"),V.prototype),c()(V.prototype,"_matchFnTask",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"_matchFnTask"),V.prototype),c()(V.prototype,"_matchFnPriority",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"_matchFnPriority"),V.prototype),c()(V.prototype,"_matchFnEmail",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"_matchFnEmail"),V.prototype),c()(V.prototype,"checkChildrenParams",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"checkChildrenParams"),V.prototype),c()(V.prototype,"hideNonMatches",[d.a],Object.getOwnPropertyDescriptor(V.prototype,"hideNonMatches"),V.prototype),V),te=n(46),ne=n(68),re=n(58),ie=0,ae=["collapser","itemParents","itemCheckbox","agendaTime","itemMenuIcon","vertLines","itemTime"],oe=(H=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o()(this,e),this.__ISPANE=!0,T.a.binder(this,"getItems","getHeaders","updateItems","getWidth","getHeight","onShowArchivedChanged","zoomInOnSwipe","collapseOnSwipe","deleteOnSwipe","completeOnSwipe","onClickRefreshData","onClickRefreshDataForce","getSwipeMenuItems","getMinItemSize","toggleCollapseAll","onTapClosePane"),this.title=r.title,this._createProps(r,{contextMenuMode:"Normal",paneEmptyMessage:"Start typing to get started",paneEmptySearchMessage:"No search results",titleContextMenuHeader:"Zoom to item",searchFilters:[],dropEffect:function(){return h.a.DropEffect.Move},isWriteable:!0,isEditable:!1,isDraggable:!0,isDropTarget:!0,hasNonVMLIs:!1,canAddItem:!0,overrideCopyBehavior:!0,supportMenuIcon:!1,supportCollapsing:!0,supportCompleting:!0,supportCheckbox:!1,supportIndent:!0,supportOffline:!0,supportPerformArchive:!0,supportDataRefresh:!1,supportReportError:!1,supportCompose:!1,supportPagination:!1,supportVertLines:!0,supportStarClick:!1,supportSearchItemAutocomplete:!0,supportSearchListenTextChanges:!0,supportSearchFlat:!0,supportLocalSearch:!0,supportClone:!0,supportDates:!0,supportMultiselect:!0,supportDeferredItemLoad:!1,supportCellTransition:!0,supportViewMenu:!1,supportHistory:!1,supportSel:!0,shouldSearchMatchParents:!0,shouldUpdateOnTextChanged:!0,noOverviewStyle:!1,supportClickOverviewScroll:!0,overviewTracksScroll:!0,overviewHasPaneItems:!0,overviewPadLevels:0,minWidth:h.a.StdPaneWidthMin,minWidthFlex:h.a.StdPaneWidthMin,maxWidth:h.a.PaneWidthMax,maxWidthFlex:h.a.StdPaneWidthMax,maxWidthSingle:h.a.StdPaneWidthMax,widthBiggerInSingle:!0,collapsedFieldName:h.a.PerPaneStateField.Collapsed,supportsDocuments:!0,overviewCanTrackScroll:!1,usesVMLIs:!0,scrollToStartOnSearch:!0,_topBoxHeight:36}),this.blockNoKey="",this.history=new G.a,this._cachedMaxWidths={},this.topBoxHeight=new z.a(this._topBoxHeight),this.rect=new z.a(t.rect),this.isExpanded=new z.a(!1);try{f.default.PAssert(2555,void 0!==t.id,"Must supply a valid pane id")}catch(u){f.default.reportError(u)}if(this.id=t.id,this.uniquePaneID=ie++,this.isFakePane=t.isFakePane,this.plugin=t.plugin,t.document&&f.default.isString(t.document)&&(t.document=W.a.getDocumentById(t.document)),this.documentSortMode=new z.a(t.documentSortMode||"Modified",this.saveState),!t.item&&this.usesVMLIs)if(this.supportDeferredItemLoad&&t.deferredItemID){var i;t.item=this.getDeferredItem(t.deferredItemID)||(null===(i=t.document)||void 0===i?void 0:i.getRootItem()),this.deferredItemState={itemID:t.deferredItemID,search:t.search,offset:0}}else{var a;if(this.supportsDocuments)t.item=null===(a=t.document)||void 0===a?void 0:a.getRootItem();else t.item=this.getDefaultDisplayItem();t.search=t.search||""}this.name=new z.a(t.name),this.item=new z.a(t.item),this.items=new G.a,this.headersArr=[],this.headerPaneObjects=new G.a,this.paneObjects={},this.paneObjectsByItem={},this.paddingTop=new z.a,this.searchingPaneObjects=new re.a({text:""}),this.isSearchingGlobal=new z.a,this.document=new ne.a([this.item],(function(){var e,t;return null===(e=n.item.get())||void 0===e||null===(t=e.getDocumentOwner)||void 0===t?void 0:t.call(e)})),this.isDefaultPane=t.isDefaultPane,this.initialScrollIndex=t.scrollIndex,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.onDestroyed=new X.a,this.showArchived=new z.a(!1),this.onItemPreloadUpdated=new X.a,this._panePadding=0,this.paneTopText=new z.a,this.toast=new z.a,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new z.a(!1),this.isFocused=new z.a(!1),this.widthManual=t.widthManual,this.widthManualExpanded=t.widthManualExpanded,this.isReady=new z.a(!this.plugin||this.plugin.isReady()),this.isActive=new z.a(!0),this.hasBeenActive=this.isActive.get(),this.hasCollapsedObs=new z.a;var s={pane:this};this.listManager=new S(s),this.isLoadingNewPage=new z.a(!1),this.orientation=new z.a("vertical"),this.showScrollbars=new z.a(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},this.showArchived.listen(this.onShowArchivedChanged),W.a.documentsArray.listen(this.onDocumentsChanged),this.search=new ee(this,t.search,this.onSearchChanged.bind(this)),this.overview=new Y(this,t.isOverviewVisible,t.isOverviewShowingContents),this.constructorExtra&&this.constructorExtra()}return u()(e,[{key:"_createProps",value:function(e,t){var n=this;Object.keys(t).forEach((function(r){n[r]=void 0!==e[r]?e[r]:t[r]}))}},{key:"init",value:function(){if(!this.__DIDINIT&&this.usesVMLIs){var e=this.getItem(!0);e&&this.setItem(e,!1,!1),this.plugin&&this.plugin.notifyPaneCreated(),this.history.push(this.getSaveInfo())}this.__DIDINIT=!0}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"getStats",value:function(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}}},{key:"becomeReal",value:function(){}},{key:"activate",value:function(){try{f.default.PAssert(2556,!1,"Activating panes should only ever happen on mobile devices")}catch(e){f.default.reportError(e)}this.isActive.get()||(this.isActive.set(!0),this.hasBeenActive=!0,this.updateItemsImmediate(!0,!1))}},{key:"deactivate",value:function(){try{f.default.PAssert(2557,!1,"Deactivating panes should only ever happen on mobile devices")}catch(e){f.default.reportError(e)}this.isActive.set(!1)}},{key:"unload",value:function(){this._isUnloaded=!0}},{key:"isUnloaded",value:function(){return this._isUnloaded}},{key:"destroy",value:function(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(),this.showArchived.unlisten(this.onShowArchivedChanged),W.a.documentsArray.unlisten(this.onDocumentsChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this.onUnload();try{f.default.PAssert(2558,f.default.focusedPane!==this,"Globally focused pane should never be the one destroyed")}catch(e){f.default.reportError(e)}try{f.default.PAssert(2559,P.a.getPane()!==this,"Selection focused pane should never be the one destroyed")}catch(e){f.default.reportError(e)}try{f.default.PAssert(2560,!I.default.PaneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}catch(e){f.default.reportError(e)}this.onDestroyed.notify()}},{key:"notifyPluginLoaded",value:function(){try{f.default.PAssert(2561,!1,"Plugin load notification not supported by pane type: ",this.type)}catch(e){f.default.reportError(e)}}},{key:"getContextMenuMode",value:function(){return this.contextMenuMode}},{key:"isItemDraggable",value:function(){return this.isDraggable}},{key:"isOkOnAgenda",value:function(e){return!1}},{key:"getItemStore",value:function(){return this.getRootItem().getItemStore()}},{key:"usesItemStore",value:function(e,t){return!(this.supportsDocuments&&this.getRootItem()&&e===this.getItemStore()&&t&&t.getDocumentOwner()!==this.getDocument())&&(e===this.getItemStore()||!!this._activeItemStores[e.id])}},{key:"useItemStore",value:function(e){try{f.default.PAssert(2562,!this._activeItemStores[e.id],"Should never use the same store twice")}catch(t){f.default.reportError(t)}this._activeItemStores[e.id]=e}},{key:"stopUsingItemStore",value:function(e){try{f.default.PAssert(2563,this._activeItemStores[e.id],"Must be using item store to stop using it")}catch(t){f.default.reportError(t)}delete this._activeItemStores[e.id]}},{key:"getOverview",value:function(){return this.overview}},{key:"isOverviewVisible",value:function(){var e;return null===(e=this.overview)||void 0===e?void 0:e.isVisible.get()}},{key:"numItems",value:function(){return this.getItems().length}},{key:"numHeaders",value:function(){return this.headersArr.length}},{key:"getItems",value:function(){return I.default.PaneUpdateBatcher.flushItemsUpdate(this),this.items.get()}},{key:"getHeaders",value:function(){return this.headerPaneObjects.get()}},{key:"itemAtIndex",value:function(e){var t;return null===(t=this.objectAtIndex(e))||void 0===t?void 0:t.item}},{key:"objectAtIndex",value:function(e){return this.getItems()[e]}},{key:"objectAtIndexWithoutFlushing",value:function(e){return this.items.get()[e]}},{key:"indexOfItem",value:function(e,t,n){var r,i;return null!==(r=null===(i=this.findItem(e,t,n))||void 0===i?void 0:i.index)&&void 0!==r?r:-1}},{key:"findItem",value:function(e,t,n){var r=0;for(var i,a=this.getItems(),o=this.isViewAutoBlocks(),s=0;s<a.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=a[s];if(o){if(u.item===e)return u}else u.item===e&&(i||(i=[]),i.push(u))}if(i){if(n){for(var l,c,d=0,h=0;h<i.length;h++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=Math.abs(i[h].index-n);(isNaN(c)||f<l)&&(c=h,l=f)}return i[c]}return i[0]}}},{key:"indexOfTop",value:function(){return this.listManager.indexOfTop()}},{key:"elementAtIndex",value:function(e){return this.listManager.getElementByIndex(e)}},{key:"addScrollListener",value:function(e){this.listManager.addScrollListener(e)}},{key:"removeScrollListener",value:function(e){this.listManager.removeScrollListener(e)}},{key:"scrollIndexIntoView",value:function(e,t){this.scrollToIndex(e,"auto",t)}},{key:"scrollItemIntoView",value:function(e,t){this.scrollToItem(e,"auto",t)}},{key:"scrollIndexToTop",value:function(e,t,n){this.scrollToIndex(e,"start",t,n)}},{key:"scrollItemToTop",value:function(e,t){this.scrollToItem(e,"start",t)}},{key:"scrollIndexToMiddle",value:function(e,t){this.scrollToIndex(e,"center",t)}},{key:"scrollItemToMiddle",value:function(e,t){this.scrollToItem(e,"center",t)}},{key:"scrollToItem",value:function(e,t,n){var r=this.indexOfItem(e);this.scrollToIndex(r,t,n)}},{key:"scrollToIndex",value:function(e,t,n,r){this.listManager.scrollToIndex(e,t,n,r)}},{key:"addScrollDelta",value:function(e,t){var n=this.listManager.getScrollOffset()+Math.floor(e);return this.listManager.scrollToOffset(n,t)}},{key:"closestIndexOfObject",value:function(e){return e.index}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){return"Loading..."}},{key:"getStatusMessage",value:function(e){var t;return e||(this.isLoading.get()?t=this._getLoadingMessage():0===this.numItems()?t=this.isSearched()&&this._allPaneItems.length>0?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(t=this._getNotReadyStatus())),t}},{key:"_getNotReadyStatus",value:function(){return"Pane data is only available while online."}},{key:"getSaveInfoForClone",value:function(){var e=this.getSaveInfo();for(var t in delete e.id,e)e.hasOwnProperty(t)&&f.default.isObject(e[t])&&(e[t]=f.default.clone(e[t]));return e}},{key:"getSaveInfo",value:function(){var e,t=this.document.get(),n=this.listManager.getScrollIndex();return n<0&&(n=this.initialScrollIndex),{id:this.id,name:this.name.get(),item:null===(e=this.item.get())||void 0===e?void 0:e.id,document:t?t.id:void 0,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),scrollIndex:n,itemState:this.getSaveInfoItemState(),isOverviewVisible:this.overview.isVisible.get(),isExpanded:this.isExpanded.get(),widthManual:this.widthManual,widthManualExpanded:this.widthManualExpanded,documentSortMode:this.documentSortMode.get()}}},{key:"getSaveInfoItemState",value:function(){var e=this._perPaneState,t={};for(var n in e)if(e.hasOwnProperty(n)){var r=W.a.getItem(n);if(r){var i=e[n];for(var a in i)if(i.hasOwnProperty(a)&&a.startsWith(h.a.PerPaneStateField.Collapsed)){var o=i[a];if(void 0!==o){var s=a.replace(h.a.PerPaneStateField.Collapsed,"");if("Search"===s||o!==this.getCollapsedDefault(r,"Overview"===s,s)||!o&&r.isDemandLoad()){var u=(i[a]?"":"un")+a;t[u]||(t[u]=[]),t[u].push(n)}}}}else delete e[n]}return t}},{key:"saveState",value:function(e){I.default.PaneManager.updatePaneStateForPane(this,e)}},{key:"getPerPaneState",value:function(e,t){var n=this._perPaneState[e];if(n)return n[t]}},{key:"setPerPaneState",value:function(e,t,n){this._perPaneState[e]||(this._perPaneState[e]={}),this._perPaneState[e][t]=n}},{key:"clearPerPaneStateSearch",value:function(){var e=this._perPaneState;for(var t in e)e.hasOwnProperty(t)&&(e[t][h.a.PerPaneStateField.CollapsedSearch]=void 0)}},{key:"deletePerPaneState",value:function(e){this._perPaneState[e]=void 0}},{key:"isSearched",value:function(){try{f.default.PAssert(2566,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){f.default.reportError(e)}return!!this.search&&this.search.isSearched()}},{key:"isSearchedText",value:function(){try{f.default.PAssert(2567,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){f.default.reportError(e)}return!!this.search&&this.search.getValue()}},{key:"onSearchChanged",value:function(e){var t=P.a.isValid();if(t&&P.a.reset(),this.updateItems(),t&&this.numItems()>0){var n=this.indexOfFirstItem();n>=0&&P.a.selectIndex(n,0)}this.saveState()}},{key:"refreshSearchResults",value:function(){this.updateItems(!0)}},{key:"_applyItemStateArr",value:function(e,t,n){if(e)for(var r=0,i=0;i<e.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i];this.setPerPaneState(a,t,n)}}},{key:"applyItemState",value:function(e){var t=this;e&&(this._perPaneState={},Object.keys(e).forEach((function(n){var r=n.startsWith("un"+h.a.PerPaneStateField.Collapsed)?n.slice(2):n;if(r.startsWith(h.a.PerPaneStateField.Collapsed)){var i=e[n];t._applyItemStateArr(i,r,!n.startsWith("un"))}})))}},{key:"requestDemandLoadData",value:function(e){try{f.default.PAssert(2568,!1,"SubClass must override - by default demand load is not supported")}catch(t){f.default.reportError(t)}}},{key:"requestDataPage",value:function(e){try{f.default.PAssert(2569,!1,"SubClass must override - by default data pagination is not supported")}catch(t){f.default.reportError(t)}}},{key:"getDefaultDisplayItem",value:function(e){return this.getRootItem()}},{key:"getRootItem",value:function(){var e;return null===(e=this.document.get())||void 0===e?void 0:e.getRootItem()}},{key:"setRootItem",value:function(e,t){try{f.default.PAssert(2570,void 0===e.parent(),"Root should never have a parent")}catch(n){f.default.reportError(n)}try{f.default.PAssert(2571,this.getItem()!==e,"Should not be setting root to the same value")}catch(n){f.default.reportError(n)}this.setItem(e,t)}},{key:"scrollFromMousePosition",value:function(e,t,n){var r=n?this.getWidth():this.getHeight(),i=f.default.clamp(.1*r,20,80),a=i,o=n?this.getWidth():this.getHeight(),s=o-i,u=n?e-this.paneContent.getBoundingClientRect().left:t-this.contentTop(),l=0;u<a?l=Math.round(f.default.computeScrollSpeed(0,a,u,20,-1)):u>s&&(l=Math.round(f.default.computeScrollSpeed(s,o,u,20,1))),0!==l?f.default.repeatScrollPane(l,this):f.default.cancelRepeatScroll("pane")}},{key:"getContentElement",value:function(){return this.paneContent}},{key:"getPaneIcon",value:function(){return"icon-align-left"}},{key:"itemHasChildren",value:function(){return this.getItem().numItems()>0}},{key:"getItem",value:function(e){return this.item.get()}},{key:"allowZoom",value:function(e){return!0}},{key:"performOverviewAction",value:function(e){}},{key:"setItem",value:function(e,t,n,r){this._numItemSets++,p.a.disable();var i=this.getItem();this.item.set(e,!1),n||this.updateItemsImmediate(!0,!1,!0),te.a.beginBatch(),i&&i.parent()&&i._updateStylePadding(i.parent().levelsDeep.get(),!0),!r&&i&&i.id!==e.id&&this.pushHistory({item:i.id}),t&&(e.itemChanged.notify(),i&&e!==i&&i.itemChanged.notify(),this.item.notify(e,i)),te.a.endBatch()}},{key:"getItemSearchParams",value:function(){var e=this;return{item:this.getItem(),comparator:function(t){return e.search.isMatched(t)},noCollapsed:!0,includeNotes:!0,pane:this}}},{key:"getHeaderSearchParams",value:function(){return{item:this.getRootItem(),comparator:this.search.isMatchedHeader,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}},{key:"setItemsDirty",value:function(){this._setDirtyState(!1,!1)}},{key:"isItemsDirty",value:function(){return!!this.itemsDirtyState}},{key:"isItemsHeightDirty",value:function(){return this.itemsHeightDirty}},{key:"_setDirtyState",value:function(e,t){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=e||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=t||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:e,forceNotify:t}}},{key:"updateItems",value:function(e,t){this._setDirtyState(e,t),I.default.PaneUpdateBatcher.updateAllItems()}},{key:"updateItemsImmediate",value:function(e,t,n,r){var i=this;if(!this.isFakePane&&this.isActive.get()){this.itemsDirtyState&&(e=e||this.itemsDirtyState.updateSearch,t=t||this.itemsDirtyState.forceNotify,this.itemsDirtyState=void 0),f.default.shouldLog(h.a.LogLevels.React)&&f.default.log("update items"),this.search.isRunningSearch||this.search.update(void 0,void 0,!r);var a=this.getItem(),o=[],s=!1,u=this.getItemSearchParams();0,u.each=function(e){e.isNote()&&e.parent()===a||(o.push(e),s=s||e.isCollapsed(i))},this.runItemSearch(u),this._numItemComputes++,this.setItems(o,t),this.updateHeaders(t||n),this.updateCollapsedObs(s),this.isInitialized||(this.isInitialized=!0),this.itemsHeightDirty=!1,F.a.fireEvent("itemsUpdated",[this])}}},{key:"updateCollapsedObs",value:function(e){this.hasCollapsedObs.set(e)}},{key:"updateItemHeights",value:function(){this.itemsHeightDirty=!1,this.plugin||this.listManager.onListChanged()}},{key:"runItemSearch",value:function(e){f.default.searchVMLIs(e)}},{key:"updateOutline",value:function(e,t){var n,r=0,i=[],a={};if(t){var o=0,s=0,u=[];for(n=0;n<e.length;n++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e[n].isNote()||u.push({item:e[n],index:u.length})}for(u.sort(t),e=[],n=0;n<u.length;n++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=u[n].item;e.push(l)}}for(n=0;n<e.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=e[n];if(!c.isNote()){var d=new K.a({type:"blockItem",item:c,id:c.id,pane:this,index:i.length,parentObject:a[c.parent().id],sizeInPane:c.sizeInPane});a[c.id]=d,this.addPaneObject(i,d)}}this.items.set(i)}},{key:"_setItems",value:function(e,t){this.updateOutline(e)}},{key:"setItems",value:function(e,t){this._allPaneItems=e,this.paneObjects={},this.paneObjectsByItem={},this._setItems(e,t),P.a.getPane()===this&&P.a.checkValid()}},{key:"updateHeaders",value:function(e){var t=[];if(this.updateHeadersOverride)t=this.updateHeadersOverride();else{var n=this.getHeaderSearchParams();n.each=function(e){t.push(e)},f.default.searchVMLIs(n)}this._numHeaderComputes++,this.setHeaders(t,e)}},{key:"setHeaders",value:function(e,t){var n=this;this.headersArr=e;var r=e.map((function(e,t){return new K.a({type:"blockItem",item:e,id:e.id,pane:n,overview:!0,index:t,sizeInPane:h.a.OverviewItemHeightDesktop})}));this.headerPaneObjects.set(r)}},{key:"clearItems",value:function(e){this.items.set([],e)}},{key:"onLoad",value:function(){this.isLoaded=!0,this.onLoadExtra&&this.onLoadExtra(),this.isFakePane&&(this.isFakePane=!1,this.becomeReal())}},{key:"onUnload",value:function(){this.onUnloadExtra&&this.onUnloadExtra()}},{key:"getSize",value:function(){return{width:this.getWidth(),height:this.getHeight()}}},{key:"getWidth",value:function(){var e,t=this._cachedWidth;if(t=null!==(e=t)&&void 0!==e?e:this.rect.get().width,this.getWidthExtra){var n=this.getWidthExtra();void 0!==n&&(t+=n)}return t}},{key:"getHeight",value:function(){return this.rect.get().height-this.headerHeight()}},{key:"getItemHeight",value:function(){}},{key:"getLeft",value:function(){return this.rect.get().left}},{key:"toggleOverviewVisibility",value:function(){this.overview.toggle()}},{key:"notifyDropFrom",value:function(e,t){}},{key:"dropEffectCopyBehavior",value:function(e,t){return e.clone(t,h.a.ChangeType.Local)}},{key:"_isNodeTextParent",value:function(e){return ae.every((function(t){return!e.classList.contains(t)}))}},{key:"convertElementToText",value:function(e){var t="";if("TEXTAREA"===e.nodeName)t+=e.value;else if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(this._isNodeTextParent(e))for(var n=0,r=0;r<e.childNodes.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t+=this.convertElementToText(e.childNodes[r])}return t}},{key:"addItemToPane",value:function(e,t){var n=this.getItem();e.text||(e.text=""),this.setIgnoreRestoreScroll();var r=n.addItemAtIndex(e,t,this);return q.a.setSelected([t],this),r}},{key:"archiveItem",value:function(e,t){return t.archiveSelf(h.a.ChangeType.Local)}},{key:"archiveSelected",value:function(e){var t=this,n=0,r=this.indexOfPrevVMLI(P.a.getStartIndex(),!0);if(this.applyToSelection((function(e){t.archiveItem(!0,e),n++})),n>0){if(r<0&&this.numItems()>0&&(r=this.indexOfFirstItem()),r>=0){var i=this.itemAtIndex(r).getParsedText().length;P.a.selectIndex(r,i)}var a=n>1?" items.":" item.";I.default.toasts.pushMessage({text:"Archived "+n+a,action:h.a.MessageAction.Undo,hold:!1,timeout:8e3})}}},{key:"deleteSelected",value:function(e,t){var n=this;P.a.confirmDangerousSelection((function(){var t=n.indexOfPrevVMLI(P.a.getStartIndex(),!0),r=0;D.a.saveDeleteSelection();var i,a=[];n.applyToSelection((function(t){e&&!e(t)||t.isDeleted()||(r+=t.numChildrenRecursive()+1,a.push(t),i||(i=t.checkDeleteProblem()))}));var o=function(){if(D.a.beginAction(),I.default.PaneUpdateBatcher.beginUpdateItems(),a.forEach((function(e){e.deleteSelf(h.a.ChangeType.Local)})),I.default.PaneUpdateBatcher.commitUpdateItems(),D.a.endAction(),t<0&&n.numItems()>0&&(t=n.indexOfFirstItem()),t>=0){var e=n.itemAtIndex(t);if(e){var i=e.getParsedText().length;P.a.selectIndex(t,i)}else P.a.reset()}var o=r>1?" items.":" item.";I.default.toasts.pushMessage({text:"Deleted "+r+o,action:h.a.MessageAction.Undo,timeout:h.a.ToastTimeoutDefault})};i?I.default.menus.confirm("One of the selected items is ".concat(i,". Are you sure you want to delete?"),(function(e){e&&o()})):o()}))}},{key:"handleLeftSideTap",value:function(e,t){var n=e.item;if(this.supportCollapsing)if(E.a.mac&&t.metaKey||!E.a.mac&&t.ctrlKey)this.zoomIn(n);else if(n.isCollapsible()||e.isBlockHeader){var r=P.a.save(),i=!this.isPaneObjectCollapsed(e);t.shiftKey?this.collapseAll(n,i,!0):this.setPaneObjectCollapsed(i,e),r&&this.restoreSelectionAfterCollapse(r,i)}}},{key:"handleRightSideTap",value:function(e){this.supportCompleting&&(f.default.beginCompleteAction(),e.setComplete(!e.isComplete(),h.a.ChangeType.Local),f.default.endCompleteAction())}},{key:"onClickTitle",value:function(e){var t=this.getItem();return this.zoomOut(e),f.default.sendEvent("Menu","Title"),t!==this.getItem()}},{key:"isZoomed",value:function(){return this.getItem()!==this.getRootItem()}},{key:"onDoubleClickTitle",value:function(){this.toggleCollapseAll()}},{key:"addItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.index,e.prefix,e.text,e.toRoot}},{key:"onClose",value:function(){}},{key:"onTapAddItem",value:function(){this.addItem()}},{key:"onTapOverviewButton",value:function(){this.toggleOverviewVisibility(),this.isOverviewVisible()?f.default.sendEvent("Menu","OpenOverview"):f.default.sendEvent("Menu","CloseOverview")}},{key:"onTapClosePane",value:function(){var e=I.default.PaneManager.removePane(this);if(e){try{f.default.PAssert(2573,e===this.id,"Pane IDs must match")}catch(t){f.default.reportError(t)}f.default.sendEvent("Menu","ClosePane"),I.default.tooltip.hideTip(),this.onClose()}}},{key:"onClickArchiveCompleted",value:function(e){this.archiveCompleted(),f.default.preventAndStop(e),f.default.sendEvent("Menu","ArchiveCompleted")}},{key:"onClickRefreshData",value:function(e,t){try{f.default.PAssert(2574,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(n){f.default.reportError(n)}this.refreshPaneData(t),f.default.sendEvent("Menu","PaneDataRefresh"),f.default.preventAndStop(e)}},{key:"onClickRefreshDataForce",value:function(e){this.onClickRefreshData(e,!0)}},{key:"onClickReportError",value:function(e){try{f.default.PAssert(2575,this.supportReportError,"Pane does not support error reporting")}catch(t){f.default.reportError(t)}this.reportPaneError(),f.default.sendEvent("Menu","PaneReportError"),f.default.preventAndStop(e)}},{key:"refreshPaneData",value:function(e){W.a.isConnected()||I.default.toasts.pushMessage({text:"Your connection appears to be offline. Data will refresh when you go online."}),this._refreshPaneData(e)}},{key:"_refreshPaneData",value:function(e){}},{key:"reportPaneError",value:function(){}},{key:"getItemsToArchive",value:function(){var e=[];return f.default.searchVMLIs({item:this.getItem(),pane:this,each:function(t){t.isComplete()&&!t.isNote()&&e.push(t)}}),e}},{key:"archiveCompleted",value:function(){var e,t,n,r=0;if(P.a.isValid()){var i=0;for(t=P.a.getEndIndex();t<this.items.length();){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if((n=this.itemAtIndex(t))&&!this.itemAtIndex(t).hasCompletedAncestor()){e=this.objectAtIndex(t);break}t++}}var a=this.getItemsToArchive();for(I.default.PaneUpdateBatcher.beginUpdateItems(),t=a.length-1;t>=0;t--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n=a[t],f.default.shouldLog(h.a.LogLevels.Data)&&f.default.log("Archive Item: ",n.getParsedText()),n.archiveSelf(h.a.ChangeType.Local)}if(I.default.PaneUpdateBatcher.commitUpdateItems(),a.length>0){var o=a.length>1?" items.":" item.";I.default.toasts.pushMessage({text:"Archived "+(a.length+o),action:h.a.MessageAction.Undo,hold:!1,timeout:8e3})}else I.default.toasts.pushMessage({text:"No completed items to archive"});if(e){var s=e.index;if(s>=0){n=this.itemAtIndex(s);try{f.default.PAssert(2576,n,"Could not restore selection to item")}catch(l){f.default.reportError(l)}if(n){var u=n.getParsedTextWithoutPrefix().length;P.a.selectIndex(s,u)}}}else P.a.reset()}},{key:"bottomListMessage",value:function(){}},{key:"isSearchingRemote",value:function(){return!1}},{key:"getTitleList",value:function(){return this.usesVMLIs?this.getItem().parents().concat(this.getItem()):[]}},{key:"itemTitle",value:function(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem()}},{key:"titleOfFirstItem",value:function(){return this.getDocument().text.get()}},{key:"onShowArchivedChanged",value:function(){this.showArchived.get()&&F.a.fireEvent("showArchived",[]),this.updateItems()}},{key:"onDocumentsChanged",value:function(){this.supportsDocuments&&this.updateHeaders(!1)}},{key:"indexOfFirstItem",value:function(){return this.indexOfNextVMLI(-1)}},{key:"indexOfLastItem",value:function(){return this.indexOfPrevVMLI(this.numItems(),!1)}},{key:"getFirstItem",value:function(){var e=this.indexOfFirstItem();if(e>=0){var t=this.getItems()[e];return t?t.item:void 0}}},{key:"getFirstObject",value:function(){return this.objectAtIndex(this.indexOfFirstItem())}},{key:"getLastItem",value:function(){return this.itemAtIndex(this.indexOfLastItem())}},{key:"getLastObject",value:function(){return this.objectAtIndex(this.indexOfLastItem())}},{key:"setFocused",value:function(e){this.isFocused.set(e)}},{key:"findPaneObject",value:function(e){return I.default.PaneUpdateBatcher.flushItemsUpdate(this),this.paneObjects[e]}},{key:"headerHeight",value:function(){return 68}},{key:"handleUndo",value:function(){var e;(null===(e=this.search)||void 0===e?void 0:e.isFocused.get())||D.a.undo()}},{key:"handleRedo",value:function(){var e;(null===(e=this.search)||void 0===e?void 0:e.isFocused.get())||D.a.redo()}},{key:"contentTop",value:function(){return I.default.DesktopUI.topBarHeight()+this.headerHeight()}},{key:"restoreSelection",value:function(e){P.a.restore(e)}},{key:"restoreSelectionAfterCollapse",value:function(e,t){if(e){var n,r=P.a.getStartSelectionOfMap(e.selectedMap),i=r.start,a=r.paneObject,o=P.a.getEndSelectionOfMap(e.selectedMap),s=o.end,u=o.paneObject;if(a&&u)P.a.selectObjects(a,i,u,s);else if(a)P.a.selectObject(a,i),n=!0;else if(u)P.a.selectObject(u,s),a=u,n=!0;else if(t)for(var l=0,c=a.parentObject;c;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=this.findPaneObject(c.id);if(d){P.a.selectObject(d,-1),a=P.a.getStartObject(),n=!0;break}c=c.parentObject}else P.a.reset();a&&n&&f.default.focusedPane.scrollIndexToMiddle(a.index)}}},{key:"setCollapsedRecursive",value:function(e,t,n,r){var i=0,a=e.numChildren(),o=e.getItems();n&&(this.canCollapse()||this.search.isMatched(e))&&e.setCollapsed(t,this,r,!1);for(var s=0;s<a;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=o[s];(u.isCollapsed(this)||u.hasChildren()&&(this.isViewFlatList()||this.search.isMatched(u)))&&this.setCollapsedRecursive(u,t,!0,r)}}},{key:"collapseAll",value:function(e,t,n){try{f.default.PAssert(2577,this.supportCollapsing,"Should not be collapsing all")}catch(a){f.default.reportError(a)}var r=e||this.item.get(),i=P.a.save();this.setIgnoreRestoreScroll(),I.default.PaneUpdateBatcher.beginUpdateItems(),void 0!==t&&this.setCollapsedRecursive(r,t,!!n),this.saveState(),this.updateItems(),I.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelectionAfterCollapse(i,t)}},{key:"toggleCollapseAll",value:function(){if(this.supportCollapsing){var e=!this.hasCollapsed();this.collapseAll(this.item.get(),e)}}},{key:"hasCollapsed",value:function(){return this.hasCollapsedObs.get()}},{key:"onOverviewToggled",value:function(e){}},{key:"getPaddingForPaneObject",value:function(e){var t,n=e.overview;t=!n&&this.isViewFlatList()?I.default.DisplaySettings.itemIndentStart():I.default.DisplaySettings.getPaddingForLevel(e.levelsDeepNew(),n);var r=this.getWidth();return void 0===this.extraPaddingForPaneObject||n||(t+=this.extraPaddingForPaneObject(e)),t=Math.min(t,r-h.a.SPThresholdRight-8),I.default.settings.alignIndentToPrefix.get()&&(t-=h.a.PrefixWidth),t}},{key:"maxWidthOfPaneObject",value:function(e){var t=e.item,n=e.pane;var r=1e4*(t.hasPrefix()?1:0)+1e5*(t.isNote()?1:0)+e.levelsDeepNew();if(void 0===this._cachedMaxWidths[r]){var i,a=this.getPaddingForPaneObject(e);i=n.listManager?this.getWidth()-a-h.a.ItemPaddingRightVirtuoso:this.getWidth()-a-h.a.SPThresholdRight-(t.hasPrefix()?this.shouldRenderPrefix(e)?h.a.PrefixWidth:5:0),this._cachedMaxWidths[r]=Math.floor(Math.max(h.a.MinItemWidth,i))}return this._cachedMaxWidths[r]}},{key:"prevPaneObjectAtSameLevel",value:function(e){var t=0;try{f.default.PAssert(2578,e>=0,"Must supply a valid selection index: "+e)}catch(o){f.default.reportError(o)}try{f.default.PAssert(2579,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(o){f.default.reportError(o)}for(var n=this.objectAtIndex(e),r=e-1;r>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.objectAtIndex(r),a=this.itemAtIndex(r);if(a&&n.item!==a&&!a.isNote()&&i.levelsDeepNew()===n.levelsDeepNew())return i;r--}}},{key:"getSiblingsAfterPaneObject",value:function(e){for(var t=0,n=e.index,r=e.item,i=this.numItems(),a=[],o=n+1;o<i;o++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=this.objectAtIndex(o),u=s.item;if(!u||r===u||u.parent()!==r.parent())break;a.push(s)}return a}},{key:"getChildrenOfPaneObject",value:function(e){for(var t=0,n=e.item,r=e.index,i=this.numItems(),a=[],o=r+1;o<i;o++){var s;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var u=this.objectAtIndex(o);if(!(null===u||void 0===u||null===(s=u.item)||void 0===s?void 0:s.isDescendantOf(n)))break;a.push(u)}return a}},{key:"indexOfPrevVMLI",value:function(e,t){var n=0;try{f.default.PAssert(2580,e>=0,"Must supply a valid selection index: "+e)}catch(o){f.default.reportError(o)}try{f.default.PAssert(2581,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(o){f.default.reportError(o)}for(var r=t?this.itemAtIndex(e):void 0,i=e-1;i>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.itemAtIndex(i);if(a&&r!==a)return i;i--}return-1}},{key:"indexOfNextVMLI",value:function(e,t){var n=0;try{f.default.PAssert(2582,e>=-1,"Must supply a valid selection index: "+e)}catch(o){f.default.reportError(o)}try{f.default.PAssert(2583,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(o){f.default.reportError(o)}for(var r=t?this.itemAtIndex(e):void 0,i=e+1;i<this.numItems();){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.itemAtIndex(i);if(a&&r!==a)return i;i++}return-1}},{key:"indexOfPrevHeader",value:function(e){var t=0;try{f.default.PAssert(2584,e>=-1,"Must supply a valid selection index: "+e)}catch(i){f.default.reportError(i)}try{f.default.PAssert(2585,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(i){f.default.reportError(i)}for(var n=e-1;n>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.itemAtIndex(n);if(null===r||void 0===r?void 0:r.isPrefixHeader())return n;n--}return-1}},{key:"indexOfNextHeader",value:function(e){var t=0;try{f.default.PAssert(2586,e>=-1,"Must supply a valid selection index: "+e)}catch(i){f.default.reportError(i)}try{f.default.PAssert(2587,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(i){f.default.reportError(i)}for(var n=e+1;n<this.numItems();){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.itemAtIndex(n);if(null===r||void 0===r?void 0:r.isPrefixHeader())return n;n++}return this.numItems()-1}},{key:"findNextSiblingItem",value:function(e){var t=this.findPaneObject(e.id);if(t){for(var n,r=0,i=t.index,a=t.item,o=this.numItems(),s=i+1;s<o;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=(n=this.objectAtIndex(s)).item;if(u&&!u.isDescendantOf(a))break}return n}}},{key:"_getPrevNextItem",value:function(e,t,n){var r=n?this.indexOfNextVMLI:this.indexOfPrevVMLI,i=r.call(this,e);if(t)for(var a=0,o=this.itemAtIndex(e);i>=0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this.itemAtIndex(i);if(o.parent()===s.parent())return s;if(o.parent()===s||s.parent()===o.parent().parent()){i=-1;break}i=r.call(this,i)}else if(i>=0)return this.itemAtIndex(i)}},{key:"getPreviousItem",value:function(e,t){return this._getPrevNextItem(e,t,!1)}},{key:"getNextItem",value:function(e,t){return this._getPrevNextItem(e,t,!0)}},{key:"getFirstSelectedItem",value:function(){var e;return this.applyToSelection((function(t){return e=t,!1})),e}},{key:"getFirstSelectedIndex",value:function(){return P.a.getStartIndex()}},{key:"applyToSelection",value:function(e,t){P.a.forEach(e,t)}},{key:"applyFnToSelection",value:function(e,t){var n=P.a.save(),r=t&&t.toggle,i=!t||void 0===t.value||t.value,a=t&&void 0!==t.value2?t.value2:void 0;if(this.applyToSelection((function(t){r&&t[r]()!==i&&(r=void 0),r||t[e](i,a)})),r){var o=!(!t||void 0===t.emptyValue)&&t.emptyValue;this.applyToSelection((function(t){t[e](o,a)}))}n&&!t.noRestoreSel&&this.restoreSelection(n)}},{key:"applyPriorityToSelection",value:function(e,t){t?this.applyFnToSelection("setPriority",{toggle:"getPriority",value:e,value2:h.a.ChangeType.Local,emptyValue:h.a.VMLIFlag.None}):this.applyFnToSelection("setPriority",{value:e,value2:h.a.ChangeType.Local})}},{key:"autocompleteTag",value:function(){this._autocompletePopup({mode:"tag",text:"Add tag",buttonText:"Add"},(function(e,t){var n=t.value.trim(),r=e.getParsedText()+" "+h.a.TagPrefix+n;e.setText(r,h.a.ChangeType.Local)}))}},{key:"autocompleteMove",value:function(e,t){var n=this;(e=e||{}).mode="move",e.text="Select item to move to",e.documentSelector=!this.supportsDocuments,e.buttonText="MOVE",this._autocompletePopup(e,(function(e,t,r){var i;t.subItemText?(i=n.createVMLI({text:t.subItemText},{parent:t.item,changeType:h.a.ChangeType.AllLocal}),t.item.insertItem(i,0)):t.item===e||t.item.isDescendantOf(e)||(i=t.item),i&&!r.includes(e.parent())&&n.moveItem(e,i)}),(function(){t&&t(),P.a.updateCaret()}))}},{key:"autocompleteSchedule",value:function(e){var t=e.item,n=e.element;e.onClose;I.default.menus.openDate({element:n||P.a.getStartElement(),pane:this,onSelect:function(e){var n=I.default.pluginManager.getPlugin(h.a.PluginID.Gmail);f.default.isDateValid(e)?n.scheduleEmail(t,e):I.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:h.a.MessageAction.Okay})}})}},{key:"autocompleteLabel",value:function(e,t){var n,r=this,i=I.default.pluginManager.getPlugin(h.a.PluginID.Gmail),a=function(e){var t=e.getAttachmentByPlugin(i.id),r=t.getPlugin().getDisplayTags(t);n=n?f.default.arrayIntersection(n,r):r};(e=e||{}).item?a(e.item):this.applyToSelection(a),e.tokens=(n||[]).map((function(e){return{text:e}})),e.mode="gmailLabel",e.text="Select a label",e.buttonText="LABEL",e.allowCustom=!0,e.allowEmpty=!0,e.onTokenRemoved=function(n){var a=n.text;i.beginAction();var o=function(e){var t=e.getAttachmentByPlugin(i.id);if(t)if(i.attachmentHasLabel(t,a))i.performAction(h.a.PluginAction.Gmail.RemoveLabel,!1,t,a);else try{f.default.PAssert(2588,!1,"Tried to remove a tag from an attachment without a tag")}catch(n){f.default.reportError(n)}else I.default.toasts.pushMessage(h.a.MessageID.ReselectEmail)};e.item?o(e.item):r.applyToSelection(o),i.endAction(),t&&t(n)},this._autocompletePopup(e,(function(e,t){var n=t.value.trim();try{f.default.PAssert(2589,e.hasPluginAttachment(i.id),"Must have valid plugin attachment")}catch(o){f.default.reportError(o)}var r=e.getAttachmentByPlugin(i.id);if(r){if(n){var a=i.createLabelString(n);a?i.attachmentHasLabel(r,a)||i.performAction(h.a.PluginAction.Gmail.AddLabel,!1,r,a):I.default.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:h.a.MessageAction.Okay})}}else I.default.toasts.pushMessage(h.a.MessageID.ReselectEmail)}))}},{key:"_autocompletePopup",value:function(e,t,n){var r=this;if(!e.elementDisplay){var i=P.a.getSelectedObjects().find((function(e){return!!r.elementAtIndex(e.index)}));i&&(e.elementDisplay=this.elementAtIndex(i.index))}var a=e.item,o=e;o.pane=this,o.item||(o.item=this.getRootItem()),o.onSelected=function(e){a?t(a,e,[a]):r.applyToSelection((function(n,r,i,a,o){t(n,e,o)})),n&&n(e)},C.a.showPopup(o)}},{key:"moveItem",value:function(e,t){if(I.default.PaneUpdateBatcher.beginUpdateItems(),t.belongsToSameItemStore(e))e.moveTo({parent:t,index:0},h.a.ChangeType.Local);else{var n=this.dropEffectCopyBehavior(e,t);n.setParent(t),t.insertItem(n)}I.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"setPropDefault",value:function(e,t){void 0===this[e]&&(this[e]=t)}},{key:"setExpanded",value:function(e,t){var n=this,r=this.isExpanded.get()!==e;f.default.batchRenderUpdates((function(){n.isExpanded.set(e),r&&!1!==t&&(F.a.fireEvent("panesChanged",[]),n.saveState(),I.default.PaneManager.ensurePaneInView(n))}))}},{key:"modifyTextOnDropBasedOnSearch",value:function(e,t,n,r,i,a){var o=0;if(!n||!n.search)return e;var s,u,l=n.search,c=this.search,d=t[a](),h=l[a](),f=c[a](),p=[],g=[];for(s=0;f&&s<f.length;s++){var v=0;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;u=f[s];for(var m=r,y=!d||d.indexOf(u)<0;y&&m;){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var _=m[a]();_&&_.indexOf(u)>=0&&(y=!1),m=m.parent()}y&&p.push(i+u)}if(p.length){var b=0;for(s=0;d&&h&&s<h.length;s++){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;u=h[s],d.indexOf(u)>=0&&f.indexOf(u)<0&&g.push(i+u)}var w=p.join(" ");if(g.length>0){var k=0;for(s=0;s<g.length;s++){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;u=g[s],e=0===s?e.replace(u,w):e.replace(u,"")}}else e=e+" "+w;e=e.replace(/  +/g," ")}return e}},{key:"canAcceptDragOver",value:function(e,t,n,r){return this.isDropTarget}},{key:"handleDragOver",value:function(e,t,n,r,i){var a,o=f.default.getElementParent(t),s=o&&f.default.getItemForElement(o),u=(o||f.default.findParent(t,"blockHeader"))&&f.default.getPaneObjectForElement(t);if(f.default.hasClass(t,"overviewBottomPad"))a={overview:!0,atEnd:!0,targetItem:s=this.headersArr[this.headersArr.length-1],targetElement:t,targetPane:this,position:h.a.DragDropPosition.Below},I.default.DragDrop.dragInfo=a,this.overview.updateDragHoverItem(s);else if(o&&f.default.hasClass(o,"overviewItem")){var l,c=o.getBoundingClientRect(),d=c.height,p=this.type!==h.a.PaneMode.Task,g=null===i||void 0===i?void 0:i.isRoot;g?s.isRoot&&(l=h.a.DragDropPosition.Above):l=p&&g?h.a.DragDropPosition.On:r<=c.top+.3*d&&!s.isRoot?h.a.DragDropPosition.Above:r>c.top+.7*d?h.a.DragDropPosition.Below:h.a.DragDropPosition.On,void 0!==l?(a={overview:!0,targetItem:s,targetElement:o,targetPane:this,position:l},I.default.DragDrop.dragInfo=a,this.overview.updateDragHoverItem(s)):this.overview.updateDragHoverItem(null)}else this.overview.updateDragHoverItem(null),a=this._handleDragOverPane(e,t,o,u,n,r,i);return a}},{key:"_handleDragOverPane",value:function(e,t,n,r,i,a,o){}},{key:"handleDragDrop",value:function(e,t,n,r){var i;return(null===n||void 0===n?void 0:n.targetItem)&&(null===e||void 0===e?void 0:e.every((function(e){return e!==n.targetItem})))&&(i=this._handleDragDrop(e,t.dataTransfer,n,t,r)),this.revertDrag(),i}},{key:"_handleDragDrop",value:function(e,t,n,r,a){var o=this,s=r.ctrlKey,u=r.altKey,l=t.pane,c=n.overview,d=n.targetItem,g=n.dropOnPane,v=n.atEnd,m=n.position,y=!0,_=!1,b=i()({},d.id,this.indexOfItem(d)),w=d.parent();if(e.forEach((function(e){for(var t=0;w&&y;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;w===e&&(y=!1,I.default.toasts.pushMessage({text:"Cannot drop an item into its own children",action:h.a.MessageAction.Okay})),w=w.parent()}b[e.id]=o.indexOfItem(e)})),y){var k,S=-1;if(!e.every((function(e){return e.isRoot}))){if(g)k=d,S=v?d.numItems():0;else if(m===h.a.DragDropPosition.Above)k=d.parent(),S=d.getIndex();else if(m===h.a.DragDropPosition.On){k=d;var P=E.a.mac&&s||!E.a.mac&&u;S=P?0:d.numItems()}else{var T=!1;if(!c){var x=this.indexOfItem(d),C=this.getNextItem(x);C&&C.parent()===d&&!C.isNote()&&(k=d,S=0,T=!0)}T||(k=d.parent(),S=d.getIndex()+1)}try{f.default.PAssert(2590,k,"Trying to move without a target")}catch(L){f.default.reportError(L)}try{f.default.PAssert(2591,!isNaN(S),"Trying to move without a target index")}catch(L){f.default.reportError(L)}}_=!0,p.a.disable(),D.a.beginAction(),I.default.PaneUpdateBatcher.beginUpdateItems();var A=[];e.forEach((function(e){if(e.isRoot){if(d.isRoot){var n=d.getDocumentOwner(),r=W.a.documentsArray.indexOf(n)+(m>0?1:0);W.a.moveDocument(e.getDocumentOwner(),r)}}else if(t.dropEffect===h.a.DropEffect.Move){var i=e.parent();if(i)if(i.belongsToSameItemStore(k)){var s=e.isCollapsed(l),u=e.parent()===k&&b[d.id]>b[e.id];e.moveTo({parent:k,index:S},h.a.ChangeType.Local),o.search.stickMatch(e);var c=e.getRawText();c=o.modifyTextOnDropBasedOnSearch(c,e,l,k,h.a.TagPrefix,"getTags"),(c=o.modifyTextOnDropBasedOnSearch(c,e,l,k,h.a.ContactPrefix,"getContacts"))!==e.getRawText()&&e.setText(c,h.a.ChangeType.Local),A.push({item:e,isCollapsed:s}),u&&S--}else{var f=e.getIndex();e=e.clone(k,h.a.ChangeType.Local),o.search.stickMatch(e),k.insertItem(e,S),i.removeChildAtIndex(f,h.a.ChangeType.Local)}else e=e.clone(k,h.a.ChangeType.Local),o.search.stickMatch(e),k.insertItem(e,S)}else a||(e=t.pane?t.pane.dropEffectCopyBehavior(e,k):e.clone(k,h.a.ChangeType.Local)),e?(e.setParent(k),o.search.stickMatch(e),k.insertItem(e,S)):_=!1;_&&(t.pane&&t.pane.notifyDropFrom(e,o),S++)})),A.forEach((function(e){var t=e.item,n=e.isCollapsed;t.setCollapsed(n,o)})),_&&I.default.onIntroAction("Drag"),I.default.PaneUpdateBatcher.commitUpdateItems(),D.a.endAction()}return _}},{key:"revertDrag",value:function(){this.overview&&this.overview.updateDragHoverItem(null)}},{key:"isItemHeader",value:function(e,t){return t?e.hasHeaderChildren():e.hasVisibleChildren(this)}},{key:"openNoteContextMenuByPaneObject",value:function(e,t){var n,r=this,i=e.index,a=e.item;a.isNote()?n=a:(a.hasNote()||a.createNote(),n=a.getNote());var o=this.elementAtIndex(i);if(o){var s=P.a.save(),u=function(){var e,t=null===(e=o.parentElement)||void 0===e?void 0:e.getElementsByClassName("itemInPaneNote")[0];if(t)return r.openNoteContextMenu(n,t,(function(){P.a.restore(s),requestAnimationFrame((function(){P.a.restore(s)}))})),!0};u()||requestAnimationFrame(u)}}},{key:"openNoteContextMenu",value:function(e,t,n,r){P.a.clearSelection(!0);var i={componentName:"ReactNotePopup",element:t,item:e.parent(),note:e,pane:this,onClosed:n};I.default.menus.isContextMenuOpen()&&I.default.menus.closeContextMenu(),i.positionOffset={left:-4,top:-8},I.default.menus.openContextMenu(i)}},{key:"closeNoteContextMenu",value:function(){I.default.menus.isContextMenuOpen()&&I.default.menus.closeContextMenu()}},{key:"canResetMultiselect",value:function(){return!0}},{key:"replaceTextOnDropOnBlock",value:function(e,t,n,r){var i=t.isNoKey?"":t.name,a=null===n||void 0===n?void 0:n.name,o=new RegExp(i+"\\b"),s=e.getRawText();if(""===i||!s.match(o)){if(a){var u=new RegExp(a+"\\b");s=s.replace(u,i)}else s+=" "+i;e.setText(s,h.a.ChangeType.Local)}}},{key:"applyDropOnBlock",value:function(e,t,n,r){var i=this;t.forEach((function(t){return i._applyDropOnBlockItem(e,t,n,r)}))}},{key:"_applyDropOnBlockItem",value:function(e,t,n,r){var i,a=e;if(P.a.setFocusedPane(n),a.isStarred||a.isImportant)a.isStarred?t.setStarred(!0,h.a.ChangeType.Local):a.isImportant&&(i=h.a.VMLIFlag.P0),i&&t.setPriority(i,h.a.ChangeType.Local);else if(e.isTag)this.replaceTextOnDropOnBlock(t,e,r&&r.isTag?r:void 0,"#");else if(e.isContact)this.replaceTextOnDropOnBlock(t,e,r&&r.isContact?r:void 0,"+");else if(e.isPriority)t.setPriority(e.priority,h.a.ChangeType.Local);else{var o=I.default.pluginManager.getPluginGCalendar(),s=!0;if(t.hasAttachmentType(h.a.PluginType.Calendar)){var u=t.getAttachmentByType(h.a.PluginType.Calendar);u&&u.getField("recurringEventId")&&t.getCalendarParsedText()===u.getField("summary")?(I.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),s=!1):o.isEnabled()?o.hasWritePermissionForAttach(u)||(I.default.toasts.pushMessage({text:"This event is on a read-only calendar",actionText:"OKAY"}),s=!1):(I.default.toasts.pushMessage({text:"Cannot modify this event if the calendar plugin is disabled. Please enable the Google Calendar plugin.",action:h.a.MessageAction.OpenSettings}),s=!1)}if(s)if(t.setDate(e.date,e.duration||h.a.DefaultEventDuration,h.a.ChangeType.Local),f.default.isDateValid(a.date)&&o&&n!==this&&!t.hasAttachmentType(h.a.PluginType.Calendar))if(o.getDefaultExportCalendarID()){var l=I.default.pluginManager,c=h.a.PluginSettingsID.GCalendar.SyncDraggedEvents,d=function(){l.getSetting(h.a.PluginID.GCalendar,c)&&o.createEventForItem(t)};I.default.settings.shouldShowHelp("syncNewEvents")?I.default.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",(function(e){I.default.settings.closeHelp("syncNewEvents"),l.setSetting(h.a.PluginID.GCalendar,c,e),d()})):d()}}if(n.isEditable){var p=n.indexOfItem(t,e);p>=0&&P.a.selectIndex(p,t.getParsedText().length)}}},{key:"setIgnoreRestoreScroll",value:function(e,t){var n=this;this._ignoreRestoreScroll=!0,this._ignoreRestoreScrollTimeout&&clearTimeout(this._ignoreRestoreScrollTimeout),this._ignoreRestoreScrollTimeout=setTimeout((function(){n._ignoreRestoreScroll=!1,t&&t()}),e||100)}},{key:"isIgnoringRestoreScroll",value:function(){return this._ignoreRestoreScroll}},{key:"zoomInOnSwipe",value:function(e){var t=this,n=this.item.get();this.zoomIn(e),I.default.toasts.pushMessage({text:"<b>Zoomed in to: </b>"+e.getParsedText(),action:function(){t.zoomIn(n)},hold:!1,actionText:"UNDO"})}},{key:"collapseOnSwipe",value:function(e){this.supportCollapsing&&e.isCollapsible()&&e.toggleCollapsed(this)}},{key:"deleteOnSwipe",value:function(e){var t;(e.deleteSelf(h.a.ChangeType.Local),e.hasAttachmentType(h.a.PluginType.Email))?t=e.getAttachmentByType(h.a.PluginType.Email).getField("subject"):t=e.getParsedTextWithoutPrefix();I.default.toasts.pushMessage({text:"<b>Deleted:</b>"+t,action:function(){D.a.undo()},hold:!1,actionText:"UNDO"})}},{key:"completeOnSwipe",value:function(e){this.supportCompleting&&(f.default.beginCompleteAction(),e.setComplete(!e.isComplete(),h.a.ChangeType.Local),f.default.endCompleteAction())}},{key:"getSwipeMenuItems",value:function(e){var t=e.item;return{left:[{icon:"check",text:t.isComplete()?"Uncomplete":"Complete",backgroundColor:"#0c0",onActivated:this.completeOnSwipe.bind(this,t)}],right:[{icon:t.isCollapsed(this)?"chevron-up":"chevron-down",backgroundColor:"#777",onActivated:this.collapseOnSwipe.bind(this,t)},{icon:"magnify-plus-outline",backgroundColor:"#09d",onActivated:this.zoomInOnSwipe.bind(this,t)},{icon:"delete",backgroundColor:"#a30",onActivated:this.deleteOnSwipe.bind(this,t)}]}}},{key:"_openSelectedInMode",value:function(e){var t=P.a.getStartItem();t&&this.openEmailByItem(t,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(h.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(h.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(h.a.EmailResponseMode.Forward)}},{key:"openEmailByItem",value:function(e,t){if(e){var n=e.getAttachmentByPlugin(h.a.PluginID.Gmail);(n&&n!==I.default.EmailPreview.getThreadAttach()||!I.default.EmailPreview.isOpenOnPane(this)||t)&&n.getPlugin().openEmailByItem(e,this,t)}}},{key:"markItemRead",value:function(e,t){var n=I.default.pluginManager.getPluginGmail(),r=t.getAttachmentByPlugin(n.id),i=e?h.a.PluginAction.Gmail.MarkRead:h.a.PluginAction.Gmail.MarkUnread;try{f.default.PAssert(2593,r,"Must be able to get a valid attachment")}catch(a){f.default.reportError(a)}(e&&n.isItemUnread(t)||!e&&!n.isItemUnread(t))&&n.performAction(i,!1,r)}},{key:"markReadSelected",value:function(e){var t=I.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection(this.markItemRead.bind(this,e)),t.endAction()}},{key:"toggleStarSelected",value:function(){var e,t=I.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection((function(n){var r=n.getAttachmentByPlugin(t.id);try{f.default.PAssert(2594,r,"Must be able to get a valid attachment")}catch(a){f.default.reportError(a)}var i=t.isItemStarred(n);void 0===e&&(e=i?h.a.PluginAction.Gmail.Unstar:h.a.PluginAction.Gmail.Star),(i&&e===h.a.PluginAction.Gmail.Unstar||!i&&e===h.a.PluginAction.Gmail.Star)&&t.performAction(e,!1,r)})),t.endAction()}},{key:"selectIndex",value:function(e,t){P.a.selectIndex(e,t||0)}},{key:"onAdded",value:function(){this.isEditable&&this.isWriteable&&setTimeout(this.selectFirstItem.bind(this),0)}},{key:"selectFirstItem",value:function(){this.isWriteable&&0===this.numItems()&&this.canAddItem&&this.addItem();var e=this.indexOfFirstItem();e>=0&&P.a.selectIndex(e,0)}},{key:"isOverviewVisibleInPane",value:function(e){var t=this.item.get();return e===t||e.isDescendantOf(t)}},{key:"getContentWidth",value:function(){return this.getWidth()}},{key:"getContentHeight",value:function(){return this.getHeight()}},{key:"getMinItemSize",value:function(){return Math.ceil(I.default.DisplaySettings.itemLineHeight()+2*I.default.DisplaySettings.itemPadding()+(I.default.DisplaySettings.noteLineHeight()+I.default.DisplaySettings.itemPadding()))/2}},{key:"onZoom",value:function(){}},{key:"widthOfDrag",value:function(e){}},{key:"getSubItems",value:function(e,t){var n=[],r={item:e,comparator:this.search.isMatched,pane:this,each:function(e){t&&e.isComplete()||n.push(e)}};return this.runItemSearch(r),n}},{key:"isItemInPane",value:function(e){return this.indexOfItem(e)>=0}},{key:"isItemTopLevel",value:function(e){return e.item.levelsDeep.get()-this.item.get().levelsDeep.get()===1}},{key:"getCollapsedDefault",value:function(e,t,n){return!1}},{key:"isViewProject",value:function(){return!1}},{key:"isViewDates",value:function(){return!1}},{key:"isViewAgenda",value:function(){return!1}},{key:"isViewCalendar",value:function(){return!1}},{key:"isViewOutline",value:function(){return!1}},{key:"isViewText",value:function(){return!0}},{key:"isViewFlatList",value:function(){return!1}},{key:"shouldShowAddBox",value:function(){return!1}},{key:"isViewAutoBlocks",value:function(){return!1}},{key:"isViewTag",value:function(){return!1}},{key:"canScrollToItem",value:function(){return!1}},{key:"getSortModeBlocks",value:function(){}},{key:"getSortModeItems",value:function(){}},{key:"isCalFilterActive",value:function(){return!1}},{key:"isViewItems",value:function(){return!1}},{key:"isViewArchived",value:function(){return!1}},{key:"isViewDeleted",value:function(){return!1}},{key:"viewModeIcon",value:function(){return""}},{key:"viewModeColor",value:function(){return""}},{key:"createVMLI",value:function(e,t){t.documentOwner=this.getDocument();var n=W.a.createVMLI(e,t);return this.search.stickMatch(n),n}},{key:"createTempVMLI",value:function(e,t){t.documentOwner=this.getDocument();var n=W.a.createVMLI(e,t);return this.search.stickMatch(n),n}},{key:"selectNearestItem",value:function(e){I.default.PaneUpdateBatcher.flushItemsUpdate(this);var t=this.findNextSiblingItem(e);t&&P.a.selectObject(t,0)}},{key:"supportsSortBlocks",value:function(){return!1}},{key:"supportsSortBlocksMode",value:function(e,t){return!1}},{key:"supportsSortItems",value:function(){return!1}},{key:"getViewMode",value:function(){return""}},{key:"scrollToTop",value:function(e){this.initialScrollIndex=0,this.listManager.scrollToOffset(0,e)}},{key:"setName",value:function(e){this.name.set(e),I.default.PaneManager.savePaneState()}},{key:"setWidthManual",value:function(e,t){isNaN(e)?this.widthManual=this.widthManualExpanded=e:t?(e=f.default.clamp(e,h.a.EmailPreviewSizeMin,h.a.EmailPreviewSizeMax),this.widthManualExpanded=e):(e=f.default.clamp(e,this.minWidth,this.maxWidth),this.widthManual=e),this.saveState(),I.default.PaneManager.updatePaneRects(!isNaN(e))}},{key:"isPaneObjectCollapsed",value:function(e){return(f.default.isVMLI(e)?e:e.item).isCollapsed(this,e.overview)}},{key:"setPaneObjectCollapsed",value:function(e,t,n){return(f.default.isVMLI(t)?t:t.item).setCollapsed(e,this,t.overview,n)}},{key:"setItemCollapsed",value:function(e,t,n,r){return t.setCollapsed(e,this,n,r)}},{key:"setItemUnCollapsedToRoot",value:function(e,t,n,r){var i=this;e.setCollapsed(!1,this,n,r),e.parents(t).forEach((function(e){return e.setCollapsed(!1,i,n,r)}))}},{key:"shouldRenderPrefix",value:function(e){return!0}},{key:"needsUpdateForDate",value:function(){return!1}},{key:"needsUpdateForTags",value:function(e){return!1}},{key:"needsUpdateForPriority",value:function(){return!1}},{key:"needsUpdateForModified",value:function(){return!1}},{key:"needsSearchUpdateForPriority",value:function(){return this.search.getFilterValue("filter")}},{key:"handleItemChanged",value:function(e,t,n){var r=this.listManager;if(n=n||!1,t.Complete&&(n=!0),(t.Items||t.Indent)&&(I.default.DisplaySettings.boldHeaders()&&r.clearItemInfoForItem(e),n=!0),t.Text&&(r.handleItemTextChanged(e)&&(this.itemsHeightDirty=!0),this.supportSearchListenTextChanges)){var i=this.search.handleItemTextChanged(e);n=n||i}if(t.Header&&this.isViewProject()&&(n=!0),t.Search||t.Date&&this.search.isSearchingDate()){var a=this.search.handleItemChanged(e);n=n||a}if(t.Priority){var o=this.search.handleItemChanged(e);o||(o=this.needsUpdateForPriority()),n=n||o}if(t.Modified&&(n=n||this.needsUpdateForModified()),(t.Date||t.RepeatDateCompleted)&&(n=n||this.needsUpdateForDate()),t.Tags&&(n=n||this.needsUpdateForTags(t.Tags)),this.onItemPreloadUpdated.notify(e),n)return(t.RepeatDateCompleted||t.Complete||!this.preventUpdateItemsForItem||this.preventUpdateItemsForItem.item!==e)&&this.setItemsDirty(),!0}},{key:"addPaneObject",value:function(e,t){var n=t.item;e.push(t),n&&(this.paneObjects[t.id]=t,this.paneObjectsByItem[n.id]?this.paneObjectsByItem[n.id].push(t):this.paneObjectsByItem[n.id]=[t])}},{key:"getPaneObjectsForItem",value:function(e){return this.paneObjectsByItem[e.id]}},{key:"_zoom",value:function(e,t,n,r){try{f.default.PAssert(2595,e,"Must supply a valid item to zoom to")}catch(a){f.default.reportError(a)}if(e){t||(this.scrollToTop("auto"),this.initialScrollIndex=0);var i=this.item.get();if(i&&i.id===e.id)return;P.a.reset(),this.setItem(e,!0,n,r),f.default.focusedItem=e,t||this.saveState()}}},{key:"zoomIn",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{f.default.PAssert(2596,e,"Must supply a valid item to zoom to")}catch(d){f.default.reportError(d)}if(e){var r=n.forLoad,i=n.showToast,a=n.noSel,o=n.noUpdateItems,s=n.fromUndo,u=this.item.get();if(this._zoom(e,r,o,s),e.isDemandLoad()&&e.notifyDemandLoadUpdate(!0,this),r||f.default.sendEvent("Menu","ZoomIn"),this.paneContent&&this.isWriteable&&!a){var l=0,c=function e(){var n=t.indexOfFirstItem();n>=0&&l<10?t.listManager.getElementByID(t.objectAtIndex(n).id)?P.a.selectIndex(n,0,0):(l++,requestAnimationFrame(e)):P.a.reset()};c()}this.isLoaded&&this.onZoom(),r||I.default.onIntroAction("Zoom"),i&&I.default.toasts.pushMessage({text:"Zoomed into "+e.getParsedTextWithoutPrefix(),actionText:"UNDO",hold:!1,action:function(){t.zoomIn(u)}})}}},{key:"zoomOut",value:function(e,t){try{f.default.PAssert(2597,e,"Must supply a valid item to zoom to")}catch(a){f.default.reportError(a)}var n=P.a.save()||P.a.getPreviousSelection();if(this._zoom(e,!1),f.default.sendEvent("Menu","ZoomOut"),this.isWriteable&&n&&(this.restoreSelectionAfterCollapse(n,!0),n.selectedMap)){var r,i=null===(r=P.a.getStartSelectionOfMap(n.selectedMap))||void 0===r?void 0:r.paneObject;i&&this.scrollIndexToMiddle(i.index)}}},{key:"getDocument",value:function(){return this.document.get()}},{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.forLoad,r=t.noUpdateItems,i=t.zoomItem,a=e!==this.document.get();a&&(this.setIgnoreRestoreScroll(1e3),this.zoomIn(null!==i&&void 0!==i?i:null===e||void 0===e?void 0:e.getRootItem(),{forLoad:n,noUpdateItems:r}))}},{key:"openItemEditor",value:function(e){e.pane=this,I.default.menus.openItemEditor(e)}},{key:"clearPreventUpdate",value:function(e){}},{key:"getVisibleChildren",value:function(e){for(var t=0,n=e.item,r=this.getItems(),i=[],a=e.index;a<r.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=r[a],s=o.item;s&&s.isDescendantOf(n)&&i.push(o)}return i}},{key:"isItemBold",value:function(e){return e.isPrefixHeader()||e.isHeader()&&I.default.DisplaySettings.boldHeaders()}},{key:"onRemoteUpdate",value:function(e){if(this.usesVMLIs&&e.item!==this.getItem().id){var t=W.a.getItem(e.item);t&&this.zoomIn(t)}void 0!==e.documentSortMode&&this.documentSortMode.set(e.documentSortMode),this.name.set(e.name),this.widthManual=e.widthManual,this.widthManualExpanded=e.widthManualExpanded,E.a.supportsMultiplePanes.get()&&this.overview.setVisibility(e.isOverviewVisible),void 0!==e.search&&this.search.onRemoteUpdate(e.search)}},{key:"goBack",value:function(){var e=this.history.get(),t=e[e.length-1];if(t){if(t.item&&t.item!==this.getItem().id){var n=W.a.getItem(t.item);n&&this.zoomIn(n,{fromUndo:!0})}var r;if(void 0!==t.search)this.search.onRemoteUpdate(t.search,!0),null===(r=this.onViewStateChanged)||void 0===r||r.call(this);this.history.splice(e.length-1,1)}}},{key:"_setRect",value:function(e){this._cachedWidth=e.width,this._cachedMaxWidths={},this.rect.set(e)}},{key:"canCollapse",value:function(){return this.supportCollapsing}},{key:"getDeferredItem",value:function(e){}},{key:"pushHistory",value:function(e){var t=this.history.get();t.length>10&&t.splice(0,1),t.push(e),this.history.set(t)}},{key:"itemLevelsDeep",value:function(e,t){return e.levelsDeep.get()-(t?t.levelsDeep.get():this.item.get().levelsDeep.get()+1)}},{key:"canZoomToItem",value:function(e){return e.canZoom()}},{key:"createVMLIsToDrop",value:function(e,t){return e.items.map((function(e){return e.item}))}},{key:"onDoubleClick",value:function(e,t){}},{key:"searchPaneObjects",value:function(e){var t=this,n=e.toLowerCase().split(" ");return this.items.get().filter((function(e){return n.every((function(n){var r;return null===(r=e.item)||void 0===r?void 0:r.getSearchText(t).includes(n)}))}))}},{key:"isPopupOpen",value:function(){return this.searchingPaneObjects.get().isSearching||this.isSearchingGlobal.get()}},{key:"getMobileIcon",value:function(){}}],[{key:"getPluginID",value:function(){}}]),e}(),c()(H.prototype,"saveState",[d.a],Object.getOwnPropertyDescriptor(H.prototype,"saveState"),H.prototype),c()(H.prototype,"onTapOverviewButton",[d.a],Object.getOwnPropertyDescriptor(H.prototype,"onTapOverviewButton"),H.prototype),c()(H.prototype,"onClickReportError",[d.a],Object.getOwnPropertyDescriptor(H.prototype,"onClickReportError"),H.prototype),c()(H.prototype,"archiveCompleted",[d.a],Object.getOwnPropertyDescriptor(H.prototype,"archiveCompleted"),H.prototype),c()(H.prototype,"onDocumentsChanged",[d.a],Object.getOwnPropertyDescriptor(H.prototype,"onDocumentsChanged"),H.prototype),H);T.a.extendClass(oe,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=function(e){v()(n,e);var t=B(n);function n(){return o()(this,n),t.apply(this,arguments)}return u()(n,[{key:"constructorExtra",value:function(){T.a.binder(this,"compositionStart","compositionEnd","onInput","onInputSetText")}},{key:"compositionStart",value:function(){E.a.isAndroid||(P.a.isComposing=!0,this.compositionOffset=P.a.getStartOffset())}},{key:"compositionEnd",value:function(e){E.a.isAndroid||(P.a.isComposing=!1,this.onInput(e),this.compositionOffset=void 0)}},{key:"onBeforeInput",value:function(e){}},{key:"onInput",value:function(e){if(P.a.isValid()){for(var t,n,r,i=0,a=P.a.getStartObject(),o=e.target.children,s=x.default.getSelectionRangeNative(),u=0;u<o.length;u++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=o[u],c=+l.getAttribute("data-index");if(c===a.index||"BR"===l.nodeName&&r+1===a.index)if(t){var d=x.default.getSelectOffsetsInElement(l,s);n={start:n.total+1,end:n.total+1,total:n.total+d.total+1},t.append("\n"),t.append(l)}else t=l,n=x.default.getSelectOffsetsInElement(t,s);r=c}if(t){var f=P.a.getStartItem(),p=this.convertElementToText(t).replace(h.a.TextSpaceRegexp,""),g=void 0!==this.compositionOffset?this.compositionOffset:P.a.getStartOffset(),v=P.a.getEndOffset();f.isPrefixCodeBlock();0;var m=a.getDisplayLengthWithoutPrefix(),y=U.onInput(a,p,n.start,g,v,e),_=y.newText,b=y.selOffset,w=n.end+b;this.onInputSetText(a,f,_,w,m,e)}}}},{key:"onInputSetText",value:function(e,t,n,r,i,a){n=n.replace(h.a.TextSpaceRegexp,"");var o=A.a.checkMultiplePrefixes(n);o!==n&&(r-=n.length-o.length,n=o);var s=n.length===t.getRawText().length-1;this.isSettingTextFromInput=!0;var u=e.getDisplayLengthWithoutPrefix();t.setText(n,h.a.ChangeType.Local);var l=e.getDisplayLengthWithoutPrefix();"insertText"===a.inputType&&l<u&&(r=Math.max(0,r+l-u)),l!==i&&(r=t.elsNew.adjustOffsetAroundUneditables(e,r,l>i?-1:1)),"insertCompositionText"===a.inputType?O.a.savedRange=void 0:P.a.selectObject(e,r,r,{fromInput:!1}),this.isSettingTextFromInput=!1,s&&!C.a.isShowing()||L.a.updateAutocomplete()}},{key:"keydown",value:function(e){if(e.handled)return!0;if(e.normCode===h.a.KeyCode.Escape&&this.searchingPaneObjects.get().isSearching)return this.searchingPaneObjects.setProperty("isSearching",!1),!0;if(I.default.tooltip.hideTip(),this.isWriteable&&0===this.numItems()&&this.canAddItem&&!f.default.hasClass(this.paneContent,"loading")&&h.a.KeyCodesModifiers.indexOf(e.normCode)<0&&h.a.KeyCodesArrows.indexOf(e.normCode)<0&&this.addItem(),P.a.isValid())if(e.normCode===h.a.KeyCode.ContextMenu&&E.a.windows)I.default.menus.openItemContextMenu(P.a.getStartObject());else{0!==this.numItems()||f.default.hasClass(this.paneContent,"loading")||this.addItem();try{L.a.keydown(e)||f.default.preventAndStop(e)}catch(t){f.default.reportError(t,e)}}}},{key:"keypress",value:function(e){if(P.a.isValid())try{L.a.keypress(e)||(f.default.preventDefault(e),f.default.stopPropagation(e))}catch(t){f.default.reportError(t,e)}}},{key:"keyup",value:function(e){if(f.default.notifyActivity(),P.a.isValid())try{L.a.keyup(e)||(f.default.preventDefault(e),f.default.stopPropagation(e))}catch(t){f.default.reportError(t,e)}}},{key:"setRect",value:function(e){f.default.deepEqual(e,this.rect.get())||(p.a.disable(!0),this._setRect(e))}}]),n}(e);return t}(oe),!0);var se=t.a=oe},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=function(){function e(t){i()(this,e),this._limit=t,this._offset=0,this._buffer=[]}return o()(e,[{key:"get",value:function(e){return this._buffer[e]}},{key:"push",value:function(e){this._buffer[this._offset]=e,this._offset=(this._limit+this._offset+1)%this._limit}},{key:"peek",value:function(){var e=(this._limit+this._offset-1)%this._limit;return this._buffer[e]}},{key:"pop",value:function(){var e=(this._limit+this._offset-1)%this._limit,t=this._buffer[e];return t&&(this._buffer[e]=void 0,this._offset=e),t}},{key:"hasData",value:function(){return!!this.peek()}},{key:"reset",value:function(){this._offset=0,this._buffer=[]}},{key:"buffer",value:function(){return this._buffer}},{key:"limit",value:function(e){this._limit=e}},{key:"ordered",value:function(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))}},{key:"entries",value:function(){for(var e=0,t=this.ordered(),n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;console.log("---- Entry ["+n+"] ----"),console.log(t[n])}}}]),e}();t.a=s},function(e,t,n){"use strict";var r=n(41),i=n.n(r),a=n(5),o=n.n(a),s=n(6),u=n.n(s),l=n(1),c=n(0),d=n(52),h=function(){function e(t){o()(this,e),this.elements="string"===typeof t?[new d.a(t)]:t}return u()(e,[{key:"insert",value:function(e,t,n,r){for(var i,a=0,o=t,s=0,u=0;u<this.elements.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=this.elements[u],c=r?l.getStyledText(r.item,{showMarkdown:r.showMarkdown()}):l.getText();if(s<e+t&&e<s+c.length){var h=0,f=Math.max(e-s,0),p=Math.min(o,c.length),g=f+o,v=c.length-g;if(f>0){var m=c.substr(0,f);this.elements.splice(u,0,new d.a(m,l.props)),h++}var y=c.substr(f,p);if((i=new d.a(y,l.props)).mergeProps(n),this.elements.splice(u+h,1,i),h++,v>0){var _=c.substr(g,v);this.elements.splice(u+h,0,new d.a(_,l.props));break}u+=h-1,o-=p}s+=c.length}return i}},{key:"insertEl",value:function(e,t,n){var r=this.split(t,n),a=i()(r,2),o=a[0],s=a[1];this.elements=o.elements.concat(e).concat(s?s.elements:[])}},{key:"getDisplayText",value:function(e,t,n,r,i){return this.elements.map((function(a){var o,s;return n&&a.props.prefixType||r&&a.props.date||i&&(null===(o=a.props.link)||void 0===o||null===(s=o.href)||void 0===s?void 0:s.startsWith("data:image"))?"":a.getStyledText(e,{showMarkdown:t})})).join("")}},{key:"getRawText",value:function(e){var t=!1,n=!1,r=!1,i=!1,a=!1,o="";return e?this.elements.map((function(t){return t.getRawText(e)})).join(""):(this.elements.forEach((function(e){var s=e.props,u=e.getRawText();!s.formatting&&u&&(!!s.bold!==t&&(o+=l.a.Markdown.bold),!!s.italic!==n&&(o+=l.a.Markdown.italic),!!s.underline!==r&&(o+=l.a.Markdown.underline),!!s.strike!==i&&(o+=l.a.Markdown.strike),!!s.code!==a&&(o+=l.a.Markdown.code),o+=u,t=!!s.bold,n=!!s.italic,r=!!s.underline,i=!!s.strike,a=!!s.code)})),t&&(o+=l.a.Markdown.bold),n&&(o+=l.a.Markdown.italic),r&&(o+=l.a.Markdown.underline),i&&(o+=l.a.Markdown.strike),a&&(o+=l.a.Markdown.code),o)}},{key:"getHTML",value:function(e,t,n){var r=this,i=this.elements.map((function(i,a){return i.props.prefixType&&!1===t?"":i.getHTML(e,a>0,a===r.elements.length-1,n)})).join("");return this.elements[0]&&"header"===this.elements[0].props.prefixType&&(i='<b style="font-size: 1.5em">'.concat(i,"</b>")),i}},{key:"getPlaintext",value:function(e,t){return this.elements.map((function(n){return n.props.prefixType&&!1===t?"":n.getPlaintext(e)})).join("")}},{key:"displayRangeHasFormat",value:function(e,t,n,r){for(var i=0,a=0,o=0;a<r&&o<this.elements.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=this.elements[o],u=s.getStyledText(t.item,{showMarkdown:t.showMarkdown()});if(a<r&&n<a+u.length)if(!s.props[e])return!1;a+=u.length}return!0}},{key:"_elementInfoAtOffset",value:function(e,t,n){for(var r=0,i=0,a=0;i<=t&&a<this.elements.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this.elements[a];if(!o.props.prefixType||"raw"===n){var s="raw"===n?o.getRawText(!0):o.getStyledText(e.item,{showMarkdown:e.showMarkdown()});if(i<=t&&(t<i+s.length||t===i+s.length&&a===this.elements.length-1))return{offset:i,text:s,length:s.length,el:o,index:a};i+=s.length}}try{c.default.PAssert(948,0===t,"Did not find element at offset ".concat(t))}catch(u){c.default.reportError(u)}return{}}},{key:"elementInfoAtOffset",value:function(e,t){return this._elementInfoAtOffset(e,t,"styled")}},{key:"elementAtOffset",value:function(e,t){var n;return null===(n=this._elementInfoAtOffset(e,t,"styled"))||void 0===n?void 0:n.el}},{key:"removeElement",value:function(e){return this.elements.remove(e),this}},{key:"removeElementAtOffset",value:function(e,t){var n=this.elementAtOffset(e,t);return this.elements.remove(n),this}},{key:"isElementAtOffsetEditable",value:function(e,t){var n=this.elementInfoAtOffset(e,t).el;return n&&n.isEditable()}},{key:"adjustOffsetAroundUneditables",value:function(e,t,n){var r=this.elementInfoAtOffset(e,t),i=r.el,a=r.offset,o=r.length;if(i&&!i.isEditable()){if(!n)return t-a<a+o-t?a:a+o;if(t!==a&&t!==a+o)return n>0?a+o:a}return t}},{key:"spliceText",value:function(e,t,n,r){var i,a=this.split(r,t);n>0?i=this.split(r,t+n)[1]:i=a[1];var o=i?i.getRawText(r.showMarkdown()):"";return(a[0]?a[0].getRawText(r.showMarkdown()):"")+e+o}},{key:"split",value:function(t,n){for(var r=0,a=0,o=0;a<=n&&o<this.elements.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=this.elements[o],u=s.getStyledText(t.item,{showMarkdown:t.showMarkdown()});if(a<=n&&n<a+u.length){var l=n-a,c=s.split(t,l),d=i()(c,2),h=d[0],f=d[1];return[new e(this.elements.slice(0,o).concat(h||[])),new e((f?[f]:[]).concat(this.elements.slice(o+1)))]}a+=u.length}return[this]}},{key:"combineWith",value:function(t,n){var r=t.elements;return n&&(r=r.filter(n)),new e(this.elements.concat(r)).getRawText()}},{key:"findElement",value:function(e,t){for(var n=0,r=0,i=0;i<this.elements.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.elements[i];if(!a.props.prefixType){var o=a.getStyledText(e.item,{showMarkdown:e.showMarkdown()});if(t(a))return{offset:r,text:o,length:o.length,el:a};r+=o.length}}}},{key:"numFormattingCharsBeforeOffset",value:function(e,t){for(var n=0,r=0,i=0,a=0;r<=t&&a<this.elements.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this.elements[a],s=o.getStyledText(e.item);o.props.formatting&&(i+=o.getText().length),r+=s.length}return i}},{key:"withoutPrefix",value:function(){return this.elements[0].props.prefixType?new e(this.elements.slice(1)):this}}]),e}();t.a=h},function(e,t,n){"use strict";var r=n(3),i=n.n(r),a=n(10),o=n.n(a),s=n(5),u=n.n(s),l=n(6),c=n.n(l),d=n(36),h=n(0),f=n(1),p=n(2),g=n(16),v=n(25),m=function(){function e(){u()(this,e)}return c()(e,[{key:"_addItemToArray",value:function(e,t,n){var r=t.getFullSaveData();if(!n&&r.note&&delete r.note,e.push(r),t.hasChildren())for(var i=0,a=t.getItems(),o=0;o<a.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o];this._addItemToArray(e,s,n)}n&&t.hasNote()&&e.push(t.getNote().getFullSaveData())}},{key:"getBestEncryptionOut",value:function(){var e=p.default.settings.encryptionKeys.get();return e&&e[f.a.EncryptionKeys.UserPassword]?f.a.EncryptionKeys.UserPassword:f.a.EncryptionKeys.Global}},{key:"getItemsData",value:function(){var e=o()(i.a.mark((function e(t,n){var r,a,o,s;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(r=n.includeNotes,a=n.encrypt,o=n.encryptionKey,s=[],this._addItemToArray(s,t,r),!a){e.next=8;break}try{h.default.PAssert(485,o,"getItemsData missing encryptionKey")}catch(u){h.default.reportError(u)}return e.abrupt("return",Promise.all(s.map((function(e){return v.a.encryptItemOut(e,p.default.crypto,o)}))));case 8:return e.abrupt("return",Promise.resolve(s.map((function(e){return v.a.itemOut(e)}))));case 9:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"toDropHtml",value:function(e){var t="";if(!e.isArchived()&&(t+="<li>"+h.default.escape(e.getParsedText())+"</li>",e.hasChildren())){var n=0;t+="<ul>";for(var r=0;r<e.numChildren();++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t+=this.toDropHtml(e.getChild(r))}t+="</ul>"}return t}},{key:"generateOPML",value:function(e,t){var n,r=this,i=0,a='<?xml version="1.0"?><opml version="2.0"><head><ownerEmail>'.concat(d.a.getAccountEmail(),"</ownerEmail></head><body>"),o=0,s=function(){a+="</outline>",o--};for(e.forEach((function(e,i){if(!e.isNote()){if(n)for(var u=0,l=e.levelsDeep.get()-n.levelsDeep.get(),c=Math.min(o,-l),d=0;d<c;d++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;s()}var h=r.printLI(e,{opml:!0},void 0,void 0,void 0,void 0,!1,t);a+=h.opml,e.hasChildren()&&o++,n=e}}));o>0;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;s()}return a+="</body></opml>"}},{key:"generateExport",value:function(e,t,n,r,i,a,o){var s,u,l,c=this,d=0,h=1,f=t.html,p=t.moodo,g=t.plain;f&&(s="<ul>"),p&&(u="<ul>"),g&&(l="");var v=function(){f&&(s+="</li>"),p&&(u+="</li>")},m=function(){f&&(s+="<ul>"),p&&(u+="<ul>"),h++},y=function(){f&&(s+="</ul>"),p&&(u+="</ul>"),h--};for(e.forEach((function(d,_){var b,w;(e.length>1||void 0!==n&&n!==r)&&(i===a&&n===r||(b=0===_?n:0,w=a.item===d&&(d.hasNote()&&_===e.length-2||!d.isNote()&&_===e.length-1)?r:void 0));var k=e.length>1||n===d.getPrefixLength()&&r===i.getDisplayLength(),S=c.printLI(d,t,b,i,w,a,k,o);g&&(l+=(l?"\r\n":"")+"\t".repeat(Math.max(0,h-1))+S.plain),f&&(s+=S.html),p&&(u+=S.moodo);var E=e[_+1];if(E){var P=E.levelsDeep.get()-d.levelsDeep.get();if(E&&(E.parent()===d&&P>0||E.isNote()))m();else{var I=Math.min(h,-P);if(0===I&&h>0)v();else{var D=0;v();for(var T=0;T<I;T++){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;y(),v()}h<=0&&m()}}}}));h>0;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;v(),y()}return{html:s,moodo:u,plain:l}}},{key:"printLI",value:function(e,t,n,r,i,a,o,s){var u,l,c=t.html,d=t.moodo,h=t.plain,p=t.opml,g=e.elsNew,v=s||o&&!e.isPrefixCodeBlock()?e.getPrefixForExport():"",m=[],y=e.getPriority();void 0!==i&&(g=g.split(a,i)[0]),void 0!==n&&0!==n&&(g=g.split(r,n)[1]);var _,b=(g=g.withoutPrefix()).getRawText();if(e.isNote()&&m.push("note"),y&&(y===f.a.VMLIFlag.P0?m.push("high"):y===f.a.VMLIFlag.P1?m.push("medium"):y===f.a.VMLIFlag.P2&&m.push("low")),e.isComplete()&&m.push("complete"),e.isStarred()&&m.push("starred"),b.includes(f.a.CharDate)){var w=e.getMooDate();w&&(_=w.toData())}return(null===(u=e.getItemsLinkedTo())||void 0===u?void 0:u.length)>0&&(l=e.id),{html:c?this.generateHTML(v+g.getHTML(e,s),m,_,l):"",plain:h?v+g.getPlaintext(e,s):"",moodo:d?this.generateHTML(v+b,m,_,l):"",opml:p&&!e.isNote()?this.generateOPMLItem(e,v+g.getHTML(e,s,!0),m,_,l):""}}},{key:"generateHTML",value:function(e,t,n,r){return"<li"+(t.length>0?' class="'+t.join(" ")+'"':"")+(n?' data-date="'.concat(n,'"'):"")+(r?' id="'.concat(r,'"'):"")+">"+e}},{key:"generateOPMLItem",value:function(e,t,n,r,i){return"<outline"+(i?' id="'.concat(i,'"'):"")+(e.hasNote()?' _note="'.concat(h.default.escape(e.getNote().getRawText()),'"'):"")+(n.length>0?" "+n.map((function(e){return"".concat(e,'="true"')})).join(" "):"")+(r?' date="'.concat(r,'"'):"")+' text="'.concat(h.default.escape(t),'"')+(e.hasChildren()?">":" />")}},{key:"rewriteItemIDs",value:function(e,t){for(var n=0,r={},i=0;i<e.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i],o=a.id;o&&(a.id=g.a.generateID(),r[o]=a.id)}Object.keys(r).length>0&&function(){for(var n=0,i=function(e,n){var i=h.default.isVMLI(e)?e.getRawText():e.text,a=i.replace(f.a.Regexp.InterlinkWithText,(function(e,n){var i=(t||!g.a.getItem(n)||g.a.getItem(n).isDeleted())&&r[n];return i?"[[".concat(i,"]]"):e}));a!==i&&(h.default.isVMLI(e)?e.setText(a,n):e.text=a)},a=0;a<e.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e[a];if(i(o,f.a.ChangeType.Remote),h.default.isVMLI(o)){var s=o.getItemsLinkedTo();s&&s.forEach((function(t){e.includes(t)||i(t,f.a.ChangeType.Local)}))}}}()}}]),e}();t.a=new m},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(1),u=n(16),l=function(){function e(){i()(this,e),this._itemsWithoutParent=[]}return o()(e,[{key:"onRemoteChange",value:function(e,t,n,r,i){var a=u.a.getItem(n),o=s.a.ChangeType.Remote;r.parent||t&&(r.parent=t.parent);var l=u.a.getItem(r.parent);if(l)if(a){if(32===(32&r.flags))!!(a.isDeleted()||r.isDeleted?void 0:a)!==l.hasNote()&&l.setNote(a.isDeleted()||r.isDeleted?void 0:a,o);a.onChangeRemote(r,o)}else if(!t||!t.isDeleted){var c=Object.assign({},t,r);(a=u.a.createVMLI(c,{parent:l,changeType:o,documentOwner:e})).onChangeRemoteParentOrIndex({id:c.id,parent:c.parent,index:c.index,flags:c.flags})}i||(l||this._itemsWithoutParent.push({doc:e,localValue:t,itemId:n,value:r}),this.tryMissingItems())}},{key:"tryMissingItems",value:function(){for(var e=0,t=0;t<this._itemsWithoutParent.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(u.a.getItem(this._itemsWithoutParent[t].value.parent)){var n=this._itemsWithoutParent[t],r=n.doc,i=n.localValue,a=n.itemId,o=n.value;this.onRemoteChange(r,i,a,o,!0),this._itemsWithoutParent.splice(t,1),t--}}}}]),e}();t.a=new l},function(e,t,n){"use strict";var r=n(33),i=n.n(r),a=n(3),o=n.n(a),s=n(10),u=n.n(s),l=n(5),c=n.n(l),d=n(6),h=n.n(d),f=n(1),p=n(0),g=n(2),v=n(16),m=n(66),y=n(25),_=n(52),b=n(77),w={"#text":!0,SPAN:!0},k={DIV:!0,LI:!0,IMG:!0,UL:!0,OL:!0,P:!0},S={UL:!0,OL:!0},E=function(){function e(){c()(this,e)}return h()(e,[{key:"_setSectionValue",value:function(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}},{key:"_parseSection",value:function(e,t){for(var n=0,r={},i=t;i<e.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i];if(a){var o=a.indexOf(":"),s=[a.substr(0,o),a.substr(o+1)],u=s[0].split(";");switch(u[0]){case"BEGIN":var l=this._parseSection(e,i+1);i+=l.size,r[s[1]]=l.section;break;case"END":return{section:r,size:i-t+1};default:if(u.length>1){for(var c=0,d={value:s[1]},h=1;h<u.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=u[h].split("=");try{p.default.PAssert(493,!d.hasOwnProperty(f[0]),"Should never overwrite line values")}catch(g){p.default.reportError(g)}d[f[0]]=f[1]}this._setSectionValue(r,u[0],d)}else this._setSectionValue(r,u[0],s[1]);break;case void 0:case null:try{p.default.PAssert(494,!1,"Invalid ICS format: "+a)}catch(g){p.default.reportError(g)}}}}return r}},{key:"parseICS",value:function(e){for(var t=0,n=e.split("\n"),r=[],i=0;i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i];a.startsWith(" ")?r[r.length-1]+=a.trim():r.push(a.trim())}return this._parseSection(r,0)}},{key:"parseHead",value:function(e){for(var t=0,n={},r=0;r<e.childElementCount;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e.children[r],a=i.nodeName;if(i.firstChild){var o=i.firstChild.textContent;n[a]=o}}return n}},{key:"parseOPML",value:function(e){var t=p.default.loadXML(e);return this._parseOPMLData(t)}},{key:"_parseOPMLData",value:function(e){var t=this,n={items:[]};return function e(r,i,a){var o,s,u=!0;switch(r.nodeName){case"#document":case"body":case"opml":break;case"head":u=!1;var l=t.parseHead(r);n.text=null===l||void 0===l?void 0:l.title;break;case"outline":var c=r.attributes,d=c.text,h=d?d.value:"",f=c.complete||c._complete,g=!(!f||"true"!==f.value),v=c.note||c._note||c.Notes,m=t.convertHTMLFormatting(h);s={id:null===(o=c.id)||void 0===o?void 0:o.value,text:m,isComplete:g,items:[],index:""+a};try{t.parseClassName(Array.from(r.attributes).map((function(e){return e.localName})),s)}catch(b){}if(v){var y=p.default.unescape(v.value);s.items=[{text:y,isNote:!0}]}i.items.push(s);break;default:p.default.log("Unknown OPML Node: ",r)}if(u){var _=0;for(a=0;a<r.childElementCount;++a){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;e(r.children[a],s||n,a)}}return s}(e,n,0),n}},{key:"parseJSON",value:function(){var e=u()(o.a.mark((function e(t,n){var r,i,a,s;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(void 0===t.moodoVer||void 0===t.moodoRoot&&void 0===t.items){e.next=26;break}if(e.prev=1,!t.doc){e.next=19;break}if(i={},!t.sentinel){e.next=15;break}if(!(s=g.default.crypto.getKeyBySentinel(t.sentinel))){e.next=12;break}return e.next=9,Promise.all(t.items.map((function(e){return y.a.decryptItemIn(e,g.default.crypto,s)})));case 9:a=e.sent,e.next=13;break;case 12:return e.abrupt("return",null);case 13:e.next=16;break;case 15:a=t.items.map(y.a.itemIn);case 16:n&&(a.forEach((function(e){var t=i[e.id];t||(t=v.a.generateID(),i[e.id]=t),e.id=t})),a.forEach((function(e){if(e.text=e.text.replace(f.a.Regexp.Interlink,(function(e,t){var n=i[t];return n?"[[".concat(n,"]]"):e})),e.parent){e.parent=i[e.parent];try{p.default.PAssert(495,e.parent,"Imported item has no parent")}catch(t){p.default.reportError(t)}}}))),m.a.createItemHierarchy(a),r={rootData:a[0],root:a[0],text:t.doc.text,items:a};case 19:return n&&r&&(r.root.id=v.a.generateID()),e.abrupt("return",r);case 23:e.prev=23,e.t0=e.catch(1),p.default.reportError(e.t0);case 26:return e.abrupt("return",!1);case 27:case"end":return e.stop()}}}),e,null,[[1,23]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_findLineParent",value:function(e,t,n){for(var r,i=0,a=Math.min(e.length-1,t-1);a>=0;--a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e[a];if(o&&o.indentLevel===n-1){r=o;break}}return r}},{key:"convertCodeBlocks",value:function(e){var t=[];e.items.forEach((function(e,n){var r;if(null===(r=e.text)||void 0===r?void 0:r.startsWith("```")){var i=t[0];!i||i.end?t.splice(0,0,{start:n}):i.end=n}})),t.forEach((function(t){var n=t.start,r=t.end;if(void 0!==n&&r){var i=e.items[n].text.replace("```","").trim(),a=e.items.slice(n+1,r).map((function(e){return e.text})).join("\n");e.items[n].text=f.a.Prefix.CodeBlock+(i||"")+" "+a,e.items.splice(n+1,r-n)}}))}},{key:"parseText",value:function(e){for(var t=0,n={items:[]},r=[],i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=this._parseTextLine(e[i]);if(a){r.push(a);var o=this._findLineParent(r,i,a.indentLevel)||n;a.parent=o,o.items.push(a)}}return this.convertCodeBlocks(n),n}},{key:"_parseTextLine",value:function(e){if(e&&e.length>0)return{indentLevel:Math.floor(e.search(/\S|$/)/4),text:p.default.trimString(e),items:[]}}},{key:"parseClassName",value:function(e,t){if(e)return e.indexOf("high")>=0?t.priority=f.a.VMLIFlag.P0:e.indexOf("medium")>=0?t.priority=f.a.VMLIFlag.P1:e.indexOf("low")>=0&&(t.priority=f.a.VMLIFlag.P2),e.indexOf("complete")>=0&&(t.isComplete=!0),e.indexOf("starred")>=0&&(t.isStarred=!0),e.indexOf("note")>=0&&(t.isNote=!0),t}},{key:"parseForTab",value:function(e){return(null===e||void 0===e?void 0:e.indexOf("Apple-tab-span"))>=0}},{key:"traverseDOMNew",value:function(e){var t,n,r=this.parseDOM(e),i=this.parsedDOMToItemData(r).itemData;return i.text||1!==(null===(t=i.items)||void 0===t?void 0:t.length)||i.items[0].text||1!==(null===(n=i.items[0].items)||void 0===n?void 0:n.length)||(i=i.items[0]),i.text?{items:[i]}:i}},{key:"parseDOM",value:function(e){var t,n,r=this;if("META"!==e.nodeName){if("#text"===e.nodeName)return{nodeNames:[e.nodeName],text:e.textContent};if("LI"===e.nodeName&&e.classList.contains("note"))return{nodeNames:["#text"],text:e.innerHTML,className:"note"};if("BR"===e.nodeName||0===e.childNodes.length&&(null===(t=e.classList)||void 0===t?void 0:t.contains("c-mrkdwn__br")))return{nodeNames:["BR"],linebreak:!0};if(null===(n=e.childNodes)||void 0===n?void 0:n.length){for(var i=0,a=[],o=function(t){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r.parseDOM(e.childNodes[t]);n&&(!(null===n||void 0===n?void 0:n.items)||n.text||r.isNodeList(n)?a.push(n):(n.items.forEach((function(e){return r.combineNodeAttrs(e,n)})),a.pushArray(n.items)))},s=0;s<e.childNodes.length;s++)o(s);if(a.length>0){var u;if(1!==(null===a||void 0===a?void 0:a.length)||S[e.nodeName]){u={nodeNames:[e.nodeName]};var l={},c=[],d=!0;a.forEach((function(e,t){if(!p.default.isWhiteSpace(e.text)||!r.isOnlyText(e)||!d&&!r.isNodeBlock(l)){if(d||e.linebreak)!e.items||e.text||e.linebreak||e.inlineElements||e.img||!r.isNodeBlock(e)||!r.isNodeBlock(u)?(l=e,c.push(e)):(c.pushArray(e.items),l=e.items[e.items.length-1]);else if(r.isNodeBlock(e)||!d&&(r.isNodeBlock(a[t-1])||l.linebreak))!e.items||l.items||e.text||e.img?(l=e,c.push(e)):p.default.isWhiteSpace(l.text)&&!l.inlineElements?(c.pushArray(e.items),l=e.items[e.items.length-1]):(l.items=e.items,r.combineNodeAttrs(l,e));else if(l.items)l.items.push(e);else{if(!l.inlineElements||l.className||!p.default.deepEqual(l.nodeNames,["SPAN"])){var n=p.default.clone(l);Object.keys(l).forEach((function(e){return delete l[e]})),l.nodeNames=["SPAN"],l.inlineElements=[n]}l.inlineElements.push(e)}d=!1}})),u.items=c}else u=a[0],this.combineNodeAttrs(u,{nodeNames:[e.nodeName]});var h=e.getAttribute("id");h&&(u.id=h);var f=e.getAttribute("data-date");return f&&(u.date=f),"A"===e.nodeName&&(u.href=e.getAttribute("href")),e.className&&(u.className=this.combineClassNames(u,e)),u}}else if("IMG"===e.nodeName){var g=e;return{nodeNames:["IMG"],img:g.src||g.srcset&&g.srcset[0]}}return"LI"===e.nodeName||"DIV"===e.nodeName||"P"===e.nodeName?{nodeNames:[e.nodeName],text:e.textContent}:void 0}}},{key:"combineClassNames",value:function(e,t){return[e.className,t.className].filter((function(e){return e})).join(" ")}},{key:"parseNodeNamesToVMLIElementProps",value:function(e){var t={};return e.forEach((function(e){"B"===e?t.bold=!0:"I"===e?t.italic=!0:"U"===e&&(t.underline=!0)})),p.default.isEmpty(t)?void 0:t}},{key:"parsedDOMToItemData",value:function(e,t){var n=this,r=[],a={};e.date&&(a.date=e.date),e.id&&(a.id=e.id),t&&r.push(new _.a("1. "));var o=this.parseForTab(e.className)?1:0;if(o||(this.parseClassName(e.className,a),this.parseNodeToElements(r,e)),e.inlineElements){var s=[];e.inlineElements.forEach((function(e){n.parseForTab(e.className)?o++:n.parseInlineElement(s,e)})),r.pushArray(s)}var u=new b.a(r).getRawText();if((u||""===u&&!e.items)&&(a.text=u),e.items){a.items=[];var l=i()({},o,a);e.items.forEach((function(t,r){var i=n.parsedDOMToItemData(t,e.nodeNames.includes("OL")),s=i.itemData,u=i.indent;if(s.items||s.text&&!p.default.isWhiteSpace(s.text)||n.isNodeBlock(t)&&!t.linebreak){var c=u>o?n.getItemAtIndent(l,u-1,o):s.isNote?l[o]:a;c.items?s.isNote?c.items.splice(0,0,s):c.items.push(s):c.items=[s],l[u]=s}})),this.convertCodeBlocks(a)}return{itemData:a,indent:o}}},{key:"parseNodeToElements",value:function(e,t,n){var r,i;return t.img?(i=t.text||t.img,r={link:{isImage:!0,showImage:!0,href:t.img,text:i}}):t.href?(i=t.text||!t.inlineElements&&t.href||"",t.inlineElements&&(i+=this.inlineElementsToText(t),t.inlineElements=void 0),r={link:{href:t.href,text:i}}):(i=t.text,r=this.parseNodeNamesToVMLIElementProps(t.nodeNames),n&&(r=Object.assign(r||{},n))),i&&e.push(new _.a(i,r)),r}},{key:"inlineElementsToText",value:function(e){var t=this;return e.inlineElements.map((function(e){return e.text||t.inlineElementsToText(e)})).join("")}},{key:"parseInlineElement",value:function(e,t,n){var r=this,i=this.parseNodeToElements(e,t,n);t.inlineElements&&t.inlineElements.forEach((function(t){return r.parseInlineElement(e,t,i||n)}))}},{key:"getItemAtIndent",value:function(e,t,n){for(var r=0;t>=0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var i=e[t];if(i)return i;t--}return e[n]}},{key:"isOnlyText",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.every((function(e){return"#text"===e}))}},{key:"isNodeText",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return w[e]}))}},{key:"isNodeBlock",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return k[e]}))}},{key:"isNodeList",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return S[e]}))}},{key:"combineNodeAttrs",value:function(e,t){var n;(e.nodeNames=p.default.arrayUnion(e.nodeNames,t.nodeNames).filter((function(e){return"#text"!==e})),e.className=this.combineClassNames(e,t),e.nodeNames.includes("A"))&&(e.href=null!==(n=e.href)&&void 0!==n?n:t.href);return e}},{key:"convertHTMLFormatting",value:function(e){return e.includes("<")?e.replace(/<b>|<\/b>/g,"**").replace(/<i>|<\/i>/g,"*").replace(/<u>|<\/u>/g,"__"):e}}]),e}();t.a=new E},function(e,t,n){"use strict";function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var i;n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return f}));var a,o=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(a||(a={}));var s={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},u=a.INFO,l=((i={})[a.DEBUG]="log",i[a.VERBOSE]="log",i[a.INFO]="info",i[a.WARN]="warn",i[a.ERROR]="error",i),c=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(t<e.logLevel)){var a=(new Date).toISOString(),o=l[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,r(["["+a+"]  "+e.name+":"],n))}},d=function(){function e(e){this.name=e,this._logLevel=u,this._logHandler=c,this._userLogHandler=null,o.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in a))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(e){this._logLevel="string"===typeof e?s[e]:e},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.DEBUG],e)),this._logHandler.apply(this,r([this,a.DEBUG],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.VERBOSE],e)),this._logHandler.apply(this,r([this,a.VERBOSE],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.INFO],e)),this._logHandler.apply(this,r([this,a.INFO],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.WARN],e)),this._logHandler.apply(this,r([this,a.WARN],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.ERROR],e)),this._logHandler.apply(this,r([this,a.ERROR],e))},e}();function h(e){o.forEach((function(t){t.setLogLevel(e)}))}function f(e,t){for(var n=function(n){var r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(e){if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((function(e){return e})).join(" ");n>=(null!==r&&void 0!==r?r:t.logLevel)&&e({level:a[n].toLowerCase(),message:s,args:i,type:t.name})}},r=0,i=o;r<i.length;r++){n(i[r])}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(41);var r=n(0),i=function(e,t){return"string"===typeof e&&(e=e.split(",")),e[e.length-1]=""+(+e[e.length-1]+t),e.join(",")},a=function(e,t){"number"===typeof e&&(e=""+e),"number"===typeof t&&(t=""+t);var n="0";if("string"===typeof e&&"string"===typeof t)n=function(e,t){var n=e.split(","),r=t.split(","),a=n.length,o=r.length;return a<o?+n[a-1]+1<+r[a-1]?i(n,1):i(r,-1):a>o||+n[a-1]+1<+r[o-1]?i(n,1):(n.push("0"),n.join(","))}(e,t);else if("string"===typeof e){var a=+e.split(",")[0];try{r.default.PAssert(420,!isNaN(a),"Index is not valid string",e)}catch(s){r.default.reportError(s)}n=""+Math.floor(a+1)}else if("string"===typeof t){var o=+t.split(",")[0];try{r.default.PAssert(421,!isNaN(o),"Index is not valid string",t)}catch(s){r.default.reportError(s)}n=""+Math.ceil(o-1)}return n}},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(1),u=n(0),l=n(2),c=n(30),d=n(62),h=function(){function e(){i()(this,e),this.FOLDER_MIMETYPE="application/vnd.google-apps.folder",this.folders={root:{type:"root",title:"_Moo.do Files (Do not delete)",id:void 0,prop:"MooDoDefaultRoot"},attach:{type:"attach",title:"Shared Attachments",id:void 0,prop:"MooDoDefaultAttach",parent:"root"},backup:{type:"backup",title:"Moo.do Backups",id:void 0,prop:"MooDoDefaultBackup",parent:"root"}}}return o()(e,[{key:"createFolderStructure",value:function(e,t,n){var r=t.type;try{u.default.PAssert(1082,!u.default.isDemoMode(),"Should not be creating "+r+"folder in demo mode")}catch(o){u.default.reportError(o)}try{u.default.PAssert(1083,void 0===t.id,"Must not already have a "+r+"folder")}catch(o){u.default.reportError(o)}t.parent&&(this.folders[t.parent].id||this.getFolder(e,this.folders[t.parent],this.createFolderStructure.bind(this,t)));try{u.default.PAssert(1085,n,"Must supply a valid callback when done creating the "+r+" file structure")}catch(o){u.default.reportError(o)}var i=c.a.fns("drive").files.insert.packedFn,a={resource:{mimeType:this.FOLDER_MIMETYPE,title:t.title,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:t.prop,value:"TRUE",visibility:"PRIVATE"}]}};t.parent&&(a.resource.parents=[{id:this.folders[t.parent].id}]);l.default.remoteAPI().runRemoteSingleRequest(e,i,a,(function(e){return u.default.shouldLog(s.a.LogLevels.Folders)&&u.default.log("Successfully created "+r+" folder",e),n(e.id)}),(function(e){return u.default.shouldLog(s.a.LogLevels.Folders)&&u.default.log("Error creating "+r+" folder",e),n()}),void 0,d.a.SingleFolder)}},{key:"getSetting",value:function(e,t){return l.default.settings.driveFolders.getProperty(e+"-"+t)}},{key:"setSetting",value:function(e,t,n){t=e+"-"+t,l.default.settings.driveFolders.setProperty(t,n)}},{key:"getFolderByType",value:function(e,t,n){return this.getFolder(e,this.folders[t],n)}},{key:"getFolder",value:function(e,t,n){var r=this,i="string"===typeof t?this.folders[t]:t;try{u.default.PAssert(1086,i,"Trying to get invalid folder")}catch(o){u.default.reportError(o)}try{u.default.PAssert(1087,!u.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(o){u.default.reportError(o)}try{u.default.PAssert(1088,n,"Must provide a valid callback when getting the root folder")}catch(o){u.default.reportError(o)}if(i){if(i.id)return n(i.id);var a=function(){var t=r.getSetting(e,i.type),a=function(){r.createFolderStructure(e,i,(function(t){return t?(i.id=t,r.setSetting(e,i.type,t),n(t)):n(void 0)}))};if(t){l.default.remoteAPI().driveFilesGet(e,t,(function(e){if(e)return i.id=t,n(t);a()}),(function(t){if(r.setSetting(e,i.type,void 0),!t||!t.error||404!==t.error.code)return n(void 0);a()}))}else{var c="properties has {key='"+i.prop+"' and value='TRUE' and visibility='PRIVATE'} and 'me' in owners and trashed=false";l.default.remoteAPI().driveFilesList(e,c,(function(t){if(t.length>0){try{u.default.PAssert(1089,1===t.length,"Must have a single root folder present")}catch(o){u.default.reportError(o)}return u.default.shouldLog(s.a.LogLevels.Folders)&&u.default.log("Successfully found root folder",t),i.id=t[0].id,r.setSetting(e,i.type,i.id),n(i.id)}a()}),(function(e){return u.default.shouldLog(s.a.LogLevels.Folders)&&u.default.log("Error getting root folder",e),n(void 0)}),{getAllPages:!0})}};i.parent?this.getFolderByType(e,i.parent,a):a()}else n(void 0)}},{key:"copyFileToFolder",value:function(e,t,n,r){l.default.remoteAPI().driveParentsInsert(e,t,n,(function(e){u.default.shouldLog(s.a.LogLevels.Folders)&&u.default.log("Error sharing file ",e),r(!0,e)}),(function(e){u.default.shouldLog(s.a.LogLevels.Folders)&&u.default.log("Successfully shared file ",e),r(!1,e)}))}},{key:"getAttachFolder",value:function(e,t){return this.getFolderByType(e,s.a.DriveFolder.Attach,t)}},{key:"getRootFolder",value:function(e,t){return this.getFolderByType(e,s.a.DriveFolder.Root,t)}},{key:"getBackupFolder",value:function(e,t){return this.getFolderByType(e,s.a.DriveFolder.Backup,t)}},{key:"getDocumentFolder",value:function(e,t,n){var r={type:t,title:t,id:void 0,parent:s.a.DriveFolder.Root,prop:t};this.getFolder(e,r,n)}}]),e}();t.a=new h},function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r=n(72),i=n.n(r),a=n(5),o=n.n(a),s=n(6),u=n.n(s),l=n(18),c=n.n(l),d=n(19),h=n.n(d),f=n(11),p=n.n(f),g=n(1),v=n(0),m=n(14),y=n.n(m),_=n(2);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var w=function(e,t){v.default.reportError(e,t,void 0,"React Component Error: "),_.default.toasts.pushMessage(g.a.MessageID.ReactError)},k=function(e){c()(n,e);var t=b(n);function n(e){var r;return o()(this,n),(r=t.call(this,e)).state={error:null},r}return u()(n,[{key:"componentDidCatch",value:function(e,t){try{this.props.onError&&this.props.onError(),w(e,t)}catch(n){}this.setState({error:e})}},{key:"render",value:function(){var e=this.props.children;return null!==this.state.error?null:e||null}}]),n}(m.Component);function S(e,t){var n=function(n,r){return y.a.createElement(k,null,y.a.createElement(e,i()({},n,{onError:t})))};return y.a.memo(n)}},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(117)},function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return g}));var r=n(18),i=n.n(r),a=n(19),o=n.n(a),s=n(11),u=n.n(s),l=n(5),c=n.n(l),d=n(6),h=n.n(d);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u()(e);if(t){var i=u()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return o()(this,n)}}var p=function(){function e(t){c()(this,e),this.isLocalOnly=t,this.documents={}}return h()(e,[{key:"renameDocument",value:function(e,t){}},{key:"deleteDocAPIItems",value:function(e,t){}}]),e}(),g=function(e){i()(n,e);var t=f(n);function n(){return c()(this,n),t.apply(this,arguments)}return n}(p)},function(e,t,n){"use strict";var r=n(3),i=n.n(r),a=n(10),o=n.n(a),s=n(5),u=n.n(s),l=n(6),c=n.n(l),d=n(0),h=n(1),f=n(83),p=n(27),g=function(){function e(t,n,r,i,a,o,s){u()(this,e),this.file=t,this.properties=i,this.contentType=t.type,this.accountID=n,this.folder=r,this.onComplete=o||d.default.emptyFn,this.onError=s||d.default.emptyFn,this.onProgress=a||d.default.emptyFn,this._callbacks=[],this.offset=0,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;this.url=this._buildURL(void 0,{uploadType:"resumable"}),this._percent=0}return c()(e,[{key:"upload",value:function(){var e=this;this._hasStarted=!0,d.default.isDemoMode()?setTimeout((function(){e.onComplete()}),2e3):p.a.getAccountAuthToken(this.accountID,[h.a.GScope.Drive],(function(t){if(t){var n={Authorization:"Bearer "+t.access_token,"Content-Type":"application/json","X-Upload-Content-Length":e.file.size,"X-Upload-Content-Type":e.contentType},r=function(){var t=o()(i.a.mark((function t(r){var a,o,s,u;return i.a.wrap((function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:a={title:e.file.name,mimeType:e.contentType,parents:r?[{id:r}]:[]},e.properties&&(a.properties=Object.keys(e.properties).map((function(t){return{key:t,value:e.properties[t],visibility:"PRIVATE"}})));try{o=JSON.stringify(a)}catch(l){d.default.reportError(l)}if(!o){t.next=15;break}return t.prev=4,t.next=7,d.default.XHR({url:e.url,type:"POST",headers:n,data:o,autoRetry:!0});case 7:(s=t.sent).status<h.a.HTTPStatusCode.BadRequest?(u=s.getResponseHeader("Location"),e.url=u,e._runUpload()):e._onError(s),t.next=13;break;case 11:t.prev=11,t.t0=t.catch(4);case 13:t.next=16;break;case 15:e._onError();case 16:case"end":return t.stop()}}}),t,null,[[4,11]])})));return function(e){return t.apply(this,arguments)}}();e.folder.named?f.a.getFolder(e.accountID,e.folder.named,r):r(e.folder.id)}}))}},{key:"_runUpload",value:function(){var e=this;try{d.default.PAssert(891,this.url,"Must have a valid remote URL to run upload")}catch(i){d.default.reportError(i)}this._isRunning=!0;var t=Math.min(this.offset+1048576,this.file.size),n=this.file.slice(this.offset,t),r={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(t-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};d.default.XHR({url:this.url,type:"PUT",headers:r,data:n,autoRetry:!0}).then((function(t){if(t.status===h.a.HTTPStatusCode.Success||t.status===h.a.HTTPStatusCode.Created)e.isCanceled()||e._onComplete(t);else if(t.status===h.a.HTTPStatusCode.PermRedirect){var n=e._extractRange(t.getResponseHeader("Range"));e.offset=n,e._onProgress(e.offset/e.file.size),e.isCanceled()||e._runUpload()}else e._onError(t)}))}},{key:"resume",value:function(){var e=this;try{d.default.PAssert(892,!this.isDone(),"Should not resume a completed upload")}catch(n){d.default.reportError(n)}try{d.default.PAssert(893,this._hasStarted,"Must have started an upload to resume it")}catch(n){d.default.reportError(n)}try{d.default.PAssert(894,this.url,"Must have a valid remote URL to resume upload")}catch(n){d.default.reportError(n)}if(this._hasError=!1,this._isCanceled=!1,this._isRunning)0;else if(this._isRunning=!0,this._hasStarted&&this.url){var t={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};d.default.XHR({url:this.url,type:"PUT",headers:t,autoRetry:!0}).then((function(t){if(t.status===h.a.HTTPStatusCode.PermRedirect){var n=e._extractRange(t.getResponseHeader("Range"));e.offset=n,e._onProgress(e.offset/e.file.size),e._runUpload()}else e._onError(t)}))}else this.upload()}},{key:"cancel",value:function(){try{d.default.PAssert(895,!this._isDone,"Cannot cancel an upload that is already complete")}catch(e){d.default.reportError(e)}this._isCanceled=!0,this._isRunning=!1}},{key:"_onError",value:function(e){this._hasError=!0,this._isRunning=!1,this.onError()}},{key:"_onComplete",value:function(e){var t=0;try{d.default.PAssert(896,!this._isDone,"Should not call the complete CB twice")}catch(i){d.default.reportError(i)}try{d.default.PAssert(897,!this._isCanceled,"Should not be able to complete a canceled upload")}catch(i){d.default.reportError(i)}this._isDone=!0,this._isRunning=!1;var n={};if(e&&e.response)try{n=JSON.parse(e.response)}catch(a){d.default.reportError(a)}this._onProgress(1),this.onComplete(n);for(var r=0;r<this._callbacks.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._callbacks[r](n)}catch(a){d.default.reportError(a)}}this._callbacks=[]}},{key:"_onProgress",value:function(e){try{d.default.PAssert(898,!this._hasError,"Should not make forward progress when an error has occurred")}catch(t){d.default.reportError(t)}this._percent=e,this.onProgress(e)}},{key:"_extractRange",value:function(e){return d.default.parseInt(e.match(/\d+/g).pop())+1}},{key:"_buildQueryString",value:function(e){return e=e||{},Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}},{key:"_buildURL",value:function(e,t){var n="https://www.googleapis.com/upload/drive/v2/files/";e&&(n+=e);var r=this._buildQueryString(t);return r&&(n+="?"+r),n}},{key:"notifyOnComplete",value:function(e){try{d.default.PAssert(899,this._callbacks.indexOf(e)<0,"Should not include fn twice")}catch(t){d.default.reportError(t)}try{d.default.PAssert(900,!this.isDone(),"Should not notify on complete after done")}catch(t){d.default.reportError(t)}try{d.default.PAssert(901,!this.hasError(),"Should not notify on complete after error")}catch(t){d.default.reportError(t)}this._callbacks.push(e)}},{key:"isCanceled",value:function(){return this._isCanceled}},{key:"isDone",value:function(){return this._isDone}},{key:"isRunning",value:function(){return this._isRunning}},{key:"hasError",value:function(){return this._hasError}},{key:"getPercent",value:function(){return this._percent}}]),e}();t.a=g},function(e,t,n){var r=t.options=n(136);t.parser=n(31),t.refiner=n(57),t.Parser=t.parser.Parser,t.Refiner=t.refiner.Refiner,t.Filter=t.refiner.Filter,t.ParsedResult=n(24).ParsedResult,t.ParsedComponents=n(24).ParsedComponents;var i=function(e){e=e||t.options.casualOption(),this.parsers=new Object(e.parsers),this.refiners=new Object(e.refiners)};i.prototype.parse=function(e,t,n){t=t||new Date,(n=n||{}).forwardDate=n.forwardDate||n.forwardDate;var r=[];return this.parsers.forEach((function(i){var a=i.execute(e,t,n);r=r.concat(a)})),r.sort((function(e,t){return e.index-t.index})),this.refiners.forEach((function(t){r=t.refine(e,r,n)})),r},i.prototype.parseDate=function(e,t,n){var r=this.parse(e,t,n);return r.length>0?r[0].start.date():null},t.Chrono=i,t.strict=new i(r.strictOption()),t.casual=new i(r.casualOption()),t.en=new i(r.mergeOptions([r.en.casual,r.commonPostProcessing])),t.en_GB=new i(r.mergeOptions([r.en_GB.casual,r.commonPostProcessing])),t.de=new i(r.mergeOptions([r.de.casual,r.en,r.commonPostProcessing])),t.pt=new i(r.mergeOptions([r.pt.casual,r.en,r.commonPostProcessing])),t.es=new i(r.mergeOptions([r.es.casual,r.en,r.commonPostProcessing])),t.fr=new i(r.mergeOptions([r.fr.casual,r.en,r.commonPostProcessing])),t.ja=new i(r.mergeOptions([r.ja.casual,r.en,r.commonPostProcessing])),t.parse=function(){return t.casual.parse.apply(t.casual,arguments)},t.parseDate=function(){return t.casual.parseDate.apply(t.casual,arguments)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tues:2,tue:2,wednesday:3,wed:3,thursday:4,thurs:4,thur:4,thu:4,friday:5,fri:5,saturday:6,sat:6},s=new RegExp("(\\W|^)(?:(?:\\,|\\(|\\\uff08)\\s*)?(?:on\\s*?)?(?:(this|last|past|next)\\s*)?("+Object.keys(o).join("|")+")(?:\\s*(?:\\,|\\)|\\\uff09))?(?:\\s*(this|last|past|next)\\s*week)?(?=\\W|$)","i");t.updateParsedComponent=function(e,t,n,i){var a=r(t),o=!1,s=a.day();return"last"==i||"past"==i?(a=a.day(n-7),o=!0):"next"==i?(a=a.day(n+7),o=!0):a="this"==i?a.day(n):Math.abs(n-7-s)<Math.abs(n-s)?a.day(n-7):Math.abs(n+7-s)<Math.abs(n-s)?a.day(n+7):a.day(n),e.start.assign("weekday",n),o?(e.start.assign("day",a.date()),e.start.assign("month",a.month()+1),e.start.assign("year",a.year())):(e.start.imply("day",a.date()),e.start.imply("month",a.month()+1),e.start.imply("year",a.year())),e},t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,n,r,i){var s=r.index+r[1].length,u=(e=r[0].substr(r[1].length,r[0].length-r[1].length),new a({index:s,text:e,ref:n})),l=r[3].toLowerCase(),c=o[l];if(void 0===c)return null;var d=r[2],h=r[4],f=d||h;return f=(f=f||"").toLowerCase(),t.updateParsedComponent(u,n,c,f),u.tags.ENWeekdayParser=!0,u}}},function(e,t,n){n(24).ParsedComponents;var r=n(57).Refiner,i=new RegExp("^\\s*(T|at|after|before|on|of|,|-)?\\s*$"),a=t.isDateOnly=function(e){return!e.start.isCertain("hour")},o=t.isTimeOnly=function(e){return!e.start.isCertain("month")&&!e.start.isCertain("weekday")},s=t.isAbleToMerge=function(e,t,n){return e.substring(t.index+t.text.length,n.index).match(i)},u=t.mergeDateTimeComponent=function(e,t){var n=e.clone();return t.isCertain("hour")?(n.assign("hour",t.get("hour")),n.assign("minute",t.get("minute")),t.isCertain("second")?(n.assign("second",t.get("second")),t.isCertain("millisecond")?n.assign("millisecond",t.get("millisecond")):n.imply("millisecond",t.get("millisecond"))):(n.imply("second",t.get("second")),n.imply("millisecond",t.get("millisecond")))):(n.imply("hour",t.get("hour")),n.imply("minute",t.get("minute")),n.imply("second",t.get("second")),n.imply("millisecond",t.get("millisecond"))),t.isCertain("meridiem")?n.assign("meridiem",t.get("meridiem")):void 0!==t.get("meridiem")&&void 0===n.get("meridiem")&&n.imply("meridiem",t.get("meridiem")),1==n.get("meridiem")&&n.get("hour")<12&&(t.isCertain("hour")?n.assign("hour",n.get("hour")+12):n.imply("hour",n.get("hour")+12)),n};function l(e,t,n){var r=t.start,i=n.start,a=u(r,i);if(null!=t.end||null!=n.end){var o=null==t.end?t.start:t.end,s=null==n.end?n.start:n.end,l=u(o,s);null==t.end&&l.date().getTime()<a.date().getTime()&&(l.isCertain("day")?l.assign("day",l.get("day")+1):l.imply("day",l.get("day")+1)),t.end=l}t.start=a;var c=Math.min(t.index,n.index),d=Math.max(t.index+t.text.length,n.index+n.text.length);for(var h in t.index=c,t.text=e.substring(c,d),n.tags)t.tags[h]=!0;return t.tags.ENMergeDateAndTimeRefiner=!0,t}t.Refiner=function(){r.call(this),this.refine=function(e,t,n){if(t.length<2)return t;for(var r=[],i=null,u=null,c=1;c<t.length;c++)i=t[c],u=t[c-1],a(u)&&o(i)&&s(e,u,i)?(u=l(e,u,i),i=t[c+1],c+=1):a(i)&&o(u)&&s(e,u,i)&&(u=l(e,i,u),i=t[c+1],c+=1),r.push(u);return null!=i&&r.push(i),r}}},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=function(){function e(t,n){i()(this,e),this.__isListener=!0,this.target=t,this.cb=n,this._disposed=!1}return o()(e,[{key:"dispose",value:function(){this._disposed=!0,this.target.unlistenListener(this)}},{key:"isDisposed",value:function(){return this._disposed}}]),e}();t.a=s},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(1),u=n(0),l=(n(12),n(2)),c=(n(47),n(56)),d=function(){function e(){i()(this,e)}return o()(e,[{key:"resetSavedSelection",value:function(){this.savedCaretPosition=void 0,this.savedSelectionMinMax=void 0}},{key:"getCaretPosition",value:function(){if(!this.savedCaretPosition){var e=this.savedRange,t=e||c.default.getSelectionRangeNative();if(t){var n=t.getBoundingClientRect(),r=u.default.findParent(t.endContainer,"hiddenInputItem")||u.default.findParent(t.endContainer,"itemInPaneText");if(r){var i,a=r.getBoundingClientRect(),o=n.right-a.left-(+(null===(i=r.style.paddingLeft)||void 0===i?void 0:i.replace("px",""))||0),s=n.top-a.top;if(0===n.left){var l,d=+(null===(l=r.style.paddingTop)||void 0===l?void 0:l.replace("px",""));this.savedCaretPosition={left:0,top:u.default.isNumber(d)?d:0,height:0}}else this.savedCaretPosition={left:o,top:s,height:n.height,fromSavedRange:!!e}}}}return this.savedCaretPosition}},{key:"getSelectionMinMax",value:function(e,t){if(!this.savedSelectionMinMax){var n=c.default.getSelectionRangeNative();if(n){var r,i=u.default.findParent(n.endContainer,"hiddenInputItem")||u.default.findParent(n.endContainer,"itemInPaneText"),a=i.getBoundingClientRect(),o=a.left+(+(null===(r=i.style.paddingLeft)||void 0===r?void 0:r.replace("px",""))||0),s=Array.from(n.getClientRects()).filter((function(e){return e.width>0})),l=s[0],d=s[s.length-1],h=new Set(s.map((function(e){return e.top}))).size;this.savedSelectionMinMax={numLines:h,min:{x:l.left-o+e,y:l.top-a.top+t},max:{x:d.right-o+e,y:d.top-a.top+t}}}}return this.savedSelectionMinMax}},{key:"updateFromPaneObject",value:function(e,t,n,r){var i=this,a=e.pane,o=a.listManager.getElementByID(e.id),d=[],h={},f=a.hiddenInput;if(this.resetSavedSelection(),u.default.clearTimeoutOnce("updateFromPaneObject"+a.id),f){var p,g;if(o){var v=u.default.findParent(o,"paneContent");p=o.getBoundingClientRect().top-v.getBoundingClientRect().top+v.scrollTop}else r||u.default.timeoutOnce("updateFromPaneObject"+a.id,(function(){return i.updateFromPaneObject(e,t,n,(r||0)+1)}),60);if(e.index>0&&(g=a.indexOfPrevVMLI(e.index,void 0))>=0){var m=a.objectAtIndex(g);d.push(m),h[m.id]=a.getPaddingForPaneObject(m)}var y=d.length;d.push(e);var _=h[e.id]=a.getPaddingForPaneObject(e),b=e.getDisplayLengthWithoutPrefix();t>b&&(t=b),n>b&&(n=b);var w=a.indexOfNextVMLI(e.index,void 0);if(w>=0){var k=a.objectAtIndex(w);d.push(k),h[k.id]=a.getPaddingForPaneObject(k)}try{var S=d.map((function(e,t){var n=e.item,r=e.pane,i=l.default.DisplaySettings.fontSizeForItem(e);var a=l.default.DisplaySettings.lineHeightForItem(e),o=h[e.id]-_-s.a.TextPaddingLeft+0,u=e.getDisplayLengthWithoutPrefix()>0?l.default.ElementRenderer.renderNew(n.elsNew.elements,n,r,{noPrefix:!0,forHiddenInput:!0,showMarkdown:e.showMarkdown(!0),fontSize:i}):"",c=["position: relative","font-size: ".concat(i,"px"),"margin-left: ".concat(o,"px"),"line-height: ".concat(a,"px"),"padding-top: ".concat(l.default.DisplaySettings.paddingForItemTop(e),"px"),"padding-bottom: ".concat(l.default.DisplaySettings.paddingForItemBottom(),"px"),"padding-left: ".concat(s.a.TextPaddingLeft,"px"),"margin-right: ".concat(l.default.DisplaySettings.paddingForItemRight(e),"px"),"z-index: 0",!1].filter((function(e){return!!e})).join(";"),d=e.item.isStarred()?"":"c-background";return'<div data-index="'.concat(e.index,'" class="hiddenInputItem ').concat(s.a.ItemClass," ").concat(d," ").concat(n.styleProps(r,!0)," ").concat(g>=0?"firstItem":"",'" style="').concat(c,'">').concat(u,"</div>")})).join("");f.style.display="",f.style.paddingLeft=_+"px",void 0!==p&&(f.style.top=p+"px"),f.innerHTML!==S&&(f.innerHTML=S);var E=f.children[y];f.focus();var P=c.default.selectElement(E,t,n);this.setSavedRange(P)}catch(I){u.default.reportError(I)}}}},{key:"setSavedRange",value:function(e){this.savedRange=e}},{key:"blur",value:function(e){var t=e.hiddenInput;t.blur(),t.innerHTML="",t.style.display="none"}}]),e}();t.a=new d},function(e,t){var n={"\u96f6":0,"\u4e00":1,"\u4e8c":2,"\u5169":2,"\u4e09":3,"\u56db":4,"\u4e94":5,"\u516d":6,"\u4e03":7,"\u516b":8,"\u4e5d":9,"\u5341":10,"\u5eff":20,"\u5345":30};t.NUMBER=n,t.WEEKDAY_OFFSET={"\u5929":0,"\u65e5":0,"\u4e00":1,"\u4e8c":2,"\u4e09":3,"\u56db":4,"\u4e94":5,"\u516d":6},t.zhStringToNumber=function(e){for(var t=0,r=0;r<e.length;r++){var i=e[r];"\u5341"===i?t=0===t?n[i]:t*n[i]:t+=n[i]}return t},t.zhStringToYear=function(e){for(var t="",r=0;r<e.length;r++){var i=e[r];t+=n[i]}return parseInt(t)}},function(e,t){t.WEEKDAY_OFFSET={sonntag:0,so:0,montag:1,mo:1,dienstag:2,di:2,mittwoch:3,mi:3,donnerstag:4,do:4,freitag:5,fr:5,samstag:6,sa:6},t.MONTH_OFFSET={januar:1,jan:1,"jan.":1,februar:2,feb:2,"feb.":2,"m\xe4rz":3,maerz:3,"m\xe4r":3,"m\xe4r.":3,mrz:3,"mrz.":3,april:4,apr:4,"apr.":4,mai:5,juni:6,jun:6,"jun.":6,juli:7,jul:7,"jul.":7,august:8,aug:8,"aug.":8,september:9,sep:9,"sep.":9,sept:9,"sept.":9,oktober:10,okt:10,"okt.":10,november:11,nov:11,"nov.":11,dezember:12,dez:12,"dez.":12},t.INTEGER_WORDS_PATTERN="(?:eins|zwei|drei|vier|f\xfcnf|fuenf|sechs|sieben|acht|neun|zehn|elf|zw\xf6lf|zwoelf)",t.INTEGER_WORDS={eins:1,zwei:2,drei:3,vier:4,"f\xfcnf":5,fuenf:5,sechs:6,sieben:7,acht:8,neun:9,zehn:10,elf:11,"zw\xf6lf":12,zwoelf:12}},function(e,t,n){(function(n){var r,i,a;i=[],void 0===(a="function"===typeof(r=function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function r(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){s(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,s=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,n){var s=o.URL||o.webkitURL,u=document.createElement("a");t=t||e.name||"download",u.download=t,u.rel="noopener","string"==typeof e?(u.href=e,u.origin===location.origin?a(u):i(u.href)?r(e,t,n):a(u,u.target="_blank")):(u.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(u.href)}),4e4),setTimeout((function(){a(u)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,o){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,o),n);else if(i(e))r(e,n,o);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){a(s)}))}}:function(e,t,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return r(e,t,n);var a="application/octet-stream"===e.type,s=/constructor/i.test(o.HTMLElement)||o.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||a&&s)&&"object"==typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},l.readAsDataURL(e)}else{var c=o.URL||o.webkitURL,d=c.createObjectURL(e);i?i.location=d:location.href=d,i=null,setTimeout((function(){c.revokeObjectURL(d)}),4e4)}});o.saveAs=s.saveAs=s,e.exports=s})?r.apply(t,i):r)||(e.exports=a)}).call(this,n(89))},function(e,t){t.WEEKDAY_OFFSET={dimanche:0,dim:0,lundi:1,lun:1,mardi:2,mar:2,mercredi:3,mer:3,jeudi:4,jeu:4,vendredi:5,ven:5,samedi:6,sam:6},t.MONTH_OFFSET={janvier:1,jan:1,"jan.":1,"f\xe9vrier":2,"f\xe9v":2,"f\xe9v.":2,fevrier:2,fev:2,"fev.":2,mars:3,mar:3,"mar.":3,avril:4,avr:4,"avr.":4,mai:5,juin:6,jun:6,juillet:7,jul:7,"jul.":7,"ao\xfbt":8,aout:8,septembre:9,sep:9,"sep.":9,sept:9,"sept.":9,octobre:10,oct:10,"oct.":10,novembre:11,nov:11,"nov.":11,"d\xe9cembre":12,decembre:12,dec:12,"dec.":12},t.INTEGER_WORDS_PATTERN="(?:un|deux|trois|quatre|cinq|six|sept|huit|neuf|dix|onze|douze|treize)",t.INTEGER_WORDS={un:1,deux:2,trois:3,quatre:4,cinq:5,six:6,sept:7,huit:8,neuf:9,dix:10,onze:11,douze:12,treize:13}},function(e,t,n){var r=n(57).Refiner;t.Refiner=function(){r.call(this),this.pattern=function(){return/^\s*(to|\-)\s*$/i},this.refine=function(e,t,n){if(t.length<2)return t;for(var r=[],i=null,a=null,o=1;o<t.length;o++)i=t[o],(a=t[o-1]).end||i.end||!this.isAbleToMerge(e,a,i)||(a=this.mergeResult(e,a,i),i=null,o+=1),r.push(a);return null!=i&&r.push(i),r},this.isAbleToMerge=function(e,t,n){var r=t.index+t.text.length,i=n.index;return e.substring(r,i).match(this.pattern())},this.mergeResult=function(e,t,n){if(!t.isOnlyWeekday()&&!n.isOnlyWeekday()){for(var r in n.start.knownValues)t.start.isCertain(r)||t.start.assign(r,n.start.get(r));for(var r in t.start.knownValues)n.start.isCertain(r)||n.start.assign(r,t.start.get(r))}if(t.start.date().getTime()>n.start.date().getTime()){var i=t.start.dayjs(),a=n.start.dayjs();if(t.isOnlyWeekday()&&i.add(-7,"days").isBefore(a))i=i.add(-7,"days"),t.start.imply("day",i.date()),t.start.imply("month",i.month()+1),t.start.imply("year",i.year());else if(n.isOnlyWeekday()&&a.add(7,"days").isAfter(i))a=a.add(7,"days"),n.start.imply("day",a.date()),n.start.imply("month",a.month()+1),n.start.imply("year",a.year());else{var o=n;n=t,t=o}}for(var s in t.end=n.start,n.tags)t.tags[s]=!0;var u=Math.min(t.index,n.index),l=Math.max(t.index+t.text.length,n.index+n.text.length);return t.index=u,t.text=e.substring(u,l),t.tags[this.constructor.name]=!0,t}}},function(e,t,n){"use strict";n.r(t);var r,i=n(5),a=n.n(i),o=n(6),s=n.n(o),u=n(42),l=n.n(u),c=n(17),d=n.n(c),h=n(18),f=n.n(h),p=n(19),g=n.n(p),v=n(11),m=n.n(v),y=n(1),_=n(0),b=n(12),w=n(4),k=n(7),S=n.n(k),E=n(8),P=n(96),I=n(2),D=n(38),T=n(53),x=n(49),C=n(78),A=n(54),L=n(80),O=(n(47),y.a.Regexp.Prefix),M=new(r=function(){function e(){a()(this,e)}return s()(e,[{key:"init",value:function(){try{_.default.PAssert(586,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(e){_.default.reportError(e)}document.body.addEventListener("paste",this.handlepaste,!1),document.body.addEventListener("cut",this.handlecut,!1),document.body.addEventListener("copy",this.handlecopy,!1)}},{key:"parseTextForPrefix",value:function(e){var t,n;return O.lastIndex=0,null!==(t=O.exec(e))&&(n=t[1],e=e.substr(t[0].length)),{prefix:n,text:e}}},{key:"insertToNote",value:function(e,t,n){try{_.default.PAssert(587,e,"Must have a valid start item")}catch(a){_.default.reportError(a)}try{_.default.PAssert(588,t,"Must have a valid end item")}catch(a){_.default.reportError(a)}var r,i=e.getParsedText();r=t===e?i.substring(0,w.a.getStartOffset())+n+i.substring(w.a.getEndOffset()):i.substring(0,w.a.getStartOffset())+n,e.setText(r,y.a.ChangeType.Local)}},{key:"insert",value:function(e,t,n){var r=this;if(!w.a.isValid())return!1;var i,a,o,s,u,l="",c=_.default.focusedPane,d=b.a.ie?"Text":"text/plain";if(n===y.a.DataSource.Plugin)o={items:[{text:e}]};else if(e&&e.getData){_.default.preventAndStop(t);var h=e.getData(d),f=h.startsWith("<?xml ");if(s=h.startsWith("<?opml ")||h.startsWith("<opml ")||f&&h.indexOf("<opml ")>=0)o=L.a.parseOPML(h);else if(f)I.default.toasts.pushMessage({text:"##BR_NAME__ currently does not support pasting XML. Please contact support@moo.do.",action:y.a.MessageAction.Contact,hold:!0});else{if(!(l=b.a.ie?void 0:e.getData("moodo/html")||e.getData("text/html"))){l=e.getData(d);var p=_.default.parseEvernoteLink(l),g=_.default.isBearLink(l);if(p||g){var v=w.a.save(),m="Enter title of "+(p?"Evernote":g&&"Bear")+" document";return void I.default.menus.prompt({title:m,cb:function(e){e&&(l="["+e+"]("+l+")"),w.a.restore(v),r.insert(l,t,y.a.DataSource.Plugin)}})}_.default.isUrlImage(l)&&I.default.settings.showImagesInline.get()&&(l="!"+l),l=l.replace(/\n/g,"<br>")}if(l){if(_.default.shouldLog(y.a.LogLevels.Input)&&_.default.log(l),!l)return void(_.default.shouldLog(y.a.LogLevels.Input)&&_.default.log("Paste buffer is empty"));var k=document.createElement("div"),S=l;w.a.getStartItem().isPrefixCodeBlock()||(S=S.replace(/[\n\t]/g," ")),S=S.replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>|style="(.|\s)*?"/g,"").replace(/\u2022/g,"").replace(/onload/gi,"never");var E;if((E=/<body(.|\s)*?\/body>/g.exec(S))&&(S=E[0]),k.innerHTML=S,w.a.isValid()&&w.a.getStartItem().isNote())this.insertToNote(w.a.getStartItem(),w.a.getEndItem(),k.innerText);else{var O=k.children[0];2===k.children.length&&"A"===O.nodeName&&_.default.isOneNoteLink(O.href)&&(k.innerHTML=O.outerHTML),o=L.a.traverseDOMNew(k),I.default.settings.showDebugInfo.get()&&I.default.toasts.pushMessage({text:"Pasted with the new paste system. If it doesn't look right, please save this and send it to Moo.do support.",actionText:"SAVE",timeout:1e4,action:function(){var e=new Blob([S],{type:"text/plain;charset=utf-8"});Object(P.saveAs)(e,"Moo.do paste failure.txt")}})}}else{if(e&&e.items&&e.items.length>0)return I.default.pluginManager.handleDropEvent(t,(function(e){var t=w.a.save(),n=w.a.getStartItem(),r=n.parent(),i=c.createVMLI({text:e},{parent:r,changeType:y.a.ChangeType.AllLocal});r.insertItem(i,n.getIndex()),w.a.restore(t)})),!1;_.default.shouldLog(y.a.LogLevels.Input)&&_.default.log("Paste buffer is empty");try{_.default.PAssert(589,!1,"Paste with unexpected data type",e.types)}catch(R){_.default.reportError(R)}}}if(!o||!o.items||0===o.items.length)return!1}if(o){u=!0;var M=function(){var e;I.default.PaneUpdateBatcher.beginUpdateItems(),D.a.beginAction();var t=w.a.getStartObject(),n=w.a.getEndObject(),l=w.a.getStartItem(),d=l.isPrefixCodeBlock(),h=w.a.getStartItem().parent(),f=w.a.getStartItem().getIndex(),p=w.a.getStartOffsetWithPrefix(),g=w.a.getEndOffsetWithPrefix();if(i=l,t===n&&d&&(o.items.length>1||(null===(e=o.items[0].items)||void 0===e?void 0:e.length)>0)&&(o.items[0].text=_.default.mapRecursive(o.items,"items",(function(e,t){return" ".repeat(2*t)+e.text})).join("\n"),o.items[0].items=[],o.items=o.items.slice(0,1)),1!==o.items.length||o.items[0].items&&0!==o.items[0].items.length)if(c.isViewAgenda())I.default.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),u=!1;else{var v=0;if(_.default.shouldLog(y.a.LogLevels.Timing)&&console.time("paste"),c.clearPreventUpdate(),w.a.getStartOffset()>0&&f++,o&&o.items){var m=0;C.a.rewriteItemIDs(o.items,s);for(var b=0;b<o.items.length;++b){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var k=o.items[b],S=void 0;k.isNote?h.getNote()||(S=c.createVMLI({text:k.text,isNote:!0},{parent:h,changeType:y.a.ChangeType.AllLocal}),h.setNote(S,y.a.ChangeType.Local)):(0===b&&0===l.getRawText().length&&0===l.numChildren()&&l.deleteSelf(y.a.ChangeType.Local),S=c.createVMLI(k,{parent:h,changeType:y.a.ChangeType.AllLocal}),h.insertItem(S,f++,!1),i=S)}}for(;i.hasChildren();){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;i=i.getLastChild()}a=-1}else{var E=t.showMarkdown(),P=o.items[0],x=P.text,L=p>0?r.parseTextForPrefix(x).text:x,O="",M="";if(!w.a.isSelectedFully(w.a.getStartObject())){var R=l.elsNew.split(t,p),F=l.elsNew.split(t,g);O=R[0].getRawText(E),M=F[1]?F[1].getRawText(E):""}d||(!O.length||O.endsWith(" ")||L.startsWith(" ")||(L=" "+L),!M.length||L.endsWith(" ")||M.startsWith(" ")||(L+=" "));var N=O+L+M;if(P.date)try{l.setMooDate(A.a.fromData(P.date),y.a.ChangeType.Local,!0)}catch(U){_.default.reportError(U,"Error parsing MooDate in paste")}O||M||(P.isStarred&&l.setStarred(!0,y.a.ChangeType.Local),P.priority&&l.setPriority(P.priority,y.a.ChangeType.Local)),l.setText(N,y.a.ChangeType.Local);var j=T.a.parseTextNew(l,L).elsNew.getDisplayText(l,E).length;a=w.a.getStartOffset()+j}D.a.endAction(),I.default.PaneUpdateBatcher.commitUpdateItems(),_.default.shouldLog(y.a.LogLevels.Timing)&&console.timeEnd("paste")};w.a.getStartIndex()!==w.a.getEndIndex()?x.a.handleMultiselect({normCode:y.a.KeyCode.Backspace,preventDefault:_.default.emptyFn},M):M()}return u&&i&&(w.a.selectItem(i,a),_.default.focusedPane.scrollItemIntoView(i)),!1}},{key:"handlepaste",value:function(e){var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;if(w.a.isValid()&&!I.default.menus.isContextMenuOpen()&&!I.default.menus.isModalOpen()){D.a.saveDeleteSelection(),D.a.beginAction();var n=this.insert(t,e,y.a.DataSource.Paste);return D.a.endAction(),n}}},{key:"handlecut",value:function(e){var t=!0;if(w.a.isValid()&&!I.default.menus.isContextMenuOpen()&&!I.default.menus.isModalOpen()){var n=w.a.getStartIndex(),r=w.a.getStartItem(),i=n===w.a.getEndIndex()&&w.a.getStartOffset()===w.a.getEndOffset();I.default.PaneUpdateBatcher.beginUpdateItems(),i&&w.a.selectIndices(n,0,n,r.getParsedText().length),!this.handlecopy(e)&&(i?_.default.focusedPane.deleteSelected():x.a.handleMultiselect({normCode:y.a.KeyCode.Backspace,preventDefault:_.default.emptyFn}),t=!1),I.default.PaneUpdateBatcher.commitUpdateItems()}return t}},{key:"handlecopy",value:function(e){var t=w.a.getPane();if(!w.a.isValid()||I.default.menus.isContextMenuOpen()||I.default.menus.isModalOpen())return!0;if(!t.overrideCopyBehavior)return!0;var n=e&&e.clipboardData?e.clipboardData:window.clipboardData;if(n){var r=!b.a.ie,i=w.a.getStartObject(),a=w.a.getEndObject(),o=w.a.getStartOffsetWithPrefix(),s=w.a.getEndOffsetWithPrefix(),u=w.a.getEndTotalWithPrefix(),l=i!==a||o===s||0===o&&s===u,c=w.a.getSelectedItems(l,!0),d=C.a.generateExport(c,{html:!0,moodo:!0,plain:!0},o,s,i,a),h=d.html,f=d.moodo,p=d.plain;return r&&h&&n.setData("text/html",h),r&&f&&n.setData("moodo/html",f),n.setData(b.a.ie?"Text":"text/plain",p),_.default.preventAndStop(e),!1}}}]),e}(),S()(r.prototype,"handlepaste",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"handlepaste"),r.prototype),S()(r.prototype,"handlecut",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"handlecut"),r.prototype),S()(r.prototype,"handlecopy",[E.a],Object.getOwnPropertyDescriptor(r.prototype,"handlecopy"),r.prototype),r),R=n(21),F=n(23),N=n(13),j=n(32),U=function(){function e(){a()(this,e),this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.isDraggingDelayed=!1,this.dragItem=void 0,this.draggingObjects=new j.a,this.position=void 0,this.transform=new N.a({left:0,top:0}),this.isExternalDrag=new N.a(!1),this.linePosition=new N.a,this.isDraggingPane=new N.a(!1),this.draggingToOutline=new N.a,this.dragTargetHovered=new N.a,R.a.binder(this,"handleEscapeKey")}return s()(e,[{key:"stop",value:function(){var e=0,t=this;this.__hotkeyEscape&&(I.default.hotkeys.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0);for(var n=this.draggingObjects.get(),r=function(e){return e.draggedInPane.set(void 0)},i=0;i<n.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[i].item.forEachChildRecursive(r,!0,!0)}this.draggingObjects.clear(),this.isExternalDrag.set(!1),this.isDragging=!1,requestAnimationFrame((function(){return t.isDraggingDelayed=!1})),this.dragItem=void 0,this.position=void 0,this.externalData=void 0}},{key:"finish",value:function(){this.blockTarget=void 0,F.a.fireEvent("endDrag",[])}},{key:"start",value:function(e,t,n,r,i,a,o,s){var u=0;this.isDragging&&(this.stop(),this.finish()),this.__hotkeyEscape=I.default.hotkeys.pushStackEscape(this.handleEscapeKey),this.isDragging=!0,this.isDraggingDelayed=!0,this.activePane=i,this.dragInfo=null,this.startPane=i,this.startInfo=a,this.dataTransfer=o,this.dragItem=e,this.startDragitem=e,this.fromOverview=s,this.externalData=void 0,this.position={left:n,top:r},this.transform.set({left:0,top:0}),this.draggingObjects.set(t),w.a.reset();for(var l=function(e){return e.draggedInPane.set(_.default.focusedPane)},c=0;c<t.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;t[c].item.forEachChildRecursive(l,!0,!0)}}},{key:"startExternal",value:function(e){this.isDragging=!0,this.isDraggingDelayed=!0,this.activePane=e,this.startPane=e,this.draggingObjects.clear(),this.isExternalDrag.set(!0)}},{key:"setExternalData",value:function(e){this.externalData=e}},{key:"setTransform",value:function(e,t){this.transform.set({left:e,top:t})}},{key:"handleDragOver",value:function(e){var t=e.item,n=e.dataTransfer,r=e.clientX,i=e.clientY,a=_.default.elementFromPoint(r,i),o=_.default.getPaneForElement(a);if(this.activePane&&o!==this.activePane&&this.revertDrag(),_.default.vmMain.checkDragForScroll({clientX:r}),o){this.isDragging||this.startExternal(o),this.activePane=o;var s=!!_.default.findParent(a,"paneOverviewScroller");o.canAcceptDragOver(n.pane,a,s,t)?this.dragInfo=o.handleDragOver(n.pane,a,r,i,t):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||_.default.cancelRepeatScroll("pane"),!1}},{key:"revertDrag",value:function(){this.dragInfo=null,this.activePane.revertDrag(),_.default.cancelRepeatScroll("pane")}},{key:"handleDropItems",value:function(e,t,n){var r,i=t.dataTransfer,a=t.altKey,o=t.ctrlKey,s=this.activePane;return this.isDropping=!0,_.default.cancelRepeatScrolls(),this.dragInfo&&s&&(I.default.PaneUpdateBatcher.beginUpdateItems(),this.startInfo&&0===this.startInfo.items[0].index&&this.startPane.setIgnoreRestoreScroll(),s.handleDragDrop(e,{dataTransfer:i,altKey:a,ctrlKey:o},this.dragInfo,n),I.default.PaneUpdateBatcher.commitUpdateItems(),r=e),this.isDropping=!1,r}},{key:"handleDrop",value:function(e){var t=this,n=e.target,r=e.dataTransfer,i=e.fromDropBucket,a=e.ctrlKey,o=e.altKey,s=e.clipboardData,u=this.activePane;if(u&&(_.default.elementInPane(n)||i)){var l=r.itemsDragging;if(this.isDragging=!1,requestAnimationFrame((function(){return t.isDraggingDelayed=!1})),l)return this.handleDropItems(l,{dataTransfer:r,ctrlKey:a,altKey:o}),!0;I.default.pluginManager.handleDropEvent({target:n,clipboardData:s,dataTransfer:r},(function(e,n){var i=u.createVMLI({text:e},{changeType:y.a.ChangeType.AllLocal,noParentOkay:!0});return!!(i=t.handleDropItems([i],{ctrlKey:a,altKey:o,dataTransfer:r},n))}))}this.stop(),_.default.cancelRepeatScrolls()}},{key:"handleDragLeave",value:function(e){e.clientX||e.clientY||(this.isDragging=!1,this.isDraggingDelayed=!1)}},{key:"setBlockTarget",value:function(e){this.blockTarget=e}},{key:"stopDraggingToOutline",value:function(){this.draggingToOutline.get();this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}},{key:"handleEscapeKey",value:function(){this.escapedDragging=!0,this.dragItem.dragEnd(),this.revertDrag()}}]),e}(),B=n(46);function V(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var H=function(e){f()(n,e);var t=V(n);function n(){var e;return a()(this,n),(e=t.call(this)).dragging=new N.a,e.draggingPosition=new N.a,e.dropSucceeded=new N.a,window.addEventListener("dragover",e.handleDragOver.bind(l()(e))),window.addEventListener("dragleave",e.handleDragLeave.bind(l()(e))),window.addEventListener("drop",e.handleDropExternal.bind(l()(e))),e}return s()(n,[{key:"handleDropExternal",value:function(e){if(_.default.preventAndStop(e),!d()(m()(n.prototype),"handleDrop",this).call(this,e)){var t,r,i=this.activePane,a=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text/html"),o=null===(r=e.dataTransfer)||void 0===r?void 0:r.getData(b.a.ie?"Text":"text/plain");if(a||o){w.a.setFocusedPane(i);var s=i.createVMLI({text:""},{changeType:y.a.ChangeType.AllLocal,noParentOkay:!0});return this.handleDropItems([s],e,!0),requestAnimationFrame((function(){w.a.selectItem(s,0);M.insert({getData:function(e){return"text/html"===e&&a||"text/plain"===e&&o||void 0}},e,y.a.DataSource.Drop)})),!0}if(this.externalData){var u=this.externalData;this.externalData=void 0;var l=u.split(":"),c=(l.removeAt(0),"["+l.removeAt(0)+"]("+l.join(":")+")"),h=i.createVMLI({text:c},{changeType:y.a.ChangeType.AllLocal,noParentOkay:!0});return h=this.handleDropItems([h],e,!0),!0}}}},{key:"checkDragMoveNew",value:function(e,t){var n;return B.a.beginBatch(),!this.dragging.get()&&_.default.distance(t.distanceX,t.distanceY)>_.default.ClickThreshold&&(this.dragging.set(e),n=!0),this.dragging.get()&&(this.draggingPosition.set({x:t.clientX,y:t.clientY}),this.handleDragOverNew(t)),B.a.endBatch(),n}},{key:"checkDragEndNew",value:function(e,t){var n,r=this,i=_.default.elementFromPoint(e.clientX,e.clientY),a=_.default.findParent(i,"fab"),o=_.default.findParent(i,"fancySheet");!a&&!o&&this.dragInfo&&this.dragging.get()&&e.clientY<b.a.windowSize.get().height-y.a.Mobile.BottomBarHeight&&(n=this.handleDragDropNew(e)),this.dropSucceeded.set(n);var s=function(){B.a.beginBatch(),r.dragInfo=void 0,r.dragging.set(void 0),r.draggingPosition.set(void 0),r.linePosition.set(void 0),n&&t&&t(),_.default.cancelRepeatScroll("pane"),B.a.endBatch()};n?requestAnimationFrame(s):s()}},{key:"checkDragStartNew",value:function(e,t,n){var r=this;w.a.addMouseHandler({move:function(e){r.checkDragMoveNew(t,e)},up:function(e){r.checkDragEndNew(e,n)}})}},{key:"cancelDragScoll",value:function(){_.default.cancelRepeatScroll("pane"),this.linePosition.set(void 0)}},{key:"handleDragOverNew",value:function(e){var t=e.clientX,n=e.clientY;_.default.vmMain.checkDragForScroll({clientX:t});var r=_.default.elementFromPoint(t,n),i=_.default.getPaneForElement(r),a=this.dragging.get().pane;if(i)if(_.default.findParent(r,"fab")||_.default.findParent(r,"fancySheet"))this.cancelDragScoll();else{var o=!!_.default.findParent(r,"paneOverviewScroller");i.canAcceptDragOver(a,r,o)?this.dragInfo=i.handleDragOver(a,r,t,n):this.dragInfo=void 0,this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition)}else this.cancelDragScoll()}},{key:"handleDragDropNew",value:function(e){var t=this.dragging.get().pane,n=this.dragInfo.targetPane,r=t.createVMLIsToDrop(this.dragging.get(),this.dragInfo);if(r){var i={ctrlKey:e.ctrlKey,altKey:e.altKey,dataTransfer:{pane:t,dropEffect:t.dropEffect(r[0])}};return n.handleDragDrop(r,i,this.dragInfo,"PaneGmail"!==t.type)}return n.revertDrag(),!1}}]),n}(U);t.default=H},function(e,t,n){"use strict";n.r(t);var r=n(5),i=n.n(r),a=n(6),o=n.n(a),s=n(17),u=n.n(s),l=n(18),c=n.n(l),d=n(19),h=n.n(d),f=n(11),p=n.n(f),g=n(1),v=n(2),m=n(0),y=n(4),_=n(12);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var w=function(e){c()(n,e);var t=b(n);function n(){return i()(this,n),t.apply(this,arguments)}return o()(n,[{key:"getAppInfo",value:function(e){u()(p()(n.prototype),"getAppInfo",this).call(this,e);var t=window;e.user={name:v.default.settings.displayName.get(),email:v.default.settings.activeUser.get()},e.gapiTimeout=t.gapiTimeout,e.sessionID=t.__SESSION_ID,e.appCacheUpdated=m.default.wasAppCacheUpdated,e.realtimeLoadStatus=this.computeRealtimeLoadStatus(),this.getRunningState(e),this.getAppStats(e),this.getPremiumInfo(e);try{e.cacheState=v.default.cacheManager.getInfo()}catch(r){e.cacheState="ERROR"}}},{key:"getRunningState",value:function(e){var t,n=window;try{v.default.PaneManager.hasLoadedPaneState()&&(t=v.default.PaneManager.getPaneState()).forEach((function(e){return delete e.itemState}))}catch(r){m.default.log("Failed to get paneState")}e.isDebug=!1,e.isDemo=m.default.isDemoMode(),e.localWrites=m.default.shouldWriteLocal(),e.authUserLoggedIn=m.default.authUserLoggedIn,e.isReconnected=m.default.isReconnected,e.url=m.default.sanitizeURL(window.location.href),e.paneState=t?m.default.sanitizePaneState(t):"Missing Pane State",e.checkpoints=n.__checkpoints,e.gapiLoadError=n.gapiLoadError,e.gapiTimeout=n.gapiTimeout,e.gapiClientLoadError=n.gapiClientLoadError,e.gapiClientTimeout=n.gapiClientTimeout,e.DOMReadyState=document.readyState,e.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.eventStream=m.default.getEventStream(),e.criticalErrorReported=m.default.criticalErrorReported(),m.default.getLoadedScripts(e);try{e.nativesel=m.default.parseExtra(window.getSelection())}catch(r){e.nativesel="Error: "+r.message}try{e.customsel=y.a.dumpState()}catch(r){e.customsel="Error: "+r.message}try{e.errorPlatformInfo=JSON.stringify(m.default.errorPlatformInfo)}catch(r){e.errorPlatformInfo="Error: "+r.message}try{e.validScreens=JSON.stringify(n.Screens)}catch(r){e.validScreens="Error: "+r.message}e.lastActivity=m.default.lastActivity}},{key:"getPremiumInfo",value:function(e){if(v.default.billingManager){var t={premiumStatus:v.default.billingManager.getPremiumStatus(),billingIdentifier:v.default.billingManager.getBillingIdentifier(),lastSignupError:v.default.billingManager._lastSignupError};e.premiumInfo=t}else e.premiumInfo="Billing Manager Not Loaded"}},{key:"computeRealtimeLoadStatus",value:function(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&m.default.isFunction(window.gapi.drive.realtime.load))}}},{key:"getAppStats",value:function(e){var t=window;if(e.numPanes=t.__TOTAL_PANES,e.numItems=m.default.totalItems,e.numArchivedItems=m.default.totalArchivedItems,e.numArchiveParents=m.default.totalArchivedParents,e.parseTextCalls=t.__PARSE_STATS,e.notificationUpdatesFull=m.default.__FULL_NOTIFICATION_UPDATES,e.notificationUpdatesSingle=m.default.__SINGLE_NOTIFICATION_UPDATES,e.XHRStats=m.default.getXHRStats(),v.default.pluginManager){try{e.pluginStats=v.default.pluginManager.getStats()}catch(n){e.pluginStats="Error: "+n.message}try{e.pluginState=v.default.pluginManager.getState()}catch(n){e.pluginState="Error: "+n.message}}if(v.default.recurringTaskManager)try{e.taskStats=v.default.recurringTaskManager.getStats()}catch(n){e.taskStats="Error: "+n.message}g.a.DETAILED_STATS}}]),n}(function(){function e(){i()(this,e)}return o()(e,[{key:"getAppInfo",value:function(e){var t=m.default.getToolbox(),n=Date.now();e.user={name:t.settings.displayName.get(),email:t.settings.activeUser.get()},e.sessionStart=m.default.SESSION_BEGIN,e.reportTime=n,e.runningTime=n-m.default.SESSION_BEGIN,_.a.getPlatformInfo(e),e.jsVersion=g.a.jsVersion}}]),e}());t.default=new w},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,s,u=o(e),l=1;l<arguments.length;l++){for(var c in n=Object(arguments[l]))i.call(n,c)&&(u[c]=n[c]);if(r){s=r(n);for(var d=0;d<s.length;d++)a.call(n,s[d])&&(u[s[d]]=n[s[d]])}}return u}},function(e,t,n){"use strict";var r=n(103).Emoji;e.exports=function(e){return r.parse(e).status}},function(e,t,n){"use strict";var r=n(104),i=n(105),a=t.OptionalVariationSelector=r.regex(/[\ufe0e\ufe0f]{0,1}/).desc("an optional variation selector (\\ufe0e or \\ufe0f)"),o=t.RequiredVariationSelector=r.regex(/[\ufe0e\ufe0f]/).desc("an required variation selector (\\ufe0e or \\ufe0f)"),s=r.seq(r.regex(/[0-9#*]/),a,r.string("\u20e3")).desc("a keycap emoji"),u=r.regex(/\ud83c[\udde6-\uddff]/).times(2).desc("a flag emoji"),l=r.seq(r.string("\ud83c\udff4\udb40\udc67\udb40\udc62"),r.alt(r.string("\udb40\udc77\udb40\udc6c\udb40\udc73"),r.string("\udb40\udc73\udb40\udc63\udb40\udc74"),r.string("\udb40\udc65\udb40\udc6e\udb40\udc67")),r.string("\udb40\udc7f")),c=r.string("\u200d").desc("zero-width joiner (\\u200d)"),d=r.regex(/(\ud83c[\udffb-\udfff]){0,1}/).desc("an optional Fitzpatrick modifier"),h=r.alt(r.regex(/[\u203c-\u2bff]/),r.regex(/[\u2702-\u27b0]/),r.regex(/[\u3200-\u32ff]/),u,l,r.regex(/\ud83c[\udc04-\udfff]/),r.regex(/\ud83d[\udc00-\udfff]/),r.regex(/\ud83e[\udc00-\udfff]/)),f=r.seq(r.alt(r.string("\xa9"),r.string("\xae"),r.string("\u3030"),r.string("\u303d")),o),p=r.seq(h,a,r.seq(c,h,a).times(1,3)),g=t.Emoji=r.seq(r.alt(f,p,r.seq(h,d,a),s),d).map((function(e){return i(e).join("")}));t.parseOne=function(e){var t=g.parse(e);return!!t.status&&t.value},t.parse=function(e){var t=g.many().parse(e);return!!t.status&&t.value}},function(e,t,n){(function(t){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,n,r){"use strict";function i(e){if(!(this instanceof i))return new i(e);this._=e}var a=i.prototype;function o(e,t){for(var n=0;n<e;n++)t(n)}function s(e,t,n){return function(e,t){o(t.length,(function(n){e(t[n],n,t)}))}((function(n,r,i){t=e(t,n,r,i)}),n),t}function u(e,t){return s((function(t,n,r,i){return t.concat([e(n,r,i)])}),[],t)}function l(e,n){var r={v:0,buf:n};return o(e,(function(){var e;r={v:r.v<<1|(e=r.buf,e[0]>>7),buf:function(e){var n=s((function(e,n,r,i){return e.concat(r===i.length-1?t.from([n,0]).readUInt16BE(0):i.readUInt16BE(r))}),[],e);return t.from(u((function(e){return(e<<1&65535)>>8}),n))}(r.buf)}})),r}function c(){return"undefined"!=typeof t}function d(){if(!c())throw new Error("Buffer global does not exist; please use webpack if you need to parse Buffers in the browser.")}function h(e){d();var t=s((function(e,t){return e+t}),0,e);if(t%8!=0)throw new Error("The bits ["+e.join(", ")+"] add up to "+t+" which is not an even number of bytes; the total should be divisible by 8");var n,r=t/8,a=(n=function(e){return e>48},s((function(e,t){return e||(n(t)?t:e)}),null,e));if(a)throw new Error(a+" bit range requested exceeds 48 bit (6 byte) Number max.");return new i((function(t,n){var i=r+n;return i>t.length?S(n,r.toString()+" bytes"):k(i,s((function(e,t){var n=l(t,e.buf);return{coll:e.coll.concat(n.v),buf:n.buf}}),{coll:[],buf:t.slice(n,i)},e).coll)}))}function f(e,t){return new i((function(n,r){return d(),r+t>n.length?S(r,t+" bytes for "+e):k(r+t,n.slice(r,r+t))}))}function p(e,t){if("number"!=typeof(n=t)||Math.floor(n)!==n||t<0||t>6)throw new Error(e+" requires integer length in range [0, 6].");var n}function g(e){return p("uintBE",e),f("uintBE("+e+")",e).map((function(t){return t.readUIntBE(0,e)}))}function v(e){return p("uintLE",e),f("uintLE("+e+")",e).map((function(t){return t.readUIntLE(0,e)}))}function m(e){return p("intBE",e),f("intBE("+e+")",e).map((function(t){return t.readIntBE(0,e)}))}function y(e){return p("intLE",e),f("intLE("+e+")",e).map((function(t){return t.readIntLE(0,e)}))}function _(e){return e instanceof i}function b(e){return"[object Array]"==={}.toString.call(e)}function w(e){return c()&&t.isBuffer(e)}function k(e,t){return{status:!0,index:e,value:t,furthest:-1,expected:[]}}function S(e,t){return b(t)||(t=[t]),{status:!1,index:-1,value:null,furthest:e,expected:t}}function E(e,t){if(!t)return e;if(e.furthest>t.furthest)return e;var n=e.furthest===t.furthest?function(e,t){for(var n={},r=0;r<e.length;r++)n[e[r]]=!0;for(var i=0;i<t.length;i++)n[t[i]]=!0;var a=[];for(var o in n)({}).hasOwnProperty.call(n,o)&&a.push(o);return a.sort(),a}(e.expected,t.expected):t.expected;return{status:e.status,index:e.index,value:e.value,furthest:t.furthest,expected:n}}function P(e,t){if(w(e))return{offset:t,line:-1,column:-1};var n=e.slice(0,t).split("\n");return{offset:t,line:n.length,column:n[n.length-1].length+1}}function I(e){if(!_(e))throw new Error("not a parser: "+e)}function D(e,t){return"string"==typeof e?e.charAt(t):e[t]}function T(e){if("number"!=typeof e)throw new Error("not a number: "+e)}function x(e){if("function"!=typeof e)throw new Error("not a function: "+e)}function C(e){if("string"!=typeof e)throw new Error("not a string: "+e)}var A=2,L=3,O=8,M=5*O,R=4*O,F="  ";function N(e,t){return new Array(t+1).join(e)}function j(e,t,n){var r=t-e.length;return r<=0?e:N(n,r)+e}function U(e,t,n,r){return{from:e-t>0?e-t:0,to:e+n>r?r:e+n}}function B(e,t){var n,r,i,a,o,l=t.index,c=l.offset,d=1;if(c===e.length)return"Got the end of the input";if(w(e)){var h=c-c%O,f=c-h,p=U(h,M,R+O,e.length),g=u((function(e){return u((function(e){return j(e.toString(16),2,"0")}),e)}),function(e,t){var n=e.length,r=[],i=0;if(n<=t)return[e.slice()];for(var a=0;a<n;a++)r[i]||r.push([]),r[i].push(e[a]),(a+1)%t==0&&i++;return r}(e.slice(p.from,p.to).toJSON().data,O));a=function(e){return 0===e.from&&1===e.to?{from:e.from,to:e.to}:{from:e.from/O,to:Math.floor(e.to/O)}}(p),r=h/O,n=3*f,f>=4&&(n+=1),d=2,i=u((function(e){return e.length<=4?e.join(" "):e.slice(0,4).join(" ")+"  "+e.slice(4).join(" ")}),g),(o=(8*(a.to>0?a.to-1:a.to)).toString(16).length)<2&&(o=2)}else{var v=e.split(/\r\n|[\n\r\u2028\u2029]/);n=l.column-1,r=l.line-1,a=U(r,A,L,v.length),i=v.slice(a.from,a.to),o=a.to.toString().length}var m=r-a.from;return w(e)&&(o=(8*(a.to>0?a.to-1:a.to)).toString(16).length)<2&&(o=2),s((function(t,r,i){var s,u=i===m,l=u?"> ":F;return s=w(e)?j((8*(a.from+i)).toString(16),o,"0"):j((a.from+i+1).toString(),o," "),[].concat(t,[l+s+" | "+r],u?[F+N(" ",o)+" | "+j("",n," ")+N("^",d)]:[])}),[],i).join("\n")}function V(e,t){return["\n","-- PARSING FAILED "+N("-",50),"\n\n",B(e,t),"\n\n",(n=t.expected,1===n.length?"Expected:\n\n"+n[0]:"Expected one of the following: \n\n"+n.join(", ")),"\n"].join("");var n}function H(e){var t=""+e;return t.slice(t.lastIndexOf("/")+1)}function W(){for(var e=[].slice.call(arguments),t=e.length,n=0;n<t;n+=1)I(e[n]);return i((function(n,r){for(var i,a=new Array(t),o=0;o<t;o+=1){if(!(i=E(e[o]._(n,r),i)).status)return i;a[o]=i.value,r=i.index}return E(k(r,a),i)}))}function q(){var e=[].slice.call(arguments);if(0===e.length)throw new Error("seqMap needs at least one argument");var t=e.pop();return x(t),W.apply(null,e).map((function(e){return t.apply(null,e)}))}function z(){var e=[].slice.call(arguments),t=e.length;if(0===t)return $("zero alternates");for(var n=0;n<t;n+=1)I(e[n]);return i((function(t,n){for(var r,i=0;i<e.length;i+=1)if((r=E(e[i]._(t,n),r)).status)return r;return r}))}function G(e,t){return K(e,t).or(X([]))}function K(e,t){return I(e),I(t),q(e,t.then(e).many(),(function(e,t){return[e].concat(t)}))}function Y(e){C(e);var t="'"+e+"'";return i((function(n,r){var i=r+e.length,a=n.slice(r,i);return a===e?k(i,a):S(r,t)}))}function Q(e,t){!function(e){if(!(e instanceof RegExp))throw new Error("not a regexp: "+e);for(var t=H(e),n=0;n<t.length;n++){var r=t.charAt(n);if("i"!==r&&"m"!==r&&"u"!==r)throw new Error('unsupported regexp flag "'+r+'": '+e)}}(e),arguments.length>=2?T(t):t=0;var n=function(e){return RegExp("^(?:"+e.source+")",H(e))}(e),r=""+e;return i((function(e,i){var a=n.exec(e.slice(i));if(a){if(0<=t&&t<=a.length){var o=a[0],s=a[t];return k(i+o.length,s)}return S(i,"valid match group (0 to "+a.length+") in "+r)}return S(i,r)}))}function X(e){return i((function(t,n){return k(n,e)}))}function $(e){return i((function(t,n){return S(n,e)}))}function J(e){if(_(e))return i((function(t,n){var r=e._(t,n);return r.index=n,r.value="",r}));if("string"==typeof e)return J(Y(e));if(e instanceof RegExp)return J(Q(e));throw new Error("not a string, regexp, or parser: "+e)}function Z(e){return I(e),i((function(t,n){var r=e._(t,n),i=t.slice(n,r.index);return r.status?S(n,'not "'+i+'"'):k(n,null)}))}function ee(e){return x(e),i((function(t,n){var r=D(t,n);return n<t.length&&e(r)?k(n+1,r):S(n,"a character/byte matching "+e)}))}function te(e,t){arguments.length<2&&(t=e,e=void 0);var n=i((function(e,r){return n._=t()._,n._(e,r)}));return e?n.desc(e):n}function ne(){return $("fantasy-land/empty")}a.parse=function(e){if("string"!=typeof e&&!w(e))throw new Error(".parse must be called with a string or Buffer as its argument");var t=this.skip(oe)._(e,0);return t.status?{status:!0,value:t.value}:{status:!1,index:P(e,t.furthest),expected:t.expected}},a.tryParse=function(e){var t=this.parse(e);if(t.status)return t.value;var n=V(e,t),r=new Error(n);throw r.type="ParsimmonError",r.result=t,r},a.assert=function(e,t){return this.chain((function(n){return e(n)?X(n):$(t)}))},a.or=function(e){return z(this,e)},a.trim=function(e){return this.wrap(e,e)},a.wrap=function(e,t){return q(e,this,t,(function(e,t){return t}))},a.thru=function(e){return e(this)},a.then=function(e){return I(e),W(this,e).map((function(e){return e[1]}))},a.many=function(){var e=this;return i((function(t,n){for(var r=[],i=void 0;;){if(!(i=E(e._(t,n),i)).status)return E(k(n,r),i);if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,r.push(i.value)}}))},a.tieWith=function(e){return C(e),this.map((function(t){if(function(e){if(!b(e))throw new Error("not an array: "+e)}(t),t.length){C(t[0]);for(var n=t[0],r=1;r<t.length;r++)C(t[r]),n+=e+t[r];return n}return""}))},a.tie=function(){return this.tieWith("")},a.times=function(e,t){var n=this;return arguments.length<2&&(t=e),T(e),T(t),i((function(r,i){for(var a=[],o=void 0,s=void 0,u=0;u<e;u+=1){if(s=E(o=n._(r,i),s),!o.status)return s;i=o.index,a.push(o.value)}for(;u<t&&(s=E(o=n._(r,i),s),o.status);u+=1)i=o.index,a.push(o.value);return E(k(i,a),s)}))},a.result=function(e){return this.map((function(){return e}))},a.atMost=function(e){return this.times(0,e)},a.atLeast=function(e){return q(this.times(e),this.many(),(function(e,t){return e.concat(t)}))},a.map=function(e){x(e);var t=this;return i((function(n,r){var i=t._(n,r);return i.status?E(k(i.index,e(i.value)),i):i}))},a.contramap=function(e){x(e);var t=this;return i((function(n,r){var i=t.parse(e(n.slice(r)));return i.status?k(r+n.length,i.value):i}))},a.promap=function(e,t){return x(e),x(t),this.contramap(e).map(t)},a.skip=function(e){return W(this,e).map((function(e){return e[0]}))},a.mark=function(){return q(re,this,re,(function(e,t,n){return{start:e,value:t,end:n}}))},a.node=function(e){return q(re,this,re,(function(t,n,r){return{name:e,value:n,start:t,end:r}}))},a.sepBy=function(e){return G(this,e)},a.sepBy1=function(e){return K(this,e)},a.lookahead=function(e){return this.skip(J(e))},a.notFollowedBy=function(e){return this.skip(Z(e))},a.desc=function(e){b(e)||(e=[e]);var t=this;return i((function(n,r){var i=t._(n,r);return i.status||(i.expected=e),i}))},a.fallback=function(e){return this.or(X(e))},a.ap=function(e){return q(e,this,(function(e,t){return e(t)}))},a.chain=function(e){var t=this;return i((function(n,r){var i=t._(n,r);return i.status?E(e(i.value)._(n,i.index),i):i}))},a.concat=a.or,a.empty=ne,a.of=X,a["fantasy-land/ap"]=a.ap,a["fantasy-land/chain"]=a.chain,a["fantasy-land/concat"]=a.concat,a["fantasy-land/empty"]=a.empty,a["fantasy-land/of"]=a.of,a["fantasy-land/map"]=a.map;var re=i((function(e,t){return k(t,P(e,t))})),ie=i((function(e,t){return t>=e.length?S(t,"any character/byte"):k(t+1,D(e,t))})),ae=i((function(e,t){return k(e.length,e.slice(t))})),oe=i((function(e,t){return t<e.length?S(t,"EOF"):k(t,null)})),se=Q(/[0-9]/).desc("a digit"),ue=Q(/[0-9]*/).desc("optional digits"),le=Q(/[a-z]/i).desc("a letter"),ce=Q(/[a-z]*/i).desc("optional letters"),de=Q(/\s*/).desc("optional whitespace"),he=Q(/\s+/).desc("whitespace"),fe=Y("\r"),pe=Y("\n"),ge=Y("\r\n"),ve=z(ge,pe,fe).desc("newline"),me=z(ve,oe);i.all=ae,i.alt=z,i.any=ie,i.cr=fe,i.createLanguage=function(e){var t={};for(var n in e)({}).hasOwnProperty.call(e,n)&&function(n){t[n]=te((function(){return e[n](t)}))}(n);return t},i.crlf=ge,i.custom=function(e){return i(e(k,S))},i.digit=se,i.digits=ue,i.empty=ne,i.end=me,i.eof=oe,i.fail=$,i.formatError=V,i.index=re,i.isParser=_,i.lazy=te,i.letter=le,i.letters=ce,i.lf=pe,i.lookahead=J,i.makeFailure=S,i.makeSuccess=k,i.newline=ve,i.noneOf=function(e){return ee((function(t){return e.indexOf(t)<0})).desc("none of '"+e+"'")},i.notFollowedBy=Z,i.of=X,i.oneOf=function(e){for(var t=e.split(""),n=0;n<t.length;n++)t[n]="'"+t[n]+"'";return ee((function(t){return e.indexOf(t)>=0})).desc(t)},i.optWhitespace=de,i.Parser=i,i.range=function(e,t){return ee((function(n){return e<=n&&n<=t})).desc(e+"-"+t)},i.regex=Q,i.regexp=Q,i.sepBy=G,i.sepBy1=K,i.seq=W,i.seqMap=q,i.seqObj=function(){for(var e,t={},n=0,r=(e=arguments,Array.prototype.slice.call(e)),a=r.length,o=0;o<a;o+=1){var s=r[o];if(!_(s)){if(b(s)&&2===s.length&&"string"==typeof s[0]&&_(s[1])){var u=s[0];if(Object.prototype.hasOwnProperty.call(t,u))throw new Error("seqObj: duplicate key "+u);t[u]=!0,n++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===n)throw new Error("seqObj expects at least one named parser, found zero");return i((function(e,t){for(var n,i={},o=0;o<a;o+=1){var s,u;if(b(r[o])?(s=r[o][0],u=r[o][1]):(s=null,u=r[o]),!(n=E(u._(e,t),n)).status)return n;s&&(i[s]=n.value),t=n.index}return E(k(t,i),n)}))},i.string=Y,i.succeed=X,i.takeWhile=function(e){return x(e),i((function(t,n){for(var r=n;r<t.length&&e(D(t,r));)r++;return k(r,t.slice(n,r))}))},i.test=ee,i.whitespace=he,i["fantasy-land/empty"]=ne,i["fantasy-land/of"]=X,i.Binary={bitSeq:h,bitSeqObj:function(e){d();var t={},n=0,r=u((function(e){if(b(e)){var r=e;if(2!==r.length)throw new Error("["+r.join(", ")+"] should be length 2, got length "+r.length);if(C(r[0]),T(r[1]),Object.prototype.hasOwnProperty.call(t,r[0]))throw new Error("duplicate key in bitSeqObj: "+r[0]);return t[r[0]]=!0,n++,r}return T(e),[null,e]}),e);if(n<1)throw new Error("bitSeqObj expects at least one named pair, got ["+e.join(", ")+"]");var i=u((function(e){return e[0]}),r);return h(u((function(e){return e[1]}),r)).map((function(e){return s((function(e,t){return null!==t[0]&&(e[t[0]]=t[1]),e}),{},u((function(t,n){return[t,e[n]]}),i))}))},byte:function(e){if(d(),T(e),e>255)throw new Error("Value specified to byte constructor ("+e+"=0x"+e.toString(16)+") is larger in value than a single byte.");var t=(e>15?"0x":"0x0")+e.toString(16);return i((function(n,r){var i=D(n,r);return i===e?k(r+1,i):S(r,t)}))},buffer:function(e){return f("buffer",e).map((function(e){return t.from(e)}))},encodedString:function(e,t){return f("string",t).map((function(t){return t.toString(e)}))},uintBE:g,uint8BE:g(1),uint16BE:g(2),uint32BE:g(4),uintLE:v,uint8LE:v(1),uint16LE:v(2),uint32LE:v(4),intBE:m,int8BE:m(1),int16BE:m(2),int32BE:m(4),intLE:y,int8LE:y(1),int16LE:y(2),int32LE:y(4),floatBE:f("floatBE",4).map((function(e){return e.readFloatBE(0)})),floatLE:f("floatLE",4).map((function(e){return e.readFloatLE(0)})),doubleBE:f("doubleBE",8).map((function(e){return e.readDoubleBE(0)})),doubleLE:f("doubleLE",8).map((function(e){return e.readDoubleLE(0)}))},e.exports=i}])}).call(this,n(121).Buffer)},function(e,t,n){(function(t){var n=9007199254740991,r="[object Arguments]",i="[object Function]",a="[object GeneratorFunction]",o="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,u=o||s||Function("return this")();function l(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var c=Object.prototype,d=c.hasOwnProperty,h=c.toString,f=u.Symbol,p=c.propertyIsEnumerable,g=f?f.isConcatSpreadable:void 0;function v(e,t,n,r,i){var a=-1,o=e.length;for(n||(n=m),i||(i=[]);++a<o;){var s=e[a];t>0&&n(s)?t>1?v(s,t-1,n,r,i):l(i,s):r||(i[i.length]=s)}return i}function m(e){return y(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?h.call(e):"";return t==i||t==a}(e)}(e)}(e)&&d.call(e,"callee")&&(!p.call(e,"callee")||h.call(e)==r)}(e)||!!(g&&e&&e[g])}var y=Array.isArray;e.exports=function(e){return(e?e.length:0)?v(e,Infinity):[]}}).call(this,n(89))},function(e,t,n){"use strict";var r=n(103).Emoji,i=n(104),a=n(105),o=i.regex(/[\uD800-\uDBFF][\uDC00-\uDFFF]/),s=t.Unicode=i.alt(r,i.regex(/[\u0000-\uD799]/),i.regex(/[\uE000-\uFFFF]/),o);t.parseOne=function(e){var t=s.parse(e);return!!t.status&&a(t.value).join("")},t.parse=function(e){var t=s.many().parse(e);return!!t.status&&t.value.map((function(e){return a(e).join("")}))}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},function(e,t,n){var r=n(107);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(41),i=n.n(r),a=n(14);function o(){var e=Object(a.useState)(!1),t=i()(e,2),n=t[0],r=t[1],o=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=function(e){return r(!0)},t=function(e){for(var t=0,n=e.toElement,i=!1;n&&!i;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n===o.current&&(i=!0),n=n.parentElement}i||r(!1)},n=o.current;if(n)return n.addEventListener("mouseover",e),n.addEventListener("mouseout",t),function(){n.removeEventListener("mouseover",e),n.removeEventListener("mouseout",t)}}),[o.current]),[o,n]}},function(e,t,n){"use strict";t.consoleFormat=n(120);var r=t.isEmoji=n(102),i=t.split=n(106).parse;t.withoutEmoji=function(e){var t=i(e);return t?t.filter((function(e){return!r(e)})):t},t.onlyEmoji=function(e){var t=i(e);return t?t.filter((function(e){return r(e)})):t}},function(e,t){var n="undefined"!==typeof Element,r="function"===typeof Map,i="function"===typeof Set,a="function"===typeof ArrayBuffer&&!!ArrayBuffer.isView;function o(e,t,s){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(!s&&e.constructor!==t.constructor)return!1;var u,l,c,d;if(Array.isArray(e)){if((u=e.length)!=t.length)return!1;for(l=u;0!==l--;)if(!o(e[l],t[l],s))return!1;return!0}if(r&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(d=e.entries();!(l=d.next()).done;)if(!t.has(l.value[0]))return!1;for(d=e.entries();!(l=d.next()).done;)if(!o(l.value[1],t.get(l.value[0]),s))return!1;return!0}if(i&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(d=e.entries();!(l=d.next()).done;)if(!t.has(l.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if((u=e.length)!=t.length)return!1;for(l=u;0!==l--;)if(e[l]!==t[l])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if((u=(c=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(l=u;0!==l--;)if(!Object.prototype.hasOwnProperty.call(t,c[l]))return!1;if(n&&e instanceof Element)return!1;for(l=u;0!==l--;)if(("_owner"!==c[l]&&"__v"!==c[l]&&"__o"!==c[l]||!e.$$typeof)&&!o(e[c[l]],t[c[l]],s))return!1;return!0}return e!==e&&t!==t}e.exports=function(e,t,n){try{return o(e,t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}}},function(e,t,n){"use strict";n.r(t);var r=n(66);self.__infLoop=function(){},r.a.load(void 0,(function(e){/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&["Gmail","GmailMessages","plugins"].forEach((function(t){e[t]=JSON.stringify(e[t])})),postMessage(e)}))},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(A){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),o=new T(r||[]);return a._invoke=function(e,t,n){var r=d;return function(i,a){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return C()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=P(o,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var u=c(e,t,n);if("normal"===u.type){if(r=n.done?p:h,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(A){return{type:"throw",arg:A}}}e.wrap=l;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",g={};function v(){}function m(){}function y(){}var _={};_[a]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(x([])));w&&w!==n&&r.call(w,a)&&(_=w);var k=y.prototype=v.prototype=Object.create(_);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"===typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function P(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=c(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function x(e){if(e){var n=e[a];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:C}}function C(){return{value:t,done:!0}}return m.prototype=k.constructor=y,y.constructor=m,m.displayName=u(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},S(E.prototype),E.prototype[o]=function(){return this},e.AsyncIterator=E,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new E(l(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(k),u(k,s,"Generator"),k[a]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;D(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:x(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){var r=n(11);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t,n){"use strict";var r=n(101),i="function"===typeof Symbol&&Symbol.for,a=i?Symbol.for("react.element"):60103,o=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,u=i?Symbol.for("react.strict_mode"):60108,l=i?Symbol.for("react.profiler"):60114,c=i?Symbol.for("react.provider"):60109,d=i?Symbol.for("react.context"):60110,h=i?Symbol.for("react.forward_ref"):60112,f=i?Symbol.for("react.suspense"):60113,p=i?Symbol.for("react.memo"):60115,g=i?Symbol.for("react.lazy"):60116,v="function"===typeof Symbol&&Symbol.iterator;function m(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};function b(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||y}function w(){}function k(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||y}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(m(85));this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=b.prototype;var S=k.prototype=new w;S.constructor=k,r(S,b.prototype),S.isPureReactComponent=!0;var E={current:null},P=Object.prototype.hasOwnProperty,I={key:!0,ref:!0,__self:!0,__source:!0};function D(e,t,n){var r,i={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)P.call(t,r)&&!I.hasOwnProperty(r)&&(i[r]=t[r]);var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];i.children=l}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===i[r]&&(i[r]=u[r]);return{$$typeof:a,type:e,key:o,ref:s,props:i,_owner:E.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===a}var x=/\/+/g,C=[];function A(e,t,n,r){if(C.length){var i=C.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function L(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>C.length&&C.push(e)}function O(e,t,n,r){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var s=!1;if(null===e)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case a:case o:s=!0}}if(s)return n(r,e,""===t?"."+R(e,0):t),1;if(s=0,t=""===t?".":t+":",Array.isArray(e))for(var u=0;u<e.length;u++){var l=t+R(i=e[u],u);s+=O(i,l,n,r)}else if(null===e||"object"!==typeof e?l=null:l="function"===typeof(l=v&&e[v]||e["@@iterator"])?l:null,"function"===typeof l)for(e=l.call(e),u=0;!(i=e.next()).done;)s+=O(i=i.value,l=t+R(i,u++),n,r);else if("object"===i)throw n=""+e,Error(m(31,"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,""));return s}function M(e,t,n){return null==e?0:O(e,"",t,n)}function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function F(e,t){e.func.call(e.context,t,e.count++)}function N(e,t,n){var r=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?j(e,r,n,(function(e){return e})):null!=e&&(T(e)&&(e=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(x,"$&/")+"/")+n)),r.push(e))}function j(e,t,n,r,i){var a="";null!=n&&(a=(""+n).replace(x,"$&/")+"/"),M(e,N,t=A(t,a,r,i)),L(t)}var U={current:null};function B(){var e=U.current;if(null===e)throw Error(m(321));return e}var V={ReactCurrentDispatcher:U,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:E,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:function(e,t,n){if(null==e)return e;var r=[];return j(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;M(e,F,t=A(null,null,t,n)),L(t)},count:function(e){return M(e,(function(){return null}),null)},toArray:function(e){var t=[];return j(e,t,null,(function(e){return e})),t},only:function(e){if(!T(e))throw Error(m(143));return e}},t.Component=b,t.Fragment=s,t.Profiler=l,t.PureComponent=k,t.StrictMode=u,t.Suspense=f,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(m(267,e));var i=r({},e.props),o=e.key,s=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,u=E.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)P.call(t,c)&&!I.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];i.children=l}return{$$typeof:a,type:e.type,key:o,ref:s,props:i,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:c,_context:e},e.Consumer=e},t.createElement=D,t.createFactory=function(e){var t=D.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:h,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:g,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:p,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return B().useCallback(e,t)},t.useContext=function(e,t){return B().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return B().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return B().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return B().useLayoutEffect(e,t)},t.useMemo=function(e,t){return B().useMemo(e,t)},t.useReducer=function(e,t,n){return B().useReducer(e,t,n)},t.useRef=function(e){return B().useRef(e)},t.useState=function(e){return B().useState(e)},t.version="16.13.1"},function(e,t,n){"use strict";var r=n(14),i=n(101),a=n(118);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));function s(e,t,n,r,i,a,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var u=!1,l=null,c=!1,d=null,h={onError:function(e){u=!0,l=e}};function f(e,t,n,r,i,a,o,c,d){u=!1,l=null,s.apply(h,arguments)}var p=null,g=null,v=null;function m(e,t,n){var r=e.type||"unknown-event";e.currentTarget=v(n),function(e,t,n,r,i,a,s,h,p){if(f.apply(this,arguments),u){if(!u)throw Error(o(198));var g=l;u=!1,l=null,c||(c=!0,d=g)}}(r,t,void 0,e),e.currentTarget=null}var y=null,_={};function b(){if(y)for(var e in _){var t=_[e],n=y.indexOf(e);if(!(-1<n))throw Error(o(96,e));if(!k[n]){if(!t.extractEvents)throw Error(o(97,e));for(var r in k[n]=t,n=t.eventTypes){var i=void 0,a=n[r],s=t,u=r;if(S.hasOwnProperty(u))throw Error(o(99,u));S[u]=a;var l=a.phasedRegistrationNames;if(l){for(i in l)l.hasOwnProperty(i)&&w(l[i],s,u);i=!0}else a.registrationName?(w(a.registrationName,s,u),i=!0):i=!1;if(!i)throw Error(o(98,r,e))}}}}function w(e,t,n){if(E[e])throw Error(o(100,e));E[e]=t,P[e]=t.eventTypes[n].dependencies}var k=[],S={},E={},P={};function I(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!_.hasOwnProperty(t)||_[t]!==r){if(_[t])throw Error(o(102,t));_[t]=r,n=!0}}n&&b()}var D=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),T=null,x=null,C=null;function A(e){if(e=g(e)){if("function"!==typeof T)throw Error(o(280));var t=e.stateNode;t&&(t=p(t),T(e.stateNode,e.type,t))}}function L(e){x?C?C.push(e):C=[e]:x=e}function O(){if(x){var e=x,t=C;if(C=x=null,A(e),t)for(e=0;e<t.length;e++)A(t[e])}}function M(e,t){return e(t)}function R(e,t,n,r,i){return e(t,n,r,i)}function F(){}var N=M,j=!1,U=!1;function B(){null===x&&null===C||(F(),O())}function V(e,t,n){if(U)return e(t,n);U=!0;try{return N(e,t,n)}finally{U=!1,B()}}var H=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,W=Object.prototype.hasOwnProperty,q={},z={};function G(e,t,n,r,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a}var K={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){K[e]=new G(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];K[t]=new G(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){K[e]=new G(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){K[e]=new G(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){K[e]=new G(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){K[e]=new G(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){K[e]=new G(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){K[e]=new G(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){K[e]=new G(e,5,!1,e.toLowerCase(),null,!1)}));var Y=/[\-:]([a-z])/g;function Q(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(Y,Q);K[t]=new G(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(Y,Q);K[t]=new G(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(Y,Q);K[t]=new G(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){K[e]=new G(e,1,!1,e.toLowerCase(),null,!1)})),K.xlinkHref=new G("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){K[e]=new G(e,1,!1,e.toLowerCase(),null,!0)}));var X=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function $(e,t,n,r){var i=K.hasOwnProperty(t)?K[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!W.call(z,e)||!W.call(q,e)&&(H.test(e)?z[e]=!0:(q[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}X.hasOwnProperty("ReactCurrentDispatcher")||(X.ReactCurrentDispatcher={current:null}),X.hasOwnProperty("ReactCurrentBatchConfig")||(X.ReactCurrentBatchConfig={suspense:null});var J=/^(.*)[\\\/]/,Z="function"===typeof Symbol&&Symbol.for,ee=Z?Symbol.for("react.element"):60103,te=Z?Symbol.for("react.portal"):60106,ne=Z?Symbol.for("react.fragment"):60107,re=Z?Symbol.for("react.strict_mode"):60108,ie=Z?Symbol.for("react.profiler"):60114,ae=Z?Symbol.for("react.provider"):60109,oe=Z?Symbol.for("react.context"):60110,se=Z?Symbol.for("react.concurrent_mode"):60111,ue=Z?Symbol.for("react.forward_ref"):60112,le=Z?Symbol.for("react.suspense"):60113,ce=Z?Symbol.for("react.suspense_list"):60120,de=Z?Symbol.for("react.memo"):60115,he=Z?Symbol.for("react.lazy"):60116,fe=Z?Symbol.for("react.block"):60121,pe="function"===typeof Symbol&&Symbol.iterator;function ge(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=pe&&e[pe]||e["@@iterator"])?e:null}function ve(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case ne:return"Fragment";case te:return"Portal";case ie:return"Profiler";case re:return"StrictMode";case le:return"Suspense";case ce:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case oe:return"Context.Consumer";case ae:return"Context.Provider";case ue:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case de:return ve(e.type);case fe:return ve(e.render);case he:if(e=1===e._status?e._result:null)return ve(e)}return null}function me(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,i=e._debugSource,a=ve(e.type);n=null,r&&(n=ve(r.type)),r=a,a="",i?a=" (at "+i.fileName.replace(J,"")+":"+i.lineNumber+")":n&&(a=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+a}t+=n,e=e.return}while(e);return t}function ye(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function _e(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function be(e){e._valueTracker||(e._valueTracker=function(e){var t=_e(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function we(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=_e(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function ke(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Se(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=ye(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Ee(e,t){null!=(t=t.checked)&&$(e,"checked",t,!1)}function Pe(e,t){Ee(e,t);var n=ye(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?De(e,t.type,n):t.hasOwnProperty("defaultValue")&&De(e,t.type,ye(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Ie(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function De(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Te(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function xe(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ye(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Ce(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:ye(n)}}function Le(e,t){var n=ye(t.value),r=ye(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function Oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var Me="http://www.w3.org/1999/xhtml",Re="http://www.w3.org/2000/svg";function Fe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ne(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Fe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var je,Ue,Be=(Ue=function(e,t){if(e.namespaceURI!==Re||"innerHTML"in e)e.innerHTML=t;else{for((je=je||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=je.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return Ue(e,t)}))}:Ue);function Ve(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function He(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var We={animationend:He("Animation","AnimationEnd"),animationiteration:He("Animation","AnimationIteration"),animationstart:He("Animation","AnimationStart"),transitionend:He("Transition","TransitionEnd")},qe={},ze={};function Ge(e){if(qe[e])return qe[e];if(!We[e])return e;var t,n=We[e];for(t in n)if(n.hasOwnProperty(t)&&t in ze)return qe[e]=n[t];return e}D&&(ze=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);var Ke=Ge("animationend"),Ye=Ge("animationiteration"),Qe=Ge("animationstart"),Xe=Ge("transitionend"),$e="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Je=new("function"===typeof WeakMap?WeakMap:Map);function Ze(e){var t=Je.get(e);return void 0===t&&(t=new Map,Je.set(e,t)),t}function et(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function tt(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function nt(e){if(et(e)!==e)throw Error(o(188))}function rt(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=et(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return nt(i),e;if(a===r)return nt(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s){for(u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function it(e,t){if(null==t)throw Error(o(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function at(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var ot=null;function st(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)m(e,t[r],n[r]);else t&&m(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function ut(e){if(null!==e&&(ot=it(ot,e)),e=ot,ot=null,e){if(at(e,st),ot)throw Error(o(95));if(c)throw e=d,c=!1,d=null,e}}function lt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function ct(e){if(!D)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"===typeof t[e]),t}var dt=[];function ht(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>dt.length&&dt.push(e)}function ft(e,t,n,r){if(dt.length){var i=dt.pop();return i.topLevelType=e,i.eventSystemFlags=r,i.nativeEvent=t,i.targetInst=n,i}return{topLevelType:e,eventSystemFlags:r,nativeEvent:t,targetInst:n,ancestors:[]}}function pt(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=An(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=lt(e.nativeEvent);r=e.topLevelType;var a=e.nativeEvent,o=e.eventSystemFlags;0===n&&(o|=64);for(var s=null,u=0;u<k.length;u++){var l=k[u];l&&(l=l.extractEvents(r,t,a,i,o))&&(s=it(s,l))}ut(s)}}function gt(e,t,n){if(!n.has(e)){switch(e){case"scroll":Qt(t,"scroll",!0);break;case"focus":case"blur":Qt(t,"focus",!0),Qt(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":ct(e)&&Qt(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===$e.indexOf(e)&&Yt(e,t)}n.set(e,null)}}var vt,mt,yt,_t=!1,bt=[],wt=null,kt=null,St=null,Et=new Map,Pt=new Map,It=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Tt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function xt(e,t,n,r,i){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:i,container:r}}function Ct(e,t){switch(e){case"focus":case"blur":wt=null;break;case"dragenter":case"dragleave":kt=null;break;case"mouseover":case"mouseout":St=null;break;case"pointerover":case"pointerout":Et.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function At(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e=xt(t,n,r,i,a),null!==t&&(null!==(t=Ln(t))&&mt(t)),e):(e.eventSystemFlags|=r,e)}function Lt(e){var t=An(e.target);if(null!==t){var n=et(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=tt(n)))return e.blockedOn=t,void a.unstable_runWithPriority(e.priority,(function(){yt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ot(e){if(null!==e.blockedOn)return!1;var t=Zt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=Ln(t);return null!==n&&mt(n),e.blockedOn=t,!1}return!0}function Mt(e,t,n){Ot(e)&&n.delete(t)}function Rt(){for(_t=!1;0<bt.length;){var e=bt[0];if(null!==e.blockedOn){null!==(e=Ln(e.blockedOn))&&vt(e);break}var t=Zt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:bt.shift()}null!==wt&&Ot(wt)&&(wt=null),null!==kt&&Ot(kt)&&(kt=null),null!==St&&Ot(St)&&(St=null),Et.forEach(Mt),Pt.forEach(Mt)}function Ft(e,t){e.blockedOn===t&&(e.blockedOn=null,_t||(_t=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Rt)))}function Nt(e){function t(t){return Ft(t,e)}if(0<bt.length){Ft(bt[0],e);for(var n=1;n<bt.length;n++){var r=bt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==wt&&Ft(wt,e),null!==kt&&Ft(kt,e),null!==St&&Ft(St,e),Et.forEach(t),Pt.forEach(t),n=0;n<It.length;n++)(r=It[n]).blockedOn===e&&(r.blockedOn=null);for(;0<It.length&&null===(n=It[0]).blockedOn;)Lt(n),null===n.blockedOn&&It.shift()}var jt={},Ut=new Map,Bt=new Map,Vt=["abort","abort",Ke,"animationEnd",Ye,"animationIteration",Qe,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Xe,"transitionEnd","waiting","waiting"];function Ht(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1],a="on"+(i[0].toUpperCase()+i.slice(1));a={phasedRegistrationNames:{bubbled:a,captured:a+"Capture"},dependencies:[r],eventPriority:t},Bt.set(r,t),Ut.set(r,a),jt[i]=a}}Ht("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ht("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ht(Vt,2);for(var Wt="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),qt=0;qt<Wt.length;qt++)Bt.set(Wt[qt],0);var zt=a.unstable_UserBlockingPriority,Gt=a.unstable_runWithPriority,Kt=!0;function Yt(e,t){Qt(t,e,!1)}function Qt(e,t,n){var r=Bt.get(t);switch(void 0===r?2:r){case 0:r=Xt.bind(null,t,1,e);break;case 1:r=$t.bind(null,t,1,e);break;default:r=Jt.bind(null,t,1,e)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function Xt(e,t,n,r){j||F();var i=Jt,a=j;j=!0;try{R(i,e,t,n,r)}finally{(j=a)||B()}}function $t(e,t,n,r){Gt(zt,Jt.bind(null,e,t,n,r))}function Jt(e,t,n,r){if(Kt)if(0<bt.length&&-1<Dt.indexOf(e))e=xt(null,e,t,n,r),bt.push(e);else{var i=Zt(e,t,n,r);if(null===i)Ct(e,r);else if(-1<Dt.indexOf(e))e=xt(i,e,t,n,r),bt.push(e);else if(!function(e,t,n,r,i){switch(t){case"focus":return wt=At(wt,e,t,n,r,i),!0;case"dragenter":return kt=At(kt,e,t,n,r,i),!0;case"mouseover":return St=At(St,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Et.set(a,At(Et.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Pt.set(a,At(Pt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r)){Ct(e,r),e=ft(e,r,null,t);try{V(pt,e)}finally{ht(e)}}}}function Zt(e,t,n,r){if(null!==(n=An(n=lt(r)))){var i=et(n);if(null===i)n=null;else{var a=i.tag;if(13===a){if(null!==(n=tt(i)))return n;n=null}else if(3===a){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null)}}e=ft(e,r,n,t);try{V(pt,e)}finally{ht(e)}return null}var en={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tn=["Webkit","ms","Moz","O"];function nn(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||en.hasOwnProperty(e)&&en[e]?(""+t).trim():t+"px"}function rn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=nn(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(en).forEach((function(e){tn.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),en[t]=en[e]}))}));var an=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function on(e,t){if(t){if(an[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62,""))}}function sn(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var un=Me;function ln(e,t){var n=Ze(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=P[t];for(var r=0;r<t.length;r++)gt(t[r],e,n)}function cn(){}function dn(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function hn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function fn(e,t){var n,r=hn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=hn(r)}}function pn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function gn(){for(var e=window,t=dn();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=dn((e=t.contentWindow).document)}return t}function vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mn="$?",yn="$!",_n=null,bn=null;function wn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function kn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Sn="function"===typeof setTimeout?setTimeout:void 0,En="function"===typeof clearTimeout?clearTimeout:void 0;function Pn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function In(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||n===yn||n===mn){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Dn=Math.random().toString(36).slice(2),Tn="__reactInternalInstance$"+Dn,xn="__reactEventHandlers$"+Dn,Cn="__reactContainere$"+Dn;function An(e){var t=e[Tn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Cn]||n[Tn]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=In(e);null!==e;){if(n=e[Tn])return n;e=In(e)}return t}n=(e=n).parentNode}return null}function Ln(e){return!(e=e[Tn]||e[Cn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function On(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function Mn(e){return e[xn]||null}function Rn(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function Fn(e,t){var n=e.stateNode;if(!n)return null;var r=p(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}function Nn(e,t,n){(t=Fn(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=it(n._dispatchListeners,t),n._dispatchInstances=it(n._dispatchInstances,e))}function jn(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=Rn(t);for(t=n.length;0<t--;)Nn(n[t],"captured",e);for(t=0;t<n.length;t++)Nn(n[t],"bubbled",e)}}function Un(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=Fn(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=it(n._dispatchListeners,t),n._dispatchInstances=it(n._dispatchInstances,e))}function Bn(e){e&&e.dispatchConfig.registrationName&&Un(e._targetInst,null,e)}function Vn(e){at(e,jn)}var Hn=null,Wn=null,qn=null;function zn(){if(qn)return qn;var e,t,n=Wn,r=n.length,i="value"in Hn?Hn.value:Hn.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return qn=i.slice(e,1<t?1-t:void 0)}function Gn(){return!0}function Kn(){return!1}function Yn(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):"target"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Gn:Kn,this.isPropagationStopped=Kn,this}function Qn(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function Xn(e){if(!(e instanceof this))throw Error(o(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function $n(e){e.eventPool=[],e.getPooled=Qn,e.release=Xn}i(Yn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Gn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Gn)},persist:function(){this.isPersistent=Gn},isPersistent:Kn,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Kn,this._dispatchInstances=this._dispatchListeners=null}}),Yn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Yn.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var a=new t;return i(a,n.prototype),n.prototype=a,n.prototype.constructor=n,n.Interface=i({},r.Interface,e),n.extend=r.extend,$n(n),n},$n(Yn);var Jn=Yn.extend({data:null}),Zn=Yn.extend({data:null}),er=[9,13,27,32],tr=D&&"CompositionEvent"in window,nr=null;D&&"documentMode"in document&&(nr=document.documentMode);var rr=D&&"TextEvent"in window&&!nr,ir=D&&(!tr||nr&&8<nr&&11>=nr),ar=String.fromCharCode(32),or={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},sr=!1;function ur(e,t){switch(e){case"keyup":return-1!==er.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function lr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var cr=!1;var dr={eventTypes:or,extractEvents:function(e,t,n,r){var i;if(tr)e:{switch(e){case"compositionstart":var a=or.compositionStart;break e;case"compositionend":a=or.compositionEnd;break e;case"compositionupdate":a=or.compositionUpdate;break e}a=void 0}else cr?ur(e,n)&&(a=or.compositionEnd):"keydown"===e&&229===n.keyCode&&(a=or.compositionStart);return a?(ir&&"ko"!==n.locale&&(cr||a!==or.compositionStart?a===or.compositionEnd&&cr&&(i=zn()):(Wn="value"in(Hn=r)?Hn.value:Hn.textContent,cr=!0)),a=Jn.getPooled(a,t,n,r),i?a.data=i:null!==(i=lr(n))&&(a.data=i),Vn(a),i=a):i=null,(e=rr?function(e,t){switch(e){case"compositionend":return lr(t);case"keypress":return 32!==t.which?null:(sr=!0,ar);case"textInput":return(e=t.data)===ar&&sr?null:e;default:return null}}(e,n):function(e,t){if(cr)return"compositionend"===e||!tr&&ur(e,t)?(e=zn(),qn=Wn=Hn=null,cr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ir&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=Zn.getPooled(or.beforeInput,t,n,r)).data=e,Vn(t)):t=null,null===i?t:null===t?i:[i,t]}},hr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!hr[e.type]:"textarea"===t}var pr={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function gr(e,t,n){return(e=Yn.getPooled(pr.change,e,t,n)).type="change",L(n),Vn(e),e}var vr=null,mr=null;function yr(e){ut(e)}function _r(e){if(we(On(e)))return e}function br(e,t){if("change"===e)return t}var wr=!1;function kr(){vr&&(vr.detachEvent("onpropertychange",Sr),mr=vr=null)}function Sr(e){if("value"===e.propertyName&&_r(mr))if(e=gr(mr,e,lt(e)),j)ut(e);else{j=!0;try{M(yr,e)}finally{j=!1,B()}}}function Er(e,t,n){"focus"===e?(kr(),mr=n,(vr=t).attachEvent("onpropertychange",Sr)):"blur"===e&&kr()}function Pr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return _r(mr)}function Ir(e,t){if("click"===e)return _r(t)}function Dr(e,t){if("input"===e||"change"===e)return _r(t)}D&&(wr=ct("input")&&(!document.documentMode||9<document.documentMode));var Tr={eventTypes:pr,_isInputEventSupported:wr,extractEvents:function(e,t,n,r){var i=t?On(t):window,a=i.nodeName&&i.nodeName.toLowerCase();if("select"===a||"input"===a&&"file"===i.type)var o=br;else if(fr(i))if(wr)o=Dr;else{o=Pr;var s=Er}else(a=i.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(o=Ir);if(o&&(o=o(e,t)))return gr(o,n,r);s&&s(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&De(i,"number",i.value)}},xr=Yn.extend({view:null,detail:null}),Cr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ar(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cr[e])&&!!t[e]}function Lr(){return Ar}var Or=0,Mr=0,Rr=!1,Fr=!1,Nr=xr.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Lr,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Or;return Or=e.screenX,Rr?"mousemove"===e.type?e.screenX-t:0:(Rr=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Mr;return Mr=e.screenY,Fr?"mousemove"===e.type?e.screenY-t:0:(Fr=!0,0)}}),jr=Nr.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Ur={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Br={eventTypes:Ur,extractEvents:function(e,t,n,r,i){var a="mouseover"===e||"pointerover"===e,o="mouseout"===e||"pointerout"===e;if(a&&0===(32&i)&&(n.relatedTarget||n.fromElement)||!o&&!a)return null;(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,o)?(o=t,null!==(t=(t=n.relatedTarget||n.toElement)?An(t):null)&&(t!==et(t)||5!==t.tag&&6!==t.tag)&&(t=null)):o=null;if(o===t)return null;if("mouseout"===e||"mouseover"===e)var s=Nr,u=Ur.mouseLeave,l=Ur.mouseEnter,c="mouse";else"pointerout"!==e&&"pointerover"!==e||(s=jr,u=Ur.pointerLeave,l=Ur.pointerEnter,c="pointer");if(e=null==o?a:On(o),a=null==t?a:On(t),(u=s.getPooled(u,o,n,r)).type=c+"leave",u.target=e,u.relatedTarget=a,(n=s.getPooled(l,t,n,r)).type=c+"enter",n.target=a,n.relatedTarget=e,c=t,(r=o)&&c)e:{for(l=c,o=0,e=s=r;e;e=Rn(e))o++;for(e=0,t=l;t;t=Rn(t))e++;for(;0<o-e;)s=Rn(s),o--;for(;0<e-o;)l=Rn(l),e--;for(;o--;){if(s===l||s===l.alternate)break e;s=Rn(s),l=Rn(l)}s=null}else s=null;for(l=s,s=[];r&&r!==l&&(null===(o=r.alternate)||o!==l);)s.push(r),r=Rn(r);for(r=[];c&&c!==l&&(null===(o=c.alternate)||o!==l);)r.push(c),c=Rn(c);for(c=0;c<s.length;c++)Un(s[c],"bubbled",u);for(c=r.length;0<c--;)Un(r[c],"captured",n);return 0===(64&i)?[u]:[u,n]}};var Vr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Hr=Object.prototype.hasOwnProperty;function Wr(e,t){if(Vr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Hr.call(t,n[r])||!Vr(e[n[r]],t[n[r]]))return!1;return!0}var qr=D&&"documentMode"in document&&11>=document.documentMode,zr={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Gr=null,Kr=null,Yr=null,Qr=!1;function Xr(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Qr||null==Gr||Gr!==dn(n)?null:("selectionStart"in(n=Gr)&&vn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Yr&&Wr(Yr,n)?null:(Yr=n,(e=Yn.getPooled(zr.select,Kr,e,t)).type="select",e.target=Gr,Vn(e),e))}var $r={eventTypes:zr,extractEvents:function(e,t,n,r,i,a){if(!(a=!(i=a||(r.window===r?r.document:9===r.nodeType?r:r.ownerDocument)))){e:{i=Ze(i),a=P.onSelect;for(var o=0;o<a.length;o++)if(!i.has(a[o])){i=!1;break e}i=!0}a=!i}if(a)return null;switch(i=t?On(t):window,e){case"focus":(fr(i)||"true"===i.contentEditable)&&(Gr=i,Kr=t,Yr=null);break;case"blur":Yr=Kr=Gr=null;break;case"mousedown":Qr=!0;break;case"contextmenu":case"mouseup":case"dragend":return Qr=!1,Xr(n,r);case"selectionchange":if(qr)break;case"keydown":case"keyup":return Xr(n,r)}return null}},Jr=Yn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),Zr=Yn.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ei=xr.extend({relatedTarget:null});function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var ni={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ri={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ii=xr.extend({key:function(e){if(e.key){var t=ni[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ri[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Lr,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ai=Nr.extend({dataTransfer:null}),oi=xr.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Lr}),si=Yn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),ui=Nr.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),li={eventTypes:jt,extractEvents:function(e,t,n,r){var i=Ut.get(e);if(!i)return null;switch(e){case"keypress":if(0===ti(n))return null;case"keydown":case"keyup":e=ii;break;case"blur":case"focus":e=ei;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Nr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=ai;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=oi;break;case Ke:case Ye:case Qe:e=Jr;break;case Xe:e=si;break;case"scroll":e=xr;break;case"wheel":e=ui;break;case"copy":case"cut":case"paste":e=Zr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=jr;break;default:e=Yn}return Vn(t=e.getPooled(i,t,n,r)),t}};if(y)throw Error(o(101));y=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),b(),p=Mn,g=Ln,v=On,I({SimpleEventPlugin:li,EnterLeaveEventPlugin:Br,ChangeEventPlugin:Tr,SelectEventPlugin:$r,BeforeInputEventPlugin:dr});var ci=[],di=-1;function hi(e){0>di||(e.current=ci[di],ci[di]=null,di--)}function fi(e,t){di++,ci[di]=e.current,e.current=t}var pi={},gi={current:pi},vi={current:!1},mi=pi;function yi(e,t){var n=e.type.contextTypes;if(!n)return pi;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function _i(e){return null!==(e=e.childContextTypes)&&void 0!==e}function bi(){hi(vi),hi(gi)}function wi(e,t,n){if(gi.current!==pi)throw Error(o(168));fi(gi,t),fi(vi,n)}function ki(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in e))throw Error(o(108,ve(t)||"Unknown",a));return i({},n,{},r)}function Si(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||pi,mi=gi.current,fi(gi,e),fi(vi,vi.current),!0}function Ei(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=ki(e,t,mi),r.__reactInternalMemoizedMergedChildContext=e,hi(vi),hi(gi),fi(gi,e)):hi(vi),fi(vi,n)}var Pi=a.unstable_runWithPriority,Ii=a.unstable_scheduleCallback,Di=a.unstable_cancelCallback,Ti=a.unstable_requestPaint,xi=a.unstable_now,Ci=a.unstable_getCurrentPriorityLevel,Ai=a.unstable_ImmediatePriority,Li=a.unstable_UserBlockingPriority,Oi=a.unstable_NormalPriority,Mi=a.unstable_LowPriority,Ri=a.unstable_IdlePriority,Fi={},Ni=a.unstable_shouldYield,ji=void 0!==Ti?Ti:function(){},Ui=null,Bi=null,Vi=!1,Hi=xi(),Wi=1e4>Hi?xi:function(){return xi()-Hi};function qi(){switch(Ci()){case Ai:return 99;case Li:return 98;case Oi:return 97;case Mi:return 96;case Ri:return 95;default:throw Error(o(332))}}function zi(e){switch(e){case 99:return Ai;case 98:return Li;case 97:return Oi;case 96:return Mi;case 95:return Ri;default:throw Error(o(332))}}function Gi(e,t){return e=zi(e),Pi(e,t)}function Ki(e,t,n){return e=zi(e),Ii(e,t,n)}function Yi(e){return null===Ui?(Ui=[e],Bi=Ii(Ai,Xi)):Ui.push(e),Fi}function Qi(){if(null!==Bi){var e=Bi;Bi=null,Di(e)}Xi()}function Xi(){if(!Vi&&null!==Ui){Vi=!0;var e=0;try{var t=Ui;Gi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Ui=null}catch(n){throw null!==Ui&&(Ui=Ui.slice(e+1)),Ii(Ai,Qi),n}finally{Vi=!1}}}function $i(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function Ji(e,t){if(e&&e.defaultProps)for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var Zi={current:null},ea=null,ta=null,na=null;function ra(){na=ta=ea=null}function ia(e){var t=Zi.current;hi(Zi),e.type._context._currentValue=t}function aa(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function oa(e,t){ea=e,na=ta=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(Mo=!0),e.firstContext=null)}function sa(e,t){if(na!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(na=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ta){if(null===ea)throw Error(o(308));ta=t,ea.dependencies={expirationTime:0,firstContext:t,responders:null}}else ta=ta.next=t;return e._currentValue}var ua=!1;function la(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function ca(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function da(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function ha(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function fa(e,t){var n=e.alternate;null!==n&&ca(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function pa(e,t,n,r){var a=e.updateQueue;ua=!1;var o=a.baseQueue,s=a.shared.pending;if(null!==s){if(null!==o){var u=o.next;o.next=s.next,s.next=u}o=s,a.shared.pending=null,null!==(u=e.alternate)&&(null!==(u=u.updateQueue)&&(u.baseQueue=s))}if(null!==o){u=o.next;var l=a.baseState,c=0,d=null,h=null,f=null;if(null!==u)for(var p=u;;){if((s=p.expirationTime)<r){var g={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===f?(h=f=g,d=l):f=f.next=g,s>c&&(c=s)}else{null!==f&&(f=f.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null}),fu(s,p.suspenseConfig);e:{var v=e,m=p;switch(s=t,g=n,m.tag){case 1:if("function"===typeof(v=m.payload)){l=v.call(g,l,s);break e}l=v;break e;case 3:v.effectTag=-4097&v.effectTag|64;case 0:if(null===(s="function"===typeof(v=m.payload)?v.call(g,l,s):v)||void 0===s)break e;l=i({},l,s);break e;case 2:ua=!0}}null!==p.callback&&(e.effectTag|=32,null===(s=a.effects)?a.effects=[p]:s.push(p))}if(null===(p=p.next)||p===u){if(null===(s=a.shared.pending))break;p=o.next=s.next,s.next=u,a.baseQueue=o=s,a.shared.pending=null}}null===f?d=l:f.next=h,a.baseState=d,a.baseQueue=f,pu(c),e.expirationTime=c,e.memoizedState=l}}function ga(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=i,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var va=X.ReactCurrentBatchConfig,ma=(new r.Component).refs;function ya(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var _a={isMounted:function(e){return!!(e=e._reactInternalFiber)&&et(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=eu(),i=va.suspense;(i=da(r=tu(r,e,i),i)).payload=t,void 0!==n&&null!==n&&(i.callback=n),ha(e,i),nu(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=eu(),i=va.suspense;(i=da(r=tu(r,e,i),i)).tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),ha(e,i),nu(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=eu(),r=va.suspense;(r=da(n=tu(n,e,r),r)).tag=2,void 0!==t&&null!==t&&(r.callback=t),ha(e,r),nu(e,n)}};function ba(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!Wr(n,r)||!Wr(i,a))}function wa(e,t,n){var r=!1,i=pi,a=t.contextType;return"object"===typeof a&&null!==a?a=sa(a):(i=_i(t)?mi:gi.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?yi(e,i):pi),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=_a,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ka(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&_a.enqueueReplaceState(t,t.state,null)}function Sa(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ma,la(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=sa(a):(a=_i(t)?mi:gi.current,i.context=yi(e,a)),pa(e,n,i,r),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(ya(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&_a.enqueueReplaceState(i,i.state,null),pa(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.effectTag|=4)}var Ea=Array.isArray;function Pa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===ma&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Ia(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Da(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Mu(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function s(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Nu(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=Pa(e,t,n),r.return=e,r):((r=Ru(n.type,n.key,n.props,null,e.mode,r)).ref=Pa(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=ju(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Fu(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Nu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case ee:return(n=Ru(t.type,t.key,t.props,null,e.mode,n)).ref=Pa(e,null,t),n.return=e,n;case te:return(t=ju(t,e.mode,n)).return=e,t}if(Ea(t)||ge(t))return(t=Fu(t,e.mode,n,null)).return=e,t;Ia(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===i?n.type===ne?d(e,t,n.props.children,r,i):l(e,t,n,r):null;case te:return n.key===i?c(e,t,n,r):null}if(Ea(n)||ge(n))return null!==i?null:d(e,t,n,r,null);Ia(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case ee:return e=e.get(null===r.key?n:r.key)||null,r.type===ne?d(t,e,r.props.children,i,r.key):l(t,e,r,i);case te:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(Ea(r)||ge(r))return d(t,e=e.get(n)||null,r,i,null);Ia(t,r)}return null}function g(i,o,s,u){for(var l=null,c=null,d=o,g=o=0,v=null;null!==d&&g<s.length;g++){d.index>g?(v=d,d=null):v=d.sibling;var m=f(i,d,s[g],u);if(null===m){null===d&&(d=v);break}e&&d&&null===m.alternate&&t(i,d),o=a(m,o,g),null===c?l=m:c.sibling=m,c=m,d=v}if(g===s.length)return n(i,d),l;if(null===d){for(;g<s.length;g++)null!==(d=h(i,s[g],u))&&(o=a(d,o,g),null===c?l=d:c.sibling=d,c=d);return l}for(d=r(i,d);g<s.length;g++)null!==(v=p(d,i,g,s[g],u))&&(e&&null!==v.alternate&&d.delete(null===v.key?g:v.key),o=a(v,o,g),null===c?l=v:c.sibling=v,c=v);return e&&d.forEach((function(e){return t(i,e)})),l}function v(i,s,u,l){var c=ge(u);if("function"!==typeof c)throw Error(o(150));if(null==(u=c.call(u)))throw Error(o(151));for(var d=c=null,g=s,v=s=0,m=null,y=u.next();null!==g&&!y.done;v++,y=u.next()){g.index>v?(m=g,g=null):m=g.sibling;var _=f(i,g,y.value,l);if(null===_){null===g&&(g=m);break}e&&g&&null===_.alternate&&t(i,g),s=a(_,s,v),null===d?c=_:d.sibling=_,d=_,g=m}if(y.done)return n(i,g),c;if(null===g){for(;!y.done;v++,y=u.next())null!==(y=h(i,y.value,l))&&(s=a(y,s,v),null===d?c=y:d.sibling=y,d=y);return c}for(g=r(i,g);!y.done;v++,y=u.next())null!==(y=p(g,i,v,y.value,l))&&(e&&null!==y.alternate&&g.delete(null===y.key?v:y.key),s=a(y,s,v),null===d?c=y:d.sibling=y,d=y);return e&&g.forEach((function(e){return t(i,e)})),c}return function(e,r,a,u){var l="object"===typeof a&&null!==a&&a.type===ne&&null===a.key;l&&(a=a.props.children);var c="object"===typeof a&&null!==a;if(c)switch(a.$$typeof){case ee:e:{for(c=a.key,l=r;null!==l;){if(l.key===c){switch(l.tag){case 7:if(a.type===ne){n(e,l.sibling),(r=i(l,a.props.children)).return=e,e=r;break e}break;default:if(l.elementType===a.type){n(e,l.sibling),(r=i(l,a.props)).ref=Pa(e,l,a),r.return=e,e=r;break e}}n(e,l);break}t(e,l),l=l.sibling}a.type===ne?((r=Fu(a.props.children,e.mode,u,a.key)).return=e,e=r):((u=Ru(a.type,a.key,a.props,null,e.mode,u)).ref=Pa(e,r,a),u.return=e,e=u)}return s(e);case te:e:{for(l=a.key;null!==r;){if(r.key===l){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(e,r.sibling),(r=i(r,a.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=ju(a,e.mode,u)).return=e,e=r}return s(e)}if("string"===typeof a||"number"===typeof a)return a=""+a,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,a)).return=e,e=r):(n(e,r),(r=Nu(a,e.mode,u)).return=e,e=r),s(e);if(Ea(a))return g(e,r,a,u);if(ge(a))return v(e,r,a,u);if(c&&Ia(e,a),"undefined"===typeof a&&!l)switch(e.tag){case 1:case 0:throw e=e.type,Error(o(152,e.displayName||e.name||"Component"))}return n(e,r)}}var Ta=Da(!0),xa=Da(!1),Ca={},Aa={current:Ca},La={current:Ca},Oa={current:Ca};function Ma(e){if(e===Ca)throw Error(o(174));return e}function Ra(e,t){switch(fi(Oa,t),fi(La,e),fi(Aa,Ca),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ne(null,"");break;default:t=Ne(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}hi(Aa),fi(Aa,t)}function Fa(){hi(Aa),hi(La),hi(Oa)}function Na(e){Ma(Oa.current);var t=Ma(Aa.current),n=Ne(t,e.type);t!==n&&(fi(La,e),fi(Aa,n))}function ja(e){La.current===e&&(hi(Aa),hi(La))}var Ua={current:0};function Ba(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||n.data===mn||n.data===yn))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Va(e,t){return{responder:e,props:t}}var Ha=X.ReactCurrentDispatcher,Wa=X.ReactCurrentBatchConfig,qa=0,za=null,Ga=null,Ka=null,Ya=!1;function Qa(){throw Error(o(321))}function Xa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Vr(e[n],t[n]))return!1;return!0}function $a(e,t,n,r,i,a){if(qa=a,za=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,Ha.current=null===e||null===e.memoizedState?wo:ko,e=n(r,i),t.expirationTime===qa){a=0;do{if(t.expirationTime=0,!(25>a))throw Error(o(301));a+=1,Ka=Ga=null,t.updateQueue=null,Ha.current=So,e=n(r,i)}while(t.expirationTime===qa)}if(Ha.current=bo,t=null!==Ga&&null!==Ga.next,qa=0,Ka=Ga=za=null,Ya=!1,t)throw Error(o(300));return e}function Ja(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ka?za.memoizedState=Ka=e:Ka=Ka.next=e,Ka}function Za(){if(null===Ga){var e=za.alternate;e=null!==e?e.memoizedState:null}else e=Ga.next;var t=null===Ka?za.memoizedState:Ka.next;if(null!==t)Ka=t,Ga=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Ga=e).memoizedState,baseState:Ga.baseState,baseQueue:Ga.baseQueue,queue:Ga.queue,next:null},null===Ka?za.memoizedState=Ka=e:Ka=Ka.next=e}return Ka}function eo(e,t){return"function"===typeof t?t(e):t}function to(e){var t=Za(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=Ga,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var u=s=a=null,l=i;do{var c=l.expirationTime;if(c<qa){var d={expirationTime:l.expirationTime,suspenseConfig:l.suspenseConfig,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};null===u?(s=u=d,a=r):u=u.next=d,c>za.expirationTime&&(za.expirationTime=c,pu(c))}else null!==u&&(u=u.next={expirationTime:1073741823,suspenseConfig:l.suspenseConfig,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),fu(c,l.suspenseConfig),r=l.eagerReducer===e?l.eagerState:e(r,l.action);l=l.next}while(null!==l&&l!==i);null===u?a=r:u.next=s,Vr(r,t.memoizedState)||(Mo=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function no(e){var t=Za(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);Vr(a,t.memoizedState)||(Mo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function ro(e){var t=Ja();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:eo,lastRenderedState:e}).dispatch=_o.bind(null,za,e),[t.memoizedState,e]}function io(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=za.updateQueue)?(t={lastEffect:null},za.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function ao(){return Za().memoizedState}function oo(e,t,n,r){var i=Ja();za.effectTag|=e,i.memoizedState=io(1|t,n,void 0,void 0===r?null:r)}function so(e,t,n,r){var i=Za();r=void 0===r?null:r;var a=void 0;if(null!==Ga){var o=Ga.memoizedState;if(a=o.destroy,null!==r&&Xa(r,o.deps))return void io(t,n,a,r)}za.effectTag|=e,i.memoizedState=io(1|t,n,a,r)}function uo(e,t){return oo(516,4,e,t)}function lo(e,t){return so(516,4,e,t)}function co(e,t){return so(4,2,e,t)}function ho(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function fo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,so(4,2,ho.bind(null,t,e),n)}function po(){}function go(e,t){return Ja().memoizedState=[e,void 0===t?null:t],e}function vo(e,t){var n=Za();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Xa(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function mo(e,t){var n=Za();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Xa(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function yo(e,t,n){var r=qi();Gi(98>r?98:r,(function(){e(!0)})),Gi(97<r?97:r,(function(){var r=Wa.suspense;Wa.suspense=void 0===t?null:t;try{e(!1),n()}finally{Wa.suspense=r}}))}function _o(e,t,n){var r=eu(),i=va.suspense;i={expirationTime:r=tu(r,e,i),suspenseConfig:i,action:n,eagerReducer:null,eagerState:null,next:null};var a=t.pending;if(null===a?i.next=i:(i.next=a.next,a.next=i),t.pending=i,a=e.alternate,e===za||null!==a&&a===za)Ya=!0,i.expirationTime=qa,za.expirationTime=qa;else{if(0===e.expirationTime&&(null===a||0===a.expirationTime)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.eagerReducer=a,i.eagerState=s,Vr(s,o))return}catch(u){}nu(e,r)}}var bo={readContext:sa,useCallback:Qa,useContext:Qa,useEffect:Qa,useImperativeHandle:Qa,useLayoutEffect:Qa,useMemo:Qa,useReducer:Qa,useRef:Qa,useState:Qa,useDebugValue:Qa,useResponder:Qa,useDeferredValue:Qa,useTransition:Qa},wo={readContext:sa,useCallback:go,useContext:sa,useEffect:uo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,oo(4,2,ho.bind(null,t,e),n)},useLayoutEffect:function(e,t){return oo(4,2,e,t)},useMemo:function(e,t){var n=Ja();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ja();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=_o.bind(null,za,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ja().memoizedState=e},useState:ro,useDebugValue:po,useResponder:Va,useDeferredValue:function(e,t){var n=ro(e),r=n[0],i=n[1];return uo((function(){var n=Wa.suspense;Wa.suspense=void 0===t?null:t;try{i(e)}finally{Wa.suspense=n}}),[e,t]),r},useTransition:function(e){var t=ro(!1),n=t[0];return t=t[1],[go(yo.bind(null,t,e),[t,e]),n]}},ko={readContext:sa,useCallback:vo,useContext:sa,useEffect:lo,useImperativeHandle:fo,useLayoutEffect:co,useMemo:mo,useReducer:to,useRef:ao,useState:function(){return to(eo)},useDebugValue:po,useResponder:Va,useDeferredValue:function(e,t){var n=to(eo),r=n[0],i=n[1];return lo((function(){var n=Wa.suspense;Wa.suspense=void 0===t?null:t;try{i(e)}finally{Wa.suspense=n}}),[e,t]),r},useTransition:function(e){var t=to(eo),n=t[0];return t=t[1],[vo(yo.bind(null,t,e),[t,e]),n]}},So={readContext:sa,useCallback:vo,useContext:sa,useEffect:lo,useImperativeHandle:fo,useLayoutEffect:co,useMemo:mo,useReducer:no,useRef:ao,useState:function(){return no(eo)},useDebugValue:po,useResponder:Va,useDeferredValue:function(e,t){var n=no(eo),r=n[0],i=n[1];return lo((function(){var n=Wa.suspense;Wa.suspense=void 0===t?null:t;try{i(e)}finally{Wa.suspense=n}}),[e,t]),r},useTransition:function(e){var t=no(eo),n=t[0];return t=t[1],[vo(yo.bind(null,t,e),[t,e]),n]}},Eo=null,Po=null,Io=!1;function Do(e,t){var n=Lu(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function To(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function xo(e){if(Io){var t=Po;if(t){var n=t;if(!To(e,t)){if(!(t=Pn(n.nextSibling))||!To(e,t))return e.effectTag=-1025&e.effectTag|2,Io=!1,void(Eo=e);Do(Eo,n)}Eo=e,Po=Pn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Io=!1,Eo=e}}function Co(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Eo=e}function Ao(e){if(e!==Eo)return!1;if(!Io)return Co(e),Io=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!kn(t,e.memoizedProps))for(t=Po;t;)Do(e,t),t=Pn(t.nextSibling);if(Co(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Po=Pn(e.nextSibling);break e}t--}else"$"!==n&&n!==yn&&n!==mn||t++}e=e.nextSibling}Po=null}}else Po=Eo?Pn(e.stateNode.nextSibling):null;return!0}function Lo(){Po=Eo=null,Io=!1}var Oo=X.ReactCurrentOwner,Mo=!1;function Ro(e,t,n,r){t.child=null===e?xa(t,null,n,r):Ta(t,e.child,n,r)}function Fo(e,t,n,r,i){n=n.render;var a=t.ref;return oa(t,i),r=$a(e,t,n,r,a,i),null===e||Mo?(t.effectTag|=1,Ro(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Jo(e,t,i))}function No(e,t,n,r,i,a){if(null===e){var o=n.type;return"function"!==typeof o||Ou(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ru(n.type,null,r,null,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,jo(e,t,o,r,i,a))}return o=e.child,i<a&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:Wr)(i,r)&&e.ref===t.ref)?Jo(e,t,a):(t.effectTag|=1,(e=Mu(o,r)).ref=t.ref,e.return=t,t.child=e)}function jo(e,t,n,r,i,a){return null!==e&&Wr(e.memoizedProps,r)&&e.ref===t.ref&&(Mo=!1,i<a)?(t.expirationTime=e.expirationTime,Jo(e,t,a)):Bo(e,t,n,r,a)}function Uo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Bo(e,t,n,r,i){var a=_i(n)?mi:gi.current;return a=yi(t,a),oa(t,i),n=$a(e,t,n,r,a,i),null===e||Mo?(t.effectTag|=1,Ro(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Jo(e,t,i))}function Vo(e,t,n,r,i){if(_i(n)){var a=!0;Si(t)}else a=!1;if(oa(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),wa(t,n,r),Sa(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=sa(l):l=yi(t,l=_i(n)?mi:gi.current);var c=n.getDerivedStateFromProps,d="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==l)&&ka(t,o,r,l),ua=!1;var h=t.memoizedState;o.state=h,pa(t,r,o,i),u=t.memoizedState,s!==r||h!==u||vi.current||ua?("function"===typeof c&&(ya(t,n,c,r),u=t.memoizedState),(s=ua||ba(t,n,s,r,h,u,l))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.effectTag|=4)):("function"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,ca(e,t),s=t.memoizedProps,o.props=t.type===t.elementType?s:Ji(t.type,s),u=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=sa(l):l=yi(t,l=_i(n)?mi:gi.current),(d="function"===typeof(c=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==l)&&ka(t,o,r,l),ua=!1,u=t.memoizedState,o.state=u,pa(t,r,o,i),h=t.memoizedState,s!==r||u!==h||vi.current||ua?("function"===typeof c&&(ya(t,n,c,r),h=t.memoizedState),(c=ua||ba(t,n,s,r,u,h,l))?(d||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,h,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,h,l)),"function"===typeof o.componentDidUpdate&&(t.effectTag|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=h),o.props=r,o.state=h,o.context=l,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),r=!1);return Ho(e,t,n,r,a,i)}function Ho(e,t,n,r,i,a){Uo(e,t);var o=0!==(64&t.effectTag);if(!r&&!o)return i&&Ei(t,n,!1),Jo(e,t,a);r=t.stateNode,Oo.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&o?(t.child=Ta(t,e.child,null,a),t.child=Ta(t,null,s,a)):Ro(e,t,s,a),t.memoizedState=r.state,i&&Ei(t,n,!0),t.child}function Wo(e){var t=e.stateNode;t.pendingContext?wi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&wi(0,t.context,!1),Ra(e,t.containerInfo)}var qo,zo,Go,Ko={dehydrated:null,retryTime:0};function Yo(e,t,n){var r,i=t.mode,a=t.pendingProps,o=Ua.current,s=!1;if((r=0!==(64&t.effectTag))||(r=0!==(2&o)&&(null===e||null!==e.memoizedState)),r?(s=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===a.fallback||!0===a.unstable_avoidThisFallback||(o|=1),fi(Ua,1&o),null===e){if(void 0!==a.fallback&&xo(t),s){if(s=a.fallback,(a=Fu(null,i,0,null)).return=t,0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,a.child=e;null!==e;)e.return=a,e=e.sibling;return(n=Fu(s,i,n,null)).return=t,a.sibling=n,t.memoizedState=Ko,t.child=a,n}return i=a.children,t.memoizedState=null,t.child=xa(t,null,i,n)}if(null!==e.memoizedState){if(i=(e=e.child).sibling,s){if(a=a.fallback,(n=Mu(e,e.pendingProps)).return=t,0===(2&t.mode)&&(s=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=s;null!==s;)s.return=n,s=s.sibling;return(i=Mu(i,a)).return=t,n.sibling=i,n.childExpirationTime=0,t.memoizedState=Ko,t.child=n,i}return n=Ta(t,e.child,a.children,n),t.memoizedState=null,t.child=n}if(e=e.child,s){if(s=a.fallback,(a=Fu(null,i,0,null)).return=t,a.child=e,null!==e&&(e.return=a),0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,a.child=e;null!==e;)e.return=a,e=e.sibling;return(n=Fu(s,i,n,null)).return=t,a.sibling=n,n.effectTag|=2,a.childExpirationTime=0,t.memoizedState=Ko,t.child=a,n}return t.memoizedState=null,t.child=Ta(t,e,a.children,n)}function Qo(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),aa(e.return,t)}function Xo(e,t,n,r,i,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:i,lastEffect:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailExpiration=0,o.tailMode=i,o.lastEffect=a)}function $o(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(Ro(e,t,r.children,n),0!==(2&(r=Ua.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!==(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qo(e,n);else if(19===e.tag)Qo(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(fi(Ua,r),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Ba(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Xo(t,!1,i,n,a,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Ba(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Xo(t,!0,n,null,a,t.lastEffect);break;case"together":Xo(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function Jo(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&pu(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Mu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Mu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Zo(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function es(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return _i(t.type)&&bi(),null;case 3:return Fa(),hi(vi),hi(gi),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!Ao(t)||(t.effectTag|=4),null;case 5:ja(t),n=Ma(Oa.current);var a=t.type;if(null!==e&&null!=t.stateNode)zo(e,t,a,r,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=Ma(Aa.current),Ao(t)){r=t.stateNode,a=t.type;var s=t.memoizedProps;switch(r[Tn]=t,r[xn]=s,a){case"iframe":case"object":case"embed":Yt("load",r);break;case"video":case"audio":for(e=0;e<$e.length;e++)Yt($e[e],r);break;case"source":Yt("error",r);break;case"img":case"image":case"link":Yt("error",r),Yt("load",r);break;case"form":Yt("reset",r),Yt("submit",r);break;case"details":Yt("toggle",r);break;case"input":Se(r,s),Yt("invalid",r),ln(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Yt("invalid",r),ln(n,"onChange");break;case"textarea":Ae(r,s),Yt("invalid",r),ln(n,"onChange")}for(var u in on(a,s),e=null,s)if(s.hasOwnProperty(u)){var l=s[u];"children"===u?"string"===typeof l?r.textContent!==l&&(e=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(e=["children",""+l]):E.hasOwnProperty(u)&&null!=l&&ln(n,u)}switch(a){case"input":be(r),Ie(r,s,!0);break;case"textarea":be(r),Oe(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=cn)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(u=9===n.nodeType?n:n.ownerDocument,e===un&&(e=Fe(a)),e===un?"script"===a?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(a,{is:r.is}):(e=u.createElement(a),"select"===a&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,a),e[Tn]=t,e[xn]=r,qo(e,t),t.stateNode=e,u=sn(a,r),a){case"iframe":case"object":case"embed":Yt("load",e),l=r;break;case"video":case"audio":for(l=0;l<$e.length;l++)Yt($e[l],e);l=r;break;case"source":Yt("error",e),l=r;break;case"img":case"image":case"link":Yt("error",e),Yt("load",e),l=r;break;case"form":Yt("reset",e),Yt("submit",e),l=r;break;case"details":Yt("toggle",e),l=r;break;case"input":Se(e,r),l=ke(e,r),Yt("invalid",e),ln(n,"onChange");break;case"option":l=Te(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},l=i({},r,{value:void 0}),Yt("invalid",e),ln(n,"onChange");break;case"textarea":Ae(e,r),l=Ce(e,r),Yt("invalid",e),ln(n,"onChange");break;default:l=r}on(a,l);var c=l;for(s in c)if(c.hasOwnProperty(s)){var d=c[s];"style"===s?rn(e,d):"dangerouslySetInnerHTML"===s?null!=(d=d?d.__html:void 0)&&Be(e,d):"children"===s?"string"===typeof d?("textarea"!==a||""!==d)&&Ve(e,d):"number"===typeof d&&Ve(e,""+d):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(E.hasOwnProperty(s)?null!=d&&ln(n,s):null!=d&&$(e,s,d,u))}switch(a){case"input":be(e),Ie(e,r,!1);break;case"textarea":be(e),Oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+ye(r.value));break;case"select":e.multiple=!!r.multiple,null!=(n=r.value)?xe(e,!!r.multiple,n,!1):null!=r.defaultValue&&xe(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof l.onClick&&(e.onclick=cn)}wn(a,r)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)Go(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));n=Ma(Oa.current),Ma(Aa.current),Ao(t)?(n=t.stateNode,r=t.memoizedProps,n[Tn]=t,n.nodeValue!==r&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Tn]=t,t.stateNode=n)}return null;case 13:return hi(Ua),r=t.memoizedState,0!==(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==r,r=!1,null===e?void 0!==t.memoizedProps.fallback&&Ao(t):(r=null!==(a=e.memoizedState),n||null===a||null!==(a=e.child.sibling)&&(null!==(s=t.firstEffect)?(t.firstEffect=a,a.nextEffect=s):(t.firstEffect=t.lastEffect=a,a.nextEffect=null),a.effectTag=8)),n&&!r&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Ua.current)?Rs===Ts&&(Rs=xs):(Rs!==Ts&&Rs!==xs||(Rs=Cs),0!==Bs&&null!==Ls&&(Vu(Ls,Ms),Hu(Ls,Bs)))),(n||r)&&(t.effectTag|=4),null);case 4:return Fa(),null;case 10:return ia(t),null;case 17:return _i(t.type)&&bi(),null;case 19:if(hi(Ua),null===(r=t.memoizedState))return null;if(a=0!==(64&t.effectTag),null===(s=r.rendering)){if(a)Zo(r,!1);else if(Rs!==Ts||null!==e&&0!==(64&e.effectTag))for(s=t.child;null!==s;){if(null!==(e=Ba(s))){for(t.effectTag|=64,Zo(r,!1),null!==(a=e.updateQueue)&&(t.updateQueue=a,t.effectTag|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;null!==r;)s=n,(a=r).effectTag&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(e=a.alternate)?(a.childExpirationTime=0,a.expirationTime=s,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null):(a.childExpirationTime=e.childExpirationTime,a.expirationTime=e.expirationTime,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,s=e.dependencies,a.dependencies=null===s?null:{expirationTime:s.expirationTime,firstContext:s.firstContext,responders:s.responders}),r=r.sibling;return fi(Ua,1&Ua.current|2),t.child}s=s.sibling}}else{if(!a)if(null!==(e=Ba(s))){if(t.effectTag|=64,a=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),Zo(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Wi()-r.renderingStartTime>r.tailExpiration&&1<n&&(t.effectTag|=64,a=!0,Zo(r,!1),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(s.sibling=t.child,t.child=s):(null!==(n=r.last)?n.sibling=s:t.child=s,r.last=s)}return null!==r.tail?(0===r.tailExpiration&&(r.tailExpiration=Wi()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Wi(),n.sibling=null,t=Ua.current,fi(Ua,a?1&t|2:1&t),n):null}throw Error(o(156,t.tag))}function ts(e){switch(e.tag){case 1:_i(e.type)&&bi();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Fa(),hi(vi),hi(gi),0!==(64&(t=e.effectTag)))throw Error(o(285));return e.effectTag=-4097&t|64,e;case 5:return ja(e),null;case 13:return hi(Ua),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return hi(Ua),null;case 4:return Fa(),null;case 10:return ia(e),null;default:return null}}function ns(e,t){return{value:e,source:t,stack:me(t)}}qo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},zo=function(e,t,n,r,a){var o=e.memoizedProps;if(o!==r){var s,u,l=t.stateNode;switch(Ma(Aa.current),e=null,n){case"input":o=ke(l,o),r=ke(l,r),e=[];break;case"option":o=Te(l,o),r=Te(l,r),e=[];break;case"select":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),e=[];break;case"textarea":o=Ce(l,o),r=Ce(l,r),e=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(l.onclick=cn)}for(s in on(n,r),n=null,o)if(!r.hasOwnProperty(s)&&o.hasOwnProperty(s)&&null!=o[s])if("style"===s)for(u in l=o[s])l.hasOwnProperty(u)&&(n||(n={}),n[u]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(E.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in r){var c=r[s];if(l=null!=o?o[s]:void 0,r.hasOwnProperty(s)&&c!==l&&(null!=c||null!=l))if("style"===s)if(l){for(u in l)!l.hasOwnProperty(u)||c&&c.hasOwnProperty(u)||(n||(n={}),n[u]="");for(u in c)c.hasOwnProperty(u)&&l[u]!==c[u]&&(n||(n={}),n[u]=c[u])}else n||(e||(e=[]),e.push(s,n)),n=c;else"dangerouslySetInnerHTML"===s?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(e=e||[]).push(s,c)):"children"===s?l===c||"string"!==typeof c&&"number"!==typeof c||(e=e||[]).push(s,""+c):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(E.hasOwnProperty(s)?(null!=c&&ln(a,s),e||l===c||(e=[])):(e=e||[]).push(s,c))}n&&(e=e||[]).push("style",n),a=e,(t.updateQueue=a)&&(t.effectTag|=4)}},Go=function(e,t,n,r){n!==r&&(t.effectTag|=4)};var rs="function"===typeof WeakSet?WeakSet:Set;function is(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=me(n)),null!==n&&ve(n.type),t=t.value,null!==e&&1===e.tag&&ve(e.type);try{console.error(t)}catch(i){setTimeout((function(){throw i}))}}function as(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Iu(e,n)}else t.current=null}function os(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Ji(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(o(163))}function ss(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==t)}}function us(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ls(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void us(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:Ji(n.type,t.memoizedProps);e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&ga(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}ga(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&wn(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Nt(n)))));case 19:case 17:case 20:case 21:return}throw Error(o(163))}function cs(e,t,n){switch("function"===typeof Cu&&Cu(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e.next;Gi(97<n?97:n,(function(){var e=r;do{var n=e.destroy;if(void 0!==n){var i=t;try{n()}catch(a){Iu(i,a)}}e=e.next}while(e!==r)}))}break;case 1:as(t),"function"===typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(n){Iu(e,n)}}(t,n);break;case 5:as(t);break;case 4:vs(e,t,n)}}function ds(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&ds(t)}function hs(e){return 5===e.tag||3===e.tag||4===e.tag}function fs(e){e:{for(var t=e.return;null!==t;){if(hs(t)){var n=t;break e}t=t.return}throw Error(o(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.effectTag&&(Ve(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||hs(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}r?ps(e,n,t):gs(e,n,t)}function ps(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=cn));else if(4!==r&&null!==(e=e.child))for(ps(e,t,n),e=e.sibling;null!==e;)ps(e,t,n),e=e.sibling}function gs(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(gs(e,t,n),e=e.sibling;null!==e;)gs(e,t,n),e=e.sibling}function vs(e,t,n){for(var r,i,a=t,s=!1;;){if(!s){s=a.return;e:for(;;){if(null===s)throw Error(o(160));switch(r=s.stateNode,s.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}s=s.return}s=!0}if(5===a.tag||6===a.tag){e:for(var u=e,l=a,c=n,d=l;;)if(cs(u,d,c),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===l)break e;for(;null===d.sibling;){if(null===d.return||d.return===l)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}i?(u=r,l=a.stateNode,8===u.nodeType?u.parentNode.removeChild(l):u.removeChild(l)):r.removeChild(a.stateNode)}else if(4===a.tag){if(null!==a.child){r=a.stateNode.containerInfo,i=!0,a.child.return=a,a=a.child;continue}}else if(cs(e,a,n),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(s=!1)}a.sibling.return=a.return,a=a.sibling}}function ms(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void ss(3,t);case 1:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,i=null!==e?e.memoizedProps:r;e=t.type;var a=t.updateQueue;if(t.updateQueue=null,null!==a){for(n[xn]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Ee(n,r),sn(e,i),t=sn(e,r),i=0;i<a.length;i+=2){var s=a[i],u=a[i+1];"style"===s?rn(n,u):"dangerouslySetInnerHTML"===s?Be(n,u):"children"===s?Ve(n,u):$(n,s,u,t)}switch(e){case"input":Pe(n,r);break;case"textarea":Le(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?xe(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?xe(n,!!r.multiple,r.defaultValue,!0):xe(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Nt(t.containerInfo)));case 12:return;case 13:if(n=t,null===t.memoizedState?r=!1:(r=!0,n=t.child,Hs=Wi()),null!==n)e:for(e=n;;){if(5===e.tag)a=e.stateNode,r?"function"===typeof(a=a.style).setProperty?a.setProperty("display","none","important"):a.display="none":(a=e.stateNode,i=void 0!==(i=e.memoizedProps.style)&&null!==i&&i.hasOwnProperty("display")?i.display:null,a.style.display=nn("display",i));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(a=e.child.sibling).return=e,e=a;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void ys(t);case 19:return void ys(t);case 17:return}throw Error(o(163))}function ys(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new rs),t.forEach((function(t){var r=Tu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}var _s="function"===typeof WeakMap?WeakMap:Map;function bs(e,t,n){(n=da(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){qs||(qs=!0,zs=r),is(e,t)},n}function ws(e,t,n){(n=da(n,null)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return is(e,t),r(i)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Gs?Gs=new Set([this]):Gs.add(this),is(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var ks,Ss=Math.ceil,Es=X.ReactCurrentDispatcher,Ps=X.ReactCurrentOwner,Is=16,Ds=32,Ts=0,xs=3,Cs=4,As=0,Ls=null,Os=null,Ms=0,Rs=Ts,Fs=null,Ns=1073741823,js=1073741823,Us=null,Bs=0,Vs=!1,Hs=0,Ws=null,qs=!1,zs=null,Gs=null,Ks=!1,Ys=null,Qs=90,Xs=null,$s=0,Js=null,Zs=0;function eu(){return 0!==(48&As)?1073741821-(Wi()/10|0):0!==Zs?Zs:Zs=1073741821-(Wi()/10|0)}function tu(e,t,n){if(0===(2&(t=t.mode)))return 1073741823;var r=qi();if(0===(4&t))return 99===r?1073741823:1073741822;if(0!==(As&Is))return Ms;if(null!==n)e=$i(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=$i(e,150,100);break;case 97:case 96:e=$i(e,5e3,250);break;case 95:e=2;break;default:throw Error(o(326))}return null!==Ls&&e===Ms&&--e,e}function nu(e,t){if(50<$s)throw $s=0,Js=null,Error(o(185));if(null!==(e=ru(e,t))){var n=qi();1073741823===t?0!==(8&As)&&0===(48&As)?su(e):(au(e),0===As&&Qi()):au(e),0===(4&As)||98!==n&&99!==n||(null===Xs?Xs=new Map([[e,t]]):(void 0===(n=Xs.get(e))||n>t)&&Xs.set(e,t))}}function ru(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return null!==i&&(Ls===i&&(pu(t),Rs===Cs&&Vu(i,Ms)),Hu(i,t)),i}function iu(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!Bu(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function au(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Yi(su.bind(null,e));else{var t=iu(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=eu();if(1073741823===t?r=99:1===t||2===t?r=95:r=0>=(r=10*(1073741821-t)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var i=e.callbackPriority;if(e.callbackExpirationTime===t&&i>=r)return;n!==Fi&&Di(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?Yi(su.bind(null,e)):Ki(r,ou.bind(null,e),{timeout:10*(1073741821-t)-Wi()}),e.callbackNode=t}}}function ou(e,t){if(Zs=0,t)return Wu(e,t=eu()),au(e),null;var n=iu(e);if(0!==n){if(t=e.callbackNode,0!==(48&As))throw Error(o(327));if(Su(),e===Ls&&n===Ms||cu(e,n),null!==Os){var r=As;As|=Is;for(var i=hu();;)try{vu();break}catch(u){du(e,u)}if(ra(),As=r,Es.current=i,1===Rs)throw t=Fs,cu(e,n),Vu(e,n),au(e),t;if(null===Os)switch(i=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=Rs,Ls=null,r){case Ts:case 1:throw Error(o(345));case 2:Wu(e,2<n?2:n);break;case xs:if(Vu(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=_u(i)),1073741823===Ns&&10<(i=Hs+500-Wi())){if(Vs){var a=e.lastPingedTime;if(0===a||a>=n){e.lastPingedTime=n,cu(e,n);break}}if(0!==(a=iu(e))&&a!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=Sn(bu.bind(null,e),i);break}bu(e);break;case Cs:if(Vu(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=_u(i)),Vs&&(0===(i=e.lastPingedTime)||i>=n)){e.lastPingedTime=n,cu(e,n);break}if(0!==(i=iu(e))&&i!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}if(1073741823!==js?r=10*(1073741821-js)-Wi():1073741823===Ns?r=0:(r=10*(1073741821-Ns)-5e3,0>(r=(i=Wi())-r)&&(r=0),(n=10*(1073741821-n)-i)<(r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ss(r/1960))-r)&&(r=n)),10<r){e.timeoutHandle=Sn(bu.bind(null,e),r);break}bu(e);break;case 5:if(1073741823!==Ns&&null!==Us){a=Ns;var s=Us;if(0>=(r=0|s.busyMinDurationMs)?r=0:(i=0|s.busyDelayMs,r=(a=Wi()-(10*(1073741821-a)-(0|s.timeoutMs||5e3)))<=i?0:i+r-a),10<r){Vu(e,n),e.timeoutHandle=Sn(bu.bind(null,e),r);break}}bu(e);break;default:throw Error(o(329))}if(au(e),e.callbackNode===t)return ou.bind(null,e)}}return null}function su(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,0!==(48&As))throw Error(o(327));if(Su(),e===Ls&&t===Ms||cu(e,t),null!==Os){var n=As;As|=Is;for(var r=hu();;)try{gu();break}catch(i){du(e,i)}if(ra(),As=n,Es.current=r,1===Rs)throw n=Fs,cu(e,t),Vu(e,t),au(e),n;if(null!==Os)throw Error(o(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Ls=null,bu(e),au(e)}return null}function uu(e,t){var n=As;As|=1;try{return e(t)}finally{0===(As=n)&&Qi()}}function lu(e,t){var n=As;As&=-2,As|=8;try{return e(t)}finally{0===(As=n)&&Qi()}}function cu(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,En(n)),null!==Os)for(n=Os.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&bi();break;case 3:Fa(),hi(vi),hi(gi);break;case 5:ja(r);break;case 4:Fa();break;case 13:case 19:hi(Ua);break;case 10:ia(r)}n=n.return}Ls=e,Os=Mu(e.current,null),Ms=t,Rs=Ts,Fs=null,js=Ns=1073741823,Us=null,Bs=0,Vs=!1}function du(e,t){for(;;){try{if(ra(),Ha.current=bo,Ya)for(var n=za.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}if(qa=0,Ka=Ga=za=null,Ya=!1,null===Os||null===Os.return)return Rs=1,Fs=t,Os=null;e:{var i=e,a=Os.return,o=Os,s=t;if(t=Ms,o.effectTag|=2048,o.firstEffect=o.lastEffect=null,null!==s&&"object"===typeof s&&"function"===typeof s.then){var u=s;if(0===(2&o.mode)){var l=o.alternate;l?(o.updateQueue=l.updateQueue,o.memoizedState=l.memoizedState,o.expirationTime=l.expirationTime):(o.updateQueue=null,o.memoizedState=null)}var c=0!==(1&Ua.current),d=a;do{var h;if(h=13===d.tag){var f=d.memoizedState;if(null!==f)h=null!==f.dehydrated;else{var p=d.memoizedProps;h=void 0!==p.fallback&&(!0!==p.unstable_avoidThisFallback||!c)}}if(h){var g=d.updateQueue;if(null===g){var v=new Set;v.add(u),d.updateQueue=v}else g.add(u);if(0===(2&d.mode)){if(d.effectTag|=64,o.effectTag&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var m=da(1073741823,null);m.tag=2,ha(o,m)}o.expirationTime=1073741823;break e}s=void 0,o=t;var y=i.pingCache;if(null===y?(y=i.pingCache=new _s,s=new Set,y.set(u,s)):void 0===(s=y.get(u))&&(s=new Set,y.set(u,s)),!s.has(o)){s.add(o);var _=Du.bind(null,i,u,o);u.then(_,_)}d.effectTag|=4096,d.expirationTime=t;break e}d=d.return}while(null!==d);s=Error((ve(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+me(o))}5!==Rs&&(Rs=2),s=ns(s,o),d=a;do{switch(d.tag){case 3:u=s,d.effectTag|=4096,d.expirationTime=t,fa(d,bs(d,u,t));break e;case 1:u=s;var b=d.type,w=d.stateNode;if(0===(64&d.effectTag)&&("function"===typeof b.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Gs||!Gs.has(w)))){d.effectTag|=4096,d.expirationTime=t,fa(d,ws(d,u,t));break e}}d=d.return}while(null!==d)}Os=yu(Os)}catch(k){t=k;continue}break}}function hu(){var e=Es.current;return Es.current=bo,null===e?bo:e}function fu(e,t){e<Ns&&2<e&&(Ns=e),null!==t&&e<js&&2<e&&(js=e,Us=t)}function pu(e){e>Bs&&(Bs=e)}function gu(){for(;null!==Os;)Os=mu(Os)}function vu(){for(;null!==Os&&!Ni();)Os=mu(Os)}function mu(e){var t=ks(e.alternate,e,Ms);return e.memoizedProps=e.pendingProps,null===t&&(t=yu(e)),Ps.current=null,t}function yu(e){Os=e;do{var t=Os.alternate;if(e=Os.return,0===(2048&Os.effectTag)){if(t=es(t,Os,Ms),1===Ms||1!==Os.childExpirationTime){for(var n=0,r=Os.child;null!==r;){var i=r.expirationTime,a=r.childExpirationTime;i>n&&(n=i),a>n&&(n=a),r=r.sibling}Os.childExpirationTime=n}if(null!==t)return t;null!==e&&0===(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Os.firstEffect),null!==Os.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Os.firstEffect),e.lastEffect=Os.lastEffect),1<Os.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Os:e.firstEffect=Os,e.lastEffect=Os))}else{if(null!==(t=ts(Os)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Os.sibling))return t;Os=e}while(null!==Os);return Rs===Ts&&(Rs=5),null}function _u(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function bu(e){var t=qi();return Gi(99,wu.bind(null,e,t)),null}function wu(e,t){do{Su()}while(null!==Ys);if(0!==(48&As))throw Error(o(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var i=_u(n);if(e.firstPendingTime=i,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Ls&&(Os=Ls=null,Ms=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){var a=As;As|=Ds,Ps.current=null,_n=Kt;var s=gn();if(vn(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else e:{var l=(u=(u=s.ownerDocument)&&u.defaultView||window).getSelection&&u.getSelection();if(l&&0!==l.rangeCount){u=l.anchorNode;var c=l.anchorOffset,d=l.focusNode;l=l.focusOffset;try{u.nodeType,d.nodeType}catch(I){u=null;break e}var h=0,f=-1,p=-1,g=0,v=0,m=s,y=null;t:for(;;){for(var _;m!==u||0!==c&&3!==m.nodeType||(f=h+c),m!==d||0!==l&&3!==m.nodeType||(p=h+l),3===m.nodeType&&(h+=m.nodeValue.length),null!==(_=m.firstChild);)y=m,m=_;for(;;){if(m===s)break t;if(y===u&&++g===c&&(f=h),y===d&&++v===l&&(p=h),null!==(_=m.nextSibling))break;y=(m=y).parentNode}m=_}u=-1===f||-1===p?null:{start:f,end:p}}else u=null}u=u||{start:0,end:0}}else u=null;bn={activeElementDetached:null,focusedElem:s,selectionRange:u},Kt=!1,Ws=i;do{try{ku()}catch(I){if(null===Ws)throw Error(o(330));Iu(Ws,I),Ws=Ws.nextEffect}}while(null!==Ws);Ws=i;do{try{for(s=e,u=t;null!==Ws;){var b=Ws.effectTag;if(16&b&&Ve(Ws.stateNode,""),128&b){var w=Ws.alternate;if(null!==w){var k=w.ref;null!==k&&("function"===typeof k?k(null):k.current=null)}}switch(1038&b){case 2:fs(Ws),Ws.effectTag&=-3;break;case 6:fs(Ws),Ws.effectTag&=-3,ms(Ws.alternate,Ws);break;case 1024:Ws.effectTag&=-1025;break;case 1028:Ws.effectTag&=-1025,ms(Ws.alternate,Ws);break;case 4:ms(Ws.alternate,Ws);break;case 8:vs(s,c=Ws,u),ds(c)}Ws=Ws.nextEffect}}catch(I){if(null===Ws)throw Error(o(330));Iu(Ws,I),Ws=Ws.nextEffect}}while(null!==Ws);if(k=bn,w=gn(),b=k.focusedElem,u=k.selectionRange,w!==b&&b&&b.ownerDocument&&pn(b.ownerDocument.documentElement,b)){null!==u&&vn(b)&&(w=u.start,void 0===(k=u.end)&&(k=w),"selectionStart"in b?(b.selectionStart=w,b.selectionEnd=Math.min(k,b.value.length)):(k=(w=b.ownerDocument||document)&&w.defaultView||window).getSelection&&(k=k.getSelection(),c=b.textContent.length,s=Math.min(u.start,c),u=void 0===u.end?s:Math.min(u.end,c),!k.extend&&s>u&&(c=u,u=s,s=c),c=fn(b,s),d=fn(b,u),c&&d&&(1!==k.rangeCount||k.anchorNode!==c.node||k.anchorOffset!==c.offset||k.focusNode!==d.node||k.focusOffset!==d.offset)&&((w=w.createRange()).setStart(c.node,c.offset),k.removeAllRanges(),s>u?(k.addRange(w),k.extend(d.node,d.offset)):(w.setEnd(d.node,d.offset),k.addRange(w))))),w=[];for(k=b;k=k.parentNode;)1===k.nodeType&&w.push({element:k,left:k.scrollLeft,top:k.scrollTop});for("function"===typeof b.focus&&b.focus(),b=0;b<w.length;b++)(k=w[b]).element.scrollLeft=k.left,k.element.scrollTop=k.top}Kt=!!_n,bn=_n=null,e.current=n,Ws=i;do{try{for(b=e;null!==Ws;){var S=Ws.effectTag;if(36&S&&ls(b,Ws.alternate,Ws),128&S){w=void 0;var E=Ws.ref;if(null!==E){var P=Ws.stateNode;switch(Ws.tag){case 5:w=P;break;default:w=P}"function"===typeof E?E(w):E.current=w}}Ws=Ws.nextEffect}}catch(I){if(null===Ws)throw Error(o(330));Iu(Ws,I),Ws=Ws.nextEffect}}while(null!==Ws);Ws=null,ji(),As=a}else e.current=n;if(Ks)Ks=!1,Ys=e,Qs=t;else for(Ws=i;null!==Ws;)t=Ws.nextEffect,Ws.nextEffect=null,Ws=t;if(0===(t=e.firstPendingTime)&&(Gs=null),1073741823===t?e===Js?$s++:($s=0,Js=e):$s=0,"function"===typeof xu&&xu(n.stateNode,r),au(e),qs)throw qs=!1,e=zs,zs=null,e;return 0!==(8&As)||Qi(),null}function ku(){for(;null!==Ws;){var e=Ws.effectTag;0!==(256&e)&&os(Ws.alternate,Ws),0===(512&e)||Ks||(Ks=!0,Ki(97,(function(){return Su(),null}))),Ws=Ws.nextEffect}}function Su(){if(90!==Qs){var e=97<Qs?97:Qs;return Qs=90,Gi(e,Eu)}}function Eu(){if(null===Ys)return!1;var e=Ys;if(Ys=null,0!==(48&As))throw Error(o(331));var t=As;for(As|=Ds,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!==(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:ss(5,n),us(5,n)}}catch(r){if(null===e)throw Error(o(330));Iu(e,r)}n=e.nextEffect,e.nextEffect=null,e=n}return As=t,Qi(),!0}function Pu(e,t,n){ha(e,t=bs(e,t=ns(n,t),1073741823)),null!==(e=ru(e,1073741823))&&au(e)}function Iu(e,t){if(3===e.tag)Pu(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Pu(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Gs||!Gs.has(r))){ha(n,e=ws(n,e=ns(t,e),1073741823)),null!==(n=ru(n,1073741823))&&au(n);break}}n=n.return}}function Du(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),Ls===e&&Ms===n?Rs===Cs||Rs===xs&&1073741823===Ns&&Wi()-Hs<500?cu(e,Ms):Vs=!0:Bu(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,au(e)))}function Tu(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(t=tu(t=eu(),e,null)),null!==(e=ru(e,t))&&au(e)}ks=function(e,t,n){var r=t.expirationTime;if(null!==e){var i=t.pendingProps;if(e.memoizedProps!==i||vi.current)Mo=!0;else{if(r<n){switch(Mo=!1,t.tag){case 3:Wo(t),Lo();break;case 5:if(Na(t),4&t.mode&&1!==n&&i.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:_i(t.type)&&Si(t);break;case 4:Ra(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value,i=t.type._context,fi(Zi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?Yo(e,t,n):(fi(Ua,1&Ua.current),null!==(t=Jo(e,t,n))?t.sibling:null);fi(Ua,1&Ua.current);break;case 19:if(r=t.childExpirationTime>=n,0!==(64&e.effectTag)){if(r)return $o(e,t,n);t.effectTag|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null),fi(Ua,Ua.current),!r)return null}return Jo(e,t,n)}Mo=!1}}else Mo=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,i=yi(t,gi.current),oa(t,n),i=$a(null,t,r,e,i,n),t.effectTag|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,_i(r)){var a=!0;Si(t)}else a=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,la(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&ya(t,r,s,e),i.updater=_a,t.stateNode=i,i._reactInternalFiber=t,Sa(t,r,e,n),t=Ho(null,t,r,!0,a,n)}else t.tag=0,Ro(null,t,i,n),t=t.child;return t;case 16:e:{if(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(i),1!==i._status)throw i._result;switch(i=i._result,t.type=i,a=t.tag=function(e){if("function"===typeof e)return Ou(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===ue)return 11;if(e===de)return 14}return 2}(i),e=Ji(i,e),a){case 0:t=Bo(null,t,i,e,n);break e;case 1:t=Vo(null,t,i,e,n);break e;case 11:t=Fo(null,t,i,e,n);break e;case 14:t=No(null,t,i,Ji(i.type,e),r,n);break e}throw Error(o(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Bo(e,t,r,i=t.elementType===r?i:Ji(r,i),n);case 1:return r=t.type,i=t.pendingProps,Vo(e,t,r,i=t.elementType===r?i:Ji(r,i),n);case 3:if(Wo(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,ca(e,t),pa(t,r,null,n),(r=t.memoizedState.element)===i)Lo(),t=Jo(e,t,n);else{if((i=t.stateNode.hydrate)&&(Po=Pn(t.stateNode.containerInfo.firstChild),Eo=t,i=Io=!0),i)for(n=xa(t,null,r,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else Ro(e,t,r,n),Lo();t=t.child}return t;case 5:return Na(t),null===e&&xo(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,kn(r,i)?s=null:null!==a&&kn(r,a)&&(t.effectTag|=16),Uo(e,t),4&t.mode&&1!==n&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Ro(e,t,s,n),t=t.child),t;case 6:return null===e&&xo(t),null;case 13:return Yo(e,t,n);case 4:return Ra(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ta(t,null,r,n):Ro(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Fo(e,t,r,i=t.elementType===r?i:Ji(r,i),n);case 7:return Ro(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ro(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value;var u=t.type._context;if(fi(Zi,u._currentValue),u._currentValue=a,null!==s)if(u=s.value,0===(a=Vr(u,a)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(u,a):1073741823))){if(s.children===i.children&&!vi.current){t=Jo(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var l=u.dependencies;if(null!==l){s=u.child;for(var c=l.firstContext;null!==c;){if(c.context===r&&0!==(c.observedBits&a)){1===u.tag&&((c=da(n,null)).tag=2,ha(u,c)),u.expirationTime<n&&(u.expirationTime=n),null!==(c=u.alternate)&&c.expirationTime<n&&(c.expirationTime=n),aa(u.return,n),l.expirationTime<n&&(l.expirationTime=n);break}c=c.next}}else s=10===u.tag&&u.type===t.type?null:u.child;if(null!==s)s.return=u;else for(s=u;null!==s;){if(s===t){s=null;break}if(null!==(u=s.sibling)){u.return=s.return,s=u;break}s=s.return}u=s}Ro(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(a=t.pendingProps).children,oa(t,n),r=r(i=sa(i,a.unstable_observedBits)),t.effectTag|=1,Ro(e,t,r,n),t.child;case 14:return a=Ji(i=t.type,t.pendingProps),No(e,t,i,a=Ji(i.type,a),r,n);case 15:return jo(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Ji(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,_i(r)?(e=!0,Si(t)):e=!1,oa(t,n),wa(t,r,i),Sa(t,r,i,n),Ho(null,t,r,!0,e,n);case 19:return $o(e,t,n)}throw Error(o(156,t.tag))};var xu=null,Cu=null;function Au(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Lu(e,t,n,r){return new Au(e,t,n,r)}function Ou(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mu(e,t){var n=e.alternate;return null===n?((n=Lu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ru(e,t,n,r,i,a){var s=2;if(r=e,"function"===typeof e)Ou(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case ne:return Fu(n.children,i,a,t);case se:s=8,i|=7;break;case re:s=8,i|=1;break;case ie:return(e=Lu(12,n,t,8|i)).elementType=ie,e.type=ie,e.expirationTime=a,e;case le:return(e=Lu(13,n,t,i)).type=le,e.elementType=le,e.expirationTime=a,e;case ce:return(e=Lu(19,n,t,i)).elementType=ce,e.expirationTime=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case ae:s=10;break e;case oe:s=9;break e;case ue:s=11;break e;case de:s=14;break e;case he:s=16,r=null;break e;case fe:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Lu(s,n,t,i)).elementType=e,t.type=r,t.expirationTime=a,t}function Fu(e,t,n,r){return(e=Lu(7,e,r,t)).expirationTime=n,e}function Nu(e,t,n){return(e=Lu(6,e,null,t)).expirationTime=n,e}function ju(e,t,n){return(t=Lu(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uu(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Bu(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function Vu(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Hu(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Wu(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function qu(e,t,n,r){var i=t.current,a=eu(),s=va.suspense;a=tu(a,i,s);e:if(n){t:{if(et(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(o(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(_i(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);throw Error(o(171))}if(1===n.tag){var l=n.type;if(_i(l)){n=ki(n,l,u);break e}}n=u}else n=pi;return null===t.context?t.context=n:t.pendingContext=n,(t=da(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),ha(i,t),nu(i,a),a}function zu(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Gu(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function Ku(e,t){Gu(e,t),(e=e.alternate)&&Gu(e,t)}function Yu(e,t,n){var r=new Uu(e,t,n=null!=n&&!0===n.hydrate),i=Lu(3,null,null,2===t?7:1===t?3:0);r.current=i,i.stateNode=r,la(i),e[Cn]=r.current,n&&0!==t&&function(e,t){var n=Ze(t);Dt.forEach((function(e){gt(e,t,n)})),Tt.forEach((function(e){gt(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=r}function Qu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xu(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a._internalRoot;if("function"===typeof i){var s=i;i=function(){var e=zu(o);s.call(e)}}qu(t,o,e,i)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Yu(e,0,t?{hydrate:!0}:void 0)}(n,r),o=a._internalRoot,"function"===typeof i){var u=i;i=function(){var e=zu(o);u.call(e)}}lu((function(){qu(t,o,e,i)}))}return zu(o)}function $u(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:te,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Ju(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qu(t))throw Error(o(200));return $u(e,t,null,n)}Yu.prototype.render=function(e){qu(e,this._internalRoot,null,null)},Yu.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;qu(null,e,null,(function(){t[Cn]=null}))},vt=function(e){if(13===e.tag){var t=$i(eu(),150,100);nu(e,t),Ku(e,t)}},mt=function(e){13===e.tag&&(nu(e,3),Ku(e,3))},yt=function(e){if(13===e.tag){var t=eu();nu(e,t=tu(t,e,null)),Ku(e,t)}},T=function(e,t,n){switch(t){case"input":if(Pe(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Mn(r);if(!i)throw Error(o(90));we(r),Pe(r,i)}}}break;case"textarea":Le(e,n);break;case"select":null!=(t=n.value)&&xe(e,!!n.multiple,t,!1)}},M=uu,R=function(e,t,n,r,i){var a=As;As|=4;try{return Gi(98,e.bind(null,t,n,r,i))}finally{0===(As=a)&&Qi()}},F=function(){0===(49&As)&&(function(){if(null!==Xs){var e=Xs;Xs=null,e.forEach((function(e,t){Wu(t,e),au(t)})),Qi()}}(),Su())},N=function(e,t){var n=As;As|=2;try{return e(t)}finally{0===(As=n)&&Qi()}};var Zu={Events:[Ln,On,Mn,I,S,Vn,function(e){at(e,Bn)},L,O,Jt,ut,Su,{current:!1}]};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);xu=function(e){try{t.onCommitFiberRoot(n,e,void 0,64===(64&e.current.effectTag))}catch(r){}},Cu=function(e){try{t.onCommitFiberUnmount(n,e)}catch(r){}}}catch(r){}})(i({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:X.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=rt(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:An,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"}),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zu,t.createPortal=Ju,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=rt(t))?null:e.stateNode},t.flushSync=function(e,t){if(0!==(48&As))throw Error(o(187));var n=As;As|=1;try{return Gi(99,e.bind(null,t))}finally{As=n,Qi()}},t.hydrate=function(e,t,n){if(!Qu(t))throw Error(o(200));return Xu(null,e,t,!0,n)},t.render=function(e,t,n){if(!Qu(t))throw Error(o(200));return Xu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qu(e))throw Error(o(40));return!!e._reactRootContainer&&(lu((function(){Xu(null,null,e,!1,(function(){e._reactRootContainer=null,e[Cn]=null}))})),!0)},t.unstable_batchedUpdates=uu,t.unstable_createPortal=function(e,t){return Ju(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Qu(n))throw Error(o(200));if(null==e||void 0===e._reactInternalFiber)throw Error(o(38));return Xu(e,t,n,!1,r)},t.version="16.13.1"},function(e,t,n){"use strict";e.exports=n(119)},function(e,t,n){"use strict";var r,i,a,o,s;if("undefined"===typeof window||"function"!==typeof MessageChannel){var u=null,l=null,c=function(){if(null!==u)try{var e=t.unstable_now();u(!0,e),u=null}catch(n){throw setTimeout(c,0),n}},d=Date.now();t.unstable_now=function(){return Date.now()-d},r=function(e){null!==u?setTimeout(r,0,e):(u=e,setTimeout(c,0))},i=function(e,t){l=setTimeout(e,t)},a=function(){clearTimeout(l)},o=function(){return!1},s=t.unstable_forceFrameRate=function(){}}else{var h=window.performance,f=window.Date,p=window.setTimeout,g=window.clearTimeout;if("undefined"!==typeof console){var v=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof v&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"===typeof h&&"function"===typeof h.now)t.unstable_now=function(){return h.now()};else{var m=f.now();t.unstable_now=function(){return f.now()-m}}var y=!1,_=null,b=-1,w=5,k=0;o=function(){return t.unstable_now()>=k},s=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):w=0<e?Math.floor(1e3/e):5};var S=new MessageChannel,E=S.port2;S.port1.onmessage=function(){if(null!==_){var e=t.unstable_now();k=e+w;try{_(!0,e)?E.postMessage(null):(y=!1,_=null)}catch(n){throw E.postMessage(null),n}}else y=!1},r=function(e){_=e,y||(y=!0,E.postMessage(null))},i=function(e,n){b=p((function(){e(t.unstable_now())}),n)},a=function(){g(b),b=-1}}function P(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<T(i,t)))break e;e[r]=t,e[n]=i,n=r}}function I(e){return void 0===(e=e[0])?null:e}function D(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var a=2*(r+1)-1,o=e[a],s=a+1,u=e[s];if(void 0!==o&&0>T(o,n))void 0!==u&&0>T(u,o)?(e[r]=u,e[s]=n,r=s):(e[r]=o,e[a]=n,r=a);else{if(!(void 0!==u&&0>T(u,n)))break e;e[r]=u,e[s]=n,r=s}}}return t}return null}function T(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var x=[],C=[],A=1,L=null,O=3,M=!1,R=!1,F=!1;function N(e){for(var t=I(C);null!==t;){if(null===t.callback)D(C);else{if(!(t.startTime<=e))break;D(C),t.sortIndex=t.expirationTime,P(x,t)}t=I(C)}}function j(e){if(F=!1,N(e),!R)if(null!==I(x))R=!0,r(U);else{var t=I(C);null!==t&&i(j,t.startTime-e)}}function U(e,n){R=!1,F&&(F=!1,a()),M=!0;var r=O;try{for(N(n),L=I(x);null!==L&&(!(L.expirationTime>n)||e&&!o());){var s=L.callback;if(null!==s){L.callback=null,O=L.priorityLevel;var u=s(L.expirationTime<=n);n=t.unstable_now(),"function"===typeof u?L.callback=u:L===I(x)&&D(x),N(n)}else D(x);L=I(x)}if(null!==L)var l=!0;else{var c=I(C);null!==c&&i(j,c.startTime-n),l=!1}return l}finally{L=null,O=r,M=!1}}function B(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var V=s;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){R||M||(R=!0,r(U))},t.unstable_getCurrentPriorityLevel=function(){return O},t.unstable_getFirstCallbackNode=function(){return I(x)},t.unstable_next=function(e){switch(O){case 1:case 2:case 3:var t=3;break;default:t=O}var n=O;O=t;try{return e()}finally{O=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=V,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=O;O=e;try{return t()}finally{O=n}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();if("object"===typeof o&&null!==o){var u=o.delay;u="number"===typeof u&&0<u?s+u:s,o="number"===typeof o.timeout?o.timeout:B(e)}else o=B(e),u=s;return e={id:A++,callback:n,priorityLevel:e,startTime:u,expirationTime:o=u+o,sortIndex:-1},u>s?(e.sortIndex=u,P(C,e),null===I(x)&&e===I(C)&&(F?a():F=!0,i(j,u-s))):(e.sortIndex=o,P(x,e),R||M||(R=!0,r(U))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();N(e);var n=I(x);return n!==L&&null!==L&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<L.expirationTime||o()},t.unstable_wrapCallback=function(e){var t=O;return function(){var n=O;O=t;try{return e.apply(this,arguments)}finally{O=n}}}},function(e,t,n){"use strict";var r=n(102),i=n(106).parse;e.exports=function(e){var t=i(e),n="";return t.forEach((function(e){n+=r(e)?e+" ":e})),n}},function(e,t,n){"use strict";(function(e){var r=n(122),i=n(123),a=n(124);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return l(this,e,t,n)}function l(e,t,n,r){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=h(e,t);return e}(e,t,n,r):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(r=t.length)!==r?s(e,0):h(e,t);if("Buffer"===t.type&&a(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(c(t),e=s(e,t<0?0:0|f(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(e).length;default:if(r)return V(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return T(this,t,n);case"latin1":case"binary":return x(this,t,n);case"base64":return P(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"===typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=n;a<s;a++)if(l(e,a)===l(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===u)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var d=!0,h=0;h<u;h++)if(l(e,a+h)!==l(t,h)){d=!1;break}if(d)return a}return-1}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!==0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,r){return W(V(t,e.length-n),e,n,r)}function w(e,t,n,r){return W(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function k(e,t,n,r){return w(e,t,n,r)}function S(e,t,n,r){return W(H(t),e,n,r)}function E(e,t,n,r){return W(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function P(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,l=e[i],c=null,d=l>239?4:l>223?3:l>191?2:1;if(i+d<=n)switch(d){case 1:l<128&&(c=l);break;case 2:128===(192&(a=e[i+1]))&&(u=(31&l)<<6|63&a)>127&&(c=u);break;case 3:a=e[i+1],o=e[i+2],128===(192&a)&&128===(192&o)&&(u=(15&l)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&(u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,d=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=d}return function(e){var t=e.length;if(t<=D)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=D));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return l(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return c(t),t<=0?s(e,t):void 0!==n?"string"===typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return d(null,e)},u.allocUnsafeSlow=function(e){return d(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):g.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),l=this.slice(r,i),c=e.slice(t,n),d=0;d<s;++d)if(l[d]!==c[d]){a=l[d],o=c[d];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return k(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var D=4096;function T(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function x(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function C(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=B(e[a]);return i}function A(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function L(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function R(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function F(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,r,a){return a||F(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,a){return a||F(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):R(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):R(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):R(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):R(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},u.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:V(new u(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function H(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function W(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(89))},function(e,t,n){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=l(e),o=r[0],s=r[1],u=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),c=0,d=s>0?o-4:o;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[c++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=16383,s=0,u=n-i;s<u;s+=o)a.push(c(e,s,s+o>u?u:s+o));1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return a.join("")};for(var r=[],i=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=h,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[t+d],d+=h,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=l}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,l=8*a-i-1,c=(1<<l)-1,d=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+d>=1?h/u:h*Math.pow(2,1-d))*u>=2&&(o++,u/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(t*u-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[n+f]=255&o,f+=p,o/=256,l-=8);e[n+f-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,n,i){!function(){var e=Date,t=Date.CultureStrings?Date.CultureStrings.lang:null,n={},r={getFromKey:function(e,t){var n;return n=Date.CultureStrings&&Date.CultureStrings[t]&&Date.CultureStrings[t][e]?Date.CultureStrings[t][e]:r.buildFromDefault(e),"/"===e.charAt(0)&&(n=r.buildFromRegex(e,t)),n},getFromObjectValues:function(e,t){var n,i={};for(n in e)e.hasOwnProperty(n)&&(i[n]=r.getFromKey(e[n],t));return i},getFromObjectKeys:function(e,t){var n,i={};for(n in e)e.hasOwnProperty(n)&&(i[r.getFromKey(n,t)]=e[n]);return i},getFromArray:function(e,t){for(var n=[],i=0;i<e.length;i++)i in e&&(n[i]=r.getFromKey(e[i],t));return n},buildFromDefault:function(e){var t,n,r,i;switch(e){case"name":t="en-US";break;case"englishName":case"nativeName":t="English (United States)";break;case"twoDigitYearMax":t=2049;break;case"firstDayOfWeek":t=0;break;default:t=e,(n=(r=e.split("_")).length)>1&&"/"!==e.charAt(0)&&("initial"!==(i=r[n-1].toLowerCase())&&"abbr"!==i||(t=r[0]))}return t},buildFromRegex:function(e,t){return Date.CultureStrings&&Date.CultureStrings[t]&&Date.CultureStrings[t][e]?new RegExp(Date.CultureStrings[t][e],"i"):new RegExp(e.replace(new RegExp("/","g"),""),"i")}},i=function(e,i){var a=i||t;return n[e]=e,"object"===typeof e?e instanceof Array?r.getFromArray(e,a):r.getFromObjectKeys(e,a):r.getFromKey(e,a)},a={buildFromMethodHash:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(e[t]=a[e[t]]());return e},timeZoneDST:function(){return i({CHADT:"+1345",NZDT:"+1300",AEDT:"+1100",ACDT:"+1030",AZST:"+0500",IRDT:"+0430",EEST:"+0300",CEST:"+0200",BST:"+0100",PMDT:"-0200",ADT:"-0300",NDT:"-0230",EDT:"-0400",CDT:"-0500",MDT:"-0600",PDT:"-0700",AKDT:"-0800",HADT:"-0900"})},timeZoneStandard:function(){return i({LINT:"+1400",TOT:"+1300",CHAST:"+1245",NZST:"+1200",NFT:"+1130",SBT:"+1100",AEST:"+1000",ACST:"+0930",JST:"+0900",CWST:"+0845",CT:"+0800",ICT:"+0700",MMT:"+0630",BST:"+0600",NPT:"+0545",IST:"+0530",PKT:"+0500",AFT:"+0430",MSK:"+0400",IRST:"+0330",FET:"+0300",EET:"+0200",CET:"+0100",GMT:"+0000",UTC:"+0000",CVT:"-0100",GST:"-0200",BRT:"-0300",NST:"-0330",AST:"-0400",EST:"-0500",CST:"-0600",MST:"-0700",PST:"-0800",AKST:"-0900",MIT:"-0930",HST:"-1000",SST:"-1100",BIT:"-1200"})},timeZones:function(e){var t;for(t in e.timezones=[],e.abbreviatedTimeZoneStandard)e.abbreviatedTimeZoneStandard.hasOwnProperty(t)&&e.timezones.push({name:t,offset:e.abbreviatedTimeZoneStandard[t]});for(t in e.abbreviatedTimeZoneDST)e.abbreviatedTimeZoneDST.hasOwnProperty(t)&&e.timezones.push({name:t,offset:e.abbreviatedTimeZoneDST[t],dst:!0});return e.timezones},days:function(){return i(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"])},dayAbbr:function(){return i(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"])},dayShortNames:function(){return i(["Su","Mo","Tu","We","Th","Fr","Sa"])},dayFirstLetters:function(){return i(["S_Sun_Initial","M_Mon_Initial","T_Tues_Initial","W_Wed_Initial","T_Thu_Initial","F_Fri_Initial","S_Sat_Initial"])},months:function(){return i(["January","February","March","April","May","June","July","August","September","October","November","December"])},monthAbbr:function(){return i(["Jan_Abbr","Feb_Abbr","Mar_Abbr","Apr_Abbr","May_Abbr","Jun_Abbr","Jul_Abbr","Aug_Abbr","Sep_Abbr","Oct_Abbr","Nov_Abbr","Dec_Abbr"])},formatPatterns:function(){return r.getFromObjectValues({shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss",monthDay:"MMMM dd",monthDayShortTime:"MM/dd",monthDayYear:"MM/dd/yy",yearMonth:"MMMM, yyyy"},Date.i18n.currentLanguage())},regex:function(){return r.getFromObjectValues({thisMorning:"/(this )(morn(ing)?)\\b/",thisEvening:"/(this )(even(ing)?)\\b/",jan:"/jan(uary)?/",feb:"/feb(ruary)?/",mar:"/mar(ch)?/",apr:"/apr(il)?/",may:"/may/",jun:"/jun(e)?/",jul:"/jul(y)?/",aug:"/aug(ust)?/",sep:"/sep(t(ember)?)?/",oct:"/oct(ober)?/",nov:"/nov(ember)?/",dec:"/dec(ember)?/",sun:"/^sun(day)?/",mon:"/^mon(day)?/",tue:"/^tue(s(day)?)?/",wed:"/^wed(nesday)?/",thu:"/^thu(rsday)?/",fri:"/^fri(day)?/",sat:"/^sat(urday)?/",future:"/^next/",past:"/^last|past|prev(ious)?/",yesterday:"/^yesterday/",today:"/^today/",tomorrow:"/^tom(orrow)?/",soon:"/^soon/",later:"/^later/",someday:"/^someday/",now:"/^now/",shortMeridian:"/^(a|p)/",longMeridian:"/^(a\\.?m?\\.?|p\\.?m?\\.?)/",timezone:"/^((e(s|d)t|c(e?s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\\s*(\\+|\\-)\\s*\\d\\d\\d\\d?)|gmt|utc)/",ordinalSuffix:"/^\\s*(st|nd|rd|th)/",timeContext:"/^\\s*(\\:|a(?!u|p)|p)/"},Date.i18n.currentLanguage())}},o=function(){var e=r.getFromObjectValues({name:"name",englishName:"englishName",nativeName:"nativeName",amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:"firstDayOfWeek",twoDigitYearMax:"twoDigitYearMax",dateElementOrder:"mdy"},Date.i18n.currentLanguage());return function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(e,a.buildFromMethodHash({dayNames:"days",abbreviatedDayNames:"dayAbbr",shortestDayNames:"dayShortNames",firstLetterDayNames:"dayFirstLetters",monthNames:"months",abbreviatedMonthNames:"monthAbbr",formatPatterns:"formatPatterns",regexPatterns:"regex",abbreviatedTimeZoneDST:"timeZoneDST",abbreviatedTimeZoneStandard:"timeZoneStandard"})),a.timeZones(e),e};e.i18n={__:function(e,t){return i(e,t)},currentLanguage:function(){return t||"en-US"},setLanguage:function(n,r,i){if(r||"en-US"===n||Date.CultureStrings&&Date.CultureStrings[n])t=n,Date.CultureStrings=Date.CultureStrings||{},Date.CultureStrings.lang=n,Date.CultureInfo=new o;else if(!Date.CultureStrings||!Date.CultureStrings[n])return!1;e.Parsing.Normalizer.buildReplaceData(),e.Grammar&&e.Grammar.buildGrammarFormats(),i&&i()},getLoggedKeys:function(){return n},updateCultureInfo:function(){Date.CultureInfo=new o}},e.i18n.updateCultureInfo()}(),function(){var e=Date,t=e.prototype,n=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};"undefined"!==typeof window&&"undefined"!==typeof window.console&&"undefined"!==typeof window.console.log?e.console=console:e.console={log:function(){},error:function(){}},e.Config=e.Config||{},e.initOverloads=function(){e.now?e._now||(e._now=e.now):e._now=function(){return(new Date).getTime()},e.now=function(t){return t?e.present():e._now()},t.toISOString||(t.toISOString=function(){return this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}),void 0===t._toString&&(t._toString=t.toString)},e.initOverloads(),e.today=function(){return(new Date).clearTime()},e.present=function(){return new Date},e.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return e<t?-1:e>t?1:0;throw new TypeError(e+" - "+t)},e.equals=function(e,t){return 0===e.compareTo(t)},e.getDayName=function(e){return Date.CultureInfo.dayNames[e]},e.getDayNumberFromName=function(e){for(var t=Date.CultureInfo.dayNames,n=Date.CultureInfo.abbreviatedDayNames,r=Date.CultureInfo.shortestDayNames,i=e.toLowerCase(),a=0;a<t.length;a++)if(t[a].toLowerCase()===i||n[a].toLowerCase()===i||r[a].toLowerCase()===i)return a;return-1},e.getMonthNumberFromName=function(e){for(var t=Date.CultureInfo.monthNames,n=Date.CultureInfo.abbreviatedMonthNames,r=e.toLowerCase(),i=0;i<t.length;i++)if(t[i].toLowerCase()===r||n[i].toLowerCase()===r)return i;return-1},e.getMonthName=function(e){return Date.CultureInfo.monthNames[e]},e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},e.getDaysInMonth=function(t,n){return!n&&e.validateMonth(t)&&(n=t,t=Date.today().getFullYear()),[31,e.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][n]},t.getDaysInMonth=function(){return e.getDaysInMonth(this.getFullYear(),this.getMonth())},e.getTimezoneAbbreviation=function(e,t){var n,r=t?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(n in r)if(r.hasOwnProperty(n)&&r[n]===e)return n;return null},e.getTimezoneOffset=function(e,t){var n,r=[],i=Date.CultureInfo.timezones;for(e||(e=(new Date).getTimezone()),n=0;n<i.length;n++)i[n].name===e.toUpperCase()&&r.push(n);if(!i[r[0]])return null;if(1===r.length||!t)return i[r[0]].offset;for(n=0;n<r.length;n++)if(i[r[n]].dst)return i[r[n]].offset},e.getQuarter=function(e){e=e||new Date;return[1,2,3,4][Math.floor(e.getMonth()/3)]},e.getDaysLeftInQuarter=function(e){e=e||new Date;var t=new Date(e);return t.setMonth(t.getMonth()+3-t.getMonth()%3,0),Math.floor((t-e)/864e5)},t.ensureTimeOfDay=function(){0===this.getMilliseconds()&&this.setTime(this.getTime()+1)};var r=function(e,t,n,r){if(r=r||"Object","undefined"===typeof e)return!1;if("number"!==typeof e)throw new TypeError(e+" is not a Number.");return!(e<t||e>n)};e.validateMillisecond=function(e){return r(e,0,999,"millisecond")},e.validateSecond=function(e){return r(e,0,59,"second")},e.validateMinute=function(e){return r(e,0,59,"minute")},e.validateHour=function(e){return r(e,0,23,"hour")},e.validateDay=function(t,n,i){return void 0!==n&&null!==n&&void 0!==i&&null!==i&&r(t,1,e.getDaysInMonth(n,i),"day")},e.validateWeek=function(e){return r(e,0,53,"week")},e.validateMonth=function(e){return r(e,0,11,"month")},e.validateYear=function(e){return r(e,-271822,275760,"year")},e.validateTimezone=function(e){return 1==={ACDT:1,ACST:1,ACT:1,ADT:1,AEDT:1,AEST:1,AFT:1,AKDT:1,AKST:1,AMST:1,AMT:1,ART:1,AST:1,AWDT:1,AWST:1,AZOST:1,AZT:1,BDT:1,BIOT:1,BIT:1,BOT:1,BRT:1,BST:1,BTT:1,CAT:1,CCT:1,CDT:1,CEDT:1,CEST:1,CET:1,CHADT:1,CHAST:1,CHOT:1,ChST:1,CHUT:1,CIST:1,CIT:1,CKT:1,CLST:1,CLT:1,COST:1,COT:1,CST:1,CT:1,CVT:1,CWST:1,CXT:1,DAVT:1,DDUT:1,DFT:1,EASST:1,EAST:1,EAT:1,ECT:1,EDT:1,EEDT:1,EEST:1,EET:1,EGST:1,EGT:1,EIT:1,EST:1,FET:1,FJT:1,FKST:1,FKT:1,FNT:1,GALT:1,GAMT:1,GET:1,GFT:1,GILT:1,GIT:1,GMT:1,GST:1,GYT:1,HADT:1,HAEC:1,HAST:1,HKT:1,HMT:1,HOVT:1,HST:1,ICT:1,IDT:1,IOT:1,IRDT:1,IRKT:1,IRST:1,IST:1,JST:1,KGT:1,KOST:1,KRAT:1,KST:1,LHST:1,LINT:1,MAGT:1,MART:1,MAWT:1,MDT:1,MET:1,MEST:1,MHT:1,MIST:1,MIT:1,MMT:1,MSK:1,MST:1,MUT:1,MVT:1,MYT:1,NCT:1,NDT:1,NFT:1,NPT:1,NST:1,NT:1,NUT:1,NZDT:1,NZST:1,OMST:1,ORAT:1,PDT:1,PET:1,PETT:1,PGT:1,PHOT:1,PHT:1,PKT:1,PMDT:1,PMST:1,PONT:1,PST:1,PYST:1,PYT:1,RET:1,ROTT:1,SAKT:1,SAMT:1,SAST:1,SBT:1,SCT:1,SGT:1,SLST:1,SRT:1,SST:1,SYOT:1,TAHT:1,THA:1,TFT:1,TJT:1,TKT:1,TLT:1,TMT:1,TOT:1,TVT:1,UCT:1,ULAT:1,UTC:1,UYST:1,UYT:1,UZT:1,VET:1,VLAT:1,VOLT:1,VOST:1,VUT:1,WAKT:1,WAST:1,WAT:1,WEDT:1,WEST:1,WET:1,WST:1,YAKT:1,YEKT:1,Z:1}[e]},e.validateTimezoneOffset=function(e){return e>-841&&e<721},e.validateSetExplicitTime=function(e){return!0}}(),function(){var e=Date,t=e.prototype,n=function(e,t){return t||(t=2),("000"+e).slice(-1*t)},r=function(t){var n,r,i={},a=this;for(n in r=function(n,r,i){if("day"===n){var o=void 0!==t.month?t.month:a.getMonth(),s=void 0!==t.year?t.year:a.getFullYear();return e[r](i,s,o)}return e[r](i)},t)if(hasOwnProperty.call(t,n)){var o="validate"+n.charAt(0).toUpperCase()+n.slice(1);e[o]&&null!==t[n]&&r(n,o,t[n])&&(i[n]=t[n])}return i};t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},t.clone=function(){return new Date(this.getTime())},t.compareTo=function(e){return Date.compare(this,e)},t.equals=function(e){if(!e)return!1;var t=this.clone(),n=e.clone();return t.setMilliseconds(0),n.setMilliseconds(0),Date.equals(t,n)},t.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},t.isAfter=function(e){return 1===this.compareTo(e||new Date)},t.isBefore=function(e){return-1===this.compareTo(e||new Date)},t.isToday=t.isSameDay=function(e){return this.clone().clearTime().equals((e||new Date).clone().clearTime())},t.addMilliseconds=function(e){return e?(this.setTime(this.getTime()+1*e),this):this},t.addSeconds=function(e){return e?this.addMilliseconds(1e3*e):this},t.addMinutes=function(e){return e?this.addMilliseconds(6e4*e):this},t.addHours=function(e){return e?this.addMilliseconds(36e5*e):this},t.addDays=function(e){return e?(this.setDate(this.getDate()+1*e),this):this},t.addWeekdays=function(e){if(!e)return this;var t=this.getDay(),n=Math.ceil(Math.abs(e)/7);if(0!==t&&6!==t||e>0&&(this.next().monday(),this.addDays(-1),t=this.getDay()),e<0){for(;e<0;)this.addDays(-1),0!==(t=this.getDay())&&6!==t&&e++;return this}return(e>5||6-t<=e)&&(e+=2*n),this.addDays(e)},t.addWeeks=function(e){return e?this.addDays(7*e):this},t.addMonths=function(t){if(!t)return this;var n=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+1*t),this.setDate(Math.min(n,e.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addQuarters=function(e){return e?this.addMonths(3*e):this},t.addYears=function(e){return e?this.addMonths(12*e):this},t.add=function(e){if("number"===typeof e)return this._orient=e,this;var t=e;return t.day&&t.day-this.getDate()!==0&&this.setDate(t.day),t.milliseconds&&this.addMilliseconds(t.milliseconds),t.seconds&&this.addSeconds(t.seconds),t.minutes&&this.addMinutes(t.minutes),t.hours&&this.addHours(t.hours),t.weeks&&this.addWeeks(t.weeks),t.months&&this.addMonths(t.months),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),t.setExplicitTime&&this.ensureTimeOfDay(),this},t.getWeek=function(e){var t,n=new Date(this.valueOf());e?(n.addMinutes(n.getTimezoneOffset()),t=n.clone()):t=this;var r=(t.getDay()+6)%7;n.setDate(n.getDate()-r+3);var i=n.valueOf();return n.setMonth(0,1),4!==n.getDay()&&n.setMonth(0,1+(4-n.getDay()+7)%7),1+Math.ceil((i-n)/6048e5)},t.getISOWeek=function(){return n(this.getWeek(!0))},t.setWeek=function(e){return e-this.getWeek()===0?1!==this.getDay()?this.moveToDayOfWeek(1,this.getDay()>1?-1:1):this:this.moveToDayOfWeek(1,this.getDay()>1?-1:1).addWeeks(e-this.getWeek())},t.setQuarter=function(e){var t=Math.abs(3*(e-1)+1);return this.setMonth(t,1)},t.getQuarter=function(){return Date.getQuarter(this)},t.getDaysLeftInQuarter=function(){return Date.getDaysLeftInQuarter(this)},t.moveToNthOccurrence=function(e,t){if("Weekday"===e){if(t>0)this.moveToFirstDayOfMonth(),this.is().weekday()&&(t-=1);else{if(!(t<0))return this;this.moveToLastDayOfMonth(),this.is().weekday()&&(t+=1)}return this.addWeekdays(t)}var n=0;if(t>0)n=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(n)};var i=function(e,t,n){return function(r,i){var a=(r-this[e]()+n*(i||1))%n;return this[t](a)}};t.moveToDayOfWeek=i("getDay","addDays",7),t.moveToMonth=i("getMonth","addMonths",12),t.getOrdinate=function(){var e=this.getDate();return a(e)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset(),this.isDaylightSavingTime())},t.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),n=-6*Number(e)/10;return n||0===n?this.addMinutes(t-n):this},t.setTimezone=function(t){return this.setTimezoneOffset(e.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==this.getTimezoneOffset()},t.getUTCOffset=function(e){var t,n=-10*(e||this.getTimezoneOffset())/6;return n<0?(t=(n-1e4).toString()).charAt(0)+t.substr(2):"+"+(t=(n+1e4).toString()).substr(1)},t.getElapsed=function(e){return(e||new Date)-this},t.set=function(e){var t;for(t in e=r.call(this,e))if(hasOwnProperty.call(e,t)){var n,i,a=t.charAt(0).toUpperCase()+t.slice(1);"week"!==t&&"month"!==t&&"timezone"!==t&&"timezoneOffset"!==t&&(a+="s"),n="add"+a,i="get"+a,"month"===t?n+="s":"year"===t&&(i="getFullYear"),"day"!==t&&"timezone"!==t&&"timezoneOffset"!==t&&"week"!==t&&"hour"!==t&&"setExplicitTime"!==t?this[n](e[t]-this[i]()):"timezone"===t||"timezoneOffset"===t||"week"===t||"hour"===t?this["set"+a](e[t]):"setExplicitTime"===t&&this.ensureTimeOfDay()}return e.day&&this.addDays(e.day-this.getDate()),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})};var a=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},o=function(e){var t=Date.CultureInfo.formatPatterns;switch(e){case"d":return this.toString(t.shortDate);case"D":return this.toString(t.longDate);case"F":return this.toString(t.fullDateTime);case"m":return this.toString(t.monthDay);case"r":case"R":return this.clone().addMinutes(this.getTimezoneOffset()).toString(t.rfc1123)+" GMT";case"s":return this.toString(t.sortableDateTime);case"t":return this.toString(t.shortTime);case"T":return this.toString(t.longTime);case"u":return this.clone().addMinutes(this.getTimezoneOffset()).toString(t.universalSortableDateTime);case"y":return this.toString(t.yearMonth);default:return!1}};t.toString=function(t,r){if(!r&&t&&1===t.length){var i=o.call(this,t);if(i)return i}var s,u=(s=this,function(t){if("\\"===t.charAt(0))return t.replace("\\","");switch(t){case"hh":return n(s.getHours()<13?0===s.getHours()?12:s.getHours():s.getHours()-12);case"h":return s.getHours()<13?0===s.getHours()?12:s.getHours():s.getHours()-12;case"HH":return n(s.getHours());case"H":return s.getHours();case"mm":return n(s.getMinutes());case"m":return s.getMinutes();case"ss":return n(s.getSeconds());case"s":return s.getSeconds();case"yyyy":return n(s.getFullYear(),4);case"yy":return n(s.getFullYear());case"y":return s.getFullYear();case"E":case"dddd":return Date.CultureInfo.dayNames[s.getDay()];case"ddd":return Date.CultureInfo.abbreviatedDayNames[s.getDay()];case"dd":return n(s.getDate());case"d":return s.getDate();case"MMMM":return Date.CultureInfo.monthNames[s.getMonth()];case"MMM":return Date.CultureInfo.abbreviatedMonthNames[s.getMonth()];case"MM":return n(s.getMonth()+1);case"M":return s.getMonth()+1;case"t":return s.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return s.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"S":return a(s.getDate());case"W":return s.getWeek();case"WW":return s.getISOWeek();case"Q":return"Q"+s.getQuarter();case"q":return String(s.getQuarter());case"z":return s.getTimezone();case"Z":case"X":return Date.getTimezoneOffset(s.getTimezone());case"ZZ":return-60*s.getTimezoneOffset();case"u":return s.getDay();case"L":return e.isLeapYear(s.getFullYear())?1:0;case"B":return"@"+(s.getUTCSeconds()+60*s.getUTCMinutes()+3600*(s.getUTCHours()+1))/86.4;default:return t}});return t?t.replace(/((\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S|q|Q|WW?W?W?)(?![^\[]*\]))/g,u).replace(/\[|\]/g,""):this._toString()}}(),function(){var e=Date,t=e.prototype,n=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._isSecond=!1,n._dateElement="days",t.next=function(){return this._move=!0,this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._move=!0,this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return this._nth?l("Weekday").call(this):this._move?this.addWeekdays(this._orient):!!this._is&&(this._is=!1,!this.is().sat()&&!this.is().sun())},t.weekend=function(){return!!this._is&&(this._is=!1,this.is().sat()||this.is().sun())},t.at=function(t){return"string"===typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},n.fromNow=n.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},n.ago=n.before=function(e){var t={};return t["s"!==this._dateElement[this._dateElement.length-1]?this._dateElement+"s":this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var r,i="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),a="january february march april may june july august september october november december".split(/\s/),o=[],s=[],u="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<o.length;t++)this["get"+s[t]]&&(e[o[t].toLowerCase()]=this["get"+s[t]]());return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};var l=function(t){return function(){if(this._is)return this._is=!1,this.getDay()===t;if(this._move&&(this._move=null),null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var n=this._nth;this._nth=null;var r=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,n),this>r)throw new RangeError(e.getDayName(t)+" does not occur "+n+" times in the month of "+e.getMonthName(r.getMonth())+" "+r.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},c=function(n,r,i){for(var a=0;a<n.length;a++)e[n[a].toUpperCase()]=e[n[a].toUpperCase().substring(0,3)]=a,e[n[a]]=e[n[a].substring(0,3)]=r(a),t[n[a]]=t[n[a].substring(0,3)]=i(a)};c(i,(function(t){return function(){var n=e.today(),r=t-n.getDay();return(0===t&&1===Date.CultureInfo.firstDayOfWeek&&0!==n.getDay()||r<0)&&(r+=7),n.addDays(r)}}),l),c(a,(function(t){return function(){return e.today().set({month:t,day:1})}}),(function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}}));for(var d=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;var t=this.toObject(),n=(arguments[0]||new Date).toObject(),r="",i=e.toLowerCase();i="s"===i[i.length-1]?i.substring(0,i.length-1):i;for(var a=o.length-1;a>-1;a--){if(t[r=o[a].toLowerCase()]!==n[r])return!1;if(i===r)break}return!0}return"s"!==e.substring(e.length-1)&&(e+="s"),this._move&&(this._move=null),this["add"+e](this._orient)}},h=function(e){return function(){return this._dateElement=e,this}},f=0;f<o.length;f++)"weekday"!==(r=o[f].toLowerCase())&&(t[r]=t[r+"s"]=d(o[f]),n[r]=n[r+"s"]=h(r+"s"));t._ss=d("Second");for(var p=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},g=0;g<u.length;g++)t[u[g]]=p(0===g?-1:g)}(),function(){"use strict";Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};var e=Date.Parsing,t={standard:[0,31,59,90,120,151,181,212,243,273,304,334],leap:[0,31,60,91,121,152,182,213,244,274,305,335]};e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0};var n={multiReplace:function(e,t){var n;for(n in t){var r;if(Object.prototype.hasOwnProperty.call(t,n))"function"===typeof t[n]||(r=t[n]instanceof RegExp?t[n]:new RegExp(t[n],"g")),e=e.replace(r,n)}return e},getDayOfYearFromWeek:function(e){var t,n;return e.weekDay=e.weekDay||0===e.weekDay?e.weekDay:1,n=(0===(t=new Date(e.year,0,4)).getDay()?7:t.getDay())+3,e.dayOfYear=7*e.week+(0===e.weekDay?7:e.weekDay)-n,e},getDayOfYear:function(e,t){e.dayOfYear||(e=n.getDayOfYearFromWeek(e));for(var r=0;r<=t.length;r++){if(e.dayOfYear<t[r]||r===t.length){e.day=e.day?e.day:e.dayOfYear-t[r-1];break}e.month=r}return e},adjustForTimeZone:function(e,t){var n;return"Z"===e.zone.toUpperCase()||0===e.zone_hours&&0===e.zone_minutes?n=-t.getTimezoneOffset():(n=60*e.zone_hours+(e.zone_minutes||0),"+"===e.zone_sign&&(n*=-1),n-=t.getTimezoneOffset()),t.setMinutes(t.getMinutes()+n),t},setDefaults:function(e){return e.year=e.year||Date.today().getFullYear(),e.hours=e.hours||0,e.minutes=e.minutes||0,e.seconds=e.seconds||0,e.milliseconds=e.milliseconds||0,(e.month||!e.week&&!e.dayOfYear)&&(e.month=e.month||0,e.day=e.day||1),e},dataNum:function(e,t,n,r){var i=1*e;return t?r?e?1*t(e):e:e?t(i):e:n?e&&"undefined"!==typeof e?i:e:e?i:e},timeDataProcess:function(e){var t={};for(var r in e.data)e.data.hasOwnProperty(r)&&(t[r]=e.ignore[r]?e.data[r]:n.dataNum(e.data[r],e.mods[r],e.explict[r],e.postProcess[r]));return e.data.secmins&&(e.data.secmins=60*e.data.secmins.replace(",","."),t.minutes?t.seconds||(t.seconds=e.data.secmins):t.minutes=e.data.secmins,delete e.secmins),t},buildTimeObjectFromData:function(e){return n.timeDataProcess({data:{year:e[1],month:e[5],day:e[7],week:e[8],dayOfYear:e[10],hours:e[15],zone_hours:e[23],zone_minutes:e[24],zone:e[21],zone_sign:e[22],weekDay:e[9],minutes:e[16],seconds:e[19],milliseconds:e[20],secmins:e[18]},mods:{month:function(e){return e-1},weekDay:function(e){return 7===(e=Math.abs(e))?0:e},minutes:function(e){return e.replace(":","")},seconds:function(e){return Math.floor(1*e.replace(":","").replace(",","."))},milliseconds:function(e){return 1e3*e.replace(",",".")}},postProcess:{minutes:!0,seconds:!0,milliseconds:!0},explict:{zone_hours:!0,zone_minutes:!0},ignore:{zone:!0,zone_sign:!0,secmins:!0}})},addToHash:function(e,t,n){n=n;for(var r=(t=t).length,i=0;i<r;i++)e[t[i]]=n[i];return e},combineRegex:function(e,t){return new RegExp("(("+e.source+")\\s("+t.source+"))")},getDateNthString:function(e,t,n){return e?Date.today().addDays(n).toString("d"):t?Date.today().last()[n]().toString("d"):void 0},buildRegexData:function(e){for(var t=[],n=e.length,r=0;r<n;r++)Array.isArray(e[r])?t.push(this.combineRegex(e[r][0],e[r][1])):t.push(e[r]);return t}};e.processTimeObject=function(r){var i,a;return n.setDefaults(r),a=e.isLeapYear(r.year)?t.leap:t.standard,r.month||!r.week&&!r.dayOfYear?r.dayOfYear=a[r.month]+r.day:n.getDayOfYear(r,a),i=new Date(r.year,r.month,r.day,r.hours,r.minutes,r.seconds,r.milliseconds),r.zone&&n.adjustForTimeZone(r,i),i},e.Numeric={isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},regex:/\b([0-1]?[0-9])([0-3]?[0-9])([0-2]?[0-9]?[0-9][0-9])\b/i,parse:function(t){var n,r,i={},a=Date.CultureInfo.dateElementOrder.split("");if(!this.isNumeric(t)||"+"===t[0]&&"-"===t[0])return null;if(t.length<5&&t.indexOf(".")<0&&t.indexOf("/")<0)return i.year=t,e.processTimeObject(i);if(!(n=t.match(this.regex))||!n.length)return null;for(r=0;r<a.length;r++)switch(a[r]){case"d":i.day=n[r+1];break;case"m":i.month=n[r+1]-1;break;case"y":i.year=n[r+1]}return e.processTimeObject(i)}},e.Normalizer={regexData:function(){var e=Date.CultureInfo.regexPatterns;return n.buildRegexData([e.tomorrow,e.yesterday,[e.past,e.mon],[e.past,e.tue],[e.past,e.wed],[e.past,e.thu],[e.past,e.fri],[e.past,e.sat],[e.past,e.sun]])},basicReplaceHash:function(){var e=Date.CultureInfo.regexPatterns;return{January:e.jan,February:e.feb,March:e.mar,April:e.apr,May:e.may,June:e.jun,July:e.jul,August:e.aug,September:e.sep,October:e.oct,November:e.nov,December:e.dec,"":/\bat\b/gi," ":/\s{2,}/,"9am":e.thisMorning,"7pm":e.thisEvening}},keys:function(){return[n.getDateNthString(!0,!1,1),n.getDateNthString(!0,!1,-1),n.getDateNthString(!1,!0,"monday"),n.getDateNthString(!1,!0,"tuesday"),n.getDateNthString(!1,!0,"wednesday"),n.getDateNthString(!1,!0,"thursday"),n.getDateNthString(!1,!0,"friday"),n.getDateNthString(!1,!0,"saturday"),n.getDateNthString(!1,!0,"sunday")]},buildRegexFunctions:function(){var e=Date.CultureInfo.regexPatterns,t=Date.i18n.__,n=new RegExp("(\\b\\d\\d?("+t("AM")+"|"+t("PM")+")? )("+e.tomorrow.source.slice(1)+")","i"),r=new RegExp(e.today.source+"(?!\\s*([+-]))\\b");this.replaceFuncs=[[r,function(e){return e.length>1?Date.today().toString("d"):e}],[n,function(e,t){return Date.today().addDays(1).toString("d")+" "+t}]]},buildReplaceData:function(){this.buildRegexFunctions(),this.replaceHash=n.addToHash(this.basicReplaceHash(),this.keys(),this.regexData())},stringReplaceFuncs:function(e){for(var t=0;t<this.replaceFuncs.length;t++)e=e.replace(this.replaceFuncs[t][0],this.replaceFuncs[t][1]);return e},parse:function(t){t=this.stringReplaceFuncs(t),t=n.multiReplace(t,this.replaceHash);try{var r=t.split(/([\s\-\.\,\/\x27]+)/);3===r.length&&e.Numeric.isNumeric(r[0])&&e.Numeric.isNumeric(r[2])&&r[2].length>=4&&"d"===Date.CultureInfo.dateElementOrder[0]&&(t="1/"+r[0]+"/"+r[2])}catch(i){}return t}},e.Normalizer.buildReplaceData()}(),function(){for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(n){var r=n.match(t);if(r)return[r[0],n.substring(r[0].length)];throw new e.Exception(n)}},token:function(){return function(e){return t.rtoken(new RegExp("^\\s*"+e+"\\s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var n=[],r=null;t.length;){try{r=e.call(this,t)}catch(i){n.push(r[0]),t=r[1];continue}break}return[n,t]}},many:function(e){return function(t){for(var n=[],r=null;t.length;){try{r=e.call(this,t)}catch(i){return[n,t]}n.push(r[0]),t=r[1]}return[n,t]}},optional:function(e){return function(t){var n=null;try{n=e.call(this,t)}catch(r){return[null,t]}return[n[0],n[1]]}},not:function(t){return function(n){try{t.call(this,n)}catch(r){return[null,n]}throw new e.Exception(n)}},ignore:function(e){return e?function(t){return[null,e.call(this,t)[1]]}:null},product:function(){for(var e=arguments[0],n=Array.prototype.slice.call(arguments,1),r=[],i=0;i<e.length;i++)r.push(t.each(e[i],n));return r},cache:function(t){var n={},r=0,i=[],a=Date.Config.CACHE_MAX||500,o=null;return function(s){!function(){if(r===a)for(var e=0;e<10;e++){var t=i.shift();t&&(delete n[t],r--)}}();try{o=n[s]=n[s]||t.call(this,s)}catch(u){o=n[s]=u}if(r++,i.push(s),o instanceof e.Exception)throw o;return o}},any:function(){var t=arguments;return function(n){for(var r=null,i=0;i<t.length;i++)if(null!=t[i]){try{r=t[i].call(this,n)}catch(a){r=null}if(r)return r}throw new e.Exception(n)}},each:function(){var t=arguments;return function(n){for(var r=[],i=null,a=0;a<t.length;a++)if(null!=t[a]){try{i=t[a].call(this,n)}catch(o){throw new e.Exception(n)}r.push(i[0]),n=i[1]}return[r,n]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(n,r,i){return r=r||t.rtoken(/^\s*/),i=i||null,1===n.length?n[0]:function(t){for(var a=null,o=null,s=[],u=0;u<n.length;u++){try{a=n[u].call(this,t)}catch(l){break}s.push(a[0]);try{o=r.call(this,a[1])}catch(c){o=null;break}t=o[1]}if(!a)throw new e.Exception(t);if(o)throw new e.Exception(o[1]);if(i)try{a=i.call(this,a[1])}catch(d){throw new e.Exception(a[1])}return[s,a?a[1]:t]}},between:function(e,n,i){i=i||e;var a=t.each(t.ignore(e),n,t.ignore(i));return function(e){var t=a.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,n,r){return n=n||t.rtoken(/^\s*/),r=r||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(n)),e.slice(-1),t.ignore(r)):t.each(t.many(t.each(e,t.ignore(n))),px,t.ignore(r))},set:function(n,r,i){return r=r||t.rtoken(/^\s*/),i=i||null,function(a){for(var o=null,s=null,u=null,l=null,c=[[],a],d=!1,h=0;h<n.length;h++){u=null,s=null,o=null,d=1===n.length;try{o=n[h].call(this,a)}catch(g){continue}if(l=[[o[0]],o[1]],o[1].length>0&&!d)try{u=r.call(this,o[1])}catch(v){d=!0}else d=!0;if(d||0!==u[1].length||(d=!0),!d){for(var f=[],p=0;p<n.length;p++)h!==p&&f.push(n[p]);(s=t.set(f,r).call(this,u[1]))[0].length>0&&(l[0]=l[0].concat(s[0]),l[1]=s[1])}if(l[1].length<c[1].length&&(c=l),0===c[1].length)break}if(0===c[0].length)return c;if(i){try{u=i.call(this,c[1])}catch(m){throw new e.Exception(c[1])}c[1]=u[1]}return c}},forward:function(e,t){return function(n){return e[t].call(this,n)}},replace:function(e,t){return function(n){var r=e.call(this,n);return[t,r[1]]}},process:function(e,t){return function(n){var r=e.call(this,n);return[t.call(this,r[0]),r[1]]}},min:function(t,n){return function(r){var i=n.call(this,r);if(i[0].length<t)throw new e.Exception(r);return i}}},n=function(e){return function(){var t,n,r=null,i=[];return arguments.length>1?r=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(r=arguments[0]),r?(t=r.shift()).length>0?(r.unshift(t[n]),i.push(e.apply(null,r)),r.shift(),i):void 0:e.apply(null,arguments)}},i="optional not ignore cache".split(/\s/),a=0;a<i.length;a++)t[i[a]]=n(t[i[a]]);for(var o=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),u=0;u<s.length;u++)t[s[u]]=o(t[s[u]])}(),function(){var e=Date,t=function(e){for(var n=[],r=0;r<e.length;r++)e[r]instanceof Array?n=n.concat(t(e[r])):e[r]&&n.push(e[r]);return n},n=function(){if(this.meridian&&(this.hour||0===this.hour)){if("a"===this.meridian&&this.hour>11&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";if("p"===this.meridian&&this.hour<12&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";"p"===this.meridian&&this.hour<12?this.hour=this.hour+12:"a"===this.meridian&&12===this.hour&&(this.hour=0)}else this.meridian||!this.hour&&0!==this.hour||this.hour<8&&(this.hour=this.hour+12)},r=function(){var e=new Date;!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=e.getDate()),this.year||(this.year=e.getFullYear(),this.month<e.getMonth()&&this.year++),this.month||0===this.month||(this.month=e.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.millisecond||(this.millisecond=0)},i={getToday:function(){return this.now||-1!=="hour minute second".indexOf(this.unit)?new Date:e.today()},setDaysFromWeekday:function(t,n){var r;return n=n||1,this.unit="day",r=e.getDayNumberFromName(this.weekday)-t.getDay(),this.days=r?r+7*n:7*n,this},setMonthsFromMonth:function(e,t){var n;return t=t||1,this.unit="month",n=this.month-e.getMonth(),this.months=n?(n+12*t)%12:12*t,this.month=null,this},setDMYFromWeekday:function(){var e=Date[this.weekday]();return this.day=e.getDate(),this.month||(this.month=e.getMonth()),this.year=e.getFullYear(),this},setUnitValue:function(e){!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"===this.operator?1:-1)+(this.value||0)*e:null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),this[this.unit+"s"]=this.value*e)},generateDateFromWeeks:function(){var e=void 0!==this.weekday?this.weekday:"today",t=Date[e]().addWeeks(this.weeks);return this.now&&t.setTimeToNow(),t}};e.Translator={hour:function(e){return function(){this.hour=Number(e),this.setExplicitTime=!0}},minute:function(e){return function(){this.minute=Number(e),this.setExplicitTime=!0}},second:function(e){return function(){this.second=Number(e),this.setExplicitTime=!0}},secondAndMillisecond:function(e){return function(){var t=e.match(/^([0-5][0-9])\.([0-9]{1,3})/);this.second=Number(t[1]),this.millisecond=Number(t[2]),this.setExplicitTime=!0}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase(),this.setExplicitTime=!0}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){if(this.day=Number(t.match(/\d+/)[0]),this.day<1)throw"invalid day"}},month:function(e){return function(){if(this.month=3===e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1,this.month<0)throw"invalid month"}},year:function(e){return function(){var t=Number(e);this.year=e.length>2?t:t+(t+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"someday":this.days=14;break;case"later":this.days=5;break;case"soon":this.days=2;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){var i;t=t instanceof Array?t:[t];for(var a=0;a<t.length;a++)t[a]&&t[a].call(this);if(r.call(this),n.call(this),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");return i=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond),this.setExplicitTime&&i.ensureTimeOfDay(),this.year<100&&i.setFullYear(this.year),this.timezone?i.set({timezone:this.timezone}):this.timezoneOffset&&i.set({timezoneOffset:this.timezoneOffset}),i},finish:function(r){var a,o,s,u;if(0===(r=r instanceof Array?t(r):[r]).length)return null;for(var l=0;l<r.length;l++)"function"===typeof r[l]&&r[l].call(this);if(this.now&&!this.unit&&!this.operator)return new Date;if(a=i.getToday.call(this),givenYear=!!this.year,o=!!(this.days&&null!==this.days||this.orient||this.operator),s="past"===this.orient||"subtract"===this.operator?-1:1,this.month&&"week"===this.unit&&(this.value=this.month+1,delete this.month,delete this.day),!this.month&&0!==this.month||-1==="year day hour minute second".indexOf(this.unit)||(this.value||(this.value=this.month+1),this.month=null,o=!0),o||!this.weekday||this.day||this.days||i.setDMYFromWeekday.call(this),o&&this.weekday&&"month"!==this.unit&&"week"!==this.unit&&i.setDaysFromWeekday.call(this,a,s),!this.weekday||"week"===this.unit||this.day||this.days||(u=Date[this.weekday](),this.day=u.getDate(),u.getMonth()!==a.getMonth()&&(this.month=u.getMonth())),this.month&&"day"===this.unit&&this.operator&&(this.value||(this.value=this.month+1),this.month=null),null==this.value||null==this.month||null==this.year||this.day||(this.day=1*this.value),this.month&&!this.day&&this.value&&(a.set({day:1*this.value}),o||(this.day=1*this.value)),this.month||!this.value||"month"!==this.unit||this.now||(this.month=this.value,o=!0),o&&(this.month||0===this.month)&&"year"!==this.unit&&i.setMonthsFromMonth.call(this,a,s),this.unit||(this.unit="day"),i.setUnitValue.call(this,s),n.call(this),!this.month&&0!==this.month||this.day||(this.day=1),!this.orient&&!this.operator&&"week"===this.unit&&this.value&&!this.day&&!this.month)return Date.today().setWeek(this.value);if("week"===this.unit&&this.weeks&&!this.day&&!this.month)return i.generateDateFromWeeks.call(this);if(o&&this.timezone&&this.day&&this.days&&(this.day=this.days),!givenYear&&this.month<a.getMonth()&&(this.year=a.getFullYear()+1),o&&(this.hour||this.minute||this.second)&&(this.hours=this.hour,this.minutes=this.minute,this.seconds=this.second),o?a.add(this):a.set(this),this.timezone){this.timezone=this.timezone.toUpperCase();var c=e.getTimezoneOffset(this.timezone);a.hasDaylightSavingTime()&&e.getTimezoneAbbreviation(c,a.isDaylightSavingTime())!==this.timezone&&(a.isDaylightSavingTime()?a.addHours(-1):a.addHours(1)),a.setTimezoneOffset(c)}return a}}}(),function(){var e=Date;e.Grammar={};var t,n=e.Parsing.Operators,r=e.Grammar,i=e.Translator;t=function(){return n.each(n.any.apply(null,arguments),n.not(r.ctoken2("timeContext")))},r.datePartDelimiter=n.rtoken(/^([\s\-\.\,\/\x27]+)/),r.timePartDelimiter=n.stoken(":"),r.whiteSpace=n.rtoken(/^\s*/),r.generalDelimiter=n.rtoken(/^(([\s\,]|at|@|on)+)/);var a={};r.ctoken=function(e){var t=a[e];if(!t){for(var r=Date.CultureInfo.regexPatterns,i=e.split(/\s+/),o=[],s=0;s<i.length;s++)o.push(n.replace(n.rtoken(r[i[s]]),i[s]));t=a[e]=n.any.apply(null,o)}return t},r.ctoken2=function(e){return n.rtoken(Date.CultureInfo.regexPatterns[e])};var o=function(e,t,i,a){r[e]=a?n.cache(n.process(n.each(n.rtoken(t),n.optional(r.ctoken2(a))),i)):n.cache(n.process(n.rtoken(t),i))},s=function(e,t){return n.cache(n.process(r.ctoken2(e),t))},u={},l=function(e){return u[e]=u[e]||r.format(e)[0],u[e]};r.allformats=function(e){var t=[];if(e instanceof Array)for(var n=0;n<e.length;n++)t.push(l(e[n]));else t.push(l(e));return t},r.formats=function(e){if(e instanceof Array){for(var t=[],r=0;r<e.length;r++)t.push(l(e[r]));return n.any.apply(null,t)}return l(e)};var c=function(){var e,t=["h","hh","H","HH","m","mm","s","ss","ss.s","z","zz"],a=[/^(0[0-9]|1[0-2]|[1-9])/,/^(0[0-9]|1[0-2])/,/^([0-1][0-9]|2[0-3]|[0-9])/,/^([0-1][0-9]|2[0-3])/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^[0-5][0-9]\.[0-9]{1,3}/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/],u=[i.hour,i.hour,i.hour,i.hour,i.minute,i.minute,i.second,i.second,i.secondAndMillisecond,i.timezone,i.timezone];for(e=0;e<t.length;e++)o(t[e],a[e],u[e]);r.hms=n.cache(n.sequence([r.H,r.m,r.s],r.timePartDelimiter)),r.t=s("shortMeridian",i.meridian),r.tt=s("longMeridian",i.meridian),r.zzz=s("timezone",i.timezone),r.timeSuffix=n.each(n.ignore(r.whiteSpace),n.set([r.tt,r.zzz])),r.time=n.each(n.optional(n.ignore(n.stoken("T"))),r.hms,r.timeSuffix)},d=function(){o("d",/^([0-2]\d|3[0-1]|\d)/,i.day,"ordinalSuffix"),o("dd",/^([0-2]\d|3[0-1])/,i.day,"ordinalSuffix"),r.rday=n.cache(n.process(r.ctoken("yesterday tomorrow soon later someday today now"),i.rday)),r.ddd=r.dddd=n.cache(n.process(r.ctoken("sun mon tue wed thu fri sat"),(function(e){return function(){this.weekday=e}}))),o("M",/^(1[0-2]|0\d|\d)/,i.month),o("MM",/^(1[0-2]|0\d)/,i.month),r.MMM=r.MMMM=n.cache(n.process(r.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),i.month)),o("y",/^(\d+)/,i.year),o("yy",/^(\d\d)/,i.year),o("yyy",/^(\d\d?\d?\d?)/,i.year),o("yyyy",/^(\d\d\d\d)/,i.year),r.day=t(r.d,r.dd),r.month=t(r.M,r.MMM),r.year=t(r.yyyy,r.yy);var e=function(){return n.set(arguments,r.datePartDelimiter)};r.mdy=e(r.ddd,r.month,r.day,r.year),r.ymd=e(r.ddd,r.year,r.month,r.day),r.dmy=e(r.ddd,r.day,r.month,r.year),r.date=function(e){return(r[Date.CultureInfo.dateElementOrder]||r.mdy).call(this,e)}},h=function(){r.orientation=n.process(r.ctoken("past future"),(function(e){return function(){this.orient=e}})),r.operator=n.process(r.ctoken("add subtract"),(function(e){return function(){this.operator=e}}))};r.buildGrammarFormats=function(){a={},c(),d(),h(),r.value=n.process(n.rtoken(/^([-+]?\d+)?(st|nd|rd|th)?/),(function(e){return function(){this.value=e.replace(/\D/g,"")}})),r.expression=n.set([r.rday,r.time,r.value,r.orientation,r.ddd,r.MMM]),r.format=n.process(n.many(n.any(n.process(n.rtoken(/^(dd?d?d?(?!e)|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),(function(t){if(r[t])return r[t];throw e.Parsing.Exception(t)})),n.process(n.rtoken(/^[^dMyhHmstz]+/),(function(e){return n.ignore(n.stoken(e))})))),(function(e){return n.process(n.each.apply(null,e),i.finishExact)})),r._start=n.process(n.set([r.date,r.expression,r.time],r.generalDelimiter,r.whiteSpace),i.finish)},r.buildGrammarFormats(),r._formats=r.formats(["M-d H","ddd H"]),r.start=function(e){try{var t=r._formats.call({},e);if(0===t[1].length)return t}catch(n){}return r._start.call({},e)}}(),function(){var e=Date,t=function(e){var t=e.match(/\b(\d+)(?:st|nd|rd|th)\b/);return e=t&&2===t.length?e.replace(t[0],t[1]):e},n=function(t){var n=null;try{n=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(r){return null}return 0===n[1].length?n[0]:null};e._parse||(e._parse=e.parse),e.parse=function(r){var i;return r?r instanceof Date?r.clone():(r.length>=4&&"0"!==r.charAt(0)&&"+"!==r.charAt(0)&&"-"!==r.charAt(0)&&(i=e.Parsing.Numeric.parse(r)),i instanceof Date&&!isNaN(i.getTime())?i:(r=e.Parsing.Normalizer.parse(t(r)),i=n(r))):null},Date.getParseFunction=function(e){var t=Date.Grammar.allformats(e);return function(e){for(var n=null,r=0;r<t.length;r++){try{n=t[r].call({},e)}catch(i){continue}if(0===n[1].length)return n[0]}return null}},e.parseExact=function(t,n){return e.getParseFunction(n)(t)}}(),function(){var e=Date,n=e.prototype,r=function(e,t){return t||(t=2),("000"+e).slice(-1*t)},i={substitutes:function(e){switch(e){case"d":case"%d":return"dd";case"D":case"%a":return"ddd";case"j":case"l":case"%A":return"dddd";case"S":return"S";case"F":case"%B":return"MMMM";case"m":case"%m":return"MM";case"M":case"%b":case"%h":return"MMM";case"n":return"M";case"Y":case"%Y":return"yyyy";case"y":case"%y":return"yy";case"g":case"%I":return"h";case"G":return"H";case"h":return"hh";case"H":case"%H":return"HH";case"i":case"%M":return"mm";case"s":case"%S":return"ss";case"%r":return"hh:mm tt";case"%R":return"H:mm";case"%T":return"H:mm:ss";case"%X":return"t";case"%x":case"%e":return"d";case"%D":return"MM/dd/yy";case"%n":return"\\n";case"%t":return"\\t";case"e":case"T":case"%z":case"%Z":return"z";case"Z":return"ZZ";case"N":case"w":case"%w":return"u";case"W":case"%V":return"W"}},interpreted:function(n,i){var a;switch(n){case"%u":return i.getDay()+1;case"z":return i.getOrdinalNumber();case"%j":return r(i.getOrdinalNumber(),3);case"%U":var o=i.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),s=i.clone().addDays(1).moveToDayOfWeek(0,-1);return s<o?"00":r((s.getOrdinalNumber()-o.getOrdinalNumber())/7+1);case"%W":return r(i.getWeek());case"t":return e.getDaysInMonth(i.getFullYear(),i.getMonth());case"o":case"%G":return i.setWeek(i.getISOWeek()).toString("yyyy");case"%g":return i._format("%G").slice(-2);case"a":case"%p":return t("tt").toLowerCase();case"A":return t("tt").toUpperCase();case"u":return r(i.getMilliseconds(),3);case"I":return i.isDaylightSavingTime()?1:0;case"O":return i.getUTCOffset();case"P":return(a=i.getUTCOffset()).substring(0,a.length-2)+":"+a.substring(a.length-2);case"B":var u=new Date;return Math.floor((3600*u.getHours()+60*u.getMinutes()+u.getSeconds()+60*(u.getTimezoneOffset()+60))/86.4);case"c":return i.toISOString().replace(/\"/g,"");case"U":return e.strtotime("now");case"%c":return t("d")+" "+t("t");case"%C":return Math.floor(i.getFullYear()/100+1)}},shouldOverrideDefaults:function(e){switch(e){case"%e":return!0;default:return!1}},parse:function(e,t){var n,r=t||new Date;return(n=i.substitutes(e))?n:(n=i.interpreted(e,r))||e}};e.normalizeFormat=function(e,t){return e.replace(/(%|\\)?.|%%/g,(function(e){return i.parse(e,t)}))},e.strftime=function(e,t){return Date.parse(t)._format(e)},e.strtotime=function(t){var n=e.parse(t);return Math.round(e.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds())/1e3)};n._format=function(t){var n,r=(n=this,function(t){var r,a;return"\\"===t.charAt(0)||"%%"===t.substring(0,2)?t.replace("\\","").replace("%%","%"):(a=i.shouldOverrideDefaults(t),(r=e.normalizeFormat(t,n))?n.toString(r,a):void 0)});return t?t.replace(/(%|\\)?.|%%/g,r):this._toString()},n.format||(n.format=n._format)}(),function(){"use strict";var e=function(e){return function(){return this[e]}},t=function(e){return function(t){return this[e]=t,this}},n=function(e,t,r,i,a){if(1===arguments.length&&"number"===typeof e){var o=e<0?-1:1,s=Math.abs(e);this.setDays(Math.floor(s/864e5)*o),s%=864e5,this.setHours(Math.floor(s/36e5)*o),s%=36e5,this.setMinutes(Math.floor(s/6e4)*o),s%=6e4,this.setSeconds(Math.floor(s/1e3)*o),s%=1e3,this.setMilliseconds(s*o)}else this.set(e,t,r,i,a);return this.getTotalMilliseconds=function(){return 864e5*this.getDays()+36e5*this.getHours()+6e4*this.getMinutes()+1e3*this.getSeconds()},this.compareTo=function(e){var t,n=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds());return n<(t=null===e?new Date(1970,1,1,0,0,0):new Date(1970,1,1,e.getHours(),e.getMinutes(),e.getSeconds()))?-1:n>t?1:0},this.equals=function(e){return 0===this.compareTo(e)},this.add=function(e){return null===e?this:this.addSeconds(e.getTotalMilliseconds()/1e3)},this.subtract=function(e){return null===e?this:this.addSeconds(-e.getTotalMilliseconds()/1e3)},this.addDays=function(e){return new n(this.getTotalMilliseconds()+864e5*e)},this.addHours=function(e){return new n(this.getTotalMilliseconds()+36e5*e)},this.addMinutes=function(e){return new n(this.getTotalMilliseconds()+6e4*e)},this.addSeconds=function(e){return new n(this.getTotalMilliseconds()+1e3*e)},this.addMilliseconds=function(e){return new n(this.getTotalMilliseconds()+e)},this.get12HourHour=function(){return this.getHours()>12?this.getHours()-12:0===this.getHours()?12:this.getHours()},this.getDesignator=function(){return this.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator},this.toString=function(e){this._toString=function(){return null!==this.getDays()&&this.getDays()>0?this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds()):this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())},this.p=function(e){return e.toString().length<2?"0"+e:e};var t=this;return e?e.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,(function(e){switch(e){case"d":return t.getDays();case"dd":return t.p(t.getDays());case"H":return t.getHours();case"HH":return t.p(t.getHours());case"h":return t.get12HourHour();case"hh":return t.p(t.get12HourHour());case"m":return t.getMinutes();case"mm":return t.p(t.getMinutes());case"s":return t.getSeconds();case"ss":return t.p(t.getSeconds());case"t":return(t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator}})):this._toString()},this};!function(n,r){for(var i=0;i<r.length;i++){var a=r[i],o=a.slice(0,1).toUpperCase()+a.slice(1);n.prototype[a]=0,n.prototype["get"+o]=e(a),n.prototype["set"+o]=t(a)}}(n,["years","months","days","hours","minutes","seconds","milliseconds"].slice(2)),n.prototype.set=function(e,t,n,r,i){this.setDays(e||this.getDays()),this.setHours(t||this.getHours()),this.setMinutes(n||this.getMinutes()),this.setSeconds(r||this.getSeconds()),this.setMilliseconds(i||this.getMilliseconds())},Date.prototype.getTimeOfDay=function(){return this.getMilliseconds()+1e3*this.getSeconds()+6e4*this.getMinutes()+36e5*this.getHours()},Date.prototype.hasTimeOfDay=function(){return 0!==this.getHours()||0!==this.getMinutes()||0!==this.getSeconds()||0!==this.getMilliseconds()},Date.prototype.isRepeatDate=function(){return!1},Date.TimeSpan=n,"undefined"!==typeof window&&(window.TimeSpan=n)}(),function(){"use strict";var e=function(e){return function(){return this[e]}},t=function(e){return function(t){return this[e]=t,this}},n=function(e,t,n,r){function i(){t.addMonths(-e),r.months++,12===r.months&&(r.years++,r.months=0)}if(1===e)for(;t>n;)i();else for(;t<n;)i();r.months--,r.months*=e,r.years*=e},r=function(e,t,n){var r=!1===(t.isDaylightSavingTime()===n.isDaylightSavingTime());r&&1===e?t.addHours(-1):r&&t.addHours(1)},i=function(e,t,i,a,o,s,u){if(7===arguments.length)this.set(e,t,i,a,o,s,u);else if(2===arguments.length&&arguments[0]instanceof Date&&arguments[1]instanceof Date){var l=arguments[0].clone(),c=arguments[1].clone(),d=l>c?1:-1;this.dates={start:arguments[0].clone(),end:arguments[1].clone()},n(d,l,c,this),r(d,l,c);var h=c-l;if(0!==h){var f=new TimeSpan(h);this.set(this.years,this.months,f.getDays(),f.getHours(),f.getMinutes(),f.getSeconds(),f.getMilliseconds())}}return this};!function(n,r){for(var i=0;i<r.length;i++){var a=r[i],o=a.slice(0,1).toUpperCase()+a.slice(1);n.prototype[a]=0,n.prototype["get"+o]=e(a),n.prototype["set"+o]=t(a)}}(i,["years","months","days","hours","minutes","seconds","milliseconds"]),i.prototype.set=function(e,t,n,r,i,a,o){this.setYears(e||this.getYears()),this.setMonths(t||this.getMonths()),this.setDays(n||this.getDays()),this.setHours(r||this.getHours()),this.setMinutes(i||this.getMinutes()),this.setSeconds(a||this.getSeconds()),this.setMilliseconds(o||this.getMilliseconds())},Date.TimePeriod=i,"undefined"!==typeof window&&(window.TimePeriod=i)}()},function(e,t,n){var r=n(107);e.exports=function(e){if(Array.isArray(e))return r(e)}},function(e,t){e.exports=function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){i=!0,a=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){"use strict";(function(e,t){var r=n(34),i=n(29),a=n(9),o=n(81),s=n(61),u=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(a.B)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(a.v)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),l=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return Object(a.i)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),c=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new u(t)}}catch(n){}return new l},d=c("localStorage"),h=c("sessionStorage"),f=new o.b("@firebase/database"),p=function(){var e=1;return function(){return e++}}(),g=function(e){var t=Object(a.A)(e),n=new a.d;n.update(t);var r=n.digest();return a.g.encodeByteArray(r)},v=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"===typeof i&&"number"===typeof i.length?n+=v.apply(null,i):n+="object"===typeof i?Object(a.B)(i):i,n+=" "}return n},m=null,y=!0,_=function(e,t){Object(a.e)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(f.logLevel=o.a.VERBOSE,m=f.log.bind(f),t&&h.set("logging_enabled",!0)):"function"===typeof e?m=e:(m=null,h.remove("logging_enabled"))},b=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===y&&(y=!1,null===m&&!0===h.get("logging_enabled")&&_(!0)),m){var n=v.apply(null,e);m(n)}},w=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];b.apply(void 0,Object(i.f)([e],t))}},k=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+v.apply(void 0,Object(i.f)(e));f.error(n)},S=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+v.apply(void 0,Object(i.f)(e));throw f.error(n),new Error(n)},E=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+v.apply(void 0,Object(i.f)(e));f.warn(n)},P=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},I="[MIN_NAME]",D="[MAX_NAME]",T=function(e,t){if(e===t)return 0;if(e===I||t===D)return-1;if(t===I||e===D)return 1;var n=F(e),r=F(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},x=function(e,t){return e===t?0:e<t?-1:1},C=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(a.B)(t))},A=function(e){if("object"!==typeof e||null===e)return Object(a.B)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=Object(a.B)(t[i]),r+=":",r+=A(e[t[i]]);return r+="}"},L=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function O(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var M=function(e){Object(a.e)(!P(e),"Invalid JSON number");var t,n,r,i,o,s=1023;0===e?(n=0,r=0,t=1/e===-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),s))+s,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var u=[];for(o=52;o;o-=1)u.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)u.push(n%2?1:0),n=Math.floor(n/2);u.push(t?1:0),u.reverse();var l=u.join(""),c="";for(o=0;o<64;o+=8){var d=parseInt(l.substr(o,8),2).toString(16);1===d.length&&(d="0"+d),c+=d}return c.toLowerCase()},R=new RegExp("^-?(0*)\\d{1,10}$"),F=function(e){if(R.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},N=function(e){try{e()}catch(t){setTimeout((function(){var e=t.stack||"";throw E("Exception was thrown by user callback.",e),t}),Math.floor(0))}},j=function(e,t){var n=setTimeout(e,t);return"object"===typeof n&&n.unref&&n.unref(),n},U=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:!1,configurable:!0}),e.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},e.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new e(this.pieces_,t)},e.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},e.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)t.push(this.pieces_[n]);return new e(t,0)},e.prototype.child=function(t){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(t instanceof e)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new e(n,0)},e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},e.relativePath=function(t,n){var r=t.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return e.relativePath(t.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+t+")")},e.comparePaths=function(e,t){for(var n=e.slice(),r=t.slice(),i=0;i<n.length&&i<r.length;i++){var a=T(n[i],r[i]);if(0!==a)return a}return n.length===r.length?0:n.length<r.length?-1:1},e.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,n=e.pieceNum_;t<=this.pieces_.length;t++,n++)if(this.pieces_[t]!==e.pieces_[n])return!1;return!0},e.prototype.contains=function(e){var t=this.pieceNum_,n=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0},e}(),B=function(){function e(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(a.z)(this.parts_[n]);this.checkValid_()}return Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=Object(a.z)(e),this.checkValid_()},e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=Object(a.z)(e),this.parts_.length>0&&(this.byteLength_-=1)},e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},e.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},e}(),V="5",H="firebaseio.com",W="websocket",q="long_polling",z=function(){function e(e,t,n,r,i,a,o){void 0===i&&(i=!1),void 0===a&&(a=""),void 0===o&&(o=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=a,this.includeNamespaceInQueryParams=o,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=d.get("host:"+e)||this.host}return e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},e.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&d.set("host:"+this.host,this.internalHost))},e.prototype.connectionURL=function(e,t){var n;if(Object(a.e)("string"===typeof e,"typeof type must == string"),Object(a.e)("object"===typeof t,"typeof params must == object"),e===W)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==q)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return O(t,(function(e,t){r.push(e+"="+t)})),n+r.join("&")},e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},e}();var G,K,Y=function(e,t){var n=Q(e),r=n.namespace;"firebase.com"===n.domain&&S(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||S("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&E("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new z(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new U(n.pathString)}},Q=function(e){var t="",n="",r="",a="",o="",s=!0,u="https",l=443;if("string"===typeof e){var c=e.indexOf("//");c>=0&&(u=e.substring(0,c-1),e=e.substring(c+2));var d=e.indexOf("/");-1===d&&(d=e.length);var h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(d,h)),d<h&&(a=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(a){}t+="/"+i}return t}(e.substring(d,h)));var f=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var a=Object(i.h)(e.split("&")),o=a.next();!o.done;o=a.next()){var s=o.value;if(0!==s.length){var u=s.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):E("Invalid query segment '"+s+"' in query '"+e+"'")}}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,h)));(c=t.indexOf(":"))>=0?(s="https"===u||"wss"===u,l=parseInt(t.substring(c+1),10)):c=t.length;var p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{var g=t.indexOf(".");r=t.substring(0,g).toLowerCase(),n=t.substring(g+1),o=r}"ns"in f&&(o=f.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:s,scheme:u,pathString:a,namespace:o}},X=/[\[\].#$\/\u0000-\u001F\u007F]/,$=/[\[\].#$\u0000-\u001F\u007F]/,J=10485760,Z=function(e){return"string"===typeof e&&0!==e.length&&!X.test(e)},ee=function(e){return"string"===typeof e&&0!==e.length&&!$.test(e)},te=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!P(e)||e&&"object"===typeof e&&Object(a.i)(e,".sv")},ne=function(e,t,n,r,i){i&&void 0===n||re(Object(a.m)(e,t,i),n,r)},re=function(e,t,n){var r=n instanceof U?new B(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+r.toErrorString());if("function"===typeof t)throw new Error(e+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(P(t))throw new Error(e+"contains "+t.toString()+" "+r.toErrorString());if("string"===typeof t&&t.length>J/3&&Object(a.z)(t)>J)throw new Error(e+"contains a string greater than "+"10485760 utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){var i=!1,o=!1;if(O(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!Z(t)))throw new Error(e+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),re(e,n,r),r.pop()})),i&&o)throw new Error(e+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},ie=function(e,t,n,r,i){if(!i||void 0!==n){var o=Object(a.m)(e,t,i);if(!n||"object"!==typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var s=[];O(n,(function(e,t){var n=new U(e);if(re(o,t,r.child(n)),".priority"===n.getBack()&&!te(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=(r=t[n]).slice(),a=0;a<i.length;a++)if(".priority"===i[a]&&a===i.length-1);else if(!Z(i[a]))throw new Error(e+"contains an invalid key ("+i[a]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(U.comparePaths);var o=null;for(n=0;n<t.length;n++){if(r=t[n],null!==o&&o.contains(r))throw new Error(e+"contains a path "+o.toString()+" that is ancestor of another path "+r.toString());o=r}}(o,s)}},ae=function(e,t,n,r){if(!r||void 0!==n){if(P(n))throw new Error(Object(a.m)(e,t,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!te(n))throw new Error(Object(a.m)(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},oe=function(e,t,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(a.m)(e,t,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},se=function(e,t,n,r){if((!r||void 0!==n)&&!Z(n))throw new Error(Object(a.m)(e,t,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ue=function(e,t,n,r){if((!r||void 0!==n)&&!ee(n))throw new Error(Object(a.m)(e,t,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},le=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ue(e,t,n,r)},ce=function(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")},de=function(e,t,n){var r=n.path.toString();if("string"!==typeof n.repoInfo.host||0===n.repoInfo.host.length||!Z(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),ee(e)}(r))throw new Error(Object(a.m)(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},he=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!==typeof n)throw new Error(Object(a.m)(e,t,r)+"must be a boolean.")},fe=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){Object(a.C)("OnDisconnect.cancel",0,1,arguments.length),Object(a.D)("OnDisconnect.cancel",1,e,!0);var t=new a.a;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){Object(a.C)("OnDisconnect.remove",0,1,arguments.length),ce("OnDisconnect.remove",this.path_),Object(a.D)("OnDisconnect.remove",1,e,!0);var t=new a.a;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){Object(a.C)("OnDisconnect.set",1,2,arguments.length),ce("OnDisconnect.set",this.path_),ne("OnDisconnect.set",1,e,this.path_,!1),Object(a.D)("OnDisconnect.set",2,t,!0);var n=new a.a;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){Object(a.C)("OnDisconnect.setWithPriority",2,3,arguments.length),ce("OnDisconnect.setWithPriority",this.path_),ne("OnDisconnect.setWithPriority",1,e,this.path_,!1),ae("OnDisconnect.setWithPriority",2,t,!1),Object(a.D)("OnDisconnect.setWithPriority",3,n,!0);var r=new a.a;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,r.wrapCallback(n)),r.promise},e.prototype.update=function(e,t){if(Object(a.C)("OnDisconnect.update",1,2,arguments.length),ce("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,E("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ie("OnDisconnect.update",1,e,this.path_,!1),Object(a.D)("OnDisconnect.update",2,t,!0);var i=new a.a;return this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t)),i.promise},e}(),pe=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return Object(a.C)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),ge=function(){var e="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",t=0,n=[];return function(r){var i,o=r===t;t=r;var s=new Array(8);for(i=7;i>=0;i--)s[i]=e.charAt(r%64),r=Math.floor(r/64);Object(a.e)(0===r,"Cannot push at time == 0");var u=s.join("");if(o){for(i=11;i>=0&&63===n[i];i--)n[i]=0;n[i]++}else for(i=0;i<12;i++)n[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)u+=e.charAt(n[i]);return Object(a.e)(20===u.length,"nextPushId: Length should be 20."),u}}(),ve=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),me=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new ve(I,e),r=new ve(I,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return ve.MIN},e}(),ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return G},set:function(e){G=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return T(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw Object(a.f)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return ve.MIN},t.prototype.maxPost=function(){return new ve(D,G)},t.prototype.makePost=function(e,t){return Object(a.e)("string"===typeof e,"KeyIndex indexValue must always be a string."),new ve(e,G)},t.prototype.toString=function(){return".key"},t}(me),_e=new ye;var be,we,ke,Se=function(e){return"number"===typeof e?"number:"+M(e):"string:"+e},Ee=function(e){if(e.isLeafNode()){var t=e.val();Object(a.e)("string"===typeof t||"number"===typeof t||"object"===typeof t&&Object(a.i)(t,".sv"),"Priority must be a string or number.")}else Object(a.e)(e===K||e.isEmpty(),"priority of unexpected type.");Object(a.e)(e===K||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Pe=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Object(a.e)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ee(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return be},set:function(e){be=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=t.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(a.e)(".priority"!==r||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Se(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?M(this.value_):this.value_,this.lazyHash_=g(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Object(a.e)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return Object(a.e)(i>=0,"Unknown leaf type: "+n),Object(a.e)(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var Ie,De,Te=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?T(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return ve.MIN},t.prototype.maxPost=function(){return new ve(D,new Pe("[PRIORITY-POST]",ke))},t.prototype.makePost=function(e,t){var n=we(e);return new ve(t,new Pe("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(me)),xe=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var a=1;!e.isEmpty();)if(e=e,a=t?n(e.key,t):1,r&&(a*=-1),a<0)e=this.isReverse_?e.left:e.right;else{if(0===a){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Ce=function(){function e(t,n,r,i,a){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Le.EMPTY_NODE,this.right=null!=a?a:Le.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Le.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Le.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Ae=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new Ce(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Le=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Ce.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ce.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new xe(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new xe(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new xe(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new xe(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Ae,e}(),Oe=Math.log(2),Me=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Oe,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),Re=function(e,t,n,r){e.sort(t);var i=function(t,r){var a,o,s=r-t;if(0===s)return null;if(1===s)return a=e[t],o=n?n(a):a,new Ce(o,a.node,Ce.BLACK,null,null);var u=parseInt(s/2,10)+t,l=i(t,u),c=i(u+1,r);return a=e[u],o=n?n(a):a,new Ce(o,a.node,Ce.BLACK,l,c)},a=function(t){for(var r=null,a=null,o=e.length,s=function(t,r){var a=o-t,s=o;o-=t;var l=i(a+1,s),c=e[a],d=n?n(c):c;u(new Ce(d,c.node,r,null,l))},u=function(e){r?(r.left=e,r=e):(a=e,r=e)},l=0;l<t.count;++l){var c=t.nextBitIsOne(),d=Math.pow(2,t.count-(l+1));c?s(d,Ce.BLACK):(s(d,Ce.BLACK),s(d,Ce.RED))}return a}(new Me(e.length));return new Le(r||t,a)},Fe={},Ne=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return Object(a.e)(Fe&&Te,"ChildrenNode.ts has not been loaded"),Ie=Ie||new e({".priority":Fe},{".priority":Te})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=Object(a.y)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Le?t:null},e.prototype.hasIndex=function(e){return Object(a.i)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){Object(a.e)(t!==_e,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,o=[],s=!1,u=n.getIterator(ve.Wrap),l=u.getNext();l;)s=s||t.isDefinedOn(l.node),o.push(l),l=u.getNext();r=s?Re(o,t.getCompare()):Fe;var c=t.toString(),d=Object(i.a)({},this.indexSet_);d[c]=t;var h=Object(i.a)({},this.indexes_);return h[c]=r,new e(h,d)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(Object(a.w)(this.indexes_,(function(e,i){var o=Object(a.y)(r.indexSet_,i);if(Object(a.e)(o,"Missing index implementation for "+i),e===Fe){if(o.isDefinedOn(t.node)){for(var s=[],u=n.getIterator(ve.Wrap),l=u.getNext();l;)l.name!==t.name&&s.push(l),l=u.getNext();return s.push(t),Re(s,o.getCompare())}return Fe}var c=n.get(t.name),d=e;return c&&(d=d.remove(new ve(t.name,c))),d.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(Object(a.w)(this.indexes_,(function(e){if(e===Fe)return e;var r=n.get(t.name);return r?e.remove(new ve(t.name,r)):e})),this.indexSet_)},e}();function je(e,t){return T(e.name,t.name)}function Ue(e,t){return T(e,t)}var Be=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ee(this.priorityNode_),this.children_.isEmpty()&&Object(a.e)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return De||(De=new e(new Le(Ue),null,Ne.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||De},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?De:t},e.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(Object(a.e)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new ve(t,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(r,this.children_));var s=i.isEmpty()?De:this.priorityNode_;return new e(i,s,o)},e.prototype.updateChild=function(e,t){var n=e.getFront();if(null===n)return t;Object(a.e)(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(e.popFront(),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,a=!0;if(this.forEachChild(Te,(function(o,s){n[o]=s.val(t),r++,a&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):a=!1})),!t&&a&&i<2*r){var o=[];for(var s in n)o[s]=n[s];return o}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Se(this.getPriority().val())+":"),this.forEachChild(Te,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":g(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ve(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new ve(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new ve(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,ve.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,ve.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ve?-1:0},e.prototype.withIndex=function(t){if(t===_e||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===_e||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(Te),r=t.getIterator(Te),i=n.getNext(),a=r.getNext();i&&a;){if(i.name!==a.name||!i.node.equals(a.node))return!1;i=n.getNext(),a=r.getNext()}return null===i&&null===a}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===_e?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),Ve=new(function(e){function t(){return e.call(this,new Le(Ue),Be.EMPTY_NODE,Ne.Default)||this}return Object(i.c)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return Be.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(Be));Object.defineProperties(ve,{MIN:{value:new ve(I,Be.EMPTY_NODE)},MAX:{value:new ve(D,Ve)}}),ye.__EMPTY_NODE=Be.EMPTY_NODE,Pe.__childrenNodeConstructor=Be,K=Ve,function(e){ke=e}(Ve);function He(e,t){if(void 0===t&&(t=null),null===e)return Be.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),Object(a.e)(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e)return new Pe(e,He(t));if(e instanceof Array){var n=Be.EMPTY_NODE;return O(e,(function(t,r){if(Object(a.i)(e,t)&&"."!==t.substring(0,1)){var i=He(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(He(t))}var r=[],i=!1;if(O(e,(function(e,t){if("."!==e.substring(0,1)){var n=He(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new ve(e,n)))}})),0===r.length)return Be.EMPTY_NODE;var o=Re(r,je,(function(e){return e.name}),Ue);if(i){var s=Re(r,Te.getCompare());return new Be(o,He(t),new Ne({".priority":s},{".priority":Te}))}return new Be(o,He(t),Ne.Default)}!function(e){we=e}(He);var We,qe=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?T(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return ve.MIN},t.prototype.maxPost=function(){return ve.MAX},t.prototype.makePost=function(e,t){var n=He(e);return new ve(t,n)},t.prototype.toString=function(){return".value"},t}(me)),ze=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,Object(a.e)(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Object(i.c)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?T(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=He(e),r=Be.EMPTY_NODE.updateChild(this.indexPath_,n);return new ve(t,r)},t.prototype.maxPost=function(){var e=Be.EMPTY_NODE.updateChild(this.indexPath_,Ve);return new ve(D,e)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(me),Ge=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return Object(a.C)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return Object(a.C)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return Object(a.C)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return Object(a.C)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){Object(a.C)("DataSnapshot.child",0,1,arguments.length),t=String(t),ue("DataSnapshot.child",1,t,!1);var n=new U(t),r=this.ref_.child(n);return new e(this.node_.getChild(n),r,Te)},e.prototype.hasChild=function(e){Object(a.C)("DataSnapshot.hasChild",1,1,arguments.length),ue("DataSnapshot.hasChild",1,e,!1);var t=new U(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return Object(a.C)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;if(Object(a.C)("DataSnapshot.forEach",1,1,arguments.length),Object(a.D)("DataSnapshot.forEach",1,t,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return t(new e(i,n.ref_.child(r),Te))}))},e.prototype.hasChildren=function(){return Object(a.C)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return Object(a.C)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return Object(a.C)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Ke=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(a.B)(this.snapshot.exportVal())},e}(),Ye=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Qe=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new Ke("value",this,new Ge(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(a.e)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Ye(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),Xe=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,Object(a.i)(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Ye(this,e,t):null},e.prototype.createEvent=function(e,t){Object(a.e)(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),r=t.getQueryParams().getIndex();return new Ke(e.type,this,new Ge(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(a.e)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){var n=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var r=Object.keys(t.callbacks_),i=Object.keys(this.callbacks_),a=r.length;if(a===i.length){if(1===a){var o=r[0],s=i[0];return s===o&&(!t.callbacks_[o]||!this.callbacks_[s]||t.callbacks_[o]===this.callbacks_[s])}return i.every((function(e){return t.callbacks_[e]===n.callbacks_[e]}))}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}(),$e=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(a.e)(We,"Reference.ts has not been loaded"),We},set:function(e){We=e},enumerable:!1,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===_e){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==I)throw new Error(r);if("string"!==typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==D)throw new Error(r);if("string"!==typeof n)throw new Error(i)}}else if(e.getIndex()===Te){if(null!=t&&!te(t)||null!=n&&!te(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(a.e)(e.getIndex()instanceof ze||e.getIndex()===qe,"unknown index type."),null!=t&&"object"===typeof t||null!=n&&"object"===typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return Object(a.C)("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,r,i){Object(a.C)("Query.on",2,4,arguments.length),oe("Query.on",1,t,!1),Object(a.D)("Query.on",2,n,!1);var o=e.getCancelAndContextArgs_("Query.on",r,i);if("value"===t)this.onValueEvent(n,o.cancel,o.context);else{var s={};s[t]=n,this.onChildEvent(s,o.cancel,o.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new Qe(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new Xe(e,t,n);this.repo.addEventCallbackForQuery(this,r)},e.prototype.off=function(e,t,n){Object(a.C)("Query.off",0,3,arguments.length),oe("Query.off",1,e,!0),Object(a.D)("Query.off",2,t,!0),Object(a.E)("Query.off",3,n,!0);var r=null,i=null;if("value"===e){var o=t||null;r=new Qe(o,null,n||null)}else e&&(t&&((i={})[e]=t),r=new Xe(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},e.prototype.once=function(t,n,r,i){var o=this;Object(a.C)("Query.once",1,4,arguments.length),oe("Query.once",1,t,!1),Object(a.D)("Query.once",2,n,!0);var s=e.getCancelAndContextArgs_("Query.once",r,i),u=!0,l=new a.a;l.promise.catch((function(){}));var c=function(e){u&&(u=!1,o.off(t,c),n&&n.bind(s.context)(e),l.resolve(e))};return this.on(t,c,(function(e){o.off(t,c),s.cancel&&s.cancel.bind(s.context)(e),l.reject(e)})),l.promise},e.prototype.limitToFirst=function(t){if(Object(a.C)("Query.limitToFirst",1,1,arguments.length),"number"!==typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if(Object(a.C)("Query.limitToLast",1,1,arguments.length),"number"!==typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if(Object(a.C)("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ue("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new U(t);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new ze(n),i=this.queryParams_.orderBy(r);return e.validateQueryEndpoints_(i),new e(this.repo,this.path,i,!0)},e.prototype.orderByKey=function(){Object(a.C)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(_e);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){Object(a.C)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Te);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){Object(a.C)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(qe);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),Object(a.C)("Query.startAt",0,2,arguments.length),ne("Query.startAt",1,t,this.path,!0),se("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),Object(a.C)("Query.endAt",0,2,arguments.length),ne("Query.endAt",1,t,this.path,!0),se("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if(Object(a.C)("Query.equalTo",1,2,arguments.length),ne("Query.equalTo",1,e,this.path,!1),se("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return Object(a.C)("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},e.prototype.toJSON=function(){return Object(a.C)("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=A(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if(Object(a.C)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var r=this.repo===t.repo,i=this.path.equals(t.path),o=this.queryIdentifier()===t.queryIdentifier();return r&&i&&o},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:null,context:null};if(t&&n)r.cancel=t,Object(a.D)(e,3,r.cancel,!0),r.context=n,Object(a.E)(e,4,r.context,!0);else if(t)if("object"===typeof t&&null!==t)r.context=t;else{if("function"!==typeof t)throw new Error(Object(a.m)(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Je=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),Ze=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=this.path_.child(t);return new e(this.syncTree_,n)},e.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},e}(),et=function(e,t,n){return e&&"object"===typeof e?(Object(a.e)(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?tt(e[".sv"],t,n):"object"===typeof e[".sv"]?nt(e[".sv"],t):void Object(a.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},tt=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:Object(a.e)(!1,"Unexpected server value: "+e)}},nt=function(e,t,n){e.hasOwnProperty("increment")||Object(a.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!==typeof r&&Object(a.e)(!1,"Unexpected increment value: "+r);var i=t.node();if(Object(a.e)(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var o=i.getValue();return"number"!==typeof o?r:o+r},rt=function(e,t,n,r){return at(t,new Ze(n,e),r)},it=function(e,t,n){return at(e,new Je(t),n)};function at(e,t,n){var r,i=e.getPriority().val(),a=et(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var o=e,s=et(o.getValue(),t,n);return s!==o.getValue()||a!==o.getPriority().val()?new Pe(s,He(a)):e}var u=e;return r=u,a!==u.getPriority().val()&&(r=r.updatePriority(new Pe(a))),u.forEachChild(Te,(function(e,i){var a=at(i,t.getImmediateChild(e),n);a!==i&&(r=r.updateImmediateChild(e,a))})),r}var ot,st=function(){function e(){this.value=null,this.children=new Map}return e.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},e.prototype.remember=function(t,n){if(t.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,n);else{var r=t.getFront();this.children.has(r)||this.children.set(r,new e);var i=this.children.get(r);t=t.popFront(),i.remember(t,n)}},e.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var n=this;return t.forEachChild(Te,(function(e,t){n.remember(new U(e),t)})),this.forget(e)}if(this.children.size>0){var r=e.getFront();if(e=e.popFront(),this.children.has(r))this.children.get(r).forget(e)&&this.children.delete(r);return 0===this.children.size}return!0},e.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild((function(n,r){var i=new U(e.toString()+"/"+n);r.forEachTree(i,t)}))},e.prototype.forEachChild=function(e){this.children.forEach((function(t,n){e(n,t)}))},e}();!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ot||(ot={}));var ut,lt,ct=function(){function e(e,t,n,r){this.fromUser=e,this.fromServer=t,this.queryId=n,this.tagged=r,Object(a.e)(!r||t,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),dt=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ot.ACK_USER_WRITE,this.source=ct.User}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Object(a.e)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new U(t));return new e(U.Empty,n,this.revert)}return Object(a.e)(this.path.getFront()===t,"operationForChild called for unrelated child."),new e(this.path.popFront(),this.affectedTree,this.revert)},e}(),ht=function(){function e(e,t){void 0===t&&(ut||(ut=new Le(x)),t=ut),this.value=e,this.children=t}return e.fromObject=function(t){var n=e.Empty;return O(t,(function(e,t){n=n.set(new U(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:U.Empty,value:this.value};if(e.isEmpty())return null;var n=e.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=i?{path:new U(n).child(i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(t.isEmpty())return this;var n=t.getFront(),r=this.children.get(n);return null!==r?r.subtree(t.popFront()):e.Empty},e.prototype.set=function(t,n){if(t.isEmpty())return new e(n,this.children);var r=t.getFront(),i=(this.children.get(r)||e.Empty).set(t.popFront(),n),a=this.children.insert(r,i);return new e(this.value,a)},e.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?e.Empty:new e(null,this.children);var n=t.getFront(),r=this.children.get(n);if(r){var i=r.remove(t.popFront()),a=void 0;return a=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&a.isEmpty()?e.Empty:new e(this.value,a)}return this},e.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),n=this.children.get(t);return n?n.get(e.popFront()):null},e.prototype.setTree=function(t,n){if(t.isEmpty())return n;var r=t.getFront(),i=(this.children.get(r)||e.Empty).setTree(t.popFront(),n),a=void 0;return a=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,a)},e.prototype.fold=function(e){return this.fold_(U.Empty,e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(e.child(r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,U.Empty,t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(e.isEmpty())return null;var i=e.getFront(),a=this.children.get(i);return a?a.findOnPath_(e.popFront(),t.child(i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,U.Empty,t)},e.prototype.foreachOnPath_=function(t,n,r){if(t.isEmpty())return this;this.value&&r(n,this.value);var i=t.getFront(),a=this.children.get(i);return a?a.foreachOnPath_(t.popFront(),n.child(i),r):e.Empty},e.prototype.foreach=function(e){this.foreach_(U.Empty,e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(e.child(n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e.Empty=new e(null),e}(),ft=function(){function e(e,t){this.source=e,this.path=t,this.type=ot.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,U.Empty):new e(this.source,this.path.popFront())},e}(),pt=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ot.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,U.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),gt=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ot.MERGE}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var n=this.children.subtree(new U(t));return n.isEmpty()?null:n.value?new pt(this.source,U.Empty,n.value):new e(this.source,U.Empty,n)}return Object(a.e)(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,this.path.popFront(),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),vt=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),mt=function(){function e(e,t){this.eventCache_=e,this.serverCache_=t}return e.prototype.updateEventSnap=function(t,n,r){return new e(new vt(t,n,r),this.serverCache_)},e.prototype.updateServerSnap=function(t,n,r){return new e(this.eventCache_,new vt(t,n,r))},e.prototype.getEventCache=function(){return this.eventCache_},e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},e.prototype.getServerCache=function(){return this.serverCache_},e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},e.Empty=new e(new vt(Be.EMPTY_NODE,!1,!1),new vt(Be.EMPTY_NODE,!1,!1)),e}(),yt=function(){function e(e,t,n,r,i){this.type=e,this.snapshotNode=t,this.childName=n,this.oldSnap=r,this.prevName=i}return e.valueChange=function(t){return new e(e.VALUE,t)},e.childAddedChange=function(t,n){return new e(e.CHILD_ADDED,n,t)},e.childRemovedChange=function(t,n){return new e(e.CHILD_REMOVED,n,t)},e.childChangedChange=function(t,n,r){return new e(e.CHILD_CHANGED,n,t,r)},e.childMovedChange=function(t,n){return new e(e.CHILD_MOVED,n,t)},e.CHILD_ADDED="child_added",e.CHILD_REMOVED="child_removed",e.CHILD_CHANGED="child_changed",e.CHILD_MOVED="child_moved",e.VALUE="value",e}(),_t=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){Object(a.e)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(yt.childRemovedChange(t,s)):Object(a.e)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(yt.childAddedChange(t,n)):o.trackChildChange(yt.childChangedChange(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Te,(function(e,r){t.hasChild(e)||n.trackChildChange(yt.childRemovedChange(e,r))})),t.isLeafNode()||t.forEachChild(Te,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(yt.childChangedChange(t,r,i))}else n.trackChildChange(yt.childAddedChange(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?Be.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),bt=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;Object(a.e)(t===yt.CHILD_ADDED||t===yt.CHILD_CHANGED||t===yt.CHILD_REMOVED,"Only child changes supported for tracking"),Object(a.e)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(t===yt.CHILD_ADDED&&i===yt.CHILD_REMOVED)this.changeMap.set(n,yt.childChangedChange(n,e.snapshotNode,r.snapshotNode));else if(t===yt.CHILD_REMOVED&&i===yt.CHILD_ADDED)this.changeMap.delete(n);else if(t===yt.CHILD_REMOVED&&i===yt.CHILD_CHANGED)this.changeMap.set(n,yt.childRemovedChange(n,r.oldSnap));else if(t===yt.CHILD_CHANGED&&i===yt.CHILD_ADDED)this.changeMap.set(n,yt.childAddedChange(n,e.snapshotNode));else{if(t!==yt.CHILD_CHANGED||i!==yt.CHILD_CHANGED)throw Object(a.f)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,yt.childChangedChange(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),wt=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),kt=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new vt(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},e}(),St=function(e,t){this.viewCache=e,this.changes=t},Et=function(){function e(e){this.filter_=e}return e.prototype.assertIndexed=function(e){Object(a.e)(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Object(a.e)(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},e.prototype.applyOperation=function(t,n,r,i){var o,s,u=new bt;if(n.type===ot.OVERWRITE){var l=n;l.source.fromUser?o=this.applyUserOverwrite_(t,l.path,l.snap,r,i,u):(Object(a.e)(l.source.fromServer,"Unknown source."),s=l.source.tagged||t.getServerCache().isFiltered()&&!l.path.isEmpty(),o=this.applyServerOverwrite_(t,l.path,l.snap,r,i,s,u))}else if(n.type===ot.MERGE){var c=n;c.source.fromUser?o=this.applyUserMerge_(t,c.path,c.children,r,i,u):(Object(a.e)(c.source.fromServer,"Unknown source."),s=c.source.tagged||t.getServerCache().isFiltered(),o=this.applyServerMerge_(t,c.path,c.children,r,i,s,u))}else if(n.type===ot.ACK_USER_WRITE){var d=n;o=d.revert?this.revertUserWrite_(t,d.path,r,i,u):this.ackUserWrite_(t,d.path,d.affectedTree,r,i,u)}else{if(n.type!==ot.LISTEN_COMPLETE)throw Object(a.f)("Unknown operation type: "+n.type);o=this.listenComplete_(t,n.path,r,u)}var h=u.getChanges();return e.maybeAddValueEvent_(t,o,h),new St(o,h)},e.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=e.getCompleteEventSnap();(n.length>0||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&n.push(yt.valueChange(t.getCompleteEventSnap()))}},e.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,r,i){var o=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var s=void 0,u=void 0;if(t.isEmpty())if(Object(a.e)(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var l=e.getCompleteServerSnap(),c=l instanceof Be?l:Be.EMPTY_NODE,d=n.calcCompleteEventChildren(c);s=this.filter_.updateFullNode(e.getEventCache().getNode(),d,i)}else{var h=n.calcCompleteEventCache(e.getCompleteServerSnap());s=this.filter_.updateFullNode(e.getEventCache().getNode(),h,i)}else{var f=t.getFront();if(".priority"===f){Object(a.e)(1===t.getLength(),"Can't have a priority with additional path components");var p=o.getNode();u=e.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(t,p,u);s=null!=g?this.filter_.updatePriority(p,g):o.getNode()}else{var v=t.popFront(),m=void 0;if(o.isCompleteForChild(f)){u=e.getServerCache().getNode();var y=n.calcEventCacheAfterServerOverwrite(t,o.getNode(),u);m=null!=y?o.getNode().getImmediateChild(f).updateChild(v,y):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,e.getServerCache());s=null!=m?this.filter_.updateChild(o.getNode(),f,m,v,r,i):o.getNode()}}return e.updateEventSnap(s,o.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},e.prototype.applyServerOverwrite_=function(e,t,n,r,i,a,o){var s,u=e.getServerCache(),l=a?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())s=l.updateFullNode(u.getNode(),n,null);else if(l.filtersNodes()&&!u.isFiltered()){var c=u.getNode().updateChild(t,n);s=l.updateFullNode(u.getNode(),c,null)}else{var d=t.getFront();if(!u.isCompleteForPath(t)&&t.getLength()>1)return e;var h=t.popFront(),f=u.getNode().getImmediateChild(d).updateChild(h,n);s=".priority"===d?l.updatePriority(u.getNode(),f):l.updateChild(u.getNode(),d,f,h,wt,null)}var p=e.updateServerSnap(s,u.isFullyInitialized()||t.isEmpty(),l.filtersNodes()),g=new kt(r,p,i);return this.generateEventCacheAfterServerEvent_(p,t,r,g,o)},e.prototype.applyUserOverwrite_=function(e,t,n,r,i,a){var o,s,u=e.getEventCache(),l=new kt(r,e,i);if(t.isEmpty())s=this.filter_.updateFullNode(e.getEventCache().getNode(),n,a),o=e.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var c=t.getFront();if(".priority"===c)s=this.filter_.updatePriority(e.getEventCache().getNode(),n),o=e.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var d=t.popFront(),h=u.getNode().getImmediateChild(c),f=void 0;if(d.isEmpty())f=n;else{var p=l.getCompleteChild(c);f=null!=p?".priority"===d.getBack()&&p.getChild(d.parent()).isEmpty()?p:p.updateChild(d,n):Be.EMPTY_NODE}if(h.equals(f))o=e;else{var g=this.filter_.updateChild(u.getNode(),c,f,d,l,a);o=e.updateEventSnap(g,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return o},e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},e.prototype.applyUserMerge_=function(t,n,r,i,a,o){var s=this,u=t;return r.foreach((function(r,l){var c=n.child(r);e.cacheHasChild_(t,c.getFront())&&(u=s.applyUserOverwrite_(u,c,l,i,a,o))})),r.foreach((function(r,l){var c=n.child(r);e.cacheHasChild_(t,c.getFront())||(u=s.applyUserOverwrite_(u,c,l,i,a,o))})),u},e.prototype.applyMerge_=function(e,t){return t.foreach((function(t,n){e=e.updateChild(t,n)})),e},e.prototype.applyServerMerge_=function(e,t,n,r,i,a,o){var s=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var u,l=e;u=t.isEmpty()?n:ht.Empty.setTree(t,n);var c=e.getServerCache().getNode();return u.children.inorderTraversal((function(t,n){if(c.hasChild(t)){var u=e.getServerCache().getNode().getImmediateChild(t),d=s.applyMerge_(u,n);l=s.applyServerOverwrite_(l,new U(t),d,r,i,a,o)}})),u.children.inorderTraversal((function(t,n){var u=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!c.hasChild(t)&&!u){var d=e.getServerCache().getNode().getImmediateChild(t),h=s.applyMerge_(d,n);l=s.applyServerOverwrite_(l,new U(t),h,r,i,a,o)}})),l},e.prototype.ackUserWrite_=function(e,t,n,r,i,a){if(null!=r.shadowingWrite(t))return e;var o=e.getServerCache().isFiltered(),s=e.getServerCache();if(null!=n.value){if(t.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,s.getNode().getChild(t),r,i,o,a);if(t.isEmpty()){var u=ht.Empty;return s.getNode().forEachChild(_e,(function(e,t){u=u.set(new U(e),t)})),this.applyServerMerge_(e,t,u,r,i,o,a)}return e}var l=ht.Empty;return n.foreach((function(e,n){var r=t.child(e);s.isCompleteForPath(r)&&(l=l.set(e,s.getNode().getChild(r)))})),this.applyServerMerge_(e,t,l,r,i,o,a)},e.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),a=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(a,t,n,wt,r)},e.prototype.revertUserWrite_=function(e,t,n,r,i){var o;if(null!=n.shadowingWrite(t))return e;var s=new kt(n,e,r),u=e.getEventCache().getNode(),l=void 0;if(t.isEmpty()||".priority"===t.getFront()){var c=void 0;if(e.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var d=e.getServerCache().getNode();Object(a.e)(d instanceof Be,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(d)}c=c,l=this.filter_.updateFullNode(u,c,i)}else{var h=t.getFront(),f=n.calcCompleteChild(h,e.getServerCache());null==f&&e.getServerCache().isCompleteForChild(h)&&(f=u.getImmediateChild(h)),(l=null!=f?this.filter_.updateChild(u,h,f,t.popFront(),s,i):e.getEventCache().getNode().hasChild(h)?this.filter_.updateChild(u,h,Be.EMPTY_NODE,t.popFront(),s,i):u).isEmpty()&&e.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(l=this.filter_.updateFullNode(l,o,i))}return o=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(U.Empty),e.updateEventSnap(l,o,this.filter_.filtersNodes())},e}(),Pt=function(){function e(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return e.prototype.generateEventsForChanges=function(e,t,n){var r=this,i=[],a=[];return e.forEach((function(e){e.type===yt.CHILD_CHANGED&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&a.push(yt.childMovedChange(e.childName,e.snapshotNode))})),this.generateEventsForType_(i,yt.CHILD_REMOVED,e,n,t),this.generateEventsForType_(i,yt.CHILD_ADDED,e,n,t),this.generateEventsForType_(i,yt.CHILD_MOVED,a,n,t),this.generateEventsForType_(i,yt.CHILD_CHANGED,e,n,t),this.generateEventsForType_(i,yt.VALUE,e,n,t),i},e.prototype.generateEventsForType_=function(e,t,n,r,i){var a=this,o=n.filter((function(e){return e.type===t}));o.sort(this.compareChanges_.bind(this)),o.forEach((function(t){var n=a.materializeSingleChange_(t,i);r.forEach((function(r){r.respondsTo(t.type)&&e.push(r.createEvent(n,a.query_))}))}))},e.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_)),e},e.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw Object(a.f)("Should only compare child_ events.");var n=new ve(e.childName,e.snapshotNode),r=new ve(t.childName,t.snapshotNode);return this.index_.compare(n,r)},e}(),It=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new _t(n.getIndex()),i=n.getNodeFilter();this.processor_=new Et(i);var a=t.getServerCache(),o=t.getEventCache(),s=r.updateFullNode(Be.EMPTY_NODE,a.getNode(),null),u=i.updateFullNode(Be.EMPTY_NODE,o.getNode(),null),l=new vt(s,a.isFullyInitialized(),r.filtersNodes()),c=new vt(u,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=new mt(c,l),this.eventGenerator_=new Pt(this.query_)}return e.prototype.getQuery=function(){return this.query_},e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},e.prototype.removeEventRegistration=function(e,t){var n=[];if(t){Object(a.e)(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(e){t=t;var i=e.createCancelEvent(t,r);i&&n.push(i)}))}if(e){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(e)){if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},e.prototype.applyOperation=function(e,t,n){e.type===ot.MERGE&&null!==e.source.queryId&&(Object(a.e)(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Object(a.e)(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,e,t,n);return this.processor_.assertIndexed(i.viewCache),Object(a.e)(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(Te,(function(e,t){n.push(yt.childAddedChange(e,t))}));return t.isFullyInitialized()&&n.push(yt.valueChange(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},e.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},e}(),Dt=function(){function e(){this.views=new Map}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(a.e)(lt,"Reference.ts has not been loaded"),lt},set:function(e){Object(a.e)(!lt,"__referenceConstructor has already been defined"),lt=e},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.views.size},e.prototype.applyOperation=function(e,t,n){var r,o,s=e.source.queryId;if(null!==s){var u=this.views.get(s);return Object(a.e)(null!=u,"SyncTree gave us an op for an invalid query."),u.applyOperation(e,t,n)}var l=[];try{for(var c=Object(i.h)(this.views.values()),d=c.next();!d.done;d=c.next()){u=d.value;l=l.concat(u.applyOperation(e,t,n))}}catch(h){r={error:h}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}return l},e.prototype.addEventRegistration=function(e,t,n,r,i){var a=e.queryIdentifier(),o=this.views.get(a);if(!o){var s=n.calcCompleteEventCache(i?r:null),u=!1;s?u=!0:r instanceof Be?(s=n.calcCompleteEventChildren(r),u=!1):(s=Be.EMPTY_NODE,u=!1);var l=new mt(new vt(s,u,!1),new vt(r,i,!1));o=new It(e,l),this.views.set(a,o)}return o.addEventRegistration(t),o.getInitialEvents(t)},e.prototype.removeEventRegistration=function(t,n,r){var a,o,s=t.queryIdentifier(),u=[],l=[],c=this.hasCompleteView();if("default"===s)try{for(var d=Object(i.h)(this.views.entries()),h=d.next();!h.done;h=d.next()){var f=Object(i.e)(h.value,2),p=f[0],g=f[1];l=l.concat(g.removeEventRegistration(n,r)),g.isEmpty()&&(this.views.delete(p),g.getQuery().getQueryParams().loadsAllData()||u.push(g.getQuery()))}}catch(v){a={error:v}}finally{try{h&&!h.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}else(g=this.views.get(s))&&(l=l.concat(g.removeEventRegistration(n,r)),g.isEmpty()&&(this.views.delete(s),g.getQuery().getQueryParams().loadsAllData()||u.push(g.getQuery())));return c&&!this.hasCompleteView()&&u.push(new e.__referenceConstructor(t.repo,t.path)),{removed:u,events:l}},e.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=Object(i.h)(this.views.values()),a=r.next();!a.done;a=r.next()){var o=a.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},e.prototype.getCompleteServerCache=function(e){var t,n,r=null;try{for(var a=Object(i.h)(this.views.values()),o=a.next();!o.done;o=a.next()){var s=o.value;r=r||s.getCompleteServerCache(e)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r},e.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return this.views.get(t)},e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},e.prototype.getCompleteView=function(){var e,t;try{for(var n=Object(i.h)(this.views.values()),r=n.next();!r.done;r=n.next()){var a=r.value;if(a.getQuery().getQueryParams().loadsAllData())return a}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},e}(),Tt=function(){function e(e){this.writeTree_=e}return e.prototype.addWrite=function(t,n){if(t.isEmpty())return new e(new ht(n));var r=this.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,a=r.value,o=U.relativePath(i,t);return a=a.updateChild(o,n),new e(this.writeTree_.set(i,a))}var s=new ht(n);return new e(this.writeTree_.setTree(t,s))},e.prototype.addWrites=function(e,t){var n=this;return O(t,(function(t,r){n=n.addWrite(e.child(t),r)})),n},e.prototype.removeWrite=function(t){return t.isEmpty()?e.Empty:new e(this.writeTree_.setTree(t,ht.Empty))},e.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(U.relativePath(t.path,e)):null},e.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Te,(function(t,n){e.push(new ve(t,n))})):this.writeTree_.children.inorderTraversal((function(t,n){null!=n.value&&e.push(new ve(t,n.value))})),e},e.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var n=this.getCompleteNode(t);return new e(null!=n?new ht(n):this.writeTree_.subtree(t))},e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},e.prototype.apply=function(e){return xt(U.Empty,this.writeTree_,e)},e.Empty=new e(new ht(null)),e}();function xt(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?(Object(a.e)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=xt(e.child(t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(e.child(".priority"),r)),n}var Ct=function(){function e(){this.visibleWrites_=Tt.Empty,this.allWrites_=[],this.lastWriteId_=-1}return e.prototype.childWrites=function(e){return new At(e,this)},e.prototype.addOverwrite=function(e,t,n,r){Object(a.e)(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=n},e.prototype.addMerge=function(e,t,n){Object(a.e)(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=n},e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},e.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex((function(t){return t.writeId===e}));Object(a.e)(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,s=this.allWrites_.length-1;i&&s>=0;){var u=this.allWrites_[s];u.visible&&(s>=n&&this.recordContainsPath_(u,r.path)?i=!1:r.path.contains(u.path)&&(o=!0)),s--}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):O(r.children,(function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(r.path.child(e))}));return!0}return!1},e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcCompleteEventCache=function(t,n,r,i){if(r||i){var a=this.visibleWrites_.childCompoundWrite(t);if(!i&&a.isEmpty())return n;if(i||null!=n||a.hasCompleteWrite(U.Empty)){var o=e.layerTree_(this.allWrites_,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))}),t);l=n||Be.EMPTY_NODE;return o.apply(l)}return null}var s=this.visibleWrites_.getCompleteNode(t);if(null!=s)return s;var u=this.visibleWrites_.childCompoundWrite(t);if(u.isEmpty())return n;if(null!=n||u.hasCompleteWrite(U.Empty)){var l=n||Be.EMPTY_NODE;return u.apply(l)}return null},e.prototype.calcCompleteEventChildren=function(e,t){var n=Be.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(Te,(function(e,t){n=n.updateImmediateChild(e,t)})),n;if(t){var i=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(Te,(function(e,t){var r=i.childCompoundWrite(new U(e)).apply(t);n=n.updateImmediateChild(e,r)})),i.getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,r){Object(a.e)(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=e.child(t);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(t):o.apply(r.getChild(t))},e.prototype.calcCompleteChild=function(e,t,n){var r=e.child(t),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(t)):null},e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcIndexedSlice=function(e,t,n,r,i,a){var o,s=this.visibleWrites_.childCompoundWrite(e),u=s.getCompleteNode(U.Empty);if(null!=u)o=u;else{if(null==t)return[];o=s.apply(t)}if((o=o.withIndex(a)).isEmpty()||o.isLeafNode())return[];for(var l=[],c=a.getCompare(),d=i?o.getReverseIteratorFrom(n,a):o.getIteratorFrom(n,a),h=d.getNext();h&&l.length<r;)0!==c(h,n)&&l.push(h),h=d.getNext();return l},e.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&e.path.child(n).contains(t))return!0;return!1},e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,U.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},e.DefaultFilter_=function(e){return e.visible},e.layerTree_=function(e,t,n){for(var r=Tt.Empty,i=0;i<e.length;++i){var o=e[i];if(t(o)){var s=o.path,u=void 0;if(o.snap)n.contains(s)?(u=U.relativePath(n,s),r=r.addWrite(u,o.snap)):s.contains(n)&&(u=U.relativePath(s,n),r=r.addWrite(U.Empty,o.snap.getChild(u)));else{if(!o.children)throw Object(a.f)("WriteRecord should have .snap or .children");if(n.contains(s))u=U.relativePath(n,s),r=r.addWrites(u,o.children);else if(s.contains(n))if((u=U.relativePath(s,n)).isEmpty())r=r.addWrites(U.Empty,o.children);else{var l=Object(a.y)(o.children,u.getFront());if(l){var c=l.getChild(u.popFront());r=r.addWrite(U.Empty,c)}}}}}return r},e}(),At=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},e.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),Lt=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=ht.Empty,this.pendingWriteTree_=new Ct,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return e.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new pt(ct.User,e,t)):[]},e.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=ht.fromObject(t);return this.applyOperationToSyncPoints_(new gt(ct.User,e,r))},e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=ht.Empty;return null!=n.snap?r=r.set(U.Empty,!0):O(n.children,(function(e,t){r=r.set(new U(e),t)})),this.applyOperationToSyncPoints_(new dt(n.path,r,t))}return[]},e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new pt(ct.Server,e,t))},e.prototype.applyServerMerge=function(e,t){var n=ht.fromObject(t);return this.applyOperationToSyncPoints_(new gt(ct.Server,e,n))},e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new ft(ct.Server,e))},e.prototype.applyTaggedQueryOverwrite=function(t,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var a=e.parseQueryKey_(i),o=a.path,s=a.queryId,u=U.relativePath(o,t),l=new pt(ct.forServerTaggedQuery(s),u,n);return this.applyTaggedOperation_(o,l)}return[]},e.prototype.applyTaggedQueryMerge=function(t,n,r){var i=this.queryKeyForTag_(r);if(i){var a=e.parseQueryKey_(i),o=a.path,s=a.queryId,u=U.relativePath(o,t),l=ht.fromObject(n),c=new gt(ct.forServerTaggedQuery(s),u,l);return this.applyTaggedOperation_(o,c)}return[]},e.prototype.applyTaggedListenComplete=function(t,n){var r=this.queryKeyForTag_(n);if(r){var i=e.parseQueryKey_(r),a=i.path,o=i.queryId,s=U.relativePath(a,t),u=new ft(ct.forServerTaggedQuery(o),s);return this.applyTaggedOperation_(a,u)}return[]},e.prototype.addEventRegistration=function(t,n){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,(function(e,t){var n=U.relativePath(e,r);i=i||t.getCompleteServerCache(n),o=o||t.hasCompleteView()}));var s,u=this.syncPointTree_.get(r);(u?(o=o||u.hasCompleteView(),i=i||u.getCompleteServerCache(U.Empty)):(u=new Dt,this.syncPointTree_=this.syncPointTree_.set(r,u)),null!=i)?s=!0:(s=!1,i=Be.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(e,t){var n=t.getCompleteServerCache(U.Empty);n&&(i=i.updateImmediateChild(e,n))})));var l=u.viewExistsForQuery(t);if(!l&&!t.getQueryParams().loadsAllData()){var c=e.makeQueryKey_(t);Object(a.e)(!this.queryToTagMap.has(c),"View does not exist, but we have a tag");var d=e.getNextQueryTag_();this.queryToTagMap.set(c,d),this.tagToQueryMap.set(d,c)}var h=this.pendingWriteTree_.childWrites(r),f=u.addEventRegistration(t,n,h,i,s);if(!l&&!o){var p=u.viewForQuery(t);f=f.concat(this.setupListener_(t,p))}return f},e.prototype.removeEventRegistration=function(t,n,r){var i=this,a=t.path,o=this.syncPointTree_.get(a),s=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var u=o.removeEventRegistration(t,n,r);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(a));var l=u.removed;s=u.events;var c=-1!==l.findIndex((function(e){return e.getQueryParams().loadsAllData()})),d=this.syncPointTree_.findOnPath(a,(function(e,t){return t.hasCompleteView()}));if(c&&!d){var h=this.syncPointTree_.subtree(a);if(!h.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(h),p=0;p<f.length;++p){var g=f[p],v=g.getQuery(),m=this.createListenerForView_(g);this.listenProvider_.startListening(e.queryForListening_(v),this.tagForQuery_(v),m.hashFn,m.onComplete)}}if(!d&&l.length>0&&!r)if(c){this.listenProvider_.stopListening(e.queryForListening_(t),null)}else l.forEach((function(t){var n=i.queryToTagMap.get(e.makeQueryKey_(t));i.listenProvider_.stopListening(e.queryForListening_(t),n)}));this.removeTags_(l)}return s},e.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,(function(t,n){var r=U.relativePath(t,e),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(e,r,t,!0)},e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold((function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),O(n,(function(e,t){r=r.concat(t)})),r}))},e.prototype.removeTags_=function(t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(r),a=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(a)}}},e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},e.prototype.setupListener_=function(t,n){var r=t.path,i=this.tagForQuery_(t),o=this.createListenerForView_(n),s=this.listenProvider_.startListening(e.queryForListening_(t),i,o.hashFn,o.onComplete),u=this.syncPointTree_.subtree(r);if(i)Object(a.e)(!u.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var l=u.fold((function(e,t,n){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map((function(e){return e.getQuery()})))),O(n,(function(e,t){r=r.concat(t)})),r})),c=0;c<l.length;++c){var d=l[c];this.listenProvider_.stopListening(e.queryForListening_(d),this.tagForQuery_(d))}return s},e.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||Be.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,n);return t.removeEventRegistration(n,null,i)}}},e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},e.parseQueryKey_=function(e){var t=e.indexOf("$");return Object(a.e)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new U(e.substr(0,t))}},e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},e.prototype.tagForQuery_=function(t){var n=e.makeQueryKey_(t);return this.queryToTagMap.get(n)},e.getNextQueryTag_=function(){return e.nextQueryTag_++},e.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);Object(a.e)(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,r,null)},e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(U.Empty))},e.prototype.applyOperationHelper_=function(e,t,n,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get(U.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(U.Empty));var a=[],o=e.path.getFront(),s=e.operationForChild(o),u=t.children.get(o);if(u&&s){var l=n?n.getImmediateChild(o):null,c=r.child(o);a=a.concat(this.applyOperationHelper_(s,u,l,c))}return i&&(a=a.concat(i.applyOperation(e,r,n))),a},e.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,a=t.get(U.Empty);null==n&&null!=a&&(n=a.getCompleteServerCache(U.Empty));var o=[];return t.children.inorderTraversal((function(t,a){var s=n?n.getImmediateChild(t):null,u=r.child(t),l=e.operationForChild(t);l&&(o=o.concat(i.applyOperationDescendantsHelper_(l,a,s,u)))})),a&&(o=o.concat(a.applyOperation(e,r,n))),o},e.nextQueryTag_=1,e}(),Ot=function(){function e(){this.rootNode_=Be.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),Mt=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),Object(a.i)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return Object(a.k)(this.counters_)},e}(),Rt=function(){function e(){}return e.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new Mt),this.collections_[t]},e.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},e.collections_={},e.reporters_={},e}(),Ft=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=Object(i.a)({},e);return this.last_&&O(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),Nt=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ft(e);var n=1e4+2e4*Math.random();j(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.includeStat=function(e){this.statsToReport_[e]=!0},e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;O(t,(function(t,i){i>0&&Object(a.i)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),j(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}(),jt=function(){function e(){this.eventLists_=[],this.recursionDepth_=0}return e.prototype.queueEvents=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n],i=r.getPath();null===t||i.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new Ut(i)),t.add(r)}t&&this.eventLists_.push(t)},e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.equals(e)}))},e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.contains(e)||e.contains(t)}))},e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)e(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):t=!1}t&&(this.eventLists_=[]),this.recursionDepth_--},e}(),Ut=function(){function e(e){this.path_=e,this.events_=[]}return e.prototype.add=function(e){this.events_.push(e)},e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var n=t.getEventRunner();m&&b("event: "+t.toString()),N(n)}}},e.prototype.getPath=function(){return this.path_},e}(),Bt=function(){function e(e){this.allowedEvents_=e,this.listeners_={},Object(a.e)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=Object(i.f)(this.listeners_[e]),a=0;a<r.length;a++)r[a].callback.apply(r[a].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){Object(a.e)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),Vt=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(n="visibilitychange",t="hidden"):"undefined"!==typeof document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document.msHidden?(n="msvisibilitychange",t="msHidden"):"undefined"!==typeof document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return Object(i.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(a.e)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(Bt),Ht=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||Object(a.q)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return Object(i.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(a.e)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(Bt),Wt=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&N((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),qt="start",zt="close",Gt=function(){function e(e,t,n,r,i){this.connId=e,this.repoInfo=t,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=w(e),this.stats_=Rt.getCollection(t),this.urlFn=function(e){return t.connectionURL(q,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Wt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(a.s)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Kt((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(i.e)(e,5),a=r[0],o=r[1],s=r[2];r[3],r[4];if(n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,a===qt)n.id=o,n.password=s;else{if(a!==zt)throw new Error("Unrecognized command received: "+a);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(i.e)(e,2),a=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(a,o)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v=V,n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),"undefined"!==typeof location&&location.href&&-1!==location.href.indexOf(H)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!Object(a.s)()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=Object(a.B)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=Object(a.h)(t),r=L(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!Object(a.s)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=Object(a.B)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Kt=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(a.s)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=p(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(u){b("frame writing exception"),u.stack&&b(u.stack),b(u)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||b("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},e.prototype.addTag=function(e,t){var n=this;Object(a.s)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){b("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}}),Math.floor(1))},e}(),Yt="";function Qt(e){Yt=e}var Xt=null;"undefined"!==typeof MozWebSocket?Xt=MozWebSocket:"undefined"!==typeof WebSocket&&(Xt=WebSocket);var $t=function(){function t(e,n,r,i,a){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=w(this.connId),this.stats_=Rt.getCollection(n),this.connURL=t.connectionURL_(n,i,a),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(e,t,n){var r={};return r.v=V,!Object(a.s)()&&"undefined"!==typeof location&&location.href&&-1!==location.href.indexOf(H)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),e.connectionURL(W,r)},t.prototype.open=function(t,n){var r=this;this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,d.set("previous_websocket_failure",!0);try{if(Object(a.s)()){var i=this.nodeAdmin?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+Yt+"/"+e.platform+"/"+i,"X-Firebase-GMPID":this.applicationId||""}},s=e.env,u=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;u&&(o.proxy={origin:u}),this.mySock=new Xt(this.connURL,[],o)}else{o={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new Xt(this.connURL,[],o)}}catch(c){this.log_("Error instantiating WebSocket.");var l=c.message||c.data;return l&&this.log_(l),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(e){r.handleIncomingFrame(e)},this.mySock.onerror=function(e){r.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&r.log_(t),r.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Xt&&!t.forceDisallow_},t.previouslyFailed=function(){return d.isInMemoryStorage||!0===d.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){d.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=Object(a.v)(t);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},t.prototype.extractFrameCount_=function(e){if(Object(a.e)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},t.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(e){this.resetKeepAlive();var t=Object(a.B)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=L(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Jt=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Gt,$t]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,a=$t&&$t.isAvailable(),o=a&&!$t.previouslyFailed();if(t.webSocketOnly&&(a||E("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[$t];else{var s=this.transports_=[];try{for(var u=Object(i.h)(e.ALL_TRANSPORTS),l=u.next();!l.done;l=u.next()){var c=l.value;c&&c.isAvailable()&&s.push(c)}}catch(d){n={error:d}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),Zt=function(){function e(e,t,n,r,i,a,o,s){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=a,this.onKill_=o,this.lastSessionId=s,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=w("c:"+this.id+":"),this.transportManager_=new Jt(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=j((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=C("t",e),n=C("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=C("t",e),n=C("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=C("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?k("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):k("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),V!==n&&E("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),j((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):j((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(d.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),en=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),tn=1e3,nn=function(e){function t(n,r,i,o,s,u,l){var c=e.call(this)||this;if(c.repoInfo_=n,c.applicationId_=r,c.onDataUpdate_=i,c.onConnectStatus_=o,c.onServerInfoUpdate_=s,c.authTokenProvider_=u,c.authOverride_=l,c.id=t.nextPersistentConnectionId_++,c.log_=w("p:"+c.id+":"),c.interruptReasons_={},c.listens=new Map,c.outstandingPuts_=[],c.outstandingPutCount_=0,c.onDisconnectRequestQueue_=[],c.connected_=!1,c.reconnectDelay_=tn,c.maxReconnectDelay_=3e5,c.securityDebugCallback_=null,c.lastSessionId=null,c.establishConnectionTimer_=null,c.visible_=!1,c.requestCBHash_={},c.requestNumber_=0,c.realtime_=null,c.authToken_=null,c.forceTokenRefresh_=!1,c.invalidAuthTokenCount_=0,c.firstConnection_=!0,c.lastConnectionAttemptTime_=null,c.lastConnectionEstablishedTime_=null,l&&!Object(a.s)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return c.scheduleConnect_(0),Vt.getInstance().on("visible",c.onVisible_,c),-1===n.host.indexOf("fblocal")&&Ht.getInstance().on("online",c.onOnline_,c),c}return Object(i.c)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Object(a.B)(i)),Object(a.e)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.listen=function(e,t,n,r){var i=e.queryIdentifier(),o=e.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Object(a.e)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Object(a.e)(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),a=r.queryIdentifier();this.log_("Listen on "+i+" for "+a);var o={p:i};e.tag&&(o.q=r.queryObject(),o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(function(o){var s=o.d,u=o.s;t.warnOnListenWarnings_(s,r),(n.listens.get(i)&&n.listens.get(i).get(a))===e&&(n.log_("listen response",o),"ok"!==u&&n.removeListen_(i,a),e.onComplete&&e.onComplete(u,s))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"===typeof e&&Object(a.i)(e,"w")){var n=Object(a.y)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',i=t.path.toString();E("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||Object(a.n)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=Object(a.u)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"===typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Object(a.e)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var a={p:t,d:n};void 0!==i&&(a.h=i),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+Object(a.B)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):k("Unrecognized action received from server: "+Object(a.B)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;Object(a.e)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=tn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=tn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=tn),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){var e=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+t.nextConnectionId_++,s=this,u=this.lastSessionId,l=!1,c=null,d=function(){c?c.close():(l=!0,i())};this.realtime_={close:d,sendRequest:function(e){Object(a.e)(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then((function(e){l?b("getToken() completed but was canceled"):(b("getToken() completed. Creating connection."),s.authToken_=e&&e.accessToken,c=new Zt(o,s.repoInfo_,s.applicationId_,n,r,i,(function(e){E(e+" ("+s.repoInfo_.toString()+")"),s.interrupt("server_kill")}),u))})).then(null,(function(t){s.log_("Failed to get token: "+t),l||(e.repoInfo_.nodeAdmin&&E(t),d())}))}},t.prototype.interrupt=function(e){b("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){b("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(a.p)(this.interruptReasons_)&&(this.reconnectDelay_=tn,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return A(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new U(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){b("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var a=Object(i.h)(this.listens.values()),o=a.next();!o.done;o=a.next()){var s=o.value;try{for(var u=(n=void 0,Object(i.h)(s.values())),l=u.next();!l.done;l=u.next()){var c=l.value;this.sendListen_(c)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(p){e={error:p}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}for(var d=0;d<this.outstandingPuts_.length;d++)this.outstandingPuts_[d]&&this.sendPut_(d);for(;this.onDisconnectRequestQueue_.length;){var h=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(h.action,h.pathString,h.data,h.onComplete)}},t.prototype.sendConnectStats_=function(){var e={},t="js";Object(a.s)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+Yt.replace(/\./g,"-")]=1,Object(a.q)()?e["framework.cordova"]=1:Object(a.t)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=Ht.getInstance().currentlyOnline();return Object(a.p)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(en),rn=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=w("p:rest:"),i.listens_={},i}return Object(i.c)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(Object(a.e)(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,r,i){var o=this,s=e.path.toString();this.log_("Listen called for "+s+" "+e.queryIdentifier());var u=t.getListenId_(e,r),l={};this.listens_[u]=l;var c=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",c,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(s,n,!1,r),Object(a.y)(o.listens_,u)===l)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(t.auth=o);var s=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+Object(a.x)(t);r.log_("Sending REST request for "+s);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+s+" received. status:",u.status,"response:",u.responseText);var e=null;if(u.status>=200&&u.status<300){try{e=Object(a.v)(u.responseText)}catch(t){E("Failed to parse JSON response for "+s+": "+u.responseText)}n(null,e)}else 401!==u.status&&404!==u.status&&E("Got unsuccessful REST response for "+s+" Status: "+u.status),n(u.status);n=null}},u.open("GET",s,!0),u.send()}))},t}(en),an="repo_interrupt",on=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.app=n,this.authTokenProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new jt,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new st,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.start=function(){var e=this;if(this.stats_=Rt.getCollection(this.repoInfo_),this.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new rn(this.repoInfo_,this.onDataUpdate_.bind(this),this.authTokenProvider_),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var t=this.app.options.databaseAuthVariableOverride;if("undefined"!==typeof t&&null!==t){if("object"!==typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(a.B)(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}this.persistentConnection_=new nn(this.repoInfo_,this.app.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),this.authTokenProvider_,t),this.server_=this.persistentConnection_}this.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),this.statsReporter_=Rt.getOrCreateReporter(this.repoInfo_,(function(){return new Nt(e.stats_,e.server_)})),this.transactionsInit_(),this.infoData_=new Ot,this.infoSyncTree_=new Lt({startListening:function(t,n,r,i){var a=[],o=e.infoData_.getNode(t.path);return o.isEmpty()||(a=e.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout((function(){i("ok")}),0)),a},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Lt({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var a=i(n,r);e.eventQueue_.raiseEventsForChangedPath(t.path,a)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})},e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e.prototype.name=function(){return this.repoInfo_.namespace},e.prototype.serverTime=function(){var e=this.infoData_.getNode(new U(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},e.prototype.generateServerValues=function(){return(e=(e={timestamp:this.serverTime()})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e},e.prototype.onDataUpdate_=function(e,t,n,r){this.dataUpdateCount++;var i=new U(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var o=[];if(r)if(n){var s=Object(a.w)(t,(function(e){return He(e)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r)}else{var u=He(t);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,u,r)}else if(n){var l=Object(a.w)(t,(function(e){return He(e)}));o=this.serverSyncTree_.applyServerMerge(i,l)}else{var c=He(t);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var d=i;o.length>0&&(d=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(d,o)},e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},e.prototype.onServerInfoUpdate_=function(e){var t=this;O(e,(function(e,n){t.updateInfo_(e,n)}))},e.prototype.updateInfo_=function(e,t){var n=new U("/.info/"+e),r=He(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},e.prototype.getNextWriteId_=function(){return this.nextWriteId_++},e.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var a=this.generateServerValues(),o=He(t,n),s=this.serverSyncTree_.calcCompleteEventCache(e),u=it(o,s,a),l=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(e,u,l,!0);this.eventQueue_.queueEvents(c),this.server_.put(e.toString(),o.val(!0),(function(t,n){var a="ok"===t;a||E("set at "+e+" failed: "+t);var o=i.serverSyncTree_.ackUserWrite(l,!a);i.eventQueue_.raiseEventsForChangedPath(e,o),i.callOnCompleteCallback(r,t,n)}));var d=this.abortTransactions_(e);this.rerunTransactions_(d),this.eventQueue_.raiseEventsForChangedPath(d,[])},e.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,a=this.generateServerValues(),o={};if(O(t,(function(t,n){i=!1,o[t]=rt(e.child(t),He(n),r.serverSyncTree_,a)})),i)b("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(e,o,s);this.eventQueue_.queueEvents(u),this.server_.merge(e.toString(),t,(function(t,i){var a="ok"===t;a||E("update at "+e+" failed: "+t);var o=r.serverSyncTree_.ackUserWrite(s,!a),u=o.length>0?r.rerunTransactions_(e):e;r.eventQueue_.raiseEventsForChangedPath(u,o),r.callOnCompleteCallback(n,t,i)})),O(t,(function(t){var n=r.abortTransactions_(e.child(t));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(e,[])}},e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=new st;this.onDisconnect_.forEachTree(U.Empty,(function(r,i){var a=rt(r,i,e.serverSyncTree_,t);n.remember(r,a)}));var r=[];n.forEachTree(U.Empty,(function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)})),this.onDisconnect_=new st,this.eventQueue_.raiseEventsForChangedPath(U.Empty,r)},e.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)}))},e.prototype.onDisconnectSet=function(e,t,n){var r=this,i=He(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),(function(t,a){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,a)}))},e.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,a=He(t,n);this.server_.onDisconnectPut(e.toString(),a.val(!0),(function(t,n){"ok"===t&&i.onDisconnect_.remember(e,a),i.callOnCompleteCallback(r,t,n)}))},e.prototype.onDisconnectUpdate=function(e,t,n){var r=this;if(Object(a.p)(t))return b("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,(function(i,a){"ok"===i&&O(t,(function(t,n){var i=He(n);r.onDisconnect_.remember(e.child(t),i)})),r.callOnCompleteCallback(n,i,a)}))},e.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(an)},e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(an)},e.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!==typeof console){var t;e?(this.statsListener_||(this.statsListener_=new Ft(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var n=Object.keys(t).reduce((function(e,t){return Math.max(t.length,e)}),0);O(t,(function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)}))}},e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},e.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),b.apply(void 0,Object(i.f)([n],e))},e.prototype.callOnCompleteCallback=function(e,t,n){e&&N((function(){if("ok"===t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var a=new Error(i);a.code=r,e(a)}}))},Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new yn(this))},enumerable:!1,configurable:!0}),e}(),sn=function(){function e(t){this.indexedFilter_=new _t(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,a){return this.matches(new ve(t,n))||(n=Be.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,a)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=Be.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(Be.EMPTY_NODE);var i=this;return t.forEachChild(Te,(function(e,t){i.matches(new ve(e,t))||(r=r.updateImmediateChild(e,Be.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),un=function(){function e(e){this.rangedFilter_=new sn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,a){return this.rangedFilter_.matches(new ve(t,n))||(n=Be.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,a):this.fullLimitUpdateChild_(e,t,n,i,a)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=Be.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=Be.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var a=0;i.hasNext()&&a<this.limit_;){var o=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),o)<=0:this.index_.compare(o,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(o.name,o.node),a++}}else{r=(r=t.withIndex(this.index_)).updatePriority(Be.EMPTY_NODE);var s=void 0,u=void 0,l=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var c=this.index_.getCompare();l=function(e,t){return c(t,e)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();a=0;for(var d=!1;i.hasNext();){o=i.getNext();!d&&l(s,o)<=0&&(d=!0),d&&a<this.limit_&&l(o,u)<=0?a++:r=r.updateImmediateChild(o.name,Be.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(e,t){return s(t,e)}}else o=this.index_.getCompare();var u=e;Object(a.e)(u.numChildren()===this.limit_,"");var l=new ve(t,n),c=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),d=this.rangedFilter_.matches(l);if(u.hasChild(t)){for(var h=u.getImmediateChild(t),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name===t||u.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,l);if(d&&!n.isEmpty()&&p>=0)return null!=i&&i.trackChildChange(yt.childChangedChange(t,n,h)),u.updateImmediateChild(t,n);null!=i&&i.trackChildChange(yt.childRemovedChange(t,h));var g=u.updateImmediateChild(t,Be.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(yt.childAddedChange(f.name,f.node)),g.updateImmediateChild(f.name,f.node)):g}return n.isEmpty()?e:d&&o(c,l)>=0?(null!=i&&(i.trackChildChange(yt.childRemovedChange(c.name,c.node)),i.trackChildChange(yt.childAddedChange(t,n))),u.updateImmediateChild(t,n).updateImmediateChild(c.name,Be.EMPTY_NODE)):e},e}(),ln=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Te}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},e.prototype.getIndexStartValue=function(){return Object(a.e)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return Object(a.e)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:I},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return Object(a.e)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return Object(a.e)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:D},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return Object(a.e)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.copy_=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},e.prototype.limitToFirst=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},e.prototype.limitToLast=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},e.prototype.startAt=function(e,t){var n=this.copy_();return n.startSet_=!0,void 0===e&&(e=null),n.indexStartValue_=e,null!=t?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n},e.prototype.endAt=function(e,t){var n=this.copy_();return n.endSet_=!0,void 0===e&&(e=null),n.indexEndValue_=e,void 0!==t?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n},e.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[t.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),n[t.VIEW_FROM]=r}return this.index_!==Te&&(n[t.INDEX]=this.index_.toString()),n},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Te},e.prototype.getNodeFilter=function(){return this.loadsAllData()?new _t(this.getIndex()):this.hasLimit()?new un(this):new sn(this)},e.prototype.toRestQueryStringParameters=function(){var t,n=e.REST_QUERY_CONSTANTS_,r={};return this.isDefault()||(this.index_===Te?t=n.PRIORITY_INDEX:this.index_===qe?t=n.VALUE_INDEX:this.index_===_e?t=n.KEY_INDEX:(Object(a.e)(this.index_ instanceof ze,"Unrecognized index type!"),t=this.index_.toString()),r[n.ORDER_BY]=Object(a.B)(t),this.startSet_&&(r[n.START_AT]=Object(a.B)(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+Object(a.B)(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=Object(a.B)(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+Object(a.B)(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_)),r},e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},e.DEFAULT=new e,e}(),cn=function(e){function t(t,n){if(!(t instanceof on))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,ln.DEFAULT,!1)||this}return Object(i.c)(t,e),t.prototype.getKey=function(){return Object(a.C)("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},t.prototype.child=function(e){return Object(a.C)("Reference.child",1,1,arguments.length),"number"===typeof e?e=String(e):e instanceof U||(null===this.path.getFront()?le("Reference.child",1,e,!1):ue("Reference.child",1,e,!1)),new t(this.repo,this.path.child(e))},t.prototype.getParent=function(){Object(a.C)("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){Object(a.C)("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return this.repo.database},t.prototype.set=function(e,t){Object(a.C)("Reference.set",1,2,arguments.length),ce("Reference.set",this.path),ne("Reference.set",1,e,this.path,!1),Object(a.D)("Reference.set",2,t,!0);var n=new a.a;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if(Object(a.C)("Reference.update",1,2,arguments.length),ce("Reference.update",this.path),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,E("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ie("Reference.update",1,e,this.path,!1),Object(a.D)("Reference.update",2,t,!0);var i=new a.a;return this.repo.update(this.path,e,i.wrapCallback(t)),i.promise},t.prototype.setWithPriority=function(e,t,n){if(Object(a.C)("Reference.setWithPriority",2,3,arguments.length),ce("Reference.setWithPriority",this.path),ne("Reference.setWithPriority",1,e,this.path,!1),ae("Reference.setWithPriority",2,t,!1),Object(a.D)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new a.a;return this.repo.setWithPriority(this.path,e,t,r.wrapCallback(n)),r.promise},t.prototype.remove=function(e){return Object(a.C)("Reference.remove",0,1,arguments.length),ce("Reference.remove",this.path),Object(a.D)("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if(Object(a.C)("Reference.transaction",1,3,arguments.length),ce("Reference.transaction",this.path),Object(a.D)("Reference.transaction",1,e,!1),Object(a.D)("Reference.transaction",2,t,!0),he("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new a.a;"function"===typeof t&&r.promise.catch((function(){}));var i=function(e,n,i){e?r.reject(e):r.resolve(new pe(n,i)),"function"===typeof t&&t(e,n,i)};return this.repo.startTransaction(this.path,e,i,n),r.promise},t.prototype.setPriority=function(e,t){Object(a.C)("Reference.setPriority",1,2,arguments.length),ce("Reference.setPriority",this.path),ae("Reference.setPriority",1,e,!1),Object(a.D)("Reference.setPriority",2,t,!0);var n=new a.a;return this.repo.setWithPriority(this.path.child(".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){Object(a.C)("Reference.push",0,2,arguments.length),ce("Reference.push",this.path),ne("Reference.push",1,e,this.path,!0),Object(a.D)("Reference.push",2,t,!0);var n,r=this.repo.serverTime(),i=ge(r),o=this.child(i),s=this.child(i);return n=null!=e?o.set(e,t).then((function(){return s})):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"===typeof t&&n.catch((function(){})),o},t.prototype.onDisconnect=function(){return ce("Reference.onDisconnect",this.path),new fe(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}($e);$e.__referenceConstructor=cn,Dt.__referenceConstructor=cn;var dn,hn=function(){this.children={},this.childCount=0,this.value=null},fn=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new hn),this.name_=e,this.parent_=t,this.node_=n}return e.prototype.subTree=function(t){for(var n=t instanceof U?t:new U(t),r=this,i=n.getFront();null!==i;){r=new e(i,r,Object(a.y)(r.node_.children,i)||new hn),i=(n=n.popFront()).getFront()}return r},e.prototype.getValue=function(){return this.node_.value},e.prototype.setValue=function(e){Object(a.e)("undefined"!==typeof e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},e.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},e.prototype.hasChildren=function(){return this.node_.childCount>0},e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},e.prototype.forEachChild=function(t){var n=this;O(this.node_.children,(function(r,i){t(new e(r,n,i))}))},e.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild((function(t){t.forEachDescendant(e,!0,n)})),t&&n&&e(this)},e.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild((function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)}))},e.prototype.path=function(){return new U(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},e.prototype.name=function(){return this.name_},e.prototype.parent=function(){return this.parent_},e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},e.prototype.updateChild_=function(e,t){var n=t.isEmpty(),r=Object(a.i)(this.node_.children,e);n&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},e}();!function(e){e[e.RUN=0]="RUN",e[e.SENT=1]="SENT",e[e.COMPLETED=2]="COMPLETED",e[e.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",e[e.NEEDS_ABORT=4]="NEEDS_ABORT"}(dn||(dn={})),on.MAX_TRANSACTION_RETRIES_=25,on.prototype.transactionsInit_=function(){this.transactionQueueTree_=new fn},on.prototype.startTransaction=function(e,t,n,r){this.log_("transaction on "+e);var i=function(){},o=new cn(this,e);o.on("value",i);var s={path:e,update:t,onComplete:n,status:null,order:p(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},u=this.getLatestState_(e);s.currentInputSnapshot=u;var l=s.update(u.val());if(void 0===l){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var c=new Ge(s.currentInputSnapshot,new cn(this,s.path),Te);s.onComplete(null,!1,c)}}else{re("transaction failed: Data returned ",l,s.path),s.status=dn.RUN;var d=this.transactionQueueTree_.subTree(e),h=d.getValue()||[];h.push(s),d.setValue(h);var f=void 0;if("object"===typeof l&&null!==l&&Object(a.i)(l,".priority"))f=Object(a.y)(l,".priority"),Object(a.e)(te(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(e)||Be.EMPTY_NODE).getPriority().val();f=f;var g=this.generateServerValues(),v=He(l,f),m=it(v,u,g);s.currentOutputSnapshotRaw=v,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_();var y=this.serverSyncTree_.applyUserOverwrite(e,m,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,y),this.sendReadyTransactions_()}},on.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||Be.EMPTY_NODE},on.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);Object(a.e)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return e.status===dn.RUN}))&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild((function(e){t.sendReadyTransactions_(e)}))},on.prototype.sendTransactionQueue_=function(e,t){for(var n=this,r=t.map((function(e){return e.currentWriteId})),i=this.getLatestState_(e,r),o=i,s=i.hash(),u=0;u<t.length;u++){var l=t[u];Object(a.e)(l.status===dn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=dn.SENT,l.retryCount++;var c=U.relativePath(e,l.path);o=o.updateChild(c,l.currentOutputSnapshotRaw)}var d=o.val(!0),h=e;this.server_.put(h.toString(),d,(function(r){n.log_("transaction put response",{path:h.toString(),status:r});var i=[];if("ok"===r){for(var a=[],o=0;o<t.length;o++){if(t[o].status=dn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[o].currentWriteId)),t[o].onComplete){var s=t[o].currentOutputSnapshotResolved,u=new cn(n,t[o].path),l=new Ge(s,u,Te);a.push(t[o].onComplete.bind(null,null,!0,l))}t[o].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(e,i);for(o=0;o<a.length;o++)N(a[o])}else{if("datastale"===r)for(o=0;o<t.length;o++)t[o].status===dn.SENT_NEEDS_ABORT?t[o].status=dn.NEEDS_ABORT:t[o].status=dn.RUN;else{E("transaction at "+h.toString()+" failed: "+r);for(o=0;o<t.length;o++)t[o].status=dn.NEEDS_ABORT,t[o].abortReason=r}n.rerunTransactions_(e)}}),s)},on.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},on.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,r=[],i=[],o=e.filter((function(e){return e.status===dn.RUN})).map((function(e){return e.currentWriteId})),s=0;s<e.length;s++){var u=e[s],l=U.relativePath(t,u.path),c=!1,d=void 0;if(Object(a.e)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===dn.NEEDS_ABORT)c=!0,d=u.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0));else if(u.status===dn.RUN)if(u.retryCount>=on.MAX_TRANSACTION_RETRIES_)c=!0,d="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0));else{var h=this.getLatestState_(u.path,o);u.currentInputSnapshot=h;var f=e[s].update(h.val());if(void 0!==f){re("transaction failed: Data returned ",f,u.path);var p=He(f);"object"===typeof f&&null!=f&&Object(a.i)(f,".priority")||(p=p.updatePriority(h.getPriority()));var g=u.currentWriteId,v=this.generateServerValues(),m=it(p,h,v);u.currentOutputSnapshotRaw=p,u.currentOutputSnapshotResolved=m,u.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(g),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(u.path,m,u.currentWriteId,u.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(g,!0))}else c=!0,d="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,i),i=[],c&&(e[s].status=dn.COMPLETED,n=e[s].unwatcher,setTimeout(n,Math.floor(0)),e[s].onComplete))if("nodata"===d){var y=new cn(this,e[s].path),_=e[s].currentInputSnapshot,b=new Ge(_,y,Te);r.push(e[s].onComplete.bind(null,null,!1,b))}else r.push(e[s].onComplete.bind(null,new Error(d),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(s=0;s<r.length;s++)N(r[s]);this.sendReadyTransactions_()}},on.prototype.getAncestorTransactionNode_=function(e){var t,n=this.transactionQueueTree_;for(t=e.getFront();null!==t&&null===n.getValue();)n=n.subTree(t),t=(e=e.popFront()).getFront();return n},on.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort((function(e,t){return e.order-t.order})),t},on.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild((function(e){n.aggregateTransactionQueuesForNode_(e,t)}))},on.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==dn.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(n.length>0?n:null)}e.forEachChild((function(e){t.pruneCompletedTransactionsBelowNode_(e)}))},on.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor((function(e){t.abortTransactionsOnNode_(e)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(e){t.abortTransactionsOnNode_(e)})),n},on.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],r=[],i=-1,o=0;o<t.length;o++)if(t[o].status===dn.SENT_NEEDS_ABORT);else if(t[o].status===dn.SENT)Object(a.e)(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=dn.SENT_NEEDS_ABORT,t[o].abortReason="set";else if(Object(a.e)(t[o].status===dn.RUN,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[o].currentWriteId,!0)),t[o].onComplete){n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?e.setValue(null):t.length=i+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r);for(o=0;o<n.length;o++)N(n[o])}};var pn,gn=function(){function e(e,t){var n=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then((function(e){return n.auth_=e}))}return e.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(b("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout((function(){return e(null)}),0),this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)})))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',E(e)},e}(),vn=function(){function e(){}return e.prototype.getToken=function(t){return Promise.resolve({accessToken:e.EMULATOR_AUTH_TOKEN})},e.prototype.addTokenChangeListener=function(t){t(e.EMULATOR_AUTH_TOKEN)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.EMULATOR_AUTH_TOKEN="owner",e}(),mn=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return pn||(pn=new t),pn},t.prototype.interrupt=function(){var e,t,n,r;try{for(var a=Object(i.h)(Object.keys(this.repos_)),o=a.next();!o.done;o=a.next()){var s=o.value;try{for(var u=(n=void 0,Object(i.h)(Object.keys(this.repos_[s]))),l=u.next();!l.done;l=u.next()){var c=l.value;this.repos_[s][c].interrupt()}}catch(d){n={error:d}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(h){e={error:h}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},t.prototype.resume=function(){var e,t,n,r;try{for(var a=Object(i.h)(Object.keys(this.repos_)),o=a.next();!o.done;o=a.next()){var s=o.value;try{for(var u=(n=void 0,Object(i.h)(Object.keys(this.repos_[s]))),l=u.next();!l.done;l=u.next()){var c=l.value;this.repos_[s][c].resume()}}catch(d){n={error:d}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(h){e={error:h}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},t.prototype.applyEmulatorSettings=function(e,t,n){e.repoInfo_=new z(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),e.repoInfo_.nodeAdmin&&(e.authTokenProvider_=new vn)},t.prototype.databaseFromApp=function(t,n,r,i){var a=r||t.options.databaseURL;void 0===a&&(t.options.projectId||S("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),b("Using default host for project ",t.options.projectId),a=t.options.projectId+"-default-rtdb.firebaseio.com");var o,s=Y(a,i),u=s.repoInfo,l=void 0;"undefined"!==typeof e&&(l=e.env.FIREBASE_DATABASE_EMULATOR_HOST),l?(o=!0,a="http://"+l+"?ns="+u.namespace,u=(s=Y(a,i)).repoInfo):o=!s.repoInfo.secure;var c=i&&o?new vn:new gn(t,n);return de("Invalid Firebase Database URL",1,s),s.path.isEmpty()||S("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(u,t,c).database},t.prototype.deleteRepo=function(e){var t=Object(a.y)(this.repos_,e.app.name);t&&Object(a.y)(t,e.key)===e||S("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.key]},t.prototype.createRepo=function(e,t,n){var r=Object(a.y)(this.repos_,t.name);r||(r={},this.repos_[t.name]=r);var i=Object(a.y)(r,e.toURLString());return i&&S("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new on(e,this.useRestClient_,t,n),r[e.toURLString()]=i,i},t.prototype.forceRestClient=function(e){this.useRestClient_=e},t}(),yn=function(){function e(e){var t=this;this.repoInternal_=e,this.instanceStarted_=!1,this.INTERNAL={delete:function(){return Object(i.b)(t,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return this.checkDeleted_("delete"),mn.getInstance().deleteRepo(this.repo_),this.repoInternal_=null,this.rootInternal_=null,[2]}))}))}},e instanceof on||S("Don't call new Database() directly - please use firebase.database().")}return Object.defineProperty(e.prototype,"repo_",{get:function(){return this.instanceStarted_||(this.repoInternal_.start(),this.instanceStarted_=!0),this.repoInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root_",{get:function(){return this.rootInternal_||(this.rootInternal_=new cn(this.repo_,U.Empty)),this.rootInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),e.prototype.useEmulator=function(e,t){this.checkDeleted_("useEmulator"),this.instanceStarted_?S("Cannot call useEmulator() after instance has already been initialized."):mn.getInstance().applyEmulatorSettings(this.repoInternal_,e,t)},e.prototype.ref=function(e){return this.checkDeleted_("ref"),Object(a.C)("database.ref",0,1,arguments.length),e instanceof cn?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),Object(a.C)(t,1,1,arguments.length);var n=Y(e,this.repo_.repoInfo_.nodeAdmin);de(t,1,n);var r=n.repoInfo;return r.isCustomHost()||r.host===this.repo_.repoInfo_.host||S(t+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repoInternal_&&S("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){Object(a.C)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},e.prototype.goOnline=function(){Object(a.C)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},e.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},e}();var _n=Object.freeze({__proto__:null,forceLongPolling:function(){$t.forceDisallow(),Gt.forceAllow()},forceWebSockets:function(){Gt.forceDisallow()},isWebSocketsAvailable:function(){return $t.isAvailable()},setSecurityDebugCallback:function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){e.repo.stats(t)},statsIncrementCounter:function(e,t){e.repo.statsIncrementCounter(t)},dataUpdateCount:function(e){return e.repo.dataUpdateCount},interceptServerData:function(e,t){return e.repo.interceptServerData_(t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,a=e.namespace,o=e.nodeAdmin,u=void 0!==o&&o;Qt(r);var l=new s.c("auth-internal",new s.b("database-standalone"));return l.setComponent(new s.a("auth-internal",(function(){return i}),"PRIVATE")),{instance:mn.getInstance().databaseFromApp(t,l,n,u),namespace:a}}}),bn=nn;nn.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},nn.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var wn=Zt,kn=z,Sn=Object.freeze({__proto__:null,DataConnection:bn,RealTimeConnection:wn,hijackHash:function(e){var t=nn.prototype.put;return nn.prototype.put=function(n,r,i,a){void 0!==a&&(a=e()),t.call(this,n,r,i,a)},function(){nn.prototype.put=t}},ConnectionTarget:kn,queryIdentifier:function(e){return e.queryIdentifier()},forceRestClient:function(e){mn.getInstance().forceRestClient(e)}}),En=yn.ServerValue;!function(e){Qt(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new s.a("database",(function(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal");return mn.getInstance().databaseFromApp(n,r,t)}),"PUBLIC").setServiceProps({Reference:cn,Query:$e,Database:yn,DataSnapshot:Ge,enableLogging:_,INTERNAL:_n,ServerValue:En,TEST_ACCESS:Sn}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.7.0"),Object(a.s)()&&(t.exports=n)}(r.a)}).call(this,n(133),n(134)(e))},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,l=[],c=!1,d=-1;function h(){c&&u&&(c=!1,u.length?l=u.concat(l):d=-1,l.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=l.length;t;){for(u=l,l=[];++d<t;)u&&u[d].run();d=-1,t=l.length}u=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";(function(e){var t=n(34);(function(){var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)};var i=function(t){t=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e&&e,t];for(var n=0;n<t.length;++n){var r=t[n];if(r&&r.Math==Math)return r}return globalThis}(this);function a(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}function o(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:a(e)}}!function(e,t){if(t){var n=i;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];o in n||(n[o]={}),n=n[o]}(t=t(a=n[e=e[e.length-1]]))!=a&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Promise",(function(e){function t(e){this.b=0,this.c=void 0,this.a=[];var t=this.f();try{e(t.resolve,t.reject)}catch(n){t.reject(n)}}function n(){this.a=null}function r(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.b=function(e){if(null==this.a){this.a=[];var t=this;this.c((function(){t.g()}))}this.a.push(e)};var a=i.setTimeout;n.prototype.c=function(e){a(e,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var e=this.a;this.a=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(r){this.f(r)}}}this.a=null},n.prototype.f=function(e){this.c((function(){throw e}))},t.prototype.f=function(){function e(e){return function(r){n||(n=!0,e.call(t,r))}}var t=this,n=!1;return{resolve:e(this.v),reject:e(this.g)}},t.prototype.v=function(e){if(e===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.o(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.m(e):this.h(e)}},t.prototype.m=function(e){var t=void 0;try{t=e.then}catch(n){return void this.g(n)}"function"==typeof t?this.u(t,e):this.h(e)},t.prototype.g=function(e){this.i(2,e)},t.prototype.h=function(e){this.i(1,e)},t.prototype.i=function(e,t){if(0!=this.b)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.b);this.b=e,this.c=t,this.l()},t.prototype.l=function(){if(null!=this.a){for(var e=0;e<this.a.length;++e)s.b(this.a[e]);this.a=null}};var s=new n;return t.prototype.o=function(e){var t=this.f();e.Pa(t.resolve,t.reject)},t.prototype.u=function(e,t){var n=this.f();try{e.call(t,n.resolve,n.reject)}catch(r){n.reject(r)}},t.prototype.then=function(e,n){function r(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(n){a(n)}}:t}var i,a,o=new t((function(e,t){i=e,a=t}));return this.Pa(r(e,i),r(n,a)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.Pa=function(e,t){function n(){switch(r.b){case 1:e(r.c);break;case 2:t(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},t.resolve=r,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var i=o(e),a=i.next();!a.done;a=i.next())r(a.value).Pa(t,n)}))},t.all=function(e){var n=o(e),i=n.next();return i.done?r([]):new t((function(e,t){function a(t){return function(n){o[t]=n,0==--s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,r(i.value).Pa(a(o.length-1),t),i=n.next()}while(!i.done)}))},t}));var s=s||{},u=this||self,l=/^[\w+/_-]+[=]{0,2}$/,c=null;function d(){}function h(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t}function f(e){var t=h(e);return"array"==t||"object"==t&&"number"==typeof e.length}function p(e){return"function"==h(e)}function g(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function v(e){return Object.prototype.hasOwnProperty.call(e,m)&&e[m]||(e[m]=++y)}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function _(e,t,n){return e.call.apply(e.bind,arguments)}function b(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_:b).apply(null,arguments)}function k(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var S=Date.now||function(){return+new Date};function E(e,t){function n(){}n.prototype=t.prototype,e.$a=t.prototype,e.prototype=new n,e.prototype.constructor=e}function P(e,t,n){this.code=T+e,this.message=t||x[e]||"",this.a=n||null}function I(e){var t=e&&e.code;return t?new P(t.substring(T.length),e.message,e.serverResponse):null}E(P,Error),P.prototype.w=function(){var e={code:this.code,message:this.message};return this.a&&(e.serverResponse=this.a),e},P.prototype.toJSON=function(){return this.w()};var D,T="auth/",x={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."},C={kd:{Sa:"https://staging-identitytoolkit.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Va:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"b"},rd:{Sa:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://securetoken.googleapis.com/v1/token",Va:"https://identitytoolkit.googleapis.com/v2/",id:"p"},td:{Sa:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Ya:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Va:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"s"},ud:{Sa:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",Ya:"https://test-securetoken.sandbox.googleapis.com/v1/token",Va:"https://test-identitytoolkit.sandbox.googleapis.com/v2/",id:"t"}};function A(e){for(var t in C)if(C[t].id===e)return{firebaseEndpoint:(e=C[t]).Sa,secureTokenEndpoint:e.Ya,identityPlatformEndpoint:e.Va};return null}function L(e){if(!e)return!1;try{return!!e.$goog_Thenable}catch(t){return!1}}function O(e){if(Error.captureStackTrace)Error.captureStackTrace(this,O);else{var t=Error().stack;t&&(this.stack=t)}e&&(this.message=String(e))}function M(e,t){for(var n="",r=(e=e.split("%s")).length-1,i=0;i<r;i++)n+=e[i]+(i<t.length?t[i]:"%s");O.call(this,n+e[r])}function R(e,t){throw new M("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1))}function F(e,t){this.c=e,this.f=t,this.b=0,this.a=null}function N(e,t){e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}function j(){this.b=this.a=null}D=A("__EID__")?"__EID__":void 0,E(O,Error),O.prototype.name="CustomError",E(M,O),M.prototype.name="AssertionError",F.prototype.get=function(){if(0<this.b){this.b--;var e=this.a;this.a=e.next,e.next=null}else e=this.c();return e};var U=new F((function(){return new V}),(function(e){e.reset()}));function B(){var e=mt,t=null;return e.a&&(t=e.a,e.a=e.a.next,e.a||(e.b=null),t.next=null),t}function V(){this.next=this.b=this.a=null}j.prototype.add=function(e,t){var n=U.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n},V.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null},V.prototype.reset=function(){this.next=this.b=this.a=null};var H=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},W=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"===typeof e?e.split(""):e,a=0;a<r;a++)a in i&&t.call(n,i[a],a,e)};var q=Array.prototype.filter?function(e,t){return Array.prototype.filter.call(e,t,void 0)}:function(e,t){for(var n=e.length,r=[],i=0,a="string"===typeof e?e.split(""):e,o=0;o<n;o++)if(o in a){var s=a[o];t.call(void 0,s,o,e)&&(r[i++]=s)}return r},z=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var n=e.length,r=Array(n),i="string"===typeof e?e.split(""):e,a=0;a<n;a++)a in i&&(r[a]=t.call(void 0,i[a],a,e));return r},G=Array.prototype.some?function(e,t){return Array.prototype.some.call(e,t,void 0)}:function(e,t){for(var n=e.length,r="string"===typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e))return!0;return!1};function K(e,t){return 0<=H(e,t)}function Y(e,t){var n;return(n=0<=(t=H(e,t)))&&Array.prototype.splice.call(e,t,1),n}function Q(e,t){!function(e,t){for(var n="string"===typeof e?e.split(""):e,r=e.length-1;0<=r;--r)r in n&&t.call(void 0,n[r],r,e)}(e,(function(n,r){t.call(void 0,n,r,e)&&1==Array.prototype.splice.call(e,r,1).length&&0}))}function X(e){return Array.prototype.concat.apply([],arguments)}function $(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}var J,Z=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]},ee=/&/g,te=/</g,ne=/>/g,re=/"/g,ie=/'/g,ae=/\x00/g,oe=/[\x00&<>"']/;function se(e,t){return-1!=e.indexOf(t)}function ue(e,t){return e<t?-1:e>t?1:0}e:{var le=u.navigator;if(le){var ce=le.userAgent;if(ce){J=ce;break e}}J=""}function de(e){return se(J,e)}function he(e,t){for(var n in e)t.call(void 0,e[n],n,e)}function fe(e){for(var t in e)return!1;return!0}function pe(e){var t,n={};for(t in e)n[t]=e[t];return n}var ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ve(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<ge.length;a++)n=ge[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function me(e,t){e:{try{var n=e&&e.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||u).Element&&r.Location){var i=r;break e}}catch(o){}i=null}if(i&&"undefined"!=typeof i[t]&&(!e||!(e instanceof i[t])&&(e instanceof i.Location||e instanceof i.Element))){if(g(e))try{var a=e.constructor.displayName||e.constructor.name||Object.prototype.toString.call(e)}catch(o){a="<object could not be stringified>"}else a=void 0===e?"undefined":null===e?"null":typeof e;R("Argument is not a %s (or a non-Element, non-Location mock); got: %s",t,a)}}function ye(e,t){this.a=e===we&&t||"",this.b=be}function _e(e){return e instanceof ye&&e.constructor===ye&&e.b===be?e.a:(R("expected object of type Const, got '"+e+"'"),"type_error:Const")}ye.prototype.sa=!0,ye.prototype.ra=function(){return this.a},ye.prototype.toString=function(){return"Const{"+this.a+"}"};var be={},we={},ke=new ye(we,"");function Se(e,t){this.a=e===xe&&t||"",this.b=Te}function Ee(e){return e instanceof Se&&e.constructor===Se&&e.b===Te?e.a:(R("expected object of type TrustedResourceUrl, got '"+e+"' of type "+h(e)),"type_error:TrustedResourceUrl")}function Pe(e,t){var n=_e(e);if(!De.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return e=n.replace(Ie,(function(e,r){if(!Object.prototype.hasOwnProperty.call(t,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(t));return(e=t[r])instanceof ye?_e(e):encodeURIComponent(String(e))})),new Se(xe,e)}Se.prototype.sa=!0,Se.prototype.ra=function(){return this.a.toString()},Se.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var Ie=/%{(\w+)}/g,De=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,Te={},xe={};function Ce(e,t){this.a=e===Re&&t||"",this.b=Me}function Ae(e){return e instanceof Ce&&e.constructor===Ce&&e.b===Me?e.a:(R("expected object of type SafeUrl, got '"+e+"' of type "+h(e)),"type_error:SafeUrl")}Ce.prototype.sa=!0,Ce.prototype.ra=function(){return this.a.toString()},Ce.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Le=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function Oe(e){return e instanceof Ce?e:(e="object"==typeof e&&e.sa?e.ra():String(e),Le.test(e)||(e="about:invalid#zClosurez"),new Ce(Re,e))}var Me={},Re={};function Fe(){this.a="",this.b=je}function Ne(e){return e instanceof Fe&&e.constructor===Fe&&e.b===je?e.a:(R("expected object of type SafeHtml, got '"+e+"' of type "+h(e)),"type_error:SafeHtml")}Fe.prototype.sa=!0,Fe.prototype.ra=function(){return this.a.toString()},Fe.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var je={};function Ue(e){var t=new Fe;return t.a=e,t}Ue("<!DOCTYPE html>");var Be=Ue("");function Ve(e,t){for(var n=e.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function He(e){return oe.test(e)&&(-1!=e.indexOf("&")&&(e=e.replace(ee,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(te,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(ne,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(re,"&quot;")),-1!=e.indexOf("'")&&(e=e.replace(ie,"&#39;")),-1!=e.indexOf("\0")&&(e=e.replace(ae,"&#0;"))),e}function We(e){return We[" "](e),e}Ue("<br>"),We[" "]=d;var qe,ze=de("Opera"),Ge=de("Trident")||de("MSIE"),Ke=de("Edge"),Ye=Ke||Ge,Qe=de("Gecko")&&!(se(J.toLowerCase(),"webkit")&&!de("Edge"))&&!(de("Trident")||de("MSIE"))&&!de("Edge"),Xe=se(J.toLowerCase(),"webkit")&&!de("Edge");function $e(){var e=u.document;return e?e.documentMode:void 0}e:{var Je="",Ze=function(){var e=J;return Qe?/rv:([^\);]+)(\)|;)/.exec(e):Ke?/Edge\/([\d\.]+)/.exec(e):Ge?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):Xe?/WebKit\/(\S+)/.exec(e):ze?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(Ze&&(Je=Ze?Ze[1]:""),Ge){var et=$e();if(null!=et&&et>parseFloat(Je)){qe=String(et);break e}}qe=Je}var tt,nt={};function rt(e){return function(e,t){var n=nt;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(){for(var t=0,n=Z(String(qe)).split("."),r=Z(String(e)).split("."),i=Math.max(n.length,r.length),a=0;0==t&&a<i;a++){var o=n[a]||"",s=r[a]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=ue(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||ue(0==o[2].length,0==s[2].length)||ue(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}))}tt=u.document&&Ge?$e():void 0;try{new self.OffscreenCanvas(0,0).getContext("2d")}catch(lo){}var it=!Ge||9<=Number(tt);function at(e){var t=document;return"string"===typeof e?t.getElementById(e):e}function ot(e,t){he(t,(function(t,n){t&&"object"==typeof t&&t.sa&&(t=t.ra()),"style"==n?e.style.cssText=t:"class"==n?e.className=t:"for"==n?e.htmlFor=t:lt.hasOwnProperty(n)?e.setAttribute(lt[n],t):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?e.setAttribute(n,t):e[n]=t}))}var st,ut,lt={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function ct(e,t,n){function r(n){n&&t.appendChild("string"===typeof n?e.createTextNode(n):n)}for(var i=2;i<n.length;i++){var a=n[i];!f(a)||g(a)&&0<a.nodeType?r(a):W(ht(a)?$(a):a,r)}}function dt(e,t){return t=String(t),"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)}function ht(e){if(e&&"number"==typeof e.length){if(g(e))return"function"==typeof e.item||"string"==typeof e.item;if(p(e))return"function"==typeof e.item}return!1}function ft(e){u.setTimeout((function(){throw e}),0)}function pt(){var e=u.MessageChannel;if("undefined"===typeof e&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!de("Presto")&&(e=function(){var e=dt(document,"IFRAME");e.style.display="none",function(e){var t=new Se(xe,_e(ke));me(e,"HTMLIFrameElement"),e.src=Ee(t).toString()}(e),document.documentElement.appendChild(e);var t=e.contentWindow;(e=t.document).open(),e.write(Ne(Be)),e.close();var n="callImmediate"+Math.random(),r="file:"==t.location.protocol?"*":t.location.protocol+"//"+t.location.host;e=w((function(e){"*"!=r&&e.origin!=r||e.data!=n||this.port1.onmessage()}),this),t.addEventListener("message",e,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(n,r)}}}),"undefined"!==typeof e&&!de("Trident")&&!de("MSIE")){var t=new e,n={},r=n;return t.port1.onmessage=function(){if(void 0!==n.next){var e=(n=n.next).Fb;n.Fb=null,e()}},function(e){r.next={Fb:e},r=r.next,t.port2.postMessage(0)}}return function(e){u.setTimeout(e,0)}}function gt(e,t){ut||function(){if(u.Promise&&u.Promise.resolve){var e=u.Promise.resolve(void 0);ut=function(){e.then(yt)}}else ut=function(){var e=yt;!p(u.setImmediate)||u.Window&&u.Window.prototype&&!de("Edge")&&u.Window.prototype.setImmediate==u.setImmediate?(st||(st=pt()),st(e)):u.setImmediate(e)}}(),vt||(ut(),vt=!0),mt.add(e,t)}var vt=!1,mt=new j;function yt(){for(var e;e=B();){try{e.a.call(e.b)}catch(t){ft(t)}N(U,e)}vt=!1}function _t(e,t){if(this.a=bt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,e!=d)try{var n=this;e.call(t,(function(e){Ot(n,wt,e)}),(function(e){if(!(e instanceof Bt))try{if(e instanceof Error)throw e;throw Error("Promise rejected.")}catch(t){}Ot(n,kt,e)}))}catch(r){Ot(this,kt,r)}}var bt=0,wt=2,kt=3;function St(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}St.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Et=new F((function(){return new St}),(function(e){e.reset()}));function Pt(e,t,n){var r=Et.get();return r.g=e,r.b=t,r.f=n,r}function It(e){if(e instanceof _t)return e;var t=new _t(d);return Ot(t,wt,e),t}function Dt(e){return new _t((function(t,n){n(e)}))}function Tt(e,t,n){Mt(e,t,n,null)||gt(k(t,e))}function xt(e){return new _t((function(t){var n=e.length,r=[];if(n)for(var i=function(e,i,a){n--,r[e]=i?{Ob:!0,value:a}:{Ob:!1,reason:a},0==n&&t(r)},a=0;a<e.length;a++)Tt(e[a],k(i,a,!0),k(i,a,!1));else t(r)}))}function Ct(e,t){if(e.a==bt)if(e.c){var n=e.c;if(n.b){for(var r=0,i=null,a=null,o=n.b;o&&(o.c||(r++,o.a==e&&(i=o),!(i&&1<r)));o=o.next)i||(a=o);i&&(n.a==bt&&1==r?Ct(n,t):(a?((r=a).next==n.f&&(n.f=r),r.next=r.next.next):Ft(n),Nt(n,i,kt,t)))}e.c=null}else Ot(e,kt,t)}function At(e,t){e.b||e.a!=wt&&e.a!=kt||Rt(e),e.f?e.f.next=t:e.b=t,e.f=t}function Lt(e,t,n,r){var i=Pt(null,null,null);return i.a=new _t((function(e,a){i.g=t?function(n){try{var i=t.call(r,n);e(i)}catch(o){a(o)}}:e,i.b=n?function(t){try{var i=n.call(r,t);void 0===i&&t instanceof Bt?a(t):e(i)}catch(o){a(o)}}:a})),i.a.c=e,At(e,i),i.a}function Ot(e,t,n){e.a==bt&&(e===n&&(t=kt,n=new TypeError("Promise cannot resolve to itself")),e.a=1,Mt(n,e.Zc,e.$c,e)||(e.i=n,e.a=t,e.c=null,Rt(e),t!=kt||n instanceof Bt||function(e,t){e.g=!0,gt((function(){e.g&&Ut.call(null,t)}))}(e,n)))}function Mt(e,t,n,r){if(e instanceof _t)return At(e,Pt(t||d,n||null,r)),!0;if(L(e))return e.then(t,n,r),!0;if(g(e))try{var i=e.then;if(p(i))return function(e,t,n,r,i){function a(e){s||(s=!0,r.call(i,e))}function o(e){s||(s=!0,n.call(i,e))}var s=!1;try{t.call(e,o,a)}catch(u){a(u)}}(e,i,t,n,r),!0}catch(a){return n.call(r,a),!0}return!1}function Rt(e){e.h||(e.h=!0,gt(e.fc,e))}function Ft(e){var t=null;return e.b&&(t=e.b,e.b=t.next,t.next=null),e.b||(e.f=null),t}function Nt(e,t,n,r){if(n==kt&&t.b&&!t.c)for(;e&&e.g;e=e.c)e.g=!1;if(t.a)t.a.c=null,jt(t,n,r);else try{t.c?t.g.call(t.f):jt(t,n,r)}catch(i){Ut.call(null,i)}N(Et,t)}function jt(e,t,n){t==wt?e.g.call(e.f,n):e.b&&e.b.call(e.f,n)}_t.prototype.then=function(e,t,n){return Lt(this,p(e)?e:null,p(t)?t:null,n)},_t.prototype.$goog_Thenable=!0,(n=_t.prototype).na=function(e,t){return(e=Pt(e,e,t)).c=!0,At(this,e),this},n.s=function(e,t){return Lt(this,null,e,t)},n.cancel=function(e){if(this.a==bt){var t=new Bt(e);gt((function(){Ct(this,t)}),this)}},n.Zc=function(e){this.a=bt,Ot(this,wt,e)},n.$c=function(e){this.a=bt,Ot(this,kt,e)},n.fc=function(){for(var e;e=Ft(this);)Nt(this,e,this.a,this.i);this.h=!1};var Ut=ft;function Bt(e){O.call(this,e)}function Vt(){0!=Ht&&(Wt[v(this)]=this),this.xa=this.xa,this.oa=this.oa}E(Bt,O),Bt.prototype.name="cancel";var Ht=0,Wt={};function qt(e){if(!e.xa&&(e.xa=!0,e.Da(),0!=Ht)){var t=v(e);if(0!=Ht&&e.oa&&0<e.oa.length)throw Error(e+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Wt[t]}}Vt.prototype.xa=!1,Vt.prototype.Da=function(){if(this.oa)for(;this.oa.length;)this.oa.shift()()};var zt=Object.freeze||function(e){return e},Gt=!Ge||9<=Number(tt),Kt=Ge&&!rt("9"),Yt=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{u.addEventListener("test",d,t),u.removeEventListener("test",d,t)}catch(n){}return e}();function Qt(e,t){this.type=e,this.b=this.target=t,this.defaultPrevented=!1}function Xt(e,t){if(Qt.call(this,e?e.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.b=t,t=e.relatedTarget){if(Qe){e:{try{We(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:$t[e.pointerType]||"",this.a=e,e.defaultPrevented&&this.preventDefault()}}Qt.prototype.preventDefault=function(){this.defaultPrevented=!0},E(Xt,Qt);var $t=zt({2:"touch",3:"pen",4:"mouse"});Xt.prototype.preventDefault=function(){Xt.$a.preventDefault.call(this);var e=this.a;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,Kt)try{(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)&&(e.keyCode=-1)}catch(t){}},Xt.prototype.g=function(){return this.a};var Jt="closure_listenable_"+(1e6*Math.random()|0),Zt=0;function en(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.Ua=i,this.key=++Zt,this.va=this.Oa=!1}function tn(e){e.va=!0,e.listener=null,e.proxy=null,e.src=null,e.Ua=null}function nn(e){this.src=e,this.a={},this.b=0}function rn(e,t){var n=t.type;n in e.a&&Y(e.a[n],t)&&(tn(t),0==e.a[n].length&&(delete e.a[n],e.b--))}function an(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.va&&a.listener==t&&a.capture==!!n&&a.Ua==r)return i}return-1}nn.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.a[a])||(e=this.a[a]=[],this.b++);var o=an(e,t,r,i);return-1<o?(t=e[o],n||(t.Oa=!1)):((t=new en(t,this.src,a,!!r,i)).Oa=n,e.push(t)),t};var on="closure_lm_"+(1e6*Math.random()|0),sn={};function un(e,t,n,r,i){if(r&&r.once)cn(e,t,n,r,i);else if(Array.isArray(t))for(var a=0;a<t.length;a++)un(e,t[a],n,r,i);else n=_n(n),e&&e[Jt]?wn(e,t,n,g(r)?!!r.capture:!!r,i):ln(e,t,n,!1,r,i)}function ln(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=g(i)?!!i.capture:!!i,s=mn(e);if(s||(e[on]=s=new nn(e)),!(n=s.add(t,n,r,o,a)).proxy){if(r=function(){var e=vn,t=Gt?function(n){return e.call(t.src,t.listener,n)}:function(n){if(!(n=e.call(t.src,t.listener,n)))return n};return t}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Yt||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(fn(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}0}}function cn(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)cn(e,t[a],n,r,i);else n=_n(n),e&&e[Jt]?kn(e,t,n,g(r)?!!r.capture:!!r,i):ln(e,t,n,!0,r,i)}function dn(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)dn(e,t[a],n,r,i);else r=g(r)?!!r.capture:!!r,n=_n(n),e&&e[Jt]?(e=e.v,(t=String(t).toString())in e.a&&(-1<(n=an(a=e.a[t],n,r,i))&&(tn(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.a[t],e.b--)))):e&&(e=mn(e))&&(t=e.a[t.toString()],e=-1,t&&(e=an(t,n,r,i)),(n=-1<e?t[e]:null)&&hn(n))}function hn(e){if("number"!==typeof e&&e&&!e.va){var t=e.src;if(t&&t[Jt])rn(t.v,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(fn(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=mn(t))?(rn(n,e),0==n.b&&(n.src=null,t[on]=null)):tn(e)}}}function fn(e){return e in sn?sn[e]:sn[e]="on"+e}function pn(e,t,n,r){var i=!0;if((e=mn(e))&&(t=e.a[t.toString()]))for(t=t.concat(),e=0;e<t.length;e++){var a=t[e];a&&a.capture==n&&!a.va&&(a=gn(a,r),i=i&&!1!==a)}return i}function gn(e,t){var n=e.listener,r=e.Ua||e.src;return e.Oa&&hn(e),n.call(r,t)}function vn(e,t){if(e.va)return!0;if(!Gt){if(!t)e:{t=["window","event"];for(var n=u,r=0;r<t.length;r++)if(null==(n=n[t[r]])){t=null;break e}t=n}if(t=new Xt(r=t,this),n=!0,!(0>r.keyCode||void 0!=r.returnValue)){e:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break e}catch(o){i=!0}(i||void 0==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=t.b;i;i=i.parentNode)r.push(i);for(e=e.type,i=r.length-1;0<=i;i--){t.b=r[i];var a=pn(r[i],e,!0,t);n=n&&a}for(i=0;i<r.length;i++)t.b=r[i],a=pn(r[i],e,!1,t),n=n&&a}return n}return gn(e,new Xt(t,this))}function mn(e){return(e=e[on])instanceof nn?e:null}var yn="__closure_events_fn_"+(1e9*Math.random()>>>0);function _n(e){return p(e)?e:(e[yn]||(e[yn]=function(t){return e.handleEvent(t)}),e[yn])}function bn(){Vt.call(this),this.v=new nn(this),this.$b=this,this.fb=null}function wn(e,t,n,r,i){e.v.add(String(t),n,!1,r,i)}function kn(e,t,n,r,i){e.v.add(String(t),n,!0,r,i)}function Sn(e,t,n,r){if(!(t=e.v.a[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.va&&o.capture==n){var s=o.listener,u=o.Ua||o.src;o.Oa&&rn(e.v,o),i=!1!==s.call(u,r)&&i}}return i&&!r.defaultPrevented}function En(e,t,n){if(p(e))n&&(e=w(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=w(e.handleEvent,e)}return 2147483647<Number(t)?-1:u.setTimeout(e,t||0)}function Pn(e){var t=null;return new _t((function(n,r){-1==(t=En((function(){n(void 0)}),e))&&r(Error("Failed to schedule timer."))})).s((function(e){throw u.clearTimeout(t),e}))}function In(e){if(e.V&&"function"==typeof e.V)return e.V();if("string"===typeof e)return e.split("");if(f(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}function Dn(e){if(e.Y&&"function"==typeof e.Y)return e.Y();if(!e.V||"function"!=typeof e.V){if(f(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(var r in t=[],n=0,e)t[n++]=r;return t}}function Tn(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Tn)for(n=e.Y(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function xn(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];Cn(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){var i={};for(n=t=0;t<e.a.length;)Cn(i,r=e.a[t])||(e.a[n++]=r,i[r]=1),t++;e.a.length=n}}function Cn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}E(bn,Vt),bn.prototype[Jt]=!0,bn.prototype.addEventListener=function(e,t,n,r){un(this,e,t,n,r)},bn.prototype.removeEventListener=function(e,t,n,r){dn(this,e,t,n,r)},bn.prototype.dispatchEvent=function(e){var t,n=this.fb;if(n)for(t=[];n;n=n.fb)t.push(n);n=this.$b;var r=e.type||e;if("string"===typeof e)e=new Qt(e,n);else if(e instanceof Qt)e.target=e.target||n;else{var i=e;ve(e=new Qt(r,n),i)}if(i=!0,t)for(var a=t.length-1;0<=a;a--){var o=e.b=t[a];i=Sn(o,r,!0,e)&&i}if(i=Sn(o=e.b=n,r,!0,e)&&i,i=Sn(o,r,!1,e)&&i,t)for(a=0;a<t.length;a++)i=Sn(o=e.b=t[a],r,!1,e)&&i;return i},bn.prototype.Da=function(){if(bn.$a.Da.call(this),this.v){var e,t=this.v;for(e in t.a){for(var n=t.a[e],r=0;r<n.length;r++)tn(n[r]);delete t.a[e],t.b--}}this.fb=null},(n=Tn.prototype).V=function(){xn(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e},n.Y=function(){return xn(this),this.a.concat()},n.clear=function(){this.b={},this.c=this.a.length=0},n.get=function(e,t){return Cn(this.b,e)?this.b[e]:t},n.set=function(e,t){Cn(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t},n.forEach=function(e,t){for(var n=this.Y(),r=0;r<n.length;r++){var i=n[r],a=this.get(i);e.call(t,a,i,this)}};var An=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/\\#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ln(e,t){var n;this.a=this.l=this.f="",this.g=null,this.h=this.c="",this.i=!1,e instanceof Ln?(this.i=void 0!==t?t:e.i,On(this,e.f),this.l=e.l,this.a=e.a,Mn(this,e.g),this.c=e.c,Rn(this,er(e.b)),this.h=e.h):e&&(n=String(e).match(An))?(this.i=!!t,On(this,n[1]||"",!0),this.l=Bn(n[2]||""),this.a=Bn(n[3]||"",!0),Mn(this,n[4]),this.c=Bn(n[5]||"",!0),Rn(this,n[6]||"",!0),this.h=Bn(n[7]||"")):(this.i=!!t,this.b=new Yn(null,this.i))}function On(e,t,n){e.f=n?Bn(t,!0):t,e.f&&(e.f=e.f.replace(/:$/,""))}function Mn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.g=t}else e.g=null}function Rn(e,t,n){t instanceof Yn?(e.b=t,function(e,t){t&&!e.f&&(Qn(e),e.c=null,e.a.forEach((function(e,t){var n=t.toLowerCase();t!=n&&($n(this,t),Zn(this,n,e))}),e)),e.f=t}(e.b,e.i)):(n||(t=Vn(t,Gn)),e.b=new Yn(t,e.i))}function Fn(e,t,n){e.b.set(t,n)}function Nn(e,t){return e.b.get(t)}function jn(e){return e instanceof Ln?new Ln(e):new Ln(e,void 0)}function Un(e,t,n,r){var i=new Ln(null,void 0);return e&&On(i,e),t&&(i.a=t),n&&Mn(i,n),r&&(i.c=r),i}function Bn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Vn(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,Hn),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Hn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ln.prototype.toString=function(){var e=[],t=this.f;t&&e.push(Vn(t,Wn,!0),":");var n=this.a;return(n||"file"==t)&&(e.push("//"),(t=this.l)&&e.push(Vn(t,Wn,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.g)&&e.push(":",String(n))),(n=this.c)&&(this.a&&"/"!=n.charAt(0)&&e.push("/"),e.push(Vn(n,"/"==n.charAt(0)?zn:qn,!0))),(n=this.b.toString())&&e.push("?",n),(n=this.h)&&e.push("#",Vn(n,Kn)),e.join("")},Ln.prototype.resolve=function(e){var t=new Ln(this),n=!!e.f;n?On(t,e.f):n=!!e.l,n?t.l=e.l:n=!!e.a,n?t.a=e.a:n=null!=e.g;var r=e.c;if(n)Mn(t,e.g);else if(n=!!e.c){if("/"!=r.charAt(0))if(this.a&&!this.c)r="/"+r;else{var i=t.c.lastIndexOf("/");-1!=i&&(r=t.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(se(i,"./")||se(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var a=[],o=0;o<i.length;){var s=i[o++];"."==s?r&&o==i.length&&a.push(""):".."==s?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),r&&o==i.length&&a.push("")):(a.push(s),r=!0)}r=a.join("/")}else r=i}return n?t.c=r:n=""!==e.b.toString(),n?Rn(t,er(e.b)):n=!!e.h,n&&(t.h=e.h),t};var Wn=/[#\/\?@]/g,qn=/[#\?:]/g,zn=/[#\?]/g,Gn=/[#\?@]/g,Kn=/#/g;function Yn(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function Qn(e){e.a||(e.a=new Tn,e.b=0,e.c&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.c,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Xn(e){var t=Dn(e);if("undefined"==typeof t)throw Error("Keys are undefined");var n=new Yn(null,void 0);e=In(e);for(var r=0;r<t.length;r++){var i=t[r],a=e[r];Array.isArray(a)?Zn(n,i,a):n.add(i,a)}return n}function $n(e,t){Qn(e),t=tr(e,t),Cn(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,Cn((e=e.a).b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&xn(e)))}function Jn(e,t){return Qn(e),t=tr(e,t),Cn(e.a.b,t)}function Zn(e,t,n){$n(e,t),0<n.length&&(e.c=null,e.a.set(tr(e,t),$(n)),e.b+=n.length)}function er(e){var t=new Yn;return t.c=e.c,e.a&&(t.a=new Tn(e.a),t.b=e.b),t}function tr(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}function nr(e){var t=[];return ir(new rr,e,t),t.join("")}function rr(){}function ir(e,t,n){if(null==t)n.push("null");else{if("object"==typeof t){if(Array.isArray(t)){var r=t;t=r.length,n.push("[");for(var i="",a=0;a<t;a++)n.push(i),ir(e,r[a],n),i=",";return void n.push("]")}if(!(t instanceof String||t instanceof Number||t instanceof Boolean)){for(r in n.push("{"),i="",t)Object.prototype.hasOwnProperty.call(t,r)&&("function"!=typeof(a=t[r])&&(n.push(i),sr(r,n),n.push(":"),ir(e,a,n),i=","));return void n.push("}")}t=t.valueOf()}switch(typeof t){case"string":sr(t,n);break;case"number":n.push(isFinite(t)&&!isNaN(t)?String(t):"null");break;case"boolean":n.push(String(t));break;case"function":n.push("null");break;default:throw Error("Unknown type: "+typeof t)}}}(n=Yn.prototype).add=function(e,t){Qn(this),this.c=null,e=tr(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this},n.clear=function(){this.a=this.c=null,this.b=0},n.forEach=function(e,t){Qn(this),this.a.forEach((function(n,r){W(n,(function(n){e.call(t,n,r,this)}),this)}),this)},n.Y=function(){Qn(this);for(var e=this.a.V(),t=this.a.Y(),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},n.V=function(e){Qn(this);var t=[];if("string"===typeof e)Jn(this,e)&&(t=X(t,this.a.get(tr(this,e))));else{e=this.a.V();for(var n=0;n<e.length;n++)t=X(t,e[n])}return t},n.set=function(e,t){return Qn(this),this.c=null,Jn(this,e=tr(this,e))&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.Y(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.V(r);for(var a=0;a<r.length;a++){var o=i;""!==r[a]&&(o+="="+encodeURIComponent(String(r[a]))),e.push(o)}}return this.c=e.join("&")};var ar={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},or=/\uffff/.test("\uffff")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function sr(e,t){t.push('"',e.replace(or,(function(e){var t=ar[e];return t||(t="\\u"+(65536|e.charCodeAt(0)).toString(16).substr(1),ar[e]=t),t})),'"')}function ur(){var e=Tr();return Ge&&!!tt&&11==tt||/Edge\/\d+/.test(e)}function lr(){return u.window&&u.window.location.href||self&&self.location&&self.location.href||""}function cr(e,t){t=t||u.window;var n="about:blank";e&&(n=Ae(Oe(e))),t.location.href=n}function dr(e,t){var n,r=[];for(n in e)n in t?typeof e[n]!=typeof t[n]?r.push(n):"object"==typeof e[n]&&null!=e[n]&&null!=t[n]?0<dr(e[n],t[n]).length&&r.push(n):e[n]!==t[n]&&r.push(n):r.push(n);for(n in t)n in e||r.push(n);return r}function hr(e){return!!((e=(e||Tr()).toLowerCase()).match(/android/)||e.match(/webos/)||e.match(/iphone|ipad|ipod/)||e.match(/blackberry/)||e.match(/windows phone/)||e.match(/iemobile/))}function fr(e){e=e||u.window;try{e.close()}catch(t){}}function pr(e,t,n){var r=Math.floor(1e9*Math.random()).toString();t=t||500,n=n||600;var i=(window.screen.availHeight-n)/2,a=(window.screen.availWidth-t)/2;for(o in t={width:t,height:n,top:0<i?i:0,left:0<a?a:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=Tr().toLowerCase(),r&&(t.target=r,se(n,"crios/")&&(t.target="_blank")),Pr(Tr())==Sr&&(e=e||"http://localhost",t.scrollbars=!0),n=e||"",(e=t)||(e={}),r=window,t=n instanceof Ce?n:Oe("undefined"!=typeof n.href?n.href:String(n)),n=e.target||n.target,i=[],e)switch(o){case"width":case"height":case"top":case"left":i.push(o+"="+e[o]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(o+"="+(e[o]?1:0))}var o=i.join(",");if((de("iPhone")&&!de("iPod")&&!de("iPad")||de("iPad")||de("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(me(o=dt(document,"A"),"HTMLAnchorElement"),t instanceof Ce||t instanceof Ce||(t="object"==typeof t&&t.sa?t.ra():String(t),Le.test(t)||(t="about:invalid#zClosurez"),t=new Ce(Re,t)),o.href=Ae(t),o.setAttribute("target",n),e.noreferrer&&o.setAttribute("rel","noreferrer"),(e=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),o.dispatchEvent(e),o={}):e.noreferrer?(o=r.open("",n,o),e=Ae(t),o&&(Ye&&se(e,";")&&(e="'"+e.replace(/'/g,"%27")+"'"),o.opener=null,e=Ue('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+He(e)+'">'),r=o.document)&&(r.write(Ne(e)),r.close())):(o=r.open(Ae(t),n,o))&&e.noopener&&(o.opener=null),o)try{o.focus()}catch(s){}return o}var gr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,vr=/^[^@]+@[^@]+$/;function mr(){var e=null;return new _t((function(t){"complete"==u.document.readyState?t():(e=function(){t()},cn(window,"load",e))})).s((function(t){throw dn(window,"load",e),t}))}function yr(e){return e=e||Tr(),!("file:"!==Or()&&"ionic:"!==Or()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function _r(){var e=u.window;try{return!(!e||e==e.top)}catch(t){return!1}}function br(){return"undefined"!==typeof u.WorkerGlobalScope&&"function"===typeof u.importScripts}function wr(){return t.a.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":t.a.INTERNAL.hasOwnProperty("node")?"Node":br()?"Worker":"Browser"}function kr(){var e=wr();return"ReactNative"===e||"Node"===e}var Sr="Firefox",Er="Chrome";function Pr(e){var t=e.toLowerCase();return se(t,"opera/")||se(t,"opr/")||se(t,"opios/")?"Opera":se(t,"iemobile")?"IEMobile":se(t,"msie")||se(t,"trident/")?"IE":se(t,"edge/")?"Edge":se(t,"firefox/")?Sr:se(t,"silk/")?"Silk":se(t,"blackberry")?"Blackberry":se(t,"webos")?"Webos":!se(t,"safari/")||se(t,"chrome/")||se(t,"crios/")||se(t,"android")?!se(t,"chrome/")&&!se(t,"crios/")||se(t,"edge/")?se(t,"android")?"Android":(e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==e.length?e[1]:"Other":Er:"Safari"}var Ir={ld:"FirebaseCore-web",nd:"FirebaseUI-web"};function Dr(e,t){t=t||[];var n,r=[],i={};for(n in Ir)i[Ir[n]]=!0;for(n=0;n<t.length;n++)"undefined"!==typeof i[t[n]]&&(delete i[t[n]],r.push(t[n]));return r.sort(),(t=r).length||(t=["FirebaseCore-web"]),"Browser"===(r=wr())?r=Pr(i=Tr()):"Worker"===r&&(r=Pr(i=Tr())+"-"+r),r+"/JsCore/"+e+"/"+t.join(",")}function Tr(){return u.navigator&&u.navigator.userAgent||""}function xr(e,t){e=e.split("."),t=t||u;for(var n=0;n<e.length&&"object"==typeof t&&null!=t;n++)t=t[e[n]];return n!=e.length&&(t=void 0),t}function Cr(){try{var e=u.localStorage,t=jr();if(e)return e.setItem(t,"1"),e.removeItem(t),!ur()||!!u.indexedDB}catch(n){return br()&&!!u.indexedDB}return!1}function Ar(){return(Lr()||"chrome-extension:"===Or()||yr())&&!kr()&&Cr()&&!br()}function Lr(){return"http:"===Or()||"https:"===Or()}function Or(){return u.location&&u.location.protocol||null}function Mr(e){return!hr(e=e||Tr())&&Pr(e)!=Sr}function Rr(e){return"undefined"===typeof e?null:nr(e)}function Fr(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&null!==e[t]&&void 0!==e[t]&&(n[t]=e[t]);return n}function Nr(e){if(null!==e)return JSON.parse(e)}function jr(e){return e||Math.floor(1e9*Math.random()).toString()}function Ur(e){return"Safari"!=Pr(e=e||Tr())&&!e.toLowerCase().match(/iphone|ipad|ipod/)}function Br(){var e=u.___jsl;if(e&&e.H)for(var t in e.H)if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=e.H[t].L.concat(),e.CP)for(var n=0;n<e.CP.length;n++)e.CP[n]=null}function Vr(e,t){if(e>t)throw Error("Short delay should be less than long delay!");this.a=e,this.c=t,e=Tr(),t=wr(),this.b=hr(e)||"ReactNative"===t}function Hr(){var e=u.document;return!e||"undefined"===typeof e.visibilityState||"visible"==e.visibilityState}function Wr(e){"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn(e)}function qr(e){try{var t=new Date(parseInt(e,10));if(!isNaN(t.getTime())&&!/[^0-9]/.test(e))return t.toUTCString()}catch(n){}return null}function zr(){return!(!xr("fireauth.oauthhelper",u)&&!xr("fireauth.iframe",u))}Vr.prototype.get=function(){var e=u.navigator;return!e||"boolean"!==typeof e.onLine||!Lr()&&"chrome-extension:"!==Or()&&"undefined"===typeof e.connection||e.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Gr,Kr={};function Yr(e){Kr[e]||(Kr[e]=!0,Wr(e))}try{var Qr={};Object.defineProperty(Qr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Qr,"abcd",{configurable:!0,enumerable:!0,value:2}),Gr=2==Qr.abcd}catch(lo){Gr=!1}function Xr(e,t,n){Gr?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,value:n}):e[t]=n}function $r(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&Xr(e,n,t[n])}function Jr(e){var t={};return $r(t,e),t}function Zr(e){var t=e;if("object"==typeof e&&null!=e)for(var n in t="length"in e?[]:{},e)Xr(t,n,Zr(e[n]));return t}function ei(e){var t=e&&(e[ai]?"phone":null);if(!(t&&e&&e[ii]))throw new P("internal-error","Internal assert: invalid MultiFactorInfo object");Xr(this,"uid",e[ii]),Xr(this,"displayName",e[ni]||null);var n=null;e[ri]&&(n=new Date(e[ri]).toUTCString()),Xr(this,"enrollmentTime",n),Xr(this,"factorId",t)}function ti(e){try{var t=new oi(e)}catch(n){t=null}return t}ei.prototype.w=function(){return{uid:this.uid,displayName:this.displayName,factorId:this.factorId,enrollmentTime:this.enrollmentTime}};var ni="displayName",ri="enrolledAt",ii="mfaEnrollmentId",ai="phoneInfo";function oi(e){ei.call(this,e),Xr(this,"phoneNumber",e[ai])}function si(e){var t={},n=e[di],r=e[fi],i=e[pi];if(e=ti(e[hi]),!i||i!=li&&i!=ci&&!n||i==ci&&!r||i==ui&&!e)throw Error("Invalid checkActionCode response!");i==ci?(t[vi]=n||null,t[yi]=n||null,t[gi]=r):(t[vi]=r||null,t[yi]=r||null,t[gi]=n||null),t[mi]=e||null,Xr(this,bi,i),Xr(this,_i,Zr(t))}E(oi,ei),oi.prototype.w=function(){var e=oi.$a.w.call(this);return e.phoneNumber=this.phoneNumber,e};var ui="REVERT_SECOND_FACTOR_ADDITION",li="EMAIL_SIGNIN",ci="VERIFY_AND_CHANGE_EMAIL",di="email",hi="mfaInfo",fi="newEmail",pi="requestType",gi="email",vi="fromEmail",mi="multiFactorInfo",yi="previousEmail",_i="data",bi="operation";function wi(e){var t=Nn(e=jn(e),ki)||null,n=Nn(e,Si)||null,r=Nn(e,Ii)||null;if(r=r&&Ti[r]||null,!t||!n||!r)throw new P("argument-error",ki+", "+Si+"and "+Ii+" are required in a valid action code URL.");$r(this,{apiKey:t,operation:r,code:n,continueUrl:Nn(e,Ei)||null,languageCode:Nn(e,Pi)||null,tenantId:Nn(e,Di)||null})}var ki="apiKey",Si="oobCode",Ei="continueUrl",Pi="languageCode",Ii="mode",Di="tenantId",Ti={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",revertSecondFactorAddition:ui,signIn:li,verifyAndChangeEmail:ci,verifyEmail:"VERIFY_EMAIL"};function xi(e){try{return new wi(e)}catch(t){return null}}function Ci(e){var t=e[Ri];if("undefined"===typeof t)throw new P("missing-continue-uri");if("string"!==typeof t||"string"===typeof t&&!t.length)throw new P("invalid-continue-uri");this.h=t,this.b=this.a=null,this.g=!1;var n=e[Ai];if(n&&"object"===typeof n){t=n[ji];var r=n[Fi];if(n=n[Ni],"string"===typeof t&&t.length){if(this.a=t,"undefined"!==typeof r&&"boolean"!==typeof r)throw new P("argument-error",Fi+" property must be a boolean when specified.");if(this.g=!!r,"undefined"!==typeof n&&("string"!==typeof n||"string"===typeof n&&!n.length))throw new P("argument-error",Ni+" property must be a non empty string when specified.");this.b=n||null}else{if("undefined"!==typeof t)throw new P("argument-error",ji+" property must be a non empty string when specified.");if("undefined"!==typeof r||"undefined"!==typeof n)throw new P("missing-android-pkg-name")}}else if("undefined"!==typeof n)throw new P("argument-error",Ai+" property must be a non null object when specified.");if(this.f=null,(t=e[Mi])&&"object"===typeof t){if("string"===typeof(t=t[Ui])&&t.length)this.f=t;else if("undefined"!==typeof t)throw new P("argument-error",Ui+" property must be a non empty string when specified.")}else if("undefined"!==typeof t)throw new P("argument-error",Mi+" property must be a non null object when specified.");if("undefined"!==typeof(t=e[Oi])&&"boolean"!==typeof t)throw new P("argument-error",Oi+" property must be a boolean when specified.");if(this.c=!!t,"undefined"!==typeof(e=e[Li])&&("string"!==typeof e||"string"===typeof e&&!e.length))throw new P("argument-error",Li+" property must be a non empty string when specified.");this.i=e||null}var Ai="android",Li="dynamicLinkDomain",Oi="handleCodeInApp",Mi="iOS",Ri="url",Fi="installApp",Ni="minimumVersion",ji="packageName",Ui="bundleId";function Bi(e){var t={};for(var n in t.continueUrl=e.h,t.canHandleCodeInApp=e.c,(t.androidPackageName=e.a)&&(t.androidMinimumVersion=e.b,t.androidInstallApp=e.g),t.iOSBundleId=e.f,t.dynamicLinkDomain=e.i,t)null===t[n]&&delete t[n];return t}var Vi=null;function Hi(e){var t="";return function(e,t){function n(t){for(;r<e.length;){var n=e.charAt(r++),i=Vi[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}!function(){if(!Vi){Vi={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++)for(var r=e.concat(t[n].split("")),i=0;i<r.length;i++){var a=r[i];void 0===Vi[a]&&(Vi[a]=i)}}}();for(var r=0;;){var i=n(-1),a=n(0),o=n(64),s=n(64);if(64===s&&-1===i)break;t(i<<2|a>>4),64!=o&&(t(a<<4&240|o>>2),64!=s&&t(o<<6&192|s))}}(e,(function(e){t+=String.fromCharCode(e)})),t}function Wi(e){var t=zi(e);if(!(t&&t.sub&&t.iss&&t.aud&&t.exp))throw Error("Invalid JWT");this.g=e,this.c=t.exp,this.h=t.sub,S(),this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.f=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function qi(e){try{return new Wi(e)}catch(t){return null}}function zi(e){if(!e)return null;if(3!=(e=e.split(".")).length)return null;for(var t=(4-(e=e[1]).length%4)%4,n=0;n<t;n++)e+=".";try{return JSON.parse(Hi(e))}catch(r){}return null}Wi.prototype.S=function(){return this.f},Wi.prototype.i=function(){return this.b},Wi.prototype.toString=function(){return this.g};var Gi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Ki=["client_id","response_type","scope","redirect_uri","state"],Yi={md:{Ja:"locale",ua:700,ta:600,fa:"facebook.com",Wa:Ki},od:{Ja:null,ua:500,ta:750,fa:"github.com",Wa:Ki},pd:{Ja:"hl",ua:515,ta:680,fa:"google.com",Wa:Ki},vd:{Ja:"lang",ua:485,ta:705,fa:"twitter.com",Wa:Gi},jd:{Ja:"locale",ua:640,ta:600,fa:"apple.com",Wa:[]}};function Qi(e){for(var t in Yi)if(Yi[t].fa==e)return Yi[t];return null}function Xi(e){var t={};t["facebook.com"]=ta,t["google.com"]=ra,t["github.com"]=na,t["twitter.com"]=ia;var n=e&&e[Ji];try{if(n)return t[n]?new t[n](e):new ea(e);if("undefined"!==typeof e[$i])return new Zi(e)}catch(r){}return null}var $i="idToken",Ji="providerId";function Zi(e){var t=e[Ji];if(!t&&e[$i]){var n=qi(e[$i]);n&&n.a&&(t=n.a)}if(!t)throw Error("Invalid additional user info!");"anonymous"!=t&&"custom"!=t||(t=null),n=!1,"undefined"!==typeof e.isNewUser?n=!!e.isNewUser:"identitytoolkit#SignupNewUserResponse"===e.kind&&(n=!0),Xr(this,"providerId",t),Xr(this,"isNewUser",n)}function ea(e){Zi.call(this,e),Xr(this,"profile",Zr((e=Nr(e.rawUserInfo||"{}"))||{}))}function ta(e){if(ea.call(this,e),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function na(e){if(ea.call(this,e),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Xr(this,"username",this.profile&&this.profile.login||null)}function ra(e){if(ea.call(this,e),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function ia(e){if(ea.call(this,e),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Xr(this,"username",e.screenName||null)}function aa(e){var t=jn(e),n=Nn(t,"link"),r=Nn(jn(n),"link");return t=Nn(t,"deep_link_id"),Nn(jn(t),"link")||t||r||n||e}function oa(e,t){if(!e&&!t)throw new P("internal-error","Internal assert: no raw session string available");if(e&&t)throw new P("internal-error","Internal assert: unable to determine the session type");this.a=e||null,this.b=t||null,this.type=this.a?sa:ua}E(ea,Zi),E(ta,ea),E(na,ea),E(ra,ea),E(ia,ea);var sa="enroll",ua="signin";function la(){}function ca(e,t){return e.then((function(e){if(e[es]){var n=qi(e[es]);if(!n||t!=n.h)throw new P("user-mismatch");return e}throw new P("user-mismatch")})).s((function(e){throw e&&e.code&&e.code==T+"user-not-found"?new P("user-mismatch"):e}))}function da(e,t){if(!t)throw new P("internal-error","failed to construct a credential");this.a=t,Xr(this,"providerId",e),Xr(this,"signInMethod",e)}function ha(e){return{pendingToken:e.a,requestUri:"http://localhost"}}function fa(e){if(e&&e.providerId&&e.signInMethod&&0==e.providerId.indexOf("saml.")&&e.pendingToken)try{return new da(e.providerId,e.pendingToken)}catch(t){}return null}function pa(e,t,n){if(this.a=null,t.idToken||t.accessToken)t.idToken&&Xr(this,"idToken",t.idToken),t.accessToken&&Xr(this,"accessToken",t.accessToken),t.nonce&&!t.pendingToken&&Xr(this,"nonce",t.nonce),t.pendingToken&&(this.a=t.pendingToken);else{if(!t.oauthToken||!t.oauthTokenSecret)throw new P("internal-error","failed to construct a credential");Xr(this,"accessToken",t.oauthToken),Xr(this,"secret",t.oauthTokenSecret)}Xr(this,"providerId",e),Xr(this,"signInMethod",n)}function ga(e){var t={};return e.idToken&&(t.id_token=e.idToken),e.accessToken&&(t.access_token=e.accessToken),e.secret&&(t.oauth_token_secret=e.secret),t.providerId=e.providerId,e.nonce&&!e.a&&(t.nonce=e.nonce),t={postBody:Xn(t).toString(),requestUri:"http://localhost"},e.a&&(delete t.postBody,t.pendingToken=e.a),t}function va(e){if(e&&e.providerId&&e.signInMethod){var t={idToken:e.oauthIdToken,accessToken:e.oauthTokenSecret?null:e.oauthAccessToken,oauthTokenSecret:e.oauthTokenSecret,oauthToken:e.oauthTokenSecret&&e.oauthAccessToken,nonce:e.nonce,pendingToken:e.pendingToken};try{return new pa(e.providerId,t,e.signInMethod)}catch(n){}}return null}function ma(e,t){this.Pc=t||[],$r(this,{providerId:e,isOAuthProvider:!0}),this.Hb={},this.ob=(Qi(e)||{}).Ja||null,this.nb=null}function ya(e){if("string"!==typeof e||0!=e.indexOf("saml."))throw new P("argument-error",'SAML provider IDs must be prefixed with "saml."');ma.call(this,e,[])}function _a(e){ma.call(this,e,Ki),this.a=[]}function ba(){_a.call(this,"facebook.com")}function wa(e){if(!e)throw new P("argument-error","credential failed: expected 1 argument (the OAuth access token).");var t=e;return g(e)&&(t=e.accessToken),(new ba).credential({accessToken:t})}function ka(){_a.call(this,"github.com")}function Sa(e){if(!e)throw new P("argument-error","credential failed: expected 1 argument (the OAuth access token).");var t=e;return g(e)&&(t=e.accessToken),(new ka).credential({accessToken:t})}function Ea(){_a.call(this,"google.com"),this.Ca("profile")}function Pa(e,t){var n=e;return g(e)&&(n=e.idToken,t=e.accessToken),(new Ea).credential({idToken:n,accessToken:t})}function Ia(){ma.call(this,"twitter.com",Gi)}function Da(e,t){var n=e;if(g(n)||(n={oauthToken:e,oauthTokenSecret:t}),!n.oauthToken||!n.oauthTokenSecret)throw new P("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new pa("twitter.com",n,"twitter.com")}function Ta(e,t,n){this.a=e,this.f=t,Xr(this,"providerId","password"),Xr(this,"signInMethod",n===Ca.EMAIL_LINK_SIGN_IN_METHOD?Ca.EMAIL_LINK_SIGN_IN_METHOD:Ca.EMAIL_PASSWORD_SIGN_IN_METHOD)}function xa(e){return e&&e.email&&e.password?new Ta(e.email,e.password,e.signInMethod):null}function Ca(){$r(this,{providerId:"password",isOAuthProvider:!1})}function Aa(e,t){if(!(t=La(t)))throw new P("argument-error","Invalid email link!");return new Ta(e,t.code,Ca.EMAIL_LINK_SIGN_IN_METHOD)}function La(e){return(e=xi(e=aa(e)))&&e.operation===li?e:null}function Oa(e){if(!(e.cb&&e.bb||e.La&&e.ea))throw new P("internal-error");this.a=e,Xr(this,"providerId","phone"),this.fa="phone",Xr(this,"signInMethod","phone")}function Ma(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var t={};return W(["verificationId","verificationCode","temporaryProof","phoneNumber"],(function(n){e[n]&&(t[n]=e[n])})),new Oa(t)}return null}function Ra(e){return e.a.La&&e.a.ea?{temporaryProof:e.a.La,phoneNumber:e.a.ea}:{sessionInfo:e.a.cb,code:e.a.bb}}function Fa(e){try{this.a=e||t.a.auth()}catch(n){throw new P("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}$r(this,{providerId:"phone",isOAuthProvider:!1})}function Na(e,t){if(!e)throw new P("missing-verification-id");if(!t)throw new P("missing-verification-code");return new Oa({cb:e,bb:t})}function ja(e){if(e.temporaryProof&&e.phoneNumber)return new Oa({La:e.temporaryProof,ea:e.phoneNumber});var t=e&&e.providerId;if(!t||"password"===t)return null;var n=e&&e.oauthAccessToken,r=e&&e.oauthTokenSecret,i=e&&e.nonce,a=e&&e.oauthIdToken,o=e&&e.pendingToken;try{switch(t){case"google.com":return Pa(a,n);case"facebook.com":return wa(n);case"github.com":return Sa(n);case"twitter.com":return Da(n,r);default:return n||r||a||o?o?0==t.indexOf("saml.")?new da(t,o):new pa(t,{pendingToken:o,idToken:e.oauthIdToken,accessToken:e.oauthAccessToken},t):new _a(t).credential({idToken:a,accessToken:n,rawNonce:i}):null}}catch(s){return null}}function Ua(e){if(!e.isOAuthProvider)throw new P("invalid-oauth-provider")}function Ba(e,t,n,r,i,a,o){if(this.c=e,this.b=t||null,this.g=n||null,this.f=r||null,this.i=a||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new P("invalid-auth-event");if(this.g&&this.a)throw new P("invalid-auth-event");if(this.g&&!this.f)throw new P("invalid-auth-event")}function Va(e){return(e=e||{}).type?new Ba(e.type,e.eventId,e.urlResponse,e.sessionId,e.error&&I(e.error),e.postBody,e.tenantId):null}function Ha(){this.b=null,this.a=[]}oa.prototype.Ha=function(){return this.a?It(this.a):It(this.b)},oa.prototype.w=function(){return this.type==sa?{multiFactorSession:{idToken:this.a}}:{multiFactorSession:{pendingCredential:this.b}}},la.prototype.ja=function(){},la.prototype.b=function(){},la.prototype.c=function(){},la.prototype.w=function(){},da.prototype.ja=function(e){return ks(e,ha(this))},da.prototype.b=function(e,t){var n=ha(this);return n.idToken=t,Ss(e,n)},da.prototype.c=function(e,t){return ca(Es(e,ha(this)),t)},da.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},pa.prototype.ja=function(e){return ks(e,ga(this))},pa.prototype.b=function(e,t){var n=ga(this);return n.idToken=t,Ss(e,n)},pa.prototype.c=function(e,t){return ca(Es(e,ga(this)),t)},pa.prototype.w=function(){var e={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(e.oauthIdToken=this.idToken),this.accessToken&&(e.oauthAccessToken=this.accessToken),this.secret&&(e.oauthTokenSecret=this.secret),this.nonce&&(e.nonce=this.nonce),this.a&&(e.pendingToken=this.a),e},ma.prototype.Ka=function(e){return this.Hb=pe(e),this},E(ya,ma),E(_a,ma),_a.prototype.Ca=function(e){return K(this.a,e)||this.a.push(e),this},_a.prototype.Pb=function(){return $(this.a)},_a.prototype.credential=function(e,t){var n;if(!(n=g(e)?{idToken:e.idToken||null,accessToken:e.accessToken||null,nonce:e.rawNonce||null}:{idToken:e||null,accessToken:t||null}).idToken&&!n.accessToken)throw new P("argument-error","credential failed: must provide the ID token and/or the access token.");return new pa(this.providerId,n,this.providerId)},E(ba,_a),Xr(ba,"PROVIDER_ID","facebook.com"),Xr(ba,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),E(ka,_a),Xr(ka,"PROVIDER_ID","github.com"),Xr(ka,"GITHUB_SIGN_IN_METHOD","github.com"),E(Ea,_a),Xr(Ea,"PROVIDER_ID","google.com"),Xr(Ea,"GOOGLE_SIGN_IN_METHOD","google.com"),E(Ia,ma),Xr(Ia,"PROVIDER_ID","twitter.com"),Xr(Ia,"TWITTER_SIGN_IN_METHOD","twitter.com"),Ta.prototype.ja=function(e){return this.signInMethod==Ca.EMAIL_LINK_SIGN_IN_METHOD?au(e,Ls,{email:this.a,oobCode:this.f}):au(e,eu,{email:this.a,password:this.f})},Ta.prototype.b=function(e,t){return this.signInMethod==Ca.EMAIL_LINK_SIGN_IN_METHOD?au(e,Os,{idToken:t,email:this.a,oobCode:this.f}):au(e,Gs,{idToken:t,email:this.a,password:this.f})},Ta.prototype.c=function(e,t){return ca(this.ja(e),t)},Ta.prototype.w=function(){return{email:this.a,password:this.f,signInMethod:this.signInMethod}},$r(Ca,{PROVIDER_ID:"password"}),$r(Ca,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),$r(Ca,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Oa.prototype.ja=function(e){return e.eb(Ra(this))},Oa.prototype.b=function(e,t){var n=Ra(this);return n.idToken=t,au(e,nu,n)},Oa.prototype.c=function(e,t){var n=Ra(this);return n.operation="REAUTH",ca(e=au(e,ru,n),t)},Oa.prototype.w=function(){var e={providerId:"phone"};return this.a.cb&&(e.verificationId=this.a.cb),this.a.bb&&(e.verificationCode=this.a.bb),this.a.La&&(e.temporaryProof=this.a.La),this.a.ea&&(e.phoneNumber=this.a.ea),e},Fa.prototype.eb=function(e,t){var n=this.a.a;return It(t.verify()).then((function(r){if("string"!==typeof r)throw new P("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(t.type){case"recaptcha":var i=g(e)?e.session:null,a=g(e)?e.phoneNumber:e;return(i&&i.type==sa?i.Ha().then((function(e){return function(e,t){return au(e,Ys,t).then((function(e){return e.phoneSessionInfo.sessionInfo}))}(n,{idToken:e,phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:r}})})):i&&i.type==ua?i.Ha().then((function(t){return function(e,t){return au(e,Qs,t).then((function(e){return e.phoneResponseInfo.sessionInfo}))}(n,{mfaPendingCredential:t,mfaEnrollmentId:e.multiFactorHint&&e.multiFactorHint.uid||e.multiFactorUid,phoneSignInInfo:{recaptchaToken:r}})})):function(e,t){return au(e,qs,t)}(n,{phoneNumber:a,recaptchaToken:r})).then((function(e){return"function"===typeof t.reset&&t.reset(),e}),(function(e){throw"function"===typeof t.reset&&t.reset(),e}));default:throw new P("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}}))},$r(Fa,{PROVIDER_ID:"phone"}),$r(Fa,{PHONE_SIGN_IN_METHOD:"phone"}),Ba.prototype.getUid=function(){var e=[];return e.push(this.c),this.b&&e.push(this.b),this.f&&e.push(this.f),this.h&&e.push(this.h),e.join("-")},Ba.prototype.S=function(){return this.h},Ba.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.w()}};var Wa,qa=null;function za(e){var t="unauthorized-domain",n=void 0,r=jn(e);e=r.a,"chrome-extension"==(r=r.f)?n=Ve("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",e):"http"==r||"https"==r?n=Ve("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",e):t="operation-not-supported-in-this-environment",P.call(this,t,n)}function Ga(e,t,n){P.call(this,e,n),(e=t||{}).Ib&&Xr(this,"email",e.Ib),e.ea&&Xr(this,"phoneNumber",e.ea),e.credential&&Xr(this,"credential",e.credential),e.Yb&&Xr(this,"tenantId",e.Yb)}function Ka(e){if(e.code){var t=e.code||"";0==t.indexOf(T)&&(t=t.substring(T.length));var n={credential:ja(e),Yb:e.tenantId};if(e.email)n.Ib=e.email;else if(e.phoneNumber)n.ea=e.phoneNumber;else if(!n.credential)return new P(t,e.message||void 0);return new Ga(t,n,e.message)}return null}function Ya(){}function Qa(e){return e.c||(e.c=e.b())}function Xa(){}function $a(e){if(!e.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var t=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<t.length;n++){var r=t[n];try{return new ActiveXObject(r),e.f=r}catch(i){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return e.f}function Ja(){}function Za(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=w(this.pc,this),this.a.onerror=w(this.Rb,this),this.a.onprogress=w(this.qc,this),this.a.ontimeout=w(this.uc,this)}function eo(e,t){e.readyState=t,e.onreadystatechange&&e.onreadystatechange()}function to(e,t,n){this.reset(e,t,n,void 0,void 0)}E(za,P),E(Ga,P),Ga.prototype.w=function(){var e={code:this.code,message:this.message};this.email&&(e.email=this.email),this.phoneNumber&&(e.phoneNumber=this.phoneNumber),this.tenantId&&(e.tenantId=this.tenantId);var t=this.credential&&this.credential.w();return t&&ve(e,t),e},Ga.prototype.toJSON=function(){return this.w()},Ya.prototype.c=null,E(Xa,Ya),Xa.prototype.a=function(){var e=$a(this);return e?new ActiveXObject(e):new XMLHttpRequest},Xa.prototype.b=function(){var e={};return $a(this)&&(e[0]=!0,e[1]=!0),e},Wa=new Xa,E(Ja,Ya),Ja.prototype.a=function(){var e=new XMLHttpRequest;if("withCredentials"in e)return e;if("undefined"!=typeof XDomainRequest)return new Za;throw Error("Unsupported browser")},Ja.prototype.b=function(){return{}},(n=Za.prototype).open=function(e,t,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(e,t)},n.send=function(e){if(e){if("string"!=typeof e)throw Error("Only string data is supported");this.a.send(e)}else this.a.send()},n.abort=function(){this.a.abort()},n.setRequestHeader=function(){},n.getResponseHeader=function(e){return"content-type"==e.toLowerCase()?this.a.contentType:""},n.pc=function(){this.status=200,this.response=this.responseText=this.a.responseText,eo(this,4)},n.Rb=function(){this.status=500,this.response=this.responseText="",eo(this,4)},n.uc=function(){this.Rb()},n.qc=function(){this.status=200,eo(this,1)},n.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},to.prototype.a=null;function no(e){this.f=e,this.b=this.c=this.a=null}function ro(e,t){this.name=e,this.value=t}to.prototype.reset=function(e,t,n,r,i){"number"==typeof i||0,r||S(),delete this.a},ro.prototype.toString=function(){return this.name};var io=new ro("SEVERE",1e3),ao=new ro("WARNING",900),oo=new ro("CONFIG",700),so=new ro("FINE",500);function uo(e){return e.c?e.c:e.a?uo(e.a):(R("Root logger has no level set."),null)}no.prototype.log=function(e,t,n){if(e.value>=uo(this).value)for(p(t)&&(t=t()),e=new to(e,String(t),this.f),n&&(e.a=n),n=this;n;)n=n.a};var lo,co={},ho=null;function fo(e){var t;if(ho||(ho=new no(""),co[""]=ho,ho.c=oo),!(t=co[e])){t=new no(e);var n=e.lastIndexOf("."),r=e.substr(n+1);(n=fo(e.substr(0,n))).b||(n.b={}),n.b[r]=t,t.a=n,co[e]=t}return t}function po(e,t){e&&e.log(so,t,void 0)}function go(e){this.f=e}function vo(e){bn.call(this),this.o=e,this.readyState=mo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=fo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}E(go,Ya),go.prototype.a=function(){return new vo(this.f)},go.prototype.b=(lo={},function(){return lo}),E(vo,bn);var mo=0;function yo(e){e.c.read().then(e.oc.bind(e)).catch(e.Ta.bind(e))}function _o(e,t){t&&e.f&&(e.status=e.f.status,e.statusText=e.f.statusText),e.readyState=4,e.f=null,e.c=null,e.l=null,bo(e)}function bo(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function wo(e){bn.call(this),this.headers=new Tn,this.O=e||null,this.c=!1,this.A=this.a=null,this.h=this.P=this.l="",this.f=this.N=this.i=this.G=!1,this.g=0,this.o=null,this.m=ko,this.u=this.R=!1}(n=vo.prototype).open=function(e,t){if(this.readyState!=mo)throw this.abort(),Error("Error reopening a connection");this.m=e,this.g=t,this.readyState=1,bo(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var t={headers:this.i,method:this.m,credentials:void 0,cache:void 0};e&&(t.body=e),this.o.fetch(new Request(this.g,t)).then(this.tc.bind(this),this.Ta.bind(this))},n.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,_o(this,!1)),this.readyState=mo},n.tc=function(e){this.a&&(this.f=e,this.b||(this.b=e.headers,this.readyState=2,bo(this)),this.a&&(this.readyState=3,bo(this),this.a&&("arraybuffer"===this.responseType?e.arrayBuffer().then(this.rc.bind(this),this.Ta.bind(this)):"undefined"!==typeof u.ReadableStream&&"body"in e?(this.response=this.responseText="",this.c=e.body.getReader(),this.l=new TextDecoder,yo(this)):e.text().then(this.sc.bind(this),this.Ta.bind(this)))))},n.oc=function(e){if(this.a){var t=this.l.decode(e.value?e.value:new Uint8Array(0),{stream:!e.done});t&&(this.response=this.responseText+=t),e.done?_o(this,!0):bo(this),3==this.readyState&&yo(this)}},n.sc=function(e){this.a&&(this.response=this.responseText=e,_o(this,!0))},n.rc=function(e){this.a&&(this.response=e,_o(this,!0))},n.Ta=function(e){var t=this.h;t&&t.log(ao,"Failed to fetch url "+this.g,e instanceof Error?e:Error(e)),this.a&&_o(this,!0)},n.setRequestHeader=function(e,t){this.i.append(e,t)},n.getResponseHeader=function(e){return this.b?this.b.get(e.toLowerCase())||"":((e=this.h)&&e.log(ao,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},n.getAllResponseHeaders=function(){if(!this.b){var e=this.h;return e&&e.log(ao,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}e=[];for(var t=this.b.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},E(wo,bn);var ko="";wo.prototype.b=fo("goog.net.XhrIo");var So=/^https?$/i,Eo=["POST","PUT"];function Po(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.P=n,e.G=!1,e.c=!0,e.a=e.O?e.O.a():Wa.a(),e.A=e.O?Qa(e.O):Qa(Wa),e.a.onreadystatechange=w(e.Ub,e);try{po(e.b,Mo(e,"Opening Xhr")),e.N=!0,e.a.open(n,String(t),!0),e.N=!1}catch(o){return po(e.b,Mo(e,"Error opening Xhr: "+o.message)),void Do(e,o)}t=r||"";var a=new Tn(e.headers);i&&function(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(f(e)||"string"===typeof e)W(e,t,void 0);else for(var n=Dn(e),r=In(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}(i,(function(e,t){a.set(t,e)})),i=function(e){e:{for(var t=Io,n=e.length,r="string"===typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"===typeof e?e.charAt(t):e[t]}(a.Y()),r=u.FormData&&t instanceof u.FormData,!K(Eo,n)||i||r||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach((function(e,t){this.a.setRequestHeader(t,e)}),e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.R&&(e.a.withCredentials=e.R);try{Ao(e),0<e.g&&(e.u=function(e){return Ge&&rt(9)&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(e.a),po(e.b,Mo(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.u)),e.u?(e.a.timeout=e.g,e.a.ontimeout=w(e.Ma,e)):e.o=En(e.Ma,e.g,e)),po(e.b,Mo(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(o){po(e.b,Mo(e,"Send error: "+o.message)),Do(e,o)}}function Io(e){return"content-type"==e.toLowerCase()}function Do(e,t){e.c=!1,e.a&&(e.f=!0,e.a.abort(),e.f=!1),e.h=t,To(e),Co(e)}function To(e){e.G||(e.G=!0,e.dispatchEvent("complete"),e.dispatchEvent("error"))}function xo(e){if(e.c&&"undefined"!=typeof s)if(e.A[1]&&4==Lo(e)&&2==Oo(e))po(e.b,Mo(e,"Local request error detected and ignored"));else if(e.i&&4==Lo(e))En(e.Ub,0,e);else if(e.dispatchEvent("readystatechange"),4==Lo(e)){po(e.b,Mo(e,"Request complete")),e.c=!1;try{var t,n=Oo(e);e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.l).match(An)[1]||null;if(!a&&u.self&&u.self.location){var o=u.self.location.protocol;a=o.substr(0,o.length-1)}i=!So.test(a?a.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var l=2<Lo(e)?e.a.statusText:""}catch(c){po(e.b,"Can not get status: "+c.message),l=""}e.h=l+" ["+Oo(e)+"]",To(e)}}finally{Co(e)}}}function Co(e,t){if(e.a){Ao(e);var n=e.a,r=e.A[0]?d:null;e.a=null,e.A=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(i){(e=e.b)&&e.log(io,"Problem encountered resetting onreadystatechange: "+i.message,void 0)}}}function Ao(e){e.a&&e.u&&(e.a.ontimeout=null),e.o&&(u.clearTimeout(e.o),e.o=null)}function Lo(e){return e.a?e.a.readyState:0}function Oo(e){try{return 2<Lo(e)?e.a.status:-1}catch(t){return-1}}function Mo(e,t){return t+" ["+e.P+" "+e.l+" "+Oo(e)+"]"}function Ro(e){var t=Go;this.g=[],this.u=t,this.o=e||null,this.f=this.a=!1,this.c=void 0,this.m=this.A=this.i=!1,this.h=0,this.b=null,this.l=0}function Fo(e,t,n){e.a=!0,e.c=n,e.f=!t,Bo(e)}function No(e){if(e.a){if(!e.m)throw new Vo(e);e.m=!1}}function jo(e,t,n,r){e.g.push([t,n,r]),e.a&&Bo(e)}function Uo(e){return G(e.g,(function(e){return p(e[1])}))}function Bo(e){if(e.h&&e.a&&Uo(e)){var t=e.h,n=qo[t];n&&(u.clearTimeout(n.a),delete qo[t]),e.h=0}e.b&&(e.b.l--,delete e.b),t=e.c;for(var r=n=!1;e.g.length&&!e.i;){var i=e.g.shift(),a=i[0],o=i[1];if(i=i[2],a=e.f?o:a)try{var s=a.call(i||e.o,t);void 0!==s&&(e.f=e.f&&(s==t||s instanceof Error),e.c=t=s),(L(t)||"function"===typeof u.Promise&&t instanceof u.Promise)&&(r=!0,e.i=!0)}catch(l){t=l,e.f=!0,Uo(e)||(n=!0)}}e.c=t,r&&(s=w(e.v,e,!0),r=w(e.v,e,!1),t instanceof Ro?(jo(t,s,r),t.A=!0):t.then(s,r)),n&&(t=new Wo(t),qo[t.a]=t,e.h=t.a)}function Vo(){O.call(this)}function Ho(){O.call(this)}function Wo(e){this.a=u.setTimeout(w(this.c,this),0),this.b=e}(n=wo.prototype).Ma=function(){"undefined"!=typeof s&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",po(this.b,Mo(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},n.abort=function(){this.a&&this.c&&(po(this.b,Mo(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Co(this))},n.Da=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Co(this,!0)),wo.$a.Da.call(this)},n.Ub=function(){this.xa||(this.N||this.i||this.f?xo(this):this.Ic())},n.Ic=function(){xo(this)},n.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ko:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var e=this.b;return e&&e.log(io,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return po(this.b,"Can not get response: "+t.message),null}},Ro.prototype.cancel=function(e){if(this.a)this.c instanceof Ro&&this.c.cancel();else{if(this.b){var t=this.b;delete this.b,e?t.cancel(e):(t.l--,0>=t.l&&t.cancel())}this.u?this.u.call(this.o,this):this.m=!0,this.a||(e=new Ho(this),No(this),Fo(this,!1,e))}},Ro.prototype.v=function(e,t){this.i=!1,Fo(this,e,t)},Ro.prototype.then=function(e,t,n){var r,i,a=new _t((function(e,t){r=e,i=t}));return jo(this,r,(function(e){e instanceof Ho?a.cancel():i(e)})),a.then(e,t,n)},Ro.prototype.$goog_Thenable=!0,E(Vo,O),Vo.prototype.message="Deferred has already fired",Vo.prototype.name="AlreadyCalledError",E(Ho,O),Ho.prototype.message="Deferred was canceled",Ho.prototype.name="CanceledError",Wo.prototype.c=function(){throw delete qo[this.a],this.b};var qo={};function zo(e){var t={},n=t.document||document,r=Ee(e).toString(),i=dt(document,"SCRIPT"),a={Vb:i,Ma:void 0},o=new Ro(a),s=null,d=null!=t.timeout?t.timeout:5e3;return 0<d&&(s=window.setTimeout((function(){Ko(i,!0);var e=new Xo(Qo,"Timeout reached for loading script "+r);No(o),Fo(o,!1,e)}),d),a.Ma=s),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ko(i,t.wd||!1,s),No(o),Fo(o,!0,null))},i.onerror=function(){Ko(i,!0,s);var e=new Xo(Yo,"Error while loading script "+r);No(o),Fo(o,!1,e)},ve(a=t.attributes||{},{type:"text/javascript",charset:"UTF-8"}),ot(i,a),function(e,t){me(e,"HTMLScriptElement"),e.src=Ee(t),null===c&&(c=(t=(t=u.document).querySelector&&t.querySelector("script[nonce]"))&&(t=t.nonce||t.getAttribute("nonce"))&&l.test(t)?t:""),(t=c)&&e.setAttribute("nonce",t)}(i,e),function(e){var t;return(t=(e||document).getElementsByTagName("HEAD"))&&0!=t.length?t[0]:e.documentElement}(n).appendChild(i),o}function Go(){if(this&&this.Vb){var e=this.Vb;e&&"SCRIPT"==e.tagName&&Ko(e,!0,this.Ma)}}function Ko(e,t,n){null!=n&&u.clearTimeout(n),e.onload=d,e.onerror=d,e.onreadystatechange=d,t&&window.setTimeout((function(){e&&e.parentNode&&e.parentNode.removeChild(e)}),0)}var Yo=0,Qo=1;function Xo(e,t){var n="Jsloader error (code #"+e+")";t&&(n+=": "+t),O.call(this,n),this.code=e}function $o(e){this.f=e}function Jo(e,n,r){if(this.c=e,e=n||{},this.l=e.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.v=e.secureTokenTimeout||ts,this.g=pe(e.secureTokenHeaders||ns),this.h=e.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=e.identityPlatformEndpoint||"https://identitytoolkit.googleapis.com/v2/",this.m=e.firebaseTimeout||rs,this.a=pe(e.firebaseHeaders||is),r&&(this.a["X-Client-Version"]=r,this.g["X-Client-Version"]=r),r="Node"==wr(),!(r=u.XMLHttpRequest||r&&t.a.INTERNAL.node&&t.a.INTERNAL.node.XMLHttpRequest)&&!br())throw new P("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,br()?this.f=new go(self):kr()?this.f=new $o(r):this.f=new Ja,this.b=null}E(Xo,O),E($o,Ya),$o.prototype.a=function(){return new this.f},$o.prototype.b=function(){return{}};var Zo,es="idToken",ts=new Vr(3e4,6e4),ns={"Content-Type":"application/x-www-form-urlencoded"},rs=new Vr(3e4,6e4),is={"Content-Type":"application/json"};function as(e,t){t?e.a["X-Firebase-Locale"]=t:delete e.a["X-Firebase-Locale"]}function os(e,t){t&&(e.l=ss("https://securetoken.googleapis.com/v1/token",t),e.h=ss("https://www.googleapis.com/identitytoolkit/v3/relyingparty/",t),e.i=ss("https://identitytoolkit.googleapis.com/v2/",t))}function ss(e,t){return e=jn(e),t=jn(t.url),e.c=e.a+e.c,On(e,t.f),e.a=t.a,Mn(e,t.g),e.toString()}function us(e,t){t?(e.a["X-Client-Version"]=t,e.g["X-Client-Version"]=t):(delete e.a["X-Client-Version"],delete e.g["X-Client-Version"])}function ls(e,t,n,r,i,a,o){(function(){var e=Tr();return!((e=Pr(e)!=Er?null:(e=e.match(/\sChrome\/(\d+)/i))&&2==e.length?parseInt(e[1],10):null)&&30>e)&&(!Ge||!tt||9<tt)})()||br()?e=w(e.u,e):(Zo||(Zo=new _t((function(e,t){!function(e,t){if(((window.gapi||{}).client||{}).request)e();else{u[ds]=function(){((window.gapi||{}).client||{}).request?e():t(Error("CORS_UNSUPPORTED"))},function(e,t){jo(e,null,t,void 0)}(zo(Pe(cs,{onload:ds})),(function(){t(Error("CORS_UNSUPPORTED"))}))}}(e,t)}))),e=w(e.o,e)),e(t,n,r,i,a,o)}Jo.prototype.S=function(){return this.b},Jo.prototype.u=function(e,t,n,r,i,a){if(br()&&("undefined"===typeof u.fetch||"undefined"===typeof u.Headers||"undefined"===typeof u.Request))throw new P("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var o=new wo(this.f);if(a){o.g=Math.max(0,a);var s=setTimeout((function(){o.dispatchEvent("timeout")}),a)}wn(o,"complete",(function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return po(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(n){e=null}t&&t(e)})),kn(o,"ready",(function(){s&&clearTimeout(s),qt(this)})),kn(o,"timeout",(function(){s&&clearTimeout(s),qt(this),t&&t(null)})),Po(o,e,n,r,i)};var cs=new ye(we,"https://apis.google.com/js/client.js?onload=%{onload}"),ds="__fcb"+Math.floor(1e6*Math.random()).toString();function hs(e,t,n,r,i,a,o){var s=jn(t+n);Fn(s,"key",e.c),o&&Fn(s,"cb",S().toString());var u="GET"==r;if(u)for(var l in i)i.hasOwnProperty(l)&&Fn(s,l,i[l]);return new _t((function(t,n){ls(e,s.toString(),(function(e){e?e.error?n(su(e,a||{})):t(e):n(new P("network-request-failed"))}),r,u?void 0:nr(Fr(i)),e.a,e.m.get())}))}function fs(e){if("string"!==typeof(e=e.email)||!vr.test(e))throw new P("invalid-email")}function ps(e){"email"in e&&fs(e)}function gs(e){if(!e[es]){if(e.mfaPendingCredential)throw new P("multi-factor-auth-required",null,pe(e));throw new P("internal-error")}}function vs(e){if(e.phoneNumber||e.temporaryProof){if(!e.phoneNumber||!e.temporaryProof)throw new P("internal-error")}else{if(!e.sessionInfo)throw new P("missing-verification-id");if(!e.code)throw new P("missing-verification-code")}}Jo.prototype.o=function(e,t,n,r,i){var a=this;Zo.then((function(){window.gapi.client.setApiKey(a.c);var o=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:e,method:n,body:r,headers:i,authType:"none",callback:function(e){window.gapi.auth.setToken(o),t&&t(e)}})})).s((function(e){t&&t({error:{message:e&&e.message||"CORS_UNSUPPORTED"}})}))},Jo.prototype.yb=function(){return au(this,Ks,{})},Jo.prototype.Ab=function(e,t){return au(this,zs,{idToken:e,email:t})},Jo.prototype.Bb=function(e,t){return au(this,Gs,{idToken:e,password:t})};var ms={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function ys(e){if(!e.phoneVerificationInfo)throw new P("internal-error");if(!e.phoneVerificationInfo.sessionInfo)throw new P("missing-verification-id");if(!e.phoneVerificationInfo.code)throw new P("missing-verification-code")}function _s(e){if(!e.requestUri||!e.sessionId&&!e.postBody&&!e.pendingToken)throw new P("internal-error")}function bs(e,t){return t.oauthIdToken&&t.providerId&&0==t.providerId.indexOf("oidc.")&&!t.pendingToken&&(e.sessionId?t.nonce=e.sessionId:e.postBody&&(Jn(e=new Yn(e.postBody),"nonce")&&(t.nonce=e.get("nonce")))),t}function ws(e){var t=null;if(e.needConfirmation?(e.code="account-exists-with-different-credential",t=Ka(e)):"FEDERATED_USER_ID_ALREADY_LINKED"==e.errorMessage?(e.code="credential-already-in-use",t=Ka(e)):"EMAIL_EXISTS"==e.errorMessage?(e.code="email-already-in-use",t=Ka(e)):e.errorMessage&&(t=ou(e.errorMessage)),t)throw t;gs(e)}function ks(e,t){return t.returnIdpCredential=!0,au(e,Xs,t)}function Ss(e,t){return t.returnIdpCredential=!0,au(e,Js,t)}function Es(e,t){return t.returnIdpCredential=!0,t.autoCreate=!1,au(e,$s,t)}function Ps(e){if(!e.oobCode)throw new P("invalid-action-code")}(n=Jo.prototype).Cb=function(e,t){var n={idToken:e},r=[];return he(ms,(function(e,i){var a=t[i];null===a?r.push(e):i in t&&(n[i]=a)})),r.length&&(n.deleteAttribute=r),au(this,zs,n)},n.ub=function(e,t){return ve(e={requestType:"PASSWORD_RESET",email:e},t),au(this,Bs,e)},n.vb=function(e,t){return ve(e={requestType:"EMAIL_SIGNIN",email:e},t),au(this,Ns,e)},n.tb=function(e,t){return ve(e={requestType:"VERIFY_EMAIL",idToken:e},t),au(this,js,e)},n.Db=function(e,t,n){return ve(e={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:e,newEmail:t},n),au(this,Us,e)},n.eb=function(e){return au(this,tu,e)},n.mb=function(e,t){return au(this,Ws,{oobCode:e,newPassword:t})},n.Qa=function(e){return au(this,Ds,{oobCode:e})},n.ib=function(e){return au(this,Is,{oobCode:e})};var Is={endpoint:"setAccountInfo",B:Ps,Z:"email",C:!0},Ds={endpoint:"resetPassword",B:Ps,F:function(e){var t=e.requestType;if(!t||!e.email&&"EMAIL_SIGNIN"!=t&&"VERIFY_AND_CHANGE_EMAIL"!=t)throw new P("internal-error")},C:!0},Ts={endpoint:"signupNewUser",B:function(e){if(fs(e),!e.password)throw new P("weak-password")},F:gs,U:!0,C:!0},xs={endpoint:"createAuthUri",C:!0},Cs={endpoint:"deleteAccount",M:["idToken"]},As={endpoint:"setAccountInfo",M:["idToken","deleteProvider"],B:function(e){if("array"!=h(e.deleteProvider))throw new P("internal-error")}},Ls={endpoint:"emailLinkSignin",M:["email","oobCode"],B:fs,F:gs,U:!0,C:!0},Os={endpoint:"emailLinkSignin",M:["idToken","email","oobCode"],B:fs,F:gs,U:!0},Ms={endpoint:"accounts/mfaEnrollment:finalize",M:["idToken","phoneVerificationInfo"],B:ys,F:gs,C:!0,Na:!0},Rs={endpoint:"accounts/mfaSignIn:finalize",M:["mfaPendingCredential","phoneVerificationInfo"],B:ys,F:gs,C:!0,Na:!0},Fs={endpoint:"getAccountInfo"},Ns={endpoint:"getOobConfirmationCode",M:["requestType"],B:function(e){if("EMAIL_SIGNIN"!=e.requestType)throw new P("internal-error");fs(e)},Z:"email",C:!0},js={endpoint:"getOobConfirmationCode",M:["idToken","requestType"],B:function(e){if("VERIFY_EMAIL"!=e.requestType)throw new P("internal-error")},Z:"email",C:!0},Us={endpoint:"getOobConfirmationCode",M:["idToken","newEmail","requestType"],B:function(e){if("VERIFY_AND_CHANGE_EMAIL"!=e.requestType)throw new P("internal-error")},Z:"email",C:!0},Bs={endpoint:"getOobConfirmationCode",M:["requestType"],B:function(e){if("PASSWORD_RESET"!=e.requestType)throw new P("internal-error");fs(e)},Z:"email",C:!0},Vs={kb:!0,endpoint:"getProjectConfig",Tb:"GET"},Hs={kb:!0,endpoint:"getRecaptchaParam",Tb:"GET",F:function(e){if(!e.recaptchaSiteKey)throw new P("internal-error")}},Ws={endpoint:"resetPassword",B:Ps,Z:"email",C:!0},qs={endpoint:"sendVerificationCode",M:["phoneNumber","recaptchaToken"],Z:"sessionInfo",C:!0},zs={endpoint:"setAccountInfo",M:["idToken"],B:ps,U:!0},Gs={endpoint:"setAccountInfo",M:["idToken"],B:function(e){if(ps(e),!e.password)throw new P("weak-password")},F:gs,U:!0},Ks={endpoint:"signupNewUser",F:gs,U:!0,C:!0},Ys={endpoint:"accounts/mfaEnrollment:start",M:["idToken","phoneEnrollmentInfo"],B:function(e){if(!e.phoneEnrollmentInfo)throw new P("internal-error");if(!e.phoneEnrollmentInfo.phoneNumber)throw new P("missing-phone-number");if(!e.phoneEnrollmentInfo.recaptchaToken)throw new P("missing-app-credential")},F:function(e){if(!e.phoneSessionInfo||!e.phoneSessionInfo.sessionInfo)throw new P("internal-error")},C:!0,Na:!0},Qs={endpoint:"accounts/mfaSignIn:start",M:["mfaPendingCredential","mfaEnrollmentId","phoneSignInInfo"],B:function(e){if(!e.phoneSignInInfo||!e.phoneSignInInfo.recaptchaToken)throw new P("missing-app-credential")},F:function(e){if(!e.phoneResponseInfo||!e.phoneResponseInfo.sessionInfo)throw new P("internal-error")},C:!0,Na:!0},Xs={endpoint:"verifyAssertion",B:_s,Xa:bs,F:ws,U:!0,C:!0},$s={endpoint:"verifyAssertion",B:_s,Xa:bs,F:function(e){if(e.errorMessage&&"USER_NOT_FOUND"==e.errorMessage)throw new P("user-not-found");if(e.errorMessage)throw ou(e.errorMessage);gs(e)},U:!0,C:!0},Js={endpoint:"verifyAssertion",B:function(e){if(_s(e),!e.idToken)throw new P("internal-error")},Xa:bs,F:ws,U:!0},Zs={endpoint:"verifyCustomToken",B:function(e){if(!e.token)throw new P("invalid-custom-token")},F:gs,U:!0,C:!0},eu={endpoint:"verifyPassword",B:function(e){if(fs(e),!e.password)throw new P("wrong-password")},F:gs,U:!0,C:!0},tu={endpoint:"verifyPhoneNumber",B:vs,F:gs,C:!0},nu={endpoint:"verifyPhoneNumber",B:function(e){if(!e.idToken)throw new P("internal-error");vs(e)},F:function(e){if(e.temporaryProof)throw e.code="credential-already-in-use",Ka(e);gs(e)}},ru={Gb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",B:vs,F:gs,C:!0},iu={endpoint:"accounts/mfaEnrollment:withdraw",M:["idToken","mfaEnrollmentId"],F:function(e){if(!!e[es]^!!e.refreshToken)throw new P("internal-error")},C:!0,Na:!0};function au(e,t,n){if(!function(e,t){if(!t||!t.length)return!0;if(!e)return!1;for(var n=0;n<t.length;n++){var r=e[t[n]];if(void 0===r||null===r||""===r)return!1}return!0}(n,t.M))return Dt(new P("internal-error"));var r,i=!!t.Na,a=t.Tb||"POST";return It(n).then(t.B).then((function(){return t.U&&(n.returnSecureToken=!0),t.C&&e.b&&"undefined"===typeof n.tenantId&&(n.tenantId=e.b),hs(e,i?e.i:e.h,t.endpoint,a,n,t.Gb,t.kb||!1)})).then((function(e){return r=e,t.Xa?t.Xa(n,r):r})).then(t.F).then((function(){if(!t.Z)return r;if(!(t.Z in r))throw new P("internal-error");return r[t.Z]}))}function ou(e){return su({error:{errors:[{message:e}],code:400,message:e}})}function su(e,t){var n=(e.error&&e.error.errors&&e.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new P(r[n]):null)return n;for(var i in n=e.error&&e.error.message||"",ve(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",EMAIL_CHANGE_NEEDS_VERIFICATION:"email-change-needs-verification",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",UNSUPPORTED_FIRST_FACTOR:"unsupported-first-factor",UNVERIFIED_EMAIL:"unverified-email"},t||{}),t=(t=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<t.length?t[1]:void 0,r)if(0===n.indexOf(i))return new P(r[i],t);return!t&&e&&(t=Rr(e)),new P("internal-error",t)}function uu(e){this.b=e,this.a=null,this.qb=function(e){return(hu||(hu=new _t((function(e,t){function n(){Br(),xr("gapi.load")("gapi.iframes",{callback:e,ontimeout:function(){Br(),t(Error("Network Error"))},timeout:cu.get()})}if(xr("gapi.iframes.Iframe"))e();else if(xr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();u[r]=function(){xr("gapi.load")?n():t(Error("Network Error"))},It(zo(r=Pe(lu,{onload:r}))).s((function(){t(Error("Network Error"))}))}})).s((function(e){throw hu=null,e})))).then((function(){return new _t((function(t,n){xr("gapi.iframes.getContext")().open({where:document.body,url:e.b,messageHandlersFilter:xr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},(function(r){function i(){clearTimeout(a),t()}e.a=r,e.a.restyle({setHideOnLeave:!1});var a=setTimeout((function(){n(Error("Network Error"))}),du.get());r.ping(i).then(i,(function(){n(Error("Network Error"))}))}))}))}))}(this)}var lu=new ye(we,"https://apis.google.com/js/api.js?onload=%{onload}"),cu=new Vr(3e4,6e4),du=new Vr(5e3,15e3),hu=null;function fu(e,t,n,r){this.l=e,this.h=t,this.i=n,this.g=r,this.f=null,this.g?e=Un((e=jn(this.g.url)).f,e.a,e.g,"/emulator/auth/iframe"):e=Un("https",this.l,null,"/__/auth/iframe"),this.a=e,Fn(this.a,"apiKey",this.h),Fn(this.a,"appName",this.i),this.b=null,this.c=[]}function pu(e,t,n,r,i,a){this.u=e,this.o=t,this.c=n,this.v=r,this.m=a,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function gu(e){try{return t.a.app(e).auth().Ga()}catch(n){return[]}}function vu(e,t,n,r,i,a){this.o=e,this.g=t,this.b=n,this.f=a,this.c=r||null,this.i=i||null,this.l=this.u=this.A=null,this.h=[],this.v=this.a=null}function mu(e){var t=lr();return function(e){return au(e,Vs,{}).then((function(e){return e.authorizedDomains||[]}))}(e).then((function(e){e:{var n=jn(t),r=n.f;n=n.a;for(var i=0;i<e.length;i++){var a=e[i],o=n,s=r;if(0==a.indexOf("chrome-extension://")?o=jn(a).a==o&&"chrome-extension"==s:"http"!=s&&"https"!=s?o=!1:gr.test(a)?o=o==a:(a=a.split(".").join("\\."),o=new RegExp("^(.+\\."+a+"|"+a+")$","i").test(o)),o){e=!0;break e}}e=!1}if(!e)throw new za(lr())}))}function yu(e){return e.v||(e.v=mr().then((function(){if(!e.u){var t=e.c,n=e.i,r=gu(e.b),i=new fu(e.o,e.g,e.b,e.f);i.f=t,i.b=n,i.c=$(r||[]),e.u=i.toString()}e.m=new uu(e.u),function(e){if(!e.m)throw Error("IfcHandler must be initialized!");!function(e,t){e.qb.then((function(){e.a.register("authEvent",t,xr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}(e.m,(function(t){var n={};if(t&&t.authEvent){var r=!1;for(t=Va(t.authEvent),n=0;n<e.h.length;n++)r=e.h[n](t)||r;return(n={}).status=r?"ACK":"ERROR",It(n)}return n.status="ERROR",It(n)}))}(e)}))),e.v}function _u(e){return e.l||(e.A=e.c?Dr(e.c,gu(e.b)):null,e.l=new Jo(e.g,A(e.i),e.A),e.f&&os(e.l,e.f)),e.l}function bu(e,t,n,r,i,a,o,s,u,l,c,d){return(e=new pu(e,t,n,r,i,d)).l=a,e.g=o,e.i=s,e.b=pe(u||null),e.f=l,e.xb(c).toString()}function wu(e){if(this.a=e||t.a.INTERNAL.reactNative&&t.a.INTERNAL.reactNative.AsyncStorage,!this.a)throw new P("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function ku(e){this.b=e,this.a={},this.f=w(this.c,this)}fu.prototype.toString=function(){return this.f?Fn(this.a,"v",this.f):$n(this.a.b,"v"),this.b?Fn(this.a,"eid",this.b):$n(this.a.b,"eid"),this.c.length?Fn(this.a,"fw",this.c.join(",")):$n(this.a.b,"fw"),this.a.toString()},pu.prototype.xb=function(e){return this.h=e,this},pu.prototype.toString=function(){if(this.m){var e=jn(this.m.url);e=Un(e.f,e.a,e.g,"/emulator/auth/handler")}else e=Un("https",this.u,null,"/__/auth/handler");if(Fn(e,"apiKey",this.o),Fn(e,"appName",this.c),Fn(e,"authType",this.v),this.a.isOAuthProvider){var n=this.a;try{var r=t.a.app(this.c).auth().ka()}catch(u){r=null}for(var i in n.nb=r,Fn(e,"providerId",this.a.providerId),n=Fr((r=this.a).Hb))n[i]=n[i].toString();i=r.Pc,n=pe(n);for(var a=0;a<i.length;a++){var o=i[a];o in n&&delete n[o]}r.ob&&r.nb&&!n[r.ob]&&(n[r.ob]=r.nb),fe(n)||Fn(e,"customParameters",Rr(n))}if("function"===typeof this.a.Pb&&((r=this.a.Pb()).length&&Fn(e,"scopes",r.join(","))),this.l?Fn(e,"redirectUrl",this.l):$n(e.b,"redirectUrl"),this.g?Fn(e,"eventId",this.g):$n(e.b,"eventId"),this.i?Fn(e,"v",this.i):$n(e.b,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!Nn(e,s)&&Fn(e,s,this.b[s]);return this.h?Fn(e,"tid",this.h):$n(e.b,"tid"),this.f?Fn(e,"eid",this.f):$n(e.b,"eid"),(s=gu(this.c)).length&&Fn(e,"fw",s.join(",")),e.toString()},(n=vu.prototype).Nb=function(e,t,n){var r=new P("popup-closed-by-user"),i=new P("web-storage-unsupported"),a=this,o=!1;return this.la().then((function(){(function(e){var t={type:"webStorageSupport"};return yu(e).then((function(){return function(e,t){return e.qb.then((function(){return new _t((function(n){e.a.send(t.type,t,n,xr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}))}(e.m,t)})).then((function(e){if(e&&e.length&&"undefined"!==typeof e[0].webStorageSupport)return e[0].webStorageSupport;throw Error()}))})(a).then((function(n){n||(e&&fr(e),t(i),o=!0)}))})).s((function(){})).then((function(){if(!o)return function(e){return new _t((function(t){return function n(){Pn(2e3).then((function(){if(e&&!e.closed)return n();t()}))}()}))}(e)})).then((function(){if(!o)return Pn(n).then((function(){t(r)}))}))},n.Wb=function(){var e=Tr();return!Mr(e)&&!Ur(e)},n.Sb=function(){return!1},n.Lb=function(e,t,n,r,i,a,o,s){if(!e)return Dt(new P("popup-blocked"));if(o&&!Mr())return this.la().s((function(t){fr(e),i(t)})),r(),It();this.a||(this.a=mu(_u(this)));var u=this;return this.a.then((function(){var t=u.la().s((function(t){throw fr(e),i(t),t}));return r(),t})).then((function(){(Ua(n),o)||cr(bu(u.o,u.g,u.b,t,n,null,a,u.c,void 0,u.i,s,u.f),e)})).s((function(e){throw"auth/network-request-failed"==e.code&&(u.a=null),e}))},n.Mb=function(e,t,n,r){this.a||(this.a=mu(_u(this)));var i=this;return this.a.then((function(){Ua(t),cr(bu(i.o,i.g,i.b,e,t,lr(),n,i.c,void 0,i.i,r,i.f))})).s((function(e){throw"auth/network-request-failed"==e.code&&(i.a=null),e}))},n.la=function(){var e=this;return yu(this).then((function(){return e.m.qb})).s((function(){throw e.a=null,new P("network-request-failed")}))},n.Zb=function(){return!0},n.Ea=function(e){this.h.push(e)},n.Ra=function(e){Q(this.h,(function(t){return t==e}))},(n=wu.prototype).get=function(e){return It(this.a.getItem(e)).then((function(e){return e&&Nr(e)}))},n.set=function(e,t){return It(this.a.setItem(e,Rr(t)))},n.T=function(e){return It(this.a.removeItem(e))},n.ca=function(){},n.ia=function(){};var Su,Eu=[];function Pu(e,t,n){fe(e.a)&&e.b.addEventListener("message",e.f),"undefined"===typeof e.a[t]&&(e.a[t]=[]),e.a[t].push(n)}function Iu(e){this.a=e}function Du(e){this.c=e,this.b=!1,this.a=[]}function Tu(e,t,n,r){var i,a,o,s,u=n||{},l=null;if(e.b)return Dt(Error("connection_unavailable"));var c=r?800:50,d="undefined"!==typeof MessageChannel?new MessageChannel:null;return new _t((function(n,r){d?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),d.port1.start(),o=setTimeout((function(){r(Error("unsupported_event"))}),c),l={messageChannel:d,onMessage:a=function(e){e.data.eventId===i&&("ack"===e.data.status?(clearTimeout(o),s=setTimeout((function(){r(Error("timeout"))}),3e3)):"done"===e.data.status?(clearTimeout(s),"undefined"!==typeof e.data.response?n(e.data.response):r(Error("unknown_error"))):(clearTimeout(o),clearTimeout(s),r(Error("invalid_response"))))}},e.a.push(l),d.port1.addEventListener("message",a),e.c.postMessage({eventType:t,eventId:i,data:u},[d.port2])):r(Error("connection_unavailable"))})).then((function(t){return xu(e,l),t})).s((function(t){throw xu(e,l),t}))}function xu(e,t){if(t){var n=t.messageChannel,r=t.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),Q(e.a,(function(e){return e==t}))}}function Cu(){if(!Ou())throw new P("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.m=u.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var e=this;br()&&self?(this.l=function(){var e=br()?self:null;if(W(Eu,(function(n){n.b==e&&(t=n)})),!t){var t=new ku(e);Eu.push(t)}return t}(),Pu(this.l,"keyChanged",(function(t,n){return ju(e).then((function(t){return 0<t.length&&W(e.a,(function(e){e(t)})),{keyProcessed:K(t,n.key)}}))})),Pu(this.l,"ping",(function(){return It(["keyChanged"])}))):function(){var e=u.navigator;return e&&e.serviceWorker?It().then((function(){return e.serviceWorker.ready})).then((function(e){return e.active||null})).s((function(){return null})):It(null)}().then((function(t){(e.h=t)&&(e.g=new Du(new Iu(t)),Tu(e.g,"ping",null,!0).then((function(t){t[0].fulfilled&&K(t[0].value,"keyChanged")&&(e.o=!0)})).s((function(){})))}))}function Au(e){return new _t((function(t,n){var r=e.m.open("firebaseLocalStorageDb",1);r.onerror=function(e){try{e.preventDefault()}catch(t){}n(Error(e.target.error))},r.onupgradeneeded=function(e){e=e.target.result;try{e.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?t(r):function(e){return new _t((function(t,n){var r=e.m.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){t()},r.onerror=function(e){n(Error(e.target.error))}}))}(e).then((function(){return Au(e)})).then((function(e){t(e)})).s((function(e){n(e)}))}}))}function Lu(e){return e.v||(e.v=Au(e)),e.v}function Ou(){try{return!!u.indexedDB}catch(lo){return!1}}function Mu(e){return e.objectStore("firebaseLocalStorage")}function Ru(e,t){return e.transaction(["firebaseLocalStorage"],t?"readwrite":"readonly")}function Fu(e){return new _t((function(t,n){e.onsuccess=function(e){e&&e.target?t(e.target.result):t()},e.onerror=function(e){n(e.target.error)}}))}function Nu(e,t){return e.g&&e.h&&function(){var e=u.navigator;return e&&e.serviceWorker&&e.serviceWorker.controller||null}()===e.h?Tu(e.g,"keyChanged",{key:t},e.o).then((function(){})).s((function(){})):It()}function ju(e){return Lu(e).then((function(e){var t=Mu(Ru(e,!1));return t.getAll?Fu(t.getAll()):new _t((function(e,n){var r=[],i=t.openCursor();i.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},i.onerror=function(e){n(e.target.error)}}))})).then((function(t){var n={},r=[];if(0==e.b){for(r=0;r<t.length;r++)n[t[r].fbase_key]=t[r].value;r=dr(e.c,n),e.c=n}return r}))}function Uu(e){e.i&&e.i.cancel("STOP_EVENT"),e.f&&(clearTimeout(e.f),e.f=null)}function Bu(e){var t=this,n=null;this.a=[],this.type="indexedDB",this.c=e,this.b=It().then((function(){if(Ou()){var e=jr(),r="__sak"+e;return Su||(Su=new Cu),(n=Su).set(r,e).then((function(){return n.get(r)})).then((function(t){if(t!==e)throw Error("indexedDB not supported!");return n.T(r)})).then((function(){return n})).s((function(){return t.c}))}return t.c})).then((function(e){return t.type=e.type,e.ca((function(e){W(t.a,(function(t){t(e)}))})),e}))}function Vu(){this.a={},this.type="inMemory"}function Hu(){if(!function(){var e="Node"==wr();if(!(e=Wu()||e&&t.a.INTERNAL.node&&t.a.INTERNAL.node.localStorage))return!1;try{return e.setItem("__sak","1"),e.removeItem("__sak"),!0}catch(n){return!1}}()){if("Node"==wr())throw new P("internal-error","The LocalStorage compatibility library was not found.");throw new P("web-storage-unsupported")}this.a=Wu()||t.a.INTERNAL.node.localStorage,this.type="localStorage"}function Wu(){try{var e=u.localStorage,t=jr();return e&&(e.setItem(t,"1"),e.removeItem(t)),e}catch(n){return null}}function qu(){this.type="nullStorage"}function zu(){if(!function(){var e="Node"==wr();if(!(e=Gu()||e&&t.a.INTERNAL.node&&t.a.INTERNAL.node.sessionStorage))return!1;try{return e.setItem("__sak","1"),e.removeItem("__sak"),!0}catch(n){return!1}}()){if("Node"==wr())throw new P("internal-error","The SessionStorage compatibility library was not found.");throw new P("web-storage-unsupported")}this.a=Gu()||t.a.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Gu(){try{var e=u.sessionStorage,t=jr();return e&&(e.setItem(t,"1"),e.removeItem(t)),e}catch(n){return null}}function Ku(){var e={};e.Browser=Xu,e.Node=$u,e.ReactNative=Ju,e.Worker=Zu,this.a=e[wr()]}ku.prototype.c=function(e){var t=e.data.eventType,n=e.data.eventId,r=this.a[t];if(r&&0<r.length){e.ports[0].postMessage({status:"ack",eventId:n,eventType:t,response:null});var i=[];W(r,(function(t){i.push(It().then((function(){return t(e.origin,e.data.data)})))})),xt(i).then((function(r){var i=[];W(r,(function(e){i.push({fulfilled:e.Ob,value:e.value,reason:e.reason?e.reason.message:void 0})})),W(i,(function(e){for(var t in e)"undefined"===typeof e[t]&&delete e[t]})),e.ports[0].postMessage({status:"done",eventId:n,eventType:t,response:i})}))}},Iu.prototype.postMessage=function(e,t){this.a.postMessage(e,t)},Du.prototype.close=function(){for(;0<this.a.length;)xu(this,this.a[0]);this.b=!0},(n=Cu.prototype).set=function(e,t){var n,r=!1,i=this;return Lu(this).then((function(t){return Fu((t=Mu(Ru(n=t,!0))).get(e))})).then((function(a){var o=Mu(Ru(n,!0));return a?(a.value=t,Fu(o.put(a))):(i.b++,r=!0,(a={}).fbase_key=e,a.value=t,Fu(o.add(a)))})).then((function(){return i.c[e]=t,Nu(i,e)})).na((function(){r&&i.b--}))},n.get=function(e){return Lu(this).then((function(t){return Fu(Mu(Ru(t,!1)).get(e))})).then((function(e){return e&&e.value}))},n.T=function(e){var t=!1,n=this;return Lu(this).then((function(r){return t=!0,n.b++,Fu(Mu(Ru(r,!0)).delete(e))})).then((function(){return delete n.c[e],Nu(n,e)})).na((function(){t&&n.b--}))},n.ca=function(e){0==this.a.length&&function(e){function t(){e.f=setTimeout((function(){e.i=ju(e).then((function(t){0<t.length&&W(e.a,(function(e){e(t)}))})).then((function(){t()})).s((function(e){"STOP_EVENT"!=e.message&&t()}))}),800)}Uu(e),t()}(this),this.a.push(e)},n.ia=function(e){Q(this.a,(function(t){return t==e})),0==this.a.length&&Uu(this)},(n=Bu.prototype).get=function(e){return this.b.then((function(t){return t.get(e)}))},n.set=function(e,t){return this.b.then((function(n){return n.set(e,t)}))},n.T=function(e){return this.b.then((function(t){return t.T(e)}))},n.ca=function(e){this.a.push(e)},n.ia=function(e){Q(this.a,(function(t){return t==e}))},(n=Vu.prototype).get=function(e){return It(this.a[e])},n.set=function(e,t){return this.a[e]=t,It()},n.T=function(e){return delete this.a[e],It()},n.ca=function(){},n.ia=function(){},(n=Hu.prototype).get=function(e){var t=this;return It().then((function(){return Nr(t.a.getItem(e))}))},n.set=function(e,t){var n=this;return It().then((function(){var r=Rr(t);null===r?n.T(e):n.a.setItem(e,r)}))},n.T=function(e){var t=this;return It().then((function(){t.a.removeItem(e)}))},n.ca=function(e){u.window&&un(u.window,"storage",e)},n.ia=function(e){u.window&&dn(u.window,"storage",e)},(n=qu.prototype).get=function(){return It(null)},n.set=function(){return It()},n.T=function(){return It()},n.ca=function(){},n.ia=function(){},(n=zu.prototype).get=function(e){var t=this;return It().then((function(){return Nr(t.a.getItem(e))}))},n.set=function(e,t){var n=this;return It().then((function(){var r=Rr(t);null===r?n.T(e):n.a.setItem(e,r)}))},n.T=function(e){var t=this;return It().then((function(){t.a.removeItem(e)}))},n.ca=function(){},n.ia=function(){};var Yu,Qu,Xu={D:Hu,ab:zu},$u={D:Hu,ab:zu},Ju={D:wu,ab:qu},Zu={D:Hu,ab:qu},el={qd:"local",NONE:"none",sd:"session"};function tl(){var e=!(Ur(Tr())||!_r()),t=Mr(),n=Cr();this.v=e,this.h=t,this.l=n,this.a={},Yu||(Yu=new Ku),e=Yu;try{this.g=!ur()&&zr()||!u.indexedDB?new e.a.D:new Bu(br()?new Vu:new e.a.D)}catch(r){this.g=new Vu,this.h=!0}try{this.i=new e.a.ab}catch(r){this.i=new Vu}this.m=new Vu,this.f=w(this.Xb,this),this.b={}}function nl(){return Qu||(Qu=new tl),Qu}function rl(e,t){switch(t){case"session":return e.i;case"none":return e.m;default:return e.g}}function il(e,t){return"firebase:"+e.name+(t?":"+t:"")}function al(e,t,n){return n=il(t,n),"local"==t.D&&(e.b[n]=null),rl(e,t.D).T(n)}function ol(e){e.c&&(clearInterval(e.c),e.c=null)}function sl(e){this.a=e,this.b=nl()}(n=tl.prototype).get=function(e,t){return rl(this,e.D).get(il(e,t))},n.set=function(e,t,n){var r=il(e,n),i=this,a=rl(this,e.D);return a.set(r,t).then((function(){return a.get(r)})).then((function(t){"local"==e.D&&(i.b[r]=t)}))},n.addListener=function(e,t,n){e=il(e,t),this.l&&(this.b[e]=u.localStorage.getItem(e)),fe(this.a)&&(rl(this,"local").ca(this.f),this.h||(ur()||!zr())&&u.indexedDB||!this.l||function(e){ol(e),e.c=setInterval((function(){for(var t in e.a){var n=u.localStorage.getItem(t),r=e.b[t];n!=r&&(e.b[t]=n,n=new Xt({type:"storage",key:t,target:window,oldValue:r,newValue:n,a:!0}),e.Xb(n))}}),1e3)}(this)),this.a[e]||(this.a[e]=[]),this.a[e].push(n)},n.removeListener=function(e,t,n){e=il(e,t),this.a[e]&&(Q(this.a[e],(function(e){return e==n})),0==this.a[e].length&&delete this.a[e]),fe(this.a)&&(rl(this,"local").ia(this.f),ol(this))},n.Xb=function(e){if(e&&e.g){var t=e.a.key;if(null==t)for(var n in this.a){var r=this.b[n];"undefined"===typeof r&&(r=null);var i=u.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.lb(n))}else if(0==t.indexOf("firebase:")&&this.a[t]){if("undefined"!==typeof e.a.a?rl(this,"local").ia(this.f):ol(this),this.v)if(n=u.localStorage.getItem(t),(r=e.a.newValue)!==n)null!==r?u.localStorage.setItem(t,r):u.localStorage.removeItem(t);else if(this.b[t]===r&&"undefined"===typeof e.a.a)return;var a=this;n=function(){"undefined"===typeof e.a.a&&a.b[t]===u.localStorage.getItem(t)||(a.b[t]=u.localStorage.getItem(t),a.lb(t))},Ge&&tt&&10==tt&&u.localStorage.getItem(t)!==e.a.newValue&&e.a.newValue!==e.a.oldValue?setTimeout(n,10):n()}}else W(e,w(this.lb,this))},n.lb=function(e){this.a[e]&&W(this.a[e],(function(e){e()}))};var ul,ll={name:"authEvent",D:"local"};function cl(){this.a=nl()}function dl(e,t){this.b=hl,this.f=u.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=e,this.h=t,this.l=u.Int32Array?new Int32Array(64):Array(64),void 0===ul&&(ul=u.Int32Array?new Int32Array(_l):_l),this.reset()}E(dl,(function(){this.b=-1}));for(var hl=64,fl=hl-1,pl=[],gl=0;gl<fl;gl++)pl[gl]=0;var vl=X(128,pl);function ml(e){for(var t=e.f,n=e.l,r=0,i=0;i<t.length;)n[r++]=t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3],i=4*r;for(t=16;64>t;t++){i=0|n[t-15],r=0|n[t-2];var a=(0|n[t-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,o=(0|n[t-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[t]=a+o|0}r=0|e.a[0],i=0|e.a[1];var s=0|e.a[2],u=0|e.a[3],l=0|e.a[4],c=0|e.a[5],d=0|e.a[6];for(a=0|e.a[7],t=0;64>t;t++){var h=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;o=(a=a+((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))|0)+((o=(o=l&c^~l&d)+(0|ul[t])|0)+(0|n[t])|0)|0,a=d,d=c,c=l,l=u+o|0,u=s,s=i,i=r,r=o+h|0}e.a[0]=e.a[0]+r|0,e.a[1]=e.a[1]+i|0,e.a[2]=e.a[2]+s|0,e.a[3]=e.a[3]+u|0,e.a[4]=e.a[4]+l|0,e.a[5]=e.a[5]+c|0,e.a[6]=e.a[6]+d|0,e.a[7]=e.a[7]+a|0}function yl(e,t,n){void 0===n&&(n=t.length);var r=0,i=e.c;if("string"===typeof t)for(;r<n;)e.f[i++]=t.charCodeAt(r++),i==e.b&&(ml(e),i=0);else{if(!f(t))throw Error("message must be string or array");for(;r<n;){var a=t[r++];if(!("number"==typeof a&&0<=a&&255>=a&&a==(0|a)))throw Error("message must be a byte array");e.f[i++]=a,i==e.b&&(ml(e),i=0)}}e.c=i,e.g+=n}dl.prototype.reset=function(){this.g=this.c=0,this.a=u.Int32Array?new Int32Array(this.h):$(this.h)};var _l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function bl(){dl.call(this,8,wl)}E(bl,dl);var wl=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function kl(e,t,n,r,i,a){this.m=e,this.i=t,this.l=n,this.v=r||null,this.u=i||null,this.o=a,this.h=t+":"+n,this.A=new cl,this.g=new sl(this.h),this.f=null,this.b=[],this.a=this.c=null}function Sl(e){return new P("invalid-cordova-configuration",e)}function El(e){var t=new bl;yl(t,e),e=[];var n=8*t.g;56>t.c?yl(t,vl,56-t.c):yl(t,vl,t.b-(t.c-56));for(var r=63;56<=r;r--)t.f[r]=255&n,n/=256;for(ml(t),r=n=0;r<t.i;r++)for(var i=24;0<=i;i-=8)e[n++]=t.a[r]>>i&255;return function(e){return z(e,(function(e){return 1<(e=e.toString(16)).length?e:"0"+e})).join("")}(e)}function Pl(e,t){for(var n=0;n<e.b.length;n++)try{e.b[n](t)}catch(r){}}function Il(e){return e.f||(e.f=e.la().then((function(){return new _t((function(t){e.Ea((function n(r){return t(r),e.Ra(n),!1})),function(e){function t(t){r=!0,i&&i.cancel(),Dl(e).then((function(r){var i=n;if(r&&t&&t.url){var a=null;-1!=(i=aa(t.url)).indexOf("/__/auth/callback")&&(a=(a="object"===typeof(a=Nr(Nn(a=jn(i),"firebaseError")||null))?I(a):null)?new Ba(r.c,r.b,null,null,a,null,r.S()):new Ba(r.c,r.b,i,r.f,null,null,r.S())),i=a||n}Pl(e,i)}))}var n=new Ba("unknown",null,null,null,new P("no-auth-event")),r=!1,i=Pn(500).then((function(){return Dl(e).then((function(){r||Pl(e,n)}))})),a=u.handleOpenURL;u.handleOpenURL=function(e){if(0==e.toLowerCase().indexOf(xr("BuildInfo.packageName",u).toLowerCase()+"://")&&t({url:e}),"function"===typeof a)try{a(e)}catch(n){console.error(n)}},qa||(qa=new Ha),function(e){var t=qa;t.a.push(e),t.b||(t.b=function(e){for(var n=0;n<t.a.length;n++)t.a[n](e)},"function"===typeof(e=xr("universalLinks.subscribe",u))&&e(null,t.b))}(t)}(e)}))}))),e.f}function Dl(e){var t=null;return function(e){return e.b.get(ll,e.a).then((function(e){return Va(e)}))}(e.g).then((function(n){return t=n,al((n=e.g).b,ll,n.a)})).then((function(){return t}))}function Tl(e){this.a=e,this.b=nl()}(n=kl.prototype).la=function(){return this.Ia?this.Ia:this.Ia=(yr(void 0)?mr().then((function(){return new _t((function(e,t){var n=u.document,r=setTimeout((function(){t(Error("Cordova framework is not ready."))}),1e3);n.addEventListener("deviceready",(function(){clearTimeout(r),e()}),!1)}))})):Dt(Error("Cordova must run in an Android or iOS file scheme."))).then((function(){if("function"!==typeof xr("universalLinks.subscribe",u))throw Sl("cordova-universal-links-plugin-fix is not installed");if("undefined"===typeof xr("BuildInfo.packageName",u))throw Sl("cordova-plugin-buildinfo is not installed");if("function"!==typeof xr("cordova.plugins.browsertab.openUrl",u))throw Sl("cordova-plugin-browsertab is not installed");if("function"!==typeof xr("cordova.InAppBrowser.open",u))throw Sl("cordova-plugin-inappbrowser is not installed")}),(function(){throw new P("cordova-not-ready")}))},n.Nb=function(e,t){return t(new P("operation-not-supported-in-this-environment")),It()},n.Lb=function(){return Dt(new P("operation-not-supported-in-this-environment"))},n.Zb=function(){return!1},n.Wb=function(){return!0},n.Sb=function(){return!0},n.Mb=function(e,t,n,r){if(this.c)return Dt(new P("redirect-operation-pending"));var i=this,a=u.document,o=null,s=null,l=null,c=null;return this.c=It().then((function(){return Ua(t),Il(i)})).then((function(){return function(e,t,n,r,i){var a=function(){for(var e=20,t=[];0<e;)t.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),e--;return t.join("")}(),o=new Ba(t,r,null,a,new P("no-auth-event"),null,i),s=xr("BuildInfo.packageName",u);if("string"!==typeof s)throw new P("invalid-cordova-configuration");var l=xr("BuildInfo.displayName",u),c={};if(Tr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!Tr().toLowerCase().match(/android/))return Dt(new P("operation-not-supported-in-this-environment"));c.apn=s}l&&(c.appDisplayName=l),a=El(a),c.sessionId=a;var d=bu(e.m,e.i,e.l,t,n,null,r,e.v,c,e.u,i,e.o);return e.la().then((function(){var t=e.h;return e.A.a.set(ll,o.w(),t)})).then((function(){var t=xr("cordova.plugins.browsertab.isAvailable",u);if("function"!==typeof t)throw new P("invalid-cordova-configuration");var n=null;t((function(t){if(t){if("function"!==typeof(n=xr("cordova.plugins.browsertab.openUrl",u)))throw new P("invalid-cordova-configuration");n(d)}else{if("function"!==typeof(n=xr("cordova.InAppBrowser.open",u)))throw new P("invalid-cordova-configuration");t=Tr(),e.a=n(d,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}}))}))}(i,e,t,n,r)})).then((function(){return new _t((function(e,t){s=function(){var t=xr("cordova.plugins.browsertab.close",u);return e(),"function"===typeof t&&t(),i.a&&"function"===typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Ea(s),l=function(){o||(o=Pn(2e3).then((function(){t(new P("redirect-cancelled-by-user"))})))},c=function(){Hr()&&l()},a.addEventListener("resume",l,!1),Tr().toLowerCase().match(/android/)||a.addEventListener("visibilitychange",c,!1)})).s((function(e){return Dl(i).then((function(){throw e}))}))})).na((function(){l&&a.removeEventListener("resume",l,!1),c&&a.removeEventListener("visibilitychange",c,!1),o&&o.cancel(),s&&i.Ra(s),i.c=null}))},n.Ea=function(e){this.b.push(e),Il(this).s((function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new Ba("unknown",null,null,null,new P("no-auth-event")),e(t))}))},n.Ra=function(e){Q(this.b,(function(t){return t==e}))};var xl={name:"pendingRedirect",D:"session"};function Cl(e){return al(e.b,xl,e.a)}function Al(e,t,n,r){this.i={},this.u=0,this.O=e,this.m=t,this.v=n,this.G=r,this.h=[],this.f=!1,this.l=w(this.o,this),this.b=new Gl,this.A=new $l,this.g=new Tl(ql(this.m,this.v)),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.A,this.c.linkViaPopup=this.A,this.c.reauthViaPopup=this.A,this.a=Ll(this.O,this.m,this.v,D,this.G)}function Ll(e,n,r,i,a){var o=t.a.SDK_VERSION||null;return yr()?new kl(e,n,r,o,i,a):new vu(e,n,r,o,i,a)}function Ol(e){e.f||(e.f=!0,e.a.Ea(e.l));var t=e.a;return e.a.la().s((function(n){throw e.a==t&&e.reset(),n}))}function Ml(e){e.a.Wb()&&Ol(e).s((function(t){var n=new Ba("unknown",null,null,null,new P("operation-not-supported-in-this-environment"));Bl(t)&&e.o(n)})),e.a.Sb()||Kl(e.b)}function Rl(e,t){K(e.h,t)||e.h.push(t),e.f||function(e){return e.b.get(xl,e.a).then((function(e){return"pending"==e}))}(e.g).then((function(t){t?Cl(e.g).then((function(){Ol(e).s((function(t){var n=new Ba("unknown",null,null,null,new P("operation-not-supported-in-this-environment"));Bl(t)&&e.o(n)}))})):Ml(e)})).s((function(){Ml(e)}))}function Fl(e,t){Q(e.h,(function(e){return e==t}))}Al.prototype.reset=function(){this.f=!1,this.a.Ra(this.l),this.a=Ll(this.O,this.m,this.v,null,this.G),this.i={}},Al.prototype.o=function(e){if(!e)throw new P("invalid-auth-event");if(6e5<=S()-this.u&&(this.i={},this.u=0),e&&e.getUid()&&this.i.hasOwnProperty(e.getUid()))return!1;for(var t=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.Eb(e.c,e.b)){(t=this.c[e.c])&&(t.h(e,r),e&&(e.f||e.b)&&(this.i[e.getUid()]=!0,this.u=S())),t=!0;break}}return Kl(this.b),t};var Nl=new Vr(2e3,1e4),jl=new Vr(3e4,6e4);function Ul(e,t,n,r,i,a,o){return e.a.Lb(t,n,r,(function(){e.f||(e.f=!0,e.a.Ea(e.l))}),(function(){e.reset()}),i,a,o)}function Bl(e){return!(!e||"auth/cordova-not-ready"!=e.code)}function Vl(e,t,n,r,i){var a;return function(e){return e.b.set(xl,"pending",e.a)}(e.g).then((function(){return e.a.Mb(t,n,r,i).s((function(t){if(Bl(t))throw new P("operation-not-supported-in-this-environment");return a=t,Cl(e.g).then((function(){throw a}))})).then((function(){return e.a.Zb()?new _t((function(){})):Cl(e.g).then((function(){return e.qa()})).then((function(){})).s((function(){}))}))}))}function Hl(e,t,n,r,i){return e.a.Nb(r,(function(e){t.ma(n,null,e,i)}),Nl.get())}Al.prototype.qa=function(){return this.b.qa()};var Wl={};function ql(e,t,n){return e=e+":"+t,n&&(e=e+":"+n.url),e}function zl(e,t,n,r){var i=ql(t,n,r);return Wl[i]||(Wl[i]=new Al(e,t,n,r)),Wl[i]}function Gl(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Kl(e){e.g||(e.g=!0,Xl(e,!1,null,null))}function Yl(e){e.g&&!e.i&&Xl(e,!1,null,null)}function Ql(e,t){if(e.b=function(){return It(t)},e.f.length)for(var n=0;n<e.f.length;n++)e.f[n](t)}function Xl(e,t,n,r){t?r?function(e,t){if(e.b=function(){return Dt(t)},e.c.length)for(var n=0;n<e.c.length;n++)e.c[n](t)}(e,r):Ql(e,n):Ql(e,{user:null}),e.f=[],e.c=[]}function $l(){}function Jl(){this.hb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.hb},set:function(e){this.hb=e},enumerable:!1})}function Zl(e,t){this.a=t,Xr(this,"verificationId",e)}function ec(e,t,n,r){return new Fa(e).eb(t,n).then((function(e){return new Zl(e,r)}))}function tc(e){var t=zi(e);if(!(t&&t.exp&&t.auth_time&&t.iat))throw new P("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");$r(this,{token:e,expirationTime:qr(1e3*t.exp),authTime:qr(1e3*t.auth_time),issuedAtTime:qr(1e3*t.iat),signInProvider:t.firebase&&t.firebase.sign_in_provider?t.firebase.sign_in_provider:null,signInSecondFactor:t.firebase&&t.firebase.sign_in_second_factor?t.firebase.sign_in_second_factor:null,claims:t})}function nc(e,t,n){var r=t&&t[ic];if(!r)throw new P("argument-error","Internal assert: Invalid MultiFactorResolver");this.a=e,this.f=pe(t),this.g=n,this.c=new oa(null,r),this.b=[];var i=this;W(t[rc]||[],(function(e){(e=ti(e))&&i.b.push(e)})),Xr(this,"auth",this.a),Xr(this,"session",this.c),Xr(this,"hints",this.b)}Gl.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},Gl.prototype.h=function(e,t){if(e){this.reset(),this.g=!0;var n=e.c,r=e.b,i=e.a&&"auth/web-storage-unsupported"==e.a.code,a=e.a&&"auth/operation-not-supported-in-this-environment"==e.a.code;this.i=!(!i&&!a),"unknown"!=n||i||a?e.a?(Xl(this,!0,null,e.a),It()):t.Fa(n,r)?function(e,t,n){n=n.Fa(t.c,t.b);var r=t.g,i=t.f,a=t.i,o=t.S(),s=!!t.c.match(/Redirect$/);n(r,i,o,a).then((function(t){Xl(e,s,t,null)})).s((function(t){Xl(e,s,null,t)}))}(this,e,t):Dt(new P("invalid-auth-event")):(Xl(this,!1,null,null),It())}else Dt(new P("invalid-auth-event"))},Gl.prototype.qa=function(){var e=this;return new _t((function(t,n){e.b?e.b().then(t,n):(e.f.push(t),e.c.push(n),function(e){var t=new P("timeout");e.a&&e.a.cancel(),e.a=Pn(jl.get()).then((function(){e.b||(e.g=!0,Xl(e,!0,null,t))}))}(e))}))},$l.prototype.h=function(e,t){if(e){var n=e.c,r=e.b;e.a?(t.ma(e.c,null,e.a,e.b),It()):t.Fa(n,r)?function(e,t){var n=e.b,r=e.c;t.Fa(r,n)(e.g,e.f,e.S(),e.i).then((function(e){t.ma(r,e,null,n)})).s((function(e){t.ma(r,null,e,n)}))}(e,t):Dt(new P("invalid-auth-event"))}else Dt(new P("invalid-auth-event"))},Zl.prototype.confirm=function(e){return e=Na(this.verificationId,e),this.a(e)};var rc="mfaInfo",ic="mfaPendingCredential";function ac(e,t,n,r){P.call(this,"multi-factor-auth-required",r,t),this.b=new nc(e,t,n),Xr(this,"resolver",this.b)}function oc(e,t,n){if(e&&g(e.serverResponse)&&"auth/multi-factor-auth-required"===e.code)try{return new ac(t,e.serverResponse,n,e.message)}catch(r){}return null}function sc(){}function uc(e){Xr(this,"factorId",e.fa),this.a=e}function lc(e){if(uc.call(this,e),this.a.fa!=Fa.PROVIDER_ID)throw new P("argument-error","firebase.auth.PhoneMultiFactorAssertion requires a valid firebase.auth.PhoneAuthCredential")}function cc(e,t){for(var n in Qt.call(this,e),t)this[n]=t[n]}function dc(e,t){this.a=e,this.b=[],this.c=w(this.xc,this),un(this.a,"userReloaded",this.c);var n=[];t&&t.multiFactor&&t.multiFactor.enrolledFactors&&W(t.multiFactor.enrolledFactors,(function(e){var t=null,r={};if(e){e.uid&&(r[ii]=e.uid),e.displayName&&(r[ni]=e.displayName),e.enrollmentTime&&(r[ri]=new Date(e.enrollmentTime).toISOString()),e.phoneNumber&&(r[ai]=e.phoneNumber);try{t=new oi(r)}catch(i){}e=t}else e=null;e&&n.push(e)})),hc(this,n)}function hc(e,t){e.b=t,Xr(e,"enrolledFactors",t)}function fc(e,t,n){if(this.h=e,this.i=t,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function pc(e,t){e.stop(),e.b=Pn(function(e,t){return t?(e.a=e.c,e.g()):(t=e.a,e.a*=2,e.a>e.f&&(e.a=e.f),t)}(e,t)).then((function(){return function(){var e=u.document,t=null;return Hr()||!e?It():new _t((function(n){t=function(){Hr()&&(e.removeEventListener("visibilitychange",t,!1),n())},e.addEventListener("visibilitychange",t,!1)})).s((function(n){throw e.removeEventListener("visibilitychange",t,!1),n}))}()})).then((function(){return e.h()})).then((function(){pc(e,!0)})).s((function(t){e.i(t)&&pc(e,!1)}))}function gc(e){this.c=e,this.b=this.a=null}function vc(e){return e.b&&1e3*e.b.c||0}function mc(e,t){var n=t.refreshToken;e.b=qi(t[es]||""),e.a=n}function yc(e,t){return function(e,t){return new _t((function(n,r){"refresh_token"==t.grant_type&&t.refresh_token||"authorization_code"==t.grant_type&&t.code?ls(e,e.l+"?key="+encodeURIComponent(e.c),(function(e){e?e.error?r(su(e)):e.access_token&&e.refresh_token?n(e):r(new P("internal-error")):r(new P("network-request-failed"))}),"POST",Xn(t).toString(),e.g,e.v.get()):r(new P("internal-error"))}))}(e.c,t).then((function(t){return e.b=qi(t.access_token),e.a=t.refresh_token,{accessToken:e.b.toString(),refreshToken:e.a}})).s((function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t}))}function _c(e,t){this.a=e||null,this.b=t||null,$r(this,{lastSignInTime:qr(t||null),creationTime:qr(e||null)})}function bc(e,t,n,r,i,a){$r(this,{uid:e,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:a||null,providerId:t})}function wc(e,n,r){this.G=[],this.l=e.apiKey,this.m=e.appName,this.o=e.authDomain||null;var i=t.a.SDK_VERSION?Dr(t.a.SDK_VERSION):null;this.a=new Jo(this.l,A(D),i),e.emulatorConfig&&os(this.a,e.emulatorConfig),this.b=new gc(this.a),xc(this,n[es]),mc(this.b,n),Xr(this,"refreshToken",this.b.a),Lc(this,r||{}),bn.call(this),this.P=!1,this.o&&Ar()&&(this.i=zl(this.o,this.l,this.m)),this.R=[],this.f=null,this.u=function(e){return new fc((function(){return e.I(!0)}),(function(e){return!(!e||"auth/network-request-failed"!=e.code)}),(function(){var t=vc(e.b)-S()-3e5;return 0<t?t:0}))}(this),this.$=w(this.gb,this);var a=this;this.pa=null,this.Ba=function(e){a.wa(e.h)},this.ba=null,this.za=function(e){os(a.a,e.c)},this.W=null,this.X=[],this.Aa=function(e){Ec(a,e.f)},this.aa=null,this.N=new dc(this,r),Xr(this,"multiFactor",this.N)}function kc(e,t){e.ba&&dn(e.ba,"languageCodeChanged",e.Ba),(e.ba=t)&&un(t,"languageCodeChanged",e.Ba)}function Sc(e,t){e.W&&dn(e.W,"emulatorConfigChanged",e.za),(e.W=t)&&un(t,"emulatorConfigChanged",e.za)}function Ec(e,n){e.X=n,us(e.a,t.a.SDK_VERSION?Dr(t.a.SDK_VERSION,e.X):null)}function Pc(e,t){e.aa&&dn(e.aa,"frameworkChanged",e.Aa),(e.aa=t)&&un(t,"frameworkChanged",e.Aa)}function Ic(e){try{return t.a.app(e.m).auth()}catch(n){throw new P("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Dc(e){e.A||e.u.b||(e.u.start(),dn(e,"tokenChanged",e.$),un(e,"tokenChanged",e.$))}function Tc(e){dn(e,"tokenChanged",e.$),e.u.stop()}function xc(e,t){e.ya=t,Xr(e,"_lat",t)}function Cc(e){for(var t=[],n=0;n<e.R.length;n++)t.push(e.R[n](e));return xt(t).then((function(){return e}))}function Ac(e){e.i&&!e.P&&(e.P=!0,Rl(e.i,e))}function Lc(e,t){$r(e,{uid:t.uid,displayName:t.displayName||null,photoURL:t.photoURL||null,email:t.email||null,emailVerified:t.emailVerified||!1,phoneNumber:t.phoneNumber||null,isAnonymous:t.isAnonymous||!1,tenantId:t.tenantId||null,metadata:new _c(t.createdAt,t.lastLoginAt),providerData:[]}),e.a.b=e.tenantId}function Oc(){}function Mc(e){return It().then((function(){if(e.A)throw new P("app-deleted")}))}function Rc(e){return z(e.providerData,(function(e){return e.providerId}))}function Fc(e,t){t&&(Nc(e,t.providerId),e.providerData.push(t))}function Nc(e,t){Q(e.providerData,(function(e){return e.providerId==t}))}function jc(e,t,n){("uid"!=t||n)&&e.hasOwnProperty(t)&&Xr(e,t,n)}function Uc(e,t){e!=t&&($r(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?Xr(e,"metadata",function(e){return new _c(e.a,e.b)}(t.metadata)):Xr(e,"metadata",new _c),W(t.providerData,(function(t){Fc(e,t)})),function(e,t){e.b=t.b,e.a=t.a}(e.b,t.b),Xr(e,"refreshToken",e.b.a),hc(e.N,t.N.b))}function Bc(e){return e.I().then((function(t){var n=e.isAnonymous;return function(e,t){return au(e.a,Fs,{idToken:t}).then(w(e.Jc,e))}(e,t).then((function(){return n||jc(e,"isAnonymous",!1),t}))}))}function Vc(e,t){t[es]&&e.ya!=t[es]&&(mc(e.b,t),e.dispatchEvent(new cc("tokenChanged")),xc(e,t[es]),jc(e,"refreshToken",e.b.a))}function Hc(e,t){return Bc(e).then((function(){if(K(Rc(e),t))return Cc(e).then((function(){throw new P("provider-already-linked")}))}))}function Wc(e,t,n){return Jr({user:e,credential:ja(t),additionalUserInfo:t=Xi(t),operationType:n})}function qc(e,t){return Vc(e,t),e.reload().then((function(){return e}))}function zc(e,n,r,i,a){if(!Ar())return Dt(new P("operation-not-supported-in-this-environment"));if(e.f&&!a)return Dt(e.f);var o=Qi(r.providerId),s=jr(e.uid+":::"),u=null;(!Mr()||_r())&&e.o&&r.isOAuthProvider&&(u=bu(e.o,e.l,e.m,n,r,null,s,t.a.SDK_VERSION||null,null,null,e.tenantId));var l=pr(u,o&&o.ua,o&&o.ta);return i=i().then((function(){if(Kc(e),!a)return e.I().then((function(){}))})).then((function(){return Ul(e.i,l,n,r,s,!!u,e.tenantId)})).then((function(){return new _t((function(t,r){e.ma(n,null,new P("cancelled-popup-request"),e.h||null),e.g=t,e.O=r,e.h=s,e.c=Hl(e.i,e,n,l,s)}))})).then((function(e){return l&&fr(l),e?Jr(e):null})).s((function(e){throw l&&fr(l),e})),Yc(e,i,a)}function Gc(e,t,n,r,i){if(!Ar())return Dt(new P("operation-not-supported-in-this-environment"));if(e.f&&!i)return Dt(e.f);var a=null,o=jr(e.uid+":::");return r=r().then((function(){if(Kc(e),!i)return e.I().then((function(){}))})).then((function(){return e.ga=o,Cc(e)})).then((function(t){return e.ha&&(t=(t=e.ha).b.set($c,e.w(),t.a)),t})).then((function(){return Vl(e.i,t,n,o,e.tenantId)})).s((function(t){if(a=t,e.ha)return Jc(e.ha);throw a})).then((function(){if(a)throw a})),Yc(e,r,i)}function Kc(e){if(!e.i||!e.P){if(e.i&&!e.P)throw new P("internal-error");throw new P("auth-domain-config-required")}}function Yc(e,t,n){var r=function(e,t,n){return e.f&&!n?(t.cancel(),Dt(e.f)):t.s((function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.f||e.dispatchEvent(new cc("userInvalidated")),e.f=t),t}))}(e,t,n);return e.G.push(r),r.na((function(){Y(e.G,r)})),r.s((function(t){var n=null;throw t&&"auth/multi-factor-auth-required"===t.code&&(n=oc(t.w(),Ic(e),w(e.ic,e))),n||t}))}function Qc(e){if(!e.apiKey)return null;var t={apiKey:e.apiKey,authDomain:e.authDomain,appName:e.appName,emulatorConfig:e.emulatorConfig},n={};if(!e.stsTokenManager||!e.stsTokenManager.accessToken)return null;n[es]=e.stsTokenManager.accessToken,n.refreshToken=e.stsTokenManager.refreshToken||null;var r=new wc(t,n,e);return e.providerData&&W(e.providerData,(function(e){e&&Fc(r,Jr(e))})),e.redirectEventId&&(r.ga=e.redirectEventId),r}function Xc(e){this.a=e,this.b=nl()}nc.prototype.Qc=function(e){var t=this;return e.rb(this.a.a,this.c).then((function(e){var n=pe(t.f);return delete n[rc],delete n[ic],ve(n,e),t.g(n)}))},E(ac,P),sc.prototype.rb=function(e,t,n){return t.type==sa?function(e,t,n,r){return n.Ha().then((function(n){return n={idToken:n},"undefined"!==typeof r&&(n.displayName=r),ve(n,{phoneVerificationInfo:Ra(e.a)}),au(t,Ms,n)}))}(this,e,t,n):function(e,t,n){return n.Ha().then((function(n){return ve(n={mfaPendingCredential:n},{phoneVerificationInfo:Ra(e.a)}),au(t,Rs,n)}))}(this,e,t)},E(uc,sc),E(lc,uc),E(cc,Qt),(n=dc.prototype).xc=function(e){hc(this,function(e){var t=[];return W(e.mfaInfo||[],(function(e){(e=ti(e))&&t.push(e)})),t}(e.gd))},n.Qb=function(){return this.a.I().then((function(e){return new oa(e,null)}))},n.ec=function(e,t){var n=this,r=this.a.a;return this.Qb().then((function(n){return e.rb(r,n,t)})).then((function(e){return Vc(n.a,e),n.a.reload()}))},n.ad=function(e){var t=this,n="string"===typeof e?e:e.uid,r=this.a.a;return this.a.I().then((function(e){return au(r,iu,{idToken:e,mfaEnrollmentId:n})})).then((function(e){var r=q(t.b,(function(e){return e.uid!=n}));return hc(t,r),Vc(t.a,e),t.a.reload().s((function(e){if("auth/user-token-expired"!=e.code)throw e}))}))},n.w=function(){return{multiFactor:{enrolledFactors:z(this.b,(function(e){return e.w()}))}}},fc.prototype.start=function(){this.a=this.c,pc(this,!0)},fc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},gc.prototype.w=function(){return{apiKey:this.c.c,refreshToken:this.a,accessToken:this.b&&this.b.toString(),expirationTime:vc(this)}},gc.prototype.getToken=function(e){return e=!!e,this.b&&!this.a?Dt(new P("user-token-expired")):e||!this.b||S()>vc(this)-3e4?this.a?yc(this,{grant_type:"refresh_token",refresh_token:this.a}):It(null):It({accessToken:this.b.toString(),refreshToken:this.a})},_c.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},E(wc,bn),wc.prototype.wa=function(e){this.pa=e,as(this.a,e)},wc.prototype.ka=function(){return this.pa},wc.prototype.Ga=function(){return $(this.X)},wc.prototype.gb=function(){this.u.b&&(this.u.stop(),this.u.start())},Xr(wc.prototype,"providerId","firebase"),(n=wc.prototype).reload=function(){var e=this;return Yc(this,Mc(this).then((function(){return Bc(e).then((function(){return Cc(e)})).then(Oc)})))},n.nc=function(e){return this.I(e).then((function(e){return new tc(e)}))},n.I=function(e){var t=this;return Yc(this,Mc(this).then((function(){return t.b.getToken(e)})).then((function(e){if(!e)throw new P("internal-error");return e.accessToken!=t.ya&&(xc(t,e.accessToken),t.dispatchEvent(new cc("tokenChanged"))),jc(t,"refreshToken",e.refreshToken),e.accessToken})))},n.Jc=function(e){if(!(e=e.users)||!e.length)throw new P("internal-error");Lc(this,{uid:(e=e[0]).localId,displayName:e.displayName,photoURL:e.photoUrl,email:e.email,emailVerified:!!e.emailVerified,phoneNumber:e.phoneNumber,lastLoginAt:e.lastLoginAt,createdAt:e.createdAt,tenantId:e.tenantId});for(var t=function(e){return(e=e.providerUserInfo)&&e.length?z(e,(function(e){return new bc(e.rawId,e.providerId,e.email,e.displayName,e.photoUrl,e.phoneNumber)})):[]}(e),n=0;n<t.length;n++)Fc(this,t[n]);jc(this,"isAnonymous",!(this.email&&e.passwordHash)&&!(this.providerData&&this.providerData.length)),this.dispatchEvent(new cc("userReloaded",{gd:e}))},n.Kc=function(e){return Yr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.sb(e)},n.sb=function(e){var t=this,n=null;return Yc(this,e.c(this.a,this.uid).then((function(e){return Vc(t,e),n=Wc(t,e,"reauthenticate"),t.f=null,t.reload()})).then((function(){return n})),!0)},n.Bc=function(e){return Yr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.pb(e)},n.pb=function(e){var t=this,n=null;return Yc(this,Hc(this,e.providerId).then((function(){return t.I()})).then((function(n){return e.b(t.a,n)})).then((function(e){return n=Wc(t,e,"link"),qc(t,e)})).then((function(){return n})))},n.Cc=function(e,t){var n=this;return Yc(this,Hc(this,"phone").then((function(){return ec(Ic(n),e,t,w(n.pb,n))})))},n.Lc=function(e,t){var n=this;return Yc(this,It().then((function(){return ec(Ic(n),e,t,w(n.sb,n))})),!0)},n.Ab=function(e){var t=this;return Yc(this,this.I().then((function(n){return t.a.Ab(n,e)})).then((function(e){return Vc(t,e),t.reload()})))},n.dd=function(e){var t=this;return Yc(this,this.I().then((function(n){return e.b(t.a,n)})).then((function(e){return Vc(t,e),t.reload()})))},n.Bb=function(e){var t=this;return Yc(this,this.I().then((function(n){return t.a.Bb(n,e)})).then((function(e){return Vc(t,e),t.reload()})))},n.Cb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Mc(this);var t=this;return Yc(this,this.I().then((function(n){return t.a.Cb(n,{displayName:e.displayName,photoUrl:e.photoURL})})).then((function(e){return Vc(t,e),jc(t,"displayName",e.displayName||null),jc(t,"photoURL",e.photoUrl||null),W(t.providerData,(function(e){"password"===e.providerId&&(Xr(e,"displayName",t.displayName),Xr(e,"photoURL",t.photoURL))})),Cc(t)})).then(Oc))},n.bd=function(e){var t=this;return Yc(this,Bc(this).then((function(n){return K(Rc(t),e)?function(e,t,n){return au(e,As,{idToken:t,deleteProvider:n})}(t.a,n,[e]).then((function(e){var n={};return W(e.providerUserInfo||[],(function(e){n[e.providerId]=!0})),W(Rc(t),(function(e){n[e]||Nc(t,e)})),n[Fa.PROVIDER_ID]||Xr(t,"phoneNumber",null),Cc(t)})):Cc(t).then((function(){throw new P("no-such-provider")}))})))},n.delete=function(){var e=this;return Yc(this,this.I().then((function(t){return au(e.a,Cs,{idToken:t})})).then((function(){e.dispatchEvent(new cc("userDeleted"))}))).then((function(){for(var t=0;t<e.G.length;t++)e.G[t].cancel("app-deleted");kc(e,null),Sc(e,null),Pc(e,null),e.G=[],e.A=!0,Tc(e),Xr(e,"refreshToken",null),e.i&&Fl(e.i,e)}))},n.Eb=function(e,t){return!!("linkViaPopup"==e&&(this.h||null)==t&&this.g||"reauthViaPopup"==e&&(this.h||null)==t&&this.g||"linkViaRedirect"==e&&(this.ga||null)==t||"reauthViaRedirect"==e&&(this.ga||null)==t)},n.ma=function(e,t,n,r){"linkViaPopup"!=e&&"reauthViaPopup"!=e||r!=(this.h||null)||(n&&this.O?this.O(n):t&&!n&&this.g&&this.g(t),this.c&&(this.c.cancel(),this.c=null),delete this.g,delete this.O)},n.Fa=function(e,t){return"linkViaPopup"==e&&t==(this.h||null)?w(this.Jb,this):"reauthViaPopup"==e&&t==(this.h||null)?w(this.Kb,this):"linkViaRedirect"==e&&(this.ga||null)==t?w(this.Jb,this):"reauthViaRedirect"==e&&(this.ga||null)==t?w(this.Kb,this):null},n.Dc=function(e){var t=this;return zc(this,"linkViaPopup",e,(function(){return Hc(t,e.providerId).then((function(){return Cc(t)}))}),!1)},n.Mc=function(e){return zc(this,"reauthViaPopup",e,(function(){return It()}),!0)},n.Ec=function(e){var t=this;return Gc(this,"linkViaRedirect",e,(function(){return Hc(t,e.providerId)}),!1)},n.Nc=function(e){return Gc(this,"reauthViaRedirect",e,(function(){return It()}),!0)},n.Jb=function(e,t,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var a=null;return Yc(this,this.I().then((function(n){return Ss(i.a,{requestUri:e,postBody:r,sessionId:t,idToken:n})})).then((function(e){return a=Wc(i,e,"link"),qc(i,e)})).then((function(){return a})))},n.Kb=function(e,t,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var a=null;return Yc(this,It().then((function(){return ca(Es(i.a,{requestUri:e,sessionId:t,postBody:r,tenantId:n}),i.uid)})).then((function(e){return a=Wc(i,e,"reauthenticate"),Vc(i,e),i.f=null,i.reload()})).then((function(){return a})),!0)},n.tb=function(e){var t=this,n=null;return Yc(this,this.I().then((function(t){return n=t,"undefined"===typeof e||fe(e)?{}:Bi(new Ci(e))})).then((function(e){return t.a.tb(n,e)})).then((function(e){if(t.email!=e)return t.reload()})).then((function(){})))},n.Db=function(e,t){var n=this,r=null;return Yc(this,this.I().then((function(e){return r=e,"undefined"===typeof t||fe(t)?{}:Bi(new Ci(t))})).then((function(t){return n.a.Db(r,e,t)})).then((function(e){if(n.email!=e)return n.reload()})).then((function(){})))},n.ic=function(e){var t=null,n=this;return Yc(this,e=ca(It(e),n.uid).then((function(e){return t=Wc(n,e,"reauthenticate"),Vc(n,e),n.f=null,n.reload()})).then((function(){return t})),!0)},n.toJSON=function(){return this.w()},n.w=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.w(),redirectEventId:this.ga||null};return this.metadata&&ve(e,this.metadata.w()),W(this.providerData,(function(t){e.providerData.push(function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}(t))})),ve(e,this.N.w()),e};var $c={name:"redirectUser",D:"session"};function Jc(e){return al(e.b,$c,e.a)}function Zc(e){this.a=e,this.b=nl(),this.c=null,this.f=function(e){var t=nd("local"),n=nd("session"),r=nd("none");return function(e,t,n){var r=il(t,n),i=rl(e,t.D);return e.get(t,n).then((function(a){var o=null;try{o=Nr(u.localStorage.getItem(r))}catch(s){}if(o&&!a)return u.localStorage.removeItem(r),e.set(t,o,n);o&&a&&"localStorage"!=i.type&&u.localStorage.removeItem(r)}))}(e.b,t,e.a).then((function(){return e.b.get(n,e.a)})).then((function(i){return i?n:e.b.get(r,e.a).then((function(n){return n?r:e.b.get(t,e.a).then((function(n){return n?t:e.b.get(td,e.a).then((function(e){return e?nd(e):t}))}))}))})).then((function(t){return e.c=t,ed(e,t.D)})).s((function(){e.c||(e.c=t)}))}(this),this.b.addListener(nd("local"),this.a,w(this.g,this))}function ed(e,t){var n,r=[];for(n in el)el[n]!==t&&r.push(al(e.b,nd(el[n]),e.a));return r.push(al(e.b,td,e.a)),function(e){return new _t((function(t,n){var r=e.length,i=[];if(r)for(var a=function(e,n){r--,i[e]=n,0==r&&t(i)},o=function(e){n(e)},s=0;s<e.length;s++)Tt(e[s],k(a,s),o);else t(i)}))}(r)}Zc.prototype.g=function(){var e=this,t=nd("local");od(this,(function(){return It().then((function(){return e.c&&"local"!=e.c.D?e.b.get(t,e.a):null})).then((function(n){if(n)return ed(e,"local").then((function(){e.c=t}))}))}))};var td={name:"persistence",D:"session"};function nd(e){return{name:"authUser",D:e}}function rd(e,t){return od(e,(function(){return e.b.set(e.c,t.w(),e.a)}))}function id(e){return od(e,(function(){return al(e.b,e.c,e.a)}))}function ad(e,t,n){return od(e,(function(){return e.b.get(e.c,e.a).then((function(e){return e&&t&&(e.authDomain=t),e&&n&&(e.emulatorConfig=n),Qc(e||{})}))}))}function od(e,t){return e.f=e.f.then(t,t),e.f}function sd(e){if(this.m=!1,Xr(this,"settings",new Jl),Xr(this,"app",e),!vd(this).options||!vd(this).options.apiKey)throw new P("invalid-api-key");e=t.a.SDK_VERSION?Dr(t.a.SDK_VERSION):null,this.a=new Jo(vd(this).options&&vd(this).options.apiKey,A(D),e),this.R=[],this.u=[],this.P=[],this.ac=t.a.INTERNAL.createSubscribe(w(this.yc,this)),this.X=void 0,this.bc=t.a.INTERNAL.createSubscribe(w(this.zc,this)),pd(this,null),this.l=new Zc(vd(this).options.apiKey+":"+vd(this).name),this.G=new Xc(vd(this).options.apiKey+":"+vd(this).name),this.$=bd(this,function(e){var t=vd(e).options.authDomain,n=function(e){var t=function(e,t){return e.b.get($c,e.a).then((function(e){return e&&t&&(e.authDomain=t),Qc(e||{})}))}(e.G,vd(e).options.authDomain).then((function(t){return(e.o=t)&&(t.ha=e.G),Jc(e.G)}));return bd(e,t)}(e).then((function(){return ad(e.l,t,e.f)})).then((function(t){return t?(t.ha=e.G,e.o&&(e.o.ga||null)==(t.ga||null)?t:t.reload().then((function(){return rd(e.l,t).then((function(){return t}))})).s((function(n){return"auth/network-request-failed"==n.code?t:id(e.l)}))):null})).then((function(t){pd(e,t||null)}));return bd(e,n)}(this)),this.i=bd(this,function(e){return e.$.then((function(){return hd(e)})).s((function(){})).then((function(){if(!e.m)return e.pa()})).s((function(){})).then((function(){if(!e.m){e.ba=!0;var t=e.l;t.b.addListener(nd("local"),t.a,e.pa)}}))}(this)),this.ba=!1,this.pa=w(this.Yc,this),this.Ba=w(this.da,this),this.ya=w(this.kc,this),this.za=w(this.vc,this),this.Aa=w(this.wc,this),this.b=null,function(e){var t=vd(e).options.authDomain,n=vd(e).options.apiKey;t&&Ar()&&(e.gb=e.$.then((function(){if(!e.m){if(e.b=zl(t,n,vd(e).name,e.f),Rl(e.b,e),md(e)&&Ac(md(e)),e.o){Ac(e.o);var r=e.o;r.wa(e.ka()),kc(r,e),Ec(r=e.o,e.N),Pc(r,e),os((r=e.o).a,e.f),Sc(r,e),e.o=null}return e.b}})))}(this),this.INTERNAL={},this.INTERNAL.delete=w(this.delete,this),this.INTERNAL.logFramework=w(this.Fc,this),this.A=0,bn.call(this),function(e){Object.defineProperty(e,"lc",{get:function(){return this.ka()},set:function(e){this.wa(e)},enumerable:!1}),e.aa=null,Object.defineProperty(e,"ti",{get:function(){return this.S()},set:function(e){this.xb(e)},enumerable:!1}),e.W=null}(this),this.N=[],this.f=null}function ud(e){Qt.call(this,"languageCodeChanged"),this.h=e}function ld(e){Qt.call(this,"emulatorConfigChanged"),this.c=e}function cd(e){Qt.call(this,"frameworkChanged"),this.f=e}function dd(e){return e.gb||Dt(new P("auth-domain-config-required"))}function hd(e){if(!Ar())return Dt(new P("operation-not-supported-in-this-environment"));var t=dd(e).then((function(){return e.b.qa()})).then((function(e){return e?Jr(e):null}));return bd(e,t)}function fd(e,t){var n={};return n.apiKey=vd(e).options.apiKey,n.authDomain=vd(e).options.authDomain,n.appName=vd(e).name,e.f&&(n.emulatorConfig=e.f),e.$.then((function(){return function(e,t,n,r){var i=new wc(e,t);return n&&(i.ha=n),r&&Ec(i,r),i.reload().then((function(){return i}))}(n,t,e.G,e.Ga())})).then((function(t){return md(e)&&t.uid==md(e).uid?(Uc(md(e),t),e.da(t)):(pd(e,t),Ac(t),e.da(t))})).then((function(){_d(e)}))}function pd(e,t){md(e)&&(function(e,t){Q(e.R,(function(e){return e==t}))}(md(e),e.Ba),dn(md(e),"tokenChanged",e.ya),dn(md(e),"userDeleted",e.za),dn(md(e),"userInvalidated",e.Aa),Tc(md(e))),t&&(t.R.push(e.Ba),un(t,"tokenChanged",e.ya),un(t,"userDeleted",e.za),un(t,"userInvalidated",e.Aa),0<e.A&&Dc(t)),Xr(e,"currentUser",t),t&&(t.wa(e.ka()),kc(t,e),Ec(t,e.N),Pc(t,e),os(t.a,e.f),Sc(t,e))}function gd(e,t){var n=null,r=null;return bd(e,t.then((function(t){return n=ja(t),r=Xi(t),fd(e,t)}),(function(t){var n=null;throw t&&"auth/multi-factor-auth-required"===t.code&&(n=oc(t.w(),e,w(e.jc,e))),n||t})).then((function(){return Jr({user:md(e),credential:n,additionalUserInfo:r,operationType:"signIn"})})))}function vd(e){return e.app}function md(e){return e.currentUser}function yd(e){return md(e)&&md(e)._lat||null}function _d(e){if(e.ba){for(var t=0;t<e.u.length;t++)e.u[t]&&e.u[t](yd(e));if(e.X!==e.getUid()&&e.P.length)for(e.X=e.getUid(),t=0;t<e.P.length;t++)e.P[t]&&e.P[t](yd(e))}}function bd(e,t){return e.R.push(t),t.na((function(){Y(e.R,t)})),t}function wd(){}function kd(){this.a={},this.b=1e12}Zc.prototype.wb=function(e){var t=null,n=this;return function(e){var t=new P("invalid-persistence-type"),n=new P("unsupported-persistence-type");e:{for(r in el)if(el[r]==e){var r=!0;break e}r=!1}if(!r||"string"!==typeof e)throw t;switch(wr()){case"ReactNative":if("session"===e)throw n;break;case"Node":if("none"!==e)throw n;break;case"Worker":if("session"===e||!Ou()&&"none"!==e)throw n;break;default:if(!Cr()&&"none"!==e)throw n}}(e),od(this,(function(){return e!=n.c.D?n.b.get(n.c,n.a).then((function(r){return t=r,ed(n,e)})).then((function(){if(n.c=nd(e),t)return n.b.set(n.c,t,n.a)})):It()}))},E(sd,bn),E(ud,Qt),E(ld,Qt),E(cd,Qt),(n=sd.prototype).wb=function(e){return bd(this,e=this.l.wb(e))},n.wa=function(e){this.aa===e||this.m||(this.aa=e,as(this.a,this.aa),this.dispatchEvent(new ud(this.ka())))},n.ka=function(){return this.aa},n.ed=function(){var e=u.navigator;this.wa(e&&(e.languages&&e.languages[0]||e.language||e.userLanguage)||null)},n.fd=function(e){if(!this.f){if(!/^https?:\/\//.test(e))throw new P("argument-error","Emulator URL must start with a valid scheme (http:// or https://).");Wr("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),u.document&&mr().then((function(){var e=u.document.createElement("div");e.innerText="Running in emulator mode. Do not use with production credentials.",e.style.position="fixed",e.style.width="100%",e.style.backgroundColor="#ffffff",e.style.border=".1em solid #000000",e.style.color="#ff0000",e.style.bottom="0px",e.style.left="0px",e.style.margin="0px",e.style.zIndex=1e4,e.style.textAlign="center",e.classList.add("firebase-emulator-warning"),u.document.body.appendChild(e)})),this.f={url:e},this.settings.hb=!0,os(this.a,this.f),this.dispatchEvent(new ld(this.f))}},n.Fc=function(e){this.N.push(e),us(this.a,t.a.SDK_VERSION?Dr(t.a.SDK_VERSION,this.N):null),this.dispatchEvent(new cd(this.N))},n.Ga=function(){return $(this.N)},n.xb=function(e){this.W===e||this.m||(this.W=e,this.a.b=this.W)},n.S=function(){return this.W},n.toJSON=function(){return{apiKey:vd(this).options.apiKey,authDomain:vd(this).options.authDomain,appName:vd(this).name,currentUser:md(this)&&md(this).w()}},n.Eb=function(e,t){switch(e){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.h==t&&!!this.g;default:return!1}},n.ma=function(e,t,n,r){"signInViaPopup"==e&&this.h==r&&(n&&this.O?this.O(n):t&&!n&&this.g&&this.g(t),this.c&&(this.c.cancel(),this.c=null),delete this.g,delete this.O)},n.Fa=function(e,t){return"signInViaRedirect"==e||"signInViaPopup"==e&&this.h==t&&this.g?w(this.hc,this):null},n.hc=function(e,t,n,r){var i=this,a={requestUri:e,postBody:r,sessionId:t,tenantId:n};return this.c&&(this.c.cancel(),this.c=null),i.$.then((function(){return gd(i,ks(i.a,a))}))},n.Wc=function(e){if(!Ar())return Dt(new P("operation-not-supported-in-this-environment"));var n=this,r=Qi(e.providerId),i=jr(),a=null;(!Mr()||_r())&&vd(this).options.authDomain&&e.isOAuthProvider&&(a=bu(vd(this).options.authDomain,vd(this).options.apiKey,vd(this).name,"signInViaPopup",e,null,i,t.a.SDK_VERSION||null,null,null,this.S(),this.f));var o=pr(a,r&&r.ua,r&&r.ta);return bd(this,r=dd(this).then((function(t){return Ul(t,o,"signInViaPopup",e,i,!!a,n.S())})).then((function(){return new _t((function(e,t){n.ma("signInViaPopup",null,new P("cancelled-popup-request"),n.h),n.g=e,n.O=t,n.h=i,n.c=Hl(n.b,n,"signInViaPopup",o,i)}))})).then((function(e){return o&&fr(o),e?Jr(e):null})).s((function(e){throw o&&fr(o),e})))},n.Xc=function(e){if(!Ar())return Dt(new P("operation-not-supported-in-this-environment"));var t=this;return bd(this,dd(this).then((function(){return function(e){return od(e,(function(){return e.b.set(td,e.c.D,e.a)}))}(t.l)})).then((function(){return Vl(t.b,"signInViaRedirect",e,void 0,t.S())})))},n.qa=function(){var e=this;return hd(this).then((function(t){return e.b&&Yl(e.b.b),t})).s((function(t){throw e.b&&Yl(e.b.b),t}))},n.cd=function(e){if(!e)return Dt(new P("null-user"));if(this.W!=e.tenantId)return Dt(new P("tenant-id-mismatch"));var t=this,n={};n.apiKey=vd(this).options.apiKey,n.authDomain=vd(this).options.authDomain,n.appName=vd(this).name;var r=function(e,t,n,r){var i=e.b,a={};return a[es]=i.b&&i.b.toString(),a.refreshToken=i.a,t=new wc(t||{apiKey:e.l,authDomain:e.o,appName:e.m},a),n&&(t.ha=n),r&&Ec(t,r),Uc(t,e),t}(e,n,t.G,t.Ga());return bd(this,this.i.then((function(){if(vd(t).options.apiKey!=e.l)return r.reload()})).then((function(){return md(t)&&e.uid==md(t).uid?(Uc(md(t),e),t.da(e)):(pd(t,r),Ac(r),t.da(r))})).then((function(){_d(t)})))},n.zb=function(){var e=this;return bd(this,this.i.then((function(){return e.b&&Yl(e.b.b),md(e)?(pd(e,null),id(e.l).then((function(){_d(e)}))):It()})))},n.Yc=function(){var e=this;return ad(this.l,vd(this).options.authDomain).then((function(t){if(!e.m){var n;if(n=md(e)&&t){n=md(e).uid;var r=t.uid;n=void 0!==n&&null!==n&&""!==n&&void 0!==r&&null!==r&&""!==r&&n==r}if(n)return Uc(md(e),t),md(e).I();(md(e)||t)&&(pd(e,t),t&&(Ac(t),t.ha=e.G),e.b&&Rl(e.b,e),_d(e))}}))},n.da=function(e){return rd(this.l,e)},n.kc=function(){_d(this),this.da(md(this))},n.vc=function(){this.zb()},n.wc=function(){this.zb()},n.jc=function(e){var t=this;return this.i.then((function(){return gd(t,It(e))}))},n.yc=function(e){var t=this;this.addAuthTokenListener((function(){e.next(md(t))}))},n.zc=function(e){var t=this;!function(e,t){e.P.push(t),bd(e,e.i.then((function(){!e.m&&K(e.P,t)&&e.X!==e.getUid()&&(e.X=e.getUid(),t(yd(e)))})))}(this,(function(){e.next(md(t))}))},n.Hc=function(e,t,n){var r=this;return this.ba&&Promise.resolve().then((function(){"function"===typeof e?e(md(r)):"function"===typeof e.next&&e.next(md(r))})),this.ac(e,t,n)},n.Gc=function(e,t,n){var r=this;return this.ba&&Promise.resolve().then((function(){r.X=r.getUid(),"function"===typeof e?e(md(r)):"function"===typeof e.next&&e.next(md(r))})),this.bc(e,t,n)},n.mc=function(e){var t=this;return bd(this,this.i.then((function(){return md(t)?md(t).I(e).then((function(e){return{accessToken:e}})):null})))},n.Sc=function(e){var t=this;return this.i.then((function(){return gd(t,au(t.a,Zs,{token:e}))})).then((function(e){var n=e.user;return jc(n,"isAnonymous",!1),t.da(n),e}))},n.Tc=function(e,t){var n=this;return this.i.then((function(){return gd(n,au(n.a,eu,{email:e,password:t}))}))},n.dc=function(e,t){var n=this;return this.i.then((function(){return gd(n,au(n.a,Ts,{email:e,password:t}))}))},n.Za=function(e){var t=this;return this.i.then((function(){return gd(t,e.ja(t.a))}))},n.Rc=function(e){return Yr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Za(e)},n.yb=function(){var e=this;return this.i.then((function(){var t=md(e);if(t&&t.isAnonymous){var n=Jr({providerId:null,isNewUser:!1});return Jr({user:t,credential:null,additionalUserInfo:n,operationType:"signIn"})}return gd(e,e.a.yb()).then((function(t){var n=t.user;return jc(n,"isAnonymous",!0),e.da(n),t}))}))},n.getUid=function(){return md(this)&&md(this).uid||null},n.cc=function(e){this.addAuthTokenListener(e),this.A++,0<this.A&&md(this)&&Dc(md(this))},n.Oc=function(e){var t=this;W(this.u,(function(n){n==e&&t.A--})),0>this.A&&(this.A=0),0==this.A&&md(this)&&Tc(md(this)),this.removeAuthTokenListener(e)},n.addAuthTokenListener=function(e){var t=this;this.u.push(e),bd(this,this.i.then((function(){t.m||K(t.u,e)&&e(yd(t))})))},n.removeAuthTokenListener=function(e){Q(this.u,(function(t){return t==e}))},n.delete=function(){this.m=!0;for(var e=0;e<this.R.length;e++)this.R[e].cancel("app-deleted");return this.R=[],this.l&&(e=this.l).b.removeListener(nd("local"),e.a,this.pa),this.b&&(Fl(this.b,this),Yl(this.b.b)),Promise.resolve()},n.gc=function(e){return bd(this,function(e,t){return au(e,xs,{identifier:t,continueUri:Lr()?lr():"http://localhost"}).then((function(e){return e.signinMethods||[]}))}(this.a,e))},n.Ac=function(e){return!!La(e)},n.vb=function(e,t){var n=this;return bd(this,It().then((function(){var e=new Ci(t);if(!e.c)throw new P("argument-error",Oi+" must be true when sending sign in link to email");return Bi(e)})).then((function(t){return n.a.vb(e,t)})).then((function(){})))},n.hd=function(e){return this.Qa(e).then((function(e){return e.data.email}))},n.mb=function(e,t){return bd(this,this.a.mb(e,t).then((function(){})))},n.Qa=function(e){return bd(this,this.a.Qa(e).then((function(e){return new si(e)})))},n.ib=function(e){return bd(this,this.a.ib(e).then((function(){})))},n.ub=function(e,t){var n=this;return bd(this,It().then((function(){return"undefined"===typeof t||fe(t)?{}:Bi(new Ci(t))})).then((function(t){return n.a.ub(e,t)})).then((function(){})))},n.Vc=function(e,t){return bd(this,ec(this,e,t,w(this.Za,this)))},n.Uc=function(e,t){var n=this;return bd(this,It().then((function(){var r=t||lr(),i=Aa(e,r);if(!(r=La(r)))throw new P("argument-error","Invalid email link!");if(r.tenantId!==n.S())throw new P("tenant-id-mismatch");return n.Za(i)})))},wd.prototype.render=function(){},wd.prototype.reset=function(){},wd.prototype.getResponse=function(){},wd.prototype.execute=function(){};var Sd=null;function Ed(e,t){return(t=Pd(t))&&e.a[t]||null}function Pd(e){return(e="undefined"===typeof e?1e12:e)?e.toString():null}function Id(e,t){this.g=!1,this.c=t,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=at(e);var n=this;this.i=function(){n.execute()},this.h?this.execute():un(this.f,"click",this.i)}function Dd(e){if(e.g)throw Error("reCAPTCHA mock was already deleted!")}function Td(){}function xd(){}kd.prototype.render=function(e,t){return this.a[this.b.toString()]=new Id(e,t),this.b++},kd.prototype.reset=function(e){var t=Ed(this,e);e=Pd(e),t&&e&&(t.delete(),delete this.a[e])},kd.prototype.getResponse=function(e){return(e=Ed(this,e))?e.getResponse():null},kd.prototype.execute=function(e){(e=Ed(this,e))&&e.execute()},Id.prototype.getResponse=function(){return Dd(this),this.b},Id.prototype.execute=function(){Dd(this);var e=this;this.a||(this.a=setTimeout((function(){e.b=function(){for(var e=50,t=[];0<e;)t.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),e--;return t.join("")}();var t=e.c.callback,n=e.c["expired-callback"];if(t)try{t(e.b)}catch(r){}e.a=setTimeout((function(){if(e.a=null,e.b=null,n)try{n()}catch(r){}e.h&&e.execute()}),6e4)}),500))},Id.prototype.delete=function(){Dd(this),this.g=!0,clearTimeout(this.a),this.a=null,dn(this.f,"click",this.i)},Xr(Td,"FACTOR_ID","phone"),xd.prototype.g=function(){return Sd||(Sd=new kd),It(Sd)},xd.prototype.c=function(){};var Cd=null;function Ad(){this.b=u.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Ld=new ye(we,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Od=new Vr(3e4,6e4);Ad.prototype.g=function(e){var t=this;return new _t((function(n,r){var i=setTimeout((function(){r(new P("network-request-failed"))}),Od.get());!u.grecaptcha||e!==t.f&&!t.b?(u[t.a]=function(){if(u.grecaptcha){t.f=e;var a=u.grecaptcha.render;u.grecaptcha.render=function(e,n){return e=a(e,n),t.b++,e},clearTimeout(i),n(u.grecaptcha)}else clearTimeout(i),r(new P("internal-error"));delete u[t.a]},It(zo(Pe(Ld,{onload:t.a,hl:e||""}))).s((function(){clearTimeout(i),r(new P("internal-error","Unable to load external reCAPTCHA dependencies!"))}))):(clearTimeout(i),n(u.grecaptcha))}))},Ad.prototype.c=function(){this.b--};var Md=null;function Rd(e,t,n,r,i,a,o){if(Xr(this,"type","recaptcha"),this.c=this.f=null,this.A=!1,this.m=t,this.g=null,o?(Cd||(Cd=new xd),o=Cd):(Md||(Md=new Ad),o=Md),this.v=o,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[jd])throw new P("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Ud],!u.document)throw new P("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!at(t)||!this.i&&at(t).hasChildNodes())throw new P("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Jo(e,a||null,i||null),this.u=r||function(){return null};var s=this;this.l=[];var l=this.a[Fd];this.a[Fd]=function(e){if(Bd(s,e),"function"===typeof l)l(e);else if("string"===typeof l){var t=xr(l,u);"function"===typeof t&&t(e)}};var c=this.a[Nd];this.a[Nd]=function(){if(Bd(s,null),"function"===typeof c)c();else if("string"===typeof c){var e=xr(c,u);"function"===typeof e&&e()}}}var Fd="callback",Nd="expired-callback",jd="sitekey",Ud="size";function Bd(e,t){for(var n=0;n<e.l.length;n++)try{e.l[n](t)}catch(r){}}function Vd(e,t){return e.h.push(t),t.na((function(){Y(e.h,t)})),t}function Hd(e){if(e.A)throw new P("internal-error","RecaptchaVerifier instance has been destroyed.")}function Wd(e,n,r){var i=!1;try{this.b=r||t.a.app()}catch(s){throw new P("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new P("invalid-api-key");r=this.b.options.apiKey;var a=this,o=null;try{o=this.b.auth().Ga()}catch(s){}try{i=this.b.auth().settings.appVerificationDisabledForTesting}catch(s){}o=t.a.SDK_VERSION?Dr(t.a.SDK_VERSION,o):null,Rd.call(this,r,e,n,(function(){try{var e=a.b.auth().ka()}catch(t){e=null}return e}),o,A(D),i)}function qd(e,t,n,r){e:{n=Array.prototype.slice.call(n);for(var i=0,a=!1,o=0;o<t.length;o++)if(t[o].optional)a=!0;else{if(a)throw new P("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(a=t.length,n.length<i||a<n.length)r="Expected "+(i==a?1==i?"1 argument":i+" arguments":i+"-"+a+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(a=t[i].optional&&void 0===n[i],!t[i].K(n[i])&&!a){if(t=t[i],0>i||i>=zd.length)throw new P("internal-error","Argument validator received an unsupported number of arguments.");n=zd[i],r=(r?"":n+" argument ")+(t.name?'"'+t.name+'" ':"")+"must be "+t.J+".";break e}r=null}}if(r)throw new P("argument-error",e+" failed: "+r)}(n=Rd.prototype).Ia=function(){var e=this;return this.f?this.f:this.f=Vd(this,It().then((function(){if(Lr()&&!br())return mr();throw new P("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")})).then((function(){return e.v.g(e.u())})).then((function(t){return e.g=t,au(e.o,Hs,{})})).then((function(t){e.a[jd]=t.recaptchaSiteKey})).s((function(t){throw e.f=null,t})))},n.render=function(){Hd(this);var e=this;return Vd(this,this.Ia().then((function(){if(null===e.c){var t=e.m;if(!e.i){var n=at(t);t=function(e,t,n){var r=arguments,i=document,a=String(r[0]),o=r[1];if(!it&&o&&(o.name||o.type)){if(a=["<",a],o.name&&a.push(' name="',He(o.name),'"'),o.type){a.push(' type="',He(o.type),'"');var s={};ve(s,o),delete s.type,o=s}a.push(">"),a=a.join("")}return a=dt(i,a),o&&("string"===typeof o?a.className=o:Array.isArray(o)?a.className=o.join(" "):ot(a,o)),2<r.length&&ct(i,a,r),a}("DIV"),n.appendChild(t)}e.c=e.g.render(t,e.a)}return e.c})))},n.verify=function(){Hd(this);var e=this;return Vd(this,this.render().then((function(t){return new _t((function(n){var r=e.g.getResponse(t);if(r)n(r);else{var i=function(t){t&&(function(e,t){Q(e.l,(function(e){return e==t}))}(e,i),n(t))};e.l.push(i),e.i&&e.g.execute(e.c)}}))})))},n.reset=function(){Hd(this),null!==this.c&&this.g.reset(this.c)},n.clear=function(){Hd(this),this.A=!0,this.v.c();for(var e=0;e<this.h.length;e++)this.h[e].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){e=at(this.m);for(var t;t=e.firstChild;)e.removeChild(t)}},E(Wd,Rd);var zd="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Gd(e,t){return{name:e||"",J:"a valid string",optional:!!t,K:function(e){return"string"===typeof e}}}function Kd(e,t){return{name:e||"",J:"a boolean",optional:!!t,K:function(e){return"boolean"===typeof e}}}function Yd(e,t){return{name:e||"",J:"a valid object",optional:!!t,K:g}}function Qd(e,t){return{name:e||"",J:"a function",optional:!!t,K:function(e){return"function"===typeof e}}}function Xd(e,t){return{name:e||"",J:"null",optional:!!t,K:function(e){return null===e}}}function $d(e){return{name:e?e+"Credential":"credential",J:e?"a valid "+e+" credential":"a valid credential",optional:!1,K:function(t){if(!t)return!1;var n=!e||t.providerId===e;return!(!t.ja||!n)}}}function Jd(e,t){return g(e)&&"string"===typeof e.type&&e.type===t&&"function"===typeof e.Ha}function Zd(e){return g(e)&&"string"===typeof e.uid}function eh(e,t,n,r){return{name:n||"",J:e.J+" or "+t.J,optional:!!r,K:function(n){return e.K(n)||t.K(n)}}}function th(e,t){for(var n in t){var r=t[n].name;e[r]=ih(r,e[n],t[n].j)}}function nh(e,t){for(var n in t){var r=t[n].name;r!==n&&Object.defineProperty(e,r,{get:k((function(e){return this[e]}),n),set:k((function(e,t,n,r){qd(e,[n],[r],!0),this[t]=r}),r,n,t[n].jb),enumerable:!0})}}function rh(e,t,n,r){e[t]=ih(t,n,r)}function ih(e,t,n){function r(){var e=Array.prototype.slice.call(arguments);return qd(a,n,e),t.apply(this,e)}if(!n)return t;var i,a=function(e){return(e=e.split("."))[e.length-1]}(e);for(i in t)r[i]=t[i];for(i in t.prototype)r.prototype[i]=t.prototype[i];return r}th(sd.prototype,{ib:{name:"applyActionCode",j:[Gd("code")]},Qa:{name:"checkActionCode",j:[Gd("code")]},mb:{name:"confirmPasswordReset",j:[Gd("code"),Gd("newPassword")]},dc:{name:"createUserWithEmailAndPassword",j:[Gd("email"),Gd("password")]},gc:{name:"fetchSignInMethodsForEmail",j:[Gd("email")]},qa:{name:"getRedirectResult",j:[]},Ac:{name:"isSignInWithEmailLink",j:[Gd("emailLink")]},Gc:{name:"onAuthStateChanged",j:[eh(Yd(),Qd(),"nextOrObserver"),Qd("opt_error",!0),Qd("opt_completed",!0)]},Hc:{name:"onIdTokenChanged",j:[eh(Yd(),Qd(),"nextOrObserver"),Qd("opt_error",!0),Qd("opt_completed",!0)]},ub:{name:"sendPasswordResetEmail",j:[Gd("email"),eh(Yd("opt_actionCodeSettings",!0),Xd(null,!0),"opt_actionCodeSettings",!0)]},vb:{name:"sendSignInLinkToEmail",j:[Gd("email"),Yd("actionCodeSettings")]},wb:{name:"setPersistence",j:[Gd("persistence")]},Rc:{name:"signInAndRetrieveDataWithCredential",j:[$d()]},yb:{name:"signInAnonymously",j:[]},Za:{name:"signInWithCredential",j:[$d()]},Sc:{name:"signInWithCustomToken",j:[Gd("token")]},Tc:{name:"signInWithEmailAndPassword",j:[Gd("email"),Gd("password")]},Uc:{name:"signInWithEmailLink",j:[Gd("email"),Gd("emailLink",!0)]},Vc:{name:"signInWithPhoneNumber",j:[Gd("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(e){return!(!e||"string"!==typeof e.type||"function"!==typeof e.verify)}}]},Wc:{name:"signInWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Xc:{name:"signInWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},cd:{name:"updateCurrentUser",j:[eh({name:"user",J:"an instance of Firebase User",optional:!1,K:function(e){return!!(e&&e instanceof wc)}},Xd(),"user")]},zb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Gd(null,!0)]},ed:{name:"useDeviceLanguage",j:[]},fd:{name:"useEmulator",j:[Gd("url")]},hd:{name:"verifyPasswordResetCode",j:[Gd("code")]}}),nh(sd.prototype,{lc:{name:"languageCode",jb:eh(Gd(),Xd(),"languageCode")},ti:{name:"tenantId",jb:eh(Gd(),Xd(),"tenantId")}}),sd.Persistence=el,sd.Persistence.LOCAL="local",sd.Persistence.SESSION="session",sd.Persistence.NONE="none",th(wc.prototype,{delete:{name:"delete",j:[]},nc:{name:"getIdTokenResult",j:[Kd("opt_forceRefresh",!0)]},I:{name:"getIdToken",j:[Kd("opt_forceRefresh",!0)]},Bc:{name:"linkAndRetrieveDataWithCredential",j:[$d()]},pb:{name:"linkWithCredential",j:[$d()]},Cc:{name:"linkWithPhoneNumber",j:[Gd("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(e){return!(!e||"string"!==typeof e.type||"function"!==typeof e.verify)}}]},Dc:{name:"linkWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Ec:{name:"linkWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Kc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[$d()]},sb:{name:"reauthenticateWithCredential",j:[$d()]},Lc:{name:"reauthenticateWithPhoneNumber",j:[Gd("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(e){return!(!e||"string"!==typeof e.type||"function"!==typeof e.verify)}}]},Mc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Nc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},tb:{name:"sendEmailVerification",j:[eh(Yd("opt_actionCodeSettings",!0),Xd(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Gd(null,!0)]},bd:{name:"unlink",j:[Gd("provider")]},Ab:{name:"updateEmail",j:[Gd("email")]},Bb:{name:"updatePassword",j:[Gd("password")]},dd:{name:"updatePhoneNumber",j:[$d("phone")]},Cb:{name:"updateProfile",j:[Yd("profile")]},Db:{name:"verifyBeforeUpdateEmail",j:[Gd("email"),eh(Yd("opt_actionCodeSettings",!0),Xd(null,!0),"opt_actionCodeSettings",!0)]}}),th(kd.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),th(wd.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),th(_t.prototype,{na:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),nh(Jl.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",jb:Kd("appVerificationDisabledForTesting")}}),th(Zl.prototype,{confirm:{name:"confirm",j:[Gd("verificationCode")]}}),rh(la,"fromJSON",(function(e){e="string"===typeof e?JSON.parse(e):e;for(var t,n=[va,xa,Ma,fa],r=0;r<n.length;r++)if(t=n[r](e))return t;return null}),[eh(Gd(),Yd(),"json")]),rh(Ca,"credential",(function(e,t){return new Ta(e,t)}),[Gd("email"),Gd("password")]),th(Ta.prototype,{w:{name:"toJSON",j:[Gd(null,!0)]}}),th(ba.prototype,{Ca:{name:"addScope",j:[Gd("scope")]},Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),rh(ba,"credential",wa,[eh(Gd(),Yd(),"token")]),rh(Ca,"credentialWithLink",Aa,[Gd("email"),Gd("emailLink")]),th(ka.prototype,{Ca:{name:"addScope",j:[Gd("scope")]},Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),rh(ka,"credential",Sa,[eh(Gd(),Yd(),"token")]),th(Ea.prototype,{Ca:{name:"addScope",j:[Gd("scope")]},Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),rh(Ea,"credential",Pa,[eh(Gd(),eh(Yd(),Xd()),"idToken"),eh(Gd(),Xd(),"accessToken",!0)]),th(Ia.prototype,{Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),rh(Ia,"credential",Da,[eh(Gd(),Yd(),"token"),Gd("secret",!0)]),th(_a.prototype,{Ca:{name:"addScope",j:[Gd("scope")]},credential:{name:"credential",j:[eh(Gd(),eh(Yd(),Xd()),"optionsOrIdToken"),eh(Gd(),Xd(),"accessToken",!0)]},Ka:{name:"setCustomParameters",j:[Yd("customOAuthParameters")]}}),th(pa.prototype,{w:{name:"toJSON",j:[Gd(null,!0)]}}),th(da.prototype,{w:{name:"toJSON",j:[Gd(null,!0)]}}),rh(Fa,"credential",Na,[Gd("verificationId"),Gd("verificationCode")]),th(Fa.prototype,{eb:{name:"verifyPhoneNumber",j:[eh(Gd(),{name:"phoneInfoOptions",J:"valid phone info options",optional:!1,K:function(e){return!!e&&(e.session&&e.phoneNumber?Jd(e.session,sa)&&"string"===typeof e.phoneNumber:e.session&&e.multiFactorHint?Jd(e.session,ua)&&Zd(e.multiFactorHint):e.session&&e.multiFactorUid?Jd(e.session,ua)&&"string"===typeof e.multiFactorUid:!!e.phoneNumber&&"string"===typeof e.phoneNumber)}},"phoneInfoOptions"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(e){return!(!e||"string"!==typeof e.type||"function"!==typeof e.verify)}}]}}),th(Oa.prototype,{w:{name:"toJSON",j:[Gd(null,!0)]}}),th(P.prototype,{toJSON:{name:"toJSON",j:[Gd(null,!0)]}}),th(Ga.prototype,{toJSON:{name:"toJSON",j:[Gd(null,!0)]}}),th(za.prototype,{toJSON:{name:"toJSON",j:[Gd(null,!0)]}}),th(ac.prototype,{toJSON:{name:"toJSON",j:[Gd(null,!0)]}}),th(nc.prototype,{Qc:{name:"resolveSignIn",j:[{name:"multiFactorAssertion",J:"a valid multiFactorAssertion",optional:!1,K:function(e){return!!e&&!!e.rb}}]}}),th(dc.prototype,{Qb:{name:"getSession",j:[]},ec:{name:"enroll",j:[{name:"multiFactorAssertion",J:"a valid multiFactorAssertion",optional:!1,K:function(e){return!!e&&!!e.rb}},Gd("displayName",!0)]},ad:{name:"unenroll",j:[eh({name:"multiFactorInfo",J:"a valid multiFactorInfo",optional:!1,K:Zd},Gd(),"multiFactorInfoIdentifier")]}}),th(Wd.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),rh(wi,"parseLink",xi,[Gd("link")]),rh(Td,"assertion",(function(e){return new lc(e)}),[$d("phone")]),function(){if("undefined"===typeof t.a||!t.a.INTERNAL||!t.a.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var e={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:li,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:ui,VERIFY_AND_CHANGE_EMAIL:ci,VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:sd,AuthCredential:la,Error:P};rh(e,"EmailAuthProvider",Ca,[]),rh(e,"FacebookAuthProvider",ba,[]),rh(e,"GithubAuthProvider",ka,[]),rh(e,"GoogleAuthProvider",Ea,[]),rh(e,"TwitterAuthProvider",Ia,[]),rh(e,"OAuthProvider",_a,[Gd("providerId")]),rh(e,"SAMLAuthProvider",ya,[Gd("providerId")]),rh(e,"PhoneAuthProvider",Fa,[{name:"auth",J:"an instance of Firebase Auth",optional:!0,K:function(e){return!!(e&&e instanceof sd)}}]),rh(e,"RecaptchaVerifier",Wd,[eh(Gd(),{name:"",J:"an HTML element",optional:!1,K:function(e){return!!(e&&e instanceof Element)}},"recaptchaContainer"),Yd("recaptchaParameters",!0),{name:"app",J:"an instance of Firebase App",optional:!0,K:function(e){return!!(e&&e instanceof t.a.app.App)}}]),rh(e,"ActionCodeURL",wi,[]),rh(e,"PhoneMultiFactorGenerator",Td,[]),t.a.INTERNAL.registerComponent({name:"auth",instanceFactory:function(e){return new sd(e=e.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:e,instantiationMode:"LAZY",type:"PUBLIC"}),t.a.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(e){return{getUid:w((e=e.getProvider("auth").getImmediate()).getUid,e),getToken:w(e.mc,e),addAuthTokenListener:w(e.cc,e),removeAuthTokenListener:w(e.Oc,e)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),t.a.registerVersion("@firebase/auth","0.15.1"),t.a.INTERNAL.extendNamespace({User:wc})}()}).apply("undefined"!==typeof e?e:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})}).call(this,n(89))},function(e,t,n){var r=n(31),i=n(57);t.mergeOptions=function(e){var t={},n={parsers:[],refiners:[]};return e.forEach((function(e){e.call&&(e=e.call()),e.parsers&&e.parsers.forEach((function(e){t[e.constructor]||(n.parsers.push(e),t[e.constructor]=!0)})),e.refiners&&e.refiners.forEach((function(e){t[e.constructor]||(n.refiners.push(e),t[e.constructor]=!0)}))})),n},t.commonPostProcessing=function(){return{refiners:[new i.ExtractTimezoneOffsetRefiner,new i.ExtractTimezoneAbbrRefiner,new i.UnlikelyFormatFilter]}},t.strictOption=function(){var e={strict:!0};return t.mergeOptions([t.en(e),t.de(e),t.pt(e),t.es(e),t.fr(e),t.ja(e),t.zh,t.commonPostProcessing])},t.casualOption=function(){return t.mergeOptions([t.en.casual,t.de({strict:!0}),t.pt.casual,t.es.casual,t.fr.casual,t.ja.casual,t.zh,t.commonPostProcessing])},t.de=function(e){return{parsers:[new r.DEDeadlineFormatParser(e),new r.DEMonthNameLittleEndianParser(e),new r.DEMonthNameParser(e),new r.DESlashDateFormatParser(e),new r.DETimeAgoFormatParser(e),new r.DETimeExpressionParser(e)],refiners:[new i.OverlapRemovalRefiner,new i.ForwardDateRefiner,new i.DEMergeDateTimeRefiner,new i.DEMergeDateRangeRefiner]}},t.de.casual=function(){var e=t.de({strict:!1});return e.parsers.unshift(new r.DECasualDateParser),e.parsers.unshift(new r.DEWeekdayParser),e},t.en=function(e){return{parsers:[new r.ENISOFormatParser(e),new r.ENDeadlineFormatParser(e),new r.ENMonthNameLittleEndianParser(e),new r.ENMonthNameMiddleEndianParser(e),new r.ENMonthNameParser(e),new r.ENSlashDateFormatParser(e),new r.ENSlashDateFormatStartWithYearParser(e),new r.ENSlashMonthFormatParser(e),new r.ENTimeAgoFormatParser(e),new r.ENTimeLaterFormatParser(e),new r.ENTimeExpressionParser(e)],refiners:[new i.OverlapRemovalRefiner,new i.ForwardDateRefiner,new i.ENMergeDateTimeRefiner,new i.ENMergeDateRangeRefiner,new i.ENPrioritizeSpecificDateRefiner]}},t.en.casual=function(e){(e=e||{}).strict=!1;var n=t.en(e);return n.parsers.unshift(new r.ENCasualDateParser),n.parsers.unshift(new r.ENCasualTimeParser),n.parsers.unshift(new r.ENWeekdayParser),n.parsers.unshift(new r.ENRelativeDateFormatParser),n},t.en_GB=function(e){return(e=e||{}).littleEndian=!0,t.en(e)},t.en_GB.casual=function(e){return(e=e||{}).littleEndian=!0,t.en.casual(e)},t.ja=function(){return{parsers:[new r.JPStandardParser],refiners:[new i.OverlapRemovalRefiner,new i.ForwardDateRefiner,new i.JPMergeDateRangeRefiner]}},t.ja.casual=function(){var e=t.ja();return e.parsers.unshift(new r.JPCasualDateParser),e},t.pt=function(e){return{parsers:[new r.PTTimeAgoFormatParser(e),new r.PTDeadlineFormatParser(e),new r.PTTimeExpressionParser(e),new r.PTMonthNameLittleEndianParser(e),new r.PTSlashDateFormatParser(e)],refiners:[new i.OverlapRemovalRefiner,new i.ForwardDateRefiner]}},t.pt.casual=function(){var e=t.pt({strict:!1});return e.parsers.unshift(new r.PTCasualDateParser),e.parsers.unshift(new r.PTWeekdayParser),e},t.es=function(e){return{parsers:[new r.ESTimeAgoFormatParser(e),new r.ESDeadlineFormatParser(e),new r.ESTimeExpressionParser(e),new r.ESMonthNameLittleEndianParser(e),new r.ESSlashDateFormatParser(e)],refiners:[new i.OverlapRemovalRefiner,new i.ForwardDateRefiner]}},t.es.casual=function(){var e=t.es({strict:!1});return e.parsers.unshift(new r.ESCasualDateParser),e.parsers.unshift(new r.ESWeekdayParser),e},t.fr=function(e){return{parsers:[new r.FRDeadlineFormatParser(e),new r.FRMonthNameLittleEndianParser(e),new r.FRSlashDateFormatParser(e),new r.FRTimeAgoFormatParser(e),new r.FRTimeExpressionParser(e)],refiners:[new i.OverlapRemovalRefiner,new i.ForwardDateRefiner,new i.FRMergeDateRangeRefiner,new i.FRMergeDateTimeRefiner]}},t.fr.casual=function(){var e=t.fr({strict:!1});return e.parsers.unshift(new r.FRCasualDateParser),e.parsers.unshift(new r.FRWeekdayParser),e.parsers.unshift(new r.FRRelativeDateFormatParser),e},t.zh=function(){return{parsers:[new r.ZHHantDateParser,new r.ZHHantWeekdayParser,new r.ZHHantTimeExpressionParser,new r.ZHHantCasualDateParser,new r.ZHHantDeadlineFormatParser],refiners:[new i.OverlapRemovalRefiner,new i.ForwardDateRefiner]}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=new RegExp("(\\W|^)([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})(?:T([0-9]{1,2}):([0-9]{1,2})(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?(?:Z|([+-]\\d{2}):?(\\d{2})?)?)?(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){e=n[0].substr(n[1].length);var o=n.index+n[1].length,s=new a({text:e,index:o,ref:t});if(s.start.assign("year",parseInt(n[2])),s.start.assign("month",parseInt(n[3])),s.start.assign("day",parseInt(n[4])),r(s.start.get("month"))>12||r(s.start.get("month"))<1||r(s.start.get("day"))>31||r(s.start.get("day"))<1)return null;if(null!=n[5])if(s.start.assign("hour",parseInt(n[5])),s.start.assign("minute",parseInt(n[6])),null!=n[7]&&s.start.assign("second",parseInt(n[7])),null!=n[8]&&s.start.assign("millisecond",parseInt(n[8])),null==n[9])s.start.assign("timezoneOffset",0);else{var u=0,l=parseInt(n[9]);null!=n[10]&&(u=parseInt(n[10]));var c=60*l;c<0?c-=u:c+=u,s.start.assign("timezoneOffset",c)}return s.tags.ENISOFormatParser=!0,s}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(74),s=new RegExp("(\\W|^)(within|in)\\s*("+o.INTEGER_WORDS_PATTERN+"|[0-9]+|an?(?:\\s*few)?|half(?:\\s*an?)?)\\s*(seconds?|min(?:ute)?s?|hours?|days?|weeks?|months?|years?)\\s*(?=\\W|$)","i"),u=new RegExp("(\\W|^)(within|in)\\s*("+o.INTEGER_WORDS_PATTERN+"|[0-9]+|an?)\\s*(seconds?|minutes?|hours?|days?)\\s*(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return this.isStrictMode()?u:s},this.extract=function(e,t,n,i){var s=n.index+n[1].length;n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length);var u=new a({index:s,text:e,ref:t}),l=n[3].toLowerCase();l=void 0!==o.INTEGER_WORDS[l]?o.INTEGER_WORDS[l]:"a"===l||"an"===l?1:l.match(/few/i)?3:l.match(/half/i)?.5:parseInt(l);var c=r(t);return n[4].match(/day|week|month|year/i)?(n[4].match(/day/i)?c=c.add(l,"d"):n[4].match(/week/i)?c=c.add(7*l,"d"):n[4].match(/month/i)?c=c.add(l,"month"):n[4].match(/year/i)&&(c=c.add(l,"year")),u.start.imply("year",c.year()),u.start.imply("month",c.month()+1),u.start.imply("day",c.date()),u):(n[4].match(/hour/i)?c=c.add(l,"hour"):n[4].match(/min/i)?c=c.add(l,"minute"):n[4].match(/second/i)&&(c=c.add(l,"second")),u.start.imply("year",c.year()),u.start.imply("month",c.month()+1),u.start.imply("day",c.date()),u.start.imply("hour",c.hour()),u.start.imply("minute",c.minute()),u.start.imply("second",c.second()),u.tags.ENDeadlineFormatParser=!0,u)}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(74),s=new RegExp("(\\W|^)(this|next|last|past)\\s*("+o.INTEGER_WORDS_PATTERN+"|[0-9]+|few|half(?:\\s*an?)?)?\\s*(seconds?|min(?:ute)?s?|hours?|days?|weeks?|months?|years?)(?=\\s*)(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){var s=n.index+n[1].length,u=n[2].toLowerCase().match(/^next/)?1:-1;n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length);var l=new a({index:s,text:e,ref:t});l.tags.ENRelativeDateFormatParser=!0;var c=void 0===n[3]?"":n[3].toLowerCase();c=void 0!==o.INTEGER_WORDS[c]?o.INTEGER_WORDS[c]:""===c?1:c.match(/few/i)?3:c.match(/half/i)?.5:parseInt(c),c*=u;var d=r(t);if(n[2].toLowerCase().match(/^this/)){if(n[3])return null;if(n[4].match(/day|week|month|year/i))return n[4].match(/week/i)?(d=d.add(-d.get("d"),"d"),l.start.imply("day",d.date()),l.start.imply("month",d.month()+1),l.start.imply("year",d.year())):n[4].match(/month/i)?(d=d.add(1-d.date(),"d"),l.start.imply("day",d.date()),l.start.assign("year",d.year()),l.start.assign("month",d.month()+1)):n[4].match(/year/i)&&(d=(d=d.add(1-d.date(),"d")).add(-d.month(),"month"),l.start.imply("day",d.date()),l.start.imply("month",d.month()+1),l.start.assign("year",d.year())),l}return n[4].match(/day|week|month|year/i)?(n[4].match(/day/i)?(d=d.add(c,"d"),l.start.assign("year",d.year()),l.start.assign("month",d.month()+1),l.start.assign("day",d.date())):n[4].match(/week/i)?(d=d.add(7*c,"d"),l.start.imply("day",d.date()),l.start.imply("month",d.month()+1),l.start.imply("year",d.year())):n[4].match(/month/i)?(d=d.add(c,"month"),l.start.imply("day",d.date()),l.start.assign("year",d.year()),l.start.assign("month",d.month()+1)):n[4].match(/year/i)&&(d=d.add(c,"year"),l.start.imply("day",d.date()),l.start.imply("month",d.month()+1),l.start.assign("year",d.year())),l):(n[4].match(/hour/i)?(d=d.add(c,"hour"),l.start.imply("minute",d.minute()),l.start.imply("second",d.second())):n[4].match(/min/i)?(d=d.add(c,"minute"),l.start.assign("minute",d.minute()),l.start.imply("second",d.second())):n[4].match(/second/i)&&(d=d.add(c,"second"),l.start.assign("second",d.second()),l.start.assign("minute",d.minute())),l.start.assign("hour",d.hour()),l.start.assign("year",d.year()),l.start.assign("month",d.month()+1),l.start.assign("day",d.date()),l)}}},function(e,t,n){const r=n(31);var i=n(24).ParsedResult,a=n(74),o=new RegExp("(\\W|^)(?:on\\s*?)?(?:(Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sun|Mon|Tue|Wed|Thu|Fri|Sat)\\s*,?\\s*)?(([0-9]{1,2})(?:st|nd|rd|th)?|"+a.ORDINAL_WORDS_PATTERN+")(?:\\s*(?:to|\\-|\\\u2013|until|through|till|\\s)\\s*(([0-9]{1,2})(?:st|nd|rd|th)?|"+a.ORDINAL_WORDS_PATTERN+"))?(?:-|/|\\s*(?:of)?\\s*)("+a.MONTH_PATTERN+")(?:(?:-|/|,?\\s*)((?:[1-9][0-9]{0,3}\\s*(?:BE|AD|BC)|[1-2][0-9]{3})(?![^\\s]\\d)))?(?=\\W|$)","i");t.Parser=function(){r.Parser.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,o){var s=new i({text:n[0].substr(n[1].length,n[0].length-n[1].length),index:n.index+n[1].length,ref:t}),u=n[7];u=a.MONTH_OFFSET[u.toLowerCase()];var l=n[4]?parseInt(n[4]):a.ORDINAL_WORDS[n[3].trim().replace("-"," ").toLowerCase()],c=null;if(n[8]&&(c=n[8],/BE/i.test(c)?(c=c.replace(/BE/i,""),c=parseInt(c)-543):/BC/i.test(c)?(c=c.replace(/BC/i,""),c=-parseInt(c)):/AD/i.test(c)?(c=c.replace(/AD/i,""),c=parseInt(c)):(c=parseInt(c))<100&&(c+=2e3)),c?(s.start.assign("day",l),s.start.assign("month",u),s.start.assign("year",c)):(c=r.findYearClosestToRef(t,l,u),s.start.assign("day",l),s.start.assign("month",u),s.start.imply("year",c)),n[2]){var d=n[2];d=a.WEEKDAY_OFFSET[d.toLowerCase()],s.start.assign("weekday",d)}if(n[5]){var h=n[6]?parseInt(n[6]):a.ORDINAL_WORDS[n[5].trim().replace("-"," ").toLowerCase()];s.end=s.start.clone(),s.end.assign("day",h)}return s.tags.ENMonthNameLittleEndianParser=!0,s}}},function(e,t,n){var r=n(31),i=n(24).ParsedResult,a=n(74),o=new RegExp("(\\W|^)(?:(?:on\\s*?)?(Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sun\\.?|Mon\\.?|Tue\\.?|Wed\\.?|Thu\\.?|Fri\\.?|Sat\\.?)\\s*,?\\s*)?("+a.MONTH_PATTERN+")(?:-|/|\\s*,?\\s*)(([0-9]{1,2})(?:st|nd|rd|th)?|"+a.ORDINAL_WORDS_PATTERN+")(?!\\s*(?:am|pm))\\s*(?:(?:to|\\-)\\s*(([0-9]{1,2})(?:st|nd|rd|th)?| "+a.ORDINAL_WORDS_PATTERN+")\\s*)?(?:(?:-|/|\\s*,?\\s*)(?:([0-9]{4})\\s*(BE|AD|BC)?|([0-9]{1,4})\\s*(AD|BC))\\s*)?(?=\\W|$)(?!\\:\\d)","i");t.Parser=function(){r.Parser.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,o){var s=new i({text:n[0].substr(n[1].length,n[0].length-n[1].length),index:n.index+n[1].length,ref:t}),u=n[3];u=a.MONTH_OFFSET[u.toLowerCase()];var l=n[5]?parseInt(n[5]):a.ORDINAL_WORDS[n[4].trim().replace("-"," ").toLowerCase()],c=null;if(n[8]||n[10]){c=n[8]||n[10],c=parseInt(c);var d=n[9]||n[11];d?/BE/i.test(d)?c-=543:/BC/i.test(d)&&(c=-c):c<100&&(c+=2e3)}if(c?(s.start.assign("day",l),s.start.assign("month",u),s.start.assign("year",c)):(c=r.findYearClosestToRef(t,l,u),s.start.assign("day",l),s.start.assign("month",u),s.start.imply("year",c)),n[2]){var h=n[2];h=a.WEEKDAY_OFFSET[h.toLowerCase()],s.start.assign("weekday",h)}if(n[6]){var f=n[7]?f=parseInt(n[7]):a.ORDINAL_WORDS[n[6].replace("-"," ").trim().toLowerCase()];s.end=s.start.clone(),s.end.assign("day",f)}return s.tags.ENMonthNameMiddleEndianParser=!0,s}}},function(e,t,n){var r=n(31),i=n(24).ParsedResult,a=n(74),o=new RegExp("(^|\\D\\s+|[^\\w\\s])("+a.MONTH_PATTERN+")\\s*(?:[,-]?\\s*([0-9]{4})(\\s*BE|AD|BC)?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)","i");t.Parser=function(){r.Parser.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,o){var s=new i({text:n[0].substr(n[1].length,n[0].length-n[1].length),index:n.index+n[1].length,ref:t}),u=n[2];u=a.MONTH_OFFSET[u.toLowerCase()];var l=null;return n[3]&&(l=n[3],l=parseInt(l),n[4]?n[4].match(/BE/)?l-=543:n[4].match(/BC/)&&(l=-l):l<100&&(l+=2e3)),l?(s.start.imply("day",1),s.start.assign("month",u),s.start.assign("year",l)):(l=r.findYearClosestToRef(t,1,u),s.start.imply("day",1),s.start.assign("month",u),s.start.imply("year",l)),s.tags.ENMonthNameParser=!0,s}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=new RegExp("(\\W|^)(?:(?:on\\s*?)?((?:sun|mon|tues?|wed(?:nes)?|thu(?:rs?)?|fri|sat(?:ur)?)(?:day)?)\\s*\\,?\\s*)?([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}s*,?s*|[0-9]{2}s*,?s*))?(\\W|$)","i"),s={sunday:0,sun:0,monday:1,mon:1,tuesday:2,wednesday:3,wed:3,thursday:4,thur:4,friday:5,fri:5,saturday:6,sat:6};t.Parser=function(e){i.apply(this,arguments);var t=(e=e||{}).littleEndian,n=t?4:3,u=t?3:4;this.pattern=function(){return o},this.extract=function(e,t,i,o){if("/"!=i[1]&&"/"!=i[6]){var l=i.index+i[1].length,c=(e=i[0].substr(i[1].length,i[0].length-i[6].length),new a({text:e,index:l,ref:t}));if(!e.match(/^\d\.\d$/)&&!e.match(/^\d\.\d{1,2}\.\d{1,2}$/)&&(i[5]||!(i[0].indexOf("/")<0))){var d=i[5]||r(t).year()+"",h=i[n],f=i[u];if(h=parseInt(h),f=parseInt(f),d=parseInt(d),(h<1||h>12)&&h>12){if(!(f>=1&&f<=12&&h>=13&&h<=31))return null;var p=h;h=f,f=p}return f<1||f>31?null:(d<100&&(d+=d>50?1900:2e3),c.start.assign("day",f),c.start.assign("month",h),i[5]?c.start.assign("year",d):c.start.imply("year",d),i[2]&&c.start.assign("weekday",s[i[2].toLowerCase()]),c.tags.ENSlashDateFormatParser=!0,c)}}else i.index+=i[0].length}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(74),s=new RegExp("(\\W|^)([0-9]{4})[\\-\\.\\/]((?:"+o.MONTH_PATTERN+"|[0-9]{1,2}))[\\-\\.\\/]([0-9]{1,2})(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){e=n[0].substr(n[1].length);var s=n.index+n[1].length,u=new a({text:e,index:s,ref:t}),l=n[3].toLowerCase();return l=o.MONTH_OFFSET[l]|l,u.start.assign("year",parseInt(n[2])),u.start.assign("month",parseInt(l)),u.start.assign("day",parseInt(n[4])),r(u.start.get("month"))>12||r(u.start.get("month"))<1||r(u.start.get("day"))>31||r(u.start.get("day"))<1?null:(u.tags.ENDateFormatParser=!0,u)}}},function(e,t,n){var r=n(31).Parser,i=n(24).ParsedResult,a=new RegExp("(^|[^\\d/]\\s+|[^\\w\\s])([0-9]|0[1-9]|1[012])/([0-9]{4})([^\\d/]|$)","i");t.Parser=function(e){r.apply(this,arguments),this.pattern=function(){return a},this.extract=function(e,t,n,r){var a=n.index+n[1].length,o=(e=n[0].substr(n[1].length,n[0].length-(1+n[4].length)).trim(),new i({text:e,index:a,ref:t})),s=n[3],u=n[2];return u=parseInt(u),s=parseInt(s),o.start.imply("day",1),o.start.assign("month",u),o.start.assign("year",s),o.tags.ENSlashMonthFormatParser=!0,o}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(74),s=new RegExp("(\\W|^)(?:within\\s*)?("+o.TIME_UNIT_PATTERN+")(?:ago|before|earlier)(?=(?:\\W|$))","i"),u=new RegExp("(\\W|^)(?:within\\s*)?("+o.TIME_UNIT_STRICT_PATTERN+")ago(?=(?:\\W|$))","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return this.isStrictMode()?u:s},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;e=n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length);var s=n.index+n[1].length,u=new a({index:s,text:e,ref:t}),l=o.extractDateTimeUnitFragments(n[2]),c=r(t);for(var d in l)c=c.add(-l[d],d);return(l.hour>0||l.minute>0||l.second>0)&&(u.start.assign("hour",c.hour()),u.start.assign("minute",c.minute()),u.start.assign("second",c.second()),u.tags.ENTimeAgoFormatParser=!0),l.d>0||l.month>0||l.year>0?(u.start.assign("day",c.date()),u.start.assign("month",c.month()+1),u.start.assign("year",c.year())):(l.week>0&&u.start.imply("weekday",c.day()),u.start.imply("day",c.date()),u.start.imply("month",c.month()+1),u.start.imply("year",c.year())),u}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(24).ParsedComponents,s=new RegExp("(^|\\s|T)(?:(?:at|from)\\s*)??(\\d{1,4}|noon|midnight)(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:(?:\\:|\\\uff1a)(\\d{2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?|O\\W*CLOCK))?(?=\\W|$)","i"),u=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301c|to|\\?)\\s*(\\d{1,4})(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?|O\\W*CLOCK))?(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;var s=r(t),l=new a;l.ref=t,l.index=n.index+n[1].length,l.text=n[0].substring(n[1].length),l.tags.ENTimeExpressionParser=!0,l.start.imply("day",s.date()),l.start.imply("month",s.month()+1),l.start.imply("year",s.year());var c=0,d=0,h=-1;if(null!=n[5]){if((f=parseInt(n[5].substring(0,3)))>=1e3)return null;l.start.assign("millisecond",f)}if(null!=n[4]){if((p=parseInt(n[4]))>=60)return null;l.start.assign("second",p)}if("noon"==n[2].toLowerCase()?(h=1,c=12):"midnight"==n[2].toLowerCase()?(h=0,c=0):c=parseInt(n[2]),null!=n[3]?d=parseInt(n[3]):c>100&&(d=c%100,c=parseInt(c/100)),d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[6]){if(c>12)return null;"a"==(g=n[6][0].toLowerCase())&&(h=0,12==c&&(c=0)),"p"==g&&(h=1,12!=c&&(c+=12))}if(l.start.assign("hour",c),l.start.assign("minute",d),h>=0?l.start.assign("meridiem",h):c<12?l.start.imply("meridiem",0):l.start.imply("meridiem",1),!(n=u.exec(e.substring(l.index+l.text.length))))return l;if(n[0].match(/^\s*(\+|\-)\s*\d{3,4}$/))return l;null==l.end&&(l.end=new o(null,l.start.date()));c=0,d=0,h=-1;if(null!=n[5]){var f;if((f=parseInt(n[5].substring(0,3)))>=1e3)return null;l.end.assign("millisecond",f)}if(null!=n[4]){var p;if((p=parseInt(n[4]))>=60)return null;l.end.assign("second",p)}if(c=parseInt(n[2]),null!=n[3]){if((d=parseInt(n[3]))>=60)return l}else c>100&&(d=c%100,c=parseInt(c/100));if(d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[6]){if(c>12)return null;var g;"a"==(g=n[6][0].toLowerCase())&&(h=0,12==c&&(c=0,l.end.isCertain("day")||l.end.imply("day",l.end.get("day")+1))),"p"==g&&(h=1,12!=c&&(c+=12)),l.start.isCertain("meridiem")||(0==h?(l.start.imply("meridiem",0),12==l.start.get("hour")&&l.start.assign("hour",0)):(l.start.imply("meridiem",1),12!=l.start.get("hour")&&l.start.assign("hour",l.start.get("hour")+12)))}(l.text=l.text+n[0],l.end.assign("hour",c),l.end.assign("minute",d),h>=0)?l.end.assign("meridiem",h):l.start.isCertain("meridiem")&&1==l.start.get("meridiem")&&l.start.get("hour")>c?l.end.imply("meridiem",0):c>12&&l.end.imply("meridiem",1);return l.end.date().getTime()<l.start.date().getTime()&&l.end.imply("day",l.end.get("day")+1),l}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(74),s=new RegExp("(\\W|^)(in )?("+o.TIME_UNIT_PATTERN+")(later|after|from now|henceforth|forward|out)?(?=(?:\\W|$))","i"),u=new RegExp("(\\W|^)(in )?("+o.TIME_UNIT_STRICT_PATTERN+")(later|from now)?(?=(?:\\W|$))","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return this.isStrictMode()?u:s},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;var s=n[2],u=n[4];if(!s&&!u)return null;var l=n[1],c=(e=n[0].substr(l.length,n[0].length-l.length),n.index+l.length),d=new a({index:c,text:e,ref:t}),h=o.extractDateTimeUnitFragments(n[3]),f=r(t);for(var p in h)f=f.add(h[p],p);return(h.hour>0||h.minute>0||h.second>0)&&(d.start.assign("hour",f.hour()),d.start.assign("minute",f.minute()),d.start.assign("second",f.second()),d.tags.ENTimeAgoFormatParser=!0),h.d>0||h.month>0||h.year>0?(d.start.assign("day",f.date()),d.start.assign("month",f.month()+1),d.start.assign("year",f.year())):(h.week>0&&d.start.imply("weekday",f.day()),d.start.imply("day",f.date()),d.start.imply("month",f.month()+1),d.start.imply("year",f.year())),d}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)(now|today|tonight|last\s*night|(?:tomorrow|tmr|yesterday)\s*|tomorrow|tmr|yesterday)(?=\W|$)/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){e=n[0].substr(n[1].length);var o=n.index+n[1].length,s=new a({index:o,text:e,ref:t}),u=r(t),l=u,c=e.toLowerCase();return"tonight"==c?(s.start.imply("hour",22),s.start.imply("meridiem",1)):/^tomorrow|^tmr/.test(c)?u.hour()>1&&(l=l.add(1,"day")):/^yesterday/.test(c)?l=l.add(-1,"day"):c.match(/last\s*night/)?(s.start.imply("hour",0),u.hour()>6&&(l=l.add(-1,"day"))):c.match("now")&&(s.start.assign("hour",u.hour()),s.start.assign("minute",u.minute()),s.start.assign("second",u.second()),s.start.assign("millisecond",u.millisecond())),s.start.assign("day",l.date()),s.start.assign("month",l.month()+1),s.start.assign("year",l.year()),s.tags.ENCasualDateParser=!0,s}}},function(e,t,n){var r=n(31).Parser,i=n(24).ParsedResult,a=/(\W|^)((this)?\s*(morning|afternoon|evening|noon|night))/i,o=4;t.Parser=function(){r.apply(this,arguments),this.pattern=function(){return a},this.extract=function(e,t,n,r){e=n[0].substr(n[1].length);var a=n.index+n[1].length,s=new i({index:a,text:e,ref:t});switch(n[o]||(o=3),n[o].toLowerCase()){case"afternoon":s.start.imply("meridiem",1),s.start.imply("hour",15);break;case"evening":case"night":s.start.imply("meridiem",1),s.start.imply("hour",20);break;case"morning":s.start.imply("meridiem",0),s.start.imply("hour",6);break;case"noon":s.start.imply("meridiem",0),s.start.imply("hour",12)}return s.tags.ENCasualTimeParser=!0,s}}},function(e,t,n){const r=n(37),i=n(31),a=n(24).ParsedResult,o=n(152),s=/(?:(\u540c|\u4eca|\u672c|((\u662d\u548c|\u5e73\u6210|\u4ee4\u548c)?([0-9\uff10-\uff19]{1,4}|\u5143)))\u5e74\s*)?([0-9\uff10-\uff19]{1,2})\u6708\s*([0-9\uff10-\uff19]{1,2})\u65e5/i;t.Parser=function(){i.Parser.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,s){var u=new a({text:n[0],index:n.index,ref:t}),l=n[5];l=o.toHankaku(l),l=parseInt(l);var c=n[6];if(c=o.toHankaku(c),c=parseInt(c),u.start.assign("day",c),u.start.assign("month",l),n[2]){var d=n[4];"\u5143"==d?d=1:(d=o.toHankaku(d),d=parseInt(d)),"\u4ee4\u548c"==n[3]?d+=2018:"\u5e73\u6210"==n[3]?d+=1988:"\u662d\u548c"==n[3]&&(d+=1925),u.start.assign("year",d)}else if(n[1]&&n[1].match("\u540c|\u4eca|\u672c")){const e=r(t);u.start.assign("year",e.year())}else{const e=i.findYearClosestToRef(t,c,l);u.start.imply("year",e)}return u.tags.JPStandardParser=!0,u}}},function(e,t){t.toHankaku=function(e,t){function n(e){return t(e.charCodeAt(0)-65248)}return function(t){return e(t).replace(/\u2019/g,"'").replace(/\u201D/g,'"').replace(/\u3000/g," ").replace(/\uFFE5/g,"\xa5").replace(/[\uFF01\uFF03-\uFF06\uFF08\uFF09\uFF0C-\uFF19\uFF1C-\uFF1F\uFF21-\uFF3B\uFF3D\uFF3F\uFF41-\uFF5B\uFF5D\uFF5E]/g,n)}}(String,String.fromCharCode),t.toZenkaku=function(e,t){function n(e){return t(e.charCodeAt(0)+65248)}return function(t){return e(t).replace(/\u0020/g,"\u3000").replace(/\u0022/g,"\u201d").replace(/\u0027/g,"\u2019").replace(/\u00A5/g,"\uffe5").replace(/[!#-&(),-9\u003C-?A-[\u005D_a-{}~]/g,n)}}(String,String.fromCharCode)},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/\u4eca\u65e5|\u5f53\u65e5|\u6628\u65e5|\u660e\u65e5|\u4eca\u591c|\u4eca\u5915|\u4eca\u6669|\u4eca\u671d/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){var o=n.index,s=(e=n[0],new a({index:o,text:e,ref:t})),u=r(t),l=u;return"\u4eca\u591c"==e||"\u4eca\u5915"==e||"\u4eca\u6669"==e?(s.start.imply("hour",22),s.start.imply("meridiem",1)):"\u660e\u65e5"==e?u.hour()>4&&(l=l.add(1,"day")):"\u6628\u65e5"==e?l=l.add(-1,"day"):e.match("\u4eca\u671d")&&(s.start.imply("hour",6),s.start.imply("meridiem",0)),s.start.assign("day",l.date()),s.start.assign("month",l.month()+1),s.start.assign("year",l.year()),s.tags.JPCasualDateParser=!0,s}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)(agora|esta\s*(manh\xe3|tarde|noite)|(ontem|amanh\xe3)\s*(de|\xe0)\s*(manh\xe3|tarde|noite)|hoje|amanh\xe3|ontem|noite)(?=\W|$)/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){e=n[0].substr(n[1].length);var o=n.index+n[1].length,s=new a({index:o,text:e,ref:t}),u=r(t),l=u,c=e.toLowerCase().replace(/\s+/g," ");if("amanh\xe3"==c)u.hour()>1&&(l=l.add(1,"day"));else if("ontem"==c)l=l.add(-1,"day");else if("noite"==c)s.start.imply("hour",0),u.hour()>6&&(l=l.add(-1,"day"));else if(c.match("esta")){"tarde"==(d=n[3].toLowerCase())?s.start.imply("hour",18):"manh\xe3"==d?s.start.imply("hour",6):"noite"==d&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else if(c.match(/de|\xe0/)){var d,h=n[4].toLowerCase();"ontem"===h?l=l.add(-1,"day"):"amanh\xe3"===h&&(l=l.add(1,"day")),"tarde"==(d=n[6].toLowerCase())?s.start.imply("hour",18):"manh\xe3"==d?s.start.imply("hour",9):"noite"==d&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else c.match("agora")&&(s.start.imply("hour",u.hour()),s.start.imply("minute",u.minute()),s.start.imply("second",u.second()),s.start.imply("millisecond",u.millisecond()));return s.start.assign("day",l.date()),s.start.assign("month",l.month()+1),s.start.assign("year",l.year()),s.tags.PTCasualDateParser=!0,s}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)(dentro\s*de|em|em*at\xe9)\s*([0-9]+|mei[oa]|uma?)\s*(minutos?|horas?|dias?)\s*(?=(?:\W|$))/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){var o=n.index+n[1].length;n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length);var s=new a({index:o,text:e,ref:t}),u=parseInt(n[3]);isNaN(u)&&(u=n[3].match(/(meio|meia)/)?.5:1);var l=r(t);return n[4].match(/dia/)?(l=l.add(u,"d"),s.start.assign("year",l.year()),s.start.assign("month",l.month()+1),s.start.assign("day",l.date()),s):(n[4].match(/hora/)?l=l.add(u,"hour"):n[4].match(/minuto/)&&(l=l.add(u,"minute")),s.start.imply("year",l.year()),s.start.imply("month",l.month()+1),s.start.imply("day",l.date()),s.start.assign("hour",l.hour()),s.start.assign("minute",l.minute()),s.tags.PTDeadlineFormatParser=!0,s)}}},function(e,t,n){var r=n(31),i=n(24).ParsedResult,a=n(157),o=(a.WEEKDAY_OFFSET,new RegExp("(\\W|^)(?:(domingo|segunda|segunda-feira|ter\xe7a|ter\xe7a-feira|quarta|quarta-feira|quinta|quinta-feira|sexta|sexta-feira|s\xe1bado|sabado|dom|seg|ter|qua|qui|sex|sab)\\s*,?\\s*)?([0-9]{1,2})(?:\xba|\xaa|\xb0)?(?:\\s*(?:desde|de|\\-|\\\u2013|ao?|\\s)\\s*([0-9]{1,2})(?:\xba|\xaa|\xb0)?)?\\s*(?:de)?\\s*(Jan(?:eiro|\\.)?|Fev(?:ereiro|\\.)?|Mar(?:\xe7o|\\.)?|Abr(?:il|\\.)?|Mai(?:o|\\.)?|Jun(?:ho|\\.)?|Jul(?:ho|\\.)?|Ago(?:sto|\\.)?|Set(?:embro|\\.)?|Out(?:ubro|\\.)?|Nov(?:embro|\\.)?|Dez(?:embro|\\.)?)(?:\\s*(?:de?)?(\\s*[0-9]{1,4}(?![^\\s]\\d))(\\s*[ad]\\.?\\s*c\\.?|a\\.?\\s*d\\.?)?)?(?=\\W|$)","i"));t.Parser=function(){r.Parser.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,o){var s=new i({text:n[0].substr(n[1].length,n[0].length-n[1].length),index:n.index+n[1].length,ref:t}),u=n[5];u=a.MONTH_OFFSET[u.toLowerCase()];var l=n[3];l=parseInt(l);var c=null;if(n[6]&&(c=n[6],c=parseInt(c),n[7]?/a\.?\s*c\.?/i.test(n[7])&&(c=-c):c<100&&(c+=2e3)),c?(s.start.assign("day",l),s.start.assign("month",u),s.start.assign("year",c)):(c=r.findYearClosestToRef(t,l,u),s.start.assign("day",l),s.start.assign("month",u),s.start.imply("year",c)),n[2]){var d=n[2];d=a.WEEKDAY_OFFSET[d.toLowerCase()],s.start.assign("weekday",d)}return n[4]&&(s.end=s.start.clone(),s.end.assign("day",parseInt(n[4]))),s.tags.PTMonthNameLittleEndianParser=!0,s}}},function(e,t){t.WEEKDAY_OFFSET={domingo:0,dom:0,segunda:1,"segunda-feira":1,seg:1,"ter\xe7a":2,terca:2,"ter\xe7a-feira":2,"terca-feira":2,ter:2,quarta:3,"quarta-feira":3,qua:3,quinta:4,"quinta-feira":4,qui:4,sexta:5,"sexta-feira":5,sex:5,"s\xe1bado":6,sabado:6,sab:6},t.MONTH_OFFSET={janeiro:1,jan:1,"jan.":1,fevereiro:2,fev:2,"fev.":2,"mar\xe7o":3,mar:3,"mar.":3,abril:4,abr:4,"abr.":4,maio:5,mai:5,"mai.":5,junho:6,jun:6,"jun.":6,julho:7,jul:7,"jul.":7,agosto:8,ago:8,"ago.":8,setembro:9,set:9,"set.":9,outubro:10,out:10,"out.":10,novembro:11,nov:11,"nov.":11,dezembro:12,dez:12,"dez.":12}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=new RegExp("(\\W|^)(?:((?:domingo|dom|segunda|segunda-feira|seg|ter\xe7a|ter\xe7a-feira|ter|quarta|quarta-feira|qua|quinta|quinta-feira|qui|sexta|sexta-feira|sex|s[\xe1a]bado|sab))\\s*\\,?\\s*)?([0-1]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}s*,?s*|[0-9]{2}s*,?s*))?(\\W|$)","i"),s={domingo:0,dom:0,segunda:1,"segunda-feira":1,seg:1,"ter\xe7a":2,"ter\xe7a-feira":2,ter:2,quarta:3,"quarta-feira":3,qua:3,quinta:4,"quinta-feira":4,qui:4,sexta:5,"sexta-feira":5,sex:5,"s\xe1bado":6,sabado:6,sab:6};t.Parser=function(e){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){if("/"!=n[1]&&"/"!=n[6]){var o=n.index+n[1].length,u=(e=n[0].substr(n[1].length,n[0].length-n[6].length),new a({text:e,index:o,ref:t}));if(!e.match(/^\d\.\d$/)&&!e.match(/^\d\.\d{1,2}\.\d{1,2}$/)&&(n[5]||!(n[0].indexOf("/")<0))){var l=n[5]||r(t).year()+"",c=n[4],d=n[3];if(c=parseInt(c),d=parseInt(d),l=parseInt(l),(c<1||c>12)&&c>12){if(!(d>=1&&d<=12&&c>=13&&c<=31))return null;var h=c;c=d,d=h}return d<1||d>31?null:(l<100&&(l+=l>50?1900:2e3),u.start.assign("day",d),u.start.assign("month",c),u.start.assign("year",l),n[2]&&u.start.assign("weekday",s[n[2].toLowerCase()]),u.tags.PTSlashDateFormatParser=!0,u)}}else n.index+=n[0].length}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)h\xe1\s*([0-9]+|mei[oa]|uma?)\s*(minutos?|horas?|semanas?|dias?|mes(es)?|anos?)(?=(?:\W|$))/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;e=n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length),index=n.index+n[1].length;var o=new a({index:index,text:e,ref:t}),s=parseInt(n[2]);isNaN(s)&&(s=n[2].match(/mei/)?.5:1);var u=r(t);return n[3].match(/hora/)||n[3].match(/minuto/)?(n[3].match(/hora/)?u=u.add(-s,"hour"):n[3].match(/minuto/)&&(u=u.add(-s,"minute")),o.start.imply("day",u.date()),o.start.imply("month",u.month()+1),o.start.imply("year",u.year()),o.start.assign("hour",u.hour()),o.start.assign("minute",u.minute()),o.tags.PTTimeAgoFormatParser=!0,o):n[3].match(/semana/)?(u=u.add(-s,"week"),o.start.imply("day",u.date()),o.start.imply("month",u.month()+1),o.start.imply("year",u.year()),o.start.imply("weekday",u.day()),o):(n[3].match(/dia/)&&(u=u.add(-s,"d")),n[3].match(/mes/)&&(u=u.add(-s,"month")),n[3].match(/ano/)&&(u=u.add(-s,"year")),o.start.assign("day",u.date()),o.start.assign("month",u.month()+1),o.start.assign("year",u.year()),o)}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(24).ParsedComponents,s=new RegExp("(^|\\s|T)(?:(?:ao?|\xe0s?|das|da|do)\\s*)?(\\d{1,4}|meio-dia|meia-noite|meio dia|meia noite)(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:(?:\\:|\\\uff1a)(\\d{2}))?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i"),u=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301c|a(?:o)?|\\?)\\s*(\\d{1,4})(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2}))?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;var s=r(t),l=new a;l.ref=t,l.index=n.index+n[1].length,l.text=n[0].substring(n[1].length),l.tags.PTTimeExpressionParser=!0,l.start.imply("day",s.date()),l.start.imply("month",s.month()+1),l.start.imply("year",s.year());var c=0,d=0,h=-1;if(null!=n[4]){if((p=parseInt(n[4]))>=60)return null;l.start.assign("second",p)}if(n[2].toLowerCase().match(/meio\-di/)?(h=1,c=12):"meia-noite"==n[2].toLowerCase()?(h=0,c=0):c=parseInt(n[2]),null!=n[3]?d=parseInt(n[3]):c>100&&(d=c%100,c=parseInt(c/100)),d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[5]){if(c>12)return null;var f=n[5][0].toLowerCase();"a"==f&&(h=0,12==c&&(c=0)),"p"==f&&(h=1,12!=c&&(c+=12))}if(l.start.assign("hour",c),l.start.assign("minute",d),h>=0&&l.start.assign("meridiem",h),!(n=u.exec(e.substring(l.index+l.text.length))))return l.text.match(/^\d+$/)?null:l;if(n[0].match(/^\s*(\+|\-)\s*\d{3,4}$/))return l;null==l.end&&(l.end=new o(null,l.start.date()));c=0,d=0,h=-1;if(null!=n[4]){var p;if((p=parseInt(n[4]))>=60)return null;l.end.assign("second",p)}if(c=parseInt(n[2]),null!=n[3]){if((d=parseInt(n[3]))>=60)return l}else c>100&&(d=c%100,c=parseInt(c/100));if(d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[5]){if(c>12)return null;"a"==n[5][0].toLowerCase()&&(h=0,12==c&&(c=0,l.end.isCertain("day")||l.end.imply("day",l.end.get("day")+1))),"p"==n[5][0].toLowerCase()&&(h=1,12!=c&&(c+=12)),l.start.isCertain("meridiem")||(0==h?(l.start.imply("meridiem",0),12==l.start.get("hour")&&l.start.assign("hour",0)):(l.start.imply("meridiem",1),12!=l.start.get("hour")&&l.start.assign("hour",l.start.get("hour")+12)))}else c>=12&&(h=1);return l.text=l.text+n[0],l.end.assign("hour",c),l.end.assign("minute",d),h>=0&&l.end.assign("meridiem",h),l.end.date().getTime()<l.start.date().getTime()&&l.end.imply("day",l.end.get("day")+1),l}}},function(e,t,n){var r=n(31).Parser,i=n(24).ParsedResult,a=n(90).updateParsedComponent,o={domingo:0,dom:0,segunda:1,"segunda-feira":1,seg:1,"ter\xe7a":2,"ter\xe7a-feira":2,ter:2,quarta:3,"quarta-feira":3,qua:3,quinta:4,"quinta-feira":4,qui:4,sexta:5,"sexta-feira":5,sex:5,"s\xe1bado":6,sabado:6,sab:6},s=new RegExp("(\\W|^)(?:(?:\\,|\\(|\\\uff08)\\s*)?(?:(este|esta|passado|pr[o\xf3]ximo)\\s*)?("+Object.keys(o).join("|")+")(?:\\s*(?:\\,|\\)|\\\uff09))?(?:\\s*(este|esta|passado|pr[\xf3o]ximo)\\s*semana)?(?=\\W|$)","i");t.Parser=function(){r.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,r){var s=n.index+n[1].length,u=(e=n[0].substr(n[1].length,n[0].length-n[1].length),new i({index:s,text:e,ref:t})),l=n[3].toLowerCase(),c=o[l];if(void 0===c)return null;var d=null,h=n[2],f=n[4];if(h||f){var p=h||f;"passado"==(p=p.toLowerCase())?d="this":"pr\xf3ximo"==p||"proximo"==p?d="next":"este"==p&&(d="this")}return a(u,t,c,d),u.tags.PTWeekdayParser=!0,u}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)(ahora|esta\s*(ma\xf1ana|tarde|noche)|(ayer|ma\xf1ana)\s*por\s*la\s*(ma\xf1ana|tarde|noche)|hoy|ma\xf1ana|ayer|anoche)(?=\W|$)/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){e=n[0].substr(n[1].length);var o=n.index+n[1].length,s=new a({index:o,text:e,ref:t}),u=r(t),l=u,c=e.toLowerCase().replace(/\s+/g," ");if("ma\xf1ana"==c)u.hour()>1&&(l=l.add(1,"day"));else if("ayer"==c)l=l.add(-1,"day");else if("anoche"==c)s.start.imply("hour",0),u.hour()>6&&(l=l.add(-1,"day"));else if(c.match("esta")){"tarde"==(d=n[3].toLowerCase())?s.start.imply("hour",18):"ma\xf1ana"==d?s.start.imply("hour",6):"noche"==d&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else if(c.match(/por\s*la/)){var d,h=n[4].toLowerCase();"ayer"===h?l=l.add(-1,"day"):"ma\xf1ana"===h&&(l=l.add(1,"day")),"tarde"==(d=n[5].toLowerCase())?s.start.imply("hour",18):"ma\xf1ana"==d?s.start.imply("hour",9):"noche"==d&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else c.match("ahora")&&(s.start.imply("hour",u.hour()),s.start.imply("minute",u.minute()),s.start.imply("second",u.second()),s.start.imply("millisecond",u.millisecond()));return s.start.assign("day",l.date()),s.start.assign("month",l.month()+1),s.start.assign("year",l.year()),s.tags.ESCasualDateParser=!0,s}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)(dentro\s*de|en)\s*([0-9]+|medi[oa]|una?)\s*(minutos?|horas?|d[i\xed]as?)\s*(?=(?:\W|$))/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){var o=n.index+n[1].length;n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length);var s=new a({index:o,text:e,ref:t}),u=parseInt(n[3]);isNaN(u)&&(u=n[3].match(/medi/)?.5:1);var l=r(t);return n[4].match(/d[i\xed]a/)?(l=l.add(u,"d"),s.start.assign("year",l.year()),s.start.assign("month",l.month()+1),s.start.assign("day",l.date()),s):(n[4].match(/hora/)?l=l.add(u,"hour"):n[4].match(/minuto/)&&(l=l.add(u,"minute")),s.start.imply("year",l.year()),s.start.imply("month",l.month()+1),s.start.imply("day",l.date()),s.start.assign("hour",l.hour()),s.start.assign("minute",l.minute()),s.tags.ESDeadlineFormatParser=!0,s)}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)hace\s*([0-9]+|medi[oa]|una?)\s*(minutos?|horas?|semanas?|d[i\xed]as?|mes(es)?|a\xf1os?)(?=(?:\W|$))/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;e=n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length),index=n.index+n[1].length;var o=new a({index:index,text:e,ref:t}),s=parseInt(n[2]);isNaN(s)&&(s=n[2].match(/medi/)?.5:1);var u=r(t);return n[3].match(/hora/)||n[3].match(/minuto/)?(n[3].match(/hora/)?u=u.add(-s,"hour"):n[3].match(/minuto/)&&(u=u.add(-s,"minute")),o.start.imply("day",u.date()),o.start.imply("month",u.month()+1),o.start.imply("year",u.year()),o.start.assign("hour",u.hour()),o.start.assign("minute",u.minute()),o.tags.ESTimeAgoFormatParser=!0,o):n[3].match(/semana/)?(u=u.add(-s,"week"),o.start.imply("day",u.date()),o.start.imply("month",u.month()+1),o.start.imply("year",u.year()),o.start.imply("weekday",u.day()),o):(n[3].match(/d[i\xed]a/)&&(u=u.add(-s,"d")),n[3].match(/mes/)&&(u=u.add(-s,"month")),n[3].match(/a\xf1o/)&&(u=u.add(-s,"year")),o.start.assign("day",u.date()),o.start.assign("month",u.month()+1),o.start.assign("year",u.year()),o)}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(24).ParsedComponents,s=new RegExp("(^|\\s|T)(?:(?:a las?|al?|desde|de)\\s*)?(\\d{1,4}|mediod[i\xed]a|medianoche)(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:(?:\\:|\\\uff1a)(\\d{2}))?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i"),u=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301c|a(?:s*las)?|\\?)\\s*(\\d{1,4})(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2}))?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;var s=r(t),l=new a;l.ref=t,l.index=n.index+n[1].length,l.text=n[0].substring(n[1].length),l.tags.ESTimeExpressionParser=!0,l.start.imply("day",s.date()),l.start.imply("month",s.month()+1),l.start.imply("year",s.year());var c=0,d=0,h=-1;if(null!=n[4]){if((p=parseInt(n[4]))>=60)return null;l.start.assign("second",p)}if(n[2].toLowerCase().match(/mediod/)?(h=1,c=12):"medianoche"==n[2].toLowerCase()?(h=0,c=0):c=parseInt(n[2]),null!=n[3]?d=parseInt(n[3]):c>100&&(d=c%100,c=parseInt(c/100)),d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[5]){if(c>12)return null;var f=n[5][0].toLowerCase();"a"==f&&(h=0,12==c&&(c=0)),"p"==f&&(h=1,12!=c&&(c+=12))}if(l.start.assign("hour",c),l.start.assign("minute",d),h>=0&&l.start.assign("meridiem",h),!(n=u.exec(e.substring(l.index+l.text.length))))return l.text.match(/^\d+$/)?null:l;if(n[0].match(/^\s*(\+|\-)\s*\d{3,4}$/))return l;null==l.end&&(l.end=new o(null,l.start.date()));c=0,d=0,h=-1;if(null!=n[4]){var p;if((p=parseInt(n[4]))>=60)return null;l.end.assign("second",p)}if(c=parseInt(n[2]),null!=n[3]){if((d=parseInt(n[3]))>=60)return l}else c>100&&(d=c%100,c=parseInt(c/100));if(d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[5]){if(c>12)return null;"a"==n[5][0].toLowerCase()&&(h=0,12==c&&(c=0,l.end.isCertain("day")||l.end.imply("day",l.end.get("day")+1))),"p"==n[5][0].toLowerCase()&&(h=1,12!=c&&(c+=12)),l.start.isCertain("meridiem")||(0==h?(l.start.imply("meridiem",0),12==l.start.get("hour")&&l.start.assign("hour",0)):(l.start.imply("meridiem",1),12!=l.start.get("hour")&&l.start.assign("hour",l.start.get("hour")+12)))}else c>=12&&(h=1);return l.text=l.text+n[0],l.end.assign("hour",c),l.end.assign("minute",d),h>=0&&l.end.assign("meridiem",h),l.end.date().getTime()<l.start.date().getTime()&&l.end.imply("day",l.end.get("day")+1),l}}},function(e,t,n){var r=n(31).Parser,i=n(24).ParsedResult,a=n(90).updateParsedComponent,o={domingo:0,dom:0,lunes:1,lun:1,martes:2,mar:2,miercoles:3,"mi\xe9rcoles":3,mie:3,jueves:4,jue:4,viernes:5,vier:5,sabado:6,"s\xe1bado":6,sab:6},s=new RegExp("(\\W|^)(?:(?:\\,|\\(|\\\uff08)\\s*)?(?:(este|pasado|pr[o\xf3]ximo)\\s*)?("+Object.keys(o).join("|")+")(?:\\s*(?:\\,|\\)|\\\uff09))?(?:\\s*(este|pasado|pr[\xf3o]ximo)\\s*week)?(?=\\W|$)","i");t.Parser=function(){r.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,r){var s=n.index+n[1].length,u=(e=n[0].substr(n[1].length,n[0].length-n[1].length),new i({index:s,text:e,ref:t})),l=n[3].toLowerCase(),c=o[l];if(void 0===c)return null;var d=null,h=n[2],f=n[4];if(h||f){var p=h||f;"pasado"==(p=p.toLowerCase())?d="this":"pr\xf3ximo"==p||"proximo"==p?d="next":"este"==p&&(d="this")}return a(u,t,c,d),u.tags.ESWeekdayParser=!0,u}}},function(e,t,n){var r=n(31),i=n(24).ParsedResult,a=n(168),o=(a.WEEKDAY_OFFSET,new RegExp("(\\W|^)(?:(Domingo|Lunes|Martes|Mi\xe9rcoles|Miercoles|Jueves|Viernes|S\xe1bado|Sabado|Dom|Lun|Mar|Mie|Jue|Vie|Sab)\\s*,?\\s*)?([0-9]{1,2})(?:\xba|\xaa|\xb0)?(?:\\s*(?:desde|de|\\-|\\\u2013|al?|hasta|\\s)\\s*([0-9]{1,2})(?:\xba|\xaa|\xb0)?)?\\s*(?:de)?\\s*(Ene(?:ro|\\.)?|Feb(?:rero|\\.)?|Mar(?:zo|\\.)?|Abr(?:il|\\.)?|May(?:o|\\.)?|Jun(?:io|\\.)?|Jul(?:io|\\.)?|Ago(?:sto|\\.)?|Sep(?:tiembre|\\.)?|Set(?:iembre|\\.)?|Oct(?:ubre|\\.)?|Nov(?:iembre|\\.)?|Dic(?:iembre|\\.)?)(?:\\s*(?:del?)?(\\s*[0-9]{1,4}(?![^\\s]\\d))(\\s*[ad]\\.?\\s*c\\.?|a\\.?\\s*d\\.?)?)?(?=\\W|$)","i"));t.Parser=function(){r.Parser.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,o){var s=new i({text:n[0].substr(n[1].length,n[0].length-n[1].length),index:n.index+n[1].length,ref:t}),u=n[5];u=a.MONTH_OFFSET[u.toLowerCase()];var l=n[3];l=parseInt(l);var c=null;if(n[6]&&(c=n[6],c=parseInt(c),n[7]?/a\.?\s*c\.?/i.test(n[7])&&(c=-c):c<100&&(c+=2e3)),c?(s.start.assign("day",l),s.start.assign("month",u),s.start.assign("year",c)):(c=r.findYearClosestToRef(t,l,u),s.start.assign("day",l),s.start.assign("month",u),s.start.imply("year",c)),n[2]){var d=n[2];d=a.WEEKDAY_OFFSET[d.toLowerCase()],s.start.assign("weekday",d)}return n[4]&&(s.end=s.start.clone(),s.end.assign("day",parseInt(n[4]))),s.tags.ESMonthNameLittleEndianParser=!0,s}}},function(e,t){t.WEEKDAY_OFFSET={domingo:0,dom:0,lunes:1,lun:1,martes:2,mar:2,"mi\xe9rcoles":3,miercoles:3,mie:3,jueves:4,jue:4,viernes:5,vie:5,"s\xe1bado":6,sabado:6,sab:6},t.MONTH_OFFSET={enero:1,ene:1,"ene.":1,febrero:2,feb:2,"feb.":2,marzo:3,mar:3,"mar.":3,abril:4,abr:4,"abr.":4,mayo:5,may:5,"may.":5,junio:6,jun:6,"jun.":6,julio:7,jul:7,"jul.":7,agosto:8,ago:8,"ago.":8,septiembre:9,sep:9,sept:9,"sep.":9,"sept.":9,octubre:10,oct:10,"oct.":10,noviembre:11,nov:11,"nov.":11,diciembre:12,dic:12,"dic.":12}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=new RegExp("(\\W|^)(?:((?:domingo|dom|lunes|lun|martes|mar|mi[\xe9e]rcoles|mie|jueves|jue|viernes|vie|s[\xe1a]bado|sab))\\s*\\,?\\s*)?([0-1]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}s*,?s*|[0-9]{2}s*,?s*))?(\\W|$)","i"),s={domingo:0,dom:0,lunes:1,lun:1,martes:2,mar:2,miercoles:3,"mi\xe9rcoles":3,mie:3,jueves:4,jue:4,viernes:5,vier:5,"s\xe1bado":6,sabado:6,sab:6};t.Parser=function(e){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){if("/"!=n[1]&&"/"!=n[6]){var o=n.index+n[1].length,u=(e=n[0].substr(n[1].length,n[0].length-n[6].length),new a({text:e,index:o,ref:t}));if(!e.match(/^\d\.\d$/)&&!e.match(/^\d\.\d{1,2}\.\d{1,2}$/)&&(n[5]||!(n[0].indexOf("/")<0))){var l=n[5]||r(t).year()+"",c=n[4],d=n[3];if(c=parseInt(c),d=parseInt(d),l=parseInt(l),(c<1||c>12)&&c>12){if(!(d>=1&&d<=12&&c>=13&&c<=31))return null;var h=c;c=d,d=h}return d<1||d>31?null:(l<100&&(l+=l>50?1900:2e3),u.start.assign("day",d),u.start.assign("month",c),u.start.assign("year",l),n[2]&&u.start.assign("weekday",s[n[2].toLowerCase()]),u.tags.ESSlashDateFormatParser=!0,u)}}else n.index+=n[0].length}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)(maintenant|aujourd'hui|ajd|cette\s*nuit|la\s*veille|(demain|hier)(\s*(matin|soir|aprem|apr\xe8s-midi))?|ce\s*(matin|soir)|cet\s*(apr\xe8s-midi|aprem))(?=\W|$)/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){e=n[0].substr(n[1].length);var o=n.index+n[1].length,s=new a({index:o,text:e,ref:t}),u=r(t),l=u,c=e.toLowerCase();return c.match(/demain/)&&u.hour()>1&&(l=l.add(1,"day")),c.match(/hier/)&&(l=l.add(-1,"day")),c.match(/cette\s*nuit/)?(s.start.imply("hour",22),s.start.imply("meridiem",1)):c.match(/la\s*veille/)?(s.start.imply("hour",0),u.hour()>6&&(l=l.add(-1,"day"))):c.match(/(apr\xe8s-midi|aprem)/)?s.start.imply("hour",14):c.match(/(soir)/)?s.start.imply("hour",18):c.match(/matin/)?s.start.imply("hour",8):c.match("maintenant")&&(s.start.imply("hour",u.hour()),s.start.imply("minute",u.minute()),s.start.imply("second",u.second()),s.start.imply("millisecond",u.millisecond())),s.start.assign("day",l.date()),s.start.assign("month",l.month()+1),s.start.assign("year",l.year()),s.tags.FRCasualDateParser=!0,s}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(97),s=new RegExp("(\\W|^)(dans|en)\\s*("+o.INTEGER_WORDS_PATTERN+"|[0-9]+|une?|(?:\\s*quelques)?|demi(?:\\s*|-?)?)\\s*(secondes?|min(?:ute)?s?|heures?|jours?|semaines?|mois|ann\xe9es?)\\s*(?=\\W|$)","i"),u=new RegExp("(\\W|^)(dans|en)\\s*("+o.INTEGER_WORDS_PATTERN+"|[0-9]+|un?)\\s*(secondes?|minutes?|heures?|jours?)\\s*(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return this.isStrictMode()?u:s},this.extract=function(e,t,n,i){var s=n.index+n[1].length;n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length);var u=new a({index:s,text:e,ref:t}),l=n[3];l=void 0!==o.INTEGER_WORDS[l]?o.INTEGER_WORDS[l]:"un"===l||"une"===l?1:l.match(/quelques?/i)?3:l.match(/demi-?/i)?.5:parseInt(l);var c=r(t);return n[4].match(/jour|semaine|mois|ann\xe9e/i)?(n[4].match(/jour/)?c=c.add(l,"d"):n[4].match(/semaine/i)?c=c.add(7*l,"d"):n[4].match(/mois/i)?c=c.add(l,"month"):n[4].match(/ann\xe9e/i)&&(c=c.add(l,"year")),u.start.assign("year",c.year()),u.start.assign("month",c.month()+1),u.start.assign("day",c.date()),u):(n[4].match(/heure/i)?c=c.add(l,"hour"):n[4].match(/min/i)?c=c.add(l,"minutes"):n[4].match(/secondes/i)&&(c=c.add(l,"second")),u.start.imply("year",c.year()),u.start.imply("month",c.month()+1),u.start.imply("day",c.date()),u.start.assign("hour",c.hour()),u.start.assign("minute",c.minute()),u.start.assign("second",c.second()),u.tags.FRDeadlineFormatParser=!0,u)}}},function(e,t,n){const r=n(31);var i=n(24).ParsedResult,a=n(97),o=(a.WEEKDAY_OFFSET,new RegExp("(\\W|^)(?:(Dimanche|Lundi|Mardi|mercredi|Jeudi|Vendredi|Samedi|Dim|Lun|Mar|Mer|Jeu|Ven|Sam)\\s*,?\\s*)?([0-9]{1,2}|1er)(?:\\s*(?:au|\\-|\\\u2013|jusqu'au?|\\s)\\s*([0-9]{1,2})(?:er)?)?\\s*(?:de)?\\s*(Jan(?:vier|\\.)?|F[\xe9e]v(?:rier|\\.)?|Mars|Avr(?:il|\\.)?|Mai|Juin|Juil(?:let|\\.)?|Ao[u\xfb]t|Sept(?:embre|\\.)?|Oct(?:obre|\\.)?|Nov(?:embre|\\.)?|d[\xe9e]c(?:embre|\\.)?)(?:\\s*(\\s*[0-9]{1,4}(?![^\\s]\\d))(?:\\s*(AC|[ap]\\.?\\s*c(?:h(?:r)?)?\\.?\\s*n\\.?))?)?(?=\\W|$)","i"));t.Parser=function(){r.Parser.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,o){var s=new i({text:n[0].substr(n[1].length,n[0].length-n[1].length),index:n.index+n[1].length,ref:t}),u=n[5];u=a.MONTH_OFFSET[u.toLowerCase()];var l=n[3];l=parseInt(l);var c=null;if(n[6]&&(c=n[6],c=parseInt(c),n[7]?/a/i.test(n[7])&&(c=-c):c<100&&(c+=2e3)),c?(s.start.assign("day",l),s.start.assign("month",u),s.start.assign("year",c)):(c=r.findYearClosestToRef(t,l,u),s.start.assign("day",l),s.start.assign("month",u),s.start.imply("year",c)),n[2]){var d=n[2];d=a.WEEKDAY_OFFSET[d.toLowerCase()],s.start.assign("weekday",d)}return n[4]&&(s.end=s.start.clone(),s.end.assign("day",parseInt(n[4]))),s.tags.FRMonthNameLittleEndianParser=!0,s}}},function(e,t,n){var r=n(31),i=n(24).ParsedResult,a=new RegExp("(\\W|^)(?:((?:dimanche|dim|lundi|lun|mardi|mar|mercredi|mer|jeudi|jeu|vendredi|ven|samedi|sam|le))\\s*\\,?\\s*)?([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}s*,?s*|[0-9]{2}s*,?s*))?(\\W|$)","i"),o={dimanche:0,dim:0,lundi:1,lun:1,mardi:2,mar:2,mercredi:3,mer:3,jeudi:4,jeu:4,vendredi:5,ven:5,samedi:6,sam:6};t.Parser=function(e){r.Parser.apply(this,arguments),this.pattern=function(){return a},this.extract=function(e,t,n,a){if("/"!=n[1]&&"/"!=n[6]){var s=n.index+n[1].length,u=(e=n[0].substr(n[1].length,n[0].length-n[6].length),new i({text:e,index:s,ref:t}));if(!e.match(/^\d\.\d$/)&&!e.match(/^\d\.\d{1,2}\.\d{1,2}$/)&&(n[5]||!(n[0].indexOf("/")<0))){var l=n[4],c=n[3];c=parseInt(c),l=parseInt(l);var d=null;if(n[5]&&(d=n[5],(d=parseInt(d))<100&&(d+=2e3)),(l<1||l>12)&&l>12){if(!(c>=1&&c<=12&&l>=13&&l<=31))return null;var h=l;l=c,c=h}return c<1||c>31?null:(d?(u.start.assign("day",c),u.start.assign("month",l),u.start.assign("year",d)):(d=r.findYearClosestToRef(t,c,l),u.start.assign("day",c),u.start.assign("month",l),u.start.imply("year",d)),n[2]&&u.start.assign("weekday",o[n[2].toLowerCase()]),u.tags.FRSlashDateFormatParser=!0,u)}}else n.index+=n[0].length}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=/(\W|^)il y a\s*([0-9]+|une?)\s*(minutes?|heures?|semaines?|jours?|mois|ann\xe9es?|ans?)(?=(?:\W|$))/i;t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;e=n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length),index=n.index+n[1].length;var o=new a({index:index,text:e,ref:t});o.tags.FRTimeAgoFormatParser=!0;var s=parseInt(n[2]);isNaN(s)&&(s=n[2].match(/demi/)?.5:1);var u=r(t);return n[3].match(/heure/)||n[3].match(/minute/)?(n[3].match(/heure/)?u=u.add(-s,"hour"):n[3].match(/minute/)&&(u=u.add(-s,"minute")),o.start.imply("day",u.date()),o.start.imply("month",u.month()+1),o.start.imply("year",u.year()),o.start.assign("hour",u.hour()),o.start.assign("minute",u.minute()),o):n[3].match(/semaine/)?(u=u.add(-s,"week"),o.start.imply("day",u.date()),o.start.imply("month",u.month()+1),o.start.imply("year",u.year()),o.start.imply("weekday",u.day()),o):(n[3].match(/jour/)&&(u=u.add(-s,"d")),n[3].match(/mois/)&&(u=u.add(-s,"month")),n[3].match(/ann\xe9es?|ans?/)&&(u=u.add(-s,"year")),o.start.assign("day",u.date()),o.start.assign("month",u.month()+1),o.start.assign("year",u.year()),o)}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(24).ParsedComponents,s=new RegExp("(^|\\s|T)(?:(?:[\xe0a])\\s*)?(\\d{1,2}(?:h)?|midi|minuit)(?:(?:\\.|\\:|\\\uff1a|h)(\\d{1,2})(?:m)?(?:(?:\\:|\\\uff1a|m)(\\d{0,2})(?:s)?)?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i"),u=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301c|[\xe0a]|\\?)\\s*(\\d{1,2}(?:h)?)(?:(?:\\.|\\:|\\\uff1a|h)(\\d{1,2})(?:m)?(?:(?:\\.|\\:|\\\uff1a|m)(\\d{1,2})(?:s)?)?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;var s=r(t),l=new a;l.ref=t,l.index=n.index+n[1].length,l.text=n[0].substring(n[1].length),l.tags.FRTimeExpressionParser=!0,l.start.imply("day",s.date()),l.start.imply("month",s.month()+1),l.start.imply("year",s.year());var c=0,d=0,h=-1;if(null!=n[4]){if((p=parseInt(n[4]))>=60)return null;l.start.assign("second",p)}if("midi"==n[2].toLowerCase()?(h=1,c=12):"minuit"==n[2].toLowerCase()?(h=0,c=0):c=parseInt(n[2]),null!=n[3]?d=parseInt(n[3]):c>100&&(d=c%100,c=parseInt(c/100)),d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[5]){if(c>12)return null;var f=n[5][0].toLowerCase();"a"==f&&(h=0,12==c&&(c=0)),"p"==f&&(h=1,12!=c&&(c+=12))}if(l.start.assign("hour",c),l.start.assign("minute",d),h>=0&&l.start.assign("meridiem",h),!(n=u.exec(e.substring(l.index+l.text.length))))return l.text.match(/^\d+$/)?null:l;if(n[0].match(/^\s*(\+|\-)\s*\d{3,4}$/))return l;null==l.end&&(l.end=new o(null,l.start.date()));c=0,d=0,h=-1;if(null!=n[4]){var p;if((p=parseInt(n[4]))>=60)return null;l.end.assign("second",p)}if(c=parseInt(n[2]),null!=n[3]){if((d=parseInt(n[3]))>=60)return l}else c>100&&(d=c%100,c=parseInt(c/100));if(d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[5]){if(c>12)return null;"a"==n[5][0].toLowerCase()&&(h=0,12==c&&(c=0,l.end.isCertain("day")||l.end.imply("day",l.end.get("day")+1))),"p"==n[5][0].toLowerCase()&&(h=1,12!=c&&(c+=12)),l.start.isCertain("meridiem")||(0==h?(l.start.imply("meridiem",0),12==l.start.get("hour")&&l.start.assign("hour",0)):(l.start.imply("meridiem",1),12!=l.start.get("hour")&&l.start.assign("hour",l.start.get("hour")+12)))}else c>=12&&(h=1);return l.text=l.text+n[0],l.end.assign("hour",c),l.end.assign("minute",d),h>=0&&l.end.assign("meridiem",h),l.end.date().getTime()<l.start.date().getTime()&&l.end.imply("day",l.end.get("day")+1),l}}},function(e,t,n){var r=n(31).Parser,i=n(24).ParsedResult,a=n(90).updateParsedComponent,o={dimanche:0,dim:0,lundi:1,lun:1,mardi:2,mar:2,mercredi:3,mer:3,jeudi:4,jeu:4,vendredi:5,ven:5,samedi:6,sam:6},s=new RegExp("(\\s|^)(?:(?:\\,|\\(|\\\uff08)\\s*)?(?:(ce)\\s*)?("+Object.keys(o).join("|")+")(?:\\s*(?:\\,|\\)|\\\uff09))?(?:\\s*(dernier|prochain)\\s*)?(?=\\W|$)","i");t.Parser=function(){r.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,r){var s=n.index+n[1].length,u=(e=n[0].substr(n[1].length,n[0].length-n[1].length),new i({index:s,text:e,ref:t})),l=n[3].toLowerCase(),c=o[l];if(void 0===c)return null;var d=null,h=n[2],f=n[4];if(h||f){var p=h||f;"dernier"==(p=p.toLowerCase())?d="last":"prochain"==p?d="next":"ce"==p&&(d="this")}return a(u,t,c,d),u.tags.FRWeekdayParser=!0,u}}},function(e,t,n){const r=n(178),i=n(37);i.extend(r);var a=n(31).Parser,o=n(24).ParsedResult,s=n(97),u=new RegExp("(\\W|^)(?:les?|la|l'|du|des?)\\s*("+s.INTEGER_WORDS_PATTERN+"|\\d+)?\\s*(prochaine?s?|derni[e\xe8]re?s?|pass[\xe9e]e?s?|pr[\xe9e]c[\xe9e]dents?|suivante?s?)?\\s*(secondes?|min(?:ute)?s?|heures?|jours?|semaines?|mois|trimestres?|ann\xe9es?)\\s*(prochaine?s?|derni[e\xe8]re?s?|pass[\xe9e]e?s?|pr[\xe9e]c[\xe9e]dents?|suivante?s?)?(?=\\W|$)","i");t.Parser=function(){a.apply(this,arguments),this.pattern=function(){return u},this.extract=function(e,t,n,r){var a=n.index+n[1].length;n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length);var u=void 0===n[2]?"1":n[2];u=void 0!==s.INTEGER_WORDS[u]?s.INTEGER_WORDS[u]:parseInt(u);var l=void 0===n[3]?void 0===n[5]?"":n[5].toLowerCase():n[3].toLowerCase();if(l){var c,d=new o({index:a,text:e,ref:t});switch(d.tags.FRRelativeDateFormatParser=!0,!0){case/prochaine?s?/.test(l):case/suivants?/.test(l):c=1;break;case/derni[e\xe8]re?s?/.test(l):case/pass[\xe9e]e?s?/.test(l):case/pr[\xe9e]c[\xe9e]dents?/.test(l):c=-1}var h,f=u*c,p=i(t),g=i(t),v=n[4];switch(!0){case/secondes?/.test(v):p=p.add(f,"s"),g=g.add(c,"s"),h="second";break;case/min(?:ute)?s?/.test(v):p=p.add(f,"m"),g=g.add(c,"m"),h="minute";break;case/heures?/.test(v):p=p.add(f,"h"),g=g.add(c,"h"),h="hour";break;case/jours?/.test(v):p=p.add(f,"d"),g=g.add(c,"d"),h="day";break;case/semaines?/.test(v):p=p.add(f,"w"),g=g.add(c,"w"),h="week";break;case/mois?/.test(v):p=p.add(f,"M"),g=g.add(c,"M"),h="month";break;case/trimestres?/.test(v):p=p.add(f,"Q"),g=g.add(c,"Q"),h="quarter";break;case/ann\xe9es?/.test(v):p=p.add(f,"y"),g=g.add(c,"y"),h="year"}if(c>0){var m=p;p=g,g=m}return p=p.startOf(h),g=g.endOf(h),"week"==h&&(p=p.add(1,"d"),g=g.add(1,"d")),d.start.assign("year",p.year()),d.start.assign("month",p.month()+1),d.start.assign("day",p.date()),d.start.assign("minute",p.minute()),d.start.assign("second",p.second()),d.start.assign("hour",p.hour()),d.start.assign("millisecond",p.millisecond()),d.end=d.start.clone(),d.end.assign("year",g.year()),d.end.assign("month",g.month()+1),d.end.assign("day",g.date()),d.end.assign("minute",g.minute()),d.end.assign("second",g.second()),d.end.assign("hour",g.hour()),d.end.assign("millisecond",g.millisecond()),d}}}},function(e,t,n){e.exports=function(){"use strict";var e="month",t="quarter";return function(n,r){var i=r.prototype;i.quarter=function(e){return this.$utils().u(e)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(e-1))};var a=i.add;i.add=function(n,r){return n=Number(n),this.$utils().p(r)===t?this.add(3*n,e):a.bind(this)(n,r)};var o=i.startOf;i.startOf=function(n,r){var i=this.$utils(),a=!!i.u(r)||r;if(i.p(n)===t){var s=this.quarter()-1;return a?this.month(3*s).startOf(e).startOf("day"):this.month(3*s+2).endOf(e).endOf("day")}return o.bind(this)(n,r)}}}()},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(94),s=new RegExp("(\\d{2,4}|["+Object.keys(o.NUMBER).join("")+"]{2,4})?(?:\\s*)(?:\u5e74)?(?:[\\s|,|\uff0c]*)(\\d{1,2}|["+Object.keys(o.NUMBER).join("")+"]{1,2})(?:\\s*)(?:\u6708)(?:\\s*)(\\d{1,2}|["+Object.keys(o.NUMBER).join("")+"]{1,2})?(?:\\s*)(?:\u65e5|\u865f)?");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){var s=r(t),u=new a({text:n[0],index:n.index,ref:t}),l=parseInt(n[2]);if(isNaN(l)&&(l=o.zhStringToNumber(n[2])),u.start.assign("month",l),n[3]){var c=parseInt(n[3]);isNaN(c)&&(c=o.zhStringToNumber(n[3])),u.start.assign("day",c)}else u.start.imply("day",s.date());if(n[1]){var d=parseInt(n[1]);isNaN(d)&&(d=o.zhStringToYear(n[1])),u.start.assign("year",d)}else u.start.imply("year",s.year());return u.tags.ZHHantDateParser=!0,u}}},function(e,t,n){var r=n(31).Parser,i=n(24).ParsedResult,a=n(90).updateParsedComponent,o=n(94),s=new RegExp("(\u4e0a|\u4eca|\u4e0b|\u9019|\u5462)?(?:\u500b)?(?:\u661f\u671f|\u79ae\u62dc)("+Object.keys(o.WEEKDAY_OFFSET).join("|")+")");t.Parser=function(){r.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,r){var s=n.index;e=n[0];var u=new i({index:s,text:e,ref:t}),l=n[2],c=o.WEEKDAY_OFFSET[l];if(void 0===c)return null;var d=null,h=n[1];return"\u4e0a"==h?d="last":"\u4e0b"==h?d="next":"\u4eca"!=h&&"\u9019"!=h&&"\u5462"!=h||(d="this"),a(u,t,c,d),u.tags.ZHHantWeekdayParser=!0,u}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(24).ParsedComponents,s=n(94),u="(?:\u7531|\u5f9e|\u81ea)?(?:(\u4eca|\u660e|\u524d|\u5927\u524d|\u5f8c|\u5927\u5f8c|\u807d|\u6628|\u5c0b|\u7434)(\u65e9|\u671d|\u665a)|(\u4e0a(?:\u5348|\u665d)|\u671d(?:\u65e9)|\u65e9(?:\u4e0a)|\u4e0b(?:\u5348|\u665d)|\u664f(?:\u665d)|\u665a(?:\u4e0a)|\u591c(?:\u665a)?|\u4e2d(?:\u5348)|\u51cc(?:\u6668))|(\u4eca|\u660e|\u524d|\u5927\u524d|\u5f8c|\u5927\u5f8c|\u807d|\u6628|\u5c0b|\u7434)(?:\u65e5|\u5929)(?:[\\s,\uff0c]*)(?:(\u4e0a(?:\u5348|\u665d)|\u671d(?:\u65e9)|\u65e9(?:\u4e0a)|\u4e0b(?:\u5348|\u665d)|\u664f(?:\u665d)|\u665a(?:\u4e0a)|\u591c(?:\u665a)?|\u4e2d(?:\u5348)|\u51cc(?:\u6668)))?)?(?:[\\s,\uff0c]*)(?:(\\d+|["+Object.keys(s.NUMBER).join("")+"]+)(?:\\s*)(?:\u9ede|\u6642|:|\uff1a)(?:\\s*)(\\d+|\u534a|\u6b63|\u6574|["+Object.keys(s.NUMBER).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uff1a)?(?:\\s*)(\\d+|["+Object.keys(s.NUMBER).join("")+"]+)?(?:\\s*)(?:\u79d2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?",l="(?:\\s*(?:\u5230|\u81f3|\\-|\\\u2013|\\~|\\\u301c)\\s*)(?:(\u4eca|\u660e|\u524d|\u5927\u524d|\u5f8c|\u5927\u5f8c|\u807d|\u6628|\u5c0b|\u7434)(\u65e9|\u671d|\u665a)|(\u4e0a(?:\u5348|\u665d)|\u671d(?:\u65e9)|\u65e9(?:\u4e0a)|\u4e0b(?:\u5348|\u665d)|\u664f(?:\u665d)|\u665a(?:\u4e0a)|\u591c(?:\u665a)?|\u4e2d(?:\u5348)|\u51cc(?:\u6668))|(\u4eca|\u660e|\u524d|\u5927\u524d|\u5f8c|\u5927\u5f8c|\u807d|\u6628|\u5c0b|\u7434)(?:\u65e5|\u5929)(?:[\\s,\uff0c]*)(?:(\u4e0a(?:\u5348|\u665d)|\u671d(?:\u65e9)|\u65e9(?:\u4e0a)|\u4e0b(?:\u5348|\u665d)|\u664f(?:\u665d)|\u665a(?:\u4e0a)|\u591c(?:\u665a)?|\u4e2d(?:\u5348)|\u51cc(?:\u6668)))?)?(?:[\\s,\uff0c]*)(?:(\\d+|["+Object.keys(s.NUMBER).join("")+"]+)(?:\\s*)(?:\u9ede|\u6642|:|\uff1a)(?:\\s*)(\\d+|\u534a|\u6b63|\u6574|["+Object.keys(s.NUMBER).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uff1a)?(?:\\s*)(\\d+|["+Object.keys(s.NUMBER).join("")+"]+)?(?:\\s*)(?:\u79d2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?",c=new RegExp(u,"i"),d=new RegExp(l,"i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return c},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;var u=r(t),l=new a;l.ref=t,l.index=n.index,l.text=n[0],l.tags.ZHTimeExpressionParser=!0;var c=u.clone();if(n[1])"\u660e"==(v=n[1])||"\u807d"==v?u.hour()>1&&c.add(1,"day"):"\u6628"==v||"\u5c0b"==v||"\u7434"==v?c.add(-1,"day"):"\u524d"==v?c.add(-2,"day"):"\u5927\u524d"==v?c.add(-3,"day"):"\u5f8c"==v?c.add(2,"day"):"\u5927\u5f8c"==v&&c.add(3,"day"),l.start.assign("day",c.date()),l.start.assign("month",c.month()+1),l.start.assign("year",c.year());else if(n[4]){"\u660e"==(y=n[4])||"\u807d"==y?c.add(1,"day"):"\u6628"==y||"\u5c0b"==y||"\u7434"==y?c.add(-1,"day"):"\u524d"==y?c.add(-2,"day"):"\u5927\u524d"==y?c.add(-3,"day"):"\u5f8c"==y?c.add(2,"day"):"\u5927\u5f8c"==y&&c.add(3,"day"),l.start.assign("day",c.date()),l.start.assign("month",c.month()+1),l.start.assign("year",c.year())}else l.start.imply("day",c.date()),l.start.imply("month",c.month()+1),l.start.imply("year",c.year());var h=0,f=0,p=-1;if(n[8]){var g=parseInt(n[8]);if(isNaN(g)&&(g=s.zhStringToNumber(n[8])),g>=60)return null;l.start.assign("second",g)}if(h=parseInt(n[6]),isNaN(h)&&(h=s.zhStringToNumber(n[6])),n[7]?"\u534a"==n[7]?f=30:"\u6b63"==n[7]||"\u6574"==n[7]?f=0:(f=parseInt(n[7]),isNaN(f)&&(f=s.zhStringToNumber(n[7]))):h>100&&(f=h%100,h=parseInt(h/100)),f>=60)return null;if(h>24)return null;if(h>=12&&(p=1),n[9]){if(h>12)return null;"a"==(_=n[9][0].toLowerCase())&&(p=0,12==h&&(h=0)),"p"==_&&(p=1,12!=h&&(h+=12))}else if(n[2]){"\u671d"==(b=n[2][0])||"\u65e9"==b?(p=0,12==h&&(h=0)):"\u665a"==b&&(p=1,12!=h&&(h+=12))}else if(n[3]){"\u4e0a"==(w=n[3][0])||"\u671d"==w||"\u65e9"==w||"\u51cc"==w?(p=0,12==h&&(h=0)):"\u4e0b"!=w&&"\u664f"!=w&&"\u665a"!=w||(p=1,12!=h&&(h+=12))}else if(n[5]){"\u4e0a"==(k=n[5][0])||"\u671d"==k||"\u65e9"==k||"\u51cc"==k?(p=0,12==h&&(h=0)):"\u4e0b"!=k&&"\u664f"!=k&&"\u665a"!=k||(p=1,12!=h&&(h+=12))}if(l.start.assign("hour",h),l.start.assign("minute",f),p>=0?l.start.assign("meridiem",p):h<12?l.start.imply("meridiem",0):l.start.imply("meridiem",1),!(n=d.exec(e.substring(l.index+l.text.length))))return l.text.match(/^\d+$/)?null:l;var v,m=c.clone();if(l.end=new o(null,null),n[1])"\u660e"==(v=n[1])||"\u807d"==v?u.hour()>1&&m.add(1,"day"):"\u6628"==v||"\u5c0b"==v||"\u7434"==v?m.add(-1,"day"):"\u524d"==v?m.add(-2,"day"):"\u5927\u524d"==v?m.add(-3,"day"):"\u5f8c"==v?m.add(2,"day"):"\u5927\u5f8c"==v&&m.add(3,"day"),l.end.assign("day",m.date()),l.end.assign("month",m.month()+1),l.end.assign("year",m.year());else if(n[4]){var y;"\u660e"==(y=n[4])||"\u807d"==y?m.add(1,"day"):"\u6628"==y||"\u5c0b"==y||"\u7434"==y?m.add(-1,"day"):"\u524d"==y?m.add(-2,"day"):"\u5927\u524d"==y?m.add(-3,"day"):"\u5f8c"==y?m.add(2,"day"):"\u5927\u5f8c"==y&&m.add(3,"day"),l.end.assign("day",m.date()),l.end.assign("month",m.month()+1),l.end.assign("year",m.year())}else l.end.imply("day",m.date()),l.end.imply("month",m.month()+1),l.end.imply("year",m.year());if(h=0,f=0,p=-1,n[8]){g=parseInt(n[8]);if(isNaN(g)&&(g=s.zhStringToNumber(n[8])),g>=60)return null;l.end.assign("second",g)}if(h=parseInt(n[6]),isNaN(h)&&(h=s.zhStringToNumber(n[6])),n[7]?"\u534a"==n[7]?f=30:"\u6b63"==n[7]||"\u6574"==n[7]?f=0:(f=parseInt(n[7]),isNaN(f)&&(f=s.zhStringToNumber(n[7]))):h>100&&(f=h%100,h=parseInt(h/100)),f>=60)return null;if(h>24)return null;if(h>=12&&(p=1),n[9]){if(h>12)return null;var _;"a"==(_=n[9][0].toLowerCase())&&(p=0,12==h&&(h=0)),"p"==_&&(p=1,12!=h&&(h+=12)),l.start.isCertain("meridiem")||(0==p?(l.start.imply("meridiem",0),12==l.start.get("hour")&&l.start.assign("hour",0)):(l.start.imply("meridiem",1),12!=l.start.get("hour")&&l.start.assign("hour",l.start.get("hour")+12)))}else if(n[2]){var b;"\u671d"==(b=n[2][0])||"\u65e9"==b?(p=0,12==h&&(h=0)):"\u665a"==b&&(p=1,12!=h&&(h+=12))}else if(n[3]){var w;"\u4e0a"==(w=n[3][0])||"\u671d"==w||"\u65e9"==w||"\u51cc"==w?(p=0,12==h&&(h=0)):"\u4e0b"!=w&&"\u664f"!=w&&"\u665a"!=w||(p=1,12!=h&&(h+=12))}else if(n[5]){var k;"\u4e0a"==(k=n[5][0])||"\u671d"==k||"\u65e9"==k||"\u51cc"==k?(p=0,12==h&&(h=0)):"\u4e0b"!=k&&"\u664f"!=k&&"\u665a"!=k||(p=1,12!=h&&(h+=12))}(l.text=l.text+n[0],l.end.assign("hour",h),l.end.assign("minute",f),p>=0)?l.end.assign("meridiem",p):l.start.isCertain("meridiem")&&1==l.start.get("meridiem")&&l.start.get("hour")>h?l.end.imply("meridiem",0):h>12&&l.end.imply("meridiem",1);return l.end.date().getTime()<l.start.date().getTime()&&l.end.imply("day",l.end.get("day")+1),l}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=new RegExp("(\u800c\u5bb6|\u7acb(?:\u523b|\u5373)|\u5373\u523b)|(\u4eca|\u660e|\u524d|\u5927\u524d|\u5f8c|\u5927\u5f8c|\u807d|\u6628|\u5c0b|\u7434)(\u65e9|\u671d|\u665a)|(\u4e0a(?:\u5348|\u665d)|\u671d(?:\u65e9)|\u65e9(?:\u4e0a)|\u4e0b(?:\u5348|\u665d)|\u664f(?:\u665d)|\u665a(?:\u4e0a)|\u591c(?:\u665a)?|\u4e2d(?:\u5348)|\u51cc(?:\u6668))|(\u4eca|\u660e|\u524d|\u5927\u524d|\u5f8c|\u5927\u5f8c|\u807d|\u6628|\u5c0b|\u7434)(?:\u65e5|\u5929)(?:[\\s|,|\uff0c]*)(?:(\u4e0a(?:\u5348|\u665d)|\u671d(?:\u65e9)|\u65e9(?:\u4e0a)|\u4e0b(?:\u5348|\u665d)|\u664f(?:\u665d)|\u665a(?:\u4e0a)|\u591c(?:\u665a)?|\u4e2d(?:\u5348)|\u51cc(?:\u6668)))?","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){e=n[0];var o=n.index,s=new a({index:o,text:e,ref:t}),u=r(t),l=u;if(n[1])s.start.imply("hour",u.hour()),s.start.imply("minute",u.minute()),s.start.imply("second",u.second()),s.start.imply("millisecond",u.millisecond());else if(n[2]){var c=n[2],d=n[3];"\u660e"==c||"\u807d"==c?u.hour()>1&&(l=l.add(1,"day")):"\u6628"==c||"\u5c0b"==c||"\u7434"==c?l=l.add(-1,"day"):"\u524d"==c?l=l.add(-2,"day"):"\u5927\u524d"==c?l=l.add(-3,"day"):"\u5f8c"==c?l=l.add(2,"day"):"\u5927\u5f8c"==c&&(l=l.add(3,"day")),"\u65e9"==d||"\u671d"==d?s.start.imply("hour",6):"\u665a"==d&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else if(n[4]){var h=n[4][0];"\u65e9"==h||"\u671d"==h||"\u4e0a"==h?s.start.imply("hour",6):"\u4e0b"==h||"\u664f"==h?(s.start.imply("hour",15),s.start.imply("meridiem",1)):"\u4e2d"==h?(s.start.imply("hour",12),s.start.imply("meridiem",1)):"\u591c"==h||"\u665a"==h?(s.start.imply("hour",22),s.start.imply("meridiem",1)):"\u51cc"==h&&s.start.imply("hour",0)}else if(n[5]){var f=n[5];"\u660e"==f||"\u807d"==f?u.hour()>1&&(l=l.add(1,"day")):"\u6628"==f||"\u5c0b"==f||"\u7434"==f?l=l.add(-1,"day"):"\u524d"==f?l=l.add(-2,"day"):"\u5927\u524d"==f?l=l.add(-3,"day"):"\u5f8c"==f?l=l.add(2,"day"):"\u5927\u5f8c"==f&&(l=l.add(3,"day"));var p=n[6];if(p){var g=p[0];"\u65e9"==g||"\u671d"==g||"\u4e0a"==g?s.start.imply("hour",6):"\u4e0b"==g||"\u664f"==g?(s.start.imply("hour",15),s.start.imply("meridiem",1)):"\u4e2d"==g?(s.start.imply("hour",12),s.start.imply("meridiem",1)):"\u591c"==g||"\u665a"==g?(s.start.imply("hour",22),s.start.imply("meridiem",1)):"\u51cc"==g&&s.start.imply("hour",0)}}return s.start.assign("day",l.date()),s.start.assign("month",l.month()+1),s.start.assign("year",l.year()),s.tags.ZHHantCasualDateParser=!0,s}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(94),s=new RegExp("(\\d+|["+Object.keys(o.NUMBER).join("")+"]+|\u534a|\u5e7e)(?:\\s*)(?:\u500b)?(\u79d2(?:\u9418)?|\u5206\u9418|\u5c0f\u6642|\u9418|\u65e5|\u5929|\u661f\u671f|\u79ae\u62dc|\u6708|\u5e74)(?:(?:\u4e4b|\u904e)?\u5f8c|(?:\u4e4b)?\u5167)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){var s=n.index;e=n[0];var u=new a({index:s,text:e,ref:t}),l=parseInt(n[1]);if(isNaN(l)&&(l=o.zhStringToNumber(n[1])),isNaN(l)){var c=n[1];if("\u5e7e"===c)l=3;else{if("\u534a"!==c)return null;l=.5}}var d=r(t),h=n[2][0];return h.match(/[\u65e5\u5929\u661f\u79ae\u6708\u5e74]/)?("\u65e5"==h||"\u5929"==h?d=d.add(l,"d"):"\u661f"==h||"\u79ae"==h?d=d.add(7*l,"d"):"\u6708"==h?d=d.add(l,"month"):"\u5e74"==h&&(d=d.add(l,"year")),u.start.assign("year",d.year()),u.start.assign("month",d.month()+1),u.start.assign("day",d.date()),u):("\u79d2"==h?d=d.add(l,"second"):"\u5206"==h?d=d.add(l,"minute"):"\u5c0f"!=h&&"\u9418"!=h||(d=d.add(l,"hour")),u.start.imply("year",d.year()),u.start.imply("month",d.month()+1),u.start.imply("day",d.date()),u.start.assign("hour",d.hour()),u.start.assign("minute",d.minute()),u.start.assign("second",d.second()),u.tags.ZHHantDeadlineFormatParser=!0,u)}}},function(e,t,n){var r=n(37),i=n(31).Parser,a=n(24).ParsedResult,o=n(95),s=new RegExp("(\\W|^)(in|nach)\\s*("+o.INTEGER_WORDS_PATTERN+"|[0-9]+|einigen|eine[rm]\\s*halben|eine[rm])\\s*(sekunden?|min(?:ute)?n?|stunden?|tag(?:en)?|wochen?|monat(?:en)?|jahr(?:en)?)\\s*(?=\\W|$)","i"),u=new RegExp("(\\W|^)(in|nach)\\s*("+o.INTEGER_WORDS_PATTERN+"|[0-9]+|eine(?:r|m)?)\\s*(sekunden?|minuten?|stunden?|tag(?:en)?)\\s*(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return this.isStrictMode()?u:s},this.extract=function(e,t,n,i){var s=n.index+n[1].length;n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length);var u=new a({index:s,text:e,ref:t}),l=n[3].toLowerCase();l=void 0!==o.INTEGER_WORDS[l]?o.INTEGER_WORDS[l]:"einer"===l||"einem"===l?1:"einigen"===l?3:/halben/.test(l)?.5:parseInt(l);var c=r(t);return/tag|woche|monat|jahr/i.test(n[4])?(/tag/i.test(n[4])?c=c.add(l,"d"):/woche/i.test(n[4])?c=c.add(7*l,"d"):/monat/i.test(n[4])?c=c.add(l,"month"):/jahr/i.test(n[4])&&(c=c.add(l,"year")),u.start.assign("year",c.year()),u.start.assign("month",c.month()+1),u.start.assign("day",c.date()),u):(/stunde/i.test(n[4])?c=c.add(l,"hour"):/min/i.test(n[4])?c=c.add(l,"minute"):/sekunde/i.test(n[4])&&(c=c.add(l,"second")),u.start.imply("year",c.year()),u.start.imply("month",c.month()+1),u.start.imply("day",c.date()),u.start.assign("hour",c.hour()),u.start.assign("minute",c.minute()),u.start.assign("second",c.second()),u.tags.DEDeadlineFormatParser=!0,u)}}},function(e,t,n){n(37);const r=n(31),i=n(24).ParsedResult,a=n(95),o=new RegExp("(\\W|^)(?:am\\s*?)?(?:(Sonntag|Montag|Dienstag|Mittwoch|Donnerstag|Freitag|Samstag|So|Mo|Di|Mi|Do|Fr|Sa)\\s*,?\\s*)?(?:den\\s*)?([0-9]{1,2})\\.(?:\\s*(?:bis(?:\\s*(?:am|zum))?|\\-|\\\u2013|\\s)\\s*([0-9]{1,2})\\.)?\\s*(Jan(?:uar|\\.)?|Feb(?:ruar|\\.)?|M\xe4r(?:z|\\.)?|Maerz|Mrz\\.?|Apr(?:il|\\.)?|Mai|Jun(?:i|\\.)?|Jul(?:i|\\.)?|Aug(?:ust|\\.)?|Sep(?:t|t\\.|tember|\\.)?|Okt(?:ober|\\.)?|Nov(?:ember|\\.)?|Dez(?:ember|\\.)?)(?:,?\\s*([0-9]{1,4}(?![^\\s]\\d))(\\s*[vn]\\.?\\s*C(?:hr)?\\.?)?)?(?=\\W|$)","i");t.Parser=function(){r.Parser.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,o){const s=new i({text:n[0].substr(n[1].length,n[0].length-n[1].length),index:n.index+n[1].length,ref:t});var u=n[5];u=a.MONTH_OFFSET[u.toLowerCase()];var l=n[3];l=parseInt(l);var c=null;if(n[6]&&(c=n[6],c=parseInt(c),n[7]?/v/i.test(n[7])&&(c=-c):c<100&&(c+=2e3)),c?(s.start.assign("day",l),s.start.assign("month",u),s.start.assign("year",c)):(c=r.findYearClosestToRef(t,l,u),s.start.assign("day",l),s.start.assign("month",u),s.start.imply("year",c)),n[2]){var d=n[2];d=a.WEEKDAY_OFFSET[d.toLowerCase()],s.start.assign("weekday",d)}return n[4]&&(s.end=s.start.clone(),s.end.assign("day",parseInt(n[4]))),s.tags.DEMonthNameLittleEndianParser=!0,s}}},function(e,t,n){const r=n(31),i=n(24).ParsedResult,a=n(95),o=new RegExp("(^|\\D\\s+|[^\\w\\s])(Jan\\.?|Januar|Feb\\.?|Februar|M\xe4r\\.?|M(?:\xe4|ae)rz|Mrz\\.?|Apr\\.?|April|Mai\\.?|Jun\\.?|Juni|Jul\\.?|Juli|Aug\\.?|August|Sep\\.?|Sept\\.?|September|Okt\\.?|Oktober|Nov\\.?|November|Dez\\.?|Dezember)\\s*(?:,?\\s*(?:([0-9]{4})(\\s*[vn]\\.?\\s*C(?:hr)?\\.?)?|([0-9]{1,4})\\s*([vn]\\.?\\s*C(?:hr)?\\.?)))?(?=[^\\s\\w]|$)","i");t.Parser=function(){r.Parser.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,o){var s=new i({text:n[0].substr(n[1].length,n[0].length-n[1].length),index:n.index+n[1].length,ref:t}),u=n[2];u=a.MONTH_OFFSET[u.toLowerCase()];var l=null;return(n[3]||n[5])&&(l=n[3]||n[5],l=parseInt(l),n[4]||n[6]?/v/i.test(n[4]||n[6])&&(l=-l):l<100&&(l+=2e3)),l?(s.start.imply("day",1),s.start.assign("month",u),s.start.assign("year",l)):(l=r.findYearClosestToRef(t,1,u),s.start.imply("day",1),s.start.assign("month",u),s.start.imply("year",l)),s.tags.DEMonthNameParser=!0,s}}},function(e,t,n){var r=n(37),i=n(31).Parser,a=n(24).ParsedResult,o=new RegExp("(\\W|^)(?:(?:am\\s*?)?((?:sonntag|so|montag|mo|dienstag|di|mittwoch|mi|donnerstag|do|freitag|fr|samstag|sa))\\s*\\,?\\s*(?:den\\s*)?)?([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}s*,?s*|[0-9]{2}s*,?s*))?(\\W|$)","i"),s={sonntag:0,so:0,montag:1,mo:1,dienstag:2,di:2,mittwoch:3,mi:3,donnerstag:4,do:4,freitag:5,fr:5,samstag:6,sa:6};t.Parser=function(e){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){if("/"!=n[1]&&"/"!=n[6]){var o=n.index+n[1].length,u=(e=n[0].substr(n[1].length,n[0].length-n[6].length),new a({text:e,index:o,ref:t}));if(!e.match(/^\d\.\d$/)&&!e.match(/^\d\.\d{1,2}\.\d{1,2}$/)&&(n[5]||!(n[0].indexOf("/")<0))){var l=n[5]||r(t).year()+"",c=n[4],d=n[3];return c=parseInt(c),d=parseInt(d),l=parseInt(l),c<1||c>12?null:d<1||d>31?null:(l<100&&(l+=l>50?1900:2e3),u.start.assign("day",d),u.start.assign("month",c),u.start.assign("year",l),n[2]&&u.start.assign("weekday",s[n[2].toLowerCase()]),u.tags.DESlashDateFormatParser=!0,u)}}else n.index+=n[0].length}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(95),s=new RegExp("(\\W|^)vor\\s*("+o.INTEGER_WORDS_PATTERN+"|[0-9]+|einigen|eine[rm]\\s*halben|eine[rm])\\s*(sekunden?|min(?:ute)?n?|stunden?|wochen?|tag(?:en)?|monat(?:en)?|jahr(?:en)?)\\s*(?=(?:\\W|$))","i"),u=new RegExp("(\\W|^)vor\\s*([0-9]+|eine(?:r|m))\\s*(sekunden?|minuten?|stunden?|tag(?:en)?)(?=(?:\\W|$))","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return this.isStrictMode()?u:s},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;e=n[0];e=n[0].substr(n[1].length,n[0].length-n[1].length),index=n.index+n[1].length;var s=new a({index:index,text:e,ref:t}),u=n[2].toLowerCase();u=void 0!==o.INTEGER_WORDS[u]?o.INTEGER_WORDS[u]:"einer"===u||"einem"===u?1:"einigen"===u?3:/halben/.test(u)?.5:parseInt(u);var l=r(t);return/stunde|min|sekunde/i.test(n[3])?(/stunde/i.test(n[3])?l=l.add(-u,"hour"):/min/i.test(n[3])?l=l.add(-u,"minute"):/sekunde/i.test(n[3])&&(l=l.add(-u,"second")),s.start.imply("day",l.date()),s.start.imply("month",l.month()+1),s.start.imply("year",l.year()),s.start.assign("hour",l.hour()),s.start.assign("minute",l.minute()),s.start.assign("second",l.second()),s.tags.DETimeAgoFormatParser=!0,s):/woche/i.test(n[3])?(l=l.add(-u,"week"),s.start.imply("day",l.date()),s.start.imply("month",l.month()+1),s.start.imply("year",l.year()),s.start.imply("weekday",l.day()),s):(/tag/i.test(n[3])&&(l=l.add(-u,"d")),/monat/i.test(n[3])&&(l=l.add(-u,"month")),/jahr/i.test(n[3])&&(l=l.add(-u,"year")),s.start.assign("day",l.date()),s.start.assign("month",l.month()+1),s.start.assign("year",l.year()),s)}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o=n(24).ParsedComponents,s=new RegExp("(^|\\s|T)(?:(?:um|von)\\s*)?(\\d{1,4}|mittags?|mitternachts?)(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:(?:\\:|\\\uff1a)(\\d{2}))?)?(?:\\s*uhr)?(?:\\s*(morgens|vormittags|mittags|nachmittags|abends|nachts))?(?=\\W|$)","i"),u=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301c|bis|\\?)\\s*(\\d{1,4})(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2})(?:(?:\\.|\\:|\\\uff1a)(\\d{1,2}))?)?(?:\\s*(morgens|vormittags|mittags|nachmittags|abends|nachts))?(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){if(n.index>0&&e[n.index-1].match(/\w/))return null;var s=r(t),l=new a;l.ref=t,l.index=n.index+n[1].length,l.text=n[0].substring(n[1].length),l.tags.DETimeExpressionParser=!0,l.start.imply("day",s.date()),l.start.imply("month",s.month()+1),l.start.imply("year",s.year());var c=0,d=0,h=-1;if(null!=n[4]){if((f=parseInt(n[4]))>=60)return null;l.start.assign("second",f)}if(/mittags?/i.test(n[2])?(h=1,c=12):/mitternachts?/i.test(n[2])?(h=0,c=0):c=parseInt(n[2]),null!=n[3]?d=parseInt(n[3]):c>100&&(d=c%100,c=parseInt(c/100)),d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[5]){if(c>12)return null;"morgens"===(p=n[5][0].toLowerCase())||"vormittags"===p?(h=0,12==c&&(c=0)):(h=1,12!=c&&(c+=12))}if(l.start.assign("hour",c),l.start.assign("minute",d),h>=0?l.start.assign("meridiem",h):c<12?l.start.imply("meridiem",0):l.start.imply("meridiem",1),!(n=u.exec(e.substring(l.index+l.text.length))))return l.text.match(/^\d+$/)?null:l;if(n[0].match(/^\s*(\+|\-)\s*\d{3,4}$/))return l;null==l.end&&(l.end=new o(null,l.start.date()));c=0,d=0,h=-1;if(null!=n[4]){var f;if((f=parseInt(n[4]))>=60)return null;l.end.assign("second",f)}if(c=parseInt(n[2]),null!=n[3]){if((d=parseInt(n[3]))>=60)return l}else c>100&&(d=c%100,c=parseInt(c/100));if(d>=60)return null;if(c>24)return null;if(c>=12&&(h=1),null!=n[5]){if(c>12)return null;var p;"morgens"===(p=n[5][0].toLowerCase())||"vormittags"===p?(h=0,12==c&&(c=0,l.end.isCertain("day")||l.end.imply("day",l.end.get("day")+1))):(h=1,12!=c&&(c+=12)),l.start.isCertain("meridiem")||(0==h?(l.start.imply("meridiem",0),12==l.start.get("hour")&&l.start.assign("hour",0)):(l.start.imply("meridiem",1),12!=l.start.get("hour")&&l.start.assign("hour",l.start.get("hour")+12)))}(l.text=l.text+n[0],l.end.assign("hour",c),l.end.assign("minute",d),h>=0)?l.end.assign("meridiem",h):l.start.isCertain("meridiem")&&1==l.start.get("meridiem")&&l.start.get("hour")>c?l.end.imply("meridiem",0):c>12&&l.end.imply("meridiem",1);return l.end.date().getTime()<l.start.date().getTime()&&l.end.imply("day",l.end.get("day")+1),l}}},function(e,t,n){const r=n(37);var i=n(31).Parser,a=n(24).ParsedResult,o={sonntag:0,so:0,montag:1,mo:1,dienstag:2,di:2,mittwoch:3,mi:3,donnerstag:4,do:4,freitag:5,fr:5,samstag:6,sa:6},s=new RegExp("(\\W|^)(?:(?:\\,|\\(|\\\uff08)\\s*)?(?:a[mn]\\s*?)?(?:(diese[mn]|letzte[mn]|n(?:\xe4|ae)chste[mn])\\s*)?("+Object.keys(o).join("|")+")(?:\\s*(?:\\,|\\)|\\\uff09))?(?:\\s*(diese|letzte|n(?:\xe4|ae)chste)\\s*woche)?(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return s},this.extract=function(e,t,n,i){var s=n.index+n[1].length,u=(e=n[0].substr(n[1].length,n[0].length-n[1].length),new a({index:s,text:e,ref:t})),l=n[3].toLowerCase(),c=o[l];if(void 0===c)return null;var d=r(t),h=n[2],f=n[4],p=d.day(),g=h||f;return g=(g=g||"").toLowerCase(),d=/letzte/.test(g)?d.day(c-7):/n(?:\xe4|ae)chste/.test(g)?d.day(c+7):/diese/.test(g)?i.forwardDate&&p>c?d.day(c+7):d.day(c):i.forwardDate&&p>c?d.day(c+7):!i.forwardDate&&Math.abs(c-7-p)<Math.abs(c-p)?d.day(c-7):!i.forwardDate&&Math.abs(c+7-p)<Math.abs(c-p)?d.day(c+7):d.day(c),u.start.assign("weekday",c),u.start.imply("day",d.date()),u.start.imply("month",d.month()+1),u.start.imply("year",d.year()),u}}},function(e,t,n){var r=n(37),i=n(31).Parser,a=n(24).ParsedResult,o=new RegExp("(\\W|^)(jetzt|(?:heute|diesen)\\s*(morgen|vormittag|mittag|nachmittag|abend)|(?:heute|diese)\\s*nacht|heute|(?:(?:\xfc|ue)ber)?morgen(?:\\s*(morgen|vormittag|mittag|nachmittag|abend|nacht))?|(?:vor)?gestern(?:\\s*(morgen|vormittag|mittag|nachmittag|abend|nacht))?|letzte\\s*nacht)(?=\\W|$)","i");t.Parser=function(){i.apply(this,arguments),this.pattern=function(){return o},this.extract=function(e,t,n,i){e=n[0].substr(n[1].length);const o=n.index+n[1].length,s=new a({index:o,text:e,ref:t}),u=r(t),l=e.toLowerCase();var c=u;/(?:heute|diese)\s*nacht/.test(l)?(s.start.imply("hour",22),s.start.imply("meridiem",1)):/^(?:\xfc|ue)bermorgen/.test(l)?c=c.add(u.hour()>1?2:1,"day"):/^morgen/.test(l)?u.hour()>1&&(c=c.add(1,"day")):/^gestern/.test(l)?c=c.add(-1,"day"):/^vorgestern/.test(l)?c=c.add(-2,"day"):/letzte\s*nacht/.test(l)?(s.start.imply("hour",0),u.hour()>6&&(c=c.add(-1,"day"))):"jetzt"===l&&(s.start.imply("hour",u.hour()),s.start.imply("minute",u.minute()),s.start.imply("second",u.second()),s.start.imply("millisecond",u.millisecond()));var d=n[3]||n[4]||n[5];if(d)switch(d.toLowerCase()){case"morgen":s.start.imply("hour",6);break;case"vormittag":s.start.imply("hour",9);break;case"mittag":s.start.imply("hour",12);break;case"nachmittag":s.start.imply("hour",15),s.start.imply("meridiem",1);break;case"abend":s.start.imply("hour",18),s.start.imply("meridiem",1);break;case"nacht":s.start.imply("hour",0)}return s.start.assign("day",c.date()),s.start.assign("month",c.month()+1),s.start.assign("year",c.year()),s.tags.DECasualDateParser=!0,s}}},function(e,t,n){var r=n(57).Refiner;t.Refiner=function(){r.call(this),this.refine=function(e,t,n){if(t.length<2)return t;for(var r=[],i=t[0],a=1;a<t.length;a++){var o=t[a];o.index<i.index+i.text.length?o.text.length>i.text.length&&(i=o):(r.push(i),i=o)}return null!=i&&r.push(i),r}}},function(e,t,n){var r=n(57).Refiner,i=new RegExp("^\\s*(GMT|UTC)?(\\+|\\-)(\\d{1,2}):?(\\d{2})","i");t.Refiner=function(){r.call(this),this.refine=function(e,t,n){return t.forEach((function(t){if(!t.start.isCertain("timezoneOffset")){var n=i.exec(e.substring(t.index+t.text.length));if(n){var r=60*parseInt(n[3])+parseInt(n[4]);"-"===n[2]&&(r=-r),null!=t.end&&t.end.assign("timezoneOffset",r),t.start.assign("timezoneOffset",r),t.text+=n[0],t.tags.ExtractTimezoneOffsetRefiner=!0}}})),t}}},function(e,t,n){var r=n(57).Refiner,i=new RegExp("^\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i"),a={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:60,CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:-300,FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:330,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:240,MST:-420,MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:-480,PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360};t.Refiner=function(e){r.call(this,arguments),this.refine=function(e,t,n){var r=new Object(a);if(n.timezones)for(var o in n.timezones)r[o]=n.timezones[o];return t.forEach((function(t){if(t.tags.ENTimeExpressionParser||t.tags.ZHTimeExpressionParser||t.tags.FRTimeExpressionParser||t.tags.DETimeExpressionParser){var n=i.exec(e.substring(t.index+t.text.length));if(n){var a=n[1].toUpperCase();if(void 0===r[a])return;var o=r[a];t.start.isCertain("timezoneOffset")||t.start.assign("timezoneOffset",o),null==t.end||t.end.isCertain("timezoneOffset")||t.end.assign("timezoneOffset",o),t.text+=n[0],t.tags.ExtractTimezoneAbbrRefiner=!0}}})),t}}},function(e,t,n){var r=n(37),i=n(57).Refiner;t.Refiner=function(){i.call(this),this.refine=function(e,t,n){return n.forwardDate?(t.forEach((function(e){var t=r(e.ref);if(e.start.isOnlyDayMonthComponent()&&t.isAfter(e.start.dayjs())){for(var n=0;n<3&&t.isAfter(e.start.dayjs());n++)e.start.imply("year",e.start.get("year")+1),e.end&&!e.end.isCertain("year")&&e.end.imply("year",e.end.get("year")+1);e.tags.ForwardDateRefiner=!0}e.start.isOnlyWeekdayComponent()&&t.isAfter(e.start.dayjs())&&(t=t.day()>e.start.get("weekday")?t.day(e.start.get("weekday")+7):t.day(e.start.get("weekday")),e.start.imply("day",t.date()),e.start.imply("month",t.month()+1),e.start.imply("year",t.year()),e.tags.ForwardDateRefiner=!0)})),t):t}}},function(e,t,n){var r=n(57).Filter;t.Refiner=function(){r.call(this),this.isValid=function(e,t,n){return!t.text.replace(" ","").match(/^\d*(\.\d*)?$/)}}},function(e,t,n){n(24).ParsedComponents;var r=n(57).Refiner,i=new RegExp("^\\s*(at|after|before|on|,|-|\\(|\\))?\\s*$");function a(e,t){var n=!1;return e.start.isCertain("year")&&(t.start.isCertain("year")?e.start.isCertain("month")&&(t.start.isCertain("month")?e.start.isCertain("day")&&!t.start.isCertain("day")&&(n=!0):n=!0):n=!0),n}function o(e,t,n){var r=e.substring(t.index+t.text.length,n.index),a=t.tags.ENRelativeDateFormatParser||n.tags.ENRelativeDateFormatParser,o=!t.start.isCertain("day")&&!t.start.isCertain("month")&&!t.start.isCertain("year");return t.start.isCertain("year")&&n.start.isCertain("year")&&(o=t.start.get("year")===n.start.get("year")),t.start.isCertain("month")&&n.start.isCertain("month")&&(o=t.start.get("month")===n.start.get("month")&&o),a&&r.match(i)&&o}function s(e,t,n){t.start,n.start;var r=Math.min(t.index,n.index),i=Math.max(t.index+t.text.length,n.index+n.text.length);for(var a in t.index=r,t.text=e.substring(r,i),n.tags)t.tags[a]=!0;return t.tags.ENPrioritizeSpecificDateRefiner=!0,t}t.Refiner=function(){r.call(this),this.refine=function(e,t,n){if(t.length<2)return t;for(var r=[],i=null,u=null,l=1;l<t.length;l++)i=t[l],a(u=t[l-1],i)&&o(e,u,i)?(u=s(e,u,i),i=null,l+=1):a(i,u)&&o(e,u,i)&&(u=s(e,i,u),i=null,l+=1),r.push(u);return null!=i&&r.push(i),r}}},function(e,t,n){var r=n(98).Refiner;t.Refiner=function(){r.call(this),this.pattern=function(){return/^\s*(\u304b\u3089|\u30fc)\s*$/i}}},function(e,t,n){var r=n(57).Refiner;t.Refiner=function(){r.call(this),this.pattern=function(){return/^\s*(\xe0|a|\-)\s*$/i},this.refine=function(e,t,n){if(t.length<2)return t;for(var r=[],i=null,a=null,o=1;o<t.length;o++)i=t[o],(a=t[o-1]).end||i.end||!this.isAbleToMerge(e,a,i)||(a=this.mergeResult(e,a,i),i=null,o+=1),r.push(a);return null!=i&&r.push(i),r},this.isAbleToMerge=function(e,t,n){var r=t.index+t.text.length,i=n.index;return e.substring(r,i).match(this.pattern())},this.isWeekdayResult=function(e){return e.start.isCertain("weekday")&&!e.start.isCertain("day")},this.mergeResult=function(e,t,n){if(!this.isWeekdayResult(t)&&!this.isWeekdayResult(n)){for(var r in n.start.knownValues)t.start.isCertain(r)||t.start.assign(r,n.start.get(r));for(var r in t.start.knownValues)n.start.isCertain(r)||n.start.assign(r,t.start.get(r))}if(t.start.date().getTime()>n.start.date()){var i=n;n=t,t=i}for(var a in t.end=n.start,n.tags)t.tags[a]=!0;var o=Math.min(t.index,n.index),s=Math.max(t.index+t.text.length,n.index+n.text.length);return t.index=o,t.text=e.substring(o,s),t.tags[this.constructor.name]=!0,t}}},function(e,t,n){n(24).ParsedComponents;var r=n(57).Refiner,i=n(91).mergeDateTimeComponent,a=new RegExp("^\\s*(T|\xe0|a|vers|de|,|-)?\\s*$");function o(e){return!e.start.isCertain("hour")||e.tags.FRCasualDateParser}function s(e){return!e.start.isCertain("month")&&!e.start.isCertain("weekday")}function u(e,t,n){return e.substring(t.index+t.text.length,n.index).match(a)}function l(e,t,n){var r=t.start,a=n.start,o=i(r,a);if(null!=t.end||null!=n.end){var s=null==t.end?t.start:t.end,u=null==n.end?n.start:n.end,l=i(s,u);null==t.end&&l.date().getTime()<o.date().getTime()&&(l.isCertain("day")?l.assign("day",l.get("day")+1):l.imply("day",l.get("day")+1)),t.end=l}t.start=o;var c=Math.min(t.index,n.index),d=Math.max(t.index+t.text.length,n.index+n.text.length);for(var h in t.index=c,t.text=e.substring(c,d),n.tags)t.tags[h]=!0;return t.tags.FRMergeDateAndTimeRefiner=!0,t}t.Refiner=function(){r.call(this),this.refine=function(e,t,n){if(t.length<2)return t;for(var r=[],i=null,a=null,c=1;c<t.length;c++)i=t[c],o(a=t[c-1])&&s(i)&&u(e,a,i)?(a=l(e,a,i),i=null,c+=1):o(i)&&s(a)&&u(e,a,i)&&(a=l(e,i,a),i=null,c+=1),r.push(a);return null!=i&&r.push(i),r}}},function(e,t,n){var r=n(98).Refiner;t.Refiner=function(){r.call(this),this.pattern=function(){return/^\s*(bis(?:\s*(?:am|zum))?|\-)\s*$/i}}},function(e,t,n){n(24).ParsedComponents;var r=n(57).Refiner,i=n(91).mergeDateTimeComponent,a=n(91).isDateOnly,o=n(91).isTimeOnly,s=new RegExp("^\\s*(T|um|am|,|-)?\\s*$");function u(e,t,n){return e.substring(t.index+t.text.length,n.index).match(s)}function l(e,t,n){var r=t.start,a=n.start,o=i(r,a);if(null!=t.end||null!=n.end){var s=null==t.end?t.start:t.end,u=null==n.end?n.start:n.end,l=i(s,u);null==t.end&&l.date().getTime()<o.date().getTime()&&(l.isCertain("day")?l.assign("day",l.get("day")+1):l.imply("day",l.get("day")+1)),t.end=l}t.start=o;var c=Math.min(t.index,n.index),d=Math.max(t.index+t.text.length,n.index+n.text.length);for(var h in t.index=c,t.text=e.substring(c,d),n.tags)t.tags[h]=!0;return t.tags.DEMergeDateAndTimeRefiner=!0,t}t.Refiner=function(){r.call(this),this.refine=function(e,t,n){if(t.length<2)return t;for(var r=[],i=null,s=null,c=1;c<t.length;c++)i=t[c],s=t[c-1],a(s)&&o(i)&&u(e,s,i)?(s=l(e,s,i),i=null,c+=1):a(i)&&o(s)&&u(e,s,i)&&(s=l(e,i,s),i=null,c+=1),r.push(s);return null!=i&&r.push(i),r}}},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}},function(e,t,n){"use strict";n.r(t),n.d(t,"fromText",(function(){return g})),n.d(t,"parseText",(function(){return p})),n.d(t,"isFullyConvertible",(function(){return _})),n.d(t,"toText",(function(){return m})),n.d(t,"toTextShort",(function(){return y}));var r=n(71),i=n(28),a=n(15),o=function(e,t){return-1!==e.indexOf(t)},s=function(e){return e.toString()},u=function(e,t,n){return t+" "+n+", "+e},l=function(){function e(e,t,n,i){if(void 0===t&&(t=s),void 0===n&&(n=r.a),void 0===i&&(i=u),this.text=[],this.language=n||r.a,this.gettext=t,this.dateFormatter=i,this.rrule=e,this.options=e.options,this.origOptions=e.origOptions,this.origOptions.bymonthday){var o=[].concat(this.options.bymonthday),l=[].concat(this.options.bynmonthday);o.sort((function(e,t){return e-t})),l.sort((function(e,t){return t-e})),this.bymonthday=o.concat(l),this.bymonthday.length||(this.bymonthday=null)}if(Object(a.f)(this.origOptions.byweekday)){var c=Object(a.d)(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],d=String(c);this.byweekday={allWeeks:c.filter((function(e){return!e.n})),someWeeks:c.filter((function(e){return Boolean(e.n)})),isWeekdays:-1!==d.indexOf("MO")&&-1!==d.indexOf("TU")&&-1!==d.indexOf("WE")&&-1!==d.indexOf("TH")&&-1!==d.indexOf("FR")&&-1===d.indexOf("SA")&&-1===d.indexOf("SU"),isEveryDay:-1!==d.indexOf("MO")&&-1!==d.indexOf("TU")&&-1!==d.indexOf("WE")&&-1!==d.indexOf("TH")&&-1!==d.indexOf("FR")&&-1!==d.indexOf("SA")&&-1!==d.indexOf("SU")};var h=function(e,t){return e.weekday-t.weekday};this.byweekday.allWeeks.sort(h),this.byweekday.someWeeks.sort(h),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return e.isFullyConvertible=function(t){if(!(t.options.freq in e.IMPLEMENTED))return!1;if(t.origOptions.until&&t.origOptions.count)return!1;for(var n in t.origOptions){if(o(["dtstart","wkst","freq"],n))return!0;if(!o(e.IMPLEMENTED[t.options.freq],n))return!1}return!0},e.prototype.isFullyConvertible=function(){return e.isFullyConvertible(this.rrule)},e.prototype.toString=function(t){var n=this.gettext;if(!(this.options.freq in e.IMPLEMENTED))return n("RRule error: Unable to fully convert this rrule to text");if(t&&this.options.freq===i.e.DAILY&&this.options.dtstart&&(this.options.until||this.options.count)){var r=this.options.until||new Date(this.options.dtstart).addDays(this.options.count),a=new Date(this.options.dtstart.getTime()+6e4*this.options.dtstart.getTimezoneOffset());return r=new Date(r.getTime()+6e4*r.getTimezoneOffset()),a.toString("MMM d")+" - "+r.toString("MMM d")}if(this.text=[n("every")],this[i.e.FREQUENCIES[this.options.freq]](t),!t){if(this.options.dtstart){this.add(n("from"));var o=this.options.dtstart,s=o.getUTCFullYear();this.add(o.getUTCMonth()+1+"/"+o.getUTCDate()+(s!==(new Date).getUTCFullYear()?"/"+s:""))}if(this.options.until){this.add(n("until"));s=(r=this.options.until).getUTCFullYear();this.add(r.getUTCMonth()+1+"/"+r.getUTCDate()+(s!==(new Date).getUTCFullYear()?"/"+s:""))}else this.options.count&&this.add(n("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?n("times"):n("time"));this.isFullyConvertible()||this.add(n("(~ approximate)"))}return this.text.join("")},e.prototype.HOURLY=function(){var e=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("hours"):e("hour"))},e.prototype.MINUTELY=function(){var e=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.add((this.plural(this.options.interval),e("minutes")))},e.prototype.DAILY=function(e){var t=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(this.plural(this.options.interval)?t("days"):t("day")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour()},e.prototype.WEEKLY=function(e){var t=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?t("weeks"):t("week")),this.byweekday&&this.byweekday.isWeekdays?1===this.options.interval?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(t("on")).add(t("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?t("days"):t("day")):(e&&(this.bymonthday||this.byweekday)||1!==this.options.interval||this.add(t("week")),!e&&this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday(e):this.byweekday&&this._byweekday(e)),this.origOptions.byhour&&this._byhour(e)},e.prototype.MONTHLY=function(e){var t=this.gettext;this.origOptions.bymonth?(1!==this.options.interval&&(this.add(this.options.interval.toString()).add(t("months")),this.plural(this.options.interval)&&this.add(t("in"))),this._bymonth()):(1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("months"):t("month"))),this.bymonthday?this._bymonthday(e):this.byweekday&&this.byweekday.isWeekdays?this.add(t("on")).add(t("weekdays")):this.byweekday&&this._byweekday(e)},e.prototype.YEARLY=function(e){var t=this.gettext;this.origOptions.bymonth?(1!==this.options.interval&&(this.add(this.options.interval.toString()),this.add(t("years"))),this._bymonth()):(1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("years"):t("year"))),this.bymonthday?this._bymonthday(e):this.byweekday&&this._byweekday(e),this.options.byyearday&&this.add(t("on the")).add(this.list(this.options.byyearday,this.nth,t("and"))).add(t("day")),this.options.byweekno&&this.add(t("in")).add(this.plural(this.options.byweekno.length)?t("weeks"):t("week")).add(this.list(this.options.byweekno,void 0,t("and")))},e.prototype._bymonthday=function(e){var t=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,t("or"))).add(t("the")).add(this.list(this.bymonthday,this.nth,t("or"))):(e||this.add(t("on the")),this.add(this.list(this.bymonthday,this.nth,t("and"))))},e.prototype._byweekday=function(e){var t=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&(e||this.add(t("on")),this.add(this.list(this.byweekday.allWeeks,this.weekdaytext))),this.byweekday.someWeeks&&(!e&&this.byweekday.allWeeks&&this.add(t("and")),e||this.add(t("on the")),this.add(this.list(this.byweekday.someWeeks,this.weekdaytext,t("and"))))},e.prototype._byhour=function(e){var t=this.gettext,n=(this.origOptions.byminute&&isNaN(this.origOptions.byminute)?this.origOptions.byminute[0]:this.origOptions.byminute)||"";n&&(+n<10&&(n="0"+n),n=":"+n);var r=this.origOptions.byhour;isNaN(r)||(r=[r]);var i=r.map((function(e){return(0===e?12:e>12?e-12:e)+n+(e>11?"pm":"am")}));e||this.add(t("at")),this.add(this.list(i,void 0,t("and")))},e.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},e.prototype.nth=function(e){var t,n;e=parseInt(e.toString(),10);var r=this.gettext;if(-1===e)return r("last");switch(n=Math.abs(e)){case 1:case 21:case 31:t=n+r("st");break;case 2:case 22:t=n+r("nd");break;case 3:case 23:t=n+r("rd");break;default:t=n+r("th")}return e<0?t+" "+r("last"):t},e.prototype.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.prototype.monthtext=function(e){return this.capitalizeFirstLetter(this.language.monthNames[e-1])},e.prototype.weekdaytext=function(e){var t=Object(a.e)(e)?(e+1)%7:e.getJsWeekday();return(e.n?this.nth(e.n)+" ":"")+this.capitalizeFirstLetter(this.language.dayNames[t])},e.prototype.plural=function(e){return e%100!==1},e.prototype.add=function(e){return this.text.push(" "),this.text.push(e),this},e.prototype.list=function(e,t,n,r){void 0===r&&(r=","),Object(a.d)(e)||(e=[e]);t=t||function(e){return e.toString()};var i=this,o=function(e){return t&&t.call(i,e)};return n?function(e,t,n){for(var r="",i=0;i<e.length;i++)0!==i&&(i===e.length-1?r+=" "+n+" ":r+=t+" "),r+=e[i];return r}(e.map(o),r,n):e.map(o).join(r+" ")},e}(),c=n(88),d=n.n(c),h={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10},f=function(){function e(e){this.done=!0,this.rules=e}return e.prototype.start=function(e){return this.text=e,this.done=!1,this.nextSymbol()},e.prototype.isDone=function(){return this.done&&null===this.symbol},e.prototype.nextSymbol=function(){var e,t;this.symbol=null,this.value=null;do{if(this.done)return!1;for(var n in e=null,this.rules){var r=this.rules[n].exec(this.text);r&&(null===e||r[0].length>e[0].length)&&(e=r,t=n)}if(null!=e&&(this.text=this.text.substr(e[0].length),""===this.text&&(this.done=!0)),null==e)return this.done=!0,this.symbol=null,void(this.value=null)}while("SKIP"===t);return this.symbol=t,this.value=e,!0},e.prototype.accept=function(e){if(this.symbol===e){if(this.value){var t=this.value;return this.nextSymbol(),t}return this.nextSymbol(),!0}return!1},e.prototype.acceptNumber=function(){var e=this.accept("number");if(!e)if(e=this.accept("numberAsText")){var t=h[e[0]];e=isNaN(t)?void 0:[t]}else(e=this.accept("time"))&&(e=isNaN(+e[0])?void 0:[+e[0]]);return e},e.prototype.expect=function(e){return!!this.accept(e)},e}();function p(e,t){void 0===t&&(t=r.a);var n,a,o={},s=new f(t.tokens),u=!1;return e=e.trim(),s.start(e)?!1!==function(){var t,r,a,u=s.expect("every");if(u){(a=s.accept("other"))&&(o.interval=2);var c=s.acceptNumber();c?o.interval=parseInt(c[0],10):(t=v())&&(o.interval||(t<0?r=!0:o.interval=t))}else{var f=d.a.parse(e,void 0,{forwardDate:!0})[0];f&&0===f.index&&s.start("from "+e),"starting"===s.symbol&&(o.freq=i.e.DAILY)}(s.isDone()||"starting"===s.symbol||"until"===s.symbol)&&t&&(o.freq=i.e.MONTHLY,o.bymonthday=[t],a||delete o.interval);if(s.isDone())return!!t;switch(s.symbol){case"day(s)":o.interval<0?(o.freq=i.e.MONTHLY,o.bymonthday=[t],delete o.interval):o.freq=i.e.DAILY,s.nextSymbol()&&(h(),y());break;case"weekday(s)":o.freq=i.e.WEEKLY,o.byweekday=[i.e.MO,i.e.TU,i.e.WE,i.e.TH,i.e.FR],s.nextSymbol()&&(h(),y());break;case"week(s)":o.freq=i.e.WEEKLY,s.nextSymbol()&&(l(),h(),y());break;case"hour(s)":o.freq=i.e.HOURLY,s.nextSymbol()&&(l(),y());break;case"minute(s)":o.freq=i.e.MINUTELY,s.nextSymbol()&&(l(),y());break;case"month(s)":o.freq=i.e.MONTHLY,s.nextSymbol()&&(l(),h(),y());break;case"year(s)":o.freq=i.e.YEARLY,s.nextSymbol()&&(l(),h(),y());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":var b=s.symbol.substr(0,2).toUpperCase();if(r?(o.freq=i.e.MONTHLY,o.byweekday=[i.e[b].nth(-1)]):(o.freq=i.e.WEEKLY,o.byweekday=[i.e[b]]),!s.nextSymbol())return;for(;g()||s.accept("comma");){if(s.isDone())return!1;var w=g();if(!w)return!1;o.byweekday.push(i.e[w]),s.nextSymbol()}m(),h(),y();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(o.freq=i.e.YEARLY,o.bymonth=[p()],o.interval?(o.bymonthday=[o.interval],delete o.interval):o.bymonthday=[1],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())return!1;var k=p();if(!k)return!1;o.bymonth.push(k),s.nextSymbol()}m(),l(),h(),y();break;case"morning":o.freq=i.e.DAILY,o.byhour=[9];break;case"night":o.freq=i.e.DAILY,o.byhour=[19];break;case"starting":case"until":o.freq&&y();break;default:return!1}if(_(),!u&&(!o.until||!n))return!1;return!0}()&&!u&&{options:o,fromDate:n,duration:a}:null;function l(){var e=s.accept("on"),t=s.accept("the");if(e||t||"nth"===s.symbol)do{var n=v(),r=g(),a=p();if(n)r?(s.nextSymbol(),o.byweekday||(o.byweekday=[]),o.byweekday.push(i.e[r].nth(n))):(o.bymonthday=[n],s.accept("day(s)"));else if(r)s.nextSymbol(),o.byweekday||(o.byweekday=[]),o.byweekday.push(i.e[r]);else if("weekday(s)"===s.symbol)s.nextSymbol(),o.byweekday||(o.byweekday=[i.e.MO,i.e.TU,i.e.WE,i.e.TH,i.e.FR]);else if("week(s)"===s.symbol){s.nextSymbol();var u=s.acceptNumber();if(!u)return!1;for(o.byweekno=[parseInt(u[0],10)];s.accept("comma");){if(!(u=s.acceptNumber()))return!1;o.byweekno.push(parseInt(u[0],10))}}else{if(!a)return;s.nextSymbol(),o.bymonth||(o.bymonth=[]),o.bymonth.push(a)}}while(s.accept("comma")||s.accept("the")||s.accept("on"))}function c(e){var t;if(1===e.length)t=parseInt(e[0],10),o.byhour?o.byhour.push(t):o.byhour=[t];else{var n=+e[1],r=e[2];e[3];n<=24&&(e&&e.indexOf("pm")>0&&n<12&&(n+=12),o.byhour?o.byhour.push(n):o.byhour=[n],r&&!isNaN(+r)&&+r>0&&(o.byminute?o.byminute.push(+r):o.byminute=[+r]))}}function h(){if(s.accept("at")||"time"===s.symbol){do{var e=s.accept("time");if(!e)return!1;for(c(e);s.accept("comma");){if(!(e=s.accept("time")))return!1;c(e)}}while(s.accept("comma")||s.accept("at"));_()}}function p(){switch(s.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function g(){switch(s.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return s.symbol.substr(0,2).toUpperCase();default:return!1}}function v(){switch(s.symbol){case"last":return s.nextSymbol(),-1;case"first":return s.nextSymbol(),1;case"second":return s.nextSymbol(),s.accept("last")?-2:2;case"third":return s.nextSymbol(),s.accept("last")?-3:3;case"nth":case"number":var e=parseInt(s.value[1],10);return!(e<-366||e>366)&&(s.nextSymbol(),s.accept("last")?-e:e);default:return!1}}function m(){s.accept("on"),s.accept("the");var e=v()||s.accept("number");if(e)for(o.bymonthday=[e];s.accept("comma");){if(!(e=v()||s.accept("number")))return!1;o.bymonthday.push(e),s.nextSymbol()}}function y(){if("until"===s.symbol||"starting"===s.symbol){var e=s.text,t=void 0;"starting"===s.symbol&&((t=e.indexOf("until"))<0&&(t=e.indexOf("til")),t>0&&(e=e.substring(0,t))),e=(e=e.replace(/\./g,"/")).replace(/(\d{1,4}\.?\d?)\s?(h(?:ou)?r?|m(?:in)?)/,"");var r=d.a.parse(e,void 0,{forwardDate:!0})[0];if(r){var i=Date.parse(r.text);if(i){var a=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate()));if("until"===s.symbol?o.until=a:n=a,i.hasTimeOfDay()){var l=i.getHours(),h=i.getMinutes();c([l+h,l,h])}s.text=s.text.substring(r.text.length+r.index),t>0?(s.nextSymbol(),y()):s.isDone()||(s.nextSymbol(),y())}}else u=!0}else s.accept("for")&&(o.count=parseInt(s.value[0],10),s.expect("number"))}function _(){var e=s.accept("duration");e&&(a=+e[1]*("h"===e[2][0]?60:1))}}var g=function(e,t){return void 0===t&&(t=r.a),new i.e(p(e,t)||void 0)},v=["count","until","interval","byweekday","bymonthday","bymonth"];l.IMPLEMENTED=[],l.IMPLEMENTED[i.e.HOURLY]=v,l.IMPLEMENTED[i.e.MINUTELY]=v,l.IMPLEMENTED[i.e.DAILY]=["byhour"].concat(v),l.IMPLEMENTED[i.e.WEEKLY]=v,l.IMPLEMENTED[i.e.MONTHLY]=v,l.IMPLEMENTED[i.e.YEARLY]=["byweekno","byyearday"].concat(v);var m=function(e,t,n,r){return new l(e,t,n,r).toString()},y=function(e){return new l(e).toString(!0)},_=l.isFullyConvertible},function(e,t,n){"use strict";n.r(t);var r=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|inert|itemProp|itemScope|itemType|itemID|itemRef|on|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,i=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){return r.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91}));t.default=i}]);
//# sourceMappingURL=preload.worker-1610169678972.js.map