(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{802:function(e,t,r){"use strict";r.r(t);var a=r(0),o=r(1),s=r(13),i=r(18),l=r(6),n=r(88),d=r(3),c=r(31),u=r(55),p=r(53),h=r(56);function f(e){return e.toString(d.default.International.getFormat(o.a.DFormat.MonthDay))}t.default=class{constructor(){["wunderlist","opml","json","gtasks","trello","todoist"].forEach(e=>this.register(e))}register(e){let t={login:this[e+"Login"].bind(this),import:this[e+"Import"].bind(this),save:this[e+"Save"].bind(this)};this[e+"Preload"]&&(t.preload=this[e+"Preload"].bind(this)),this[e]=t}wunderlistLogin(e,t,r,s){try{a.default.PAssert(1157,r,"Wunderlist requires a success callback")}catch(u){a.default.reportError(u)}try{a.default.PAssert(1158,s,"Wunderlist requires an error callback")}catch(u){a.default.reportError(u)}var i="localhost"===window.location.hostname?"f06a1334e250a9bb0b03":"ad988eeb954e9aabc288",l=window.location.protocol+"//"+window.location.host+"/oauthRelay.html";this.wunderlist.clientId=i;var n="Dchs"+(new Date).getTime(),d="https://www.wunderlist.com/oauth/authorize?client_id="+i+"&redirect_uri="+l+"&state="+n;window.open(d,"modal-wunderlist","height=600,width=550");var c=e=>{var t=a.default.getLocationOrigin(),i=!1;try{i=e.data.state===n}catch(d){a.default.reportError(d)}if(t&&i)if(window.removeEventListener("message",c),e.data.error)s("Error authenticating with Wunderlist");else{var l=e.data.code;l&&a.default.XHR_PrivateAPI({type:"POST",path:"/private/v1/oauth/wunderlist",data:{code:l},requireAuth:!0,cb:e=>{if(a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("Wunderlist Login Reponse: ",e),200===e.status){try{var t=JSON.parse(e.response).data;this.wunderlist.token=t.access_token}catch(d){s("Error parsing response from remote server.",d)}this.wunderlist.token?r():s("Invalid username or password.")}else s("Error contacting remote server.")}})}};window.addEventListener("message",c)}wunderlistImport(e,t){try{a.default.PAssert(1159,e,"Wunderlist requires a success callback")}catch(i){a.default.reportError(i)}try{a.default.PAssert(1160,t,"Wunderlist requires an error callback")}catch(i){a.default.reportError(i)}let r={inbox:{title:"inbox",items:{},p:0}},s=0;this.wunderlistGetLists(i=>{var l=0;a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("Get ListData Response: ",i);for(var n=0;n<i.length;++n){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;let d=i[n];r[d.id]={title:d.title,items:{},p:d.position},this.wunderlistGetTasks(d.id,l=>{var n=0;a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("Get TaskData Response: ",l);for(let e=0;e<l.length;++e){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;let t=l[e];if(t.parent_id){let e=r[t.list_id].items[t.parent_id];e?(e.items||(e.items=[]),e.items.push(t)):r[t.list_id].items[t.parent_id]={items:[t]}}else{let e=r[t.list_id].items[t.id];r[t.list_id].items[t.id]=t,e&&(r[t.list_id].items[t.id].items=e.items)}}this.wunderlistGetSubtasks(d.id,t=>{for(var a=0,o=0;o<t.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;let e=t[o],s=r[e.list_id];if(s)if(e.parent_id){let t=s.items[e.parent_id];t?(t.items||(t.items=[]),t.items.push(e)):s.items[e.parent_id]={items:[e]}}else{let t=s.items[e.id];s.items[e.id]=e,t&&(s.items[e.id].items=t.items)}}++s===i.length&&e(r)},t)},t)}},t)}wunderlistGetLists(e,t){try{a.default.PAssert(1161,e,"Wunderlist requires a success callback")}catch(r){a.default.reportError(r)}try{a.default.PAssert(1162,t,"Wunderlist requires an error callback")}catch(r){a.default.reportError(r)}a.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/lists",headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId}}).then(async r=>{if(200===r.status){var s;try{s=await r.json()}catch(i){t("There was an error parsing your Wunderlist data. The developers have been notified with details of the error.",i)}e(s)}else a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("XHR Status: "+r.status),t("Error contacting remote server.")})}wunderlistGetTasks(e,t,r){try{a.default.PAssert(1163,t,"Wunderlist requires a success callback")}catch(s){a.default.reportError(s)}try{a.default.PAssert(1164,r,"Wunderlist requires an error callback")}catch(s){a.default.reportError(s)}a.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/tasks?list_id="+e,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId}}).then(async e=>{if(200===e.status){var s=await e.json();t(s)}else a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("XHR Status: "+e.status),r("Error contacting remote server.")})}wunderlistGetSubtasks(e,t,r){try{a.default.PAssert(1165,t,"Wunderlist requires a success callback")}catch(s){a.default.reportError(s)}try{a.default.PAssert(1166,r,"Wunderlist requires an error callback")}catch(s){a.default.reportError(s)}a.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/subtasks?list_id="+e,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId}}).then(async e=>{if(200===e.status){var s=await e.json();t(s)}else a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("XHR Status: "+e.status),r("Error contacting remote server.")})}wunderlistSave(e,t,r){try{a.default.PAssert(1167,t,"Wunderlist requires a success callback")}catch(n){a.default.reportError(n)}try{a.default.PAssert(1168,r,"Wunderlist requires an error callback")}catch(n){a.default.reportError(n)}try{l.d.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();let u=this.createDocument("Wunderlist import");var i=u.getRootItem();try{a.default.PAssert(1169,i,"Root item must exist in order to import")}catch(n){a.default.reportError(n)}Object.keys(e).forEach(t=>{var r=e[t];a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("List: ",r);var l=r.title,n=s.a.createVMLI({text:l},{parent:i,changeType:o.a.ChangeType.AllLocal,documentOwner:u});i.insertItem(n,0),Object.keys(r.items).forEach(e=>{var t=r.items[e];a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("  Task: ",t);var i=s.a.createVMLI({text:t.title,isComplete:!!t.completed_at,dateCompleted:t.completed_at,isStarred:t.starred},{parent:n,changeType:o.a.ChangeType.AllLocal,documentOwner:u});if(n.insertItem(i),t.note){var l=s.a.createVMLI({text:t.note},{parent:i,changeType:o.a.ChangeType.AllLocal,documentOwner:u});i.insertItem(l)}if(t.items)for(var d=0,c=0;c<t.items.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var p=t.items[c];a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("    SubTask: ",p);var h=s.a.createVMLI({text:p.title,isComplete:!!p.completed_at,dateCompleted:p.completed_at,isStarred:p.starred},{parent:i,changeType:o.a.ChangeType.AllLocal,documentOwner:u});i.insertItem(h)}})}),u.parseAll(o.a.ChangeType.Local|o.a.ChangeType.All),this.saveDocument(u),d.default.PaneUpdateBatcher.commitUpdateItems(),l.d.endAction(),t()}catch(c){r(void 0,c)}}opmlLogin(e,t,r,o){try{a.default.PAssert(1170,r,"OPML requires a success callback")}catch(i){a.default.reportError(i)}try{a.default.PAssert(1171,o,"OPML requires an error callback")}catch(i){a.default.reportError(i)}var s=document.getElementById("importFileUploadButton");s.onchange=r,s.click()}opmlImport(e,t){try{a.default.PAssert(1172,e,"OPML requires a success callback")}catch(s){a.default.reportError(s)}try{a.default.PAssert(1173,t,"OPML requires an error callback")}catch(s){a.default.reportError(s)}try{var r=new FileReader,o=document.forms.importFileUpload.importFile.files[0];o?(r.onload=r=>{var a=r.target.result;let o=this.opmlToDocument(a,"OPML Import");!0===o?e():t(o)},r.onerror=t,r.readAsText(o)):t("You must select a file before importing.")}catch(i){t(void 0,i)}}opmlSave(e,t,r){try{a.default.PAssert(1174,t,"OPML requires a success callback")}catch(s){a.default.reportError(s)}try{a.default.PAssert(1175,r,"OPML requires an error callback")}catch(s){a.default.reportError(s)}a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("OPML Save: ",e),t()}opmlToDocument(e,t){if(!e)return"Please enter your OPML in the box above.";var r;if((e.startsWith("<?xml ")||e.startsWith("<?opml ")||e.startsWith("<opml "))&&(r=a.default.loadXML(e)),r){l.d.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();let e=this.createDocument(t);var o=e.getRootItem();try{a.default.PAssert(1176,o,"Root item must exist in order to import")}catch(i){a.default.reportError(i)}var s=n.a.parseOPML(r,o);return this.saveDocument(e),d.default.PaneUpdateBatcher.commitUpdateItems(),l.d.endAction(),!!s||"Error parsing OPML. Please validate your data."}return"Unable to load XML lib. Please update or try another browser."}jsonLogin(e,t,r,o){try{a.default.PAssert(1177,r,"JSON requires a success callback")}catch(l){a.default.reportError(l)}try{a.default.PAssert(1178,o,"JSON requires an error callback")}catch(l){a.default.reportError(l)}var s=document.getElementById("importFileUploadButton"),i=!1;s.onchange=function(e){i=!0,r(e)},s.click(),document.body.onfocus=()=>{setTimeout(()=>{i||o(!1),document.body.onfocus=void 0},1e3)}}jsonImport(e,t){try{var r=new FileReader,a=document.forms.importFileUpload.importFile.files[0];a?(r.onload=r=>{var a=r.target.result;if(!a)return t("Unable to import your requested file. Please try a different file.");try{var o=JSON.parse(a)}catch(c){return t("The JSON is not properly formatted. Please re-validate or send the file to support@moo.do.")}try{n.a.parseJSON(o,!0).then(r=>{if(r){r.text=r.text||"Imported document",l.d.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems(),r.items&&r.items.forEach(e=>{i.a.cacheItem(e)});let e=u.a.create(r);s.a.addDocument(e),d.default.PaneUpdateBatcher.commitUpdateItems(),l.d.endAction()}return r?e():t("Invalid JSON format. The developers have been notified with details of the error.")})}catch(p){return t("The JSON file has errors. The developers have been notified with details of the error.",p)}},r.onerror=t,r.readAsText(a)):t("You must select a file before importing.")}catch(o){t(void 0,o)}}jsonSave(e,t,r){try{a.default.PAssert(1179,t,"JSON requires a success callback")}catch(o){a.default.reportError(o)}try{a.default.PAssert(1180,r,"JSON requires an error callback")}catch(o){a.default.reportError(o)}t()}gtasksLogin(e,t,r,s){try{a.default.PAssert(1185,r,"GTasks requires a success callback")}catch(i){a.default.reportError(i)}try{a.default.PAssert(1186,s,"GTasks requires an error callback")}catch(i){a.default.reportError(i)}c.a.authAccountTemp([o.a.GScope.TasksRO],e=>{e&&!e.error?(this.gtasks.token=e.access_token,r(e)):(a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("Error getting Google TaskRO permission: ",e),s("Unable to authenticate with Google. Please try again.",e))})}gtasksImport(e,t){try{a.default.PAssert(1187,e,"GTasks requires a success callback")}catch(o){a.default.reportError(o)}try{a.default.PAssert(1188,t,"GTasks requires an error callback")}catch(o){a.default.reportError(o)}var r={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(s=>{var i=0;try{a.default.PAssert(1189,a.default.isArray(s),"List data must be an array")}catch(o){a.default.reportError(o)}for(var l=s.length,n=0,d=0;d<s.length;++d){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=s[d];r.remoteItems[c.id]={id:c.id,text:c.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},r.roots.push(c.id),this.gtasksGetTasks(c,(s,i)=>{if(s){try{a.default.PAssert(1190,a.default.isArray(s),"List data must be an array")}catch(o){a.default.reportError(o)}if(a.default.isArray(s)){for(var d=0,c=0;c<s.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var u=s[c];if(u&&"completed"!==u.status){r.remoteItems[u.id]={id:u.id,text:u.title,isComplete:"completed"===u.status,dateCompleted:u.completed?new Date(u.completed):void 0,isArchived:u.hidden,due:u.due?new Date(u.due):void 0,notes:u.notes,parent:u.parent||i.id,items:[]};var p=r.remoteItems[u.parent||i.id];p?p.items.push(u.id):r.unassigned.push(u.id)}}++n===l&&e(r)}else t("Invalid task list returned.")}else n++},t)}},t)}gtasksGetLists(e,t){try{a.default.PAssert(1191,e,"GTasks requires a success callback")}catch(r){a.default.reportError(r)}try{a.default.PAssert(1192,t,"GTasks requires an error callback")}catch(r){a.default.reportError(r)}a.default.XHR({type:"GET",url:`https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults=2000&key=${o.a.APIKey}&access_token=${this.gtasks.token}`}).then(async s=>{if(200===s.status)try{var i=await s.json();try{a.default.PAssert(1193,i&&i.items,"Must have a valid set of data to get tasks from")}catch(r){a.default.reportError(r)}i&&i.items?e(i.items):t("Error getting data from remote server.")}catch(l){t(l)}else a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("XHR Status: "+s.status),t("Error contacting remote server.")})}gtasksGetTasks(e,t,r){try{a.default.PAssert(1194,e,"GTasks requires a valid list to get tasks from")}catch(s){a.default.reportError(s)}try{a.default.PAssert(1195,t,"GTasks requires a success callback")}catch(s){a.default.reportError(s)}try{a.default.PAssert(1196,r,"GTasks requires an error callback")}catch(s){a.default.reportError(s)}a.default.XHR({type:"GET",url:`https://www.googleapis.com/tasks/v1/lists/${e.id}/tasks?maxResults=2500&key=${o.a.APIKey}&access_token=${this.gtasks.token}`}).then(async i=>{if(200===i.status)try{var l=await i.json();try{a.default.PAssert(1197,l,"Must have a valid array of tasks")}catch(s){a.default.reportError(s)}l&&l.items?t(l.items,e):t([],e)}catch(n){r(n)}else a.default.shouldLog(o.a.LogLevels.Import)&&a.default.log("XHR Status: "+i.status),r("Error contacting remote server.")})}gtasksSave(e,t,r){try{a.default.PAssert(1198,t,"GTasks requires a success callback")}catch(c){a.default.reportError(c)}try{a.default.PAssert(1199,r,"GTasks requires an error callback")}catch(c){a.default.reportError(c)}try{var i=0;try{a.default.PAssert(1200,0===e.unassigned.length,"We should never have unassigned tasks")}catch(c){a.default.reportError(c)}l.d.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();let p=this.createDocument("Google Tasks import");var n=p.getRootItem();try{a.default.PAssert(1201,n,"Root item must exist in order to import")}catch(c){a.default.reportError(c)}let h=(t,r)=>{var a=0,i=t.text;t.due&&(i+=" @"+f(t.due));var l=s.a.createVMLI({text:i,isComplete:t.isComplete,dateCompleted:t.dateCompleted?t.dateCompleted.getTime():t.dateCompleted,isArchived:t.isArchived},{parent:r,changeType:o.a.ChangeType.AllLocal,documentOwner:p});if(r.insertItem(l),t.notes){var n=s.a.createVMLI({text:t.notes,isNote:!0},{parent:l,changeType:o.a.ChangeType.AllLocal,documentOwner:p});l.setNote(n,o.a.ChangeType.Local)}for(let o=0;o<t.items.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;h(e.remoteItems[t.items[o]],l)}};for(let t=0;t<e.roots.length;++t){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;h(e.remoteItems[e.roots[t]],n)}p.parseAll(o.a.ChangeType.Local|o.a.ChangeType.All),this.saveDocument(p),d.default.PaneUpdateBatcher.commitUpdateItems(),l.d.endAction(),t()}catch(u){r(void 0,u)}}trelloPreload(e,t){window.Trello||this.trello.isLoading?e():(this.trello.isLoading=!0,a.default.addScript("https://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",()=>{a.default.addScript("https://api.trello.com/1/client.js?key=667ecf0c3d3e029c51d205b7173f6c38","trelloScript",()=>{this.trello.isLoading=!1;try{a.default.PAssert(1202,window.Trello,"The Trello client lib must have been loaded correctly")}catch(r){a.default.reportError(r)}window.Trello?e():t("Error loading Trello. Please try again.")},e=>{this.trello.isLoading=!1,t(e)})},e=>{this.trello.isLoading=!1,t(e)}))}trelloLogin(e,t,r,o){try{a.default.PAssert(1203,window.Trello,"The Trello client lib was not properly loaded")}catch(s){a.default.reportError(s)}window.Trello?window.Trello.authorize({type:"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:r,error:o}):o("Error loading Trello. Please try again.")}trelloImport(e,t){var r=[];window.Trello.get("members/me/boards",a.default.wrapFn(a=>{var o=0,s=(a=a||[]).length,i=0;function l(){s===i&&e(r)}function n(e){i++,l()}for(var d=0;d<a.length;++d){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=a[d];if(c.closed)s--;else{var u={text:c.name,items:[]};r.push(u),this._handleBoard(u,c.id,t,n)}}l()},t),t)}_handleBoard(e,t,r,o){window.Trello.get("boards/"+t+"/lists",a.default.wrapFn(t=>{var a=0,s=0,i=t.length;function l(){s===i&&o()}function n(){s++,l()}for(var d=0;d<t.length;++d){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=t[d];if(c.closed)i--;else{var u={text:c.name,items:[]};e.items.push(u),this._handleList(u,c.id,r,n)}}l()},r),r)}_handleList(e,t,r,s){window.Trello.get("lists/"+t+"/cards",a.default.wrapFn(t=>{var a=0,i=0,l=t.length;function n(){i===l&&s()}function d(){i++,n()}for(var c=0;c<t.length;++c){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=t[c];if(u.closed)l--;else{var p={text:u.name};if(u.labels&&u.labels.length>0){for(var h=0,f="",m=0;m<u.labels.length;++m){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var g=u.labels[m];f+=o.a.TagPrefix+(g.name.length>0?g.name:g.color)+" "}p.text=f+p.text}if(u.due&&(u.date=new Date(u.due)),u.desc&&u.desc.length>0){var v=0;p.items=[];var w=u.desc.split("\n");for(m=0;m<w.length;++m){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var L=w[m];L&&L.length>0&&p.items.push({text:L})}}if(u.idChecklists&&u.idChecklists.length>0){var y=0;for(p.items||(p.items=[]),m=0;m<u.idChecklists.length;++m){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;this._handleChecklist(p,u.idChecklists[m],r,d)}}else i++;e.items.push(p)}}n()},r),r)}_handleChecklist(e,t,r,o){window.Trello.get("checklists/"+t+"/",a.default.wrapFn(function(t){for(var r=0,a={text:t.name,isCollapsed:!0,items:[]},s=0;s<t.checkItems.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var i=t.checkItems[s],l="complete"===i.state;if(!l){var n={text:i.name,isComplete:l};a.items.push(n)}}e.items.push(a),o()},r),r)}trelloSave(e,t,r){try{var i=0;l.d.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();let t=this.createDocument("Trello import"),p=(e,r)=>{var a=s.a.createVMLI({text:e.text,isComplete:e.isComplete,isCollapsed:e.isCollapsed},{parent:r,changeType:o.a.ChangeType.AllLocal,documentOwner:t});if(r.insertItem(a),e.items){var i=0;for(let t=0;t<e.items.length;++t){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;p(e.items[t],a)}}return a};var n=t.getRootItem();try{a.default.PAssert(1204,n,"Root item must exist in order to import")}catch(c){a.default.reportError(c)}for(let r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;p(e[r],n)}this.saveDocument(t),d.default.PaneUpdateBatcher.commitUpdateItems(),l.d.endAction()}catch(u){return r(u)}t()}todoistLogin(e,t,r,o){try{a.default.PAssert(1205,r,"Todoist requires a success callback")}catch(n){a.default.reportError(n)}try{a.default.PAssert(1206,o,"Todoist requires an error callback")}catch(n){a.default.reportError(n)}var s="Dchs"+(new Date).getTime(),i="https://todoist.com/oauth/authorize?client_id=de93a2f2c51d4e2fa0412a79f88c7960&scope=data:read&state="+s;window.open(i,"modal-todoist","height=600,width=550");var l=e=>{var t=a.default.getLocationOrigin(),i=!1;try{i=e.data.state===s}catch(d){a.default.reportError(d)}if(t&&i)if(window.removeEventListener("message",l),e.data.error)o("Error authenticating with Todoist");else{var n=e.data.code;n&&h.a.todoistImport(n).then(e=>{e.error?o("Error parsing response from remote server.",e.error):(console.log(e.value),this.todoist.data=e.value,r())})}};window.addEventListener("message",l)}todoistImport(e,t){var r=0,o=0;try{a.default.PAssert(1207,e,"Todoist requires a success callback")}catch(n){a.default.reportError(n)}try{a.default.PAssert(1208,t,"Todoist requires an error callback")}catch(n){a.default.reportError(n)}let s=this.todoist.data,i={};for(let a=0;a<s.projects.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;let e=s.projects[a];e.is_archived||e.is_deleted||(i[e.id]={id:e.id,name:e.name,items:[],itemMap:{},parent_id:e.parent_id,item_order:e.item_order})}var l=[];for(let a=0;a<s.items.length;++a){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;let e=s.items[a];!i[e.project_id]||e.is_deleted||e.is_archived||e.checked||(!e.parent_id&&a>0&&!isNaN(e.indent)&&e.indent>1&&l[e.indent-1]&&(e.parent_id=l[e.indent-1].id),i[e.project_id].items.push(e),i[e.project_id].itemMap[e.id]=e,isNaN(e.indent)||(l[e.indent]=e))}e(i)}todoistSave(e,t,r){var i=[o.a.VMLIFlag.None,o.a.VMLIFlag.None,o.a.VMLIFlag.P2,o.a.VMLIFlag.P1,o.a.VMLIFlag.P0];try{l.d.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();let t=this.createDocument("Todoist import");var n=t.getRootItem();try{a.default.PAssert(1209,n,"Root item must exist in order to import")}catch(L){a.default.reportError(L)}var c={},u={},h=(e,t)=>{var r=u[e.id],a=u[t.id];return r.item_order-a.item_order},m=(e,r)=>{if(!c[r.id]){var l=r.parent_id;r.parent_id&&!c[r.id]&&m(e,e.itemMap[r.parent_id]);var n=c[l||r.project_id];try{a.default.PAssert(1210,n,"parent item did not exist",l,r.project_id)}catch(L){a.default.reportError(L)}n&&((e,r,a)=>{if(r.priority&&(r.priority=i[r.priority]),r.due_date_utc){let e=p.a.parseText(f(new Date(r.due_date_utc)));e&&(r.date=e.toData(),r.content+=" "+o.a.CharDate)}var l=s.a.createVMLI({text:r.content||"",isCollapsed:!!r.collapsed,priority:r.priority,date:r.date},{parent:a,changeType:o.a.ChangeType.AllLocal,documentOwner:t});c[r.id]=l,u[l.id]=r,a.insertSorted(l,h)})(0,r,n)}},g=r=>{if(!c[r.id]){let a,i=r.parent_id,l=r.id;i?(c[i]||g(e[i]),a=c[i]):a=n;let d=s.a.createVMLI({text:r.name},{parent:a,changeType:o.a.ChangeType.AllLocal,documentOwner:t});c[l]=d,u[d.id]=r,a.insertSorted(d,h)}};for(let r in e)if(e.hasOwnProperty(r)){var v=0;let t=e[r],a=t.items;g(t);for(var w=0;w<a.length;w++){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;m(t,a[w])}}this.saveDocument(t),d.default.PaneUpdateBatcher.commitUpdateItems(),l.d.endAction()}catch(y){return r(y)}t()}createDocument(e){return s.a.createEmptyDocument(e,s.a.getDefaultBacking())}saveDocument(e){s.a.addDocument(e)}runImport(e,t,r,a,o){e.login(t,r,()=>{e.import(t=>{e.save(t,()=>{a()},o)},o)},o)}}}}]);
