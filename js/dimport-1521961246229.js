(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{114:function(e,t,r){"use strict";r.r(t);var a=r(0),s=r(1),o=r(4),i=r(6),l=r(7),n=r(51),d=r(15),c=r(18),u=r(11),f=r(74),h=r.n(f);function p(){this.workflowy={login:this.workflowyLogin.bind(this),import:this.workflowyImport.bind(this),save:this.workflowySave.bind(this)},this.wunderlist={login:this.wunderlistLogin.bind(this),import:this.wunderlistImport.bind(this),save:this.wunderlistSave.bind(this)},this.iqtell={login:this.iqtellLogin.bind(this),import:this.iqtellImport.bind(this),save:this.iqtellSave.bind(this)},this.opml={login:this.opmlLogin.bind(this),import:this.opmlImport.bind(this),save:this.opmlSave.bind(this)},this.json={login:this.jsonLogin.bind(this),import:this.jsonImport.bind(this),save:this.jsonSave.bind(this)},this.gtasks={login:this.gtasksLogin.bind(this),import:this.gtasksImport.bind(this),save:this.gtasksSave.bind(this)},this.trello={preload:this.trelloPreload.bind(this),login:this.trelloLogin.bind(this),import:this.trelloImport.bind(this),save:this.trelloSave.bind(this)},this.todoist={login:this.todoistLogin.bind(this),import:this.todoistImport.bind(this),save:this.todoistSave.bind(this)}}function m(e){return e.toString(c.a.getFormat(DFormat.MonthDay))}p.prototype={workflowyLogin:function(e,t,r,s){try{a.default.PAssert(2601,r,"Workflowy requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2602,s,"Workflowy requires an error callback")}catch(e){a.default.reportError(e)}return e?t?void a.default.XHR_PrivateAPI({type:"POST",path:"/oauth/workflowy",data:{username:e,password:t},cb:function(e){if(200===e.status){try{var t=JSON.parse(e.response);this.workflowy.data=JSON.parse(t.data)}catch(e){return a.default.reportError(e),s("Error parsing successful response from server. The developers have been notified with details of the error.")}return!this.workflowy.data||this.workflowy.data.error?s("Invalid username or password."):r()}var o;try{var i=JSON.parse(e.response);switch(i.code){case PrivateAPIErrorCodes.InvalidParameter:o="Must specify a username and password.";break;case PrivateAPIErrorCodes.UnauthorizedUser:o="Invalid username or password.";break;case PrivateAPIErrorCodes.ErrorContactingRemote:o=i.data;break;default:o="Error contacting server. The developers have been notified with details of the error."}}catch(e){o="Error parsing error response from server. The developers have been notified with details of the error.",a.default.reportError(e)}return s(o)}.bind(this)}):s("Must provide a password."):s("Must provide a valid username.")},workflowyImport:function(e,t){try{a.default.PAssert(2603,e,"Workflowy requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2604,t,"Workflowy requires an error callback")}catch(e){a.default.reportError(e)}return e(this.workflowy.data)},workflowyIterateItem:function(e,t){try{a.default.PAssert(2605,e&&void 0!==e.nm,"All items must exist and have stars and text, children and notes are optional",e)}catch(e){a.default.reportError(e)}try{a.default.PAssert(2607,t,"A valid parent must always be defined")}catch(e){a.default.reportError(e)}if(e&&t)try{var r=!!e.cp;if(!r){var s=a.default.stripFormattingTags(e.nm),o=i.default.createVMLI({text:s,isComplete:r},{parent:t,changeType:ChangeType.AllLocal});if(t.insertItem(o),e.no){var l=a.default.stripFormattingTags(e.no),n=i.default.createVMLI({text:l,isNote:!0},{parent:o,changeType:ChangeType.AllLocal});o.setNote(n,ChangeType.Local)}if(e.ch)for(var d=0;d<e.ch.length;++d){var c=e.ch[d];this.workflowyIterateItem(c,o)}}}catch(e){throw a.default.reportError(e),e}},workflowySave:function(e,t,r){try{a.default.PAssert(2608,e,"Workflowy requires having valid data")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2609,t,"Workflowy requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2610,r,"Workflowy requires an error callback")}catch(e){a.default.reportError(e)}try{try{a.default.PAssert(2611,e.projectTreeData,"Missing Workflowy projectTreeData")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2612,e.projectTreeData.mainProjectTreeInfo,"Missing Workflowy mainProjectTreeInfo")}catch(e){a.default.reportError(e)}var s=e.projectTreeData.mainProjectTreeInfo;try{a.default.PAssert(2613,s.rootProjectChildren,"Missing Workflowy rootProjectChildren")}catch(e){a.default.reportError(e)}l.a.beginAction(),a.default.vmMain.beginUpdateItems();var o=i.default.getRootModel();try{a.default.PAssert(2614,o,"Root item must exist in order to import")}catch(e){a.default.reportError(e)}var n=i.default.createVMLI({text:"Workflowy Import"},{parent:o,changeType:ChangeType.AllLocal});o.insertItem(n);try{for(var d=0;d<s.rootProjectChildren.length;++d){var c=s.rootProjectChildren[d];this.workflowyIterateItem(c,n)}a.default.vmMain.parseSubtree(n,ChangeType.Local|ChangeType.All)}catch(e){return a.default.reportError(e),r("There was an error iterating your Workflowy items. The developers have been notified with daetails of the error.",e)}return a.default.vmMain.commitUpdateItems(),l.a.endAction(),t()}catch(e){return a.default.reportError(e),r("There was an error parsing your Workflowy data. The developers have been notified with details of the error.",e)}},wunderlistLogin:function(e,t,r,s){try{a.default.PAssert(2615,r,"Wunderlist requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2616,s,"Wunderlist requires an error callback")}catch(e){a.default.reportError(e)}var o="localhost"===window.location.hostname?"f06a1334e250a9bb0b03":"ad988eeb954e9aabc288",i=window.location.protocol+"//"+window.location.host+"/oauthRelay.html";this.wunderlist.clientId=o;var l="Dchs"+(new Date).getTime(),n="https://www.wunderlist.com/oauth/authorize?client_id="+o+"&redirect_uri="+i+"&state="+l;window.open(n,"wunderlist","height=600,width=550");var d=function(e){var t=a.default.getLocationOrigin(),o=!1;try{o=e.data.state===l}catch(e){a.default.reportError(e)}if(t&&o)if(window.removeEventListener("message",d),e.data.error)s("Error authenticating with Wunderlist");else{var i=e.data.code;i&&a.default.XHR_PrivateAPI({type:"POST",path:"/oauth/wunderlist",data:{code:i},requireAuth:!0,cb:function(e){if(200===e.status){try{var t=JSON.parse(e.response).data;this.wunderlist.token=t.access_token}catch(e){s("Error parsing response from remote server.",e)}this.wunderlist.token?r():s("Invalid username or password.")}else s("Error contacting remote server.")}.bind(this)})}}.bind(this);window.addEventListener("message",d)},wunderlistImport:function(e,t){try{a.default.PAssert(2617,e,"Wunderlist requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2618,t,"Wunderlist requires an error callback")}catch(e){a.default.reportError(e)}var r={inbox:{title:"inbox",items:{},p:0}},s=0;this.wunderlistGetLists(function(a){for(var o=0;o<a.length;++o){var i=a[o];r[i.id]={title:i.title,items:{},p:i.position},this.wunderlistGetTasks(i.id,function(o){for(var l=0;l<o.length;++l){var n=o[l];if(n.parent_id){var d=r[n.list_id].items[n.parent_id];d?(d.items||(d.items=[]),d.items.push(n)):r[n.list_id].items[n.parent_id]={items:[n]}}else{var c=r[n.list_id].items[n.id];r[n.list_id].items[n.id]=n,c&&(r[n.list_id].items[n.id].items=c.items)}}this.wunderlistGetSubtasks(i.id,function(t){for(var o=0;o<t.length;++o){var i=t[o],l=r[i.list_id];if(l)if(i.parent_id){var n=l.items[i.parent_id];n?(n.items||(n.items=[]),n.items.push(i)):l.items[i.parent_id]={items:[i]}}else{var d=l.items[i.id];l.items[i.id]=i,d&&(l.items[i.id].items=d.items)}}++s===a.length&&e(r)}.bind(this),t)}.bind(this),t)}}.bind(this),t)},wunderlistGetLists:function(e,t){try{a.default.PAssert(2619,e,"Wunderlist requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2620,t,"Wunderlist requires an error callback")}catch(e){a.default.reportError(e)}a.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/lists",headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(r){if(200===r.status){var a;try{a=JSON.parse(r.response)}catch(e){t("There was an error parsing your Wunderlist data. The developers have been notified with details of the error.",e)}e(a)}else t("Error contacting remote server.")}.bind(this)})},wunderlistGetTasks:function(e,t,r){try{a.default.PAssert(2621,t,"Wunderlist requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2622,r,"Wunderlist requires an error callback")}catch(e){a.default.reportError(e)}a.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/tasks?list_id="+e,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var a=JSON.parse(e.response);t(a)}else r("Error contacting remote server.")}.bind(this)})},wunderlistGetSubtasks:function(e,t,r){try{a.default.PAssert(2623,t,"Wunderlist requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2624,r,"Wunderlist requires an error callback")}catch(e){a.default.reportError(e)}a.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/subtasks?list_id="+e,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var a=JSON.parse(e.response);t(a)}else r("Error contacting remote server.")}.bind(this)})},wunderlistSave:function(e,t,r){try{a.default.PAssert(2625,t,"Wunderlist requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2626,r,"Wunderlist requires an error callback")}catch(e){a.default.reportError(e)}try{l.a.beginAction(),a.default.vmMain.beginUpdateItems();var s=i.default.getRootModel();try{a.default.PAssert(2627,s,"Root item must exist in order to import")}catch(e){a.default.reportError(e)}var o=i.default.createVMLI({text:"Wunderlist Import"},{parent:s,changeType:ChangeType.AllLocal});for(var n in s.insertItem(o),e){var d=e[n];0;var c=d.title,u=i.default.createVMLI({text:c},{parent:o,changeType:ChangeType.AllLocal});for(var f in o.insertItem(u),d.items){var h=d.items[f];0;var p=i.default.createVMLI({text:h.title,isComplete:!!h.completed_at,dateCompleted:h.completed_at,isStarred:h.starred},{parent:u,changeType:ChangeType.AllLocal});if(u.insertItem(p),h.note){var m=i.default.createVMLI({text:h.note},{parent:p,changeType:ChangeType.AllLocal});p.insertItem(m)}if(h.items)for(var v=0;v<h.items.length;++v){var g=h.items[v];0;var y=i.default.createVMLI({text:g.title,isComplete:!!g.completed_at,dateCompleted:g.completed_at,isStarred:g.starred},{parent:p,changeType:ChangeType.AllLocal});p.insertItem(y)}}}a.default.vmMain.parseSubtree(o,ChangeType.Local|ChangeType.All),a.default.vmMain.commitUpdateItems(),l.a.endAction(),t()}catch(e){r(void 0,e)}},iqtellLogin:function(e,t,r,s){try{a.default.PAssert(2628,r,"IQTell requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2629,s,"IQTell requires an error callback")}catch(e){a.default.reportError(e)}var o=document.getElementById("importFileUploadButton");o.onchange=r,o.click()},_readMultipleFiles:function(e,t,r){var s=0,o=0,i=!1,l={},d={},c={};function u(){i&&s+o===e.length&&(o>0?r(function(){var e="";for(var t in c)e+=n.a._parseIQTellFilename(t)+": "+c[t]+"\r\n";return e}()):t(l,d))}function f(e,t,r){l[t]=e,d[t]=r,s++,u()}function h(e,t){c[t]=e,o++,u()}for(var p=0;p<e.length;++p){var m=new FileReader;m.onload=function(e,t){var r=t.target.result;if(r){var s=this.parseCSV(r);s&&!a.default.isString(s)?f(s,e,r):h(s||"Error parsing IQTell import. Please validate your data.",e)}else h("Unable to load IQTell data. Please contact support.",e)}.bind(this,e[p].name),m.onerror=function(e,t){h(t,e)}.bind(this,e[p].name),m.readAsText(e[p])}i=!0,u()},iqtellImport:function(e,t){try{a.default.PAssert(2630,e,"IQTell requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2631,t,"IQTell requires an error callback")}catch(e){a.default.reportError(e)}try{var r=document.forms.importFileUpload.importFile.files;if(r&&0!==r.length){this._readMultipleFiles(r,function(r,s){var o;l.a.beginAction(),a.default.vmMain.beginUpdateItems();try{o=n.a.iqtellProcess(r,s)}catch(e){a.default.reportError(e,s)}log("IQTell output: ",o),a.default.vmMain.commitUpdateItems(),l.a.endAction(),o?e():t("Error parsing IQTell import. Please contact support")},t)}else t("You must select a file before importing.")}catch(e){t(void 0,e)}},iqtellSave:function(e,t,r){try{a.default.PAssert(2632,t,"IQTell requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2633,r,"IQTell requires an error callback")}catch(e){a.default.reportError(e)}t()},opmlLogin:function(e,t,r,s){try{a.default.PAssert(2634,r,"OPML requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2635,s,"OPML requires an error callback")}catch(e){a.default.reportError(e)}var o=document.getElementById("importFileUploadButton");o.onchange=r,o.click()},opmlImport:function(e,t){try{a.default.PAssert(2636,e,"OPML requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2637,t,"OPML requires an error callback")}catch(e){a.default.reportError(e)}try{var r=new FileReader,s=document.forms.importFileUpload.importFile.files[0];s?(r.onload=function(r){var o,i=r.target.result;if((i.startsWith("<?xml ")||i.startsWith("<?opml ")||i.startsWith("<opml "))&&(o=a.default.loadXML(i)),o){l.a.beginAction(),a.default.vmMain.beginUpdateItems();var d=n.a.parseOPML(o,s.name);a.default.vmMain.commitUpdateItems(),l.a.endAction(),d?e():t("Error parsing OPML. Please validate your data.")}else t("Unable to load XML lib. Please update or try another browser.")},r.onerror=t,r.readAsText(s)):t("You must select a file before importing.")}catch(e){t(void 0,e)}},opmlSave:function(e,t,r){try{a.default.PAssert(2638,t,"OPML requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2639,r,"OPML requires an error callback")}catch(e){a.default.reportError(e)}t()},jsonLogin:function(e,t,r,s){try{a.default.PAssert(2640,r,"JSON requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2641,s,"JSON requires an error callback")}catch(e){a.default.reportError(e)}var o=document.getElementById("importFileUploadButton"),i=!1;o.onchange=function(e){i=!0,r(e)},o.click();document.body.onfocus=function(){i||s(!1),document.body.onfocus=void 0}},jsonImport:function(e,t){try{var r=new FileReader,s=document.forms.importFileUpload.importFile.files[0];s?(r.onload=function(r){var s=r.target.result;if(!s)return t("Unable to import your requested file. Please try a different file.");try{var o=JSON.parse(s)}catch(e){return t("The JSON is not properly formatted. Please re-validate or send the file to support@moo.do.")}try{l.a.beginAction(),a.default.vmMain.beginUpdateItems();var i=n.a.parseJSON(o);return a.default.vmMain.commitUpdateItems(),l.a.endAction(),i?e():t("Invalid JSON format. The developers have been notified with details of the error.")}catch(e){return t("The JSON file has errors. The developers have been notified with details of the error.",e)}},r.onerror=t,r.readAsText(s)):t("You must select a file before importing.")}catch(e){t(void 0,e)}},jsonSave:function(e,t,r){try{a.default.PAssert(2642,t,"JSON requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2643,r,"JSON requires an error callback")}catch(e){a.default.reportError(e)}t()},gtasksLogin:function(e,t,r,s){try{a.default.PAssert(2648,r,"GTasks requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2649,s,"GTasks requires an error callback")}catch(e){a.default.reportError(e)}d.default.runAuthenticate([GScope.TasksRO],!1,!1,function(e){e&&!e.error?(this.gtasks.token=e,r(e)):s("Unable to authenticate with Google. Please try again.",e)}.bind(this))},gtasksImport:function(e,t){try{a.default.PAssert(2650,e,"GTasks requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2651,t,"GTasks requires an error callback")}catch(e){a.default.reportError(e)}var r={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(function(s){try{a.default.PAssert(2652,a.default.isArray(s),"List data must be an array")}catch(e){a.default.reportError(e)}for(var o=s.length,i=0,l=0;l<s.length;++l){var n=s[l];r.remoteItems[n.id]={id:n.id,text:n.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},r.roots.push(n.id),this.gtasksGetTasks(n,function(s,l){if(s){try{a.default.PAssert(2653,a.default.isArray(s),"List data must be an array")}catch(e){a.default.reportError(e)}if(a.default.isArray(s)){for(var n=0;n<s.length;++n){var d=s[n];if(d&&"completed"!==d.status){r.remoteItems[d.id]={id:d.id,text:d.title,isComplete:"completed"===d.status,dateCompleted:d.completed?new Date(d.completed):void 0,isArchived:d.hidden,due:d.due?new Date(d.due):void 0,notes:d.notes,parent:d.parent||l.id,items:[]};var c=r.remoteItems[d.parent||l.id];c?c.items.push(d.id):r.unassigned.push(d.id)}}++i===o&&e(r)}else t("Invalid task list returned.")}else i++}.bind(this),t)}}.bind(this),t)},gtasksGetLists:function(e,t){try{a.default.PAssert(2654,e,"GTasks requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2655,t,"GTasks requires an error callback")}catch(e){a.default.reportError(e)}a.default.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults=2000&key="+window.gapiKey+"&access_token="+u.a.getDefaultAccessToken(),cb:function(r){if(200===r.status)try{var s=JSON.parse(r.response);try{a.default.PAssert(2656,s&&s.items,"Must have a valid set of data to get tasks from")}catch(e){a.default.reportError(e)}s&&s.items?e(s.items):t("Error getting data from remote server.")}catch(e){t(e)}else t("Error contacting remote server.")}.bind(this)})},gtasksGetTasks:function(e,t,r){try{a.default.PAssert(2657,e,"GTasks requires a valid list to get tasks from")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2658,t,"GTasks requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2659,r,"GTasks requires an error callback")}catch(e){a.default.reportError(e)}a.default.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/lists/"+e.id+"/tasks?maxResults=2500&key="+window.gapiKey+"&access_token="+u.a.getDefaultAccessToken(),cb:function(s){if(200===s.status)try{var o=JSON.parse(s.response);try{a.default.PAssert(2660,o,"Must have a valid array of tasks")}catch(e){a.default.reportError(e)}o&&o.items?t(o.items,e):t([],e)}catch(e){r(e)}else r("Error contacting remote server.")}.bind(this)})},gtasksSave:function(e,t,r){try{a.default.PAssert(2661,t,"GTasks requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2662,r,"GTasks requires an error callback")}catch(e){a.default.reportError(e)}try{var s=function t(r,a){var s=r.text;r.due&&(s+=" @"+m(r.due));var o=i.default.createVMLI({text:s,isComplete:r.isComplete,dateCompleted:r.dateCompleted?r.dateCompleted.getTime():r.dateCompleted,isArchived:r.isArchived},{parent:a,changeType:ChangeType.AllLocal});if(a.insertItem(o),r.notes){var l=i.default.createVMLI({text:r.notes,isNote:!0},{parent:o,changeType:ChangeType.AllLocal});o.setNote(l,ChangeType.Local)}for(var n=0;n<r.items.length;++n)t(e.remoteItems[r.items[n]],o)};try{a.default.PAssert(2663,0===e.unassigned.length,"We should never have unassigned tasks")}catch(e){a.default.reportError(e)}l.a.beginAction(),a.default.vmMain.beginUpdateItems();var o=i.default.getRootModel();try{a.default.PAssert(2664,o,"Root item must exist in order to import")}catch(e){a.default.reportError(e)}var n=i.default.createVMLI({text:"Google Tasks Import"},{parent:o,changeType:ChangeType.AllLocal});o.insertItem(n);for(var d=0;d<e.roots.length;++d)s(e.remoteItems[e.roots[d]],n);a.default.vmMain.parseSubtree(n,ChangeType.Local|ChangeType.All),a.default.vmMain.commitUpdateItems(),l.a.endAction(),t()}catch(e){r(void 0,e)}},trelloPreload:function(e,t){window.Trello||this.trello.isLoading?e():(this.trello.isLoading=!0,a.default.addScript("https://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",function(){a.default.addScript("https://api.trello.com/1/client.js?key=667ecf0c3d3e029c51d205b7173f6c38","trelloScript",function(){this.trello.isLoading=!1;try{a.default.PAssert(2665,window.Trello,"The Trello client lib must have been loaded correctly")}catch(e){a.default.reportError(e)}window.Trello?e():t("Error loading Trello. Please try again.")}.bind(this),function(e){this.trello.isLoading=!1,t(e)})}.bind(this),function(e){this.trello.isLoading=!1,t(e)}))},trelloLogin:function(e,t,r,s){try{a.default.PAssert(2666,window.Trello,"The Trello client lib was not properly loaded")}catch(e){a.default.reportError(e)}if(window.Trello){if(o.a.appPlatform===AppPlatform.Chrome){window.addEventListener("message",function e(t){a.default.getLocationOrigin()&&(window.removeEventListener("message",e),t.data.error?s("Error authenticating with Trello."):(Trello.setToken(t.data.token),r()))})}Trello.authorize({type:o.a.appPlatform===AppPlatform.Chrome?"redirect":"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:r,error:s})}else s("Error loading Trello. Please try again.")},trelloImport:function(e,t){var r=[];Trello.get("members/me/boards",a.default.protectFn(function(a){var s=(a=a||[]).length,o=0;function i(){s===o&&e(r)}function l(e){o++,i()}for(var n=0;n<a.length;++n){var d=a[n];if(d.closed)s--;else{var c={text:d.name,items:[]};r.push(c),this._handleBoard(c,d.id,t,l)}}i()}.bind(this),t),t)},_handleBoard:function(e,t,r,s){Trello.get("boards/"+t+"/lists",a.default.protectFn(function(t){var a=0,o=t.length;function i(){a===o&&s()}function l(){a++,i()}for(var n=0;n<t.length;++n){var d=t[n];if(d.closed)o--;else{var c={text:d.name,items:[]};e.items.push(c),this._handleList(c,d.id,r,l)}}i()}.bind(this),r),r)},_handleList:function(e,t,r,o){Trello.get("lists/"+t+"/cards",a.default.protectFn(function(t){var a=0,i=t.length;function l(){a===i&&o()}function n(){a++,l()}for(var d=0;d<t.length;++d){var c=t[d];if(c.closed)i--;else{var u={text:c.name};if(c.labels&&c.labels.length>0){for(var f="",h=0;h<c.labels.length;++h){var p=c.labels[h];f+=s.a.TagPrefix+(p.name.length>0?p.name:p.color)+" "}u.text=f+u.text}if(c.due&&(u.text+=" "+s.a.DatePrefix+m(new Date(c.due))),c.desc&&c.desc.length>0){u.items=[];var v=c.desc.split("\n");for(h=0;h<v.length;++h){var g=v[h];g&&g.length>0&&u.items.push({text:g})}}if(c.idChecklists&&c.idChecklists.length>0){u.items||(u.items=[]);for(h=0;h<c.idChecklists.length;++h)this._handleChecklist(u,c.idChecklists[h],r,n)}else a++;e.items.push(u)}}l()}.bind(this),r),r)},_handleChecklist:function(e,t,r,s){Trello.get("checklists/"+t+"/",a.default.protectFn(function(t){for(var r={text:t.name,isCollapsed:!0,items:[]},a=0;a<t.checkItems.length;++a){var o=t.checkItems[a],i="complete"===o.state;if(!i){var l={text:o.name,isComplete:i};r.items.push(l)}}e.items.push(r),s()}.bind(this),r),r)},trelloSave:function(e,t,r){function s(e,t){var r=i.default.createVMLI({text:e.text,isComplete:e.isComplete,isCollapsed:e.isCollapsed},{parent:t,changeType:ChangeType.AllLocal});if(t.insertItem(r),e.items)for(var a=0;a<e.items.length;++a)s(e.items[a],r);return r}try{l.a.beginAction(),a.default.vmMain.beginUpdateItems();var o=i.default.getRootModel();try{a.default.PAssert(2667,o,"Root item must exist in order to import")}catch(e){a.default.reportError(e)}var n=i.default.createVMLI({text:"Trello Import"},{parent:o,changeType:ChangeType.AllLocal});o.insertItem(n);for(var d=0;d<e.length;++d)s(e[d],n);a.default.vmMain.commitUpdateItems(),l.a.endAction()}catch(e){return r(e)}t()},todoistLogin:function(e,t,r,s){try{a.default.PAssert(2668,r,"Todoist requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2669,s,"Todoist requires an error callback")}catch(e){a.default.reportError(e)}var o="localhost"===window.location.hostname?"5d361221eddb4bcdb018457c7c74e698":"b701ac04f4df419ca4144ab208a9fb06",i="Dchs"+(new Date).getTime(),l="https://todoist.com/oauth/authorize?client_id="+o+"&scope=data:read&state="+i;window.open(l,"todoist","height=600,width=550");var n=function(e){var t=a.default.getLocationOrigin(),o=!1;try{o=e.data.state===i}catch(e){a.default.reportError(e)}if(t&&o)if(window.removeEventListener("message",n),e.data.error)s("Error authenticating with Todoist");else{var l=e.data.code;l&&a.default.XHR_PrivateAPI({type:"POST",path:"/oauth/todoist",data:{code:l},requireAuth:!0,cb:function(e){if(200===e.status){try{var t=JSON.parse(e.response).data;this.todoist.data=t}catch(e){s("Error parsing response from remote server.",e)}this.todoist.data?r():s("Invalid username or password")}else s("Error contacting remote server.")}.bind(this)})}}.bind(this);window.addEventListener("message",n)},todoistImport:function(e,t){try{a.default.PAssert(2670,e,"Todoist requires a success callback")}catch(e){a.default.reportError(e)}try{a.default.PAssert(2671,t,"Todoist requires an error callback")}catch(e){a.default.reportError(e)}for(var r=this.todoist.data,s={},o=0;o<r.projects.length;++o){var i=r.projects[o];i.is_archived||i.is_deleted||(s[i.id]={name:i.name,items:[]})}for(o=0;o<r.items.length;++o){var l=r.items[o];!s[l.project_id]||l.is_deleted||l.is_archived||l.checked||s[l.project_id].items.push(l)}e(s)},todoistSave:function(e,t,r){var s=[VMLIFlag.None,VMLIFlag.None,VMLIFlag.P2,VMLIFlag.P1,VMLIFlag.P0];function o(e,t){e.priority&&(e.priority=s[e.priority]),e.due_date_utc&&(e.content+=" @"+m(new Date(e.due_date_utc)));var r=i.default.createVMLI({text:e.content||"",isCollapsed:!!e.collapsed,priority:e.priority},{parent:t,changeType:ChangeType.AllLocal});return t.insertItem(r),r}try{l.a.beginAction(),a.default.vmMain.beginUpdateItems();var n=i.default.getRootModel();try{a.default.PAssert(2672,n,"Root item must exist in order to import")}catch(e){a.default.reportError(e)}var d=i.default.createVMLI({text:"Todoist Import"},{parent:n,changeType:ChangeType.AllLocal});for(var c in n.insertItem(d),e){var u=e[c],f=u.items;f.sort(function(e,t){return e.item_order>t.item_order});var h=i.default.createVMLI({text:u.name},{parent:d,changeType:ChangeType.AllLocal});d.insertItem(h);for(var p={},v=0;v<f.length;++v){var g=f[v];try{a.default.PAssert(2673,!g.parent_id||p[g.parent_id],"Parent exists and has not been created yet")}catch(e){a.default.reportError(e)}var y=g.parent_id?p[g.parent_id]:h;y||(y=h,g.content="[Error] "+g.content),p[g.id]=o(g,y)}}a.default.vmMain.commitUpdateItems(),l.a.endAction()}catch(e){return r(e)}t()},_createCSVEntry:function(e,t){for(var r={},a=0;a<e.length;++a)r[e[a]]=t[a];return r},parseCSV:function(e){for(var t=h.a.parse(e),r=["Area","Client","Contacts","Category","Context","Created By","Date Created","Date Updated","Delegated To","Start Date","Due Date","Links","Notes","Originating Entry","Parent Entries","Priority","Short Description","Title","Star","Status","Website References"],a=[],s=t.data[0],o=0;o<s.length;++o)r.indexOf(s[o])<0?console.log("Unknown CSV Headers: ",s[o]):a.indexOf(s[o])>=0&&a.remove(s[o]);if(0===a.length){var i=[];for(o=1;o<t.data.length;++o)i.push(this._createCSVEntry(s,t.data[o]))}else var l="Missing required export fields: "+a.join(", ");if(s.indexOf("Short Descrption")<0&&s.indexOf("Title")<0)l="Missing required export fields: Short Descrption OR Title.";return i||l}},t.default=p}}]);
//# sourceMappingURL=dimport-1521961246229.js.map