function dateWrapper(){this.dateLibLoaded=!0,Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"am",pmDesignator:"pm",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^sun(day)?/i,mon:/^mon(day)?/i,tue:/^tue(s(day)?)?/i,wed:/^wed(nesday)?/i,thu:/^thu(rsday)?/i,fri:/^fri(day)?/i,sat:/^sat(urday)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,yesterday:/^yesterday/i,today:/^today/i,tomorrow:/^tom(orrow)?/i,soon:/^soon/i,later:/^later/i,now:/^now/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},function(){var e=Date,t=e.prototype,r=e.CultureInfo,n=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},e.today=function(){return(new Date).clearTime()},e.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return t>e?-1:e>t?1:0;throw new TypeError(e+" - "+t)},e.equals=function(e,t){return 0===e.compareTo(t)},e.getDayNumberFromName=function(e){for(var t=r.dayNames,n=r.abbreviatedDayNames,i=r.shortestDayNames,o=e.toLowerCase(),a=0;a<t.length;a++)if(t[a].toLowerCase()==o||n[a].toLowerCase()==o||i[a].toLowerCase()==o)return a;return-1},e.getMonthNumberFromName=function(e){for(var t=r.monthNames,n=r.abbreviatedMonthNames,i=e.toLowerCase(),o=0;o<t.length;o++)if(t[o].toLowerCase()==i||n[o].toLowerCase()==i)return o;return-1},e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},e.getDaysInMonth=function(t,r){return[31,e.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][r]},e.getTimezoneAbbreviation=function(e){for(var t=r.timezones,n=0;n<t.length;n++)if(t[n].offset===e)return t[n].name;return null},e.getTimezoneOffset=function(e){for(var t=r.timezones,n=0;n<t.length;n++)if(t[n].name===e.toUpperCase())return t[n].offset;return null},t.clone=function(){var e=new Date(this.getTime());return e._explicitTime=this._explicitTime,e},t.compareTo=function(e){return Date.compare(this,e)},t.equals=function(e){return Date.equals(this,e||new Date)},t.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},t.isAfter=function(e){return 1===this.compareTo(e||new Date)},t.isBefore=function(e){return-1===this.compareTo(e||new Date)},t.isToday=function(){return this.isSameDay(new Date)},t.isSameDay=function(e){return this.clone().clearTime().equals(e.clone().clearTime())},t.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},t.addSeconds=function(e){return this.addMilliseconds(1e3*e)},t.addMinutes=function(e){return this.addMilliseconds(6e4*e)},t.addHours=function(e){return this.addMilliseconds(36e5*e)},t.addDays=function(e){return this.setDate(this.getDate()+e),this},t.addWeeks=function(e){return this.addDays(7*e)},t.addMonths=function(t){var r=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+t),this.setDate(Math.min(r,e.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addYears=function(e){return this.addMonths(12*e)},t.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return t.millisecond&&this.addMilliseconds(t.millisecond),t.second&&this.addSeconds(t.second),t.minute&&this.addMinutes(t.minute),t.hour&&this.addHours(t.hour),t.week&&this.addWeeks(t.week),t.month&&this.addMonths(t.month),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),t.setExplicitTime&&(this._explicitTime=!0),this};var i,o,a;t.getWeek=function(){var e,t,r,n,s,c,d,l,u,h;return i=i?i:this.getFullYear(),o=o?o:this.getMonth()+1,a=a?a:this.getDate(),2>=o?(e=i-1,t=(e/4|0)-(e/100|0)+(e/400|0),r=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),u=t-r,s=0,c=a-1+31*(o-1)):(e=i,t=(e/4|0)-(e/100|0)+(e/400|0),r=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),u=t-r,s=u+1,c=a+(153*(o-3)+2)/5+58+u),d=(e+t)%7,n=(c+d-s)%7,l=c+3-n|0,h=0>l?53-((d-u)/5|0):l>364+u?1:(l/7|0)+1,i=o=a=null,h},t.getISOWeek=function(){return i=this.getUTCFullYear(),o=this.getUTCMonth()+1,a=this.getUTCDate(),n(this.getWeek())},t.setWeek=function(e){return this.moveToDayOfWeek(1).addWeeks(e-this.getWeek())},e._validate=function(e,t,r,n){if("undefined"==typeof e)return!1;if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(t>e||e>r)throw new RangeError(e+" is not a valid value for "+n+".");return!0},e.validateMillisecond=function(t){return e._validate(t,0,999,"millisecond")},e.validateSecond=function(t){return e._validate(t,0,59,"second")},e.validateMinute=function(t){return e._validate(t,0,59,"minute")},e.validateHour=function(t){return e._validate(t,0,23,"hour")},e.validateDay=function(t,r,n){return e._validate(t,1,e.getDaysInMonth(r,n),"day")},e.validateMonth=function(t){return e._validate(t,0,11,"month")},e.validateYear=function(t){return e._validate(t,0,9999,"year")},t.set=function(t){return e.validateMillisecond(t.millisecond)&&this.addMilliseconds(t.millisecond-this.getMilliseconds()),e.validateSecond(t.second)&&this.addSeconds(t.second-this.getSeconds()),e.validateMinute(t.minute)&&this.addMinutes(t.minute-this.getMinutes()),e.validateHour(t.hour)&&this.addHours(t.hour-this.getHours()),e.validateMonth(t.month)&&this.addMonths(t.month-this.getMonth()),e.validateYear(t.year)&&this.addYears(t.year-this.getFullYear()),e.validateDay(t.day,this.getFullYear(),this.getMonth())&&this.addDays(t.day-this.getDate()),t.timezone&&this.setTimezone(t.timezone),t.timezoneOffset&&this.setTimezoneOffset(t.timezoneOffset),t.week&&e._validate(t.week,0,53,"week")&&this.setWeek(t.week),t.setExplicitTime&&(this._explicitTime=!0),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})},t.moveToNthOccurrence=function(e,t){var r=0;if(t>0)r=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(r)},t.moveToDayOfWeek=function(e,t){var r=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===r?r+=7*(t||1):r)},t.moveToMonth=function(e,t){var r=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===r?r+=12*(t||1):r)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset())},t.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),r=-6*Number(e)/10;return this.addMinutes(r-t)},t.setTimezone=function(t){return this.setTimezoneOffset(e.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&(new Date).getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset()},t.getUTCOffset=function(){var e,t=-10*this.getTimezoneOffset()/6;return 0>t?(e=(t-1e4).toString(),e.charAt(0)+e.substr(2)):(e=(t+1e4).toString(),"+"+e.substr(1))},t.getElapsed=function(e){return(e||new Date)-this},t.toISOString||(t.toISOString=function(){function e(e){return 10>e?"0"+e:e}return'"'+this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+'Z"'}),t._toString=t.toString,t.toString=function(e){var t=this;if(e&&1==e.length){var i=r.formatPatterns;switch(t.t=t.toString,e){case"d":return t.t(i.shortDate);case"D":return t.t(i.longDate);case"F":return t.t(i.fullDateTime);case"m":return t.t(i.monthDay);case"r":return t.t(i.rfc1123);case"s":return t.t(i.sortableDateTime);case"t":return t.t(i.shortTime);case"T":return t.t(i.longTime);case"u":return t.t(i.universalSortableDateTime);case"y":return t.t(i.yearMonth)}}var o=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return e?e.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(e){if("\\"===e.charAt(0))return e.replace("\\","");switch(t.h=t.getHours,e){case"hh":return n(t.h()<13?0===t.h()?12:t.h():t.h()-12);case"h":return t.h()<13?0===t.h()?12:t.h():t.h()-12;case"HH":return n(t.h());case"H":return t.h();case"mm":return n(t.getMinutes());case"m":return t.getMinutes();case"ss":return n(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return n(t.getFullYear(),4);case"yy":return n(t.getFullYear());case"dddd":return r.dayNames[t.getDay()];case"ddd":return r.abbreviatedDayNames[t.getDay()];case"dd":return n(t.getDate());case"d":return t.getDate();case"MMMM":return r.monthNames[t.getMonth()];case"MMM":return r.abbreviatedMonthNames[t.getMonth()];case"MM":return n(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.h()<12?r.amDesignator.substring(0,1):r.pmDesignator.substring(0,1);case"tt":return t.h()<12?r.amDesignator:r.pmDesignator;case"S":return o(t.getDate());default:return e}}):this._toString()}}(),function(){var e=Date,t=e.prototype,r=e.CultureInfo,n=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._explicitTime=!1,t._isSecond=!1,n._dateElement="day",t.next=function(){return this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1},t.at=function(t){return"string"==typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},n.fromNow=n.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},n.ago=n.before=function(e){var t={};return t[this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var i,o="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),a="january february march april may june july august september october november december".split(/\s/),s=[],c=[],d="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<s.length;t++)e[s[t].toLowerCase()]=this["get"+c[t]]();return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};for(var l=function(t){return function(){if(this._is)return this._is=!1,this.getDay()==t;if(null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var r=this._nth;this._nth=null;var n=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,r),this>n)throw new RangeError(e.getDayName(t)+" does not occur "+r+" times in the month of "+e.getMonthName(n.getMonth())+" "+n.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},u=function(t){return function(){var n=e.today(),i=t-n.getDay();return(0===t&&1===r.firstDayOfWeek&&0!==n.getDay()||0>i)&&(i+=7),n.addDays(i)}},h=0;h<o.length;h++)e[o[h].toUpperCase()]=e[o[h].toUpperCase().substring(0,3)]=h,e[o[h]]=e[o[h].substring(0,3)]=u(h),t[o[h]]=t[o[h].substring(0,3)]=l(h);for(var p=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},m=function(t){return function(){return e.today().set({month:t,day:1})}},f=0;f<a.length;f++)e[a[f].toUpperCase()]=e[a[f].toUpperCase().substring(0,3)]=f,e[a[f]]=e[a[f].substring(0,3)]=m(f),t[a[f]]=t[a[f].substring(0,3)]=p(f);for(var g=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;for(var t=this.toObject(),r=(arguments[0]||new Date).toObject(),n="",i=e.toLowerCase(),o=s.length-1;o>-1;o--){if(n=s[o].toLowerCase(),t[n]!=r[n])return!1;if(i==n)break}return!0}return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},v=function(e){return function(){return this._dateElement=e,this}},y=0;y<s.length;y++)i=s[y].toLowerCase(),t[i]=t[i+"s"]=g(s[y]),n[i]=n[i+"s"]=v(i);t._ss=g("Second");for(var b=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},S=0;S<d.length;S++)t[d[S]]=b(0===S?-1:S)}(),function(){Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(r){var n=r.match(t);if(n)return[n[0],r.substring(n[0].length)];throw new e.Exception(r)}},token:function(){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var r=[],n=null;t.length;){try{n=e.call(this,t)}catch(i){r.push(n[0]),t=n[1];continue}break}return[r,t]}},many:function(e){return function(t){for(var r=[],n=null;t.length;){try{n=e.call(this,t)}catch(i){return[r,t]}r.push(n[0]),t=n[1]}return[r,t]}},optional:function(e){return function(t){var r=null;try{r=e.call(this,t)}catch(n){return[null,t]}return[r[0],r[1]]}},not:function(t){return function(r){try{t.call(this,r)}catch(n){return[null,r]}throw new e.Exception(r)}},ignore:function(e){return e?function(t){var r=null;return r=e.call(this,t),[null,r[1]]}:null},product:function(){for(var e=arguments[0],r=Array.prototype.slice.call(arguments,1),n=[],i=0;i<e.length;i++)n.push(t.each(e[i],r));return n},cache:function(t){var r={},n=null;return function(i){try{n=r[i]=r[i]||t.call(this,i)}catch(o){n=r[i]=o}if(n instanceof e.Exception)throw n;return n}},any:function(){var t=arguments;return function(r){for(var n=null,i=0;i<t.length;i++)if(null!=t[i]){try{n=t[i].call(this,r)}catch(o){n=null}if(n)return n}throw new e.Exception(r)}},each:function(){var t=arguments;return function(r){for(var n=[],i=null,o=0;o<t.length;o++)if(null!=t[o]){try{i=t[o].call(this,r)}catch(a){throw new e.Exception(r)}n.push(i[0]),r=i[1]}return[n,r]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(r,n,i){return n=n||t.rtoken(/^\s*/),i=i||null,1==r.length?r[0]:function(t){for(var o=null,a=null,s=[],c=0;c<r.length;c++){try{o=r[c].call(this,t)}catch(d){break}s.push(o[0]);try{a=n.call(this,o[1])}catch(l){a=null;break}t=a[1]}if(!o)throw new e.Exception(t);if(a)throw new e.Exception(a[1]);if(i)try{o=i.call(this,o[1])}catch(u){throw new e.Exception(o[1])}return[s,o?o[1]:t]}},between:function(e,n,i){i=i||e;var o=t.each(t.ignore(e),n,t.ignore(i));return function(e){var t=o.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,r,n){return r=r||t.rtoken(/^\s*/),n=n||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(r)),e.slice(-1),t.ignore(n)):t.each(t.many(t.each(e,t.ignore(r))),px,t.ignore(n))},set:function(r,n,i){return n=n||t.rtoken(/^\s*/),i=i||null,function(o){for(var a=null,s=null,c=null,d=null,l=[[],o],u=!1,h=0;h<r.length;h++){c=null,s=null,a=null,u=1==r.length;try{a=r[h].call(this,o)}catch(p){continue}if(d=[[a[0]],a[1]],a[1].length>0&&!u)try{c=n.call(this,a[1])}catch(m){u=!0}else u=!0;if(u||0!==c[1].length||(u=!0),!u){for(var f=[],g=0;g<r.length;g++)h!=g&&f.push(r[g]);s=t.set(f,n).call(this,c[1]),s[0].length>0&&(d[0]=d[0].concat(s[0]),d[1]=s[1])}if(d[1].length<l[1].length&&(l=d),0===l[1].length)break}if(0===l[0].length)return l;if(i){try{c=i.call(this,l[1])}catch(v){throw new e.Exception(l[1])}l[1]=c[1]}return l}},forward:function(e,t){return function(r){return e[t].call(this,r)}},replace:function(e,t){return function(r){var n=e.call(this,r);return[t,n[1]]}},process:function(e,t){return function(r){var n=e.call(this,r);return[t.call(this,n[0]),n[1]]}},min:function(t,r){return function(n){var i=r.call(this,n);if(i[0].length<t)throw new e.Exception(n);return i}}},n=function(e){return function(){var t=null,r=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var n=0,i=t.shift();n<i.length;n++)return t.unshift(i[n]),r.push(e.apply(null,t)),t.shift(),r}},i="optional not ignore cache".split(/\s/),o=0;o<i.length;o++)t[i[o]]=n(t[i[o]]);for(var a=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),c=0;c<s.length;c++)t[s[c]]=a(t[s[c]])}(),function(){var e=Date,t=(e.prototype,e.CultureInfo),r=function(e){for(var t=[],n=0;n<e.length;n++)e[n]instanceof Array?t=t.concat(r(e[n])):e[n]&&t.push(e[n]);return t};e.Grammar={},e.Translator={hour:function(e){return function(){this.hour=Number(e),this.setExplicitTime=!0}},minute:function(e){return function(){this.minute=Number(e),this.setExplicitTime=!0}},second:function(e){return function(){this.second=Number(e),this.setExplicitTime=!0}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(e){return function(){this.month=3==e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1}},year:function(e){return function(){var r=Number(e);this.year=e.length>2?r:r+(r+2e3<t.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){(new Date).getDate();switch(e){case"yesterday":this.days=-1;break;case"later":this.days=5;break;case"soon":this.days=2;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){t=t instanceof Array?t:[t];for(var r=0;r<t.length;r++)t[r]&&t[r].call(this);var n=new Date;if(!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=n.getDate()),this.year||(this.year=n.getFullYear(),this.month<n.getMonth()&&this.year++),this.month||0===this.month||(this.month=n.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var i=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return i._explicitTime=this.setExplicitTime,this.timezone?i.set({timezone:this.timezone}):this.timezoneOffset&&i.set({timezoneOffset:this.timezoneOffset}),i},finish:function(t){if(t=t instanceof Array?r(t):[t],0===t.length)return null;for(var n=0;n<t.length;n++)"function"==typeof t[n]&&t[n].call(this);var i=e.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(i=new Date);var o,a,s,c=!!this.year,d=!!(this.days&&null!==this.days||this.orient||this.operator);if(s="past"==this.orient||"subtract"==this.operator?-1:1,this.now||-1=="hour minute second".indexOf(this.unit)||i.setTimeToNow(),(this.month||0===this.month)&&-1!="year day hour minute second".indexOf(this.unit)&&(this.value=this.month+1,this.month=null,d=!0),!d&&this.weekday&&!this.day&&!this.days){var l=Date[this.weekday]();this.day=l.getDate(),this.month||(this.month=l.getMonth()),this.year=l.getFullYear()}if(d&&this.weekday&&"month"!=this.unit&&(this.unit="day",o=e.getDayNumberFromName(this.weekday)-i.getDay(),a=7,this.days=o?(o+s*a)%a:s*a),this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(i.set({day:1*this.value}),d||(this.day=1*this.value)),this.month||!this.value||"month"!=this.unit||this.now||(this.month=this.value,d=!0),d&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",o=this.month-i.getMonth(),a=12,this.months=o?(o+s*a)%a:s*a,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*s:(null==this[this.unit+"s"]||null!=this.operator)&&(this.value||(this.value=1),this[this.unit+"s"]=this.value*s),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.weekday&&!this.day&&!this.days){var l=Date[this.weekday]();this.day=l.getDate(),l.getMonth()!==i.getMonth()&&(this.month=l.getMonth())}return!this.month&&0!==this.month||this.day||(this.day=1),this.orient||this.operator||"week"!=this.unit||!this.value||this.day||this.month?(d&&this.timezone&&this.day&&this.days&&(this.day=this.days),!c&&this.month<i.getMonth()&&(this.year=i.getFullYear()+1),d?i.add(this):i.set(this)):Date.today().setWeek(this.value)}};var n,i=e.Parsing.Operators,o=e.Grammar,a=e.Translator;o.datePartDelimiter=i.rtoken(/^([\s\-\.\,\/\x27]+)/),o.timePartDelimiter=i.stoken(":"),o.whiteSpace=i.rtoken(/^\s*/),o.generalDelimiter=i.rtoken(/^(([\s\,]|at|@|on)+)/);var s={};o.ctoken=function(e){var r=s[e];if(!r){for(var n=t.regexPatterns,o=e.split(/\s+/),a=[],c=0;c<o.length;c++)a.push(i.replace(i.rtoken(n[o[c]]),o[c]));r=s[e]=i.any.apply(null,a)}return r},o.ctoken2=function(e){return i.rtoken(t.regexPatterns[e])},o.h=i.cache(i.process(i.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),a.hour)),o.hh=i.cache(i.process(i.rtoken(/^(0[0-9]|1[0-2])/),a.hour)),o.H=i.cache(i.process(i.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),a.hour)),o.HH=i.cache(i.process(i.rtoken(/^([0-1][0-9]|2[0-3])/),a.hour)),o.m=i.cache(i.process(i.rtoken(/^([0-5][0-9]|[0-9])/),a.minute)),o.mm=i.cache(i.process(i.rtoken(/^[0-5][0-9]/),a.minute)),o.s=i.cache(i.process(i.rtoken(/^([0-5][0-9]|[0-9])/),a.second)),o.ss=i.cache(i.process(i.rtoken(/^[0-5][0-9]/),a.second)),o.hms=i.cache(i.sequence([o.H,o.m,o.s],o.timePartDelimiter)),o.t=i.cache(i.process(o.ctoken2("shortMeridian"),a.meridian)),o.tt=i.cache(i.process(o.ctoken2("longMeridian"),a.meridian)),o.z=i.cache(i.process(i.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),a.timezone)),o.zz=i.cache(i.process(i.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),a.timezone)),o.zzz=i.cache(i.process(o.ctoken2("timezone"),a.timezone)),o.timeSuffix=i.each(i.ignore(o.whiteSpace),i.set([o.tt,o.zzz])),o.time=i.each(i.optional(i.ignore(i.stoken("T"))),o.hms,o.timeSuffix),o.d=i.cache(i.process(i.each(i.rtoken(/^([0-2]\d|3[0-1]|\d)/),i.optional(o.ctoken2("ordinalSuffix"))),a.day)),o.dd=i.cache(i.process(i.each(i.rtoken(/^([0-2]\d|3[0-1])/),i.optional(o.ctoken2("ordinalSuffix"))),a.day)),o.rday=i.cache(i.process(o.ctoken("yesterday tomorrow soon later today now"),a.rday)),o.ddd=o.dddd=i.cache(i.process(o.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),o.M=i.cache(i.process(i.rtoken(/^(1[0-2]|0\d|\d)/),a.month)),o.MM=i.cache(i.process(i.rtoken(/^(1[0-2]|0\d)/),a.month)),o.MMM=o.MMMM=i.cache(i.process(o.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),a.month)),o.y=i.cache(i.process(i.rtoken(/^(\d\d?)/),a.year)),o.yy=i.cache(i.process(i.rtoken(/^(\d\d)/),a.year)),o.yyy=i.cache(i.process(i.rtoken(/^(\d\d?\d?\d?)/),a.year)),o.yyyy=i.cache(i.process(i.rtoken(/^(\d\d\d\d)/),a.year)),n=function(){return i.each(i.any.apply(null,arguments),i.not(o.ctoken2("timeContext")))},o.day=n(o.d,o.dd,o.rday),o.month=n(o.M,o.MMM),o.year=n(o.yyyy,o.yy),o.orientation=i.process(o.ctoken("past future"),function(e){return function(){this.orient=e}}),o.value=i.process(i.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),o.expression=i.set([o.rday,o.value,o.orientation,o.ddd,o.MMM]),n=function(){return i.set(arguments,o.datePartDelimiter)},o.mdy=n(o.ddd,o.month,o.day,o.year),o.ymd=n(o.ddd,o.year,o.month,o.day),o.dmy=n(o.ddd,o.day,o.month,o.year),o.date=function(e){return(o[t.dateElementOrder]||o.mdy).call(this,e)},o.format=i.process(i.many(i.any(i.process(i.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(o[t])return o[t];throw e.Parsing.Exception(t)}),i.process(i.rtoken(/^[^dMyhHmstz]+/),function(e){return i.ignore(i.stoken(e))}))),function(e){return i.process(i.each.apply(null,e),a.finishExact)});var c={},d=function(e){return c[e]=c[e]||o.format(e)[0]};o.formats=function(e){if(e instanceof Array){for(var t=[],r=0;r<e.length;r++)t.push(d(e[r]));return i.any.apply(null,t)}return d(e)};var l=["M/d H","M-d H","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy"];o._formats=o.formats(l),o._start=i.process(i.set([o.date,o.time,o.expression],o.generalDelimiter,o.whiteSpace),a.finish),o.start=function(e){try{var t=o._formats.call({},e);if(0===t[1].length)return t}catch(r){}return o._start.call({},e)},e._parse=e.parse,e.parse=function(t){var r=null;if(!t)return null;if(t instanceof Date)return t;try{r=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(n){return null}return 0===r[1].length?r[0]:null},e.getParseFunction=function(t){var r=e.Grammar.formats(t);return function(e){var t=null;try{t=r.call({},e)}catch(n){return null}return 0===t[1].length?t[0]:null}},e.parseExact=function(t,r){return e.getParseFunction(r)(t)}}()}function DuchessHelpersWrapper(e){function t(e){return String(e).replace(/[&\"<>]/g,function(e){return a[e]})}function r(e){var t=e.replace(/[:,\.\'\"\)\]]$/g,"");return t}this.helperLibLoaded=!0;var n="@",i="+",o=-1!=navigator.userAgent.indexOf("Win")?"ctrl":"⌘";String.prototype.insertTag=function(e,t,r,n){return this.substr(0,e)+t+this.substr(e,r)+n+this.substr(e+r)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)});var a={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},s=["YESTERDAY","TODAY","TOMORROW"],c=/(^#|[\(\s]#)([^\s\),]+)/g,d=/(?:^@|[\(\s]@)([^\s\)]+)(\s[^\s\)@]+)?(\s[^\s\)@]+)?/g,l=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/g,u=/(?:^|[\s\(\[])([^\(\[@\s]+\.(?:com|org|net))/gi;e.parseText=function(a,s,h,p){var m=!1,f=a,g=[];if(0===a.length)return{parsedText:void 0};var v=a,y=!1,b=a.length;a=t(a),b!==a.length&&(y=!0);var S,T,w,E=[];if(p&&p.___info___.count>0&&a.indexOf(i)>=0){for(var M=a.split(" "),x=0,C=0;C<M.length;C++){if(0===M[C].indexOf(i)){for(var I=void 0,A=M[C].substring(1),P=1;4>P;P++){var D=r(A);if(""===p[D]&&(I=D),!(C+P<M.length))break;A+=" "+M[C+P]}I&&g.push({name:I,lineIndex:x})}x+=M[C].length+1}if(g.length>0)for(var C=g.length-1;C>=0;C--)a=a.insertTag(g[C].lineIndex,'<p class="contact">',g[C].name.length+1,"</p>"),y=!0}for(c.lastIndex=0;S=c.exec(a);){var k=S.index+S[1].length-1,O=S[2].length+1;":"==S[2].charAt(S[2].length-1)&&O--,a=a.insertTag(k,'<p class="tag" title="'+o+'+click to search">',O,"</p>"),y=!0}for(d.lastIndex=0;S=d.exec(a);){for(var L,R=S[0].indexOf(n),_=!1,C=1;C<S.length&&S[C];++C)if(_)S[C]=void 0;else{var N=S[C][S[C].length-1];(":"===N||","===N||"."===N)&&(S[C]=S[C].slice(0,-1),_=!0)}L=S[1]+(S[2]?S[2]:"")+(S[3]?S[3]:"");var F=Date.parse(L);if(!F&&S[3]&&(L=S[1]+(S[2]?S[2]:""),F=Date.parse(L)),!F&&S[2]&&(L=S[1],F=Date.parse(L)),F){var V=e.computeDateInfo(s,h,F,L);if(V.replacedDate){dateLength=V.text.length+1;var B=S.index+R+1;a=a.substr(0,B)+V.text+a.substr(B+L.length),a=a.insertTag(S.index+R,'<p class="date">',dateLength,"</p>");var U=f.indexOf(L);f=f.substr(0,U)+V.text+f.substr(U+L.length),m=!0,E.push({date:V.date,text:V.text,explicitTime:F._explicitTime})}else dateLength=L.length+1,a=a.insertTag(S.index+R,'<p class="date">',dateLength,"</p>"),E.push({date:V.date,text:L,explicitTime:F._explicitTime});y=!0;break}}if(l.lastIndex=0,S=l.exec(a)){var q=S[0].startsWith("http")?S[0]:"http://"+S[0];T="<a target='_blank' href='"+q+"' title='"+o+"+click to navigate'>",w="</a>",a=a.insertTag(S.index,T,S[0].length,w),y=!0}else if(u.lastIndex=0,S=u.exec(a)){var R=S[0].length-S[1].length,q=S[1].startsWith("http")?S[1]:"http://"+S[1];T="<a target='_blank' href='"+q+"' title='"+o+"+click to navigate'>",w="</a>",a=a.insertTag(S.index+R,T,S[1].length,w),y=!0}return{text:v,styledText:a,parsedText:m?f:void 0,dates:E,hasStyle:y,numContacts:g.length}},e.computeDateInfo=function(e,t,r,n){function i(e){var t=864e5,r=new Date(e).clearTime()-(new Date).clearTime();return 0>r?r>=-t?"yesterday":e.toString("M/d"):t>=r&&e.isToday()?"today":2*t>=r?"tomorrow":void 0}var o,a=n,c=!1;if(t)o=r;else if(o=new Date(e),void 0!==e&&r.getTime()!==e){if(s.indexOf(n.toUpperCase())>=0){var d=r._explicitTime;o=new Date(e);var l=i(o);l&&(a=l,d&&(a+=" "+o.toString("h:mmtt")),c=!0)}}else void 0===e&&(o=r);return{text:a,date:o,replacedDate:c}}}function parseWorkerWrapper(){DuchessHelpersWrapper&&!this.helperLibLoaded&&DuchessHelpersWrapper(this.DuchessHelpers=this.DuchessHelpers||{}),dateWrapper&&!this.dateLibLoaded&&dateWrapper(),log=postMessage;var e;onmessage=function(t){if(t.data.contacts&&(e=t.data.contacts),t.data.items){for(var r=Date.now(),n=new Array(t.data.items.length),i=0;i<t.data.items.length;i++){var o=t.data.items[i];n[i]=DuchessHelpers.parseText(o.text,o.prevDate,o.isUpdate,e)}postMessage({id:t.data.id,styles:n,done:!0,start:r,end:Date.now()})}else postMessage({id:t.data.id,done:!1,msg:"ERROR: No items passed to the worker"})}}function makeLogger(e){window.log[e]=function(){window.DEBUG&&log.apply(console,arguments)}}function GoogleApiLoaded(){if(!gapiCalled){if(gapiCalled=!0,gapi.auth.init(),window.location.hash.indexOf("offline=true")>=0||window.location.hash.indexOf("offline%22:true")>=0||window.location.hash.indexOf('offline":true')>=0||window.location.hash.indexOf("demo=true")>=0)return void log("%cOffline","color: pink");gapi.client.setApiKey(window.gapiKey),gapi.load("drive-realtime",function(){if(gapi&&gapi.drive&&gapi.drive.realtime)require(["globals","goog"],function(e,t){t.loadClientDefaultFile(),e.removeDOM("blockedError")});else{require(["globals","platform"],function(e,t){var r;r=gapi?gapi.drive?gapi.drive.realtime?"all exist":"gapi.drive.realtime":"gapi.drive":"gapi",gapiCalled=!1,gapiLoadError=!0,e.reportError(new Error("Drive returned load, but unable to load "+r));var n=document.getElementById("blockedMessage");n.innerText=t.app?"There was an error loading the Google APIs, "+t.actionVerb()+" to try again.":"You are running an extension that blocked drive.google.com from loading, Moo.do requires access to function correctly.",document.getElementById("blockedError").classList.remove("none"),e.vmMain&&e.vmMain.gdriveStatus(DriveStatus.Offline)
})}}),require(["globals","util","platform","goog","VMSetup"],function(e,t,r,n){var i=!1;(!r.ie||r.mobile)&&(i=n.checkTokenInHash());var o=i||t.hasURLParam("login","true")||e.getLoginState()==LoginState.LOGGED_IN;n.runAuthenticate(n.requestScopes,!0,!1,function(r){t.removeURLParam("login",!0),r&&!r.error?(o&&(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_IN):e.setLoginState(LoginState.LOGGED_IN),n.loadClientDefaultFile(),e.openMainPage()),n.ensureRequiredScopesAreRequested()):n.requiredScopes!==n.requestScopes?(e.settings.reset(Settings.authScopes),n.runAuthenticate(n.requiredScopes,!0,!1,function(t){t&&!t.error?o&&(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_IN):e.setLoginState(LoginState.LOGGED_IN),n.loadClientDefaultFile(),e.openMainPage()):(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_OUT):e.setLoginState(LoginState.LOGGED_OUT),e.openSetupPage())})):(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_OUT):e.setLoginState(LoginState.LOGGED_OUT),e.openSetupPage())})})}}var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function r(e,t){var r,n,i,o,a,s,c,d,l,u,h=t&&t.split("/"),p=f.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),d=0;d<e.length;d+=1)if(u=e[d],"."===u)e.splice(d,1),d-=1;else if(".."===u){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(r=e.split("/"),d=r.length;d>0;d-=1){if(n=r.slice(0,d).join("/"),h)for(l=h.length;l>0;l-=1)if(i=p[h.slice(0,l).join("/")],i&&(i=i[n])){o=i,a=d;break}if(o)break;!s&&m&&m[n]&&(s=m[n],c=d)}!o&&s&&(o=s,a=c),o&&(r.splice(0,a,o),e=r.join("/"))}return e}function n(t,r){return function(){return l.apply(e,y.call(arguments,0).concat([t,r]))}}function i(e){return function(t){return r(t,e)}}function o(e){return function(t){p[e]=t}}function a(r){if(t(m,r)){var n=m[r];delete m[r],g[r]=!0,d.apply(e,n)}if(!t(p,r)&&!t(g,r))throw new Error("No "+r);return p[r]}function s(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function c(e){return function(){return f&&f.config&&f.config[e]||{}}}var d,l,u,h,p={},m={},f={},g={},v=Object.prototype.hasOwnProperty,y=[].slice;u=function(e,t){var n,o=s(e),c=o[0];return e=o[1],c&&(c=r(c,t),n=a(c)),c?e=n&&n.normalize?n.normalize(e,i(t)):r(e,t):(e=r(e,t),o=s(e),c=o[0],e=o[1],c&&(n=a(c))),{f:c?c+"!"+e:e,n:e,pr:c,p:n}},h={require:function(e){return n(e)},exports:function(e){var t=p[e];return"undefined"!=typeof t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:c(e)}}},d=function(r,i,s,c){var d,l,f,v,y,b,S=[];if(c=c||r,"function"==typeof s){for(i=!i.length&&s.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if(v=u(i[y],c),l=v.f,"require"===l)S[y]=h.require(r);else if("exports"===l)S[y]=h.exports(r),b=!0;else if("module"===l)d=S[y]=h.module(r);else if(t(p,l)||t(m,l)||t(g,l))S[y]=a(l);else{if(!v.p)throw new Error(r+" missing "+l);v.p.load(v.n,n(c,!0),o(l),{}),S[y]=p[l]}f=s.apply(p[r],S),r&&(d&&d.exports!==e&&d.exports!==p[r]?p[r]=d.exports:f===e&&b||(p[r]=f))}else r&&(p[r]=s)},requirejs=require=l=function(t,r,n,i,o){return"string"==typeof t?h[t]?h[t](r):a(u(t,r).f):(t.splice||(f=t,r.splice?(t=r,r=n,n=null):t=e),r=r||function(){},"function"==typeof n&&(n=i,i=o),i?d(e,t,r,n):setTimeout(function(){d(e,t,r,n)},4),l)},l.config=function(e){return f=e,f.deps&&l(f.deps,f.callback),l},define=function(e,r,n){r.splice||(n=r,r=[]),t(p,e)||t(m,e)||(m[e]=[e,r,n])},define.amd={jQuery:!0}}(),define("lib/almond",function(){}),function(){!function(e){var t=this||(0,eval)("this"),r=t.document,n=t.navigator,i=t.jQuery,o=t.JSON;!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(module.exports||exports):"function"==typeof define&&define.amd?define("ko",["exports"],e):e(t.ko={})}(function(a){function s(e,t,r,n){d.d[e]={init:function(e){return d.a.f.set(e,p,{}),{controlsDescendantBindings:!0}},update:function(e,i,o,a,s){o=d.a.f.get(e,p),i=d.a.c(i()),a=!r!=!i;var c=!o.gb;(c||t||a!==o.wb)&&(c&&(o.gb=d.a.Pa(d.e.childNodes(e),!0)),a?(c||d.e.S(e,d.a.Pa(o.gb)),d.Ka(n?n(s,i):s,e)):d.e.ca(e),o.wb=a)}},d.g.V[e]=!1,d.e.N[e]=!0}function c(e,t,r){r&&t!==d.i.n(e)&&d.i.X(e,t),t!==d.i.n(e)&&d.o.P(d.a.Ha,null,[e,"change"])}var d="undefined"!=typeof a?a:{};d.b=function(e,t){for(var r=e.split("."),n=d,i=0;i<r.length-1;i++)n=n[r[i]];n[r[r.length-1]]=t},d.q=function(e,t,r){e[t]=r},d.version="2.3.0",d.b("version",d.version),d.a=function(){function a(e,t){for(var r in e)e.hasOwnProperty(r)&&t(r,e[r])}function s(e,t){if("input"!==d.a.u(e)||!e.type||"click"!=t.toLowerCase())return!1;var r=e.type;return"checkbox"==r||"radio"==r}var c={},l={};c[n&&/Firefox\/2/i.test(n.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],c.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),a(c,function(e,t){if(t.length)for(var r=0,n=t.length;n>r;r++)l[t[r]]=e});var u={propertychange:!0},h=r&&function(){for(var t=3,n=r.createElement("div"),i=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",i[0];);return t>4?t:e}(),p={__proto__:[]}instanceof Array;return{Ua:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],r:function(e,t){for(var r=0,n=e.length;n>r;r++)t(e[r])},k:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var r=0,n=e.length;n>r;r++)if(e[r]===t)return r;return-1},Ma:function(e,t,r){for(var n=0,i=e.length;i>n;n++)if(t.call(r,e[n]))return e[n];return null},la:function(e,t){var r=d.a.k(e,t);r>=0&&e.splice(r,1)},Na:function(e){e=e||[];for(var t=[],r=0,n=e.length;n>r;r++)0>d.a.k(t,e[r])&&t.push(e[r]);return t},$:function(e,t){e=e||[];for(var r=[],n=0,i=e.length;i>n;n++)r.push(t(e[n]));return r},Z:function(e,t){e=e||[];for(var r=[],n=0,i=e.length;i>n;n++)t(e[n])&&r.push(e[n]);return r},U:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var r=0,n=t.length;n>r;r++)e.push(t[r]);return e},ka:function(e,t,r){var n=e.indexOf?e.indexOf(t):d.a.k(e,t);0>n?r&&e.push(t):r||e.splice(n,1)},extend:function(e,t){if(t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},w:a,pa:function(e){for(;e.firstChild;)d.removeNode(e.firstChild)},Ob:function(e){e=d.a.Q(e);for(var t=r.createElement("div"),n=0,i=e.length;i>n;n++)t.appendChild(d.J(e[n]));return t},Pa:function(e,t){for(var r=0,n=e.length,i=[];n>r;r++){var o=e[r].cloneNode(!0);i.push(t?d.J(o):o)}return i},S:function(e,t){if(d.a.pa(e),t)for(var r=0,n=t.length;n>r;r++)e.appendChild(t[r])},fb:function(e,t){var r=e.nodeType?[e]:e;if(0<r.length){for(var n=r[0],i=n.parentNode,o=0,a=t.length;a>o;o++)i.insertBefore(t[o],n);for(o=0,a=r.length;a>o;o++)d.removeNode(r[o])}},ib:function(e,t){7>h?e.setAttribute("selected",t):e.selected=t},H:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Yb:function(e,t){for(var r=[],n=(e||"").split(t),i=0,o=n.length;o>i;i++){var a=d.a.H(n[i]);""!==a&&r.push(a)}return r},Vb:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},zb:function(e,t){if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;null!=e;){if(e==t)return!0;e=e.parentNode}return!1},ba:function(e){return d.a.zb(e,e.ownerDocument)},qb:function(e){return!!d.a.Ma(e,d.a.ba)},u:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},p:function(e,t,r){var n=h&&u[t];if(n||"undefined"==typeof i)if(n||"function"!=typeof e.addEventListener){if("undefined"==typeof e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var o=function(t){r.call(e,t)},a="on"+t;e.attachEvent(a,o),d.a.F.ja(e,function(){e.detachEvent(a,o)})}else e.addEventListener(t,r,!1);else{if(s(e,t)){var c=r;r=function(e,t){var r=this.checked;t&&(this.checked=!0!==t.tb),c.call(this,e),this.checked=r}}i(e).bind(t,r)}},Ha:function(e,n){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");if("undefined"!=typeof i){var o=[];s(e,n)&&o.push({tb:e.checked}),i(e).trigger(n,o)}else if("function"==typeof r.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");o=r.createEvent(l[n]||"HTMLEvents"),o.initEvent(n,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(o)}else{if("undefined"==typeof e.fireEvent)throw Error("Browser doesn't support triggering events");s(e,n)&&(e.checked=!0!==e.checked),e.fireEvent("on"+n)}},c:function(e){return d.W(e)?e():e},za:function(e){return d.W(e)?e.t():e},ha:function(e,t,r){if(t){var n=/\S+/g,i=e.className.match(n)||[];d.a.r(t.match(n),function(e){d.a.ka(i,e,r)}),e.className=i.join(" ")}},jb:function(t,n){var i=d.a.c(n);(null===i||i===e)&&(i="");var o=d.e.firstChild(t);!o||3!=o.nodeType||d.e.nextSibling(o)?d.e.S(t,[r.createTextNode(i)]):o.data=i,d.a.Cb(t)},hb:function(e,t){if(e.name=t,7>=h)try{e.mergeAttributes(r.createElement("<input name='"+e.name+"'/>"),!1)}catch(n){}},Cb:function(e){h>=9&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},Ab:function(e){if(h){var t=e.style.width;e.style.width=0,e.style.width=t}},Sb:function(e,t){e=d.a.c(e),t=d.a.c(t);for(var r=[],n=e;t>=n;n++)r.push(n);return r},Q:function(e){for(var t=[],r=0,n=e.length;n>r;r++)t.push(e[r]);return t},Wb:6===h,Xb:7===h,da:h,Va:function(e,t){for(var r=d.a.Q(e.getElementsByTagName("input")).concat(d.a.Q(e.getElementsByTagName("textarea"))),n="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},i=[],o=r.length-1;o>=0;o--)n(r[o])&&i.push(r[o]);return i},Pb:function(e){return"string"==typeof e&&(e=d.a.H(e))?o&&o.parse?o.parse(e):new Function("return "+e)():null},Da:function(e,t,r){if(!o||!o.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return o.stringify(d.a.c(e),t,r)},Qb:function(e,t,n){n=n||{};var i=n.params||{},o=n.includeFields||this.Ua,s=e;if("object"==typeof e&&"form"===d.a.u(e))for(var s=e.action,c=o.length-1;c>=0;c--)for(var l=d.a.Va(e,o[c]),u=l.length-1;u>=0;u--)i[l[u].name]=l[u].value;t=d.a.c(t);var h=r.createElement("form");h.style.display="none",h.action=s,h.method="post";for(var p in t)e=r.createElement("input"),e.name=p,e.value=d.a.Da(d.a.c(t[p])),h.appendChild(e);a(i,function(e,t){var n=r.createElement("input");n.name=e,n.value=t,h.appendChild(n)}),r.body.appendChild(h),n.submitter?n.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)},I:function(e,t){return p?(e.__proto__=t,!0):!1}}}(),d.b("utils",d.a),d.b("utils.arrayForEach",d.a.r),d.b("utils.arrayFirst",d.a.Ma),d.b("utils.arrayFilter",d.a.Z),d.b("utils.arrayGetDistinctValues",d.a.Na),d.b("utils.arrayIndexOf",d.a.k),d.b("utils.arrayMap",d.a.$),d.b("utils.arrayPushAll",d.a.U),d.b("utils.arrayRemoveItem",d.a.la),d.b("utils.extend",d.a.extend),d.b("utils.fieldsIncludedWithJsonPost",d.a.Ua),d.b("utils.getFormFields",d.a.Va),d.b("utils.peekObservable",d.a.za),d.b("utils.postJson",d.a.Qb),d.b("utils.parseJson",d.a.Pb),d.b("utils.registerEventHandler",d.a.p),d.b("utils.stringifyJson",d.a.Da),d.b("utils.range",d.a.Sb),d.b("utils.toggleDomNodeCssClass",d.a.ha),d.b("utils.triggerEvent",d.a.Ha),d.b("utils.unwrapObservable",d.a.c),d.b("utils.objectForEach",d.a.w),d.b("utils.addOrRemoveItem",d.a.ka),d.b("unwrap",d.a.c),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,r=Array.prototype.slice.call(arguments);return e=r.shift(),function(){return t.apply(e,r.concat(Array.prototype.slice.call(arguments)))}}),d.a.f=new function(){var t=0,r="__ko__"+(new Date).getTime(),n={};return{get:function(t,r){var n=d.a.f.qa(t,!1);return n===e?e:n[r]},set:function(t,r,n){(n!==e||d.a.f.qa(t,!1)!==e)&&(d.a.f.qa(t,!0)[r]=n)},qa:function(i,o){var a=i[r];if(!a||"null"===a||!n[a]){if(!o)return e;a=i[r]="ko"+t++,n[a]={}}return n[a]},clear:function(e){var t=e[r];return t?(delete n[t],e[r]=null,!0):!1}}},d.b("utils.domData",d.a.f),d.b("utils.domData.clear",d.a.f.clear),d.a.F=new function(){function t(t,r){var i=d.a.f.get(t,n);return i===e&&r&&(i=[],d.a.f.set(t,n,i)),i}function r(e){var n=t(e,!1);if(n)for(var n=n.slice(0),o=0;o<n.length;o++)n[o](e);if(d.a.f.clear(e),"function"==typeof i&&"function"==typeof i.cleanData&&i.cleanData([e]),a[e.nodeType])for(n=e.firstChild;e=n;)n=e.nextSibling,8===e.nodeType&&r(e)}var n="__ko_domNodeDisposal__"+(new Date).getTime(),o={1:!0,8:!0,9:!0},a={1:!0,9:!0};return{ja:function(e,r){if("function"!=typeof r)throw Error("Callback must be a function");t(e,!0).push(r)},eb:function(r,i){var o=t(r,!1);o&&(d.a.la(o,i),0==o.length&&d.a.f.set(r,n,e))},J:function(e){if(o[e.nodeType]&&(r(e),a[e.nodeType])){var t=[];d.a.U(t,e.getElementsByTagName("*"));for(var n=0,i=t.length;i>n;n++)r(t[n])}return e},removeNode:function(e){d.J(e),e.parentNode&&e.parentNode.removeChild(e)}}},d.J=d.a.F.J,d.removeNode=d.a.F.removeNode,d.b("cleanNode",d.J),d.b("removeNode",d.removeNode),d.b("utils.domNodeDisposal",d.a.F),d.b("utils.domNodeDisposal.addDisposeCallback",d.a.F.ja),d.b("utils.domNodeDisposal.removeDisposeCallback",d.a.F.eb),function(){d.a.ya=function(e){var n;if("undefined"!=typeof i){if(i.parseHTML)n=i.parseHTML(e)||[];else if((n=i.clean([e]))&&n[0]){for(e=n[0];e.parentNode&&11!==e.parentNode.nodeType;)e=e.parentNode;e.parentNode&&e.parentNode.removeChild(e)}}else{var o=d.a.H(e).toLowerCase();for(n=r.createElement("div"),o=o.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!o.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!o.indexOf("<td")||!o.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],e="ignored<div>"+o[1]+e+o[2]+"</div>","function"==typeof t.innerShiv?n.appendChild(t.innerShiv(e)):n.innerHTML=e;o[0]--;)n=n.lastChild;n=d.a.Q(n.lastChild.childNodes)}return n},d.a.ga=function(t,r){if(d.a.pa(t),r=d.a.c(r),null!==r&&r!==e)if("string"!=typeof r&&(r=r.toString()),"undefined"!=typeof i)i(t).html(r);else for(var n=d.a.ya(r),o=0;o<n.length;o++)t.appendChild(n[o])}}(),d.b("utils.parseHtmlFragment",d.a.ya),d.b("utils.setHtml",d.a.ga),d.s=function(){function t(e,r){if(e)if(8==e.nodeType){var n=d.s.ab(e.nodeValue);null!=n&&r.push({yb:e,Mb:n})}else if(1==e.nodeType)for(var n=0,i=e.childNodes,o=i.length;o>n;n++)t(i[n],r)}var r={};return{wa:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return r[t]=e,"<!--[ko_memo:"+t+"]-->"},nb:function(t,n){var i=r[t];if(i===e)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return i.apply(null,n||[]),!0}finally{delete r[t]}},ob:function(e,r){var n=[];t(e,n);for(var i=0,o=n.length;o>i;i++){var a=n[i].yb,s=[a];r&&d.a.U(s,r),d.s.nb(n[i].Mb,s),a.nodeValue="",a.parentNode&&a.parentNode.removeChild(a)}},ab:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),d.b("memoization",d.s),d.b("memoization.memoize",d.s.wa),d.b("memoization.unmemoize",d.s.nb),d.b("memoization.parseMemoText",d.s.ab),d.b("memoization.unmemoizeDomNodeAndDescendants",d.s.ob),d.Ta={throttle:function(e,t){e.throttleEvaluation=t;var r=null;return d.h({read:e,write:function(n){clearTimeout(r),r=setTimeout(function(){e(n)},t)}})},notify:function(e,t){return e.equalityComparer="always"==t?function(){return!1}:d.l.fn.equalityComparer,e}},d.b("extenders",d.Ta),d.lb=function(e,t,r){this.target=e,this.ma=t,this.xb=r,d.q(this,"dispose",this.D)},d.lb.prototype.D=function(){this.Jb=!0,this.xb()},d.A=function(){this.B={},d.a.I(this,d.A.fn)||d.a.extend(this,d.A.fn),d.q(this,"subscribe",this.Ea),d.q(this,"extend",this.extend),d.q(this,"getSubscriptionsCount",this.Eb)},d.A.fn={Ea:function(e,t,r){r=r||"change";var n=new d.lb(this,t?e.bind(t):e,function(){d.a.la(this.B[r],n)}.bind(this));return this.B[r]||(this.B[r]=[]),this.B[r].push(n),n},notifySubscribers:function(e,t){if(t=t||"change",this.Fb(t))try{d.o.Oa();for(var r,n=this.B[t].slice(0),i=0;r=n[i];++i)r&&!0!==r.Jb&&r.ma(e)}finally{d.o.end()}},Fb:function(e){return this.B[e]&&this.B[e].length},Eb:function(){var e=0;return d.a.w(this.B,function(t,r){e+=r.length}),e},extend:function(e){var t=this;return e&&d.a.w(e,function(e,r){var n=d.Ta[e];"function"==typeof n&&(t=n(t,r))}),t}},d.a.I(d.A.fn,Function.prototype),d.Xa=function(e){return null!=e&&"function"==typeof e.Ea&&"function"==typeof e.notifySubscribers},d.b("subscribable",d.A),d.b("isSubscribable",d.Xa),d.o=function(){var e=[];return{Oa:function(t){e.push(t&&{ma:t,Sa:[]})},end:function(){e.pop()},cb:function(t){if(!d.Xa(t))throw Error("Only subscribable things can act as dependencies");if(0<e.length){var r=e[e.length-1];!r||0<=d.a.k(r.Sa,t)||(r.Sa.push(t),r.ma(t))}},P:function(t,r,n){try{return e.push(null),t.apply(r,n||[])}finally{e.pop()}}}}();var l={undefined:!0,"boolean":!0,number:!0,string:!0};d.l=function(e){function t(){return 0<arguments.length?(t.equalityComparer&&t.equalityComparer(r,arguments[0])||(t.M(),r=arguments[0],t.L()),this):(d.o.cb(t),r)}var r=e;return d.A.call(t),t.t=function(){return r},t.L=function(){t.notifySubscribers(r)},t.M=function(){t.notifySubscribers(r,"beforeChange")},d.a.I(t,d.l.fn)||d.a.extend(t,d.l.fn),d.q(t,"peek",t.t),d.q(t,"valueHasMutated",t.L),d.q(t,"valueWillMutate",t.M),t},d.l.fn={equalityComparer:function(e,t){return null===e||typeof e in l?e===t:!1}};var u=d.l.Rb="__ko_proto__";d.l.fn[u]=d.l,d.a.I(d.l.fn,d.A.fn),d.ra=function(t,r){return null===t||t===e||t[u]===e?!1:t[u]===r?!0:d.ra(t[u],r)},d.W=function(e){return d.ra(e,d.l)},d.Ya=function(e){return"function"==typeof e&&e[u]===d.l||"function"==typeof e&&e[u]===d.h&&e.Gb?!0:!1},d.b("observable",d.l),d.b("isObservable",d.W),d.b("isWriteableObservable",d.Ya),d.K=function(e){if(e=e||[],"object"!=typeof e||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=d.l(e),d.a.I(e,d.K.fn)||d.a.extend(e,d.K.fn),e},d.K.fn={remove:function(e){for(var t=this.t(),r=[],n="function"==typeof e?e:function(t){return t===e},i=0;i<t.length;i++){var o=t[i];n(o)&&(0===r.length&&this.M(),r.push(o),t.splice(i,1),i--)}return r.length&&this.L(),r},removeAll:function(t){if(t===e){var r=this.t(),n=r.slice(0);return this.M(),r.splice(0,r.length),this.L(),n}return t?this.remove(function(e){return 0<=d.a.k(t,e)}):[]},destroy:function(e){var t=this.t(),r="function"==typeof e?e:function(t){return t===e};this.M();for(var n=t.length-1;n>=0;n--)r(t[n])&&(t[n]._destroy=!0);this.L()},destroyAll:function(t){return t===e?this.destroy(function(){return!0}):t?this.destroy(function(e){return 0<=d.a.k(t,e)}):[]},indexOf:function(e){var t=this();return d.a.k(t,e)},replace:function(e,t){var r=this.indexOf(e);r>=0&&(this.M(),this.t()[r]=t,this.L())}},d.a.r("pop push reverse shift sort splice unshift".split(" "),function(e){d.K.fn[e]=function(){var t=this.t();return this.M(),t=t[e].apply(t,arguments),this.L(),t}}),d.a.r(["slice"],function(e){d.K.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),d.a.I(d.K.fn,d.l.fn),d.b("observableArray",d.K),d.h=function(t,r,n){function i(){d.a.r(y,function(e){e.D()}),y=[]}function o(){var e=s.throttleEvaluation;e&&e>=0?(clearTimeout(b),b=setTimeout(a,e)):a()}function a(){if(!h)if(u&&g())v();else{h=!0;try{var t=d.a.$(y,function(e){return e.target});d.o.Oa(function(r){var n;0<=(n=d.a.k(t,r))?t[n]=e:y.push(r.Ea(o))});for(var n=r?p.call(r):p(),i=t.length-1;i>=0;i--)t[i]&&y.splice(i,1)[0].D();u=!0,s.notifySubscribers(l,"beforeChange"),l=n,s.notifySubscribers(l)}finally{d.o.end(),h=!1}y.length||v()}}function s(){if(0<arguments.length){if("function"!=typeof m)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return m.apply(r,arguments),this}return u||a(),d.o.cb(s),l}function c(){return!u||0<y.length}var l,u=!1,h=!1,p=t;if(p&&"object"==typeof p?(n=p,p=n.read):(n=n||{},p||(p=n.read)),"function"!=typeof p)throw Error("Pass a function that returns the value of the ko.computed");var m=n.write,f=n.disposeWhenNodeIsRemoved||n.aa||null,g=n.disposeWhen||n.Ra||function(){return!1},v=i,y=[],b=null;if(r||(r=n.owner),s.t=function(){return u||a(),l},s.Db=function(){return y.length},s.Gb="function"==typeof n.write,s.D=function(){v()},s.ua=c,d.A.call(s),d.a.I(s,d.h.fn)||d.a.extend(s,d.h.fn),d.q(s,"peek",s.t),d.q(s,"dispose",s.D),d.q(s,"isActive",s.ua),d.q(s,"getDependenciesCount",s.Db),!0!==n.deferEvaluation&&a(),f&&c()){v=function(){d.a.F.eb(f,v),i()},d.a.F.ja(f,v);var S=g,g=function(){return!d.a.ba(f)||S()}}return s},d.Ib=function(e){return d.ra(e,d.h)},a=d.l.Rb,d.h[a]=d.l,d.h.fn={},d.h.fn[a]=d.h,d.a.I(d.h.fn,d.A.fn),d.b("dependentObservable",d.h),d.b("computed",d.h),d.b("isComputed",d.Ib),function(){function t(i,o,a){if(a=a||new n,i=o(i),"object"!=typeof i||null===i||i===e||i instanceof Date||i instanceof String||i instanceof Number||i instanceof Boolean)return i;var s=i instanceof Array?[]:{};return a.save(i,s),r(i,function(r){var n=o(i[r]);switch(typeof n){case"boolean":case"number":case"string":case"function":s[r]=n;break;case"object":case"undefined":var c=a.get(n);s[r]=c!==e?c:t(n,o,a)}}),s}function r(e,t){if(e instanceof Array){for(var r=0;r<e.length;r++)t(r);"function"==typeof e.toJSON&&t("toJSON")}else for(r in e)t(r)}function n(){this.keys=[],this.Ia=[]}d.mb=function(e){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(e,function(e){for(var t=0;d.W(e)&&10>t;t++)e=e();return e})},d.toJSON=function(e,t,r){return e=d.mb(e),d.a.Da(e,t,r)},n.prototype={save:function(e,t){var r=d.a.k(this.keys,e);r>=0?this.Ia[r]=t:(this.keys.push(e),this.Ia.push(t))},get:function(t){return t=d.a.k(this.keys,t),t>=0?this.Ia[t]:e}}}(),d.b("toJS",d.mb),d.b("toJSON",d.toJSON),function(){d.i={n:function(t){switch(d.a.u(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?d.a.f.get(t,d.d.options.xa):7>=d.a.da?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?d.i.n(t.options[t.selectedIndex]):e;default:return t.value}},X:function(t,r){switch(d.a.u(t)){case"option":switch(typeof r){case"string":d.a.f.set(t,d.d.options.xa,e),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=r;break;default:d.a.f.set(t,d.d.options.xa,r),t.__ko__hasDomDataOptionValue__=!0,t.value="number"==typeof r?r:""}break;case"select":""===r&&(r=e),(null===r||r===e)&&(t.selectedIndex=-1);for(var n=t.options.length-1;n>=0;n--)if(d.i.n(t.options[n])==r){t.selectedIndex=n;break}1<t.size||-1!==t.selectedIndex||(t.selectedIndex=0);break;default:(null===r||r===e)&&(r=""),t.value=r}}}}(),d.b("selectExtensions",d.i),d.b("selectExtensions.readValue",d.i.n),d.b("selectExtensions.writeValue",d.i.X),d.g=function(){function e(e,r){for(var n=null;e!=n;)n=e,e=e.replace(t,function(e,t){return r[t]});return e}var t=/\@ko_token_(\d+)\@/g,r=["true","false","null","undefined"],n=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;return{V:[],ea:function(t){var r=d.a.H(t);if(3>r.length)return[];"{"===r.charAt(0)&&(r=r.substring(1,r.length-1)),t=[];for(var n,i=null,o=0;o<r.length;o++){var a=r.charAt(o);if(null===i)switch(a){case'"':case"'":case"/":i=o,n=a}else if(a==n&&"\\"!==r.charAt(o-1)){a=r.substring(i,o+1),t.push(a);var s="@ko_token_"+(t.length-1)+"@",r=r.substring(0,i)+s+r.substring(o+1),o=o-(a.length-s.length),i=null}}n=i=null;for(var c=0,l=null,o=0;o<r.length;o++){if(a=r.charAt(o),null===i)switch(a){case"{":i=o,l=a,n="}";break;case"(":i=o,l=a,n=")";break;case"[":i=o,l=a,n="]"}a===l?c++:a===n&&(c--,0===c&&(a=r.substring(i,o+1),t.push(a),s="@ko_token_"+(t.length-1)+"@",r=r.substring(0,i)+s+r.substring(o+1),o-=a.length-s.length,i=null))}for(n=[],r=r.split(","),i=0,o=r.length;o>i;i++)c=r[i],l=c.indexOf(":"),l>0&&l<c.length-1?(a=c.substring(l+1),n.push({key:e(c.substring(0,l),t),value:e(a,t)})):n.push({unknown:e(c,t)});return n},fa:function(e){var t="string"==typeof e?d.g.ea(e):e,i=[];e=[];for(var o,a=0;o=t[a];a++)if(0<i.length&&i.push(","),o.key){var s;e:{s=o.key;var c=d.a.H(s);switch(c.length&&c.charAt(0)){case"'":case'"':break e;default:s="'"+c+"'"}}o=o.value,i.push(s),i.push(":"),i.push(o),o=d.a.H(o),0<=d.a.k(r,d.a.H(o).toLowerCase())?o=!1:(c=o.match(n),o=null===c?!1:c[1]?"Object("+c[1]+")"+c[2]:o),o&&(0<e.length&&e.push(", "),e.push(s+" : function(__ko_value) { "+o+" = __ko_value; }"))}else o.unknown&&i.push(o.unknown);return t=i.join(""),0<e.length&&(t=t+", '_ko_property_writers' : { "+e.join("")+" } "),t},Lb:function(e,t){for(var r=0;r<e.length;r++)if(d.a.H(e[r].key)==t)return!0;return!1},ia:function(e,t,r,n,i){e&&d.W(e)?!d.Ya(e)||i&&e.t()===n||e(n):(e=t()._ko_property_writers)&&e[r]&&e[r](n)}}}(),d.b("expressionRewriting",d.g),d.b("expressionRewriting.bindingRewriteValidators",d.g.V),d.b("expressionRewriting.parseObjectLiteral",d.g.ea),d.b("expressionRewriting.preProcessBindings",d.g.fa),d.b("jsonExpressionRewriting",d.g),d.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",d.g.fa),function(){function e(e){return 8==e.nodeType&&(o?e.text:e.nodeValue).match(a)}function t(e){return 8==e.nodeType&&(o?e.text:e.nodeValue).match(s)}function n(r,n){for(var i=r,o=1,a=[];i=i.nextSibling;){if(t(i)&&(o--,0===o))return a;a.push(i),e(i)&&o++}if(!n)throw Error("Cannot find closing comment tag to match: "+r.nodeValue);return null}function i(e,t){var r=n(e,t);return r?0<r.length?r[r.length-1].nextSibling:e.nextSibling:null}var o=r&&"<!--test-->"===r.createComment("test").text,a=o?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,s=o?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,c={ul:!0,ol:!0};d.e={N:{},childNodes:function(t){return e(t)?n(t):t.childNodes},ca:function(t){if(e(t)){t=d.e.childNodes(t);for(var r=0,n=t.length;n>r;r++)d.removeNode(t[r])}else d.a.pa(t)},S:function(t,r){if(e(t)){d.e.ca(t);for(var n=t.nextSibling,i=0,o=r.length;o>i;i++)n.parentNode.insertBefore(r[i],n)}else d.a.S(t,r)},bb:function(t,r){e(t)?t.parentNode.insertBefore(r,t.nextSibling):t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r)},Wa:function(t,r,n){n?e(t)?t.parentNode.insertBefore(r,n.nextSibling):n.nextSibling?t.insertBefore(r,n.nextSibling):t.appendChild(r):d.e.bb(t,r)},firstChild:function(r){return e(r)?!r.nextSibling||t(r.nextSibling)?null:r.nextSibling:r.firstChild},nextSibling:function(r){return e(r)&&(r=i(r)),r.nextSibling&&t(r.nextSibling)?null:r.nextSibling},pb:function(t){return(t=e(t))?t[1]:null},$a:function(r){if(c[d.a.u(r)]){var n=r.firstChild;if(n)do if(1===n.nodeType){var o;o=n.firstChild;var a=null;if(o)do if(a)a.push(o);else if(e(o)){var s=i(o,!0);s?o=s:a=[o]}else t(o)&&(a=[o]);while(o=o.nextSibling);if(o=a)for(a=n.nextSibling,s=0;s<o.length;s++)a?r.insertBefore(o[s],a):r.appendChild(o[s])}while(n=n.nextSibling)}}}}(),d.b("virtualElements",d.e),d.b("virtualElements.allowedBindings",d.e.N),d.b("virtualElements.emptyNode",d.e.ca),d.b("virtualElements.insertAfter",d.e.Wa),d.b("virtualElements.prepend",d.e.bb),d.b("virtualElements.setDomNodeChildren",d.e.S),function(){d.O=function(){this.sb={}},d.a.extend(d.O.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind");case 8:return null!=d.e.pb(e);default:return!1}},getBindings:function(e,t){var r=this.getBindingsString(e,t);return r?this.parseBindingsString(r,t,e):null},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return d.e.pb(e);default:return null}},parseBindingsString:function(e,t,r){try{var n,i=this.sb;if(!(n=i[e])){var o,a="with($context){with($data||{}){return{"+d.g.fa(e)+"}}}";o=new Function("$context","$element",a),n=i[e]=o}return n(t,r)}catch(s){throw s.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+s.message,s}}}),d.O.instance=new d.O}(),d.b("bindingProvider",d.O),function(){function r(e,t,r){for(var i=d.e.firstChild(t);t=i;)i=d.e.nextSibling(t),n(e,t,r)}function n(e,t,n){var o=!0,a=1===t.nodeType;a&&d.e.$a(t),(a&&n||d.O.instance.nodeHasBindings(t))&&(o=i(t,null,e,n).Ub),o&&r(e,t,!a)}function i(t,r,n,i){function a(e){return function(){return c[e]}}function s(){return c}var c,l,u=0,h=d.a.f.get(t,o);if(!r){if(h)throw Error("You cannot apply bindings multiple times to the same element."+t.id+" "+t.className);d.a.f.set(t,o,!0)}return d.h(function(){var o=n&&n instanceof d.C?n:new d.C(d.a.c(n)),p=o.$data;!h&&i&&d.kb(t,o),(c=("function"==typeof r?r(o,t):r)||d.O.instance.getBindings(t,o))&&(0===u&&(u=1,d.a.w(c,function(r){var n=d.d[r];if(n&&8===t.nodeType&&!d.e.N[r])throw Error("The binding '"+r+"' cannot be used with virtual elements");if(n&&"function"==typeof n.init&&(n=n.init(t,a(r),s,p,o))&&n.controlsDescendantBindings){if(l!==e)throw Error("Multiple bindings ("+l+" and "+r+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");l=r}}),u=2),2===u&&d.a.w(c,function(e){var r=d.d[e];r&&"function"==typeof r.update&&r.update(t,a(e),s,p,o)}))},null,{aa:t}),{Ub:l===e}}d.d={},d.C=function(e,t,r){t?(d.a.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e,this.ko=d),this.$data=e,r&&(this[r]=e)},d.C.prototype.createChildContext=function(e,t){return new d.C(e,this,t)},d.C.prototype.extend=function(e){var t=d.a.extend(new d.C,this);return d.a.extend(t,e)};var o="__ko_boundElement";d.kb=function(e,t){return 2!=arguments.length?d.a.f.get(e,"__ko_bindingContext__"):void d.a.f.set(e,"__ko_bindingContext__",t)},d.La=function(e,t,r){return 1===e.nodeType&&d.e.$a(e),i(e,t,r,!0)},d.Ka=function(e,t){1!==t.nodeType&&8!==t.nodeType||r(e,t,!0)},d.Ja=function(e,r){if(r&&1!==r.nodeType&&8!==r.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");r=r||t.document.body,n(e,r,!0)},d.oa=function(t){switch(t.nodeType){case 1:case 8:var r=d.kb(t);if(r)return r;if(t.parentNode)return d.oa(t.parentNode)}return e},d.vb=function(t){return(t=d.oa(t))?t.$data:e},d.b("bindingHandlers",d.d),d.b("applyBindings",d.Ja),d.b("applyBindingsToDescendants",d.Ka),d.b("applyBindingsToNode",d.La),d.b("contextFor",d.oa),d.b("dataFor",d.vb)}();var h={"class":"className","for":"htmlFor"};d.d.attr={update:function(t,r){var n=d.a.c(r())||{};d.a.w(n,function(r,n){n=d.a.c(n);var i=!1===n||null===n||n===e;i&&t.removeAttribute(r),8>=d.a.da&&r in h?(r=h[r],i?t.removeAttribute(r):t[r]=n):i||t.setAttribute(r,n.toString()),"name"===r&&d.a.hb(t,i?"":n.toString())})}},d.d.checked={init:function(e,t,r){d.a.p(e,"click",function(){var n;if("checkbox"==e.type)n=e.checked;else{if("radio"!=e.type||!e.checked)return;n=e.value}var i=t(),o=d.a.c(i);"checkbox"==e.type&&o instanceof Array?d.a.ka(i,e.value,e.checked):d.g.ia(i,r,"checked",n,!0)}),"radio"!=e.type||e.name||d.d.uniqueName.init(e,function(){return!0})},update:function(e,t){var r=d.a.c(t());"checkbox"==e.type?e.checked=r instanceof Array?0<=d.a.k(r,e.value):r:"radio"==e.type&&(e.checked=e.value==r)}},d.d.css={update:function(e,t){var r=d.a.c(t());"object"==typeof r?d.a.w(r,function(t,r){r=d.a.c(r),d.a.ha(e,t,r)}):(r=String(r||""),d.a.ha(e,e.__ko__cssValue,!1),e.__ko__cssValue=r,d.a.ha(e,r,!0))}},d.d.enable={update:function(e,t){var r=d.a.c(t());r&&e.disabled?e.removeAttribute("disabled"):r||e.disabled||(e.disabled=!0)}},d.d.disable={update:function(e,t){d.d.enable.update(e,function(){return!d.a.c(t())})}},d.d.event={init:function(e,t,r,n){var i=t()||{};d.a.w(i,function(i){"string"==typeof i&&d.a.p(e,i,function(e){var o,a=t()[i];if(a){var s=r();try{var c=d.a.Q(arguments);c.unshift(n),o=a.apply(n,c)}finally{!0!==o&&(e.preventDefault?e.preventDefault():e.returnValue=!1)
}!1===s[i+"Bubble"]&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},d.d.foreach={Za:function(e){return function(){var t=e(),r=d.a.za(t);return r&&"number"!=typeof r.length?(d.a.c(t),{foreach:r.data,as:r.as,includeDestroyed:r.includeDestroyed,afterAdd:r.afterAdd,beforeRemove:r.beforeRemove,afterRender:r.afterRender,beforeMove:r.beforeMove,afterMove:r.afterMove,templateEngine:d.G.ta}):{foreach:t,templateEngine:d.G.ta}}},init:function(e,t){return d.d.template.init(e,d.d.foreach.Za(t))},update:function(e,t,r,n,i){return d.d.template.update(e,d.d.foreach.Za(t),r,n,i)}},d.g.V.foreach=!1,d.e.N.foreach=!0,d.d.hasfocus={init:function(e,t,r){function n(n){e.__ko_hasfocusUpdating=!0;var i=e.ownerDocument;if("activeElement"in i){var o;try{o=i.activeElement}catch(a){o=i.body}n=o===e}i=t(),d.g.ia(i,r,"hasfocus",n,!0),e.__ko_hasfocusLastValue=n,e.__ko_hasfocusUpdating=!1}var i=n.bind(null,!0),o=n.bind(null,!1);d.a.p(e,"focus",i),d.a.p(e,"focusin",i),d.a.p(e,"blur",o),d.a.p(e,"focusout",o)},update:function(e,t){var r=!!d.a.c(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===r||(r?e.focus():e.blur(),d.o.P(d.a.Ha,null,[e,r?"focusin":"focusout"]))}},d.d.hasFocus=d.d.hasfocus,d.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){d.a.ga(e,t())}};var p="__ko_withIfBindingData";s("if"),s("ifnot",!1,!0),s("with",!0,!1,function(e,t){return e.createChildContext(t)}),d.d.options={init:function(e){if("select"!==d.a.u(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,n,i){function o(e,t,r){var n=typeof t;return"function"==n?t(e):"string"==n?e[t]:r}function a(e,t){if(h){var r=0<=d.a.k(h,d.i.n(t[0]));d.a.ib(t[0],r)}}var s=0==t.length,l=!s&&t.multiple?t.scrollTop:null;n=d.a.c(n());var u,h,p=i(),m=p.optionsIncludeDestroyed,f={};if(t.multiple?h=d.a.$(t.selectedOptions||d.a.Z(t.childNodes,function(e){return e.tagName&&"option"===d.a.u(e)&&e.selected}),function(e){return d.i.n(e)}):0<=t.selectedIndex&&(h=[d.i.n(t.options[t.selectedIndex])]),n){"undefined"==typeof n.length&&(n=[n]);var g=d.a.Z(n,function(t){return m||t===e||null===t||!d.a.c(t._destroy)});"optionsCaption"in p&&(u=d.a.c(p.optionsCaption),null!==u&&u!==e&&g.unshift(f))}else n=[];i=a,p.optionsAfterRender&&(i=function(t,r){a(0,r),d.o.P(p.optionsAfterRender,null,[r[0],t!==f?t:e])}),d.a.Ba(t,g,function(t,n,i){return i.length&&(h=i[0].selected&&[d.i.n(i[0])]),n=r.createElement("option"),t===f?(d.a.ga(n,u),d.i.X(n,e)):(i=o(t,p.optionsValue,t),d.i.X(n,d.a.c(i)),t=o(t,p.optionsText,i),d.a.jb(n,t)),[n]},null,i),h=null,s&&"value"in p&&c(t,d.a.za(p.value),!0),d.a.Ab(t),l&&20<Math.abs(l-t.scrollTop)&&(t.scrollTop=l)}},d.d.options.xa="__ko.optionValueDomData__",d.d.selectedOptions={init:function(e,t,r){d.a.p(e,"change",function(){var n=t(),i=[];d.a.r(e.getElementsByTagName("option"),function(e){e.selected&&i.push(d.i.n(e))}),d.g.ia(n,r,"selectedOptions",i)})},update:function(e,t){if("select"!=d.a.u(e))throw Error("values binding applies only to SELECT elements");var r=d.a.c(t());r&&"number"==typeof r.length&&d.a.r(e.getElementsByTagName("option"),function(e){var t=0<=d.a.k(r,d.i.n(e));d.a.ib(e,t)})}},d.d.style={update:function(e,t){var r=d.a.c(t()||{});d.a.w(r,function(t,r){r=d.a.c(r),e.style[t]!==r&&(e.style[t]=r||"")})}},d.d.submit={init:function(e,t,r,n){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");d.a.p(e,"submit",function(r){var i,o=t();try{i=o.call(n,e)}finally{!0!==i&&(r.preventDefault?r.preventDefault():r.returnValue=!1)}})}},d.d.text={update:function(e,t){d.a.jb(e,t())}},d.e.N.text=!0,d.d.uniqueName={init:function(e,t){if(t()){var r="ko_unique_"+ ++d.d.uniqueName.ub;d.a.hb(e,r)}}},d.d.uniqueName.ub=0,d.d.value={init:function(e,t,r){function n(){a=!1;var n=t(),i=d.i.n(e);d.g.ia(n,r,"value",i)}var i=["change"],o=r().valueUpdate,a=!1;o&&("string"==typeof o&&(o=[o]),d.a.U(i,o),i=d.a.Na(i)),!d.a.da||"input"!=e.tagName.toLowerCase()||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=d.a.k(i,"propertychange")||(d.a.p(e,"propertychange",function(){a=!0}),d.a.p(e,"blur",function(){a&&n()})),d.a.r(i,function(t){var r=n;d.a.Vb(t,"after")&&(r=function(){setTimeout(n,0)},t=t.substring(5)),d.a.p(e,t,r)})},update:function(e,t){var r="select"===d.a.u(e),n=d.a.c(t()),i=d.i.n(e);n!==i&&(i=function(){d.i.X(e,n)},i(),r&&setTimeout(i,0)),r&&0<e.length&&c(e,n,!1)}},d.d.visible={update:function(e,t){var r=d.a.c(t()),n="none"!=e.style.display;r&&!n?e.style.display="":!r&&n&&(e.style.display="none")}},function(e){d.d[e]={init:function(t,r,n,i){return d.d.event.init.call(this,t,function(){var t={};return t[e]=r(),t},n,i)}}}("click"),d.v=function(){},d.v.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},d.v.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},d.v.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||r;var n=t.getElementById(e);if(!n)throw Error("Cannot find template with ID "+e);return new d.m.j(n)}if(1==e.nodeType||8==e.nodeType)return new d.m.T(e);throw Error("Unknown template type: "+e)},d.v.prototype.renderTemplate=function(e,t,r,n){return e=this.makeTemplateSource(e,n),this.renderTemplateSource(e,t,r)},d.v.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(e,t).data("isRewritten")},d.v.prototype.rewriteTemplate=function(e,t,r){e=this.makeTemplateSource(e,r),t=t(e.text()),e.text(t),e.data("isRewritten",!0)},d.b("templateEngine",d.v),d.Fa=function(){function e(e,t,r,n){e=d.g.ea(e);for(var i=d.g.V,o=0;o<e.length;o++){var a=e[o].key;if(i.hasOwnProperty(a)){var s=i[a];if("function"==typeof s){if(a=s(e[o].value))throw Error(a)}else if(!s)throw Error("This template engine does not support the '"+a+"' binding within its templates")}}return r="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+d.g.fa(e)+" } })()},'"+r.toLowerCase()+"')",n.createJavaScriptEvaluatorBlock(r)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,r=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Bb:function(e,t,r){t.isTemplateRewritten(e,r)||t.rewriteTemplate(e,function(e){return d.Fa.Nb(e,t)},r)},Nb:function(n,i){return n.replace(t,function(t,r,n,o,a){return e(a,r,n,i)}).replace(r,function(t,r){return e(r,"<!-- ko -->","#comment",i)})},rb:function(e,t){return d.s.wa(function(r,n){var i=r.nextSibling;i&&i.nodeName.toLowerCase()===t&&d.La(i,e,n)})}}}(),d.b("__tr_ambtns",d.Fa.rb),function(){d.m={},d.m.j=function(e){this.j=e},d.m.j.prototype.text=function(){var e=d.a.u(this.j),e="script"===e?"text":"textarea"===e?"value":"innerHTML";if(0==arguments.length)return this.j[e];var t=arguments[0];"innerHTML"===e?d.a.ga(this.j,t):this.j[e]=t},d.m.j.prototype.data=function(e){return 1===arguments.length?d.a.f.get(this.j,"templateSourceData_"+e):void d.a.f.set(this.j,"templateSourceData_"+e,arguments[1])},d.m.T=function(e){this.j=e},d.m.T.prototype=new d.m.j,d.m.T.prototype.text=function(){if(0==arguments.length){var t=d.a.f.get(this.j,"__ko_anon_template__")||{};return t.Ga===e&&t.na&&(t.Ga=t.na.innerHTML),t.Ga}d.a.f.set(this.j,"__ko_anon_template__",{Ga:arguments[0]})},d.m.j.prototype.nodes=function(){return 0==arguments.length?(d.a.f.get(this.j,"__ko_anon_template__")||{}).na:void d.a.f.set(this.j,"__ko_anon_template__",{na:arguments[0]})},d.b("templateSources",d.m),d.b("templateSources.domElement",d.m.j),d.b("templateSources.anonymousTemplate",d.m.T)}(),function(){function t(e,t,r){var n;for(t=d.e.nextSibling(t);e&&(n=e)!==t;)e=d.e.nextSibling(n),1!==n.nodeType&&8!==n.nodeType||r(n)}function r(e,r){if(e.length){var n=e[0],i=e[e.length-1];t(n,i,function(e){d.Ja(r,e)}),t(n,i,function(e){d.s.ob(e,[r])})}}function n(e){return e.nodeType?e:0<e.length?e[0]:null}function i(e,t,i,a,s){s=s||{};var c=e&&n(e),c=c&&c.ownerDocument,l=s.templateEngine||o;if(d.Fa.Bb(i,l,c),i=l.renderTemplate(i,a,s,c),"number"!=typeof i.length||0<i.length&&"number"!=typeof i[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(c=!1,t){case"replaceChildren":d.e.S(e,i),c=!0;break;case"replaceNode":d.a.fb(e,i),c=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t)}return c&&(r(i,a),s.afterRender&&d.o.P(s.afterRender,null,[i,a.$data])),i}var o;d.Ca=function(t){if(t!=e&&!(t instanceof d.v))throw Error("templateEngine must inherit from ko.templateEngine");o=t},d.Aa=function(t,r,a,s,c){if(a=a||{},(a.templateEngine||o)==e)throw Error("Set a template engine before calling renderTemplate");if(c=c||"replaceChildren",s){var l=n(s);return d.h(function(){var e=r&&r instanceof d.C?r:new d.C(d.a.c(r)),o="function"==typeof t?t(e.$data,e):t,e=i(s,c,o,e,a);"replaceNode"==c&&(s=e,l=n(s))},null,{Ra:function(){return!l||!d.a.ba(l)},aa:l&&"replaceNode"==c?l.parentNode:l})}return d.s.wa(function(e){d.Aa(t,r,a,e,"replaceNode")})},d.Tb=function(t,n,o,a,s){function c(e,t){r(t,u),o.afterRender&&o.afterRender(t,e)}function l(e,r){u=s.createChildContext(d.a.c(e),o.as),u.$index=r;var n="function"==typeof t?t(e,u):t;return i(null,"ignoreTargetNode",n,u,o)}var u;return d.h(function(){var t=d.a.c(n)||[];"undefined"==typeof t.length&&(t=[t]),t=d.a.Z(t,function(t){return o.includeDestroyed||t===e||null===t||!d.a.c(t._destroy)}),d.o.P(d.a.Ba,null,[a,t,l,o,c])},null,{aa:a})},d.d.template={init:function(e,t){var r=d.a.c(t());return"string"==typeof r||r.name||1!=e.nodeType&&8!=e.nodeType||(r=1==e.nodeType?e.childNodes:d.e.childNodes(e),r=d.a.Ob(r),new d.m.T(e).nodes(r)),{controlsDescendantBindings:!0}},update:function(t,r,n,i,o){r=d.a.c(r()),n={},i=!0;var a,s=null;"string"!=typeof r&&(n=r,r=d.a.c(n.name),"if"in n&&(i=d.a.c(n["if"])),i&&"ifnot"in n&&(i=!d.a.c(n.ifnot)),a=d.a.c(n.data)),"foreach"in n?s=d.Tb(r||t,i&&n.foreach||[],n,t,o):i?(o="data"in n?o.createChildContext(a,n.as):o,s=d.Aa(r||t,o,n,t)):d.e.ca(t),o=s,(a=d.a.f.get(t,"__ko__templateComputedDomDataKey__"))&&"function"==typeof a.D&&a.D(),d.a.f.set(t,"__ko__templateComputedDomDataKey__",o&&o.ua()?o:e)}},d.g.V.template=function(e){return e=d.g.ea(e),1==e.length&&e[0].unknown||d.g.Lb(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},d.e.N.template=!0}(),d.b("setTemplateEngine",d.Ca),d.b("renderTemplate",d.Aa),d.a.Qa=function(){function e(e,t,r,n,i){var o,a,s,c,d,l=Math.min,u=Math.max,h=[],p=e.length,m=t.length,f=m-p||1,g=p+m+1;for(o=0;p>=o;o++)for(c=s,h.push(s=[]),d=l(m,o+f),a=u(0,o-1);d>=a;a++)s[a]=a?o?e[o-1]===t[a-1]?c[a-1]:l(c[a]||g,s[a-1]||g)+1:a+1:o+1;for(l=[],u=[],f=[],o=p,a=m;o||a;)m=h[o][a]-1,a&&m===h[o][a-1]?u.push(l[l.length]={status:r,value:t[--a],index:a}):o&&m===h[o-1][a]?f.push(l[l.length]={status:n,value:e[--o],index:o}):(l.push({status:"retained",value:t[--a]}),--o);if(u.length&&f.length){e=10*p;var v;for(t=r=0;(i||e>t)&&(v=u[r]);r++){for(n=0;h=f[n];n++)if(v.value===h.value){v.moved=h.index,h.moved=v.index,f.splice(n,1),t=n=0;break}t+=n}}return l.reverse()}return function(t,r,n){return t=t||[],r=r||[],t.length<=r.length?e(t,r,"added","deleted",n):e(r,t,"deleted","added",n)}}(),d.b("utils.compareArrays",d.a.Qa),function(){function t(e){for(;e.length&&!d.a.ba(e[0]);)e.splice(0,1);if(1<e.length){for(var t=e[0],r=e[e.length-1],n=[t];t!==r;){if(t=t.nextSibling,!t)return;n.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(n))}return e}function r(r,n,i,o,a){var s=[];return r=d.h(function(){var e=n(i,a,t(s))||[];0<s.length&&(d.a.fb(s,e),o&&d.o.P(o,null,[i,e,a])),s.splice(0,s.length),d.a.U(s,e)},null,{aa:r,Ra:function(){return!d.a.qb(s)}}),{R:s,h:r.ua()?r:e}}d.a.Ba=function(n,i,o,a,s){function c(e,r){S=h[r],v!==r&&(E[e]=S),S.sa(v++),t(S.R),f.push(S),b.push(S)}function l(e,t){if(e)for(var r=0,n=t.length;n>r;r++)t[r]&&d.a.r(t[r].R,function(n){e(n,r,t[r].Y)})}i=i||[],a=a||{};var u=d.a.f.get(n,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===e,h=d.a.f.get(n,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],p=d.a.$(h,function(e){return e.Y}),m=d.a.Qa(p,i,a.dontLimitMoves),f=[],g=0,v=0,y=[],b=[];i=[];for(var S,T,w,E=[],p=[],M=0;T=m[M];M++)switch(w=T.moved,T.status){case"deleted":w===e&&(S=h[g],S.h&&S.h.D(),y.push.apply(y,t(S.R)),a.beforeRemove&&(i[M]=S,b.push(S))),g++;break;case"retained":c(M,g++);break;case"added":w!==e?c(M,w):(S={Y:T.value,sa:d.l(v++)},f.push(S),b.push(S),u||(p[M]=S))}l(a.beforeMove,E),d.a.r(y,a.beforeRemove?d.J:d.removeNode);for(var x,M=0,u=d.e.firstChild(n);S=b[M];M++){for(S.R||d.a.extend(S,r(n,o,S.Y,s,S.sa)),g=0;m=S.R[g];u=m.nextSibling,x=m,g++)m!==u&&d.e.Wa(n,m,x);!S.Hb&&s&&(s(S.Y,S.R,S.sa),S.Hb=!0)}l(a.beforeRemove,i),l(a.afterMove,E),l(a.afterAdd,p),d.a.f.set(n,"setDomNodeChildrenFromArrayMapping_lastMappingResult",f)}}(),d.b("utils.setDomNodeChildrenFromArrayMapping",d.a.Ba),d.G=function(){this.allowTemplateRewriting=!1},d.G.prototype=new d.v,d.G.prototype.renderTemplateSource=function(e){var t=(9>d.a.da?0:e.nodes)?e.nodes():null;return t?d.a.Q(t.cloneNode(!0).childNodes):(e=e.text(),d.a.ya(e))},d.G.ta=new d.G,d.Ca(d.G.ta),d.b("nativeTemplateEngine",d.G),function(){d.va=function(){var e=this.Kb=function(){if("undefined"==typeof i||!i.tmpl)return 0;try{if(0<=i.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,n,o){if(o=o||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var a=t.data("precompiled");return a||(a=t.text()||"",a=i.template(null,"{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}"),t.data("precompiled",a)),t=[n.$data],n=i.extend({koBindingContext:n},o.templateOptions),n=i.tmpl(a,t,n),n.appendTo(r.createElement("div")),i.fragments={},n},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){r.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},e>0&&(i.tmpl.tag.ko_code={open:"__.push($1 || '');"},i.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},d.va.prototype=new d.v;var e=new d.va;0<e.Kb&&d.Ca(e),d.b("jqueryTmplTemplateEngine",d.va)}()})}()}(),define("util",[],function(){function e(e,t){e===URLPart.Search?window.location.search=t:e===URLPart.Hash&&(window.location.hash=t)}function t(e){return e===URLPart.Search?window.location.search:e===URLPart.Hash?window.location.hash:void 0}function r(e){return o[e]}function n(){}var i={};window.URLPart={Search:1,Hash:2};var o={demo:URLPart.Hash,login:URLPart.Hash,access_token:URLPart.Hash,error:URLPart.Hash,expires_in:URLPart.Hash,scope:URLPart.Hash,token_type:URLPart.Hash,data:URLPart.Hash,script:URLPart.Hash,dmode:URLPart.Hash,jasmine:URLPart.Hash,touch:URLPart.Hash,file:URLPart.Hash,panes:URLPart.Hash,offline:URLPart.Hash,live:URLPart.Hash,test:URLPart.Hash,nolocal:URLPart.Hash,nosync:URLPart.Hash,rdebug:URLPart.Hash,rsession:URLPart.Hash,cacheError:URLPart.Hash,state:URLPart.Search};i.hasURLParam=function(e,n){var i=e+"=";n&&(i+=n);var o=r(e);o||log("Invalid URL Part");var a=t(o);return a.indexOf(i)>=0},i.getURLParam=function(e,t){var n=t?t:r(e);if(n===URLPart.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+e+"=([^&#]*)",o=new RegExp(i),a=o.exec(window.location.href);return null===a?void 0:decodeURIComponent(a[1].replace(/\+/g," "))}if(n===URLPart.Hash){for(var s,c=window.location.hash.substring(1),o=/([^&=]+)=([^&]*)/g;s=o.exec(c);)if(decodeURIComponent(s[1])===e)return decodeURIComponent(s[2]);return void 0}log("Invalid URL part")},i.insertURLParam=function(n,i,o){n=encodeURIComponent(n),i=encodeURIComponent(i);for(var a=r(n),s=t(a),c=s.substr(1).split("&"),d=c.length-1;d>=0;d--){var l=c[d].split("=");if(l[0]==n){l[1]=i,c[d]=l.join("=");break}}0>d&&(c[c.length]=[n,i].join("=")),e(a,c.join("&")),a!==URLPart.Hash||o||window.location.reload()},i.removeURLParam=function(n,i){n=encodeURIComponent(n);for(var o=r(n),a=t(o),s=a.substr(1).split("&"),c=s.length-1;c>=0;c--){var d=s[c].split("=");if(d[0]==n){s.splice(c,1);break}}e(o,s.join("&")),o!==URLPart.Hash||i||window.location.reload()};var a="chrome-extension:"===window.location.protocol;return i.__storage=a?chrome.storage.local:window.localStorage,i.storage={getItem:(i.__storage.getItem||function(e,t){return this.get(e,t||n)}).bind(i.__storage),setItem:(i.__storage.setItem||function(e,t){var r={};r[e]=t,i.__storage.set(r)}).bind(i.__storage),removeItem:(i.__storage.removeItem||function(e,t){this.remove(e,t)}).bind(i.__storage)},i}),define("platform",["ko","util"],function(e,t){function r(){this.versionRequired=4,this.requireCustomRedirect=!1,this.b=document.documentElement||document.body,this.orientation=Orientation.Portrait,this.windowWidth=e.observable(0),this.windowHeight=e.observable(0),this.kbsize=void 0,this.kbsizePortrait=void 0,this.kbsizeLandscape=void 0,this.hasBeenPortrait=!1,this.iframeApp=void 0,this.appState=void 0,this.isDevURL="dev.moo.do"===window.location.hostname,this.init();var t=!1||this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone;this.customRedirectString=window.location.protocol+"//"+(t?window.location.host:"www.moo.do"),this.app&&(this.customRedirectState={app:!0,appv:this.versionRequired}),this.keyboardOpenTime=this.app||this.android?200:this.winphone?200:this.mobileie?600:0}return window.Orientation={Portrait:0,Landscape:1},r.prototype={getPlatformInfo:function(e){e.os=this.OSName,e.browser=this.browser,e.appVersionRequired=this.versionRequired,e.app=this.app,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.requireCustomRedirect=this.requireCustomRedirect,e.isMobile=this.mobile,e.isPhone=this.phone,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.kbsize=this.kbsize,e.appState=this.appState,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent},init:function(){this.initAppState();var e=navigator.userAgent,n="";if(this.app&&(n+=" app"),-1!==e.indexOf("Win")?(this.OSName="Windows",this.windows=!0,-1!==e.indexOf("Windows Phone")&&(this.phone=!0,this.touch=!0,this.mobile=!0)):-1!==e.indexOf("iPad")?(this.OSName="iPad",this.ios=!0,this.ipad=!0,this.phone=!0,this.touch=!0,this.mobile=!0):-1!==e.indexOf("iPhone")?(this.OSName="iPhone",this.ios=!0,this.iphone=!0,this.phone=!0,this.mobile=!0,this.touch=!0):-1!==e.indexOf("iPod")?(this.OSName="iPod",this.ios=!0,this.ipod=!0,this.phone=!0,this.mobile=!0,this.touch=!0):-1!==e.indexOf("Mac")?(this.OSName="MacOS",this.mac=!0):-1!==e.indexOf("X11")?(this.OSName="UNIX",this.unix=!0):-1!==e.indexOf("Android")?(this.OSName="Android",this.android=!0,this.touch=!0,this.mobile=!0,this.phone=!0,n+=" android"):-1!==e.indexOf("Linux")&&(this.OSName="Linux",this.linux=!0),this.ios&&(this.ios7=-1!==e.indexOf("OS 7"),this.ios70=-1!==e.indexOf("OS 7_0"),this.ios71=-1!==e.indexOf("OS 7_1"),this.ios7&&(n+=" ios7")),this.majorVersion=1e3,this.minorVersion=1e3,-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident")){this.browser="Trident",this.ie=!0,this.winphone=!!e.match(/IEMobile/i);var i;i=new RegExp(this.winphone||"Microsoft Internet Explorer"===navigator.appName?"MSIE ([0-9]{1,}[.0-9]{0,})":"Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==e.indexOf("Chrome")||-1!==e.indexOf("CriOS")){this.browser="Chrome",this.isChrome=!0;var i=new RegExp("Chrome/([0-9]{1,}).");null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==e.indexOf("Android")){this.browser="Native Android";var i=new RegExp("Linux; Android ([0-9]{1,}).([0-9]{1,}).");null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else if(-1!==e.indexOf("Firefox")){this.browser="Firefox";var i=new RegExp("Firefox/([0-9]{1,}).");null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==e.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName){this.browser="Safari";var i;i=new RegExp(this.mobile?"OS ([0-9]{1,})_([0-9]{1,})":"Version/([0-9]{1,}).([0-9]{1,})."),null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else-1!==e.indexOf("Opera")&&(this.browser="Opera");this.isTouchDevice=!!("ontouchstart"in window||window.navigator.msMaxTouchPoints),this.usePointerEvents=!!window.navigator.msPointerEnabled,log("Touch Device: "+this.isTouchDevice+" Pointer Events: "+this.usePointerEvents),log("Browser: "+this.browser+"  Major Version: "+this.majorVersion+"  Minor Version: "+this.minorVersion),this.isTouchDevice&&(this.usePointerEvents?(this.touchStartEvent="MSPointerDown",this.touchMoveEvent="MSPointerMove",this.touchEndEvent="MSPointerUp",this.touchCancelEvent="MSPointerCancel"):(this.touchStartEvent="touchstart",this.touchMoveEvent="touchmove",this.touchEndEvent="touchend",this.touchCancelEvent="touchcancel")),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup");try{var o=!!t.storage.getItem("forceFullUI")}catch(a){}t.hasURLParam("touch","false")||o?(this.touch=!1,this.phone=!1,this.mobile=!1,this.ios=!1,this.android=!1):(this.isTouchDevice||t.hasURLParam("touch","true"))&&(this.touch=!0,this.phone=!0,this.mobile=!0),this.windows&&(n+=" windows",this.ie?(n+=" ie",this.demo||(this.mobro=this.isMobro())):"Firefox"===this.browser&&(n+=" firefox")),this.phone&&(n+=" phone",n+=" nonbodyscroll",this.bodyscroll=!1),this.ipad&&(n+=" ipad"),this.mobileie=this.ie&&this.mobile,this.mobile&&!this.app&&this.calcKeyboardSize(),this.cmdChar=this.windows?"ctrl":"⌘",this.noErrorStacks="iPad"===r.OSName||"iPhone"===r.OSName||"iPod"===r.OSName,this.packagedApp="chrome-extension:"===window.location.protocol,this.standalone=!!window.navigator.standalone||this.packagedApp||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app||this.mobro)&&(this.requireCustomRedirect=!0),n&&n.length>0&&(this.b.className+=n),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0)},isMobro:function(){var e=null;try{new ActiveXObject("")}catch(t){errorName=t.name}try{e=!!new ActiveXObject("htmlfile")}catch(t){e=!1}return e="ReferenceError"!=errorName&&0==e?!1:!0,!e},calcKeyboardSize:function(){this.ios?this.iphone||this.ipod?(this.kbsizePortrait=216,this.kbsizeLandscape=162,this.ios71&&(this.kbsizePortrait+=44,this.kbsizeLandscape+=44)):this.ipad&&(this.kbsizePortrait=264,this.kbsizeLandscape=352,this.kbsizePortrait+=44,this.kbsizeLandscape+=44):this.android||this.winphone?(this.kbsizePortrait=0,this.kbsizeLandscape=0):this.mobileie&&(this.kbsizePortrait=369,this.kbsizeLandscape=492)},normalizeKeys:function(e){void 0===e.normCode&&(e.normCode=null===e.keyCode||0===e.keyCode?null!=e.charCode?e.charCode:e.which:e.keyCode)},initAppState:function(){var e=location.hash.substring(1);if(e)for(var r,n=/([^&=]+)=([^&]*)/g;r=n.exec(e);)if("state"===decodeURIComponent(r[1])){var i=decodeURIComponent(r[2]);if(i){try{e=JSON.parse(i)}catch(o){log("Error parsing AppState: ",i),e=void 0}e&&(this.app=e.app===!0,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.syncContacts=e.syncContacts,this.test=e.test,this.appState=e)}break}this.live=this.live||t.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||this.test||t.hasURLParam("offline","true")||!1,this.demo=t.hasURLParam("demo","true")||!1,this.script=t.hasURLParam("script")},addPrefix:function(e){var t="",r=["ms","webkit","moz","o"],n=this.b.style;if("string"==typeof n[e])t="";else for(var i=0;i<r.length;i++)if("string"==typeof n["-"+r[i]+"-"+e]){t=r[i];break}var o=t.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;return t?{prop:"-"+t+"-"+e,style:t+o}:{prop:e,style:o}},blockClient:function(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(2===this.majorVersion&&this.minorVersion<1||this.majorVersion<2)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(!this.isDevURL){if(this.phone&&!this.demo)return{platform:"Windows Phone",browser:this.browser,update:!1};if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0}}break;case"Safari":if(this.mobile&&this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};if(!this.mobile&&(6==this.majorVersion&&this.minorVersion<1||this.majorVersion<6))return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired)return log("App Version out of date."),{version:this.versionRequired};if(this.appv>this.versionRequired)return log("App is newer than the javascript, forcing an app cache update"),{cacheUpdate:!0,error:!1}}if("1403087090032"!==document.body.getAttribute("ver")){var e=t.hasURLParam("cacheError");if(require(["globals"],function(t){t.reportError(new Error("VersionMismatch, CacheError: "+e))}),!e)return this.sendToApp("resetCache"),{cacheUpdate:!0,error:!0}}},actionVerb:function(){return this.touch?"tap":"click"},actionVerbCaps:function(){return this.touch?"Tap":"Click"},updateOrientation:function(){var e=90==Math.abs(window.orientation)?Orientation.Landscape:Orientation.Portrait;return this.orientation==Orientation.Portrait&&(this.hasBeenPortrait=!0),this.orientation=e,this.app||(this.kbsize=this.orientation==Orientation.Portrait?this.kbsizePortrait:this.kbsizeLandscape),this.orientation},sendToApp:function(e,t){if(this.app)if(this.ios){this.iframeApp||(this.iframeApp=document.createElement("IFRAME"),this.iframeApp.setAttribute("height","1px"),this.iframeApp.setAttribute("width","1px"),document.documentElement.appendChild(this.iframeApp));var r="duchess://"+e;void 0!==t&&(r+="//"+t),this.iframeApp.setAttribute("src",r)}else this.android&&void 0!==AppInterface&&AppInterface.addNotification(t)}},new r}),this.document&&(window.dateWrapper=dateWrapper),this.dateLibLoaded||dateWrapper(),define("date",function(){}),define("globals",["ko","platform","util","date"],function(e,t,r){function n(e,t){var r,n,i,o,a,s,c,d;for(r=3&e.length,n=e.length-r,i=t,a=3432918353,s=461845907,d=0;n>d;)c=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24,++d,c=(65535&c)*a+(((c>>>16)*a&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,i^=c,i=i<<13|i>>>19,o=5*(65535&i)+((5*(i>>>16)&65535)<<16)&4294967295,i=(65535&o)+27492+(((o>>>16)+58964&65535)<<16);switch(c=0,r){case 3:c^=(255&e.charCodeAt(d+2))<<16;case 2:c^=(255&e.charCodeAt(d+1))<<8;case 1:c^=255&e.charCodeAt(d),c=(65535&c)*a+(((c>>>16)*a&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,i^=c}return i^=e.length,i^=i>>>16,i=2246822507*(65535&i)+((2246822507*(i>>>16)&65535)<<16)&4294967295,i^=i>>>13,i=3266489909*(65535&i)+((3266489909*(i>>>16)&65535)<<16)&4294967295,i^=i>>>16,i>>>0}function i(e){try{for(var t=JSON.parse(JSON.stringify(e)),r=0;r<t.length;++r)""!==t[r].search&&(t[r].search="HasSearch");return JSON.stringify(t)}catch(n){return"Failed to sanitize pane state"}}function o(e){try{var t=JSON.parse(e);return delete t.paneState,delete t.gdocTitle,JSON.stringify(t)}catch(r){return"Failed to parse settings"}}function a(){var e=T.settings.get("activeUser");return e?"MooDoRDebug"+(new Date).getTime()+"_"+e:"Unknown"}function s(e){try{T.PAssert(791,e,"Must specify a callback")}catch(t){w.reportError(t)}return function(){try{if(e)return e.apply(void 0,arguments)}catch(t){throw T.reportError(t,arguments),t}}}function c(e,t){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onReadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())}}function d(e){for(var t="",r=0;r<e.length;++r)t+=" "+T.safeStringify(e[r]);return t}function l(e){function t(e){if(e)if(e.nodeType===Node.TEXT_NODE)r.push(e);else for(var n=0;n<e.childNodes.length;++n){var i=e.childNodes[n];t(i)}}var r=[];return t(e),r}function u(e,t){for(var r=0,n=l(e),i=0;i<n.length;++i){var o=n[i].length;if(r+o>=t)return{element:n[i],offset:t-r};r+=o}try{T.PAssert(801,!1,"Unable to find offset child element")}catch(a){w.reportError(a)}return void 0}function h(e){for(var t=l(e),r=0,n=0;n<t.length;++n)r+=t[n].length;return r}function p(e){return T.hasClass(e,"text")||"androidInput"===e.id&&E.isEnabled()}function m(){var e=2,t=12,r=$.pane.getScroller(),n=e+t*$.speed;r.scrollTop+=n,Q&&requestAnimationFrame(m)}function f(e,t){for(var r=0;r<t.length;++r)e.comparator?e.comparator(t[r])&&e.action(t[r]):e.each&&e.each(t[r]),e.item=t[r],T.searchVMLIs(e)}function g(e,t){try{T.PAssert(838,"string"!=typeof e,"Should only pass objects to the obj mapping function",e)}catch(r){w.reportError(r)}var n={};for(var i in e){try{T.PAssert(839,e.hasOwnProperty(i),"This should always be the case, the prototype shouldn't be extended")}catch(r){w.reportError(r)}if(void 0!==e[i]&&null!==e[i]){var o=t[i];if(o)n[o]=e[i];else{try{T.PAssert(840,!1,"Incoming field should be added to the field map",i)}catch(r){w.reportError(r)}n[i]=e[i]}}}return n}function v(e,t,r){try{T.PAssert(847,void 0!==r,"Must pass in valid key data to type")}catch(n){w.reportError(n)}if(!e){var i=T.getSelectionInfo();i&&(e=i.node)}if(document.createEvent&&e){var o=document.createEvent("Event");o.normCode=r.normCode,o.shiftKey=!!r.shiftKey,o.synthetic=!0,o.initEvent(t,!0,!0),e.dispatchEvent(o)}else try{T.PAssert(848,!1,"Unable to fire key event")}catch(n){w.reportError(n)}}function y(e,t,r){try{T.PAssert(849,void 0!==r,"Must pass in a valid button to click with")}catch(n){w.reportError(n)}if(!e){var i=T.getSelectionInfo();i&&(e=i.node)}if(document.createEvent){var o=document.createEvent("Event");o.button=r,o.synthetic=!0,o.initEvent(t,!0,!0),e.dispatchEvent(o)}else try{T.PAssert(850,!1,"Unable to fire click event")}catch(n){w.reportError(n)}}function b(){document.removeEventListener("DOMContentLoaded",b,!1),window.removeEventListener("load",b,!1);for(var e=0;e<tt.length;++e)tt[e]();tt=void 0}function S(e){var t="";if("object"==typeof e){var r=[];for(key in e)r[r.length]=encodeURIComponent(key)+"="+encodeURIComponent(e[key]);t=r.join("&").replace(/%20/g,"+")}else{try{T.PAssert(879,"string"==typeof e,"Only Objects or Strings are currently supported")}catch(n){w.reportError(n)}t=e}return t}var T={vmMain:void 0,vmDebug:void 0,topBarHeight:40,phoneMainY:40,topBoxHeight:t.phone?50:150,keyboardToolbarHeight:40,hasFocus:!0,zoomTime:0,demoMode:!1,intro:void 0,focusedPaneID:void 0,focusedPane:void 0,focusedItem:void 0,isScrolling:!1,ClickThreshold:5,noLocalWrites:!1,isLoadingRemote:!1,revealingMenu:!1,isKeyboardOpen:!1,dragging:void 0,draggingHidden:void 0,dragStartInfo:{x:0,y:0},dragStartTimeout:void 0,startDrag:void 0,itemMenuOpenedOn:void 0,tempUL:document.getElementById("tempUL"),elements:{}},w=T,E={isEnabled:function(){return!!t.android}};require(["android"],function(e){E=e
});var M;require(["VMLI"],function(e){M=e}),window.KeyCode={BackSpace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,Hash:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D8:56,LAngle:60,RAngle:62,At:64,A:65,B:66,E:69,F:70,G:71,I:73,N:78,O:79,S:83,U:85,V:86,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,F4:115,Equals:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222},window.TextSpace="﻿",T.PhoneWidth=480,window.DriveStatus={Offline:0,Connecting:1,Saving:2,Saved:3,Reconnecting:4},window.PaneMode={Normal:1,Timeline:2},window.MessageAction={Default:0,Reload:1,Login:2,Demo:3,ResetClient:4,None:5},window.MessageType={Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7,MobileOffline:8},window.MessageID={Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,MobileOffline:10,ApplicationError:11,DriveError:12},window.VMLIFlag={None:0,Header:1,Collapsed:2,Selected:4,Highlighted:8,NumList:16,Complete:4096,P2:8192,P1:16384,P0:32768,Flagged:65536},window.VersionType={Structure:1,Text:2},window.SaveFlag={None:0,Prop:1,Text:2,All:3},window.PropChangeType={None:0,Date:2,Complete:4,Archive:8,Flagged:16,Priority:32,All:63},window.LoginState={NONE:0,LOGGED_OUT:1,LOGGED_IN:2},T.isFlagSet=function(e,t){return(e&t)===t},T.isAtLeastOneFlagSet=function(e,t){return 0!==(e&t)},T.PCFMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete|VMLIFlag.Flagged,T.PCMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete,T.PFMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Flagged,T.PMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2,T.fieldMapIn={id:"id",items:"i",archivedItems:"ai",text:"t",modifiedOffline:"l",modifiedOfflineText:"o",versionText:"u",version:"v",formats:"f",isArchived:"a",isDeleted:"x",isCollapsed:"m",date:"d",dateText:"s",allDayDate:"ad",dateCreated:"c",dateCompleted:"^",priority:"p",isComplete:"z",isFlagged:"*"},T.priorityMapOut={},T.priorityMapOut[VMLIFlag.None]=" ",T.priorityMapOut[VMLIFlag.P0]=" p0",T.priorityMapOut[VMLIFlag.P1]=" p1",T.priorityMapOut[VMLIFlag.P2]=" p2",window.NumListPrefix="#.",window.NumListPrefixOther="1.",window.DatePrefix="@",window.ContactPrefix="+",window.cmdChar=t.windows?"ctrl":"⌘",T.getTransitionClass=function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t},T.setTransformStyle=function(e,r,n){try{T.PAssert(750,e,"Must provide a valid element")}catch(i){w.reportError(i)}if(e){try{T.PAssert(751,void 0!==r,"Must supply a valid X offset")}catch(i){w.reportError(i)}try{T.PAssert(752,void 0!==n,"Must supply a valid Y offset")}catch(i){w.reportError(i)}e.style[t.transform.style]=t.ie?"translate("+r+"px, "+n+"px)":"translate3d("+r+"px, "+n+"px, 0px)"}},T.setTransitionStyle=function(e,r,n,i){try{T.PAssert(753,e,"Must provide a valid element")}catch(o){w.reportError(o)}e&&(i=i||"ease",e.style[t.transition.style]=r+" "+n+"ms "+i,setTimeout(function(){e.style[t.transition.style]=""},n))};var x=t.ie;T.setTransform=function(e,r,n,i,o){i>0?x?setTransformStyle(e,r,n):(T.setTransitionStyle(e,t.transform.prop,i,o),T.setTransformStyle(e,r,n)):r||n?T.setTransformStyle(e,r,n):e.style[t.transform.style]="none"},T.reload=function(){try{T.PAssert(754,!I,"Page should not be reloaded while waiting for an appcache update to finish.")}catch(e){w.reportError(e)}I&&T.reportError(new Error("Page requesting reload while waiting for AppCache update.")),window.location.reload()},T.isSetupPageOpen=!1,T.isMainPageOpen=!1,T.openMainPage=function(){T.isSetupPageOpen&&(T.isSetupPageOpen=!1),T.isMainPageOpen||(T.isMainPageOpen=!0);var e=document.getElementById("outerWrapper"),t=document.getElementById("setupWrapper");e&&t&&(T.removeClass(e,"none"),T.addClass(t,"none"))},T.openSetupPage=function(){T.isMainPageOpen&&(T.isMainPageOpen=!1),T.addClass(document.getElementById("outerWrapper"),"none"),T.removeClass(document.getElementById("setupWrapper"),"none")};var C=!1,I=!1;T.setAppCacheUpdateState=function(e){I=e,e&&(C=!0)},T.isEmpty=function(e){for(var t in e)return!1;return!0},T.isEmail=function(e){var t=new RegExp(/.+@.+\..+/i),r=t.exec(e);return!!r},T.removeDOM=function(e){var t=document.getElementById(e);try{T.PAssert(755,t,"DOM Element must exist to remove it")}catch(r){w.reportError(r)}t&&t.parentNode.removeChild(t)},T.isRunningScript=function(){return T.AScript&&T.AScript.isRunning};var A=!1;T.goOnline=function(){T.noLocalWrites&&!T.isDemoMode()&&(T.messageQueue.clearMessage(MessageID.OfflineWarn),T.messageQueue.pushMessage(MessageID.OnlineInfo)),A=!1},T.goOffline=function(){T.noLocalWrites&&!T.isDemoMode()&&(T.messageQueue.clearMessage(MessageID.OnlineInfo),T.messageQueue.pushMessage(MessageID.OfflineWarn)),A=!0},T.isOffline=function(){return A},T.preventLocalWrites=function(){ShouldLog(LogLevels.Warning)&&log("---- WARNING: Local Writes Disabled ----"),A&&!T.isDemoMode()&&(T.messageQueue.clearMessage(MessageID.OnlineInfo),T.messageQueue.pushMessage(MessageID.OfflineWarn)),T.noLocalWrites=!0},T.shouldWriteLocal=function(){return!T.noLocalWrites},T.enableDemoMode=function(){T.demoMode=!0,t.mobile||t.script||T.messageQueue.pushMessage({text:"You are in demo mode, your information is not being saved. Click here to leave.",type:MessageType.Info,action:MessageAction.Login}),T.preventLocalWrites()},T.isDemoMode=function(){return T.demoMode},window.DisplayMode={Default:0,NoTopBar:1,NoPaneHeaders:2,ForceTwoPane:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowBanner:1024,FullMin:2047},T.activeDisplayMode=DisplayMode.Default,T.isDisplayModeActive=function(e){return(T.activeDisplayMode&e)===e},T.enableMinMode=function(e){try{if(e=parseInt(e),("Trident"===t.browser||t.android===!0)&&(e|=DisplayMode.NoScrollbars,e|=DisplayMode.NoInteraction),!t.touch){if(e&DisplayMode.NoTopBar){var r=document.getElementById("desktopMenu");r&&T.addClass(r,"none");var n=document.getElementById("container");n&&(n.style.top="0px");for(var i=document.getElementsByClassName("pane"),o=0;o<i.length;++o)i[o]&&(i[o].style.marginTop="0px",i[o].style.height="100%")}e&DisplayMode.NoPaneHeaders&&T.addClass(document.body,"noPaneHeaders"),e&DisplayMode.NoPaneTop&&T.addClass(document.body,"noPaneTopBox"),e&DisplayMode.NoPaneStyle&&T.addClass(document.body,"noPaneStyle")}if(e&DisplayMode.NoPaneTop&&T.addClass(document.body,"noPanePadding"),e&DisplayMode.NoScrollbars&&T.addClass(document.body,"noScrollbars"),e&DisplayMode.NoBackground){var a=document.getElementsByTagName("html")[0];try{T.PAssert(756,a,"Must have a valid HTML element")}catch(s){w.reportError(s)}a&&T.addClass(a,"noBackground")}if(e&DisplayMode.NoInteraction){var c=document.getElementById("preventInteraction");c&&(T.removeClass(c,"none"),c.addEventListener("mousewheel",function(e){return e.stopImmediatePropagation(),!1},!0),c.addEventListener("mousedown",function(e){return e.preventDefault(),e.stopImmediatePropagation(),!1},!0),c.addEventListener("keydown",function(e){return e.preventDefault(),e.stopImmediatePropagation(),!1},!0))}e&DisplayMode.ShowBanner&&!(e&DisplayMode.NoInteraction)?T.removeClass(document.getElementById("cornerBannerMessage"),"none"):T.removeDOM("cornerBannerMessage"),T.activeDisplayMode=parseInt(e)}catch(d){T.reportError(d)}},T.sendEvent=function(e,t,r){try{T.PAssert(757,!T.isString(r),"Values must be numeric")}catch(n){w.reportError(n)}window.ga&&!T.isDemoMode()&&ga("send","event",e,t,T.getAnonUserIdentifier(),r)},T.sendTimeEvent=function(e,t,r){try{T.PAssert(758,!T.isString(r),"Values must be numeric")}catch(n){w.reportError(n)}window.ga&&!T.isDemoMode()&&ga("send","timing",e,t,r,T.getAnonUserIdentifier())};var P=void 0;T.startTimeEvent=function(e,t){if(log&&log.now){try{T.PAssert(759,void 0===P,"This function needs to be updated to allow nested timing events")}catch(r){w.reportError(r)}P={startTime:log.now(),category:e,variable:t}}},T.endTimeEvent=function(){if(log&&log.now){try{T.PAssert(760,void 0!==P,"Must have started a timing event")}catch(e){w.reportError(e)}var t=log.now()-P.startTime;T.sendTimeEvent(P.category,P.variable,t),P=void 0}};var D={};T.registerEvent=function(e,t,r){try{T.PAssert(761,!D.hasOwnProperty(e),"Should only register an event once")}catch(n){w.reportError(n)}try{T.PAssert(762,void 0!==e,"Must specify a name for the event")}catch(n){w.reportError(n)}try{T.PAssert(763,void 0!==t,"Must specify a category for the event")}catch(n){w.reportError(n)}try{T.PAssert(764,void 0!==r,"Must specify an action for the event")}catch(n){w.reportError(n)}var i={category:t,action:r,label:T.getAnonUserIdentifier(),count:0};D[e]=i},T.aggregateEvent=function(e,t){try{T.PAssert(765,D.hasOwnProperty(e),"Must register an event before using it")}catch(r){w.reportError(r)}void 0===t&&(t=1),D[e]&&(D[e].count+=t)};var k=!1;T.pageDataCleared=function(){k=!0},T.onunload=function(){log("Unloading the page");for(var e in D){var t=D[e];T.sendEvent(t.category,t.action,t.count),t.count=0}if(T.vmMain&&T.vmMain.failedGapiLoad?T.sendEvent("ScriptLoad","GapiFailed"):gapiCalled||T.sendEvent("ScriptLoad","GapiNotLoaded"),T.vmMain&&T.vmMain.updatePaneScrollState(),!k){var r=require("gdata");r&&T.settings.set(Settings.lastServerVersion,r.getServerVersion())}return T.isLoadingRemote?"We are still syncing your changes, are you sure you want to exit?":void 0},t.demo||t.packagedApp||(window.onbeforeunload=T.onunload);var O=LoginState.LOGGED_OUT;T.getLoginState=function(){var e=O;if(T.shouldWriteLocal())try{var t=r.storage.getItem("loginState");null!==t&&void 0!==t&&(e=parseInt(t))}catch(n){T.reportError(n)}try{T.PAssert(766,e===LoginState.NONE||e===LoginState.LOGGED_OUT||e===LoginState.LOGGED_IN,"Invalid login state set")}catch(i){w.reportError(i)}return e},T.setLoginState=function(e){try{T.PAssert(767,null!==e&&void 0!==e&&!isNaN(e),"Should always be a valid LoginState enum value")}catch(t){w.reportError(t)}if(O=e,T.shouldWriteLocal())try{(isNaN(e)||null===e||void 0===e)&&(e=LoginState.LOGGED_OUT);try{T.PAssert(768,e===LoginState.NONE||e===LoginState.LOGGED_OUT||e===LoginState.LOGGED_IN,"Invalid login state set")}catch(t){w.reportError(t)}r.storage.setItem("loginState",e)}catch(n){T.reportError(n)}},window.Settings={theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",disableNotifications:"disableNotifications",docSharing:"docSharing",authScopes:"authScopes",localIntegrity:"localIntegrity",paneState:"paneState",localDataVersion:"localDataVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",noSounds:"noSounds",noLocalWrites:"noLocalWrites",lastMessageSync:"lastMessageSync",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",shownInstallInfo:"shownInstall"};var L=[Settings.localIntegrity,Settings.paneState,Settings.authScopes,Settings.localDataVersion,Settings.shownTutorial,Settings.lastContactSync,Settings.disableNotifications,Settings.gdocId,Settings.gdocTitle,Settings.activeUser,Settings.noSounds,Settings.lastMessageSync,Settings.lastServerVersion,Settings.noLocalWrites,Settings.lastMessageSync];if(T.settings={settings:{},prefix:"V~",init:function(){try{r.storage.setItem("poke",0)}catch(e){T.preventLocalWrites()}this.ensureLocalCopy()},initEvents:function(e){try{T.PAssert(769,e,"Must supply a callback function")}catch(t){w.reportError(t)}T.shouldWriteLocal()&&window.addEventListener("storage",function(t){if(t||(t=window.event),e(t),"localSettings"===t.key)try{this.settings=t.newValue?JSON.parse(t.newValue):{}}catch(r){T.reportError(r),this.settings={}}}.bind(this),!1)},ensureLocalCopy:function(e){try{T.PAssert(770,void 0===e,"Invalid caller param forceSync")}catch(t){w.reportError(t)}if(T.shouldWriteLocal()&&(e||T.isEmpty(this.settings)))try{var n=r.storage.getItem("localSettings");this.settings=n?JSON.parse(n):{}}catch(i){T.reportError(i),this.settings={}}},flushLocalCopy:function(){if(T.shouldWriteLocal())try{r.storage.setItem("localSettings",JSON.stringify(this.settings))}catch(e){T.reportError(e)}},set:function(e,t,r){try{T.PAssert(771,void 0!==e&&null!==e,"Must specify a valid property name")}catch(n){w.reportError(n)}try{T.PAssert(772,!e.startsWith(this.prefix),"Use setVersion to set version properties")}catch(n){w.reportError(n)}this.ensureLocalCopy(),null===r&&(r=0);var i=this.settings[e],o=this.getVersion(e),a=!1;if(i!==t||"object"==typeof t){if(void 0===r){if(a=!0,o>=0&&L.indexOf(e)<0){var s=this.getVersion(e);this.settings[this.prefix+e]=-(s+1)}}else{try{T.PAssert(773,r>=0,"Remote version must be positive")}catch(n){w.reportError(n)}a=this.isPropertyNewer(e,r),a&&(this.settings[this.prefix+e]=r)}a&&(this.settings[e]=t,L.indexOf(e)<0&&(T.fireCustomEvent("settingsChange",{property:this.prefix+e,value:this.settings[this.prefix+e],isRemote:void 0!==r}),T.fireCustomEvent("settingsChange",{property:e,value:t,isRemote:void 0!==r}))),this.flushLocalCopy()}return a},get:function(e,t){try{T.PAssert(774,void 0!==e&&null!==e,"Must specify a valid property name")}catch(r){w.reportError(r)}return this.ensureLocalCopy(t),this.settings[e]},getVersion:function(e,t){try{T.PAssert(775,void 0!==e&&null!==e,"Must specify a valid property name")}catch(r){w.reportError(r)}return this.ensureLocalCopy(t),this.settings[this.prefix+e]||0},setVersion:function(e,t,r){try{T.PAssert(776,void 0!==e&&null!==e,"Must specify a valid property name")}catch(n){w.reportError(n)}try{T.PAssert(777,e.startsWith(this.prefix),"Setting versions requires a version property name")}catch(n){w.reportError(n)}try{T.PAssert(778,t>=0,"Versions should always be positive")}catch(n){w.reportError(n)}this.ensureLocalCopy(r),this.settings[e]=t},reset:function(e){if(e)this.ensureLocalCopy(),delete this.settings[e],this.flushLocalCopy();else if(this.settings={},T.shouldWriteLocal())try{r.storage.setItem("localSettings","{}")}catch(t){T.reportError(t)}},resetAll:function(e){var t={};if(e)for(var n=0;n<e.length;++n)t[e[n]]=this.settings[e[n]];if(this.settings=t,e)this.flushLocalCopy();else if(T.shouldWriteLocal())try{r.storage.setItem("localSettings","{}")}catch(i){T.reportError(i)}},isPropertyNewer:function(e,t){try{T.PAssert(779,void 0!==t&&null!==t&&t>=0,"Remote versions should always be positive")}catch(r){w.reportError(r)}var n=this.getVersion(e);try{T.PAssert(780,void 0!==n&&null!==n,"Self version should always be valid")}catch(r){w.reportError(r)}return Math.abs(n)<Math.abs(t)},getRawSettings:function(){var e;if(T.shouldWriteLocal())try{e=r.storage.getItem("localSettings")}catch(t){T.reportError(t)}else try{return JSON.stringify(this.settings)}catch(t){return T.reportError(t),'{m: "Invalid Settings"}'}return e}},REPORT_ACTIONS){window.ResolveAction={Error:1,SetRemoteText:2,SetLocalText:4,DupeItem:8,AddLocalItem:16,RemoveRemoteItem:32,AddBackDeletedItem:64,LocalMoveCandidate:128,MoveLocalItem:256,DeleteLocalItem:512,MoveRemoteItem:1024},window.RATAG={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,O:13,P:14,Q:15,R:16,S:17};var R=r.hasURLParam("nosync")||r.hasURLParam("demo");R||console.log("%cGenerating Sync Report - use #noSync=true to disable and __syncReport.printList() to view.","color: green");var _=[];T.reportAction=function(e,t,r){R||_.push({tag:e,type:t,info:r,tagString:T.enumToString(window.RATAG,e),typeString:T.enumToString(window.ResolveAction,t)})},T.reportActionCrash=function(e){T.reportAction(RATAG.S,ResolveAction.Error,{msg:e.message,stack:e.stack})},window.DataSnapshot={Before:0,After:1};var N=[];T.reportData=function(e,t){N[t]=JSON.stringify(e)},window.__syncReport={print:function(){return _},printList:function(){if(R)return"Sync Report Disabled";if(0===_.length)return"No Actions Perfomed in Sync";for(var e=0;e<_.length;++e){var t=_[e];log("Action: ",{type:t.typeString,tag:t.tagString,info:t.info})}return"Actions Complete"},filterType:function(e){return _.filter(function(t){return t.type===e})},filterTag:function(e){return _.filter(function(t){return t.tag===e})},getData:function(){var e={snapshotBefore:N[DataSnapshot.Before],actions:JSON.stringify(_),snapshotAfter:N[DataSnapshot.After]};return e},getSaveData:function(){var e=this.getData();return JSON.stringify(e)},save:function(){var e=new Blob([this.getSaveData()],{type:"text/plain;charset=utf-8"});saveAs(e,"SyncReport.json")},view:function(){T.XHR({type:"POST",url:window.location.protocol+"//"+window.location.host+"/debug/sendSyncReport",data:this.getSaveData(),cb:function(e){if(log("SyncReport Response: ",e),200===e.status)try{var t=JSON.parse(e.responseText);window.location=window.location.protocol+"//"+window.location.host+"/syncReport?"+t.reportID}catch(r){log("Error parsing SyncReport Response: "+r.message)}else log("Remote Sync Report Error: ",e.status,e.responseText)}})}}}T.applyBindings=function(t,r){var n=document.getElementById(r);try{T.PAssert(781,t,"A valid model must be defined when apply bindings")}catch(i){w.reportError(i)}try{T.PAssert(782,n,"A valid element must be defined when apply bindings")}catch(i){w.reportError(i)}if(n&&t)try{e.applyBindings(t,n)}catch(o){throw o.message+=" | Binding on: "+T.elementToString(n),T.reportError(o),o}else{var a="Invalid model or element passed to applyBindings | ";a+=n?"NoModel - Elem: "+T.elementToString(n):t?"NoElem - Elem: #"+r:"NoModelNoElem - Elem: #"+r,T.reportError(new Error(a))}},e.observable.fn.toString=function(){return"observable: "+e.toJSON(this(),null,2)},e.computed.fn.toString=function(){return"computed: "+e.toJSON(this(),null,2)},e.bindingHandlers.load={init:function(e,t,r,n,i){try{T.PAssert(783,n.onLoad,"If no load function is specified, remove the binding from the template")}catch(o){w.reportError(o)}var a,s=i.$parents.length-2;s>=0&&(a=i.$parents[s]),n.onLoad(e,a)}},e.bindingHandlers.check={init:function(e,t,r,n){var i=t();i()&&T.addClass(e,"checked"),T.setupClick(e,n,{onClick:function(t){i(!i()),i()?T.addClass(e,"checked"):T.removeClass(e,"checked"),t.preventDefault(),t.stopPropagation()}})},update:function(e,t){var r=t();r()?T.addClass(e,"checked"):T.removeClass(e,"checked")}},e.bindingHandlers.tap={init:function(e,t,r,n){T.setupClick(e,n,t())}},e.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},e.bindingHandlers.possHTML={init:function(){return{controlsDescendantBindings:!0}},update:function(t,r,n,i){i.isStyled?t.innerHTML=e.utils.unwrapObservable(r()):t.textContent=e.utils.unwrapObservable(r())}},e.bindingHandlers.tooltip={init:function(r,n){t.mobile||T.setupMouseOver(r,e.utils.unwrapObservable(n()),!1)},update:function(r,n){t.mobile||T.setupMouseOver(r,e.utils.unwrapObservable(n()),!0)}},T.setupMouseOver=function(e,r,n){try{T.PAssert(784,!t.mobile)}catch(i){w.reportError(i)}T.tooltip?n?T.tooltip.update(e,r):T.tooltip.register(e,r):T.reportError(new Error("Tooltips registered before VMTooltip created"))},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),e.bindingHandlers.css2=e.bindingHandlers.css,T.findFirstDiff=function(e,t,r){if(!e)return t.length;if(!t)return e.length;for(var n=Math.min(e.length,t.length),i=0;n>i;++i)if(r){if(e.charAt(i).toLowerCase()!==t.charAt(i).toLowerCase())return i}else if(e.charAt(i)!==t.charAt(i))return i;return Math.max(e.length,t.length)},T.findMatchingLength=function(e,t,r){if(!e||!t)return 0;for(var n=Math.min(e.length,t.length),i=0;n>i;++i)if(r){if(e.charAt(i).toLowerCase()!==t.charAt(i).toLowerCase())return i}else if(e.charAt(i)!==t.charAt(i))return i;return n},T.TEMP_PREFIX="~T^";var F=0;T.generateTempId=function(){return T.TEMP_PREFIX+Date.now()+ ++F},T.isLocalItem=function(e){try{T.PAssert(785,e.id,"All items should have an ID even if it is a temp one")}catch(t){w.reportError(t)}return e.id[0]===T.TEMP_PREFIX[0]&&e.id[1]===T.TEMP_PREFIX[1]&&e.id[2]===T.TEMP_PREFIX[2]},T.getClientInfo=function(e){T.XHR({type:"GET",url:"http://api.hostip.info/get_json.php",cb:function(t){if(200===t.status){var r=JSON.parse(t.responseText);e(r)}else e({ip:"Unknown"})}})},T.requestNotification=function(e){var t=document.forms.requestNotification,r=document.getElementById("notificationResult"),n=t.email.value;return void 0===n||null===n||n.length<5?r.innerText="Please enter a valid email address.":T.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/requestNotification",data:{email:n,platform:e},cb:function(e){200===e.status?(t.email.value="",r.innerText="Thanks for your interest!"):r.innerText="There was an error processing your request, please try again in a few minutes."}}),!1};var V=void 0;T.getUserIdentifier=function(){if(!V){var e=require("goog"),t=e.authenticatedUserEmail()||T.settings.get("activeUser");if(!t)return"Unknown";V=t}return V};var B=void 0;T.getAnonUserIdentifier=function(){if(!B){var e=T.getUserIdentifier();B=e[0]+e[1]+e[2]+n(e,17124123)}return B},T.introHash=function(e){return n(e,347236113)},T.getRunningState=function(e){try{var t=T.settings.get(Settings.paneState)}catch(r){log("Failed to get paneState")}e.isDebug=!1,e.isDemo=T.isDemoMode(),e.localWrites=T.shouldWriteLocal(),e.url=window.location.href,e.paneState=i(t),e.localSettings=o(T.settings.getRawSettings()),e.loginState=T.getLoginState(),e.checkpoints=window.__checkpoints,e.gapiLoadError=gapiLoadError,e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.selection=T.parseExtra(window.getSelection()),e.eventStream=T.getEventStream(),e.trackerStream=T.getTrackerStream()},T.getAppInfo=function(e){var r="Loaded";T.vmMain&&T.vmMain.failedGapiLoad?r="ErrorLoading":gapiCalled||(r="NotLoaded"),e.gapiStatus=r,e.sessionID=window.__SESSION_ID,e.appCacheUpdated=C,t.getPlatformInfo(e),T.getRunningState(e),require("gdata").getState(e)},T.reportSignup=function(e){try{T.PAssert(786,e,"Must specify a valid email address to signup with")}catch(t){w.reportError(t)}T.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/reportSignup",data:{email:e},cb:function(e){200!==e.status&&ShouldLog(LogLevels.Error)&&log("Failed to report signup",e.responseText,e)}})};var U=!1;T.criticalErrorReported=function(){return U},T.handleCriticalError=function(){if(U=!0,T.isDemoMode())T.reload();else{var e=document.createElement("div");e.id="criticalError",e.textContent="There was a critical error while loading the app, "+t.actionVerb()+" to reload.",t.isTouchDevice?e.addEventListener(t.touchStartEvent,function(){T.reload()},!0):e.addEventListener(t.upEvent,function(){T.reload()},!0),T.prependChild(document.body,e),T.removeDOM("outerWrapper"),T.removeDOM("setupWrapper"),T.removeDOM("templates")}},T.safeStringify=function(e){try{return JSON.stringify(e)}catch(t){log("Error stringify object: "+t.message)}},T.reportEvent=function(e){if(!T.isDemoMode()){var t=T.parseExtra(e);T.eventStream.push(t)}},T.getEventStream=function(){return T.safeStringify(T.eventStream.ordered())},window.__getEventStream=T.getEventStream,T.getTrackerStream=function(){try{var e=require("tracker");return e.stringifyGroups()}catch(t){log("Error getting tracker stream: ",t.message)}},T.parseExtra=function(e){var t;if(e)try{var r;if(e instanceof KeyboardEvent)r={type:e.type,currentTarget:T.elementToString(e.currentTarget),target:T.elementToString(e.target||e.srcElement),keyCode:e.keyCode,normCode:e.normCode,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()};else if(e instanceof window.MouseEvent)r={type:e.type,currentTarget:T.elementToString(e.currentTarget),relatedTarget:T.elementToString(e.relatedTarget),target:T.elementToString(e.target||e.srcElement),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof window.TouchEvent){r={type:e.type,currentTarget:T.elementToString(e.currentTarget),relatedTarget:T.elementToString(e.relatedTarget),target:T.elementToString(e.target||e.srcElement),tstamp:Date.now()};var n=e.touches[0];n&&(r.clientX=n.clientX,r.clientY=n.clientY)}else if(window.PointerEvent&&e instanceof window.PointerEvent)r={type:e.type,currentTarget:T.elementToString(e.currentTarget),relatedTarget:T.elementToString(e.relatedTarget),target:T.elementToString(e.target||e.srcElement),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof window.Event)r={type:e.type,currentTarget:T.elementToString(e.currentTarget),relatedTarget:T.elementToString(e.relatedTarget),target:T.elementToString(e.target||e.srcElement),tstamp:Date.now()};else if(e instanceof Selection)if(0===e.rangeCount)r={rangeCount:0};else{var i=e.getRangeAt(0),o=i.startContainer,a=!1,s=0,c=i.endContainer,d=!1,l=0;o.nodeType===Node.TEXT_NODE&&(s=o.length,o=o.parentNode,a=!0),T.hasClass(o,"text")&&(s=h(o)),c.nodeType===Node.TEXT_NODE&&(l=c.length,c=c.parentNode,d=!0),T.hasClass(c,"text")&&(s=h(c)),r={rangeCount:e.rangeCount,startContainer:T.elementToString(o),startWasTextNode:a,startOffset:i.startOffset,startElementLength:s,endContainer:T.elementToString(c),endWasTextNode:d,endOffset:i.endOffset,endElementLength:l}}else r=e;t=T.safeStringify(r)}catch(u){log("Error parsing extra "+u.message)}return t},window.__jsVersion="1403087090032",T.handleJSError=function(e,t,r,n){function i(){var r={};T.getAppInfo(r),T.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/debug/reportError",data:{msg:e,url:window.location.href,stack:t,logs:o,info:JSON.stringify(r),user:a,extra:s,jsVersion:window.__jsVersion,htmlVersion:document.body.getAttribute("ver")},cb:function(e){200!==e.status?log("Failed to report remote error",e.responseText,e):log("Reported Remote Error: ",e.responseText)}})}if(n||console.error("JS Error: "+e,"  Stack: ",t,"  Extra: ",r),e||t)try{var o=o=__LOG_BUFFER.ordered().join("\r\n"),a=T.getUserIdentifier(),s=T.parseExtra(r);"Unknown"!==a?i():T.getClientInfo(function(e){e&&(a=e.ip),i()})}catch(c){log("Badness happened reporting errors to server: ",c)}else;},window.onerror=function(e,t,r,n,i){i?(log("Reported Global OnError: "+e+" Script: "+t+" Line: "+r+" Column: "+n),T.reportError(i)):(log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+r+" Column: "+n),T.reportError(e))},T.reportError=function(e,t){!e||t||e.message||e.stack||(t=e,e=void 0),e||(e={message:"Undefined error passed to reporter",stack:T.getCurrentStack("")}),T.handleJSError(e.message,e.stack,t)},window.__SendInfo=function(e){return T.handleJSError("Remote Client Info",void 0,e,!0),"Thank you for providing your client info!"},window.__CreateDebugSession=function(e){if(window.remote)return"Debug session already started";var t=e||a();window.rcon=window.console,T.handleJSError("Remote Debug Session",void 0,t,!0),T.addScript("http://jsconsole.com/remote.js?"+t,"rDebugScript");var r=!1,n=0,i="";return window.rdbg={startProfile:function(e){try{return r?"Profiler already running":(i=e?e:"RDBGProfile_"+n,window.rcon.profile(i),r=!0,"Profiler Started: "+i)}catch(t){return"Error starting profile: "+t.message}},stopProfile:function(){try{if(r){window.rcon.profileEnd(i),r=!1;var e="Profile Completed: "+i;return i="",n++,e}return"Profiler not running, use startProfile()"}catch(t){return"Error stopping profile: "+t.message}}},"Your remote debug session has started: "+t},r.hasURLParam("rdebug","true")&&setTimeout(function(){var e=r.getURLParam("rsession")||a();window.__CreateDebugSession(e),log("%c---- REMOTE DEBUGGING ENABLED: "+e+" ----","color: green")},2e3),t.demo||console.log('%cIf you have been asked to send us your client information or have been seeing issues, please use __SendInfo("MESSAGE") to give us your information.',"color: green"),window.Checkpoint={MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,MaskRequired:255},T.checkpoint=function(e){window.__checkpoints|=e},T.hasSentLowMemoryWarning=e.observable(!1),T.handleLowMemory=function(e){T.hasSentLowMemoryWarning()||(T.hasSentLowMemoryWarning(!0),log("Low Memory Event: ",e),T.handleJSError("DeviceLowMemory: "+e,void 0))};var q=/function\s+([^(]*?)\s*\(([^)]*)\)/,W=!1;T.getCurrentStack=function(e){if(W||t.noErrorStacks)try{var r=JSON.stringify(e)}catch(n){log("Error stringifying stack message",n,e)}if(W){var n=new Error(r||e);if(n.stack)return n.stack}W=!1;try{for(var i=["GenError: "+(r||e)],o=arguments.callee.caller,a=75,s=0;o&&s++<a;){var c,d=o.toString(),l=q.exec(d);c=l&&3===l.length&&""!==l[1]&&void 0!==l[1]?"at "+l[1]+"("+l[2].replace(/[\r\n]/g,"")+")":l&&3===l.length?"at <anonymous> ("+l[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",i.push(c),o=o.caller}return i.join("\n")}catch(n){log("Error generating stack trace",n)}return""};var H=12e5,K=0;T.checkForRemoteChanges=function(){var e=Date.now();if(K-e>=H)try{T.AppCache.checkForUpdate(),T.messageQueue.updateRemoteMessages()}catch(t){T.reportError(t)}finally{K=e}},T.createRingBuffer=function(e){var t=0,r=[],n=e;return{get:function(e){return r[e]},push:function(e){r[t]=e,t=(n+t+1)%n},count:function(){return t},reset:function(){t=0,r=[]},buffer:function(){return r},limit:function(e){n=e},ordered:function(){return r.slice(t).concat(r.slice(0,t))},entries:function(){for(var e=this.ordered(),t=0;t<e.length;++t)console.log("---- Entry ["+t+"] ----"),console.log(e[t])}}},T.wrapFn=function(e){function t(){try{return e.apply(this,arguments)}catch(t){var r;try{r=JSON.stringify(arguments)}catch(n){log("Unable to stringify args: ",arguments)}finally{T.reportError(t,r)}}}return t},function(){var e=function(e){var t=window[e];window[e]=function(){var e=Array.prototype.slice.call(arguments),r=e[0];return"function"==typeof r&&(e[0]=T.wrapFn(r)),t.apply?t.apply(this,e):t(e[0],e[1])}};e("setTimeout"),e("setInterval")}();var j=t.mobile?20:40;window.__LOG_BUFFER=T.createRingBuffer(j);var G=window.log;window.log=function(){__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," ")),console.log.apply(console,arguments)};for(var z in G)window.log[z]=G[z];T.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},T.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},T.isString=function(e){return"string"==typeof e},T.isObject=function(e){return"object"==typeof e&&null!==e},T.enumToString=function(e,t){for(var r in e)if(e[r]==t)return r;return null},T.elementToString=function(e,t){if(e){var r=e.nodeName;return e.id&&(r+="#"+e.id),e.className&&(r+="."+e.className),t&&e.innerText&&(r+=":"+e.innerText.length),"["+r+"]"}return"[UNDEFINED]"},T.highlightElement=function(e,t,r){try{T.PAssert(787,e,"Must have a valid element to highlight")}catch(n){w.reportError(n)}if(e){var i=t||.5,o=r||1,a=e.getBoundingClientRect(),s=a.top+a.height*o,c=a.left+a.width*i;T.showArrowAt(s,c)}},T.showArrowAt=function(e,r){var n=document.getElementById("iarrow");try{T.PAssert(789,n,"Must have a valid highlight arrow")}catch(i){w.reportError(i)}n.style.display="block";var o=t.mobile?-35:0;n.style.top=e+o+"px",n.style.left=r+"px"},T.hideHighlightElement=function(){var e=document.getElementById("iarrow");try{T.PAssert(790,e,"Must have a valid highlight arrow")}catch(t){w.reportError(t)}e.style.display="none"};var Y=500;T.setupClick=function(e,r,n){function i(e){var t=e.eventX-this.lastX,i=e.eventY-this.lastY;if(0!==t||0!==i){var o=!this.moved;if(this.lastX=e.eventX,this.lastY=e.eventY,e.distanceX=this.distanceX=this.distanceX+Math.abs(t),e.distanceY=this.distanceY=this.distanceY+Math.abs(i),(this.moved||e.distanceX>T.ClickThreshold||e.distanceY>T.ClickThreshold)&&(this.moved=!0,e.moved=this.moved),(n.onMove||n.onFirstMove)&&(e.diffX=e.eventX-this.startX,e.diffY=e.eventY-this.startY,e.xThisFrame=t,e.yThisFrame=i,e.xFromTopLeft=this.xFromTopLeft,e.yFromTopLeft=this.yFromTopLeft,e.startX=this.startX,e.startY=this.startY,e.startClientX=this.startClientX,e.startClientY=this.startClientY,e.startSrc=this.startSrc,o&&n.onFirstMove&&n.onFirstMove.call(r,e),n.onMove)){var a=!1;
a=n.onMove.call(r,e),a&&e.stopImmediatePropagation()}}}function o(e){e.srcElement||(e.srcElement=e.target);var t=Date.now(),i=this.lastTouch||t,o=Math.max(0,t-i);this.numClicks?this.numClicks++:this.numClicks=1,e.eventX=this.lastX,e.eventY=this.lastY,e.moved=this.moved,e.timeDelta=o,e.diffX=this.lastX-this.startX,e.diffY=this.lastY-this.startY,e.startX=this.startX,e.startY=this.startY,e.xFromTopLeft=this.xFromTopLeft,e.yFromTopLeft=this.yFromTopLeft,e.startSrc=this.startSrc,Y>o&&o>0&&n.onDblClick&&!this.moved&&n.onDblClick.call(r,e),isNaN(e.button)||0===e.button?(this.lastTouch=t,n.onClick&&!this.moved&&n.onClick.call(r,e)):1==e.button&&n.onMiddleClick&&!this.moved&&n.onMiddleClick.call(r,e),(isNaN(e.button)||0===e.button)&&n.onEnd&&n.onEnd.call(r,e),setTimeout(function(){this.lastTouch=void 0,this.numClicks=void 0}.bind(this),Y)}function a(e){n.onCancel&&n.onCancel.call(r,e)}function c(e){e.timeStart=this.timeStart=Date.now(),e.srcElement||(e.srcElement=e.target),this.startSrc=e.srcElement,this.moved=!1,e.startX=this.startX=e.eventX,e.startY=this.startY=e.eventY,e.startClientX=this.startClientX=e.clientX,e.startClientY=this.startClientY=e.clientY,this.lastX=e.eventX,this.lastY=e.eventY,this.distanceX=0,this.distanceY=0;var t=T.offset(e.srcElement);e.xFromTopLeft=this.xFromTopLeft=e.eventX-t.left,e.yFromTopLeft=this.yFromTopLeft=e.eventY-t.top,(isNaN(e.button)||0===e.button)&&n.onStart&&n.onStart.call(r,e),isNaN(e.changeLastY)||(this.lastY+=e.changeLastY)}function d(r){var n=t.ie?r:r.touches[0];return r.eventX=n.pageX,r.eventY=n.pageY,r.clientX=n.clientX,r.clientY=n.clientY,i.call(e,r),r.returnFalse?!1:void 0}function l(r){return document.removeEventListener(t.touchMoveEvent,S,y),document.removeEventListener(t.touchEndEvent,M,y),document.removeEventListener(t.touchCancelEvent,x,y),C&&C.stop(),o.call(e,r),r.returnFalse?!1:void 0}function u(r){return document.removeEventListener(t.touchMoveEvent,S,y),document.removeEventListener(t.touchEndEvent,M,y),document.removeEventListener(t.touchCancelEvent,x,y),C&&C.stop(),a.call(e,r),r.returnFalse?!1:void 0}function h(r){if(!r.handled){this.lastInputTouch=!0;var n=t.ie?r:r.touches[0];return r.eventX=n.pageX,r.eventY=n.pageY,r.clientX=n.clientX,r.clientY=n.clientY,c.call(e,r),r.ignore||(document.addEventListener(t.touchMoveEvent,S,y),document.addEventListener(t.touchEndEvent,M,y),document.addEventListener(t.touchCancelEvent,x,y),C&&(log("Add Gesture Pointer: ",r.id,T.elementToString(r.target),T.elementToString(e)),C.addPointer(r.pointerId))),r.returnFalse?!1:void 0}}function p(t){return this.lastInputTouch?void 0:(t.eventX=t.pageX,t.eventY=t.pageY,i.call(e,t),t.returnFalse?!1:void 0)}function m(r){return r.handled||this.lastInputTouch?void 0:(document.removeEventListener(t.moveEvent,A,y),document.removeEventListener(t.upEvent,P,y),0===r.button&&o.call(e,r),r.returnFalse?!1:void 0)}function f(r){return r.handled||this.lastInputTouch?void 0:(this.lastInputTouch=!1,r.eventX=r.pageX,r.eventY=r.pageY,c.call(e,r),r.ignore||(0===r.button&&document.addEventListener(t.moveEvent,A,y),document.addEventListener(t.upEvent,P,y)),r.returnFalse?!1:void 0)}function g(e){e.handled||this.lastInputTouch||(e.srcElement||(e.srcElement=e.target),n.onRightClick&&n.onRightClick.call(r,e))}try{T.PAssert(792,e,"Expecting an object to bind the click hanlders to.")}catch(v){w.reportError(v)}if(!e)return void log("Skipping setupClick because no valid DOM object was provided to bind to");r||(r=e);var y=!1;T.isFunction(n)?n={onClick:n}:n&&n.useCapture&&(y=n.useCapture);var b=s(h),S=s(d),M=s(l),x=s(u),C=void 0,I=s(f),A=s(p),P=s(m),D=s(g);return t.isTouchDevice?e.addEventListener(t.touchStartEvent,b,y):e.addEventListener(t.downEvent,I,y),t.usePointerEvents&&t.mobile&&e.addEventListener("mousedown",function(e){return E.isEnabled()&&E.isTargetBox(e)||(e.preventDefault(),e.stopImmediatePropagation()),!1},y),n.onRightClick&&!t.mobile&&e.addEventListener("contextmenu",D,y),this};var X=!1;T.StartSpinner=function(){t.mobile&&!X&&(X=!0,T.removeClass(document.getElementById("loading"),"hidden"))},T.StopSpinner=function(){var e=document.getElementById("loading");X&&e&&T.addClass(document.getElementById("loading"),"hidden")},Array.prototype.removeAt=function(e){return this.splice(e,1)[0]},Array.prototype.remove=function(e){var t=this.indexOf(e);return t>=0&&this.removeAt.call(this,t),t},Array.prototype.findInsertIndex=function(e,t){try{T.PAssert(794,e,"Require a valid element to insert")}catch(r){w.reportError(r)}try{T.PAssert(795,t,"Require a valid comparison function")}catch(r){w.reportError(r)}for(var n=0,i=this.length-1;i>=n;){var o=n+i>>1,a=t(this[o],e);if(0>a)n=o+1;else{if(!(a>0))return o;i=o-1}}return n},Array.prototype.insertSorted=function(e,t){var r=this.findInsertIndex(e,t);this.splice.apply(this,[r,0,e])},e.observableArray.fn.insertSorted=function(e,t){this.peek().insertSorted(e,t),this.valueHasMutated()},T.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},T.randParam=function(){return"?t="+Date.now()},T.createPath=function(e){return window.location.protocol+"//"+window.location.host+"/"+e},T.addScript=function(e,t,r){var n=document.createElement("script");n.type="text/javascript",n.src=e,t&&(n.id=t),r&&c(n,r),"undefined"!=typeof n&&document.getElementsByTagName("head")[0].appendChild(n)},T.addStylesheet=function(e,t){var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t&&c(r,t),"undefined"!=typeof r&&document.getElementsByTagName("head")[0].appendChild(r)},T.PAssert=function(e,t){if(!t){var r={isAssert:!0,tag:e};try{var n=d(Array.prototype.slice.call(arguments,2));log(arguments.length>2?"Assert Failure: "+n:"Assert Failure"),T.reportError(new Error("Assert Failure: "+n),r)}catch(i){log("Exception in PAssert: ",i),T.reportError(i,r)}}},T.getSelectionInfo=function(){var e=window.getSelection(),t=e.anchorNode;return t?{node:t.nodeType===Node.TEXT_NODE?t.parentNode:t,selection:e}:void 0},T.getSelectionRange=function(){var e=window.getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0);return t}return void 0},T.getItemForElement=function(t){if(E.isEnabled()){var r=E.getCurrentVMLI();if(r)return r}if(t&&t!==document.body){t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);var n=e.dataFor(t);return n instanceof M?n:void 0}return void 0},T.getSelectedItem=function(){var e=window.getSelection();return T.getItemForElement(e.anchorNode)},T.clearSelection=function(){window.getSelection().removeAllRanges()},T.selectElement=function(e,t){if(e.textContent.length>0&&e.textContent!==TextSpace){var r=window.getSelection(),n=document.createRange(),i=t?e.textContent.length:0;n.setStart(e.childNodes[0],i),n.setEnd(e.childNodes[0],e.textContent.length),r.removeAllRanges(),r.addRange(n)}else e.focus()},T.selectChildren=function(e,t,r){if(e){var n=e.getParsedText().length-e.styleLength,t=Math.min(t,n),i=Math.min(t+r,n),o=window.getSelection(),a=document.createRange(),s=void 0,c=-1,d=void 0,u=-1,h=0,p=e.getSpan();if(p){for(var m=l(p),f=0;f<m.length;++f){var g=m[f].length;if(-1===c&&h+g>=t&&(s=m[f],c=t-h),h+g>=i){d=m[f],u=i-h;break}h+=g}try{T.PAssert(797,s&&c>=0)}catch(v){w.reportError(v)}try{T.PAssert(798,d&&u>=0)}catch(v){w.reportError(v)}try{T.PAssert(799,c<=s.length)}catch(v){w.reportError(v)}try{T.PAssert(800,u<=d.length)}catch(v){w.reportError(v)}c=0>c?0:c,u=0>u?0:u,a.setStart(s,c),a.setEnd(d,u),o.removeAllRanges(),o.addRange(a)}}else try{T.PAssert(796,!1,"Valid item and text required to perform selection")}catch(v){w.reportError(v)}},T.getOffsetOfSubNode=function(e,t){for(var r=0,n=l(e),i=l(t),o=0;o<n.length&&n[o]!=i[0];++o)r+=n[o].length;return r},T.selectMultiline=function(e,t,r,n){var i=!1,o=window.getSelection(),a=document.createRange(),s=u(e,t),c=u(r,n);try{T.PAssert(802,s&&s.element&&!isNaN(s.offset),"Start element is invalid")}catch(d){w.reportError(d)}try{T.PAssert(803,c&&c.element&&!isNaN(c.offset),"End element is invalid")}catch(d){w.reportError(d)}return s&&s.element&&c&&c.element&&(a.setStart(s.element,s.offset),a.setEnd(c.element,c.offset),o.removeAllRanges(),o.addRange(a),i=!0),i},T.saveSelectionItem=function(e){if(!e){var t=T.getSelectionInfo();if(!t||0===t.rangeCount)return void 0;e=t.selection.getRangeAt(0)}var r=!0;if(e&&e.startContainer&&e.endContainer)try{var n=T.getItemForElement(e.startContainer),i=T.getItemForElement(e.endContainer);if(n&&i)var o=T.getSelectOffsetsInSpan(n,n.getSpan(),e),a=T.getSelectOffsetsInSpan(i,i.getSpan(),e),s=T.getPaneForElement(n.getSpan());else r=!1}catch(c){T.reportError(c),r=!1}else r=!1;var d=void 0;return r&&(d={start:o,end:a,startItem:n,endItem:i,pane:s}),d};var J={};T.saveSelection=function(e,t){J[e]=T.saveSelectionItem(t,e)},T.clearSavedSelection=function(e){J[e]=void 0},T.restoreSavedSelection=function(e,t){var r=J[e],n=void 0;if(r&&(!t||t===r.pane)){try{n=T.restoreSelectionItem(r),n&&T.scrollIntoView(n.getSpan(),0)}catch(i){T.reportError(i)}T.clearSavedSelection(e)}return!!n},T.restoreSelectionItem=function(e){try{T.PAssert(804,e,"Must restore to a valid selection")}catch(t){w.reportError(t)}var r=T.hasClass(e.startItem.getElement(),"hidden"),n=T.hasClass(e.endItem.getElement(),"hidden");if(r&&!n){var i=T.selectMultiline(e.endItem.getSpan(),e.end.end,e.endItem.getSpan(),e.end.end);return i?e.endItem:void 0}if(!r&&n){var i=T.selectMultiline(e.startItem.getSpan(),e.start.start,e.startItem.getSpan(),e.start.start);return i?e.startItem:void 0}var i=T.selectMultiline(e.startItem.getSpan(),e.start.start,e.endItem.getSpan(),e.end.end);return i?e.startItem:void 0},T.getSelectOffsetsInSpan=function(e,t,r,n){var i=e?e.styleLength:0,o={start:0,startText:i,end:0,endText:i,total:0,totalText:i};if(E.isEnabled()&&!n)o.start=E.getSelectionStart(),o.startText=o.start+i,o.end=E.getSelectionEnd(),o.endText=o.end+i,o.total=E.getInputText().length,o.totalText=o.total+i;else{try{T.PAssert(805,t&&"SPAN"==t.tagName,"Expected SPAN, Actual: ",t)}catch(a){w.reportError(a)}if(t&&t.textContent!==TextSpace&&(!E.isEnabled()||""!==t.textContent)){var s=r.startContainer,c=r.startOffset,d=r.endContainer,u=r.endOffset;try{T.PAssert(806,"#text"==s.nodeName,"Expected #text, Actual: ",s.nodeName)}catch(a){w.reportError(a)}for(var h=0,p=l(t),m=0;m<p.length;++m)p[m]==s&&(o.start=h+c,o.startText=h+c+i),p[m]==d&&(o.end=h+u,o.endText=h+u+i),h+=p[m].length;o.total=h,o.totalText=h+i}}return o},T.getSpanParent=function(e){if(E.isEnabled())return E.getInputBox();if(T.hasClass(e,"noItems"))return void 0;for(;e&&("SPAN"!==e.tagName||!p(e));)e=e.parentNode;if(e&&p(e))return e;try{T.PAssert(807,!1,"This shouldn't happen, spans should always be found")}catch(t){w.reportError(t)}return void 0},T.getLIParent=function(e){for(;e&&"LI"!==e.tagName;)e=e.parentNode;return e&&!T.hasClass(e,"item")?null:e},T.getPreviousItem=function(e,t,r){try{T.PAssert(809,e,"Item must be specified")}catch(n){w.reportError(n)}if(!e)return void 0;var i=void 0,o=r&&r.isTest,a=r&&r.ignoreSearch,s=e.parent();if(!s)return void 0;var c=s.getChildIndex(e);if(c>0){for(;!i;){for(var d=!1,l=c-1;l>=0;l--){var u=s.getChild(l);if(u.hasChildren()&&!u.isCollapsed()){if(a||!t||!T.hasClass(u.getElement(t.id),"hidden")){s=u,c=u.numChildren(),d=!0;break}}else if(a||!t||!T.hasClass(u.getElement(t.id),"hidden")){i=u,d=!0;break}}d||(i=s)}try{T.PAssert(810,o||!i||i.isCollapsed()||e===T.getNextItem(i,t,{isTest:!0,ignoreSearch:a}),"Previous/Next should always match")}catch(n){w.reportError(n)}}else i=e.parent();return i},T.getNextItem=function(e,t,r){try{T.PAssert(811,e,"Item must be specified")}catch(n){w.reportError(n)}if(!e)return void 0;var i=void 0,o=r&&r.isTest,a=r&&r.ignoreSearch;if(e.hasChildren()&&!e.isCollapsed())for(var s=e.numChildren(),c=0;s>c;++c){var d=e.getChild(c);if(a||!t||!T.hasClass(d.getElement(t.id),"hidden")){i=d,r&&r.numLevels++;break}}for(var l=e;!i;){var u=l.parent();if(!u)break;var h=u.getChildIndex(l),s=u.numChildren();if(!u.isCollapsed())for(var c=h+1;s>c;++c){var d=u.getChild(c);try{T.PAssert(812,!t||d.getElement(t.id),"next element should be visible in pane")}catch(n){w.reportError(n)}if(a||!t||!T.hasClass(d.getElement(t.id),"hidden")){i=d;break}}if(l=u,r&&!i&&r.numLevels--,t&&l===t.item())break}try{T.PAssert(813,o||!i||e===T.getPreviousItem(i,t,{isTest:!0,ignoreSearch:a}),"Previous/Next should always match")}catch(n){w.reportError(n)}return i},T.getFirstPaneItem=function(e){return T.getNextItem(e.item())},T.getLastPaneItem=function(e){for(var t=e.item().getLastChild();t.hasChildren();t=t.getLastChild());try{T.PAssert(814,t,"Must always have a valid pane item")}catch(r){w.reportError(r)}return t},T.getItemCounts=function(e,t,r){try{T.PAssert(815,e,"Start must be a valid item")}catch(n){w.reportError(n)}try{T.PAssert(816,t,"End must be a valid item")}catch(n){w.reportError(n)}var i=0,o=0,a=e;do{a=T.getNextItem(a,r);try{T.PAssert(817,a,"Items must exist")}catch(n){w.reportError(n)}a.parent()===r.item()&&a.isHeader()&&o++,i++}while(a!==t);return{fscount:o,icount:i}},T.getItemsBetween=function(e,t,r){try{T.PAssert(818,e,"Start must be a valid item")}catch(n){w.reportError(n)}try{T.PAssert(819,t,"End must be a valid item")}catch(n){w.reportError(n)}for(var i=[e],o=e;o!==t;){o=T.getNextItem(o,r);try{T.PAssert(820,o,"Items must exist")}catch(n){w.reportError(n)}i.push(o)}return i},T.getFirstItem=function(e,t){if(e.id==t.id||t.parent().id==e.id)return e;if(e.parent().id==t.id)return t;var r=e,n=void 0;do{var i=t,o=void 0;do{if(r.id==i.id){if(void 0===n)return e;if(void 0===o)return t;try{T.PAssert(821,void 0!==o,"Fix this assert by handling this edge case!")}catch(a){w.reportError(a)}try{T.PAssert(822,r.id==o.parent().id,"Must share a common parent")}catch(a){w.reportError(a)}try{T.PAssert(823,r.id==n.parent().id,"Must share a common parent")}catch(a){w.reportError(a)}try{T.PAssert(824,n.id!=o.id,"If both previous items match, they should have been the common ancestor")}catch(a){w.reportError(a)}return n.getIndex()<o.getIndex()?e:t}o=i}while(void 0!==(i=i.parent()));n=r}while(void 0!==(r=r.parent()));try{T.PAssert(825,!1,"One item must appear first in the tree")}catch(a){w.reportError(a)}return void 0},T.animateTransform=function(e,r){function n(){r.clearTransform&&(e.style[t.transform.style]="",e.style[t.transformOrigin.style]=""),r.onComplete&&r.onComplete()}var i=r.transform;if(!isNaN(r.delay)){var o=r.delay;return r.delay=void 0,void setTimeout(T.animateTransform,o,e,r)}if(r.time){var a=T.getTransitionClass(r.time);T.addClass(e,a),setTimeout(function(){T.removeClass(e,a),n()},r.time)}else n();isNaN(r.opacity)||(e.style.opacity=r.opacity),i||isNaN(r.left)||isNaN(r.top)||(i="translate3d("+left+"px,"+top+"px,0)"),r.origin&&(e.style[t.transformOrigin.style]=r.origin),e.style[t.transform.style]=i},T.easeOut=function(e,t,r){return-r*e*(e-2)+t},T.scrollTo=function(e,r,n,i,o){function a(e){c||(c=e-20);var i=Math.min((e-c)/r,1),u=T.easeOut(i,d,l);return n[s]=u,1==i?(T.isScrollingIntoView=!1,void(t.ios&&(T.setSelectionToWhatItAlreadyIs(),o&&o()))):void requestAnimationFrame(a)}n=n||T.focusedPane.rootElement;var s=i?"scrollLeft":"scrollTop";if(r>0){T.isScrollingIntoView=!0;var c,d=n[s],l=e-d;requestAnimationFrame(a)}else n&&(n[s]=e)},T.computeScrollSpeed=function(e,t,r){return(t-e-(t-r))/(t-e)};var $={speed:0,pane:void 0},Q=!1;T.repeatScroll=function(e,t){$.speed=e,$.pane=t,Q||(Q=!0,requestAnimationFrame(m))},T.cancelRepeatScroll=function(){Q=!1};var Z;T.getPaneForElement=function(t){if(Z||(Z=require("VMPane")),t){var r;r=e.contextFor(E&&E.isEnabled()&&"androidInput"==t.id?E.getCurrentVMLI().getSpan():t);var n=r?r.$parents[r.$parents.length-2]:void 0;if(!n&&r&&1===r.$parents.length&&(n=r.$data),n instanceof Z)return n}return void 0},T.elementInPane=function(t){if(t){var r=e.contextFor(t);if(r){var n=r.$parents[r.$parents.length-2];if(n)return T.hasClass(n.element,"pane")}}return!1},T.scrollToTop=function(e,r,n){if(e){var i=(n&&n.callback,T.findParent(e,"scroller"));if(i){var o=e.getBoundingClientRect().top,a=i.scrollTop,s=o-T.topBoxHeight+(t.orientation==Orientation.Landscape?T.topBarHeight:0),c=a+s;return T.scrollTo(c,r,i),s||!0}}return!1},T.scrollIntoView=function(r,n,i){var o=i&&i.callback,a=i&&i.noToolbar;isNaN(n)&&(n=200);var s=!1;if(r){var c=T.findParent(r,"scroller");if(c){var d,l=c.getBoundingClientRect(),u=l.bottom,h=r.getBoundingClientRect(),p=10,m=c.scrollTop;if(t.mobile&&(a||(u-=T.keyboardToolbarHeight),t.ios&&!t.ios71&&T.isKeyboardOpen||(u-=t.kbsize?t.kbsize:248)),h.top<l.top){var f=e.dataFor(r);d=t.mobile||f!=T.getFirstPaneItem(T.focusedPane)?m+h.top-l.top-p:0}else h.bottom>u&&(d=m+h.bottom-u+p);void 0!==d&&(T.scrollTo(d,n,c),o&&(n>0?setTimeout(o,n):o()),s=!0)}}return s},T.isKeyboardInputElement=function(e){return"checkbox"===e.type?!1:"INPUT"==e.nodeName||"textarea"==e.type?!0:!1},T.openKeyboardOn=function(e,r,n,i,o){try{T.PAssert(827,t.mobile,"Should only be opening keyboard on mobile devices")}catch(a){w.reportError(a)}var s=T.findParent(r,"scroller"),c=s?s.scrollTop:0,d=!1;if(n&&T.keyboardToolbar.preShow(),T.isKeyboardOpen)log("keyboard open");else if(t.app||t.android||t.mobileie){var l=function(){n?T.keyboardToolbar.show():T.isKeyboardOpen=!0,i&&i(),T.enforceScroll()};T.addClass(s,"padded"),d=T.scrollIntoView(r,t.keyboardOpenTime,{callback:l,noToolbar:!n})}else d=T.scrollIntoView(r,t.keyboardOpenTime);d&&t.app&&!t.android||(i&&i(),n&&T.keyboardToolbar.show()),T.onCloseKeyboard=function(){T.addClass(s,"padded"),T.scrollTo(c,t.keyboardOpenTime,s,!1,function(){T.removeClass(s,"padded")}),T.isKeyboardOpen=!1,o&&o(),window.removeEventListener("closeKeyboard",T.onCloseKeyboard),T.onCloseKeyboard=void 0},window.addEventListener("closeKeyboard",T.onCloseKeyboard),t.ios&&T.preventClick(),e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0,T.enforceScroll()},T.blurActiveElement=function(e){T.ignoreSelectionChange=!!e,T.fireCustomEvent("closeKeyboard"),document.activeElement.blur(),setTimeout(function(){T.ignoreSelectionChange=!1},100)},T.preventScrollPropagation=function(e){return e.scrollHeight===e.clientHeight?!1:(0===e.scrollTop?e.scrollTop=1:e.scrollTop+e.offsetHeight>=e.scrollHeight&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1),!0)},T.setSelectionToWhatItAlreadyIs=function(){var e=window.getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0);e.removeAllRanges(),e.addRange(t)}},T.setSelection=function(e,t,r){try{T.PAssert(829,e,"Must supply a valid element to set selection on")}catch(n){w.reportError(n)}try{T.PAssert(830,t>=0&&r>=0,"Must specify positive start and end offsets")}catch(n){w.reportError(n)}if(0>t||0>r)return!1;if(!e)return!1;var i,o=!0;try{var a=l(e),s=document.createRange();i=a.length>0?a[0]:e,s.setStart(i,t),s.setEnd(i,r);var c=window.getSelection();c.removeAllRanges(),c.addRange(s)}catch(d){T.reportError(d,{element:T.elementToString(e,!0),select:T.elementToString(i,!0),start:t,end:r,children:a.length>0?T.elementToString(e,!0):void 0}),o=!1}return o},T.restrictSelectionToText=function(){if(!E||!E.isEnabled()){var t,r,n,i,o,a,s=function(){return t=T.getSelectionInfo(),t&&0!==t.rangeCount?(r=t.selection.getRangeAt(0),n=r.startContainer,i=r.endContainer,o=r.startOffset,void(a=r.endOffset)):!0};if(s(),t){try{T.PAssert(831,"#text"==n.nodeName||"SPAN"==n.nodeName,"Expected #text or SPAN, Actual: "+n.nodeName)}catch(c){w.reportError(c)}try{T.PAssert(832,"#text"==i.nodeName||"LI"==i.tagName||"UL"==i.tagName||"SPAN"==i.tagName,"Expected LI, UL, #text, SPAN, Actual: "+i.tagName)}catch(c){w.reportError(c)}if("SPAN"===n.nodeName&&(T.selectMultiline(n,o,i,a),s()),"#text"===n.nodeName&&n.previousSibling&&"#comment"===n.previousSibling.nodeName){try{T.PAssert(833,!1,"This case shouldnt be getting hit")}catch(c){w.reportError(c)}T.selectChildren(T.getSpanParent(n),0,a),s()}if(n!==i&&0===a&&"P"==i.nodeName){i=i.parentNode.parentNode;var d=i.previousElementSibling;try{T.PAssert(834,!d||"LI"==d.tagName)}catch(c){w.reportError(c)}if(d){if(d.children.length>1){var l=d.children[1].children;d=l[l.length-1]}}else d=i.parentNode.parentNode;var u=e.dataFor(d).getParsedText().length;T.selectMultiline(n,o,d,u)}else if("LI"===i.tagName){var d=i.previousElementSibling;try{T.PAssert(835,!d||"LI"===d.tagName)}catch(c){w.reportError(c)}if(d){if(d.children.length>1){var l=d.children[1].children;d=l[l.length-1]}}else d=i.parentNode.parentNode,console.log(d);var h=d.firstChild;try{T.PAssert(836,"SPAN"===h.tagName,"Expected SPAN, Actual: "+h.tagName)}catch(c){w.reportError(c)}T.selectChildren(e.dataFor(h),0,h.textContent.length)}else if("UL"===i.nodeName){var h=i.parentElement.firstElementChild;try{T.PAssert(837,"SPAN"===h.tagName,"Expected SPAN, Actual: "+h.tagName)}catch(c){w.reportError(c)}T.selectChildren(e.dataFor(h),0,h.textContent.length)}}}},T.trimString=function(e){for(var e=e.replace(/^\s\s*/,""),t=/\s/,r=e.length;t.test(e.charAt(--r)););return e.slice(0,r+1)},T.enforceScroll=function(e,r){(e||(t.ios||t.android)&&(!t.app||t.ios71)&&!t.bodyscroll)&&(setTimeout(function(){window.scrollTo(0,r||0)},0),requestAnimationFrame(function(){window.scrollTo(0,r||0)}),window.scrollTo(0,r||0),document.body.scrollTop=0)},T.preventDefault=function(e){e.preventDefault()},T.preventClick=function(){T.addClass(T.element("outerWrapper"),"noClick"),window.ontouchstart=T.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,T.removeClass(T.element("outerWrapper"),"noClick")})},T.searchVMLIs=function(e){var t=e.item;t||(t=T.vmMain.root()),e.headers?f(e,t.headers()):f(e,t.items()),e.includeArchived&&t.hasArchivedChildren()&&f(e,t.archivedItems(!0))},T.getLastVisibleItem=function(e){for(var t=e.items(),r=t.length-1;r>=0;r--)if(!T.vmSearchPhone.hiddenItems[t[r].id]){var n=T.getLastVisibleItem(t[r]);return n?n:t[r]}return void 0},T.invertObject=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t},T.fieldMapOut=T.invertObject(T.fieldMapIn),T.translateFieldIn=function(e){try{T.PAssert(841,T.fieldMapIn[e],"Incoming field should be added to the field map",e)}catch(t){w.reportError(t)}try{T.PAssert(842,"string"==typeof e,"Should only pass strings to the field mapping function",e)}catch(t){w.reportError(t)}return T.fieldMapIn[e]||e},T.translateFieldOut=function(e){try{T.PAssert(843,T.fieldMapOut[e],"Incoming field should be added to the field map",e)}catch(t){w.reportError(t)}try{T.PAssert(844,"string"==typeof e,"Should only pass strings to the field mapping function",e)}catch(t){w.reportError(t)}return T.fieldMapOut[e]||e},T.translateObjIn=function(e){return g(e,T.fieldMapIn)},T.translateObjOut=function(e){return g(e,T.fieldMapOut)};var et={};T.addCustomEventListener=function(e,t,r){if(void 0!==r){var n=et[e],i={fn:t,pri:r};n?et[e].insertSorted(i,function(e,t){return t>e?1:-1}):(et[e]=[i],window.addEventListener(e,function(t){for(var r=0;r<et[e].length;++r){var n=et[e][r],i=n.fn(t);if(i===!1)break}}))}else window.addEventListener(e,t)},T.removeCustomEventListener=function(e,t,r){if(r){for(var n=et[e],i=!1,o=0;o<n.length;++o)if(n[o].fn===t){i=!0,n.removeAt(o);break}try{T.PAssert(845,i,"Event listener should always be found when removing")}catch(a){w.reportError(a)}}else window.removeEventListener(e,t)},T.fireCustomEvent=function(e,t,r){if(document.createEvent){var n=document.createEvent("Event");return t&&(n.data=t),n.initEvent(e,!0,!0),(r||window).dispatchEvent(n)}try{T.PAssert(846,!1,"Unable to fire custom event")}catch(i){w.reportError(i)}},T.fireKeyEvent=function(e,t){v(e,"keydown",t),v(e,"keypress",t),v(e,"keyup",t)},T.fireClickEvent=function(e,t){y(e,"mousedown",t),y(e,"mouseup",t),y(e,"mouseclick",t)},T.clone=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},T.alias=function(){for(var e=Array.prototype.slice.call(arguments),t=e[0],r=1;r<e.length;r++){var n=e[r];t[n]=t["_"+n]}},T.extend=function(e,t){try{T.PAssert(851,e&&t,"Invalid call to extend")}catch(r){w.reportError(r)}if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},T.loadXML=function(e){try{if("undefined"!=typeof window.DOMParser)return(new window.DOMParser).parseFromString(e,"text/xml");if("undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}try{T.PAssert(852,!1,"No XML parser found")}catch(r){w.reportError(r)}return void 0}catch(n){return void T.reportError(n)}},T.adjustOriginToBeInsideBounds=function(e,t,r,n,i,o){var a={x:t.left,y:t.top};return r=r||0,n=n||0,i=i||0,o=o||0,t.bottom+o>e.bottom&&(a.y=Math.max(n,t.top-(t.bottom+o-e.bottom))),t.top-o<e.top&&(a.y=Math.max(n,t.top)),t.right+i>e.right&&(a.x=Math.max(r,t.left-(t.right+i-e.right))),a},T.setOrigin=function(e,t,r){var n=e.left-t,i=e.top-r;e.left-=n,e.right-=n,e.top-=i,e.bottom-=i},T.copyStyles=function(e,t,r){try{T.PAssert(853,e,"Must have a valid source element")}catch(n){w.reportError(n)}try{T.PAssert(854,t,"Must have a valid dest element")}catch(n){w.reportError(n)}try{T.PAssert(855,r,"Must have a valid list of styles to copy")}catch(n){w.reportError(n)}var i=window.getComputedStyle(e);if(i){for(var o=[],a=0;a<r.length;++a)o[a]=i[r[a]];for(var a=0;a<o.length;++a)t.style[r[a]]=o[a]}},T.hasClass=function(e,t){try{T.PAssert(856,e,"Must pass in a valid element")}catch(r){w.reportError(r)}return e&&e.classList?e.classList.contains(t):void 0},T.removeClass=function(e,t){try{T.PAssert(857,e,"Must pass in a valid element")}catch(r){w.reportError(r)}e&&e.classList&&e.classList.remove(t)},T.addClass=function(e,t){try{T.PAssert(858,e,"Must pass in a valid element")}catch(r){w.reportError(r)}e&&e.classList&&e.classList.add(t)},T.toggleClass=function(e,t){try{T.PAssert(859,e,"Must pass in a valid element")}catch(r){w.reportError(r)}e&&e.classList&&e.classList.toggle(t)},T.css=function(e,t){try{T.PAssert(860,e,"Must pass in a valid element")}catch(r){w.reportError(r)}if(e)for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];"number"==typeof i&&(i+="px"),e.style[n]=i}},T.findChild=function(e,t){try{T.PAssert(861,e,"Must pass in a valid element")}catch(r){w.reportError(r)}if(e)for(var n=0;n<e.childElementCount;++n)if(T.hasClass(e.children[n],t))return e.children[n];return void 0},T.findParent=function(e,t,r){try{T.PAssert(862,e,"Must pass in a valid element")}catch(n){w.reportError(n)}if(r||(r=1e4),e){var i=e;try{T.PAssert(863,i,"Must have a valid parent element")}catch(n){w.reportError(n)}for(var o=0;r>o&&i;++o,i=i.parentNode)if(T.hasClass(i,t))return i}return void 0},T.isAncestor=function(e,t){try{T.PAssert(864,e,"Must have a valid element")}catch(r){w.reportError(r)}try{T.PAssert(865,t,"Must have a valid candidate")}catch(r){w.reportError(r)}for(;e&&e!==t;)e=e.parentNode;return!!e},T.firstChildTag=function(e,t){try{T.PAssert(866,e,"Must pass in a valid element")}catch(r){w.reportError(r)}try{T.PAssert(867,t,"Must pass in a valid tag to check")}catch(r){w.reportError(r)}if(e)for(var n=t.toUpperCase(),i=0;i<e.childElementCount;++i)if(e.children[i].tagName===n)return e.children[i];return void 0},T.insertAfter=function(e,t){try{T.PAssert(869,e,"Must pass in a valid element")}catch(r){w.reportError(r)}try{T.PAssert(870,t,"Must pass in a valid element")}catch(r){w.reportError(r)}e.parentNode.insertBefore(t,e.nextSibling)},T.prependChild=function(e,t){try{T.PAssert(871,e,"Must pass in a valid element")}catch(r){w.reportError(r)}try{T.PAssert(872,t,"Must pass in a valid element")}catch(r){w.reportError(r)}e.insertBefore(t,e.firstChild)},T.offset=function(e){try{T.PAssert(873,e,"Must pass in a valid element")}catch(t){w.reportError(t)}var r=e.getBoundingClientRect(),n=e.ownerDocument,i=e.ownerDocument.documentElement,o=n.defaultView,a={top:r.top+o.pageYOffset-i.clientTop,left:r.left+o.pageXOffset-i.clientLeft};return a},T.height=function(e){try{T.PAssert(875,e,"Must pass in a valid element")}catch(t){w.reportError(t)}var r=e.offsetHeight,n=window.getComputedStyle(e);return n?("border-box"!==e.style.boxSizing&&(r-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom)),r-=parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::height"),r},T.width=function(e){try{T.PAssert(877,e,"Must pass in a valid element")}catch(t){w.reportError(t)}var r=e.offsetWidth,n=window.getComputedStyle(e);return n?("border-box"!==n.boxSizing&&(r-=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)),r-=parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::width"),r};var tt=void 0;return T.runOnLoad=function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e):(tt||(tt=[],document.addEventListener("DOMContentLoaded",b,!1),window.addEventListener("load",b,!1)),tt[tt.length]=e)},T.XHR=function(e){var t=e.url,r=e.type,n=e.cb,i=e.data,o=e.headers,a=e.username,s=e.password,c=new XMLHttpRequest;if(c.onreadystatechange=function(){4===c.readyState&&n(c)},a&&s?c.open(r.toUpperCase(),t,!0,a,s):c.open(r.toUpperCase(),t,!0),o)for(var d in o)c.setRequestHeader(d,o[d]);if(i){c.setRequestHeader("Accept","*/*"),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var l=S(i);c.send(l)}else c.send()},T.element=function(e,t){try{T.PAssert(880,e,"Tried to get an element without an id")}catch(r){w.reportError(r)}(!T.elements[e]||t)&&(T.elements[e]=document.getElementById(e));try{T.PAssert(881,T.elements[e],"Tried to get an element that doesn't exist",e)}catch(r){w.reportError(r)}return T.elements[e]},T.waitingList={},T._waitForElement=function(e,t){var r=document.getElementById(e);return r?(t(r),delete T.waitingList[e],r):void setTimeout(T._waitForElement,100,e,t)},T.waitForElement=function(e,t){var r=T._waitForElement(e,t);r||(T.waitingList[e]=t)},T.getElementByClassName=function(e,t){if(!t)return document.getElementsByClassName(e)[0];for(var r=t.children.length,n=0;r>n;n++)if(t.children[n].className.indexOf(e)>=0)return t.children[n]},T.getElementsByClassName=function(e,t){if(t){for(var r=[],n=t.children.length,i=0;n>i;i++)t.children[i].className.indexOf(e)>=0&&r.push(t.children[i]);return r}return document.getElementsByClassName(e)},T.isDateSoft=function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"NOW":return!0}return!1},T.handlerPreventStop=function(e){e.preventDefault(),e.stopImmediatePropagation()},T.fFalse=function(){return!1},T.emptyFn=function(){},r.hasURLParam("nolocal","true")&&(T.noLocalWrites=!0),T.settings.init(),T.eventStream=T.createRingBuffer(100),T}),define("gdata",["ko","globals","data","platform"],function(e,t,r,n){function i(e){function n(e){if(e)for(var n=0;n<e.length;++n){var o=e.get(n),a=v.get(o,"text");if(a.indexOf("@")>=0)for(var s=a.split(" "),c=0,n=0;n<s.length;++n){if(0===s[n].indexOf("@")){for(var d=void 0,l=s[n].substring(1),u=1;4>u;u++){var h=-1!==l.indexOf(":",l.length-1)?l.substr(0,l.length-1):l;if(r.contactsByName[h]&&(d=h),n+u<s.length){if(!(n+u<s.length))break;l+=" "+s[n+u]}}if(d){try{t.PAssert(899,"@"==a[c],"Explicitly matching @, should always match")}catch(m){t.reportError(m)}var f=a.substr(0,c)+"+"+a.substr(c+1);v.set(o,"text",f),p(o)}}c+=s[n].length+1}i(o)}}function i(e){var t=v.get(e,"items");t&&n(t);var r=v.get(e,"archivedItems");r&&n(r)}v.beginWriteAction();try{t.PAssert(898,e,"Must have a valid root item to migrate")}catch(o){t.reportError(o)}if(0===r.contacts.length)return void log("Skipping remote data migration four");var a=e.get("root");i(a)}function o(e){function r(e){if(e)for(var t=0;t<e.length;++t){var r=e.get(t),i=v.get(r,"text");i.startsWith("!")?(v.set(r,"priority",VMLIFlag.P0),v.set(r,"text",i.substr(1)),p(r)):i.startsWith("*")?(v.set(r,"isFlagged",!0),v.set(r,"text",i.substr(1)),p(r)):i.startsWith("^")&&(v.set(r,"isComplete",!0),v.set(r,"text",i.substr(1)),p(r)),n(r)}}function n(e){var t=v.get(e,"items");t&&r(t);var n=v.get(e,"archivedItems");n&&r(n)}v.beginWriteAction();try{t.PAssert(900,e,"Must have a valid root item to migrate")}catch(i){t.reportError(i)}var o=e.get("root");n(o)}function a(e){function r(e){if(e)for(var r=0;r<e.length;++r){var i=e.get(r);
try{t.PAssert(902,i,"Remote item must exist")}catch(o){t.reportError(o)}try{t.PAssert(903,!t.isString(i),"New items must be collab maps not strings")}catch(o){t.reportError(o)}n(i)}}function n(e){var n=v.get(e,"text");t.isString(n)||(v.set(e,"text",n.getText()),log("Updated Text: ",v.get(e,"text")));var i=v.get(e,"items");i&&r(i);var o=v.get(e,"archivedItems");o&&r(o)}v.beginWriteAction();try{t.PAssert(901,e,"Must have a valid root item to migrate")}catch(i){t.reportError(i)}var o=e.get("root");n(o)}function s(e){function r(e){var r=[];if(e)for(var i=0;i<e.length;++i){var o=e.get(i);try{t.PAssert(905,t.isString(o),"Must be a valid ID string")}catch(s){t.reportError(s)}var c=a.get(o);try{t.PAssert(906,c,"Remote item must exist in DB")}catch(s){t.reportError(s)}try{t.PAssert(907,!t.isString(c),"New items must be collab maps not strings")}catch(s){t.reportError(s)}r.push(c),n(c)}return r}function n(e){var n=v.get(e,"items");if(n){var i=r(n);try{t.PAssert(908,i.length===n.length,"New item list must be the same length as the old one")}catch(o){t.reportError(o)}i.length>0&&n.replaceRange(0,i)}var a=v.get(e,"archivedItems");if(a){var s=r(a);try{t.PAssert(909,s.length===a.length,"New item list must be the same length as the old one")}catch(o){t.reportError(o)}s.length>0&&a.replaceRange(0,s)}}v.beginWriteAction();try{t.PAssert(904,e,"Must have a valid root item to migrate")}catch(i){t.reportError(i)}var o=e.get("root"),a=e.get("items"),s=a.get(o);n(s),e.set("root",s)}function c(){try{t.PAssert(919,!v.inCompoundOperation,"Should never be in a compound operation after sync block finishes")}catch(e){t.reportError(e)}try{t.PAssert(920,!v.wantCompoundOperation,"Should never want a compound operation after a sync block finishes")}catch(e){t.reportError(e)}v.inCompoundOperation&&(v.model.endCompoundOperation(),t.reportError(new Error("Compound operation open after sync block finished"))),T=void 0}function d(e){try{t.PAssert(926,e,"Must have a valid local item to attach events to")}catch(r){t.reportError(r)}try{t.PAssert(927,e instanceof S,"Must pass in a valid instace of a local item")}catch(r){t.reportError(r)}try{t.PAssert(928,e.data,"Must have a valid remote item to attach events to")}catch(r){t.reportError(r)}e.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,e.onObjectChanged.bind(e))}function l(e){v.beginWriteAction();try{t.PAssert(950,e instanceof S)}catch(r){t.reportError(r)}try{t.PAssert(951,e.data,"Must have valid remote item to attach events to and create")}catch(r){t.reportError(r)}var n=v.get(e.data,"items");return n||(n=v.model.createList(),v.set(e.data,"items",n)),n}function u(e){v.beginWriteAction();try{t.PAssert(952,e instanceof S)}catch(r){t.reportError(r)}try{t.PAssert(953,e.data,"Must have valid remote item to attach events to and create")}catch(r){t.reportError(r)}var n=v.get(e.data,"archivedItems");return n||(n=v.model.createList(),v.set(e.data,"archivedItems",n)),n}function h(e){v.beginWriteAction();var t=v.getVersion(e,VersionType.Structure);t=t?t+1:1;v.set(e,"version",t)}function p(e){v.beginWriteAction();var t=v.getVersion(e,VersionType.Text);t=t?t+1:1;v.set(e,"versionText",t)}function m(e,n){var i=v.canSave(e);if(i){if(t.isEmpty(n))return void(ShouldLog(LogLevels.Warning)&&log("Skipped remote saving an empty object"));v.beginWriteAction(),r.addPendingUpdate(e.id);for(var o in n){try{t.PAssert(980,n.hasOwnProperty(o),"Changes should only contain properties they own")}catch(a){t.reportError(a)}if(n.hasOwnProperty(o))switch(o){case"text":try{t.PAssert(981,t.isString(n.text))}catch(a){t.reportError(a)}v.set(i,"text",n.text);break;case"date":try{t.PAssert(982,!n.date||"number"==typeof n.date)}catch(a){t.reportError(a)}v.set(i,"date",n.date);break;case"dateCreated":try{t.PAssert(983,"number"==typeof n.dateCreated)}catch(a){t.reportError(a)}v.set(i,"dateCreated",n.dateCreated);break;case"dateCompleted":try{t.PAssert(984,!n.dateCompleted||"number"==typeof n.dateCompleted)}catch(a){t.reportError(a)}v.set(i,"dateCompleted",n.dateCompleted);break;case"allDayDate":case"priority":case"isComplete":case"isFlagged":v.set(i,o,n[o]);break;case"isCollapsed":case"isArchived":try{t.PAssert(985,!1,"These properties are not set this way")}catch(a){t.reportError(a)}v.set(i,o,n[o]);break;case"modifiedOfflineText":case"dateText":break;default:try{t.PAssert(986,!1,"Attempting to remotely save an unknown field: ",o)}catch(a){t.reportError(a)}}}p(i)}}function f(){log("Try Reconnect: ",A,P),P=void 0,t.goog.reconnectToActiveDocument()}function g(e){for(var r=!1,n=0;n<e.events.length;++n){var i=e.events[n];i.isLocal||(i.property.startsWith(t.settings.prefix)||(r=!0),v.settingsLocal[i.property]=i.newValue,t.fireCustomEvent("settingsChange_"+i.property,i.newValue))}r&&v.onRemoteSettingsLoad()}var v={isClosed:!0,isInitialized:!0,wantCompoundOperation:!1,inCompoundOperation:!1,flushingDeferredActions:!1,authenticatedUser:e.observable()},y=5,b={};v.cacheItem=function(e){try{t.PAssert(882,void 0===b[e.id]||b[e.id]===e,"Should not be caching different items with the same ID")}catch(r){t.reportError(r)}b[e.id]=e},v.getState=function(e){try{var t={};if(v.doc)try{var r=v.doc.getModel();t.isReadOnly=r.isReadOnly,t.serverVersion=r.serverVersion,t.size=r.bytesUsed}catch(n){e.docAccessError=!0}t.lastPending=O,t.lastSaving=L,t.isClosed=v.isClosed,t.initialized=v.initialized,e.gState=t}catch(i){log("Error getting information in gdata::getState()"+i.message)}};var r,S;v.checkRemoteIntegrity=function(){function e(e,t){if(e)for(var r=0;r<e.length;++r){var o=e.get(r).id;o||(log(o,": Child does not have a valid reference in our remote database"),n=!0),i[o]?i[o].ref?(log(o,": Item is referenced remotely multiple times: ",v.get(e.get(r),"text")),log("   ",i[o].ref,": ",v.get(b[i[o].ref],"text")),log("   ",s.id,": ",v.get(s,"text")),n=!0,v.beginWriteAction(),e.remove(r)):i[o].ref=s.id:i[o]={exist:!1,arch:t,ref:s.id}}}v.beginAction();var n=!1,i={},o=!1;for(var a in b){var s=b[a];i[s.id]?i[s.id].exist?(log(s.id,": Duplicated IDs in the remote database",s),n=!0):i[s.id].exist=!0:i[s.id]={exist:!0,ref:!1},s.id==v.rootID&&(o&&(log(s.id,": Multiple roots present remotely",s),n=!0),o=!0,i[s.id].isRoot=!0);var c=v.get(s,"items");e(c,!1);var d=v.get(s,"archivedItems");e(d,!0)}o||(log("No root present"),localDataError=!0);for(var l in i){var u=i[l];if(!u.exist){try{t.PAssert(884,!1,"This should never happen as the database is inline with the item tree now")}catch(h){t.reportError(h)}log(l,": Item is referenced remotely as a child but does not exist in the database");var p=b[u.ref];try{t.PAssert(885,p,"Parent must exist otherwise it couldn't reference this item")}catch(h){t.reportError(h)}var m=v.getItemList(p,u.arch);try{t.PAssert(886,m,"If the item has been seen here, we will always have a valid parent list")}catch(h){t.reportError(h)}if(m){var f=m.indexOf(l);if(f>=0)v.beginWriteAction(),m.remove(f);else try{t.PAssert(887,!1,"If we previously saw this item, we expect to be able to delete it from the parent list")}catch(h){t.reportError(h)}}}u.ref||u.isRoot||(log(l,": Item exists remotely but is not referenced by a parent"),log("   : ",v.get(b[l],"text")),delete b[l]),u.isRoot&&u.ref&&(log(l,": Remote root has a parent"),localDataError=!0)}r.removeDeletedItems(i),v.endAction()},v.migrateData=function(){function e(){p++,2===p&&t.reload()}var n=!1,c=!1,d=!1,l=v.root.get("dataVersion");if(y>l){v.beginAction(),log("Migrating to latest version: ",l);try{switch(l){case 1:s(v.root);case 2:a(v.root);case 3:o(v.root),d=!0;case 4:i(v.root);default:log("Remote Migration Completed")}}catch(u){d=!0,t.reportError(u)}v.endAction(),v.model.getRoot().set("dataVersion",y),log("Done Migrating Remote Data!",y)}else l>y&&(c=!0,n=!0);if(r.hasLocalData){var h=t.settings.get(Settings.localDataVersion)||0;if(y>h){try{switch(h){case 0:r.migrateLocalData_One(),c=!0,n=!0;case 4:r.migrateLocalData_Two();default:log("Local Migration Completed")}}catch(u){c=!0,t.reportError(u)}t.settings.set(Settings.localDataVersion,y),log("Done Migrating Local Data!",y)}}else t.settings.set(Settings.localDataVersion,l);if(c||d)if(c&&!d)t.AppCache.runOnFinish(function(){t.reload()},!0);else if(d&&!c)v.registerSaveNotify(function(){t.reload()});else{var p=0;t.AppCache.runOnFinish(e,!0),v.registerSaveNotify(e)}return n},v.beginAction=function(){if(v.model){try{t.PAssert(910,!v.flushingDeferredActions,"Should never begin a new action while flushing")}catch(e){t.reportError(e)}try{t.PAssert(911,!v.inCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}try{t.PAssert(912,!v.wantCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}try{t.PAssert(913,!v.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}v.wantCompoundOperation=!0}};var T=void 0;v.beginWriteAction=function(){if(v.model&&!v.flushingDeferredActions){try{t.PAssert(914,v.inCompoundOperation||v.wantCompoundOperation,"If performing an action, we should have already requested a compound operation")}catch(e){t.reportError(e)}if(!v.inCompoundOperation&&v.wantCompoundOperation)v.flushDeferredActions(),setTimeout(c,0),v.model.beginCompoundOperation(),v.inCompoundOperation=!0,v.wantCompoundOperation=!1;else try{t.PAssert(915,!v.wantCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}}},v.endAction=function(){if(v.model){try{t.PAssert(916,!v.flushingDeferredActions,"Should never end an action while flushing")}catch(e){t.reportError(e)}try{t.PAssert(917,!v.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(918,v.inCompoundOperation||v.wantCompoundOperation,"If ending an action, a beginning should have happened")}catch(e){t.reportError(e)}try{v.inCompoundOperation&&v.model.endCompoundOperation()}catch(r){t.goog.recoverFromError(r)}finally{v.inCompoundOperation=!1,v.wantCompoundOperation=!1,clearTimeout(T)}}};var w=800,E={},M=!1,x=void 0;v.performDeferredAction=function(e,r){try{t.PAssert(921,e,"Must supply a valid item to perform the action on")}catch(n){t.reportError(n)}try{t.PAssert(922,r,"Must supply a valid action to be performed")}catch(n){t.reportError(n)}if(v.model){try{t.PAssert(923,!v.inCompoundOperation,"Cannot perform deferred action after a compound operation has started")}catch(n){t.reportError(n)}if(E[e.id])for(var i in r)E[e.id].changes[i]=r[i];else E[e.id]={item:e,changes:r};M=!0,clearTimeout(x),x=setTimeout(v.flushDeferredActions,w)}},v.flushDeferredActions=function(){if(v.model&&!v.isClosed){try{t.PAssert(924,!v.flushingDeferredActions,"Should never recursively call flushDeferredActions")}catch(e){t.reportError(e)}try{t.PAssert(925,!v.inCompoundOperation,"Must flush deferred actions before starting a compound operation")}catch(e){t.reportError(e)}if(M){clearTimeout(x),x=void 0,v.flushingDeferredActions=!0;try{v.model.beginCompoundOperation();try{for(var r in E)m(E[r].item,E[r].changes);v.flushingDeferredActions=!1,M=!1,E={}}catch(n){t.reportError(i)}v.model.endCompoundOperation()}catch(i){t.reportError(i)}}}},v.createNewItem=function(e,r,n){v.beginWriteAction();try{t.PAssert(929,e instanceof S,"Must pass in a valid instace of a local item")}catch(i){t.reportError(i)}try{t.PAssert(930,v.inCompoundOperation,"Should always create an item inside of a compound operation")}catch(i){t.reportError(i)}try{t.PAssert(931,!v.isClosed,"Document must be open to make changes")}catch(i){t.reportError(i)}try{t.PAssert(932,v.model,"Need a valid model to create collaborative items")}catch(i){t.reportError(i)}try{t.PAssert(933,!e.data,"When initializing a new item, it should have no gdata components already")}catch(i){t.reportError(i)}var o=v.model.createMap();if(e.data=o,v.set(o,"text",e.getRawText()),r){var a=v.model.createList();v.set(o,"items",a)}if(n){var s=v.model.createList();v.set(o,"archivedItems",s)}return v.set(o,"dateCreated",e.dateCreated.getTime()),e.id=o.id,b[o.id]||(b[o.id]=o),o.id},v.initializeNewItem=function(e){v.beginWriteAction();try{t.PAssert(934,e instanceof S,"Must pass in a valid instace of a local item")}catch(r){t.reportError(r)}try{t.PAssert(935,!v.isClosed,"Document must be open to make changes")}catch(r){t.reportError(r)}try{t.PAssert(936,v.inCompoundOperation,"Should always initialize an item inside of a compound operation")}catch(r){t.reportError(r)}if(e.hasChildren()){var n=e.items(),i=l(e);try{t.PAssert(937,i)}catch(r){t.reportError(r)}for(var o=0;o<n.length;++o){try{t.PAssert(938,n[o].data,"Item must have a valid remote to be added to a collab list")}catch(r){t.reportError(r)}i.push(n[o].data)}}if(e.hasArchivedChildren()){var a=e.archivedItems(!0),s=u(e);try{t.PAssert(939,s)}catch(r){t.reportError(r)}for(var o=0;o<a.length;++o){try{t.PAssert(940,a[o].data,"Item must have a valid remote to be added to a collab list")}catch(r){t.reportError(r)}s.push(a[o].data)}}d(e)},v.attachEventsToItem=function(e){try{t.PAssert(941,e instanceof S,"Must pass in a valid local item")}catch(r){t.reportError(r)}try{t.PAssert(942,e.data,"Must have loaded data from gdrive before attaching events to item")}catch(r){t.reportError(r)}d(e)};var C;v.registerForUndoRedoStateChange=function(e){v.model?(v.model.addEventListener(gapi.drive.realtime.EventType.UNDO_REDO_STATE_CHANGED,e.stateChangeForUndoRedo),e.stateChangeForUndoRedo({canUndo:v.model.canUndo,canRedo:v.model.canRedo})):C=e},v.registerForSaveStateChange=function(e){try{t.PAssert(943,v.doc,"Must have a valid doc to connect to")}catch(r){t.reportError(r)}v.doc.addEventListener(gapi.drive.realtime.EventType.DOCUMENT_SAVE_STATE_CHANGED,e)},v.loadCollaborators=function(){for(var e=v.doc.getCollaborators(),t=void 0,r=0;r<e.length;++r){var n=e[r];n.isMe&&(t=n)}v.authenticatedUser(t)},v.undoAction=function(){v.flushDeferredActions();try{t.PAssert(944,!v.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(945,v.model.canUndo)}catch(e){t.reportError(e)}v.model.undo()},v.redoAction=function(){v.flushDeferredActions();try{t.PAssert(946,!v.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(947,v.model.canRedo)}catch(e){t.reportError(e)}v.model.redo()},v.getItemList=function(e,r){v.beginWriteAction();try{t.PAssert(948,!(e instanceof S),"Must pass in a valid remote item")}catch(n){t.reportError(n)}return r?v.get(e,"archivedItems"):v.get(e,"items")},v.ensureItemList=function(e,r){v.beginWriteAction();try{t.PAssert(949,e instanceof S,"Must pass in a valid local item")}catch(n){t.reportError(n)}return r?u(e):l(e)},v.canSave=function(e){if(v.initialized){var r=e instanceof S?e.data:e;try{t.PAssert(954,r&&!v.isClosed,"Document must be open to make changes")}catch(n){t.reportError(n)}return r&&!v.isClosed?r:!1}},v.deleteTree=function(e){v.beginWriteAction();try{t.PAssert(955,!(e instanceof S),"Must not be a VMLI, should be a remote item")}catch(r){t.reportError(r)}try{t.PAssert(956,!t.isString(e),"Must pass in a valid remote item not an ID")}catch(r){t.reportError(r)}var n=v.get(e,"items");if(n)for(var i=0;i<n.length;i++){var o=n.get(i);v.deleteTree(o)}delete b[e.id]},v.itemAdded=function(e){v.beginWriteAction();var n=e.item,i=e.addedItem,o=e.index,a=e.isArchived,s=e.noVersion;try{t.PAssert(957,void 0!==n&&void 0!==i&&void 0!==a,"itemAdded is missing parameters")}catch(c){t.reportError(c)}try{t.PAssert(958,o>=-1||void 0===o,"Invalid index",o)}catch(c){t.reportError(c)}var d=v.canSave(n);if(d){var l=i.data;try{t.PAssert(959,l,"Must have valid gdata for the item being inserted",l)}catch(c){t.reportError(c)}r.addPendingUpdate(n.id),r.addPendingUpdate(i.id);var u=v.ensureItemList(n,a);try{t.PAssert(960,u,"Must have a valid remote list to add the item to")}catch(c){t.reportError(c)}0>o||isNaN(o)||o>u.length?u.push(l):u.insert(o,l),s||h(i.data)}},v.itemsAdded=function(e){v.beginWriteAction();var n=e.item;try{t.PAssert(961,n instanceof S,"Passed in item must be a VMLI")}catch(i){t.reportError(i)}var o=e.addedItems,a=e.index,s=e.isArchived,c=e.noVersion;try{t.PAssert(962,void 0!==n&&void 0!==o&&void 0!==s,"itemsAdded is missing parameters")}catch(i){t.reportError(i)}var d=v.canSave(n);if(d){var l=v.ensureItemList(n,s);try{t.PAssert(963,l,"Must have a valid remote list to add the item to")}catch(i){t.reportError(i)}for(var u=new Array(o.length),p=0;p<o.length;++p)u[p]=o[p].data,r.addPendingUpdate(o[p].id),!c&&u[p]&&h(u[p]);if(r.addPendingUpdate(n.id),0>a||isNaN(a)){try{t.PAssert(964,s,"Only archived items should be inserted into a list by pushing")}catch(i){t.reportError(i)}l.pushAll(u)}else l.insertAll(a,u)}},v.itemRemoved=function(e){v.beginWriteAction();var n=e.item,i=e.index,o=e.numToRemove,a=e.isArchived,s=e.noDelete,c=e.noVersion;try{t.PAssert(965,void 0!==n&&void 0!==i&&void 0!==o&&void 0!==a,"itemRemoved is missing parameters")}catch(d){t.reportError(d)}try{t.PAssert(966,i>=0,"Must have a valid index to remove from")}catch(d){t.reportError(d)}var l=v.canSave(n);if(l){isNaN(o)&&(o=1);var u=v.getItemList(l,a);try{t.PAssert(967,u,"Must have a valid remote list to remove the item from")}catch(d){t.reportError(d)}for(var p=i;i+o>p;p++){var m=u.get(p);r.addPendingUpdate(m.id),c||h(m),s||v.deleteTree(m)}r.addPendingUpdate(n.id),1===o?u.remove(i):u.removeRange(i,i+o)}},v.itemMoved=function(e){v.beginWriteAction();var n=e.item,i=e.newInfo,o=e.oldParent,a=e.oldInfo,s=e.noVersion;try{t.PAssert(968,void 0!==n&&void 0!==i&&void 0!==o&&void 0!==a,"itemMoved is missing parameters")}catch(c){t.reportError(c)}try{t.PAssert(969,i&&i.index>=-1)}catch(c){t.reportError(c)}try{t.PAssert(970,i&&void 0!==i.isArchived)}catch(c){t.reportError(c)}try{t.PAssert(971,o)}catch(c){t.reportError(c)}try{t.PAssert(972,a&&a.index>=0)}catch(c){t.reportError(c)}try{t.PAssert(973,a&&void 0!==a.isArchived)}catch(c){t.reportError(c)}var d=v.canSave(n);d&&(r.addPendingUpdate(n.id),v.itemRemoved({item:o,index:a.index,numToRemove:1,isArchived:a.isArchived,noDelete:!0,noVersion:!0}),v.itemAdded({item:n.parent(),addedItem:n,index:i.index,isArchived:i.isArchived,noVersion:s}))},v.itemArchived=function(e,n,i){try{t.PAssert(974,i>=0,"Must have a valid index to remove from")}catch(o){t.reportError(o)}v.beginWriteAction();var a=v.canSave(e);if(a){r.addPendingUpdate(e.id),r.addPendingUpdate(n.id);var s=v.get(a,"items");try{t.PAssert(975,s,"Must be an items array present")}catch(o){t.reportError(o)}var c=u(e);try{t.PAssert(976,c,"Must be an archived items array present")}catch(o){t.reportError(o)}s.remove(i),c.push(n.data),h(n.data)}},v.itemUnarchived=function(e,n,i,o){try{t.PAssert(977,i>=0,"Must have a valid index to remove from")}catch(a){t.reportError(a)}v.beginWriteAction();var s=v.canSave(e);if(s){r.addPendingUpdate(e.id),r.addPendingUpdate(n.id);var c=v.get(s,"items");try{t.PAssert(978,c,"Must be an items array present")}catch(a){t.reportError(a)}var d=v.get(s,"archivedItems");try{t.PAssert(979,d,"Must be an archived items array present")}catch(a){t.reportError(a)}d.remove(i),c.insert(o,n.data),h(n.data)}},v.saveChanges=function(e,t){v.inCompoundOperation?m(e,t):v.performDeferredAction(e,t)};var I=3e4,A=0,P=void 0;v.setupReconnect=function(){if(log("Setup Reconnect: ",A,P),!P){var e=0===A?500:I;A++,P=setTimeout(f,e)}},v.resetDriveData=function(){b={},v.initialized=!1,v.doc=void 0,v.model=void 0,v.root=void 0,v.rootItem=void 0,v.rootID=void 0,window.__remoteDoc=void 0,r.forEachModel(function(e){e.resetDriveData()}),t.vmMain.notifyDriveDisconnect(),v.inCompoundOperation=!1,v.wantCompoundOperation=!1,v.flushingDeferredActions=!1,clearTimeout(T),T=void 0,clearTimeout(x),x=void 0,M=!1,E={}},v.close=function(e){try{t.PAssert(987,!v.wantCompoundOperation,"Closing the doc with a deferred compound operation")}catch(r){t.reportError(r)}if(v.doc&&!v.isClosed){log("---- Closing Remote Document! ----",e),v.isClosed=!0,t.vmMain.setGDriveStatus(DriveStatus.Offline);try{v.doc.close()}catch(n){log("Error Closing Doc: ",n)}v.resetDriveData()}v.setupReconnect()},v.onInitialized=function(e){log("Initializing",e),r||(r=require("data")),S||(S=require("VMLI"));var t=e.createMap(),n=e.createList();v.set(t,"text","Home"),v.set(t,"items",n),v.set(t,"archivedItems",e.createList()),v.set(t,"dateCreated",Date.now());var i=e.createMap();v.set(i,"text",""),v.set(i,"dateCreated",Date.now()),n.push(i);var o=e.getRoot();o.set("dataVersion",y),o.set("root",t)},v.saveSetting=function(e){v.flushDeferredActions();try{t.PAssert(988,v.settingsRemote,"Remote settings required to sync")}catch(r){t.reportError(r)}if(!e.data.isRemote){var n=e.data.value,i=e.data.property;i.startsWith(t.settings.prefix)&&(n=Math.abs(n),t.settings.setVersion(i,n)),v.settingsLocal[i]!==n&&(v.settingsLocal[i]=n,v.settingsRemote.set(i,n))}},v.onRemoteSettingsLoad=function(){t.settings.set(Settings.syncContacts,v.settingsLocal[Settings.syncContacts],v.settingsLocal[t.settings.prefix+Settings.syncContacts])&&t.goog.authAndLoadContacts(),t.settings.set(Settings.docSharing,v.settingsLocal[Settings.docSharing],v.settingsLocal[t.settings.prefix+Settings.docSharing])&&t.goog.authDocSharing(),window.addEventListener("settingsChange",v.saveSetting)},v.loadSettings=function(){v.settingsLocal={},v.settingsRemote=v.root.get("settings"),v.settingsRemote||(v.settingsRemote=v.model.createMap(),v.root.set("settings",v.settingsRemote));try{v.settingsLocal[Settings.syncContacts]=v.settingsRemote.get(Settings.syncContacts);var e=t.settings.prefix+Settings.syncContacts;v.settingsLocal[e]=v.settingsRemote.get(e),v.settingsLocal[Settings.docSharing]=v.settingsRemote.get(Settings.docSharing);var r=t.settings.prefix+Settings.docSharing;v.settingsLocal[r]=v.settingsRemote.get(r),v.settingsLocal[Settings.theme]=v.settingsRemote.get(Settings.theme);var n=t.settings.prefix+Settings.theme;v.settingsLocal[n]=v.settingsRemote.get(n),v.settingsRemote.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,g.bind(v))}catch(i){t.reportError(i)}},v.poke=function(){if(v.root&&!v.isClosed)try{var e=v.root.get("poke");e?v.root.set("poke",e+1):v.root.set("poke",1)}catch(t){v.close()}},window.__poke=v.poke,v.rootChanged=function(e){if(e.ocHandled||e.isLocal||v.root.id!==e.target.id)return!1;for(var r=0;r<e.events.length;++r)switch(e.events[r].type){case gapi.drive.realtime.EventType.VALUES_ADDED:case gapi.drive.realtime.EventType.VALUES_REMOVED:break;case gapi.drive.realtime.EventType.VALUE_CHANGED:"dataVersion"===e.property&&(e.newValue>y?t.AppCache.checkForUpdate(!0):e.newVersion<y&&t.reportError(new Error("Remote setting dataVersion to invalid value"+e.newVersion)));break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:default:try{t.PAssert(989,!1,"Unexpected event type")}catch(n){t.reportError(n)}}},v.isConnected=function(){return v.initialized&&!v.isClosed&&!!v.model};v.onLoad=function(e){try{try{t.PAssert(990,v.isClosed,"Document must not already be open when we are loading")}catch(i){t.reportError(i)}v.initialized=!0,r||(r=require("data")),S||(S=require("VMLI")),v.doc=e,v.model=e.getModel(),v.root=v.model.getRoot(),v.root.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,v.rootChanged),v.isClosed=!1,v.registerForSaveStateChange(v.onSaveStateChange),A>0&&(log("Reconnect Successful: "+A),clearTimeout(P),P=void 0,A=0);var o=v.migrateData();return o?(log("---- Skipping Document Load! ----"),v.isClosed=!0,v.initialized=!1,v.doc=void 0,v.model=void 0,v.root=void 0,!1):(v.loadSettings(),v.rootItem=v.root.get("root"),v.rootItem?(v.rootID=v.rootItem.id,window.__remoteDoc=e,C&&(v.registerForUndoRedoStateChange(C),C=void 0),t.vmMain&&t.vmMain.root()?t.vmMain.loadGDriveData():t.requireGDriveDataCallback=!0,v.loadCollaborators(),!0):void t.messageQueue.pushMessage({text:"Document is corrupted, "+n.actionVerb()+" to reload. If the problem persists, please contact support.",type:MessageType.Fatal,action:MessageAction.ResetClient}))}catch(a){t.reportError(a)}},v.getServerVersion=function(){return v.model&&!v.isClosed?v.model.serverVersion:void 0};var D=[];v.registerSaveNotify=function(e){D.push(e)};var k,O=!1,L=!1;return v.onSaveStateChange=function(e){if(O!==e.isPending||L!==e.isSaving){if(e.isSaving||e.isPending)navigator.onLine?e.isSaving&&(e.isPending||t.vmMain.setGDriveStatus(DriveStatus.Saving),clearTimeout(k),k=n.mobile?setTimeout(v.onErrorSaving,12e3):setTimeout(v.onErrorSaving,8e3)):t.vmMain.setGDriveStatus(DriveStatus.Offline);else{t.vmMain.setGDriveStatus(DriveStatus.Saved),r.clearPendingUpdates(),clearTimeout(k),k=void 0,t.messageQueue.clearMessage(MessageID.ConnectionError);for(var i=0;i<D.length;++i)D[i]()}O=e.isPending,L=e.isSaving}},v.onErrorSaving=function(){t.vmMain.setGDriveStatus(DriveStatus.Offline),k=void 0},v.getVersion=function(e,r){try{t.PAssert(991,!(e instanceof S),"Must pass in a valid remote item")}catch(n){t.reportError(n)}var i;switch(r){case VersionType.Structure:i=e.get(t.translateFieldIn("version"));break;case VersionType.Text:i=e.get(t.translateFieldIn("versionText"));break;default:i=-2;try{t.PAssert(992,!1,"Invalid version type")}catch(n){t.reportError(n)}}return i?i:0},v.get=function(e,r){try{t.PAssert(993,!(e instanceof S),"Must pass in a valid remote item")}catch(n){t.reportError(n)}return e.get(t.translateFieldIn(r))},v.set=function(e,r,n){v.beginWriteAction();try{t.PAssert(994,!(e instanceof S),"Must pass in a valid remote item")}catch(i){t.reportError(i)}return void 0===n&&(n=null),e.set(t.translateFieldIn(r),n)},v.delete=function(e,r){v.beginWriteAction();try{t.PAssert(995,!(e instanceof S),"Must pass in a valid remote item")}catch(n){t.reportError(n)}return e.delete(t.translateFieldIn(r))},v.findInTree=function(e,t){function r(r,n){if(!r)return!1;for(var i=0;i<r.length;i++){var o=r.get(i);if(o.id==e.id)return{parent:t,index:i,isArchived:n};var a=v.findInTree(e,o);if(a)return a}return void 0}t||(t=v.rootItem);var n=v.get(t,"items"),i=r(n,!1);if(!i){var o=v.get(t,"archivedItems");i=r(o,!0)}return i},v});var idbModules={},cleanInterface=!1;!function(){var e={test:!0};if(Object.defineProperty)try{Object.defineProperty(e,"test",{enumerable:!1}),e.test&&(cleanInterface=!0)}catch(t){}}(),function(e){function t(e,t,r,n){r.target=t,"function"==typeof t[e]&&t[e].apply(t,[r]),"function"==typeof n&&n()}function r(e,t){var r=new DOMException.prototype.constructor(0,t);throw r.name=e,r.message=t,r}var n=function(){this.length=0,this._items=[],cleanInterface&&Object.defineProperty(this,"_items",{enumerable:!1})};if(n.prototype={contains:function(e){return-1!==this._items.indexOf(e)},item:function(e){return this._items[e]},indexOf:function(e){return this._items.indexOf(e)},push:function(e){this._items.push(e),this.length+=1;for(var t=0;t<this._items.length;t++)this[t]=this._items[t]},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length;for(var e in this)e===String(parseInt(e,10))&&delete this[e];for(e=0;e<this._items.length;e++)this[e]=this._items[e]}},cleanInterface)for(var i in{indexOf:!1,push:!1,splice:!1})Object.defineProperty(n.prototype,i,{enumerable:!1});e.util={throwDOMException:r,callback:t,quote:function(e){return"'"+e+"'"},StringList:n}}(idbModules),function(idbModules){var Sca=function(){return{decycle:function(object,callback){function checkForCompletion(){0===queuedObjects.length&&returnCallback(derezObj)}function readBlobAsDataURL(e,t){var r=new FileReader;r.onloadend=function(e){var r=e.target.result,n="blob";updateEncodedBlob(r,t,n)},r.readAsDataURL(e)}function updateEncodedBlob(dataURL,path,blobtype){var encoded=queuedObjects.indexOf(path);path=path.replace("$","derezObj"),eval(path+'.$enc="'+dataURL+'"'),eval(path+'.$type="'+blobtype+'"'),queuedObjects.splice(encoded,1),checkForCompletion()}function derez(e,t){var r,n,i;if(!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof Blob||e instanceof String)){for(r=0;r<objects.length;r+=1)if(objects[r]===e)return{$ref:paths[r]};if(objects.push(e),paths.push(t),"[object Array]"===Object.prototype.toString.apply(e))for(i=[],r=0;r<e.length;r+=1)i[r]=derez(e[r],t+"["+r+"]");else{i={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=derez(e[n],t+"["+JSON.stringify(n)+"]"))}return i}return e instanceof Blob?(queuedObjects.push(t),readBlobAsDataURL(e,t)):e instanceof Boolean?e={$type:"bool",$enc:e.toString()}:e instanceof Date?e={$type:"date",$enc:e.getTime()}:e instanceof Number?e={$type:"num",$enc:e.toString()}:e instanceof RegExp&&(e={$type:"regex",$enc:e.toString()}),e}var objects=[],paths=[],queuedObjects=[],returnCallback=callback,derezObj=derez(object,"$");checkForCompletion()},retrocycle:function retrocycle($){function dataURLToBlob(e){var t,r,n,i=";base64,";if(-1===e.indexOf(i))return r=e.split(","),t=r[0].split(":")[1],n=r[1],new Blob([n],{type:t});r=e.split(i),t=r[0].split(":")[1],n=window.atob(r[1]);for(var o=n.length,a=new Uint8Array(o),s=0;o>s;++s)a[s]=n.charCodeAt(s);return new Blob([a.buffer],{type:t})}function rez(value){var i,item,name,path;if(value&&"object"==typeof value)if("[object Array]"===Object.prototype.toString.apply(value))for(i=0;i<value.length;i+=1)item=value[i],item&&"object"==typeof item&&(path=item.$ref,value[i]="string"==typeof path&&px.test(path)?eval(path):rez(item));else if(void 0!==value.$type)switch(value.$type){case"blob":case"file":value=dataURLToBlob(value.$enc);break;case"bool":value=Boolean("true"===value.$enc);break;case"date":value=new Date(value.$enc);break;case"num":value=Number(value.$enc);break;case"regex":value=eval(value.$enc)}else for(name in value)"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,value[name]="string"==typeof path&&px.test(path)?eval(path):rez(item)));return value}var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return rez($),$},encode:function(e,t){function r(e){t(JSON.stringify(e))}this.decycle(e,r)},decode:function(e){return this.retrocycle(JSON.parse(e))}}}();idbModules.Sca=Sca}(idbModules),function(e){var t=["","number","string","boolean","object","undefined"],r=function(){return{encode:function(e){return t.indexOf(typeof e)+"-"+JSON.stringify(e)},decode:function(e){return"undefined"==typeof e?void 0:JSON.parse(e.substring(2))}}},n={number:r("number"),"boolean":r(),object:r(),string:{encode:function(e){return t.indexOf("string")+"-"+e},decode:function(e){return""+e.substring(2)}},undefined:{encode:function(){return t.indexOf("undefined")+"-undefined"},decode:function(){return void 0}}},i=function(){return{encode:function(e){return n[typeof e].encode(e)},decode:function(e){return n[t[e.substring(0,1)]].decode(e)}}}();e.Key=i}(idbModules),function(e){var t=function(e,t){return{type:e,debug:t,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}};e.Event=t}(idbModules),function(e){var t=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"},r=function(){this.onblocked=this.onupgradeneeded=null};r.prototype=t,e.IDBRequest=t,e.IDBOpenRequest=r}(idbModules),function(e,t){var r=function(e,t,r,n){this.lower=e,this.upper=t,this.lowerOpen=r,this.upperOpen=n};r.only=function(e){return new r(e,e,!1,!1)},r.lowerBound=function(e,n){return new r(e,t,n,t)},r.upperBound=function(e){return new r(t,e,t,open)},r.bound=function(e,t,n,i){return new r(e,t,n,i)},e.IDBKeyRange=r}(idbModules),function(e,t){function r(r,n,i,o,a,s){this.__range=r,this.source=this.__idbObjectStore=i,this.__req=o,this.key=t,this.direction=n,this.__keyColumnName=a,this.__valueColumnName=s,this.__valueDecoder="value"===s?e.Sca:e.Key,this.source.transaction.__active||e.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active."),this.__offset=-1,this.__lastKeyContinued=t,this["continue"]()}r.prototype.__find=function(r,n,i,o,a){a=a||1;var s=this,c=["SELECT * FROM ",e.util.quote(s.__idbObjectStore.name)],d=[];c.push("WHERE ",s.__keyColumnName," NOT NULL"),s.__range&&(s.__range.lower||s.__range.upper)&&(c.push("AND"),s.__range.lower&&(c.push(s.__keyColumnName+(s.__range.lowerOpen?" >":" >= ")+" ?"),d.push(e.Key.encode(s.__range.lower))),s.__range.lower&&s.__range.upper&&c.push("AND"),s.__range.upper&&(c.push(s.__keyColumnName+(s.__range.upperOpen?" < ":" <= ")+" ?"),d.push(e.Key.encode(s.__range.upper)))),"undefined"!=typeof r&&(s.__lastKeyContinued=r,s.__offset=0),s.__lastKeyContinued!==t&&(c.push("AND "+s.__keyColumnName+" >= ?"),d.push(e.Key.encode(s.__lastKeyContinued))),c.push("ORDER BY ",s.__keyColumnName),c.push("LIMIT "+a+" OFFSET "+s.__offset),s.__prefetchedData=null,n.executeSql(c.join(" "),d,function(e,r){r.rows.length>1?(s.__prefetchedData=r.rows,s.__prefetchedIndex=0,s.__decode(r.rows.item(0),i)):1===r.rows.length?s.__decode(r.rows.item(0),i):i(t,t)
},function(e,t){o(t)})},r.prototype.__decode=function(t,r){var n=e.Key.decode(t[this.__keyColumnName]),i=this.__valueDecoder.decode(t[this.__valueColumnName]),o=e.Key.decode(t.key);r(n,i,o)},r.prototype["continue"]=function(r){var n=e.cursorPreloadPackSize||1e4,i=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,o,a,s){i.__offset++;var c=function(e,r,n){i.key=e,i.value=r,i.primaryKey=n,a("undefined"!=typeof i.key?i:t,i.__req)};return i.__prefetchedData&&(i.__prefetchedIndex++,i.__prefetchedIndex<i.__prefetchedData.length)?void i.__decode(i.__prefetchedData.item(i.__prefetchedIndex),c):void i.__find(r,e,c,s,n)})},r.prototype.advance=function(r){0>=r&&e.util.throwDOMException("Type Error - Count is invalid - 0 or negative",r);var n=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,i,o,a){n.__offset+=r,n.__find(t,e,function(e,r){n.key=e,n.value=r,o("undefined"!=typeof n.key?n:t,n.__req)},a)})},r.prototype.update=function(r){var n=this,i=this.__idbObjectStore.transaction.__createRequest(function(){});return e.Sca.encode(r,function(r){n.__idbObjectStore.transaction.__pushToQueue(i,function(i,o,a,s){n.__find(t,i,function(t,o,c){var d="UPDATE "+e.util.quote(n.__idbObjectStore.name)+" SET value = ? WHERE key = ?";i.executeSql(d,[r,e.Key.encode(c)],function(e,r){1===r.rowsAffected?a(t):s("No rows with key found"+t)},function(e,t){s(t)})},s)})}),i},r.prototype["delete"]=function(){var r=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(n,i,o,a){r.__find(t,n,function(i,s,c){var d="DELETE FROM  "+e.util.quote(r.__idbObjectStore.name)+" WHERE key = ?";n.executeSql(d,[e.Key.encode(c)],function(e,n){1===n.rowsAffected?(r.__offset--,o(t)):a("No rows with key found"+i)},function(e,t){a(t)})},a)})},e.IDBCursor=r}(idbModules),function(idbModules,undefined){function IDBIndex(e,t){this.indexName=this.name=e,this.__idbObjectStore=this.objectStore=this.source=t;var r=t.__storeProps&&t.__storeProps.indexList;r&&(r=JSON.parse(r)),this.keyPath=r&&r[e]&&r[e].keyPath||e,["multiEntry","unique"].forEach(function(t){this[t]=!!(r&&r[e]&&r[e].optionalParams&&r[e].optionalParams[t])},this)}IDBIndex.prototype.__createIndex=function(indexName,keyPath,optionalParameters){var me=this,transaction=me.__idbObjectStore.transaction;transaction.__addToTransactionQueue(function(tx,args,success,failure){me.__idbObjectStore.__getStoreProps(tx,function(){function error(){idbModules.util.throwDOMException(0,"Could not create new index",arguments)}2!==transaction.mode&&idbModules.util.throwDOMException(0,"Invalid State error, not a version transaction",me.transaction);var idxList=JSON.parse(me.__idbObjectStore.__storeProps.indexList);"undefined"!=typeof idxList[indexName]&&idbModules.util.throwDOMException(0,"Index already exists on store",idxList);var columnName=indexName;idxList[indexName]={columnName:columnName,keyPath:keyPath,optionalParams:optionalParameters},me.__idbObjectStore.__storeProps.indexList=JSON.stringify(idxList);var sql=["ALTER TABLE",idbModules.util.quote(me.__idbObjectStore.name),"ADD",columnName,"BLOB"].join(" ");tx.executeSql(sql,[],function(tx,data){tx.executeSql("SELECT * FROM "+idbModules.util.quote(me.__idbObjectStore.name),[],function(tx,data){!function initIndexForRow(i){if(i<data.rows.length)try{var value=idbModules.Sca.decode(data.rows.item(i).value),indexKey=eval("value['"+keyPath+"']");tx.executeSql("UPDATE "+idbModules.util.quote(me.__idbObjectStore.name)+" set "+columnName+" = ? where key = ?",[idbModules.Key.encode(indexKey),data.rows.item(i).key],function(){initIndexForRow(i+1)},error)}catch(e){initIndexForRow(i+1)}else tx.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[me.__idbObjectStore.__storeProps.indexList,me.__idbObjectStore.name],function(){me.__idbObjectStore.__setReadyState("createIndex",!0),success(me)},error)}(0)},error)},error)},"createObjectStore")})},IDBIndex.prototype.openCursor=function(e,t){{var r=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this.source,r,this.indexName,"value")}return r},IDBIndex.prototype.openKeyCursor=function(e,t){{var r=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this.source,r,this.indexName,"key")}return r},IDBIndex.prototype.__fetchIndexData=function(e,t){var r=this;return r.__idbObjectStore.transaction.__addToTransactionQueue(function(n,i,o,a){var s=["SELECT * FROM ",idbModules.util.quote(r.__idbObjectStore.name)," WHERE",r.indexName,"NOT NULL"],c=[];"undefined"!=typeof e&&(s.push("AND",r.indexName," = ?"),c.push(idbModules.Key.encode(e))),n.executeSql(s.join(" "),c,function(e,r){var n;n="count"===t?r.rows.length:0===r.rows.length?undefined:"key"===t?idbModules.Key.decode(r.rows.item(0).key):idbModules.Sca.decode(r.rows.item(0).value),o(n)},a)})},IDBIndex.prototype.get=function(e){return this.__fetchIndexData(e,"value")},IDBIndex.prototype.getKey=function(e){return this.__fetchIndexData(e,"key")},IDBIndex.prototype.count=function(e){return this.__fetchIndexData(e,"count")},idbModules.IDBIndex=IDBIndex}(idbModules),function(idbModules){var IDBObjectStore=function(e,t,r){this.name=e,this.transaction=t,this.__ready={},this.__setReadyState("createObjectStore","undefined"==typeof r?!0:r),this.indexNames=new idbModules.util.StringList};IDBObjectStore.prototype.__setReadyState=function(e,t){this.__ready[e]=t},IDBObjectStore.prototype.__waitForReady=function(e,t){var r=!0;if("undefined"!=typeof t)r="undefined"==typeof this.__ready[t]?!0:this.__ready[t];else for(var n in this.__ready)this.__ready[n]||(r=!1);if(r)e();else{var i=this;window.setTimeout(function(){i.__waitForReady(e,t)},100)}},IDBObjectStore.prototype.__getStoreProps=function(e,t,r){var n=this;this.__waitForReady(function(){n.__storeProps?t(n.__storeProps):e.executeSql("SELECT * FROM __sys__ where name = ?",[n.name],function(e,r){1!==r.rows.length?t():(n.__storeProps={name:r.rows.item(0).name,indexList:r.rows.item(0).indexList,autoInc:r.rows.item(0).autoInc,keyPath:r.rows.item(0).keyPath},t(n.__storeProps))},function(){t()})},r)},IDBObjectStore.prototype.__deriveKey=function(tx,value,key,callback){function getNextAutoIncKey(){tx.executeSql("SELECT * FROM sqlite_sequence where name like ?",[me.name],function(e,t){callback(1!==t.rows.length?0:t.rows.item(0).seq)},function(e,t){idbModules.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",t)})}var me=this;me.__getStoreProps(tx,function(props){if(props||idbModules.util.throwDOMException(0,"Data Error - Could not locate defination for this table",props),props.keyPath)if("undefined"!=typeof key&&idbModules.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",props),value)try{var primaryKey=eval("value['"+props.keyPath+"']");primaryKey?callback(primaryKey):"true"===props.autoInc?getNextAutoIncKey():idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(e){idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",e)}else idbModules.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not");else"undefined"!=typeof key?callback(key):"false"===props.autoInc?idbModules.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",props):getNextAutoIncKey()})},IDBObjectStore.prototype.__insertData=function(tx,encoded,value,primaryKey,success,error){var paramMap={};"undefined"!=typeof primaryKey&&(paramMap.key=idbModules.Key.encode(primaryKey));var indexes=JSON.parse(this.__storeProps.indexList);for(var key in indexes)try{paramMap[indexes[key].columnName]=idbModules.Key.encode(eval("value['"+indexes[key].keyPath+"']"))}catch(e){error(e)}var sqlStart=["INSERT INTO ",idbModules.util.quote(this.name),"("],sqlEnd=[" VALUES ("],sqlValues=[];for(key in paramMap)sqlStart.push(key+","),sqlEnd.push("?,"),sqlValues.push(paramMap[key]);sqlStart.push("value )"),sqlEnd.push("?)"),sqlValues.push(encoded);var sql=sqlStart.join(" ")+sqlEnd.join(" ");tx.executeSql(sql,sqlValues,function(){success(primaryKey)},function(e,t){error(t)})},IDBObjectStore.prototype.add=function(e,t){var r=this,n=r.transaction.__createRequest(function(){});return idbModules.Sca.encode(e,function(i){r.transaction.__pushToQueue(n,function(n,o,a,s){r.__deriveKey(n,e,t,function(t){r.__insertData(n,i,e,t,a,s)})})}),n},IDBObjectStore.prototype.put=function(e,t){var r=this,n=r.transaction.__createRequest(function(){});return idbModules.Sca.encode(e,function(i){r.transaction.__pushToQueue(n,function(n,o,a,s){r.__deriveKey(n,e,t,function(t){var o="DELETE FROM "+idbModules.util.quote(r.name)+" where key = ?";n.executeSql(o,[idbModules.Key.encode(t)],function(n){r.__insertData(n,i,e,t,a,s)},function(e,t){s(t)})})})}),n},IDBObjectStore.prototype.get=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(r,n,i,o){t.__waitForReady(function(){var n=idbModules.Key.encode(e);r.executeSql("SELECT * FROM "+idbModules.util.quote(t.name)+" where key = ?",[n],function(e,t){try{if(0===t.rows.length)return i();i(idbModules.Sca.decode(t.rows.item(0).value))}catch(r){i(void 0)}},function(e,t){o(t)})})})},IDBObjectStore.prototype["delete"]=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(r,n,i,o){t.__waitForReady(function(){var n=idbModules.Key.encode(e);r.executeSql("DELETE FROM "+idbModules.util.quote(t.name)+" where key = ?",[n],function(){i()},function(e,t){o(t)})})})},IDBObjectStore.prototype.clear=function(){var e=this;return e.transaction.__addToTransactionQueue(function(t,r,n,i){e.__waitForReady(function(){t.executeSql("DELETE FROM "+idbModules.util.quote(e.name),[],function(){n()},function(e,t){i(t)})})})},IDBObjectStore.prototype.count=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(r,n,i,o){t.__waitForReady(function(){var n="SELECT * FROM "+idbModules.util.quote(t.name)+("undefined"!=typeof e?" WHERE key = ?":""),a=[];"undefined"!=typeof e&&a.push(idbModules.Key.encode(e)),r.executeSql(n,a,function(e,t){i(t.rows.length)},function(e,t){o(t)})})})},IDBObjectStore.prototype.openCursor=function(e,t){{var r=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this,r,"key","value")}return r},IDBObjectStore.prototype.index=function(e){var t=new idbModules.IDBIndex(e,this);return t},IDBObjectStore.prototype.createIndex=function(e,t,r){var n=this;r=r||{},n.__setReadyState("createIndex",!1);var i=new idbModules.IDBIndex(e,n);return n.__waitForReady(function(){i.__createIndex(e,t,r)},"createObjectStore"),n.indexNames.push(e),i},IDBObjectStore.prototype.deleteIndex=function(e){var t=new idbModules.IDBIndex(e,this,!1);return t.__deleteIndex(e),t},idbModules.IDBObjectStore=IDBObjectStore}(idbModules),function(e){var t=0,r=1,n=2,i=function(n,i,o){if("number"==typeof i)this.mode=i;else if("string"==typeof i)switch(i){case"readwrite":this.mode=r;break;case"readonly":this.mode=t;break;default:this.mode=t}this.storeNames="string"==typeof n?[n]:n;for(var a=0;a<this.storeNames.length;a++)o.objectStoreNames.contains(this.storeNames[a])||e.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",this.storeNames[a]);this.__active=!0,this.__running=!1,this.__requests=[],this.__aborted=!1,this.db=o,this.error=null,this.onabort=this.onerror=this.oncomplete=null};i.prototype.__executeRequests=function(){if(!this.__running||this.mode===n){this.__running=!0;var t=this;window.setTimeout(function(){2===t.mode||t.__active||e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",t.__active),t.db.__db.transaction(function(r){function n(t,r){r&&(a.req=r),a.req.readyState="done",a.req.result=t,delete a.req.error;var n=e.Event("success");e.util.callback("onsuccess",a.req,n),s++,o()}function i(){a.req.readyState="done",a.req.error="DOMError";var t=e.Event("error",arguments);e.util.callback("onerror",a.req,t),s++,o()}function o(){return s>=t.__requests.length?(t.__active=!1,void(t.__requests=[])):(a=t.__requests[s],void a.op(r,a.args,n,i))}t.__tx=r;var a=null,s=0;try{o()}catch(c){"function"==typeof t.onerror&&t.onerror()}},function(){"function"==typeof t.onerror&&t.onerror()},function(){"function"==typeof t.oncomplete&&t.oncomplete()})},1)}},i.prototype.__addToTransactionQueue=function(t,r){this.__active||this.mode===n||e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",this.__mode);var i=this.__createRequest();return this.__pushToQueue(i,t,r),i},i.prototype.__createRequest=function(){var t=new e.IDBRequest;return t.source=this.db,t.transaction=this,t},i.prototype.__pushToQueue=function(e,t,r){this.__requests.push({op:t,args:r,req:e}),this.__executeRequests()},i.prototype.objectStore=function(t){return new e.IDBObjectStore(t,this)},i.prototype.abort=function(){!this.__active&&e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)},i.prototype.READ_ONLY=0,i.prototype.READ_WRITE=1,i.prototype.VERSION_CHANGE=2,e.IDBTransaction=i}(idbModules),function(e){var t=function(t,r,n,i){this.__db=t,this.version=n,this.__storeProperties=i,this.objectStoreNames=new e.util.StringList;for(var o=0;o<i.rows.length;o++)this.objectStoreNames.push(i.rows.item(o).name);this.name=r,this.onabort=this.onerror=this.onversionchange=null};t.prototype.createObjectStore=function(t,r){var n=this;r=r||{},r.keyPath=r.keyPath||null;var i=new e.IDBObjectStore(t,n.__versionTransaction,!1),o=n.__versionTransaction;return o.__addToTransactionQueue(function(o,a,s){function c(){e.util.throwDOMException(0,"Could not create new object store",arguments)}n.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",n.transaction);var d=["CREATE TABLE",e.util.quote(t),"(key BLOB",r.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");o.executeSql(d,[],function(e){e.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[t,r.keyPath,r.autoIncrement?!0:!1,"{}"],function(){i.__setReadyState("createObjectStore",!0),s(i)},c)},c)}),n.objectStoreNames.push(t),i},t.prototype.deleteObjectStore=function(t){var r=function(){e.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},n=this;!n.objectStoreNames.contains(t)&&r("Object Store does not exist"),n.objectStoreNames.splice(n.objectStoreNames.indexOf(t),1);var i=n.__versionTransaction;i.__addToTransactionQueue(function(){n.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",n.transaction),n.__db.transaction(function(n){n.executeSql("SELECT * FROM __sys__ where name = ?",[t],function(n,i){i.rows.length>0&&n.executeSql("DROP TABLE "+e.util.quote(t),[],function(){n.executeSql("DELETE FROM __sys__ WHERE name = ?",[t],function(){},r)},r)})})})},t.prototype.close=function(){},t.prototype.transaction=function(t,r){var n=new e.IDBTransaction(t,r||1,this);return n},e.IDBDatabase=t}(idbModules),function(e){var t=2097152;if(window.openDatabase){var r=window.openDatabase("__sysdb__",1,"System Database",t);r.transaction(function(e){e.executeSql("SELECT * FROM dbVersions",[],function(){a.notifyIsReady(!0)},function(){r.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){a.notifyIsReady(!0)},function(){a.notifyIsReady(!1)})})})},function(){});var n=!1,i=!1,o=void 0,a={notifyIsReady:function(e){if(i=!0,n=e,o){for(var t=0;t<o.length;++t)o[t](n);o=void 0}},onIsReady:function(e){i?setTimeout(function(){e(n)},0):o?o.push(e):o=[e]},open:function(n,i){function o(){if(!c){var t=e.Event("error",arguments);s.readyState="done",s.error="DOMError",e.util.callback("onerror",s,t),c=!0}}function a(a){var c=window.openDatabase(n,1,n,t);s.readyState="done","undefined"==typeof i&&(i=a||1),(0>=i||a>i)&&e.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",i),c.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){t.executeSql("SELECT * FROM __sys__",[],function(t,d){var l=e.Event("success");s.source=s.result=new e.IDBDatabase(c,n,i,d),i>a?r.transaction(function(t){t.executeSql("UPDATE dbVersions set version = ? where name = ?",[i,n],function(){var t=e.Event("upgradeneeded");t.oldVersion=a,t.newVersion=i,s.transaction=s.result.__versionTransaction=new e.IDBTransaction([],2,s.source),e.util.callback("onupgradeneeded",s,t,function(){var t=e.Event("success");e.util.callback("onsuccess",s,t)})},o)},o):e.util.callback("onsuccess",s,l)},o)},o)},o)}var s=new e.IDBOpenRequest,c=!1;return r.transaction(function(e){e.executeSql("SELECT * FROM dbVersions where name = ?",[n],function(e,t){0===t.rows.length?e.executeSql("INSERT INTO dbVersions VALUES (?,?)",[n,i||1],function(){a(0)},o):a(t.rows.item(0).version)},o)},o),s},deleteDatabase:function(n){function i(t){if(!s){a.readyState="done",a.error="DOMError";var r=e.Event("error");r.message=t,r.debug=arguments,e.util.callback("onerror",a,r),s=!0}}function o(){r.transaction(function(t){t.executeSql("DELETE FROM dbVersions where name = ? ",[n],function(){a.result=void 0;var t=e.Event("success");t.newVersion=null,t.oldVersion=c,e.util.callback("onsuccess",a,t)},i)},i)}var a=new e.IDBOpenRequest,s=!1,c=null;return r.transaction(function(r){r.executeSql("SELECT * FROM dbVersions where name = ?",[n],function(r,s){if(0===s.rows.length){a.result=void 0;var d=e.Event("success");return d.newVersion=null,d.oldVersion=c,void e.util.callback("onsuccess",a,d)}c=s.rows.item(0).version;var l=window.openDatabase(n,1,n,t);l.transaction(function(t){t.executeSql("SELECT * FROM __sys__",[],function(t,r){var n=r.rows;!function a(r){r>=n.length?t.executeSql("DROP TABLE __sys__",[],function(){o()},i):t.executeSql("DROP TABLE "+e.util.quote(n.item(r).name),[],function(){a(r+1)},function(){a(r+1)})}(0)},function(){o()})},i)})},i),a},cmp:function(t,r){return e.Key.encode(t)>e.Key.encode(r)?1:t===r?0:-1}};e.shimIndexedDB=a}}(idbModules),function(e,t){"undefined"!=typeof e.openDatabase&&(e.shimIndexedDB=t.shimIndexedDB,e.shimIndexedDB&&(e.shimIndexedDB.__useShim=function(){console.log("---- Using SQL Shim ----"),e.indexedDB=t.shimIndexedDB,e.IDBDatabase=t.IDBDatabase,e.IDBTransaction=t.IDBTransaction,e.IDBCursor=t.IDBCursor,e.IDBKeyRange=t.IDBKeyRange,e.indexedDB!==t.shimIndexedDB&&Object.defineProperty&&Object.defineProperty(e,"indexedDB",{value:t.shimIndexedDB})},e.shimIndexedDB.__debug=function(){})),"indexedDB"in e||(e.indexedDB=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.oIndexedDB||e.msIndexedDB);var r=!1;(navigator.userAgent.match(/Android 2/)||navigator.userAgent.match(/Android 3/)||navigator.userAgent.match(/Android 4\.[0-3]/))&&(navigator.userAgent.match(/Chrome/)||(r=!0));var n=e.location.hash.indexOf("forcesql=true")>=0;if(n||("undefined"==typeof e.indexedDB||r)&&"undefined"!=typeof e.openDatabase)e.shimIndexedDB.__useShim();else{e.IDBDatabase=e.IDBDatabase||e.webkitIDBDatabase,e.IDBTransaction=e.IDBTransaction||e.webkitIDBTransaction,e.IDBCursor=e.IDBCursor||e.webkitIDBCursor,e.IDBKeyRange=e.IDBKeyRange||e.webkitIDBKeyRange,e.IDBTransaction||(e.IDBTransaction={});try{e.IDBTransaction.READ_ONLY=e.IDBTransaction.READ_ONLY||"readonly",e.IDBTransaction.READ_WRITE=e.IDBTransaction.READ_WRITE||"readwrite"}catch(i){}}}(window,idbModules),define("IndexedDBShim",function(){}),define("db",["IndexedDBShim"],function(){var e=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB,t=window.IDBKeyRange||window.webkitIDBKeyRange,r={readonly:"readonly",readwrite:"readwrite"},n=Object.prototype.hasOwnProperty;if(!e)return void console.log("IndexedDB is not available");var i=function(e){return e},o=function(){var e,t=[],r=function(r,n){if(t){n=n||[],e=e||[r,n];for(var i=0,o=t.length;o>i;i++)t[i].apply(e[0],e[1]);t=[]}};this.add=function(){for(var n=0,i=arguments.length;i>n;n++)t.push(arguments[n]);return e&&r(),this},this.execute=function(){return r(this,arguments),this}},a=function(e){var t="progress",r=[["resolve","done",new o,"resolved"],["reject","fail",new o,"rejected"],["notify","progress",new o]],n={},i={state:function(){return t},then:function(){var e=arguments;return a(function(t){r.forEach(function(r,i){var o=e[i];n[r[1]]("function"==typeof o?function(){var e=o.apply(this,arguments);e&&"function"==typeof e.promise&&e.promise().done(t.resolve).fail(t.reject).progress(t.notify)}:t[r[0]])})}).promise()},promise:function(e){return e?(Object.keys(i).forEach(function(t){e[t]=i[t]}),e):i}};return r.forEach(function(e){var r=e[2],o=e[3];i[e[1]]=r.add,o&&r.add(function(){t=o}),n[e[0]]=r.execute}),i.promise(n),e&&e.call(n,n),n},s=function(e,t){var i=this,o=!1;this.add=function(t){if(o)throw"Database has been closed";for(var n=[],s=0,c=0;c<arguments.length-1;c++)if(Array.isArray(arguments[c+1]))for(var d=0;d<arguments[c+1].length;d++)n[s]=arguments[c+1][d],s++;else n[s]=arguments[c+1],s++;var l=e.transaction(t,r.readwrite),u=l.objectStore(t),h=a();return n.forEach(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=u.add(e,r)}else t=u.add(e);t.onsuccess=function(t){var r=t.target,n=r.source.keyPath;null===n&&(n="__id__"),Object.defineProperty(e,n,{value:r.result,enumerable:!0}),h.notify()}}),l.oncomplete=function(){h.resolve(n,i)},l.onerror=function(e){h.reject(n,e)},l.onabort=function(e){h.reject(n,e)},h.promise()},this.update=function(t){if(o)throw"Database has been closed";for(var n=[],s=0;s<arguments.length-1;s++)n[s]=arguments[s+1];var c=e.transaction(t,r.readwrite),d=c.objectStore(t),l=a();return n.forEach(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=d.put(e,r)}else t=d.put(e);t.onsuccess=function(){l.notify()}}),c.oncomplete=function(){l.resolve(n,i)},c.onerror=function(e){l.reject(n,e)},c.onabort=function(e){l.reject(n,e)},l.promise()},this.updateObject=function(t){if(o)throw"Database has been closed";var n=e.transaction(t,r.readwrite),s=n.objectStore(t),c=a(),d=arguments[1];for(var l in d)s.put(d[l]);return n.oncomplete=function(){c.resolve(d,i)},n.onerror=function(e){c.reject(d,e)},n.onabort=function(e){c.reject(d,e)},c.promise()},this.remove=function(t,n){if(o)throw"Database has been closed";{var i=e.transaction(t,r.readwrite),s=i.objectStore(t),c=a();s.delete(n)}return i.oncomplete=function(){c.resolve(n)},i.onerror=function(e){c.reject(e)},c.promise()},this.clear=function(t){if(o)throw"Database has been closed";{var n=e.transaction(t,r.readwrite),i=n.objectStore(t),s=a();i.clear()}return n.oncomplete=function(){s.resolve()},n.onerror=function(e){s.reject(e)},s.promise()},this.close=function(){if(o)throw"Database has been closed";e.close(),o=!0,delete u[t]},this.get=function(t,r){if(o)throw"Database has been closed";var n=e.transaction(t),i=n.objectStore(t),s=a(),c=i.get(r);return c.onsuccess=function(e){s.resolve(e.target.result)},n.onerror=function(e){s.reject(e)},s.promise()},this.query=function(t,r){if(o)throw"Database has been closed";return new c(t,e,r)};for(var s=0,d=e.objectStoreNames.length;d>s;s++)!function(e){i[e]={};for(var t in i)n.call(i,t)&&"close"!==t&&(i[e][t]=function(t){return function(){var r=[e].concat([].slice.call(arguments,0));return i[t].apply(i,r)}}(t))}(e.objectStoreNames[s])},c=function(e,n,o){var s=this,c=!1,d=function(i,s,d,l,u,h,p){var m=n.transaction(e,c?r.readwrite:r.readonly),f=m.objectStore(e),g=o?f.index(o):f,v=i?t[i].apply(null,s):null,y=[],b=a(),S=[v],u=u?u:null,h=h?h:void 0,T=0;"count"!==d&&S.push(l||"next");var w=c?Object.keys(c):!1,E=function(e){for(var t=0;t<w.length;t++){var r=w[t],n=c[r];n instanceof Function&&(n=n(e)),e[r]=n}return e};return g[d].apply(g,S).onsuccess=function(e){var t=e.target.result;if("number"==typeof t)y=t;else if(t)if(null!==u&&u[0]>T)T=u[0],t.advance(u[0]);else if(null!==u&&T>=u[0]+u[1]);else{var r=!0,n="value"in t?t.value:t.key;h&&h.forEach(function(e){e&&e.length&&(r=2===e.length?n[e[0]]===e[1]:e[0].apply(void 0,[n]))}),r&&(T++,y.push(p(n)),c&&(n=E(n),t.update(n))),t.continue()}},m.oncomplete=function(){b.resolve(y)},m.onerror=function(e){b.reject(e)},m.onabort=function(e){b.reject(e)},b.promise()},l=function(e,t){var r="next",n="openCursor",o=[],a=null,s=i,l=!1,u=function(){return d(e,t,n,l?r+"unique":r,a,o,s)},h=function(){return a=Array.prototype.slice.call(arguments,0,2),1==a.length&&a.unshift(0),{execute:u}},p=function(){return r=null,n="count",{execute:u}},m=function(){return n="openKeyCursor",{desc:g,execute:u,filter:f,distinct:v,map:b}},f=function(){return o.push(Array.prototype.slice.call(arguments,0,2)),{keys:m,execute:u,filter:f,desc:g,distinct:v,modify:y,limit:h,map:b}},g=function(){return r="prev",{keys:m,execute:u,filter:f,distinct:v,modify:y,map:b}},v=function(){return l=!0,{keys:m,count:p,execute:u,filter:f,desc:g,modify:y,map:b}},y=function(e){return c=e,{execute:u}},b=function(e){return s=e,{execute:u,count:p,keys:m,filter:f,desc:g,distinct:v,modify:y,limit:h,map:b}};return{execute:u,count:p,keys:m,filter:f,desc:g,distinct:v,modify:y,limit:h,map:b}};"only bound upperBound lowerBound".split(" ").forEach(function(e){s[e]=function(){return new l(e,arguments)}}),this.filter=function(){var e=new l(null,null);return e.filter.apply(e,arguments)},this.all=function(){return this.filter()}},d=function(e,t,r){"function"==typeof t&&(t=t());for(var i in t){var o,a=t[i];o=!n.call(t,i)||r.objectStoreNames.contains(i)?e.currentTarget.transaction.objectStore(i):r.createObjectStore(i,a.key);for(var s in a.indexes)if(!o.indexNames.contains(s)){var c=a.indexes[s];o.createIndex(s,c.key||s,Object.keys(c).length?c:{unique:!1})}}},l=function(e,t){var r=e.target.result,n=new s(r,t),i=a();return i.resolve(n),u[t]=r,i.promise()},u={},h={version:"0.9.0",open:function(t){var r,n=a();return u[t.server]?l({target:{result:u[t.server]}},t.server,t.version,t.schema).done(n.resolve).fail(n.reject).progress(n.notify):(r=e.open(t.server,t.version),r.onsuccess=function(e){l(e,t.server,t.version,t.schema).done(n.resolve).fail(n.reject).progress(n.notify)},r.onupgradeneeded=function(e){d(e,t.schema,e.target.result)},r.onerror=function(e){n.reject(e)}),n.promise()}};return h}),define("demo",["globals","util"],function(e){var t={cache:{}};return t.loadRemoteData=function(r,n){try{e.PAssert(998,r&&n,"Must supply valid remote load info as well as a cb when data is loaded")}catch(i){e.reportError(i)}var o=r.split(".");t.cache[o[0]]?n(t.cache[o[0]][o[1]]):e.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+o[0]+".json",cb:function(e){if(200===e.status)try{var r=JSON.parse(e.responseText);t.cache[o[0]]=r,n(r[o[1]])}catch(i){log("Error parsing demo data: "+i.message)}else log("Error getting demo data",e.status,e.responseText)}})},t}),define("data",["globals","util","gdata","db","demo","platform"],function(e,t,r,n,i,o){function a(){}function s(){log("Transaction Error: ",arguments)}function c(e){var t=g.getItem(e);if(t){var r=t.items;if(r)for(var n=0;n<r.length;++n)c(r[n]);g.dbDeleteItem(t.id)}}function d(e,t,r){e.save({items:e.getItemsArrayForSave()},SaveFlag.None),t.save({isArchived:r},SaveFlag.None)}function l(e,t){var r=e[t];return r?',"'+t+'":'+r:""}function u(e,t,r){var n="";t&&(n+=",");var i=g.getModel(e.id),o=String(i.getParsedText()).replace(/[\"]/g,function(e){return M[e]}),e=g.getItem(e.id),a=l(e,"dateCompleted"),s=l(e,"priority"),c=l(e,"isComplete"),d=l(e,"isFlagged"),h=l(e,"isArchived");if(n+='{"text": "'+o+'"'+a+s+c+d+h,e.items&&e.items.length>0){n+=',"items":[';for(var p=0;p<e.items.length;p++){var m=g.getItem(e.items[p]);(!m.isArchived||m.isArchived&&r)&&(n+=u(m,p>0))}n+="]"}return n+="}"}var h="ctcs",p="helpIntro",m="helpNormal",f={___info___:{count:0}},g={contacts:[],contactsByName:{},contactNames:f,pendingRemoteUpdates:{},itemsById:{},loadedItemCount:0,hasLocalData:!1,freezeUpdates:!1,dbi:void 0};REPORT_ACTIONS&&(g.reportData=function(r){if(!t.hasURLParam("nosync")){var n={};for(var i in g.itemsById)n[i]=g.itemsById[i].data;e.reportData(n,r)}});g.forEachModel=function(t){try{e.PAssert(999,t,"Must pass a valid function to iterate on")}catch(r){e.reportError(r)}for(var n in g.itemsById)g.itemsById[n]&&t(g.itemsById[n].model)},g.getModel=function(t){try{e.PAssert(1e3,t,"Tried to get a model that doesn't exist")}catch(r){e.reportError(r)}var n=g.itemsById[t];return n?n.model:void 0},g.setModel=function(t,r){try{e.PAssert(1001,t,"Tried to set a model with an invalid id")}catch(n){e.reportError(n)}g.itemsById[t]?g.itemsById[t].model=r:g.itemsById[t]={model:r,data:void 0}},g.getItem=function(t){try{e.PAssert(1002,t,"Tried to get an item that doesn't exist")}catch(r){e.reportError(r)}var n=g.itemsById[t];return n?n.data:void 0},g.setItem=function(t,r){try{e.PAssert(1003,t,"Tried to set an item with an invalid id")}catch(n){e.reportError(n)}g.itemsById[t]?g.itemsById[t].data=r:g.itemsById[t]={model:void 0,data:r}},g.getRootItem=function(){return g.rootId?g.getItem(g.rootId):void 0},g.getRootModel=function(){return g.rootId?g.getModel(g.rootId):void 0},g.initializeIndexedDB=function(t){function r(r){r?n.open({server:"duchess",version:i,schema:{items:{key:{keyPath:"id"}},settings:{}}}).done(function(e){g.dbi=e,t()}).fail(function(r){log("Error loading local DB client",r),e.preventLocalWrites(),e.reportError(r),t()}):(log("Shim failed to init."),e.preventLocalWrites(),t())}var i=1;void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?window.indexedDB.onIsReady(r):setTimeout(function(){r(!0)},0)},g.migrateLocalData_One=function(){for(var e in g.itemsById){var t=!1,r={},n=g.getItem(e);if(n){var i=n.text;i.startsWith("!")?(r.priority=VMLIFlag.P0,r.text=i.substr(1),t=!0):i.startsWith("*")?(r.isFlagged=!0,r.text=i.substr(1),t=!0):i.startsWith("^")&&(r.isComplete=!0,r.text=i.substr(1),t=!0),t&&g.dbUpdateItem({id:e,changes:r,saveFlags:SaveFlag.None})}}},g.migrateLocalData_Two=function(){if(0===g.contacts.length)return void log("Skipping local data migration two");for(var t in g.itemsById){var r=!1,n={},i=g.getItem(t);if(i&&i.text.indexOf("@")>=0)for(var o=i.text.split(" "),a=0,s=0;s<o.length;++s){if(0===o[s].indexOf("@")){for(var c=void 0,d=o[s].substring(1),l=1;4>l;l++){var u=-1!==d.indexOf(":",d.length-1)?d.substr(0,d.length-1):d;if(g.contactsByName[u]&&(c=u),!(s+l<o.length))break;d+=" "+o[s+l]}if(c){try{e.PAssert(1004,"@"==i.text[a],"Explicitly matching @, should always match")}catch(h){e.reportError(h)}var p=i.text.substr(0,a)+"+"+i.text.substr(a+1);n.text=p,r=!0;var m=g.getModel(t);m&&(m.setRawText(p),m.parseText(!0))}}a+=o[s].length+1}r&&g.dbUpdateItem({id:t,changes:n,saveFlags:SaveFlag.None})}};var v=!1;g.localDataLoaded=function(){return v},g.loadFromIndexedDB=function(t){try{e.PAssert(1005,!v,"Should never load local data twice")}catch(r){e.reportError(r)}g.itemsById={},e.shouldWriteLocal()&&g.dbi&&g.dbi.items?g.dbi.items.query().all().execute().done(function(r){g.loadedItemCount=r.length;for(var n=0;n<r.length;++n)g.setItem(r[n].id,e.translateObjOut(r[n]));v=!0,g.dbi.settings?g.dbi.settings.get("root").done(function(r){if(!e.criticalErrorReported()){if(r){try{e.PAssert(1006,g.getItem(r.root),"If there is a root item defined there should be a corresponding local item")}catch(n){e.reportError(n)}g.rootId=r.root}log("Root Item: ",g.rootId),t&&t()}}).fail(t):(log("Unable to load local settings DB"),t&&t())}):(log("Unable to load local items DB"),v=!0,e.preventLocalWrites(),t&&t())};var y=void 0;g.beginTransaction=function(){e.shouldWriteLocal()&&(y={})},g.transactionUpdate=function(t,r){try{e.PAssert(1007,e.shouldWriteLocal(),"Should never be writing during a transaction if local writes are disabled")}catch(n){e.reportError(n)}if(y[t])for(var i in r)y[t][i]=r[i];else y[t]=r},g.endTransaction=function(){e.shouldWriteLocal()&&g.dbi&&g.dbi.items?g.dbi.items.updateObject(y).done(a).fail(s):void 0!==y&&e.reportError(new Error("Started a transaction and stopped writes halfway through")),y=void 0
},g.dbUpdateItem=function(t){if(!g.freezeUpdates){g.hasLocalData||e.isLoadingRemote||t.skipLocalModification||(g.hasLocalData=!0);var r=t.changes||{},n=t.id?t.id:r.id,i=t.callback,o=t.saveFlags;try{e.PAssert(1008,o===SaveFlag.None||o===SaveFlag.Prop||o===SaveFlag.Text||o===SaveFlag.All)}catch(a){e.reportError(a)}var s=g.getItem(n);if(e.shouldWriteLocal()){var c;try{e.PAssert(1009,!o||void 0===r.modifiedOffline&&void 0===r.modifiedOfflineText,"Shouldn't be setting a modified flag while passing them in with changes")}catch(a){e.reportError(a)}if(e.isFlagSet(o,SaveFlag.Prop)){try{e.PAssert(1010,void 0===r.modifiedOffline,"Shouldnt be passing in a value and assigning true")}catch(a){e.reportError(a)}r.modifiedOffline=!0;var d=g.getModel(n);d&&(d.modifiedOffline=!0)}if(e.isFlagSet(o,SaveFlag.Text)){try{e.PAssert(1011,void 0===r.modifiedOfflineText,"Shouldnt be passing in a value and assigning true")}catch(a){e.reportError(a)}r.modifiedOfflineText=!0;var d=g.getModel(n);d&&(d.modifiedOfflineText=!0)}if(s){for(var l in r)if(r.hasOwnProperty(l)){s[l]=r[l]}c=e.translateObjIn(s)}else{try{e.PAssert(1012,r.id,"Item being modified does not already exist as expected",r)}catch(a){e.reportError(a)}g.setItem(n,r),c=e.translateObjIn(r)}if(y){try{e.PAssert(1014,!i,"Callbacks not supported for updates inside of a transaction")}catch(a){e.reportError(a)}g.transactionUpdate(n,c)}else i?g.dbi.items.update(c).done(i).fail(i):g.dbi.items.update(c)}else{if(s)for(var l in r)r.hasOwnProperty(l)&&(s[l]=r[l]);else g.setItem(n,r);i&&i()}}},g.dbDeleteItem=function(t,r){g.freezeUpdates||(g.setItem(t,void 0),e.shouldWriteLocal()&&(r?g.dbi.items.remove(t).done(r).fail(r):g.dbi.items.remove(t)))},g.setRoot=function(t){return g.freezeUpdates?void 0:(e.shouldWriteLocal()&&g.dbi.settings.update({key:"root",item:{root:t}}),g.rootId=t,g.getRootItem())};var b=0,S={};g.loadDemoData=function(e,t){function r(e){e.id||(e.id="demo"+b++),g.setItem(e.id,e);var t=e.items;if(t){for(var n=[],i=0;i<t.length;++i)t[i].id||(t[i].id="demo"+b++),n.push(t[i].id),r(t[i]);e.items=n}}function n(n){var i;n&&(i=n[0]),i&&(r(i),g.setRoot(i.id),S[e]=i,v=!0,t&&t(i.id))}if(void 0===e&&(e="demo.5"),void 0!==e&&""!==e&&void 0!==S[e]){log("Use Preloaded demo data: ",e);var o=S[e];g.setRoot(o.id),t&&t(o.id)}else""===e?i.loadRemoteData("demo.5",n):i.loadRemoteData(e,n)};var T=!1;g.initData=function(r){if(T)return!1;T=!0;try{e.isDemoMode()?setTimeout(function(){var e=t.getURLParam("data");g.loadDemoData(e,r)},0):(e.checkpoint(Checkpoint.InitData),g.initializeIndexedDB(function(){g.loadFromIndexedDB(function(){e.checkpoint(Checkpoint.DBLoaded),g.checkLocalIntegrity(function(){g.loadLocalContacts(),r(),g.hasLocalData||o.offline||!navigator.onLine||e.vmMain.isLoadingDoc(!0)})})}))}catch(n){e.reportError(n)}return!0},g.initializeItem=function(t){var n=t.id,i=!n||e.isLocalItem(t)||!t.data;if(i){var o=r.createNewItem(t,t.hasChildren(),t.hasArchivedChildren());n&&n!==o&&g.modifyItemId(n,o);for(var a=!1,s=t.items(),c=0;c<s.length;++c)a|=g.initializeItem(s[c]);if(t.hasArchivedChildren())for(var d=t.archivedItems(!0),c=0;c<d.length;++c)a|=g.initializeItem(d[c]);if(r.initializeNewItem(t),n&&n!==o){var l=t.parent();l&&l.save(null,SaveFlag.None)}}return i},g.checkLocalIntegrity=function(t){var r=!1,n=!1;g.ensureLocalCache(function(){var i=!1,o={};for(var a in g.itemsById)if(g.itemsById.hasOwnProperty(a)&&g.getItem(a)){var s=g.getItem(a);(s.i||s.t)&&(log("%cInvalid local properties on item: ","color: red",s),r=!0),o[s.id]?o[s.id].exist?(log(s.id,": Duplicated IDs in the local database",s),r=!0):(o[s.id].exist=!0,o[s.id].del=!!s.isDeleted):o[s.id]={exist:!0,ref:!1,del:!!s.isDeleted},s.id==g.rootId&&(i&&(log(s.id,": Multiple roots present locally",s),r=!0),i=!0,o[s.id].isRoot=!0),void 0==s.text&&(log("Found item with no text",s.id),s.text="",g.dbUpdateItem({id:a,changes:{text:""},saveFlags:SaveFlag.None}));for(var d=void 0,l=0;s.items&&l<s.items.length;++l)if(s.items[l]){var u=s.items[l],h=g.getItem(u);if(h?(h.isArchived&&(d=u),d&&!h.isArchived&&(log(u,": Unarchived child found after an archived one"),log("   ",s.id,": Parent with incorrectly ordered children"),r=!0)):(log(u,": Child does not have a valid reference on our local database"),r=!0),o[u])if(o[u].ref){log(u,": Item is referenced locally multiple times: ",h?g.getItem(u).id:"UNDEFINED"),log("   ",o[u].ref,": ",g.getItem(o[u].ref).id),log("   ",s.id,": <CLIENTDATA>"),r=!0;var p=s.items;p.removeAt(l),g.dbUpdateItem({id:a,changes:{items:p},saveFlags:SaveFlag.None})}else o[u].ref=s.id;else o[u]={exist:!1,ref:s.id}}else log(s.id,": Invalid item in local items array"),r=!0}i||(log("No root present"),r=!0);for(var m in o){var f=o[m];if(!f.exist){log(m,": Item is referenced locally as a child but does not exist in the database");var s=g.getItem(f.ref);try{e.PAssert(1015,s,"Parent of item must exist")}catch(v){e.reportError(v)}if(s){var p=s.items;p?p.remove(m):p=[],g.dbUpdateItem({id:s.id,changes:{items:p},saveFlags:SaveFlag.None})}}if(f.ref||f.isRoot||f.del||(log(m,": Item exists locally but is not referenced by a parent"),c(m)),f.ref&&f.del){log(m,": Item is referenced locally by a parent but has been deleted");var s=g.getItem(f.ref);try{e.PAssert(1016,s)}catch(v){e.reportError(v)}var p=s.items;p?p.remove(m):p=[],g.dbUpdateItem({id:s.id,changes:{items:p},saveFlags:SaveFlag.None})}if(f.isRoot&&f.ref&&(log(m,": Local root has a parent"),r=!0),f.del&&!f.ref){var s=g.getItem(m);e.isLocalItem(s)&&(log("Deleting Unreferenced Local Item: ",m),g.dbDeleteItem(m))}}t({error:r,local:n})})},g.removeDeletedItems=function(e){for(var t in g.itemsById){var r=g.getItem(t);r&&r.isDeleted&&(e[t]||(log("Deleting Removed Local Item: ",t),g.dbDeleteItem(t)))}},g.clearData=function(t,r){g.freezeUpdates=!0,setTimeout(function(){function n(){g.clearContacts(),g.clearHelp(),e.settings.resetAll(r),t&&t()}function i(){g.dbi.items&&g.dbi.items.clear().done(function(){n()}).fail(function(){log("Failed to reset items!",arguments),n()})}return e.pageDataCleared(),g.dbi?void(g.dbi.settings&&g.dbi.settings.clear().done(function(){i()}).fail(function(){log("Failed to reset settings!",arguments),i()})):void g.initializeIndexedDB(function(){g.clearData(t,r)})},0)},g.contactComparator=function(e,t){return e.text.localeCompare(t.text)},g.sortContacts=function(){g.contacts.sort(g.contactComparator)},g.addContact=function(t,r){try{e.PAssert(1017,t.id,"Incoming contacts must have a valid id")}catch(n){e.reportError(n)}try{e.PAssert(1018,t.text,"All contacts are expected to have a text")}catch(n){e.reportError(n)}r?g.contacts.insertSorted(t,g.contactComparator):g.contacts.push(t),t.text&&(g.contactNames[t.text]="",g.contactsByName[t.text]=t),g.contactNames.___info___.count=g.contacts.length},g.updateContact=function(t){try{e.PAssert(1019,t.id,"Incoming contacts must have a valid id")}catch(r){e.reportError(r)}try{e.PAssert(1020,t.text,"All contacts are expected to have a text")}catch(r){e.reportError(r)}for(var n=!1,i=0;i<g.contacts.length;++i)if(g.contacts[i].id===t.id){g.contacts[i]=t,n=!0;break}return n?void 0:(g.addContact(t),!0)};var w=!1;g.clearLocalContacts=function(){if(w=!1,e.shouldWriteLocal())try{t.storage.setItem(h,"[]")}catch(r){e.reportError(r)}g.contacts=[],e.settings.set(Settings.lastContactSync,void 0)},g.loadLocalContacts=function(){if(!w&&(w=!0,e.shouldWriteLocal()))try{g.loadContacts(JSON.parse(t.storage.getItem(h)),!1)}catch(r){e.reportError(r)}},g.loadContacts=function(t,r){try{e.PAssert(1021,0===g.contacts.length,"Should only load contacts once")}catch(n){e.reportError(n)}if(g.contacts=t,g.contacts){for(var i=!1,o=0;o<g.contacts.length;o++){var a=g.contacts[o];if(a.name&&(a.text=a.name,g.contacts[o].text=a.name,delete g.contacts[o].name,i=!0),!r&&a.isDemo||a.text&&!a.phoneNumbers&&!a.emails)g.contacts.removeAt(o--),i=!0;else{a.text&&(g.contactNames[a.text]="",g.contactsByName[a.text]=a);try{e.PAssert(1022,a.id,"Each contact must have a valid id")}catch(n){e.reportError(n)}}}i&&g.saveContacts(),g.contactNames.___info___.count=g.contacts.length}else g.contacts=[],g.contactsByName={},g.contactNames=f;log("Contacts Loaded: ",g.numContacts())},g.saveContacts=function(){e.shouldWriteLocal()&&t.storage.setItem(h,JSON.stringify(g.contacts))},g.clearContacts=function(){e.settings.set(Settings.syncContacts,!1),e.settings.reset(Settings.lastContactSync),e.shouldWriteLocal()&&t.storage.removeItem(h,void 0)},g.clearHelp=function(){e.shouldWriteLocal()&&(t.storage.removeItem(p,void 0),t.storage.removeItem(m,void 0))},g.contactRelevanceComparator=function(e,t){return e.index!=t.index?e.index<t.index?-1:1:e.object.text.localeCompare(t.object.text)},g.findContactsLike=function(e){for(var t=e.toLowerCase(),r=[],n=50,i=0;i<g.contacts.length;++i){var o=g.contacts[i].text.toLowerCase().indexOf(t);if(o>=0&&(r.push({index:o,object:g.contacts[i]}),r.length>n))break}return r.sort(g.contactRelevanceComparator),r},g.findContactsExact=function(e){return g.contactsByName[e]},g.findContactByEmail=function(e){for(var t=0;t<g.contacts.length;++t){var r=g.contacts[t];if(r.emails)for(var n=0;n<r.emails.length;++n)if(r.emails[n].address==e)return r}},g.getContacts=function(){return g.contactNames},g.numContacts=function(){try{e.PAssert(1023,g.contacts.length===g.contactNames.___info___.count,"Contact names count should match contacts value")}catch(t){e.reportError(t)}return g.contacts.length},g.areLocalContactsLoaded=function(){return w},g.insertItems=function(t,n,i){try{e.PAssert(1024,t,"Must pass in a valid item")}catch(o){e.reportError(o)}try{e.PAssert(1025,void 0===i||i>=0,"Must pass in a valid index")}catch(o){e.reportError(o)}t.save({items:t.getItemsArrayForSave()},SaveFlag.Prop),1===n.length?r.itemAdded({item:t,addedItem:n[0],index:i,isArchived:!1}):r.itemsAdded({item:t,addedItems:n,index:i,isArchived:!1})},g.removeItem=function(t,n,i,o){try{e.PAssert(1026,t,"Must pass in a valid item")}catch(a){e.reportError(a)}try{e.PAssert(1027,void 0===n||n>=0,"Must pass in a valid index")}catch(a){e.reportError(a)}t.save({items:t.getItemsArrayForSave()},SaveFlag.Prop),i&&i.data&&r.itemRemoved({item:t,index:n,numToRemove:1,isArchived:o})},g.moveItem=function(t){var n=t.item,i=t.newInfo,o=t.oldParent,a=t.oldInfo,s=t.isRemoteChange,c=t.noVersion,d=s?SaveFlag.None:SaveFlag.Prop;try{e.PAssert(1028,void 0!==n&&void 0!==i&&void 0!==o&&void 0!==a,"moveItem is missing parameters")}catch(l){e.reportError(l)}o.save({items:o.getItemsArrayForSave()},d),n.parent().save({items:n.parent().getItemsArrayForSave()},d),a.isArchived!==i.isArchived&&(n.isArchived(i.isArchived),n.save({isArchived:i.isArchived},d)),s||(g.saveChanges(n,{},d),r.itemMoved({item:n,newInfo:i,oldParent:o,oldInfo:a,noVersion:c}))},g.archiveItem=function(t,n,i){try{e.PAssert(1029,n>=0,"Must have a valid index to remove from")}catch(o){e.reportError(o)}d(t,i,!0),i.data&&r.itemArchived(t,i,n)},g.unarchiveItem=function(t,n,i){try{e.PAssert(1030,n>=0,"Must have a valid index to remove from")}catch(o){e.reportError(o)}d(t,i,!1),i.data&&r.itemUnarchived(t,i,n,t.items().length-1)},g.modifyItemId=function(t,r,n){var i=g.getItem(t),o=g.getModel(t);if(i.id=r,o.id=r,g.pendingRemoteUpdates[t]&&(g.pendingRemoteUpdates[t]=void 0,g.pendingRemoteUpdates[r]=!0),i.version=-1,i.versionText=-1,"root"===t)for(var a=i.items.length-1;a>=0;a--){var s=g.getItem(i.items[a]);if(e.isLocalItem(s)&&!s.modifiedOffline&&!s.modifiedOfflineText){i.items.removeAt(a);try{e.PAssert(1031,o.items()[a].id===s.id,"Item arrays should match")}catch(c){e.reportError(c)}o.items().removeAt(a)}}g.itemsById[r]={data:i,model:g.itemsById[t].model},g.dbDeleteItem(t),g.dbUpdateItem({changes:i,callback:n,skipLocalModification:!0,saveFlags:SaveFlag.None}),g.itemsById[t]=void 0,delete g.itemsById[t]},g.deleteItem=function(t){try{e.PAssert(1032,!t.isDeleted,"Should never try to delete an item that has already been deleted")}catch(r){e.reportError(r)}var n=g.getItem(t.id);if(n)t.isDeleted=!0,g.dbUpdateItem({id:t.id,changes:{isDeleted:!0},saveFlags:SaveFlag.Prop});else try{e.PAssert(1033,"Expected local item, didnt find one",t.id)}catch(r){e.reportError(r)}},g.undeleteItem=function(t){var r=g.getItem(t.id);if(r)t.isDeleted=!1,g.dbUpdateItem({id:t.id,changes:{isDeleted:void 0},saveFlags:SaveFlag.Prop});else try{e.PAssert(1034,"Expected local item, didnt find one",t.id)}catch(n){e.reportError(n)}},g.saveChanges=function(t,r,n){if(t)r||(r={}),g.dbUpdateItem({id:t.id,changes:r,saveFlags:n});else{log("Incoming item to save has no item!",t,r);try{e.PAssert(1035,!1,"Incoming item to save has no item!")}catch(i){e.reportError(i)}}},g.addPendingUpdate=function(t){try{e.PAssert(1036,t,"Invalid ID")}catch(r){e.reportError(r)}try{e.PAssert(1037,e.isString(t),"Must provide a valid id string")}catch(r){e.reportError(r)}g.pendingRemoteUpdates[t]||(g.pendingRemoteUpdates[t]=!0)},g.clearPendingUpdates=function(){for(var t in g.pendingRemoteUpdates){try{e.PAssert(1038,g.pendingRemoteUpdates.hasOwnProperty(t))}catch(n){e.reportError(n)}var i=g.getModel(t),o=g.getItem(t);if(o&&o.isDeleted)g.dbDeleteItem(t);else if(i&&i.data){var a={modifiedOffline:!1,modifiedOfflineText:!1};i.modifiedOffline=!1,i.modifiedOfflineText=!1;var s=r.getVersion(i.data,VersionType.Structure),c=r.getVersion(i.data,VersionType.Text);s!=i.getVersion(VersionType.Structure)&&(a.version=s,i.setVersion(VersionType.Structure,s)),c!=i.getVersion(VersionType.Text)&&(a.versionText=c,i.setVersion(VersionType.Text,c)),g.dbUpdateItem({id:t,changes:a,saveFlags:SaveFlag.None})}}g.pendingRemoteUpdates={},g.printIndexedDB("id","text","version","versionText","modifiedOffline","isArchived")};var E={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},M={'"':'\\"'};return g.toHtml=function(e,t){var r="<ul>";if(e.items)for(var n=0;n<e.items.length;n++){var i=g.getItem(e.items[n]),o=g.getModel(i.id),a=String(o.getParsedText()).replace(/[&\"<>]/g,function(e){return E[e]});(!i.isArchived||i.isArchived&&t)&&(r+="<li>"+a,i.items&&i.items.length>0&&(r+=g.toHtml(i)),r+="</li>")}return r+="</ul>"},g.toPlainText=function(e,t,r){isNaN(t)&&(t=0);var n="";if(e.items)for(var i=0;i<e.items.length;i++){var o=g.getItem(e.items[i]),a=g.getModel(o.id);if(!o.isArchived||o.isArchived&&r){for(var s=0;t>s;s++)n+="	";n+=a.getParsedText()+"\n",o.items&&o.items.length>0&&(n+=g.toPlainText(o,t+1))}}return n},g.toJSON=function(t,r,n){var i=u(t,r,n);return'{"moodoVer":'+e.settings.get(Settings.localDataVersion)+',"moodoRoot":'+i+"}"},g.ensureLocalCache=function(t){var r=g.getRootItem();if(r)g.loadedItemCount>2&&(g.hasLocalData=!0),t();else{{var n=g.hasLocalData;e.generateTempId()}g.dbUpdateItem({changes:{id:"root",text:"Home",items:[]},skipLocalModification:!0,saveFlags:SaveFlag.None,callback:function(){g.setRoot("root"),g.hasLocalData=n,t()}})}},g.printIndexedDB=function(){},g}),define("goog",["ko","data","globals","util","gdata","platform"],function(e,t,r,n,i,o){function a(){var e=void 0;try{var t=gapi.auth.getToken();t&&(e=t.access_token)}catch(r){E.recoverFromError(r)}return e}function s(){r.messageQueue.pushMessage({text:"There was an internal error in Google Drive, refresh to try again in a couple minutes.",type:MessageType.Error,action:MessageAction.Reload}),r.vmMain.setGDriveStatus(DriveStatus.Offline)}function c(e){r.vmMain.setGDriveStatus(DriveStatus.Connecting),gapi.client.load("drive","v2",function(){if(!gapi.client.drive)return void s();var t="(title='"+E.LEGACY_DefaultDriveDocTitle+"' or properties has {key='"+E.DefaultProperty+"' and value='"+E.DefaultPropertyValue+"' and visibility='PRIVATE'}) and 'me' in owners and trashed=false";gapi.client.drive.files.list({fields:A,q:t}).execute(function(t){t&&t.items?e(t.items[0],!1):t&&200!==t.code&&t.error?s():d(e)})})}function d(e){gapi.client.load("drive","v2",function(){gapi.client.drive.files.insert({resource:{mimeType:E.REALTIME_MIMETYPE,title:E.DefaultDocTitle,writersCanShare:!1,properties:[{key:E.DefaultProperty,value:E.DefaultPropertyValue,visibility:"PRIVATE"}]}}).execute(function(t){if(200!==t.code&&t.error)s();else{var i=n.getURLParam("file");if(i)try{try{r.PAssert(1061,gapi.drive,"gapi.drive should exist")}catch(o){r.reportError(o)}n.removeURLParam("file"),gapi.drive.realtime.load(i,h,u,p)}catch(a){r.reportError(a)}else e(t,!0)}})})}function l(e){if(log("First Run Drive Document"),u(e),E.authenticatedUserEmail())r.sendEvent("Subscribe","NewUser"),r.reportSignup(E.authenticatedUserEmail());else var t=E.authenticatedUserEmail.subscribe(function(){t.dispose(),t=void 0,r.sendEvent("Subscribe","NewUser"),r.reportSignup(E.authenticatedUserEmail())})}function u(e){if(log("Drive Document Initialized"),i.onInitialized(e),E.authenticatedUserEmail())r.sendEvent("Documents","CreateNew");else var t=E.authenticatedUserEmail.subscribe(function(){t.dispose(),t=void 0,r.sendEvent("Documents","CreateNew")})}function h(e){r.vmMain.setGDriveStatus(DriveStatus.Saved);var t=i.onLoad(e);t&&(i.onRemoteSettingsLoad(),E.startWatchdog())}function p(e){switch(ShouldLog(LogLevels.Error)&&log("Doc Load Error - ",JSON.stringify(e)),e.type){case gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED:try{r.PAssert(1062,!e.isFatal,"Token refresh required causes a non-fatal error")}catch(n){r.reportError(n)}E.recoverFromError();break;case gapi.drive.realtime.ErrorType.INVALID_COMPOUND_OPERATION:try{r.PAssert(1063,e.isFatal,"Invalid compound operation causes a fatal error")}catch(n){r.reportError(n)}ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+e.type+"] Fatal: "+e.isFatal),r.reportError(new Error("Invalid Compound Operation: "+r.safeStringify(e)));break;case gapi.drive.realtime.ErrorType.CONCURRENT_CREATION:case gapi.drive.realtime.ErrorType.CLIENT_ERROR:ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+e.type+"] Fatal: "+e.isFatal),r.reportError(new Error("Client Error: "+r.safeStringify(e))),E.clearDocInfo(),f();break;case gapi.drive.realtime.ErrorType.FORBIDDEN:case gapi.drive.realtime.ErrorType.NOT_FOUND:ShouldLog(LogLevels.Error)&&log("Unable to access or find the requested document"),r.reportError(new Error("DocError Forbidden/NotFound: "+r.safeStringify(e))),t.clearData(function(){r.reload()});break;case gapi.drive.realtime.ErrorType.SERVER_ERROR:try{r.PAssert(1064,e.isFatal,"Server errors are always fatal")}catch(n){r.reportError(n)}r.vmMain.setGDriveStatus(DriveStatus.Offline);break;default:ShouldLog(LogLevels.Error)&&log("Unkown Doc Error - ",r.safeStringify(e)),r.reportError(new Error("Unknown Doc Error: "+r.safeStringify(e)))}e.isFatal&&i.close(e)}function m(e){var t=E.getDocId();if(t)try{var r=e?l:u;gapi.drive.realtime.load(t,h,r,p)}catch(n){E.recoverFromError(n)}else f()}function f(){c(function(e,t){e&&e.id?(E.setDocInfo(e.id,e.title),m(t)):r.reportError(new Error("We should always find a valid document with a defined id")),t&&r.fireCustomEvent("firstRun")})}function g(){for(var e=[],t=0;t<I.length;++t){var n=E.scopes.indexOf(I[t]),i=C.indexOf(I[t])>=0;n>=0&&!i&&e.push(n)}var o=JSON.stringify(e);r.settings.set(Settings.authScopes,o)}function v(e){e>0&&r.vmMain.runParseWorkerNewContacts()}function y(e){return parseInt(e.id.split("_")[1])}function b(t,n){if(t&&!t.error){try{r.PAssert(1067,t.scope,"Scopes must be valid")}catch(o){r.reportError(o)}r.isString(t.scope)&&(t.scope=t.scope.split(" "));var a=I,s=e.utils.arrayGetDistinctValues(t.scope);I=s,(a.length!==s.length||a!==s)&&g();var c=1e3*(parseInt(t.expires_in)-600);log("Token expires in",c/1e3),L=Date.now()+c,clearTimeout(O),O=setTimeout(function(){S()},c),_=M,i.poke(),setTimeout(function(){for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;++t)if(e[t].src.startsWith("https://accounts.google.com/o/oauth2/auth?"))if(""===e[t].id)e[t].id="auth_"+F++;else{var r=y(e[t]);r!==F&&r!==F-1&&e[t].parentElement.removeChild(e[t])}},0)}else log("Error authorizing token"+(t?t.error:""));n&&n(t)}function S(e){if(!gapi||!gapi.auth||!gapi.auth.authorize)return e(void 0),!1;try{r.PAssert(1069,I.length>=E.requiredScopes.length,"We lost some required scopes somewhere...")}catch(t){r.reportError(t)}R=!0;var n=E.authenticatedUserEmail()||r.settings.get("activeUser"),i={client_id:E.CLIENT_ID,scope:I,immediate:!0,user_id:n};return gapi.auth.authorize(i,function(t){V=!0,R=!1,b(t,e)}),!0}function T(){if(E.isRealtimeAPILoaded())q=!1;else{var e=document.getElementById("gapiScript");e&&e.parentNode.removeChild(e),r.addScript("https://apis.google.com/js/client.js?onload=GoogleApiLoaded","gapiScript",function(){q=!1}),U-->0?setTimeout(T,B):q=!1}}function w(){V?(r.vmMain.setGDriveStatus(DriveStatus.Saved),r.messageQueue.clearMessage(MessageID.ConnectionError)):(S(),setTimeout(w,B))}var E={CLIENT_ID:"597847337936.apps.googleusercontent.com",exportID:void 0,calendars:e.observable({}),eventSubscribers:[],authenticatedUserEmail:e.observable(void 0),gapiLoaded:!1};r.goog=E;var M=1e4,x=16e4;E.APP_ID="597847337936",E.REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk",window.GScope={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.google.com/m8/feeds",Drive:"https://www.googleapis.com/auth/drive.file",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",DriveFull:"https://www.googleapis.com/auth/drive",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveInstall:"https://www.googleapis.com/auth/drive.install",DriveAppData:"https://www.googleapis.com/auth/drive.appdata"};var C=[GScope.TasksRO];E.LEGACY_DefaultDriveDocTitle="DuchessBeta",E.DefaultDocTitle="Moo.do Personal Document",E.DefaultProperty="MooDoDefault",E.DefaultPropertyValue="TRUE",E.requiredScopes=[GScope.Drive,GScope.UserInfoEmail,GScope.DriveInstall],E.requestScopes=[],E.scopes=[GScope.Calendar,GScope.CalendarRO,GScope.Contacts,GScope.Drive,GScope.UserInfoEmail,GScope.DriveFull,GScope.UserInfoProfile,GScope.DriveInstall,GScope.DriveAppData];var I=[],A="items(id,title)";E.isLoaded=!1,E.init=function(){var t=r.settings.get(Settings.authScopes);if(t){var i;try{i=JSON.parse(t)}catch(a){r.reportError(a)}if(i){for(var s=0;s<i.length;++s){try{r.PAssert(1047,i[s]>=0,"Each saved scope should be a valid array index")}catch(c){r.reportError(c)}i[s]>=0&&E.requestScopes.push(E.scopes[i[s]])}E.requestScopes=e.utils.arrayGetDistinctValues(E.requestScopes)}}else E.requestScopes=E.requiredScopes;I=E.requestScopes,o.syncContacts&&n.getURLParam("access_token")&&!n.hasURLParam("error")&&(I.indexOf(GScope.Contacts)<0&&(I.push(GScope.Contacts),g()),r.settings.set(Settings.syncContacts,!0));var d=E.authenticatedUserEmail.subscribe(function(e){void 0!==e&&(window.ga&&ga("set","&uid",r.getAnonUserIdentifier()),d.dispose(),d=void 0)})},E.ensureRequiredScopesAreRequested=function(){for(var e=!1,t=0;t<E.requiredScopes.length;++t)if(I.indexOf(E.requiredScopes[t])<0){e=!0;break}e&&E.runAuthenticate(E.requiredScopes,!0,!1,function(e){(!e||e.error)&&r.messageQueue.pushMessage({text:"We need additional permissions to give you the best experience, "+o.actionVerb()+" here to authenticate.",type:MessageType.Warning,action:function(){E.runAuthenticate(E.requiredScopes,!1,!1,function(e){(!e||e.error)&&r.messageQueue.pushMessage({text:"There was an error authenticating, "+o.actionVerb()+" here to try again.",type:MessageType.Error,action:E.ensureRequiredScopesAreRequested})})}})})};var P=96e4,D=void 0;E.startWatchdog=function(){D||(D=setInterval(E.watchdogFn,P))},E.stopWatchdog=function(){clearInterval(D),D=void 0};var k=0;E.watchdogFn=function(){var e=Date.now();if(k-e>=P){try{var t=gapi.auth.getToken();if(t){var n=1e3*parseInt(t.expires_at);e>n?(ShouldLog(LogLevels.Error)&&log("Active token is no longer valid: "+e+" vs. "+n),S(),r.reportError(new Error("Watchdog found expired token on client"))):i.poke()}else ShouldLog(LogLevels.Error)&&log("No active token on client!"),S(),r.reportError(new Error("Watchdog found client with no token set"))}catch(o){r.reportError(o)}finally{k=e}r.checkForRemoteChanges()}},E.hasPermission=function(e){return I.indexOf(e)>-1};var O=void 0,L=void 0,R=!0;E.onFocusHandler=function(){L&&Date.now()>L&&S()},E.onBlurHandler=function(){O&&clearTimeout(O)},E.getAccessToken=function(){var e=a();return e||E.recoverFromError(),e},E.getContactInfo=function(e,n){function i(e){if(200!==e.status)n();else{var t=JSON.parse(e.responseText);try{r.settings.set(Settings.lastContactSync,new Date(t.feed.updated.$t))}catch(i){r.reportError(i)}n(t)}}var o=E.getAccessToken();if(!o)return void n(void 0);var a=void 0,s="https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json";e?s+='&q="'+e+'"':a=r.settings.get(Settings.lastContactSync);var c=t.areLocalContactsLoaded()&&0===t.numContacts();if(a&&!c){var d=new Date(a);s+="&updated-min="+d.toString("yyyy-MM-ddTHH:mm:ss")}s+="&max-results=10000",s+="&access_token="+o,r.XHR({type:"GET",url:s,cb:i})},E.loadedContacts=!1,E.loadContacts=function(e){if(!E.loadedContacts){E.loadedContacts=!0,t.loadLocalContacts();var n=t.numContacts();E.getContactInfo(void 0,function(i){if(!i)return void e(-1);log("Loading Remote Contacts!",parseInt(i.feed.openSearch$totalResults.$t));var o=0,a=!1;if(i&&i.feed&&i.feed.entry&&i.feed.entry.length){r.vmMain.notifyContactsUpdated(),o=i.feed.entry.length;for(var s=i.feed.entry,c=0;c<s.length;c++){var d=s[c],l={id:/\/([^\s\/]+$)/gi.exec(d.id.$t)[1],text:""};if(d.gd$name&&d.gd$name.gd$fullName){var u=d.gd$name.gd$fullName.$t;l.text=u,"'"==l.text[0]&&(l.text=l.text.substr(1))}if(d.gd$email){var h=d.gd$email;l.emails=h;for(var p=0;p<h.length;p++)delete l.emails[p].rel,!l.text&&l.emails[p].primary&&(l.text=l.emails[p].address);!l.text&&h.length>0&&(l.text=l.emails[0].address)}if(d.gd$phoneNumber){var m=d.gd$phoneNumber;l.phoneNumbers=[];for(var p=0;p<m.length;p++){var f={number:m[p].$t};f.type=m[p].rel?m[p].rel.replace("http://schemas.google.com/g/2005#",""):m[p].label,l.phoneNumbers.push(f)}}if(l.text){if(d.link)for(var g=d.link,p=0;p<g.length;p++)if(g[p].type.startsWith("image")&&void 0!==g[p].gd$etag){var v=g[p].href;l.avatar=v}0===n?(t.addContact(l,!1),a=!0):a=t.updateContact(l,!1)||a}}}o>0&&t.saveContacts(),a&&t.sortContacts(),e&&e(o)})}},E.setDocInfo=function(e,t){r.settings.set(Settings.gdocId,e),r.settings.set(Settings.gdocTitle,t)},E.getDocId=function(){return r.settings.get(Settings.gdocId)},E.clearDocInfo=function(){r.settings.reset(Settings.gdocId),r.settings.reset(Settings.gdocTitle)};var _=M;E.recoverFromError=function(e){e&&(ShouldLog(LogLevels.Error)&&log("GDrive Error: ",e),r.reportError(e)),r.vmMain.setGDriveStatus(DriveStatus.Connecting),S(function(e){if(!e||e.error){r.messageQueue.pushMessage(MessageID.ConnectionError),r.vmMain.setGDriveStatus(DriveStatus.Offline);var t="Unable to refresh authentication token - ",n=!0;e?(t+=e.error,"immediate_failed"===e.error&&(n=!1)):t+="No Token",n&&r.reportError(new Error(t)),x>_&&(setTimeout(E.recoverFromError,_),_*=2)}})},E.getActiveUser=function(e){if(E.getAccessToken())if(E.authenticatedUserEmail())e&&e(E.authenticatedUserEmail());else{var t="https://www.googleapis.com/oauth2/v2/userinfo?alt=json&access_token="+E.getAccessToken();r.XHR({type:"GET",url:t,cb:function(t){if(200===t.status){var r=JSON.parse(t.responseText);E.authenticatedUserEmail(r.email)}e&&e(E.authenticatedUserEmail())}})}else e&&e(E.authenticatedUserEmail())};var N=!1;E.loadClientDefaultFile=function(){var e=!!r.vmMain,n=!!window.gapi&&!!window.gapi.drive&&!!window.gapi.drive.realtime;if(!N&&e&&n){var i=a();i&&r.getLoginState()==LoginState.LOGGED_IN&&(N=!0,r.vmMain.setGDriveStatus(DriveStatus.Connecting),E.getActiveUser(function(e){var n=r.settings.get(Settings.activeUser);n&&e&&e!==n?t.clearData(function(){r.reload()}):!n&&e&&r.settings.set(Settings.activeUser,e)}),m(),E.loadCalendarAndContacts())}},E.reconnectToActiveDocument=function(){var e=!!r.vmMain,t=!!window.gapi&&!!window.gapi.drive&&!!window.gapi.drive.realtime,n=r.getLoginState()==LoginState.LOGGED_IN,o=a();try{r.PAssert(1065,!i.isConnected(),"Should not try to reconnect if gdata is still connected")}catch(s){r.reportError(s)}e&&t&&n&&o&&(r.vmMain.setGDriveStatus(DriveStatus.Reconnecting),m())},E.authAndLoadContacts=function(e){r.settings.get(Settings.syncContacts)&&(I.indexOf(GScope.Contacts)<0?E.runAuthenticate([GScope.Contacts],!0,!0,function(t){!t||t.error?(I.push(GScope.Contacts),g(),r.messageQueue.pushMessage({text:"Contact sync is enabled but permissions have been lost, "+o.verb()+" here to find it again.",type:MessageType.Error,action:E.authAndLoadContacts}),e&&e(!1)):E.loadContacts(function(t){v(t),e&&t>0&&e(!0)})}):E.loadContacts(function(t){v(t),e&&t>0&&e(!0)}))},E.authDocSharing=function(){},E.loadCalendarAndContacts=function(){window.gapi&&E.authAndLoadContacts()},E.checkTokenInHash=function(){var e=!1;if(n.hasURLParam("access_token"))try{var t=n.getURLParam("scope"),i={access_token:n.getURLParam("access_token"),expires_in:n.getURLParam("expires_in"),scope:t.split("+")};gapi.auth.setToken(i),e=!0,n.removeURLParam("access_token",!0),n.removeURLParam("expires_in",!0),n.removeURLParam("scope",!0),n.removeURLParam("token_type",!0)}catch(o){r.reportError(o)}return e},E.runAuthenticate=function(e,t,i,a){if(!window.gapi||!window.gapi.auth)return a&&a(),!1;E.gapiLoaded||(r.fireCustomEvent("gapiLoaded"),E.gapiLoaded=!0);var s=void 0;try{s=gapi.auth.getToken()}catch(c){r.reportError(c)}var d;if(s){if(d=s.scope,!r.isArray(d)&&(r.reportError(new Error("Scopes are not an array: "+d)),r.isString(d)))try{d=s.scope.split(" ")}catch(c){r.reportError(c)}for(var l=0,u=0;u<e.length;++u)s.scope.indexOf(e[u])<0&&(d.push(e[u]),l++);0===l&&(d=[])}else d=e;if(d.length>0){d.indexOf(GScope.DriveFull)>=0&&d.remove(GScope.Drive);var h=E.authenticatedUserEmail()||r.settings.get("activeUser"),p={client_id:E.CLIENT_ID,scope:d,immediate:t,user_id:h,authuser:t?0:-1};o.requireCustomRedirect&&!t&&(p.redirect_uri=o.customRedirectString,o.customRedirectState&&(d.indexOf(GScope.Contacts)>=0&&(o.customRedirectState.syncContacts=!0),p.state=JSON.stringify(o.customRedirectState))),R=!0;gapi.auth.authorize(p,function(e){R=!1,(!e||e.error)&&t&&i?E.runAuthenticate(d,!1,!1,a):(e&&!e.error&&(o.app||n.hasURLParam("login","true"))&&(r.vmSetup?r.vmSetup.setLoginState(LoginState.LOGGED_IN):r.setLoginState(LoginState.LOGGED_IN),E.loadClientDefaultFile()),b(e,a))})}else ShouldLog(LogLevels.Error)&&log("Authorization request with no scopes: ",d),a&&a(s);return!0};var F=0,V=!1;E.isDriveAPILoaded=function(){return window.gapi&&window.gapi.client&&window.gapi.client.drive},E.isRealtimeAPILoaded=function(){return window.gapi&&window.gapi.client&&window.gapi.drive&&window.gapi.drive.realtime};var B=1e4,U=0,q=!1;return E.goOnline=function(){return U=2,E.isRealtimeAPILoaded()?(V=!1,setTimeout(w,2e3),!0):(q||(q=!0,setTimeout(T,2e3)),!1)},E.init(),E}),define("android",["ko","globals","platform"],function(e,t,r){var n,i,o,a,s,c={},d=!1,l=!1;c.isEnabled=function(){return l},c.getCurrentVMLI=function(){return s},c.getCurrentSpan=function(){return s?s.getSpan():void 0},c.isTargetBox=function(e){return a===(e.target||e.srcElement)},c.getInputBox=function(){return a},c.getSelectionStart=function(){return a.selectionStart},c.getSelectionEnd=function(){return a.selectionEnd},c.setPaneRoot=function(e){function u(){try{t.PAssert(1072,s,"VMLI must be selected in order to enforce selection offset")}catch(e){t.reportError(e)}try{t.PAssert(1073,c.getBoxHasTextSpace(),"Editor must always be prefixed with TextSpace")}catch(e){t.reportError(e)}0===a.selectionStart&&(a.selectionStart=1)}if(void 0===e.rootElement)return void(l=!1);if(l=!0,e.rootElement!==n){n=e.rootElement,i=e.scrollElement,o=e.paneContent,a=document.createElement("textarea"),a.id="androidInput",a.style.visibility="hidden",n.appendChild(a),a.onfocus=function(e){t.dragging||t.isKeyboardOpen||t.keyboardToolbar.show()},a.onblur=function(e){e.relatedTarget&&"searchPhone"!==e.relatedTarget.id||(c.finishInput(),t.keyboardToolbar.hide())};var h,p;a.oninput=function(e){try{t.PAssert(1070,s,"VMLI must be selected in order to get input events")
}catch(r){t.reportError(r)}if(s){var n=!c.getBoxHasTextSpace();if(n){h=h||require("edit"),p=p||require("tracker");try{t.PAssert(1071,h&&p,"Should always be defined")}catch(r){t.reportError(r)}p.beginAction(),h.handleBackspace(e,s.getSpan(),void 0),p.endAction()}}},r.ie||(a.ontouchend=function(){setTimeout(u,30)}),d=null!==a.selectionStart&&void 0!==a.selectionStart&&null!==a.selectionEnd&&void 0!==a.selectionEnd,log("---- Android Editing Enabled ----")}};var u=!1,h=!1;c.updateInput=function(e){try{t.PAssert(1074,c.isEnabled(),"Must be enabled to update input")}catch(r){t.reportError(r)}var n=window.getSelection(),i=void 0;if(n.rangeCount>0&&n.getRangeAt(0).startContainer.nodeType===Node.TEXT_NODE){var o=n.getRangeAt(0);i=t.getSelectOffsetsInSpan(e,e.getSpan(),o,!0)}var l=!1;h||(h=!0,l=!0,a.style.visibility="visible"),t.isKeyboardOpen||t.keyboardToolbar.show();var p=e!==s;(p||e&&e.isHeader()!==u)&&(s&&p&&c.finishInput(!0),s=e,u=e.isHeader(),c.updateInputText(e),c.updateInputBounds(e)),l&&a.focus(),void 0!==i&&d&&(a.selectionStart=i.start+1,a.selectionEnd=i.end+1)},c.updateInputText=function(e){if(e&&s&&e.id===s.id){var t=s.getParsedText();c.setBoxValue(t)}},c.insertText=function(e,t){var r=c.getBoxValue(),n=r.substr(0,e)+t+r.substr(e);c.setBoxValue(n),d&&(a.selectionStart=e+t.length+1,a.selectionEnd=e+t.length+1)},c.getInputText=function(){try{t.PAssert(1075,c.isEnabled(),"Must be enabled to get input")}catch(e){t.reportError(e)}try{t.PAssert(1076,s,"Android input must be active to get input text")}catch(e){t.reportError(e)}return s?c.getBoxValue():""};var p=0;return c.updateInputBounds=function(e){if(e&&s&&e.id===s.id){var r=e.getSpan(),n=r.getBoundingClientRect(),o=8,c=40,d=i.scrollTop;t.copyStyles(r,a,["paddingLeft","paddingTop","paddingRight","paddingBottom","width","height","fontSize","lineHeight"]),a.style.top=Math.ceil(n.top+d-c)+"px",a.style.marginLeft=o+"px",a.style.paddingLeft=parseInt(a.style.paddingLeft)-o+"px",p=a.scrollHeight}},c.checkAndroidBounds=function(){try{t.PAssert(1077,s,"When updating Android bounds we should always have a current VMLI")}catch(e){t.reportError(e)}var r=a.scrollHeight;if(r!==p){var n=c.getBoxValue();if(l=!1,s){s.getRawText()!==n&&s.setText(n,!0,!0);var i=window.getComputedStyle(s.getSpan());a.style.height=i?i.height:"16px"}l=!0,p=r}},c.flushInput=function(){var e=c.getBoxValue();s.getRawText()!==e&&s.setText(e,!0,!0)},c.finishInput=function(e){try{t.PAssert(1078,c.isEnabled(),"Must be enabled to finish input")}catch(r){t.reportError(r)}s&&(h&&!e&&(h=!1,a.style.visibility="hidden"),c.flushInput(),s=void 0)},c.getBoxHasTextSpace=function(){var e=a.value;if(0===e.length||e[0]!==TextSpace){try{t.PAssert(1079,e.indexOf(TextSpace)<0,"If TextSpace is not at the front of the editor, it shouldnt appear in the rest of the string")}catch(r){t.reportError(r)}return!1}return!0},c.getBoxValue=function(){var e=a.value,t=e.replace(TextSpace,"");return t},c.setBoxValue=function(e){e&&0!==e.length||(e=TextSpace);var t=e[0]===TextSpace?e:TextSpace+e;a.value=t},c.passKeypress=function(e){return s?e.normCode===KeyCode.Enter||e.synthetic?!0:!1:!1},c.passKeydown=function(e){return s?e.normCode===KeyCode.Tab||e.normCode===KeyCode.BackSpace||e.synthetic?!0:!1:!1},c}),define("VMLI_TapHandlers",["ko","globals","platform","android","tracker"],function(e,t,r,n){var i=18,o=36,a=void 0,s={dragStart:function(e){try{t.PAssert(1080,!r.mobile||!t.focusedPane.isTimeline(),"Should not be able to drag/drop on timeline on mobile")}catch(i){t.reportError(i)}try{t.PAssert(1081,t.startDrag,"Should always have a valid item to start dragging from")}catch(i){t.reportError(i)}t.clearSelection(),n.isEnabled()&&n.finishInput();var o=t.startDrag.getElement();t.startDrag=void 0;try{t.PAssert(1082,void 0===t.dragging,"Only one element may be dragged or dropped at a time")}catch(i){t.reportError(i)}try{t.PAssert(1083,void 0===t.draggingHidden,"Only one element may be dragged or dropped at a time")}catch(i){t.reportError(i)}try{t.PAssert(1084,!t.tempUL.hasChildNodes(),"TempUL should never have children when starting a drag")}catch(i){t.reportError(i)}t.draggingHidden=o,t.dragging=o.cloneNode(!0),t.tempUL.appendChild(t.dragging);var a=document.getElementById("container").scrollTop,s=e.eventY+a-(r.mobile?t.phoneMainY:0),c=t.width(o);t.dragStartInfo={x:e.eventX,y:e.eventY},t.tempUL.style.display="block",r.mobile||(t.tempUL.style.left=e.eventX-e.xFromTopLeft+"px"),t.tempUL.style.top=s-e.yFromTopLeft+"px",t.tempUL.style.width=c+"px",t.addClass(t.draggingHidden,"itemBeingDragged"),t.disableMouseMove=!0},dragMove:function(e){e.preventDefault();var n=r.mobile?0:e.eventX-t.dragStartInfo.x,i=e.eventY-t.dragStartInfo.y,o="translate3d("+n+"px, "+i+"px, 0)";t.tempUL.style[r.transform.style]=o;var s=document.elementFromPoint(e.eventX,e.eventY);a||(a={dropEffect:"move",item:this}),t.vmMain.handleDragOver({srcElement:s,dataTransfer:a,diffY:e.diffY,offsetY:e.eventY,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn})},dragEnd:function(e){r.ios&&t.preventClick(),t.disableMouseMove=!1;var n=t.dragging,i=t.draggingHidden;t.dragging=void 0,t.draggingHidden=void 0,t.removeClass(i,"itemBeingDragged"),n.parentNode.removeChild(n),t.tempUL.style.display="none",a||(a={dropEffect:"move",item:this}),t.vmMain.handleDrop({srcElement:e.srcElement,dataTransfer:a,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn}),a=void 0,r.ios&&t.preventClick(),t.disableMouseMove=!1},onStart:function(e){t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.scrollAtTouchStart=t.focusedPane.getScrollOffset(),t.canRevealMenu=!0,t.isKeyboardOpen&&(t.revealTimeout=setTimeout(function(){t.canRevealMenu=!1},400)),!r.mobile||r.ie||"UL"===e.srcElement.tagName||t.isKeyboardOpen||t.focusedPane.isTimeline()?"SPAN"===e.srcElement.tagName&&e.offsetX<=i&&(t.clearSelection(),t.startDrag=this,e.preventDefault(),e.stopImmediatePropagation()):t.dragStartTimeout=setTimeout(function(){t.clearSelection(),t.startDrag=this,this.dragStart(e),this.dragMove(e)}.bind(this),500)},onMove:function(e){t.revealTimeout&&(clearTimeout(t.revealTimeout),t.revealTimeout=void 0),this.isItemMenuOpen?e.preventDefault():t.startDrag&&(!r.touch||Math.abs(e.distanceY)>t.ClickThreshold&&Math.abs(e.distanceX)<t.ClickThreshold)&&t.startDrag===this&&this.dragStart(e),t.dragging?this.dragMove(e):r.touch&&t.canRevealMenu&&!t.focusedPane.isTimeline()&&(t.revealingMenu||t.revealingRightMenu||e.distanceY<t.ClickThreshold&&Math.abs(e.diffX)>t.ClickThreshold)&&(t.revealingMenu||t.menus.revealGestureMenu(this,e),t.menus.updateRevealGestureMenu(e),e.preventDefault())},onClick:function(e){if(r.mobile&&t.phoneMenu.multiSelectMode())t.menus.multiSelect(this);else if("SPAN"===e.srcElement.tagName&&e.offsetX<=i)this.isComplete()||t.messageQueue.pushMessage({text:"You completed an item, click again to undo",type:MessageType.Info,timeout:3e3}),this.isComplete(!this.isComplete());else if("LI"===e.srcElement.tagName&&this.isCollapsed()&&e.offsetX>=t.focusedPane.getWidth()-o)this.toggleCollapsed();else if(t.hasClass(e.srcElement,"tag")&&!r.mobile){if(r.mac&&e.metaKey||!r.mac&&e.ctrlKey){var a=e.srcElement.textContent;e.shiftKey?t.focusedPane.vmSearch.setSearch(a):t.focusedPane.vmSearch.addToSearch(a)}}else if(t.hasClass(e.srcElement,"contact")){var s=t.getOffsetOfSubNode(this.getSpan(),e.srcElement);t.autocomplete.update({item:this,start:s+1}),t.autocomplete.show(this,e.srcElement),e.preventDefault(),r.ios&&t.preventClick()}else if("itemOptions"===e.startSrc.id)t.itemMenuOpenedOn==this&&(t.itemMenuOpenedOn=void 0);else if("A"===e.srcElement.tagName){if(r.mac&&e.metaKey||!r.mac&&e.ctrlKey){var s=t.offset(e.srcElement);open(e.srcElement.href,"link"+e.srcElement.href)}}else{if(t.autocomplete&&t.autocomplete.hide(),r.ios||r.android||r.mobileie){var c=document.activeElement,d=t.focusedPane.getScrollOffset(),l=Math.abs(d-t.scrollAtTouchStart)>0;if(t.isKeyboardOpen&&c&&"searchPhone"!=c.id||l||t.focusedPane.isTimeline())r.mobileie&&n.isEnabled()&&n.updateInput(this);else{var u=this;r.mobile&&this==t.focusedPane.item()&&(u=t.getLastVisibleItem(t.focusedPane.item()));try{t.PAssert(1085,u,"Click on item should not happen")}catch(h){t.reportError(h)}r.ios&&t.vmMain.setSelected([u]),t.openKeyboardOn(e,u.getSpan(),!0,function(){t.selectChildren(u,u.getParsedText().length,0)})}}else!r.mobile;if(t.focusedPane.isTimeline()&&t.hasClass(e.srcElement,"text")){for(var p=0;p<this.elements.length;++p){var m=(this.getSpan(p),t.vmMain.panes()[p]);m&&m.vmSearch.isVisible(this)&&t.scrollIntoView(this.getSpan(p),200)}this.highlight(),t.sendEvent("Menu","GoTo")}}},onDblClick:function(e){if(t.hasClass(e.srcElement,"text")&&r.mobile){try{t.PAssert(1086,t.phoneMenu,"Phone menu should always be available on mobile")}catch(n){t.reportError(n)}t.phoneMenu.toggleMode(),e.preventDefault();for(var i=0;i<this.elements.length;++i)t.scrollIntoView(this.getSpan(i),200);this.highlight(),t.sendEvent("PhoneMenu","GoTo")}},onEnd:function(e){t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.startDrag=void 0,t.itemMenuOpenedOn==this&&t.menus.menuItemSelected(e.srcElement),(t.revealingMenu||t.phoneMenu&&t.phoneMenu.multiSelectMode())&&(e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0,r.ios&&t.preventClick()),t.revealingMenu&&t.menus.stopRevealGestureMenu(e);t.dragging&&this.dragEnd(e)},onRightClick:function(e){!e.stopPropagation||!e.preventDefault,t.menus.openItemMenu(this,e),e.preventDefault(),e.stopPropagation()},onAutocompleteTapped:function(e,r){var e=this.getParsedText().substr(0,r.index)+e+this.getParsedText().substr(r.index+r.length);this.setText(e,!0),t.selectChildren(this,r.index+e.length,0)}};return s}),this.document&&(window.helperWrapper=DuchessHelpersWrapper),this.helperLibLoaded||DuchessHelpersWrapper(this.DuchessHelpers=this.DuchessHelpers||{}),define("DuchessHelpers",function(){}),define("VMLI_Text",["ko","data","gdata","globals","tracker","android","DuchessHelpers"],function(e,t,r,n,i,o){var a={_runAndGetSaveData:function(e,t){var r=this.getMetaTextSaveData();this.setRawText(e),this.parseText(t);var n=this.getMetaTextSaveData(),i={};for(var o in n)r[o]!==n[o]&&(i[o]=n[o]);return i},setText:function(e,t,n){var i=this._runAndGetSaveData(e,t);i.text=e,r.saveChanges(this,i),i.dateText=this.dateText,this.save(i,SaveFlag.Text),t&&!n&&o.isEnabled()&&o.updateInputText(this)},parseText:function(e){var r=void 0;e&&(r=DuchessHelpers.parseText(this.getRawText(),this.getDateTime(),this.isLoaded,t.getContacts()),r.numContacts>0&&i.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddContact,data:[{itemID:this.id}]})),this.styleText(r,e)},styleText:function(e,t,r){try{n.PAssert(1087,!(!e&&t),"In a full parse, styleInfo should always be defined")}catch(i){n.reportError(i)}var o,a=!1;if(e){if(o=void 0!==e.styledText?e.styledText:void 0!==e.text?e.text:this.getRawText(),t&&this.setParsedText(e.parsedText),e.dates){0===e.dates.length&&this.date()&&this.date()&&(this.allDayDate=void 0,this.dateText=void 0,this.date(null),r&&(a=!0,r.date=void 0,r.dateText=void 0,r.allDayDate=void 0));for(var s=0;s<e.dates.length;s++){var c=e.dates[s];this.dateText!==c.text&&(this.dateText=c.text,r&&(a=!0,r.dateText=c.text)),c.date&&this.date()&&c.date==this.date()||(!!c.date^!!this.date()||this.date()&&c.date.getTime()!==this.date().getTime())&&(c.explicitTime&&(c.date._explicitTime=c.explicitTime),this.allDayDate=!c.date._explicitTime,this.date(c.date),r&&(a=!0,r.date=c.date,r.allDayDate=c.date._explicitTime))}}else this.date()&&t&&(this.dateText=void 0,this.allDayDate=void 0,this.date(null),r&&(a=!0,r.date=void 0,r.dateText=void 0,r.allDayDate=void 0));this.isStyled=e.hasStyle}else o=this.getRawText();return 0===o.length&&(o=TextSpace,t=!0),this.setStyledText(o),a},checkFormats:function(e,t,r){try{n.PAssert(1088,!1,"No formats")}catch(i){n.reportError(i)}return!1},toggleFormat:function(e,t){try{n.PAssert(1089,!1,"No formats")}catch(r){n.reportError(r)}return!1},clearFormats:function(){try{n.PAssert(1090,!1,"No formats")}catch(e){n.reportError(e)}return!1},areFormatsEqual:function(e,t){try{n.PAssert(1091,!1,"No formats")}catch(r){n.reportError(r)}return!0},setFormats:function(e,t){try{n.PAssert(1092,!1,"No formats")}catch(r){n.reportError(r)}return!1},appendFormats:function(e,t){try{n.PAssert(1093,!1,"No formats")}catch(r){n.reportError(r)}return!1},getFormatsAfter:function(e){try{n.PAssert(1094,!1,"No formats")}catch(t){n.reportError(t)}return!1},removeFormatsAfter:function(e){try{n.PAssert(1095,!1,"No formats")}catch(t){n.reportError(t)}return!1},transformFormats:function(e,t){try{n.PAssert(1096,!1,"No formats")}catch(r){n.reportError(r)}return!1},saveFormats:function(e){try{n.PAssert(1098,!1,"No formats")}catch(t){n.reportError(t)}return!1}};return a}),define("VMLI_Drive",["globals","data","gdata","tracker"],function(e,t,r,n){var i=function(i){function o(e){r.cacheItem(e),a(r.get(e,"items")),a(r.get(e,"archivedItems"))}function a(r){if(r)for(var n=0;n<r.length;++n){var i=r.get(n);try{e.PAssert(1100,i,"Item must exist to get it from the array")}catch(a){e.reportError(a)}if(i){var s=t.getModel(i.id);s?s.linkToGDrive(i):o(i)}else r.remove(n),n--}}return{linkToGDrive:function(t,n){try{e.PAssert(1101,t,"Must be passing in valid data")}catch(i){e.reportError(i)}this.data||(this.data=t,r.cacheItem(t),this.setRemoteVersion(VersionType.Structure,r.getVersion(t,VersionType.Structure)),this.setRemoteVersion(VersionType.Text,r.getVersion(t,VersionType.Text)),n&&(this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text))),a(r.get(t,"items")),a(r.get(t,"archivedItems")))},resetModified:function(){var t;try{e.PAssert(1102,this.data,"Can only reset modified if remote data exists")}catch(r){e.reportError(r)}var n=!1,i={};if(!this.modifiedOffline&&this.isRemoteVersionNewer(VersionType.Structure)){var o=this.getRemoteVersion(VersionType.Structure);this.setVersion(VersionType.Structure,o),i.version=o,n=!0}else this.modifiedOffline&&(i.modifiedOffline=!1,n=!0);if(!this.modifiedOfflineText&&this.isRemoteVersionNewer(VersionType.Text)){var a=this.getRemoteVersion(VersionType.Text);this.setVersion(VersionType.Text,a),i.versionText=a,n=!0}else this.modifiedOfflineText&&(i.modifiedOfflineText=!1,n=!0);n&&this.save(i,SaveFlag.None),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0);var s=this.items();for(t=0;t<s.length;++t)s[t].resetModified();if(this.hasArchivedChildren()){var c=this.archivedItems(!0);for(t=0;t<c.length;++t)c[t].resetModified()}},initFromGDrive:function(t,n){try{e.PAssert(1105,t,"To initialize from gdrive a valid remote data object must be passed in")}catch(i){e.reportError(i)}if(!t)return void e.reportError(new Error("FATAL ERROR - No remote data for item"));this.data=t;var o=void 0===this.id||this.forceModifiedItems,a=o?void 0:{},s=!1;this.id=t.id;try{s=this.resolveText(a)||s,s=this.resolveMisc(a)||s,s&&(e.vmMain.addParseItem(this,!0),e.vmMain.addModifiedItem(this)),this.resolveItems(a,n)}catch(c){if(e.reportError(c),REPORT_ACTIONS)try{e.reportAction(RATAG.R,ResolveAction.Error,{msg:c.message,stacK:c.stack,item:this.getDebugData()})}catch(d){e.reportActionCrash(d)}}if(o){try{e.PAssert(1108,void 0===a,"If doing a full save, remoteChanges should always be undefined")}catch(i){e.reportError(i)}this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text)),this.save(null,SaveFlag.None)}else e.isEmpty(a)||(a.isDeleted!==!0&&(a.isDeleted=void 0),this.save(a,SaveFlag.None));r.attachEventsToItem(this)},resolveText:function(t){var n=!1;if(this.modifiedOfflineText&&!this.forceModifiedItems)if(this.isLocalVersionNewer(VersionType.Text)){if(REPORT_ACTIONS)try{e.reportAction(RATAG.A,ResolveAction.SetRemoteText,{text:this.getParsedText(),item:this.getDebugData()})}catch(o){e.reportActionCrash(o)}r.saveChanges(this,{text:this.getParsedText()})}else{var a=r.get(this.data,"text");try{e.PAssert(1109,void 0!==a,"Every item should have text associated with it from gdrive")}catch(s){e.reportError(s)}var c=this.getRawText(),d=!1;if(c!==a&&(d=!0),d){var l=this.getIndex(),u=new i({text:this.getParsedText()},{parent:this.parent(),forceSave:!0});if(this.parent().insertItem(u,l+1),this.setText(a,!0),REPORT_ACTIONS)try{e.reportAction(RATAG.B,ResolveAction.DupeItem,{remoteText:a,localText:this.getParsedText(),prevItem:this.getDebugData(),newItem:u.getDebugData()})}catch(o){e.reportActionCrash(o)}t&&(t.text=this.getParsedText()),n=!0}else t&&(t.modifiedOfflineText=!1);t&&(t.versionText=this.getRemoteVersion(VersionType.Text))}else if(this.isRemoteVersionNewer(VersionType.Text)){var a=r.get(this.data,"text");try{e.PAssert(1110,void 0!==a,"Every item should have text associated with it from gdrive")}catch(s){e.reportError(s)}if(this.getRawText()!=a){if(REPORT_ACTIONS)try{e.reportAction(RATAG.C,ResolveAction.SetLocalText,{oldText:this.getRawText(),newText:a,item:this.getDebugData()})}catch(o){e.reportActionCrash(o)}this.setRawText(a),t&&(t.text=this.getRawText()),n=!0}t&&this.getVersion(VersionType.Text)!==this.getRemoteVersion(VersionType.Text)&&(t.versionText=this.getRemoteVersion(VersionType.Text))}return n},resolveMisc:function(t){var n=this.modifiedOfflineText&&this.isLocalVersionNewer(VersionType.Text),i=!1,o=!1;if(n||this.isRemoteVersionNewer(VersionType.Structure)||this.isRemoteVersionNewer(VersionType.Text)){var a={},s=r.get(this.data,"date");if(s||this.date()){this.date()&&this.date().getTime()===s||(n&&this.date()?(a.date=this.date().getTime(),o=!0):(this.date(new Date(s),!0),this.date()._explicitTime=!!this.allDayDate,t&&(t.date=this.date().getTime()),i=!0));var c=r.get(this.data,"allDayDate");c&&this.allDayDate!==c&&(n?(a.allDayDate=this.allDayDate,o=!0):(this.allDayDate=c,t&&(t.allDayDate=c)))}try{e.PAssert(1111,void 0===this.allDayDate||void 0!==this.date(),"Cannot have an alldaydate with no date specified")}catch(d){e.reportError(d)}var l=r.get(this.data,"dateCreated");if(!this.dateCreated||!l||this.dateCreated.getTime()!==l)if(n)a.dateCreated=this.dateCreated?this.dateCreated.getTime():void 0,o=!0;else{var u=l;try{e.PAssert(1112,"string"!=typeof l,"Invalid date format stored")}catch(d){e.reportError(d)}this.dateCreated=new Date(u),t&&(t.dateCreated=u)}var h=r.get(this.data,"dateCompleted");if(!(!h&&!this.dateCompleted||this.dateCompleted&&h&&this.dateCompleted.getTime()===h))if(n)a.dateCompleted=this.dateCompleted?this.dateCompleted.getTime():void 0,o=!0;else{var u=h;try{e.PAssert(1113,"string"!=typeof h,"Invalid date format stored")}catch(d){e.reportError(d)}this.dateCompleted=new Date(u),t&&(t.dateCompleted=u)}var p=r.get(this.data,"priority");(p||this.priority())&&this.priority()!==p&&(n?(a.priority=this.priority(),o=!0):(null===p&&(p=VMLIFlag.None),this.priority(p,!0)));var m=r.get(this.data,"isFlagged");(m||this.isFlagged())&&this.isFlagged()!==m&&(n?(a.isFlagged=this.isFlagged(),o=!0):(null===m&&(m=!1),this.isFlagged(m,!0)));var f=r.get(this.data,"isComplete");if((f||this.isComplete())&&this.isComplete()!==f&&(n?(a.isComplete=this.isComplete(),o=!0):(null===f&&(f=!1),this.isComplete(f,!0))),n){try{e.PAssert(1114,o===!e.isEmpty(a),"Verify modLocal is computed properly. It should track any changes to localChanges")}catch(d){e.reportError(d)}o===!0&&r.saveChanges(this,a)}}return i},resolveItemsHelper:function(n,o,a){var s,c,d,l,u,h,p,m=r.getItemList(this.data,n);p=n?this.hasArchivedChildren()?this.archivedItems(!0):[]:this.items();try{e.PAssert(1115,p,"Item arrays must exist")}catch(f){e.reportError(f)}for(s=0;m&&s<m.length;s++)if(c=m.get(s)){try{e.PAssert(1117,void 0===r.loadSeen[c.id]||r.loadSeen[c.id]===!1,"Items can only be seen once on the remote.")}catch(f){e.reportError(f)}r.loadSeen[c.id]=this.id;var d=this.getIndexOf(c.id,n);if(d>=0)u=p[d],u.initFromGDrive(c);else if(l=t.getItem(c.id),u=t.getModel(c.id),l)if(l.isDeleted){try{e.PAssert(1118,!u,"The local model should never exist when an item has been marked as deleted locally")}catch(f){e.reportError(f)}try{e.PAssert(1119,l.modifiedOffline,"How did it get deleted if it wasn't modified offline?")}catch(f){e.reportError(f)}if(r.getVersion(c,VersionType.Structure)==l.version){if(r.itemRemoved({item:this,index:s,numToRemove:1,isArchived:n}),REPORT_ACTIONS)try{e.reportAction(RATAG.E,ResolveAction.RemoveRemoteItem,{item:this.getChild(s).getDebugData(),parent:this.getDebugData(),index:s,isArchived:n})}catch(g){e.reportActionCrash(g)}s--}else{try{e.PAssert(1120,!u,"The local model should never exist when an item has been marked as deleted locally")}catch(f){e.reportError(f)}if(t.undeleteItem(l),u=new i({data:c,isArchived:n},{parent:this,parse:a,forceSave:!0}),p.splice(s,0,u),h=!0,REPORT_ACTIONS)try{e.reportAction(RATAG.F,ResolveAction.AddBackDeletedItem,{item:u.getDebugData(),parent:this.getDebugData(),index:s,isArchived:n})}catch(g){e.reportActionCrash(g)}e.vmMain.addModifiedItem(u)}}else if(u&&u.modifiedOffline)if(u.isLocalVersionNewer(VersionType.Structure)){if(REPORT_ACTIONS)try{e.reportAction(RATAG.G,ResolveAction.LocalMoveCandidate,{item:u.getDebugData(),parent:this.getDebugData(),index:s,isArchived:n})}catch(g){e.reportActionCrash(g)}try{e.PAssert(1121,r.loadSeen[c.id]===this.id)}catch(f){e.reportError(f)}r.loadSeen[c.id]=!1}else{if(REPORT_ACTIONS)try{e.reportAction(RATAG.H,ResolveAction.MoveLocalItem,{item:u.getDebugData(),oldParent:u.parent(),oldIndex:u.getIndex(),newParent:this.getDebugData(),newIndex:s,isArchived:n})}catch(g){e.reportActionCrash(g)}u.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:n}),u.initFromGDrive(c),h=!0,e.vmMain.addModifiedItem(u)}else if(u){if(REPORT_ACTIONS)try{e.reportAction(RATAG.I,ResolveAction.MoveLocalItem,{item:u.getDebugData(),oldParent:u.parent().getDebugData(),oldIndex:u.getIndex(),newParent:this.getDebugData(),newIndex:s,isArchived:n})}catch(g){e.reportActionCrash(g)}u.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:n}),u.initFromGDrive(c),h=!0,e.vmMain.addModifiedItem(u)}else{if(REPORT_ACTIONS)try{e.reportAction(RATAG.Q,ResolveAction.Error,{msg:"Local model does not exist for local item that was not deleted",item:u.getDebugData(),localIndex:s,data:l})}catch(g){e.reportActionCrash(g)}e.reportError(new Error("Local model does not exist for local item that was not deleted."))}else{if(u=new i({data:c,isArchived:n},{parent:this,parse:a}),p.splice(s,0,u),h=!0,REPORT_ACTIONS)try{e.reportAction(RATAG.D,ResolveAction.AddLocalItem,{item:u.getDebugData(),parent:this.getDebugData(),index:s,isArchived:n})}catch(g){e.reportActionCrash(g)}e.vmMain.addModifiedItem(u)}}else try{e.PAssert(1116,c,"Item in remote list does not exist")}catch(f){e.reportError(f)}if(t.hasLocalData){for(s=0;s<p.length;s++)if(u=p[s],r.loadSeen[u.id]!==this.id)if(c=u.data){if(u.modifiedOffline&&u.isLocalVersionNewer(VersionType.Structure)){var v=r.findInTree(c);try{e.PAssert(1128,v,"Item should be found in tree")}catch(f){e.reportError(f)}if(v){if(REPORT_ACTIONS)try{var y=t.getModel(v.parent.id);e.reportAction(RATAG.M,ResolveAction.MoveRemoteItem,{item:u.getDebugData(),oldParent:y?y.getDebugData():void 0,oldIndex:v.index,newParent:u.parent().getDebugData(),newIndex:s,isArchived:n})}catch(g){e.reportActionCrash(g)}r.itemMoved({item:u,newInfo:{index:s,isArchived:n},oldParent:v.parent,oldInfo:v})}else if(REPORT_ACTIONS)try{e.reportAction(RATAG.N,ResolveAction.Error,{msg:"Item not found in local tree",item:u.getDebugData(),localIndex:s,data:l})}catch(g){e.reportActionCrash(g)}u.initFromGDrive(c)}}else if(u.modifiedOfflineText){var b,S=[];if(n?u.hasArchivedChildren()&&(b=u.archivedItems(!0)):b=u.items(),b)for(var T=0;T<b.length;++T)if(b[T].data&&b[T].isLocalVersionNewer(VersionType.Structure)){var v=r.findInTree(b[T].data);try{e.PAssert(1123,v,"Item should be found in tree")}catch(f){e.reportError(f)}v&&S.push({parent:v.parent,child:b[T]})}if(t.initializeItem(u),r.itemAdded({item:this,addedItem:u,index:s,isArchived:n}),REPORT_ACTIONS)try{e.reportAction(RATAG.J,ResolveAction.AddRemoteItem,{item:u.getDebugData(),parent:this.getDebugData(),index:s,isArchived:n})}catch(g){e.reportActionCrash(g)}for(var T=0;T<S.length;++T){var w=S[T];try{e.PAssert(1124,w,"Must have valid data to remove")}catch(f){e.reportError(f)}var E=w.child.isArchived(),M=r.getItemList(w.parent,E);try{e.PAssert(1125,M,"The item has children, it must have a list")}catch(f){e.reportError(f)}var x=M.indexOf(w.child.data);try{e.PAssert(1126,x>=0,"Remote item must be in the parents list")}catch(f){e.reportError(f)}if(r.itemRemoved({item:w.parent,index:x,numToRemove:1,isArchived:E}),REPORT_ACTIONS)try{e.reportAction(RATAG.K,ResolveAction.RemoveRemoteItem,{item:w.child.getDebugData(),parent:t.getModel(w.parent.id).getDebugData(),index:x,isArchived:E})}catch(g){e.reportActionCrash(g)}}u.initFromGDrive(u.data)}else{if(REPORT_ACTIONS)try{e.reportAction(RATAG.L,ResolveAction.DeleteLocalItem,{item:u.getDebugData(),parent:this.getDebugData(),index:u.getIndex(),isArchived:n})}catch(g){e.reportActionCrash(g)}try{e.PAssert(1127,t.getItem(u.id),"Trying to delete an item locally that doesn't exist locally")}catch(f){e.reportError(f)}this.deleteChild(u),s--,h=!0,e.vmMain.addModifiedItem(u)}if(!n&&m&&(m.length>0||p.length>0)){var C=[],I=void 0,A=[],P=m.asArray(),D=!1;for(s=0;s<P.length;++s){var k=P[s].id,O=t.getModel(k);try{e.PAssert(1129,O,"If the remote ID exists the local item should have been created.")}catch(f){e.reportError(f)}var d=this.getIndexOf(k);O&&O.modifiedOffline&&O.isLocalVersionNewer(VersionType.Structure)?d>=0?C.push(d):(I||(I=[]),log(this.id+": Item in remote array not found in local array: ",k),I.push(k)):d>=0?(A.push(k),d!==s&&(D=!0)):(I||(I=[]),log(this.id+": Item in remote array not found in local array: ",k),I.push(k))}if(D||C.length>0){for(C.sort(),s=0;s<C.length;s++){var l=p[C[s]];l&&A.splice(C[s],0,l.id)}I&&I.length>0&&(A=A.concat(I));for(s=0;s<A.length;++s)for(var L=A[s],T=s;T<m.length;++T){var R=m.get(T);if(L===R.id){if(s!==T){var _=t.getModel(R.id);if(REPORT_ACTIONS)try{e.reportAction(RATAG.O,ResolveAction.MoveRemoteItem,{item:_.getDebugData(),oldParent:this.getDebugData(),oldIndex:T,newParent:_.parent().getDebugData(),newIndex:s,isArchived:!1})}catch(g){e.reportActionCrash(g)}var N={index:T,isArchived:!1},F={index:s,isArchived:!1};r.itemMoved({item:_,newInfo:F,oldParent:this,oldInfo:N}),h=!0,e.vmMain.addModifiedItem(_)}break}}for(s=0;s<A.length;++s)for(var L=A[s],T=s;T<p.length;++T){var R=p[T];if(L===R.id){if(s!==T){if(REPORT_ACTIONS)try{e.reportAction(RATAG.P,ResolveAction.MoveLocalItem,{item:R.getDebugData(),oldParent:R.parent().getDebugData(),oldIndex:R.getIndex(),newParent:this.getDebugData(),newIndex:s,isArchived:!1})}catch(g){e.reportActionCrash(g)}R.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:!1}),h=!0,e.vmMain.addModifiedItem(R)}break}}}}}if(h){if(t.hasLocalData&&(n?this.hasArchivedChildren()&&this.archivedItems().valueHasMutated():this.items.valueHasMutated()),n&&!this.hasArchivedChildren()){try{e.PAssert(1134,p.length>0,"If saving an archive array it should have data in it")}catch(f){e.reportError(f)}this.archivedItems()(p)}o&&(o.items=this.getItemsArrayForSave())}},resolveItems:function(e,t){this.resolveItemsHelper(!1,e,t),this.resolveItemsHelper(!0,e,t)},onValueChanged:function(t){if(!t.isLocal||n.undoRedoActive){var i=e.translateFieldOut(t.property);if(this.id===t.target.id)switch(i){case"version":case"versionText":var o=r.get(this.data,i);if(o>this[i]||void 0===this[i]){var a={modifiedOffline:!1};a[i]=this[i]=o,this.save(a,SaveFlag.None)}break;case"formats":var s=JSON.parse(JSON.stringify(r.get(this.data,"formats")));s||(s=[]),this.setFormats(s,!0);break;case"priority":this.priority(t.newValue,!0);break;case"isComplete":this.isComplete(t.newValue,!0);break;case"isFlagged":this.isFlagged(t.newValue,!0);break;case"dateCompleted":this.dateCompleted=new Date(t.newValue),this.save({dateCompleted:t.newValue},SaveFlag.None);break;case"isArchived":this.isArchived(t.newValue),this.save({isArchived:t.newValue},SaveFlag.None);break;case"date":this.date(new Date(t.newValue)),this.save({date:t.newValue},SaveFlag.None);break;case"allDayDate":this.allDayDate=t.newValue,this.save({allDayDate:t.newValue},SaveFlag.None);break;case"items":case"archivedItems":var c=!("items"===i);if(t.newValue){for(var d=0;d<t.newValue.length;++d)this.addRemoteItem(t.newValue.get(d),d,c);r.attachEventsToItem(this)}else{try{e.PAssert(1136,0===t.oldValue.length,"Expected no items in list")}catch(l){e.reportError(l)}this.removeAllRemoteItems(c)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None);break;case"dateCreated":break;case"text":this.onTextChanged(t);break;default:ShouldLog(LogLevels.Error)&&log("Unhandled value changed remotely: ",i,t)}}},onTextChanged:function(t){if(!t.isLocal||n.undoRedoActive){var i=r.get(this.data,"text");if(i!=this.getRawText()&&(this.setRawText(i),this.parseText(!0),this.save({text:this.getRawText()},SaveFlag.None),n.undoRedoActive)){var o=TrackerType.SetText;n.notifyStateChangedFromUndoRedo(o,{itemID:this.id,position:e.findFirstDiff(t.newValue,t.oldValue),text:t.newValue})}}},addRemoteItem:function(o,a,s){var c=o.id;r.cacheItem(o);var d=s?this.archivedItems():this.items;if(!(a<d().length&&d()[a].id===c)){var l=t.getModel(c);l?(clearTimeout(l.deleteTimeout),l.deleteTimeout=void 0):l=new i({data:o},{parent:this,parse:!0}),l.isDeleted&&(l.isDeleted=!1,l.save(null,SaveFlag.None)),l.isArchived()!==s&&(l.isArchived(s),l.save({isArchived:s},SaveFlag.None)),l.parent(this),d.splice(a,0,l),e.fireCustomEvent("itemAdded",{item:l,force:!0}),e.timeline.notifyStateChanged(l),n.undoRedoActive&&n.notifyStateChangedFromUndoRedo(TrackerType.Create,{itemID:l.id,parent:this.id,position:a,text:r.get(o,"text")})}},removeAllRemoteItems:function(e){e?this.hasArchivedChildren()&&this.archivedItems()([]):this.items([])},removeRemoteItem:function(t,r,i,o){var a;if(i){try{e.PAssert(1137,this.hasArchivedChildren(),"Must have a valid item list to remove from")}catch(s){e.reportError(s)}a=this.archivedItems()}else a=this.items;var c=a()[r];if(c&&c.id===t.id){try{e.PAssert(1138,c,"Expect a valid local item to remove")}catch(s){e.reportError(s)}try{e.PAssert(1139,t.id==c.id,"Remote item should match local items")}catch(s){e.reportError(s)}n.undoRedoActive&&n.notifyStateChangedFromUndoRedo(TrackerType.Delete,{itemID:c.id,parent:this.id,position:r,previous:e.getPreviousItem(c).id}),a.splice(r,1),c.deleteTimeout=o?setTimeout(c.deleteFromServer.bind(c),2e3):setTimeout(c.markDeleted.bind(c),2e3)}},onListAdded:function(t){if(!t.isLocal||n.undoRedoActive){var i=!1,o=r.get(this.data,"items");if(!o||t.target.id!==o.id){var a=r.get(this.data,"archivedItems");(a&&t.target.id===a.id||!o)&&(i=!0)}var s,c,d;t.values.length>0?(c=t.index,d=c+t.values.length,s=function(e){return t.values[e]}):(c=0,d=t.target.length,s=function(e){return t.target.get(e)});for(var l=c;d>l;++l){var u=l-c,h=s(u);try{e.PAssert(1140,h,"Always expect a valid item at each index")}catch(p){e.reportError(p)}this.addRemoteItem(h,l,i)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None)}},onListRemoved:function(t){if(!t.isLocal||n.undoRedoActive){var i,o=!1,a=r.get(this.data,"items");if(!a||t.target.id!==a.id){var s=r.get(this.data,"archivedItems");s&&t.target.id===s.id&&(o=!0)}for(var c=t.index,d=c+t.values.length,l=d-1;l>=c;l--){var u=l-c;try{e.PAssert(1142,!!t.values[u],"Always expect a valid item at each index")}catch(h){e.reportError(h)}var i=t.values[u],p=t.isLocal&&n.undoRedoActive;this.removeRemoteItem(i,l,o,p)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None)}},onListSet:function(t){try{e.PAssert(1143,!1,"What? This shouldn't happen!",t)}catch(r){e.reportError(r)}},onObjectChanged:function(t){if(t.ocHandled)return!1;if(t.ocHandled=this.id,t.stopPropagation(),t.isLocal&&!n.undoRedoActive)return!1;
for(var r=0;r<t.events.length;++r)switch(t.events[r].type){case gapi.drive.realtime.EventType.TEXT_DELETED:this.onTextChanged(t.events[r]);break;case gapi.drive.realtime.EventType.TEXT_INSERTED:this.onTextChanged(t.events[r]);break;case gapi.drive.realtime.EventType.VALUES_ADDED:this.onListAdded(t.events[r]);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:this.onListRemoved(t.events[r]);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:this.onValueChanged(t.events[r]);break;case gapi.drive.realtime.EventType.VALUES_SET:try{e.PAssert(1144,!1,"VALUES_SET should never be triggered")}catch(i){e.reportError(i)}break;default:try{e.PAssert(1145,!1,"Unexpected event type")}catch(i){e.reportError(i)}}return!1},deleteFromServer:function(){t.dbDeleteItem(this.id)},markDeleted:function(){t.deleteItem(this),e.timeline.notifyStateChanged(this)}}};return i}),define("sounds",["globals","platform"],function(e){function t(e,t){var r=document.createElement("source");r.src=t,e.appendChild(r)}var r={},n={};return r.add=function(e){if(r[e]=e,!n[e]){var i=document.createElement("audio");t(i,"sounds/"+e+".mp3"),i.preload="auto",n[e]=i}},r.play=function(t){if(!e.settings.get(Settings.noSounds)){if(!n[t])return log("Tried to play a sound that has not been loaded:",t),void console.trace();try{n[t].play()}catch(r){log("Failed to play audio",r)}}},r}),define("VMLI",["ko","globals","platform","data","gdata","VMLI_TapHandlers","VMLI_Text","VMLI_Drive","tracker","sounds"],function(e,t,r,n,i,o,a,s,c){function d(r,i){if(!r.id&&r.data&&r.data.id)r.id=r.data.id;else if(r.id&&r.data)try{t.PAssert(1146,r.id==r.data.id,"If passing in a local id and a remote ID, they should match")}catch(o){t.reportError(o)}if(r.id&&n.getModel[r.id]){ShouldLog(LogLevels.Warning)&&log("Attempting to create an already created VMLI: ",r.id);try{t.PAssert(1147,!1,"Should not be constructing a VMLI here")}catch(o){t.reportError(o)}return n.getModel[r.id]}try{t.PAssert(1148,void 0===r.v,"We should never be passing in 'v'")}catch(o){t.reportError(o)}try{t.PAssert(1149,void 0===r.extern,"We should never be passing in 'extern'")}catch(o){t.reportError(o)}this._parent=i?i.parent:void 0,this._rawText=r.data?"":r.text,this._searchText=r.data?"":r.text?r.text.toLowerCase():"",this._parsedText=void 0,this._styledText=e.observable(""),this._isArchived=r.isArchived||!1,this.items=e.observableArray(),this._archivedItems=void 0,this._date=e.observable(void 0);var a=VMLIFlag.None;r.isCollapsed&&(a|=VMLIFlag.Collapsed),r.isComplete&&(a|=VMLIFlag.Complete),r.isFlagged&&(a|=VMLIFlag.Flagged),r.priority&&(a|=r.priority),this._flags=e.observable(a),this.styleLength=0,this.dateText=r.dateText,this.allDayDate=void 0,this.dateCreated=r.dateCreated?new Date(r.dateCreated):new Date,this.dateCompleted=r.dateCompleted?new Date(r.dateCompleted):void 0,this.elements=[],this.outlineElements=[],this.isLoaded=!1,this.isDeleted=r.isDeleted||!1,this.isStyled=!1,this.modifiedOffline=void 0,this.modifiedOfflineText=void 0,this.deleteTimeout=void 0,this.highlightTimeout=void 0,this.data=void 0,this._version=-1,this._versionText=-1,this._versionRemote=void 0,this._versionRemoteText=void 0,this.levelsDeep=e.observable(this._parent?this._parent.levelsDeep()+1:0),__TOTAL_ITEMS++,r.isArchived&&__TOTAL_ARCHIVED_ITEMS++,this._needsParse=!1,this.init(r,i)}return window.__TOTAL_ITEMS=0,window.__TOTAL_ARCHIVED_ITEMS=0,window.__TOTAL_ARCHIVE_PARENTS=0,d.prototype={_getLineStyle:function(){return this._flags()&t.LSMask},_getPriority:function(){return this._flags()&t.PMask},stylePadding:function(e){var n,i;if(e){n=r.phone?15:24;var o=e.$parents[e.$parents.length-2];try{t.PAssert(1150,o&&o.item.peek(),"Invalid pane")}catch(a){t.reportError(a)}var s=o.item.peek().levelsDeep.peek();i=this.levelsDeep()-s-1}else n=r.phone?40:25,i=this.levelsDeep()-1;return n+20*i+"px"},_updateStylePadding:function(e,r){try{t.PAssert(1151,this._parent,"Must have a valid parent to update padding, root should never change")}catch(n){t.reportError(n)}var i=e+1,o=this.levelsDeep.peek()!==i;if(o||r){o?this.levelsDeep(i):this.levelsDeep.valueHasMutated();for(var a=this.items.peek(),s=0;s<a.length;++s)a[s]._updateStylePadding(i,r)}},styleProps:function(){var e=this._flags(),r=e&VMLIFlag.Header?"pHeader ":"";return e&VMLIFlag.Collapsed&&(r+="collapsed "),e&VMLIFlag.Selected&&(r+="selected "),e&VMLIFlag.Highlighted&&(r+="highlight "),e&VMLIFlag.NumList&&(r+="pNumList "),this.isArchived()&&(r+="archived "),r+=e&VMLIFlag.Complete?"pComplete ":e&t.PMask?t.priorityMapOut[e&t.PMask]+" ":"pNormal ",e&VMLIFlag.Flagged&&(r+="pStar "),r},copyProperties:function(e){this.isFlagged(e.isFlagged()),this.isComplete(e.isComplete()),this.priority(e.priority())},parent:function(){if(1===arguments.length){try{t.PAssert(1152,arguments[0]instanceof d||void 0===arguments[0],"Parent must be a VMLI")}catch(e){t.reportError(e)}this._parent=arguments[0],void 0!==arguments[0]&&this._updateStylePadding(this._parent.levelsDeep(),!1)}return this._parent},archivedItems:function(t){return this._archivedItems||(this._archivedItems=e.observableArray(),window.__TOTAL_ARCHIVE_PARENTS++),t?this._archivedItems():this._archivedItems},hasArchivedChildren:function(){return void 0!==this._archivedItems?this._archivedItems().length>0:!1},headers:function(){for(var e=[],t=this.items(),r=0;r<t.length;++r)t[r].isHeader()&&e.push(t[r]);return e},isArchived:function(){if(1===arguments.length){var e=this._isArchived;this._isArchived=arguments[0],arguments[0]!==e&&t.timeline.notifyStateChanged(this,PropChangeType.Archive)}return this._isArchived},getRawText:function(){return this._rawText},getParsedText:function(){try{t.PAssert(1153,this._needsParse===!1,"Text should be parsed before calling get")}catch(e){t.reportError(e)}return this._parsedText?this._parsedText:this._rawText},getStyledText:function(){return this._styledText()},getSearchText:function(){try{t.PAssert(1155,void 0!==this._searchText,"Item should always have search text")}catch(e){t.reportError(e)}return this._searchText},setRawText:function(e){(void 0===e||null===e)&&(e=""),this._rawText=e,e&&(this._searchText=e.toLowerCase()),this._parsedText=void 0,this._needsParse=!0},setParsedText:function(e){this._parsedText===e||void 0===e;this._parsedText=e,e&&(this._searchText=e.toLowerCase()),this._needsParse=!1},setStyledText:function(e){this._styledText(e)},priority:function(e,r){if(void 0===e)return this._getPriority();try{t.PAssert(1158,t.priorityMapOut[e],"Priority must be defined in globals")}catch(n){t.reportError(n)}var o=this._getPriority();if(e!==o){var a=this._flags()&~t.PCMask|e;if(this._flags(a),this.isLoaded){var s={priority:e};r||(i.saveChanges(this,s),s=t.clone(s));var d=r?SaveFlag.None:SaveFlag.Text;this.save(s,d),t.timeline.notifyStateChanged(this,PropChangeType.Priority|PropChangeType.Complete),c.performAction(TrackerType.Update,{itemID:this.id,field:"priority",newValue:e,oldValue:o})}}},date:function(e,r){return void 0!==e&&e!==this._date()&&(null===e&&(e=void 0),this._date(e),t.timeline.notifyStateChanged(this,PropChangeType.Date),this.isLoaded&&!r&&c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:[{itemID:this.id,date:e}]})),this._date()},_isFlagHelper:function(e,t){if(void 0!==t){var r=t?this._flags()|e:this._flags()&~e;return void this._flags(r)}return!!(this._flags()&e)},isImportant:function(){return this._getPriority()},isComplete:function(e,r){if(void 0===e)return this._isFlagHelper(VMLIFlag.Complete);var n={isComplete:e};if(e!==this._isFlagHelper(VMLIFlag.Complete)&&(this._isFlagHelper(VMLIFlag.Complete,e),this.isLoaded)){e?(this.dateCompleted||(this.dateCompleted=new Date,n.dateCompleted=this.getDateCompletedTime()),t.vmMain.isLoaded&&t.aggregateEvent("ItemCompleted")):(this.dateCompleted=void 0,n.dateCompleted=void 0),r||(i.saveChanges(this,n),n=t.clone(n));var o=r?SaveFlag.None:SaveFlag.Text;this.save(n,o),t.timeline.notifyStateChanged(this,PropChangeType.Complete),c.performAction(TrackerType.Update,{itemID:this.id,field:"isComplete",newValue:e,oldValue:!e})}},isFlagged:function(e,r){if(void 0===e)return this._isFlagHelper(VMLIFlag.Flagged);if(e!==this._isFlagHelper(VMLIFlag.Flagged)){var n=e?this._flags()&~VMLIFlag.Complete:this._flags(),o=e?n|VMLIFlag.Flagged:n&~VMLIFlag.Flagged;if(this._flags(o),this.isLoaded){var a={isFlagged:e};r||(i.saveChanges(this,a),a=t.clone(a));var s=r?SaveFlag.None:SaveFlag.Text;this.save(a,s),t.timeline.notifyStateChanged(this,PropChangeType.Flagged|PropChangeType.Complete)}c.performAction(TrackerType.Update,{itemID:this.id,field:"isFlagged",newValue:e,oldValue:!e})}},isHeader:function(){try{t.PAssert(1159,0===arguments.length,"Shouldnt be passing arguemtns to isHeader")}catch(e){t.reportError(e)}var r=this.items().length>0,n=this._flags();if(!!(n&VMLIFlag.Header)!==r){var i=r?n|VMLIFlag.Header:n&~VMLIFlag.Header;this._flags(i),this._parent&&this._parent.isFullscreen()&&this._updateStylePadding(this._parent.levelsDeep(),!0)}return r},isCollapsed:function(e){return this._isFlagHelper(VMLIFlag.Collapsed,e)},isSelected:function(e){return r.mobile?this._isFlagHelper(VMLIFlag.Selected,e):!1},isHighlighted:function(e){return this._isFlagHelper(VMLIFlag.Highlighted,e)},isNumList:function(e){return this._isFlagHelper(VMLIFlag.NumList,e)},hasCompletedAncestor:function(){for(var e=this.parent();e;){if(e.isComplete())return!0;e=e.parent()}},hasTime:function(){return this.date()?"12:00am"!==this.date().toString("h:mmtt"):this.dateCompleted},time:function(){return this.date()?"12:00am"==this.date().toString("h:mmtt")?"Any Time":this.date().toString("h:mm tt"):this.dateCompleted?this.dateCompleted.toString("h:mmtt"):""},createDateString:function(e){return e.toString(e.isBefore(Date.today().addWeeks(1))?"dddd h:mm tt":"MM/dd h:mm tt")},fullTime:function(){var e=this.date();return e?void this.createDateString(e):""},setVersion:function(e,r){switch(e){case VersionType.Structure:this._version=r;break;case VersionType.Text:this._versionText=r;break;default:try{t.PAssert(1160,!1,"Invalid version type")}catch(n){t.reportError(n)}}},getVersion:function(e){var r;switch(e){case VersionType.Structure:r=this._version;break;case VersionType.Text:r=this._versionText;break;default:r=-2;try{t.PAssert(1161,!1,"Invalid version type")}catch(n){t.reportError(n)}}return r?r:0},setRemoteVersion:function(e,r){switch(e){case VersionType.Structure:this._versionRemote=r;break;case VersionType.Text:this._versionRemoteText=r;break;default:try{t.PAssert(1162,!1,"Invalid version type")}catch(n){t.reportError(n)}}},getRemoteVersion:function(e){var r;switch(e){case VersionType.Structure:r=this._versionRemote;break;case VersionType.Text:r=this._versionRemoteText;break;default:r=-2;try{t.PAssert(1163,!1,"Invalid version type")}catch(n){t.reportError(n)}}return r?r:0},isLocalVersionNewer:function(e){return this.getVersion(e)==this.getRemoteVersion(e)},isRemoteVersionNewer:function(e){return!this.isLocalVersionNewer(e)},init:function(e,r){if(e.data){var o=i.getVersion(e.data,VersionType.Structure),a=i.getVersion(e.data,VersionType.Text);this.setRemoteVersion(VersionType.Structure,o),this.setRemoteVersion(VersionType.Text,a),c.beginAction(),this.initFromGDrive(e.data,r&&r.parse),c.endAction(),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0)}else this.setVersion(VersionType.Structure,e.version),this.setVersion(VersionType.Text,e.versionText),this.modifiedOffline=e.modifiedOffline,this.modifiedOfflineText=e.modifiedOfflineText,this.modifiedOffline,this.modifiedOfflineText,t.vmMain.isLoaded&&i.isConnected()?n.initializeItem(this):this.id=e.id||t.generateTempId(),e.date&&(this.allDayDate=e.allDayDate,this.date(new Date(e.date)),this.date()._explicitTime=!this.allDayDate),e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),e.items&&this.updateItems(e.items,r&&r.forceSave,r&&r.parse);this.parseText(r&&r.parse),r&&r.forceSave&&(this.save(void 0,SaveFlag.Prop),this.date()&&i.saveChanges(this,this.getMetaTextSaveData())),t.vmMain.isLoaded&&t.aggregateEvent("ItemCreated"),n.setModel(this.id,this)},onLoad:function(e,n){if(r.mobile&&(n=t.focusedPane),n&&n.trackDOM&&n.trackDOM()){try{t.PAssert(1164,n,"Items must be added to a pane")}catch(i){t.reportError(i)}var o=n.id;if(this.isLoaded=!0,t.hasClass(e,"outlineItem"))this.outlineElements[o]=e,n.vmSearch.checkItem(this,!0,!1);else{this.elements[o]=e;try{t.PAssert(1167,t.hasClass(this.elements[o].firstElementChild,"text"))}catch(i){t.reportError(i)}(!t.vmMain.isLoaded||n!=t.focusedPane||n.reloading)&&n.vmSearch.checkItem(this,!1,!0)}}},resetDriveData:function(){try{t.PAssert(1168,void 0===this._versionRemote,"Remote versions should be reset")}catch(e){t.reportError(e)}try{t.PAssert(1169,void 0===this._versionRemoteText,"Remote versions should be reset")}catch(e){t.reportError(e)}this.data=void 0},isFullscreen:function(){return t.focusedItem===this},findItem:function(e){var t=this.getIndexOf(e,!1);return t>=0?{index:t,arr:this.items,isArchived:!1}:this.hasArchivedChildren()&&(t=this.getIndexOf(e,!0),t>=0)?{index:t,arr:this.archivedItems(),isArchived:!0}:void 0},updateItems:function(e,r,o){var a,s;this.data&&(a=i.get(this.data,"items"),s=i.get(this.data,"archivedItems"));try{t.PAssert(1170,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(c){t.reportError(c)}try{t.PAssert(1171,!this.hasArchivedChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(c){t.reportError(c)}for(var l=!1,u=!1,h=0;h<e.length;++h){var p=e[h],m=n.getModel(p);if(m){var f=n.getItem(m.parent().id),g=f.items.indexOf(m.id);try{t.PAssert(1176,-1===g,"Expect that the old parent has been notified")}catch(c){t.reportError(c)}var v=m.getIndex();v>-1&&m.parent().removeChildAtIndex(v),m.parent(this)}else if("object"!=typeof p){var y=n.getItem(p);try{t.PAssert(1172,y,"Referenced item doesn't exist",p)}catch(c){t.reportError(c)}if(y)m=new d(y,{parent:this,forceSave:r,parse:o});else try{t.PAssert(1173,!1)}catch(c){t.reportError(c)}}else{try{t.PAssert(1174,p,"Item must exist otherwise we arent creating anything")}catch(c){t.reportError(c)}if(p)m=new d(p,{parent:this,forceSave:r,parse:o});else try{t.PAssert(1175,!1)}catch(c){t.reportError(c)}}try{t.PAssert(1177,m,"There must be a model at this point")}catch(c){t.reportError(c)}m&&(m.isArchived()?(u=!0,this.archivedItems(!0).push(m),!s&&this.data&&(s=i.ensureItemList(this,!0)),s&&s.push(m.data)):(l=!0,this.items().push(m),!a&&this.data&&(a=i.ensureItemList(this,!1)),a&&a.push(m.data)))}l&&this.items.valueHasMutated(),u&&this.archivedItems().valueHasMutated()},insertItem:function(e,r,i){var o=i?this.items():this.items;isNaN(r)?o.push(e):o.splice(r,0,e),n.insertItems(this,[e],r),t.fireCustomEvent("itemAdded",{item:e,force:!1})},moveTo:function(e){var r=e.parent,i=e.index,o=e.isRemoteChange,a=e.shouldBeArchived,s=e.noVersion,c=e.underlying;try{t.PAssert(1178,r instanceof d)}catch(l){t.reportError(l)}void 0===i&&(i=-1),void 0===o&&(o=!1),void 0===a&&(a=!1);var u=this.parent(),h=u.findItem(this);if(h){if(u===r){if(h.index===i)return;h.index<i&&i--}c&&(h.arr=h.arr()),h.arr.splice(h.index,1),this.parent(r);var p=a?r.archivedItems():r.items;c&&(p=p()),0>i?p.push(this):p.splice(i,0,this);var m={index:i,isArchived:a};n.moveItem({item:this,newInfo:m,oldParent:u,oldInfo:h,isRemoteChange:o,noVersion:s})}},getItemsArrayForSave:function(){for(var e=[],t=this.items(),r=0;r<t.length;++r)e.push(t[r].id);if(this.hasArchivedChildren())for(var n=this.archivedItems(!0),r=0;r<n.length;++r)e.push(n[r].id);return e},getDateTime:function(){return this.date()?this.date().getTime():void 0},getDateCompletedTime:function(){return this.dateCompleted?this.dateCompleted.getTime():void 0},getMetaTextSaveData:function(){var e,t,r=this.date();return void 0!==r&&(e=r.getTime(),t=!r._explicitTime),{date:e,allDayDate:t,dateCompleted:this.getDateCompletedTime()}},getBasicJSON:function(){try{t.PAssert(1179,this.date(),"Must have a valid date")}catch(e){t.reportError(e)}try{t.PAssert(1180,!this.allDayDate,"All day dates should not be scheduled")}catch(e){t.reportError(e)}if(this.allDayDate)return"";var r,n=this.date().toJSON();return r=this.allDayDate?this.date().addDays(-1).setHours(17).toJSON():this.date().addMinutes(-30).toJSON(),'{"id":"'+this.id+'","text":"'+this.getRawText()+'","date":"'+n+'","alertDate":"'+r+'"}'},getDebugData:function(){var e={id:this.id,parent:this._parent?this._parent.id:void 0,items:this.getItemsArrayForSave(),text:this.getRawText(),isArchived:this.isArchived(),isDeleted:this.isDeleted,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return e},getFullSaveData:function(){var e={id:this.id,text:this.getRawText(),date:this.getDateTime(),dateCreated:this.dateCreated.getTime(),dateCompleted:this.getDateCompletedTime(),priority:this._getPriority()||void 0,isComplete:this.isComplete()||void 0,isFlagged:this.isFlagged()||void 0,isCollapsed:this.isCollapsed()||void 0,allDayDate:this.allDayDate||void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return e.items=this.getItemsArrayForSave(),e},save:function(e,r){try{t.PAssert(1181,void 0!==r,"Must specify saveFlags for the changes that are being saved")}catch(i){t.reportError(i)}if(e){var o=n.getItem(this.id);o||e.id?(e.items&&(e.items=this.getItemsArrayForSave()),e.date&&!e.allDayDate&&(e.allDayDate=this.allDayDate||void 0),e.text&&t.fireCustomEvent("itemTextChanged",{item:this,force:r===SaveFlag.None})):e=this.getFullSaveData()}else e=this.getFullSaveData();n.saveChanges(this,e,r)},toggleCollapsed:function(){function e(){c.performAction(TrackerType.Update,{itemID:n.id,field:"isCollapsed",newValue:!n.isCollapsed(),oldValue:n.isCollapsed()}),n.isCollapsed(!n.isCollapsed()),n.save({isCollapsed:n.isCollapsed()},SaveFlag.Text)}if(!(this.items().length<=0)){var r=this.isCollapsed(),n=this,i=t.firstChildTag(this.getElement(),"ul");r?(e(),t.animateTransform(i,{time:200,delay:0,transform:"scale(1, 1) translate3d(0,0,0)",clearTransform:!0,origin:"50% 0"})):t.animateTransform(i,{time:200,transform:"scale(1, 0)",origin:"50% 0",onComplete:function(){e()}})}},highlight:function(){var e=this;this.highlightTimeout?(this.isHighlighted(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=0,setTimeout(function(){e.isHighlighted(!0)},0)):this.isHighlighted(!0),this.highlightTimeout=setTimeout(function(){e.isHighlighted(!1)},2e3)},getElement:function(e){return void 0===e&&(e=t.focusedPaneID),this.elements[e]},getSpan:function(e){var t=this.getElement(e);return t?t.firstElementChild:void 0},getOutlineElement:function(e){return void 0===e&&(e=t.focusedPaneID),this.outlineElements[e]},removeChild:function(e){var r;if(e.isArchived()){try{t.PAssert(1186,this.hasArchivedChildren(),"For a child to be archived, this item must have valid archived children")}catch(i){t.reportError(i)}this.hasArchivedChildren()&&(r=this.archivedItems(!0).remove(e),n.removeItem(this,r,e,!0),this.archivedItems().valueHasMutated())}else r=this.items().remove(e),n.removeItem(this,r,e,!1),this.items.valueHasMutated();return r},removeChildAtIndex:function(e){try{t.PAssert(1187,!this.items()[e].isArchived())}catch(r){t.reportError(r)}var i=this.items().removeAt(e);return n.removeItem(this,e,i,!1),this.items.valueHasMutated(),i},archiveChild:function(e){var t=!1;if(!e.isArchived()){c.beginAction(),e.isArchived(!0),this.archivedItems().push(e);var r=this.items().remove(e);n.archiveItem(this,r,e),this.items.valueHasMutated(),c.endAction(),t=!0}return t},unarchiveChild:function(e){var r=!1;if(e.isArchived()){c.beginAction();try{t.PAssert(1188,e.isArchived(),"Child must be archived to be unarchived")}catch(i){t.reportError(i)}try{t.PAssert(1189,this.hasArchivedChildren(),"Parent must have archived children to unarchive a child")}catch(i){t.reportError(i)}e.isArchived(!1);var o=this.archivedItems(!0).remove(e);this.items.push(e),n.unarchiveItem(this,o,e),this.archivedItems().valueHasMutated(),c.endAction(),r=!0}return r},_moveChildrenHelper:function(e){var r=e.newParent,n=e.index,i=e.isArchived;try{t.PAssert(1190,void 0!==r&&void 0!==i,"_moveChildrenHelper is missing parameters")}catch(o){t.reportError(o)}var a=i?this.archivedItems():this.items,s=a();if(s.length>0){var d=i?r.archivedItems():r.items;!i&&(isNaN(n)||0>n)&&(n=d().length);for(var l=0;s.length>0;){try{t.PAssert(1191,s[l]!=r)}catch(o){t.reportError(o)}var u=s[0];s[0].moveTo({parent:r,index:n+l,shouldBeArchived:i,underlying:!0}),c.performAction(TrackerType.Move,{itemID:u,oldParent:this.id,oldPosition:l,newParent:r.id,newPosition:n+l}),l++}a.valueHasMutated(),d.valueHasMutated()}},moveChildren:function(e,r){try{t.PAssert(1192,this.id!==e.id)}catch(n){t.reportError(n)}if(e.parent()===this){var i=this.removeChild(e);c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:i})}this._moveChildrenHelper({newParent:e,index:r,isArchived:!1}),this._moveChildrenHelper({newParent:e,index:r,isArchived:!0})},deleteSelf:function(){this.parent().deleteChild(this),this.parent(void 0)},deleteChild:function(e,r,i){if(c.beginAction(),e.hasChildren()||e.hasArchivedChildren())if(r)e.moveChildren(r,i);else for(var o=e.items(),a=o.length-1;a>=0;a--)e.deleteChild(o[a]);if(!e.isDeleted){var s=this.removeChild(e);c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:s}),n.deleteItem(e)}t.timeline.notifyStateChanged(e),c.endAction()},replaceChild:function(e,t){var r=e.getIndex();this.items().removeAt(r),c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:r}),n.deleteItem(e),t.moveTo({parent:this,index:r}),n.removeItem(this,r+1,e,!1),e.moveChildren(t,t.numChildren());var i=t.parent().id;if(i!==this.id){var o=t.parent().items().remove(t);c.performAction(TrackerType.Move,{itemID:t.id,oldParent:i,oldPosition:o,newParent:this.id,newPosition:r})}this.items.valueHasMutated()},getChild:function(e){try{t.PAssert(1193,e<this.items().length)}catch(r){t.reportError(r)}return this.items()[e]},getFirstChild:function(){return this.hasChildren()?this.items()[0]:void 0},isFirstChild:function(){return this.parent()?this.parent().getFirstChild()===this:!1},getLastChild:function(){return this.hasChildren()?this.items()[this.items().length-1]:void 0},isLastChild:function(){return this.parent()?this.parent().getLastChild()===this:!1},getChildIndex:function(e){return this.getIndexOf(e.id,e.isArchived())},getIndexOf:function(e,t){e.id&&(e=e.id);var r,n=-1;if(t?this.hasArchivedChildren()&&(r=this.archivedItems(!0)):r=this.items(),r)for(var i=0;i<r.length;++i)if(r[i].id===e){n=i;break}return n},getRemoteIndexOf:function(e,t){var r=i.getItemList(this.data,t),n=-1;return r&&(n=r.indexOf(e)),n},getIndex:function(){return this.parent().getChildIndex(this)},hasChildren:function(){return this.items().length>0},numChildren:function(){return this.items().length},canZoom:function(){return this.numChildren()>0||this.getParsedText().length>0},parents:function(){for(var e=[],t=this;t;)e.splice(0,0,t),t=t.parent();return e},getSiblings:function(e){e=e||0;var t=[];if(this.parent())for(var r=this.parent().items(),n=0,i=r.length;i>n;n++)r[n]!==this&&t.push(r[n]);return t},outline:function(e){if(e)for(var r=e.$parents.length-1;r>0;r--)if(e.$parents[r]instanceof t.VMOutline)return e.$parents[r];return t.focusedPane.outline}},t.extend(d.prototype,o),t.extend(d.prototype,a),t.extend(d.prototype,s(d)),d}),define("tracker",["globals","platform","data","gdata","VMLI"],function(e,t,r,n){function i(){return _.groupID+1}function o(){return++_.groupID}function a(){return _.groups[_.cursor]}function s(){return _.groups[_.cursor].events[_.groups[_.cursor].events.length-1]}function c(t){for(var r=0;r<t.events.length;++r){var n=t.events[r];switch(n.type){case TrackerType.Insert:break;case TrackerType.Remove:break;case TrackerType.Create:break;case TrackerType.Delete:break;case TrackerType.Move:break;case TrackerType.Update:break;case TrackerType.Format:break;case TrackerType.Zoom:break;case TrackerType.UIAction:break;default:try{e.PAssert(1196,!1,"Expected TrackerType, received: ",type)}catch(i){e.reportError(i)}}}}function d(){var e=o();return _.groups.push({id:e,events:[],persisted:!1}),_.cursor<N-1&&_.cursor++,_.groups.length>N&&c(_.groups.shift()),e}function l(t,r){var n=a();try{e.PAssert(1197,n,"Expected group to exist")}catch(i){e.reportError(i)}var o={type:t,data:r};switch(t){case TrackerType.Insert:o.cb={undo:m,redo:f};break;case TrackerType.Remove:o.cb={undo:g,redo:v};break;case TrackerType.Create:o.cb={undo:y,redo:b};break;case TrackerType.Delete:o.cb={undo:S,redo:T};break;case TrackerType.Move:o.cb={undo:w,redo:E};break;case TrackerType.Update:o.cb={undo:M,redo:x};break;case TrackerType.Format:o.cb={undo:C,redo:I};break;case TrackerType.Zoom:o.cb={undo:A,redo:P};break;case TrackerType.UIAction:o.cb={undo:D,redo:k};break;default:try{e.PAssert(1198,!1,"Expected TrackerType, received: ",t)}catch(i){e.reportError(i)}}n.events.push(o)}function u(t,r){log("Tracker Action Merged: ",t,r);var n=s();try{e.PAssert(1199,n,"Expected action to exist")}catch(i){e.reportError(i)}switch(t){case TrackerType.Insert:break;case TrackerType.Remove:break;case TrackerType.Create:break;case TrackerType.Delete:break;case TrackerType.Move:break;case TrackerType.Update:break;case TrackerType.Format:try{e.PAssert(1200,!1,"Formats cannot be merged")}catch(i){e.reportError(i)}break;case TrackerType.Zoom:try{e.PAssert(1201,!1,"Zooms cannot be merged")}catch(i){e.reportError(i)}break;case TrackerType.UIAction:try{e.PAssert(1202,!1,"UIActions cannot be merged")}catch(i){e.reportError(i)}break;default:try{e.PAssert(1203,!1,"Expected TrackerType, received: ",t)}catch(i){e.reportError(i)}}}function h(e){var t=!1,r=a();return r&&r.events.length>0&&(r.events[r.events.length-1].type===e?e===TrackerType.Insert&&(t=!0):t=!1),t}function p(e,t){var r=a();return r&&(r.id===t||0===r.events.length)}function m(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.itemID);try{e.PAssert(1204,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}var s=o.getParsedText(),c=0;"﻿"==s[0]&&(c=1);var d=s.slice(c,i.position)+s.slice(i.position+i.text.length);o.setText(d,!0),e.selectChildren(o,i.position,0)}}function f(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.itemID);try{e.PAssert(1205,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}var s=o.getParsedText(),c=s.slice(0,i.position)+i.text+s.slice(i.position);0===c.length&&(c="﻿"),o.setText(c,!0),e.selectChildren(o,i.position,i.text.length)}}function g(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.itemID);try{e.PAssert(1206,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}var s=o.getParsedText(),c=0;"﻿"==s[0]&&(c=1);var d=s.slice(c,i.position)+i.text+s.slice(i.position);o.setText(d,!0),e.selectChildren(o,i.position,i.text.length)}}function v(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.itemID);try{e.PAssert(1207,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}var s=o.getParsedText(),c=s.slice(0,i.position)+s.slice(i.position+i.text.length);0===c.length&&(c="﻿"),o.setText(c,!0),e.selectChildren(o,i.position,0)}}function y(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.parent);try{e.PAssert(1208,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}var s=o.removeChildAtIndex(i.position);try{e.PAssert(1209,s.id===i.itemID,"Expected data to match removed child: ",s,i)}catch(a){e.reportError(a)}s.parent(void 0),r.deleteItem(s);var c=o;i.position>0&&(c=o.getChild(i.position-1)),e.selectChildren(c,c.getParsedText().length,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function b(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.parent);try{e.PAssert(1210,o,"Expected parent model to exist: ",i)}catch(a){e.reportError(a)}var s=r.getModel(i.itemID);try{e.PAssert(1211,s,"Expected child model to exist: ",i)}catch(a){e.reportError(a)}r.undeleteItem(s),o.items.splice(i.position,0,s),s.parent(o),e.selectChildren(s,0,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function S(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.parent);try{e.PAssert(1213,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}var s=r.getModel(i.itemID);try{e.PAssert(1214,s,"Expected model to exist: ",i)}catch(a){e.reportError(a)}r.undeleteItem(s),o.items.splice(i.position,0,s),s.parent(o),e.selectChildren(s,0,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function T(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.parent);try{e.PAssert(1216,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}var s=o.removeChildAtIndex(i.position);try{e.PAssert(1217,s.id===i.itemID,"Expected data to match removed child: ",s,i)}catch(a){e.reportError(a)}s.parent(void 0),r.deleteItem(s);var c=o;i.position>0&&(c=o.getChild(i.position-1)),e.selectChildren(c,c.getParsedText().length,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function w(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.oldParent);try{e.PAssert(1218,o,"Expected oldParent model to exist: ",i)}catch(a){e.reportError(a)}var s=r.getModel(i.newParent);try{e.PAssert(1219,s,"Expected newParent model to exist: ",i)}catch(a){e.reportError(a)}var c=s.removeChildAtIndex(i.newPosition);try{e.PAssert(1220,c.id===i.itemID,"Expected data to match child: ",c,i)}catch(a){e.reportError(a)}c.parent(o),o.items.splice(i.oldPosition,0,c),e.selectChildren(c,0,0),s.save({items:s.getItemsArrayForSave()},SaveFlag.None),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function E(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.oldParent);try{e.PAssert(1221,o,"Expected oldParent model to exist: ",i)}catch(a){e.reportError(a)}var s=r.getModel(i.newParent);try{e.PAssert(1222,s,"Expected newParent model to exist: ",i)}catch(a){e.reportError(a)}var c=o.removeChildAtIndex(i.oldPosition);try{e.PAssert(1223,c.id===i.itemID)}catch(a){e.reportError(a)}c.parent(s),s.items.splice(i.newPosition,0,c),e.selectChildren(c,0,0),s.save({items:s.getItemsArrayForSave()},SaveFlag.None),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function M(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.itemID);try{e.PAssert(1224,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}try{e.PAssert(1225,o[i.field],"Expected field to exist: ",i)}catch(a){e.reportError(a)}o[i.field](i.oldValue)}}function x(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.itemID);try{e.PAssert(1226,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}try{e.PAssert(1227,o[i.field],"Expected field to exist: ",i)}catch(a){e.reportError(a)}o[i.field](i.newValue)}}function C(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.itemID);try{e.PAssert(1228,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}}}function I(t){for(var n=0;n<t.length;++n){var i=t[n],o=r.getModel(i.itemID);try{e.PAssert(1229,o,"Expected model to exist: ",i)}catch(a){e.reportError(a)}}}function A(t){var n=t[0],i=r.getModel(n.oldItemID);try{e.PAssert(1230,i,"Expected model to exist: ",n)}catch(o){e.reportError(o)}if(n.zoomIn)i.zoomOut(n.time);else if(n.zoomOut)i.zoomin({time:n.time});else try{e.PAssert(1231,!1,"Zoom action must define either zoomIn or zoomOut")}catch(o){e.reportError(o)}}function P(t){var n=t[0],i=r.getModel(n.itemID);try{e.PAssert(1232,i,"Expected model to exist: ",n)}catch(o){e.reportError(o)}if(n.zoomIn)i.zoomin({time:n.time});else if(n.zoomOut)i.zoomOut(n.time);else try{e.PAssert(1233,!1,"Zoom action must define either zoomIn or zoomOut")}catch(o){e.reportError(o)}}function D(t){var r=t[0];switch(r.type){case TrackerUIAction.RemovePane:break;case TrackerUIAction.SwitchPaneMode:break;default:try{e.PAssert(1234,!1,"Invalid UIAction")
}catch(n){e.reportError(n)}}}function k(){}function O(){return!e.vmMain.isLoaded||e.isLoadingRemote}function L(t){try{e.PAssert(1242,!_.undoRedoActive)}catch(n){e.reportError(n)}for(var i=void 0,o=0,a=0,s=0;s<t.length;++s){var c=t[s],d=c.data,l=r.getModel(d.itemID);try{e.PAssert(1243,l,"Expected model to exist: ",d)}catch(n){e.reportError(n)}switch(c.type){case TrackerType.Insert:i=l,o=d.position,a=d.text.length;break;case TrackerType.Remove:i=l,o=d.position,a=0;break;case TrackerType.SetText:l.deleteTimeout||(i=l,o=d.position,a=0);break;case TrackerType.Create:i=l,o=0,a=0;break;case TrackerType.Delete:var u=r.getModel(d.previous);i=u,o=u.getParsedText().length,a=0}}i&&(e.selectChildren(i,o,a),e.scrollIntoView(i.getSpan(),200)),U=[]}function R(){return _.groups.slice(_.cursor).concat(_.groups.slice(0,_.cursor))}var _={disabled:!1,allowOfflineUndo:!1,cursor:-1,groupID:0,groups:[],externalUndoRedo:!1,undoRedoActive:!1,canRedo:!1,canUndo:!1};window.TrackerType={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11},window.TrackerMisc={ToggleOutline:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,ToggleSidebar:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19},window.TrackerUIAction={AddPane:1,RemovePane:2,SwitchPaneMode:3};var N=75,F=!1;_.performActions=function(t){try{e.PAssert(1235,!_.disabled||e.intro)}catch(r){e.reportError(r)}try{e.PAssert(1236,!F)}catch(r){e.reportError(r)}if(F=!0,t&&t.length>0){if(!_.disabled){var n=void 0;_.cursor!=_.groups.length-1?(_.groups.splice(_.cursor+1,_.groups.length-(_.cursor+1)),n=d()):n=i()}for(var o=0;o<t.length;++o){var a=t[o];e.intro&&e.intro.onAction(a),_.disabled||(p(a.type,n)?h(a.type)?u(a.type,a.data):l(a.type,a.data):(n=d(),l(a.type,a.data)))}}F=!1};var V=[],B=0;_.beginAction=function(){try{e.PAssert(1237,!F)}catch(t){e.reportError(t)}if(0===B){n.beginAction();try{e.PAssert(1238,0===V.length,"Current actions should always be empty when starting a new action")}catch(t){e.reportError(t)}}B++},_.performAction=function(t,r){try{e.PAssert(1239,!F)}catch(n){e.reportError(n)}var i=O();_.disabled?e.intro&&(i||_.performActions([{type:t,data:[r]}])):B?V.push({type:t,data:[r]}):_.performActions([{type:t,data:[r]}])},_.endAction=function(){try{e.PAssert(1240,!F)}catch(t){e.reportError(t)}try{e.PAssert(1241,0!==B,"Must have called beginAction before calling endAction")}catch(t){e.reportError(t)}1===B&&((!_.disabled||e.intro)&&_.performActions(V),V.length=0,n.endAction()),B--};var U=[];return _.notifyStateChangedFromUndoRedo=function(t,r){try{e.PAssert(1244,_.undoRedoActive)}catch(n){e.reportError(n)}U.push({type:t,data:r})},_.undoAction=function(){e.vmMain.isOnline()||_.allowOfflineUndo||e.messageQueue.pushMessage(MessageID.OfflineUndo),_.undoRedoActive=!0;try{e.PAssert(1245,!F)}catch(t){e.reportError(t)}if(!_.disabled&&_.allowOfflineUndo){if(_.cursor>=0)for(var r=_.groups[_.cursor--],i=r.events.length-1;i>=0;i--){var o=r.events[i];o.cb.undo(o.data)}}else if(_.canUndo){try{e.PAssert(1246,_.externalUndoRedo)}catch(t){e.reportError(t)}n.undoAction()}_.undoRedoActive=!1,L(U),_.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{undo:!0}]})},_.redoAction=function(){e.vmMain.isOnline()||_.allowOfflineUndo||e.messageQueue.pushMessage(MessageID.OfflineUndo),_.undoRedoActive=!0;try{e.PAssert(1247,!F)}catch(t){e.reportError(t)}if(!_.disabled&&_.allowOfflineUndo){if(_.cursor>=-1&&_.cursor<_.groups.length-1)for(var r=_.groups[++_.cursor],i=0;i<r.events.length;++i){var o=r.events[i];o.cb.redo(o.data)}}else if(_.canRedo){try{e.PAssert(1248,_.externalUndoRedo)}catch(t){e.reportError(t)}n.redoAction()}_.undoRedoActive=!1,L(U),_.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{redo:!0}]})},_.miscAction=function(t){e.intro&&e.intro.onAction(t)},_.resetState=function(){F=!1,U=[],V=[],_.undoRedoActive=!1,_.cursor=-1,_.groupID=0,_.groups=[]},_.stringifyGroups=function(){var e=R();return"Tracker: "+e.length},_.stateChangeForUndoRedo=function(e){_.externalUndoRedo=!0,_.disabled=!0,_.canRedo=e.canRedo,_.canUndo=e.canUndo},n.registerForUndoRedoStateChange(_),_}),define("edit",["ko","globals","platform","android","VMLI","tracker"],function(e,t,r,n,i,o){function a(){if(n.isEnabled()){if(!n.getCurrentVMLI())return!0;s={},c=void 0,d=l=n.getCurrentSpan(),u=n.getSelectionStart(),h=n.getSelectionEnd()}else{if(s=t.getSelectionInfo(),!s||0===s.rangeCount)return!0;c=s.selection.getRangeAt(0),d=c.startContainer,l=c.endContainer,u=c.startOffset,h=c.endOffset}}var s,c,d,l,u,h,p,m,f={},g=[KeyCode.Tab,KeyCode.BackSpace,KeyCode.Delete,KeyCode.Period],v=[KeyCode.UpArrow,KeyCode.DownArrow,KeyCode.LeftArrow,KeyCode.RightArrow,KeyCode.Home,KeyCode.End],y={},b=String.fromCharCode(10);return f.updateAutocomplete=function(r){var n=r.normCode&&v.indexOf(r.normCode)>=0;if(t.autocomplete){var i=t.getSelectionInfo();if(i&&i.selection.rangeCount>0){var o=i.selection.getRangeAt(0),a=t.getLIParent(o.startContainer),s=t.getLIParent(o.endContainer);if(a&&a===s&&o.startOffset===o.endOffset&&"UL"!==o.startContainer.tagName){var c=e.dataFor(a),d=c.getSpan();try{t.PAssert(1249,d,"Items should always have a valid span if we are performing updates in a VMPane")}catch(l){t.reportError(l)}if(d){var u=t.getSelectOffsetsInSpan(c,d,o);u.start===u.end&&t.autocomplete.update({item:c,start:u.start,fromArrows:n})}else t.autocomplete.hide()}}}},f.onTextInput=function(e){if(y.item&&y.waitAutocorrect&&" "!=e.data&&e.data!=b){var r=y.item,n="enter"==y.waitAutocorrect?p:r.getSpan(),i=r.getParsedText();a();var o=t.getSelectOffsetsInSpan(r,n,c),s=o.endText-o.startText,d="space"==y.waitAutocorrect?" ":"";y.text=i.substr(0,o.startText)+e.data+d+i.substr(o.endText),y.start+=e.data.length-s,y.waitAutocorrect=void 0}},f.keyup=function(e,r){y.item&&(o.beginAction(),void 0!=y.text&&y.item.setText(y.text,!0),y.nextItem?t.selectChildren(y.nextItem,0,0):t.selectChildren(y.item,y.start,0),f.updateAutocomplete(r),o.endAction()),y.item=void 0,y.nextItem=void 0,y.text=void 0,y.start=void 0,y.waitAutocorrect=void 0,(r.normCode===KeyCode.Enter||r.normCode===KeyCode.PageUp||r.normCode===KeyCode.PageDown)&&f.scrollTextIntoView();try{t.PAssert(1250,r.stopImmediatePropagation,"Should always be defined")}catch(n){t.reportError(n)}r.stopImmediatePropagation&&r.stopImmediatePropagation();try{t.PAssert(1251,r.preventDefault,"Should always be defined")}catch(n){t.reportError(n)}return r.preventDefault&&r.preventDefault(),r.handled?!0:void 0},f.scrollTextIntoView=function(r,n){try{t.PAssert(1252,0!==r,"Cannot have a null scroll direction")}catch(i){t.reportError(i)}if(isNaN(n)&&(n=200),!t.isScrolling&&(a(),l&&"UL"!==l.tagName&&"LI"!==l.tagName)){var o=t.getSpanParent(l),s=e.dataFor(o);if(s){var c;0>r?c=t.getPreviousItem(s,t.focusedPane)||s:r>0&&(c=t.getNextItem(s,t.focusedPane)||s);var d=c?c.getSpan():o;t.scrollIntoView(d,n)}}},f.handleSelectAll=function(e){a();var r=t.getFirstPaneItem(e),n=t.getLastPaneItem(e);return t.selectMultiline(r.getSpan(),0,n.getSpan(),n.getParsedText().length),!1},f.handleArrows=function(n,i){if(t.restrictSelectionToText(),a(),r.mac&&i.metaKey&&i.normCode===KeyCode.UpArrow||!r.mac&&i.ctrlKey&&i.normCode===KeyCode.Home){var o=t.getFirstPaneItem(t.focusedPane);return i.shiftKey?t.selectMultiline(o.getSpan(),0,l,h):t.selectChildren(o,0,0),t.scrollIntoView(o.getSpan()),!1}if(r.mac&&i.metaKey&&i.normCode===KeyCode.DownArrow||!r.mac&&i.ctrlKey&&i.normCode===KeyCode.End){var s=t.getLastPaneItem(t.focusedPane);return i.shiftKey?t.selectMultiline(d,u,s.getSpan(),s.getParsedText().length):t.selectChildren(s,s.getParsedText().length,0),t.scrollIntoView(s.getSpan()),!1}if(!r.mac&&i.ctrlKey&&i.normCode===KeyCode.UpArrow&&d){var p,m=e.dataFor(t.getSpanParent(d));if(m.parent()===t.focusedItem){if(!m.isFirstChild()){try{t.PAssert(1254,m.getIndex()>0,"Should never hit this with the first item in the list")}catch(g){t.reportError(g)}p=m.parent().getChild(m.getIndex()-1)}}else{for(;m.parent()!==t.focusedItem;)m=m.parent();p=m}return void 0!==p&&(t.selectChildren(p,p.getParsedText().length,0),t.scrollIntoView(p.getSpan())),!1}if(!r.mac&&i.ctrlKey&&i.normCode===KeyCode.DownArrow&&l){var p,m=e.dataFor(t.getSpanParent(l));if(m.parent()===t.focusedItem)m.isLastChild()||(p=m.parent().getChild(m.getIndex()+1));else{for(;m.parent()!==t.focusedItem;)m=m.parent();m.isLastChild()||(p=m.parent().getChild(m.getIndex()+1))}return void 0!==p&&(t.selectChildren(p,p.getParsedText().length,0),t.scrollIntoView(p.getSpan())),!1}if(void 0===d||void 0===l)return!0;if(i.normCode===KeyCode.LeftArrow||i.normCode===KeyCode.RightArrow){a();var v=t.getLIParent(d),y=t.getLIParent(l);if(v==y){var m=e.dataFor(v);if(0===m.getParsedText().length){if(i.normCode===KeyCode.LeftArrow){var b=t.getPreviousItem(m,t.focusedPane);b&&t.selectChildren(b,b.getParsedText().length,0)}else if(i.normCode===KeyCode.RightArrow){var S=t.getNextItem(m,t.focusedPane);S&&t.selectChildren(S,0,0)}return!1}}}else if(r.ie&&(i.normCode===KeyCode.UpArrow||i.normCode===KeyCode.DownArrow)){if(a(),i.normCode===KeyCode.UpArrow)var T=e.dataFor(t.getLIParent(d)),w=t.getPreviousItem(T,t.focusedPane);else if(i.normCode===KeyCode.DownArrow)var T=e.dataFor(t.getLIParent(l)),w=t.getNextItem(T,t.focusedPane);if(w){if(d===l)var E=t.getSelectOffsetsInSpan(void 0,l,c),M=Math.min(E.start,w.getParsedText().length);else var M=w.getParsedText().length;return t.selectChildren(w,M,0),!1}}return f.updateAutocomplete(i),!0},f.keydown=function(e,t){var i=!0;if(g.indexOf(t.normCode)>=0)i=f.keypress(e,t,!0);else if(v.indexOf(t.normCode)>=0)i=f.handleArrows(e,t);else if(r.mac&&t.metaKey||!r.mac&&t.ctrlKey){if(t.normCode===KeyCode.A)return f.handleSelectAll(e,t);if(t.normCode===KeyCode.Y||t.normCode===KeyCode.Z)return f.keypress(e,t,!0)}switch(t.normCode){case KeyCode.Enter:(!r.mobile||n.isEnabled())&&f.scrollTextIntoView();break;case KeyCode.UpArrow:r.mac&&!t.metaKey&&f.scrollTextIntoView(-1,10);break;case KeyCode.DownArrow:r.mac&&!t.metaKey&&f.scrollTextIntoView(1,10);break;default:var o=t.normCode>=32&&t.normCode<=90&&t.normCode!==KeyCode.Period||t.normCode===KeyCode.Enter;!o||r.mac&&t.metaKey||!r.mac&&t.ctrlKey||f.scrollTextIntoView()}return i},f.keypress=function(u,h,p){var g=[KeyCode.Enter];try{t.PAssert(1255,h.stopPropagation,"Should always be defined")}catch(v){t.reportError(v)}h.stopPropagation&&h.stopPropagation();var b=!0,S=h.normCode>=32&&h.normCode!==KeyCode.Period||g.indexOf(h.normCode)>=0,T=r.mobile&&h.normCode===KeyCode.Delete||0===h.which;if(!T&&(p||S)){if(a(),!s&&!n.isEnabled())return!0;if(r.mac&&h.metaKey||!r.mac&&h.ctrlKey){if(h.normCode===KeyCode.Y||h.normCode===KeyCode.Z){h.normCode!==KeyCode.Z||h.shiftKey?(o.redoAction(),t.sendEvent("Hotkey","Redo")):(o.undoAction(),t.sendEvent("Hotkey","Undo")),h.handled=!0;try{t.PAssert(1256,h.preventDefault,"Should always be defined")}catch(v){t.reportError(v)}return h.preventDefault&&h.preventDefault(),!0}var w=String.fromCharCode(h.normCode);switch(w){case"c":case"C":return h.handled=!0,!0;case"v":case"V":return h.handled=!0,!0;case"r":case"R":case"a":case"A":return h.handled=!0,!0}}var E;if("UL"==d.nodeName){var M=e.dataFor(d);M instanceof i||(E=M.addItemToPane("",0),A=E.getSpan(),t.selectChildren(E,0,0))}t.restrictSelectionToText(),a();try{t.PAssert(1257,n.isEnabled()||"#text"==d.nodeName||"SPAN"==d.nodeName,"Expected SPAN, Actual: "+d.tagName)}catch(v){t.reportError(v)}var x=t.getSpanParent(d);try{t.PAssert(1258,n.isEnabled()||"#text"==l.nodeName||"SPAN"==l.nodeName,"Expected SPAN, Actual: "+l.tagName)}catch(v){t.reportError(v)}var C=t.getSpanParent(l);if(!x||!C)return h.stopPropagation(),h.preventDefault(),!1;o.beginAction(),x!=C&&h.normCode!==KeyCode.Tab&&(b=b&&f.handleMultiselect(h,x,C,c));var I=[KeyCode.Tab,KeyCode.Enter,KeyCode.BackSpace,KeyCode.Delete];if(b&&I.indexOf(h.normCode)>=0){var A=t.getSpanParent(s.node);try{t.PAssert(1259,n.isEnabled()||A&&"SPAN"===A.tagName,"Expected SPAN, Actual: "+A.tagName)}catch(v){t.reportError(v)}if(A){var P=!1;if(h.shiftKey&&h.normCode===KeyCode.BackSpace){var D=t.getSelectOffsetsInSpan(void 0,A,c);0===D.start&&(P=!0)}h.normCode===KeyCode.Tab||P?b=b&&f.handleTab(h,c):h.normCode===KeyCode.Enter?b=b&&f.handleEnter(h,A,c):h.normCode===KeyCode.BackSpace?(b=b&&f.handleBackspace(h,A,c),y.item||f.updateAutocomplete(h)):h.normCode===KeyCode.Delete&&(b=b&&f.handleDelete(h,A,c))}}var k=h.normCode;h.normCode===KeyCode.Period&&(k=h.shiftKey?KeyCode.RAngle:KeyCode.Delete);var O=String.fromCharCode(k);if(b&&O&&h.normCode!==KeyCode.BackSpace&&h.normCode!==KeyCode.Enter&&!h.ctrlKey){a();try{t.PAssert(1260,t.getSpanParent(d)==t.getSpanParent(l))}catch(v){t.reportError(v)}var A=t.getSpanParent(s.node);try{t.PAssert(1261,n.isEnabled()||"SPAN"===A.tagName,"Expected SPAN, Actual: "+A.tagName)}catch(v){t.reportError(v)}E||(E=t.getItemForElement(A));try{t.PAssert(1262,E,"Must be able to get a valid item from the selected span")}catch(v){t.reportError(v)}var L,R=t.getSelectOffsetsInSpan(E,A,c);L=n.isEnabled()?n.getInputText():E.getParsedText();var _=!0,N=L.substr(0,R.startText)+O+L.substr(R.endText);if(R.startText!==R.endText&&(_=!1,o.performAction(TrackerType.Remove,{itemID:E.id,position:R.startText,text:L.slice(R.startText,R.endText)})),o.performAction(TrackerType.Insert,{itemID:E.id,position:R.startText,text:O}),r.ios)y.text=N,y.start=R.start+1,y.waitAutocorrect=" "==O?"space":void 0,y.item=E,b=!0;else{t.clearSelection(),E.setText(N,!0),t.selectChildren(E,R.start+1,0),b=!1;try{t.PAssert(1263,h.preventDefault,"Should always be defined")}catch(v){t.reportError(v)}h.preventDefault&&h.preventDefault(),f.updateAutocomplete(h)}}o.endAction()}return m=h.normCode,b},f.handleMultiselect=function(n,i,a,s){var c=[],d=0,l=!0,u=i.parentNode,h=a.parentNode;try{t.PAssert(1264,"LI"==u.tagName,"Expected LI, Actual: ",u)}catch(p){t.reportError(p)}try{t.PAssert(1265,"LI"==h.tagName,"Expected LI, Actual: ",h)}catch(p){t.reportError(p)}try{t.PAssert(1266,u!=h)}catch(p){t.reportError(p)}var m=e.dataFor(u),f=e.dataFor(h),g=m,v=t.getSelectOffsetsInSpan(m,i,s),y=t.getSelectOffsetsInSpan(f,a,s),b=0;do{var S={numLevels:0};g=t.getNextItem(g,t.focusedPane,S),g.parent()===t.focusedPane.item()&&g.isHeader()&&b++,d+=S.numLevels,(g!==f||y.end===y.total)&&c.push(g)}while(g!==f);var T=!0;if(c.length>=16&&b>=2&&(r.packagedApp||(T=confirm("You have selected a large number of items to delete, please confirm you want to perform this action."))),T){var w;if(v.start>0||y.end<y.total){var E=m.getParsedText(),M=f.getParsedText().substring(y.endText);w=E.substring(0,v.startText)+M,o.performAction(TrackerType.Remove,{itemID:m.id,position:v.startText,text:E.slice(v.startText)}),o.performAction(TrackerType.Insert,{itemID:m.id,position:v.startText,text:M}),c.indexOf(f)<0&&c.push(f),0===v.start&&m.copyProperties(f)}else o.performAction(TrackerType.Remove,{itemID:m.id,position:0,text:m.getParsedText()}),w="";if((n.normCode===KeyCode.BackSpace||n.normCode===KeyCode.Delete||n.normCode===KeyCode.Enter)&&(l=!1),f.moveChildren(m,0),d>0){var x,C=[];x=h.children.length>1?h.children[1].children[0]:h.nextElementSibling;for(var I=x;d>0&&I;){for(d--;void 0!==I&&null!==I;)C.push(I),I=I.nextElementSibling;x=x.parentElement.parentElement,I=x.nextElementSibling}if(C.length>0)for(var A=m,P=A.parent(),D=A.getIndex()+1,k=0;k<C.length;k++){var O=e.dataFor(C[k]),L=O.parent();O.moveTo({parent:P,index:D});var R=O.parent().getIndexOf(O);o.performAction(TrackerType.Move,{itemID:O.id,oldParent:L.id,oldPosition:R,newParent:P.id,newPosition:D}),D++}}for(var k=0;k<c.length;k++){var O=c[k];try{t.PAssert(1267,O,"Item must exist")}catch(p){t.reportError(p)}O.isDeleted||O.parent().deleteChild(O)}m.setText(w,!0),t.selectChildren(m,v.start,0)}else l=!1;return l},f.handleTab=function(r,i){if(n.isEnabled())var a=n.getCurrentVMLI(),s=n.getCurrentVMLI();else{var c=t.getSpanParent(i.startContainer),d=t.getSpanParent(i.endContainer),l=t.getSelectOffsetsInSpan(void 0,c,i),u=t.getSelectOffsetsInSpan(void 0,d,i);try{t.PAssert(1268,"LI"==c.parentNode.tagName,"Expected LI, Actual: ",c.parentNode)}catch(h){t.reportError(h)}try{t.PAssert(1269,"LI"==d.parentNode.tagName,"Expected LI, Actual: ",d.parentNode)}catch(h){t.reportError(h)}var a=e.dataFor(c.parentNode),s=e.dataFor(d.parentNode)}var p,m,f=a,g={},v=[a],y={},b={};if(b[a.id]=!0,a!==s)do{var S={numLevels:0,ignoreSearch:!0};f=t.getNextItem(f,void 0,S),p=f.parent(),v.push(f),b[f.id]=!0}while(f!==s);var T,w,E;if(r.shiftKey)var M=function(){T=v.length-1},w=function(){return T>=0},E=function(){T--};else var M=function(){T=0},w=function(){return T<v.length},E=function(){T++};for(M();w();E()){var x,C,I=v[T],p=I.parent(),A=p.items().indexOf(I);if(r.shiftKey){if(x=I.parent()!=t.focusedItem){m=I.parent().parent();{var P=p.items();P.length-A-1}for(C=A+1;P[A+1];){var D=P[A+1];b[D.id]||t.hasClass(D.getElement(),"hidden")?A++:(g[D.parent().id]=D.parent(),g[I.id]=I,D.moveTo({parent:I,underlying:!0}),y[D.id]=!0,o.performAction(TrackerType.Move,{itemID:D.id,oldParent:p.id,oldPosition:C,newParent:I.id,newPosition:I.items().length-1})),C++}if(b[p.id]>=0&&(!p.parent()||p.parent()!=t.focusedItem))continue;var k=m.items().indexOf(p);g[I.parent().id]=I.parent(),g[m.id]=m,I.moveTo({parent:m,index:k+1,underlying:!0}),y[I.id]=!0,o.performAction(TrackerType.Move,{itemID:I.id,oldParent:p.id,oldPosition:A,newParent:m.id,newPosition:k+1})}}else{if(x=A>0){for(m=p.items()[A-1];t.hasClass(m.getElement(),"hidden");){if(A--,0>=A)return!1;m=p.items()[A-1]}y[p.id]||(g[I.parent().id]=I.parent(),g[m.id]=m,I.moveTo({parent:m,underlying:!0})),y[I.id]=!0,o.performAction(TrackerType.Move,{itemID:I.id,oldParent:p.id,oldPosition:A,newParent:m.id,newPosition:m.items().length-1})}else m=p,y[I.id]=y[p.id];for(var O=!1,L=I;L;){if(y[L.id]){O=!0;break}L=L.parent()}var R=I.getIndex()+1;if(O){var _=I.items(),N=0;for(C=0;C<_.length;C++){var F=_[C];if(!b[F.id]){if(t.hasClass(F.getElement(),"hidden"))continue;g[F.parent().id]=F.parent(),g[I.parent().id]=I.parent();var V=R+N;F.moveTo({parent:I.parent(),index:V,underlying:!0}),y[F.id]=!0,o.performAction(TrackerType.Move,{itemID:F.id,oldParent:I.id,oldPosition:C,newParent:I.parent().id,newPosition:V}),N++,C--}}}}}for(var B in g)g[B].items.valueHasMutated();if(n.isEnabled())n.updateInputBounds(a);else if(a||s){try{t.PAssert(1270,a&&s)}catch(h){t.reportError(h)}t.selectMultiline(a.getSpan(),l.start,s.getSpan(),u.end)}r.handled=!0;try{t.PAssert(1271,r.preventDefault,"Should always be defined")}catch(h){t.reportError(h)}return r.preventDefault&&r.preventDefault(),!1},f.handleEnter=function(e,a,s){var c=t.getItemForElement(a),d=c.parent(),l=d.items().indexOf(c),u=t.getSelectOffsetsInSpan(c,a,s);n.isEnabled()&&n.finishInput(!0);var h,m=c.getParsedText(),f=!1,g=d,v=!0;if(0===u.end)h=c.isNumList()?new i({text:NumListPrefix},{parent:g,forceSave:!0}):new i({text:""},{parent:g,forceSave:!0}),l--,v=!1;else if(u.start>=u.total){f=!e.shiftKey&&!c.isCollapsed()&&(c.items().length>0||c.isHeader()),f&&(g=c);var b="";c.isNumList()&&(b=NumListPrefix),h=new i({text:b},{parent:g,forceSave:!0})}else if(0===u.start&&u.end===u.total)h=new i({text:""},{parent:g,forceSave:!0}),c.setText("",!0),o.performAction(TrackerType.Remove,{itemID:c.id,position:0,text:m});else{var S=u.start>0?m.substring(0,u.startText):"";secondText=u.endText<m.length?m.substring(u.endText):"",c.isNumList()&&(secondText=NumListPrefix+secondText),h=new i({text:S},{parent:g,forceSave:!0}),c.setText(secondText,!0),o.performAction(TrackerType.Remove,{itemID:c.id,position:u.startText,text:m.substring(u.startText)}),h.copyProperties(c),l--,v=!1}h.parseText(!0),f?(c.insertItem(h,0),o.performAction(TrackerType.Create,{itemID:h.id,parent:c.id,position:0,text:h.getParsedText()})):(g.insertItem(h,l+1),o.performAction(TrackerType.Create,{itemID:h.id,parent:g.id,position:l+1,text:h.getParsedText()}));var T=v?h:c;try{t.PAssert(1273,T,"Expected another item to exist")}catch(w){t.reportError(w)}if(r.ios)return y.start=u.start,y.waitAutocorrect="enter",y.item=v?c:h,y.nextItem=v?h:c,p||(p=t.element("tempInput")),p.innerHTML=y.item.getStyledText(),t.selectMultiline(p,u.start,p,u.start),!0;if(n.isEnabled()){n.updateInput(T);try{t.PAssert(1274,e.preventDefault,"Should always be defined")}catch(w){t.reportError(w)}return e.preventDefault&&e.preventDefault(),!1}t.selectChildren(T,0,0);try{t.PAssert(1275,e.preventDefault,"Should always be defined")}catch(w){t.reportError(w)}return e.preventDefault&&e.preventDefault(),!1},f.handleBackspace=function(e,i,a){var s=t.getItemForElement(i),c=s.parent(),d=t.getSelectOffsetsInSpan(s,i,a);n.isEnabled()&&n.finishInput(!0),r.ie&&(e.preventDefault(),e.stopImmediatePropagation());var l=s.getParsedText(),u=(s.getSpan(),""),h=0;if(0===d.startText&&0===d.endText||""===l){var p=t.getPreviousItem(s,t.focusedPane),f=t.getNextItem(s,t.focusedPane);if(p&&(!p.isFullscreen()||""===l&&f)){var g=p.getParsedText().length;c.deleteChild(s,p,0),l.length>0&&""!==l&&(0===p.getParsedText().length&&p.copyProperties(s),p.setText(p.getParsedText()+l,!0),o.performAction(TrackerType.Insert,{itemID:p.id,position:g,text:l}));var v=p.isFullscreen()?p.getFirstChild():p,b=p.isFullscreen()?0:g;return t.selectChildren(v,b,0),!1}return!1}if(e.metaKey&&d.startText===l.length||0===d.startText&&d.endText===l.length)o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:s.getParsedText()}),u="",h=0;else if(e.metaKey)u=l.substring(d.startText),o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l.slice(0,d.startText)}),h=0;else if((r.mac&&e.altKey||!r.mac&&e.ctrlKey)&&d.start===d.end){for(var S=l.substring(d.startText),T=!1,w=!1,E=d.startText-1;E>=0&&!w;E--)if(T=T||" "!==l[E],!(" "==l[E]&&" "==l[E-1]||0!==E&&" "!==l[E]&&"@"!==l[E])){var M=0===E||E===d.startText-1?E:E+1;(T||" "!==l[E])&&(o.performAction(TrackerType.Remove,{itemID:s.id,position:M,text:l.slice(M,d.startText)}),u=l.substring(0,M)+S,h=M,w=!0)}w||(d.startText===l.length?0===d.start&&(u="",o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l})):(o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l.slice(0,d.startText)}),u=S),h=0)}else if(1===d.start&&1===d.end&&1===l.length&&""!=l[0])o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:s.getParsedText()}),u="",h=0;else{try{t.PAssert(1278,d.start>=0)}catch(x){t.reportError(x)}if(d.start!=d.end)o.performAction(TrackerType.Remove,{itemID:s.id,position:d.startText,text:l.slice(d.startText,d.endText)}),u=l.substr(0,d.startText)+l.substr(d.endText),h=d.start;else{var C=1;l.length>1&&""==l[d.startText-1]&&C++,u=l.substr(0,d.startText-C)+l.substr(d.startText),o.performAction(TrackerType.Remove,{itemID:s.id,position:d.startText-C,text:l.slice(d.startText-C,d.startText)}),h=d.startText-C}}return r.phone&&m!==KeyCode.BackSpace?(y.text=u,y.start=h,y.item=s,0===u.length&&(s.setStyledText(TextSpace+" ",!0),t.selectChildren(s,1,0)),!0):(s.setText(u,!0),t.selectChildren(s,h,0),!1)},f.handleDelete=function(n,i,a){var s=e.dataFor(i.parentNode),c=t.getSelectOffsetsInSpan(s,i,a);try{t.PAssert(1279,s)}catch(d){t.reportError(d)}{var l=s.parent(),u=s.getIndex(),h=s.getParsedText();s.getSpan()}if(""===h){var p=t.getNextItem(s,t.focusedPane),m=0;p||(p=t.getPreviousItem(s,t.focusedPane),m=p.getParsedText().length),p&&!p.isFullscreen()&&(s.hasChildren()?l.replaceChild(s,s.getFirstChild()):l.deleteChild(s,l,u),t.selectChildren(p,m,m))}else if(c.start===c.total&&c.end===c.total||c.start===c.total-1&&c.end===c.total-1&&""===i.textContent[c.endText]){var f=t.getNextItem(s,t.focusedPane);f&&(s.setText(h+f.getParsedText(),!0),o.performAction(TrackerType.Insert,{itemID:s.id,position:h.length,text:f.getParsedText()}),f.parent().deleteChild(f,s,0),t.selectChildren(s,c.total,0))}else if(0===c.start&&0===c.end&&1===h.length&&""!=h[0])s.setText("",!0),o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:h});else if((r.mac&&n.altKey||!r.mac&&n.ctrlKey)&&c.start===c.end){for(var g=h.substring(0,c.startText),v=!1,y=!1,b=c.startText;b<h.length&&!y;b++)if(v=v||" "!==h[b],b===h.length-1||" "===h[b]){var S=" "===h[b]&&" "==h[c.startText]?b:b+1;if(v||" "!==h[b]){var T=g+h.substring(S);s.setText(T,!0),o.performAction(TrackerType.Remove,{itemID:s.id,position:S,text:T}),t.selectChildren(s,c.start,0),y=!0}}}else if(c.start!=c.end){var T=h.substr(0,c.startText)+h.substr(c.endText);s.setText(T,!0),o.performAction(TrackerType.Remove,{itemID:s.id,position:c.startText,text:h.slice(c.startText,c.endText)}),t.selectChildren(s,c.start,0)}else{var T=h.substr(0,c.startText)+h.substr(c.startText+1);s.setText(T,!0),o.performAction(TrackerType.Remove,{itemID:s.id,position:c.startText,text:h.slice(c.startText,c.startText+1)}),t.selectChildren(s,c.start,0)}return!1},f}),define("AScript",["globals","platform","data","tracker","VMLI","edit"],function(e,t,r){function n(){this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.needsFinish=!1,this.lastCreatedItem=void 0,this.lastLoadedData="demo.5",this._scriptQueue=[],this.startText={},window.addEventListener("message",function(t){if(t.data.indexOf("{")<0){var r=t.data.split(":");try{e.PAssert(1280,r.length>=0,"Invalid number of params in message")}catch(n){e.reportError(n)}switch(r[0]){case"script":this.finishAndRunScript(r[1]);break;case"data":this.loadScriptData(r[1])}}}.bind(this),!1),window.pauseScript=function(){this.isDisabled||(log("pause script"),this.isDisabled=!0)}.bind(this)}var i={Run:1,Reset:2};return n.prototype={runScript:function(t,r){if(!this.isDisabled){switch(t){case"power":this._scriptQueue.push(this.demoPower("power0",0)),this._scriptQueue.push(this.demoPower("power1",1)),this._scriptQueue.push(this.demoPower("power2",2)),this._scriptQueue.push(this.demoPower("power3",3)),this._scriptQueue.push(this.demoPower("power4",4));var n=this.createScript("delay");n.queue(i.Run,"delay",5e3),this._scriptQueue.push(n);break;case"main":this._scriptQueue.push(this.demoMain(t));break;case"mainp":this._scriptQueue.push(this.demoMain(t,!0));break;case"search":this._scriptQueue.push(this.demoSearch(t));break;case"power0":case"power1":case"power2":case"power3":case"power4":var o=parseInt(t.replace("power",""),10);this._scriptQueue.push(this.demoPower(t,o));break;case"p0":case"p1":case"p2":case"p3":case"p4":case"p5":var o=parseInt(t.replace("p",""),10);this._scriptQueue.push(this.demoPrioritize(t,o)),r=!1;break;case"f0":case"f1":case"f2":case"f3":case"f4":case"f5":var o=parseInt(t.replace("f",""),10);this._scriptQueue.push(this.demoFocus(t,o)),r=!1;break;case"indent":this._scriptQueue.push(this.demoIndent(t));break;case"none":return;default:try{e.PAssert(1281,!1,"Invalid script request")}catch(a){e.reportError(a)}}this.repeat=r,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&(this.onScriptStart(this.activeScript),this.reset(),this.run())}},forceFinish:function(t){try{e.PAssert(1282,t,"Must supply a callback to force finish")}catch(r){e.reportError(r)}if(this.isRunning)this.needsFinish=!0,this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayCb(),this.delayCb=this.delayTimeout=void 0),this.onScriptDone=function(){this.needsFinish=!1,t(),this.onScriptDone=void 0}.bind(this);else{try{e.PAssert(1283,this.needsFinish===!1,"Should never be forcing a finish if not actively running")}catch(r){e.reportError(r)}t()}},finishAndRunScript:function(e){this._scriptQueue=[],this.repeat=!1,this.forceFinish(function(){this.runScript(e,!1)}.bind(this))},loadScriptData:function(t){log("Load Script Data: ",t),this._scriptQueue=[],this.repeat=!1,this.lastLoadedData!==t&&(this.lastLoadedData=t,e.vmMain.resetScrollOffsets(),r.loadDemoData(t,e.vmMain.changeRoot))},onScriptStart:function(e){e&&window.parent.postMessage(e.getName(),"*")},getRoot:function(){return r.getRootModel()},getFirstItem:function(){return r.getRootModel().getChild(0)},setSelection:function(t,r,n,i){try{e.PAssert(1285,t,"Must provide a valid item to select")}catch(o){e.reportError(o)}e.focusedPaneID!==r&&e.vmMain.setFocusedPane(e.vmMain.panes[r]),void 0===n||null===n?n=0:0>n&&(n=t.getParsedText().length+n+1),e.selectChildren(t,n,0),this.hasSelection=!0,this.selectedItem=t,i&&i()},selectEndOfLine:function(e,t,r){this.setSelection(e,t,-1,r)},clearSelection:function(t){e.clearSelection(),this.hasSelection=!1,this.selectedItem=void 0,t&&t()},scrollTo:function(t,r,n){var i=e.vmMain.panes()[t];try{e.PAssert(1286,i,"Must have selected a valid pane")}catch(o){e.reportError(o)}i.setScrollOffset(r),n&&n()},setText:function(e,t,r){e.setText(t,!0),r&&r()},appendText:function(e,t,r){e.setText(e.getRawText()+t,!0),r&&r()},removeText:function(e,t,r){var n=e.getRawText().replace(t,"");e.setText(n,!0),r&&r()},setPriority:function(e,t,r){e.priority(t),r&&r()},setFlagged:function(e,t,r){e.isFlagged(t),r&&r()},setComplete:function(e,t,r,n){e.dateCompleted=r,e.isComplete(t),n&&n()},indent:function(t,r){var n={normCode:KeyCode.Tab,shiftKey:t};e.fireKeyEvent(void 0,n),r&&r()},_deleteChildren:function(e){for(var t=0;t<e.items().length;t++)this._deleteChildren(e.items()[t]),delete r.itemsById[e.items()[t].id]},clearChildren:function(e,t){this._deleteChildren(e),e.items.removeAll(),t&&t()},typeString:function(t,r,n,i){function o(){e.fireKeyEvent(void 0,{normCode:r.charCodeAt(c)}),++c>=r.length&&(s&&clearInterval(s),this.isTyping=!1,i&&i())}try{e.PAssert(1287,i,"typeString should always have a callback")}catch(a){e.reportError(a)}this.needsFinish&&(n=0),this.selectEndOfLine(t||this.lastCreatedItem,0);try{e.PAssert(1288,this.hasSelection,"Must set selection before typing")}catch(a){e.reportError(a)}try{e.PAssert(1289,!this.isTyping,"Must wait until previous typing is finished")}catch(a){e.reportError(a)}try{e.PAssert(1290,void 0!==r,"Must supply a string to be typed")}catch(a){e.reportError(a)}try{e.PAssert(1291,void 0!==n,"Must specify a delay between each typed character")}catch(a){e.reportError(a)}this.isTyping=!0;var s,c=0;s=setInterval(o.bind(this),n)},resetSearch:function(t){for(var r=0;r<e.vmMain.panes().length;r++)e.vmMain.panes()[r].vmSearch.setSearch("");t&&t()},hideAutoComplete:function(t){e.autocomplete&&e.autocomplete.hide(),t&&t()},setSearch:function(t,r,n){e.vmMain.panes()[r].vmSearch.setSearch(t),n&&n()},searchString:function(t,r,n,i,o){try{e.PAssert(1292,!this.isTyping,"Must wait until previous typing is finished")}catch(a){e.reportError(a)}try{e.PAssert(1293,void 0!==t,"Must supply a string to be typed")}catch(a){e.reportError(a)}try{e.PAssert(1294,void 0!==r,"Must specify a delay between each typed character")}catch(a){e.reportError(a)}this.isTyping=!0;var s=e.vmMain.panes()[i].vmSearch,c=n?"":s.search(),d=0,l=setInterval(function(){s.setSearch(c+t.substr(0,d+1)),++d>=t.length&&(clearInterval(l),this.isTyping=!1,o&&o())}.bind(this),r)},createItemAfter:function(t,r){t?this.setSelection(t,0,t.getParsedText().length):t=this.selectedItem||this.lastCreatedItem,e.fireKeyEvent(void 0,{normCode:KeyCode.Enter}),this.clearSelection(function(){var e;e=t.isHeader()?t.getChild(0):t.parent().getChild(t.getIndex()+1),this.lastCreatedItem=e,this.setSelection(e,0,-1,r)}.bind(this))},clickElement:function(t,r){try{e.PAssert(1295,t,"Requesting selection in an invalid element")}catch(n){e.reportError(n)}e.fireClickEvent(t,Button.Left),r&&r()},zoomItem:function(t,r){e.vmMain.zoomin(t,!1),r&&r()},openOutline:function(t,r){var n=e.vmMain.panes()[t];n.outlineVisible()||n.toggleOutlineVisibility(),r&&r()},closeOutline:function(t,r){var n=e.vmMain.panes()[t];n.outlineVisible()&&n.toggleOutlineVisibility(),r&&r()},openContextMenu:function(t,r){try{e.PAssert(1296,t,"Requesting selection in an invalid item")}catch(n){e.reportError(n)}var i=t.getElement().getBoundingClientRect(),o=i.left+150,a=i.top+10;e.menus.openItemMenu(t,{x:o,y:a}),r&&r()},closeContextMenu:function(t){e.menus.closeItemMenu(),t&&t()},hoverMenuItem:function(t,r){try{e.PAssert(1297,t,"Requesting selection in an invalid element")
}catch(n){e.reportError(n)}try{e.PAssert(1298,!e.hasClass(t,"menuHover"),"Dont apply hover twice to an element")}catch(n){e.reportError(n)}e.addClass(t,"menuHover"),r&&r()},unhoverMenuItem:function(t,r){try{e.PAssert(1299,t,"Requesting selection in an invalid element")}catch(n){e.reportError(n)}try{e.PAssert(1300,e.hasClass(t,"menuHover"),"Cant unhover when not previously hovered")}catch(n){e.reportError(n)}e.removeClass(t,"menuHover"),r&&r()},delay:function(e,t){t&&(this.needsFinish?t&&t():(this.delayCb=t,this.delayTimeout=setTimeout(function(){this.delayCb=this.delayTimeout=void 0,t()}.bind(this),e)))},setPaneModeAnim:function(e,t,r){var n=document.getElementsByClassName("paneOptionsButton")[e];this.clickElement(n),this.delay(function(){var n=t===PaneMode.Timeline?"paneTimelineView":"paneListView",i=document.getElementsByClassName(n)[e];this.hoverMenuItem(i),this.delay(function(){this.clickElement(i),this.unhoverMenuItem(i),r&&r()}.bind(this),800)}.bind(this),300)},setPaneModeInstant:function(t,r,n){var i=e.vmMain.panes()[t];i.mode(r),n&&n()},addPane:function(t,r){e.vmMain.addPaneToRight(t),r&&r()},removePaneAnim:function(e,t){var r=document.getElementsByClassName("paneOptionsButton")[e];this.clickElement(r),this.delay(function(){var r=document.getElementsByClassName("paneClose")[e];this.hoverMenuItem(r),this.delay(function(){this.clickElement(r),this.unhoverMenuItem(r),t&&t()}.bind(this),800)}.bind(this),300)},removePaneInstant:function(t,r){var n=e.vmMain.panes()[t];e.vmMain.removePane(n),r&&r()},setSubtitle:function(t,r,n){var i=e.messageQueue.pushMessage({text:t,type:MessageType.Subtitle});setTimeout(function(){e.messageQueue.clearMessage(i),n&&n()}.bind(this),r)},createScript:function(e){var t={owner:this,_name:e,index:0,isResetting:!1,_repeat:!1,noDelay:!1,runQueue:[],resetQueue:[],_activeQueue:function(){return this.isResetting?this.resetQueue:this.runQueue},queue:function(e,t){var r=Array.prototype.slice.call(arguments,2),n=e==i.Run?this.runQueue:this.resetQueue;return n.push({name:t,args:r}),n},repeat:function(e){this._repeat=e},reset:function(){this.index=0;for(var e=0;e<this.resetQueue.length;e++){var t=this.resetQueue[e];this.owner[t.name].apply(this.owner,t.args)}},nextStep:function(){var e=this.runQueue;return e[this.index++]},getName:function(){return this._name}};return t},reset:function(){this.index=0;for(var e=0;e<this._scriptQueue.length;e++)this._scriptQueue[e].reset()},run:function(){if(!this.isDisabled){try{e.PAssert(1303,this.activeScript,"Must have a script active to be running")}catch(t){e.reportError(t)}var r=this.activeScript.nextStep();if(!r){if(this.index++,this.index>=this._scriptQueue.length){if(!this.repeat)return this.isRunning=!1,void(this.onScriptDone&&this.onScriptDone());this.reset()}this.activeScript=this._scriptQueue[this.index],this.activeScript.reset(),this.onScriptStart(this.activeScript),r=this.activeScript.nextStep()}var n=r.args;n.push(this.run.bind(this)),n.push(this.activeScript),this.isRunning=!0,setTimeout(function(){try{this[r.name].apply(this,n)}catch(t){e.reportError(t),this.onDisable()}}.bind(this),0)}},onDisable:function(){this.isDisabled=!0},demoIndent:function(e){var t=this.createScript(e),n=r.itemsById.itemIndent.model;return t.queue(i.Run,"delay",2e3),t.queue(i.Run,"setSelection",n,0,0),t.queue(i.Run,"indent",!1),t.queue(i.Run,"delay",2e3),t.queue(i.Run,"setSelection",n,0,0),t.queue(i.Run,"indent",!0),t},demoMain:function(e){var t=this.createScript(e);return t.queue(i.Run,"delay",500),t.queue(i.Reset,"delay",500),t;var t},demoSearch:function(e){var t=this.createScript(e),n=2e3,o=r.itemsById.searchItem.model;return t.queue(i.Run,"delay",n),t.queue(i.Run,"setSearch","#tag",0),t.queue(i.Run,"delay",n),t.queue(i.Run,"resetSearch"),t.queue(i.Run,"delay",n),t.queue(i.Run,"setSearch","!",0),t.queue(i.Run,"delay",n),t.queue(i.Run,"setSearch","!!!",0),t.queue(i.Run,"delay",n),t.queue(i.Run,"resetSearch"),t.queue(i.Run,"delay",n),t.queue(i.Run,"zoomItem",o),t.queue(i.Run,"delay",n),t.queue(i.Run,"setSearch","#tag",0),t.queue(i.Run,"delay",n),t.queue(i.Run,"zoomItem",this.getRoot()),t.queue(i.Run,"resetSearch"),t.queue(i.Run,"delay",n),t.queue(i.Run,"setSearch","+Jane",0),t.queue(i.Run,"delay",n),t.queue(i.Reset,"resetSearch"),t},loadItemAndReset:function(e,t){var n,o=r.itemsById[e].model;return n=this.startText[e]?this.startText[e]:this.startText[e]=r.itemsById[e].data.text,log("reset text = ",n),t.queue(i.Reset,"setText",o,n),t.queue(i.Reset,"setPriority",o,VMLIFlag.None),t.queue(i.Reset,"setFlagged",o,!1),t.queue(i.Reset,"setComplete",o,!1,void 0),o},demoPrioritize:function(e,t){var r=this.createScript(e),n=this.loadItemAndReset("yard",r),o=this.loadItemAndReset("roof",r),a=this.loadItemAndReset("vacation",r),s=this.loadItemAndReset("chips",r),c=this.loadItemAndReset("present",r),d=this.loadItemAndReset("shorts",r),l=this.loadItemAndReset("laptop",r),u=this.loadItemAndReset("app",r);return 0===t?(r.queue(i.Run,"appendText",n," @later"),r.queue(i.Run,"appendText",o," @soon"),r.queue(i.Run,"appendText",a," @later"),r.queue(i.Run,"appendText",s," @now"),r.queue(i.Run,"appendText",c," @now"),r.queue(i.Run,"appendText",d," @later"),r.queue(i.Run,"appendText",l," @soon"),r.queue(i.Run,"appendText",u," @now")):1===t?(r.queue(i.Run,"appendText",n," @next friday"),r.queue(i.Run,"appendText",o," @tomorrow"),r.queue(i.Run,"appendText",a," @"+Date.today().addDays(42).toString("M/dd")),r.queue(i.Run,"appendText",s," @today 6pm"),r.queue(i.Run,"appendText",c," @today 3pm"),r.queue(i.Run,"appendText",d," @"+Date.today().addDays(4).toString("M/dd")),r.queue(i.Run,"appendText",l," @"+Date.today().addDays(3).toString("M/dd")),r.queue(i.Run,"appendText",u," @today "+(new Date).toString("h:mmtt"))):2===t?(r.queue(i.Run,"setPriority",n,VMLIFlag.P2),r.queue(i.Run,"setPriority",o,VMLIFlag.P1),r.queue(i.Run,"setPriority",a,VMLIFlag.P2),r.queue(i.Run,"setPriority",s,VMLIFlag.P0),r.queue(i.Run,"setPriority",c,VMLIFlag.P0),r.queue(i.Run,"setPriority",d,VMLIFlag.P2),r.queue(i.Run,"setPriority",l,VMLIFlag.P1),r.queue(i.Run,"setPriority",u,VMLIFlag.P0)):3===t?(r.queue(i.Run,"setFlagged",s,!0),r.queue(i.Run,"setFlagged",c,!0),r.queue(i.Run,"setFlagged",u,!0)):4===t?(r.queue(i.Run,"setComplete",o,!0,(new Date).addDays(-2)),r.queue(i.Run,"setComplete",s,!0,(new Date).addMinutes(-10)),r.queue(i.Run,"setComplete",c,!0,(new Date).addMinutes(-10)),r.queue(i.Run,"setComplete",l,!0,(new Date).addDays(-11)),r.queue(i.Run,"setComplete",u,!0,new Date)):5===t&&(r.queue(i.Run,"appendText",n," @later"),r.queue(i.Run,"setPriority",o,VMLIFlag.P1),r.queue(i.Run,"appendText",a," @tomorrow"),r.queue(i.Run,"appendText",s," @today 6pm"),r.queue(i.Run,"appendText",c," @today 3pm"),r.queue(i.Run,"setPriority",c,VMLIFlag.P0),r.queue(i.Run,"setPriority",d,VMLIFlag.P2),r.queue(i.Run,"setComplete",l,!0,(new Date).addDays(-1)),r.queue(i.Run,"setFlagged",u,!0),r.queue(i.Run,"appendText",u," @now")),r},demoFocus:function(e,t){var r=this.createScript(e);return 0===t?r.queue(i.Run,"setSearch","#out",1):1===t?(r.queue(i.Run,"setSearch","!",1),r.queue(i.Run,"delay",2e3),r.queue(i.Run,"setSearch","!!!",1)):2===t?r.queue(i.Run,"setSearch","+Miller Harris",1):3===t?r.queue(i.Run,"setSearch","-//",1):4===t?r.queue(i.Run,"setSearch","Japan",1):5===t&&(r.queue(i.Run,"setSearch","!",1),r.queue(i.Run,"delay",1e3),r.queue(i.Run,"setSearch","! todo",1),r.queue(i.Run,"delay",1e3),r.queue(i.Run,"setSearch","! todo ! app",1),r.queue(i.Run,"delay",1e3),r.queue(i.Run,"setSearch","! todo ! app -jap",1)),r},demoPower:function(e,t){var n=this.createScript(e);if(0===t){var o=r.itemsById.groceriesItem.model;n.queue(i.Run,"delay",500),n.queue(i.Run,"resetSearch"),n.queue(i.Run,"createItemAfter",o),n.queue(i.Run,"indent",!1),n.queue(i.Run,"typeString",void 0,"Peaches",60),n.queue(i.Run,"createItemAfter",void 0),n.queue(i.Run,"typeString",void 0,"Apples",60),n.queue(i.Run,"createItemAfter",void 0),n.queue(i.Run,"typeString",void 0,"Almonds",60);var a=r.itemsById.vacationItem.model;n.queue(i.Run,"createItemAfter",a),n.queue(i.Run,"typeString",void 0,"Hotels",60),n.queue(i.Run,"createItemAfter",void 0),n.queue(i.Run,"typeString",void 0,"Cliff Cottage - $199 - View of beach",30),n.queue(i.Run,"createItemAfter",void 0),n.queue(i.Run,"typeString",void 0,"Beach Resort - $399 - On the beach",30),n.queue(i.Run,"delay",500),n.queue(i.Reset,"clearChildren",a),n.queue(i.Reset,"clearChildren",o),n.queue(i.Reset,"removeText",a,":"),n.queue(i.Reset,"removeText",o,":")}else if(1===t){var s=" @Fri 4pm",c=" @Tues 8pm",d=" @Monday",l=r.itemsById.movieItem.model;n.queue(i.Run,"delay",500),n.queue(i.Run,"resetSearch"),n.queue(i.Run,"typeString",l,s,40);var u=r.itemsById.movieItem2.model;n.queue(i.Run,"delay",500),n.queue(i.Run,"typeString",u,c,40);var h=r.itemsById.rentItem.model;n.queue(i.Run,"delay",500),n.queue(i.Run,"typeString",h,d,40),n.queue(i.Run,"delay",500),n.queue(i.Reset,"removeText",l,s),n.queue(i.Reset,"removeText",u,c),n.queue(i.Reset,"removeText",h,d),n.queue(i.Run,"delay",500),n.queue(i.Run,"resetSearch"),n.queue(i.Run,"hideAutoComplete"),n.queue(i.Run,"setPriority",h,VMLIFlag.P1),n.queue(i.Run,"delay",1e3);var o=r.itemsById.groceriesItem.model;n.queue(i.Run,"setPriority",o,VMLIFlag.P2),n.queue(i.Run,"delay",1e3);var p=r.itemsById.laptopItem.model;n.queue(i.Run,"setPriority",p,VMLIFlag.P0),n.queue(i.Run,"delay",1e3);var a=r.itemsById.vacationItem.model;n.queue(i.Run,"setFlagged",a,!0),n.queue(i.Run,"delay",1e3),n.queue(i.Reset,"setPriority",h,VMLIFlag.None),n.queue(i.Reset,"setPriority",o,VMLIFlag.None),n.queue(i.Reset,"setFlagged",a,!1)}else if(2===t){var m=" +Jay",f=" +Grant",g=" +Honey Bear",l=r.itemsById.movieItem.model;n.queue(i.Run,"delay",500),n.queue(i.Run,"resetSearch"),n.queue(i.Run,"typeString",l,m,50),n.queue(i.Run,"delay",1e3),n.queue(i.Run,"typeString",l,f,50),n.queue(i.Run,"delay",1e3);var o=r.itemsById.groceriesItem.model;n.queue(i.Run,"typeString",o,g,50),n.queue(i.Run,"delay",1e3),n.queue(i.Run,"hideAutoComplete"),n.queue(i.Reset,"removeText",l,m),n.queue(i.Reset,"removeText",l,f),n.queue(i.Reset,"removeText",o,g)}else if(3===t){var v=r.itemsById.todoItem.model;n.queue(i.Run,"resetSearch"),n.queue(i.Run,"delay",500),n.queue(i.Run,"openOutline",0),n.queue(i.Run,"delay",1e3),n.queue(i.Run,"zoomItem",v),n.queue(i.Run,"delay",300),n.queue(i.Run,"closeOutline",0),n.queue(i.Run,"delay",2e3),n.queue(i.Run,"openOutline",0),n.queue(i.Run,"delay",1e3),n.queue(i.Run,"zoomItem",this.getRoot()),n.queue(i.Run,"delay",300),n.queue(i.Run,"closeOutline",0),n.queue(i.Run,"delay",500),n.queue(i.Reset,"zoomItem",this.getRoot())}else if(4===t){{var y=" #out",o=r.itemsById.groceriesItem.model;o.getRawText()}n.queue(i.Run,"delay",500),n.queue(i.Run,"resetSearch"),n.queue(i.Run,"typeString",o,y,40),n.queue(i.Run,"delay",500);{var b=r.itemsById.shoppingItem.model;b.getRawText()}n.queue(i.Run,"typeString",b,y,40),n.queue(i.Run,"delay",1e3),n.queue(i.Run,"searchString","#out",40,!0,0),n.queue(i.Run,"delay",1500),n.queue(i.Run,"searchString"," !",40,!1,0),n.queue(i.Run,"delay",1500),n.queue(i.Run,"searchString"," -gro",40,!1,0),n.queue(i.Run,"scrollTo",0,0),n.queue(i.Run,"delay",1500),n.queue(i.Run,"searchString","!",40,!0,1),n.queue(i.Run,"delay",1e3),n.queue(i.Run,"searchString","!",40,!1,1),n.queue(i.Run,"delay",1e3),n.queue(i.Run,"searchString","!",40,!1,1),n.queue(i.Reset,"removeText",b,y),n.queue(i.Reset,"removeText",o,y),n.queue(i.Reset,"resetSearch"),n.queue(i.Reset,"scrollTo",0,30)}return n}},n}),define("VMSetup",["ko","data","globals","util","platform","goog","AScript"],function(e,t,r,n,i,o,a){function s(){this.loginState=e.observable(LoginState.NONE),this.loginEnabled=e.observable(!0),this.loginStatus=e.observable(""),o.gapiLoaded||(this.loginDisableTimeout=setTimeout(function(){this.loginEnabled(!1),this.loginStatus("Must be online to login")}.bind(this),1e3),window.addEventListener("gapiLoaded",function(){clearTimeout(this.loginDisableTimeout),this.loginEnabled(!0),this.loginStatus("")}.bind(this),!0))}return s.prototype={init:function(){if(r.isDemoMode())return LoginState.LOGGED_OUT;var e=r.getLoginState();return this.setLoginState(e),r.applyBindings(this,"setup"),window.addEventListener("offline",function(){log("Browser going offline."),r.vmMain.setGDriveStatus(DriveStatus.Offline)}),window.addEventListener("online",function(){if(log("Browser going online."),r.getLoginState()==LoginState.LOGGED_IN&&!i.offline){r.vmMain.setGDriveStatus(DriveStatus.Connecting);var e=o.goOnline();log("Coming online. Already online:",e)}}),e},logoutButtonText:function(){return r.isDemoMode()?"Leave Introduction":"Logout"},setLoginState:function(e){e!=this.loginState()&&(r.setLoginState(e),this.loginState(e))},userLogin:function(){o.runAuthenticate(o.requiredScopes,!1,!0,function(e){e&&!e.error?(r.settings.set(Settings.localIntegrity,!0),this.setLoginState(LoginState.LOGGED_IN),gapi.load("drive-realtime",function(){o.loadClientDefaultFile()})):log("Invalid token returned when calling userLogin")}.bind(this))},openLogin:function(){this.loginState(LoginState.NONE),r.StopSpinner()},logout:function(){r.settings.reset(),this.setLoginState(LoginState.LOGGED_OUT),t.clearData(function(){n.hasURLParam("login")?n.removeURLParam("login"):i.app?i.app&&i.sendToApp("logout"):r.reload()})},logoutClicked:function(){if(r.isDemoMode())n.removeURLParam("demo");else{var e=!0;for(var o in t.pendingRemoteUpdates)if(t.pendingRemoteUpdates.hasOwnProperty(o)){i.packagedApp||(e=confirm("You have unsaved changes which will be lost if you log out. Are you sure?"));break}e&&this.logout()}},isLocal:function(){return"localhost"==window.location.hostname},onlineStatusToggle:function(){i.offline?n.removeURLParam("offline"):n.insertURLParam("offline","true")},runScript:function(e){r.AScript||(r.AScript=new a),r.AScript.runScript(e,!0)},onTapLogin:function(){r.vmMain.isOnline()&&this.userLogin()},onTapInput:{onClick:function(e){i.ios&&(e.srcElement.focus(),r.enforceScroll())}},onTap:{onMove:function(e){e.diffY<0&&e.preventDefault()}},onTapLanding:function(){window.location.pathname="/about/"},onPrivacyPolicy:{onClick:function(){open("/privacy")}}},s}),define("kos",[],function(){return null}),define("parse",["globals","VMLI","tracker","data"],function(e,t,r,n){function i(e){for(var t={},r=0;r<e.childElementCount;++r){var n=e.children[r],i=n.nodeName;if(n.firstChild){var o=n.firstChild.textContent;t[i]=o}}return t}function o(e){if(e.parent=void 0,e.items)for(var t=0;t<e.items.length;t++)o(e.items[t])}var a={};return a.parseOPML=function(e,o){function a(e,r){var c=!0,d=void 0;switch(e.nodeName){case"#document":case"body":case"opml":break;case"head":c=!1;var l=i(e);l&&l.title&&!s&&(s=new t({text:l.title},{parent:n.getRootModel(),parse:!0,forceSave:!0}),n.getRootModel().insertItem(s));break;case"outline":r||(s?r=s:(r=s=new t({text:o},{parent:n.getRootModel(),parse:!0,forceSave:!0}),n.getRootModel().insertItem(s))),d=new t({text:e.attributes.text.value},{parent:r,parse:!0,forceSave:!0}),r.insertItem(d);break;default:log("Unknown OPML Node: ",e)}if(c)for(var u=0;u<e.childElementCount;++u)a(e.children[u],d);return d}var s;return r.beginAction(),a(e),r.endAction(),!0},a.parseJSON=function(e,i){function o(e,r){var a=r||i||n.getRootModel(),s={text:e.text,dateCompleted:e.dateCompleted,priority:e.priority,isComplete:e.isComplete,isFlagged:e.isFlagged},c=new t(s,{parent:a,parse:!0,forceSave:!0});if(a.insertItem(c),e.items)for(var d=0;d<e.items.length;++d)o(e.items[d],c)}var a;if(void 0!==e.moodoVer&&void 0!==e.moodoRoot)try{return a=parseInt(e.moodoVer),r.beginAction(),o(e.moodoRoot),r.endAction(),!0}catch(s){}else if(void 0!==e.text&&void 0!==e.items)try{return r.beginAction(),o(e),r.endAction(),!0}catch(s){}return!1},a.traverseDOM=function(e){function t(e){if(e.nodeType===Node.TEXT_NODE){(m||p)&&(u.text=u.text.trim(),""!==u.text&&(h={text:"",parent:u.parent},u.parent.items.push(h),u=h)),m=!1,p=!1;var t=e.nodeValue;""===u.text&&(t=e.nodeValue.replace(/^\s+/g,"")),u.text+=t}else e.nodeType===Node.COMMENT_NODE||("BR"==e.tagName||"P"==e.tagName||"LI"==e.tagName||"DIV"==e.tagName?p=!0:("UL"==e.tagName||"OL"==e.tagName)&&(p=!1,u.text=u.text.trim(),h={text:"",parent:u},u.items?u.items.push(h):u.items=[h],u=h))}function r(e){e.nodeType!==Node.TEXT_NODE&&("UL"==e.tagName||"OL"==e.tagName?(u=u.parent,m=!0):("DIV"==e.tagName||"P"==e.tagName)&&(p=!0))}function n(e,t){isNaN(t)&&(t=0);for(var r="",i=0;t>i;i++)r+="--";if(t&&console.log(r,e.text),e.items)for(var i=0;i<e.items.length;i++)n(e.items[i],t+1)}var i=e.root,a=e.stripParents,s=e.shouldPrint,d=i.firstChild,l={items:[]},u={text:"",parent:l};l.items.push(u);var h,p=!1,m=!1;do if(t(d),c=d.firstChild)d=c;else if(c=d.nextSibling)d=c;else{do c=d.parentNode.nextSibling,c?(r(d.parentNode),d=c):(d=d.parentNode,r(d));while(!c&&d&&d.parentNode);if(!c)break}while(d);return a&&o(l),s&&n(l),l},a}),define("copypaste",["ko","globals","platform","edit","VMLI","tracker","parse"],function(e,t,r,n,i,o,a){function s(e){try{t.PAssert(1305,e.preventDefault,"Should always be defined")}catch(r){t.reportError(r)}try{t.PAssert(1306,e.stopPropagation,"Should always be defined")}catch(r){t.reportError(r)}e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}function c(c){c.srcElement||(c.srcElement=c.target);var d=c&&c.clipboardData?c.clipboardData:window.clipboardData,l=r.ie?"Text":"text/plain",u="",h=t.getSelectionInfo();if(h&&h.selection){var p=h.selection.getRangeAt(0),m=t.getPaneForElement(c.srcElement);if(t.hasClass(c.srcElement,"search"))return(/text\/plain/.test(d.types)||r.ie)&&(c.srcElement.textContent=d.getData(l).replace(/[\r\n\t]/g,""),t.selectElement(c.srcElement,!0)),c.preventDefault(),!1;if(m){if(m.mode()!==PaneMode.Normal)return!1;var f=t.getSpanParent(p.startContainer),g=t.getSpanParent(p.endContainer);if(!f||!g){if(p.startContainer!=m.paneContent&&p.endContainer!=m.paneContent){try{t.PAssert(1307,!1,"There should always be something to paste into")}catch(v){t.reportError(v)}return}var y=m.addItemToPane("",0);f=g=y.getSpan(),t.selectChildren(y,0,0)}if(d&&d.getData){o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Paste,data:[{value:!0}]}),s(c);var b;if(/text\/html/.test(d.types)){if(u=d.getData("text/html"),!u)return;var S,T=document.createElement("div"),w=u.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/\s+/g," ").replace(/onload/gi,"never"),E=/<body(.|\s)*?\/body>/g;(S=E.exec(w))&&(w=S[0]),T.innerHTML=w,b=a.traverseDOM({root:T,shouldPrint:!1,stripParents:!0}),1===b.items.length&&""===b.items[0].text&&(b=b.items[0])}else if(/text\/plain/.test(d.types)||r.ie){u=d.getData(l).trim();var M,x=u.startsWith("<?xml "),C=u.startsWith("<?opml ");if((x||C)&&(M=t.loadXML(u)),M){if(x)return t.messageQueue.pushMessage({text:"We currently do not support pasting generic XML documents, try convering to OPML. If you need to import XML send us a message and we will work through your scenario with you.",type:MessageType.Error}),!1;if(C)return a.parseOPML(M,"OPML Import"),!1}else{if(u.startsWith("{")&&u.endsWith("}"))try{var I=JSON.parse(u),A=e.dataFor(f.parentElement),P=a.parseJSON(I,A);if(P)return!1}catch(D){}var w=u.replace(/[\t]/g," "),k=w.split("\n");b={items:[]};for(var O=0;O<k.length;O++)0!==k[O].length&&b.items.push({text:t.trimString(k[O]),parent:b})}}if(!b||0===b.items.length)return!1;try{t.PAssert(1308,void 0!==f&&void 0!==g,"Must have a valid selection to perform paste")}catch(v){t.reportError(v)}o.beginAction();var L,R,_=e.dataFor(f.parentElement),N=e.dataFor(g.parentElement),F=t.getSelectOffsetsInSpan(_,f,p),V=t.getSelectOffsetsInSpan(N,g,p),B=_.parent(),U=_.getIndex(),q=_.getParsedText(),W=N.getParsedText();_!=N&&n.handleMultiselect({},f,g,p);var H=_;if(b&&1===b.items.length&&!b.items[0].items){var K=b.items[0].text.trim(),j=q.substring(0,F.startText)+K+W.substring(V.endText);L=_.getSpan(),o.performAction(TrackerType.Remove,{itemID:_.id,position:0,text:_.getParsedText()}),_.setText(j,!0),o.performAction(TrackerType.Insert,{itemID:_.id,position:0,text:j}),R=F.start+K.length,t.selectChildren(_,R,0)}else{for(var G=(B.items(),[]),O=0;b&&O<b.items.length;++O){var z=b.items[O];if(z.text=z.text.trim(),""!==z.text||z.items)if(0===O){if(z.text[0]==q&&(z.text=z.text.substr(1)),z.text=q.substring(0,F.startText)+z.text,_.setText(z.text,!0),o.performAction(TrackerType.Insert,{itemID:_.id,position:0,text:z.text}),U++,z.items){for(var Y=0;Y<z.items.length;Y++){var X=z.items[Y];(""!==X.text||X.items)&&_.insertItem(new i(X,{parent:_,parse:!0,forceSave:!0}))}-1==G.indexOf(_)&&G.push(_)}}else{var J=new i(z,{parent:B,parse:!0,forceSave:!0});B.insertItem(J,U++,!0),-1==G.indexOf(B)&&G.push(B),o.performAction(TrackerType.Create,{itemID:J.id,parent:B.id,position:U-1,text:J.getParsedText()})}}for(O=0;O<G.length;O++)G[O].items.valueHasMutated();for(H=B.getChild(U-1);H.hasChildren();)H=H.getLastChild();R=H.getParsedText().length,H.setRawText(H.getParsedText()+W.substring(V.endText)),t.vmMain.runParseWorker(B,function(){setTimeout(function(){t.selectChildren(H,R,0)},0)})}}return o.endAction(),t.scrollIntoView(H.getSpan(),200),!1}}}function d(e){var t=!l(e);return t?(n.keydown(void 0,{normCode:KeyCode.BackSpace}),s(e),!1):!0}function l(n){var i=n&&n.clipboardData?n.clipboardData:window.clipboardData;if(i){n.srcElement||(n.srcElement=n.target);var a=t.getSelectionInfo();if(!a)return!0;var c=a.selection.getRangeAt(0).startContainer;if("#text"==c.nodeName&&(c=c.parentNode),"exportedArea"===n.srcElement.id||"exportedContent"===n.srcElement.id){var d=r.ie?"Text":"text/plain";i.setData(d,n.srcElement.textContent)}else{var l=t.elementInPane(c);if(!l||"searchDiv"===a.node.id||t.hasClass(a.node,"search"))return!0;t.restrictSelectionToText(),a=t.getSelectionInfo();var u=a.selection.getRangeAt(0);try{t.PAssert(1309,"#text"==u.startContainer.nodeName,"Expected #text, Actual: "+u.startContainer.tagName)}catch(h){t.reportError(h)}var p=t.getSpanParent(u.startContainer);try{t.PAssert(1310,"#text"==u.endContainer.nodeName||"SPAN"==u.endContainer.nodeName,"Expected #text or SPAN, Actual: "+u.endContainer.tagName)}catch(h){t.reportError(h)}var m=t.getSpanParent(u.endContainer),f=p.parentElement;try{t.PAssert(1311,"LI"==f.tagName,"Expected LI, Actual: ",f)}catch(h){t.reportError(h)}var g=m.parentElement;try{t.PAssert(1312,"LI"==g.tagName,"Expected LI, Actual: ",g)}catch(h){t.reportError(h)}var v=e.dataFor(f),y=e.dataFor(g),b=t.getSelectOffsetsInSpan(v,p,u);try{t.PAssert(1313,v)}catch(h){t.reportError(h)}var S,T,w=!r.ie,E=v.getParsedText().substring(b.startText);if(f==g)E=b.start==b.end?v.getParsedText():v.getParsedText().substr(b.startText,b.endText-b.startText),w&&(S=E),T=E;else{var M=0;M++,w&&(S="<ul><li>"+E+"</li>"),T=E;do{var x={numLevels:0};for(v=t.getNextItem(v,t.focusedPane,x),x.numLevels>0&&(w&&(S+="<ul>"),M++);x.numLevels<0&&M>=0;)w&&(S+="</ul>"),M--,x.numLevels++;if(0>=M&&(w&&(S+="<ul>"),M++),v!==y)E=v.getParsedText(),w&&(S+="<li>"+E+"</li>");else{var C=t.getSelectOffsetsInSpan(v,v.getSpan(),u);E=v.getParsedText().substring(0,C.endText),w&&(S+="<li>"+E+"</li></ul>"),M--}T+="\r\n"+E}while(v!==y);for(;M>0;)w&&(S+="</ul>"),M--}w&&S&&i.setData("text/html",S);var d=r.ie?"Text":"text/plain";i.setData(d,T)}}return s(n),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Copy,data:[{value:!0}]}),!1}var u={};return u.init=function(){try{t.PAssert(1304,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(e){t.reportError(e)}document.body.addEventListener("paste",c,!1),document.body.addEventListener("cut",d,!1),document.body.addEventListener("copy",l,!1)},u}),define("VMSearch",["ko","globals","platform","data","VMLI","tracker"],function(e,t,r,n,i,o){function a(t,r){this.elSearch=void 0,this.search=e.observable(r||""),this.isFocused=e.observable(!1),this.placeholderActive=e.observable(!0),this.searchLoaded=!1,this.pane=t,this.searchArr=[],this.matches={},this.hiddenItems={},this.numMatches=e.observable(0),this.previousSearch="",this.titles=e.observableArray(),this.initialized=!1,this.isPaneTimeline=t.mode()==PaneMode.Timeline,this.isSearchBoxSmall=e.observable(),this.onUpdated=e.observable()}return a.prototype={getSearchBox:function(){return this.elSearch},init:function(){try{t.PAssert(1314,!this.initialized)}catch(e){t.reportError(e)}if(!this.initialized){if(this.pane.showArchived.subscribe(function(){this.updateSearch()}.bind(this)),this.pane.mode.subscribe(function(){this.isPaneTimeline=this.pane.isTimeline()}.bind(this)),window.addEventListener("itemAdded",function(e){if(e.data.force||t.focusedPane.id!==this.pane.id){var r=this.checkItem(e.data.item);r===!0&&this.updateNumMatches(e.data.item,!0)}else t.focusedPane.id===this.pane.id&&this.updateNumMatches(e.data.item,!0)}.bind(this),!0),window.addEventListener("itemTextChanged",function(e){if(e.data.force||t.focusedPane.id!==this.pane.id){var r=e.data.item,n=this.matches[r.id],i=this.checkItem(r);(i===!0&&n!==!0||i!==!0&&n===!0)&&this.updateNumMatches(r,i===!0),this.checkChildren(r,!1,!0)}}.bind(this),!0),r.mobile||window.addEventListener("windowResize",this.checkSearchBoxSize.bind(this)),this.search())this.updateSearch();else{var n=0,i=this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({item:this.pane.item(),includeArchived:i,each:function(e){var t=this.amountIncrementNumMatches(e,!0);t&&(n+=t)}.bind(this)}),this.setNumMatches(n)}this.initialized=!0}},onLoad:function(e){this.elSearch=e,this.elSearchWrap=e.parentNode,this.elAutocomplete=t.getElementByClassName("searchAutocomplete",this.elSearchWrap),this.elSearch.addEventListener("focus",this.onfocus.bind(this),!1),this.elSearch.addEventListener("blur",this.onblur.bind(this),!1),this.search()?setTimeout(function(){this.setDisplayText(this.search()),this.searchLoaded=!0}.bind(this),0):setTimeout(function(){this.searchLoaded=!0}.bind(this),0)},checkSearchBoxSize:function(){try{t.PAssert(1315,!r.mobile,"Only update search box size on non-mobile platforms")}catch(e){t.reportError(e)}if(this.isFocused()){var n=this.elAutocomplete.getBoundingClientRect(),i=this.elSearchWrap.getBoundingClientRect(),o=this.pane.scrollElement.getBoundingClientRect();o.right-i.left-10<n.width?(this.elAutocomplete.style.right=0,this.elAutocomplete.style.left="auto"):i.left<40?(this.elAutocomplete.style.left=0,this.elAutocomplete.style.right="auto"):(this.elAutocomplete.style.left="auto",this.elAutocomplete.style.right="auto")}},onfocus:function(){this.isFocused(!0),t.vmMain.setFocusedPane(this.pane),r.phone?t.sendEvent("SearchFocus","Mobile"):(this.clearPlaceholder(),this.checkSearchBoxSize(),t.sendEvent("SearchFocus","Desktop"))},onblur:function(){this.isFocused(!1),t.fireCustomEvent("closeKeyboard"),""===this.getDisplayText()?this.setDisplayText(TextSpace):this.getDisplayText()===TextSpace&&this.setDisplayToPlaceholder(),t.clearSavedSelection("StoredSearch")},focusBox:function(){t.vmMain.setFocusedPane(this.pane),t.keyboardToolbar&&t.keyboardToolbar.preShow(),this.getSearchBox().focus(),t.enforceScroll(),t.keyboardToolbar&&t.keyboardToolbar.show()},blurBox:function(){this.getSearchBox().blur()},focusAndSelectEnd:function(){this.focusBox(),t.selectElement(this.elSearch,!0)},resetSearch:function(){this.search(""),this.setDisplayText(TextSpace);for(var e in this.matches)this.updateMatchState(n.getModel(e),void 0,void 0);this.matches[this.pane.item().id]=!1,this.updateSearch()},setSearch:function(e){this.setDisplayText(e||TextSpace),this.search(e),this.updateSearch()},addToSearch:function(e){if(e){var t=this.search()+" "+e;this.setDisplayText(t||TextSpace),this.search(t),this.updateSearch()}},isSearching:function(){return this.search().length>0},isShowing:function(){return this.isFocused()||this.isSearching()},isMatched:function(e){return(void 0===this.matches[e.id]||!!this.matches[e.id])&&-1!==this.matches[e.id]},isVisible:function(e){return!this.hiddenItems[e.id]},hideItem:function(e,r){if(r){var n=e.getOutlineElement(this.pane.id);n&&t.addClass(n,"hidden")}else{var i=e.getElement(this.pane.id);i&&(t.addClass(i,"hidden"),this.hiddenItems[e.id]=!0)}},showItem:function(e,r){if(r){var n=e.getOutlineElement(this.pane.id);n&&t.removeClass(n,"hidden")}else{var i=e.getElement(this.pane.id);i&&(this.hiddenItems[e.id]=!1,t.removeClass(i,"hidden"))}},updateMatchState:function(e,r){var n=!1;if(e!=this.pane.item.peek()&&e!=t.vmMain.root.peek()){if(e){var i=this.matches[e.id];this.matches[e.id]=r,i===r||void 0===i&&r===!0||(n=!0,this.isPaneTimeline&&this.pane.notifySearchStateChanged(e,r))}return n}},amountIncrementNumMatches:function(e,r){return e==this.pane.item.peek()||e==t.vmMain.root.peek()?0:r?1:-1},updateNumMatches:function(e,r){var n=this.amountIncrementNumMatches(e,r);n&&this.setNumMatches(this.numMatches()+n);try{t.PAssert(1316,this.numMatches()>=0)}catch(i){t.reportError(i)}},setNumMatches:function(e){var t=this.numMatches();t!==e&&(this.numMatches(e),this.pane.paneContent&&!!t!=!!e&&this.pane.setNoItems(!!e))},isMatch:function(e,t,r){var n=!0;return r.indexOf("!")>=0&&(n=e.priority()>=VMLIFlag.P2,r.indexOf("!!")>=0&&(n=e.priority()>=VMLIFlag.P1,r.indexOf("!!!")>=0&&(n=e.priority()>=VMLIFlag.P0)),r=r.replace(/!/g,"")),r.indexOf("''")>=0&&n&&(n=e.isFlagged()&&!e.isComplete(),r=r.replace(/\'/g,"")),r.indexOf("//")>=0&&n&&(n=e.isComplete(),r=r.replace(/\//g,"")),r.length>0&&n&&(n=t.indexOf(r)>=0),n},checkItem:function(e,r,i){for(var o,a=r?t.vmMain.root.peek():this.pane.item.peek(),s=!0,c=e.getSearchText(),d=0;d<this.searchArr.length;d++){var l=this.searchArr[d],u=l.isNegated;if(u){var h=l.text;try{t.PAssert(1317,h,"Each value in the search array should be valid at this point")}catch(p){t.reportError(p)}var m=this.isMatch(e,c,h);if(m){s=-1;break}}}if(s===!0)for(var d=0;d<this.searchArr.length;d++){var l=this.searchArr[d],u=l.isNegated,h=l.text;try{t.PAssert(1318,h,"Each value in the search array should be valid at this point")}catch(p){t.reportError(p)}if(!u){var m=this.isMatch(e,c,h);if(!m)for(o=e;o;){if(o=o.parent(),!o||o==n.getRootModel()){s=!1;break}if(this.isMatch(o,o.getSearchText(),h))break}}if(s!==!0)break}if(s===!0&&e.isLoaded){var f=e,g=this.matches[e.id];for(this.updateMatchState(e,!0,r);f;){if(-1===this.matches[f.id]){this.matches[e.id]=!1;break}if(f.isLoaded&&this.showItem(f,r),f==a)break;if(f=f.parent()){if(this.matches[f.id]===!0)break;g=this.matches[f.id]}}i&&!r&&this.search()&&this.updateNumMatches(e,!0)}else if(e.isLoaded){{this.updateMatchState(e,s,r)}this.hideItem(e,r)}return this.matches[e.id]},checkChildren:function(e,r,n){var i=this.numMatches();r&&(i=0);var o=this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({item:e,includeArchived:o,each:function(e){var t=this.matches[e.id],o=this.checkItem(e);if(r&&o===!0||n&&(o===!0&&t!==!0||o!==!0&&t===!0)){var a=this.amountIncrementNumMatches(e,o===!0);a&&(i+=a)}}.bind(this)}),this.setNumMatches(i)},checkChildrenOutline:function(){this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({headers:!0,each:function(e){this.checkItem(e,!0)}.bind(this)})},updateSearch:function(e){if(e===!0||this.search()!=this.previousSearch){this.searchLoaded&&t.vmMain.updatePaneState(this.pane);var n=this.search().toLowerCase().trim().split(/\s+/);n=n.filter(function(e){return!(!e||"-"===e)}),this.searchArr=[];for(var i=0;i<n.length;++i){var o=n[i].startsWith("-"),a=o?n[i].substr(1):n[i];this.searchArr.push({text:a,isNegated:o})}this.search()?(this.pane.isSearching=!0,r.mobile&&this.clearPlaceholder()):(this.pane.isSearching=!1,r.mobile&&this.setDisplayToPlaceholder()),this.previousSearch=this.search(),this.matches[this.pane.item().id]=!1,this.initialized&&(this.checkChildren(this.pane.item(),!0),this.checkChildrenOutline()),this.onUpdated.valueHasMutated()}},keydown:function(e,r){if(r.normCode===KeyCode.Enter)return!1;if(r.normCode===KeyCode.BackSpace){var n=this.getDisplayText();if(""===n||n===TextSpace)return!1;if(r.metaKey)this.setDisplayText(TextSpace);else{var i=t.getSelectionRange();0===i.startOffset&&i.endOffset===n.length&&this.setDisplayText(TextSpace)
}}return!0},keyup:function(e,n){var i=this.getDisplayText();if(r.mobile||""!==i||this.setDisplayText(TextSpace),n.normCode===KeyCode.Escape)t.selectElement(this.elSearch,!1);else{var a=i.replace(TextSpace,"").replace("\n","");this.search(a),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:[{pane:this.pane.id,text:a}]});var s=n.normCode===KeyCode.Enter;if(this.updateSearch(s),r.mobile||this.checkSearchBoxSize(),n.normCode===KeyCode.Enter)if(r.android&&t.keyboardToolbar)t.clearSavedSelection("StoredSearch"),t.clearSelection();else if(!t.restoreSavedSelection("StoredSearch",t.focusedPane)){var c=t.focusedItem.getFirstChild();c&&(t.selectChildren(c,0,0),t.scrollIntoView(c.getSpan(),0))}}return!0},insert:function(e,r){var n=t.getSelectionRange(),i=n.startOffset;1===i&&this.getDisplayText()===TextSpace&&i--;try{t.PAssert(1319,this.search().indexOf(TextSpace)<0,"TextSpace should never be in the search string")}catch(a){t.reportError(a)}var s=this.search().replace(TextSpace,"");if(r&&s.length>0){var c=s[i-1];" "!==c&"-"!==c&&(e=" "+e)}var d=e.length,l=s.substr(0,n.startOffset)+e+s.substr(n.endOffset);this.search(l),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:[{pane:this.pane.id,text:l}]}),this.setDisplayText(l),this.updateSearch(),t.setSelection(this.elSearch,i+d,i+d)},onTapAutocomplete:{onStart:function(e){e.preventDefault()}},onTapSearchInsert:{onStart:function(e){e.preventDefault()},onClick:function(e){var r=e.srcElement.className;switch(0!==r.indexOf("search")&&(r=e.srcElement.parentNode.className),r){case"searchNegate":var n=t.getSelectionRange();if(n.startOffset!==n.endOffset){var i=n.startOffset,o=n.endOffset;this.getDisplayText[0]===TextSpace&&(i>0&&i--,o--);var a=this.search();if("-"!==a[i]){var s=a.substring(0,i)+"-"+a.substring(i);this.setSearch(s),t.setSelection(this.elSearch,i,o+1)}else{var s=a.substring(0,i)+a.substring(i+1);this.setSearch(s),t.setSelection(this.elSearch,i,Math.max(0,o-1))}}else this.insert("-",!0);break;case"searchP2":this.insert("!",!0);break;case"searchP1":this.insert("!!",!0);break;case"searchP0":this.insert("!!!",!0);break;case"searchFlagged":this.insert("''",!0);break;case"searchComplete":this.insert("//",!0)}t.sendEvent("Menu",r)}},requestFocusBoxForEvent:function(e){var t=document.activeElement;t&&"searchPhone"==t.id||(this.open(),e.preventDefault())},onTapBox:{onClick:function(e){r.mobile?(t.phoneMenu.activeScreen()!==Screens.Settings&&t.phoneMenu.mode()==t.phoneMenu.Modes.Normal&&this.open()&&e.stopImmediatePropagation(),e.preventDefault()):this.requestFocusBoxForEvent(e)}},onTapX:{onStart:function(e){e.handled=!0,e.preventDefault()},onClick:function(e){this.isSearchActive()?(this.resetSearch(),e.preventDefault(),t.sendEvent("Menu","ClearSearch")):(this.requestFocusBoxForEvent(e),t.sendEvent("Menu","FocusSearch"))}},isSearchActive:function(){return 0!==this.search().length},getTitleText:function(){return this.isSearchActive()?"Clear Search":"Search"},getSearchIcon:function(){return this.isSearchActive()?"icon-remove":"icon-search"},open:function(){return this.isFocused()?void 0:(r.mobile?this.focusAndSelectEnd():this.focusBox(),!0)},getDisplayText:function(){return this.elSearch.textContent},setDisplayText:function(e){try{t.PAssert(1320,void 0!==e&&""!==e||r.mobile,"Search text should always be defined, either with a TextSpace or actual text")}catch(n){t.reportError(n)}this.elSearch.textContent=e,this.placeholderActive(e===TextSpace&&r.mobile?!0:!1)},setDisplayToPlaceholder:function(){this.placeholderActive(!0),this.elSearch.textContent=TextSpace},clearPlaceholder:function(){this.placeholderActive(!1)}},a}),define("VMTitle",["ko","globals","data","tracker","platform"],function(e,t){function r(t){this.text=t.text,this.item=t.item,this.home=t.home,this.isTruncated=e.observable(!1),this.pane=t.pane,this.init(t)}return r.prototype={init:function(){this.text=this.item.getParsedText(),this.text.length>25&&(this.text=this.text.substr(0,25),this.isTruncated(!0))},onTap:{onStart:function(e){e.handled=!0,t.vmMain.setFocusedPane(this.pane)},onClick:function(e){t.focusedPane.onTapTitle.onClick.call(t.focusedPane,e,this.item)}}},r}),define("VMTimelineBlock",["ko","globals","data","VMLI"],function(e,t){function r(t){this.owner=t.owner,this.date=t.date,this.dateKey=t.dateKey,this.text=t.text,this.name=t.name,this.searchProvider=void 0,this.items=e.observableArray(),this.searchCount=e.observable(0),this.hasDeferredUpdate=!1,this.element=void 0,this.timeCount=e.observable(0),this.isFlagged=t.isFlagged,this.isImportant=t.isImportant,this.isToday=!1,this.init(t)}return r.prototype={showBlock:function(){return this.items().length>0&&this.searchCount()>0},specialClass:function(){return this.isFlagged?"flaggedBlock":this.isImportant?"importantBlock":this.isToday||this.isNow?"todayBlock":void 0},showTime:function(e){var t=e.$data,r=e.$index;if(this.isNow)return!1;this.searchProvider.onUpdated();if(0===this.timeCount()||this.isFlagged||this.isImportant||!this.searchProvider.isVisible(t))return!1;for(var n=r()-1;n>0&&!this.searchProvider.isVisible(this.items()[n]);)n--;if(0>n)return!0;var i=this.items()[n];if(t.hasTime()){if(0===this.compareDate(i,t))return!1}else if(!i.hasTime())return!1;return!0},processDeferredUpdates:function(){this.hasDeferredUpdate&&(this.hasDeferredUpdate=!1)},init:function(e){try{t.PAssert(1321,this.date)}catch(r){t.reportError(r)}if(this.dateKey||(this.dateKey=this.date.clone().clearTime().getTime(),e.name&&(this.dateKey=this.dateKey+e.name)),this.name)this.text=this.name.toUpperCase(),"NOW"==this.name&&(this.isNow=!0);else{if(this.text="",this.date){var n=Math.floor((this.date-Date.today())/864e5);switch(n){case-1:this.text="YESTERDAY ";break;case 0:this.text="TODAY ",this.isToday=!0;break;case 1:this.text="TOMORROW ";break;default:this.text=this.date.toString("dddd").toUpperCase()}}this.text=this.text+" "+this.date.toString("M/d")}},comparePriority:function(e,t){var r=e.priority(),n=t.priority();return r>n?-1:n>r?1:0},compareDate:function(e,t){if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(e.date()&&!t.date())return-1;if(!e.date()&&t.date())return 1;var r=new Date(e.date()),n=r.toString("h:mmtt"),i=new Date(t.date()),o=i.toString("h:mmtt");return"12:00am"!=n&&"12:00am"!=o?isNaN(r.getYear())||isNaN(i.getYear())?0:Date.compare(r,i):"12:00am"!=n?-1:"12:00am"!=o?1:0},compareOrder:function(e,r){var n=t.getFirstItem(e,r);try{t.PAssert(1322,void 0!==n)}catch(i){t.reportError(i)}return n.id==e.id?-1:1},compareItems:function(e,r){var n=this.isFlagged||this.isImportant?0:this.compareDate(e,r);if(0===n){var i=this.isFlagged?0:this.comparePriority(e,r);if(0===i){var o=this.compareOrder(e,r);try{t.PAssert(1323,0!==o,"This should always result in a tie break")}catch(a){t.reportError(a)}return o}return i}return n},addItem:function(e){return this.items.indexOf(e)>=0?void this.updateItem(e):(this.searchProvider.isMatched(e)&&(this.searchCount(this.searchCount()+1),e.hasTime()&&this.timeCount(this.timeCount()+1)),void(this.owner.deferModelUpdates?(this.items().insertSorted(e,this.compareItems.bind(this)),this.hasDeferredUpdate=!0):this.items.insertSorted(e,this.compareItems.bind(this))))},removeItem:function(e){this.searchProvider.isMatched(e)&&(this.searchCount(this.searchCount()-1),e.hasTime()&&this.timeCount(this.timeCount()-1)),this.owner.deferModelUpdates?(this.items().remove(e),this.hasDeferredUpdate=!0):this.items.remove(e)},updateItem:function(e){this.owner.deferModelUpdates?(this.items().remove(e),this.items().insertSorted(e,this.compareItems.bind(this)),this.hasDeferredUpdate=!0):(this.items.remove(e),this.items.insertSorted(e,this.compareItems.bind(this)));for(var t=0,r=0;r<this.items().length;r++)this.items()[r].hasTime()&&t++;this.timeCount(t)},onLoad:function(e){this.element=e},notifySearchStateChanged:function(e,r){try{t.PAssert(1324,void 0!==r||this.searchProvider,"Must supply a value or a valid search provider")}catch(n){t.reportError(n)}void 0===r&&(r=this.searchProvider.isMatched(e)),r===!0?(this.searchCount(this.searchCount()+1),e.hasTime()&&this.timeCount(this.timeCount()+1)):(this.searchCount(this.searchCount()-1),e.hasTime()&&this.timeCount(this.timeCount()-1))},setSearchProvider:function(e){this.searchProvider=e}},r}),define("VMPane_Timeline",["ko","globals","data","VMTimelineBlock"],function(e,t,r,n){var i={initTimeline:function(){this.blocks=e.observableArray(),this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.updateNextTimeout=0,this.datesByItem={},this.flaggedItems={},this.priorityItems={},this.isLoading=!1,this.deferModelUpdates=0;var t=this;this.showArchived.subscribe(function(e){t.reloadTimeline()})},hasBlocks:function(){for(var e=0,t=0;t<this.blocks().length;t++)e+=this.blocks()[t].searchCount();return e>0},reasonEmpty:function(){return this.vmSearch&&this.vmSearch.search().length>0?"No search results":"Nothing on the agenda"},blockCompare:function(e,t){return e.isNow&&t.isToday?-1:e.isToday&&t.isNow?1:Date.compare(e.date,t.date)},removeDate:function(e){var t=this.datesByItem[e.id];t.removeItem(e),this.datesByItem[e.id]=void 0},addBlock:function(e){e.setSearchProvider(this.vmSearch),this.deferModelUpdates?this.blocks().insertSorted(e,this.blockCompare):this.blocks.insertSorted(e,this.blockCompare)},dumpBlocks:function(){log("Dump Timeline Blocks:");for(var e=0;e<this.blocks().length;++e){var t=this.blocks()[e];log("  Block: ",t.text),log("  Count: ",t.searchCount);for(var r=0;r<t.items().length;++r){var n=t.items()[r];log("    Item: ",n.getParsedText())}}},findNextBlock:function(){for(var e=new Date,t=0;t<this.blocks().length;t++){var r=this.blocks()[t];if(r.isToday||r.isFlagged||r.isImportant||r.date>e)return r}},hideDescendants:function(e){for(var t=0;t<e.items().length;t++){var r=e.items()[t];this.datesByItem[r.id]&&this.removeDate(r),this.flaggedItems[r.id]&&(this.blockStarred.removeItem(r),this.flaggedItems[r.id]=void 0),this.priorityItems[r.id]&&(this.blockImportant.removeItem(r),this.priorityItems[r.id]=void 0),r.items().length>0&&this.hideDescendants(r)}},notifyDescendants:function(e){for(var t=0;t<e.items().length;t++){var r=e.items()[t];this.notifyStateChanged(r),r.items().length>0&&this.notifyDescendants(r)}},notifyPositionChanged:function(e){this.mode()===PaneMode.Timeline&&(this.isLoading||(this.datesByItem[e.id]&&this.datesByItem[e.id].updateItem(e),this.flaggedItems[e.id]&&this.blockStarred.updateItem(e),this.priorityItems[e.id]&&this.blockImportant.updateItem(e)))},notifySearchStateChanged:function(e,t){this.mode()===PaneMode.Timeline&&(this.isLoading||(this.datesByItem[e.id]&&this.datesByItem[e.id].notifySearchStateChanged(e,t),this.flaggedItems[e.id]&&this.blockStarred.notifySearchStateChanged(e,t),this.priorityItems[e.id]&&this.blockImportant.notifySearchStateChanged(e,t)))},notifyStateChanged:function(e,n){if(this.mode()===PaneMode.Timeline&&!this.isLoading&&!e.hasCompletedAncestor()){var i=r.getItem(e.id);try{t.PAssert(1325,!i||!!i.isDeleted==!!e.isDeleted||t.isDemoMode(),"isDeleted should match loaded item and item info")}catch(o){t.reportError(o)}if(this.vmSearch.checkItem(e),i&&i.isDeleted){var a=this.datesByItem[e.id];a&&a.removeItem(e),e.isImportant()&&this.updateSpecialBlock(e,this.priorityItems,this.blockImportant,!1),e.isFlagged()&&this.updateSpecialBlock(e,this.flaggedItems,this.blockStarred,!1)}else{if(!n||t.isAtLeastOneFlagSet(n,PropChangeType.Date|PropChangeType.Complete|PropChangeType.Archive))if(e.date()||e.isComplete()){var s=e.date()?e.date():e.dateCompleted;this.dateUpdated(e,s)}else{var c=this.datesByItem[e.id];c&&this.removeDate(e)}t.isAtLeastOneFlagSet(n,PropChangeType.Complete|PropChangeType.Archive)&&(e.isComplete()||e.isArchived()?this.hideDescendants(e):this.notifyDescendants(e)),(!n||t.isAtLeastOneFlagSet(n,PropChangeType.Priority|PropChangeType.Complete|PropChangeType.Archive))&&this.updateSpecialBlock(e,this.priorityItems,this.blockImportant,e.isImportant()&&!e.isComplete()),(!n||t.isAtLeastOneFlagSet(n,PropChangeType.Flagged|PropChangeType.Complete|PropChangeType.Archive))&&this.updateSpecialBlock(e,this.flaggedItems,this.blockStarred,e.isFlagged()&&!e.isComplete())}}},updateSpecialBlock:function(e,t,r,n){!n||e.isDeleted||e.isArchived()&&!this.showArchived()?t[e.id]&&(r.removeItem(e),t[e.id]=void 0):t[e.id]?r.updateItem(e):(r.addItem(e),t[e.id]=e)},dateUpdated:function(e,r,i){if(this.mode()===PaneMode.Timeline&&!this.isLoading){if(e.isArchived()&&!this.showArchived())return void(this.datesByItem[e.id]&&this.removeDate(e));if(this.vmSearch.checkItem(e),r){var o,a=t.isDateSoft(e.dateText);o=a?e.dateText.toUpperCase():r.clone().clearTime().getTime();var s=this.days[o];if(!s&&!this.days[o]){var c={owner:this,date:r.clone().clearTime(),dateKey:o};a&&(c.name=o);var s=new n(c);this.days[o]=s,this.addBlock(s,i)}if(s){var d=this.datesByItem[e.id];d?d.dateKey!==o&&(this.removeDate(e),this.datesByItem[e.id]=s):this.datesByItem[e.id]=s,this.days[o].addItem(e)}}else this.datesByItem[e.id]&&this.removeDate(e)}},ensureSpecialBlocks:function(){this.blockStarred||(this.blockStarred=new n({owner:this,name:"Flagged",date:Date.today().add({hour:1}),isFlagged:!0}),this.addBlock(this.blockStarred)),this.blockImportant||(this.blockImportant=new n({owner:this,name:"Important",date:Date.today().add({hour:2}),isImportant:!0}),this.addBlock(this.blockImportant))},loadTimeline:function(){try{t.PAssert(1326,this.mode()==PaneMode.Timeline)}catch(e){t.reportError(e)}try{t.PAssert(1327,0===this.blocks().length,"When loading the timeline we expect it to be empty")}catch(e){t.reportError(e)}this.setDeferUpdates(!0),this.ensureSpecialBlocks(),t.searchVMLIs({item:this.item(),includeArchived:this.showArchived(),each:this.notifyStateChanged.bind(this)}),this.setDeferUpdates(!1),this.vmSearch.onUpdated.valueHasMutated()},unloadTimeline:function(){this.datesByItem={},this.flaggedItems={},this.priorityItems={},this.days={},this.deferModelUpdates?this.blocks().splice(0,this.blocks().length):this.blocks([]),this.blockStarred=void 0,this.blockImportant=void 0},reloadTimeline:function(){this.mode()===PaneMode.Timeline&&(this.reloading=!0,this.unloadTimeline(),this.loadTimeline(),this.reloading=!1)},setDeferUpdates:function(e){try{t.PAssert(1329,this.mode()==PaneMode.Timeline)}catch(r){t.reportError(r)}this.deferModelUpdates+=e?1:-1;try{t.PAssert(1330,this.deferModelUpdates>=0,"Mismatching defer update calls")}catch(r){t.reportError(r)}if(0===this.deferModelUpdates){for(var n=this.blocks().length,i=0;n>i;++i)this.blocks()[i].processDeferredUpdates();this.blocks.valueHasMutated()}},startLoading:function(){if(this.mode()===PaneMode.Timeline){try{t.PAssert(1331,!this.isLoading,"Should only notify the timeline a single time when loading starts")}catch(e){t.reportError(e)}this.isLoading=!0}},endLoading:function(){if(this.mode()===PaneMode.Timeline){try{t.PAssert(1332,this.isLoading,"Must have started loading the timeline to stop loading it")}catch(e){t.reportError(e)}this.isLoading=!1,this.setDeferUpdates(!0),this.reloadTimeline(),this.setDeferUpdates(!1)}}};return i}),define("VMOutline",["ko","globals","data","gdata","VMSearch","platform","tracker"],function(e,t,r,n,i,o,a){function s(r){this.pane=r,this.root=t.vmMain.root(),o.mobile||(this.isVisible=e.observable(!1)),this.init()}return s.prototype={init:function(){t.outline=this,o.mobile&&t.ScreenManager.addScreen(this,Screens.Outline)},getTopElement:function(){return document.getElementsByClassName("paneOutline")[0]},onTap:{onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onClick:function(r){if(!(o.mobile&&t.ScreenManager.checkSwipeClick(r)||!t.hasClass(r.srcElement,"outlineText")&&!t.hasClass(r.srcElement.parentElement,"outlineText"))){var n=e.dataFor(r.srcElement);o.mobile||t.vmMain.setFocusedPane(this.pane),t.vmMain.zoomin(n),o.mobile?t.ScreenManager.scrollToScreen(Screens.List):t.focusedPane.toggleOutlineVisibility(),r.preventDefault(),t.sendEvent("Menu","OutlineZoom")}},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},onTapCollapse:{onStart:function(e){if(t.hasClass(e.srcElement,"outlineArrow")){var r=e.srcElement.parentNode;t.hasClass(r,"collapsed")?(t.removeClass(r,"collapsed"),t.sendEvent("Menu","OutlineMinimize")):(t.addClass(r,"collapsed"),t.sendEvent("Menu","OutlineMaximize")),e.handled=!0,e.preventDefault()}}},onScreenStartOpen:function(){},onScreenOpen:function(){t.isKeyboardOpen&&!t.vmSearchPhone.isFocused()&&t.blurActiveElement(),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement()}})},onScreenUpdate:function(){},onScreenClose:function(){a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement()}})},toggleDesktop:function(){var e=t.width(this.pane.element),r=150;this.isVisible()?(t.setTransform(this.pane.outlineElement,1*-e,0,r,"ease-out"),t.setTransform(this.pane.paneContent,0,0,r,"ease-out"),setTimeout(function(){this.isVisible(!this.isVisible()),this.pane.outlineElement.style.visibility="hidden"}.bind(this),r)):(this.isVisible(!this.isVisible()),this.pane.outlineElement.style.visibility="visible",t.setTransform(this.pane.outlineElement,1*-e,0),requestAnimationFrame(function(){t.setTransform(this.pane.outlineElement,0,0,r,"ease-in-out"),t.setTransform(this.pane.paneContent,e,0,r,"ease-in-out")}.bind(this))),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement()}})}},t.VMOutline=s,s}),define("VMPane",["ko","globals","android","data","gdata","VMSearch","VMTitle","edit","VMLI","tracker","VMPane_Timeline","VMOutline","platform"],function(e,t,r,n,i,o,a,s,c,d,l,u,h){function p(r){this.id=r.id,this.item=e.observable(r.item),this.mode=e.observable(r.mode||PaneMode.Normal),this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.titleMenu=void 0,this.vmSearch=void 0,this.titles=e.observableArray(),this.showArchived=e.observable(!1),this.reloading=!1,this.width=-1,this.initialOffset=r.offset,this.defaultOffset=h.mobile?50:0,h.mobile?(t.vmSearchPhone=this.vmSearch=new o(this,r.search),this.outline=t.vmMain.outline=new u(this)):(this.vmSearch=new o(this,r.search),this.outline=new u(this)),this.initTimeline(),this.init(r)}return p.prototype={init:function(){this.vmSearch.init(),this.mode.subscribe(this.onModeChanged,this),h.mobile&&t.ScreenManager.addScreen(this,Screens.List),this.updateContents()},getScroller:function(){return h.bodyscroll?document.body:this.scrollElement},getScrollOffset:function(){var e=0;return h.bodyscroll?e=document.body.scrollTop:this.scrollElement&&(e=this.scrollElement.scrollTop),e},setScrollOffset:function(e){try{t.PAssert(1333,this.scrollElement,"Pane must have loaded a scrollable element")}catch(r){t.reportError(r)}void 0===e&&(e=this.defaultOffset),t.scrollTo(e,0,this.scrollElement)},setMode:function(e){this.mode(e),t.sendEvent("Menu","PaneModeSwitchTo",e),modeChanged=!0,t.vmMain.updatePaneState(this),this.vmSearch.updateSearch(!0)},getTopElement:function(){return this.element},trackDOM:function(){return!0},templateName:function(e){return e.mode()===PaneMode.Normal?"template-pane-normal":e.mode()===PaneMode.Timeline?"template-pane-timeline":void 0},itemHasChildren:function(){return this.item().items().length>0},isTimeline:function(){return this.mode()==PaneMode.Timeline},onModeChanged:function(e){e===PaneMode.Timeline?this.loadTimeline():this.unloadTimeline(),(h.ios||h.ie)&&this.setupFocusEvents()},setupFocusEvents:function(){if(h.phone&&(log("setting up focus"),h.ios)){try{t.PAssert(1334,!r.isEnabled(),"Android sets up its own focus/blur events in android.js")}catch(e){t.reportError(e)}try{t.PAssert(1335,!h.ie,"IE does not rely on focus/blur events to be fired")}catch(e){t.reportError(e)}this.paneContent.addEventListener("textInput",s.onTextInput,!1)}},onLoad:function(e){if(t.hasClass(e,"pane"))this.element=e,h.mobile&&(this.itemMenuPhone=t.element("itemMenuPhone"),this.rightMenuPhone=t.element("rightMenuPhone"));else{this.paneContent=e,this.rootElement=e.parentElement,this.scrollElement=this.rootElement.parentElement,this.outlineElement=this.scrollElement.previousElementSibling;try{t.PAssert(1337,t.hasClass(this.rootElement,"paneRoot"))}catch(n){t.reportError(n)}try{t.PAssert(1338,t.hasClass(this.paneContent,"paneContent"))}catch(n){t.reportError(n)}!h.android&&!h.mobileie||h.script||r.setPaneRoot(this),window.addEventListener("windowResize",function(){this.width=t.width(this.element)}.bind(this)),setTimeout(function(){if(this.width=t.width(this.element),(h.ios||h.ie)&&this.setupFocusEvents(),this.mode()===PaneMode.Normal&&isNaN(this.initialOffset))this.initialOffset=this.defaultOffset;else if(this.mode()===PaneMode.Timeline){var e=this.findNextBlock();this.initialOffset=e&&e.element?h.mobile?e.element.getBoundingClientRect().top:e.element.getBoundingClientRect().top-this.scrollElement.getBoundingClientRect().top-25:0}0!==this.initialOffset&&this.setScrollOffset(this.initialOffset)}.bind(this),0),h.ios&&(this.scrollElement.onscroll=function(e){return Math.abs(this.scrollElement.scrollTop-t.scrollAtTouchStart)>100&&(t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.startDrag=void 0),0===this.scrollElement.scrollTop?(e.preventDefault(),e.stopImmediatePropagation(),!1):!0}.bind(this)),this.setNoItems(!!this.vmSearch.numMatches())}},setNoItems:function(e){e?t.removeClass(this.paneContent,"noItems"):t.addClass(this.paneContent,"noItems")},getWidth:function(){return this.width},toggleOutlineVisibility:function(){try{t.PAssert(1339,this.outline,"Outline must exist")}catch(e){t.reportError(e)}try{t.PAssert(1340,this.outlineElement,"Outline element must be valid")}catch(e){t.reportError(e)}this.outline.toggleDesktop()},updateContents:function(){this.mode()==PaneMode.Normal||this.mode()===PaneMode.Timeline&&this.reloadTimeline(),this.updateTitles()},notifyOfZoom:function(){this.updateContents(),this.vmSearch.updateSearch(!0)},updateTitles:function(){var e=this.item().parents();this.titles.removeAll();for(var t=0;t<e.length;t++){var r=new a({item:e[t],pane:this});this.titles.push(r)}},keydown:function(e,n){if(r.isEnabled()&&!r.passKeydown(n))return!0;if(t.autocomplete&&!t.autocomplete.onkeydown(n))return!1;try{return s.keydown(e,n)}catch(i){t.reportError(i,n)}},keypress:function(e,n){if(r.isEnabled()&&!r.passKeypress(n))return!0;try{return s.keypress(e,n)}catch(i){t.reportError(i,n)}},keyup:function(e,n){if(r.isEnabled())return r.checkAndroidBounds(),!0;try{return s.keyup(e,n)}catch(i){t.reportError(i,n)}},addItemToPane:function(e,t){var r=this.item();e||(e=""),d.beginAction();var n=new c({text:e},{parent:r,forceSave:!0});return r.insertItem(n,t),d.performAction(TrackerType.Create,{itemID:n.id,parent:r.id,position:isNaN(t)?r.items().length-1:t,text:e}),d.endAction(),n},onTapTitle:{onClick:function(e,r){var n=t.focusedItem;return h.ios||r==this.item()&&this.vmSearch.resetSearch(),this.titles().length<=1?void(this.outline.isVisible()&&this.toggleOutlineVisibility()):(t.vmMain.zoomout(r,n),void t.sendEvent("Menu","Title"))}},onTap:{onStart:function(n){if(!h.mobile||!t.ScreenManager.checkSwipeStart(n)){if(h.phone,t.menus&&t.phoneMenu&&(t.menus.startedInMultiSelectMode=t.phoneMenu.multiSelectMode()),t.vmMain.setFocusedPane(this),h.isTouchDevice&&!h.app&&!h.ie&&!h.bodyscroll){var i=this.scrollElement;if(!t.preventScrollPropagation(i))return n.preventDefault(),!1}if(!r.isEnabled()||!r.isTargetBox(n)){var o=e.dataFor(n.srcElement);h.mobile&&o===this&&(o=t.getLastVisibleItem(t.focusedPane.item())),o&&o.onStart&&o.onStart(n)}}},onMove:function(n){t.autocomplete&&h.mobile&&t.autocomplete.hide(),t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0);var i=!0;if(h.mobile&&(t.menus.startedInMultiSelectMode||(i=!t.ScreenManager.checkSwipeMove(n))),i&&(!r.isEnabled()||!r.isTargetBox(n))){var o=e.dataFor(n.startSrc);h.mobile&&o===this&&(o=t.getLastVisibleItem(t.focusedPane.item())),o&&o.onMove&&o.onMove(n)}return!1},onClick:function(n){if(!(h.mobile&&t.ScreenManager.checkSwipeClick(n)||r.isEnabled()&&r.isTargetBox(n))){var i=e.dataFor(n.startSrc);h.mobile&&i===this&&(i=t.getLastVisibleItem(t.focusedPane.item())),i&&i.onClick?i.onClick(n):t.hasClass(this.paneContent,"noItems")?this.addItem(n):n.preventDefault()}},onEnd:function(n){if(!(h.mobile&&t.ScreenManager.checkSwipeEnd(n)||r.isEnabled()&&r.isTargetBox(n))){var i=e.dataFor(n.startSrc);if(h.mobile&&i==this&&(i=t.getLastVisibleItem(t.focusedPane.item())),!i)return;"paneContent"===n.startSrc.id&&(n.preventDefault(),h.ios&&t.preventClick()),i&&i.onEnd&&i.onEnd(n)}},onDblClick:function(t){if(this.isTimeline()){var r=e.dataFor(t.startSrc);r&&r.onDblClick&&r.onDblClick(t)}},onRightClick:function(n){if(!t.isDisplayModeActive(DisplayMode.NoRightClick)){if(t.vmMain.setFocusedPaneFromElement(n.srcElement),!r.isEnabled()||!r.isTargetBox(n)){var i=e.dataFor(n.srcElement);i&&i.onRightClick&&i.onRightClick(n)}d.miscAction({type:TrackerType.Misc,misc:TrackerMisc.RightClick,data:{element:void 0}})}}},addItem:function(e){var r=this.addItemToPane("",0);t.selectChildren(r,0,0),t.sendEvent("Menu","AddItemButton"),h.mobile&&t.openKeyboardOn(e,r.getSpan(),!0)},onTapAddItem:{onStart:function(e){e.preventDefault(),e.stopImmediatePropagation()},onClick:function(e){this.addItem(e)}},onTapOutlineButton:function(){this.toggleOutlineVisibility(),this.outline.isVisible()?t.sendEvent("Menu","OpenOutline"):t.sendEvent("Menu","CloseOutline")},onTapSwitchList:function(){var e=this.setMode(PaneMode.Normal);d.performAction(TrackerType.UIAction,{type:TrackerUIAction.SwitchPaneMode,data:{from:e,to:PaneMode.Normal}}),t.sendEvent("Menu","SwitchPaneMode")},onTapSwitchTimeline:function(){var e=this.setMode(PaneMode.Timeline);d.performAction(TrackerType.UIAction,{type:TrackerUIAction.SwitchPaneMode,data:{from:e,to:PaneMode.Timeline}}),t.sendEvent("Menu","SwitchPaneMode")},onTapClosePane:function(){if(t.vmMain.panes().length>1){var e=t.vmMain.removePane(this);d.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:e}),t.sendEvent("Menu","ClosePane"),t.tooltip.hideTip()}},onTapArchiveCompleted:{onStart:t.handlerPreventStop,onClick:function(){this.archiveCompleted(),t.sendEvent("Menu","ArchiveCompleted")}},archiveCompleted:function(){var e=[];t.searchVMLIs({item:this.item(),includeArchived:!1,comparator:function(e){return e.isComplete()},action:function(t){e.push(t)}}),d.beginAction();for(var r=e.length-1;r>=0;r--){var n=e[r];n.parent().archiveChild(n)}if(d.endAction(),e.length>0){var i=e.length>1?" items.":" item.";t.messageQueue.pushMessage({text:"Successfully archived "+e.length+i,type:MessageType.Info,action:MessageAction.Default,timeout:2e3})}t.sendEvent("Menu","ArchiveCompleted")},onTapViewArchived:function(){if(this.mode()===PaneMode.Timeline)this.showArchived(!this.showArchived()),t.vmMain.updatePaneState(this),t.sendEvent("Menu","ShowArchivedTimeline");else if(this.mode()===PaneMode.Normal){var e=[];t.searchVMLIs({item:this.item(),includeArchived:!0,comparator:function(e){return e.isArchived()},action:function(t){e.push(t)}});for(var r=0;r<e.length;++r){var n=e[r];n.parent().unarchiveChild(n)}t.sendEvent("Menu","UnarchiveItems")}},onScreenOpen:function(){},onScreenClose:function(){}},t.extend(p.prototype,l),p}),define("VMMain_DragDrop",["ko","globals","platform","tracker","VMPane","VMLI"],function(e,t,r,n,i,o){var a=function(a){function s(){p&&(t.removeClass(p,"itemDraggingAbove"),t.removeClass(p,"itemDraggingBelow"))}function c(e){log(e.target.result)}function d(e){var t=e.dataTransfer.files[0],r=new FileReader;r.onload=c,r.readAsDataURL(t)}var l=void 0,u=void 0,h=void 0,p=void 0,m=void 0,f=!1;a.handleDragOver=function(n){if(u!==n.srcElement){n.srcElement&&(l=t.getPaneForElement(n.srcElement));var c=n.srcElement;if(!c||!l||"SPAN"!==c.tagName&&"P"!==c.tagName&&"LI"!==c.tagName&&"UL"!==c.tagName);else{s();var d=t.getPaneForElement(c);try{t.PAssert(1343,d,"Must have a valid pane to update our drag target on")}catch(g){t.reportError(g)}var v=e.dataFor(c);try{t.PAssert(1344,v,"Should always have a valid drop target")}catch(g){t.reportError(g)}var y=void 0,b=!1;v instanceof i?(b=!0,v=h?h:t.getLastPaneItem(v),highLightAbove=n.diffY<0?!0:!1):v instanceof o?d.isTimeline()||!v.isFullscreen()&&"LI"!==c.tagName?y=!0:h&&(v=h,y=n.diffY<0||f?!0:!1):v=a.getDropItem(n);try{t.PAssert(1345,v,"Should always have a valid drop target")}catch(g){t.reportError(g)}p=d.isTimeline()?void 0:v.getSpan(d.id),m=y?"itemDraggingAbove":"itemDraggingBelow",d.isTimeline()||t.addClass(p,m);try{t.PAssert(1346,!(v instanceof i),"Drop target shouldnt be a pane")}catch(g){t.reportError(g)}h=v,u=c,f=b}}if(l){var S=70,T=110,w=r.windowHeight()-40,E=r.windowHeight()+40;if(n.offsetY<T){var M=-(1-t.computeScrollSpeed(S,T,n.offsetY));t.repeatScroll(M,l)}else if(n.offsetY>w&&n.offsetY<E){var M=t.computeScrollSpeed(w,E,n.offsetY);t.repeatScroll(M,l)}else t.cancelRepeatScroll()}else t.cancelRepeatScroll();return!1},a.handleDropItem=function(e){if(t.cancelRepeatScroll(),e!==h){for(var r=h.parent();r;){if(r===e)return;r=r.parent()}if(t.getNextItem(e,t.focusedPane)===h&&"itemDraggingAbove"===m)return;var i=t.getPaneForElement(u);if(!i.isTimeline()){var o=e.parent(),a=e.getIndex(),s=void 0,c=-1;h.isFullscreen()?(s=h,c=s.numChildren()):(s=h.parent(),c="itemDraggingAbove"===m?h.getIndex():h.getIndex()+1),n.beginAction();try{t.PAssert(1347,s,"Trying to move without a target")}catch(d){t.reportError(d)}try{t.PAssert(1348,!isNaN(c),"Trying to move without a target index")}catch(d){t.reportError(d)}e.moveTo({parent:s,index:c}),n.performAction(TrackerType.Move,{itemID:e.id,oldParent:o.id,oldPosition:a,newParent:s.id,newPosition:c}),n.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DropItem,data:[{itemID:e.id}]}),n.endAction(),t.timeline.reloadTimelines()}}},a.getDropItem=function(e){try{t.PAssert(1351,e.dataTransfer.item,"We do not support HTML5 drag/drop")}catch(r){t.reportError(r)}return e.dataTransfer.item},a.handleDrop=function(t){if(t.stopPropagation(),u){s();var r=a.getDropItem(t);if(r)a.handleDropItem(r,t);else{var n=t.dataTransfer.getData("itemid");if(n){var i=e.dataFor(document.getElementById(n));a.handleDropItem(i,t)}else t.dataTransfer.files&&t.dataTransfer.files.length>0&&(d(t),t.stopPropagation(),t.preventDefault())}}}};return a}),define("VMDocument",["ko","globals","platform","data","goog","tracker"],function(e,t,r,n,i,o){function a(t){this.file=t,this.id=t&&t.id,this.title=e.observable(t&&t.title||""),this.shared=t&&t.shared,this.isOpen=void 0,this.isOwned=e.observable(!1),this.init()}return a.prototype={init:function(){this.file&&"me"===this.file.userPermission.id&&"owner"===this.file.userPermission.role&&this.isOwned(!0)},onTapMenu:function(){this.openSharing(),t.sendEvent("Menu","OpenSharing"),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocSharing,data:[{value:!0}]})},openSharing:function(e){t.menus.openModal("shareDoc",this,e)},closeMenu:function(){t.menus.closeContextMenu(t.element("contextMenuDocument"))},onTapContextMenu:function(e){var t=e.srcElement.id;switch(t||(t=e.srcElement.parentNode.id),t){case"documentDelete":break;case"documentShare":}this.closeMenu()}},a}),define("VMMenus",["ko","globals","data","gdata","VMSearch","VMTitle","edit","VMLI","tracker","platform","VMDocument"],function(e,t,r,n,i,o,a,s,c,d){function l(){this.linkAddress=e.observable(),this.linkTitle=e.observable("temporary title"),this.itemMenuPhoneWidth=-240,this.rightMenuWidth=50,this.phoneLastTop=0,this.itemMenuPhone=void 0,this.itemMenuBG=void 0,this.itemMenuPhoneMode=e.observable(0),this.rightMenuPhone=void 0,this.rightMenuPhoneBG=void 0,this.lastSwipeMove=0,this.lastSwipeMoveTime=0,this.canClosePane=e.observable(!1),this.showArchivedMenuOption=e.observable(!1),this.archivedMenuText=e.observable(""),this.itemIsHeader=e.observable(!1),this.itemHasChildren=e.observable(!1),this.itemIsCollapsed=e.observable(!1),this.itemIsArchived=e.observable(!1),this.itemCanIndent=e.observable(!1),this.itemCanUnindent=e.observable(!1),this.itemCanZoom=e.observable(!1),this.lastZIndex=37,this.contextMenuOpenedOn=e.observable(void 0),this.isModalVisible=e.observable(!1),this.isModalOpen=e.observable(!1),this.modalOpened=void 0,this.modalOpenedBound=void 0,this.modalsBound=!1,this.menusBound=!1,this.init()
}return l.prototype={init:function(){window.addEventListener("closeKeyboard",this.onCloseKeyboard.bind(this)),t.addCustomEventListener("keyEscape",this.onEscapeKey.bind(this),100),d.mobile||this.isModalOpen.subscribe(function(e){requestAnimationFrame(e?function(){requestAnimationFrame(function(){t.addClass(t.element("main"),"modalOpen"),t.addClass(t.element("desktopMenu"),"modalOpen"),t.addClass(t.element("desktopSidebar"),"modalOpen")})}:function(){t.removeClass(t.element("main"),"modalOpen"),t.removeClass(t.element("desktopMenu"),"modalOpen"),t.removeClass(t.element("desktopSidebar"),"modalOpen")})})},bind:function(){this.menusBound||(this.menusBound=!0,t.applyBindings(this,"contextMenus"),d.mobile&&(this.itemMenuPhone=t.element("itemMenuPhone"),this.rightMenuPhoneBG=t.element("rightMenuPhoneBG"),this.rightMenuPhone=t.element("rightMenuPhone"),this.rightMenuPhoneItems=t.element("rightMenuPhoneItems"),this.itemMenuBG=t.element("itemMenuBG"),t.applyBindings(this,"itemMenuPhone"),t.applyBindings(this,"rightMenuPhoneItems")))},onEscapeKey:function(){return this.isModalOpen()?this.closeModalInternal(!1):void 0},itemMenuPhoneClass:function(){var e=this.itemMenuPhoneMode();return 0===e?"complete completeDisabled":1==e?"complete":2==e?"notVisible":void 0},selectionHasChildren:function(){for(var e=0;e<t.vmMain.selected().length;e++)if(t.vmMain.selected()[e].hasChildren())return!0;return!1},selectionIsHeader:function(){return 1===t.vmMain.selected().length&&t.vmMain.selected()[0].isHeader()},openLinkMenu:function(e,r,n,i){this.linkAddress(r),t.menuOnItem=e;var o=document.getElementById("contextMenuLink");o.style.left=n+"px",o.style.top=i+"px",o.style.display="block",t.vmMain.handleFullscreenClick(function(){this.closeLinkMenu()}.bind(this))},closeLinkMenu:function(){t.menuOnItem=void 0,this.linkAddress("");var e=document.getElementById("contextMenuLink");e.style.display="none",t.vmMain.cancelFullscreenClick()},onTapLink:{onClick:function(){this.closeLinkMenu()}},closeAllMenus:function(){this.linkAddress("");var e=document.getElementById("contextMenuLink");e.style.display="none",t.menuOnItem=void 0},setupItemMenu:function(){t.element("menuGoto").style.display=t.focusedPane.isSearching?"block":"none"},onTapHover:{onStart:function(e){e.preventDefault()},onClick:function(e){var r=e.srcElement.id;t.sendEvent("Menu",r)}},multiSelect:function(e){e.isSelected(!e.isSelected()),e.isSelected()?t.vmMain.selected.push(e):t.vmMain.selected.splice(t.vmMain.selected.indexOf(e),1)},revealGestureMenu:function(e){try{t.PAssert(1352,t.revealingMenu===!1,"Must not have already started a gesture")}catch(r){t.reportError(r)}t.revealingMenu=!0,this.startedInMultiSelectMode=t.phoneMenu.multiSelectMode(),t.menuOnItem=e;var n=e.getSpan(),i=40,o=t.offset(n).top,a=o-t.phoneMainY,s=t.height(n)+8;a+=(s-i)/2;var c=a;this.phoneLastTop!==c&&(this.phoneLastTop=c),this.itemMenuPhone.style[d.transition.style]="",t.setTransformStyle(this.itemMenuPhone,0,this.phoneLastTop),this.startedInMultiSelectMode||t.setTransformStyle(this.rightMenuPhone,0,0),this.rightMenuThresh=this.rightMenuWidth/200*d.windowWidth.peek()},updateRevealGestureMenu:function(e){try{t.PAssert(1353,t.revealingMenu===!0,"Must have already started a gesture to perform an update")}catch(r){t.reportError(r)}var n=e.diffX;if(this.lastSwipeMove=e.xThisFrame,this.lastSwipeMoveTime=e.timeStamp,this.startedInMultiSelectMode){n-=this.rightMenuWidth;var i=t.clamp(n,-this.rightMenuWidth,0);t.setTransformStyle(this.rightMenuPhone,i,0)}else{var o=t.clamp(n,-this.rightMenuWidth,0);t.setTransformStyle(this.itemMenuPhone,d.windowWidth.peek()+o,this.phoneLastTop);var a=-this.rightMenuWidth-this.rightMenuThresh,s=t.clamp((-n-this.rightMenuWidth)/this.rightMenuThresh,0,1);this.itemMenuBG.style[d.transform.style]="scale3d(1,"+s+", 1)";var i=t.clamp(n+this.rightMenuWidth+this.rightMenuThresh,-this.rightMenuWidth,0);t.setTransformStyle(this.rightMenuPhone,i,0);var c=t.clamp((-n+a)/(.75*this.rightMenuWidth),0,1);this.itemMenuPhone.style.opacity=1-c,t.isKeyboardOpen||t.vmMain.setSelected([t.menuOnItem]),n<=-this.rightMenuWidth?1!==this.itemMenuPhoneMode.peek()&&this.itemMenuPhoneMode(1):0!==this.itemMenuPhoneMode.peek()&&this.itemMenuPhoneMode(0)}},stopRevealGestureMenu:function(e){try{t.PAssert(1354,t.revealingMenu===!0,"Must have already started a gesture")}catch(r){t.reportError(r)}var n=200,i=e.diffX;t.revealingMenu=!1;e.timeStamp-this.lastSwipeMoveTime;if(this.startedInMultiSelectMode){i-=this.rightMenuWidth;var o=t.clamp(i,-this.rightMenuWidth,0);o<=-this.rightMenuWidth/2?t.setTransform(this.rightMenuPhone,-this.rightMenuWidth,0,200,"ease-out"):(this.closeMultiSelect(),t.vmMain.clearSelected())}else i<=-this.rightMenuWidth-this.rightMenuThresh?(t.setTransform(this.rightMenuPhone,-this.rightMenuWidth,0,200,"ease-out"),t.phoneMenu.multiSelectMode(!0),t.blurActiveElement(!0),t.vmMain.setSelected([t.menuOnItem])):(i<=-this.rightMenuWidth&&t.menuOnItem.isComplete(!t.menuOnItem.isComplete()),t.setTransform(this.rightMenuPhone,0,0,200,"ease-out"),t.isKeyboardOpen||t.vmMain.clearSelected());this.closePhoneMenu(n)},closeMultiSelect:function(){t.setTransform(this.rightMenuPhone,0,0,200,"ease-out"),t.phoneMenu.multiSelectMode(!1),t.vmMain.clearSelected()},closePhoneMenu:function(){var e=200;t.setTransform(this.itemMenuPhone,d.windowWidth(),this.phoneLastTop,e,"ease-out"),t.menuOnItem=void 0},onResize:function(){t.menuOnItem||t.setTransform(this.itemMenuPhone,d.windowWidth(),this.phoneLastTop)},onTapMenuPhone:{onStart:t.handlerPreventStop,onClick:function(e){if(0!==t.vmMain.selected().length){var r,n,i=e.srcElement.id;switch(i){case"phoneMenuComplete":r="isComplete",n=!t.vmMain.getFirstSelectedItem().isComplete();break;case"phoneMenuFlag":r="isFlagged",n=!t.vmMain.getFirstSelectedItem().isFlagged();break;case"phoneMenuPriorityNone":r="priority",n=VMLIFlag.None;break;case"phoneMenuPriorityHigh":r="priority",n=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P0?VMLIFlag.None:VMLIFlag.P0;break;case"phoneMenuPriorityMed":r="priority",n=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P1?VMLIFlag.None:VMLIFlag.P1;break;case"phoneMenuPriorityLow":r="priority",n=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P2?VMLIFlag.None:VMLIFlag.P2;break;case"phoneMenuZoom":t.vmMain.zoomin(t.vmMain.getFirstSelectedItem()),this.closeMultiSelect();break;case"phoneMenuDelete":r="deleteSelf";break;case"phoneMenuCollapse":if(this.selectionHasChildren())for(var o=0;o<t.vmMain.selected().length;o++)t.vmMain.selected()[o].hasChildren()&&(n||(n=!t.vmMain.selected()[o].isCollapsed()),t.vmMain.selected()[o].isCollapsed(n))}if(r)for(var o=0;o<t.vmMain.selected().length;o++)t.vmMain.selected()[o][r](n);"phoneMenuDelete"===i&&t.vmMain.clearSelected()}}},onTapComplete:{onClick:function(){t.menuOnItem.isComplete(!t.menuOnItem.isComplete())}},onTapPriority:{onClick:function(){var e=t.menuOnItem.priority(),r=e!==VMLIFlag.None?VMLIFlag.None:VMLIFlag.P0;t.menuOnItem.priority(r)}},onTapCollapse:{onClick:function(){t.menuOnItem.toggleCollapsed()}},onTapDelete:{onClick:function(){c.beginAction(),t.menuOnItem.deleteSelf(),c.endAction()}},paneTapped:function(){t.menuOnItem&&this.closePhoneMenu(100)},openContextMenu:function(e,r,n){t.autocomplete&&t.autocomplete.hide();var i={visibility:"visible",top:e.top},o=t.width(r);n||e.left+o>d.windowWidth()&&(n=!0),i.left=n?e.left-o-2:e.left+2;var a=t.height(r);e.top+a>d.windowHeight()&&(i.top-=a),t.css(r,i);var s=document.documentElement.getBoundingClientRect(),c=r.getBoundingClientRect(),l={left:c.left,right:c.right,top:c.top,bottom:c.bottom},u=t.adjustOriginToBeInsideBounds(s,l);(u.x!==l.left||u.y!==l.top)&&(r.style.left=u.x+"px",r.style.top=u.y+"px"),t.vmMain.handleFullscreenClick(function(){this.closeContextMenu(r)}.bind(this))},closeContextMenu:function(e){t.css(e,{visibility:"hidden"}),t.vmMain.cancelFullscreenClick()},registerModal:function(r,n,i,o){try{t.PAssert(1355,r&&n,"Must have a valid name and object to bind modal to")}catch(a){t.reportError(a)}this[r+"Item"]=e.observable(n),this[r+"Visible"]=e.observable(!1),this[r+"Loading"]=e.observable(!1),i&&(this[r+"OpenFn"]=i),o&&(this[r+"CloseFn"]=o)},openModal:function(e){try{t.PAssert(1356,!this.modalOpened,"Only a single modal should be opened at a time")}catch(r){t.reportError(r)}this[e+"OpenFn"]&&this[e+"OpenFn"].apply(this[e+"Item"](),Array.prototype.slice.call(arguments,1)),this.modalsBound||(t.applyBindings(this,"modals"),this.modalsBound=!0);var n=this[e+"Visible"];try{t.PAssert(1357,n,"Visible variable does not exist")}catch(r){t.reportError(r)}this.modalOpened=e,this.modalOpenedBound=this[e+"Item"](),n(!0),this.isModalVisible(!0),this.isModalOpen(!0)},closeModal:function(e){if(this.modalOpened){try{t.PAssert(1358,!e||e===this.modalOpened,"Tried to close the wrong modal")}catch(r){t.reportError(r)}arguments.length>1?this.closeModalInternal.apply(this,Array.prototype.slice.call(arguments,1)):this.closeModalInternal()}},closeModalInternal:function(){if(this.modalOpened){try{t.PAssert(1359,this.modalOpened,"Tried to close when no modal was open")}catch(e){t.reportError(e)}var r=this[this.modalOpened+"Visible"];try{t.PAssert(1360,r,"Visible variable does not exist")}catch(e){t.reportError(e)}var n=this.modalOpened;return r(!1),this.isModalOpen(!1),this.isModalVisible(!1),this.modalOpened=void 0,this.modalOpenedBound=void 0,this.modalInputOn=void 0,t.fireCustomEvent("closeKeyboard"),this[n+"CloseFn"]&&this[n+"CloseFn"].apply(this[n+"Item"](),arguments),!1}},focusModalInputMobile:function(e,r){try{t.PAssert(1361,d.mobile,"Should not call this from non-mobile")}catch(n){t.reportError(n)}this.modalInputOn?this.modalInputOn!=r?(r.focus(),this.modalOpenedBound.onKeyboardOpened&&requestAnimationFrame(function(){this.modalOpenedBound.onKeyboardOpened(e)}.bind(this)),e.preventDefault(),e.stopPropagation(),t.enforceScroll()):t.enforceScroll():t.openKeyboardOn(e,r,!1,function(){d.app?(this.modalOpenedBound.onKeyboardOpened(e),requestAnimationFrame(function(){requestAnimationFrame(function(){r.focus(),t.enforceScroll()})})):r.focus()}.bind(this))},onTapModal:{onStart:function(e){d.mobile&&e.srcElement!=this.modalInputOn&&(t.isKeyboardInputElement(e.srcElement)||t.hasClass(e.srcElement,"input"))&&(log("start",t.isKeyboardOpen),t.isKeyboardOpen||(e.preventDefault(),e.stopPropagation()))},onClick:function(e){var r=!0;"modals"==e.srcElement.id?(this.closeModal(),this.modalInputOn=void 0):e.srcElement==this.modalInputOn?r=!1:t.isKeyboardInputElement(e.srcElement)||t.hasClass(e.srcElement,"input")?(d.mobile&&this.focusModalInputMobile(e,e.srcElement),this.modalInputOn=e.srcElement):this.modalInputOn=void 0,r&&d.mobile&&(e.preventDefault(),e.stopPropagation())}},onCloseKeyboard:function(){this.modalInputOn=void 0},paneIsTimeline:function(){return this.contextMenuOpenedOn()?this.contextMenuOpenedOn().isTimeline&&this.contextMenuOpenedOn().isTimeline():!1},openItemMenu:function(e,r){this.openContextMenu({left:r.pageX,top:r.pageY},t.element("contextMenuItem"),!1),this.contextMenuOpenedOn(t.getPaneForElement(r.srcElement));var n,i=!1;t.vmMain.applyToSelection(function(e,r,o){try{t.PAssert(1362,e,"Item must be defined")}catch(a){t.reportError(a)}return e&&0===r&&(n=e,this.itemIsHeader(e.isHeader()),this.itemHasChildren(e.isHeader()||e.hasChildren()),this.itemIsCollapsed(e.isCollapsed()),this.itemIsArchived(e.isArchived()),this.itemCanIndent(0!==e.getIndex()),this.itemCanUnindent(e.parent()!==t.focusedItem)),i||e.canZoom()&&(i=!0,this.itemCanZoom(!0)),i||r!==o-1||this.itemCanZoom(!1),!i}.bind(this),{passExtraInfo:!0})},closeItemMenu:function(){this.closeContextMenu(t.element("contextMenuItem")),this.contextMenuOpenedOn(void 0)},itemContextText:function(){return this.itemIsCollapsed()?"Expand":"Collapse"},itemArchivedText:function(){return this.itemIsArchived()?"Unarchive":"Archive"},hotkeyText:function(e){return d.windows?d.cmdChar+"+"+e:d.cmdChar+""+e},onTapItemMenu:{onStart:t.handlerPreventStop,onClick:function(e){var r=e.srcElement.id;switch(r||(r=e.srcElement.parentNode.id),r){case"itemComplete":t.vmMain.applyFnToSelection("isComplete",!0);break;case"itemFlag":t.vmMain.applyFnToSelection("isFlagged",!0);break;case"itemIndent":t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1});break;case"itemUnindent":t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0});break;case"itemPriorityNone":t.vmMain.applyPriorityToSelection(VMLIFlag.None);break;case"itemPriorityLow":t.vmMain.applyPriorityToSelection(VMLIFlag.P2);break;case"itemPriorityMed":t.vmMain.applyPriorityToSelection(VMLIFlag.P1);break;case"itemPriorityHigh":t.vmMain.applyPriorityToSelection(VMLIFlag.P0);break;case"itemCollapse":t.vmMain.applyToSelection(function(e){e.toggleCollapsed()});break;case"itemZoom":t.vmMain.applyToSelection(function(e){return e.canZoom()?(t.vmMain.zoomin(e),!1):!0});break;case"itemCopy":break;case"itemPaste":break;case"itemUndo":break;case"itemRedo":break;case"itemArchive":{var n=0;t.vmMain.applyToSelection(function(e){this.itemIsArchived()?e.parent().unarchiveChild(e)&&n++:e.parent().archiveChild(e)&&n++}.bind(this))}if(n>0){var i=n>1?" items.":" item.",o=this.itemIsArchived()?"unarchived":"archived";t.messageQueue.pushMessage({text:"Successfully "+o+" "+n+i,type:MessageType.Info,action:MessageAction.Default,timeout:2e3})}break;case"itemDelete":t.vmMain.applyToSelection(function(e){e.deleteSelf()});break;case"contextMenuItem":break;default:try{t.PAssert(1363,!1,"Unknown context menu item: ",r)}catch(a){t.reportError(a)}}t.sendEvent("ContextMenu",r),this.closeItemMenu()}}},l}),define("VMDocSharing",["ko","globals","platform","data","goog"],function(e,t,r,n,i){function o(){this.doc=e.observable({isOwned:function(){return!1}}),this.isLoading=e.observable(!1),this.isCreating=e.observable(!1),this.permissions=e.observableArray(),this.permissionsNew=e.observableArray(),this.permissionsRemove=[],this.newEmail=e.observable(""),this.errorGlobal=e.observable(!1),this.errorName=e.observable(!1),this.errorInvite=e.observable(!1),this.isSaving=e.observable(!1),this.editing=e.observable(""),this.closeCallback=void 0,this.justCreated=!1}return o.prototype={open:function(e,t){this.doc(e),this.closeCallback=t,this.permissions.removeAll(),this.permissionsNew.removeAll(),this.permissionsRemove=[],this.newEmail(""),this.editing(""),this.isLoading(!0),this.errorGlobal(!1),this.errorName(!1),this.errorInvite(!1),this.isSaving(!1),this.isCreating(!this.doc().file),this.justCreated=!1,this.inputName=document.getElementById("shareNameInput"),this.inputName.value=this.doc().title(),this.shareLink=document.getElementById("shareLinkInput"),this.shareLink&&(this.shareLink.value="moo.do/#file="+this.doc().id),r.mobile||setTimeout(function(){this.inputName.focus()}.bind(this),0),this.isCreating()?this.isLoading(!1):gapi.client.drive.permissions.list({fileId:this.doc().id}).execute(this.permissionHandler.bind(this))},permissionHandler:function(e){if(!e.error){this.isLoading(!1);for(var r=[],n=0;n<e.items.length;++n){var i=e.items[n];i.emailAddress!==t.getUserIdentifier()&&(i.onRemove=this.onRemove.bind(this,i),"anyone"!=i.id&&(i.emailAddress||(i.emailAddress="owner"===i.role?"Owner":""),"owner"===i.role?r.splice(0,0,i):r.push(i)),i.emailDisplay="("+i.emailAddress+")")}this.permissions(r)}},isOwned:function(){return this.doc().isOwned&&this.doc().isOwned()},saveText:function(){return this.isCreating()?this.isSaving()?"Creating...":"Create":r.mobile&&this.editing()?"Close":this.newEmail().length>0?"Invite":this.isSaving()?"Saving...":"Save"},titleText:function(){return r.mobile&&this.editing()?this.editing():this.isCreating()?"Create Document":"Edit Document"},onkeydown:function(e,n){return r.normalizeKeys(n),n.normCode==KeyCode.Escape?(this.newEmail(""),n.preventDefault(),n.stopImmediatePropagation(),!1):n.normCode==KeyCode.Enter?(this.inviteUser(),t.scrollIntoView(t.element("inputShareInvite"),0),n.preventDefault(),n.stopImmediatePropagation(),!1):!0},onKeyboardOpened:function(e){this.editing(e.srcElement.title)},inviteUser:function(){if(0===this.newEmail().length)return void this.errorInvite("");if(!t.isEmail(this.newEmail()))return this.errorInvite("Please enter a valid email address."),!1;var r={emailAddress:this.newEmail(),error:e.observable(!1)},i=n.findContactByEmail(r.emailAddress.toLowerCase());return r.name=i?i.text:r.emailAddress,r.onRemove=this.onRemoveNew.bind(this,r),this.permissionsNew.push(r),this.newEmail(""),this.errorInvite(!1),!0},checkName:function(){var e=this.inputName.value.trim();return e.length>0&&e.length<255?(this.errorName(!1),!0):(this.errorName("Error: Document name must be >0 and <255 characters."),!1)},rename:function(){var e=this.inputName.value.trim();e!=this.doc().title()&&(this.doc().title(e),gapi.client.drive.files.patch({fileId:this.doc().id,resource:{title:e}}).execute(function(t){t.error?this.errorName("Error: Unable to update name on remote server."):log("File renamed to",e)}.bind(this)))},create:function(e){this.justCreated=!0,this.isSaving(!0);var t=this.inputName.value.trim();this.tooltip=t,this.isSaving(!0),gapi.client.drive.files.insert({resource:{mimeType:i.REALTIME_MIMETYPE,title:t,writersCanShare:!1}}).execute(function(t){t.error?this.errorGlobal("Error: Unable to create new document."):(this.doc().id=t.id,this.doc().file=t,this.isCreating(!this.doc().file),this.isSaving(!1),e&&e())}.bind(this))},save:function(){function e(e,i){i.error?(console.error("UH OH",i),this.permissionsNew()[n].error(!0),this.errorInvite("Some people could not be invited."),this.isSaving(!1)):(r--,0>=r&&t.menus.closeModal("shareDoc",!1))}if(!this.isSaving()||this.justCreated){if(this.editing())return t.blurActiveElement(),void this.editing("");if(!i.isDriveAPILoaded())return void this.errorGlobal("Error communicating with Google Drive. Please reconnect and try again.");if(this.checkName()){if(this.isCreating())return void this.create(this.save.bind(this));if(this.newEmail().length>0){if(!this.inviteUser())return}else this.errorInvite(!1);this.rename();for(var r=0,n=0;n<this.permissionsNew().length;n++){var o=this.permissionsNew()[n];if(!o.error()){r++;var a={value:o.emailAddress,type:"user",role:"writer",withLink:!1},s="Come collaborate with me at Moo.do!\r\nhttp://www.moo.do/#login=true&file="+this.doc().id;gapi.client.drive.permissions.insert({fileId:this.doc().id,emailMessage:s,resource:a}).execute(e.bind(this,n))}}for(var n=0;n<this.permissionsRemove.length;n++){var c=this.permissionsRemove[n];gapi.client.drive.permissions.delete({fileId:this.doc().id,permissionId:c.id}).execute(function(e){})}this.errorInvite()||this.errorName()||(0===r?t.menus.closeModal("shareDoc",!0):(this.isSaving(!0),this.onClose(!0)))}}},onClose:function(e){this.closeCallback&&(this.closeCallback(e),this.closeCallback=void 0)},onTapInviteMessage:{onStart:t.handlerPreventStop,onClick:function(e){var n=t.element("inputShareInvite");r.mobile?t.menus.focusModalInputMobile(e,n):n.focus()}},onTapSave:{onStart:t.handlerPreventStop,onClick:function(){this.save(),t.sendEvent("Menu","SharingSave")}},onTapCancel:{onStart:t.handlerPreventStop,onClick:function(){t.menus.closeModal("shareDoc",!1),t.sendEvent("Menu","SharingCancel")}},onTapDelete:{onStart:t.handlerPreventStop,onClick:function(){t.sendEvent("Menu","SharingDelete"),setTimeout(function(){var e=prompt("This will delete the file. Type DELETE to confirm.");e&&"delete"==e.trim().toLowerCase()&&(gapi.client.drive.files.delete({fileId:this.doc().id}).execute(function(e){log("Document Delete Response: ",e),e.error&&t.messageQueue.pushMessage({text:"Unable to delete document on the remote server.",type:MessageType.Error})}.bind(this)),t.vmMain.vmPicker.removeFile(this.doc()),t.menus.closeModal("shareDoc",!1))}.bind(this),0)}},onRemove:function(e){this.permissionsRemove.push(e),this.permissions.remove(e),t.sendEvent("Menu","SharingRemoveUser")},onRemoveNew:function(e){this.permissionsNew.remove(e)}},o}),define("VMPicker",["ko","globals","util","platform","data","goog","VMDocument","VMDocSharing","tracker"],function(e,t,r,n,i,o,a,s,c){function d(){this.files=e.observableArray(),this.permissions=e.observableArray(),this.isPublic=e.observable(),this.fileMap={},this.isLoading=e.observable(!1),this.needPermission=e.observable(!1),this.showError=e.observable(!1),this.loadCallbacks=[],this.init()}return d.prototype={init:function(){var e=new s;t.menus.registerModal("shareDoc",e,e.open.bind(e),e.onClose.bind(e))},refreshFiles:function(){this.runOnFileLoad(this.markFileProperties.bind(this)),gapi.client.load("drive","v2",function(){this.loadFileList()}.bind(this))},setFiles:function(e,t){this.files.removeAll();for(var r=0;r<e.length;r++){var n=e[r],i=new a(n);i.isOpen=r===t,this.files.push(i)}this.setMinHeight()},loadFileList:function(e){this.isLoading()||(this.isLoading(!0),this.showError(!1),gapi.client.load("drive","v2",function(){gapi.client.drive.files.list({fields:"items(appDataContents,createdDate,description,editable,etag,exportLinks,iconLink,id,indexableText,kind,labels,md5Checksum,mimeType,ownerNames,owners,parents,permissions,properties,quotaBytesUsed,shared,sharedWithMeDate,sharingUser,title,userPermission,version,writersCanShare),kind,nextLink,nextPageToken",q:"trashed=false and mimeType='"+o.REALTIME_MIMETYPE+"."+o.APP_ID+"'"}).execute(function(t){if(!t.items||t.error)this.showError("Load Documents");else{for(var r=0,n=o.getDocId(),i=0;i<t.items.length;++i){var a=t.items[i];this.fileMap[a.id]=a,n===a.id&&(r=i)}this.setFiles(t.items,r)}this.isLoading(!1),e&&e(t),this.onFilesLoaded(t)}.bind(this))}.bind(this)))},markFileProperties:function(e){if(e&&e.items)for(var t=0;t<e.items.length;++t){var r=e.items[t];if(!r.properties&&r.title===o.LEGACY_DefaultDriveDocTitle&&"me"===r.userPermission.id&&"owner"===r.userPermission.role){gapi.client.drive.properties.insert({fileId:r.id,resource:{key:o.DefaultProperty,value:o.DefaultPropertyValue,visibility:"PRIVATE"}}).execute(function(e){(e.error||"drive#property"!==e.kind)&&ShouldLog(LogLevels.Error)&&log("Error adding default file property: ",e)});break}}},onFilesLoaded:function(e){if(this.loadCallbacks.length>0){for(var t=0;t<this.loadCallbacks.length;++t)this.loadCallbacks[t]&&this.loadCallbacks[t](e);this.loadCallbacks=[]}},runOnFileLoad:function(e){this.loadCallbacks.push(e)},requestOpenDocument:function(e){var t=this.getFile(e);t?this.openDocument(t):this.needPermission()?this.doRequestPermission(function(){this.openDocumentFromId(e)}.bind(this)):this.onFilesLoaded(function(){this.openDocumentFromId(e)}.bind(this))},openDocumentFromId:function(e,n){var a=o.getDocId();if(a!==e){var s=[Settings.docSharing,Settings.authScopes,Settings.shownTutorial,Settings.lastMessageSync];i.clearData(function(){o.setDocInfo(e,n),r.hasURLParam("file")?r.removeURLParam("file",!0):r.hasURLParam("state")&&r.removeURLParam("state",!0),setTimeout(function(){t.reload()},500)},s)}},openDocument:function(e){t.localDocChangeRequested=!0,this.openDocumentFromId(e.id,e.title)},doRequestPermission:function(){},onRequestPermission:function(){this.doRequestPermission()},onTapReloadDocuments:function(){this.loadFileList()},onTapDocument:{onClick:function(r){var n=e.dataFor(r.srcElement);t.hasClass(r.srcElement,"documentTitle")?(this.openDocument(n),c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocument,data:[{value:!0}]})):n instanceof a?(n.onTapMenu(),r.stopImmediatePropagation()):t.reportError("Incorrect document type: "+t.elementToString(r.srcElement))}},onTapAdd:{onStart:t.handlerPreventStop,onClick:function(){if(t.vmMain&&t.vmMain.isOnline()){var e=new a;e.isOwned(!0),this.files.push(e),this.setMinHeight(),t.sendEvent("Menu","AddDocument"),e.openSharing(function(t){t||(this.files.remove(e),this.setMinHeight())}.bind(this)),c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddDocument,data:[{value:!0}]})}else t.messageQueue.pushMessage({text:"You must be online to create a new document",type:MessageType.Warning,timeout:8e3})}},getFile:function(e){return this.fileMap[e]},removeFile:function(e){this.files.remove(e),this.setMinHeight(),e.isOpen&&i.clearData(function(){setTimeout(function(){t.reload()},0)})},setMinHeight:function(){if(!n.mobile){var e=document.getElementById("documentsList");if(!e)return void setTimeout(this.setMinHeight.bind(this),0);var r=e.clientHeight;t.element("sidebarDocumentContainer").style.minHeight=r+50+"px"}}},d}),define("VMSettings",["ko","data","globals","util","goog","platform","tracker","VMPicker"],function(e,t,r,n,i,o,a){function s(){this.enabledSyncContacts=e.observable(!1),this.enabledSounds=e.observable(!1),this.enabledNotifications=e.observable(!1),this.enabledMobileUI=e.observable(!1),this.syncContactsEnabledOnOpen=e.observable(!1),this.refreshingContacts=!1,this.refreshContactsSuccess=e.observable(void 0),this.init()}return s.prototype={init:function(){if(r.menus.registerModal("settings",this,this.open.bind(this),this.close.bind(this)),this.loadSettings(),o.mobile){var e=this.save.bind(this);this.enabledSyncContacts.subscribe(e),this.enabledSounds.subscribe(e),this.enabledNotifications.subscribe(e),this.enabledMobileUI.subscribe(e)}if(o.isTouchDevice&&!o.app){var t=document.getElementById("paneSettings");t&&t.addEventListener(o.touchStartEvent,function(e){return r.preventScrollPropagation(t)||"paneSettings"!=e.srcElement.id?void 0:(e.preventDefault(),!1)})}o.mobile&&r.ScreenManager.addScreen(this,Screens.Settings),window.addEventListener("settingsChange_"+Settings.syncContacts,this.onSyncContactsChange.bind(this))},isLocal:function(){return"localhost"===window.location.hostname},showMobileUIOptionOnDesktop:function(){try{return!!n.storage.getItem("forceFullUI")}catch(e){return!1}},showMobileUIOptionOnMobile:function(){return parseInt(window.innerWidth)>767},onEnableNotificationsChange:function(){this.enabledNotifications()?r.timeline.updateNotifications():r.timeline.clearNotifications()},onSyncContactsChange:function(e){this.enabledSyncContacts(e.data)},getTopElement:function(){return document.getElementById("paneSettings")},open:function(){this.isClosing||(this.refreshContactsSuccess(void 0),this.loadSettings(),this.syncContactsEnabledOnOpen(this.enabledSyncContacts()))},close:function(e){if(e)this.save();else{var t=!!r.settings.get(Settings.syncContacts);this.enabledSyncContacts(t),this.enabledSounds(!r.settings.get(Settings.noSounds))}},onScreenStartOpen:function(){this.loadSettings()},enableSyncContacts:function(){function e(e){0>e?r.messageQueue.pushMessage({text:'There was an error syncing your contacts, please try again using the "Refresh Contacts" button in settings.',type:MessageType.Error}):e>0&&(r.messageQueue.pushMessage({text:"Your contacts were successfully syncd with Moo.do.",type:MessageType.Info}),r.vmMain.runParseWorker())}r.sendEvent("Settings","EnableContacts"),i.runAuthenticate([GScope.Contacts],!1,!1,function(t){t&&!t.error?(i.loadContacts(e),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SyncContacts,data:[{value:!0}]})):(this.enabledSyncContacts(!this.enabledSyncContacts()),r.settings.set(Settings.syncContacts,this.enabledSyncContacts()),r.messageQueue.pushMessage({text:"If you would like to sync your contacts we need permission to access them, please try again.",type:MessageType.Error,timeout:1e4}))}.bind(this))},loadSettings:function(){this.enabledSyncContacts(!!r.settings.get(Settings.syncContacts)),this.enabledSounds(!r.settings.get(Settings.noSounds)),this.enabledNotifications(!r.settings.get(Settings.disableNotifications));try{this.enabledMobileUI(!n.storage.getItem("forceFullUI"))}catch(e){this.enabledMobileUI(!1)}},save:function(){var e,o=this.enabledSyncContacts()!==!!r.settings.get(Settings.syncContacts),a=this.enabledSounds()!==!r.settings.get(Settings.noSounds),s=this.enabledNotifications()!==!r.settings.get(Settings.disableNotifications);try{e=this.enabledMobileUI()!==!n.storage.getItem("forceFullUI")}catch(c){e=!1}o&&(r.settings.set(Settings.syncContacts,this.enabledSyncContacts()),this.enabledSyncContacts()?this.enableSyncContacts():(r.sendEvent("Settings","DisableContacts"),i.loadedContacts=!1,t.clearContacts())),a&&r.settings.set(Settings.noSounds,!this.enabledSounds()),s&&r.settings.set(Settings.disableNotifications,!this.enabledNotifications()),e&&r.shouldWriteLocal()&&(this.enabledMobileUI()?n.storage.removeItem("forceFullUI"):n.storage.setItem("forceFullUI",!0))},isDemo:function(){return r.isDemoMode()},onTapSave:function(){r.menus.closeModal("settings",!0)},onTapCancel:function(){r.menus.closeModal("settings",!1)},onScreenOpen:function(){r.isKeyboardOpen&&r.blurActiveElement()},onScreenClose:function(){this.save()},onTapLogout:function(e){r.vmSetup.logoutClicked(),r.sendEvent("Menu","Logout"),e.preventDefault()},onTapRunPicker:function(){},onTapFeedback:function(e){r.menus.openModal("reportBug"),r.sendEvent("Menu","GiveFeedback"),e.preventDefault()},onTapLeaveDemo:function(){n.removeURLParam("demo")},onTapRestartClient:function(e){r.reload(),e.preventDefault()},onTapPromptResetClient:function(e){r.messageQueue.pushMessage(MessageID.CacheReset),e.preventDefault()},onTapResetClient:function(){t.clearData(function(){r.reload()}),r.sendEvent("Menu","ResetClient")},onForceReloadDoc:function(){var e=[Settings.docSharing,Settings.authScopes,Settings.shownTutorial,Settings.gdocId,Settings.gdocTitle];t.clearData(function(){r.reload()},e),r.sendEvent("Menu","ReloadDoc")},onTapSettings:function(){r.menus.openModal("settings"),r.vmMain.cancelFullscreenClick(),r.sendEvent("Menu","Settings")},onTapHelp:function(){r.vmMain.showHelp(HelpMode.Normal),r.sendEvent("Menu","HelpSidebar")},onlineStatusToggle:function(){o.offline?n.removeURLParam("offline"):n.insertURLParam("offline","true")},logoutButtonText:function(){return r.vmSetup.logoutButtonText()},isLoggedIn:function(){return r.vmSetup.loginState()==LoginState.LOGGED_IN},showAppDebugInfo:function(){return o.debugApp},getHostName:function(){return"Host: "+window.location.host},getAppDebugText:function(){return"LowMem: "+(r.hasSentLowMemoryWarning()?"TRUE":"FALSE")},onTapRefreshContacts:function(){this.refreshingContacts||(this.refreshingContacts=!0,this.refreshContactsSuccess(void 0),t.clearLocalContacts(),i.loadedContacts=!1,i.authAndLoadContacts(function(e){this.refreshContactsSuccess(e),setTimeout(function(){this.refreshingContacts=!1}.bind(this),1e3)}.bind(this)),r.sendEvent("Menu","RefreshContacts"))},contactsRefreshSuccessTest:function(){return void 0===this.refreshContactsSuccess()?"":this.refreshContactsSuccess()===!0?"Success!":this.refreshContactsSuccess()===!1?"Failure!":void 0},onTapImport:function(){r.menus.openModal("importData"),r.sendEvent("Menu","ImportData"),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenImport,data:[{value:!0}]})},onTapExport:function(){r.menus.openModal("exportData"),r.sendEvent("Menu","ExportData"),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenExport,data:[{value:!0}]})}},s}),define("VMPhoneMenu",["ko","globals","data","platform","tracker","gdata"],function(e,t,r,n,i,o){function a(){try{t.PAssert(1364,n.mobile,"Should only initialize on mobile platforms")}catch(r){t.reportError(r)}this.searchScale="",this.searchTranslate="",this.search=t.vmSearchPhone,this.mode=e.observable(this.Modes.Normal),this.multiSelected=t.vmMain.selected,this.activeScreen=e.observable(Screens.List),this.init()}return a.prototype={Modes:{Normal:0,Multiselect:1,Contact:2,Date:3},init:function(){try{t.PAssert(1365,t.vmSearchPhone,"Phone search must be initialized at this point")}catch(e){t.reportError(e)}t.applyBindings(this,"phoneMenu"),window.appEvents=this.appEvents,n.app&&n.sendToApp("kbsize"),this.mode.subscribe(function(e){e==this.Modes.Multiselect?t.addClass(t.focusedPane.element,"multiSelectMode"):t.removeClass(t.focusedPane.element,"multiSelectMode")}.bind(this)),window.addEventListener("screenScroll",function(){this.activeScreen(t.ScreenManager.activeScreen)}.bind(this))},_modeHelper:function(e,t){return void 0!==e&&this.mode(e?t:this.Modes.Normal),this.mode()===t
},activeScreenClass:function(){var e=this.activeScreen(),t="";return e==Screens.List?t="listActive":e==Screens.Outline?t="outlineActive":e==Screens.Settings&&(t="settingsActive"),this.search.isShowing()&&(t+=" searchShowing"),this.search.isFocused()&&(t+=" searchFocused"),t},normalMode:function(e){return this._modeHelper(e,this.Modes.Normal)},multiSelectMode:function(e){return this._modeHelper(e,this.Modes.Multiselect)},contactMode:function(e){return this._modeHelper(e,this.Modes.Contact)},dateMode:function(e){return this._modeHelper(e,this.Modes.Date)},isSaved:function(){return log("IsSaved DriveStatus: ",t.vmMain.gdriveStatus()),n.offline||t.vmMain.gdriveStatus()===DriveStatus.Saved},showSearchSeparator:function(){return this.search.showSearchSeparator()},isTimeline:function(){return t.focusedPane.mode()==PaneMode.Timeline},titleText:function(){var e=t.focusedPane.item(),r=e.getParsedText();return r},isMenuMain:function(){return t.ScreenManager.isScreenOpen(Screens.List)},isMenuContext:function(){return t.ScreenManager.isScreenOpen(Screens.Outline)},isMenuSettings:function(){return t.ScreenManager.isScreenOpen(Screens.Settings)},updateSearchDOM:function(){},onTapMultiSelectCancel:{onClick:function(e){t.menus.closeMultiSelect(),t.handlerPreventStop(e)}},onTapContactCancel:{onClick:function(e){t.autocomplete.hide(),t.handlerPreventStop(e)}},onTapList:{onClick:function(e){t.ScreenManager.scrollToScreen(Screens.List),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","CloseOutline")}},onTapOutline:{onClick:function(e){t.ScreenManager.scrollToScreen(Screens.Outline),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","OpenOutline")}},onTapSettings:{onClick:function(e){log("tap settings"),t.ScreenManager.scrollToScreen(t.ScreenManager.activeScreen==Screens.Settings?Screens.Outline:Screens.Settings),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","OpenSettings")}},onTapMode:{onClick:function(e){log("mode",e),this.toggleMode(),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","SwitchMode")}},onTapArchive:{onClick:function(e){t.focusedPane.archiveCompleted(),t.sendEvent("PhoneMenu","ArchiveCompleted"),t.handlerPreventStop(e)}},onTapHeader:{onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},paneTapped:function(){},updateSearchTransform:function(){t.element("searchDivPhone").style[n.transform.style]=this.searchTranslate+" "+this.searchScale},toggleMode:function(){t.blurActiveElement(),t.focusedPane.initialOffset=void 0,t.focusedPane.mode()==PaneMode.Normal?(t.vmMain.clearSelected(),t.focusedPane.mode(PaneMode.Timeline)):t.focusedPane.mode(PaneMode.Normal),t.focusedPane.vmSearch.updateSearch(!0),t.vmMain.updatePaneState(t.focusedPane)},appEvents:{undo:function(){log("shake to undo"),i.undoAction()},redo:function(){log("shake to redo"),i.redoAction()},kbsize:function(e){n.kbsize=e},enterBackground:function(){t.onunload()},enterForeground:function(){o.poke(),t.checkForRemoteChanges()},reportLowMemory:function(e){t.handleLowMemory(e)},statusBarTap:function(){var e=t.getFirstPaneItem(t.focusedPane);t.scrollToTop(e.getSpan(),200)}}},a}),define("VMKeyboardToolbar",["ko","globals","data","edit","platform"],function(e,t,r,n,i){function o(){this.buttons=e.observableArray(),this.priorityVisible=e.observable(),this.isVisible=e.observable(!1),this.element=void 0,this.aboutToShow=void 0,this.bottomPosition=void 0,this.init()}return o.prototype={init:function(){this.element=document.getElementById("mobileKeyboardToolbar"),t.applyBindings(this,"mobileKeyboardToolbar"),window.addEventListener("closeKeyboard",this.hide.bind(this))},onTap:{onStart:t.handlerPreventStop,onClick:function(e){var r=e.srcElement.id;if("mobileKeyboardToolbar"==r&&(e.preventDefault(),e.returnFalse=!0),"closeKeyboardButton"==r)t.blurActiveElement(),t.vmMain.clearSelected();else if(t.vmSearchPhone.isFocused()){var n;"priorityButton"==r?n="!":"dateButton"==r?n="@":"contactButton"==r?n="+":"tagButton"==r&&(n="#"),t.vmSearchPhone.insert(n)}else"outdentButton"==r?t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}):"indentButton"==r?t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}):"priorityButton"==r?this.priorityVisible(!this.priorityVisible()):"pNoneButton"==r?t.vmMain.applyPriorityToSelection(VMLIFlag.None,!1):"p0Button"==r?t.vmMain.applyPriorityToSelection(VMLIFlag.P0,!0):"p1Button"==r?t.vmMain.applyPriorityToSelection(VMLIFlag.P1,!0):"p2Button"==r?t.vmMain.applyPriorityToSelection(VMLIFlag.P2,!0):"pStarButton"==r?t.vmMain.applyFnToSelection("isFlagged",!0):"dateButton"==r?t.vmMain.insertCharacter("@",!0):"contactButton"==r?t.vmMain.insertCharacter("+",!0):"tagButton"==r&&t.vmMain.insertCharacter("#",!0);e.stopImmediatePropagation(),e.preventDefault(),e.returnFalse=!0}},preShow:function(){this.aboutToShow=!0,this.priorityVisible(!1),setTimeout(function(){this.aboutToShow=!1}.bind(this),100)},show:function(){this.aboutToShow=!1,this.updatePosition(),t.isKeyboardOpen=!0,i.ie||this.isVisible(!0),this.hideTopBarIfLandscape(),t.vmSearchPhone.isFocused()?t.addClass(this.element,"kbsearch"):t.removeClass(this.element,"kbsearch")},hide:function(){!this.aboutToShow&&t.isKeyboardOpen&&(this.priorityVisible(!1),t.isKeyboardOpen=!1,this.hideTopBarIfLandscape(),this.isVisible(!1))},hideTopBarIfLandscape:function(){if(i.orientation===Orientation.Landscape&&t.isKeyboardOpen){if(t.setTransform(t.element("container"),0,-40),t.setTransform(t.element("phoneMenuTopWrapper"),0,-40),t.vmMain.selected().length>0){var e=t.vmMain.selected()[0];t.scrollToTop(e.getSpan())}}else t.setTransform(t.element("container"),0,0),t.setTransform(t.element("phoneMenuTopWrapper"),0,0)},updatePosition:function(e){i.app||(i.kbsize=i.orientation==Orientation.Portrait?i.kbsizePortrait:i.kbsizeLandscape);var r=i.kbsize;r!=this.bottomPosition&&(this.bottomPosition=r,t.element("mobileKeyboardToolbar").style.bottom=this.bottomPosition+"px",e&&(this.isVisible(!1),setTimeout(function(){this.isVisible(!0)}.bind(this),400)))}},o}),define("VMHelp",["ko","globals"],function(e,t){function r(){this.isVisible=e.observable(!1),this.helpContentEle=void 0,this.iframe=void 0,this.init()}return r.prototype={init:function(){t.menus.registerModal("help",this)},onLoad:function(e){this.helpContentEle=e,this.iframe||(this.iframe=document.createElement("iframe"),this.iframe.id="helpContentFrame",this.iframe.src="help.html",this.iframe.setAttribute("seamless","seamless")),this.helpContentEle.insertBefore(this.iframe,this.helpContentEle.firstElementChild)},onTapClose:function(){t.menus.closeModal("help")}},r}),this.document||(importScripts("lib/date.js"),importScripts("DuchessHelpers.js")),this.document?window.parseWorkerWrapper=parseWorkerWrapper:parseWorkerWrapper(),define("parseWorker",function(){}),define("VMIntroSection",["ko","globals","platform","data"],function(e,t){function r(t,r){this.text=t,this.note=r,this.items=[],this.inOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0,this.isComplete=e.observable(!1)}return r.prototype={getHash:function(){return t.introHash(this.text)},getStepHash:function(e){return t.introHash(this.items[e].text)},loadFromSaveData:function(e){if(e===!0){for(var t=0;t<this.items.length;++t)this.items[t].isChecked(!0);this.numComplete=this.items.length,this.isComplete(!0)}else{for(var t=0;t<e.length;++t)for(var r=0;r<this.items.length;++r)e[t]===this.getStepHash(r)&&(this.items[r].isChecked(!0),this.numComplete++);this.numComplete===this.items.length&&this.isComplete(!0)}},addStep:function(r){return r.check||(r.check=function(){}),r.isChecked||(r.isChecked=e.observable(!1)),this.inOrder?r.isDisabled||(r.isDisabled=e.observable(this.items.length>0)):r.isDisabled=t.fFalse,this.items.push(r),r},complete:function(e){e.isChecked(!0),this.owner.notifyOfChange(e)},check:function(e){for(var t=0;t<this.items.length;t++)!this.items[t].isChecked()&&this.items[t].check(e)&&(this.complete(this.items[t]),this.inOrder&&(this.numComplete++,t===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].isDisabled(!1))));this.numComplete===this.items.length&&this.isComplete(!0)}},r}),define("VMIntro",["ko","globals","util","platform","data","VMIntroSection"],function(e,t,r,n,i,o){function a(r){try{t.PAssert(1368,void 0!==r,"Must pass in a valid display state")}catch(n){t.reportError(n)}this.mode=e.observable(r),this.sections=e.observableArray(),this.introSection=void 0,this.init(),t.intro=this}return window.HelpMode={None:0,Normal:1,Intro:2},a.prototype={init:function(){this.isIntroMode()?this.initIntro():this.initHelp(),this.loadState()},checkContactsEnable:function(){this.itemContactsEnable.isChecked(!0),this.saveState()},setMode:function(e){this.mode(e),t.settings.set(Settings.helpPaneState,e),t.vmMain.helpButtonHidden(e===HelpMode.Intro)},isIntroMode:function(){return this.mode()===HelpMode.Intro},modeClass:function(){return this.isIntroMode()?"helpIntro":"helpNormal"},loadState:function(){if(t.shouldWriteLocal())try{var e=r.storage.getItem(this.modeClass());if(e){var n=JSON.parse(e);if(n)for(var i=0;i<this.sections().length;++i){var o=this.sections()[i],a=o.getHash();n[a]&&o.loadFromSaveData(n[a])}}}catch(s){t.reportError(s)}},saveState:function(){if(t.shouldWriteLocal())try{var e=this.getState();r.storage.setItem(this.modeClass(),JSON.stringify(e))}catch(n){t.reportError(n)}},getState:function(){for(var e={},r=0;r<this.sections().length;++r){var n=this.sections()[r];if(n.isComplete())e[n.getHash()]=!0;else{for(var i=[],o=0;o<n.items.length;++o){try{t.PAssert(1369,n.items[o],"Item entries must exist")}catch(a){t.reportError(a)}if(n.items[o].isChecked()){var s=n.getStepHash(o);i.push(s)}}i.length>0&&(e[n.getHash()]=i)}}return e},notifyOfChange:function(){this.saveState()},addSection:function(e){e.owner=this,this.sections.push(e)},initIntro:function(){this.introSection=new o("Welcome to Moo.do!","We'll walk you through the basics to get you started."),this.introSection.inOrder=!0,this.introSection.addStep(this.itemAddItem),this.introSection.addStep(this.itemIndent),this.introSection.addStep(this.itemOutdent),this.introSection.addStep(this.itemDateTime),this.introSection.addStep(this.itemRightClick),this.introSection.addStep(this.itemAddAgenda),this.addSection(this.introSection)},itemAddItem:{text:"Write a list header and press enter to add a new item",check:function(e){if(e.type===TrackerType.Create){var t=i.itemsById[e.data[0].itemID].model;return t.parent()!=i.getRootModel()||0!==e.data[0].position?!0:!1}}},itemIndent:{text:"Press the Tab key to add an item into a list",check:function(e){if(e.type===TrackerType.Move){var t=i.itemsById[e.data[0].oldParent].data;if(t.items.indexOf(e.data[0].newParent)>=0)return!0}}},itemOutdent:{text:"Press Shift + Tab to remove an item out of a list",check:function(e){if(e.type===TrackerType.Move){var t=i.itemsById[e.data[0].newParent].data;if(t.items.indexOf(e.data[0].oldParent)>=0)return!0}}},itemDateTime:{text:"Add a date/time by typing @ in the text of an item",check:function(e){return e.type===TrackerType.Insert&&"@"===e.data[0].text}},itemRightClick:{text:"Right click an item to explore more options",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.RightClick}},itemAddAgenda:{text:'Click <i class="icon-calendar2 f22 gd"></i> in the top right to add an Agenda pane',check:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane){var r=t.vmMain.panes()[e.data[0].data];if(r.mode()===PaneMode.Timeline)return!0}}},itemContactsEnable:{text:'<div id="buttonHelpEnableContacts" class="button bBlue" style="margin-right: 3px;">Enable</div> syncing contacts with your Google account',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SyncContacts&&e.data[0].value}},initHelp:function(){var e=new o("Organization","Moo.do works like a text editor so you can organize like you're writing a document.");e.addStep(this.itemAddItem),e.addStep(this.itemIndent),e.addStep(this.itemOutdent),e.addStep({text:"Click and drag on the left edge of an item to move it around",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&t.vmMain.isLoaded?!0:void 0}}),e.addStep({text:"Press "+cmdChar+" + Z to undo and "+cmdChar+" + Y to redo",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.UndoRedo?!0:void 0}}),e.addStep({text:"To collapse an item and hide its children press "+cmdChar+" + , or select collapse from the right click menu",check:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"isCollapsed"===t.field&&t.newValue}}),this.addSection(e);var r=new o("Dates","Scheduling items automatically puts them on your Agenda.");r.addStep(this.itemDateTime),r.addStep({text:'Write dates in plain English like <span class="date">@tomorrow</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var r=e.data[0].date;return!!r}}}),r.addStep({text:'Schedule a full date and time like <span class="date">@today 2:30pm</span> or <span class="date">@5/25 6:00</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var r=e.data[0].date;if(r)return r._explicitTime}}}),r.addStep({text:'Describe urgency with <span class="date">@now</span>, <span class="date">@soon</span>, or <span class="date">@later</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var r=i.itemsById[e.data[0].itemID].model;return r?t.isDateSoft(r.dateText):!1}}}),this.addSection(r);var n=new o("Priority","Prioritizing items automatically puts them on your agenda and lets you manage what to do next.");n.addStep(this.itemRightClick),n.addStep({text:"Set a priority with the right click menu or "+cmdChar+" + 1/2/3",check:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"priority"===t.field&&t.newValue>0}}),n.addStep({text:"Click the left of an item or "+cmdChar+" + / to mark it complete",check:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"isComplete"===t.field&&t.newValue}}),n.addStep({text:"Press "+cmdChar+" + ' to flag an item which highlights it in yellow",check:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"isFlagged"===t.field&&t.newValue}}),this.addSection(n);var a=new o("Contacts","Add a contact to an item to easily start a call or email.");a.addStep(this.itemContactsEnable),t.waitForElement("buttonHelpEnableContacts",function(e){e.onclick=function(){t.vmSettings.enableSyncContacts()}},100),a.addStep({text:"Add a contact by typing + in the text of an item",check:function(e){return e.type===TrackerType.Insert&&"+"===e.data[0].text}}),a.addStep({text:"Select a contact's name from the list or start typing a name to narrow the search",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddContact}}),a.addStep({text:'Click on a <span class="contact">+contact</span> to start a call or email',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenContact}}),this.addSection(a);var s=new o("Panes","There are two types of panes: List and Agenda. The List pane is where you write and organize while the Agenda pane is organized automatically by time and priority.");s.addStep({text:'Click <i class="icon-align-left f22 gd"></i> in the top right to add a List pane',check:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane){var r=t.vmMain.panes()[e.data[0].data];if(r.mode()===PaneMode.Normal)return!0}}}),s.addStep(this.itemAddAgenda),s.addStep({text:'Click <i class="icon-remove gd"></i> in the top right of a pane to close it',check:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.RemovePane}}),this.addSection(s);var c=new o("Focus","Focus on an item to show only the items under it");c.addStep({text:"To focus on an item, right click on it and select zoom or press "+cmdChar+" + Enter",check:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut}}),c.addStep({text:'To bring focus back out, click the <span class="titleWrapper"><span class="titleOpen">title of the list</span></span> you want to focus on',check:function(e){return e.type===TrackerType.Zoom&&e.data[0].zoomOut}}),c.addStep({text:'Press <i class="outlineButtonNormal icon-list"></i> in the top left of a pane to open the outline',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleOutline}}),c.addStep({text:"Click the title of a list in the outline to focus on it",check:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut&&t.focusedPane.outline.isVisible()}}),this.addSection(c);var d=new o("Search","Filter for only the items you want to see right now");d.addStep({text:"Filter for a keyword by searching for that word",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged}}),d.addStep({text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function(e){return e.type===TrackerType.Insert&&"#"===e.data[0].text}}),d.addStep({text:"Filter by priority by searching for !, !!, or !!!",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("!")>=0}}),d.addStep({text:"Show only flagged items by searching for '' (two apostrophes)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("''")>=0}}),d.addStep({text:"Hide items you're not interested in by starting a search with - (dash)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("-")>=0}}),d.addStep({text:"Hide completed items by searching for -// (dash, two slashes)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("-//")>=0}}),this.addSection(d);var l=new o("Collaboration","Collaborate with others by sharing documents with different groups of people");l.addStep({text:'Click <i class="icon-reorder f22 gd"></i> in the top left to open the sidebar',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleSidebar&&e.data[0].value}}),l.addStep({text:'Click <i class="icon-plus f18 g"></i> to create a new document',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddDocument&&e.data[0].value}}),l.addStep({text:"Open your new document by clicking on it in the list of documents",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocument&&e.data[0].value}}),l.addStep({text:'Click <i class="icon-user f18 c g"></i> to change the sharing settings',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocSharing&&e.data[0].value}}),this.addSection(l);var u=new o("Data","Import data from another app to use in Moo.do or export your data out of Moo.do");u.addStep({text:"Paste into Moo.do by pressing "+cmdChar+" + V or finding Paste in your browsers edit menu",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.Paste&&e.data[0].value}}),u.addStep({text:"Copy the selected text by pressing "+cmdChar+" + C or finding Copy in your browsers edit menu",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.Copy&&e.data[0].value}}),u.addStep({text:'Click on Import Data in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please <a href="mailto:support@moo.do?subject=Import Request">contact us</a> and tell us what app you want to import from.',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenImport&&e.data[0].value}}),u.addStep({text:"Click on Export Data in the sidebar, then choose the format you'd like. You can see your data in a new tab so you may copy or download it.",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenExport&&e.data[0].value}}),this.addSection(u),!this.itemContactsEnable.isChecked()&&t.settings.get(Settings.syncContacts)&&this.checkContactsEnable(),window.addEventListener("settingsChange",function(e){"syncContacts"==e.data.property&&this.checkContactsEnable()}.bind(this))},onAction:function(e){try{for(var r=0;r<this.sections().length;r++)this.sections()[r].check(e)}catch(n){t.reportError(n)}},onClosePane:function(){t.tooltip.hideTip(),t.vmMain.closeHelp()},introComplete:function(){return this.introSection&&this.introSection.isComplete()},switchToHelp:function(){this.initHelp(),this.setMode(HelpMode.Normal),this.sections.splice(0,1),delete this.introSection,this.saveState()}},a}),define("VMMain",["ko","globals","util","android","data","gdata","goog","edit","copypaste","VMMain_DragDrop","VMLI","VMTitle","tracker","platform","VMSearch","VMPane","VMMenus","VMSettings","VMPicker","VMPhoneMenu","VMKeyboardToolbar","VMHelp","parseWorker","VMIntro"],function(e,t,r,n,i,o,a,s,c,d,l,u,h,p,m,f,g,v,y,b,S,T,w,E){var M=function(){function s(){try{t.PAssert(1374,window.helperWrapper,"helperWrapper must be defined for worker to be created")}catch(e){t.reportError(e)}try{t.PAssert(1375,window.dateWrapper,"dateWrapper must be defined for worker to be created")}catch(e){t.reportError(e)}try{t.PAssert(1376,window.parseWorkerWrapper,"parseWorkerWrapper must be defined for worker to be created")}catch(e){t.reportError(e)}var r;if(p.ie)r="js/parseWorker.js",window.helperWrapper=void 0,window.dateWrapper=void 0,window.parseWorkerWrapper=void 0,delete window.helperWrapper,delete window.dateWrapper,delete window.parseWorkerWrapper;else try{var n=window.helperWrapper.toString(),i=window.dateWrapper.toString(),o=window.parseWorkerWrapper.toString(),a="parseWorkerWrapper();";window.URL=window.URL||window.webkitURL,r=window.URL.createObjectURL(new Blob([n,i,o,a],{type:"text/javascript"}))}catch(s){ShouldLog(LogLevels.Warning)&&log("---- WARNING: Blob URLs not supported, falling back to default web worker support! ----"),ShouldLog(LogLevels.Warning)&&log(JSON.stringify(s)),r="js/parseWorker.js"}finally{window.helperWrapper=void 0,window.dateWrapper=void 0,window.parseWorkerWrapper=void 0,delete window.helperWrapper,delete window.dateWrapper,delete window.parseWorkerWrapper}return r}function u(){if(!M.worker){if(!window.Worker)return ShouldLog(LogLevels.Warning)&&log("---- WARNING: Running without WebWorker support! ----"),M.supportWebWorker=!1,void(M.worker=void 0);var e=s();try{M.worker=new Worker(e)}catch(r){if(18===r.code)try{M.worker=new Worker("js/parseWorker.js")}catch(n){t.reportError(n)}else t.reportError(r)}M.worker?(M.worker.onmessage=function(e){if(t.isString(e.data))return void log("Message from worker: ",e.data);log("Worker Finished: ",e.data.end-e.data.start,"ms");for(var r,n=-1,o=0;o<A.length;++o)A[o].id===e.data.id&&(r=A[o],n=o);try{t.PAssert(1377,r,"Must have a valid response handler")}catch(a){t.reportError(a)}try{t.PAssert(1378,r.id===e.data.id,"Respose handler should match request")}catch(a){t.reportError(a)}if(A.splice(n,1),e.data.styles)for(var o=0;o<e.data.styles.length;++o){var s=e.data.styles[o],c=i.getModel(r.items[o].id);if(c){var d={};c.styleText(s,!0,d)&&c.save(d,SaveFlag.None)}}e.data.done&&r.cb&&r.cb(),e.data.styles||e.data.done||log("Error in parse worker: ",e)},M.worker.onerror=function(e){log("Error in ParseWorker: ",e,e.message),t.reportError(new Error("Worker reported error"))}):M.supportWebWorker=!1}}function m(e,r){try{t.PAssert(1379,M.worker,"Worker must exist")}catch(n){t.reportError(n)}if(M.supportWebWorker){var o=I++;A.push({id:o,cb:r,items:e});var a={id:o,items:e};P||(a.contacts=i.getContacts(),P=!0),M.worker.postMessage(a)}}function g(e){t.isLoadingRemote=!0;try{i.beginTransaction(),t.timeline.startLoading();var r=t.settings.get(Settings.lastServerVersion),n=o.getServerVersion();r===n&&log("Client and Server Versions Match!"),t.startTimeEvent("PageLoad","RemoteData","Load Remote Data"),h.beginAction();var a=t.settings.get(Settings.localIntegrity);a===!1&&(ShouldLog(LogLevels.Warning)&&log("Previous remote sync had an issue!"),t.reportError(new Error("Previous remote sync had an issue!"))),o.loadSeen={},REPORT_ACTIONS&&i.reportData(DataSnapshot.Before),t.settings.set(Settings.localIntegrity,!1),M.root().initFromGDrive(e),t.settings.set(Settings.localIntegrity,!0),REPORT_ACTIONS&&i.reportData(DataSnapshot.After),o.loadSeen={},h.endAction(),M.flushParseItems(function(){for(var e=0;e<M.panes().length;e++)M.panes()[e].vmSearch.updateSearch(!0)}),M.flushModifiedItems(function(e){log("Flushing Modified: ",Object.keys(e).length)}),t.timeline.endLoading(),i.hasLocalData&&M.root().resetModified(),i.clearPendingUpdates(),t.endTimeEvent(),t.fireCustomEvent("remoteDataLoaded")}catch(s){t.reportError(s),t.messageQueue.pushMessage({text:"There was an error loading your data from the server, consider reloading the app.",type:MessageType.Error,action:MessageAction.Reload})}finally{i.endTransaction(),t.isLoadingRemote=!1,t.vmMain.isLoadingDoc(!1),t.StopSpinner()}}function w(){if(!p.mobile){var e=t.restoreSavedSelection("loadData");if(!e&&t.focusedPane&&!t.focusedPane.isTimeline()){var r=t.getFirstPaneItem(t.focusedPane);r&&t.setSelection(r.getSpan(),0,0)}}}var M={root:e.observable(void 0),panes:e.observableArray(),height:e.observable(0),isHelpShowing:e.observable(!1),isLoaded:!1,numCols:e.observable(),hasResized:e.observable(!1),isSidebarOpen:!1,helpButtonHidden:e.observable(!1),gdriveStatus:e.observable(-1),main:void 0,mainTransform:0,isPhone:p.phone,outline:void 0,vmSettings:new v(this),supportWebWorker:!0,swipingScreens:!1,swipeDirection:0,lastSwipeMove:0,lastSwipeMoveTime:0,vmPicker:new y,vmHelp:new T,selected:e.observableArray(),help:void 0};p.mobile&&(M.elPhoneMenu=t.element("phoneMenu")),t.vmSettings=M.vmSettings,M.isOnline=function(){return M.gdriveStatus()!==DriveStatus.Offline},M.isLocal=function(){return"localhost"==window.location.hostname},M.onlineText=function(){if(M.isDemoMode())return"DEMO";switch(M.gdriveStatus()){case DriveStatus.Connecting:return"CONNECTING";case DriveStatus.Offline:return"OFFLINE";case DriveStatus.Saving:case DriveStatus.Saved:return"ONLINE";case DriveStatus.Reconnecting:return"RETRYING"}},d(M);var x=0;M.maxWidth=e.computed({read:function(){if(M.isPhone)return p.windowWidth()+"px";var e=800*M.panes().length+(M.isHelpShowing()?400:0);return e+"px"},deferEvaluation:!0}),M.needsPadTop=e.computed({read:function(){return M.isPhone?void 0:800*M.panes().length+(M.isHelpShowing()?400:0)+170>p.windowWidth()}}),M.pinButtons=e.computed({read:function(){return p.windowWidth()>800*M.panes().length},deferEvaluation:!0}),M.getUserName=e.computed({read:function(){var e=o.authenticatedUser();return e?e.displayName:M.gdriveStatus()===DriveStatus.Saved?"Connected":t.vmSetup.loginState()==LoginState.LOGGED_IN?"Connecting":"Demo"},deferEvaluation:!0}),M.getUserImage=function(){var e=o.authenticatedUser();return e?e.photoUrl:void 0},M.isDemoMode=function(){return t.isDemoMode()},window.addEventListener("scriptLoadError",function(e){M.handleScriptLoadError(e)}),M.handleScriptLoadError=function(e){"gapiScript"===e.data.id&&(log("Failed to load GAPI!"),M.setGDriveStatus(DriveStatus.Offline),M.failedGapiLoad=!0,setTimeout(a.goOnline,3e4))},M.setGDriveStatus=function(e){var r=M.gdriveStatus();e!==r&&e!==DriveStatus.Saving&&(M.gdriveStatus(e),e===DriveStatus.Offline?(t.goOffline(),p.mobile&&t.messageQueue.pushMessage(MessageID.MobileOffline)):r===DriveStatus.Offline&&(t.goOnline(),p.mobile&&t.messageQueue.clearMessage(MessageID.MobileOffline)))},M.init=function(){c.init()},M.onLoad=function(){if(p.isTouchDevice&&!p.app)for(var e=document.getElementsByClassName("paneOutline"),r=0;r<e.length;++r)e[r].addEventListener(p.touchStartEvent,function(e){return t.preventScrollPropagation(ele)?void 0:(e.preventDefault(),!1)});p.touch&&setTimeout(function(){t.ScreenManager.computeSnapPoints()}.bind(this),0)},M.addModifiedItem=function(){},M.flushModifiedItems=function(){};var C=[];M.addParseItem=function(e,t){M.addItemToArrayForWorker(e,t,C)},M.flushParseItems=function(e){try{t.PAssert(1371,e,"Callback required")}catch(r){t.reportError(r)}C.length>0&&!a.loadingContacts&&M.runParseWorker(C,e),C=[]},M.runParseWorkerNewContacts=function(){if(M.root()){var e=[];M.parseWorkerNewContactsHelper(M.root(),e),e.length>0&&M.runParseWorker(e)}},M.parseWorkerNewContactsHelper=function(e,r){try{t.PAssert(1372,e,"Must supply a valid item to parse")}catch(n){t.reportError(n)}var i=e.getRawText();i.indexOf(ContactPrefix)>=0&&r.push({id:e.id,text:e.getRawText(),isUpdate:!1,prevDate:e.getDateTime()});for(var o=e.items(),a=0;a<o.length;a++)M.parseWorkerNewContactsHelper(o[a],r)},M.addItemToArrayForWorker=function(e,t,r){r.push({id:e.id,text:e.getRawText(),isUpdate:!t&&e.isLoaded,prevDate:e.getDateTime()})},M.addChildrenToArrayForWorker=function(e,r,n){try{t.PAssert(1373,e,"Must supply a valid item to parse")}catch(i){t.reportError(i)}n.push({id:e.id,text:e.getRawText(),isUpdate:!r&&e.isLoaded,prevDate:e.getDateTime()});for(var o=e.items(),a=0;a<o.length;a++)M.addChildrenToArrayForWorker(o[a],r,n)};var I=0,A=[],P=!1;M.notifyContactsUpdated=function(){P=!1},M.runParseWorker=function(e,r){{var n;performance.now()}if(e&&e instanceof Array){try{t.PAssert(1380,e instanceof Array,"Inputs to runParseWorker must either be: undefined, single item or an array")}catch(o){t.reportError(o)}try{t.PAssert(1381,e.length>0,"Shouldnt run the parse worker with no items in the input array")}catch(o){t.reportError(o)}log("Running Parse Worker for Array: ",e.length),n=e}else{n=[];var a=e;e?log("Running Parse Worker for Item: ",e.id):(a=M.root(),log("Running Parse Worker for Root.")),a&&M.addChildrenToArrayForWorker(a,!1,n)}u(),M.supportWebWorker?(log("Parsing Items Async: ",n.length),m(n,r)):setTimeout(function(){log("Parsing Items Sync: ",n.length);for(var e=i.getContacts(),t=0;t<n.length;++t){var r=n[t],o=DuchessHelpers.parseText(r.text,r.prevDate,r.isUpdate,e),a=i.getModel(r.id);if(a){var s={};a.styleText(o,!0,s)&&a.save(s,SaveFlag.None)}}},0)},M.createPane=function(e,t){isNaN(e)&&(e=M.panes().length);var r=new f({id:x++,item:M.root(),mode:t});return M.addPane(r,e),M.setFocusedPane(r),r},M.removePane=function(e){for(var t=M.panes(),r=0;r<t.length;r++)if(e==t[r])return M.removePaneAtIndex(r),M.setFocusedPane(t[0]),r;return-1},M.removeFocusPane=function(){if(t.focusedPane&&M.panes().length>1){var e=M.removePane(t.focusedPane);h.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:e}),t.sendEvent("Hotkey","ClosePane"),t.tooltip.hideTip()}},M.paneCount=function(){return M.panes().length};var D=0;M.setupDateRollover=function(){var e=new Date,r=e.clone().addDays(1).clearTime();try{t.PAssert(1382,r>e,"Rollover time must be in the future")}catch(n){t.reportError(n)}try{t.PAssert(1383,r>D,"Rollover time must be after the last rollover")}catch(n){t.reportError(n)}return log("Next Rollover Time: ",r),setTimeout(function(){function e(){M.runParseWorker(),t.timeline.reloadTimelines(),log("-------------------------------")}try{t.PAssert(1384,M.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(r){t.reportError(r)}log("---- Running Date Rollover ----"),lastDateRollver=new Date;M.setupDateRollover();t.settings.get(Settings.syncContacts)?(a.loadedContacts=!1,a.loadContacts(e)):e()},r-e),r};var k=!1;M.notifyDriveDisconnect=function(){k=!1},M.loadGDriveData=function(){if(!k){k=!0,p.mobile||t.saveSelection("loadData");var e=o.rootItem;M.root().linkToGDrive(e);try{o.checkRemoteIntegrity()}catch(r){t.reportError(r)}var n=i.getRootItem();n.id!==e.id?i.modifyItemId(n.id,e.id,function(){var r=i.getModel(e.id);try{t.PAssert(1385,n.id===e.id,"IDs should have been modified in modifyItemId")}catch(o){t.reportError(o)}n.id=e.id,i.setRoot(e.id),r.forceModifiedItems=!0,g(e),i.hasLocalData||r.items.valueHasMutated(),w()
}):(g(e),w()),M.vmPicker.refreshFiles()}};var O=!1;M.loadData=function(){function e(e){var t="fake_"+e.replace(" ","");n.push({id:"contact_"+o++,name:e,isDemo:!0,emails:[{address:t+"@moo.do",primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}if(!O&&i.localDataLoaded()){if(O=!0,t.startTimeEvent("PageLoad","LocalData","Load Local Data"),M.root(new l(i.getRootItem())),t.checkpoint(Checkpoint.LocalDocLoad),t.endTimeEvent(),t.requireGDriveDataCallback&&M.loadGDriveData(),M.isDemoMode()){var n=[],o=0;e("Ramada"),e("Canyon Ranch"),e("Jim Joseph"),e("Miller Harris"),e("Bob Johnson"),e("Bill Wilson"),e("Emily Edwards"),e("Jane Johnson"),e("Mike Thomas"),e("Joe Lewis"),e("Grant"),e("Jay"),e("Honey Bear"),i.loadContacts(n,!0)}M.runParseWorker(void 0,function(){r.getURLParam("data");M.isDemoMode()&&(p.script&&t.vmSetup.runScript(r.getURLParam("script")),window.parent.postMessage("loaded","*"))}),M.afterLoaded(),t.startTimeEvent("PageLoad","ApplyBindings","Apply Bindings"),t.applyBindings(M,"container");for(var a=0;a<M.panes().length;a++)M.panes()[a].vmSearch.onUpdated.valueHasMutated();M.isLoaded=!0,document.getElementById("container").style.display="block",t.endTimeEvent()}},M.changeRoot=function(e){try{t.PAssert(1386,e,"Cannot use to reset root to undefined")}catch(r){t.reportError(r)}var n=!1,o=i.getModel(e);o||(o=new l(i.getItem(e)),n=!0);try{t.PAssert(1387,o,"Must have a new root VMLI at this point, otherwise failed creation")}catch(r){t.reportError(r)}if(o){M.root(o);for(var a=0;a<M.panes().length;a++)M.panes()[a].item(o),M.panes()[a].notifyOfZoom();n&&M.runParseWorker(void 0)}},M.resetScrollOffsets=function(){for(var e=0;e<M.panes().length;e++){var t=M.panes()[e];t.setScrollOffset(t.defaultOffset)}},M.helpMessage=function(){return p.mobile?"Welcome to Moo.do! If this is your first time here take a minute to orient yourself, otherwise your data will be here shortly.":"Welcome to Moo.do! If this is your first time here take a minute to orient yourself and import your data, otherwise your data will be here shortly. You can access the introduction at a later time through the top-right menu."},M.onTapMain={onClick:function(){M.isDemoMode()&&p.script&&window.parent.postMessage("click","*")}},M.addPane=function(e,r){try{t.PAssert(1388,e,"Must pass in a valid pane to update")}catch(n){t.reportError(n)}var i=t.settings.get(Settings.paneState);i||(i=[]);try{t.PAssert(1389,i.length===M.panes().length,"Pane state does not match currently loaded pane set")}catch(n){t.reportError(n)}void 0===r?M.panes.push(e):M.panes.splice(r,0,e),i.push({id:e.id,focus:e.item().id,mode:e.mode(),showarch:e.showArchived(),search:e.vmSearch.search(),offset:0}),t.settings.set(Settings.paneState,i)},M.removePaneAtIndex=function(e){try{t.PAssert(1390,void 0!==e,"Must pass in a valid index to remove")}catch(r){t.reportError(r)}var n=t.settings.get(Settings.paneState);try{t.PAssert(1391,n,"Pane state should always be valid when removing panes")}catch(r){t.reportError(r)}try{t.PAssert(1392,n.length===M.panes().length,"Pane state does not match currently loaded pane set")}catch(r){t.reportError(r)}M.panes.splice(e,1),n.splice(e,1),t.settings.set(Settings.paneState,n)},M.afterLoaded=function(){var e;if(M.isDemoMode()?M.clearPaneState():e=t.settings.get(Settings.paneState),e){for(var r=0;r<e.length&&!(p.mobile&&r>0);++r){var n=e[r];n.id=x;var o=i.getModel(n.focus);o||(o=M.root(),n.focus=o.id,n.offset=0,n.search="");try{t.PAssert(1393,o,"Should always have a valid item at this point")}catch(a){t.reportError(a)}var s=new f({id:x++,item:o,mode:n.mode,search:n.search,offset:n.offset});n.showarch&&s.showArchived(!0),M.panes.push(s),M.setFocusedPane(s,!0),M.zoomin(o,!0)}1!==M.panes().length&&M.setFocusedPane(M.panes()[0],!0)}if(M.isDemoMode()&&t.demoPanes){for(var r=0;r<t.demoPanes.length;r++)M.addPane(new f({id:x++,item:M.root(),mode:+t.demoPanes[r]}));var s=M.panes()[0];t.focusedPaneID=s.id,t.focusedPane=s,t.focusedItem=s.item(),M.zoomin(s.item(),!0)}else if(0===M.panes().length){var s=new f({id:x++,item:M.root()});if(M.addPane(s),!p.mobile&&t.activeDisplayMode&DisplayMode.ForceTwoPane){var c=new f({id:x++,item:M.root(),mode:PaneMode.Timeline});M.addPane(c)}t.focusedPaneID=s.id,t.focusedPane=s,t.focusedItem=M.root(),M.zoomin(M.root(),!0)}p.mobile&&(t.phoneMenu=new b,t.keyboardToolbar=new S),t.timeline.updateNotifications()},M.clearPaneState=function(){t.settings.reset(Settings.paneState)},M.updatePaneState=function(e){if(!t.isRunningScript()&&!p.mobile){try{t.PAssert(1395,e,"Must pass in a valid pane to update")}catch(r){t.reportError(r)}var n=t.settings.get(Settings.paneState);try{t.PAssert(1396,n,"Pane state should always be valid when updating state")}catch(r){t.reportError(r)}try{t.PAssert(1397,n.length===M.panes().length,"Pane state does not match currently loaded pane set")}catch(r){t.reportError(r)}for(var i=!1,o=0;o<n.length;++o){var a=n[o];if(a.id===e.id){a.focus=e.item().id,a.mode=e.mode(),a.showarch=e.showArchived(),a.search=e.vmSearch.search(),t.settings.set(Settings.paneState,n),i=!0;break}}try{t.PAssert(1398,i,"Pane state should always be found")}catch(r){t.reportError(r)}}},M.updatePaneScrollState=function(){if(!t.isRunningScript()&&!p.mobile){var e=t.settings.get(Settings.paneState);if(e&&M.panes().length>0){try{t.PAssert(1399,e.length===M.panes().length,"Pane state does not match currently loaded pane set")}catch(r){t.reportError(r)}for(var n=0;n<e.length;++n){var i=e[n],o=M.panes()[n];i.offset=o?o.getScrollOffset():0}t.settings.set(Settings.paneState,e)}}};var L;M.getFirstSelectedItem=function(){try{t.PAssert(1401,p.mobile,"Selection tracking only available from mobile")}catch(e){t.reportError(e)}return M.selected().length>0?M.selected()[0]:void 0},M.setSelected=function(e){try{t.PAssert(1402,p.mobile,"Selection tracking only available from mobile")}catch(r){t.reportError(r)}e=e||[],M._clearIsSelected(e);for(var n=0;n<e.length;n++)e[n].isSelected(!0);M.selected(e)},M._clearIsSelected=function(e){try{t.PAssert(1403,p.mobile,"Selection tracking only available from mobile")}catch(r){t.reportError(r)}e=e||[];for(var n=0;n<M.selected().length;n++){var i=M.selected()[n];e.indexOf(i)<0&&i.isSelected(!1)}},M.clearSelected=function(e){try{t.PAssert(1404,p.mobile,"Selection tracking only available from mobile")}catch(r){t.reportError(r)}M._clearIsSelected(e),M.selected([])},p.mobile&&(document.onselectionchange=function(){var r,i=t.getSelectionInfo(),o=!0;if(t.ignoreSelectionChange)return t.ignoreSelectionChange=!1,void(L=void 0);if(i){if(p.android&&t.dragging)return void t.clearSelection();var a=i.selection.getRangeAt(0);if(o=!L||a.startContainer!==L.startContainer||a.endContainer!==L.endContainer,L&&!o&&a.startOffset==L.startOffset&&a.endOffset==L.endOffset)return;if("itemOptions"===a.startContainer.id||"fullscreenClickGrabber"===a.startContainer.id)return;if(L=a,t.focusedPane&&t.focusedPane.mode()===PaneMode.Normal){var s=t.getLIParent(a.startContainer),c=s?e.dataFor(s):void 0,d=!c||!c instanceof f&&!c instanceof l;if(d);else{t.restrictSelectionToText(),i=t.getSelectionInfo(),a=i.selection.getRangeAt(0);var u=t.getLIParent(a.startContainer),h=t.getLIParent(a.endContainer);if(u&&h&&!t.hasClass(u,"emptyPaneItem")&&!t.hasClass(h,"emptyPaneItem")){var m=e.dataFor(u);if(o)if(u!==h){var g=e.dataFor(h);r=t.getItemsBetween(m,g,t.focusedPane)}else r=[m],n.isEnabled()&&n.updateInput(m)}}}}else(p.android||p.mobileie||p.ios&&(!p.app||p.ipad))&&t.fireCustomEvent("closeKeyboard");i||(L=void 0),!o||p.android||p.mobileie||M.setSelected(r)}),M.setFocusedPaneFromElement=function(r){if(r){var n=t.hasClass(r,"paneRoot")?r:t.getPaneForElement(r).rootElement,i=e.dataFor(n);try{t.PAssert(1405,i,"Could not find matching pane")}catch(o){t.reportError(o)}M.setFocusedPane(i)}};var R=!1;M.setFocusedPane=function(e,r){e&&t.focusedPaneID!==e.id&&(R=!r,t.focusedPaneID=e.id,t.focusedPane=e,t.focusedItem=t.focusedPane.item())},M.zoomin=function(e,r){try{t.PAssert(1406,e,"Must supply a valid item to zoom to")}catch(n){t.reportError(n)}var i=t.focusedItem;M._zoom(e,r);var o=t.focusedPane;r||t.sendEvent("Menu","ZoomIn"),!p.mobile&&o.paneContent&&t.setSelection(o.paneContent,0,0),o.rootElement?o.setScrollOffset():setTimeout(function(){o.setScrollOffset()},0),e.isCollapsed()&&e.toggleCollapsed(),r||h.performAction(TrackerType.Zoom,{itemID:e.id,oldItemID:i.id,zoomOut:!1,time:t.zoomTime})},M.zoomout=function(e,r){try{t.PAssert(1407,e,"Must supply a valid item to zoom to")}catch(n){t.reportError(n)}var i=t.focusedItem;M._zoom(e,!1),t.sendEvent("Menu","ZoomOut"),t.selectChildren(r,r.getParsedText().length,0),t.scrollToTop(r.getSpan(),0),h.performAction(TrackerType.Zoom,{itemID:e.id,oldItemID:i.id,zoomOut:!0,time:t.zoomTime})},M._zoom=function(e,r){try{t.PAssert(1408,e,"Must supply a valid item to zoom to")}catch(n){t.reportError(n)}var i=t.focusedItem;i&&i.id===e.id||(t.focusedPane.item(e),t.focusedPane.notifyOfZoom(),t.focusedItem=e,r||M.updatePaneState(t.focusedPane))},M.onMenuButtonClick=function(){M.isSidebarOpen?(M.closeSidebar(),t.sendEvent("Menu","CloseSidebar")):(M.openSidebar(),t.sendEvent("Menu","OpenSidebar"))},M.onHelpButtonClick=function(){this.showHelp(HelpMode.Normal),t.sendEvent("Menu","HelpMain")},M.onHelpMouseOver=function(){},M.onHelpMouseOut=function(){};var _=document.getElementById("cheatSheetContainer");M.openCheatSheet=function(){var e=document.getElementById("desktopHelpButton").getBoundingClientRect();_.style.top=e.bottom+5+"px",t.removeClass(_,"none")},M.closeCheatSheet=function(){t.addClass(_,"none")},M.closeSidebarEvent=function(e){return M.isSidebarOpen?(M.closeSidebar(),e.preventDefault(),!1):void 0},t.addCustomEventListener("keyEscape",M.closeSidebarEvent,200),M.openSidebar=function(){M.isSidebarOpen=!0,t.autocomplete&&t.autocomplete.hide(),t.tooltip.hideTip(),t.setTransform(t.element("container"),250,0),setTimeout(function(){t.element("main").addEventListener("mouseup",M.closeSidebarEvent)},0),h.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleSidebar,data:[{value:!0}]})},M.closeSidebar=function(){M.isSidebarOpen=!1,t.setTransform(t.element("container"),0,0),t.element("main").removeEventListener("mouseup",M.closeSidebarEvent),t.hideHighlightElement(),h.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleSidebar,data:[{value:!1}]})};var N=document.getElementById("fullscreenClickGrabber"),F=!1;M.handleFullscreenClick=function(e){F||(t.setupClick(N,void 0,{onRightClick:function(e){N.style.display="none";var r=document.elementFromPoint(e.clientX,e.clientY),n=t.getPaneForElement(r);n&&n.onTap.onRightClick({srcElement:r,pageX:e.x,pageY:e.y,preventDefault:function(){e.preventDefault()},stopPropagation:function(){e.stopPropagation()},stopImmediatePropagation:function(){e.stopImmediatePropagation()}}),N.style.display=""},onEnd:function(){M.cancelFullscreenClick(),e()}}),t.removeClass(N,"none"),F=!0)},M.cancelFullscreenClick=function(){F&&(t.addClass(N,"none"),t.menus.closeAllMenus(),F=!1)},M.applyFnToSelection=function(e,t){var r=t&&t.toggle||t===!0,n=t&&void 0!==t.value?t.value:!0;if(M.applyToSelection(function(t){r&&t[e]()!==n&&(r=!1),r||t[e](n)}),r){var i=i=t&&void 0!==t.emptyValue?t.emptyValue:!1;M.applyToSelection(function(t){t[e](i)})}},M.applyPriorityToSelection=function(e,t){t?M.applyFnToSelection("priority",{toggle:!0,value:e,emptyValue:VMLIFlag.None}):M.applyFnToSelection("priority",{value:e})},M.insertCharacter=function(e,r){var i;if(n.isEnabled()){i=n.getInputText();var o=i[n.getSelectionStart()-1];r&&" "!==o?n.insertText(n.getSelectionStart()," "+e):n.insertText(n.getSelectionStart(),e)}else{var a=t.getSelectionRange();if(a){var s=t.getItemForElement(a.startContainer);if(s){i=s.getRawText();var o=i[a.startOffset-1];r&&" "!==o&&t.fireKeyEvent(void 0,{normCode:KeyCode.Space}),t.fireKeyEvent(void 0,{normCode:e.charCodeAt(0)})}}}},M.applyToSelection=function(e,r){var n=r&&r.passExtraInfo,i=t.getSelectionInfo();if(!i||0===i.rangeCount)return!0;if(i.node&&t.hasClass(i.node,"search"))return!0;var o=t.getPaneForElement(i.node);if(!o)return!0;if(t.restrictSelectionToText(),i=t.getSelectionInfo(),!i||0===i.rangeCount)return!0;var a=i.selection.getRangeAt(0);if(t.hasClass(a.startContainer.parentNode,"timelineItemTime"))return!0;var s=t.getItemForElement(a.startContainer),c=t.getItemForElement(a.endContainer);if(void 0===s||void 0===c)return!0;h.beginAction(),0===a.endOffset&&s!==c&&(c=t.getPreviousItem(c,t.focusedPane));for(var d=t.getItemsBetween(s,c,t.focusedPane),l=M.panes(),u=l.length,p=0;p<d.length;++p){var m=n?e(d[p],p,d.length):e(d[p]);if(m===!1)break;for(var f=0;u>f;f++)l[f]!=t.focusedPane&&l[f].vmSearch.checkItem(d[p])}return h.endAction(),d.length};var V={over:void 0,wasPointer:!1};M.updateCursor=function(e){V&&V.over&&(e&&("A"===V.over.tagName||t.hasClass(V.over,"tag"))?(V.wasPointer=!0,V.over.style.cursor="pointer"):!e&&V.wasPointer&&(V.wasPointer=!1,V.over.style.cursor="text"))},p.touch||(M.mousemove=function(e){if(!t.disableMouseMove&&(e.pageX!==V.pageX||e.pageY!==V.pageY)){V.pageX=e.pageX,V.pageY=e.pageY;var r=e.srcElement||e.target;if(e.offsetX>=0&&e.offsetX<=18){var n=t.getLIParent(V.over),i=t.getLIParent(r);i&&t.addClass(i,"hoveredFormatter"),n&&n!==i&&t.removeClass(n,"hoveredFormatter")}else{var n=t.getLIParent(V.over);n&&t.removeClass(n,"hoveredFormatter")}e.ctrlKey&&("A"===r.tagName||t.hasClass(r,"tag"))?(V.wasPointer&&(V.over.style.cursor="text"),V.wasPointer=!0,r.style.cursor="pointer"):V.wasPointer&&(V.wasPointer=!1,V.over.style.cursor="text"),V.over=r}},t.element("container").addEventListener("mousemove",M.mousemove)),M.addPaneToRight=function(e){var t=M.panes().length,r=M.createPane(t,e);M.cancelFullscreenClick(),e===PaneMode.Normal&&r.vmSearch.focusBox(),h.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddPane,data:t})},M.onTapAddNormal=function(){M.addPaneToRight(PaneMode.Normal),t.sendEvent("Menu","AddPaneNormal")},M.onTapAddTimeline=function(){M.addPaneToRight(PaneMode.Timeline),t.sendEvent("Menu","AddPaneTimeline")},M.showSearchSeparator=function(){return!p.mobile||t.phoneMenu.showSearchSeparator()},M.onTapSettingsPhone={onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},M.isLoadingDoc=function(e){for(var r=0;r<M.panes().length;r++)e?t.addClass(M.panes()[r].paneContent,"loading"):t.removeClass(M.panes()[r].paneContent,"loading")},M.showHelp=function(e){if(!p.mobile){var r=e||HelpMode.Intro;this.help||(this.help=new E(r),this.helpButtonHidden(r===HelpMode.Intro)),this.isHelpShowing(!0),t.settings.set(Settings.helpPaneState,r)}},M.closeHelp=function(){M.isHelpShowing(!1),M.helpButtonHidden(!1),t.settings.set(Settings.helpPaneState,HelpMode.None)};var B=t.settings.get(Settings.helpPaneState)||HelpMode.None;return B===HelpMode.None||t.isDemoMode()||M.showHelp(B),M.init(),M};return M});var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){var t=e.document,r=function(){return e.URL||e.webkitURL||e},n=e.URL||e.webkitURL||e,i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,a=function(r){var n=t.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(n)},s=e.webkitRequestFileSystem,c=e.requestFileSystem||s||e.mozRequestFileSystem,d=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",u=0,h=[],p=function(){for(var e=h.length;e--;){var t=h[e];"string"==typeof t?n.revokeObjectURL(t):t.remove()}h.length=0},m=function(e,t,r){t=[].concat(t);for(var n=t.length;n--;){var i=e["on"+t[n]];if("function"==typeof i)try{i.call(e,r||e)}catch(o){d(o)}}},f=function(t,n){var d,p,f,g=this,v=t.type,y=!1,b=function(){var e=r().createObjectURL(t);return h.push(e),e},S=function(){m(g,"writestart progress write writeend".split(" "))},T=function(){(y||!d)&&(d=b(t)),p?p.location.href=d:window.open(d,"_blank"),g.readyState=g.DONE,S()},w=function(e){return function(){return g.readyState!==g.DONE?e.apply(this,arguments):void 0}},E={create:!0,exclusive:!1};return g.readyState=g.INIT,n||(n="download"),o?(d=b(t),i.href=d,i.download=n,a(i),g.readyState=g.DONE,void S()):(e.chrome&&v&&v!==l&&(f=t.slice||t.webkitSlice,t=f.call(t,0,t.size,l),y=!0),s&&"download"!==n&&(n+=".download"),(v===l||s)&&(p=e),c?(u+=t.size,void c(e.TEMPORARY,u,w(function(e){e.root.getDirectory("saved",E,w(function(e){var r=function(){e.getFile(n,E,w(function(e){e.createWriter(w(function(r){r.onwriteend=function(t){p.location.href=e.toURL(),h.push(e),g.readyState=g.DONE,m(g,"writeend",t)},r.onerror=function(){var e=r.error;e.code!==e.ABORT_ERR&&T()},"writestart progress write abort".split(" ").forEach(function(e){r["on"+e]=g["on"+e]}),r.write(t),g.abort=function(){r.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),T)}),T)};e.getFile(n,{create:!1},w(function(e){e.remove(),r()}),w(function(e){e.code===e.NOT_FOUND_ERR?r():T()}))}),T)}),T)):void T())},g=f.prototype,v=function(e,t){return new f(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,m(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,e.addEventListener("unload",p,!1),v}(self);define("FileSaver",function(){}),define("dimport",["globals","data","tracker","VMLI","parse","goog"],function(e,t,r,n,i,o){function a(){this.workflowy={login:this.workflowyLogin.bind(this),"import":this.workflowyImport.bind(this),save:this.workflowySave.bind(this)},this.wunderlist={login:this.wunderlistLogin.bind(this),"import":this.wunderlistImport.bind(this),save:this.wunderlistSave.bind(this)},this.opml={login:this.opmlLogin.bind(this),"import":this.opmlImport.bind(this),save:this.opmlSave.bind(this)},this.json={login:this.jsonLogin.bind(this),"import":this.jsonImport.bind(this),save:this.jsonSave.bind(this)},this.text={login:this.textLogin.bind(this),"import":this.textImport.bind(this),save:this.textSave.bind(this)},this.gtasks={login:this.gtasksLogin.bind(this),"import":this.gtasksImport.bind(this),save:this.gtasksSave.bind(this)},this.trello={login:this.trelloLogin.bind(this),"import":this.trelloImport.bind(this),save:this.trelloSave.bind(this)},this.toodledo={login:this.toodledoLogin.bind(this),"import":this.toodledoImport.bind(this),save:this.toodledoSave.bind(this)}}return a.prototype={workflowyLogin:function(t,r,n,i){try{e.PAssert(1409,n,"Workflowy requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1410,i,"Workflowy requires an error callback")}catch(o){e.reportError(o)}e.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/oauth/workflowy",data:{username:t,password:r},cb:function(e){log("Login Response: ",e),200===e.status?(this.workflowy.data=JSON.parse(e.response),n()):(log("XHR Status: "+e.status),i("Error contacting remote server."))}.bind(this)})},workflowyImport:function(t,r){try{e.PAssert(1411,t,"Workflowy requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1412,r,"Workflowy requires an error callback")}catch(n){e.reportError(n)}t(this.workflowy.data)},workflowyIterateItem:function(t,r){var i=673732,o=139527,a=139529,s=204343;try{e.PAssert(1413,t&&void 0!==t.lm&&void 0!==t.nm,"All items must exist and have flags and text, children and notes are optional",t)}catch(c){e.reportError(c)}try{e.PAssert(1414,t.lm===i||t.lm===o||t.lm===a||t.lm===s,"Unexpected lm value for workflowy import: "+t.lm)}catch(c){e.reportError(c)}try{e.PAssert(1415,r,"A valid parent must always be defined")}catch(c){e.reportError(c)}if(t&&r){var d=t.lm===i,l=new n({text:t.nm,isComplete:d},{parent:r,parse:!0,forceSave:!0});if(r.insertItem(l),t.no){var u=new n({text:t.no},{parent:l,parse:!0,forceSave:!0});l.insertItem(u)}if(t.ch)for(var h=0;h<t.ch.length;++h){var p=t.ch[h];this.workflowyIterateItem(p,l)}}},workflowySave:function(i,o,a){try{e.PAssert(1416,i,"Workflowy requires having valid data")}catch(s){e.reportError(s)}try{e.PAssert(1417,o,"Workflowy requires a success callback")}catch(s){e.reportError(s)}try{e.PAssert(1418,a,"Workflowy requires an error callback")}catch(s){e.reportError(s)}var c=i.projectTreeData.mainProjectTreeInfo;try{r.beginAction();var d=t.getRootModel();try{e.PAssert(1419,d,"Root item must exist in order to import")}catch(s){e.reportError(s)}var l=new n({text:"Workflowy Import:"},{parent:d,parse:!0,forceSave:!0});d.insertItem(l);for(var u=0;u<c.rootProjectChildren.length;++u){var h=c.rootProjectChildren[u];this.workflowyIterateItem(h,l)}e.vmMain.runParseWorker(l),r.endAction(),o()}catch(p){a(void 0,p)}},wunderlistLogin:function(t,r,n,i){try{e.PAssert(1420,n,"Wunderlist requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1421,i,"Wunderlist requires an error callback")}catch(o){e.reportError(o)}e.XHR({type:"POST",url:"https://api.wunderlist.com/login",data:{email:t,password:r},cb:function(e){if(log("Login Response: ",e),200===e.status){var t=JSON.parse(e.response);this.wunderlist.token=t.token,n(t)}else log("XHR Status: "+e.status),i("Error contacting remote server.")}.bind(this)})},wunderlistImport:function(t,r){try{e.PAssert(1422,t,"Wunderlist requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1423,r,"Wunderlist requires an error callback")}catch(n){e.reportError(n)}this.wunderlistGetLists(function(e){this.wunderlistGetTasks(function(r){for(var n={inbox:{title:"inbox",items:{},p:0}},i=0;i<e.length;++i){var o=e[i];n[o.id]={title:o.title,items:{},p:o.position}}for(var i=0;i<r.length;++i){var a=r[i];if(a.parent_id){var s=n[a.list_id].items[a.parent_id];s?(s.items||(s.items=[]),s.items.push(a)):n[a.list_id].items[a.parent_id]={items:[a]}}else{var c=n[a.list_id].items[a.id];n[a.list_id].items[a.id]=a,c&&(n[a.list_id].items[a.id].items=c.items)}}t(n)}.bind(this),r)}.bind(this),r)},wunderlistGetLists:function(t,r){try{e.PAssert(1424,t,"Wunderlist requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1425,r,"Wunderlist requires an error callback")}catch(n){e.reportError(n)}e.XHR({type:"GET",url:"https://api.wunderlist.com/me/lists",headers:{Authorization:this.wunderlist.token},cb:function(e){if(200===e.status){var n=JSON.parse(e.response);t(n)}else log("XHR Status: "+e.status),r("Error contacting remote server.")}.bind(this)})},wunderlistGetTasks:function(t,r){try{e.PAssert(1426,t,"Wunderlist requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1427,r,"Wunderlist requires an error callback")}catch(n){e.reportError(n)}e.XHR({type:"GET",url:"https://api.wunderlist.com/me/tasks",headers:{Authorization:this.wunderlist.token},cb:function(e){if(200===e.status){var n=JSON.parse(e.response);t(n)}else log("XHR Status: "+e.status),r("Error contacting remote server.")}.bind(this)})},wunderlistSave:function(i,o,a){try{e.PAssert(1428,o,"Wunderlist requires a success callback")}catch(s){e.reportError(s)}try{e.PAssert(1429,a,"Wunderlist requires an error callback")}catch(s){e.reportError(s)}try{r.beginAction();var c=t.getRootModel();try{e.PAssert(1430,c,"Root item must exist in order to import")}catch(s){e.reportError(s)}var d=new n({text:"Wunderlist Import:"},{parent:c,parse:!0,forceSave:!0});c.insertItem(d);for(var l in i){var u=i[l],h=u.title+(":"!==u.title[u.title.length-1]?":":""),p=new n({text:h},{parent:d,parse:!0,forceSave:!0});d.insertItem(p);for(var m in u.items){var f=u.items[m],g=new n({text:f.title,isComplete:!!f.completed_at,dateCompleted:f.completed_at,isFlagged:f.starred},{parent:p,parse:!0,forceSave:!0});if(p.insertItem(g),f.note){var v=new n({text:f.note},{parent:g,parse:!0,forceSave:!0});g.insertItem(v)}if(f.items)for(var y=0;y<f.items.length;++y){var b=f.items[y],S=new n({text:b.title,isComplete:!!b.completed_at,dateCompleted:b.completed_at,isFlagged:b.starred},{parent:g,parse:!0,forceSave:!0});g.insertItem(S)}}}e.vmMain.runParseWorker(d),r.endAction(),o()}catch(T){a(void 0,T)}},opmlLogin:function(t,r,n,i){try{e.PAssert(1431,n,"OPML requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1432,i,"OPML requires an error callback")}catch(o){e.reportError(o)}n()},opmlImport:function(t,r){try{e.PAssert(1433,t,"OPML requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1434,r,"OPML requires an error callback")}catch(n){e.reportError(n)}try{var o=new FileReader,a=document.forms.importFileUpload.importFile.files[0];a?(o.onload=function(n){var o,s=n.target.result;if((s.startsWith("<?xml ")||s.startsWith("<opml "))&&(o=e.loadXML(s)),o){var c=i.parseOPML(o,a.name);c?t():r("Error parsing OPML, please validate your data")}else r("Unable to load XML lib, please update or try another browser")},o.onerror=r,o.readAsText(a)):r("You must select a file before importing")}catch(s){r(void 0,s)}},opmlSave:function(t,r,n){try{e.PAssert(1435,r,"OPML requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1436,n,"OPML requires an error callback")}catch(i){e.reportError(i)}log("OPML Save: ",t),r()},jsonLogin:function(t,r,n,i){try{e.PAssert(1437,n,"OPML requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1438,i,"OPML requires an error callback")}catch(o){e.reportError(o)}n()},jsonImport:function(e,t){try{var r=new FileReader,n=document.forms.importFileUpload.importFile.files[0];n?(r.onload=function(r){var n=r.target.result;if(n)try{var o=JSON.parse(n),a=i.parseJSON(o);a?e():t("Error parsing JSON, please validate your data")}catch(s){t(void 0,s)}else t("Unable to import your requested file, please try agani")},r.onerror=t,r.readAsText(n)):t("You must select a file before importing")}catch(o){t(void 0,o)}},jsonSave:function(t,r,n){try{e.PAssert(1439,r,"OPML requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1440,n,"OPML requires an error callback")}catch(i){e.reportError(i)}log("JSON Save: ",t),r()},textLogin:function(t,r,n,i){try{e.PAssert(1441,n,"OPML requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1442,i,"OPML requires an error callback")}catch(o){e.reportError(o)}n()},textImport:function(t,r){var n,o=document.getElementById("importFileDataBox").textContent;if(o.startsWith("<?xml ")||o.startsWith("<opml "))try{if(n=e.loadXML(o)){var a=i.parseOPML(n,fileImport.name);if(a)return void t()}}catch(s){}if(o.startsWith("{")&&o.endsWith("}"))try{var c=JSON.parse(o),a=i.parseJSON(c);if(a)return void t()}catch(s){}r("Text Import Not Supported")},textSave:function(t,r,n){try{e.PAssert(1443,r,"OPML requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1444,n,"OPML requires an error callback")}catch(i){e.reportError(i)}log("Text Save: ",t),r()},gtasksLogin:function(t,r,n,i){try{e.PAssert(1445,n,"GTasks requires a success callback")}catch(a){e.reportError(a)}try{e.PAssert(1446,i,"GTasks requires an error callback")}catch(a){e.reportError(a)}o.runAuthenticate([GScope.TasksRO],!1,!1,function(e){e&&!e.error?(this.gtasks.token=e,n(e)):i("Unable to authenticate with Google, please try again",e)}.bind(this))},gtasksImport:function(t,r){try{e.PAssert(1447,t,"GTasks requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1448,r,"GTasks requires an error callback")}catch(n){e.reportError(n)}var i={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(function(n){try{e.PAssert(1449,e.isArray(n),"List data must be an array")}catch(o){e.reportError(o)}for(var a=0;a<n.length;++a){var s=n[a];i.remoteItems[s.id]={id:s.id,text:s.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},i.roots.push(s.id),this.gtasksGetTasks(s,function(r){try{e.PAssert(1450,e.isArray(r),"List data must be an array")}catch(n){e.reportError(n)}for(var o=0;o<r.length;++o){var a=r[o];i.remoteItems[a.id]={id:a.id,text:a.title,isComplete:"completed"===a.status,dateCompleted:a.completed?new Date(a.completed):void 0,isArchived:a.hidden,due:a.due?new Date(a.due):void 0,notes:a.notes,parent:a.parent||s.id,items:[]};var c=i.remoteItems[a.parent||s.id];c?c.items.push(a.id):i.unassigned.push(a.id)}t(i)}.bind(this),r)}}.bind(this),r)},gtasksGetLists:function(t,r){try{e.PAssert(1451,t,"GTasks requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1452,r,"GTasks requires an error callback")}catch(n){e.reportError(n)}var i=2e3;e.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults="+i+"&key="+window.gapiKey+"&access_token="+o.getAccessToken(),cb:function(n){if(200===n.status){var i=JSON.parse(n.response);try{e.PAssert(1453,i.items,"Must have a valid array of lists")}catch(o){e.reportError(o)}t(i.items)}else log("XHR Status: "+n.status),r("Error contacting remote server.")}.bind(this)})},gtasksGetTasks:function(t,r,n){try{e.PAssert(1454,t,"GTasks requires a valid list to get tasks from")}catch(i){e.reportError(i)}try{e.PAssert(1455,r,"GTasks requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1456,n,"GTasks requires an error callback")}catch(i){e.reportError(i)}var a=5e3;e.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/lists/"+t.id+"/tasks?maxResults="+a+"&key="+window.gapiKey+"&access_token="+o.getAccessToken(),cb:function(t){if(200===t.status){var i=JSON.parse(t.response);try{e.PAssert(1457,i.items,"Must have a valid array of tasks")}catch(o){e.reportError(o)}r(i.items)}else log("XHR Status: "+t.status),n("Error contacting remote server.")}.bind(this)})},gtasksSave:function(i,o,a){function s(e,t){var r=e.text;e.due&&(r+=" "+e.due.toString("MM/dd h:mm"));var o=new n({text:r,isComplete:e.isComplete,dateCompleted:e.dateCompleted?e.dateCompleted.getTime():e.dateCompleted,isArchived:e.isArchived},{parent:t,parse:!0,forceSave:!0});if(t.insertItem(o),e.notes){var a=new n({text:e.notes},{parent:o,parse:!0,forceSave:!0});o.insertItem(a)}for(var c=0;c<e.items.length;++c)s(i.remoteItems[e.items[c]],o)}try{e.PAssert(1458,o,"GTasks requires a success callback")}catch(c){e.reportError(c)}try{e.PAssert(1459,a,"GTasks requires an error callback")}catch(c){e.reportError(c)}try{try{e.PAssert(1460,0===i.unassigned.length,"We should never have unassigned tasks")}catch(c){e.reportError(c)}r.beginAction();var d=t.getRootModel();try{e.PAssert(1461,d,"Root item must exist in order to import")}catch(c){e.reportError(c)}var l=new n({text:"Google Tasks Import:"},{parent:d,parse:!0,forceSave:!0});d.insertItem(l);for(var u=0;u<i.roots.length;++u)s(i.remoteItems[i.roots[u]],l);e.vmMain.runParseWorker(l),r.endAction(),o()}catch(h){a(void 0,h)}},trelloLogin:function(t,r,n,i){function o(){Trello.members("me",function(){},i)}function a(){i()}var s="667ecf0c3d3e029c51d205b7173f6c38";e.addScript("http://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",function(){e.addScript("https://api.trello.com/1/client.js?key="+s,"trelloScript",function(){try{e.PAssert(1462,Trello,"The Trello client lib musthave been loaded correctly")}catch(t){e.reportError(t)}Trello.authorize({type:"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:o,error:a})}.bind(this))}.bind(this))},trelloImport:function(){},trelloSave:function(){},toodledoLogin:function(e,t,r,n){var i="DuchessToodledoClientID",o="Dchs"+(new Date).getTime(),a="https://api.toodledo.com/3/account/authorize.php?response_type=code&client_id="+i+"&state="+o+"&scope=basic%20tasks%20notes%20outlines%20lists",s=(window.open(a,"toodledo","height=600,width=550"),function(e){var t=e.origin===location.origin;t&&(window.removeEventListener("message",s),e.data.error?n(e.data.error):(this.toodledo.token=e.data.access_token,r()))}.bind(this));window.addEventListener("message",s)},toodledoImport:function(){},toodledoSave:function(){}},a}),define("VMDebug",["ko","globals","platform","data","FileSaver","goog","dimport"],function(e,t,r,n,i,o,a){function s(){this.bugDescription=e.observable(""),this.mode=e.observable("html"),this.exportedContent="",this.exportedPreview=e.observable(""),this.exportArchived=e.observable(!0),this.importName=e.observable("JSON"),this.importDisplayMessage=e.observable(""),this.importing=!1,this.importer=new a,this.init()}return s.prototype={init:function(){this.exportArchived.subscribe(this.exportData.bind(this)),t.menus.registerModal("reportBug",this,this.reportBug),t.menus.registerModal("importData",this),t.menus.registerModal("exportData",this,this.openExport.bind(this),this.closeExport.bind(this))
},reportBug:function(){setTimeout(function(){document.getElementById("bugDescription").focus()})},onTapSaveBug:function(){var e={};t.getAppInfo(e);var r=this.bugDescription()+"\r\n\r\n\r\n"+JSON.stringify(e,void 0,3),n=this.bugDescription().indexOf("\n"),i=this.bugDescription().substr(0,n>=0?n:Math.min(this.bugDescription().length,120)),o={name:i,notes:r};o.email=t.getUserIdentifier();var a=function(){t.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/debug/reportIssue",data:o,cb:function(e){log("XHR Response: ",e),this.bugDescription("")}.bind(this)})}.bind(this);"Unknown"!==o.email?a():t.getClientInfo(function(e){e&&(o.email=e.ip),a()}),t.menus.closeModal("reportBug"),t.messageQueue.pushMessage({text:"Thanks for taking the time to send us feedback!",type:MessageType.Info,action:MessageAction.Default,timeout:1500}),t.blurActiveElement(),t.vmMain.clearSelected()},onTapCancelBug:function(){t.menus.closeModal("reportBug"),t.blurActiveElement(),t.vmMain.clearSelected()},openExport:function(){this.exportData(),this.exportKeyHandler=this.onExportKeydown.bind(this),document.addEventListener("keydown",this.exportKeyHandler,!0)},closeExport:function(){document.removeEventListener("keydown",this.exportKeyHandler,!0),this.exportKeyHandler=void 0},onTapCloseExport:function(){t.menus.closeModal("exportData")},exportData:function(){var e,t,r=n.getRootItem();if("html"==this.mode())e=n.toHtml(r,this.exportArchived()),t=e;else if("plain"==this.mode()){var i="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";e=n.toPlainText(r,0,this.exportArchived()),t=e.replace(/\n/g,"<br>").replace(/\t/g,i)}else"json"==this.mode()&&(e=n.toJSON(r,!1,this.exportArchived()),t=e);this.exportedContent=e,this.exportedPreview(t)},onTapHTML:function(e){this.mode("html"),this.exportData(),this.highlightExportButton(e)},onTapPlain:function(e){this.mode("plain"),this.exportData(),this.highlightExportButton(e)},onTapJSON:function(e){this.mode("json"),this.exportData(),this.highlightExportButton(e)},highlightExportButton:function(e){e.srcElement||(e.srcElement=e.target);var r=document.getElementById("exportTypes");if(r)for(var n=0;n<r.children.length;++n){var i=r.children[n];t.hasClass(i,"button")&&(i!==e.srcElement?t.removeClass(i,"bSelected"):t.addClass(i,"bSelected"))}},onTapOpen:function(){var e="plain"==this.mode()?this.exportedPreview():this.exportedContent,t=open("url");t.document.write(e)},onTapSelect:function(){var e=document.createRange();e.selectNodeContents(document.getElementById("exportedContent"));var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},onTapSaveExport:function(){var e;"html"==this.mode()?e="html":"plain"==this.mode()?e="txt":"json"==this.mode()&&(e="json");try{var r=new Blob([this.exportedContent],{type:"text/plain;charset=utf-8"});saveAs(r,"moodo."+e)}catch(n){t.reportError(n)}},onExportKeydown:function(e){return r.normalizeKeys(e),(r.mac&&e.metaKey||!r.mac&&e.ctrlKey)&&e.normCode===KeyCode.A?(this.onTapSelect(),e.preventDefault(),e.stopPropagation(),!1):void 0},closeImport:function(){t.menus.closeModal("importData")},isAreaVisible:function(e){switch(this.importName()){case"Wunderlist":return"LoginArea"===e;case"Workflowy":return"LoginArea"===e;case"OPML":return"UploadArea"===e;case"JSON":return"UploadArea"===e;case"Text":return"TextArea"===e;case"Google Tasks":return"OAuthArea"===e;case"Trello":return"LoginArea"===e;case"Toodledo":return"OAuthArea"===e;default:try{t.PAssert(1463,!1,"Must add valid importer")}catch(r){t.reportError(r)}}return!1},highlightImportButton:function(e){e.srcElement||(e.srcElement=e.target);var r=document.getElementById("importLocations");if(r)for(var n=0;n<r.children.length;++n){var i=r.children[n];i!==e.srcElement?t.removeClass(i,"bSelected"):t.addClass(i,"bSelected")}},onTapRunImportWunderlist:function(e){this.importName("Wunderlist"),this.highlightImportButton(e)},onTapRunImportWorkflowy:function(e){this.importName("Workflowy"),this.highlightImportButton(e)},onTapRunImportOPML:function(e){this.importName("OPML"),this.highlightImportButton(e)},onTapRunImportJSON:function(e){this.importName("JSON"),this.highlightImportButton(e)},onTapRunImportText:function(e){this.importName("Text"),this.highlightImportButton(e)},onTapRunImportGTasks:function(e){this.importName("Google Tasks"),this.highlightImportButton(e)},onTapRunImportTrello:function(e){this.importName("Trello"),this.highlightImportButton(e)},onTapRunImportToodledo:function(e){this.importName("Toodledo"),this.highlightImportButton(e)},onTapRunImport:function(){if(!this.importing){var e=function(e,r){try{var n=e;n&&t.isString(n)||(n="There was an unexpected error, please double check your data"),this.importing=!1,this.importDisplayMessage(n),t.reportError(r||e,e)}catch(i){t.reportError(i)}}.bind(this),r=document.getElementById("importEmail").value,n=document.getElementById("importPW").value,i=void 0;switch(this.importName()){case"Wunderlist":i=this.importer.wunderlist;break;case"Workflowy":i=this.importer.workflowy;break;case"OPML":i=this.importer.opml;break;case"JSON":i=this.importer.json;break;case"Text":i=this.importer.text;break;case"Google Tasks":i=this.importer.gtasks;break;case"Trello":i=this.importer.trello;break;case"Toodledo":i=this.importer.toodledo;break;default:try{t.PAssert(1464,!1,"Must add valid importer")}catch(o){t.reportError(o)}}i&&(this.importing=!0,i.login(r,n,function(){i.import(function(r){i.save(r,function(){this.importDisplayMessage("Your data was imported successfully!"),this.importing=!1,setTimeout(function(){t.menus.closeModal("importData")}.bind(this),2e3)}.bind(this),e)}.bind(this),e)}.bind(this),e))}},importTitle:function(){var e=this.importName();return"OPML"!==e&&"JSON"!==e&&"Text"!==e?"Importing data from "+this.importName():"Upload "+e+" File"},importMessage:function(){return this.importDisplayMessage()}},s}),define("VMTimeline",["ko","globals","platform","data"],function(e,t,r){function n(){this.itemsToSchedule={},this.scheduleTimeout=0}return n.prototype={shouldNotify:function(e,t){return t||(t=new Date),!e.isComplete()&&e.date()&&e.date()>t&&!e.allDayDate&&!e.isArchived()},updateNotifications:function(e){if((r.ios||r.android)&&r.app&&!t.isDemoMode()&&t.vmSettings.enabledNotifications()){var n=0,i=new Date;if(e)this.shouldNotify(e,i)&&(this.itemsToSchedule[e.id]=e,n=1);else{var o=this;t.searchVMLIs({item:t.vmMain.root(),includeArchived:!1,comparator:function(e){return o.shouldNotify(e,i)},action:function(e){n++,o.itemsToSchedule[e.id]=e}})}this.scheduleTimeout&&clearTimeout(this.scheduleTimeout),n>0&&(this.scheduleTimeout=setTimeout(this.sendNotifications.bind(this),500))}},clearNotifications:function(){r.sendToApp("scheduledItems","[]")},sendNotifications:function(){var e="[",t=!0;for(var n in this.itemsToSchedule)if(this.itemsToSchedule.hasOwnProperty(n)){var i=this.itemsToSchedule[n];i.date()&&(t||(e+=","),e+=i.getBasicJSON(),t=!1)}e+="]",r.sendToApp("scheduledItems",e),this.itemsToSchedule={}},notifyPositionChanged:function(e){for(var r=0;r<t.vmMain.panes().length;++r)t.vmMain.panes()[r].notifyPositionChanged(e)},notifyStateChanged:function(e,r){if(e.date()&&r==PropChangeType.Date)this.dateUpdated(e);else for(var n=0;n<t.vmMain.panes().length;++n)t.vmMain.panes()[n].notifyStateChanged(e,r)},dateUpdated:function(e){t.vmMain.root()&&this.updateNotifications(e);for(var r=0;r<t.vmMain.panes().length;r++)t.vmMain.panes()[r].notifyStateChanged(e,PropChangeType.Date)},reloadTimelines:function(){for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].reloadTimeline()},load:function(){},startLoading:function(){for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].startLoading()},endLoading:function(){for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].endLoading()}},n}),define("VMMessage",["ko","globals","util","data"],function(e,t,r,n){function i(e,t){this.id=e.id,this.owner=t,this.text=e.text,this.type=e.type||MessageType.Info,this.action=e.action||MessageAction.Default,this.block=e.block||!1,this.bottom=e.bottom||!1,this.onCloseFn=e.onClose,this.timeout=e.timeout,this.clearTimeout=void 0,this._isVisible=!1}return i.prototype={show:function(){this._isVisible||(this._isVisible=!0,this.timeout&&(this.clearTimeout=setTimeout(this.hide.bind(this),this.timeout)),this.block&&t.removeClass(document.getElementById("overlayBlocker"),"none"),this.owner.onMessageShow(this))},hide:function(e){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),e||this.owner.onMessageHide(this))},isVisible:function(){return this._isVisible},getClass:function(){var e;switch(this.type){case MessageType.Info:e="messageInfo";break;case MessageType.Intro:e="messageIntro";break;case MessageType.Warning:e="messageWarning";break;case MessageType.Error:e="messageError";break;case MessageType.Fatal:e="messageFatal";break;case MessageType.Subtitle:e="messageSubtitle";break;case MessageType.RequiredUpdate:e="messageRequiredUpdate";break;case MessageType.InfoGray:e="messageInfoGray";break;case MessageType.MobileOffline:e="messageMobileOffline";break;default:try{t.PAssert(1466,!1,"Invalid message type, add to globals.js")}catch(r){t.reportError(r)}e="messageInfo"}return this.bottom&&(e+=" bottom"),e},doAction:function(e){if(this.isVisible()){if(t.isFunction(this.action))this.action();else switch(this.action){case MessageAction.Default:this.hide();break;case MessageAction.Reload:t.reload(),this.hide();break;case MessageAction.Login:r.removeURLParam("demo"),this.hide();break;case MessageAction.Demo:r.insertURLParam("demo","true"),this.hide();break;case MessageAction.ResetClient:n.clearData(function(){t.reload()}),this.hide();break;case MessageAction.None:break;default:try{t.PAssert(1467,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(i){t.reportError(i)}this.hide()}e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0}},onTapIgnore:{onStart:t.handlerPreventStop,onClick:function(e){this.isVisible()&&(this.hide(),e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0)}}},i}),define("VMMessageQueue",["ko","globals","util","platform","data","VMMessage"],function(e,t,r,n,i,o){function a(){this.queue=e.observableArray(),this.remoteMessages={},this.defaultMessages=[],this.defaultMessages[MessageID.Undefined]=void 0,this.hasConnectionError=!1,this.hasFatalError=!1,this.hasDocChange=!1,this.hasOfflineWarning=!1,this.hasOnlineInfo=!1,this.hasCacheReset=!1,this.hasRequiredUpdate=!1,this.currentFilter=0,this.FilterType={Mobile:1,Desktop:2,App:4},this.init()}return a.prototype={init:function(){t.applyBindings(this,"overlayArea"),n.demo||n.offline||setTimeout(this.updateRemoteMessages.bind(this),5e3),this.computeFilter()},getMessageById:function(e){void 0===this.defaultMessages[e]&&this.initMessageByid(e);try{t.PAssert(1468,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(r){t.reportError(r)}return this.defaultMessages[e]},testMessageById:function(e){return!!this.defaultMessages[e]},initMessageByid:function(e){switch(e){case MessageID.ConnectionError:this.defaultMessages[e]=new o({text:"Connection error detected, "+n.actionVerb()+" here to reconnect.",type:MessageType.Error,action:MessageAction.Reload},this);break;case MessageID.OfflineUndo:this.defaultMessages[e]=new o({text:"Offline undo/redo has been disabled temporarily",type:MessageType.Info},this);break;case MessageID.DriveError:this.defaultMessages[e]=new o({text:"There was an error connecting to Google Drive. Moo.do will reconnect automatically when Google Drive is available.",type:MessageType.Error,action:MessageAction.None},this);break;case MessageID.FatalError:this.defaultMessages[e]=new o({text:"There was a fatal error in the application, "+n.actionVerb()+" here to restart.",type:MessageType.Error,action:MessageAction.Reload},this);break;case MessageID.DocChange:this.defaultMessages[e]=new o({text:"The active document was changed in another tab, "+n.actionVerb()+" here to restart.",type:MessageType.Fatal,action:MessageAction.Reload,block:!0},this);break;case MessageID.OfflineWarn:this.defaultMessages[e]=new o({text:"You are offline and not saving your changes locally or remotely, you must reconnect before closing the window or you will lose your changes.",type:MessageType.Warning},this);break;case MessageID.OnlineInfo:this.defaultMessages[e]=new o({text:"You have gone back online, your changes have been saved.",type:MessageType.Info,timeout:1e4},this);break;case MessageID.CacheReset:this.defaultMessages[e]=new o({text:"To fix your issues we are going to clear the local cache. This will reload the page and your data, "+n.actionVerb()+" here to continue.",type:MessageType.Info,action:MessageAction.ResetClient},this);break;case MessageID.RequiredUpdate:this.defaultMessages[e]=new o({text:"A software update is required to continue, "+n.actionVerb()+" to update.",type:MessageType.RequiredUpdate,action:MessageAction.Reload,block:!0},this);break;case MessageID.Updated:this.defaultMessages[e]=new o({text:"An update was installed. "+n.actionVerbCaps()+" to reload.",type:MessageType.RequiredUpdate,action:MessageAction.Reload,bottom:!0},this);break;case MessageID.MobileOffline:this.defaultMessages[e]=new o({text:"OFFLINE",type:MessageType.MobileOffline,action:MessageAction.None,bottom:!0},this);break;default:try{t.PAssert(1469,!1,"Invalid MessageID")}catch(r){t.reportError(r)}}},pushMessage:function(e){var r;if(e instanceof o)r=e;else if(t.isObject(e))r=new o(e,this);else if(t.isString(e))r=new o({text:e},this);else if(r=this.getMessageById(e),!r){try{t.PAssert(1470,!1,"Invalid data passed to message creation")}catch(n){t.reportError(n)}log("Message not created properly",e)}return r&&r.show(),r},clearMessage:function(e){var t;return e instanceof o?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t},onMessageShow:function(e){this.queue.push(e)},onMessageHide:function(e){try{t.PAssert(1471,e,"Must pass in a valid message to be removed from the queue")}catch(r){t.reportError(r)}var n=this.queue.indexOf(e);if(0>n)try{t.PAssert(1472,!1,"Trying to remove an invalid message from the queue")}catch(r){t.reportError(r)}else this.queue.splice(n,1)},computeFilter:function(){n.isMobile&&(this.currentFilter|=this.FilterType.Mobile),n.isMobile||(this.currentFilter|=this.FilterType.Desktop),n.app&&(this.currentFilter|=this.FilterType.App)},updateRemoteMessages:function(){if(!t.isDemoMode()){var e=t.settings.get(Settings.lastMessageSync),r="";e&&(r="?lastSync="+new Date(e).toString("yyyy-MM-ddTHH:mm:ss"));var n=new Date;t.XHR({type:"GET",url:window.location.protocol+"//api.moo.do/debug/getMessages"+r,cb:function(e){if(200===e.status){t.settings.set(Settings.lastMessageSync,n);var r=JSON.parse(e.responseText);if(r)for(var i=r.m,o=0;i&&o<i.length;++o){var a=i[o],s=this.remoteMessages[a.id];if(!s){var c=!0;a.filter&&(c=0!==(a.filter&this.currentFilter),log("Remote Message Filter: "+a.filter+" "+this.currentFilter+" "+c)),c&&this.pushMessage({text:a.data,type:a.type,action:MessageAction.Default}),this.remoteMessages[a.id]=a}}}else log("Unable to get remote messages",e)}.bind(this)})}}},a}),define("TemplateCache",["ko","globals"],function(e,t){window.__TOTAL_TEMPLATES=0;var r={},n="__cached_template__";r.templateSources=function(r){var i={elem:r,__proto__:new e.templateSources.domElement(r)};return i.text=function(e){return 0===arguments.length?i.elem.text:void(i.elem.text=e)},i.nodes=function(){try{t.PAssert(1473,0===arguments.length)}catch(r){t.reportError(r)}if(0===arguments.length){var o=e.utils.domData.get(i.elem,n);if(!o){for(var a=i.text().replace(/(\r\n|\n|\r|\s*(?=<)|\s*$)/gm,""),s=e.utils.parseHtmlFragment(a),c=document.createElement("div"),d=0;d<s.length;d++)c.appendChild(s[d]);return e.utils.domData.set(i.elem,n,{cachedNodes:c}),c}return o.cachedNodes}},i},r.templateEngine=function(){var n={__proto__:new e.nativeTemplateEngine};return n.cachedDoc=void 0,n.makeTemplateSource=function(e,i){try{t.PAssert(1474,"string"==typeof e)}catch(o){t.reportError(o)}var a=i||document,s=n.cachedDoc;if(!n.cachedDoc){try{t.PAssert(1475,a)}catch(o){t.reportError(o)}s={doc:a,cachedTemplates:{}},n.cachedDoc=s}try{t.PAssert(1476,s)}catch(o){t.reportError(o)}var c=s.cachedTemplates[e];if(!c){var d=s.doc.getElementById(e);try{t.PAssert(1477,d)}catch(o){t.reportError(o)}if(d)try{c=new r.templateSources(d);try{t.PAssert(1478,c)}catch(o){t.reportError(o)}}catch(l){t.reportError(l)}else t.reportError(new Error('Unable to find element for template "'+e+'". '+d));s.cachedTemplates[e]=c,__TOTAL_TEMPLATES++}return c},n};var i=r.templateEngine();return i instanceof e.templateEngine&&e.setTemplateEngine(i),r}),define("VMContact",["ko","data","globals","goog","platform","tracker"],function(e,t,r,n,i){function o(t){this.templateName="template-contact",this.id=t.id,this.isSelected=e.observable(!1),this.text=t.text||"",this.image=void 0,this.phoneNumbers=t.phoneNumbers||[],this.emails=t.emails||[],this.dbItem=t,this.phone=void 0,this.phoneLink=void 0,this.email=void 0,this.emailLink=void 0,this.item=void 0,this.init()}return o.prototype={hasPreview:function(){return!0},init:function(){for(var e=0;e<this.phoneNumbers.length;e++)this.phoneNumbers[e].link=this.formatPhone(this.phoneNumbers[e].number);for(var e=0;e<this.emails.length;e++)this.emails[e].link="mailto:"+this.emails[e].address},onLoad:function(e){this.element=e},formatPhone:function(e){var t=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/;if(t.test(e)){var r=e.match(t),n="";r[1]&&(n+="("+r[1]+") "),n+=r[2]+"-"+r[3];var o="";return r[1]&&(o+="+1-"+r[1]+"-"),o+=r[2]+"-"+r[3],i.iphone?"tel:"+o:"callto:"+o}},onTapNumber:function(){},onTapEmail:function(){},onTap:{onClick:function(e){log(e.srcElement,this.text),r.hasClass(e.srcElement,"contactPhone")||r.hasClass(e.srcElement,"contactEmail")||r.autocomplete.onTapped(this.text)}}},o}),define("VMAutocompleteItem",["ko","data","globals","platform"],function(e,t,r){function n(t){this.id=t.id,this.text=t.text||"",this.object=t.object,this.index=t.index,this.isSelected=e.observable(!1),this.element=void 0,this.init()}return n.prototype={init:function(){},html:function(){var e=r.autocomplete.text(),t=this.text.toLowerCase().indexOf(e.toLowerCase()),n="";return t>=0&&(n=this.text.substr(0,t)+"<b>"+this.text.substr(t,e.length)+"</b>"+this.text.substr(t+e.length)),n},onLoad:function(e){this.element=e}},n}),define("AutocompleteDates",["ko","data","globals","platform"],function(){function e(){this.soft=["now","soon","later"],this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.dict=this.soft.concat(this.softDays).concat(this.dayModifiers).concat(this.days).concat(this.months),this.NextWordOptions={None:0,DayName:1,Days:2,Time:4},this.init()}return e.prototype={init:function(){},findDatesLike:function(e){for(var t=e.toLowerCase(),r=[],n=0;n<this.dict.length;++n)0===this.dict[n].indexOf(t)&&r.push({index:0,object:{id:this.dict[n],text:this.dict[n]}});return r},findExact:function(e){return this.dict.indexOf(e)>=0?this.nextWordOptions(e)==this.NextWordOptions.None:!1},nextWordOptions:function(e){var t=e.split(" "),r=t[t.length-1];if(""==r&&(r=t[t.length-2]),this.soft.indexOf(r)>=0)return this.NextWordOptions.None;if(this.softDays.indexOf(r)>=0)return this.NextWordOptions.Time;if(this.dayModifiers.indexOf(r)>=0)return this.NextWordOptions.DayName;if(this.days.indexOf(r)>=0)return this.NextWordOptions.Time;if(this.months.indexOf(r)>=0)return this.NextWordOptions.Days;var n=parseInt(r,10);return isNaN(n)?r.indexOf(":")>=0?this.NextWordOptions.Time:this.NextWordOptions.None:this.NextWordOptions.Time}},e}),define("VMAutocomplete",["ko","data","globals","platform","VMContact","VMAutocompleteItem","AutocompleteDates","tracker"],function(e,t,r,n,i,o,a,s){function c(){this.items=e.observableArray(),this.isVisible=e.observable(!1),this.element=void 0,this.trackingItem=void 0,this.trackingTag=void 0,this.selectedIndex=e.observable(-1),this.exactMatch=e.observable(!1),this.text=e.observable(""),this.autocompleteDates=new a,this.nextDateWord=e.observable(this.autocompleteDates.NextWordOptions.None),this.lastX=0,this.lastY=0,this.Modes={Contact:0,Date:1},this.mode=e.observable(-1),this.init()}return c.prototype={getDateText:function(e){switch(e){case 1:return e+"st ";case 2:return e+"nd ";case 3:return e+"rd ";default:return e+"th "}},getMinWidth:function(){return this.mode()===this.Modes.Contact?"350px":"180px"},showAllDates:function(){return""===this.text()},showDate:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.None||this.nextDateWord()==this.autocompleteDates.NextWordOptions.DayName},showDays:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.Days},showTime:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.Time},showDates:function(){return n.mobile&&n.app&&this.mode()==this.Modes.Date&&(""===this.text()||this.nextDateWord())},showList:function(){return!this.exactMatch()&&!this.showDates()},showPreview:function(){return this.selectedItem()&&this.mode()==this.Modes.Contact&&(!n.mobile||this.exactMatch)},hasContent:function(){return this.showDates()||this.showList()||this.showPreview()},templatePreview:function(){return"template-contact"},selectedItem:function(){return this.selectedIndex()<0?void 0:this.items()[this.selectedIndex()]},init:function(){this.onkeydown=this.onkeydown.bind(this),this.onMouseover=this.onMouseover.bind(this),this.element=document.getElementById("autocomplete"),r.applyBindings(this,"autocomplete"),window.addEventListener("closeKeyboard",this.hide.bind(this))},setMode:function(e){e==DatePrefix&&this.mode(this.Modes.Date),e==ContactPrefix&&this.mode(this.Modes.Contact)},show:function(e,t){if(!this.isVisible()){var i;if(!t&&(i=document.getSelection(),i&&i.baseNode)){var o=r.findParent(i.baseNode,"contact",2);t=o||r.findParent(i.baseNode,"date",2),o&&s.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenContact,data:[{info:e}]})}var a=document.documentElement.getBoundingClientRect(),c=this.element.getBoundingClientRect(),d={left:c.left,right:c.right,top:c.top,bottom:c.bottom};if(0===c.width&&0===c.height&&(d.right=350,d.bottom=170),t){var l=t.getBoundingClientRect();r.setOrigin(d,l.left,l.bottom);var u=r.adjustOriginToBeInsideBounds(a,d,20,10,10,10);this.element.style.left=u.x+"px",this.element.style.top=u.y+"px"}else{if(!(i.rangeCount>0))return;var l=i.getRangeAt(0).getClientRects()[0];l.left-=20,r.setOrigin(d,l.left,l.bottom);var u=r.adjustOriginToBeInsideBounds(a,d,20,10,10,10);this.element.style.left=u.x+"px",this.element.style.top=u.y+"px"}if(this.isVisible(!0),this.element.scrollTop=0,n.mobile&&e){var h=150,p=r.scrollToTop(e.getSpan(),h),m=t?t.getBoundingClientRect():e.getSpan().getBoundingClientRect(),f=m.bottom-p;this.element.style.top=f-2+"px",this.mode()==this.Modes.Contact?r.phoneMenu.contactMode(!0):this.mode()==this.Modes.Date&&r.phoneMenu.dateMode(!0),r.keyboardToolbar.isVisible(!1);var g=n.windowHeight()-n.kbsize-f;r.setTransform(this.element,0,g),requestAnimationFrame(function(){r.setTransform(this.element,0,0,h,"ease-out")}.bind(this))}}},clear:function(){this.items.removeAll(),this.trackingTag=!1},hide:function(){if(this.isVisible()){var e=200;if(n.mobile){var t=n.windowHeight()-n.kbsize;r.setTransform(this.element,0,t,e,"ease-out"),setTimeout(function(){this.isVisible(!1),r.phoneMenu.contactMode(!1),r.isKeyboardOpen&&r.keyboardToolbar.isVisible(!0),this.clear()}.bind(this),e)}else this.isVisible(!1)}},onkeydown:function(e){if(0===this.items().length||!this.isVisible()||this.exactMatch()&&e.normCode!==KeyCode.Escape)return!0;if(e.normCode===KeyCode.UpArrow||e.normCode===KeyCode.DownArrow){if(this.items().length>1){this.selectedIndex()>=0&&this.items()[this.selectedIndex()].isSelected(!1);var t=this.selectedIndex()+(e.normCode==KeyCode.DownArrow?1:-1);return this.selectedIndex(0>t?this.items().length+t:t>=this.items().length?t%this.items().length:t),this.items()[this.selectedIndex()].isSelected(!0),!1}this.hide()}else{if(e.normCode===KeyCode.Enter){if(this.selectedIndex()>=0){var r=this.items()[this.selectedIndex()];this.onTapped(r.text,!0)}return this.hide(),!1}if(e.normCode===KeyCode.Escape)return this.hide(),!1}return!0},onTap:{onClick:function(t){var r=e.dataFor(t.srcElement);this.onTapped(r.text)}},onTapped:function(e,t){this.text(e),this.trackingItem&&this.trackingItem.onAutocompleteTapped(e,this.trackingTag),(t||this.mode()===this.Modes.Contact||!n.mobile)&&this.hide()},find:function(e,t,r){if(t+r>e.length-1)return!1;var n=e[t];isNaN(r)&&(r=0);for(var i=0;r>i&&e[t+i+1];i++)n+=" "+e[t+i+1];var o,a=-1!==n.indexOf(":",n.length-1)?n.substr(0,n.length-1):n;return this.mode()==this.Modes.Contact?o=this.findContact(a):this.mode()==this.Modes.Date&&(o=this.findDate(a)),o.length>0?this.find(e,t,r+1)||{start:t,num:r+1,text:a,results:o}:!1},findContact:function(e){return t.findContactsLike(e)},findDate:function(e){return this.autocompleteDates.findDatesLike(e)},findExact:function(e){return this.mode()==this.Modes.Contact?this.findContactExact(e):this.mode()==this.Modes.Date?this.findDateExact(e):void 0},findContactExact:function(e){return t.findContactsExact(e)},findDateExact:function(e){return this.autocompleteDates.findExact(e)},objectFromResult:function(e){return this.mode()==this.Modes.Contact?new i(e):this.mode()==this.Modes.Date?new i(e):void 0},getMinWordLength:function(){return this.mode()==this.Modes.Contact?1:this.mode()==this.Modes.Date?1:void 0},getLineIndexFromWordIndex:function(e,t){for(var r=0,n=0;t>n;n++)r+=e[n].length+1;return r},update:function(e){var t=e.item||this.trackingItem,r=t.getParsedText(),i=e.start,a=e.fromArrows;this.trackingItem=t,this.trackingTag=!1;var s,c=0,d=0,l=-1,u=-1,h=r.split(" ");for(c>0&&(h[0]=h[0].substr(c)),s=0;s<h.length;s++)(h[s].startsWith(ContactPrefix)||h[s].startsWith(DatePrefix))&&i>=d&&(l=s,u=d,this.setMode(h[s][0])),d+=h[s].length+1;this.getMinWordLength();if(l>=0){this.clear(),h[l]=h[l].substr(1);var p=this.find(h,l),m=1;if(""===h[l+1]&&m++,p&&u+m+p.text.length>=i){var f=this.findExact(p.text);if(this.exactMatch(!!f),f){var g={index:-1,text:f.text};g.object=this.objectFromResult(f),t=new o(g),this.items.push(t),this.selectedIndex(0),this.trackingTag=!0,a||n.mobile||this.show(this.trackingItem)}else{if(p&&p.num>0){this.trackingTag={text:p.text,index:this.getLineIndexFromWordIndex(h,p.start)+1,length:p.text.length},this.text(p.text);var t,v=p.results;for(s=0;s<v.length;s++){var y=v[s].object,g={index:s,text:y.text};g.object=this.objectFromResult(y),t=new o(g),this.items().push(t)}this.items.valueHasMutated(),this.selectedIndex(0),this.items()[0].isSelected(!0)}a||this.show(this.trackingItem)}}}this.nextDateWord(this.autocompleteDates.NextWordOptions.None),this.trackingTag||this.hide()},onMouseover:function(e){this.selectedIndex()>=0&&this.items()[this.selectedIndex()].isSelected(!1);var t=this.items.indexOf(e);t>=0&&(this.selectedIndex(t),e.isSelected(!0))},onTapDate:{onStart:r.handlerPreventStop,onClick:function(e){var t=e.srcElement;if("SPAN"==t.nodeName){var n=t.parentNode;if(r.hasClass(n,"disabled"))return;var i=t.id?t.id+" ":t.textContent,o=this.autocompleteDates.nextWordOptions(i);this.nextDateWord(o),log("next",o,this.trackingTag);var a=o==this.autocompleteDates.NextWordOptions.None;this.onTapped(i,a),this.trackingTag.index+=i.length}}}},c}),define("ScreenManager",["ko","globals","platform"],function(e,t,r){function n(e){this.snapPoints=[],this.screens=[],this.activeScreen=-1,this.screenAtSwipeStart=-1,this._isSwiping=!1,this.minOffset=0,this.maxOffset=0,this.owner=e,this.useScroll=!1,this.lastOffset=0,this.updateFunctions=[],this.paneWidth=.85,this.init()}return window.Screens=r.mobile?{Settings:0,Outline:1,List:2,MAX:2}:{Outline:0,List:1,MAX:1},n.prototype={init:function(){this.activeScreen=Screens.MAX},getActiveScreen:function(){return this.activeScreen},setOwner:function(e){this.owner=e},isSwiping:function(){return this._isSwiping},isScreenOpen:function(e){return this.activeScreen===e},computeSnapPoints:function(){try{t.PAssert(1479,r.mobile,"Should only be computing snappoints on mobile")}catch(e){t.reportError(e)}try{t.PAssert(1480,this.owner,"Must have a valid owner to compute snap points")}catch(e){t.reportError(e)}for(var n=3*this.paneWidth,i=[0,this.paneWidth,2*this.paneWidth],o=this.useScroll?this.owner.scrollWidth:parseInt(t.width(this.owner))*n,a=0;a<i.length;++a)this.snapPoints[a]=Math.round(i[a]*(o/n));this.offsetMin=0,this.offsetMax=this.snapPoints[2],this.lastOffset=this.offsetMax},onResize:function(){if(r.mobile){var e=this.activeScreen;this.computeSnapPoints();var t=this.snapPoints[e];this.updateScreenOffset(e,t,0),this.lastOffset=t}},scrollToScreen:function(e){try{t.PAssert(1484,e<=Screens.MAX,"Must be a valid screen type")}catch(r){t.reportError(r)}this.activeScreen!==e&&(this.notifyScreenOfClose(this.activeScreen),this.notifyScreenOfOpen(e));var n=this.activeScreen;this.activeScreen=e;var i=this.snapPoints[e];return this.notifyScreenOfScroll(n,i,200),this.updateScreenOffset(e,i,200),this.lastOffset=i,i},updateScreenOffset:function(e,n,i){if(i=i||0,this.useScroll)if(i){var o=this.snapPoints[e];t.scrollTo(o,i,this.owner,!0)}else this.owner.scrollLeft=n;else for(var a=0;a<this.screens.length;++a){var s=this.screens[a].getTopElement();t.setTransform(s,-n,0,i,"ease-out");var c=n-(a-1)*r.windowWidth()*this.paneWidth,d=c/(r.windowWidth()*this.paneWidth);s.style.opacity=t.clamp(.4+.6*d,0,1)}t.setTransform(t.element("headers"),-n*(1/this.paneWidth),0,i),this.lastOffset=n},getCurrentScreenOffset:function(){return this.useScroll?this.owner.scrollLeft:this.lastOffset},addScreen:function(e,r){try{t.PAssert(1485,r<=Screens.MAX,"Must be a valid screen type")}catch(n){t.reportError(n)}try{t.PAssert(1486,void 0===this.screens[r],"Already have a screen at the given index")}catch(n){t.reportError(n)}this.screens[r]=e},getScreen:function(e){var r=this.screens[e];try{t.PAssert(1487,r,"Must have a valid screen")}catch(n){t.reportError(n)}return r},notifyScreenOfClose:function(e){if(-1!==e){var t=this.getScreen(e);t.onScreenClose&&t.onScreenClose()}},notifyScreenOfScroll:function(e,r,n){if(-1!==e)for(var i=0;i<this.screens.length;++i){var o=this.getScreen(i);o.onScreenScroll&&o.onScreenScroll(r,n)}t.fireCustomEvent("screenScroll")},notifyScreenOfStartOpen:function(e){if(-1!==e){var t=this.getScreen(e);t.onScreenStartOpen&&t.onScreenStartOpen()}},notifyScreenOfOpen:function(e){if(-1!==e){var t=this.getScreen(e);t.onScreenOpen&&t.onScreenOpen()}},startSwipe:function(){this._isSwiping||(this._isSwiping=!0,0===this.activeScreen?this.notifyScreenOfStartOpen(1):this.activeScreen===Screens.MAX?this.notifyScreenOfStartOpen(Screens.MAX-1):(this.notifyScreenOfStartOpen(this.activeScreen-1),this.notifyScreenOfStartOpen(this.activeScreen+1)))},updateSwipe:function(e){try{t.PAssert(1488,this.isSwiping(),"Must be swiping to perform an update")}catch(n){t.reportError(n)}if(r.ios||r.android||r.ie&&r.mobile){var i=this.getCurrentScreenOffset(),o=Math.max(Math.min(i+e,this.offsetMax),this.offsetMin);i!==o&&this.updateScreenOffset(this.activeScreen,o)}},endSwipe:function(){try{t.PAssert(1489,this.isSwiping(),"Must be swiping to end a swipe")}catch(e){t.reportError(e)}for(var n=this.getCurrentScreenOffset(this.activeScreen),i=-1,o=1e5,a=0;a<this.snapPoints.length;++a){var s=Math.abs(this.snapPoints[a]-n);o>s&&(i=a,o=s)}this.scrollToScreen(i),r.ios&&t.preventClick(),this._isSwiping&&(this._isSwiping=!1)},checkSwipeStart:function(e){var t=!1;return this.screenAtSwipeStart=this.activeScreen,r.ie&&!r.mobile||r.mobile&&this.activeScreen!==Screens.List&&e.eventX>this.paneWidth*r.windowWidth()&&(e.preventDefault(),t=!0),t},checkSwipeMove:function(e){var t=!1;
if(r.ie&&!r.mobile);else if(r.mobile){var n=this.activeScreen!==Screens.MAX&&Math.abs(e.diffX)>5||this.activeScreen===Screens.MAX&&e.diffX>5;(this.isSwiping()||Math.abs(e.distanceY)<5&&n)&&(this.isSwiping()||this.startSwipe(),this.updateSwipe(-e.xThisFrame),e.preventDefault(),e.stopImmediatePropagation(),t=!0)}return t},checkSwipeClick:function(e){return this.activeScreen!==Screens.List&&e.eventX>this.paneWidth*r.windowWidth()?(this._isSwiping=!1,this.scrollToScreen(this.activeScreen+1),!0):this._isSwiping},checkSwipeEnd:function(){var e=!1;return this.activeScreen==this.screenAtSwipeStart?r.ie&&!r.mobile||r.mobile&&this.isSwiping()&&this.endSwipe():this.activeScreen!=this.screenAtSwipeStart&&(e=!0,log("return value is true")),e}},n}),define("VMTooltip",["ko","globals","platform"],function(e,t){function r(){this.listenerElement=void 0,this.displayElement=void 0,this.element=void 0,this.displayTimeout=void 0,this.extraTimeout=void 0,this.displayText=e.observable(""),this.displayExtra=e.observable(""),this.overTooltip=e.observable(!1),this.tipExtras={"#desktopMenuButton":"Access your settings and documents, view help",".addPaneNormal":"Open another editable view of your data",".addPaneTimeline":"View your agenda"},t.applyBindings(this,"tooltip"),this.init()}var n=300,i=1e3;return r.prototype={init:function(){},onLoad:function(){this.element=document.getElementById("tooltip"),this.element&&(this.element.addEventListener("mouseover",this.handleSelfOver.bind(this),!0),this.element.addEventListener("mouseout",this.handleSelfOut.bind(this),!0)),this.listenerElement=document.getElementById("outerWrapper"),this.listenerElement&&(this.listenerElement.addEventListener("mouseover",this.handleEleOver.bind(this),!0),this.listenerElement.addEventListener("mouseout",this.handleEleOut.bind(this),!0))},register:function(e,t){this.update(e,t)},update:function(e,t){e.setAttribute("tooltip",t)},tipIn:function(e){this.displayElement!==e.srcElement&&(this.displayElement=e.srcElement,clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),n))},adjustBounds:function(){var e=200,r=0,n=document.documentElement.getBoundingClientRect(),i=this.displayElement.getBoundingClientRect(),o=n.right-i.right,a=e>o;if(a){var s=t.width(this.element);s>o&&(r+=s-(n.right-i.right)+10)}var c=i.left+i.width/2;t.setTransform(this.element,c-r,i.bottom+5)},displayTip:function(){if(this.displayTimeout=void 0,this.displayElement){var e=this.displayElement.getAttribute("tooltip");try{t.PAssert(1490,e,"When display a tooltip, elements should always have valid data set")}catch(r){t.reportError(r)}e&&(this.displayText(e),this.adjustBounds(),this.extraTimeout=setTimeout(this.showExtra.bind(this),i))}},tipOut:function(e){e.srcElement||(e.srcElement=e.target);var r=!1,n=e.toElement||e.relatedTarget;n&&(r=t.isAncestor(n,e.srcElement)),r||e.srcElement===n||n===this.element||this.hideTip()},handleEleOver:function(e){e.srcElement||(e.srcElement=e.target);var t=e.srcElement.getAttribute("tooltip");t&&this.tipIn(e)},handleEleOut:function(e){e.srcElement||(e.srcElement=e.target);var t=e.srcElement.getAttribute("tooltip");t&&this.tipOut(e)},handleSelfOver:function(){this.displayElement&&(this.overTooltip(!0),this.showExtra())},handleSelfOut:function(e){e.srcElement||(e.srcElement=e.target);var r=!1,n=e.toElement||e.relatedTarget;n&&(r=t.isAncestor(n,e.srcElement)),r||e.srcElement===n||(this.overTooltip(!1),n!==this.displayElement&&this.hideTip())},showExtra:function(){var e=void 0;try{t.PAssert(1491,this.displayElement,"There should be a display element when showing extra information")}catch(r){t.reportError(r)}if(this.displayElement){if(this.displayElement.id){var n="#"+this.displayElement.id;this.tipExtras[n]&&(e=n)}if(!e)for(var i=0;i<this.displayElement.classList.length;++i){var o="."+this.displayElement.classList[i];if(this.tipExtras[o]){e=o;break}}if(e){var a=this.tipExtras[e];a&&(this.displayExtra(a),this.adjustBounds())}clearTimeout(this.extraTimeout),this.extraTimeout=void 0}},hideTip:function(){this.displayElement&&(this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,clearTimeout(this.extraTimeout),this.extraTimeout=void 0,this.displayText(""),this.displayExtra(""))}},r}),define("AppCache",["ko","globals","platform"],function(e,t,r){function n(){this.minTimeShowUpdate=2e3,this.timeToCancelButton=2e3,this.notifiedOfNew=!1,this.isFinished=!1,this.timeShownUpdatingMessage=void 0,this.showCancel=e.observable(!1),this.downloadingTimeout=0,this.startStatus=window.applicationCache.status,this.continuedUpdate=!1,this.updateActionDone=!1,this.fnToRun=[],this.dynamicUpdateCheck=!1,this.requiredUpdate=!1,this.appUpdatePending=!1,this.isShowingProgress=!1,this.init()}return n.prototype={init:function(){log("Cache Status: "+this.startStatus),window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()},isVisible:function(e){t.isDemoMode()?e&&t.reload():t.messageQueue.pushMessage(MessageID.Updated)},update:function(){window.applicationCache.status===window.applicationCache.IDLE&&applicationCache.update()},checkForUpdate:function(e){this.requiredUpdate=!!e,this.appUpdatePending||(this.dynamicUpdateCheck=!0,this.update())},runOnFinish:function(e){try{t.PAssert(1492,0===this.fnToRun.length,"Only a single callback is allowed to be run at this point.")}catch(r){t.reportError(r)}this.isFinished?setTimeout(e,0):this.fnToRun.push(e)},onUpdateReady:function(){log("Cache: New version available"),this.appUpdatePending=!0,this.startStatus===window.applicationCache.UNCACHED&&log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction()},onFirstUpdateReady:function(){log("Cache: first update")},onUpdateError:function(e){function n(){t.messageQueue&&t.messageQueue.pushMessage({text:"Error updating app, "+r.actionVerb()+" to retry.",type:MessageType.Error,action:MessageAction.Reload})}r.demo||t.vmMain&&!t.vmMain.isOnline()||(log("Update Error: ",e),t.reportError(new Error("Error during app update"),e),t.messageQueue?n():setTimeout(n,5e3)),this.isVisible(!1),this.onCacheLoadFinished()},onUpdateDownloading:function(){log("Cache: New version downloading")},onCacheLoadFinished:function(){if(log("Cache: No update"),!this.isFinished){this.isFinished=!0;for(var e=0;e<this.fnToRun.length;++e)this.fnToRun[e]()}},notifyOfUpdate:function(){this.notifiedOfNew||(this.notifiedOfNew=!0,t.setAppCacheUpdateState(!0),this.startStatus!==window.applicationCache.UNCACHED&&(t.StopSpinner(),this.isVisible(!0)))},updateAction:function(){this.requiredUpdate?t.messageQueue.pushMessage(MessageID.RequiredUpdate):this.isVisible(!0),t.sendEvent("AppCache","Update")}},n}),"undefined"==typeof REPORT_ACTIONS&&(REPORT_ACTIONS=!1),Error.stackTraceLimit=150;try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.appEvents=window.appEvents||{kbsize:function(){},enterBackground:function(){},enterForeground:function(){},statusBarTap:function(){},undo:function(){},redo:function(){},reportLowMemory:function(){}},window.log=console.log.bind(console),window.performance&&window.performance.now?(window.performance.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.performance.start}):(window.performance={now:function(){return Date.now()-window.performance.start}},window.performance.start=Date.now(),window.log.now=performance.now),console.timeStamp||(console.timeStamp=function(){}),console.time||(console.time=function(){}),console.timeEnd||(console.timeEnd=function(){}),console.trace||(console.trace=function(){}),window.LogLevels={Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Verbose:262144},window.LogLevel=LogLevels.Error|LogLevels.Warning,window.ShouldLog=function(e){return window.DEBUG===e},window.logIf=function(){var e=Array.prototype.slice.call(arguments);ShouldLog&&(e.splice(0,1),window.log.apply(this,e))};for(var i in LogLevels)makeLogger(i);window.inspectLocal=function(e){if(!e)return void log("Must specify either an item ID or item object to inspect");var t=e;return"string"==typeof e&&(t=window.getModel(e)),log("---- Inspecting Item:",t.id,"----"),log("  RawText:",t.getRawText()),log("  ParsedText:",t.getParsedText()),log("  StyledText:",t.getStyledText()),log('  Parent: "'+t.parent().id+'"'),log("  Date:",t.date()),log("  AllDayDate:",t.allDayDate),log("--------------------------------------------"),t}}catch(err){log("Error in main header"),window.__ERRORINMAINHEADER=err}!function(){var e,e,e={paths:{ko:"lib/knockout-2.3.0.custom",date:"lib/date",FileSaver:"lib/FileSaver",IndexedDBShim:"lib/IndexedDBShim.min",db:"lib/db"},waitSeconds:15};require.config(e)}(),window.gapiKey="AIzaSyB9HEdSJ-nhLJG_ssSSqhI2DX74GSiKSao",window.location.hash.indexOf("gtest=true")>=0&&(log("Loading DEBUG version of RealtimeAPI"),window.___gcfg={"drive-realtime":{server:"https://drive.sandbox.google.com/otservice"}});var gapiCalled=!1,gapiLoadError=!1;requirejs(["ko","kos","data","globals","util","gdata","goog","platform","edit","VMMain","VMSetup","VMDebug","VMTimeline","VMSearch","VMMessageQueue","TemplateCache","VMAutocomplete","VMMenus","ScreenManager","VMTooltip","AppCache","DuchessHelpers"],function(e,t,r,n,i,o,a,s,c,d,l,u,h,p,m,f,g,v,y,b,S){n.checkpoint(Checkpoint.RequireLoaded),window.__ERRORINMAINHEADER&&n.reportError(window.__ERRORINMAINHEADER);n.runOnLoad(function(){function e(e){document.documentElement.addEventListener(e,function(e){n.reportEvent(e)},!0),document.documentElement.addEventListener(e,function(e){},!1)}function t(){return n.requestNotification(navigator.userAgent)}function o(){n.AppCache.runOnFinish(function(){n.reload()},!0)}function p(){s.updateOrientation(),s.mobile&&!s.app&&(n.keyboardToolbar&&n.keyboardToolbar.isVisible()&&n.keyboardToolbar.updatePosition(!0),document.body.scrollTop=0),s.mobile&&n.keyboardToolbar&&n.keyboardToolbar.hideTopBarIfLandscape()}function f(){O||(O=!0,n.checkpoint(Checkpoint.InitializeMain),n.openMainPage(),n.registerEvent("ItemCreated","ItemAction","Create"),n.registerEvent("ItemCompleted","ItemAction","Complete"),r.initData(T),T())}function T(){try{if(L||!O||!r.localDataLoaded())return;L=!0,n.checkpoint(Checkpoint.OnInitializedData),a.loadClientDefaultFile(),n.isDemoMode()?s.script||(n.vmMain.openSidebar(),setTimeout(function(){n.highlightElement(document.getElementById("logoutButton"),.6,1)},0)):n.vmMain.setupDateRollover(),n.vmMain.loadData(),n.timeline.load(),n.StopSpinner(),setTimeout(function(){n.menus&&n.menus.bind(),n.autocomplete||(n.autocomplete=new g)})}catch(e){n.reportError(e)}}function w(e){return(s.mac&&e.metaKey||!s.mac&&e.ctrlKey)&&e.normCode==KeyCode.A}try{n.checkpoint(Checkpoint.PageLoad);try{n.PAssert(1494,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(E){n.reportError(E)}if("loading"===document.readyState){var M="ERROR: MainJS running before document load! "+document.readyState;ShouldLog(LogLevels.Error)&&log(M),n.reportError(new Error(M))}for(var x in window.scriptErrors)n.fireCustomEvent("scriptLoadError",{src:x,id:window.scriptErrors[x],firstChance:!0});if(window.handleLoadError=function(e){try{window.scriptErrors[e.target.src]=e.target.id,n.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(t){n.reportError(t)}},window.oncontextmenu=function(e){e.preventDefault()},s.demo&&(n.messageQueue||(n.messageQueue=new m),n.enableDemoMode()),n.isDemoMode()&&s.script){var C=i.getURLParam("dmode");C&&n.enableMinMode(C);var I=i.getURLParam("panes");I&&(n.demoPanes=I.split(":"))}else n.removeDOM("preventInteraction");setTimeout(function(){n.sendEvent("PageLoad","NewPage")},0),e("keydown"),e("keyup"),e("keypress"),e("MSPointerDown"),e("MSPointerUp"),e("MSPointerHover"),e("MSPointerCancel"),e("mousedown"),e("mouseup"),e("touchstart"),e("touchend"),n.messageQueue||(n.messageQueue=new m),n.tooltip=new b,n.AppCache=new S,n.StartSpinner();var A=s.blockClient();if(void 0!==A){var P,D=!1;return A.platform?A.update?"Firefox"==A.platform?P='Please update your Firefox browser to use Moo.do. Moo.do requires at least Firefox 16. See <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">https://support.mozilla.org/en-US/kb/update-firefox-latest-version</a> for more information.':"Chrome"==A.platform?P='Please update your Chrome browser to use Moo.do. Moo.do requires at least Chrome 26. See <a href="https://support.google.com/chrome/answer/95414">https://support.google.com/chrome/answer/95414</a> for more information.':"Native Android"==A.platform?P="Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"==A.platform?P='Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"==A.platform?P=s.mobile?"Please update your "+s.OSName+" to use Moo.do. Moo.do requires at least iOS 6.":'Please update your Safari browser to use Moo.do. Moo.do requires at least Safari 6.1. See <a href="http://support.apple.com/kb/HT6103">http://support.apple.com/kb/HT6103</a> for more information.':(P="Please update your browser to use Moo.do. If you are unable to update your browser, please let us know. Thanks!",D=!0):(D=!0,P="Sorry, we don't support "+A.platform+" yet. Please let us know that you're interested in using "+A.platform+" and we will make it a higher priority. Thanks!"):A.version?P="Please update to the latest version of this app by opening the TestFlight app and installing the latest version. Thanks!":A.cacheUpdate&&(P="There was an issue while updating the app, "+s.actionVerb()+" to try again.",n.AppCache.update(),A.error&&n.AppCache.runOnFinish(function(){i.insertURLParam("cacheError",!0)},!0)),P&&n.applyBindings({platformError:P,showSignup:D,onTapRefresh:o,onTapSubmit:t},"OSError"),n.StopSpinner(),n.removeDOM("outerWrapper"),n.removeDOM("setupWrapper"),void n.removeDOM("templates")}i.removeURLParam("cacheError",!0),n.removeDOM("OSError"),n.localDocChangeRequested=!1,n.settings.initEvents(function(e){if("localSettings"===e.key){var t;e.oldValue&&(t=JSON.parse(e.oldValue));var r;e.newValue&&(r=JSON.parse(e.newValue)),t&&r&&!n.localDocChangeRequested&&t.gdocId&&t.gdocId!==r.gdocId&&(n.messageQueue.pushMessage(MessageID.DocChange),setTimeout(function(){n.reload()},1e4))}}),n.ScreenManager=new y(document.getElementById("main")),n.menus=new v,n.vmDebug=new u,window.addEventListener("remoteDataLoaded",function(){var e=i.getURLParam("file"),t=i.getURLParam("state");if(e||t){if(!e)try{var r=JSON.parse(t);"open"===r.action&&r.ids&&r.ids.length>=0&&(e=r.ids[0])}catch(o){n.reportError(o)}var c=a.getDocId();e&&c!==e&&n.messageQueue.pushMessage({text:"You have requested to view another document, "+s.actionVerb()+" here to open it.",type:MessageType.Info,action:function(){try{n.PAssert(1496,n.vmMain&&n.vmMain.vmPicker,"VMMain must be initialized before loading another doc")}catch(t){n.reportError(t)}n.vmMain.vmPicker.requestOpenDocument(e)}})}});var k=function(e){var t=window.innerWidth,r=window.innerHeight,i=s.windowWidth(),o=s.windowHeight();if(t!=i||r!=o&&r!=o+60){if(n.smallMode=480>=t,s.windowWidth(t),s.windowHeight(r),n.documentHeight=r,(s.android||s.mobileie)&&r>o&&n.vmMain&&n.vmMain.isLoaded&&n.blurActiveElement(),s.iphone&&!s.bodyscroll&&!s.standalone&&!s.app&&!s.ios7){var a=document.documentElement.clientHeight+60;document.documentElement.style.height=a+"px",setTimeout(n.enforceScroll,0)}n.autocomplete&&n.autocomplete.hide(),i!==t&&e&&s.mobile&&(n.ScreenManager&&n.ScreenManager.onResize(),n.menus&&n.menus.onResize()),s.mobile||n.fireCustomEvent("windowResize")}};k(),p(),n.isDemoMode()||(!s.offline&&window.gapi&&window.gapi.auth&&!gapiCalled&&GoogleApiLoaded(),!s.ios||s.app||s.standalone||n.settings.get(Settings.shownInstallInfo)||(n.messageQueue.pushMessage({text:'To add this app to the home screen: tap <span class="ath-action-icon">icon</span> then <strong>Add to Home Screen</strong>.',type:MessageType.InfoGray,bottom:!0}),n.settings.set(Settings.shownInstallInfo,!0))),s.mobile?(n.removeDOM("desktopMenu"),n.removeDOM("desktopSidebar"),n.removeDOM("contextMenuItem"),n.removeDOM("contextMenuLink"),n.removeDOM("exportData")):(n.removeDOM("phoneMenu"),n.removeDOM("mobileKeyboardToolbar"),n.removeDOM("paneSettings"),s.touch||(n.removeDOM("itemMenuPhone"),n.removeDOM("rightMenuPhone"))),window.onblur=function(){n.hasFocus=!1},window.onfocus=function(){n.hasFocus=!0,a.onFocusHandler()},n.vmMain=new d,n.timeline=new h,window.addEventListener("resize",k),window.addEventListener("orientationchange",k),window.addEventListener("orientationchange",p),window.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),window.addEventListener("drop",function(e){return e.preventDefault(),!1});var O=!1,L=!1;n.vmSetup=new l,n.vmSetup.loginState.subscribe(function(e){e==LoginState.LOGGED_IN?(f(),n.openMainPage()):e==LoginState.LOGGED_OUT&&(n.isSetupPageOpen||(n.isSetupPageOpen=!0,i.hasURLParam("login","true")||n.openSetupPage(),n.vmSetup.openLogin())),n.vmMain.setGDriveStatus(s.offline||!navigator.onLine?DriveStatus.Offline:DriveStatus.Connecting)}),n.vmSetup.init(),n.isDemoMode()&&f();var R=n.getLoginState();if(R!=LoginState.LOGGED_OUT&&r.initData(f),!s.mobile){var _={},N=function(){n.focusedPane.vmSearch.isFocused()||n.saveSelection("StoredSearch"),n.selectElement(n.focusedPane.vmSearch.elSearch,!1),n.sendEvent("Hotkey","Search")},F=function(){n.focusedPane.toggleOutlineVisibility(),n.sendEvent("Hotkey","Outline")},V=function(){var e=n.getSelectedItem();if(e){for(var t=0;t<e.elements.length;++t)n.scrollIntoView(e.getSpan(t),200);e.highlight()}n.sendEvent("Hotkey","GoTo")},B=function(){n.vmMain.applyPriorityToSelection(VMLIFlag.P0,!0),n.sendEvent("Hotkey","Important")},U=function(){n.vmMain.applyPriorityToSelection(VMLIFlag.P1,!0),n.sendEvent("Hotkey","Important")},q=function(){n.vmMain.applyPriorityToSelection(VMLIFlag.P2,!0),n.sendEvent("Hotkey","Important")},W=function(){n.vmMain.applyFnToSelection("isFlagged",!0),n.sendEvent("Hotkey","Star")},H=function(){n.vmMain.applyFnToSelection("isComplete",!0),n.sendEvent("Hotkey","Complete")},K=function(){n.vmMain.applyToSelection(function(e){return n.vmMain.zoomin(e),!1}),n.sendEvent("Hotkey","ZoomIn")},j=function(){if(n.focusedItem&&n.focusedItem.parent()){var e=n.focusedItem;n.vmMain.zoomout(e.parent(),e)}n.sendEvent("Hotkey","ZoomOut")},G=function(){n.vmMain.applyToSelection(function(e){e.toggleCollapsed()}),n.sendEvent("Hotkey","Collapse")},z=function(e){e.target!=document.body&&(n.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}),n.sendEvent("Hotkey","Indent"))},Y=function(e){e.target!=document.body&&(n.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}),n.sendEvent("Hotkey","Unindent"))},X=function(){},J=function(e){return e.target!=document.body?!1:void 0},$=function(e){var t=n.enumToString(KeyCode,e.normCode);return t?n.fireCustomEvent("key"+t):void n.sendEvent("Hotkey","FireEvent_"+t)},Q=function(){n.vmMain.removeFocusPane()};_[KeyCode.E]=_[KeyCode.F]=[{mods:{0:!0},call:N},{mods:{2:!0},call:N}],_[KeyCode.G]=[{mods:{0:!0},call:V},{mods:{2:!0},call:V}],_[KeyCode.O]=[{mods:{0:!0},call:F},{mods:{2:!0},call:F}],_[KeyCode.Slash]=[{mods:{0:!0},call:H},{mods:{2:!0},call:H}],_[KeyCode.D1]=[{mods:{0:!0},call:B},{mods:{2:!0},call:B}],_[KeyCode.D2]=[{mods:{0:!0},call:U},{mods:{2:!0},call:U}],_[KeyCode.D3]=[{mods:{0:!0},call:q},{mods:{2:!0},call:q}],_[KeyCode.Apos]=[{mods:{0:!0},call:W},{mods:{2:!0},call:W}],_[KeyCode.S]=[{mods:{0:!0},call:X},{mods:{2:!0},call:X}],_[KeyCode.Enter]=[{mods:{0:!0,4:!0},call:j},{mods:{2:!0,4:!0},call:j},{mods:{0:!0},call:K},{mods:{2:!0},call:K}],_[KeyCode.Comma]=[{mods:{0:!0},call:G},{mods:{2:!0},call:G}],_[KeyCode.Period]=[{mods:{0:!0},call:G},{mods:{2:!0},call:G}],_[KeyCode.LBracket]=[{mods:{0:!0},call:Y},{mods:{2:!0},call:Y}],_[KeyCode.RBracket]=[{mods:{0:!0},call:z},{mods:{2:!0},call:z}],_[KeyCode.Escape]=[{call:$}],_[KeyCode.F4]=[{mods:{4:!0},call:Q}],_[KeyCode.BackSpace]=[{call:J}],n.globalKeyDown=function(e){var t=_[e.normCode];if(t)if(n.isFunction(t))t(e);else{for(var r,i=0;i<t.length;i++)if(!(t[i].mods&&(t[i].mods[0]&&!e.ctrlKey||t[i].mods[1]&&!e.optKey||t[i].mods[2]&&!e.metaKey||t[i].mods[3]&&!e.altKey||t[i].mods[4]&&!e.shiftKey))){r=t[i];break}if(r){var o=r.call(e);if(o!==!1)return e.handled=!0,e.preventDefault(),!1}}else e.normCode===KeyCode.Ctrl&&n.vmMain.updateCursor(!0);if(s.android&&e.srcElement===document.body){if(w(e))return e.preventDefault(),!1;c.keydown(null,e)}},n.globalKeyUp=function(e){s.normalizeKeys(e),e.normCode===KeyCode.Ctrl&&n.vmMain.updateCursor(!1)},document.addEventListener("keydown",n.globalKeyDown),document.addEventListener("keyup",n.globalKeyUp,!0)}}catch(Z){n.reportError(Z),n.handleCriticalError()}})}),define("main",function(){});
//# sourceMappingURL=main-min.js.map