function _objectWithoutProperties(e,t){var i={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);return i}function _objectWithoutProperties(e,t){var i={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);return i}function _objectWithoutProperties(e,t){var i={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);return i}function _objectWithoutProperties(e,t){var i={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);return i}function _objectWithoutProperties(e,t){var i={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);return i}function _objectWithoutProperties(e,t){var i={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);return i}function GoogleClientAPILoaded(e){window.gapiClientCalled=!0,window.gapi?window.pendingGoogleClientLoad||(window.pendingGoogleClientLoad=!0,gapi.load("client:drive-realtime",{callback:window.GoogleApiLoaded,onerror:window.GoogleApiError,timeout:2e4,ontimeout:window.GoogleApiTimeout})):require(["globals"],function(t){t.reportError(new Error("Google Client API Load Failed"),e)})}function GoogleApiError(e){window.gapiLoadError=!0,window.pendingGoogleClientLoad=!1,require(["globals"],function(t){t.reportError(new Error("Google API Load Error"+arguments.length),e)})}function GoogleApiTimeout(e){window.gapiTimeout=!0,window.pendingGoogleClientLoad=!1,require(["globals"],function(t){t.reportError(new Error("Google API Load Timeout"),e)})}function GoogleApiLoaded(){if(window.pendingGoogleClientLoad=!1,!gapiCalled){if(gapiCalled=!0,gapi.auth.init(),window.location.hash.indexOf("offline=true")>=0||window.location.hash.indexOf("offline%22:true")>=0||window.location.hash.indexOf('offline":true')>=0||window.location.hash.indexOf("demo=true")>=0)return void log("%cOffline","color: pink");ShouldLog(LogLevels.Timing)&&log("GAPI Callback - Loaded:",log.now()),ShouldLog(LogLevels.Timing)&&log("Drive-Realtime API - Loaded: ",window.performance.now()),window.gapi&&window.gapi.drive&&window.gapi.drive.realtime?require(["globals","goog"],function(e,t){e.blockedMessage="",t.loadClientDefaultFile(),e.fireCustomEvent("gapiDriveLoaded")}):(window.gapiCalled=!1,window.gapiLoadError=!0,require(["globals","platform"],function(e,t){var i;i=gapi?gapi.drive?gapi.drive.realtime?"all exist":"gapi.drive.realtime":"gapi.drive":"gapi";var n=function(n){e.isBlocked=!0,t.app||n?(e.reportError(new Error("Error loading GAPI: "+i)),e.blockedMessage="There was an error loading the Google APIs."):(e.reportError(new Error("Extension blocked gapi from loading: "+i)),e.blockedMessage="An extension has blocked apis.google.com from loading."),e.vmMain&&e.vmMain.gdriveStatus(DriveStatus.Offline)};e.XHR({type:"GET",timeout:7e3,url:"https://api.moo.do/private/v1/info",cb:function(e){var t=!1;if(200===e.status){var i;try{i=JSON.parse(e.response),!0===i.success&&0===i.data.indexOf("Moo.do")&&(t=!0)}catch(e){}n(t?!1:!0)}else n(!0)}})})),window.gapi&&window.gapi.auth?require(["globals","util","platform","goog","VMSetup","data"],function(e,t,i,n,r,a){ShouldLog(LogLevels.Timing)&&log("Goog Callback - Loaded: ",log.now()),e.fireCustomEvent("gapiLoaded");var s=!1;i.ie&&!i.mobile||(s=n.checkTokenInHash());var o=t.hasURLParam("login","true"),c=t.hasURLParam("user"),l=s||o||c||e.getLoginState()==LoginState.LOGGED_IN,d=!1;if(c){var h=t.getURLParam("user"),u=e.getActiveUser();t.removeURLParam("user",!0),h!==u&&(e.setActiveUser(h),void 0!==u&&(a.clearData(function(){e.reload()},{Default:[Settings.activeUser]}),d=!0))}d||n.runAuthenticate(n.requestScopes,!0,!1,function(i){ShouldLog(LogLevels.Timing)&&log("Goog Authorized - Callback: ",log.now()),o&&t.removeURLParam("login",!0),i&&!i.error?(l&&(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_IN):e.setLoginState(LoginState.LOGGED_IN),n.loadClientDefaultFile(),e.openMainPage()),n.ensureRequiredScopesAreRequested()):n.requiredScopes!==n.requestScopes?(e.settings.reset(Settings.authScopes),n.runAuthenticate(n.requiredScopes,!0,!1,function(t){t&&!t.error?l&&(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_IN):e.setLoginState(LoginState.LOGGED_IN),n.loadClientDefaultFile(),e.runOnLoad(function(){e.openMainPage()})):(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_OUT):e.setLoginState(LoginState.LOGGED_OUT),t&&"immediate_failed"===t.error&&(e.authImmediateFailed=!0),e.runOnLoad(function(){e.openSetupPage()}))})):(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_OUT):e.setLoginState(LoginState.LOGGED_OUT),e.runOnLoad(function(){e.openSetupPage()}))})}):require(["globals"],function(e){try{e.PAssert(5503,!1,"Failed to load GAPI auth lib properly")}catch(t){e.reportError(t)}})}}var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function i(e,t){var i,n,r,a,s,o,c,l,d,h,u,p=t&&t.split("/"),m=f.map,g=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),e=e.split("/"),s=e.length-1,f.nodeIdCompat&&b.test(e[s])&&(e[s]=e[s].replace(b,"")),e=p.concat(e),d=0;d<e.length;d+=1)if("."===(u=e[d]))e.splice(d,1),d-=1;else if(".."===u){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||g)&&m){for(i=e.split("/"),d=i.length;d>0;d-=1){if(n=i.slice(0,d).join("/"),p)for(h=p.length;h>0;h-=1)if((r=m[p.slice(0,h).join("/")])&&(r=r[n])){a=r,o=d;break}if(a)break;!c&&g&&g[n]&&(c=g[n],l=d)}!a&&c&&(a=c,o=l),a&&(i.splice(0,o,a),e=i.join("/"))}return e}function n(t,i){return function(){var n=y.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),d.apply(e,n.concat([t,i]))}}function r(e){return function(t){return i(t,e)}}function a(e){return function(t){p[e]=t}}function s(i){if(t(m,i)){var n=m[i];delete m[i],g[i]=!0,l.apply(e,n)}if(!t(p,i)&&!t(g,i))throw new Error("No "+i);return p[i]}function o(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function c(e){return function(){return f&&f.config&&f.config[e]||{}}}var l,d,h,u,p={},m={},f={},g={},v=Object.prototype.hasOwnProperty,y=[].slice,b=/\.js$/;h=function(e,t){var n,a=o(e),c=a[0];return e=a[1],c&&(c=i(c,t),n=s(c)),c?e=n&&n.normalize?n.normalize(e,r(t)):i(e,t):(e=i(e,t),a=o(e),c=a[0],e=a[1],c&&(n=s(c))),{f:c?c+"!"+e:e,n:e,pr:c,p:n}},u={require:function(e){return n(e)},exports:function(e){var t=p[e];return void 0!==t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:c(e)}}},l=function(i,r,o,c){var l,d,f,v,y,b,S=[],E=typeof o;if(c=c||i,"undefined"===E||"function"===E){for(r=!r.length&&o.length?["require","exports","module"]:r,y=0;y<r.length;y+=1)if(v=h(r[y],c),"require"===(d=v.f))S[y]=u.require(i);else if("exports"===d)S[y]=u.exports(i),b=!0;else if("module"===d)l=S[y]=u.module(i);else if(t(p,d)||t(m,d)||t(g,d))S[y]=s(d);else{if(!v.p)throw new Error(i+" missing "+d);v.p.load(v.n,n(c,!0),a(d),{}),S[y]=p[d]}f=o?o.apply(p[i],S):void 0,i&&(l&&l.exports!==e&&l.exports!==p[i]?p[i]=l.exports:f===e&&b||(p[i]=f))}else i&&(p[i]=o)},requirejs=require=d=function(t,i,n,r,a){if("string"==typeof t)return u[t]?u[t](i):s(h(t,i).f);if(t&&!t.splice){if(f=t,f.deps&&d(f.deps,f.callback),!i)return;i.splice?(t=i,i=n,n=null):t=e}return i=i||function(){},"function"==typeof n&&(n=r,r=a),r?l(e,t,i,n):setTimeout(function(){l(e,t,i,n)},0),d},d.config=function(e){return d(e)},requirejs._defined=p,define=function(e,i,n){if("string"!=typeof e)throw new Error("Incorrect module build - no module name");i&&i.splice||(n=i,i=[]),t(p,e)||t(m,e)||(m[e]=[e,i,n])},define.amd={jQuery:!0}}(),define("lib/almond",function(){}),function(){!function(e){var t=this||(0,eval)("this"),i=t.document,n=t.navigator,r=t.jQuery,a=t.JSON;!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(module.exports||exports,require):"function"==typeof define&&define.amd?define("ko",["exports","require"],e):e(t.ko={})}(function(s,o){function c(e,t){return(null===e||typeof e in p)&&e===t}function l(t,i){var n;return function(){n||(n=setTimeout(function(){n=e,t()},i))}}function d(e,t){var i;return function(){clearTimeout(i),i=setTimeout(e,t)}}function h(e,t,i,n){u.d[e]={init:function(e,r,a,s,o){var c,l;return u.s(function(){var a=u.a.c(r()),s=!i!=!a,d=!l;(d||t||s!==c)&&(d&&u.Y.la()&&(l=u.a.ia(u.f.childNodes(e),!0)),s?(d||u.f.T(e,u.a.ia(l)),u.Ca(n?n(o,a):o,e)):u.f.ja(e),c=s)},null,{o:e}),{controlsDescendantBindings:!0}}},u.h.ha[e]=!1,u.f.Q[e]=!0}var u=void 0!==s?s:{};u.b=function(e,t){for(var i=e.split("."),n=u,r=0;r<i.length-1;r++)n=n[i[r]];n[i[i.length-1]]=t},u.A=function(e,t,i){e[t]=i},u.version="3.2.0",u.b("version",u.version),u.a=function(){function s(e,t){for(var i in e)e.hasOwnProperty(i)&&t(i,e[i])}function o(e,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function c(e,t){return e.__proto__=t,e}var l={__proto__:[]}instanceof Array,d={},h={};d[n&&/Firefox\/2/i.test(n.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],d.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),s(d,function(e,t){if(t.length)for(var i=0,n=t.length;i<n;i++)h[t[i]]=e});var p={propertychange:!0},m=i&&function(){for(var t=3,n=i.createElement("div"),r=n.getElementsByTagName("i");n.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e",r[0];);return 4<t?t:e}();return{vb:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],u:function(e,t){for(var i=0,n=e.length;i<n;i++)t(e[i],i)},m:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},qb:function(e,t,i){for(var n=0,r=e.length;n<r;n++)if(t.call(i,e[n],n))return e[n];return null},ua:function(e,t){var i=u.a.m(e,t);0<i?e.splice(i,1):0===i&&e.shift()},rb:function(e){e=e||[];for(var t=[],i=0,n=e.length;i<n;i++)0>u.a.m(t,e[i])&&t.push(e[i]);return t},Da:function(e,t){e=e||[];for(var i=[],n=0,r=e.length;n<r;n++)i.push(t(e[n],n));return i},ta:function(e,t){e=e||[];for(var i=[],n=0,r=e.length;n<r;n++)t(e[n],n)&&i.push(e[n]);return i},ga:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var i=0,n=t.length;i<n;i++)e.push(t[i]);return e},ea:function(e,t,i){var n=u.a.m(u.a.Xa(e),t);0>n?i&&e.push(t):i||e.splice(n,1)},xa:l,extend:o,za:c,Aa:l?c:o,G:s,na:function(e,t){if(!e)return e;var i,n={};for(i in e)e.hasOwnProperty(i)&&(n[i]=t(e[i],i,e));return n},Ka:function(e){for(;e.firstChild;)u.removeNode(e.firstChild)},oc:function(e){e=u.a.S(e);for(var t=i.createElement("div"),n=0,r=e.length;n<r;n++)t.appendChild(u.R(e[n]));return t},ia:function(e,t){for(var i=0,n=e.length,r=[];i<n;i++){var a=e[i].cloneNode(!0);r.push(t?u.R(a):a)}return r},T:function(e,t){if(u.a.Ka(e),t)for(var i=0,n=t.length;i<n;i++)e.appendChild(t[i])},Lb:function(e,t){var i=e.nodeType?[e]:e;if(0<i.length){for(var n=i[0],r=n.parentNode,a=0,s=t.length;a<s;a++)r.insertBefore(t[a],n);for(a=0,s=i.length;a<s;a++)u.removeNode(i[a])}},ka:function(e,t){if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.shift();if(1<e.length){var i=e[0],n=e[e.length-1];for(e.length=0;i!==n;)if(e.push(i),!(i=i.nextSibling))return;e.push(n)}}return e},Nb:function(e,t){7>m?e.setAttribute("selected",t):e.selected=t},cb:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},vc:function(e,t){return e=e||"",!(t.length>e.length)&&e.substring(0,t.length)===t},cc:function(e,t){if(e===t)return!0;if(11===e.nodeType)return!1;if(t.contains)return t.contains(3===e.nodeType?e.parentNode:e);if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;e&&e!=t;)e=e.parentNode;return!!e},Ja:function(e){return u.a.cc(e,e.ownerDocument.documentElement)},ob:function(e){return!!u.a.qb(e,u.a.Ja)},t:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},n:function(e,t,i){var n=m&&p[t];if(!n&&r)r(e).bind(t,i);else if(n||"function"!=typeof e.addEventListener){if(void 0===e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var a=function(t){i.call(e,t)},s="on"+t;e.attachEvent(s,a),u.a.w.da(e,function(){e.detachEvent(s,a)})}else e.addEventListener(t,i,!1)},oa:function(e,n){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var a;if("input"===u.a.t(e)&&e.type&&"click"==n.toLowerCase()?(a=e.type,a="checkbox"==a||"radio"==a):a=!1,r&&!a)r(e).trigger(n);else if("function"==typeof i.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");a=i.createEvent(h[n]||"HTMLEvents"),a.initEvent(n,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(a)}else if(a&&e.click)e.click();else{if(void 0===e.fireEvent)throw Error("Browser doesn't support triggering events");e.fireEvent("on"+n)}},c:function(e){return u.C(e)?e():e},Xa:function(e){return u.C(e)?e.v():e},Ba:function(e,t,i){if(t){var n=/\S+/g,r=e.className.match(n)||[];u.a.u(t.match(n),function(e){u.a.ea(r,e,i)}),e.className=r.join(" ")}},bb:function(t,i){var n=u.a.c(i);null!==n&&n!==e||(n="");var r=u.f.firstChild(t);!r||3!=r.nodeType||u.f.nextSibling(r)?u.f.T(t,[t.ownerDocument.createTextNode(n)]):r.data=n,u.a.fc(t)},Mb:function(e,t){if(e.name=t,7>=m)try{e.mergeAttributes(i.createElement("<input name='"+e.name+"'/>"),!1)}catch(e){}},fc:function(e){9<=m&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},dc:function(e){if(m){var t=e.style.width;e.style.width=0,e.style.width=t}},sc:function(e,t){e=u.a.c(e),t=u.a.c(t);for(var i=[],n=e;n<=t;n++)i.push(n);return i},S:function(e){for(var t=[],i=0,n=e.length;i<n;i++)t.push(e[i]);return t},yc:6===m,zc:7===m,L:m,xb:function(e,t){for(var i=u.a.S(e.getElementsByTagName("input")).concat(u.a.S(e.getElementsByTagName("textarea"))),n="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},r=[],a=i.length-1;0<=a;a--)n(i[a])&&r.push(i[a]);return r},pc:function(e){return"string"==typeof e&&(e=u.a.cb(e))?a&&a.parse?a.parse(e):new Function("return "+e)():null},eb:function(e,t,i){if(!a||!a.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return a.stringify(u.a.c(e),t,i)},qc:function(e,t,n){n=n||{};var r=n.params||{},a=n.includeFields||this.vb,o=e;if("object"==typeof e&&"form"===u.a.t(e))for(var o=e.action,c=a.length-1;0<=c;c--)for(var l=u.a.xb(e,a[c]),d=l.length-1;0<=d;d--)r[l[d].name]=l[d].value;t=u.a.c(t);var h=i.createElement("form");h.style.display="none",h.action=o,h.method="post";for(var p in t)e=i.createElement("input"),e.type="hidden",e.name=p,e.value=u.a.eb(u.a.c(t[p])),h.appendChild(e);s(r,function(e,t){var n=i.createElement("input");n.type="hidden",n.name=e,n.value=t,h.appendChild(n)}),i.body.appendChild(h),n.submitter?n.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)}}}(),u.b("utils",u.a),u.b("utils.arrayForEach",u.a.u),u.b("utils.arrayFirst",u.a.qb),u.b("utils.arrayFilter",u.a.ta),u.b("utils.arrayGetDistinctValues",u.a.rb),u.b("utils.arrayIndexOf",u.a.m),u.b("utils.arrayMap",u.a.Da),u.b("utils.arrayPushAll",u.a.ga),u.b("utils.arrayRemoveItem",u.a.ua),u.b("utils.extend",u.a.extend),u.b("utils.fieldsIncludedWithJsonPost",u.a.vb),u.b("utils.getFormFields",u.a.xb),u.b("utils.peekObservable",u.a.Xa),u.b("utils.postJson",u.a.qc),u.b("utils.parseJson",u.a.pc),u.b("utils.registerEventHandler",u.a.n),u.b("utils.stringifyJson",u.a.eb),u.b("utils.range",u.a.sc),u.b("utils.toggleDomNodeCssClass",u.a.Ba),u.b("utils.triggerEvent",u.a.oa),u.b("utils.unwrapObservable",u.a.c),u.b("utils.objectForEach",u.a.G),u.b("utils.addOrRemoveItem",u.a.ea),u.b("unwrap",u.a.c),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,i=Array.prototype.slice.call(arguments);return e=i.shift(),function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}}),u.a.e=new function(){function t(t,a){var s=t[n];if(!s||"null"===s||!r[s]){if(!a)return e;s=t[n]="ko"+i++,r[s]={}}return r[s]}var i=0,n="__ko__"+(new Date).getTime(),r={};return{get:function(i,n){var r=t(i,!1);return r===e?e:r[n]},set:function(i,n,r){r===e&&t(i,!1)===e||(t(i,!0)[n]=r)},clear:function(e){var t=e[n];return!!t&&(delete r[t],e[n]=null,!0)},F:function(){return i+++n}}},u.b("utils.domData",u.a.e),u.b("utils.domData.clear",u.a.e.clear),u.a.w=new function(){function t(t,i){var r=u.a.e.get(t,n);return r===e&&i&&(r=[],u.a.e.set(t,n,r)),r}function i(e){var n=t(e,!1);if(n)for(var n=n.slice(0),r=0;r<n.length;r++)n[r](e);if(u.a.e.clear(e),u.a.w.cleanExternalData(e),s[e.nodeType])for(n=e.firstChild;e=n;)n=e.nextSibling,8===e.nodeType&&i(e)}var n=u.a.e.F(),a={1:!0,8:!0,9:!0},s={1:!0,9:!0};return{da:function(e,i){if("function"!=typeof i)throw Error("Callback must be a function");t(e,!0).push(i)},Kb:function(i,r){var a=t(i,!1);a&&(u.a.ua(a,r),0==a.length&&u.a.e.set(i,n,e))},R:function(e){if(a[e.nodeType]&&(i(e),s[e.nodeType])){var t=[];u.a.ga(t,e.getElementsByTagName("*"));for(var n=0,r=t.length;n<r;n++)i(t[n])}return e},removeNode:function(e){u.R(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){r&&"function"==typeof r.cleanData&&r.cleanData([e])}}},u.R=u.a.w.R,u.removeNode=u.a.w.removeNode,u.b("cleanNode",u.R),u.b("removeNode",u.removeNode),u.b("utils.domNodeDisposal",u.a.w),u.b("utils.domNodeDisposal.addDisposeCallback",u.a.w.da),u.b("utils.domNodeDisposal.removeDisposeCallback",u.a.w.Kb),function(){u.a.ba=function(e){var n;if(r){if(r.parseHTML)n=r.parseHTML(e)||[];else if((n=r.clean([e]))&&n[0]){for(e=n[0];e.parentNode&&11!==e.parentNode.nodeType;)e=e.parentNode;e.parentNode&&e.parentNode.removeChild(e)}}else{var a=u.a.cb(e).toLowerCase();for(n=i.createElement("div"),a=a.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!a.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!a.indexOf("<td")||!a.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],e="ignored<div>"+a[1]+e+a[2]+"</div>","function"==typeof t.innerShiv?n.appendChild(t.innerShiv(e)):n.innerHTML=e;a[0]--;)n=n.lastChild;n=u.a.S(n.lastChild.childNodes)}return n},u.a.$a=function(t,i){if(u.a.Ka(t),null!==(i=u.a.c(i))&&i!==e)if("string"!=typeof i&&(i=i.toString()),r)r(t).html(i);else for(var n=u.a.ba(i),a=0;a<n.length;a++)t.appendChild(n[a])}}(),u.b("utils.parseHtmlFragment",u.a.ba),u.b("utils.setHtml",u.a.$a),u.D=function(){function t(e,i){if(e)if(8==e.nodeType){var n=u.D.Gb(e.nodeValue);null!=n&&i.push({bc:e,mc:n})}else if(1==e.nodeType)for(var n=0,r=e.childNodes,a=r.length;n<a;n++)t(r[n],i)}var i={};return{Ua:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return i[t]=e,"\x3c!--[ko_memo:"+t+"]--\x3e"},Rb:function(t,n){var r=i[t];if(r===e)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return r.apply(null,n||[]),!0}finally{delete i[t]}},Sb:function(e,i){var n=[];t(e,n);for(var r=0,a=n.length;r<a;r++){var s=n[r].bc,o=[s];i&&u.a.ga(o,i),u.D.Rb(n[r].mc,o),s.nodeValue="",s.parentNode&&s.parentNode.removeChild(s)}},Gb:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),u.b("memoization",u.D),u.b("memoization.memoize",u.D.Ua),u.b("memoization.unmemoize",u.D.Rb),u.b("memoization.parseMemoText",u.D.Gb),u.b("memoization.unmemoizeDomNodeAndDescendants",u.D.Sb),u.La={throttle:function(e,t){e.throttleEvaluation=t;var i=null;return u.j({read:e,write:function(n){clearTimeout(i),i=setTimeout(function(){e(n)},t)}})},rateLimit:function(e,t){var i,n,r;"number"==typeof t?i=t:(i=t.timeout,n=t.method),r="notifyWhenChangesStop"==n?d:l,e.Ta(function(e){return r(e,i)})},notify:function(e,t){e.equalityComparer="always"==t?null:c}};var p={undefined:1,boolean:1,number:1,string:1};u.b("extenders",u.La),u.Pb=function(e,t,i){this.target=e,this.wa=t,this.ac=i,this.Cb=!1,u.A(this,"dispose",this.K)},u.Pb.prototype.K=function(){this.Cb=!0,this.ac()},u.P=function(){u.a.Aa(this,u.P.fn),this.M={}};var m="change",f={U:function(e,t,i){var n=this;i=i||m;var r=new u.Pb(n,t?e.bind(t):e,function(){u.a.ua(n.M[i],r),n.nb&&n.nb()});return n.va&&n.va(i),n.M[i]||(n.M[i]=[]),n.M[i].push(r),r},notifySubscribers:function(e,t){if(t=t||m,this.Ab(t))try{u.k.Ea();for(var i,n=this.M[t].slice(0),r=0;i=n[r];++r)i.Cb||i.wa(e)}finally{u.k.end()}},Ta:function(e){var t,i,n,r=this,a=u.C(r);r.qa||(r.qa=r.notifySubscribers,r.notifySubscribers=function(e,t){t&&t!==m?"beforeChange"===t?r.kb(e):r.qa(e,t):r.lb(e)});var s=e(function(){a&&n===r&&(n=r()),t=!1,r.Pa(i,n)&&r.qa(i=n)});r.lb=function(e){t=!0,n=e,s()},r.kb=function(e){t||(i=e,r.qa(e,"beforeChange"))}},Ab:function(e){return this.M[e]&&this.M[e].length},yb:function(){var e=0;return u.a.G(this.M,function(t,i){e+=i.length}),e},Pa:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},extend:function(e){var t=this;return e&&u.a.G(e,function(e,i){var n=u.La[e];"function"==typeof n&&(t=n(t,i)||t)}),t}};u.A(f,"subscribe",f.U),u.A(f,"extend",f.extend),u.A(f,"getSubscriptionsCount",f.yb),u.a.xa&&u.a.za(f,Function.prototype),u.P.fn=f,u.Db=function(e){return null!=e&&"function"==typeof e.U&&"function"==typeof e.notifySubscribers},u.b("subscribable",u.P),u.b("isSubscribable",u.Db),u.Y=u.k=function(){function e(e){n.push(i),i=e}function t(){i=n.pop()}var i,n=[],r=0;return{Ea:e,end:t,Jb:function(e){if(i){if(!u.Db(e))throw Error("Only subscribable things can act as dependencies");i.wa(e,e.Vb||(e.Vb=++r))}},B:function(i,n,r){try{return e(),i.apply(n,r||[])}finally{t()}},la:function(){if(i)return i.s.la()},ma:function(){if(i)return i.ma}}}(),u.b("computedContext",u.Y),u.b("computedContext.getDependenciesCount",u.Y.la),u.b("computedContext.isInitial",u.Y.ma),u.b("computedContext.isSleeping",u.Y.Ac),u.p=function(e){function t(){return 0<arguments.length?(t.Pa(i,arguments[0])&&(t.X(),i=arguments[0],t.W()),this):(u.k.Jb(t),i)}var i=e;return u.P.call(t),u.a.Aa(t,u.p.fn),t.v=function(){return i},t.W=function(){t.notifySubscribers(i)},t.X=function(){t.notifySubscribers(i,"beforeChange")},u.A(t,"peek",t.v),u.A(t,"valueHasMutated",t.W),u.A(t,"valueWillMutate",t.X),t},u.p.fn={equalityComparer:c};var g=u.p.rc="__ko_proto__";u.p.fn[g]=u.p,u.a.xa&&u.a.za(u.p.fn,u.P.fn),u.Ma=function(t,i){return null!==t&&t!==e&&t[g]!==e&&(t[g]===i||u.Ma(t[g],i))},u.C=function(e){return u.Ma(e,u.p)},u.Ra=function(e){return!!("function"==typeof e&&e[g]===u.p||"function"==typeof e&&e[g]===u.j&&e.hc)},u.b("observable",u.p),u.b("isObservable",u.C),u.b("isWriteableObservable",u.Ra),u.b("isWritableObservable",u.Ra),u.aa=function(e){if("object"!=typeof(e=e||[])||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=u.p(e),u.a.Aa(e,u.aa.fn),e.extend({trackArrayChanges:!0})},u.aa.fn={remove:function(e){for(var t=this.v(),i=[],n="function"!=typeof e||u.C(e)?function(t){return t===e}:e,r=0;r<t.length;r++){var a=t[r];n(a)&&(0===i.length&&this.X(),i.push(a),t.splice(r,1),r--)}return i.length&&this.W(),i},removeAll:function(t){if(t===e){var i=this.v(),n=i.slice(0);return this.X(),i.splice(0,i.length),this.W(),n}return t?this.remove(function(e){return 0<=u.a.m(t,e)}):[]},destroy:function(e){var t=this.v(),i="function"!=typeof e||u.C(e)?function(t){return t===e}:e;this.X();for(var n=t.length-1;0<=n;n--)i(t[n])&&(t[n]._destroy=!0);this.W()},destroyAll:function(t){return t===e?this.destroy(function(){return!0}):t?this.destroy(function(e){return 0<=u.a.m(t,e)}):[]},indexOf:function(e){var t=this();return u.a.m(t,e)},replace:function(e,t){var i=this.indexOf(e);0<=i&&(this.X(),this.v()[i]=t,this.W())}},u.a.u("pop push reverse shift sort splice unshift".split(" "),function(e){u.aa.fn[e]=function(){var t=this.v();return this.X(),this.sb(t,e,arguments),t=t[e].apply(t,arguments),this.W(),t}}),u.a.u(["slice"],function(e){u.aa.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),u.a.xa&&u.a.za(u.aa.fn,u.p.fn),u.b("observableArray",u.aa);var v="arrayChange";u.La.trackArrayChanges=function(e){function t(){if(!i){i=!0;var t=e.notifySubscribers;e.notifySubscribers=function(e,i){return i&&i!==m||++r,t.apply(this,arguments)};var a=[].concat(e.v()||[]);n=null,e.U(function(t){if(t=[].concat(t||[]),e.Ab(v)){var i;(!n||1<r)&&(n=u.a.Fa(a,t,{sparse:!0})),i=n,i.length&&e.notifySubscribers(i,v)}a=t,n=null,r=0})}}if(!e.sb){var i=!1,n=null,r=0,a=e.U;e.U=e.subscribe=function(e,i,n){return n===v&&t(),a.apply(this,arguments)},e.sb=function(e,t,a){function s(e,t,i){return o[o.length]={status:e,value:t,index:i}}if(i&&!r){var o=[],c=e.length,l=a.length,d=0;switch(t){case"push":d=c;case"unshift":for(t=0;t<l;t++)s("added",a[t],d+t);break;case"pop":d=c-1;case"shift":c&&s("deleted",e[d],d);break;case"splice":t=Math.min(Math.max(0,0>a[0]?c+a[0]:a[0]),c);for(var c=1===l?c:Math.min(t+(a[1]||0),c),l=t+l-2,d=Math.max(c,l),h=[],p=[],m=2;t<d;++t,++m)t<c&&p.push(s("deleted",e[t],t)),t<l&&h.push(s("added",a[m],t));u.a.wb(p,h);break;default:return}n=o}}}},u.s=u.j=function(t,i,n){function r(){u.a.G(D,function(e,t){t.K()}),D={}}function a(){r(),M=0,g=!0,p=!1}function s(){var e=c.throttleEvaluation;e&&0<=e?(clearTimeout(_),_=setTimeout(o,e)):c.ib?c.ib():o()}function o(t){if(m){if(y)throw Error("A 'pure' computed must not be called recursively")}else if(!g){if(P&&P()){if(!f)return void T()}else f=!1;if(m=!0,b)try{var n={};u.k.Ea({wa:function(e,t){n[t]||(n[t]=1,++M)},s:c,ma:e}),M=0,h=v.call(i)}finally{u.k.end(),m=!1}else try{var r=D,a=M;u.k.Ea({wa:function(e,t){g||(a&&r[t]?(D[t]=r[t],++M,delete r[t],--a):D[t]||(D[t]=e.U(s),++M))},s:c,ma:y?e:!M}),D={},M=0;try{var o=i?v.call(i):v()}finally{u.k.end(),a&&u.a.G(r,function(e,t){t.K()}),p=!1}c.Pa(h,o)&&(c.notifySubscribers(h,"beforeChange"),h=o,!0!==t&&c.notifySubscribers(h))}finally{m=!1}M||T()}}function c(){if(0<arguments.length){if("function"!=typeof S)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return S.apply(i,arguments),this}return u.k.Jb(c),p&&o(!0),h}function l(){return p&&!M&&o(!0),h}function d(){return p||0<M}var h,p=!0,m=!1,f=!1,g=!1,v=t,y=!1,b=!1;if(v&&"object"==typeof v?(n=v,v=n.read):(n=n||{},v||(v=n.read)),"function"!=typeof v)throw Error("Pass a function that returns the value of the ko.computed");var S=n.write,E=n.disposeWhenNodeIsRemoved||n.o||null,C=n.disposeWhen||n.Ia,P=C,T=a,D={},M=0,_=null;i||(i=n.owner),u.P.call(c),u.a.Aa(c,u.j.fn),c.v=l,c.la=function(){return M},c.hc="function"==typeof n.write,c.K=function(){T()},c.Z=d;var I=c.Ta;return c.Ta=function(e){I.call(c,e),c.ib=function(){c.kb(h),p=!0,c.lb(c)}},n.pure?(b=y=!0,c.va=function(){b&&(b=!1,o(!0))},c.nb=function(){c.yb()||(r(),b=p=!0)}):n.deferEvaluation&&(c.va=function(){l(),delete c.va}),u.A(c,"peek",c.v),u.A(c,"dispose",c.K),u.A(c,"isActive",c.Z),u.A(c,"getDependenciesCount",c.la),E&&(f=!0,E.nodeType&&(P=function(){return!u.a.Ja(E)||C&&C()})),b||n.deferEvaluation||o(),E&&d()&&E.nodeType&&(T=function(){u.a.w.Kb(E,T),a()},u.a.w.da(E,T)),c},u.jc=function(e){return u.Ma(e,u.j)},f=u.p.rc,u.j[f]=u.p,u.j.fn={equalityComparer:c},u.j.fn[f]=u.j,u.a.xa&&u.a.za(u.j.fn,u.P.fn),u.b("dependentObservable",u.j),u.b("computed",u.j),u.b("isComputed",u.jc),u.Ib=function(e,t){return"function"==typeof e?u.s(e,t,{pure:!0}):(e=u.a.extend({},e),e.pure=!0,u.s(e,t))},u.b("pureComputed",u.Ib),function(){function t(r,a,s){if(s=s||new n,"object"!=typeof(r=a(r))||null===r||r===e||r instanceof Date||r instanceof String||r instanceof Number||r instanceof Boolean)return r;var o=r instanceof Array?[]:{};return s.save(r,o),i(r,function(i){var n=a(r[i]);switch(typeof n){case"boolean":case"number":case"string":case"function":o[i]=n;break;case"object":case"undefined":var c=s.get(n);o[i]=c!==e?c:t(n,a,s)}}),o}function i(e,t){if(e instanceof Array){for(var i=0;i<e.length;i++)t(i);"function"==typeof e.toJSON&&t("toJSON")}else for(i in e)t(i)}function n(){this.keys=[],this.hb=[]}u.Qb=function(e){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(e,function(e){for(var t=0;u.C(e)&&10>t;t++)e=e();return e})},u.toJSON=function(e,t,i){return e=u.Qb(e),u.a.eb(e,t,i)},n.prototype={save:function(e,t){var i=u.a.m(this.keys,e);0<=i?this.hb[i]=t:(this.keys.push(e),this.hb.push(t))},get:function(t){return t=u.a.m(this.keys,t),0<=t?this.hb[t]:e}}}(),u.b("toJS",u.Qb),u.b("toJSON",u.toJSON),function(){u.i={q:function(t){switch(u.a.t(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?u.a.e.get(t,u.d.options.Va):7>=u.a.L?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?u.i.q(t.options[t.selectedIndex]):e;default:return t.value}},ca:function(t,i,n){switch(u.a.t(t)){case"option":switch(typeof i){case"string":u.a.e.set(t,u.d.options.Va,e),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=i;break;default:u.a.e.set(t,u.d.options.Va,i),t.__ko__hasDomDataOptionValue__=!0,t.value="number"==typeof i?i:""}break;case"select":""!==i&&null!==i||(i=e);for(var r,a=-1,s=0,o=t.options.length;s<o;++s)if((r=u.i.q(t.options[s]))==i||""==r&&i===e){a=s;break}(n||0<=a||i===e&&1<t.size)&&(t.selectedIndex=a);break;default:null!==i&&i!==e||(i=""),t.value=i}}}}(),u.b("selectExtensions",u.i),u.b("selectExtensions.readValue",u.i.q),u.b("selectExtensions.writeValue",u.i.ca),u.h=function(){function e(e){e=u.a.cb(e),123===e.charCodeAt(0)&&(e=e.slice(1,-1));var t,i,s=[],o=e.match(n),c=0;if(o){o.push(",");for(var l,d=0;l=o[d];++d){var h=l.charCodeAt(0);if(44===h){if(0>=c){t&&s.push(i?{key:t,value:i.join("")}:{unknown:t}),t=i=c=0;continue}}else if(58===h){if(!i)continue}else if(47===h&&d&&1<l.length)(h=o[d-1].match(r))&&!a[h[0]]&&(e=e.substr(e.indexOf(l)+1),o=e.match(n),o.push(","),d=-1,l="/");else if(40===h||123===h||91===h)++c;else if(41===h||125===h||93===h)--c;else if(!t&&!i){t=34===h||39===h?l.slice(1,-1):l;continue}i?i.push(l):i=[l]}}return s}var t=["true","false","null","undefined"],i=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,n=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),r=/[\])"'A-Za-z0-9_$]+$/,a={in:1,return:1,typeof:1},s={};return{ha:[],V:s,Wa:e,ya:function(n,r){function a(e,n){var r;if(!d){var h=u.getBindingHandler(e);if(h&&h.preprocess&&!(n=h.preprocess(n,e,a)))return;(h=s[e])&&(r=n,0<=u.a.m(t,r)?r=!1:(h=r.match(i),r=null!==h&&(h[1]?"Object("+h[1]+")"+h[2]:r)),h=r),h&&c.push("'"+e+"':function(_z){"+r+"=_z}")}l&&(n="function(){return "+n+" }"),o.push("'"+e+"':"+n)}r=r||{};var o=[],c=[],l=r.valueAccessors,d=r.bindingParams,h="string"==typeof n?e(n):n;return u.a.u(h,function(e){a(e.key||e.unknown,e.value)}),c.length&&a("_ko_property_writers","{"+c.join(",")+" }"),o.join(",")},lc:function(e,t){for(var i=0;i<e.length;i++)if(e[i].key==t)return!0;return!1},pa:function(e,t,i,n,r){e&&u.C(e)?!u.Ra(e)||r&&e.v()===n||e(n):(e=t.get("_ko_property_writers"))&&e[i]&&e[i](n)}}}(),u.b("expressionRewriting",u.h),u.b("expressionRewriting.bindingRewriteValidators",u.h.ha),u.b("expressionRewriting.parseObjectLiteral",u.h.Wa),u.b("expressionRewriting.preProcessBindings",u.h.ya),u.b("expressionRewriting._twoWayBindings",u.h.V),u.b("jsonExpressionRewriting",u.h),u.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",u.h.ya),function(){function e(e){return 8==e.nodeType&&s.test(a?e.text:e.nodeValue)}function t(e){return 8==e.nodeType&&o.test(a?e.text:e.nodeValue)}function n(i,n){for(var r=i,a=1,s=[];r=r.nextSibling;){if(t(r)&&0===--a)return s;s.push(r),e(r)&&a++}
if(!n)throw Error("Cannot find closing comment tag to match: "+i.nodeValue);return null}function r(e,t){var i=n(e,t);return i?0<i.length?i[i.length-1].nextSibling:e.nextSibling:null}var a=i&&"\x3c!--test--\x3e"===i.createComment("test").text,s=a?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,o=a?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,c={ul:!0,ol:!0};u.f={Q:{},childNodes:function(t){return e(t)?n(t):t.childNodes},ja:function(t){if(e(t)){t=u.f.childNodes(t);for(var i=0,n=t.length;i<n;i++)u.removeNode(t[i])}else u.a.Ka(t)},T:function(t,i){if(e(t)){u.f.ja(t);for(var n=t.nextSibling,r=0,a=i.length;r<a;r++)n.parentNode.insertBefore(i[r],n)}else u.a.T(t,i)},Hb:function(t,i){e(t)?t.parentNode.insertBefore(i,t.nextSibling):t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i)},Bb:function(t,i,n){n?e(t)?t.parentNode.insertBefore(i,n.nextSibling):n.nextSibling?t.insertBefore(i,n.nextSibling):t.appendChild(i):u.f.Hb(t,i)},firstChild:function(i){return e(i)?!i.nextSibling||t(i.nextSibling)?null:i.nextSibling:i.firstChild},nextSibling:function(i){return e(i)&&(i=r(i)),i.nextSibling&&t(i.nextSibling)?null:i.nextSibling},gc:e,xc:function(e){return(e=(a?e.text:e.nodeValue).match(s))?e[1]:null},Fb:function(i){if(c[u.a.t(i)]){var n=i.firstChild;if(n)do{if(1===n.nodeType){var a;a=n.firstChild;var s=null;if(a)do{if(s)s.push(a);else if(e(a)){var o=r(a,!0);o?a=o:s=[a]}else t(a)&&(s=[a])}while(a=a.nextSibling);if(a=s)for(s=n.nextSibling,o=0;o<a.length;o++)s?i.insertBefore(a[o],s):i.appendChild(a[o])}}while(n=n.nextSibling)}}}}(),u.b("virtualElements",u.f),u.b("virtualElements.allowedBindings",u.f.Q),u.b("virtualElements.emptyNode",u.f.ja),u.b("virtualElements.insertAfter",u.f.Bb),u.b("virtualElements.prepend",u.f.Hb),u.b("virtualElements.setDomNodeChildren",u.f.T),function(){u.J=function(){this.Yb={}},u.a.extend(u.J.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind")||u.g.getComponentNameForNode(e);case 8:return u.f.gc(e);default:return!1}},getBindings:function(e,t){var i=this.getBindingsString(e,t),i=i?this.parseBindingsString(i,t,e):null;return u.g.mb(i,e,t,!1)},getBindingAccessors:function(e,t){var i=this.getBindingsString(e,t),i=i?this.parseBindingsString(i,t,e,{valueAccessors:!0}):null;return u.g.mb(i,e,t,!0)},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return u.f.xc(e);default:return null}},parseBindingsString:function(e,t,i,n){try{var r,a=this.Yb,s=e+(n&&n.valueAccessors||"");if(!(r=a[s])){var o,c="with($context){with($data||{}){return{"+u.h.ya(e,n)+"}}}";o=new Function("$context","$element",c),r=a[s]=o}return r(t,i)}catch(t){throw t.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+t.message,t}}}),u.J.instance=new u.J}(),u.b("bindingProvider",u.J),function(){function i(e){return function(){return e}}function n(e){return e()}function a(e){return u.a.na(u.k.B(e),function(t,i){return function(){return e()[i]}})}function s(e,t){return a(this.getBindings.bind(this,e,t))}function o(e,t,i){var n,r=u.f.firstChild(t),a=u.J.instance,s=a.preprocessNode;if(s){for(;n=r;)r=u.f.nextSibling(n),s.call(a,n);r=u.f.firstChild(t)}for(;n=r;)r=u.f.nextSibling(n),c(e,n,i)}function c(e,t,i){var n=!0,r=1===t.nodeType;r&&u.f.Fb(t),(r&&i||u.J.instance.nodeHasBindings(t))&&(n=d(t,null,e,i).shouldBindDescendants),n&&!p[u.a.t(t)]&&o(e,t,!r)}function l(e){var t=[],i={},n=[];return u.a.G(e,function r(a){if(!i[a]){var s=u.getBindingHandler(a);s&&(s.after&&(n.push(a),u.a.u(s.after,function(t){if(e[t]){if(-1!==u.a.m(n,t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+n.join(", "));r(t)}}),n.length--),t.push({key:a,zb:s})),i[a]=!0}}),t}function d(t,i,r,a){var o=u.a.e.get(t,m);if(!i){if(o)throw Error("You cannot apply bindings multiple times to the same element.");u.a.e.set(t,m,!0)}!o&&a&&u.Ob(t,r);var c;if(i&&"function"!=typeof i)c=i;else{var d=u.J.instance,h=d.getBindingAccessors||s,p=u.j(function(){return(c=i?i(r,t):h.call(d,t,r))&&r.I&&r.I(),c},null,{o:t});c&&p.Z()||(p=null)}var f;if(c){var g=p?function(e){return function(){return n(p()[e])}}:function(e){return c[e]},v=function(){return u.a.na(p?p():c,n)};v.get=function(e){return c[e]&&n(g(e))},v.has=function(e){return e in c},a=l(c),u.a.u(a,function(i){var n=i.zb.init,a=i.zb.update,s=i.key;if(8===t.nodeType&&!u.f.Q[s])throw Error("The binding '"+s+"' cannot be used with virtual elements");try{"function"==typeof n&&u.k.B(function(){var i=n(t,g(s),v,r.$data,r);if(i&&i.controlsDescendantBindings){if(f!==e)throw Error("Multiple bindings ("+f+" and "+s+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");f=s}}),"function"==typeof a&&u.j(function(){a(t,g(s),v,r.$data,r)},null,{o:t})}catch(e){throw e.message='Unable to process binding "'+s+": "+c[s]+'"\nMessage: '+e.message,e}})}return{shouldBindDescendants:f===e}}function h(e){return e&&e instanceof u.N?e:new u.N(e)}u.d={};var p={script:!0};u.getBindingHandler=function(e){return u.d[e]},u.N=function(t,i,n,r){var a,s=this,o="function"==typeof t&&!u.C(t),c=u.j(function(){var e=o?t():t,a=u.a.c(e);return i?(i.I&&i.I(),u.a.extend(s,i),c&&(s.I=c)):(s.$parents=[],s.$root=a,s.ko=u),s.$rawData=e,s.$data=a,n&&(s[n]=a),r&&r(s,i,a),s.$data},null,{Ia:function(){return a&&!u.a.ob(a)},o:!0});c.Z()&&(s.I=c,c.equalityComparer=null,a=[],c.Tb=function(t){a.push(t),u.a.w.da(t,function(t){u.a.ua(a,t),a.length||(c.K(),s.I=c=e)})})},u.N.prototype.createChildContext=function(e,t,i){return new u.N(e,this,t,function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),i&&i(e)})},u.N.prototype.extend=function(e){return new u.N(this.I||this.$data,this,null,function(t,i){t.$rawData=i.$rawData,u.a.extend(t,"function"==typeof e?e():e)})};var m=u.a.e.F(),f=u.a.e.F();u.Ob=function(e,t){if(2!=arguments.length)return u.a.e.get(e,f);u.a.e.set(e,f,t),t.I&&t.I.Tb(e)},u.ra=function(e,t,i){return 1===e.nodeType&&u.f.Fb(e),d(e,t,h(i),!0)},u.Wb=function(e,t,n){return n=h(n),u.ra(e,"function"==typeof t?a(t.bind(null,n,e)):u.a.na(t,i),n)},u.Ca=function(e,t){1!==t.nodeType&&8!==t.nodeType||o(h(e),t,!0)},u.pb=function(e,i){if(!r&&t.jQuery&&(r=t.jQuery),i&&1!==i.nodeType&&8!==i.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");i=i||t.document.body,c(h(e),i,!0)},u.Ha=function(t){switch(t.nodeType){case 1:case 8:var i=u.Ob(t);if(i)return i;if(t.parentNode)return u.Ha(t.parentNode)}return e},u.$b=function(t){return(t=u.Ha(t))?t.$data:e},u.b("bindingHandlers",u.d),u.b("applyBindings",u.pb),u.b("applyBindingsToDescendants",u.Ca),u.b("applyBindingAccessorsToNode",u.ra),u.b("applyBindingsToNode",u.Wb),u.b("contextFor",u.Ha),u.b("dataFor",u.$b)}(),function(e){function t(t,n){var s,o=r.hasOwnProperty(t)?r[t]:e;o||(o=r[t]=new u.P,i(t,function(e){a[t]=e,delete r[t],s?o.notifySubscribers(e):setTimeout(function(){o.notifySubscribers(e)},0)}),s=!0),o.U(n)}function i(e,t){n("getConfig",[e],function(i){i?n("loadComponent",[e,i],function(e){t(e)}):t(null)})}function n(t,i,r,a){a||(a=u.g.loaders.slice(0));var s=a.shift();if(s){var o=s[t];if(o){var c=!1;if(o.apply(s,i.concat(function(e){c?r(null):null!==e?r(e):n(t,i,r,a)}))!==e&&(c=!0,!s.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else n(t,i,r,a)}else r(null)}var r={},a={};u.g={get:function(i,n){var r=a.hasOwnProperty(i)?a[i]:e;r?setTimeout(function(){n(r)},0):t(i,n)},tb:function(e){delete a[e]},jb:n},u.g.loaders=[],u.b("components",u.g),u.b("components.get",u.g.get),u.b("components.clearCachedDefinition",u.g.tb)}(),function(){function e(e,t,i,n){function r(){0==--o&&n(a)}var a={},o=2,c=i.template;i=i.viewModel,c?s(t,c,function(t){u.g.jb("loadTemplate",[e,t],function(e){a.template=e,r()})}):r(),i?s(t,i,function(t){u.g.jb("loadViewModel",[e,t],function(e){a[d]=e,r()})}):r()}function n(e,t,i){if("function"==typeof t)i(function(e){return new t(e)});else if("function"==typeof t[d])i(t[d]);else if("instance"in t){var r=t.instance;i(function(){return r})}else"viewModel"in t?n(e,t.viewModel,i):e("Unknown viewModel value: "+t)}function r(e){switch(u.a.t(e)){case"script":return u.a.ba(e.text);case"textarea":return u.a.ba(e.value);case"template":if(a(e.content))return u.a.ia(e.content.childNodes)}return u.a.ia(e.childNodes)}function a(e){return t.DocumentFragment?e instanceof DocumentFragment:e&&11===e.nodeType}function s(e,i,n){"string"==typeof i.require?o||t.require?(o||t.require)([i.require],n):e("Uses require, but no AMD loader is present"):n(i)}function c(e){return function(t){throw Error("Component '"+e+"': "+t)}}var l={};u.g.tc=function(e,t){if(!t)throw Error("Invalid configuration for "+e);if(u.g.Qa(e))throw Error("Component "+e+" is already registered");l[e]=t},u.g.Qa=function(e){return e in l},u.g.wc=function(e){delete l[e],u.g.tb(e)},u.g.ub={getConfig:function(e,t){t(l.hasOwnProperty(e)?l[e]:null)},loadComponent:function(t,i,n){var r=c(t);s(r,i,function(i){e(t,r,i,n)})},loadTemplate:function(e,n,s){if(e=c(e),"string"==typeof n)s(u.a.ba(n));else if(n instanceof Array)s(n);else if(a(n))s(u.a.S(n.childNodes));else if(n.element)if(n=n.element,t.HTMLElement?n instanceof HTMLElement:n&&n.tagName&&1===n.nodeType)s(r(n));else if("string"==typeof n){var o=i.getElementById(n);o?s(r(o)):e("Cannot find element with ID "+n)}else e("Unknown element type: "+n);else e("Unknown template value: "+n)},loadViewModel:function(e,t,i){n(c(e),t,i)}};var d="createViewModel";u.b("components.register",u.g.tc),u.b("components.isRegistered",u.g.Qa),u.b("components.unregister",u.g.wc),u.b("components.defaultLoader",u.g.ub),u.g.loaders.push(u.g.ub),u.g.Ub=l}(),function(){function e(e,i){var n=e.getAttribute("params");if(n){var n=t.parseBindingsString(n,i,e,{valueAccessors:!0,bindingParams:!0}),n=u.a.na(n,function(t){return u.s(t,null,{o:e})}),r=u.a.na(n,function(t){return t.Z()?u.s(function(){return u.a.c(t())},null,{o:e}):t.v()});return r.hasOwnProperty("$raw")||(r.$raw=n),r}return{$raw:{}}}u.g.getComponentNameForNode=function(e){return e=u.a.t(e),u.g.Qa(e)&&e},u.g.mb=function(t,i,n,r){if(1===i.nodeType){var a=u.g.getComponentNameForNode(i);if(a){if(t=t||{},t.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var s={name:a,params:e(i,n)};t.component=r?function(){return s}:s}}return t};var t=new u.J;9>u.a.L&&(u.g.register=function(e){return function(t){return i.createElement(t),e.apply(this,arguments)}}(u.g.register),i.createDocumentFragment=function(e){return function(){var t,i=e(),n=u.g.Ub;for(t in n)n.hasOwnProperty(t)&&i.createElement(t);return i}}(i.createDocumentFragment))}(),function(){var e=0;u.d.component={init:function(t,i,n,r,a){function s(){var e=o&&o.dispose;"function"==typeof e&&e.call(o),c=null}var o,c;return u.a.w.da(t,s),u.s(function(){var n,r,l=u.a.c(i());if("string"==typeof l?n=l:(n=u.a.c(l.name),r=u.a.c(l.params)),!n)throw Error("No component name specified");var d=c=++e;u.g.get(n,function(e){if(c===d){if(s(),!e)throw Error("Unknown component '"+n+"'");var i=e.template;if(!i)throw Error("Component '"+n+"' has no template");i=u.a.ia(i),u.f.T(t,i);var i=r,l=e.createViewModel;e=l?l.call(e,i,{element:t}):i,i=a.createChildContext(e),o=e,u.Ca(i,t)}})},null,{o:t}),{controlsDescendantBindings:!0}}},u.f.Q.component=!0}();var y={class:"className",for:"htmlFor"};u.d.attr={update:function(t,i){var n=u.a.c(i())||{};u.a.G(n,function(i,n){n=u.a.c(n);var r=!1===n||null===n||n===e;r&&t.removeAttribute(i),8>=u.a.L&&i in y?(i=y[i],r?t.removeAttribute(i):t[i]=n):r||t.setAttribute(i,n.toString()),"name"===i&&u.a.Mb(t,r?"":n.toString())})}},function(){u.d.checked={after:["value","attr"],init:function(t,i,n){function r(){var e=t.checked,r=h?s():e;if(!u.Y.ma()&&(!c||e)){var a=u.k.B(i);l?d!==r?(e&&(u.a.ea(a,r,!0),u.a.ea(a,d,!1)),d=r):u.a.ea(a,r,e):u.h.pa(a,n,"checked",r,!0)}}function a(){var e=u.a.c(i());t.checked=l?0<=u.a.m(e,s()):o?e:s()===e}var s=u.Ib(function(){return n.has("checkedValue")?u.a.c(n.get("checkedValue")):n.has("value")?u.a.c(n.get("value")):t.value}),o="checkbox"==t.type,c="radio"==t.type;if(o||c){var l=o&&u.a.c(i())instanceof Array,d=l?s():e,h=c||l;c&&!t.name&&u.d.uniqueName.init(t,function(){return!0}),u.s(r,null,{o:t}),u.a.n(t,"click",r),u.s(a,null,{o:t})}}},u.h.V.checked=!0,u.d.checkedValue={update:function(e,t){e.value=u.a.c(t())}}}(),u.d.css={update:function(e,t){var i=u.a.c(t());"object"==typeof i?u.a.G(i,function(t,i){i=u.a.c(i),u.a.Ba(e,t,i)}):(i=String(i||""),u.a.Ba(e,e.__ko__cssValue,!1),e.__ko__cssValue=i,u.a.Ba(e,i,!0))}},u.d.enable={update:function(e,t){var i=u.a.c(t());i&&e.disabled?e.removeAttribute("disabled"):i||e.disabled||(e.disabled=!0)}},u.d.disable={update:function(e,t){u.d.enable.update(e,function(){return!u.a.c(t())})}},u.d.event={init:function(e,t,i,n,r){var a=t()||{};u.a.G(a,function(a){"string"==typeof a&&u.a.n(e,a,function(e){var s,o=t()[a];if(o){try{var c=u.a.S(arguments);n=r.$data,c.unshift(n),s=o.apply(n,c)}finally{!0!==s&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===i.get(a+"Bubble")&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},u.d.foreach={Eb:function(e){return function(){var t=e(),i=u.a.Xa(t);return i&&"number"!=typeof i.length?(u.a.c(t),{foreach:i.data,as:i.as,includeDestroyed:i.includeDestroyed,afterAdd:i.afterAdd,beforeRemove:i.beforeRemove,afterRender:i.afterRender,beforeMove:i.beforeMove,afterMove:i.afterMove,templateEngine:u.O.Oa}):{foreach:t,templateEngine:u.O.Oa}}},init:function(e,t){return u.d.template.init(e,u.d.foreach.Eb(t))},update:function(e,t,i,n,r){return u.d.template.update(e,u.d.foreach.Eb(t),i,n,r)}},u.h.ha.foreach=!1,u.f.Q.foreach=!0,u.d.hasfocus={init:function(e,t,i){function n(n){e.__ko_hasfocusUpdating=!0;var r=e.ownerDocument;if("activeElement"in r){var a;try{a=r.activeElement}catch(e){a=r.body}n=a===e}r=t(),u.h.pa(r,i,"hasfocus",n,!0),e.__ko_hasfocusLastValue=n,e.__ko_hasfocusUpdating=!1}var r=n.bind(null,!0),a=n.bind(null,!1);u.a.n(e,"focus",r),u.a.n(e,"focusin",r),u.a.n(e,"blur",a),u.a.n(e,"focusout",a)},update:function(e,t){var i=!!u.a.c(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===i||(i?e.focus():e.blur(),u.k.B(u.a.oa,null,[e,i?"focusin":"focusout"]))}},u.h.V.hasfocus=!0,u.d.hasFocus=u.d.hasfocus,u.h.V.hasFocus=!0,u.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){u.a.$a(e,t())}},h("if"),h("ifnot",!1,!0),h("with",!0,!1,function(e,t){return e.createChildContext(t)});var b={};u.d.options={init:function(e){if("select"!==u.a.t(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,i,n){function r(){return u.a.ta(t.options,function(e){return e.selected})}function a(e,t,i){var n=typeof t;return"function"==n?t(e):"string"==n?e[t]:i}function s(e,i){if(h.length){var n=0<=u.a.m(h,u.i.q(i[0]));u.a.Nb(i[0],n),p&&!n&&u.k.B(u.a.oa,null,[t,"change"])}}var o=0!=t.length&&t.multiple?t.scrollTop:null,c=u.a.c(i()),l=n.get("optionsIncludeDestroyed");i={};var d,h;h=t.multiple?u.a.Da(r(),u.i.q):0<=t.selectedIndex?[u.i.q(t.options[t.selectedIndex])]:[],c&&(void 0===c.length&&(c=[c]),d=u.a.ta(c,function(t){return l||t===e||null===t||!u.a.c(t._destroy)}),n.has("optionsCaption")&&null!==(c=u.a.c(n.get("optionsCaption")))&&c!==e&&d.unshift(b));var p=!1;i.beforeRemove=function(e){t.removeChild(e)},c=s,n.has("optionsAfterRender")&&(c=function(t,i){s(0,i),u.k.B(n.get("optionsAfterRender"),null,[i[0],t!==b?t:e])}),u.a.Za(t,d,function(i,r,s){return s.length&&(h=s[0].selected?[u.i.q(s[0])]:[],p=!0),r=t.ownerDocument.createElement("option"),i===b?(u.a.bb(r,n.get("optionsCaption")),u.i.ca(r,e)):(s=a(i,n.get("optionsValue"),i),u.i.ca(r,u.a.c(s)),i=a(i,n.get("optionsText"),s),u.a.bb(r,i)),[r]},i,c),u.k.B(function(){n.get("valueAllowUnset")&&n.has("value")?u.i.ca(t,u.a.c(n.get("value")),!0):(t.multiple?h.length&&r().length<h.length:h.length&&0<=t.selectedIndex?u.i.q(t.options[t.selectedIndex])!==h[0]:h.length||0<=t.selectedIndex)&&u.a.oa(t,"change")}),u.a.dc(t),o&&20<Math.abs(o-t.scrollTop)&&(t.scrollTop=o)}},u.d.options.Va=u.a.e.F(),u.d.selectedOptions={after:["options","foreach"],init:function(e,t,i){u.a.n(e,"change",function(){var n=t(),r=[];u.a.u(e.getElementsByTagName("option"),function(e){e.selected&&r.push(u.i.q(e))}),u.h.pa(n,i,"selectedOptions",r)})},update:function(e,t){if("select"!=u.a.t(e))throw Error("values binding applies only to SELECT elements");var i=u.a.c(t());i&&"number"==typeof i.length&&u.a.u(e.getElementsByTagName("option"),function(e){var t=0<=u.a.m(i,u.i.q(e));u.a.Nb(e,t)})}},u.h.V.selectedOptions=!0,u.d.style={update:function(t,i){var n=u.a.c(i()||{});u.a.G(n,function(i,n){n=u.a.c(n),null!==n&&n!==e&&!1!==n||(n=""),t.style[i]=n})}},u.d.submit={init:function(e,t,i,n,r){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");u.a.n(e,"submit",function(i){var n,a=t();try{n=a.call(r.$data,e)}finally{!0!==n&&(i.preventDefault?i.preventDefault():i.returnValue=!1)}})}},u.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){u.a.bb(e,t())}},u.f.Q.text=!0,function(){if(t&&t.navigator)var i=function(e){if(e)return parseFloat(e[1])},n=t.opera&&t.opera.version&&parseInt(t.opera.version()),r=t.navigator.userAgent,a=i(r.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),s=i(r.match(/Firefox\/([^ ]*)/));if(10>u.a.L)var o=u.a.e.F(),c=u.a.e.F(),l=function(e){var t=this.activeElement;(t=t&&u.a.e.get(t,c))&&t(e)},d=function(e,t){var i=e.ownerDocument;u.a.e.get(i,o)||(u.a.e.set(i,o,!0),u.a.n(i,"selectionchange",l)),u.a.e.set(e,c,t)};u.d.textInput={init:function(t,i,r){function o(e,i){u.a.n(t,e,i)}function c(){var n=u.a.c(i());null!==n&&n!==e||(n=""),m!==e&&n===m?setTimeout(c,4):t.value!==n&&(f=n,t.value=n)}function l(){p||(m=t.value,p=setTimeout(h,4))}function h(){clearTimeout(p),m=p=e;var n=t.value;f!==n&&(f=n,u.h.pa(i(),r,"textInput",n))}var p,m,f=t.value;10>u.a.L?(o("propertychange",function(e){"value"===e.propertyName&&h()}),8==u.a.L&&(o("keyup",h),o("keydown",h)),8<=u.a.L&&(d(t,h),o("dragend",l))):(o("input",h),5>a&&"textarea"===u.a.t(t)?(o("keydown",l),o("paste",l),o("cut",l)):11>n?o("keydown",l):4>s&&(o("DOMAutoComplete",h),o("dragdrop",h),o("drop",h))),o("change",h),u.s(c,null,{o:t})}},u.h.V.textInput=!0,u.d.textinput={preprocess:function(e,t,i){i("textInput",e)}}}(),u.d.uniqueName={init:function(e,t){if(t()){var i="ko_unique_"+ ++u.d.uniqueName.Zb;u.a.Mb(e,i)}}},u.d.uniqueName.Zb=0,u.d.value={after:["options","foreach"],init:function(e,t,i){if("input"!=e.tagName.toLowerCase()||"checkbox"!=e.type&&"radio"!=e.type){var n=["change"],r=i.get("valueUpdate"),a=!1,s=null;r&&("string"==typeof r&&(r=[r]),u.a.ga(n,r),n=u.a.rb(n));var o=function(){s=null,a=!1;var n=t(),r=u.i.q(e);u.h.pa(n,i,"value",r)};!u.a.L||"input"!=e.tagName.toLowerCase()||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=u.a.m(n,"propertychange")||(u.a.n(e,"propertychange",function(){a=!0}),u.a.n(e,"focus",function(){a=!1}),u.a.n(e,"blur",function(){a&&o()})),u.a.u(n,function(t){var i=o;u.a.vc(t,"after")&&(i=function(){s=u.i.q(e),setTimeout(o,0)},t=t.substring(5)),u.a.n(e,t,i)});var c=function(){var n=u.a.c(t()),r=u.i.q(e);if(null!==s&&n===s)setTimeout(c,0);else if(n!==r)if("select"===u.a.t(e)){var a=i.get("valueAllowUnset"),r=function(){u.i.ca(e,n,a)};r(),a||n===u.i.q(e)?setTimeout(r,0):u.k.B(u.a.oa,null,[e,"change"])}else u.i.ca(e,n)};u.s(c,null,{o:e})}else u.ra(e,{checkedValue:t})},update:function(){}},u.h.V.value=!0,u.d.visible={update:function(e,t){var i=u.a.c(t()),n="none"!=e.style.display;i&&!n?e.style.display="":!i&&n&&(e.style.display="none")}},function(e){u.d[e]={init:function(t,i,n,r,a){return u.d.event.init.call(this,t,function(){var t={};return t[e]=i(),t},n,r,a)}}}("click"),u.H=function(){},u.H.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},u.H.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},u.H.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||i;var n=t.getElementById(e);if(!n)throw Error("Cannot find template with ID "+e);return new u.r.l(n)}if(1==e.nodeType||8==e.nodeType)return new u.r.fa(e);throw Error("Unknown template type: "+e)},u.H.prototype.renderTemplate=function(e,t,i,n){return e=this.makeTemplateSource(e,n),this.renderTemplateSource(e,t,i)},u.H.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting||this.makeTemplateSource(e,t).data("isRewritten")},u.H.prototype.rewriteTemplate=function(e,t,i){e=this.makeTemplateSource(e,i),t=t(e.text()),e.text(t),e.data("isRewritten",!0)},u.b("templateEngine",u.H),u.fb=function(){function e(e,t,i,n){e=u.h.Wa(e);for(var r=u.h.ha,a=0;a<e.length;a++){var s=e[a].key;if(r.hasOwnProperty(s)){var o=r[s];if("function"==typeof o){if(s=o(e[a].value))throw Error(s)}else if(!o)throw Error("This template engine does not support the '"+s+"' binding within its templates")}}return i="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+u.h.ya(e,{valueAccessors:!0})+" } })()},'"+i.toLowerCase()+"')",n.createJavaScriptEvaluatorBlock(i)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,i=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{ec:function(e,t,i){t.isTemplateRewritten(e,i)||t.rewriteTemplate(e,function(e){return u.fb.nc(e,t)},i)},nc:function(n,r){return n.replace(t,function(t,i,n,a,s){return e(s,i,n,r)}).replace(i,function(t,i){return e(i,"\x3c!-- ko --\x3e","#comment",r)})},Xb:function(e,t){return u.D.Ua(function(i,n){var r=i.nextSibling;r&&r.nodeName.toLowerCase()===t&&u.ra(r,e,n)})}}}(),u.b("__tr_ambtns",u.fb.Xb),function(){u.r={},u.r.l=function(e){this.l=e},u.r.l.prototype.text=function(){var e=u.a.t(this.l),e="script"===e?"text":"textarea"===e?"value":"innerHTML";if(0==arguments.length)return this.l[e];var t=arguments[0];"innerHTML"===e?u.a.$a(this.l,t):this.l[e]=t};var t=u.a.e.F()+"_";u.r.l.prototype.data=function(e){if(1===arguments.length)return u.a.e.get(this.l,t+e);u.a.e.set(this.l,t+e,arguments[1])};var i=u.a.e.F();u.r.fa=function(e){this.l=e},u.r.fa.prototype=new u.r.l,u.r.fa.prototype.text=function(){if(0==arguments.length){var t=u.a.e.get(this.l,i)||{};return t.gb===e&&t.Ga&&(t.gb=t.Ga.innerHTML),t.gb}u.a.e.set(this.l,i,{gb:arguments[0]})},u.r.l.prototype.nodes=function(){if(0==arguments.length)return(u.a.e.get(this.l,i)||{}).Ga;u.a.e.set(this.l,i,{Ga:arguments[0]})},u.b("templateSources",u.r),u.b("templateSources.domElement",u.r.l),u.b("templateSources.anonymousTemplate",u.r.fa)}(),function(){function t(e,t,i){var n;for(t=u.f.nextSibling(t);e&&(n=e)!==t;)e=u.f.nextSibling(n),i(n,e)}function i(e,i){if(e.length){var n=e[0],r=e[e.length-1],a=n.parentNode,s=u.J.instance,o=s.preprocessNode;if(o){if(t(n,r,function(e,t){var i=e.previousSibling,a=o.call(s,e);a&&(e===n&&(n=a[0]||t),e===r&&(r=a[a.length-1]||i))}),e.length=0,!n)return;n===r?e.push(n):(e.push(n,r),u.a.ka(e,a))}t(n,r,function(e){1!==e.nodeType&&8!==e.nodeType||u.pb(i,e)}),t(n,r,function(e){1!==e.nodeType&&8!==e.nodeType||u.D.Sb(e,[i])}),u.a.ka(e,a)}}function n(e){return e.nodeType?e:0<e.length?e[0]:null}function r(e,t,r,s,o){o=o||{};var c=e&&n(e),c=c&&c.ownerDocument,l=o.templateEngine||a;if(u.fb.ec(r,l,c),r=l.renderTemplate(r,s,o,c),"number"!=typeof r.length||0<r.length&&"number"!=typeof r[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(c=!1,t){case"replaceChildren":u.f.T(e,r),c=!0;break;case"replaceNode":u.a.Lb(e,r),c=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t)}return c&&(i(r,s),o.afterRender&&u.k.B(o.afterRender,null,[r,s.$data])),r}var a;u.ab=function(t){if(t!=e&&!(t instanceof u.H))throw Error("templateEngine must inherit from ko.templateEngine");a=t},u.Ya=function(t,i,s,o,c){if(s=s||{},(s.templateEngine||a)==e)throw Error("Set a template engine before calling renderTemplate");if(c=c||"replaceChildren",o){var l=n(o);return u.j(function(){var e=i&&i instanceof u.N?i:new u.N(u.a.c(i)),a=u.C(t)?t():"function"==typeof t?t(e.$data,e):t,e=r(o,c,a,e,s);"replaceNode"==c&&(o=e,l=n(o))},null,{Ia:function(){return!l||!u.a.Ja(l)},o:l&&"replaceNode"==c?l.parentNode:l})}return u.D.Ua(function(e){u.Ya(t,i,s,e,"replaceNode")})},u.uc=function(t,n,a,s,o){function c(e,t){i(t,d),a.afterRender&&a.afterRender(t,e)}function l(e,i){return d=o.createChildContext(e,a.as,function(e){e.$index=i}),r(null,"ignoreTargetNode",u.C(t)?t():"function"==typeof t?t(e,d):t,d,a)}var d;return u.j(function(){var t=u.a.c(n)||[];void 0===t.length&&(t=[t]),t=u.a.ta(t,function(t){return a.includeDestroyed||t===e||null===t||!u.a.c(t._destroy)}),u.k.B(u.a.Za,null,[s,t,l,a,c])},null,{o:s})};var s=u.a.e.F();u.d.template={init:function(e,t){var i=u.a.c(t());return"string"==typeof i||i.name?u.f.ja(e):(i=u.f.childNodes(e),i=u.a.oc(i),new u.r.fa(e).nodes(i)),{controlsDescendantBindings:!0}},update:function(t,i,n,r,a){var o,c=i();i=u.a.c(c),n=!0,r=null,"string"==typeof i?i={}:(c=i.name,"if"in i&&(n=u.a.c(i.if)),n&&"ifnot"in i&&(n=!u.a.c(i.ifnot)),o=u.a.c(i.data)),"foreach"in i?r=u.uc(c||t,n&&i.foreach||[],i,t,a):n?(a="data"in i?a.createChildContext(o,i.as):a,r=u.Ya(c||t,a,i,t)):u.f.ja(t),a=r,(o=u.a.e.get(t,s))&&"function"==typeof o.K&&o.K(),u.a.e.set(t,s,a&&a.Z()?a:e)}},u.h.ha.template=function(e){return e=u.h.Wa(e),1==e.length&&e[0].unknown||u.h.lc(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},u.f.Q.template=!0}(),u.b("setTemplateEngine",u.ab),u.b("renderTemplate",u.Ya),u.a.wb=function(e,t,i){if(e.length&&t.length){var n,r,a,s,o;for(n=r=0;(!i||n<i)&&(s=e[r]);++r){for(a=0;o=t[a];++a)if(s.value===o.value){s.moved=o.index,o.moved=s.index,t.splice(a,1),n=a=0;break}n+=a}}},u.a.Fa=function(){function e(e,t,i,n,r){var a,s,o,c,l,d=Math.min,h=Math.max,p=[],m=e.length,f=t.length,g=f-m||1,v=m+f+1;for(a=0;a<=m;a++)for(c=o,p.push(o=[]),l=d(f,a+g),s=h(0,a-1);s<=l;s++)o[s]=s?a?e[a-1]===t[s-1]?c[s-1]:d(c[s]||v,o[s-1]||v)+1:s+1:a+1;for(d=[],h=[],g=[],a=m,s=f;a||s;)f=p[a][s]-1,s&&f===p[a][s-1]?h.push(d[d.length]={status:i,value:t[--s],index:s}):a&&f===p[a-1][s]?g.push(d[d.length]={status:n,value:e[--a],index:a}):(--s,--a,r.sparse||d.push({status:"retained",value:t[s]}));return u.a.wb(h,g,10*m),d.reverse()}return function(t,i,n){return n="boolean"==typeof n?{dontLimitMoves:n}:n||{},t=t||[],i=i||[],t.length<=i.length?e(t,i,"added","deleted",n):e(i,t,"deleted","added",n)}}(),u.b("utils.compareArrays",u.a.Fa),function(){function t(t,i,n,r,a){var s=[],o=u.j(function(){var e=i(n,a,u.a.ka(s,t))||[];0<s.length&&(u.a.Lb(s,e),r&&u.k.B(r,null,[n,e,a])),s.length=0,u.a.ga(s,e)},null,{o:t,Ia:function(){return!u.a.ob(s)}});return{$:s,j:o.Z()?o:e}}var i=u.a.e.F();u.a.Za=function(n,r,a,s,o){function c(e,t){S=h[t],v!==t&&(P[e]=S),S.Na(v++),u.a.ka(S.$,n),f.push(S),b.push(S)}function l(e,t){if(e)for(var i=0,n=t.length;i<n;i++)t[i]&&u.a.u(t[i].$,function(n){e(n,i,t[i].sa)})}r=r||[],s=s||{};var d=u.a.e.get(n,i)===e,h=u.a.e.get(n,i)||[],p=u.a.Da(h,function(e){return e.sa}),m=u.a.Fa(p,r,s.dontLimitMoves),f=[],g=0,v=0,y=[],b=[];r=[];for(var S,E,C,P=[],p=[],T=0;E=m[T];T++)switch(C=E.moved,E.status){case"deleted":C===e&&(S=h[g],S.j&&S.j.K(),y.push.apply(y,u.a.ka(S.$,n)),s.beforeRemove&&(r[T]=S,b.push(S))),g++;break;case"retained":c(T,g++);break;case"added":C!==e?c(T,C):(S={sa:E.value,Na:u.p(v++)},f.push(S),b.push(S),d||(p[T]=S))}l(s.beforeMove,P),u.a.u(y,s.beforeRemove?u.R:u.removeNode);for(var D,T=0,d=u.f.firstChild(n);S=b[T];T++){for(S.$||u.a.extend(S,t(n,a,S.sa,o,S.Na)),g=0;m=S.$[g];d=m.nextSibling,D=m,g++)m!==d&&u.f.Bb(n,m,D);!S.ic&&o&&(o(S.sa,S.$,S.Na),S.ic=!0)}l(s.beforeRemove,r),l(s.afterMove,P),l(s.afterAdd,p),u.a.e.set(n,i,f)}}(),u.b("utils.setDomNodeChildrenFromArrayMapping",u.a.Za),u.O=function(){this.allowTemplateRewriting=!1},u.O.prototype=new u.H,u.O.prototype.renderTemplateSource=function(e){var t=(9>u.a.L?0:e.nodes)?e.nodes():null;return t?u.a.S(t.cloneNode(!0).childNodes):(e=e.text(),u.a.ba(e))},u.O.Oa=new u.O,u.ab(u.O.Oa),u.b("nativeTemplateEngine",u.O),function(){u.Sa=function(){var e=this.kc=function(){if(!r||!r.tmpl)return 0;try{if(0<=r.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,n,a){if(a=a||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var s=t.data("precompiled");return s||(s=t.text()||"",s=r.template(null,"{{ko_with $item.koBindingContext}}"+s+"{{/ko_with}}"),t.data("precompiled",s)),t=[n.$data],n=r.extend({koBindingContext:n},a.templateOptions),n=r.tmpl(s,t,n),n.appendTo(i.createElement("div")),r.fragments={},n},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){i.write("<script type='text/html' id='"+e+"'>"+t+"<\/script>")},0<e&&(r.tmpl.tag.ko_code={open:"__.push($1 || '');"},r.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},u.Sa.prototype=new u.H;var e=new u.Sa;0<e.kc&&u.ab(e),u.b("jqueryTmplTemplateEngine",u.Sa)}()})}()}(),define("util",[],function(){function e(e,t){e===URLPart.Search?window.location.search=t:e===URLPart.Hash&&(window.location.hash=t)}function t(e){return e===URLPart.Search?window.location.search:e===URLPart.Hash?s.overrideHash||window.location.hash:void 0}function i(e){return o[e]}function n(e){return function(e,t,i){}}function r(e){return function(e,t,i){}}function a(){}var s={};window.URLPart={Search:1,Hash:2};var o={demo:URLPart.Hash,login:URLPart.Hash,user:URLPart.Hash,premium:URLPart.Hash,ispremium:URLPart.Hash,access_token:URLPart.Hash,error:URLPart.Hash,expires_in:URLPart.Hash,expires_at:URLPart.Hash,issued_at:URLPart.Hash,scope:URLPart.Hash,token_type:URLPart.Hash,id_token:URLPart.Hash,data:URLPart.Hash,script:URLPart.Hash,dmode:URLPart.Hash,jasmine:URLPart.Hash,touch:URLPart.Hash,noverify:URLPart.Hash,file:URLPart.Hash,sinfo:URLPart.Hash,panes:URLPart.Hash,offline:URLPart.Hash,live:URLPart.Hash,test:URLPart.Hash,nolocal:URLPart.Hash,nosync:URLPart.Hash,rdebug:URLPart.Hash,rsession:URLPart.Hash,cacheError:URLPart.Hash,versionError:URLPart.Hash,invite:URLPart.Hash,state:URLPart.Search};s.hasURLParam=function(e,n){var r=e+"=";n&&(r+=n);var a=i(e);return a||log("Invalid URL Part"),t(a).indexOf(r)>=0},s.getURLParam=function(e,n){var r=n||i(e);if(r===URLPart.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+e+"=([^&#]*)",s=new RegExp(a),o=s.exec(window.location.href);return null===o?void 0:decodeURIComponent(o[1].replace(/\+/g," "))}if(r!==URLPart.Hash)log("Invalid URL part");else for(var c,l=t(URLPart.Hash).substring(1),s=/([^&=]+)=([^&]*)/g;c=s.exec(l);)if(decodeURIComponent(c[1])===e)return decodeURIComponent(c[2])},s.insertURLParam=function(n,r,a){n=encodeURIComponent(n),r=encodeURIComponent(r);for(var s=i(n),o=t(s),c=o.substr(1).split("&"),l=c.length-1;l>=0;l--){var d=c[l].split("=");if(d[0]==n){d[1]=r,c[l]=d.join("=");break}}l<0&&(c[c.length]=[n,r].join("=")),e(s,c.join("&")),s!==URLPart.Hash||a||window.location.reload()},s.removeURLParam=function(n,r){n=encodeURIComponent(n);for(var a=i(n),s=t(a),o=s.substr(1).split("&"),c=o.length-1;c>=0;c--){if(o[c].split("=")[0]==n){o.splice(c,1),e(a,o.join("&")),a!==URLPart.Hash||r||window.location.reload();break}}};s.forceBind=function(e,t){var i=t[e].bind(t);return t[e]=i,i},s.destroy=function(e){},s.extend=function(e,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},s.inherit=function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype},s.defineBase=function(e){e.prototype.constructor=e},s.genPromise=function(e){e.then=n(e),e.execute=r(e)}
;var c={getItem:function(){},setItem:function(){},removeItem:function(){},clear:function(){}};try{s.__storage=window.localStorage||c}catch(e){s.__storage=c}return s.localStorageQuotaError=!1,s.storage={getItem:(s.__storage.getItem||function(e,t){return this.get(e,t||a)}).bind(s.__storage),setItem:(s.__storage.setItem||function(e,t){var i={};i[e]=t;try{this.set(i)}catch(e){s.localStorageQuotaError=!0,log("LocalStorageError: ",e),require(["globals"],function(t){t.reportError(e)})}}).bind(s.__storage),removeItem:(s.__storage.removeItem||function(e,t){this.remove(e,t)}).bind(s.__storage),clear:(s.__storage.clear||function(e){this.clear(e)}).bind(s.__storage)},s}),define("Listener",[],function(){var e=function(e,t){this.target=e,this.cb=t,this._disposed=!1};return e.prototype={dispose:function(){this._disposed=!0,this.target.unlisten(this.cb)},isDisposed:function(){return this._disposed}},e}),define("Trigger",["globals","Listener"],function(e,t){var i=function(e){this._listeners=[],this._enabled=!0,e&&this._listeners.push(e)};return i.prototype={listen:function(e){return this._addListener(e),new t(this,e)},_addListener:function(e){this._listeners.push(e)},_hasListener:function(e){return this._listeners.indexOf(e)>=0},unlisten:function(e){this._listeners.remove(e)},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1},notify:function(){if(this._enabled)for(var e=0;e<this._listeners.length;++e)arguments.length>0?this._listeners[e](arguments[0]):this._listeners[e]()}},i}),define("Constants",[],function(){return{EmailOpenTime:250,DoubleClickTime:300,EmailPreviewSizeMin:400,EmailPreviewSizeMax:800,ExpandedPaneWidth:400,HelpWidth:360,StdPaneWidthMin:400,StdPaneWidthMax:900,EmailOpenTimeMobile:150,OverviewWidth:260,OverviewItemHeightDesktop:32,OverviewItemHeightMobile:36,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,PaneSpaceSize:5,MSPerHour:36e5,MaxBatchSize:45,TooltipDelay:400,MobileBottomHeight:50,HorizScrollbarHeight:18,PaneHeaderHeight:73,PaneHeaderButtonHeight:36,PaneHeaderRow2ButtonHeight:32,PaneHeaderRow2Height:36,MobileHeaderRow2Height:36,CalendarResizeHandleHeight:8,DesktopMenuWidth:100,DesktopMenuWidthSmall:36,RootItemName:"Outline",MinEmailScale:.25,AddPaneAreaSize:160,DateFormat:{DMY:"dmy",MDY:"mdy",YMD:"ymd"},SettingsSections:{General:"General",Plugins:"Plugins",Account:"Moo.do Account",EarlyAccess:"Send Feedback",Linked:"Email Accounts",Invite:"Invite Friends",GoogleCalendar:"Google Calendar",Contacts:"Contacts",Gmail:"Gmail"},ItemAnimationMode:{None:0,Normal:1,Move:2,Search:3},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:0,Reply:1,ReplyAll:2,Forward:3,Other:4},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},CalendarViewMode:{Agenda:"Agenda",Day:"Day",Week:"Week",Month:"Month"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:48,CalendarDayViewNumDaysPad:84,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},HelpMode:{None:0,Normal:1,Hotkeys:3},Pricing:{None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3},LoginFlags:{None:0,NewUser:1,OldUserNewTrial:2,TrialOver:4,TrialAutoReset:8},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailSortType:{TimeReceived:"Time",Priority:"Priority"},MaxGmailSyncTime:{Premium:30,Free:2},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},AutocompleteMode:{All:"all",Move:"move",Jump:"jump",Item:"item",Email:"email",Contact:"contact",Tag:"tag",Date:"date",Snooze:"snooze",GmailLabel:"gmailLabel"},ContextMenuMode:{Default:0,Archived:1,Drive:2,Gmail:3},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown"},ColorTheme:{Light:"light",Dark:"dark"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Bullet:"*",Bullet2:"-",Bullet3:"+",Task:"[",Task2:"[]",Task3:"[ ]",NumList:"1."},PrefixWidth:20,LineLeftPad:5,TextSpace:"\ufeff",AttachChar:" ",EmbedAttachChar:" "}}),define("Observable",["util","Listener"],function(e,t){function i(e,t){this._value=e,this._listeners=void 0,t&&(this._listeners=[t])}return i.prototype={get:function(){return this._value},set:function(e,t){var i=this._value;return this._value=e,!1!==t&&this.notify(e,i,t),e},dbgObserve:function(){this.listen(function(e,t){log("Value: ",t,"->",e)})},hasListeners:function(){return this._listeners&&this._listeners.length>0},listen:function(e){return this._listeners||(this._listeners=[]),this._listeners.push(e),new t(this,e)},unlisten:function(e){this._listeners&&this._listeners.remove(e)},notify:function(e,t,i){0===arguments.length&&(e=this._value,t=this._value,i=!0);var n=this._listeners;if(n&&n.length>0&&(e!==t||!0===i))for(var r=0;r<n.length;++r)!1===(0===arguments.length?n[r](this._value):n[r](e,t))&&(n.splice(r,1),r--)}},e.defineBase(i),i}),define("platform",["util","Trigger","Constants","Observable"],function(e,t,i,n){function r(){e.forceBind("normalizeKeys",this),e.forceBind("getKeyCode",this),this.versionRequired=[],this.versionAvailable=[],this.versionRequired[AppPlatform.iOS]=4,this.versionAvailable[AppPlatform.iOS]=6,this.versionRequired[AppPlatform.Android]=4,this.versionAvailable[AppPlatform.Android]=5,this.versionRequired[AppPlatform.WinPhone]=1,this.versionAvailable[AppPlatform.WinPhone]=1,this.versionRequired[AppPlatform.Chrome]=1,this.versionAvailable[AppPlatform.Chrome]=2,this.versionRequired[AppPlatform.Electron]=1,this.versionAvailable[AppPlatform.Electron]=2,this.versionMobile=2,this.versionDesktop=13,this.versionMobileMessages={},this.versionDesktopMessages={11:"Updated design for pane headers and the sidebar. Workspaces and Documents renamed to Boards and Files. See blog for details.",12:"Use Markdown to style your text. Use # for headers and [ for tasks. See blog for details.",13:"New Item hotkey changed to N and New Email hotkey changed to E. And new Evernote integration! See blog for details."},this.appSubVersion=void 0,this.setDeployEnvironments(),this.appStoreLinks=[],this.appStoreLinks[AppPlatform.iOS]="https://itunes.apple.com/us/app/moo.do-organize-your-way/id889830074?ls=1&mt=8",this.appStoreLinks[AppPlatform.Android]="https://play.google.com/store/apps/details?id=moo.do",this.appStoreLinks[AppPlatform.WinPhone]=void 0,this.appStoreLinks[AppPlatform.Chrome]="https://chrome.google.com/webstore/detail/moodo/iffimmolghilclfndeiebgppddmagofk",this.appStoreLinks[AppPlatform.Electron]="https://github.com/MooDoApp/MooDoApp.github.io/releases/latest",this.appReviewLinks=[],this.appReviewLinks[AppPlatform.iOS]=void 0,this.appReviewLinks[AppPlatform.Android]=void 0,this.appReviewLinks[AppPlatform.WinPhone]=void 0,this.appReviewLinks[AppPlatform.Chrome]=void 0,this.appReviewLinks[AppPlatform.Electron]=void 0,this.appPlatform=void 0,this.appStoreLink=void 0,this.appReviewLink=void 0,this.requireCustomRedirect=!1,this.requireCustomPurchase=!1,this.requireCustomPaypal=!1,this.bodyClass=void 0,this.b=document.documentElement,this.orientation=Orientation.Portrait,this.onResize=new t,this.kbsizePortrait=Math.ceil(this.getActualWindowHeight()/2),this.kbsizeLandscape=void 0,this.kbsize=new n(this.kbsizePortrait),this.appState=void 0,this.isHosted=!1,this.hostedBy=void 0,this.initStorageQuota={quota:NaN,usage:NaN},this.isNearStorageQuota=!1,this.pageVisibilityHidden=void 0,this.pageVisibilityChange=void 0,this._allowNativeNotifications=!0,this.isPhantom=!1,this.isDevURL="dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,this._features={},this.init(),this._windowWidth=new n(this.getActualWindowWidth()),this._windowHeight=new n(this.getActualWindowHeight()),this.app&&(this.customRedirectState={app:!0,appv:this.appv,webview:this.getAppState("webview")}),this.app||this.android?this.keyboardOpenTime=200:this.winphone?this.keyboardOpenTime=200:this.mobileie?this.keyboardOpenTime=600:this.keyboardOpenTime=0}return window.Orientation={Portrait:0,Landscape:1},window.PlatformConfig={DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},window.AppPlatform={iOS:0,Android:1,WinPhone:2,Chrome:3,Embed:4,Electron:5},window.EmbedApps={Mailbird:"mailbird"},window.DeployVariable={Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},r.prototype={getDeployVar:function(e){return this.deployEnvironment[e]},setDeployEnvironments:function(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="dev",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="beta",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="local",this.deployEnvironment[DeployVariable.APIProtocol]="http:",this.deployEnvironment[DeployVariable.APIHost]="//localhost:9024"):(this.deployEnvironment[DeployVariable.Environment]="production",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api.moo.do")},getKBSize:function(){return this.kbsize.get()?this.kbsize.get():Math.ceil(this.getActualWindowHeight()/2)},setKBSize:function(e){this.kbsize.set(parseInt(e))},windowWidth:function(e){return this._windowWidth.get()||e||(require(["globals"],function(e){try{e.PAssert(2755,!1,"Window width was not set",this._windowWidth.get(),this._windowHeight.get())}catch(t){e.reportError(t)}}.bind(this)),this._windowWidth.set(this.getActualWindowWidth())),this._windowWidth.get()},windowHeight:function(e){return this._windowHeight.get()||e||(require(["globals"],function(e){try{e.PAssert(2756,!1,"Window height was not set",this._windowWidth.get(),this._windowHeight.get())}catch(t){e.reportError(t)}}.bind(this)),this._windowHeight.set(this.getActualWindowHeight())),this._windowHeight.get()},setWindowSize:function(e,t){this._windowWidth.set(e),this._windowHeight.set(t)},getLocaleInfo:function(e){try{e.lang=navigator.language||navigator.userLanguage}catch(t){e.lang="EXCEPTION"}},getPlatformInfo:function(e){e.os=this.OSName,e.browser=this.browser,e.majorVersion=this.majorVersion,e.minorVersion=this.minorVersion,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.requireCustomRedirect=this.requireCustomRedirect,e.requireCustomPurchase=this.requireCustomPurchase,e.requireCustomPaypal=this.requireCustomPaypal,e.isMobile=this.mobile,e.isMobileBrowser=this.isMobileBrowser,e.isPhone=this.phone,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.kbsize=this.kbsize.get(),e.appState=this.appState,e.isHosted=this.isHosted,e.hostedBy=this.hostedBy,e.embed=this.embed,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent,e.referrer=document.referrer,e.devicePixelRatio=window.devicePixelRatio,e.pageVisibilityChange=!!this.pageVisibilityChange,e.appSubVersion=this.appSubVersion,e.initStorageQuota=this.initStorageQuota,e.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(e)},getUserPlatformConfig:function(){var e=PlatformConfig.Unknown;if(this.app)switch(this.appPlatform){case AppPlatform.iOS:e=PlatformConfig.iOSApp;break;case AppPlatform.Android:e=PlatformConfig.AndroidApp;break;case AppPlatform.WinPhone:e=PlatformConfig.WinPhoneApp;break;case AppPlatform.Chrome:e=PlatformConfig.ChromeApp;break;case AppPlatform.Electron:e="Windows"===this.OSName?PlatformConfig.ElectronWindows:"MacOS"===this.OSName?PlatformConfig.ElectronMac:PlatformConfig.ElectronUnknown;break;case AppPlatform.Embed:e=this.mobile?PlatformConfig.EmbedMobileApp:PlatformConfig.EmbedDesktopApp}else switch(this.OSName){case"Windows":e=this.phone?PlatformConfig.WinPhoneBrowser:PlatformConfig.DesktopWindows;break;case"iPad":case"iPod":case"iPhone":e=PlatformConfig.iOSBrowser;break;case"MacOS":e=PlatformConfig.DesktopMac;break;case"Android":e=PlatformConfig.AndroidBrowser;break;case"ChromeOS":case"Linux":default:e=this.phone?PlatformConfig.MobileOther:PlatformConfig.DesktopOther}return e},getAppDownloadURL:function(){return this.appDownloadUrl||(this.mac?this.appDownloadUrl="https://www.moo.do/lnk/mac":this.windows?this.appDownloadUrl="https://www.moo.do/lnk/windows":this.ios?this.appDownloadUrl=this.appStoreLinks[AppPlatform.iOS]:this.android?this.appDownloadUrl=this.appStoreLinks[AppPlatform.Android]:this.appDownloadUrl=this.appStoreLinks[AppPlatform.Chrome]),this.appDownloadUrl||"https://github.com/MooDoApp/MooDoApp.github.io/releases/latest"},supportsNativeApp:function(){switch(this.OSName){case"Windows":case"MacOS":return!this.mobile;default:return!1}},isNativeApp:function(){return this.appPlatform===AppPlatform.Electron},canDownloadNativeApp:function(){return this.supportsNativeApp()&&!this.isNativeApp()},isChromeApp:function(){return this.appPlatform===AppPlatform.Chrome},canDownloadChromeApp:function(){return!(this.mobile||this.supportsNativeApp()||this.isChromeApp()||this.isNativeApp())},init:function(){this.initAppState(),this.initHostState(),this.initFeatures();var t=navigator.userAgent,n="";if(this.OSName="Unknown OS",this.app&&(n+=" app"),-1!==t.indexOf("Win")?(this.OSName="Windows",this.windows=!0,-1!==t.indexOf("Windows Phone")?(this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.WinPhone],this.app&&(this.appPlatform=AppPlatform.WinPhone)):this.appStoreLink=this.appStoreLinks[AppPlatform.Electron]):-1!==t.indexOf("iPad")?(this.OSName="iPad",this.ios=!0,this.ipad=!0,this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==t.indexOf("iPhone")?(this.OSName="iPhone",this.ios=!0,this.iphone=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==t.indexOf("iPod")?(this.OSName="iPod",this.ios=!0,this.ipod=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==t.indexOf("Mac")?(this.OSName="MacOS",this.mac=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.Electron]):-1!==t.indexOf("X11")?-1!==t.indexOf("CrOS")?(this.OSName="ChromeOS",this.chromeOS=!0):(this.OSName="UNIX",this.unix=!0):-1!==t.indexOf("Android")?(this.OSName="Android",this.android=!0,this.touch=!0,this.mobile=!0,this.phone=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.Android],this.app&&(this.appPlatform=AppPlatform.Android),n+=" android"):-1!==t.indexOf("Linux")&&(this.OSName="Linux",this.linux=!0),this.ios){if(this.ios7=-1!==t.indexOf("OS 7"),this.ios70=-1!==t.indexOf("OS 7_0"),this.ios71=-1!==t.indexOf("OS 7_1"),this.ios10=-1!==t.indexOf("OS 10"),this.ios11=-1!==t.indexOf("OS 11"),this.appState){"ioswk"===this.appState.webview?this.ioswk=!0:this.iosui=!0,this.appState.oauth&&this._enableFeature(i.Feature.OAuth)}this.ios7&&(n+=" ios7")}if(this.majorVersion=1e3,this.minorVersion=1e3,-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident")){this.browser="Trident",this.ie=!0,this.winphone=!!t.match(/IEMobile/i);var r;if(r=this.winphone||"Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==r.exec(t))this.majorVersion=parseFloat(RegExp.$1);else{null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&(this.majorVersion=parseFloat(RegExp.$1))}}else if(-1!==t.indexOf("Chrome")||-1!==t.indexOf("CriOS")){this.browser="Chrome",this.isChrome=!0;var r=new RegExp("Chrome/([0-9]{1,}).");null!==r.exec(t)&&(this.majorVersion=parseFloat(RegExp.$1)),-1!==t.indexOf("Edge")&&(this.ieEdge=!0),this.app&&this.appPlatform!==AppPlatform.Android&&(this.appPlatform=AppPlatform.Chrome,this.requireCustomPaypal=!0)}else if(-1!==t.indexOf("Android")){this.browser="Native Android";var r=new RegExp("Linux; Android ([0-9]{1,}).([0-9]{1,}).");null!==r.exec(t)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else if(-1!==t.indexOf("Firefox")){this.browser="Firefox",this.isFirefox=!0;var r=new RegExp("Firefox/([0-9]{1,}).");null!==r.exec(t)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==t.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName){this.browser="Safari",this.safari=!0;var r;r=this.mobile?new RegExp("OS ([0-9]{1,})_([0-9]{1,})"):new RegExp("Version/([0-9]{1,}).([0-9]{1,})."),null!==r.exec(t)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else-1!==t.indexOf("Opera")&&(this.browser="Opera");this.appState&&"electron"===this.appState.appType&&(this.appPlatform=AppPlatform.Electron,n+=" electron",this.mac&&(n+=" electronMac"),this.appStoreLink=this.appStoreLinks[AppPlatform.Electron],this.requireCustomPurchase=!0,this._enableFeature(i.Feature.OAuth)),this.appReviewLink=this.appReviewLinks[this.appPlatform],this.isTouchDevice=!!("ontouchstart"in window||window.navigator.msMaxTouchPoints),this.isMobileBrowser=this.checkMobileBrowser(),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.useCustomScroller=!!this.iosui,this.isTouchDevice&&this.isMobileBrowser&&(this.usePointerEvents?(this.touchStartEvent="MSPointerDown",this.touchMoveEvent="MSPointerMove",this.touchEndEvent="MSPointerUp",this.touchCancelEvent="MSPointerCancel"):(this.touchStartEvent="touchstart",this.touchMoveEvent="touchmove",this.touchEndEvent="touchend",this.touchCancelEvent="touchcancel")),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),e.hasURLParam("touch","false")?(this.touch=!1,this.phone=!1,this.mobile=!1,this.ios=!1,this.android=!1):(this.isTouchDevice&&this.isMobileBrowser||e.hasURLParam("touch","true"))&&(this.touch=!0,this.phone=!0,this.mobile=!0),this.windows&&(n+=" windows",this.ie&&(n+=" ie",this.demo||(this.mobro=this.isMobro()))),"Firefox"===this.browser&&(n+=" firefox",require(["globals"],function(e){e.runOnLoad(function(){setTimeout(function(){try{document.queryCommandEnabled("enableObjectResizing")&&document.execCommand("enableObjectResizing",!1,"false")}catch(t){e.reportError(t)}},500)})})),this.safari&&(n+=" safari"),this.phone&&(n+=" phone"),this.ipad&&(n+=" ipad"),this.embed===EmbedApps.Mailbird&&(n+=" mailbird",this.isMailbirdSidebar()&&(n+=" mailbirdSidebar")),this.demo&&(n+=" demoMode"),this.mobileie=this.ie&&this.mobile,this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"⌘":"ctrl",this.priModKey=this.mac?"⌘":"Ctrl",this.secModKeyForce=this.mac?"Ctrl":"Alt",this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!window.navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app||this.mobro)&&(this.requireCustomRedirect=!0),n&&n.length>0&&(this.bodyClass=n,this.b.className+=n),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!(this.ie||this.ieEdge||this.ios10||this.ios11),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){clearTimeout(e)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0);var a,s;if(void 0!==document.hidden?(a="hidden",s="visibilitychange"):["moz","ms","webkit"].forEach(function(e){if("undefined"!==document[e+"Hidden"])return a=e+"Hidden",s=e+"visibilitychange",!1}),void 0!==a&&(this.pageVisibilityHidden=a,this.pageVisibilityChange=s),this.initRedirectString(),this.supportsEstimatedStorage()){this.estimateAvailableStorage(function(e){this.initStorageQuota=e,e.usage/e.quota>.9&&(this.isNearStorageQuota=!0)}.bind(this),function(){})}},updateBodyClass:function(){this.bodyClass&&(document.body.className+=this.bodyClass)},supportsNotifications:function(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()},supportsNativeNotifications:function(){var e=!1;return this._allowNativeNotifications&&(this.app&&this.appPlatform!==AppPlatform.Electron?(this.ios||this.android||this.isChrome)&&(e=!0):this.embed===EmbedApps.Mailbird&&(e=!0)),e},supportsHTML5Notifications:function(){return"Notification"in window},usesHTML5Notifications:function(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()},hasNotificationPermission:function(){return!this.usesHTML5Notifications()||"granted"===Notification.permission},disallowNativeNotifications:function(){this._allowNativeNotifications=!1},supportsPersistedStorage:function(){var e=!1;return"storage"in navigator&&"persist"in navigator.storage&&(e=!0),e},requestStoragePersistence:function(e,t){navigator.storage.persisted().then(function(i){i?e():navigator.storage.persist().then(e,t)})},isStoragePersisted:function(e){this.supportsPersistedStorage()?navigator.storage.persisted().then(e):setTimeout(e,0,!1)},supportsNativePromises:function(){return!!window.Promise},supportsEstimatedStorage:function(){var e=!1;return"storage"in navigator&&"estimate"in navigator.storage?e=!0:"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage&&(e=!0),e&&this.supportsNativePromises()},estimateAvailableStorage:function(e,t){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(e,t):setTimeout(t,0)},_estimateAvailableStorage:function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise(function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t,i){e({usage:t,quota:i})},t)}):Promise.resolve({usage:NaN,quota:NaN})},supportsWebworkers:function(){var e=!1;return window.Worker&&(e=!0),e},supportsNativeDownload:function(){return this.isNativeApp()&&this.appv>=2},supportsIDBWebworkers:function(){var e=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":e=this.majorVersion>=37;break;case"Chrome":e=this.majorVersion>=24}return e},supportsPassiveListeners:function(){if(void 0===this._supportsPassiveListeners){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}this._supportsPassiveListeners=e}return this._supportsPassiveListeners},addPassiveListener:function(e,t,i){this.supportsPassiveListeners()?e.addEventListener(t,i,{passive:!0}):e.addEventListener(t,i)},isMobro:function(){var e,t=null;try{new ActiveXObject("")}catch(t){e=t.name}try{t=!!new ActiveXObject("htmlfile")}catch(e){t=!1}return!(t="ReferenceError"===e||!1!==t)},normalizeKeys:function(e){void 0!==e.normCode&&(e.synthetic||e instanceof KeyboardEvent)||(e.normCode=this.getKeyCode(e))},getKeyCode:function(e){var t;return t=null===e.keyCode||0===e.keyCode?null!==e.charCode?e.charCode:e.which:e.keyCode,46===t&&"keypress"===e.type&&(t=190),t},initAppState:function(){var t=location.hash.substring(1);if(t)for(var i,n=/([^&=]+)=([^&]*)/g;null!==(i=n.exec(t));)if("state"===decodeURIComponent(i[1])){var r=decodeURIComponent(i[2]);if(r){try{t=JSON.parse(r)}catch(e){log("Error parsing AppState: ",r),require(["globals"],function(t){t.reportError(e)}),t=void 0}t&&(this.app=!0===t.app,this.appv=t.appv,this.debugApp=t.debug,this.live=t.live,this.offline=t.offline,this.syncContacts=t.syncContacts,this.test=t.test,this.embed=t.embed,this.appState=t)}break}if(!this.app&&-1!==navigator.userAgent.indexOf("Electron/")){if(null!==new RegExp("Moo\\.do/([^\\s]+)\\s").exec(navigator.userAgent)){var a,s=RegExp.$1;switch(s){case"1.0.4":case"1.0.5":a=1;break;case"1.0.6":a=2}a&&(this.app=!0,this.appv=a,this.appState={appType:"electron"})}}this.live=this.live||e.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||this.test||e.hasURLParam("offline","true")||!1,this.demo=e.hasURLParam("demo","true")||!1,this.script=e.hasURLParam("script"),this.app=this.app||!1},getAppState:function(e){return this.appState?this.appState[e]:void 0},_enableFeature:function(e){this._features[e]=!0},_disableFeature:function(e){this._features[e]=!1},initFeatures:function(){this._enableFeature(i.Feature.ClonePane),this.isMailbirdSidebar()&&this._disableFeature(i.Feature.ClonePane)},isMailbirdSidebar:function(){return this.embed===EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")},checkMobileBrowser:function(){var e=!1;if(this.android&&this.app)e=!0;else if(!this.embed&&(function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),!e)){window.matchMedia&&window.matchMedia("(max-device-width: 620px)").matches&&(e=!0)}return e},initHostState:function(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)},initRedirectString:function(){var e,t,i=this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone;e=i?window.location.host:"www.moo.do",t=!this.app||this.appPlatform!==AppPlatform.Chrome&&this.appPlatform!==AppPlatform.Electron?"app/":"oauthRelay.html",this.customRedirectString=window.location.protocol+"//"+e+"/"+t},addPrefix:function(e,t){var i="",n=["ms","webkit","moz","o"],r=this.b.style;if(t||(t=e),"string"==typeof r[e])i="";else for(var a=0;a<n.length;a++)if("string"==typeof r["-"+n[a]+"-"+t]){i=n[a];break}var s=i.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;if(i){return{prop:"-"+i+"-"+t,style:i+s,react:(i.length>0?i.charAt(0).toUpperCase()+i.slice(1):e)+s}}return{prop:e,style:s,react:s}},blockClient:function(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0};break;case"Safari":if(this.mobile&&this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};if(!this.mobile&&(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6))return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){log("App Version out of date.");var t={version:this.versionRequired[this.appPlatform]};return this.ios?(t.update=!0,t.platform="iOS App"):this.android?(t.update=!0,t.platform="Android App"):require(["globals"],function(e){e.nativeBridge.sendToApp("updateRequired")}),
t}if(this.appv>this.versionAvailable[this.appPlatform])return log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0,error:!1}}if("1525507307692"!==document.body.getAttribute("ver")){var i=e.hasURLParam("cacheError");if(require(["globals"],function(e){e.reportError(new Error("VersionMismatch, CacheError: "+i)),!i&&this.app&&e.nativeBridge.sendToApp("resetCache")}.bind(this)),!i)return{cacheUpdate:!0,error:!0}}},actionVerb:function(){return this.touch?"tap":"click"},actionVerbCaps:function(){return this.touch?"Tap":"Click"},updateOrientation:function(){return this.orientation=90===Math.abs(window.orientation)?Orientation.Landscape:Orientation.Portrait,this.app||this.kbsize.set(this.orientation===Orientation.Portrait?this.kbsizePortrait:this.kbsizeLandscape),this.orientation},isPageVisible:function(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]},getUpdateMessages:function(e){for(var t=[],i=this.mobile?"versionMobile":"versionDesktop",n=(e||0)+1;n<=this[i];n++){var r=this[i+"Messages"][n];r&&t.push(r)}return t},isFeatureEnabled:function(e){return this._features[e]},emailPreviewSize:function(){return Math.max(Math.min(i.EmailPreviewSizeMax,this.windowWidth()-i.ExpandedPaneWidth),i.EmailPreviewSizeMin)},recordAppSubVersion:function(e){this.appSubVersion=e},getPlatformName:function(){return this.mac?"Mac":this.windows?"Windows":this.iphone?"iPhone":this.ipad?"iPad":this.android?"Android":"Chrome"},getPlatformIcon:function(){return this.mac||this.iphone||this.ipad?"icon-apple":this.windows?"icon-windows":this.android?"icon-android":"icon-chrome"},getActualWindowWidth:function(){return document.body&&document.body.clientWidth||this.android&&window.screen&&window.screen.width||0},getActualWindowHeight:function(){return document.body&&document.body.clientHeight||this.android&&window.screen&&window.screen.height||0},displayRepeatedOptionalUpdateMessage:function(){this.appPlatform===AppPlatform.Chrome&&require(["globals"],function(e){var t,i=this.appv<this.versionAvailable[AppPlatform.Chrome],n="DOWNLOAD";"ChromeOS"===this.OSName?i&&(t="The Moo.do app is out of date. Please update it in the Chrome Web Store.",n="UPDATE"):this.supportsNativeApp()&&(e.vmMain.shouldShowHelp("getNativeApp")?(e.vmMain.closeHelp("getNativeApp"),t="You might like to use the new Moo.do native application. Download it now!."):i&&(t="The Moo.do app is out of date. You might like to use the new Moo.do native application, or please update in the Chrome Web Store.")),t&&e.toasts.pushMessage({text:t,action:MessageAction.OpenURL,actionText:n,data:{url:this.getAppDownloadURL()}})}.bind(this))}},new r}),define("RingBuffer",["require","exports","module"],function(e,t,i){function n(e){this._limit=e,this._offset=0,this._buffer=[]}return n.prototype={get:function(e){return this._buffer[e]},push:function(e){this._buffer[this._offset]=e,this._offset=(this._limit+this._offset+1)%this._limit},peek:function(){var e=(this._limit+this._offset-1)%this._limit;return this._buffer[e]},pop:function(){var e=(this._limit+this._offset-1)%this._limit,t=this._buffer[e];return t&&(this._buffer[e]=void 0,this._offset=e),t},hasData:function(){return!!this.peek()},reset:function(){this._offset=0,this._buffer=[]},buffer:function(){return this._buffer},limit:function(e){this._limit=e},ordered:function(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))},entries:function(){for(var e=this.ordered(),t=0;t<e.length;++t)console.log("---- Entry ["+t+"] ----"),console.log(e[t])}},n}),define("AddressParser",["require"],function(e){function t(e){var t,i,r,a,s=!1,o="text",c=[],l={address:[],comment:[],group:[],text:[]};for(r=0,a=e.length;r<a;r++)if(t=e[r],"operator"===t.type)switch(t.value){case"<":o="address";break;case"(":o="comment";break;case":":o="group",s=!0;break;default:o="text"}else t.value&&("address"===o&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),l[o].push(t.value));if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),s)l.text=l.text.join(" "),c.push({name:l.text||i&&i.name,group:l.group.length?n.parse(l.group.join(",")):[]});else{if(!l.address.length&&l.text.length){for(r=l.text.length-1;r>=0;r--)if(l.text[r].match(/^[^@\s]+@[^@\s]+$/)){l.address=l.text.splice(r,1);break}var d=function(e){return l.address.length?e:(l.address=[e.trim()]," ")};if(!l.address.length)for(r=l.text.length-1;r>=0&&(l.text[r]=l.text[r].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,d).trim(),!l.address.length);r--);}if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),l.address.length>1&&(l.text=l.text.concat(l.address.splice(1))),l.text=l.text.join(" "),l.address=l.address.join(" "),!l.address&&s)return[];i={address:l.address||l.text||"",name:l.text||l.address||""},i.address===i.name&&((i.address||"").match(/@/)?i.name="":i.address=""),c.push(i)}return c}function i(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}var n={};return i.prototype={tokenize:function(){for(var e,t=[],i=0,n=this.str.length;i<n;i++)e=this.str.charAt(i),this.checkChar(e);return this.list.forEach(function(e){e.value=(e.value||"").toString().trim(),e.value&&t.push(e)}),t},checkChar:function(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}if(!this.escaped&&"\\"===e)return void(this.escaped=!0);this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1}},n.parse=function(e){var n=new i(e),r=n.tokenize(),a=[],s=[],o=[];r.forEach(function(e){"operator"!==e.type||","!==e.value&&";"!==e.value?s.push(e):(s.length&&a.push(s),s=[])}),s.length&&a.push(s),a.forEach(function(e){e=t(e),e.length&&(o=o.concat(e))});for(var c=[],l=0;l<o.length;++l)c.push({type:"contact",text:o[l].name||o[l].address,email:o[l].address});return c},n}),function(e,t,i){function n(e,i){this.wrapper="string"==typeof e?t.querySelector(e):e,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var n in i)this.options[n]=i[n];this.translateZ=this.options.HWCompositing&&o.hasPerspective?" translateZ(0)":"",this.options.useTransition=o.hasTransition&&this.options.useTransition,this.options.useTransform=o.hasTransform&&this.options.useTransform,this.options.eventPassthrough=!0===this.options.eventPassthrough?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"!=this.options.eventPassthrough&&this.options.scrollY,this.options.scrollX="horizontal"!=this.options.eventPassthrough&&this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?o.ease[this.options.bounceEasing]||o.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,!0===this.options.tap&&(this.options.tap="tap"),"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,3==this.options.probeType&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function r(e,i,n){var r=t.createElement("div"),a=t.createElement("div");return!0===n&&(r.style.cssText="position:absolute;z-index:9999",a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),a.className="iScrollIndicator","h"==e?(!0===n&&(r.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",a.style.height="100%"),r.className="iScrollHorizontalScrollbar"):(!0===n&&(r.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",a.style.width="100%"),r.className="iScrollVerticalScrollbar"),r.style.cssText+=";overflow:hidden",i||(r.style.pointerEvents="none"),r.appendChild(a),r}function a(i,n){this.wrapper="string"==typeof n.el?t.querySelector(n.el):n.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=i,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var r in n)this.options[r]=n[r];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(o.addEvent(this.indicator,"touchstart",this),o.addEvent(e,"touchend",this)),this.options.disablePointer||(o.addEvent(this.indicator,o.prefixPointerEvent("pointerdown"),this),o.addEvent(e,o.prefixPointerEvent("pointerup"),this)),this.options.disableMouse||(o.addEvent(this.indicator,"mousedown",this),o.addEvent(e,"mouseup",this))),this.options.fade&&(this.wrapperStyle[o.style.transform]=this.scroller.translateZ,this.wrapperStyle[o.style.transitionDuration]=o.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var s=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)},o=function(){function n(e){return!1!==s&&(""===s?e:s+e.charAt(0).toUpperCase()+e.substr(1))}var r={},a=t.createElement("div").style,s=function(){for(var e=["t","webkitT","MozT","msT","OT"],t=0,i=e.length;t<i;t++)if(e[t]+"ransform"in a)return e[t].substr(0,e[t].length-1);return!1}();r.getTime=Date.now||function(){return(new Date).getTime()},r.extend=function(e,t){for(var i in t)e[i]=t[i]},r.addEvent=function(e,t,i,n){e.addEventListener(t,i,!!n)},r.removeEvent=function(e,t,i,n){e.removeEventListener(t,i,!!n)},r.prefixPointerEvent=function(t){return e.MSPointerEvent?"MSPointer"+t.charAt(9).toUpperCase()+t.substr(10):t},r.momentum=function(e,t,n,r,a,s){var o,c,l=e-t,d=i.abs(l)/n;return s=void 0===s?6e-4:s,o=e+d*d/(2*s)*(l<0?-1:1),c=d/s,o<r?(o=a?r-a/2.5*(d/8):r,l=i.abs(o-e),c=l/d):o>0&&(o=a?a/2.5*(d/8):0,l=i.abs(e)+o,c=l/d),{destination:i.round(o),duration:c}};var o=n("transform");return r.extend(r,{hasTransform:!1!==o,hasPerspective:n("perspective")in a,hasTouch:"ontouchstart"in e,hasPointer:e.PointerEvent||e.MSPointerEvent,hasTransition:n("transition")in a}),r.isBadAndroid=/Android /.test(e.navigator.appVersion)&&!/Chrome\/\d/.test(e.navigator.appVersion),r.extend(r.style={},{transform:o,transitionTimingFunction:n("transitionTimingFunction"),transitionDuration:n("transitionDuration"),transitionDelay:n("transitionDelay"),transformOrigin:n("transformOrigin")}),r.hasClass=function(e,t){return new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},r.addClass=function(e,t){if(!r.hasClass(e,t)){var i=e.className.split(" ");i.push(t),e.className=i.join(" ")}},r.removeClass=function(e,t){if(r.hasClass(e,t)){var i=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(i," ")}},r.offset=function(e){for(var t=-e.offsetLeft,i=-e.offsetTop;e=e.offsetParent;)t-=e.offsetLeft,i-=e.offsetTop;return{left:t,top:i}},r.preventDefaultException=function(e,t){for(var i in t)if(t[i].test(e[i]))return!0;return!1},r.extend(r.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),r.extend(r.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(e){return e*(2-e)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(e){return i.sqrt(1- --e*e)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(e){return(e-=1)*e*(5*e+4)+1}},bounce:{style:"",fn:function(e){return(e/=1)<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}},elastic:{style:"",fn:function(e){return 0===e?0:1==e?1:.4*i.pow(2,-10*e)*i.sin((e-.055)*(2*i.PI)/.22)+1}}}),r.tap=function(e,i){var n=t.createEvent("Event");n.initEvent(i,!0,!0),n.pageX=e.pageX,n.pageY=e.pageY,e.target.dispatchEvent(n)},r.click=function(e){var i,n=e.target;/(SELECT|INPUT|TEXTAREA)/i.test(n.tagName)||(i=t.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!0,e.view,1,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),i._constructed=!0,n.dispatchEvent(i))},r}();n.prototype={version:"5.1.3",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(e){e.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(e){if((1==o.eventType[e.type]||0===e.button)&&this.enabled&&(!this.initiated||o.eventType[e.type]===this.initiated)){!this.options.preventDefault||o.isBadAndroid||o.preventDefaultException(e.target,this.options.preventDefaultException)||e.preventDefault();var t,n=e.touches?e.touches[0]:e;this.initiated=o.eventType[e.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=o.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,t=this.getComputedPosition(),this._translate(i.round(t.x),i.round(t.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=n.pageX,this.pointY=n.pageY,this._execEvent("beforeScrollStart")}},_move:function(e){if(this.enabled&&o.eventType[e.type]===this.initiated){this.options.preventDefault&&e.preventDefault();var t,n,r,a,s=e.touches?e.touches[0]:e,c=s.pageX-this.pointX,l=s.pageY-this.pointY,d=o.getTime();if(this.pointX=s.pageX,this.pointY=s.pageY,this.distX+=c,this.distY+=l,r=i.abs(this.distX),a=i.abs(this.distY),!(d-this.endTime>300&&r<10&&a<10)){if(this.directionLocked||this.options.freeScroll||(r>a+this.options.directionLockThreshold?this.directionLocked="h":a>=r+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)e.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);l=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)e.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);c=0}c=this.hasHorizontalScroll?c:0,l=this.hasVerticalScroll?l:0,t=this.x+c,n=this.y+l,(t>0||t<this.maxScrollX)&&(t=this.options.bounce?this.x+c/3:t>0?0:this.maxScrollX),(n>0||n<this.maxScrollY)&&(n=this.options.bounce?this.y+l/3:n>0?0:this.maxScrollY),this.directionX=c>0?-1:c<0?1:0,this.directionY=l>0?-1:l<0?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(t,n),d-this.startTime>300&&(this.startTime=d,this.startX=this.x,this.startY=this.y,1==this.options.probeType&&this._execEvent("scroll")),this.options.probeType>1&&this._execEvent("scroll")}}},_end:function(e){if(this.enabled&&o.eventType[e.type]===this.initiated){this.options.preventDefault&&!o.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t,n,r=(e.changedTouches&&e.changedTouches[0],o.getTime()-this.startTime),a=i.round(this.x),s=i.round(this.y),c=i.abs(a-this.startX),l=i.abs(s-this.startY),d=0,h="";if(this.isInTransition=0,this.initiated=0,this.endTime=o.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(a,s),!this.moved)return this.options.tap&&o.tap(e,this.options.tap),this.options.click&&o.click(e),void this._execEvent("scrollCancel");if(this._events.flick&&r<200&&c<100&&l<100)return void this._execEvent("flick");if(this.options.momentum&&r<300&&(t=this.hasHorizontalScroll?o.momentum(this.x,this.startX,r,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:a,duration:0},n=this.hasVerticalScroll?o.momentum(this.y,this.startY,r,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:s,duration:0},a=t.destination,s=n.destination,d=i.max(t.duration,n.duration),this.isInTransition=1),this.options.snap){var u=this._nearestSnap(a,s);this.currentPage=u,d=this.options.snapSpeed||i.max(i.max(i.min(i.abs(a-u.x),1e3),i.min(i.abs(s-u.y),1e3)),300),a=u.x,s=u.y,this.directionX=0,this.directionY=0,h=this.options.bounceEasing}if(a!=this.x||s!=this.y)return(a>0||a<this.maxScrollX||s>0||s<this.maxScrollY)&&(h=o.ease.quadratic),void this.scrollTo(a,s,d,h);this._execEvent("scrollEnd")}}},resetPosition:function(e){var t=this.x,i=this.y;return e=e||0,!this.hasHorizontalScroll||this.x>0?t=0:this.x<this.maxScrollX&&(t=this.maxScrollX),!this.hasVerticalScroll||this.y>0?i=0:this.y<this.maxScrollY&&(i=this.maxScrollY),(t!=this.x||i!=this.y)&&(this.scrollTo(t,i,e,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=o.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},manualRefresh:function(e){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.wrapperWidth,this.scrollerHeight=e,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=o.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},off:function(e,t){if(this._events[e]){var i=this._events[e].indexOf(t);i>-1&&this._events[e].splice(i,1)}},_execEvent:function(e){if(this._events[e]){var t=0,i=this._events[e].length;if(i)for(;t<i;t++)this._events[e][t].apply(this,[].slice.call(arguments,1))}},scrollBy:function(e,t,i,n){e=this.x+e,t=this.y+t,i=i||0,this.scrollTo(e,t,i,n)},scrollTo:function(e,t,i,n){n=n||o.ease.circular,this.isInTransition=this.options.useTransition&&i>0,!i||this.options.useTransition&&n.style?(this._transitionTimingFunction(n.style),this._transitionTime(i),this._translate(e,t)):this._animate(e,t,i,n.fn)},scrollToElement:function(e,t,n,r,a){if(e=e.nodeType?e:this.scroller.querySelector(e)){var s=o.offset(e);s.left-=this.wrapperOffset.left,s.top-=this.wrapperOffset.top,!0===n&&(n=i.round(e.offsetWidth/2-this.wrapper.offsetWidth/2)),!0===r&&(r=i.round(e.offsetHeight/2-this.wrapper.offsetHeight/2)),s.left-=n||0,s.top-=r||0,s.left=s.left>0?0:s.left<this.maxScrollX?this.maxScrollX:s.left,s.top=s.top>0?0:s.top<this.maxScrollY?this.maxScrollY:s.top,t=void 0===t||null===t||"auto"===t?i.max(i.abs(this.x-s.left),i.abs(this.y-s.top)):t,this.scrollTo(s.left,s.top,t,a)}},_transitionTime:function(e){if(e=e||0,this.scrollerStyle[o.style.transitionDuration]=e+"ms",!e&&o.isBadAndroid&&(this.scrollerStyle[o.style.transitionDuration]="0.001s"),this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTime(e)},_transitionTimingFunction:function(e){if(this.scrollerStyle[o.style.transitionTimingFunction]=e,this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTimingFunction(e)},_translate:function(e,t){if(this.options.useTransform?this.scrollerStyle[o.style.transform]="translate("+e+"px,"+t+"px)"+this.translateZ:(e=i.round(e),t=i.round(t),this.scrollerStyle.left=e+"px",this.scrollerStyle.top=t+"px"),this.x=e,this.y=t,this.indicators)for(var n=this.indicators.length;n--;)this.indicators[n].updatePosition()},_initEvents:function(t){var i=t?o.removeEvent:o.addEvent,n=this.options.bindToWrapper?this.wrapper:e;this.options.click&&i(this.wrapper,"click",this,!0),this.options.disableMouse||(i(this.wrapper,"mousedown",this),i(n,"mousemove",this),i(n,"mousecancel",this),i(n,"mouseup",this)),o.hasPointer&&!this.options.disablePointer&&(i(this.wrapper,o.prefixPointerEvent("pointerdown"),this),i(n,o.prefixPointerEvent("pointermove"),this),i(n,o.prefixPointerEvent("pointercancel"),this),i(n,o.prefixPointerEvent("pointerup"),this)),o.hasTouch&&!this.options.disableTouch&&(i(this.wrapper,"touchstart",this),i(n,"touchmove",this),i(n,"touchcancel",this),i(n,"touchend",this)),i(this.scroller,"transitionend",this),i(this.scroller,"webkitTransitionEnd",this),i(this.scroller,"oTransitionEnd",this),i(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var t,i,n=e.getComputedStyle(this.scroller,null);return this.options.useTransform?(n=n[o.style.transform].split(")")[0].split(", "),t=+(n[12]||n[4]),i=+(n[13]||n[5])):(t=+n.left.replace(/[^-\d.]/g,""),i=+n.top.replace(/[^-\d.]/g,"")),{x:t,y:i}},_initIndicators:function(){function e(e){for(var t=o.indicators.length;t--;)e.call(o.indicators[t])}var t,i=this.options.interactiveScrollbars,n="string"!=typeof this.options.scrollbars,s=[],o=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(t={el:r("v",i,this.options.scrollbars),interactive:i,defaultScrollbars:!0,customStyle:n,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(t.el),s.push(t)),this.options.scrollX&&(t={el:r("h",i,this.options.scrollbars),interactive:i,defaultScrollbars:!0,customStyle:n,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(t.el),s.push(t))),this.options.indicators&&(s=s.concat(this.options.indicators));for(var c=s.length;c--;)this.indicators.push(new a(this,s[c]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){e(function(){this.fade()})}),this.on("scrollCancel",function(){e(function(){this.fade()})}),this.on("scrollStart",function(){e(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){e(function(){this.fade(1,!0)})})),this.on("refresh",function(){e(function(){this.refresh()})}),this.on("destroy",function(){e(function(){this.destroy()}),delete this.indicators})},_initWheel:function(){o.addEvent(this.wrapper,"wheel",this),o.addEvent(this.wrapper,"mousewheel",this),o.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){o.removeEvent(this.wrapper,"wheel",this),o.removeEvent(this.wrapper,"mousewheel",this),o.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(e){if(this.enabled){e.preventDefault(),e.stopPropagation();var t,n,r,a,s=this;if(void 0===this.wheelTimeout&&s._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){s._execEvent("scrollEnd"),s.wheelTimeout=void 0},400),"deltaX"in e)1===e.deltaMode?(t=-e.deltaX*this.options.mouseWheelSpeed,n=-e.deltaY*this.options.mouseWheelSpeed):(t=-e.deltaX,n=-e.deltaY);else if("wheelDeltaX"in e)t=e.wheelDeltaX/120*this.options.mouseWheelSpeed,n=e.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in e)t=n=e.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in e))return;t=n=-e.detail/3*this.options.mouseWheelSpeed}if(t*=this.options.invertWheelDirection,n*=this.options.invertWheelDirection,this.hasVerticalScroll||(t=n,n=0),this.options.snap)return r=this.currentPage.pageX,a=this.currentPage.pageY,t>0?r--:t<0&&r++,n>0?a--:n<0&&a++,void this.goToPage(r,a);r=this.x+i.round(this.hasHorizontalScroll?t:0),a=this.y+i.round(this.hasVerticalScroll?n:0),r>0?r=0:r<this.maxScrollX&&(r=this.maxScrollX),a>0?a=0:a<this.maxScrollY&&(a=this.maxScrollY),this.scrollTo(r,a,0),this.options.probeType>1&&this._execEvent("scroll")}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var e,t,n,r,a,s,o=0,c=0,l=0,d=this.options.snapStepX||this.wrapperWidth,h=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(!0===this.options.snap)for(n=i.round(d/2),r=i.round(h/2);l>-this.scrollerWidth;){for(this.pages[o]=[],e=0,a=0;a>-this.scrollerHeight;)this.pages[o][e]={x:i.max(l,this.maxScrollX),y:i.max(a,this.maxScrollY),width:d,height:h,cx:l-n,cy:a-r},a-=h,e++;l-=d,o++}else for(s=this.options.snap,e=s.length,t=-1;o<e;o++)(0===o||s[o].offsetLeft<=s[o-1].offsetLeft)&&(c=0,t++),this.pages[c]||(this.pages[c]=[]),l=i.max(-s[o].offsetLeft,this.maxScrollX),a=i.max(-s[o].offsetTop,this.maxScrollY),n=l-i.round(s[o].offsetWidth/2),r=a-i.round(s[o].offsetHeight/2),this.pages[c][t]={x:l,y:a,width:s[o].offsetWidth,height:s[o].offsetHeight,cx:n,cy:r},l>this.maxScrollX&&c++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1==0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=i.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=i.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var e=this.options.snapSpeed||i.max(i.max(i.min(i.abs(this.x-this.startX),1e3),i.min(i.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,e)})},_nearestSnap:function(e,t){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var n=0,r=this.pages.length,a=0;if(i.abs(e-this.absStartX)<this.snapThresholdX&&i.abs(t-this.absStartY)<this.snapThresholdY)return this.currentPage;for(e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),t>0?t=0:t<this.maxScrollY&&(t=this.maxScrollY);n<r;n++)if(e>=this.pages[n][0].cx){e=this.pages[n][0].x;break}for(r=this.pages[n].length;a<r;a++)if(t>=this.pages[0][a].cy){t=this.pages[0][a].y;break}return n==this.currentPage.pageX&&(n+=this.directionX,n<0?n=0:n>=this.pages.length&&(n=this.pages.length-1),e=this.pages[n][0].x),a==this.currentPage.pageY&&(a+=this.directionY,a<0?a=0:a>=this.pages[0].length&&(a=this.pages[0].length-1),t=this.pages[0][a].y),{x:e,y:t,pageX:n,pageY:a}},goToPage:function(e,t,n,r){r=r||this.options.bounceEasing,e>=this.pages.length?e=this.pages.length-1:e<0&&(e=0),t>=this.pages[e].length?t=this.pages[e].length-1:t<0&&(t=0);var a=this.pages[e][t].x,s=this.pages[e][t].y;n=void 0===n?this.options.snapSpeed||i.max(i.max(i.min(i.abs(a-this.x),1e3),i.min(i.abs(s-this.y),1e3)),300):n,this.currentPage={x:a,y:s,pageX:e,pageY:t},this.scrollTo(a,s,n,r)},next:function(e,t){var i=this.currentPage.pageX,n=this.currentPage.pageY;i++,i>=this.pages.length&&this.hasVerticalScroll&&(i=0,n++),this.goToPage(i,n,e,t)},prev:function(e,t){var i=this.currentPage.pageX,n=this.currentPage.pageY;i--,i<0&&this.hasVerticalScroll&&(i=0,n--),this.goToPage(i,n,e,t)},_initKeys:function(t){var i,n={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(i in this.options.keyBindings)"string"==typeof this.options.keyBindings[i]&&(this.options.keyBindings[i]=this.options.keyBindings[i].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(i in n)this.options.keyBindings[i]=this.options.keyBindings[i]||n[i];o.addEvent(e,"keydown",this),this.on("destroy",function(){o.removeEvent(e,"keydown",this)})},_key:function(e){if(this.enabled){var t,n=this.options.snap,r=n?this.currentPage.pageX:this.x,a=n?this.currentPage.pageY:this.y,s=o.getTime(),c=this.keyTime||0;switch(this.options.useTransition&&this.isInTransition&&(t=this.getComputedPosition(),this._translate(i.round(t.x),i.round(t.y)),this.isInTransition=!1),this.keyAcceleration=s-c<200?i.min(this.keyAcceleration+.25,50):0,e.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?r+=n?1:this.wrapperWidth:a+=n?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?r-=n?1:this.wrapperWidth:a-=n?1:this.wrapperHeight;break;case this.options.keyBindings.end:r=n?this.pages.length-1:this.maxScrollX,a=n?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:r=0,a=0;break;case this.options.keyBindings.left:r+=n?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:a+=n?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:r-=n?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:a-=n?1:5+this.keyAcceleration>>0;break;default:return}if(n)return void this.goToPage(r,a);r>0?(r=0,this.keyAcceleration=0):r<this.maxScrollX&&(r=this.maxScrollX,this.keyAcceleration=0),a>0?(a=0,this.keyAcceleration=0):a<this.maxScrollY&&(a=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(r,a,0),this.keyTime=s}},_animate:function(e,t,i,n){function r(){var u,p,m,f=o.getTime();if(f>=h)return a.isAnimating=!1,a._translate(e,t),void(a.resetPosition(a.options.bounceTime)||a._execEvent("scrollEnd"));f=(f-d)/i,m=n(f),u=(e-c)*m+c,p=(t-l)*m+l,a._translate(u,p),a.isAnimating&&s(r),3==a.options.probeType&&a._execEvent("scroll")}var a=this,c=this.x,l=this.y,d=o.getTime(),h=d+i;this.isAnimating=!0,r()},handleEvent:function(e){switch(e.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(e);break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(e);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(e);break;case"keydown":this._key(e);break;case"click":e._constructed||(e.preventDefault(),e.stopPropagation())}}},
a.prototype={handleEvent:function(e){switch(e.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(e)}},destroy:function(){this.options.interactive&&(o.removeEvent(this.indicator,"touchstart",this),o.removeEvent(this.indicator,o.prefixPointerEvent("pointerdown"),this),o.removeEvent(this.indicator,"mousedown",this),o.removeEvent(e,"touchmove",this),o.removeEvent(e,o.prefixPointerEvent("pointermove"),this),o.removeEvent(e,"mousemove",this),o.removeEvent(e,"touchend",this),o.removeEvent(e,o.prefixPointerEvent("pointerup"),this),o.removeEvent(e,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(t){var i=t.touches?t.touches[0]:t;t.preventDefault(),t.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=i.pageX,this.lastPointY=i.pageY,this.startTime=o.getTime(),this.options.disableTouch||o.addEvent(e,"touchmove",this),this.options.disablePointer||o.addEvent(e,o.prefixPointerEvent("pointermove"),this),this.options.disableMouse||o.addEvent(e,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(e){var t,i,n,r,a=e.touches?e.touches[0]:e,s=o.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,t=a.pageX-this.lastPointX,this.lastPointX=a.pageX,i=a.pageY-this.lastPointY,this.lastPointY=a.pageY,n=this.x+t,r=this.y+i,this._pos(n,r),1==this.scroller.options.probeType&&s-this.startTime>300?(this.startTime=s,this.scroller._execEvent("scroll")):this.scroller.options.probeType>1&&this.scroller._execEvent("scroll"),e.preventDefault(),e.stopPropagation()},_end:function(t){if(this.initiated){if(this.initiated=!1,t.preventDefault(),t.stopPropagation(),o.removeEvent(e,"touchmove",this),o.removeEvent(e,o.prefixPointerEvent("pointermove"),this),o.removeEvent(e,"mousemove",this),this.scroller.options.snap){var n=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),r=this.options.snapSpeed||i.max(i.max(i.min(i.abs(this.scroller.x-n.x),1e3),i.min(i.abs(this.scroller.y-n.y),1e3)),300);this.scroller.x==n.x&&this.scroller.y==n.y||(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=n,this.scroller.scrollTo(n.x,n.y,r,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(e){e=e||0,this.indicatorStyle[o.style.transitionDuration]=e+"ms",!e&&o.isBadAndroid&&(this.indicatorStyle[o.style.transitionDuration]="0.001s")},transitionTimingFunction:function(e){this.indicatorStyle[o.style.transitionTimingFunction]=e},refresh:function(){this.transitionTime(),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(o.addClass(this.wrapper,"iScrollBothScrollbars"),o.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(o.removeClass(this.wrapper,"iScrollBothScrollbars"),o.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=i.max(i.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"==this.options.shrink?(this.minBoundaryX=8-this.indicatorWidth,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=i.max(i.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=8-this.indicatorHeight,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var e=this.options.listenX&&i.round(this.sizeRatioX*this.scroller.x)||0,t=this.options.listenY&&i.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(e<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=i.max(this.indicatorWidth+e,8),this.indicatorStyle.width=this.width+"px"),e=this.minBoundaryX):e>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=i.max(this.indicatorWidth-(e-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",e=this.maxPosX+this.indicatorWidth-this.width):e=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),t<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=i.max(this.indicatorHeight+3*t,8),this.indicatorStyle.height=this.height+"px"),t=this.minBoundaryY):t>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=i.max(this.indicatorHeight-3*(t-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",t=this.maxPosY+this.indicatorHeight-this.height):t=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=e,this.y=t,this.scroller.options.useTransform?this.indicatorStyle[o.style.transform]="translate("+e+"px,"+t+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=e+"px",this.indicatorStyle.top=t+"px")},_pos:function(e,t){e<0?e=0:e>this.maxPosX&&(e=this.maxPosX),t<0?t=0:t>this.maxPosY&&(t=this.maxPosY),e=this.options.listenX?i.round(e/this.sizeRatioX):this.scroller.x,t=this.options.listenY?i.round(t/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(e,t)},fade:function(e,t){if(!t||this.visible){clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var i=e?250:500,n=e?0:300;e=e?"1":"0",this.wrapperStyle[o.style.transitionDuration]=i+"ms",this.fadeTimeout=setTimeout(function(e){this.wrapperStyle.opacity=e,this.visible=+e}.bind(this,e),n)}}},n.utils=o,"undefined"!=typeof module&&module.exports?module.exports=n:e.IScroll=n}(window,document,Math),define("IScroll",function(e){return function(){return e.IScroll}}(this)),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("react",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.React=e()}}(function(){return function e(t,i,n){function r(s,o){if(!i[s]){if(!t[s]){var c="function"==typeof require&&require;if(!o&&c)return c(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[s]={exports:{}};t[s][0].call(d.exports,function(e){var i=t[s][1][e];return r(i||e)},d,d.exports,e,t,i,n)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){"use strict";function n(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i["ms"+e]="MS"+t,i["O"+e]="o"+t.toLowerCase(),i}function r(e){if(o[e])return o[e];if(!s[e])return e;var t=s[e];for(var i in t)if(t.hasOwnProperty(i)&&i in c)return o[e]=t[i];return""}var a=e(40),s={animationend:n("Animation","AnimationEnd"),animationiteration:n("Animation","AnimationIteration"),animationstart:n("Animation","AnimationStart"),transitionend:n("Transition","TransitionEnd")},o={},c={};a.canUseDOM&&(c=document.createElement("div").style,"AnimationEvent"in window||(delete s.animationend.animation,delete s.animationiteration.animation,delete s.animationstart.animation),"TransitionEvent"in window||delete s.transitionend.transition),t.exports=r},{40:40}],2:[function(e,t,i){"use strict";function n(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}function r(e){var t=/(=0|=2)/g,i={"=0":"=","=2":":"};return(""+("."===e[0]&&"$"===e[1]?e.substring(2):e.substring(1))).replace(t,function(e){return i[e]})}var a={escape:n,unescape:r};t.exports=a},{}],3:[function(e,t,i){"use strict";var n=e(18),r=e(24),a={linkState:function(e){return new n(this.state[e],r.createStateKeySetter(this,e))}};t.exports=a},{18:18,24:24}],4:[function(e,t,i){"use strict";var n=e(35),r=(e(43),function(e){var t=this;if(t.instancePool.length){var i=t.instancePool.pop();return t.call(i,e),i}return new t(e)}),a=function(e,t){var i=this;if(i.instancePool.length){var n=i.instancePool.pop();return i.call(n,e,t),n}return new i(e,t)},s=function(e,t,i){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,e,t,i),r}return new n(e,t,i)},o=function(e,t,i,n){var r=this;if(r.instancePool.length){var a=r.instancePool.pop();return r.call(a,e,t,i,n),a}return new r(e,t,i,n)},c=function(e){var t=this;e instanceof t||n("25"),e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},l=r,d=function(e,t){var i=e;return i.instancePool=[],i.getPooled=t||l,i.poolSize||(i.poolSize=10),i.release=c,i},h={addPoolingTo:d,oneArgumentPooler:r,twoArgumentPooler:a,threeArgumentPooler:s,fourArgumentPooler:o};t.exports=h},{35:35,43:43}],5:[function(e,t,i){"use strict";var n=e(46),r=e(9),a=e(11),s=e(23),o=e(10),c=e(14),l=e(15),d=e(21),h=e(28),u=e(34),p=(e(45),l.createElement),m=l.createFactory,f=l.cloneElement,g=n,v={Children:{map:r.map,forEach:r.forEach,count:r.count,toArray:r.toArray,only:u},Component:a,PureComponent:s,createElement:p,cloneElement:f,isValidElement:l.isValidElement,PropTypes:d,createClass:o.createClass,createFactory:m,createMixin:function(e){return e},DOM:c,version:h,__spread:g};t.exports=v},{10:10,11:11,14:14,15:15,21:21,23:23,28:28,34:34,45:45,46:46,9:9}],6:[function(e,t,i){"use strict";function n(){if(!r){var t=e(30);r=t.__SECRET_INJECTED_REACT_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED}return r}var r;i.getReactDOM=n},{30:30}],7:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t="transition"+e+"Timeout",i="transition"+e;return function(e){if(e[i]){if(null==e[t])return new Error(t+" wasn't supplied to ReactCSSTransitionGroup: this can cause unreliable animations and won't be supported in a future version of React. See https://fb.me/react-animation-transition-group-timeout for more information.");if("number"!=typeof e[t])return new Error(t+" must be a number (in milliseconds)")}}}var o=e(46),c=e(5),l=e(27),d=e(8),h=function(e){function t(){var i,a,s;n(this,t);for(var o=arguments.length,l=Array(o),h=0;h<o;h++)l[h]=arguments[h];return i=a=r(this,e.call.apply(e,[this].concat(l))),a._wrapChild=function(e){return c.createElement(d,{name:a.props.transitionName,appear:a.props.transitionAppear,enter:a.props.transitionEnter,leave:a.props.transitionLeave,appearTimeout:a.props.transitionAppearTimeout,enterTimeout:a.props.transitionEnterTimeout,leaveTimeout:a.props.transitionLeaveTimeout},e)},s=i,r(a,s)}return a(t,e),t.prototype.render=function(){return c.createElement(l,o({},this.props,{childFactory:this._wrapChild}))},t}(c.Component);h.displayName="ReactCSSTransitionGroup",h.propTypes={transitionName:d.propTypes.name,transitionAppear:c.PropTypes.bool,transitionEnter:c.PropTypes.bool,transitionLeave:c.PropTypes.bool,transitionAppearTimeout:s("Appear"),transitionEnterTimeout:s("Enter"),transitionLeaveTimeout:s("Leave")},h.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},t.exports=h},{27:27,46:46,5:5,8:8}],8:[function(e,t,i){"use strict";var n=e(5),r=e(6),a=e(39),s=e(26),o=e(34),c=n.createClass({displayName:"ReactCSSTransitionGroupChild",propTypes:{name:n.PropTypes.oneOfType([n.PropTypes.string,n.PropTypes.shape({enter:n.PropTypes.string,leave:n.PropTypes.string,active:n.PropTypes.string}),n.PropTypes.shape({enter:n.PropTypes.string,enterActive:n.PropTypes.string,leave:n.PropTypes.string,leaveActive:n.PropTypes.string,appear:n.PropTypes.string,appearActive:n.PropTypes.string})]).isRequired,appear:n.PropTypes.bool,enter:n.PropTypes.bool,leave:n.PropTypes.bool,appearTimeout:n.PropTypes.number,enterTimeout:n.PropTypes.number,leaveTimeout:n.PropTypes.number},transition:function(e,t,i){var n=r.getReactDOM().findDOMNode(this);if(!n)return void(t&&t());var o=this.props.name[e]||this.props.name+"-"+e,c=this.props.name[e+"Active"]||o+"-active",l=null,d=function(e){e&&e.target!==n||(clearTimeout(l),a.removeClass(n,o),a.removeClass(n,c),s.removeEndEventListener(n,d),t&&t())};a.addClass(n,o),this.queueClassAndNode(c,n),i?(l=setTimeout(d,i),this.transitionTimeouts.push(l)):s.addEndEventListener(n,d)},queueClassAndNode:function(e,t){this.classNameAndNodeQueue.push({className:e,node:t}),this.timeout||(this.timeout=setTimeout(this.flushClassNameAndNodeQueue,17))},flushClassNameAndNodeQueue:function(){this.isMounted()&&this.classNameAndNodeQueue.forEach(function(e){a.addClass(e.node,e.className)}),this.classNameAndNodeQueue.length=0,this.timeout=null},componentWillMount:function(){this.classNameAndNodeQueue=[],this.transitionTimeouts=[]},componentWillUnmount:function(){this.timeout&&clearTimeout(this.timeout),this.transitionTimeouts.forEach(function(e){clearTimeout(e)}),this.classNameAndNodeQueue.length=0},componentWillAppear:function(e){this.props.appear?this.transition("appear",e,this.props.appearTimeout):e()},componentWillEnter:function(e){this.props.enter?this.transition("enter",e,this.props.enterTimeout):e()},componentWillLeave:function(e){this.props.leave?this.transition("leave",e,this.props.leaveTimeout):e()},render:function(){return o(this.props.children)}});t.exports=c},{26:26,34:34,39:39,5:5,6:6}],9:[function(e,t,i){"use strict";function n(e){return(""+e).replace(S,"$&/")}function r(e,t){this.func=e,this.context=t,this.count=0}function a(e,t,i){var n=e.func,r=e.context;n.call(r,t,e.count++)}function s(e,t,i){if(null==e)return e;var n=r.getPooled(t,i);v(e,a,n),r.release(n)}function o(e,t,i,n){this.result=e,this.keyPrefix=t,this.func=i,this.context=n,this.count=0}function c(e,t,i){var r=e.result,a=e.keyPrefix,s=e.func,o=e.context,c=s.call(o,t,e.count++);Array.isArray(c)?l(c,r,i,g.thatReturnsArgument):null!=c&&(f.isValidElement(c)&&(c=f.cloneAndReplaceKey(c,a+(!c.key||t&&t.key===c.key?"":n(c.key)+"/")+i)),r.push(c))}function l(e,t,i,r,a){var s="";null!=i&&(s=n(i)+"/");var l=o.getPooled(t,s,r,a);v(e,c,l),o.release(l)}function d(e,t,i){if(null==e)return e;var n=[];return l(e,n,null,t,i),n}function h(e,t,i){return null}function u(e,t){return v(e,h,null)}function p(e){var t=[];return l(e,t,null,g.thatReturnsArgument),t}var m=e(4),f=e(15),g=e(41),v=e(37),y=m.twoArgumentPooler,b=m.fourArgumentPooler,S=/\/+/g;r.prototype.destructor=function(){this.func=null,this.context=null,this.count=0},m.addPoolingTo(r,y),o.prototype.destructor=function(){this.result=null,this.keyPrefix=null,this.func=null,this.context=null,this.count=0},m.addPoolingTo(o,b);var E={forEach:s,map:d,mapIntoWithKeyPrefixInternal:l,count:u,toArray:p};t.exports=E},{15:15,37:37,4:4,41:41}],10:[function(e,t,i){"use strict";function n(e){return e}function r(e,t){var i=S.hasOwnProperty(t)?S[t]:null;C.hasOwnProperty(t)&&"OVERRIDE_BASE"!==i&&u("73",t),e&&"DEFINE_MANY"!==i&&"DEFINE_MANY_MERGED"!==i&&u("74",t)}function a(e,t){if(t){"function"==typeof t&&u("75"),f.isValidElement(t)&&u("76");var i=e.prototype,n=i.__reactAutoBindPairs;t.hasOwnProperty(y)&&E.mixins(e,t.mixins);for(var a in t)if(t.hasOwnProperty(a)&&a!==y){var s=t[a],o=i.hasOwnProperty(a);if(r(o,a),E.hasOwnProperty(a))E[a](e,s);else{var d=S.hasOwnProperty(a),h="function"==typeof s,p=h&&!d&&!o&&!1!==t.autobind;if(p)n.push(a,s),i[a]=s;else if(o){var m=S[a];(!d||"DEFINE_MANY_MERGED"!==m&&"DEFINE_MANY"!==m)&&u("77",m,a),"DEFINE_MANY_MERGED"===m?i[a]=c(i[a],s):"DEFINE_MANY"===m&&(i[a]=l(i[a],s))}else i[a]=s}}}}function s(e,t){if(t)for(var i in t){var n=t[i];if(t.hasOwnProperty(i)){var r=i in E;r&&u("78",i);var a=i in e;a&&u("79",i),e[i]=n}}}function o(e,t){e&&t&&"object"==typeof e&&"object"==typeof t||u("80");for(var i in t)t.hasOwnProperty(i)&&(void 0!==e[i]&&u("81",i),e[i]=t[i]);return e}function c(e,t){return function(){var i=e.apply(this,arguments),n=t.apply(this,arguments);if(null==i)return n;if(null==n)return i;var r={};return o(r,i),o(r,n),r}}function l(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function d(e,t){return t.bind(e)}function h(e){for(var t=e.__reactAutoBindPairs,i=0;i<t.length;i+=2){var n=t[i],r=t[i+1];e[n]=d(e,r)}}var u=e(35),p=e(46),m=e(11),f=e(15),g=(e(20),e(19)),v=e(42),y=(e(43),e(45),"mixins"),b=[],S={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"},E={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var i=0;i<t.length;i++)a(e,t[i])},childContextTypes:function(e,t){e.childContextTypes=p({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=p({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=c(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,t){e.propTypes=p({},e.propTypes,t)},statics:function(e,t){s(e,t)},autobind:function(){}},C={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e),t&&this.updater.enqueueCallback(this,t,"replaceState")},isMounted:function(){return this.updater.isMounted(this)}},P=function(){};p(P.prototype,m.prototype,C);var T={createClass:function(e){var t=n(function(e,i,n){this.__reactAutoBindPairs.length&&h(this),this.props=e,this.context=i,this.refs=v,this.updater=n||g,this.state=null;var r=this.getInitialState?this.getInitialState():null;("object"!=typeof r||Array.isArray(r))&&u("82",t.displayName||"ReactCompositeComponent"),this.state=r});t.prototype=new P,t.prototype.constructor=t,t.prototype.__reactAutoBindPairs=[],b.forEach(a.bind(null,t)),a(t,e),t.getDefaultProps&&(t.defaultProps=t.getDefaultProps()),t.prototype.render||u("83");for(var i in S)t.prototype[i]||(t.prototype[i]=null);return t},injection:{injectMixin:function(e){b.push(e)}}};t.exports=T},{11:11,15:15,19:19,20:20,35:35,42:42,43:43,45:45,46:46}],11:[function(e,t,i){"use strict";function n(e,t,i){this.props=e,this.context=t,this.refs=s,this.updater=i||a}var r=e(35),a=e(19),s=(e(31),e(42));e(43),e(45),n.prototype.isReactComponent={},n.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&r("85"),this.updater.enqueueSetState(this,e),t&&this.updater.enqueueCallback(this,t,"setState")},n.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this),e&&this.updater.enqueueCallback(this,e,"forceUpdate")},t.exports=n},{19:19,31:31,35:35,42:42,43:43,45:45}],12:[function(e,t,i){"use strict";var n=e(36),r={shouldComponentUpdate:function(e,t){return n(this,e,t)}};t.exports=r},{36:36}],13:[function(e,t,i){"use strict";var n={current:null};t.exports=n},{}],14:[function(e,t,i){"use strict";var n=e(15),r=n.createFactory,a={a:r("a"),abbr:r("abbr"),address:r("address"),area:r("area"),article:r("article"),aside:r("aside"),audio:r("audio"),b:r("b"),base:r("base"),bdi:r("bdi"),bdo:r("bdo"),big:r("big"),blockquote:r("blockquote"),body:r("body"),br:r("br"),button:r("button"),canvas:r("canvas"),caption:r("caption"),cite:r("cite"),code:r("code"),col:r("col"),colgroup:r("colgroup"),data:r("data"),datalist:r("datalist"),dd:r("dd"),del:r("del"),details:r("details"),dfn:r("dfn"),dialog:r("dialog"),div:r("div"),dl:r("dl"),dt:r("dt"),em:r("em"),embed:r("embed"),fieldset:r("fieldset"),figcaption:r("figcaption"),figure:r("figure"),footer:r("footer"),form:r("form"),h1:r("h1"),h2:r("h2"),h3:r("h3"),h4:r("h4"),h5:r("h5"),h6:r("h6"),head:r("head"),header:r("header"),hgroup:r("hgroup"),hr:r("hr"),html:r("html"),i:r("i"),iframe:r("iframe"),img:r("img"),input:r("input"),ins:r("ins"),kbd:r("kbd"),keygen:r("keygen"),label:r("label"),legend:r("legend"),li:r("li"),link:r("link"),main:r("main"),map:r("map"),mark:r("mark"),menu:r("menu"),menuitem:r("menuitem"),meta:r("meta"),meter:r("meter"),nav:r("nav"),noscript:r("noscript"),object:r("object"),ol:r("ol"),optgroup:r("optgroup"),option:r("option"),output:r("output"),p:r("p"),param:r("param"),picture:r("picture"),pre:r("pre"),progress:r("progress"),q:r("q"),rp:r("rp"),rt:r("rt"),ruby:r("ruby"),s:r("s"),samp:r("samp"),script:r("script"),section:r("section"),select:r("select"),small:r("small"),source:r("source"),span:r("span"),strong:r("strong"),style:r("style"),sub:r("sub"),summary:r("summary"),sup:r("sup"),table:r("table"),tbody:r("tbody"),td:r("td"),textarea:r("textarea"),tfoot:r("tfoot"),th:r("th"),thead:r("thead"),time:r("time"),title:r("title"),tr:r("tr"),track:r("track"),u:r("u"),ul:r("ul"),var:r("var"),video:r("video"),wbr:r("wbr"),circle:r("circle"),clipPath:r("clipPath"),defs:r("defs"),ellipse:r("ellipse"),g:r("g"),image:r("image"),line:r("line"),linearGradient:r("linearGradient"),mask:r("mask"),path:r("path"),pattern:r("pattern"),polygon:r("polygon"),polyline:r("polyline"),radialGradient:r("radialGradient"),rect:r("rect"),stop:r("stop"),svg:r("svg"),text:r("text"),tspan:r("tspan")};t.exports=a},{15:15}],15:[function(e,t,i){"use strict";function n(e){return void 0!==e.ref}function r(e){return void 0!==e.key}var a=e(46),s=e(13),o=(e(45),e(31),Object.prototype.hasOwnProperty),c=e(16),l={key:!0,ref:!0,__self:!0,__source:!0},d=function(e,t,i,n,r,a,s){return{$$typeof:c,type:e,key:t,ref:i,props:s,_owner:a}};d.createElement=function(e,t,i){var a,c={},h=null,u=null;if(null!=t){n(t)&&(u=t.ref),r(t)&&(h=""+t.key),void 0===t.__self?null:t.__self,void 0===t.__source?null:t.__source;for(a in t)o.call(t,a)&&!l.hasOwnProperty(a)&&(c[a]=t[a])}var p=arguments.length-2;if(1===p)c.children=i;else if(p>1){for(var m=Array(p),f=0;f<p;f++)m[f]=arguments[f+2];c.children=m}if(e&&e.defaultProps){var g=e.defaultProps;for(a in g)void 0===c[a]&&(c[a]=g[a])}return d(e,h,u,0,0,s.current,c)},d.createFactory=function(e){var t=d.createElement.bind(null,e);return t.type=e,t},d.cloneAndReplaceKey=function(e,t){return d(e.type,t,e.ref,e._self,e._source,e._owner,e.props)},d.cloneElement=function(e,t,i){var c,h=a({},e.props),u=e.key,p=e.ref,m=(e._self,e._source,e._owner);if(null!=t){n(t)&&(p=t.ref,m=s.current),r(t)&&(u=""+t.key);var f;e.type&&e.type.defaultProps&&(f=e.type.defaultProps);for(c in t)o.call(t,c)&&!l.hasOwnProperty(c)&&(void 0===t[c]&&void 0!==f?h[c]=f[c]:h[c]=t[c])}var g=arguments.length-2;if(1===g)h.children=i;else if(g>1){for(var v=Array(g),y=0;y<g;y++)v[y]=arguments[y+2];h.children=v}return d(e.type,u,p,0,0,m,h)},d.isValidElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===c},t.exports=d},{13:13,16:16,31:31,45:45,46:46}],16:[function(e,t,i){"use strict";var n="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;t.exports=n},{}],17:[function(e,t,i){"use strict";var n=e(35),r=e(9),a=e(15),s=e(41),o=(e(43),e(45),{create:function(e){if("object"!=typeof e||!e||Array.isArray(e))return e;if(a.isValidElement(e))return e;1===e.nodeType&&n("0");var t=[];for(var i in e)r.mapIntoWithKeyPrefixInternal(e[i],t,i,s.thatReturnsArgument);return t}});t.exports=o},{15:15,35:35,41:41,43:43,45:45,9:9}],18:[function(e,t,i){"use strict";function n(e,t){this.value=e,this.requestChange=t}function r(e){var t={value:void 0===e?a.PropTypes.any.isRequired:e.isRequired,requestChange:a.PropTypes.func.isRequired};return a.PropTypes.shape(t)}var a=e(5);n.PropTypes={link:r},t.exports=n},{5:5}],19:[function(e,t,i){"use strict";var n=(e(45),{isMounted:function(e){return!1},enqueueCallback:function(e,t){},enqueueForceUpdate:function(e){},enqueueReplaceState:function(e,t){},enqueueSetState:function(e,t){}});t.exports=n},{45:45}],20:[function(e,t,i){"use strict";var n={};t.exports=n},{}],21:[function(e,t,i){"use strict";function n(e,t){return e===t?0!==e||1/e==1/t:e!==e&&t!==t}function r(e){this.message=e,this.stack=""}function a(e){function t(t,i,n,a,s,o,c){if(a=a||P,o=o||n,null==i[n]){var l=b[s];return t?new r(null===i[n]?"The "+l+" `"+o+"` is marked as required in `"+a+"`, but its value is `null`.":"The "+l+" `"+o+"` is marked as required in `"+a+"`, but its value is `undefined`."):null}return e(i,n,a,s,o)}var i=t.bind(null,!1);return i.isRequired=t.bind(null,!0),i}function s(e){function t(t,i,n,a,s,o){var c=t[i];if(f(c)!==e)return new r("Invalid "+b[a]+" `"+s+"` of type `"+g(c)+"` supplied to `"+n+"`, expected `"+e+"`.");return null}return a(t)}function o(e){function t(t,i,n,a,s){if("function"!=typeof e)return new r("Property `"+s+"` of component `"+n+"` has invalid PropType notation inside arrayOf.");var o=t[i];if(!Array.isArray(o)){return new r("Invalid "+b[a]+" `"+s+"` of type `"+f(o)+"` supplied to `"+n+"`, expected an array.")}for(var c=0;c<o.length;c++){var l=e(o,c,n,a,s+"["+c+"]",S);if(l instanceof Error)return l}return null}return a(t)}function c(e){function t(t,i,n,a,s){if(!(t[i]instanceof e)){var o=b[a],c=e.name||P;return new r("Invalid "+o+" `"+s+"` of type `"+v(t[i])+"` supplied to `"+n+"`, expected instance of `"+c+"`.")}return null}return a(t)}function l(e){function t(t,i,a,s,o){for(var c=t[i],l=0;l<e.length;l++)if(n(c,e[l]))return null;return new r("Invalid "+b[s]+" `"+o+"` of value `"+c+"` supplied to `"+a+"`, expected one of "+JSON.stringify(e)+".")}return Array.isArray(e)?a(t):E.thatReturnsNull}function d(e){function t(t,i,n,a,s){if("function"!=typeof e)return new r("Property `"+s+"` of component `"+n+"` has invalid PropType notation inside objectOf.");var o=t[i],c=f(o);if("object"!==c){return new r("Invalid "+b[a]+" `"+s+"` of type `"+c+"` supplied to `"+n+"`, expected an object.")}for(var l in o)if(o.hasOwnProperty(l)){var d=e(o,l,n,a,s+"."+l,S);if(d instanceof Error)return d}return null}return a(t)}function h(e){function t(t,i,n,a,s){for(var o=0;o<e.length;o++){if(null==(0,e[o])(t,i,n,a,s,S))return null}return new r("Invalid "+b[a]+" `"+s+"` supplied to `"+n+"`.")}return Array.isArray(e)?a(t):E.thatReturnsNull}function u(e){function t(t,i,n,a,s){var o=t[i],c=f(o);if("object"!==c){return new r("Invalid "+b[a]+" `"+s+"` of type `"+c+"` supplied to `"+n+"`, expected `object`.")}for(var l in e){var d=e[l];if(d){var h=d(o,l,n,a,s+"."+l,S);if(h)return h}}return null}return a(t)}function p(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(p);if(null===e||y.isValidElement(e))return!0;var t=C(e);if(!t)return!1;var i,n=t.call(e);if(t!==e.entries){for(;!(i=n.next()).done;)if(!p(i.value))return!1}else for(;!(i=n.next()).done;){var r=i.value;if(r&&!p(r[1]))return!1}return!0;default:return!1}}function m(e,t){return"symbol"===e||"Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol}function f(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":m(t,e)?"symbol":t}function g(e){var t=f(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function v(e){return e.constructor&&e.constructor.name?e.constructor.name:P}var y=e(15),b=e(20),S=e(22),E=e(41),C=e(33),P=(e(45),"<<anonymous>>"),T={array:s("array"),bool:s("boolean"),func:s("function"),number:s("number"),object:s("object"),string:s("string"),symbol:s("symbol"),any:function(){return a(E.thatReturns(null))}(),arrayOf:o,element:function(){function e(e,t,i,n,a){var s=e[t];if(!y.isValidElement(s)){return new r("Invalid "+b[n]+" `"+a+"` of type `"+f(s)+"` supplied to `"+i+"`, expected a single ReactElement.")}return null}return a(e)}(),instanceOf:c,node:function(){function e(e,t,i,n,a){if(!p(e[t])){return new r("Invalid "+b[n]+" `"+a+"` supplied to `"+i+"`, expected a ReactNode.")}return null}return a(e)}(),objectOf:d,oneOf:l,oneOfType:h,shape:u};r.prototype=Error.prototype,t.exports=T},{15:15,20:20,22:22,33:33,41:41,45:45}],22:[function(e,t,i){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],23:[function(e,t,i){"use strict";function n(e,t,i){this.props=e,this.context=t,this.refs=c,this.updater=i||o}function r(){}var a=e(46),s=e(11),o=e(19),c=e(42);r.prototype=s.prototype,n.prototype=new r,n.prototype.constructor=n,a(n.prototype,s.prototype),n.prototype.isPureReactComponent=!0,t.exports=n},{11:11,19:19,42:42,46:46}],24:[function(e,t,i){"use strict";function n(e,t){var i={};return function(n){i[t]=n,e.setState(i)}}var r={createStateSetter:function(e,t){return function(i,n,r,a,s,o){var c=t.call(e,i,n,r,a,s,o);c&&e.setState(c)}},createStateKeySetter:function(e,t){var i=e.__keySetters||(e.__keySetters={});return i[t]||(i[t]=n(e,t))}};r.Mixin={createStateSetter:function(e){return r.createStateSetter(this,e)},createStateKeySetter:function(e){return r.createStateKeySetter(this,e)}},t.exports=r},{}],25:[function(e,t,i){"use strict";var n=e(32),r={getChildMapping:function(e,t){return e?n(e):e},mergeChildMappings:function(e,t){function i(i){return t.hasOwnProperty(i)?t[i]:e[i]}e=e||{},t=t||{};var n={},r=[];for(var a in e)t.hasOwnProperty(a)?r.length&&(n[a]=r,r=[]):r.push(a);var s,o={};for(var c in t){if(n.hasOwnProperty(c))for(s=0;s<n[c].length;s++){var l=n[c][s];o[n[c][s]]=i(l)}o[c]=i(c)}for(s=0;s<r.length;s++)o[r[s]]=i(r[s]);return o}};t.exports=r},{32:32}],26:[function(e,t,i){"use strict";function n(e,t,i){e.addEventListener(t,i,!1)}function r(e,t,i){e.removeEventListener(t,i,!1)}var a=e(40),s=e(1),o=[];a.canUseDOM&&function(){var e=s("animationend"),t=s("transitionend");e&&o.push(e),t&&o.push(t)}();var c={addEndEventListener:function(e,t){return 0===o.length?void window.setTimeout(t,0):void o.forEach(function(i){n(e,i,t)})},removeEndEventListener:function(e,t){0!==o.length&&o.forEach(function(i){r(e,i,t)})}};t.exports=c},{1:1,40:40}],27:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){
if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=e(46),o=e(5),c=e(25),l=e(41),d=function(e){function t(){var i,a,o;n(this,t);for(var l=arguments.length,d=Array(l),h=0;h<l;h++)d[h]=arguments[h];return i=a=r(this,e.call.apply(e,[this].concat(d))),a.state={children:c.getChildMapping(a.props.children)},a.performAppear=function(e){a.currentlyTransitioningKeys[e]=!0;var t=a.refs[e];t.componentWillAppear?t.componentWillAppear(a._handleDoneAppearing.bind(a,e)):a._handleDoneAppearing(e)},a._handleDoneAppearing=function(e){var t=a.refs[e];t.componentDidAppear&&t.componentDidAppear(),delete a.currentlyTransitioningKeys[e];var i=c.getChildMapping(a.props.children);i&&i.hasOwnProperty(e)||a.performLeave(e)},a.performEnter=function(e){a.currentlyTransitioningKeys[e]=!0;var t=a.refs[e];t.componentWillEnter?t.componentWillEnter(a._handleDoneEntering.bind(a,e)):a._handleDoneEntering(e)},a._handleDoneEntering=function(e){var t=a.refs[e];t.componentDidEnter&&t.componentDidEnter(),delete a.currentlyTransitioningKeys[e];var i=c.getChildMapping(a.props.children);i&&i.hasOwnProperty(e)||a.performLeave(e)},a.performLeave=function(e){a.currentlyTransitioningKeys[e]=!0;var t=a.refs[e];t.componentWillLeave?t.componentWillLeave(a._handleDoneLeaving.bind(a,e)):a._handleDoneLeaving(e)},a._handleDoneLeaving=function(e){var t=a.refs[e];t.componentDidLeave&&t.componentDidLeave(),delete a.currentlyTransitioningKeys[e];var i=c.getChildMapping(a.props.children);i&&i.hasOwnProperty(e)?a.performEnter(e):a.setState(function(t){var i=s({},t.children);return delete i[e],{children:i}})},o=i,r(a,o)}return a(t,e),t.prototype.componentWillMount=function(){this.currentlyTransitioningKeys={},this.keysToEnter=[],this.keysToLeave=[]},t.prototype.componentDidMount=function(){var e=this.state.children;for(var t in e)e[t]&&this.performAppear(t)},t.prototype.componentWillReceiveProps=function(e){var t=c.getChildMapping(e.children),i=this.state.children;this.setState({children:c.mergeChildMappings(i,t)});var n;for(n in t){var r=i&&i.hasOwnProperty(n);!t[n]||r||this.currentlyTransitioningKeys[n]||this.keysToEnter.push(n)}for(n in i){var a=t&&t.hasOwnProperty(n);!i[n]||a||this.currentlyTransitioningKeys[n]||this.keysToLeave.push(n)}},t.prototype.componentDidUpdate=function(){var e=this.keysToEnter;this.keysToEnter=[],e.forEach(this.performEnter);var t=this.keysToLeave;this.keysToLeave=[],t.forEach(this.performLeave)},t.prototype.render=function(){var e=[];for(var t in this.state.children){var i=this.state.children[t];i&&e.push(o.cloneElement(this.props.childFactory(i),{ref:t,key:t}))}var n=s({},this.props);return delete n.transitionLeave,delete n.transitionName,delete n.transitionAppear,delete n.transitionEnter,delete n.childFactory,delete n.transitionLeaveTimeout,delete n.transitionEnterTimeout,delete n.transitionAppearTimeout,delete n.component,o.createElement(this.props.component,n,e)},t}(o.Component);d.displayName="ReactTransitionGroup",d.propTypes={component:o.PropTypes.any,childFactory:o.PropTypes.func},d.defaultProps={component:"span",childFactory:l.thatReturnsArgument},t.exports=d},{25:25,41:41,46:46,5:5}],28:[function(e,t,i){"use strict";t.exports="15.4.2"},{}],29:[function(e,t,i){"use strict";var n=e(3),r=e(5),a=(e(6),e(12)),s=e(7),o=e(17),c=e(27),l=e(36),d=e(38);r.addons={CSSTransitionGroup:s,LinkedStateMixin:n,PureRenderMixin:a,TransitionGroup:c,createFragment:o.create,shallowCompare:l,update:d},t.exports=r},{12:12,17:17,27:27,3:3,36:36,38:38,5:5,6:6,7:7}],30:[function(e,t,i){"use strict";var n=e(46),r=e(29),a=n({__SECRET_INJECTED_REACT_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:null,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:e(13)}},r);t.exports=a},{13:13,29:29,46:46}],31:[function(e,t,i){"use strict";t.exports=!1},{}],32:[function(e,t,i){(function(i){"use strict";function n(e,t,i,n){if(e&&"object"==typeof e){var r=e;void 0===r[i]&&null!=t&&(r[i]=t)}}function r(e,t){if(null==e)return e;var i={};return a(e,n,i),i}var a=(e(2),e(37));e(45),void 0!==i&&i.env,t.exports=r}).call(this,void 0)},{2:2,37:37,45:45}],33:[function(e,t,i){"use strict";function n(e){var t=e&&(r&&e[r]||e[a]);if("function"==typeof t)return t}var r="function"==typeof Symbol&&Symbol.iterator,a="@@iterator";t.exports=n},{}],34:[function(e,t,i){"use strict";function n(e){return a.isValidElement(e)||r("143"),e}var r=e(35),a=e(15);e(43),t.exports=n},{15:15,35:35,43:43}],35:[function(e,t,i){"use strict";function n(e){for(var t=arguments.length-1,i="Minified React error #"+e+"; visit http://facebook.github.io/react/docs/error-decoder.html?invariant="+e,n=0;n<t;n++)i+="&args[]="+encodeURIComponent(arguments[n+1]);i+=" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.";var r=new Error(i);throw r.name="Invariant Violation",r.framesToPop=1,r}t.exports=n},{}],36:[function(e,t,i){"use strict";function n(e,t,i){return!r(e.props,t)||!r(e.state,i)}var r=e(44);t.exports=n},{44:44}],37:[function(e,t,i){"use strict";function n(e,t){return e&&"object"==typeof e&&null!=e.key?l.escape(e.key):t.toString(36)}function r(e,t,i,a){var u=typeof e;if("undefined"!==u&&"boolean"!==u||(e=null),null===e||"string"===u||"number"===u||"object"===u&&e.$$typeof===o)return i(a,e,""===t?d+n(e,0):t),1;var p,m,f=0,g=""===t?d:t+h;if(Array.isArray(e))for(var v=0;v<e.length;v++)p=e[v],m=g+n(p,v),f+=r(p,m,i,a);else{var y=c(e);if(y){var b,S=y.call(e);if(y!==e.entries)for(var E=0;!(b=S.next()).done;)p=b.value,m=g+n(p,E++),f+=r(p,m,i,a);else for(;!(b=S.next()).done;){var C=b.value;C&&(p=C[1],m=g+l.escape(C[0])+h+n(p,0),f+=r(p,m,i,a))}}else if("object"===u){var P=String(e);s("31","[object Object]"===P?"object with keys {"+Object.keys(e).join(", ")+"}":P,"")}}return f}function a(e,t,i){return null==e?0:r(e,"",t,i)}var s=e(35),o=(e(13),e(16)),c=e(33),l=(e(43),e(2)),d=(e(45),"."),h=":";t.exports=a},{13:13,16:16,2:2,33:33,35:35,43:43,45:45}],38:[function(e,t,i){"use strict";function n(e){return Array.isArray(e)?e.concat():e&&"object"==typeof e?o(new e.constructor,e):e}function r(e,t,i){Array.isArray(e)||s("1",i,e);var n=t[i];Array.isArray(n)||s("2",i,n)}function a(e,t){if("object"!=typeof t&&s("3",f.join(", "),u),c.call(t,u))return 1!==Object.keys(t).length&&s("4",u),t[u];var i=n(e);if(c.call(t,p)){var v=t[p];v&&"object"==typeof v||s("5",p,v),i&&"object"==typeof i||s("6",p,i),o(i,t[p])}c.call(t,l)&&(r(e,t,l),t[l].forEach(function(e){i.push(e)})),c.call(t,d)&&(r(e,t,d),t[d].forEach(function(e){i.unshift(e)})),c.call(t,h)&&(Array.isArray(e)||s("7",h,e),Array.isArray(t[h])||s("8",h,t[h]),t[h].forEach(function(e){Array.isArray(e)||s("8",h,t[h]),i.splice.apply(i,e)})),c.call(t,m)&&("function"!=typeof t[m]&&s("9",m,t[m]),i=t[m](i));for(var y in t)g.hasOwnProperty(y)&&g[y]||(i[y]=a(e[y],t[y]));return i}var s=e(35),o=e(46),c=(e(43),{}.hasOwnProperty),l="$push",d="$unshift",h="$splice",u="$set",p="$merge",m="$apply",f=[l,d,h,u,p,m],g={};f.forEach(function(e){g[e]=!0}),t.exports=a},{35:35,43:43,46:46}],39:[function(e,t,i){"use strict";function n(e,t){for(var i=e;i.parentNode;)i=i.parentNode;var n=i.querySelectorAll(t);return-1!==Array.prototype.indexOf.call(n,e)}var r=e(43),a={addClass:function(e,t){return/\s/.test(t)&&r(!1),t&&(e.classList?e.classList.add(t):a.hasClass(e,t)||(e.className=e.className+" "+t)),e},removeClass:function(e,t){return/\s/.test(t)&&r(!1),t&&(e.classList?e.classList.remove(t):a.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,""))),e},conditionClass:function(e,t,i){return(i?a.addClass:a.removeClass)(e,t)},hasClass:function(e,t){return/\s/.test(t)&&r(!1),e.classList?!!t&&e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1},matchesSelector:function(e,t){return(e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||function(t){return n(e,t)}).call(e,t)}};t.exports=a},{43:43}],40:[function(e,t,i){"use strict";var n=!("undefined"==typeof window||!window.document||!window.document.createElement),r={canUseDOM:n,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:n&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:n&&!!window.screen,isInWorker:!n};t.exports=r},{}],41:[function(e,t,i){"use strict";function n(e){return function(){return e}}var r=function(){};r.thatReturns=n,r.thatReturnsFalse=n(!1),r.thatReturnsTrue=n(!0),r.thatReturnsNull=n(null),r.thatReturnsThis=function(){return this},r.thatReturnsArgument=function(e){return e},t.exports=r},{}],42:[function(e,t,i){"use strict";var n={};t.exports=n},{}],43:[function(e,t,i){"use strict";function n(e,t,i,n,a,s,o,c){if(r(t),!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[i,n,a,s,o,c],h=0;l=new Error(t.replace(/%s/g,function(){return d[h++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}}var r=function(e){};t.exports=n},{}],44:[function(e,t,i){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!==e&&t!==t}function r(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(var s=0;s<i.length;s++)if(!a.call(t,i[s])||!n(e[i[s]],t[i[s]]))return!1;return!0}var a=Object.prototype.hasOwnProperty;t.exports=r},{}],45:[function(e,t,i){"use strict";var n=e(41),r=n;t.exports=r},{41:41}],46:[function(e,t,i){"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,s,o=n(e),c=1;c<arguments.length;c++){i=Object(arguments[c]);for(var l in i)r.call(i,l)&&(o[l]=i[l]);if(Object.getOwnPropertySymbols){s=Object.getOwnPropertySymbols(i);for(var d=0;d<s.length;d++)a.call(i,s[d])&&(o[s[d]]=i[s[d]])}}return o}},{}]},{},[30])(30)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e(require("react"));else if("function"==typeof define&&define.amd)define("react-dom",["react"],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.ReactDOM=e(t.React)}}(function(e){return function(e){return function(){return function e(t,i,n){function r(s,o){if(!i[s]){if(!t[s]){var c="function"==typeof require&&require;if(!o&&c)return c(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[s]={exports:{}};t[s][0].call(d.exports,function(e){var i=t[s][1][e];return r(i||e)},d,d.exports,e,t,i,n)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){"use strict";var n={Properties:{"aria-current":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},DOMAttributeNames:{},DOMPropertyNames:{}};t.exports=n},{}],2:[function(e,t,i){"use strict";var n=e(33),r=e(131),a={focusDOMComponent:function(){r(n.getNodeFromInstance(this))}};t.exports=a},{131:131,33:33}],3:[function(e,t,i){"use strict";function n(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}function r(e){switch(e){case"topCompositionStart":return D.compositionStart;case"topCompositionEnd":return D.compositionEnd;case"topCompositionUpdate":return D.compositionUpdate}}function a(e,t){return"topKeyDown"===e&&t.keyCode===y}function s(e,t){switch(e){case"topKeyUp":return-1!==v.indexOf(t.keyCode);case"topKeyDown":return t.keyCode!==y;case"topKeyPress":case"topMouseDown":case"topBlur":return!0;default:return!1}}function o(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function c(e,t,i,n){var c,l;if(b?c=r(e):_?s(e,i)&&(c=D.compositionEnd):a(e,i)&&(c=D.compositionStart),!c)return null;C&&(_||c!==D.compositionStart?c===D.compositionEnd&&_&&(l=_.getData()):_=m.getPooled(n));var d=f.getPooled(c,t,i,n);if(l)d.data=l;else{var h=o(i);null!==h&&(d.data=h)}return u.accumulateTwoPhaseDispatches(d),d}function l(e,t){switch(e){case"topCompositionEnd":return o(t);case"topKeyPress":return t.which!==P?null:(M=!0,T);case"topTextInput":var i=t.data;return i===T&&M?null:i;default:return null}}function d(e,t){if(_){if("topCompositionEnd"===e||!b&&s(e,t)){var i=_.getData();return m.release(_),_=null,i}return null}switch(e){case"topPaste":return null;case"topKeyPress":return t.which&&!n(t)?String.fromCharCode(t.which):null;case"topCompositionEnd":return C?null:t.data;default:return null}}function h(e,t,i,n){var r;if(!(r=E?l(e,i):d(e,i)))return null;var a=g.getPooled(D.beforeInput,t,i,n);return a.data=r,u.accumulateTwoPhaseDispatches(a),a}var u=e(19),p=e(123),m=e(20),f=e(78),g=e(82),v=[9,13,27,32],y=229,b=p.canUseDOM&&"CompositionEvent"in window,S=null;p.canUseDOM&&"documentMode"in document&&(S=document.documentMode);var E=p.canUseDOM&&"TextEvent"in window&&!S&&!function(){var e=window.opera;return"object"==typeof e&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}(),C=p.canUseDOM&&(!b||S&&S>8&&S<=11),P=32,T=String.fromCharCode(P),D={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["topCompositionEnd","topKeyPress","topTextInput","topPaste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:["topBlur","topCompositionEnd","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:["topBlur","topCompositionStart","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:["topBlur","topCompositionUpdate","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]}},M=!1,_=null,I={eventTypes:D,extractEvents:function(e,t,i,n){return[c(e,t,i,n),h(e,t,i,n)]}};t.exports=I},{123:123,19:19,20:20,78:78,82:82}],4:[function(e,t,i){"use strict";function n(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var r={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},a=["Webkit","ms","Moz","O"];Object.keys(r).forEach(function(e){a.forEach(function(t){r[n(t,e)]=r[e]})});var s={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},o={isUnitlessNumber:r,shorthandPropertyExpansions:s};t.exports=o},{}],5:[function(e,t,i){"use strict";var n=e(4),r=e(123),a=(e(58),e(125),e(94)),s=e(136),o=e(140),c=(e(142),o(function(e){return s(e)})),l=!1,d="cssFloat";if(r.canUseDOM){var h=document.createElement("div").style;try{h.font=""}catch(e){l=!0}void 0===document.documentElement.style.cssFloat&&(d="styleFloat")}var u={createMarkupForStyles:function(e,t){var i="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];null!=r&&(i+=c(n)+":",i+=a(n,r,t)+";")}return i||null},setValueForStyles:function(e,t,i){var r=e.style;for(var s in t)if(t.hasOwnProperty(s)){var o=a(s,t[s],i);if("float"!==s&&"cssFloat"!==s||(s=d),o)r[s]=o;else{var c=l&&n.shorthandPropertyExpansions[s];if(c)for(var h in c)r[h]="";else r[s]=""}}}};t.exports=u},{123:123,125:125,136:136,140:140,142:142,4:4,58:58,94:94}],6:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=e(113),a=e(24),s=(e(137),function(){function e(t){n(this,e),this._callbacks=null,this._contexts=null,this._arg=t}return e.prototype.enqueue=function(e,t){this._callbacks=this._callbacks||[],this._callbacks.push(e),this._contexts=this._contexts||[],this._contexts.push(t)},e.prototype.notifyAll=function(){var e=this._callbacks,t=this._contexts,i=this._arg;if(e&&t){e.length!==t.length&&r("24"),this._callbacks=null,this._contexts=null;for(var n=0;n<e.length;n++)e[n].call(t[n],i);e.length=0,t.length=0}},e.prototype.checkpoint=function(){return this._callbacks?this._callbacks.length:0},e.prototype.rollback=function(e){this._callbacks&&this._contexts&&(this._callbacks.length=e,this._contexts.length=e)},e.prototype.reset=function(){this._callbacks=null,this._contexts=null},e.prototype.destructor=function(){this.reset()},e}());t.exports=a.addPoolingTo(s)},{113:113,137:137,24:24}],7:[function(e,t,i){"use strict";function n(e){var t=e.nodeName&&e.nodeName.toLowerCase();return"select"===t||"input"===t&&"file"===e.type}function r(e){var t=P.getPooled(_.change,A,e,T(e));b.accumulateTwoPhaseDispatches(t),C.batchedUpdates(a,t)}function a(e){y.enqueueEvents(e),y.processEventQueue(!1)}function s(e,t){I=e,A=t,I.attachEvent("onchange",r)}function o(){I&&(I.detachEvent("onchange",r),I=null,A=null)}function c(e,t){if("topChange"===e)return t}function l(e,t,i){"topFocus"===e?(o(),s(t,i)):"topBlur"===e&&o()}function d(e,t){I=e,A=t,w=e.value,k=Object.getOwnPropertyDescriptor(e.constructor.prototype,"value"),Object.defineProperty(I,"value",O),I.attachEvent?I.attachEvent("onpropertychange",u):I.addEventListener("propertychange",u,!1)}function h(){I&&(delete I.value,I.detachEvent?I.detachEvent("onpropertychange",u):I.removeEventListener("propertychange",u,!1),I=null,A=null,w=null,k=null)}function u(e){if("value"===e.propertyName){var t=e.srcElement.value;t!==w&&(w=t,r(e))}}function p(e,t){if("topInput"===e)return t}function m(e,t,i){"topFocus"===e?(h(),d(t,i)):"topBlur"===e&&h()}function f(e,t){if(("topSelectionChange"===e||"topKeyUp"===e||"topKeyDown"===e)&&I&&I.value!==w)return w=I.value,A}function g(e){return e.nodeName&&"input"===e.nodeName.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}function v(e,t){if("topClick"===e)return t}var y=e(16),b=e(19),S=e(123),E=e(33),C=e(71),P=e(80),T=e(102),D=e(110),M=e(111),_={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:["topBlur","topChange","topClick","topFocus","topInput","topKeyDown","topKeyUp","topSelectionChange"]}},I=null,A=null,w=null,k=null,x=!1;S.canUseDOM&&(x=D("change")&&(!document.documentMode||document.documentMode>8));var R=!1;S.canUseDOM&&(R=D("input")&&(!document.documentMode||document.documentMode>11));var O={get:function(){return k.get.call(this)},set:function(e){w=""+e,k.set.call(this,e)}},L={eventTypes:_,extractEvents:function(e,t,i,r){var a,s,o=t?E.getNodeFromInstance(t):window;if(n(o)?x?a=c:s=l:M(o)?R?a=p:(a=f,s=m):g(o)&&(a=v),a){var d=a(e,t);if(d){var h=P.getPooled(_.change,d,i,r);return h.type="change",b.accumulateTwoPhaseDispatches(h),h}}s&&s(e,o,t)}};t.exports=L},{102:102,110:110,111:111,123:123,16:16,19:19,33:33,71:71,80:80}],8:[function(e,t,i){"use strict";function n(e,t){return Array.isArray(t)&&(t=t[1]),t?t.nextSibling:e.firstChild}function r(e,t,i){d.insertTreeBefore(e,t,i)}function a(e,t,i){Array.isArray(t)?o(e,t[0],t[1],i):f(e,t,i)}function s(e,t){if(Array.isArray(t)){var i=t[1];t=t[0],c(e,t,i),e.removeChild(i)}e.removeChild(t)}function o(e,t,i,n){for(var r=t;;){var a=r.nextSibling;if(f(e,r,n),r===i)break;r=a}}function c(e,t,i){for(;;){var n=t.nextSibling;if(n===i)break;e.removeChild(n)}}function l(e,t,i){var n=e.parentNode,r=e.nextSibling;r===t?i&&f(n,document.createTextNode(i),r):i?(m(r,i),c(n,r,t)):c(n,e,t)}var d=e(9),h=e(13),u=(e(33),e(58),e(93)),p=e(115),m=e(116),f=u(function(e,t,i){e.insertBefore(t,i)}),g=h.dangerouslyReplaceNodeWithMarkup,v={dangerouslyReplaceNodeWithMarkup:g,replaceDelimitedText:l,processUpdates:function(e,t){for(var i=0;i<t.length;i++){var o=t[i];switch(o.type){case"INSERT_MARKUP":r(e,o.content,n(e,o.afterNode));break;case"MOVE_EXISTING":a(e,o.fromNode,n(e,o.afterNode));break;case"SET_MARKUP":p(e,o.content);break;case"TEXT_CONTENT":m(e,o.content);break;case"REMOVE_NODE":s(e,o.fromNode)}}}};t.exports=v},{115:115,116:116,13:13,33:33,58:58,9:9,93:93}],9:[function(e,t,i){"use strict";function n(e){if(m){var t=e.node,i=e.children;if(i.length)for(var n=0;n<i.length;n++)f(t,i[n],null);else null!=e.html?h(t,e.html):null!=e.text&&p(t,e.text)}}function r(e,t){e.parentNode.replaceChild(t.node,e),n(t)}function a(e,t){m?e.children.push(t):e.node.appendChild(t.node)}function s(e,t){m?e.html=t:h(e.node,t)}function o(e,t){m?e.text=t:p(e.node,t)}function c(){return this.node.nodeName}function l(e){return{node:e,children:[],html:null,text:null,toString:c}}var d=e(10),h=e(115),u=e(93),p=e(116),m="undefined"!=typeof document&&"number"==typeof document.documentMode||"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent&&/\bEdge\/\d/.test(navigator.userAgent),f=u(function(e,t,i){11===t.node.nodeType||1===t.node.nodeType&&"object"===t.node.nodeName.toLowerCase()&&(null==t.node.namespaceURI||t.node.namespaceURI===d.html)?(n(t),e.insertBefore(t.node,i)):(e.insertBefore(t.node,i),n(t))});l.insertTreeBefore=f,l.replaceChildWithTree=r,l.queueChild=a,l.queueHTML=s,l.queueText=o,t.exports=l},{10:10,115:115,116:116,93:93}],10:[function(e,t,i){"use strict";var n={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};t.exports=n},{}],11:[function(e,t,i){"use strict";function n(e,t){return(e&t)===t}var r=e(113),a=(e(137),{MUST_USE_PROPERTY:1,HAS_BOOLEAN_VALUE:4,HAS_NUMERIC_VALUE:8,HAS_POSITIVE_NUMERIC_VALUE:24,HAS_OVERLOADED_BOOLEAN_VALUE:32,injectDOMPropertyConfig:function(e){var t=a,i=e.Properties||{},s=e.DOMAttributeNamespaces||{},c=e.DOMAttributeNames||{},l=e.DOMPropertyNames||{},d=e.DOMMutationMethods||{};e.isCustomAttribute&&o._isCustomAttributeFunctions.push(e.isCustomAttribute);for(var h in i){o.properties.hasOwnProperty(h)&&r("48",h);var u=h.toLowerCase(),p=i[h],m={attributeName:u,attributeNamespace:null,propertyName:h,mutationMethod:null,mustUseProperty:n(p,t.MUST_USE_PROPERTY),hasBooleanValue:n(p,t.HAS_BOOLEAN_VALUE),hasNumericValue:n(p,t.HAS_NUMERIC_VALUE),hasPositiveNumericValue:n(p,t.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:n(p,t.HAS_OVERLOADED_BOOLEAN_VALUE)};if(m.hasBooleanValue+m.hasNumericValue+m.hasOverloadedBooleanValue<=1||r("50",h),c.hasOwnProperty(h)){var f=c[h];m.attributeName=f}s.hasOwnProperty(h)&&(m.attributeNamespace=s[h]),l.hasOwnProperty(h)&&(m.propertyName=l[h]),d.hasOwnProperty(h)&&(m.mutationMethod=d[h]),o.properties[h]=m}}}),s=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",o={ID_ATTRIBUTE_NAME:"data-reactid",ROOT_ATTRIBUTE_NAME:"data-reactroot",ATTRIBUTE_NAME_START_CHAR:s,ATTRIBUTE_NAME_CHAR:s+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",properties:{},getPossibleStandardName:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<o._isCustomAttributeFunctions.length;t++){if((0,o._isCustomAttributeFunctions[t])(e))return!0}return!1},injection:a};t.exports=o},{113:113,137:137}],12:[function(e,t,i){"use strict";function n(e){return!!l.hasOwnProperty(e)||!c.hasOwnProperty(e)&&(o.test(e)?(l[e]=!0,!0):(c[e]=!0,!1))}function r(e,t){return null==t||e.hasBooleanValue&&!t||e.hasNumericValue&&isNaN(t)||e.hasPositiveNumericValue&&t<1||e.hasOverloadedBooleanValue&&!1===t}var a=e(11),s=(e(33),e(58),e(112)),o=(e(142),new RegExp("^["+a.ATTRIBUTE_NAME_START_CHAR+"]["+a.ATTRIBUTE_NAME_CHAR+"]*$")),c={},l={},d={createMarkupForID:function(e){return a.ID_ATTRIBUTE_NAME+"="+s(e)},setAttributeForID:function(e,t){e.setAttribute(a.ID_ATTRIBUTE_NAME,t)},createMarkupForRoot:function(){return a.ROOT_ATTRIBUTE_NAME+'=""'},setAttributeForRoot:function(e){e.setAttribute(a.ROOT_ATTRIBUTE_NAME,"")},createMarkupForProperty:function(e,t){var i=a.properties.hasOwnProperty(e)?a.properties[e]:null;if(i){if(r(i,t))return"";var n=i.attributeName;return i.hasBooleanValue||i.hasOverloadedBooleanValue&&!0===t?n+'=""':n+"="+s(t)}return a.isCustomAttribute(e)?null==t?"":e+"="+s(t):null},createMarkupForCustomAttribute:function(e,t){return n(e)&&null!=t?e+"="+s(t):""},setValueForProperty:function(e,t,i){var n=a.properties.hasOwnProperty(t)?a.properties[t]:null;if(n){var s=n.mutationMethod;if(s)s(e,i);else{if(r(n,i))return void this.deleteValueForProperty(e,t);if(n.mustUseProperty)e[n.propertyName]=i;else{var o=n.attributeName,c=n.attributeNamespace;c?e.setAttributeNS(c,o,""+i):n.hasBooleanValue||n.hasOverloadedBooleanValue&&!0===i?e.setAttribute(o,""):e.setAttribute(o,""+i)}}}else if(a.isCustomAttribute(t))return void d.setValueForAttribute(e,t,i)},setValueForAttribute:function(e,t,i){n(t)&&(null==i?e.removeAttribute(t):e.setAttribute(t,""+i))},deleteValueForAttribute:function(e,t){e.removeAttribute(t)},deleteValueForProperty:function(e,t){var i=a.properties.hasOwnProperty(t)?a.properties[t]:null;if(i){var n=i.mutationMethod;if(n)n(e,void 0);else if(i.mustUseProperty){var r=i.propertyName;i.hasBooleanValue?e[r]=!1:e[r]=""}else e.removeAttribute(i.attributeName)}else a.isCustomAttribute(t)&&e.removeAttribute(t)}};t.exports=d},{11:11,112:112,142:142,33:33,58:58}],13:[function(e,t,i){"use strict";var n=e(113),r=e(9),a=e(123),s=e(128),o=e(129),c=(e(137),{dangerouslyReplaceNodeWithMarkup:function(e,t){if(a.canUseDOM||n("56"),t||n("57"),"HTML"===e.nodeName&&n("58"),"string"==typeof t){var i=s(t,o)[0];e.parentNode.replaceChild(i,e)}else r.replaceChildWithTree(e,t)}});t.exports=c},{113:113,123:123,128:128,129:129,137:137,9:9}],14:[function(e,t,i){"use strict";var n=["ResponderEventPlugin","SimpleEventPlugin","TapEventPlugin","EnterLeaveEventPlugin","ChangeEventPlugin","SelectEventPlugin","BeforeInputEventPlugin"];t.exports=n},{}],15:[function(e,t,i){"use strict";var n=e(19),r=e(33),a=e(84),s={mouseEnter:{registrationName:"onMouseEnter",dependencies:["topMouseOut","topMouseOver"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["topMouseOut","topMouseOver"]}},o={eventTypes:s,extractEvents:function(e,t,i,o){if("topMouseOver"===e&&(i.relatedTarget||i.fromElement))return null;if("topMouseOut"!==e&&"topMouseOver"!==e)return null;var c;if(o.window===o)c=o;else{var l=o.ownerDocument;c=l?l.defaultView||l.parentWindow:window}var d,h;if("topMouseOut"===e){d=t;var u=i.relatedTarget||i.toElement;h=u?r.getClosestInstanceFromNode(u):null}else d=null,h=t;if(d===h)return null;var p=null==d?c:r.getNodeFromInstance(d),m=null==h?c:r.getNodeFromInstance(h),f=a.getPooled(s.mouseLeave,d,i,o);f.type="mouseleave",f.target=p,f.relatedTarget=m;var g=a.getPooled(s.mouseEnter,h,i,o);return g.type="mouseenter",g.target=m,g.relatedTarget=p,n.accumulateEnterLeaveDispatches(f,g,d,h),[f,g]}};t.exports=o},{19:19,33:33,84:84}],16:[function(e,t,i){"use strict";function n(e){return"button"===e||"input"===e||"select"===e||"textarea"===e}function r(e,t,i){switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":return!(!i.disabled||!n(t));default:return!1}}var a=e(113),s=e(17),o=e(18),c=e(50),l=e(91),d=e(98),h=(e(137),{}),u=null,p=function(e,t){e&&(o.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e))},m=function(e){return p(e,!0)},f=function(e){return p(e,!1)},g=function(e){return"."+e._rootNodeID},v={injection:{injectEventPluginOrder:s.injectEventPluginOrder,injectEventPluginsByName:s.injectEventPluginsByName},putListener:function(e,t,i){"function"!=typeof i&&a("94",t,typeof i);var n=g(e);(h[t]||(h[t]={}))[n]=i;var r=s.registrationNameModules[t];r&&r.didPutListener&&r.didPutListener(e,t,i)},getListener:function(e,t){var i=h[t];if(r(t,e._currentElement.type,e._currentElement.props))return null;var n=g(e);return i&&i[n]},deleteListener:function(e,t){var i=s.registrationNameModules[t];i&&i.willDeleteListener&&i.willDeleteListener(e,t);var n=h[t];if(n){delete n[g(e)]}},deleteAllListeners:function(e){var t=g(e);for(var i in h)if(h.hasOwnProperty(i)&&h[i][t]){var n=s.registrationNameModules[i];n&&n.willDeleteListener&&n.willDeleteListener(e,i),delete h[i][t]}},extractEvents:function(e,t,i,n){for(var r,a=s.plugins,o=0;o<a.length;o++){var c=a[o];if(c){var d=c.extractEvents(e,t,i,n);d&&(r=l(r,d))}}return r},enqueueEvents:function(e){e&&(u=l(u,e))},processEventQueue:function(e){var t=u;u=null,e?d(t,m):d(t,f),u&&a("95"),c.rethrowCaughtError()},__purge:function(){h={}},__getListenerBank:function(){return h}};t.exports=v},{113:113,137:137,17:17,18:18,50:50,91:91,98:98}],17:[function(e,t,i){"use strict";function n(){if(o)for(var e in c){var t=c[e],i=o.indexOf(e);if(i>-1||s("96",e),!l.plugins[i]){t.extractEvents||s("97",e),l.plugins[i]=t;var n=t.eventTypes;for(var a in n)r(n[a],t,a)||s("98",a,e)}}}function r(e,t,i){l.eventNameDispatchConfigs.hasOwnProperty(i)&&s("99",i),l.eventNameDispatchConfigs[i]=e;var n=e.phasedRegistrationNames;if(n){for(var r in n)if(n.hasOwnProperty(r)){var o=n[r];a(o,t,i)}return!0}return!!e.registrationName&&(a(e.registrationName,t,i),!0)}function a(e,t,i){l.registrationNameModules[e]&&s("100",e),l.registrationNameModules[e]=t,l.registrationNameDependencies[e]=t.eventTypes[i].dependencies}var s=e(113),o=(e(137),null),c={},l={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},possibleRegistrationNames:null,injectEventPluginOrder:function(e){o&&s("101"),o=Array.prototype.slice.call(e),n()},injectEventPluginsByName:function(e){var t=!1;for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];c.hasOwnProperty(i)&&c[i]===r||(c[i]&&s("102",i),c[i]=r,t=!0)}t&&n()},getPluginModuleForEvent:function(e){var t=e.dispatchConfig
;if(t.registrationName)return l.registrationNameModules[t.registrationName]||null;if(void 0!==t.phasedRegistrationNames){var i=t.phasedRegistrationNames;for(var n in i)if(i.hasOwnProperty(n)){var r=l.registrationNameModules[i[n]];if(r)return r}}return null},_resetEventPlugins:function(){o=null;for(var e in c)c.hasOwnProperty(e)&&delete c[e];l.plugins.length=0;var t=l.eventNameDispatchConfigs;for(var i in t)t.hasOwnProperty(i)&&delete t[i];var n=l.registrationNameModules;for(var r in n)n.hasOwnProperty(r)&&delete n[r]}};t.exports=l},{113:113,137:137}],18:[function(e,t,i){"use strict";function n(e){return"topMouseUp"===e||"topTouchEnd"===e||"topTouchCancel"===e}function r(e){return"topMouseMove"===e||"topTouchMove"===e}function a(e){return"topMouseDown"===e||"topTouchStart"===e}function s(e,t,i,n){var r=e.type||"unknown-event";e.currentTarget=v.getNodeFromInstance(n),t?f.invokeGuardedCallbackWithCatch(r,i,e):f.invokeGuardedCallback(r,i,e),e.currentTarget=null}function o(e,t){var i=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(i))for(var r=0;r<i.length&&!e.isPropagationStopped();r++)s(e,t,i[r],n[r]);else i&&s(e,t,i,n);e._dispatchListeners=null,e._dispatchInstances=null}function c(e){var t=e._dispatchListeners,i=e._dispatchInstances;if(Array.isArray(t)){for(var n=0;n<t.length&&!e.isPropagationStopped();n++)if(t[n](e,i[n]))return i[n]}else if(t&&t(e,i))return i;return null}function l(e){var t=c(e);return e._dispatchInstances=null,e._dispatchListeners=null,t}function d(e){var t=e._dispatchListeners,i=e._dispatchInstances;Array.isArray(t)&&m("103"),e.currentTarget=t?v.getNodeFromInstance(i):null;var n=t?t(e):null;return e.currentTarget=null,e._dispatchListeners=null,e._dispatchInstances=null,n}function h(e){return!!e._dispatchListeners}var u,p,m=e(113),f=e(50),g=(e(137),e(142),{injectComponentTree:function(e){u=e},injectTreeTraversal:function(e){p=e}}),v={isEndish:n,isMoveish:r,isStartish:a,executeDirectDispatch:d,executeDispatchesInOrder:o,executeDispatchesInOrderStopAtTrue:l,hasDispatches:h,getInstanceFromNode:function(e){return u.getInstanceFromNode(e)},getNodeFromInstance:function(e){return u.getNodeFromInstance(e)},isAncestor:function(e,t){return p.isAncestor(e,t)},getLowestCommonAncestor:function(e,t){return p.getLowestCommonAncestor(e,t)},getParentInstance:function(e){return p.getParentInstance(e)},traverseTwoPhase:function(e,t,i){return p.traverseTwoPhase(e,t,i)},traverseEnterLeave:function(e,t,i,n,r){return p.traverseEnterLeave(e,t,i,n,r)},injection:g};t.exports=v},{113:113,137:137,142:142,50:50}],19:[function(e,t,i){"use strict";function n(e,t,i){var n=t.dispatchConfig.phasedRegistrationNames[i];return v(e,n)}function r(e,t,i){var r=n(e,i,t);r&&(i._dispatchListeners=f(i._dispatchListeners,r),i._dispatchInstances=f(i._dispatchInstances,e))}function a(e){e&&e.dispatchConfig.phasedRegistrationNames&&m.traverseTwoPhase(e._targetInst,r,e)}function s(e){if(e&&e.dispatchConfig.phasedRegistrationNames){var t=e._targetInst,i=t?m.getParentInstance(t):null;m.traverseTwoPhase(i,r,e)}}function o(e,t,i){if(i&&i.dispatchConfig.registrationName){var n=i.dispatchConfig.registrationName,r=v(e,n);r&&(i._dispatchListeners=f(i._dispatchListeners,r),i._dispatchInstances=f(i._dispatchInstances,e))}}function c(e){e&&e.dispatchConfig.registrationName&&o(e._targetInst,null,e)}function l(e){g(e,a)}function d(e){g(e,s)}function h(e,t,i,n){m.traverseEnterLeave(i,n,o,e,t)}function u(e){g(e,c)}var p=e(16),m=e(18),f=e(91),g=e(98),v=(e(142),p.getListener),y={accumulateTwoPhaseDispatches:l,accumulateTwoPhaseDispatchesSkipTarget:d,accumulateDirectDispatches:u,accumulateEnterLeaveDispatches:h};t.exports=y},{142:142,16:16,18:18,91:91,98:98}],20:[function(e,t,i){"use strict";function n(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var r=e(143),a=e(24),s=e(107);r(n.prototype,{destructor:function(){this._root=null,this._startText=null,this._fallbackText=null},getText:function(){return"value"in this._root?this._root.value:this._root[s()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,i=this._startText,n=i.length,r=this.getText(),a=r.length;for(e=0;e<n&&i[e]===r[e];e++);var s=n-e;for(t=1;t<=s&&i[n-t]===r[a-t];t++);var o=t>1?1-t:void 0;return this._fallbackText=r.slice(e,o),this._fallbackText}}),a.addPoolingTo(n),t.exports=n},{107:107,143:143,24:24}],21:[function(e,t,i){"use strict";var n=e(11),r=n.injection.MUST_USE_PROPERTY,a=n.injection.HAS_BOOLEAN_VALUE,s=n.injection.HAS_NUMERIC_VALUE,o=n.injection.HAS_POSITIVE_NUMERIC_VALUE,c=n.injection.HAS_OVERLOADED_BOOLEAN_VALUE,l={isCustomAttribute:RegExp.prototype.test.bind(new RegExp("^(data|aria)-["+n.ATTRIBUTE_NAME_CHAR+"]*$")),Properties:{accept:0,acceptCharset:0,accessKey:0,action:0,allowFullScreen:a,allowTransparency:0,alt:0,as:0,async:a,autoComplete:0,autoPlay:a,capture:a,cellPadding:0,cellSpacing:0,charSet:0,challenge:0,checked:r|a,cite:0,classID:0,className:0,cols:o,colSpan:0,content:0,contentEditable:0,contextMenu:0,controls:a,coords:0,crossOrigin:0,data:0,dateTime:0,default:a,defer:a,dir:0,disabled:a,download:c,draggable:0,encType:0,form:0,formAction:0,formEncType:0,formMethod:0,formNoValidate:a,formTarget:0,frameBorder:0,headers:0,height:0,hidden:a,high:0,href:0,hrefLang:0,htmlFor:0,httpEquiv:0,icon:0,id:0,inputMode:0,integrity:0,is:0,keyParams:0,keyType:0,kind:0,label:0,lang:0,list:0,loop:a,low:0,manifest:0,marginHeight:0,marginWidth:0,max:0,maxLength:0,media:0,mediaGroup:0,method:0,min:0,minLength:0,multiple:r|a,muted:r|a,name:0,nonce:0,noValidate:a,open:a,optimum:0,pattern:0,placeholder:0,playsInline:a,poster:0,preload:0,profile:0,radioGroup:0,readOnly:a,referrerPolicy:0,rel:0,required:a,reversed:a,role:0,rows:o,rowSpan:s,sandbox:0,scope:0,scoped:a,scrolling:0,seamless:a,selected:r|a,shape:0,size:o,sizes:0,span:o,spellCheck:0,src:0,srcDoc:0,srcLang:0,srcSet:0,start:s,step:0,style:0,summary:0,tabIndex:0,target:0,title:0,type:0,useMap:0,value:0,width:0,wmode:0,wrap:0,about:0,datatype:0,inlist:0,prefix:0,property:0,resource:0,typeof:0,vocab:0,autoCapitalize:0,autoCorrect:0,autoSave:0,color:0,itemProp:0,itemScope:a,itemType:0,itemID:0,itemRef:0,results:0,security:0,unselectable:0},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{}};t.exports=l},{11:11}],22:[function(e,t,i){"use strict";function n(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}function r(e){var t=/(=0|=2)/g,i={"=0":"=","=2":":"};return(""+("."===e[0]&&"$"===e[1]?e.substring(2):e.substring(1))).replace(t,function(e){return i[e]})}var a={escape:n,unescape:r};t.exports=a},{}],23:[function(e,t,i){"use strict";function n(e){null!=e.checkedLink&&null!=e.valueLink&&o("87")}function r(e){n(e),(null!=e.value||null!=e.onChange)&&o("88")}function a(e){n(e),(null!=e.checked||null!=e.onChange)&&o("89")}function s(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var o=e(113),c=e(121),l=e(64),d=(e(137),e(142),{button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0}),h={value:function(e,t,i){return!e[t]||d[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,i){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:c.PropTypes.func},u={},p={checkPropTypes:function(e,t,i){for(var n in h){if(h.hasOwnProperty(n))var r=h[n](t,n,e,"prop",null,l);r instanceof Error&&!(r.message in u)&&(u[r.message]=!0,s(i))}},getValue:function(e){return e.valueLink?(r(e),e.valueLink.value):e.value},getChecked:function(e){return e.checkedLink?(a(e),e.checkedLink.value):e.checked},executeOnChange:function(e,t){return e.valueLink?(r(e),e.valueLink.requestChange(t.target.value)):e.checkedLink?(a(e),e.checkedLink.requestChange(t.target.checked)):e.onChange?e.onChange.call(void 0,t):void 0}};t.exports=p},{113:113,121:121,137:137,142:142,64:64}],24:[function(e,t,i){"use strict";var n=e(113),r=(e(137),function(e){var t=this;if(t.instancePool.length){var i=t.instancePool.pop();return t.call(i,e),i}return new t(e)}),a=function(e,t){var i=this;if(i.instancePool.length){var n=i.instancePool.pop();return i.call(n,e,t),n}return new i(e,t)},s=function(e,t,i){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,e,t,i),r}return new n(e,t,i)},o=function(e,t,i,n){var r=this;if(r.instancePool.length){var a=r.instancePool.pop();return r.call(a,e,t,i,n),a}return new r(e,t,i,n)},c=function(e){var t=this;e instanceof t||n("25"),e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},l=r,d=function(e,t){var i=e;return i.instancePool=[],i.getPooled=t||l,i.poolSize||(i.poolSize=10),i.release=c,i},h={addPoolingTo:d,oneArgumentPooler:r,twoArgumentPooler:a,threeArgumentPooler:s,fourArgumentPooler:o};t.exports=h},{113:113,137:137}],25:[function(e,t,i){"use strict";function n(e){return Object.prototype.hasOwnProperty.call(e,f)||(e[f]=p++,h[e[f]]={}),h[e[f]]}var r,a=e(143),s=e(17),o=e(51),c=e(90),l=e(108),d=e(110),h={},u=!1,p=0,m={topAbort:"abort",topAnimationEnd:l("animationend")||"animationend",topAnimationIteration:l("animationiteration")||"animationiteration",topAnimationStart:l("animationstart")||"animationstart",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topTransitionEnd:l("transitionend")||"transitionend",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"},f="_reactListenersID"+String(Math.random()).slice(2),g=a({},o,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(g.handleTopLevel),g.ReactEventListener=e}},setEnabled:function(e){g.ReactEventListener&&g.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!g.ReactEventListener||!g.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var i=t,r=n(i),a=s.registrationNameDependencies[e],o=0;o<a.length;o++){var c=a[o];r.hasOwnProperty(c)&&r[c]||("topWheel"===c?d("wheel")?g.ReactEventListener.trapBubbledEvent("topWheel","wheel",i):d("mousewheel")?g.ReactEventListener.trapBubbledEvent("topWheel","mousewheel",i):g.ReactEventListener.trapBubbledEvent("topWheel","DOMMouseScroll",i):"topScroll"===c?d("scroll",!0)?g.ReactEventListener.trapCapturedEvent("topScroll","scroll",i):g.ReactEventListener.trapBubbledEvent("topScroll","scroll",g.ReactEventListener.WINDOW_HANDLE):"topFocus"===c||"topBlur"===c?(d("focus",!0)?(g.ReactEventListener.trapCapturedEvent("topFocus","focus",i),g.ReactEventListener.trapCapturedEvent("topBlur","blur",i)):d("focusin")&&(g.ReactEventListener.trapBubbledEvent("topFocus","focusin",i),g.ReactEventListener.trapBubbledEvent("topBlur","focusout",i)),r.topBlur=!0,r.topFocus=!0):m.hasOwnProperty(c)&&g.ReactEventListener.trapBubbledEvent(c,m[c],i),r[c]=!0)}},trapBubbledEvent:function(e,t,i){return g.ReactEventListener.trapBubbledEvent(e,t,i)},trapCapturedEvent:function(e,t,i){return g.ReactEventListener.trapCapturedEvent(e,t,i)},supportsEventPageXY:function(){if(!document.createEvent)return!1;var e=document.createEvent("MouseEvent");return null!=e&&"pageX"in e},ensureScrollValueMonitoring:function(){if(void 0===r&&(r=g.supportsEventPageXY()),!r&&!u){var e=c.refreshScrollValues;g.ReactEventListener.monitorScrollValue(e),u=!0}}});t.exports=g},{108:108,110:110,143:143,17:17,51:51,90:90}],26:[function(e,t,i){(function(i){"use strict";function n(e,t,i,n){var r=void 0===e[i];null!=t&&r&&(e[i]=a(t,!0))}var r=e(66),a=e(109),s=(e(22),e(117)),o=e(118);e(142),void 0!==i&&i.env;var c={instantiateChildren:function(e,t,i,r){if(null==e)return null;var a={};return o(e,n,a),a},updateChildren:function(e,t,i,n,o,c,l,d,h){if(t||e){var u,p;for(u in t)if(t.hasOwnProperty(u)){p=e&&e[u];var m=p&&p._currentElement,f=t[u];if(null!=p&&s(m,f))r.receiveComponent(p,f,o,d),t[u]=p;else{p&&(n[u]=r.getHostNode(p),r.unmountComponent(p,!1));var g=a(f,!0);t[u]=g;var v=r.mountComponent(g,o,c,l,d,h);i.push(v)}}for(u in e)!e.hasOwnProperty(u)||t&&t.hasOwnProperty(u)||(p=e[u],n[u]=r.getHostNode(p),r.unmountComponent(p,!1))}},unmountChildren:function(e,t){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];r.unmountComponent(n,t)}}};t.exports=c}).call(this,void 0)},{109:109,117:117,118:118,142:142,22:22,66:66}],27:[function(e,t,i){"use strict";var n=e(8),r=e(37),a={processChildrenUpdates:r.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkup:n.dangerouslyReplaceNodeWithMarkup};t.exports=a},{37:37,8:8}],28:[function(e,t,i){"use strict";var n=e(113),r=(e(137),!1),a={replaceNodeWithMarkup:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){r&&n("104"),a.replaceNodeWithMarkup=e.replaceNodeWithMarkup,a.processChildrenUpdates=e.processChildrenUpdates,r=!0}}};t.exports=a},{113:113,137:137}],29:[function(e,t,i){"use strict";function n(e){}function r(e){return!(!e.prototype||!e.prototype.isReactComponent)}function a(e){return!(!e.prototype||!e.prototype.isPureReactComponent)}var s=e(113),o=e(143),c=e(121),l=e(28),d=e(120),h=e(50),u=e(57),p=(e(58),e(62)),m=e(66),f=e(130),g=(e(137),e(141)),v=e(117),y=(e(142),{ImpureClass:0,PureClass:1,StatelessFunctional:2});n.prototype.render=function(){var e=u.get(this)._currentElement.type,t=e(this.props,this.context,this.updater);return t};var b=1,S={construct:function(e){this._currentElement=e,this._rootNodeID=0,this._compositeType=null,this._instance=null,this._hostParent=null,this._hostContainerInfo=null,this._updateBatchNumber=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedNodeType=null,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._topLevelWrapper=null,this._pendingCallbacks=null,this._calledComponentWillUnmount=!1},mountComponent:function(e,t,i,o){this._context=o,this._mountOrder=b++,this._hostParent=t,this._hostContainerInfo=i;var l,d=this._currentElement.props,h=this._processContext(o),p=this._currentElement.type,m=e.getUpdateQueue(),g=r(p),v=this._constructComponent(g,d,h,m);g||null!=v&&null!=v.render?a(p)?this._compositeType=y.PureClass:this._compositeType=y.ImpureClass:(l=v,null===v||!1===v||c.isValidElement(v)||s("105",p.displayName||p.name||"Component"),v=new n(p),this._compositeType=y.StatelessFunctional),v.props=d,v.context=h,v.refs=f,v.updater=m,this._instance=v,u.set(v,this);var S=v.state;void 0===S&&(v.state=S=null),("object"!=typeof S||Array.isArray(S))&&s("106",this.getName()||"ReactCompositeComponent"),this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1;var E;return E=v.unstable_handleError?this.performInitialMountWithErrorHandling(l,t,i,e,o):this.performInitialMount(l,t,i,e,o),v.componentDidMount&&e.getReactMountReady().enqueue(v.componentDidMount,v),E},_constructComponent:function(e,t,i,n){return this._constructComponentWithoutOwner(e,t,i,n)},_constructComponentWithoutOwner:function(e,t,i,n){var r=this._currentElement.type;return e?new r(t,i,n):r(t,i,n)},performInitialMountWithErrorHandling:function(e,t,i,n,r){var a,s=n.checkpoint();try{a=this.performInitialMount(e,t,i,n,r)}catch(o){n.rollback(s),this._instance.unstable_handleError(o),this._pendingStateQueue&&(this._instance.state=this._processPendingState(this._instance.props,this._instance.context)),s=n.checkpoint(),this._renderedComponent.unmountComponent(!0),n.rollback(s),a=this.performInitialMount(e,t,i,n,r)}return a},performInitialMount:function(e,t,i,n,r){var a=this._instance;a.componentWillMount&&(a.componentWillMount(),this._pendingStateQueue&&(a.state=this._processPendingState(a.props,a.context))),void 0===e&&(e=this._renderValidatedComponent());var s=p.getType(e);this._renderedNodeType=s;var o=this._instantiateReactComponent(e,s!==p.EMPTY);return this._renderedComponent=o,m.mountComponent(o,n,t,i,this._processChildContext(r),0)},getHostNode:function(){return m.getHostNode(this._renderedComponent)},unmountComponent:function(e){if(this._renderedComponent){var t=this._instance;if(t.componentWillUnmount&&!t._calledComponentWillUnmount)if(t._calledComponentWillUnmount=!0,e){var i=this.getName()+".componentWillUnmount()";h.invokeGuardedCallback(i,t.componentWillUnmount.bind(t))}else t.componentWillUnmount();this._renderedComponent&&(m.unmountComponent(this._renderedComponent,e),this._renderedNodeType=null,this._renderedComponent=null,this._instance=null),this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=0,this._topLevelWrapper=null,u.remove(t)}},_maskContext:function(e){var t=this._currentElement.type,i=t.contextTypes;if(!i)return f;var n={};for(var r in i)n[r]=e[r];return n},_processContext:function(e){return this._maskContext(e)},_processChildContext:function(e){var t,i=this._currentElement.type,n=this._instance;if(n.getChildContext&&(t=n.getChildContext()),t){"object"!=typeof i.childContextTypes&&s("107",this.getName()||"ReactCompositeComponent");for(var r in t)r in i.childContextTypes||s("108",this.getName()||"ReactCompositeComponent",r);return o({},e,t)}return e},_checkContextTypes:function(e,t,i){},receiveComponent:function(e,t,i){var n=this._currentElement,r=this._context;this._pendingElement=null,this.updateComponent(t,n,e,r,i)},performUpdateIfNecessary:function(e){null!=this._pendingElement?m.receiveComponent(this,this._pendingElement,e,this._context):null!==this._pendingStateQueue||this._pendingForceUpdate?this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context):this._updateBatchNumber=null},updateComponent:function(e,t,i,n,r){var a=this._instance;null==a&&s("136",this.getName()||"ReactCompositeComponent");var o,c=!1;this._context===r?o=a.context:(o=this._processContext(r),c=!0);var l=t.props,d=i.props;t!==i&&(c=!0),c&&a.componentWillReceiveProps&&a.componentWillReceiveProps(d,o);var h=this._processPendingState(d,o),u=!0;this._pendingForceUpdate||(a.shouldComponentUpdate?u=a.shouldComponentUpdate(d,h,o):this._compositeType===y.PureClass&&(u=!g(l,d)||!g(a.state,h))),this._updateBatchNumber=null,u?(this._pendingForceUpdate=!1,this._performComponentUpdate(i,d,h,o,e,r)):(this._currentElement=i,this._context=r,a.props=d,a.state=h,a.context=o)},_processPendingState:function(e,t){var i=this._instance,n=this._pendingStateQueue,r=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!n)return i.state;if(r&&1===n.length)return n[0];for(var a=o({},r?n[0]:i.state),s=r?1:0;s<n.length;s++){var c=n[s];o(a,"function"==typeof c?c.call(i,a,e,t):c)}return a},_performComponentUpdate:function(e,t,i,n,r,a){var s,o,c,l=this._instance,d=Boolean(l.componentDidUpdate);d&&(s=l.props,o=l.state,c=l.context),l.componentWillUpdate&&l.componentWillUpdate(t,i,n),this._currentElement=e,this._context=a,l.props=t,l.state=i,l.context=n,this._updateRenderedComponent(r,a),d&&r.getReactMountReady().enqueue(l.componentDidUpdate.bind(l,s,o,c),l)},_updateRenderedComponent:function(e,t){var i=this._renderedComponent,n=i._currentElement,r=this._renderValidatedComponent();if(v(n,r))m.receiveComponent(i,r,e,this._processChildContext(t));else{var a=m.getHostNode(i);m.unmountComponent(i,!1);var s=p.getType(r);this._renderedNodeType=s;var o=this._instantiateReactComponent(r,s!==p.EMPTY);this._renderedComponent=o;var c=m.mountComponent(o,e,this._hostParent,this._hostContainerInfo,this._processChildContext(t),0);this._replaceNodeWithMarkup(a,c,i)}},_replaceNodeWithMarkup:function(e,t,i){l.replaceNodeWithMarkup(e,t,i)},_renderValidatedComponentWithoutOwnerOrContext:function(){return this._instance.render()},_renderValidatedComponent:function(){var e;if(this._compositeType!==y.StatelessFunctional){d.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{d.current=null}}else e=this._renderValidatedComponentWithoutOwnerOrContext();return null===e||!1===e||c.isValidElement(e)||s("109",this.getName()||"ReactCompositeComponent"),e},attachRef:function(e,t){var i=this.getPublicInstance();null==i&&s("110");var n=t.getPublicInstance();(i.refs===f?i.refs={}:i.refs)[e]=n},detachRef:function(e){delete this.getPublicInstance().refs[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return this._compositeType===y.StatelessFunctional?null:e},_instantiateReactComponent:null};t.exports=S},{113:113,117:117,120:120,121:121,130:130,137:137,141:141,142:142,143:143,28:28,50:50,57:57,58:58,62:62,66:66}],30:[function(e,t,i){"use strict";var n=e(33),r=e(47),a=e(60),s=e(66),o=e(71),c=e(72),l=e(96),d=e(103),h=e(114);e(142),r.inject();var u={findDOMNode:l,render:a.render,unmountComponentAtNode:a.unmountComponentAtNode,version:c,unstable_batchedUpdates:o.batchedUpdates,unstable_renderSubtreeIntoContainer:h};"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({ComponentTree:{getClosestInstanceFromNode:n.getClosestInstanceFromNode,getNodeFromInstance:function(e){return e._renderedComponent&&(e=d(e)),e?n.getNodeFromInstance(e):null}},Mount:a,Reconciler:s}),t.exports=u},{103:103,114:114,142:142,33:33,47:47,60:60,66:66,71:71,72:72,96:96}],31:[function(e,t,i){"use strict";function n(e){if(e){var t=e._currentElement._owner||null;if(t){var i=t.getName();if(i)return" This DOM node was rendered by `"+i+"`."}}return""}function r(e,t){t&&(Y[e._tag]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&f("137",e._tag,e._currentElement._owner?" Check the render method of "+e._currentElement._owner.getName()+".":""),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&f("60"),"object"==typeof t.dangerouslySetInnerHTML&&q in t.dangerouslySetInnerHTML||f("61")),null!=t.style&&"object"!=typeof t.style&&f("62",n(e)))}function a(e,t,i,n){if(!(n instanceof R)){var r=e._hostContainerInfo,a=r._node&&r._node.nodeType===z,o=a?r._node:r._ownerDocument;B(t,o),n.getReactMountReady().enqueue(s,{inst:e,registrationName:t,listener:i})}}function s(){var e=this;P.putListener(e.inst,e.registrationName,e.listener)}function o(){var e=this;I.postMountWrapper(e)}function c(){var e=this;k.postMountWrapper(e)}function l(){var e=this;A.postMountWrapper(e)}function d(){var e=this;e._rootNodeID||f("63");var t=F(e);switch(t||f("64"),e._tag){case"iframe":case"object":e._wrapperState.listeners=[D.trapBubbledEvent("topLoad","load",t)];break;case"video":case"audio":e._wrapperState.listeners=[];for(var i in G)G.hasOwnProperty(i)&&e._wrapperState.listeners.push(D.trapBubbledEvent(i,G[i],t));break;case"source":e._wrapperState.listeners=[D.trapBubbledEvent("topError","error",t)];break;case"img":e._wrapperState.listeners=[D.trapBubbledEvent("topError","error",t),D.trapBubbledEvent("topLoad","load",t)];break;case"form":e._wrapperState.listeners=[D.trapBubbledEvent("topReset","reset",t),D.trapBubbledEvent("topSubmit","submit",t)];break;case"input":case"select":case"textarea":e._wrapperState.listeners=[D.trapBubbledEvent("topInvalid","invalid",t)]}}function h(){w.postUpdateWrapper(this)}function u(e){J.call(Q,e)||(X.test(e)||f("65",e),Q[e]=!0)}function p(e,t){return e.indexOf("-")>=0||null!=t.is}function m(e){var t=e.type;u(t),this._currentElement=e,this._tag=t.toLowerCase(),this._namespaceURI=null,this._renderedChildren=null,this._previousStyle=null,this._previousStyleCopy=null,this._hostNode=null,this._hostParent=null,this._rootNodeID=0,this._domID=0,this._hostContainerInfo=null,this._wrapperState=null,this._topLevelWrapper=null,this._flags=0}var f=e(113),g=e(143),v=e(2),y=e(5),b=e(9),S=e(10),E=e(11),C=e(12),P=e(16),T=e(17),D=e(25),M=e(32),_=e(33),I=e(38),A=e(39),w=e(40),k=e(43),x=(e(58),e(61)),R=e(68),O=(e(129),e(95)),L=(e(137),e(110),e(141),e(119),e(142),M),N=P.deleteListener,F=_.getNodeFromInstance,B=D.listenTo,U=T.registrationNameModules,H={string:!0,number:!0},V="style",q="__html",W={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null},z=11,G={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"},j={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},K={listing:!0,pre:!0,textarea:!0},Y=g({menuitem:!0},j),X=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,Q={},J={}.hasOwnProperty,$=1;m.displayName="ReactDOMComponent",m.Mixin={mountComponent:function(e,t,i,n){this._rootNodeID=$++,this._domID=i._idCounter++,this._hostParent=t,this._hostContainerInfo=i;var a=this._currentElement.props;switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":this._wrapperState={listeners:null},e.getReactMountReady().enqueue(d,this);break;case"input":I.mountWrapper(this,a,t),a=I.getHostProps(this,a),e.getReactMountReady().enqueue(d,this);break;case"option":A.mountWrapper(this,a,t),a=A.getHostProps(this,a);break;case"select":w.mountWrapper(this,a,t),a=w.getHostProps(this,a),e.getReactMountReady().enqueue(d,this);break;case"textarea":k.mountWrapper(this,a,t),a=k.getHostProps(this,a),e.getReactMountReady().enqueue(d,this)}r(this,a);var s,h;null!=t?(s=t._namespaceURI,h=t._tag):i._tag&&(s=i._namespaceURI,h=i._tag),(null==s||s===S.svg&&"foreignobject"===h)&&(s=S.html),s===S.html&&("svg"===this._tag?s=S.svg:"math"===this._tag&&(s=S.mathml)),this._namespaceURI=s;var u;if(e.useCreateElement){var p,m=i._ownerDocument;if(s===S.html)if("script"===this._tag){var f=m.createElement("div"),g=this._currentElement.type;f.innerHTML="<"+g+"></"+g+">",p=f.removeChild(f.firstChild)}else p=a.is?m.createElement(this._currentElement.type,a.is):m.createElement(this._currentElement.type);else p=m.createElementNS(s,this._currentElement.type);_.precacheNode(this,p),this._flags|=L.hasCachedChildNodes,this._hostParent||C.setAttributeForRoot(p),this._updateDOMProperties(null,a,e);var y=b(p);this._createInitialChildren(e,a,n,y),u=y}else{var E=this._createOpenTagMarkupAndPutListeners(e,a),P=this._createContentMarkup(e,a,n);u=!P&&j[this._tag]?E+"/>":E+">"+P+"</"+this._currentElement.type+">"}switch(this._tag){case"input":e.getReactMountReady().enqueue(o,this),a.autoFocus&&e.getReactMountReady().enqueue(v.focusDOMComponent,this);break;case"textarea":e.getReactMountReady().enqueue(c,this),a.autoFocus&&e.getReactMountReady().enqueue(v.focusDOMComponent,this);break;case"select":case"button":a.autoFocus&&e.getReactMountReady().enqueue(v.focusDOMComponent,this);break;case"option":e.getReactMountReady().enqueue(l,this)}return u},_createOpenTagMarkupAndPutListeners:function(e,t){var i="<"+this._currentElement.type;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(null!=r)if(U.hasOwnProperty(n))r&&a(this,n,r,e);else{n===V&&(r&&(r=this._previousStyleCopy=g({},t.style)),r=y.createMarkupForStyles(r,this));var s=null;null!=this._tag&&p(this._tag,t)?W.hasOwnProperty(n)||(s=C.createMarkupForCustomAttribute(n,r)):s=C.createMarkupForProperty(n,r),s&&(i+=" "+s)}}return e.renderToStaticMarkup?i:(this._hostParent||(i+=" "+C.createMarkupForRoot()),i+=" "+C.createMarkupForID(this._domID))},_createContentMarkup:function(e,t,i){var n="",r=t.dangerouslySetInnerHTML;if(null!=r)null!=r.__html&&(n=r.__html);else{var a=H[typeof t.children]?t.children:null,s=null!=a?null:t.children;if(null!=a)n=O(a);else if(null!=s){var o=this.mountChildren(s,e,i);n=o.join("")}}return K[this._tag]&&"\n"===n.charAt(0)?"\n"+n:n},_createInitialChildren:function(e,t,i,n){var r=t.dangerouslySetInnerHTML;if(null!=r)null!=r.__html&&b.queueHTML(n,r.__html);else{var a=H[typeof t.children]?t.children:null,s=null!=a?null:t.children;if(null!=a)""!==a&&b.queueText(n,a);else if(null!=s)for(var o=this.mountChildren(s,e,i),c=0;c<o.length;c++)b.queueChild(n,o[c])}},receiveComponent:function(e,t,i){var n=this._currentElement;this._currentElement=e,this.updateComponent(t,n,e,i)},updateComponent:function(e,t,i,n){var a=t.props,s=this._currentElement.props;switch(this._tag){case"input":a=I.getHostProps(this,a),s=I.getHostProps(this,s);break;case"option":a=A.getHostProps(this,a),s=A.getHostProps(this,s);break;case"select":a=w.getHostProps(this,a),s=w.getHostProps(this,s);break;case"textarea":a=k.getHostProps(this,a),s=k.getHostProps(this,s)}switch(r(this,s),this._updateDOMProperties(a,s,e),this._updateDOMChildren(a,s,e,n),this._tag){case"input":I.updateWrapper(this);break;case"textarea":k.updateWrapper(this);break;case"select":e.getReactMountReady().enqueue(h,this)}},_updateDOMProperties:function(e,t,i){var n,r,s;for(n in e)if(!t.hasOwnProperty(n)&&e.hasOwnProperty(n)&&null!=e[n])if(n===V){var o=this._previousStyleCopy;for(r in o)o.hasOwnProperty(r)&&(s=s||{},s[r]="");this._previousStyleCopy=null}else U.hasOwnProperty(n)?e[n]&&N(this,n):p(this._tag,e)?W.hasOwnProperty(n)||C.deleteValueForAttribute(F(this),n):(E.properties[n]||E.isCustomAttribute(n))&&C.deleteValueForProperty(F(this),n);for(n in t){var c=t[n],l=n===V?this._previousStyleCopy:null!=e?e[n]:void 0;if(t.hasOwnProperty(n)&&c!==l&&(null!=c||null!=l))if(n===V)if(c?c=this._previousStyleCopy=g({},c):this._previousStyleCopy=null,l){for(r in l)!l.hasOwnProperty(r)||c&&c.hasOwnProperty(r)||(s=s||{},s[r]="");for(r in c)c.hasOwnProperty(r)&&l[r]!==c[r]&&(s=s||{},s[r]=c[r])}else s=c;else if(U.hasOwnProperty(n))c?a(this,n,c,i):l&&N(this,n);else if(p(this._tag,t))W.hasOwnProperty(n)||C.setValueForAttribute(F(this),n,c);else if(E.properties[n]||E.isCustomAttribute(n)){var d=F(this);null!=c?C.setValueForProperty(d,n,c):C.deleteValueForProperty(d,n)}}s&&y.setValueForStyles(F(this),s,this)},_updateDOMChildren:function(e,t,i,n){var r=H[typeof e.children]?e.children:null,a=H[typeof t.children]?t.children:null,s=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,o=t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html,c=null!=r?null:e.children,l=null!=a?null:t.children,d=null!=r||null!=s,h=null!=a||null!=o
;null!=c&&null==l?this.updateChildren(null,i,n):d&&!h&&this.updateTextContent(""),null!=a?r!==a&&this.updateTextContent(""+a):null!=o?s!==o&&this.updateMarkup(""+o):null!=l&&this.updateChildren(l,i,n)},getHostNode:function(){return F(this)},unmountComponent:function(e){switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":var t=this._wrapperState.listeners;if(t)for(var i=0;i<t.length;i++)t[i].remove();break;case"html":case"head":case"body":f("66",this._tag)}this.unmountChildren(e),_.uncacheNode(this),P.deleteAllListeners(this),this._rootNodeID=0,this._domID=0,this._wrapperState=null},getPublicInstance:function(){return F(this)}},g(m.prototype,m.Mixin,x.Mixin),t.exports=m},{10:10,11:11,110:110,113:113,119:119,12:12,129:129,137:137,141:141,142:142,143:143,16:16,17:17,2:2,25:25,32:32,33:33,38:38,39:39,40:40,43:43,5:5,58:58,61:61,68:68,9:9,95:95}],32:[function(e,t,i){"use strict";var n={hasCachedChildNodes:1};t.exports=n},{}],33:[function(e,t,i){"use strict";function n(e,t){return 1===e.nodeType&&e.getAttribute(m)===String(t)||8===e.nodeType&&e.nodeValue===" react-text: "+t+" "||8===e.nodeType&&e.nodeValue===" react-empty: "+t+" "}function r(e){for(var t;t=e._renderedComponent;)e=t;return e}function a(e,t){var i=r(e);i._hostNode=t,t[g]=i}function s(e){var t=e._hostNode;t&&(delete t[g],e._hostNode=null)}function o(e,t){if(!(e._flags&f.hasCachedChildNodes)){var i=e._renderedChildren,s=t.firstChild;e:for(var o in i)if(i.hasOwnProperty(o)){var c=i[o],l=r(c)._domID;if(0!==l){for(;null!==s;s=s.nextSibling)if(n(s,l)){a(c,s);continue e}h("32",l)}}e._flags|=f.hasCachedChildNodes}}function c(e){if(e[g])return e[g];for(var t=[];!e[g];){if(t.push(e),!e.parentNode)return null;e=e.parentNode}for(var i,n;e&&(n=e[g]);e=t.pop())i=n,t.length&&o(n,e);return i}function l(e){var t=c(e);return null!=t&&t._hostNode===e?t:null}function d(e){if(void 0===e._hostNode&&h("33"),e._hostNode)return e._hostNode;for(var t=[];!e._hostNode;)t.push(e),e._hostParent||h("34"),e=e._hostParent;for(;t.length;e=t.pop())o(e,e._hostNode);return e._hostNode}var h=e(113),u=e(11),p=e(32),m=(e(137),u.ID_ATTRIBUTE_NAME),f=p,g="__reactInternalInstance$"+Math.random().toString(36).slice(2),v={getClosestInstanceFromNode:c,getInstanceFromNode:l,getNodeFromInstance:d,precacheChildNodes:o,precacheNode:a,uncacheNode:s};t.exports=v},{11:11,113:113,137:137,32:32}],34:[function(e,t,i){"use strict";function n(e,t){return{_topLevelWrapper:e,_idCounter:1,_ownerDocument:t?t.nodeType===r?t:t.ownerDocument:null,_node:t,_tag:t?t.nodeName.toLowerCase():null,_namespaceURI:t?t.namespaceURI:null}}var r=(e(119),9);t.exports=n},{119:119}],35:[function(e,t,i){"use strict";var n=e(143),r=e(9),a=e(33),s=function(e){this._currentElement=null,this._hostNode=null,this._hostParent=null,this._hostContainerInfo=null,this._domID=0};n(s.prototype,{mountComponent:function(e,t,i,n){var s=i._idCounter++;this._domID=s,this._hostParent=t,this._hostContainerInfo=i;var o=" react-empty: "+this._domID+" ";if(e.useCreateElement){var c=i._ownerDocument,l=c.createComment(o);return a.precacheNode(this,l),r(l)}return e.renderToStaticMarkup?"":"\x3c!--"+o+"--\x3e"},receiveComponent:function(){},getHostNode:function(){return a.getNodeFromInstance(this)},unmountComponent:function(){a.uncacheNode(this)}}),t.exports=s},{143:143,33:33,9:9}],36:[function(e,t,i){"use strict";var n={useCreateElement:!0,useFiber:!1};t.exports=n},{}],37:[function(e,t,i){"use strict";var n=e(8),r=e(33),a={dangerouslyProcessChildrenUpdates:function(e,t){var i=r.getNodeFromInstance(e);n.processUpdates(i,t)}};t.exports=a},{33:33,8:8}],38:[function(e,t,i){"use strict";function n(){this._rootNodeID&&h.updateWrapper(this)}function r(e){var t=this._currentElement.props,i=c.executeOnChange(t,e);d.asap(n,this);var r=t.name;if("radio"===t.type&&null!=r){for(var s=l.getNodeFromInstance(this),o=s;o.parentNode;)o=o.parentNode;for(var h=o.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),u=0;u<h.length;u++){var p=h[u];if(p!==s&&p.form===s.form){var m=l.getInstanceFromNode(p);m||a("90"),d.asap(n,m)}}}return i}var a=e(113),s=e(143),o=e(12),c=e(23),l=e(33),d=e(71),h=(e(137),e(142),{getHostProps:function(e,t){var i=c.getValue(t),n=c.getChecked(t);return s({type:void 0,step:void 0,min:void 0,max:void 0},t,{defaultChecked:void 0,defaultValue:void 0,value:null!=i?i:e._wrapperState.initialValue,checked:null!=n?n:e._wrapperState.initialChecked,onChange:e._wrapperState.onChange})},mountWrapper:function(e,t){var i=t.defaultValue;e._wrapperState={initialChecked:null!=t.checked?t.checked:t.defaultChecked,initialValue:null!=t.value?t.value:i,listeners:null,onChange:r.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,i=t.checked;null!=i&&o.setValueForProperty(l.getNodeFromInstance(e),"checked",i||!1);var n=l.getNodeFromInstance(e),r=c.getValue(t);if(null!=r){var a=""+r;a!==n.value&&(n.value=a)}else null==t.value&&null!=t.defaultValue&&n.defaultValue!==""+t.defaultValue&&(n.defaultValue=""+t.defaultValue),null==t.checked&&null!=t.defaultChecked&&(n.defaultChecked=!!t.defaultChecked)},postMountWrapper:function(e){var t=e._currentElement.props,i=l.getNodeFromInstance(e);switch(t.type){case"submit":case"reset":break;case"color":case"date":case"datetime":case"datetime-local":case"month":case"time":case"week":i.value="",i.value=i.defaultValue;break;default:i.value=i.value}var n=i.name;""!==n&&(i.name=""),i.defaultChecked=!i.defaultChecked,i.defaultChecked=!i.defaultChecked,""!==n&&(i.name=n)}});t.exports=h},{113:113,12:12,137:137,142:142,143:143,23:23,33:33,71:71}],39:[function(e,t,i){"use strict";function n(e){var t="";return a.Children.forEach(e,function(e){null!=e&&("string"==typeof e||"number"==typeof e?t+=e:c||(c=!0))}),t}var r=e(143),a=e(121),s=e(33),o=e(40),c=(e(142),!1),l={mountWrapper:function(e,t,i){var r=null;if(null!=i){var a=i;"optgroup"===a._tag&&(a=a._hostParent),null!=a&&"select"===a._tag&&(r=o.getSelectValueContext(a))}var s=null;if(null!=r){var c;if(c=null!=t.value?t.value+"":n(t.children),s=!1,Array.isArray(r)){for(var l=0;l<r.length;l++)if(""+r[l]===c){s=!0;break}}else s=""+r===c}e._wrapperState={selected:s}},postMountWrapper:function(e){var t=e._currentElement.props;if(null!=t.value){s.getNodeFromInstance(e).setAttribute("value",t.value)}},getHostProps:function(e,t){var i=r({selected:void 0,children:void 0},t);null!=e._wrapperState.selected&&(i.selected=e._wrapperState.selected);var a=n(t.children);return a&&(i.children=a),i}};t.exports=l},{121:121,142:142,143:143,33:33,40:40}],40:[function(e,t,i){"use strict";function n(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=!1;var e=this._currentElement.props,t=o.getValue(e);null!=t&&r(this,Boolean(e.multiple),t)}}function r(e,t,i){var n,r,a=c.getNodeFromInstance(e).options;if(t){for(n={},r=0;r<i.length;r++)n[""+i[r]]=!0;for(r=0;r<a.length;r++){var s=n.hasOwnProperty(a[r].value);a[r].selected!==s&&(a[r].selected=s)}}else{for(n=""+i,r=0;r<a.length;r++)if(a[r].value===n)return void(a[r].selected=!0);a.length&&(a[0].selected=!0)}}function a(e){var t=this._currentElement.props,i=o.executeOnChange(t,e);return this._rootNodeID&&(this._wrapperState.pendingUpdate=!0),l.asap(n,this),i}var s=e(143),o=e(23),c=e(33),l=e(71),d=(e(142),!1),h={getHostProps:function(e,t){return s({},t,{onChange:e._wrapperState.onChange,value:void 0})},mountWrapper:function(e,t){var i=o.getValue(t);e._wrapperState={pendingUpdate:!1,initialValue:null!=i?i:t.defaultValue,listeners:null,onChange:a.bind(e),wasMultiple:Boolean(t.multiple)},void 0===t.value||void 0===t.defaultValue||d||(d=!0)},getSelectValueContext:function(e){return e._wrapperState.initialValue},postUpdateWrapper:function(e){var t=e._currentElement.props;e._wrapperState.initialValue=void 0;var i=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=Boolean(t.multiple);var n=o.getValue(t);null!=n?(e._wrapperState.pendingUpdate=!1,r(e,Boolean(t.multiple),n)):i!==Boolean(t.multiple)&&(null!=t.defaultValue?r(e,Boolean(t.multiple),t.defaultValue):r(e,Boolean(t.multiple),t.multiple?[]:""))}};t.exports=h},{142:142,143:143,23:23,33:33,71:71}],41:[function(e,t,i){"use strict";function n(e,t,i,n){return e===i&&t===n}function r(e){var t=document.selection,i=t.createRange(),n=i.text.length,r=i.duplicate();r.moveToElementText(e),r.setEndPoint("EndToStart",i);var a=r.text.length;return{start:a,end:a+n}}function a(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var i=t.anchorNode,r=t.anchorOffset,a=t.focusNode,s=t.focusOffset,o=t.getRangeAt(0);try{o.startContainer.nodeType,o.endContainer.nodeType}catch(e){return null}var c=n(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),l=c?0:o.toString().length,d=o.cloneRange();d.selectNodeContents(e),d.setEnd(o.startContainer,o.startOffset);var h=n(d.startContainer,d.startOffset,d.endContainer,d.endOffset),u=h?0:d.toString().length,p=u+l,m=document.createRange();m.setStart(i,r),m.setEnd(a,s);var f=m.collapsed;return{start:f?p:u,end:f?u:p}}function s(e,t){var i,n,r=document.selection.createRange().duplicate();void 0===t.end?(i=t.start,n=i):t.start>t.end?(i=t.end,n=t.start):(i=t.start,n=t.end),r.moveToElementText(e),r.moveStart("character",i),r.setEndPoint("EndToStart",r),r.moveEnd("character",n-i),r.select()}function o(e,t){if(window.getSelection){var i=window.getSelection(),n=e[d()].length,r=Math.min(t.start,n),a=void 0===t.end?r:Math.min(t.end,n);if(!i.extend&&r>a){var s=a;a=r,r=s}var o=l(e,r),c=l(e,a);if(o&&c){var h=document.createRange();h.setStart(o.node,o.offset),i.removeAllRanges(),r>a?(i.addRange(h),i.extend(c.node,c.offset)):(h.setEnd(c.node,c.offset),i.addRange(h))}}}var c=e(123),l=e(106),d=e(107),h=c.canUseDOM&&"selection"in document&&!("getSelection"in window),u={getOffsets:h?r:a,setOffsets:h?s:o};t.exports=u},{106:106,107:107,123:123}],42:[function(e,t,i){"use strict";var n=e(113),r=e(143),a=e(8),s=e(9),o=e(33),c=e(95),l=(e(137),e(119),function(e){this._currentElement=e,this._stringText=""+e,this._hostNode=null,this._hostParent=null,this._domID=0,this._mountIndex=0,this._closingComment=null,this._commentNodes=null});r(l.prototype,{mountComponent:function(e,t,i,n){var r=i._idCounter++,a=" react-text: "+r+" ",l=" /react-text ";if(this._domID=r,this._hostParent=t,e.useCreateElement){var d=i._ownerDocument,h=d.createComment(a),u=d.createComment(l),p=s(d.createDocumentFragment());return s.queueChild(p,s(h)),this._stringText&&s.queueChild(p,s(d.createTextNode(this._stringText))),s.queueChild(p,s(u)),o.precacheNode(this,h),this._closingComment=u,p}var m=c(this._stringText);return e.renderToStaticMarkup?m:"\x3c!--"+a+"--\x3e"+m+"\x3c!--"+l+"--\x3e"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var i=""+e;if(i!==this._stringText){this._stringText=i;var n=this.getHostNode();a.replaceDelimitedText(n[0],n[1],i)}}},getHostNode:function(){var e=this._commentNodes;if(e)return e;if(!this._closingComment)for(var t=o.getNodeFromInstance(this),i=t.nextSibling;;){if(null==i&&n("67",this._domID),8===i.nodeType&&" /react-text "===i.nodeValue){this._closingComment=i;break}i=i.nextSibling}return e=[this._hostNode,this._closingComment],this._commentNodes=e,e},unmountComponent:function(){this._closingComment=null,this._commentNodes=null,o.uncacheNode(this)}}),t.exports=l},{113:113,119:119,137:137,143:143,33:33,8:8,9:9,95:95}],43:[function(e,t,i){"use strict";function n(){this._rootNodeID&&d.updateWrapper(this)}function r(e){var t=this._currentElement.props,i=o.executeOnChange(t,e);return l.asap(n,this),i}var a=e(113),s=e(143),o=e(23),c=e(33),l=e(71),d=(e(137),e(142),{getHostProps:function(e,t){return null!=t.dangerouslySetInnerHTML&&a("91"),s({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue,onChange:e._wrapperState.onChange})},mountWrapper:function(e,t){var i=o.getValue(t),n=i;if(null==i){var s=t.defaultValue,c=t.children;null!=c&&(null!=s&&a("92"),Array.isArray(c)&&(c.length<=1||a("93"),c=c[0]),s=""+c),null==s&&(s=""),n=s}e._wrapperState={initialValue:""+n,listeners:null,onChange:r.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,i=c.getNodeFromInstance(e),n=o.getValue(t);if(null!=n){var r=""+n;r!==i.value&&(i.value=r),null==t.defaultValue&&(i.defaultValue=r)}null!=t.defaultValue&&(i.defaultValue=t.defaultValue)},postMountWrapper:function(e){var t=c.getNodeFromInstance(e),i=t.textContent;i===e._wrapperState.initialValue&&(t.value=i)}});t.exports=d},{113:113,137:137,142:142,143:143,23:23,33:33,71:71}],44:[function(e,t,i){"use strict";function n(e,t){"_hostNode"in e||c("33"),"_hostNode"in t||c("33");for(var i=0,n=e;n;n=n._hostParent)i++;for(var r=0,a=t;a;a=a._hostParent)r++;for(;i-r>0;)e=e._hostParent,i--;for(;r-i>0;)t=t._hostParent,r--;for(var s=i;s--;){if(e===t)return e;e=e._hostParent,t=t._hostParent}return null}function r(e,t){"_hostNode"in e||c("35"),"_hostNode"in t||c("35");for(;t;){if(t===e)return!0;t=t._hostParent}return!1}function a(e){return"_hostNode"in e||c("36"),e._hostParent}function s(e,t,i){for(var n=[];e;)n.push(e),e=e._hostParent;var r;for(r=n.length;r-- >0;)t(n[r],"captured",i);for(r=0;r<n.length;r++)t(n[r],"bubbled",i)}function o(e,t,i,r,a){for(var s=e&&t?n(e,t):null,o=[];e&&e!==s;)o.push(e),e=e._hostParent;for(var c=[];t&&t!==s;)c.push(t),t=t._hostParent;var l;for(l=0;l<o.length;l++)i(o[l],"bubbled",r);for(l=c.length;l-- >0;)i(c[l],"captured",a)}var c=e(113);e(137),t.exports={isAncestor:r,getLowestCommonAncestor:n,getParentInstance:a,traverseTwoPhase:s,traverseEnterLeave:o}},{113:113,137:137}],45:[function(e,t,i){"use strict";var n=e(121),r=e(30),a=r;n.addons&&(n.__SECRET_INJECTED_REACT_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=a),t.exports=a},{121:121,30:30}],46:[function(e,t,i){"use strict";function n(){this.reinitializeTransaction()}var r=e(143),a=e(71),s=e(89),o=e(129),c={initialize:o,close:function(){u.isBatchingUpdates=!1}},l={initialize:o,close:a.flushBatchedUpdates.bind(a)},d=[l,c];r(n.prototype,s,{getTransactionWrappers:function(){return d}});var h=new n,u={isBatchingUpdates:!1,batchedUpdates:function(e,t,i,n,r,a){var s=u.isBatchingUpdates;return u.isBatchingUpdates=!0,s?e(t,i,n,r,a):h.perform(e,null,t,i,n,r,a)}};t.exports=u},{129:129,143:143,71:71,89:89}],47:[function(e,t,i){"use strict";function n(){P||(P=!0,y.EventEmitter.injectReactEventListener(v),y.EventPluginHub.injectEventPluginOrder(o),y.EventPluginUtils.injectComponentTree(u),y.EventPluginUtils.injectTreeTraversal(m),y.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:C,EnterLeaveEventPlugin:c,ChangeEventPlugin:s,SelectEventPlugin:E,BeforeInputEventPlugin:a}),y.HostComponent.injectGenericComponentClass(h),y.HostComponent.injectTextComponentClass(f),y.DOMProperty.injectDOMPropertyConfig(r),y.DOMProperty.injectDOMPropertyConfig(l),y.DOMProperty.injectDOMPropertyConfig(S),y.EmptyComponent.injectEmptyComponentFactory(function(e){return new p(e)}),y.Updates.injectReconcileTransaction(b),y.Updates.injectBatchingStrategy(g),y.Component.injectEnvironment(d))}var r=e(1),a=e(3),s=e(7),o=e(14),c=e(15),l=e(21),d=e(27),h=e(31),u=e(33),p=e(35),m=e(44),f=e(42),g=e(46),v=e(52),y=e(55),b=e(65),S=e(73),E=e(74),C=e(75),P=!1;t.exports={inject:n}},{1:1,14:14,15:15,21:21,27:27,3:3,31:31,33:33,35:35,42:42,44:44,46:46,52:52,55:55,65:65,7:7,73:73,74:74,75:75}],48:[function(e,t,i){"use strict";var n="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;t.exports=n},{}],49:[function(e,t,i){"use strict";var n,r={injectEmptyComponentFactory:function(e){n=e}},a={create:function(e){return n(e)}};a.injection=r,t.exports=a},{}],50:[function(e,t,i){"use strict";function n(e,t,i){try{t(i)}catch(e){null===r&&(r=e)}}var r=null,a={invokeGuardedCallback:n,invokeGuardedCallbackWithCatch:n,rethrowCaughtError:function(){if(r){var e=r;throw r=null,e}}};t.exports=a},{}],51:[function(e,t,i){"use strict";function n(e){r.enqueueEvents(e),r.processEventQueue(!1)}var r=e(16),a={handleTopLevel:function(e,t,i,a){n(r.extractEvents(e,t,i,a))}};t.exports=a},{16:16}],52:[function(e,t,i){"use strict";function n(e){for(;e._hostParent;)e=e._hostParent;var t=h.getNodeFromInstance(e),i=t.parentNode;return h.getClosestInstanceFromNode(i)}function r(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function a(e){var t=p(e.nativeEvent),i=h.getClosestInstanceFromNode(t),r=i;do{e.ancestors.push(r),r=r&&n(r)}while(r);for(var a=0;a<e.ancestors.length;a++)i=e.ancestors[a],f._handleTopLevel(e.topLevelType,i,e.nativeEvent,p(e.nativeEvent))}function s(e){e(m(window))}var o=e(143),c=e(122),l=e(123),d=e(24),h=e(33),u=e(71),p=e(102),m=e(134);o(r.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),d.addPoolingTo(r,d.twoArgumentPooler);var f={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:l.canUseDOM?window:null,setHandleTopLevel:function(e){f._handleTopLevel=e},setEnabled:function(e){f._enabled=!!e},isEnabled:function(){return f._enabled},trapBubbledEvent:function(e,t,i){return i?c.listen(i,t,f.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,i){return i?c.capture(i,t,f.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=s.bind(null,e);c.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(f._enabled){var i=r.getPooled(e,t);try{u.batchedUpdates(a,i)}finally{r.release(i)}}}};t.exports=f},{102:102,122:122,123:123,134:134,143:143,24:24,33:33,71:71}],53:[function(e,t,i){"use strict";var n={logTopLevelRenders:!1};t.exports=n},{}],54:[function(e,t,i){"use strict";function n(e){return o||s("111",e.type),new o(e)}function r(e){return new c(e)}function a(e){return e instanceof c}var s=e(113),o=(e(137),null),c=null,l={injectGenericComponentClass:function(e){o=e},injectTextComponentClass:function(e){c=e}},d={createInternalComponent:n,createInstanceForText:r,isTextComponent:a,injection:l};t.exports=d},{113:113,137:137}],55:[function(e,t,i){"use strict";var n=e(11),r=e(16),a=e(18),s=e(28),o=e(49),c=e(25),l=e(54),d=e(71),h={Component:s.injection,DOMProperty:n.injection,EmptyComponent:o.injection,EventPluginHub:r.injection,EventPluginUtils:a.injection,EventEmitter:c.injection,HostComponent:l.injection,Updates:d.injection};t.exports=h},{11:11,16:16,18:18,25:25,28:28,49:49,54:54,71:71}],56:[function(e,t,i){"use strict";function n(e){return a(document.documentElement,e)}var r=e(41),a=e(126),s=e(131),o=e(132),c={hasSelectionCapabilities:function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&"text"===e.type||"textarea"===t||"true"===e.contentEditable)},getSelectionInformation:function(){var e=o();return{focusedElem:e,selectionRange:c.hasSelectionCapabilities(e)?c.getSelection(e):null}},restoreSelection:function(e){var t=o(),i=e.focusedElem,r=e.selectionRange;t!==i&&n(i)&&(c.hasSelectionCapabilities(i)&&c.setSelection(i,r),s(i))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var i=document.selection.createRange();i.parentElement()===e&&(t={start:-i.moveStart("character",-e.value.length),end:-i.moveEnd("character",-e.value.length)})}else t=r.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var i=t.start,n=t.end;if(void 0===n&&(n=i),"selectionStart"in e)e.selectionStart=i,e.selectionEnd=Math.min(n,e.value.length);else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var a=e.createTextRange();a.collapse(!0),a.moveStart("character",i),a.moveEnd("character",n-i),a.select()}else r.setOffsets(e,t)}};t.exports=c},{126:126,131:131,132:132,41:41}],57:[function(e,t,i){"use strict";var n={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}};t.exports=n},{}],58:[function(e,t,i){"use strict";t.exports={debugTool:null}},{}],59:[function(e,t,i){"use strict";var n=e(92),r=/\/?>/,a=/^<\!\-\-/,s={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=n(e);return a.test(e)?e:e.replace(r," "+s.CHECKSUM_ATTR_NAME+'="'+t+'"$&')},canReuseMarkup:function(e,t){var i=t.getAttribute(s.CHECKSUM_ATTR_NAME);return i=i&&parseInt(i,10),n(e)===i}};t.exports=s},{92:92}],60:[function(e,t,i){"use strict";function n(e,t){for(var i=Math.min(e.length,t.length),n=0;n<i;n++)if(e.charAt(n)!==t.charAt(n))return n;return e.length===t.length?-1:i}function r(e){return e?e.nodeType===O?e.documentElement:e.firstChild:null}function a(e){return e.getAttribute&&e.getAttribute(k)||""}function s(e,t,i,n,r){var a;if(E.logTopLevelRenders){var s=e._currentElement.props.child,o=s.type;a="React mount: "+("string"==typeof o?o:o.displayName||o.name),console.time(a)}var c=T.mountComponent(e,i,null,b(e,t),r,0);a&&console.timeEnd(a),e._renderedComponent._topLevelWrapper=e,U._mountImageIntoNode(c,t,e,n,i)}function o(e,t,i,n){var r=M.ReactReconcileTransaction.getPooled(!i&&S.useCreateElement);r.perform(s,null,e,t,r,i,n),M.ReactReconcileTransaction.release(r)}function c(e,t,i){for(T.unmountComponent(e,i),t.nodeType===O&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)}function l(e){var t=r(e);if(t){var i=y.getInstanceFromNode(t);return!(!i||!i._hostParent)}}function d(e){return!(!e||e.nodeType!==R&&e.nodeType!==O&&e.nodeType!==L)}function h(e){var t=r(e),i=t&&y.getInstanceFromNode(t);return i&&!i._hostParent?i:null}function u(e){var t=h(e);return t?t._hostContainerInfo._topLevelWrapper:null}var p=e(113),m=e(9),f=e(11),g=e(121),v=e(25),y=(e(120),e(33)),b=e(34),S=e(36),E=e(53),C=e(57),P=(e(58),e(59)),T=e(66),D=e(70),M=e(71),_=e(130),I=e(109),A=(e(137),e(115)),w=e(117),k=(e(142),f.ID_ATTRIBUTE_NAME),x=f.ROOT_ATTRIBUTE_NAME,R=1,O=9,L=11,N={},F=1,B=function(){this.rootID=F++};B.prototype.isReactComponent={},B.prototype.render=function(){return this.props.child},B.isReactTopLevelWrapper=!0;var U={TopLevelWrapper:B,_instancesByReactRootID:N,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,i,n,r){return U.scrollMonitor(n,function(){D.enqueueElementInternal(e,t,i),r&&D.enqueueCallbackInternal(e,r)}),e},_renderNewRootComponent:function(e,t,i,n){d(t)||p("37"),v.ensureScrollValueMonitoring();var r=I(e,!1);M.batchedUpdates(o,r,t,i,n);var a=r._instance.rootID;return N[a]=r,r},renderSubtreeIntoContainer:function(e,t,i,n){return null!=e&&C.has(e)||p("38"),U._renderSubtreeIntoContainer(e,t,i,n)},_renderSubtreeIntoContainer:function(e,t,i,n){D.validateCallback(n,"ReactDOM.render"),g.isValidElement(t)||p("39","string"==typeof t?" Instead of passing a string like 'div', pass React.createElement('div') or <div />.":"function"==typeof t?" Instead of passing a class like Foo, pass React.createElement(Foo) or <Foo />.":null!=t&&void 0!==t.props?" This may be caused by unintentionally loading two independent copies of React.":"");var s,o=g.createElement(B,{child:t});if(e){var c=C.get(e);s=c._processChildContext(c._context)}else s=_;var d=u(i);if(d){var h=d._currentElement,m=h.props.child;if(w(m,t)){var f=d._renderedComponent.getPublicInstance(),v=n&&function(){n.call(f)};return U._updateRootComponent(d,o,s,i,v),f}U.unmountComponentAtNode(i)}var y=r(i),b=y&&!!a(y),S=l(i),E=b&&!d&&!S,P=U._renderNewRootComponent(o,i,E,s)._renderedComponent.getPublicInstance();return n&&n.call(P),P},render:function(e,t,i){return U._renderSubtreeIntoContainer(null,e,t,i)},unmountComponentAtNode:function(e){d(e)||p("40");var t=u(e);return t?(delete N[t._instance.rootID],M.batchedUpdates(c,t,e,!1),!0):(l(e),1===e.nodeType&&e.hasAttribute(x),!1)},_mountImageIntoNode:function(e,t,i,a,s){if(d(t)||p("41"),a){var o=r(t);if(P.canReuseMarkup(e,o))return void y.precacheNode(i,o);var c=o.getAttribute(P.CHECKSUM_ATTR_NAME);o.removeAttribute(P.CHECKSUM_ATTR_NAME);var l=o.outerHTML;o.setAttribute(P.CHECKSUM_ATTR_NAME,c);var h=e,u=n(h,l),f=" (client) "+h.substring(u-20,u+20)+"\n (server) "+l.substring(u-20,u+20);t.nodeType===O&&p("42",f)}if(t.nodeType===O&&p("43"),s.useCreateElement){for(;t.lastChild;)t.removeChild(t.lastChild);m.insertTreeBefore(t,e,null)}else A(t,e),y.precacheNode(i,t.firstChild)}};t.exports=U},{109:109,11:11,113:113,115:115,117:117,120:120,121:121,130:130,137:137,142:142,25:25,33:33,34:34,36:36,53:53,57:57,58:58,59:59,66:66,70:70,71:71,9:9}],61:[function(e,t,i){"use strict";function n(e,t,i){return{type:"INSERT_MARKUP",content:e,fromIndex:null,fromNode:null,toIndex:i,afterNode:t}}function r(e,t,i){return{type:"MOVE_EXISTING",content:null,fromIndex:e._mountIndex,fromNode:u.getHostNode(e),toIndex:i,afterNode:t}}function a(e,t){return{type:"REMOVE_NODE",content:null,fromIndex:e._mountIndex,fromNode:t,toIndex:null,afterNode:null}}function s(e){return{type:"SET_MARKUP",content:e,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function o(e){return{type:"TEXT_CONTENT",content:e,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function c(e,t){return t&&(e=e||[],e.push(t)),e}function l(e,t){h.processChildrenUpdates(e,t)}var d=e(113),h=e(28),u=(e(57),e(58),e(120),e(66)),p=e(26),m=(e(129),e(97)),f=(e(137),{Mixin:{_reconcilerInstantiateChildren:function(e,t,i){return p.instantiateChildren(e,t,i)},_reconcilerUpdateChildren:function(e,t,i,n,r,a){var s;return s=m(t,0),p.updateChildren(e,s,i,n,r,this,this._hostContainerInfo,a,0),s},mountChildren:function(e,t,i){var n=this._reconcilerInstantiateChildren(e,t,i);this._renderedChildren=n;var r=[],a=0;for(var s in n)if(n.hasOwnProperty(s)){var o=n[s],c=u.mountComponent(o,t,this,this._hostContainerInfo,i,0);o._mountIndex=a++,r.push(c)}return r},updateTextContent:function(e){var t=this._renderedChildren;p.unmountChildren(t,!1);for(var i in t)t.hasOwnProperty(i)&&d("118");l(this,[o(e)])},updateMarkup:function(e){var t=this._renderedChildren;p.unmountChildren(t,!1);for(var i in t)t.hasOwnProperty(i)&&d("118");l(this,[s(e)])},updateChildren:function(e,t,i){this._updateChildren(e,t,i)},_updateChildren:function(e,t,i){var n=this._renderedChildren,r={},a=[],s=this._reconcilerUpdateChildren(n,e,a,r,t,i);if(s||n){var o,d=null,h=0,p=0,m=0,f=null;for(o in s)if(s.hasOwnProperty(o)){var g=n&&n[o],v=s[o];g===v?(d=c(d,this.moveChild(g,f,h,p)),p=Math.max(g._mountIndex,p),g._mountIndex=h):(g&&(p=Math.max(g._mountIndex,p)),d=c(d,this._mountChildAtIndex(v,a[m],f,h,t,i)),m++),h++,f=u.getHostNode(v)}for(o in r)r.hasOwnProperty(o)&&(d=c(d,this._unmountChild(n[o],r[o])));d&&l(this,d),this._renderedChildren=s}},unmountChildren:function(e){var t=this._renderedChildren;p.unmountChildren(t,e),this._renderedChildren=null},moveChild:function(e,t,i,n){if(e._mountIndex<n)return r(e,t,i)},createChild:function(e,t,i){return n(i,t,e._mountIndex)},removeChild:function(e,t){return a(e,t)},_mountChildAtIndex:function(e,t,i,n,r,a){return e._mountIndex=n,this.createChild(e,i,t)},_unmountChild:function(e,t){var i=this.removeChild(e,t);return e._mountIndex=null,i}}});t.exports=f},{113:113,120:120,129:129,137:137,26:26,28:28,57:57,58:58,66:66,97:97}],62:[function(e,t,i){"use strict";var n=e(113),r=e(121),a=(e(137),{HOST:0,COMPOSITE:1,EMPTY:2,getType:function(e){return null===e||!1===e?a.EMPTY:r.isValidElement(e)?"function"==typeof e.type?a.COMPOSITE:a.HOST:void n("26",e)}});t.exports=a},{113:113,121:121,137:137}],63:[function(e,t,i){"use strict";function n(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)}var r=e(113),a=(e(137),{addComponentAsRefTo:function(e,t,i){n(i)||r("119"),i.attachRef(t,e)},removeComponentAsRefFrom:function(e,t,i){n(i)||r("120");var a=i.getPublicInstance();a&&a.refs[t]===e.getPublicInstance()&&i.detachRef(t)}});t.exports=a},{113:113,137:137}],64:[function(e,t,i){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],65:[function(e,t,i){"use strict";function n(e){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=a.getPooled(null),this.useCreateElement=e}var r=e(143),a=e(6),s=e(24),o=e(25),c=e(56),l=(e(58),e(89)),d=e(70),h={initialize:c.getSelectionInformation,close:c.restoreSelection},u={initialize:function(){var e=o.isEnabled();return o.setEnabled(!1),e},close:function(e){o.setEnabled(e)}},p={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}},m=[h,u,p],f={getTransactionWrappers:function(){return m},getReactMountReady:function(){return this.reactMountReady},getUpdateQueue:function(){return d},checkpoint:function(){return this.reactMountReady.checkpoint()},rollback:function(e){this.reactMountReady.rollback(e)},destructor:function(){a.release(this.reactMountReady),this.reactMountReady=null}};r(n.prototype,l,f),s.addPoolingTo(n),t.exports=n},{143:143,24:24,25:25,56:56,58:58,6:6,70:70,89:89}],66:[function(e,t,i){"use strict";function n(){r.attachRefs(this,this._currentElement)}var r=e(67),a=(e(58),e(142),{mountComponent:function(e,t,i,r,a,s){var o=e.mountComponent(t,i,r,a,s);return e._currentElement&&null!=e._currentElement.ref&&t.getReactMountReady().enqueue(n,e),o},getHostNode:function(e){return e.getHostNode()},unmountComponent:function(e,t){r.detachRefs(e,e._currentElement),e.unmountComponent(t)},receiveComponent:function(e,t,i,a){var s=e._currentElement;if(t!==s||a!==e._context){var o=r.shouldUpdateRefs(s,t);o&&r.detachRefs(e,s),e.receiveComponent(t,i,a),o&&e._currentElement&&null!=e._currentElement.ref&&i.getReactMountReady().enqueue(n,e)}},performUpdateIfNecessary:function(e,t,i){e._updateBatchNumber===i&&e.performUpdateIfNecessary(t)}});t.exports=a},{142:142,58:58,67:67}],67:[function(e,t,i){"use strict";function n(e,t,i){"function"==typeof e?e(t.getPublicInstance()):a.addComponentAsRefTo(t,e,i)}function r(e,t,i){"function"==typeof e?e(null):a.removeComponentAsRefFrom(t,e,i)}var a=e(63),s={};s.attachRefs=function(e,t){if(null!==t&&"object"==typeof t){var i=t.ref;null!=i&&n(i,e,t._owner)}},s.shouldUpdateRefs=function(e,t){var i=null,n=null;null!==e&&"object"==typeof e&&(i=e.ref,n=e._owner);var r=null,a=null;return null!==t&&"object"==typeof t&&(r=t.ref,a=t._owner),i!==r||"string"==typeof r&&a!==n},s.detachRefs=function(e,t){if(null!==t&&"object"==typeof t){var i=t.ref;null!=i&&r(i,e,t._owner)}},t.exports=s},{63:63}],68:[function(e,t,i){"use strict";function n(e){this.reinitializeTransaction(),this.renderToStaticMarkup=e,this.useCreateElement=!1,this.updateQueue=new o(this)}var r=e(143),a=e(24),s=e(89),o=(e(58),e(69)),c=[],l={enqueue:function(){}},d={getTransactionWrappers:function(){return c},getReactMountReady:function(){return l},getUpdateQueue:function(){return this.updateQueue},destructor:function(){},checkpoint:function(){},rollback:function(){}};r(n.prototype,s,d),a.addPoolingTo(n),t.exports=n},{143:143,24:24,58:58,69:69,89:89}],69:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=e(70),a=(e(142),function(){function e(t){n(this,e),this.transaction=t}return e.prototype.isMounted=function(e){return!1},e.prototype.enqueueCallback=function(e,t,i){this.transaction.isInTransaction()&&r.enqueueCallback(e,t,i)},e.prototype.enqueueForceUpdate=function(e){this.transaction.isInTransaction()&&r.enqueueForceUpdate(e)},e.prototype.enqueueReplaceState=function(e,t){this.transaction.isInTransaction()&&r.enqueueReplaceState(e,t)},e.prototype.enqueueSetState=function(e,t){this.transaction.isInTransaction()&&r.enqueueSetState(e,t)},e}());t.exports=a},{142:142,70:70}],70:[function(e,t,i){"use strict";function n(e){c.enqueueUpdate(e)}function r(e){var t=typeof e;if("object"!==t)return t;var i=e.constructor&&e.constructor.name||t,n=Object.keys(e);return n.length>0&&n.length<20?i+" (keys: "+n.join(", ")+")":i}function a(e,t){var i=o.get(e);return i||null}var s=e(113),o=(e(120),e(57)),c=(e(58),e(71)),l=(e(137),e(142),{isMounted:function(e){var t=o.get(e);return!!t&&!!t._renderedComponent},enqueueCallback:function(e,t,i){l.validateCallback(t,i);var r=a(e);return r?(r._pendingCallbacks?r._pendingCallbacks.push(t):r._pendingCallbacks=[t],
void n(r)):null},enqueueCallbackInternal:function(e,t){e._pendingCallbacks?e._pendingCallbacks.push(t):e._pendingCallbacks=[t],n(e)},enqueueForceUpdate:function(e){var t=a(e,"forceUpdate");t&&(t._pendingForceUpdate=!0,n(t))},enqueueReplaceState:function(e,t){var i=a(e,"replaceState");i&&(i._pendingStateQueue=[t],i._pendingReplaceState=!0,n(i))},enqueueSetState:function(e,t){var i=a(e,"setState");if(i){(i._pendingStateQueue||(i._pendingStateQueue=[])).push(t),n(i)}},enqueueElementInternal:function(e,t,i){e._pendingElement=t,e._context=i,n(e)},validateCallback:function(e,t){e&&"function"!=typeof e&&s("122",t,r(e))}});t.exports=l},{113:113,120:120,137:137,142:142,57:57,58:58,71:71}],71:[function(e,t,i){"use strict";function n(){_.ReactReconcileTransaction&&E||d("123")}function r(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=u.getPooled(),this.reconcileTransaction=_.ReactReconcileTransaction.getPooled(!0)}function a(e,t,i,r,a,s){return n(),E.batchedUpdates(e,t,i,r,a,s)}function s(e,t){return e._mountOrder-t._mountOrder}function o(e){var t=e.dirtyComponentsLength;t!==v.length&&d("124",t,v.length),v.sort(s),y++;for(var i=0;i<t;i++){var n=v[i],r=n._pendingCallbacks;n._pendingCallbacks=null;var a;if(m.logTopLevelRenders){var o=n;n._currentElement.type.isReactTopLevelWrapper&&(o=n._renderedComponent),a="React update: "+o.getName(),console.time(a)}if(f.performUpdateIfNecessary(n,e.reconcileTransaction,y),a&&console.timeEnd(a),r)for(var c=0;c<r.length;c++)e.callbackQueue.enqueue(r[c],n.getPublicInstance())}}function c(e){return n(),E.isBatchingUpdates?(v.push(e),void(null==e._updateBatchNumber&&(e._updateBatchNumber=y+1))):void E.batchedUpdates(c,e)}function l(e,t){E.isBatchingUpdates||d("125"),b.enqueue(e,t),S=!0}var d=e(113),h=e(143),u=e(6),p=e(24),m=e(53),f=e(66),g=e(89),v=(e(137),[]),y=0,b=u.getPooled(),S=!1,E=null,C={initialize:function(){this.dirtyComponentsLength=v.length},close:function(){this.dirtyComponentsLength!==v.length?(v.splice(0,this.dirtyComponentsLength),D()):v.length=0}},P={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}},T=[C,P];h(r.prototype,g,{getTransactionWrappers:function(){return T},destructor:function(){this.dirtyComponentsLength=null,u.release(this.callbackQueue),this.callbackQueue=null,_.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,i){return g.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,i)}}),p.addPoolingTo(r);var D=function(){for(;v.length||S;){if(v.length){var e=r.getPooled();e.perform(o,null,e),r.release(e)}if(S){S=!1;var t=b;b=u.getPooled(),t.notifyAll(),u.release(t)}}},M={injectReconcileTransaction:function(e){e||d("126"),_.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){e||d("127"),"function"!=typeof e.batchedUpdates&&d("128"),"boolean"!=typeof e.isBatchingUpdates&&d("129"),E=e}},_={ReactReconcileTransaction:null,batchedUpdates:a,enqueueUpdate:c,flushBatchedUpdates:D,injection:M,asap:l};t.exports=_},{113:113,137:137,143:143,24:24,53:53,6:6,66:66,89:89}],72:[function(e,t,i){"use strict";t.exports="15.4.2"},{}],73:[function(e,t,i){"use strict";var n={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},r={accentHeight:"accent-height",accumulate:0,additive:0,alignmentBaseline:"alignment-baseline",allowReorder:"allowReorder",alphabetic:0,amplitude:0,arabicForm:"arabic-form",ascent:0,attributeName:"attributeName",attributeType:"attributeType",autoReverse:"autoReverse",azimuth:0,baseFrequency:"baseFrequency",baseProfile:"baseProfile",baselineShift:"baseline-shift",bbox:0,begin:0,bias:0,by:0,calcMode:"calcMode",capHeight:"cap-height",clip:0,clipPath:"clip-path",clipRule:"clip-rule",clipPathUnits:"clipPathUnits",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",contentScriptType:"contentScriptType",contentStyleType:"contentStyleType",cursor:0,cx:0,cy:0,d:0,decelerate:0,descent:0,diffuseConstant:"diffuseConstant",direction:0,display:0,divisor:0,dominantBaseline:"dominant-baseline",dur:0,dx:0,dy:0,edgeMode:"edgeMode",elevation:0,enableBackground:"enable-background",end:0,exponent:0,externalResourcesRequired:"externalResourcesRequired",fill:0,fillOpacity:"fill-opacity",fillRule:"fill-rule",filter:0,filterRes:"filterRes",filterUnits:"filterUnits",floodColor:"flood-color",floodOpacity:"flood-opacity",focusable:0,fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",format:0,from:0,fx:0,fy:0,g1:0,g2:0,glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",glyphRef:"glyphRef",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",hanging:0,horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",ideographic:0,imageRendering:"image-rendering",in:0,in2:0,intercept:0,k:0,k1:0,k2:0,k3:0,k4:0,kernelMatrix:"kernelMatrix",kernelUnitLength:"kernelUnitLength",kerning:0,keyPoints:"keyPoints",keySplines:"keySplines",keyTimes:"keyTimes",lengthAdjust:"lengthAdjust",letterSpacing:"letter-spacing",lightingColor:"lighting-color",limitingConeAngle:"limitingConeAngle",local:0,markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",markerHeight:"markerHeight",markerUnits:"markerUnits",markerWidth:"markerWidth",mask:0,maskContentUnits:"maskContentUnits",maskUnits:"maskUnits",mathematical:0,mode:0,numOctaves:"numOctaves",offset:0,opacity:0,operator:0,order:0,orient:0,orientation:0,origin:0,overflow:0,overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pathLength:"pathLength",patternContentUnits:"patternContentUnits",patternTransform:"patternTransform",patternUnits:"patternUnits",pointerEvents:"pointer-events",points:0,pointsAtX:"pointsAtX",pointsAtY:"pointsAtY",pointsAtZ:"pointsAtZ",preserveAlpha:"preserveAlpha",preserveAspectRatio:"preserveAspectRatio",primitiveUnits:"primitiveUnits",r:0,radius:0,refX:"refX",refY:"refY",renderingIntent:"rendering-intent",repeatCount:"repeatCount",repeatDur:"repeatDur",requiredExtensions:"requiredExtensions",requiredFeatures:"requiredFeatures",restart:0,result:0,rotate:0,rx:0,ry:0,scale:0,seed:0,shapeRendering:"shape-rendering",slope:0,spacing:0,specularConstant:"specularConstant",specularExponent:"specularExponent",speed:0,spreadMethod:"spreadMethod",startOffset:"startOffset",stdDeviation:"stdDeviation",stemh:0,stemv:0,stitchTiles:"stitchTiles",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",string:0,stroke:0,strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",surfaceScale:"surfaceScale",systemLanguage:"systemLanguage",tableValues:"tableValues",targetX:"targetX",targetY:"targetY",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",textLength:"textLength",to:0,transform:0,u1:0,u2:0,underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicode:0,unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",values:0,vectorEffect:"vector-effect",version:0,vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",viewBox:"viewBox",viewTarget:"viewTarget",visibility:0,widths:0,wordSpacing:"word-spacing",writingMode:"writing-mode",x:0,xHeight:"x-height",x1:0,x2:0,xChannelSelector:"xChannelSelector",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlns:0,xmlnsXlink:"xmlns:xlink",xmlLang:"xml:lang",xmlSpace:"xml:space",y:0,y1:0,y2:0,yChannelSelector:"yChannelSelector",z:0,zoomAndPan:"zoomAndPan"},a={Properties:{},DOMAttributeNamespaces:{xlinkActuate:n.xlink,xlinkArcrole:n.xlink,xlinkHref:n.xlink,xlinkRole:n.xlink,xlinkShow:n.xlink,xlinkTitle:n.xlink,xlinkType:n.xlink,xmlBase:n.xml,xmlLang:n.xml,xmlSpace:n.xml},DOMAttributeNames:{}};Object.keys(r).forEach(function(e){a.Properties[e]=0,r[e]&&(a.DOMAttributeNames[e]=r[e])}),t.exports=a},{}],74:[function(e,t,i){"use strict";function n(e){if("selectionStart"in e&&c.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var i=document.selection.createRange();return{parentElement:i.parentElement(),text:i.text,top:i.boundingTop,left:i.boundingLeft}}}function r(e,t){if(y||null==f||f!==d())return null;var i=n(f);if(!v||!u(v,i)){v=i;var r=l.getPooled(m.select,g,e,t);return r.type="select",r.target=f,a.accumulateTwoPhaseDispatches(r),r}return null}var a=e(19),s=e(123),o=e(33),c=e(56),l=e(80),d=e(132),h=e(111),u=e(141),p=s.canUseDOM&&"documentMode"in document&&document.documentMode<=11,m={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:["topBlur","topContextMenu","topFocus","topKeyDown","topKeyUp","topMouseDown","topMouseUp","topSelectionChange"]}},f=null,g=null,v=null,y=!1,b=!1,S={eventTypes:m,extractEvents:function(e,t,i,n){if(!b)return null;var a=t?o.getNodeFromInstance(t):window;switch(e){case"topFocus":(h(a)||"true"===a.contentEditable)&&(f=a,g=t,v=null);break;case"topBlur":f=null,g=null,v=null;break;case"topMouseDown":y=!0;break;case"topContextMenu":case"topMouseUp":return y=!1,r(i,n);case"topSelectionChange":if(p)break;case"topKeyDown":case"topKeyUp":return r(i,n)}return null},didPutListener:function(e,t,i){"onSelect"===t&&(b=!0)}};t.exports=S},{111:111,123:123,132:132,141:141,19:19,33:33,56:56,80:80}],75:[function(e,t,i){"use strict";function n(e){return"."+e._rootNodeID}function r(e){return"button"===e||"input"===e||"select"===e||"textarea"===e}var a=e(113),s=e(122),o=e(19),c=e(33),l=e(76),d=e(77),h=e(80),u=e(81),p=e(83),m=e(84),f=e(79),g=e(85),v=e(86),y=e(87),b=e(88),S=e(129),E=e(99),C=(e(137),{}),P={};["abort","animationEnd","animationIteration","animationStart","blur","canPlay","canPlayThrough","click","contextMenu","copy","cut","doubleClick","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","focus","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","progress","rateChange","reset","scroll","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchMove","touchStart","transitionEnd","volumeChange","waiting","wheel"].forEach(function(e){var t=e[0].toUpperCase()+e.slice(1),i="on"+t,n="top"+t,r={phasedRegistrationNames:{bubbled:i,captured:i+"Capture"},dependencies:[n]};C[e]=r,P[n]=r});var T={},D={eventTypes:C,extractEvents:function(e,t,i,n){var r=P[e];if(!r)return null;var s;switch(e){case"topAbort":case"topCanPlay":case"topCanPlayThrough":case"topDurationChange":case"topEmptied":case"topEncrypted":case"topEnded":case"topError":case"topInput":case"topInvalid":case"topLoad":case"topLoadedData":case"topLoadedMetadata":case"topLoadStart":case"topPause":case"topPlay":case"topPlaying":case"topProgress":case"topRateChange":case"topReset":case"topSeeked":case"topSeeking":case"topStalled":case"topSubmit":case"topSuspend":case"topTimeUpdate":case"topVolumeChange":case"topWaiting":s=h;break;case"topKeyPress":if(0===E(i))return null;case"topKeyDown":case"topKeyUp":s=p;break;case"topBlur":case"topFocus":s=u;break;case"topClick":if(2===i.button)return null;case"topDoubleClick":case"topMouseDown":case"topMouseMove":case"topMouseUp":case"topMouseOut":case"topMouseOver":case"topContextMenu":s=m;break;case"topDrag":case"topDragEnd":case"topDragEnter":case"topDragExit":case"topDragLeave":case"topDragOver":case"topDragStart":case"topDrop":s=f;break;case"topTouchCancel":case"topTouchEnd":case"topTouchMove":case"topTouchStart":s=g;break;case"topAnimationEnd":case"topAnimationIteration":case"topAnimationStart":s=l;break;case"topTransitionEnd":s=v;break;case"topScroll":s=y;break;case"topWheel":s=b;break;case"topCopy":case"topCut":case"topPaste":s=d}s||a("86",e);var c=s.getPooled(r,t,i,n);return o.accumulateTwoPhaseDispatches(c),c},didPutListener:function(e,t,i){if("onClick"===t&&!r(e._tag)){var a=n(e),o=c.getNodeFromInstance(e);T[a]||(T[a]=s.listen(o,"click",S))}},willDeleteListener:function(e,t){if("onClick"===t&&!r(e._tag)){var i=n(e);T[i].remove(),delete T[i]}}};t.exports=D},{113:113,122:122,129:129,137:137,19:19,33:33,76:76,77:77,79:79,80:80,81:81,83:83,84:84,85:85,86:86,87:87,88:88,99:99}],76:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(80),a={animationName:null,elapsedTime:null,pseudoElement:null};r.augmentClass(n,a),t.exports=n},{80:80}],77:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(80),a={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};r.augmentClass(n,a),t.exports=n},{80:80}],78:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(80),a={data:null};r.augmentClass(n,a),t.exports=n},{80:80}],79:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(84),a={dataTransfer:null};r.augmentClass(n,a),t.exports=n},{84:84}],80:[function(e,t,i){"use strict";function n(e,t,i,n){this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=i;var r=this.constructor.Interface;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a];o?this[a]=o(i):"target"===a?this.target=n:this[a]=i[a]}var c=null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue;return this.isDefaultPrevented=c?s.thatReturnsTrue:s.thatReturnsFalse,this.isPropagationStopped=s.thatReturnsFalse,this}var r=e(143),a=e(24),s=e(129),o=(e(142),["dispatchConfig","_targetInst","nativeEvent","isDefaultPrevented","isPropagationStopped","_dispatchListeners","_dispatchInstances"]),c={type:null,target:null,currentTarget:s.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};r(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=s.thatReturnsTrue)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=s.thatReturnsTrue)},persist:function(){this.isPersistent=s.thatReturnsTrue},isPersistent:s.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;for(var i=0;i<o.length;i++)this[o[i]]=null}}),n.Interface=c,n.augmentClass=function(e,t){var i=this,n=function(){};n.prototype=i.prototype;var s=new n;r(s,e.prototype),e.prototype=s,e.prototype.constructor=e,e.Interface=r({},i.Interface,t),e.augmentClass=i.augmentClass,a.addPoolingTo(e,a.fourArgumentPooler)},a.addPoolingTo(n,a.fourArgumentPooler),t.exports=n},{129:129,142:142,143:143,24:24}],81:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(87),a={relatedTarget:null};r.augmentClass(n,a),t.exports=n},{87:87}],82:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(80),a={data:null};r.augmentClass(n,a),t.exports=n},{80:80}],83:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(87),a=e(99),s=e(100),o=e(101),c={key:s,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:o,charCode:function(e){return"keypress"===e.type?a(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?a(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};r.augmentClass(n,c),t.exports=n},{100:100,101:101,87:87,99:99}],84:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(87),a=e(90),s=e(101),o={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:s,button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+a.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+a.currentScrollTop}};r.augmentClass(n,o),t.exports=n},{101:101,87:87,90:90}],85:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(87),a=e(101),s={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:a};r.augmentClass(n,s),t.exports=n},{101:101,87:87}],86:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(80),a={propertyName:null,elapsedTime:null,pseudoElement:null};r.augmentClass(n,a),t.exports=n},{80:80}],87:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(80),a=e(102),s={view:function(e){if(e.view)return e.view;var t=a(e);if(t.window===t)return t;var i=t.ownerDocument;return i?i.defaultView||i.parentWindow:window},detail:function(e){return e.detail||0}};r.augmentClass(n,s),t.exports=n},{102:102,80:80}],88:[function(e,t,i){"use strict";function n(e,t,i,n){return r.call(this,e,t,i,n)}var r=e(84),a={deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null};r.augmentClass(n,a),t.exports=n},{84:84}],89:[function(e,t,i){"use strict";var n=e(113),r=(e(137),{}),a={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,t,i,r,a,s,o,c){this.isInTransaction()&&n("27");var l,d;try{this._isInTransaction=!0,l=!0,this.initializeAll(0),d=e.call(t,i,r,a,s,o,c),l=!1}finally{try{if(l)try{this.closeAll(0)}catch(e){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return d},initializeAll:function(e){for(var t=this.transactionWrappers,i=e;i<t.length;i++){var n=t[i];try{this.wrapperInitData[i]=r,this.wrapperInitData[i]=n.initialize?n.initialize.call(this):null}finally{if(this.wrapperInitData[i]===r)try{this.initializeAll(i+1)}catch(e){}}}},closeAll:function(e){this.isInTransaction()||n("28");for(var t=this.transactionWrappers,i=e;i<t.length;i++){var a,s=t[i],o=this.wrapperInitData[i];try{a=!0,o!==r&&s.close&&s.close.call(this,o),a=!1}finally{if(a)try{this.closeAll(i+1)}catch(e){}}}this.wrapperInitData.length=0}};t.exports=a},{113:113,137:137}],90:[function(e,t,i){"use strict";var n={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){n.currentScrollLeft=e.x,n.currentScrollTop=e.y}};t.exports=n},{}],91:[function(e,t,i){"use strict";function n(e,t){return null==t&&r("30"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}var r=e(113);e(137),t.exports=n},{113:113,137:137}],92:[function(e,t,i){"use strict";function n(e){for(var t=1,i=0,n=0,a=e.length,s=-4&a;n<s;){for(var o=Math.min(n+4096,s);n<o;n+=4)i+=(t+=e.charCodeAt(n))+(t+=e.charCodeAt(n+1))+(t+=e.charCodeAt(n+2))+(t+=e.charCodeAt(n+3));t%=r,i%=r}for(;n<a;n++)i+=t+=e.charCodeAt(n);return t%=r,i%=r,t|i<<16}var r=65521;t.exports=n},{}],93:[function(e,t,i){"use strict";var n=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,i,n,r){MSApp.execUnsafeLocalFunction(function(){return e(t,i,n,r)})}:e};t.exports=n},{}],94:[function(e,t,i){"use strict";function n(e,t,i){return null==t||"boolean"==typeof t||""===t?"":isNaN(t)||0===t||a.hasOwnProperty(e)&&a[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}var r=e(4),a=(e(142),r.isUnitlessNumber);t.exports=n},{142:142,4:4}],95:[function(e,t,i){"use strict";function n(e){var t=""+e,i=a.exec(t);if(!i)return t;var n,r="",s=0,o=0;for(s=i.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&#x27;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}o!==s&&(r+=t.substring(o,s)),o=s+1,r+=n}return o!==s?r+t.substring(o,s):r}function r(e){return"boolean"==typeof e||"number"==typeof e?""+e:n(e)}var a=/["'&<>]/;t.exports=r},{}],96:[function(e,t,i){"use strict";function n(e){if(null==e)return null;if(1===e.nodeType)return e;var t=s.get(e);return t?(t=o(t),t?a.getNodeFromInstance(t):null):void("function"==typeof e.render?r("44"):r("45",Object.keys(e)))}var r=e(113),a=(e(120),e(33)),s=e(57),o=e(103);e(137),e(142),t.exports=n},{103:103,113:113,120:120,137:137,142:142,33:33,57:57}],97:[function(e,t,i){(function(i){"use strict";function n(e,t,i,n){if(e&&"object"==typeof e){var r=e;void 0===r[i]&&null!=t&&(r[i]=t)}}function r(e,t){if(null==e)return e;var i={};return a(e,n,i),i}var a=(e(22),e(118));e(142),void 0!==i&&i.env,t.exports=r}).call(this,void 0)},{118:118,142:142,22:22}],98:[function(e,t,i){"use strict";function n(e,t,i){Array.isArray(e)?e.forEach(t,i):e&&t.call(i,e)}t.exports=n},{}],99:[function(e,t,i){"use strict";function n(e){var t,i=e.keyCode;return"charCode"in e?0===(t=e.charCode)&&13===i&&(t=13):t=i,t>=32||13===t?t:0}t.exports=n},{}],100:[function(e,t,i){"use strict";function n(e){if(e.key){var t=a[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var i=r(e);return 13===i?"Enter":String.fromCharCode(i)}return"keydown"===e.type||"keyup"===e.type?s[e.keyCode]||"Unidentified":""}var r=e(99),a={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},s={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};t.exports=n},{99:99}],101:[function(e,t,i){"use strict";function n(e){var t=this,i=t.nativeEvent;if(i.getModifierState)return i.getModifierState(e);var n=a[e];return!!n&&!!i[n]}function r(e){return n}var a={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};t.exports=r},{}],102:[function(e,t,i){"use strict";function n(e){var t=e.target||e.srcElement||window;return t.correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}t.exports=n},{}],103:[function(e,t,i){"use strict";function n(e){for(var t;(t=e._renderedNodeType)===r.COMPOSITE;)e=e._renderedComponent;return t===r.HOST?e._renderedComponent:t===r.EMPTY?null:void 0}var r=e(62);t.exports=n},{62:62}],104:[function(e,t,i){"use strict";function n(e){var t=e&&(r&&e[r]||e[a]);if("function"==typeof t)return t}var r="function"==typeof Symbol&&Symbol.iterator,a="@@iterator";t.exports=n},{}],105:[function(e,t,i){"use strict";function n(){return r++}var r=1;t.exports=n},{}],106:[function(e,t,i){"use strict";function n(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function r(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function a(e,t){for(var i=n(e),a=0,s=0;i;){if(3===i.nodeType){if(s=a+i.textContent.length,a<=t&&s>=t)return{node:i,offset:t-a};a=s}i=n(r(i))}}t.exports=a},{}],107:[function(e,t,i){"use strict";function n(){return!a&&r.canUseDOM&&(a="textContent"in document.documentElement?"textContent":"innerText"),a}var r=e(123),a=null;t.exports=n},{123:123}],108:[function(e,t,i){"use strict";function n(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i["ms"+e]="MS"+t,i["O"+e]="o"+t.toLowerCase(),i}function r(e){if(o[e])return o[e];if(!s[e])return e;var t=s[e];for(var i in t)if(t.hasOwnProperty(i)&&i in c)return o[e]=t[i];return""}var a=e(123),s={animationend:n("Animation","AnimationEnd"),animationiteration:n("Animation","AnimationIteration"),animationstart:n("Animation","AnimationStart"),transitionend:n("Transition","TransitionEnd")},o={},c={};a.canUseDOM&&(c=document.createElement("div").style,"AnimationEvent"in window||(delete s.animationend.animation,delete s.animationiteration.animation,delete s.animationstart.animation),"TransitionEvent"in window||delete s.transitionend.transition),t.exports=r},{123:123}],109:[function(e,t,i){"use strict";function n(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}function r(e){return"function"==typeof e&&void 0!==e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}function a(e,t){var i;if(null===e||!1===e)i=l.create(a);else if("object"==typeof e){var o=e,c=o.type;if("function"!=typeof c&&"string"!=typeof c){var u="";u+=n(o._owner),s("130",null==c?c:typeof c,u)}"string"==typeof o.type?i=d.createInternalComponent(o):r(o.type)?(i=new o.type(o),i.getHostNode||(i.getHostNode=i.getNativeNode)):i=new h(o)}else"string"==typeof e||"number"==typeof e?i=d.createInstanceForText(e):s("131",typeof e);return i._mountIndex=0,i._mountImage=null,i}var s=e(113),o=e(143),c=e(29),l=e(49),d=e(54),h=(e(105),e(137),e(142),function(e){this.construct(e)});o(h.prototype,c,{_instantiateReactComponent:a}),t.exports=a},{105:105,113:113,137:137,142:142,143:143,29:29,49:49,54:54}],110:[function(e,t,i){"use strict";function n(e,t){if(!a.canUseDOM||t&&!("addEventListener"in document))return!1;var i="on"+e,n=i in document;if(!n){var s=document.createElement("div");s.setAttribute(i,"return;"),n="function"==typeof s[i]}return!n&&r&&"wheel"===e&&(n=document.implementation.hasFeature("Events.wheel","3.0")),n}var r,a=e(123);a.canUseDOM&&(r=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("","")),t.exports=n},{123:123}],111:[function(e,t,i){"use strict";function n(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!r[e.type]:"textarea"===t}var r={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};t.exports=n},{}],112:[function(e,t,i){"use strict";function n(e){return'"'+r(e)+'"'}var r=e(95);t.exports=n},{95:95}],113:[function(e,t,i){"use strict";function n(e){for(var t=arguments.length-1,i="Minified React error #"+e+"; visit http://facebook.github.io/react/docs/error-decoder.html?invariant="+e,n=0;n<t;n++)i+="&args[]="+encodeURIComponent(arguments[n+1]);i+=" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.";var r=new Error(i);throw r.name="Invariant Violation",r.framesToPop=1,r}t.exports=n},{}],114:[function(e,t,i){"use strict";var n=e(60);t.exports=n.renderSubtreeIntoContainer},{60:60}],115:[function(e,t,i){"use strict";var n,r=e(123),a=e(10),s=/^[ \r\n\t\f]/,o=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,c=e(93),l=c(function(e,t){if(e.namespaceURI!==a.svg||"innerHTML"in e)e.innerHTML=t;else{n=n||document.createElement("div"),n.innerHTML="<svg>"+t+"</svg>";for(var i=n.firstChild;i.firstChild;)e.appendChild(i.firstChild)}});if(r.canUseDOM){var d=document.createElement("div");d.innerHTML=" ",""===d.innerHTML&&(l=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),s.test(t)||"<"===t[0]&&o.test(t)){e.innerHTML=String.fromCharCode(65279)+t;var i=e.firstChild;1===i.data.length?e.removeChild(i):i.deleteData(0,1)}else e.innerHTML=t}),d=null}t.exports=l},{10:10,123:123,93:93}],116:[function(e,t,i){"use strict";var n=e(123),r=e(95),a=e(115),s=function(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t};n.canUseDOM&&("textContent"in document.documentElement||(s=function(e,t){return 3===e.nodeType?void(e.nodeValue=t):void a(e,r(t))})),t.exports=s},{115:115,123:123,95:95}],117:[function(e,t,i){"use strict";function n(e,t){var i=null===e||!1===e,n=null===t||!1===t;if(i||n)return i===n;var r=typeof e,a=typeof t;return"string"===r||"number"===r?"string"===a||"number"===a:"object"===a&&e.type===t.type&&e.key===t.key}t.exports=n},{}],118:[function(e,t,i){"use strict";function n(e,t){return e&&"object"==typeof e&&null!=e.key?l.escape(e.key):t.toString(36)}function r(e,t,i,a){var u=typeof e;if("undefined"!==u&&"boolean"!==u||(e=null),null===e||"string"===u||"number"===u||"object"===u&&e.$$typeof===o)return i(a,e,""===t?d+n(e,0):t),1;var p,m,f=0,g=""===t?d:t+h;if(Array.isArray(e))for(var v=0;v<e.length;v++)p=e[v],m=g+n(p,v),f+=r(p,m,i,a);else{var y=c(e);if(y){var b,S=y.call(e);if(y!==e.entries)for(var E=0;!(b=S.next()).done;)p=b.value,m=g+n(p,E++),f+=r(p,m,i,a);else for(;!(b=S.next()).done;){var C=b.value;C&&(p=C[1],m=g+l.escape(C[0])+h+n(p,0),f+=r(p,m,i,a))}}else if("object"===u){var P=String(e);s("31","[object Object]"===P?"object with keys {"+Object.keys(e).join(", ")+"}":P,"")}}return f}function a(e,t,i){return null==e?0:r(e,"",t,i)}var s=e(113),o=(e(120),e(48)),c=e(104),l=(e(137),e(22)),d=(e(142),"."),h=":";t.exports=a},{104:104,113:113,120:120,137:137,142:142,22:22,48:48}],119:[function(e,t,i){"use strict";var n=(e(143),e(129)),r=(e(142),n);t.exports=r},{129:129,142:142,143:143}],120:[function(t,i,n){"use strict";var r=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;i.exports=r.ReactCurrentOwner},{}],121:[function(t,i,n){"use strict";i.exports=e},{}],122:[function(e,t,i){"use strict";var n=e(129),r={listen:function(e,t,i){return e.addEventListener?(e.addEventListener(t,i,!1),{remove:function(){e.removeEventListener(t,i,!1)}}):e.attachEvent?(e.attachEvent("on"+t,i),{remove:function(){e.detachEvent("on"+t,i)}}):void 0},capture:function(e,t,i){return e.addEventListener?(e.addEventListener(t,i,!0),{remove:function(){e.removeEventListener(t,i,!0)}}):{remove:n}},registerDefault:function(){}};t.exports=r},{129:129}],123:[function(e,t,i){"use strict";var n=!("undefined"==typeof window||!window.document||!window.document.createElement),r={canUseDOM:n,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:n&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:n&&!!window.screen,isInWorker:!n};t.exports=r},{}],124:[function(e,t,i){"use strict";function n(e){return e.replace(r,function(e,t){return t.toUpperCase()})}var r=/-(.)/g;t.exports=n},{}],125:[function(e,t,i){"use strict";function n(e){return r(e.replace(a,"ms-"))}var r=e(124),a=/^-ms-/;t.exports=n},{124:124}],126:[function(e,t,i){"use strict";function n(e,t){return!(!e||!t)&&(e===t||!r(e)&&(r(t)?n(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}var r=e(139);t.exports=n},{139:139}],127:[function(e,t,i){"use strict";function n(e){var t=e.length;if((Array.isArray(e)||"object"!=typeof e&&"function"!=typeof e)&&s(!1),"number"!=typeof t&&s(!1),0===t||t-1 in e||s(!1),"function"==typeof e.callee&&s(!1),e.hasOwnProperty)try{
return Array.prototype.slice.call(e)}catch(e){}for(var i=Array(t),n=0;n<t;n++)i[n]=e[n];return i}function r(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}function a(e){return r(e)?Array.isArray(e)?e.slice():n(e):[e]}var s=e(137);t.exports=a},{137:137}],128:[function(e,t,i){"use strict";function n(e){var t=e.match(d);return t&&t[1].toLowerCase()}function r(e,t){var i=l;l||c(!1);var r=n(e),a=r&&o(r);if(a){i.innerHTML=a[1]+e+a[2];for(var d=a[0];d--;)i=i.lastChild}else i.innerHTML=e;var h=i.getElementsByTagName("script");h.length&&(t||c(!1),s(h).forEach(t));for(var u=Array.from(i.childNodes);i.lastChild;)i.removeChild(i.lastChild);return u}var a=e(123),s=e(127),o=e(133),c=e(137),l=a.canUseDOM?document.createElement("div"):null,d=/^\s*<(\w+)/;t.exports=r},{123:123,127:127,133:133,137:137}],129:[function(e,t,i){"use strict";function n(e){return function(){return e}}var r=function(){};r.thatReturns=n,r.thatReturnsFalse=n(!1),r.thatReturnsTrue=n(!0),r.thatReturnsNull=n(null),r.thatReturnsThis=function(){return this},r.thatReturnsArgument=function(e){return e},t.exports=r},{}],130:[function(e,t,i){"use strict";var n={};t.exports=n},{}],131:[function(e,t,i){"use strict";function n(e){try{e.focus()}catch(e){}}t.exports=n},{}],132:[function(e,t,i){"use strict";function n(){if("undefined"==typeof document)return null;try{return document.activeElement||document.body}catch(e){return document.body}}t.exports=n},{}],133:[function(e,t,i){"use strict";function n(e){return s||a(!1),u.hasOwnProperty(e)||(e="*"),o.hasOwnProperty(e)||(s.innerHTML="*"===e?"<link />":"<"+e+"></"+e+">",o[e]=!s.firstChild),o[e]?u[e]:null}var r=e(123),a=e(137),s=r.canUseDOM?document.createElement("div"):null,o={},c=[1,'<select multiple="true">',"</select>"],l=[1,"<table>","</table>"],d=[3,"<table><tbody><tr>","</tr></tbody></table>"],h=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"],u={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:c,option:c,caption:l,colgroup:l,tbody:l,tfoot:l,thead:l,td:d,th:d};["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"].forEach(function(e){u[e]=h,o[e]=!0}),t.exports=n},{123:123,137:137}],134:[function(e,t,i){"use strict";function n(e){return e===window?{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}t.exports=n},{}],135:[function(e,t,i){"use strict";function n(e){return e.replace(r,"-$1").toLowerCase()}var r=/([A-Z])/g;t.exports=n},{}],136:[function(e,t,i){"use strict";function n(e){return r(e).replace(a,"-ms-")}var r=e(135),a=/^ms-/;t.exports=n},{135:135}],137:[function(e,t,i){"use strict";function n(e,t,i,n,a,s,o,c){if(r(t),!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[i,n,a,s,o,c],h=0;l=new Error(t.replace(/%s/g,function(){return d[h++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}}var r=function(e){};t.exports=n},{}],138:[function(e,t,i){"use strict";function n(e){return!(!e||!("function"==typeof Node?e instanceof Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}t.exports=n},{}],139:[function(e,t,i){"use strict";function n(e){return r(e)&&3==e.nodeType}var r=e(138);t.exports=n},{138:138}],140:[function(e,t,i){"use strict";function n(e){var t={};return function(i){return t.hasOwnProperty(i)||(t[i]=e.call(this,i)),t[i]}}t.exports=n},{}],141:[function(e,t,i){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!==e&&t!==t}function r(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(var s=0;s<i.length;s++)if(!a.call(t,i[s])||!n(e[i[s]],t[i[s]]))return!1;return!0}var a=Object.prototype.hasOwnProperty;t.exports=r},{}],142:[function(e,t,i){"use strict";var n=e(129),r=n;t.exports=r},{129:129}],143:[function(e,t,i){"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,s,o=n(e),c=1;c<arguments.length;c++){i=Object(arguments[c]);for(var l in i)r.call(i,l)&&(o[l]=i[l]);if(Object.getOwnPropertySymbols){s=Object.getOwnPropertySymbols(i);for(var d=0;d<s.length;d++)a.call(i,s[d])&&(o[s[d]]=i[s[d]])}}return o}},{}]},{},[45])(45)}()}()}),function(){var e=Date,t=Date.CultureStrings?Date.CultureStrings.lang:null,i={},n={getFromKey:function(e,t){var i;return i=Date.CultureStrings&&Date.CultureStrings[t]&&Date.CultureStrings[t][e]?Date.CultureStrings[t][e]:n.buildFromDefault(e),"/"===e.charAt(0)&&(i=n.buildFromRegex(e,t)),i},getFromObjectValues:function(e,t){var i,r={};for(i in e)e.hasOwnProperty(i)&&(r[i]=n.getFromKey(e[i],t));return r},getFromObjectKeys:function(e,t){var i,r={};for(i in e)e.hasOwnProperty(i)&&(r[n.getFromKey(i,t)]=e[i]);return r},getFromArray:function(e,t){for(var i=[],r=0;r<e.length;r++)r in e&&(i[r]=n.getFromKey(e[r],t));return i},buildFromDefault:function(e){var t,i,n,r;switch(e){case"name":t="en-US";break;case"englishName":case"nativeName":t="English (United States)";break;case"twoDigitYearMax":t=2049;break;case"firstDayOfWeek":t=0;break;default:t=e,n=e.split("_"),i=n.length,i>1&&"/"!==e.charAt(0)&&("initial"!==(r=n[i-1].toLowerCase())&&"abbr"!==r||(t=n[0]))}return t},buildFromRegex:function(e,t){return Date.CultureStrings&&Date.CultureStrings[t]&&Date.CultureStrings[t][e]?new RegExp(Date.CultureStrings[t][e],"i"):new RegExp(e.replace(new RegExp("/","g"),""),"i")}},r=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},a=function(e,r){var a=r||t;return i[e]=e,"object"==typeof e?e instanceof Array?n.getFromArray(e,a):n.getFromObjectKeys(e,a):n.getFromKey(e,a)},s={buildFromMethodHash:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(e[t]=s[e[t]]());return e},timeZoneDST:function(){return a({CHADT:"+1345",NZDT:"+1300",AEDT:"+1100",ACDT:"+1030",AZST:"+0500",IRDT:"+0430",EEST:"+0300",CEST:"+0200",BST:"+0100",PMDT:"-0200",ADT:"-0300",NDT:"-0230",EDT:"-0400",CDT:"-0500",MDT:"-0600",PDT:"-0700",AKDT:"-0800",HADT:"-0900"})},timeZoneStandard:function(){return a({LINT:"+1400",TOT:"+1300",CHAST:"+1245",NZST:"+1200",NFT:"+1130",SBT:"+1100",AEST:"+1000",ACST:"+0930",JST:"+0900",CWST:"+0845",CT:"+0800",ICT:"+0700",MMT:"+0630",BST:"+0600",NPT:"+0545",IST:"+0530",PKT:"+0500",AFT:"+0430",MSK:"+0400",IRST:"+0330",FET:"+0300",EET:"+0200",CET:"+0100",GMT:"+0000",UTC:"+0000",CVT:"-0100",GST:"-0200",BRT:"-0300",NST:"-0330",AST:"-0400",EST:"-0500",CST:"-0600",MST:"-0700",PST:"-0800",AKST:"-0900",MIT:"-0930",HST:"-1000",SST:"-1100",BIT:"-1200"})},timeZones:function(e){var t;e.timezones=[];for(t in e.abbreviatedTimeZoneStandard)e.abbreviatedTimeZoneStandard.hasOwnProperty(t)&&e.timezones.push({name:t,offset:e.abbreviatedTimeZoneStandard[t]});for(t in e.abbreviatedTimeZoneDST)e.abbreviatedTimeZoneDST.hasOwnProperty(t)&&e.timezones.push({name:t,offset:e.abbreviatedTimeZoneDST[t],dst:!0});return e.timezones},days:function(){return a(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"])},dayAbbr:function(){return a(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"])},dayShortNames:function(){return a(["Su","Mo","Tu","We","Th","Fr","Sa"])},dayFirstLetters:function(){return a(["S_Sun_Initial","M_Mon_Initial","T_Tues_Initial","W_Wed_Initial","T_Thu_Initial","F_Fri_Initial","S_Sat_Initial"])},months:function(){return a(["January","February","March","April","May","June","July","August","September","October","November","December"])},monthAbbr:function(){return a(["Jan_Abbr","Feb_Abbr","Mar_Abbr","Apr_Abbr","May_Abbr","Jun_Abbr","Jul_Abbr","Aug_Abbr","Sep_Abbr","Oct_Abbr","Nov_Abbr","Dec_Abbr"])},formatPatterns:function(){return n.getFromObjectValues({shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss",monthDay:"MMMM dd",monthDayShortTime:"MM/dd",monthDayYear:"MM/dd/yy",yearMonth:"MMMM, yyyy"},Date.i18n.currentLanguage())},regex:function(){return n.getFromObjectValues({thisMorning:"/(this )(morn(ing)?)\\b/",thisEvening:"/(this )(even(ing)?)\\b/",jan:"/jan(uary)?/",feb:"/feb(ruary)?/",mar:"/mar(ch)?/",apr:"/apr(il)?/",may:"/may/",jun:"/jun(e)?/",jul:"/jul(y)?/",aug:"/aug(ust)?/",sep:"/sep(t(ember)?)?/",oct:"/oct(ober)?/",nov:"/nov(ember)?/",dec:"/dec(ember)?/",sun:"/^sun(day)?/",mon:"/^mon(day)?/",tue:"/^tue(s(day)?)?/",wed:"/^wed(nesday)?/",thu:"/^thu(rsday)?/",fri:"/^fri(day)?/",sat:"/^sat(urday)?/",future:"/^next/",past:"/^last|past|prev(ious)?/",yesterday:"/^yesterday/",today:"/^today/",tomorrow:"/^tom(orrow)?/",soon:"/^soon/",later:"/^later/",someday:"/^someday/",now:"/^now/",shortMeridian:"/^(a|p)/",longMeridian:"/^(a\\.?m?\\.?|p\\.?m?\\.?)/",timezone:"/^((e(s|d)t|c(e?s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\\s*(\\+|\\-)\\s*\\d\\d\\d\\d?)|gmt|utc)/",ordinalSuffix:"/^\\s*(st|nd|rd|th)/",timeContext:"/^\\s*(\\:|a(?!u|p)|p)/"},Date.i18n.currentLanguage())}},o=function(){var e=n.getFromObjectValues({name:"name",englishName:"englishName",nativeName:"nativeName",amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:"firstDayOfWeek",twoDigitYearMax:"twoDigitYearMax",dateElementOrder:"mdy"},Date.i18n.currentLanguage()),t=s.buildFromMethodHash({dayNames:"days",abbreviatedDayNames:"dayAbbr",shortestDayNames:"dayShortNames",firstLetterDayNames:"dayFirstLetters",monthNames:"months",abbreviatedMonthNames:"monthAbbr",formatPatterns:"formatPatterns",regexPatterns:"regex",abbreviatedTimeZoneDST:"timeZoneDST",abbreviatedTimeZoneStandard:"timeZoneStandard"});return r(e,t),s.timeZones(e),e};e.i18n={__:function(e,t){return a(e,t)},currentLanguage:function(){return t||"en-US"},setLanguage:function(i,n,r){if(n||"en-US"===i||Date.CultureStrings&&Date.CultureStrings[i])t=i,Date.CultureStrings=Date.CultureStrings||{},Date.CultureStrings.lang=i,Date.CultureInfo=new o;else if(!Date.CultureStrings||!Date.CultureStrings[i])return!1;e.Parsing.Normalizer.buildReplaceData(),e.Grammar&&e.Grammar.buildGrammarFormats(),r&&r()},getLoggedKeys:function(){return i},updateCultureInfo:function(){Date.CultureInfo=new o}},e.i18n.updateCultureInfo()}(),function(){var e=Date,t=e.prototype,i=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};"undefined"!=typeof window&&void 0!==window.console&&void 0!==window.console.log?e.console=console:e.console={log:function(){},error:function(){}},e.Config=e.Config||{},e.initOverloads=function(){e.now?e._now||(e._now=e.now):e._now=function(){return(new Date).getTime()},e.now=function(t){return t?e.present():e._now()},t.toISOString||(t.toISOString=function(){return this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}),void 0===t._toString&&(t._toString=t.toString)},e.initOverloads(),e.today=function(){return(new Date).clearTime()},e.present=function(){return new Date},e.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return e<t?-1:e>t?1:0;throw new TypeError(e+" - "+t)},e.equals=function(e,t){return 0===e.compareTo(t)},e.getDayName=function(e){return Date.CultureInfo.dayNames[e]},e.getDayNumberFromName=function(e){for(var t=Date.CultureInfo.dayNames,i=Date.CultureInfo.abbreviatedDayNames,n=Date.CultureInfo.shortestDayNames,r=e.toLowerCase(),a=0;a<t.length;a++)if(t[a].toLowerCase()===r||i[a].toLowerCase()===r||n[a].toLowerCase()===r)return a;return-1},e.getMonthNumberFromName=function(e){for(var t=Date.CultureInfo.monthNames,i=Date.CultureInfo.abbreviatedMonthNames,n=e.toLowerCase(),r=0;r<t.length;r++)if(t[r].toLowerCase()===n||i[r].toLowerCase()===n)return r;return-1},e.getMonthName=function(e){return Date.CultureInfo.monthNames[e]},e.isLeapYear=function(e){return e%4==0&&e%100!=0||e%400==0},e.getDaysInMonth=function(t,i){return!i&&e.validateMonth(t)&&(i=t,t=Date.today().getFullYear()),[31,e.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][i]},t.getDaysInMonth=function(){return e.getDaysInMonth(this.getFullYear(),this.getMonth())},e.getTimezoneAbbreviation=function(e,t){var i,n=t?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(i in n)if(n.hasOwnProperty(i)&&n[i]===e)return i;return null},e.getTimezoneOffset=function(e,t){var i,n=[],r=Date.CultureInfo.timezones;for(e||(e=(new Date).getTimezone()),i=0;i<r.length;i++)r[i].name===e.toUpperCase()&&n.push(i);if(!r[n[0]])return null;if(1===n.length||!t)return r[n[0]].offset;for(i=0;i<n.length;i++)if(r[n[i]].dst)return r[n[i]].offset},e.getQuarter=function(e){return e=e||new Date,[1,2,3,4][Math.floor(e.getMonth()/3)]},e.getDaysLeftInQuarter=function(e){e=e||new Date;var t=new Date(e);return t.setMonth(t.getMonth()+3-t.getMonth()%3,0),Math.floor((t-e)/864e5)},t.ensureTimeOfDay=function(){0===this.getMilliseconds()&&this.setTime(this.getTime()+1)};var n=function(e,t,i,n){if(n=n||"Object",void 0===e)return!1;if("number"!=typeof e)throw new TypeError(e+" is not a Number.");return!(e<t||e>i)};e.validateMillisecond=function(e){return n(e,0,999,"millisecond")},e.validateSecond=function(e){return n(e,0,59,"second")},e.validateMinute=function(e){return n(e,0,59,"minute")},e.validateHour=function(e){return n(e,0,23,"hour")},e.validateDay=function(t,i,r){return void 0!==i&&null!==i&&void 0!==r&&null!==r&&n(t,1,e.getDaysInMonth(i,r),"day")},e.validateWeek=function(e){return n(e,0,53,"week")},e.validateMonth=function(e){return n(e,0,11,"month")},e.validateYear=function(e){return n(e,-271822,275760,"year")},e.validateTimezone=function(e){return 1==={ACDT:1,ACST:1,ACT:1,ADT:1,AEDT:1,AEST:1,AFT:1,AKDT:1,AKST:1,AMST:1,AMT:1,ART:1,AST:1,AWDT:1,AWST:1,AZOST:1,AZT:1,BDT:1,BIOT:1,BIT:1,BOT:1,BRT:1,BST:1,BTT:1,CAT:1,CCT:1,CDT:1,CEDT:1,CEST:1,CET:1,CHADT:1,CHAST:1,CHOT:1,ChST:1,CHUT:1,CIST:1,CIT:1,CKT:1,CLST:1,CLT:1,COST:1,COT:1,CST:1,CT:1,CVT:1,CWST:1,CXT:1,DAVT:1,DDUT:1,DFT:1,EASST:1,EAST:1,EAT:1,ECT:1,EDT:1,EEDT:1,EEST:1,EET:1,EGST:1,EGT:1,EIT:1,EST:1,FET:1,FJT:1,FKST:1,FKT:1,FNT:1,GALT:1,GAMT:1,GET:1,GFT:1,GILT:1,GIT:1,GMT:1,GST:1,GYT:1,HADT:1,HAEC:1,HAST:1,HKT:1,HMT:1,HOVT:1,HST:1,ICT:1,IDT:1,IOT:1,IRDT:1,IRKT:1,IRST:1,IST:1,JST:1,KGT:1,KOST:1,KRAT:1,KST:1,LHST:1,LINT:1,MAGT:1,MART:1,MAWT:1,MDT:1,MET:1,MEST:1,MHT:1,MIST:1,MIT:1,MMT:1,MSK:1,MST:1,MUT:1,MVT:1,MYT:1,NCT:1,NDT:1,NFT:1,NPT:1,NST:1,NT:1,NUT:1,NZDT:1,NZST:1,OMST:1,ORAT:1,PDT:1,PET:1,PETT:1,PGT:1,PHOT:1,PHT:1,PKT:1,PMDT:1,PMST:1,PONT:1,PST:1,PYST:1,PYT:1,RET:1,ROTT:1,SAKT:1,SAMT:1,SAST:1,SBT:1,SCT:1,SGT:1,SLST:1,SRT:1,SST:1,SYOT:1,TAHT:1,THA:1,TFT:1,TJT:1,TKT:1,TLT:1,TMT:1,TOT:1,TVT:1,UCT:1,ULAT:1,UTC:1,UYST:1,UYT:1,UZT:1,VET:1,VLAT:1,VOLT:1,VOST:1,VUT:1,WAKT:1,WAST:1,WAT:1,WEDT:1,WEST:1,WET:1,WST:1,YAKT:1,YEKT:1,Z:1}[e]},e.validateTimezoneOffset=function(e){return e>-841&&e<721},e.validateSetExplicitTime=function(e){return!0}}(),function(){var e=Date,t=e.prototype,i=function(e,t){return t||(t=2),("000"+e).slice(-1*t)},n=function(t){var i,n,r={},a=this;n=function(i,n,r){if("day"===i){var s=void 0!==t.month?t.month:a.getMonth(),o=void 0!==t.year?t.year:a.getFullYear();return e[n](r,o,s)}return e[n](r)};for(i in t)if(hasOwnProperty.call(t,i)){var s="validate"+i.charAt(0).toUpperCase()+i.slice(1);e[s]&&null!==t[i]&&n(i,s,t[i])&&(r[i]=t[i])}return r};t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},t.clone=function(){return new Date(this.getTime())},t.compareTo=function(e){return Date.compare(this,e)},t.equals=function(e){if(!e)return!1;var t=this.clone(),i=e.clone();return t.setMilliseconds(0),i.setMilliseconds(0),Date.equals(t,i)},t.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},t.isAfter=function(e){return 1===this.compareTo(e||new Date)},t.isBefore=function(e){return-1===this.compareTo(e||new Date)},t.isToday=t.isSameDay=function(e){return this.clone().clearTime().equals((e||new Date).clone().clearTime())},t.addMilliseconds=function(e){return e?(this.setTime(this.getTime()+1*e),this):this},t.addSeconds=function(e){return e?this.addMilliseconds(1e3*e):this},t.addMinutes=function(e){return e?this.addMilliseconds(6e4*e):this},t.addHours=function(e){return e?this.addMilliseconds(36e5*e):this},t.addDays=function(e){return e?(this.setDate(this.getDate()+1*e),this):this},t.addWeekdays=function(e){if(!e)return this;var t=this.getDay(),i=Math.ceil(Math.abs(e)/7);if(0!==t&&6!==t||e>0&&(this.next().monday(),this.addDays(-1),t=this.getDay()),e<0){for(;e<0;)this.addDays(-1),0!==(t=this.getDay())&&6!==t&&e++;return this}return(e>5||6-t<=e)&&(e+=2*i),this.addDays(e)},t.addWeeks=function(e){return e?this.addDays(7*e):this},t.addMonths=function(t){if(!t)return this;var i=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+1*t),this.setDate(Math.min(i,e.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addQuarters=function(e){return e?this.addMonths(3*e):this},t.addYears=function(e){return e?this.addMonths(12*e):this},t.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return t.day&&t.day-this.getDate()!=0&&this.setDate(t.day),t.milliseconds&&this.addMilliseconds(t.milliseconds),t.seconds&&this.addSeconds(t.seconds),t.minutes&&this.addMinutes(t.minutes),t.hours&&this.addHours(t.hours),t.weeks&&this.addWeeks(t.weeks),t.months&&this.addMonths(t.months),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),t.setExplicitTime&&this.ensureTimeOfDay(),this},t.getWeek=function(e){var t,i=new Date(this.valueOf());e?(i.addMinutes(i.getTimezoneOffset()),t=i.clone()):t=this;var n=(t.getDay()+6)%7;i.setDate(i.getDate()-n+3);var r=i.valueOf();return i.setMonth(0,1),4!==i.getDay()&&i.setMonth(0,1+(4-i.getDay()+7)%7),1+Math.ceil((r-i)/6048e5)},t.getISOWeek=function(){return i(this.getWeek(!0))},t.setWeek=function(e){return e-this.getWeek()==0?1!==this.getDay()?this.moveToDayOfWeek(1,this.getDay()>1?-1:1):this:this.moveToDayOfWeek(1,this.getDay()>1?-1:1).addWeeks(e-this.getWeek())},t.setQuarter=function(e){var t=Math.abs(3*(e-1)+1);return this.setMonth(t,1)},t.getQuarter=function(){return Date.getQuarter(this)},t.getDaysLeftInQuarter=function(){return Date.getDaysLeftInQuarter(this)},t.moveToNthOccurrence=function(e,t){if("Weekday"===e){if(t>0)this.moveToFirstDayOfMonth(),this.is().weekday()&&(t-=1);else{if(!(t<0))return this;this.moveToLastDayOfMonth(),this.is().weekday()&&(t+=1)}return this.addWeekdays(t)}var i=0;if(t>0)i=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(i)};var r=function(e,t,i){return function(n,r){var a=(n-this[e]()+i*(r||1))%i;return this[t](0===a?a+=i*(r||1):a)}};t.moveToDayOfWeek=r("getDay","addDays",7),t.moveToMonth=r("getMonth","addMonths",12),t.getOrdinate=function(){var e=this.getDate();return a(e)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset(),this.isDaylightSavingTime())},t.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),i=-6*Number(e)/10;return i||0===i?this.addMinutes(t-i):this},t.setTimezone=function(t){return this.setTimezoneOffset(e.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==this.getTimezoneOffset()},t.getUTCOffset=function(e){var t,i=-10*(e||this.getTimezoneOffset())/6;return i<0?(t=(i-1e4).toString(),t.charAt(0)+t.substr(2)):(t=(i+1e4).toString(),"+"+t.substr(1))},t.getElapsed=function(e){return(e||new Date)-this},t.set=function(e){e=n.call(this,e);var t;for(t in e)if(hasOwnProperty.call(e,t)){var i,r,a=t.charAt(0).toUpperCase()+t.slice(1);"week"!==t&&"month"!==t&&"timezone"!==t&&"timezoneOffset"!==t&&(a+="s"),i="add"+a,r="get"+a,"month"===t?i+="s":"year"===t&&(r="getFullYear"),"day"!==t&&"timezone"!==t&&"timezoneOffset"!==t&&"week"!==t&&"hour"!==t&&"setExplicitTime"!==t?this[i](e[t]-this[r]()):"timezone"===t||"timezoneOffset"===t||"week"===t||"hour"===t?this["set"+a](e[t]):"setExplicitTime"===t&&this.ensureTimeOfDay()}return e.day&&this.addDays(e.day-this.getDate()),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})};var a=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},s=function(e){var t,i=Date.CultureInfo.formatPatterns;switch(e){case"d":return this.toString(i.shortDate);case"D":return this.toString(i.longDate);case"F":return this.toString(i.fullDateTime);case"m":return this.toString(i.monthDay);case"r":case"R":return t=this.clone().addMinutes(this.getTimezoneOffset()),t.toString(i.rfc1123)+" GMT";case"s":return this.toString(i.sortableDateTime);case"t":return this.toString(i.shortTime);case"T":return this.toString(i.longTime);case"u":return t=this.clone().addMinutes(this.getTimezoneOffset()),t.toString(i.universalSortableDateTime);case"y":return this.toString(i.yearMonth);default:return!1}},o=function(t){return function(n){if("\\"===n.charAt(0))return n.replace("\\","");switch(n){case"hh":return i(t.getHours()<13?0===t.getHours()?12:t.getHours():t.getHours()-12);case"h":return t.getHours()<13?0===t.getHours()?12:t.getHours():t.getHours()-12;case"HH":return i(t.getHours());case"H":return t.getHours();case"mm":return i(t.getMinutes());case"m":return t.getMinutes();case"ss":return i(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return i(t.getFullYear(),4);case"yy":return i(t.getFullYear());case"y":return t.getFullYear();case"E":case"dddd":return Date.CultureInfo.dayNames[t.getDay()];case"ddd":return Date.CultureInfo.abbreviatedDayNames[t.getDay()];case"dd":return i(t.getDate());case"d":return t.getDate();case"MMMM":return Date.CultureInfo.monthNames[t.getMonth()];case"MMM":return Date.CultureInfo.abbreviatedMonthNames[t.getMonth()];case"MM":return i(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"S":return a(t.getDate());case"W":return t.getWeek();case"WW":return t.getISOWeek();case"Q":return"Q"+t.getQuarter();case"q":return String(t.getQuarter());case"z":return t.getTimezone();case"Z":case"X":return Date.getTimezoneOffset(t.getTimezone());case"ZZ":return-60*t.getTimezoneOffset();case"u":return t.getDay();case"L":return e.isLeapYear(t.getFullYear())?1:0;case"B":return"@"+(t.getUTCSeconds()+60*t.getUTCMinutes()+3600*(t.getUTCHours()+1))/86.4;default:return n}}};t.toString=function(e,t){if(!t&&e&&1===e.length){var i=s.call(this,e);if(i)return i}var n=o(this);return e?e.replace(/((\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S|q|Q|WW?W?W?)(?![^\[]*\]))/g,n).replace(/\[|\]/g,""):this._toString()}}(),function(){var e=Date,t=e.prototype,i=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._isSecond=!1,i._dateElement="days",t.next=function(){return this._move=!0,this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._move=!0,this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return this._nth?l("Weekday").call(this):this._move?this.addWeekdays(this._orient):!!this._is&&(this._is=!1,!this.is().sat()&&!this.is().sun())},t.weekend=function(){return!!this._is&&(this._is=!1,this.is().sat()||this.is().sun())},t.at=function(t){return"string"==typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},i.fromNow=i.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},i.ago=i.before=function(e){var t={};return t["s"!==this._dateElement[this._dateElement.length-1]?this._dateElement+"s":this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var n,r="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),a="january february march april may june july august september october november december".split(/\s/),s=[],o=[],c="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<s.length;t++)this["get"+o[t]]&&(e[s[t].toLowerCase()]=this["get"+o[t]]());return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};var l=function(t){return function(){if(this._is)return this._is=!1,this.getDay()===t;if(this._move&&(this._move=null),null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var i=this._nth;this._nth=null;var n=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,i),this>n)throw new RangeError(e.getDayName(t)+" does not occur "+i+" times in the month of "+e.getMonthName(n.getMonth())+" "+n.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},d=function(t){return function(){var i=e.today(),n=t-i.getDay();return(0===t&&1===Date.CultureInfo.firstDayOfWeek&&0!==i.getDay()||n<0)&&(n+=7),i.addDays(n)}},h=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},u=function(t){return function(){return e.today().set({month:t,day:1})}},p=function(i,n,r){for(var a=0;a<i.length;a++)e[i[a].toUpperCase()]=e[i[a].toUpperCase().substring(0,3)]=a,e[i[a]]=e[i[a].substring(0,3)]=n(a),t[i[a]]=t[i[a].substring(0,3)]=r(a)};p(r,d,l),p(a,u,h);for(var m=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;var t=this.toObject(),i=(arguments[0]||new Date).toObject(),n="",r=e.toLowerCase();r="s"===r[r.length-1]?r.substring(0,r.length-1):r;for(var a=s.length-1;a>-1;a--){if(n=s[a].toLowerCase(),t[n]!==i[n])return!1;if(r===n)break}return!0}return"s"!==e.substring(e.length-1)&&(e+="s"),this._move&&(this._move=null),this["add"+e](this._orient)}},f=0;f<s.length;f++)"weekday"!==(n=s[f].toLowerCase())&&(t[n]=t[n+"s"]=m(s[f]),i[n]=i[n+"s"]=function(e){return function(){return this._dateElement=e,this}}(n+"s"));t._ss=m("Second");for(var g=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},v=0;v<c.length;v++)t[c[v]]=g(0===v?-1:v)}(),function(){"use strict";Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};var e=Date.Parsing,t={standard:[0,31,59,90,120,151,181,212,243,273,304,334],leap:[0,31,60,91,121,152,182,213,244,274,305,335]};e.isLeapYear=function(e){return e%4==0&&e%100!=0||e%400==0};var i={multiReplace:function(e,t){var i;for(i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n;"function"==typeof t[i]||(n=t[i]instanceof RegExp?t[i]:new RegExp(t[i],"g")),e=e.replace(n,i)}return e},getDayOfYearFromWeek:function(e){var t,i,n;return e.weekDay=e.weekDay||0===e.weekDay?e.weekDay:1,t=new Date(e.year,0,4),i=0===t.getDay()?7:t.getDay(),n=i+3,e.dayOfYear=7*e.week+(0===e.weekDay?7:e.weekDay)-n,e},getDayOfYear:function(e,t){e.dayOfYear||(e=i.getDayOfYearFromWeek(e));for(var n=0;n<=t.length;n++){if(e.dayOfYear<t[n]||n===t.length){e.day=e.day?e.day:e.dayOfYear-t[n-1];break}e.month=n}return e},adjustForTimeZone:function(e,t){var i;return"Z"===e.zone.toUpperCase()||0===e.zone_hours&&0===e.zone_minutes?i=-t.getTimezoneOffset():(i=60*e.zone_hours+(e.zone_minutes||0),"+"===e.zone_sign&&(i*=-1),i-=t.getTimezoneOffset()),t.setMinutes(t.getMinutes()+i),t},setDefaults:function(e){return e.year=e.year||Date.today().getFullYear(),e.hours=e.hours||0,e.minutes=e.minutes||0,e.seconds=e.seconds||0,e.milliseconds=e.milliseconds||0,(e.month||!e.week&&!e.dayOfYear)&&(e.month=e.month||0,e.day=e.day||1),e},dataNum:function(e,t,i,n){var r=1*e;return t?n?e?1*t(e):e:e?t(r):e:i?e&&void 0!==e?r:e:e?r:e},timeDataProcess:function(e){var t={};for(var n in e.data)e.data.hasOwnProperty(n)&&(t[n]=e.ignore[n]?e.data[n]:i.dataNum(e.data[n],e.mods[n],e.explict[n],e.postProcess[n]));return e.data.secmins&&(e.data.secmins=60*e.data.secmins.replace(",","."),t.minutes?t.seconds||(t.seconds=e.data.secmins):t.minutes=e.data.secmins,delete e.secmins),t},buildTimeObjectFromData:function(e){return i.timeDataProcess({data:{year:e[1],month:e[5],day:e[7],week:e[8],dayOfYear:e[10],hours:e[15],zone_hours:e[23],zone_minutes:e[24],zone:e[21],zone_sign:e[22],weekDay:e[9],minutes:e[16],seconds:e[19],milliseconds:e[20],secmins:e[18]},mods:{month:function(e){return e-1},weekDay:function(e){return e=Math.abs(e),7===e?0:e},minutes:function(e){return e.replace(":","")},seconds:function(e){return Math.floor(1*e.replace(":","").replace(",","."))},milliseconds:function(e){return 1e3*e.replace(",",".")}},postProcess:{minutes:!0,seconds:!0,milliseconds:!0},explict:{zone_hours:!0,zone_minutes:!0},ignore:{zone:!0,zone_sign:!0,secmins:!0}})},addToHash:function(e,t,i){t=t,i=i;for(var n=t.length,r=0;r<n;r++)e[t[r]]=i[r];return e},combineRegex:function(e,t){return new RegExp("(("+e.source+")\\s("+t.source+"))")},getDateNthString:function(e,t,i){return e?Date.today().addDays(i).toString("d"):t?Date.today().last()[i]().toString("d"):void 0},buildRegexData:function(e){for(var t=[],i=e.length,n=0;n<i;n++)Array.isArray(e[n])?t.push(this.combineRegex(e[n][0],e[n][1])):t.push(e[n]);return t}};e.processTimeObject=function(n){var r,a;return i.setDefaults(n),a=e.isLeapYear(n.year)?t.leap:t.standard,n.month||!n.week&&!n.dayOfYear?n.dayOfYear=a[n.month]+n.day:i.getDayOfYear(n,a),r=new Date(n.year,n.month,n.day,n.hours,n.minutes,n.seconds,n.milliseconds),n.zone&&i.adjustForTimeZone(n,r),r},e.Numeric={isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},regex:/\b([0-1]?[0-9])([0-3]?[0-9])([0-2]?[0-9]?[0-9][0-9])\b/i,parse:function(t){var i,n,r={},a=Date.CultureInfo.dateElementOrder.split("");if(!this.isNumeric(t)||"+"===t[0]&&"-"===t[0])return null;if(t.length<5&&t.indexOf(".")<0&&t.indexOf("/")<0)return r.year=t,e.processTimeObject(r);if(!(i=t.match(this.regex))||!i.length)return null;for(n=0;n<a.length;n++)switch(a[n]){case"d":r.day=i[n+1];break;case"m":r.month=i[n+1]-1;break;case"y":r.year=i[n+1]}return e.processTimeObject(r)}},e.Normalizer={
regexData:function(){var e=Date.CultureInfo.regexPatterns;return i.buildRegexData([e.tomorrow,e.yesterday,[e.past,e.mon],[e.past,e.tue],[e.past,e.wed],[e.past,e.thu],[e.past,e.fri],[e.past,e.sat],[e.past,e.sun]])},basicReplaceHash:function(){var e=Date.CultureInfo.regexPatterns;return{January:e.jan,February:e.feb,March:e.mar,April:e.apr,May:e.may,June:e.jun,July:e.jul,August:e.aug,September:e.sep,October:e.oct,November:e.nov,December:e.dec,"":/\bat\b/gi," ":/\s{2,}/,"9am":e.thisMorning,"7pm":e.thisEvening}},keys:function(){return[i.getDateNthString(!0,!1,1),i.getDateNthString(!0,!1,-1),i.getDateNthString(!1,!0,"monday"),i.getDateNthString(!1,!0,"tuesday"),i.getDateNthString(!1,!0,"wednesday"),i.getDateNthString(!1,!0,"thursday"),i.getDateNthString(!1,!0,"friday"),i.getDateNthString(!1,!0,"saturday"),i.getDateNthString(!1,!0,"sunday")]},buildRegexFunctions:function(){var e=Date.CultureInfo.regexPatterns,t=Date.i18n.__,i=new RegExp("(\\b\\d\\d?("+t("AM")+"|"+t("PM")+")? )("+e.tomorrow.source.slice(1)+")","i"),n=new RegExp(e.today.source+"(?!\\s*([+-]))\\b");this.replaceFuncs=[[n,function(e){return e.length>1?Date.today().toString("d"):e}],[i,function(e,t){return Date.today().addDays(1).toString("d")+" "+t}]]},buildReplaceData:function(){this.buildRegexFunctions(),this.replaceHash=i.addToHash(this.basicReplaceHash(),this.keys(),this.regexData())},stringReplaceFuncs:function(e){for(var t=0;t<this.replaceFuncs.length;t++)e=e.replace(this.replaceFuncs[t][0],this.replaceFuncs[t][1]);return e},parse:function(t){t=this.stringReplaceFuncs(t),t=i.multiReplace(t,this.replaceHash);try{var n=t.split(/([\s\-\.\,\/\x27]+)/);3===n.length&&e.Numeric.isNumeric(n[0])&&e.Numeric.isNumeric(n[2])&&n[2].length>=4&&"d"===Date.CultureInfo.dateElementOrder[0]&&(t="1/"+n[0]+"/"+n[2])}catch(e){}return t}},e.Normalizer.buildReplaceData()}(),function(){for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(i){var n=i.match(t);if(n)return[n[0],i.substring(n[0].length)];throw new e.Exception(i)}},token:function(){return function(e){return t.rtoken(new RegExp("^\\s*"+e+"\\s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var i=[],n=null;t.length;){try{n=e.call(this,t)}catch(e){i.push(n[0]),t=n[1];continue}break}return[i,t]}},many:function(e){return function(t){for(var i=[],n=null;t.length;){try{n=e.call(this,t)}catch(e){return[i,t]}i.push(n[0]),t=n[1]}return[i,t]}},optional:function(e){return function(t){var i=null;try{i=e.call(this,t)}catch(e){return[null,t]}return[i[0],i[1]]}},not:function(t){return function(i){try{t.call(this,i)}catch(e){return[null,i]}throw new e.Exception(i)}},ignore:function(e){return e?function(t){var i=null;return i=e.call(this,t),[null,i[1]]}:null},product:function(){for(var e=arguments[0],i=Array.prototype.slice.call(arguments,1),n=[],r=0;r<e.length;r++)n.push(t.each(e[r],i));return n},cache:function(t){var i={},n=0,r=[],a=Date.Config.CACHE_MAX||500,s=null,o=function(){if(n===a)for(var e=0;e<10;e++){var t=r.shift();t&&(delete i[t],n--)}};return function(a){o();try{s=i[a]=i[a]||t.call(this,a)}catch(e){s=i[a]=e}if(n++,r.push(a),s instanceof e.Exception)throw s;return s}},any:function(){var t=arguments;return function(i){for(var n=null,r=0;r<t.length;r++)if(null!=t[r]){try{n=t[r].call(this,i)}catch(e){n=null}if(n)return n}throw new e.Exception(i)}},each:function(){var t=arguments;return function(i){for(var n=[],r=null,a=0;a<t.length;a++)if(null!=t[a]){try{r=t[a].call(this,i)}catch(t){throw new e.Exception(i)}n.push(r[0]),i=r[1]}return[n,i]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(i,n,r){return n=n||t.rtoken(/^\s*/),r=r||null,1===i.length?i[0]:function(t){for(var a=null,s=null,o=[],c=0;c<i.length;c++){try{a=i[c].call(this,t)}catch(e){break}o.push(a[0]);try{s=n.call(this,a[1])}catch(e){s=null;break}t=s[1]}if(!a)throw new e.Exception(t);if(s)throw new e.Exception(s[1]);if(r)try{a=r.call(this,a[1])}catch(t){throw new e.Exception(a[1])}return[o,a?a[1]:t]}},between:function(e,i,n){n=n||e;var a=t.each(t.ignore(e),i,t.ignore(n));return function(e){var t=a.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,i,n){return i=i||t.rtoken(/^\s*/),n=n||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(i)),e.slice(-1),t.ignore(n)):t.each(t.many(t.each(e,t.ignore(i))),px,t.ignore(n))},set:function(i,n,r){return n=n||t.rtoken(/^\s*/),r=r||null,function(a){for(var s=null,o=null,c=null,l=null,d=[[],a],h=!1,u=0;u<i.length;u++){c=null,o=null,s=null,h=1===i.length;try{s=i[u].call(this,a)}catch(e){continue}if(l=[[s[0]],s[1]],s[1].length>0&&!h)try{c=n.call(this,s[1])}catch(e){h=!0}else h=!0;if(h||0!==c[1].length||(h=!0),!h){for(var p=[],m=0;m<i.length;m++)u!==m&&p.push(i[m]);o=t.set(p,n).call(this,c[1]),o[0].length>0&&(l[0]=l[0].concat(o[0]),l[1]=o[1])}if(l[1].length<d[1].length&&(d=l),0===d[1].length)break}if(0===d[0].length)return d;if(r){try{c=r.call(this,d[1])}catch(t){throw new e.Exception(d[1])}d[1]=c[1]}return d}},forward:function(e,t){return function(i){return e[t].call(this,i)}},replace:function(e,t){return function(i){var n=e.call(this,i);return[t,n[1]]}},process:function(e,t){return function(i){var n=e.call(this,i);return[t.call(this,n[0]),n[1]]}},min:function(t,i){return function(n){var r=i.call(this,n);if(r[0].length<t)throw new e.Exception(n);return r}}},i="optional not ignore cache".split(/\s/),n=0;n<i.length;n++)t[i[n]]=function(e){function t(){var t,i=null,n=[];return arguments.length>1?i=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(i=arguments[0]),i?(t=i.shift(),t.length>0?(i.unshift(t[void 0]),n.push(e.apply(null,i)),i.shift(),n):void 0):e.apply(null,arguments)}return t}(t[i[n]]);for(var a="each any all".split(/\s/),s=0;s<a.length;s++)t[a[s]]=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}}(t[a[s]])}(),function(){var e=Date,t=function(e){for(var i=[],n=0;n<e.length;n++)e[n]instanceof Array?i=i.concat(t(e[n])):e[n]&&i.push(e[n]);return i},i=function(){if(this.meridian&&(this.hour||0===this.hour)){if("a"===this.meridian&&this.hour>11&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";if("p"===this.meridian&&this.hour<12&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";"p"===this.meridian&&this.hour<12?this.hour=this.hour+12:"a"===this.meridian&&12===this.hour&&(this.hour=0)}else this.meridian||!this.hour&&0!==this.hour||this.hour<8&&(this.hour=this.hour+12)},n=function(){var e=new Date;!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=e.getDate()),this.year||(this.year=e.getFullYear(),this.month<e.getMonth()&&this.year++),this.month||0===this.month||(this.month=e.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.millisecond||(this.millisecond=0)},r={getToday:function(){return this.now||-1!=="hour minute second".indexOf(this.unit)?new Date:e.today()},setDaysFromWeekday:function(t,i){var n;return i=i||1,this.unit="day",n=e.getDayNumberFromName(this.weekday)-t.getDay(),this.days=n?n+7*i:7*i,this},setMonthsFromMonth:function(e,t){var i;return t=t||1,this.unit="month",i=this.month-e.getMonth(),this.months=i?(i+12*t)%12:12*t,this.month=null,this},setDMYFromWeekday:function(){var e=Date[this.weekday]();return this.day=e.getDate(),this.month||(this.month=e.getMonth()),this.year=e.getFullYear(),this},setUnitValue:function(e){!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"===this.operator?1:-1)+(this.value||0)*e:null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),this[this.unit+"s"]=this.value*e)},generateDateFromWeeks:function(){var e=void 0!==this.weekday?this.weekday:"today",t=Date[e]().addWeeks(this.weeks);return this.now&&t.setTimeToNow(),t}};e.Translator={hour:function(e){return function(){this.hour=Number(e),this.setExplicitTime=!0}},minute:function(e){return function(){this.minute=Number(e),this.setExplicitTime=!0}},second:function(e){return function(){this.second=Number(e),this.setExplicitTime=!0}},secondAndMillisecond:function(e){return function(){var t=e.match(/^([0-5][0-9])\.([0-9]{1,3})/);this.second=Number(t[1]),this.millisecond=Number(t[2]),this.setExplicitTime=!0}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase(),this.setExplicitTime=!0}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){if(this.day=Number(t.match(/\d+/)[0]),this.day<1)throw"invalid day"}},month:function(e){return function(){if(this.month=3===e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1,this.month<0)throw"invalid month"}},year:function(e){return function(){var t=Number(e);this.year=e.length>2?t:t+(t+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"someday":this.days=14;break;case"later":this.days=5;break;case"soon":this.days=2;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){var r;t=t instanceof Array?t:[t];for(var a=0;a<t.length;a++)t[a]&&t[a].call(this);if(n.call(this),i.call(this),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");return r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond),this.setExplicitTime&&r.ensureTimeOfDay(),this.year<100&&r.setFullYear(this.year),this.timezone?r.set({timezone:this.timezone}):this.timezoneOffset&&r.set({timezoneOffset:this.timezoneOffset}),r},finish:function(n){var a,s,o,c;if(n=n instanceof Array?t(n):[n],0===n.length)return null;for(var l=0;l<n.length;l++)"function"==typeof n[l]&&n[l].call(this);if(this.now&&!this.unit&&!this.operator)return new Date;if(a=r.getToday.call(this),givenYear=!!this.year,s=!!(this.days&&null!==this.days||this.orient||this.operator),o="past"===this.orient||"subtract"===this.operator?-1:1,this.month&&"week"===this.unit&&(this.value=this.month+1,delete this.month,delete this.day),!this.month&&0!==this.month||-1==="year day hour minute second".indexOf(this.unit)||(this.value||(this.value=this.month+1),this.month=null,s=!0),s||!this.weekday||this.day||this.days||r.setDMYFromWeekday.call(this),s&&this.weekday&&"month"!==this.unit&&"week"!==this.unit&&r.setDaysFromWeekday.call(this,a,o),!this.weekday||"week"===this.unit||this.day||this.days||(c=Date[this.weekday](),this.day=c.getDate(),c.getMonth()!==a.getMonth()&&(this.month=c.getMonth())),this.month&&"day"===this.unit&&this.operator&&(this.value||(this.value=this.month+1),this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(a.set({day:1*this.value}),s||(this.day=1*this.value)),this.month||!this.value||"month"!==this.unit||this.now||(this.month=this.value,s=!0),s&&(this.month||0===this.month)&&"year"!==this.unit&&r.setMonthsFromMonth.call(this,a,o),this.unit||(this.unit="day"),r.setUnitValue.call(this,o),i.call(this),!this.month&&0!==this.month||this.day||(this.day=1),!this.orient&&!this.operator&&"week"===this.unit&&this.value&&!this.day&&!this.month)return Date.today().setWeek(this.value);if("week"===this.unit&&this.weeks&&!this.day&&!this.month)return r.generateDateFromWeeks.call(this);if(s&&this.timezone&&this.day&&this.days&&(this.day=this.days),!givenYear&&this.month<a.getMonth()&&(this.year=a.getFullYear()+1),s&&(this.hour||this.minute||this.second)&&(this.hours=this.hour,this.minutes=this.minute,this.seconds=this.second),s?a.add(this):a.set(this),this.timezone){this.timezone=this.timezone.toUpperCase();var d=e.getTimezoneOffset(this.timezone);a.hasDaylightSavingTime()&&e.getTimezoneAbbreviation(d,a.isDaylightSavingTime())!==this.timezone&&(a.isDaylightSavingTime()?a.addHours(-1):a.addHours(1)),a.setTimezoneOffset(d)}return a}}}(),function(){var e=Date;e.Grammar={};var t,i=e.Parsing.Operators,n=e.Grammar,r=e.Translator;t=function(){return i.each(i.any.apply(null,arguments),i.not(n.ctoken2("timeContext")))},n.datePartDelimiter=i.rtoken(/^([\s\-\.\,\/\x27]+)/),n.timePartDelimiter=i.stoken(":"),n.whiteSpace=i.rtoken(/^\s*/),n.generalDelimiter=i.rtoken(/^(([\s\,]|at|@|on)+)/);var a={};n.ctoken=function(e){var t=a[e];if(!t){for(var n=Date.CultureInfo.regexPatterns,r=e.split(/\s+/),s=[],o=0;o<r.length;o++)s.push(i.replace(i.rtoken(n[r[o]]),r[o]));t=a[e]=i.any.apply(null,s)}return t},n.ctoken2=function(e){return i.rtoken(Date.CultureInfo.regexPatterns[e])};var s=function(e,t,r,a){n[e]=a?i.cache(i.process(i.each(i.rtoken(t),i.optional(n.ctoken2(a))),r)):i.cache(i.process(i.rtoken(t),r))},o=function(e,t){return i.cache(i.process(n.ctoken2(e),t))},c={},l=function(e){return c[e]=c[e]||n.format(e)[0],c[e]};n.allformats=function(e){var t=[];if(e instanceof Array)for(var i=0;i<e.length;i++)t.push(l(e[i]));else t.push(l(e));return t},n.formats=function(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(l(e[n]));return i.any.apply(null,t)}return l(e)};var d={timeFormats:function(){var e,t=["h","hh","H","HH","m","mm","s","ss","ss.s","z","zz"],a=[/^(0[0-9]|1[0-2]|[1-9])/,/^(0[0-9]|1[0-2])/,/^([0-1][0-9]|2[0-3]|[0-9])/,/^([0-1][0-9]|2[0-3])/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^[0-5][0-9]\.[0-9]{1,3}/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/],c=[r.hour,r.hour,r.hour,r.hour,r.minute,r.minute,r.second,r.second,r.secondAndMillisecond,r.timezone,r.timezone];for(e=0;e<t.length;e++)s(t[e],a[e],c[e]);n.hms=i.cache(i.sequence([n.H,n.m,n.s],n.timePartDelimiter)),n.t=o("shortMeridian",r.meridian),n.tt=o("longMeridian",r.meridian),n.zzz=o("timezone",r.timezone),n.timeSuffix=i.each(i.ignore(n.whiteSpace),i.set([n.tt,n.zzz])),n.time=i.each(i.optional(i.ignore(i.stoken("T"))),n.hms,n.timeSuffix)},dateFormats:function(){s("d",/^([0-2]\d|3[0-1]|\d)/,r.day,"ordinalSuffix"),s("dd",/^([0-2]\d|3[0-1])/,r.day,"ordinalSuffix"),n.rday=i.cache(i.process(n.ctoken("yesterday tomorrow soon later someday today now"),r.rday)),n.ddd=n.dddd=i.cache(i.process(n.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),s("M",/^(1[0-2]|0\d|\d)/,r.month),s("MM",/^(1[0-2]|0\d)/,r.month),n.MMM=n.MMMM=i.cache(i.process(n.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),r.month)),s("y",/^(\d+)/,r.year),s("yy",/^(\d\d)/,r.year),s("yyy",/^(\d\d?\d?\d?)/,r.year),s("yyyy",/^(\d\d\d\d)/,r.year),n.day=t(n.d,n.dd),n.month=t(n.M,n.MMM),n.year=t(n.yyyy,n.yy);var e=function(){return i.set(arguments,n.datePartDelimiter)};n.mdy=e(n.ddd,n.month,n.day,n.year),n.ymd=e(n.ddd,n.year,n.month,n.day),n.dmy=e(n.ddd,n.day,n.month,n.year),n.date=function(e){return(n[Date.CultureInfo.dateElementOrder]||n.mdy).call(this,e)}},relative:function(){n.orientation=i.process(n.ctoken("past future"),function(e){return function(){this.orient=e}}),n.operator=i.process(n.ctoken("add subtract"),function(e){return function(){this.operator=e}})}};n.buildGrammarFormats=function(){a={},d.timeFormats(),d.dateFormats(),d.relative(),n.value=i.process(i.rtoken(/^([-+]?\d+)?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),n.expression=i.set([n.rday,n.time,n.value,n.orientation,n.ddd,n.MMM]),n.format=i.process(i.many(i.any(i.process(i.rtoken(/^(dd?d?d?(?!e)|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(n[t])return n[t];throw e.Parsing.Exception(t)}),i.process(i.rtoken(/^[^dMyhHmstz]+/),function(e){return i.ignore(i.stoken(e))}))),function(e){return i.process(i.each.apply(null,e),r.finishExact)}),n._start=i.process(i.set([n.date,n.expression,n.time],n.generalDelimiter,n.whiteSpace),r.finish)},n.buildGrammarFormats(),n._formats=n.formats(["M-d H","ddd H"]),n.start=function(e){try{var t=n._formats.call({},e);if(0===t[1].length)return t}catch(e){}return n._start.call({},e)}}(),function(){function e(e){var n;return e?e instanceof Date?e.clone():(e.length>=4&&"0"!==e.charAt(0)&&"+"!==e.charAt(0)&&"-"!==e.charAt(0)&&(n=t.Parsing.Numeric.parse(e)),n instanceof Date&&!isNaN(n.getTime())?n:(e=t.Parsing.Normalizer.parse(i.removeOrds(e)),n=i.grammarParser(e))):null}var t=Date,i={removeOrds:function(e){var t=e.match(/\b(\d+)(?:st|nd|rd|th)\b/);return e=t&&2===t.length?e.replace(t[0],t[1]):e},grammarParser:function(e){var i=null;try{i=t.Grammar.start.call({},e.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(e){return null}return 0===i[1].length?i[0]:null}};t._parse||(t._parse=t.parse),t.parse=e,Date.getParseFunction=function(e){var t=Date.Grammar.allformats(e);return function(e){for(var i=null,n=0;n<t.length;n++){try{i=t[n].call({},e)}catch(e){continue}if(0===i[1].length)return i[0]}return null}},t.parseExact=function(e,i){return t.getParseFunction(i)(e)}}(),function(){var e=Date,i=e.prototype,n=function(e,t){return t||(t=2),("000"+e).slice(-1*t)},r={substitutes:function(e){switch(e){case"d":case"%d":return"dd";case"D":case"%a":return"ddd";case"j":case"l":case"%A":return"dddd";case"S":return"S";case"F":case"%B":return"MMMM";case"m":case"%m":return"MM";case"M":case"%b":case"%h":return"MMM";case"n":return"M";case"Y":case"%Y":return"yyyy";case"y":case"%y":return"yy";case"g":case"%I":return"h";case"G":return"H";case"h":return"hh";case"H":case"%H":return"HH";case"i":case"%M":return"mm";case"s":case"%S":return"ss";case"%r":return"hh:mm tt";case"%R":return"H:mm";case"%T":return"H:mm:ss";case"%X":return"t";case"%x":case"%e":return"d";case"%D":return"MM/dd/yy";case"%n":return"\\n";case"%t":return"\\t";case"e":case"T":case"%z":case"%Z":return"z";case"Z":return"ZZ";case"N":case"w":case"%w":return"u";case"W":case"%V":return"W"}},interpreted:function(i,r){var a;switch(i){case"%u":return r.getDay()+1;case"z":return r.getOrdinalNumber();case"%j":return n(r.getOrdinalNumber(),3);case"%U":var s=r.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),o=r.clone().addDays(1).moveToDayOfWeek(0,-1);return o<s?"00":n((o.getOrdinalNumber()-s.getOrdinalNumber())/7+1);case"%W":return n(r.getWeek());case"t":return e.getDaysInMonth(r.getFullYear(),r.getMonth());case"o":case"%G":return r.setWeek(r.getISOWeek()).toString("yyyy");case"%g":return r._format("%G").slice(-2);case"a":case"%p":return t("tt").toLowerCase();case"A":return t("tt").toUpperCase();case"u":return n(r.getMilliseconds(),3);case"I":return r.isDaylightSavingTime()?1:0;case"O":return r.getUTCOffset();case"P":return a=r.getUTCOffset(),a.substring(0,a.length-2)+":"+a.substring(a.length-2);case"B":var c=new Date;return Math.floor((3600*c.getHours()+60*c.getMinutes()+c.getSeconds()+60*(c.getTimezoneOffset()+60))/86.4);case"c":return r.toISOString().replace(/\"/g,"");case"U":return e.strtotime("now");case"%c":return t("d")+" "+t("t");case"%C":return Math.floor(r.getFullYear()/100+1)}},shouldOverrideDefaults:function(e){switch(e){case"%e":return!0;default:return!1}},parse:function(e,t){var i,n=t||new Date;return(i=r.substitutes(e))?i:(i=r.interpreted(e,n))||e}};e.normalizeFormat=function(e,t){return e.replace(/(%|\\)?.|%%/g,function(e){return r.parse(e,t)})},e.strftime=function(e,t){return Date.parse(t)._format(e)},e.strtotime=function(t){var i=e.parse(t);return Math.round(e.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds())/1e3)};var a=function(t){return function(i){var n,a=!1;return"\\"===i.charAt(0)||"%%"===i.substring(0,2)?i.replace("\\","").replace("%%","%"):(a=r.shouldOverrideDefaults(i),n=e.normalizeFormat(i,t),n?t.toString(n,a):void 0)}};i._format=function(e){var t=a(this);return e?e.replace(/(%|\\)?.|%%/g,t):this._toString()},i.format||(i.format=i._format)}(),function(){"use strict";var e=function(e){return function(){return this[e]}},t=function(e){return function(t){return this[e]=t,this}},i=["years","months","days","hours","minutes","seconds","milliseconds"],n=function(e,t,i,r,a){if(1===arguments.length&&"number"==typeof e){var s=e<0?-1:1,o=Math.abs(e);this.setDays(Math.floor(o/864e5)*s),o%=864e5,this.setHours(Math.floor(o/36e5)*s),o%=36e5,this.setMinutes(Math.floor(o/6e4)*s),o%=6e4,this.setSeconds(Math.floor(o/1e3)*s),o%=1e3,this.setMilliseconds(o*s)}else this.set(e,t,i,r,a);return this.getTotalMilliseconds=function(){return 864e5*this.getDays()+36e5*this.getHours()+6e4*this.getMinutes()+1e3*this.getSeconds()},this.compareTo=function(e){var t,i=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds());return t=null===e?new Date(1970,1,1,0,0,0):new Date(1970,1,1,e.getHours(),e.getMinutes(),e.getSeconds()),i<t?-1:i>t?1:0},this.equals=function(e){return 0===this.compareTo(e)},this.add=function(e){return null===e?this:this.addSeconds(e.getTotalMilliseconds()/1e3)},this.subtract=function(e){return null===e?this:this.addSeconds(-e.getTotalMilliseconds()/1e3)},this.addDays=function(e){return new n(this.getTotalMilliseconds()+864e5*e)},this.addHours=function(e){return new n(this.getTotalMilliseconds()+36e5*e)},this.addMinutes=function(e){return new n(this.getTotalMilliseconds()+6e4*e)},this.addSeconds=function(e){return new n(this.getTotalMilliseconds()+1e3*e)},this.addMilliseconds=function(e){return new n(this.getTotalMilliseconds()+e)},this.get12HourHour=function(){return this.getHours()>12?this.getHours()-12:0===this.getHours()?12:this.getHours()},this.getDesignator=function(){return this.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator},this.toString=function(e){this._toString=function(){return null!==this.getDays()&&this.getDays()>0?this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds()):this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())},this.p=function(e){return e.toString().length<2?"0"+e:e};var t=this;return e?e.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,function(e){switch(e){case"d":return t.getDays();case"dd":return t.p(t.getDays());case"H":return t.getHours();case"HH":return t.p(t.getHours());case"h":return t.get12HourHour();case"hh":return t.p(t.get12HourHour());case"m":return t.getMinutes();case"mm":return t.p(t.getMinutes());case"s":return t.getSeconds();case"ss":return t.p(t.getSeconds());case"t":return(t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator}}):this._toString()},this};!function(i,n){for(var r=0;r<n.length;r++){var a=n[r],s=a.slice(0,1).toUpperCase()+a.slice(1);i.prototype[a]=0,i.prototype["get"+s]=e(a),i.prototype["set"+s]=t(a)}}(n,i.slice(2)),n.prototype.set=function(e,t,i,n,r){this.setDays(e||this.getDays()),this.setHours(t||this.getHours()),this.setMinutes(i||this.getMinutes()),this.setSeconds(n||this.getSeconds()),this.setMilliseconds(r||this.getMilliseconds())},Date.prototype.getTimeOfDay=function(){return this.getMilliseconds()+1e3*this.getSeconds()+6e4*this.getMinutes()+36e5*this.getHours()},Date.prototype.hasTimeOfDay=function(){return 0!==this.getHours()||0!==this.getMinutes()||0!==this.getSeconds()||0!==this.getMilliseconds()},Date.prototype.isRepeatDate=function(){return!1},Date.TimeSpan=n,"undefined"!=typeof window&&(window.TimeSpan=n)}(),function(){"use strict";var e=["years","months","days","hours","minutes","seconds","milliseconds"],t=function(e){return function(){return this[e]}},i=function(e){return function(t){return this[e]=t,this}},n=function(e,t,i,n){function r(){t.addMonths(-e),12===++n.months&&(n.years++,n.months=0)}if(1===e)for(;t>i;)r();else for(;t<i;)r();n.months--,n.months*=e,n.years*=e},r=function(e,t,i){var n=!1==(t.isDaylightSavingTime()===i.isDaylightSavingTime());n&&1===e?t.addHours(-1):n&&t.addHours(1)},a=function(e,t,i,a,s,o,c){if(7===arguments.length)this.set(e,t,i,a,s,o,c);else if(2===arguments.length&&arguments[0]instanceof Date&&arguments[1]instanceof Date){var l=arguments[0].clone(),d=arguments[1].clone(),h=l>d?1:-1;this.dates={start:arguments[0].clone(),end:arguments[1].clone()},n(h,l,d,this),r(h,l,d);var u=d-l;if(0!==u){var p=new TimeSpan(u);this.set(this.years,this.months,p.getDays(),p.getHours(),p.getMinutes(),p.getSeconds(),p.getMilliseconds())}}return this};!function(e,n){for(var r=0;r<n.length;r++){var a=n[r],s=a.slice(0,1).toUpperCase()+a.slice(1);e.prototype[a]=0,e.prototype["get"+s]=t(a),e.prototype["set"+s]=i(a)}}(a,e),a.prototype.set=function(e,t,i,n,r,a,s){this.setYears(e||this.getYears()),this.setMonths(t||this.getMonths()),this.setDays(i||this.getDays()),this.setHours(n||this.getHours()),this.setMinutes(r||this.getMinutes()),this.setSeconds(a||this.getSeconds()),this.setMilliseconds(s||this.getMilliseconds())},Date.TimePeriod=a,"undefined"!=typeof window&&(window.TimePeriod=a)}(),define("date",function(){});var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,i=function(){return e.URL||e.webkitURL||e},n=e.URL||e.webkitURL||e,r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in r,s=function(i){var n=t.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)},o=e.webkitRequestFileSystem,c=e.requestFileSystem||o||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d=0,h=[],u=function(){for(var e=h.length;e--;){var t=h[e];"string"==typeof t?n.revokeObjectURL(t):t.remove()}h.length=0},p=function(e,t,i){t=[].concat(t);for(var n=t.length;n--;){var r=e["on"+t[n]];if("function"==typeof r)try{r.call(e,i||e)}catch(e){l(e)}}},m=function(t,n){var l,u,m,f=this,g=t.type,v=!1,y=function(){var e=i().createObjectURL(t);return h.push(e),e},b=function(){p(f,"writestart progress write writeend".split(" "))},S=function(){!v&&l||(l=y()),u?u.location.href=l:window.open(l,"_blank"),f.readyState=f.DONE,b()},E=function(e){return function(){if(f.readyState!==f.DONE)return e.apply(this,arguments)}},C={create:!0,exclusive:!1};return f.readyState=f.INIT,n||(n="download"),a?(l=y(),r.href=l,r.download=n,s(r),f.readyState=f.DONE,void b()):(e.chrome&&g&&"application/octet-stream"!==g&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,"application/octet-stream"),v=!0),o&&"download"!==n&&(n+=".download"),("application/octet-stream"===g||o)&&(u=e),c?(d+=t.size,void c(e.TEMPORARY,d,E(function(e){e.root.getDirectory("saved",C,E(function(e){var i=function(){e.getFile(n,C,E(function(e){e.createWriter(E(function(i){i.onwriteend=function(t){u.location.href=e.toURL(),h.push(e),f.readyState=f.DONE,p(f,"writeend",t)},i.onerror=function(){var e=i.error;e.code!==e.ABORT_ERR&&S()},"writestart progress write abort".split(" ").forEach(function(e){i["on"+e]=f["on"+e]}),i.write(t),f.abort=function(){i.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),S)}),S)};e.getFile(n,{create:!1},E(function(e){e.remove(),i()}),E(function(e){e.code===e.NOT_FOUND_ERR?i():S()}))}),S)}),S)):void S())},f=m.prototype,g=function(e,t){return new m(e,t)};return f.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,e.addEventListener("unload",u,!1),g}(self);define("FileSaver",function(){}),define("globals",["ko","platform","Constants","util","RingBuffer","AddressParser","IScroll","react-dom","date","FileSaver"],function(e,t,i,n,r,a,s,o){function c(e,t){var i=new Image(1,1),n="//www.googleadservices.com/pagead/conversion/"+ie+"/?label="+e+"&guid=ON";t&&(n+="&value="+t+"&currency_code=USD"),i.src=n}function l(e,t){var i=new Image(1,1),n="//www.facebook.com/tr?id="+ne+"&ev=PageView";i.src=n}function d(e,t){var i,n,r,a,s,o,c,l;for(i=3&e.length,n=e.length-i,r=t,s=3432918353,o=461845907,l=0;l<n;)c=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*o+(((c>>>16)*o&65535)<<16)&4294967295,r^=c,r=r<<13|r>>>19,a=5*(65535&r)+((5*(r>>>16)&65535)<<16)&4294967295,r=27492+(65535&a)+((58964+(a>>>16)&65535)<<16);switch(c=0,i){case 3:c^=(255&e.charCodeAt(l+2))<<16;case 2:c^=(255&e.charCodeAt(l+1))<<8;case 1:c^=255&e.charCodeAt(l),c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*o+(((c>>>16)*o&65535)<<16)&4294967295,r^=c}return r^=e.length,r^=r>>>16,r=2246822507*(65535&r)+((2246822507*(r>>>16)&65535)<<16)&4294967295,r^=r>>>13,r=3266489909*(65535&r)+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}function h(e){try{for(var t=JSON.parse(JSON.stringify(e)),i=0;i<t.length;++i)""!==t[i].search&&(t[i].search="HasSearch");return JSON.stringify(t)}catch(e){return"Failed to sanitize pane state"}}function u(e){try{var t=JSON.parse(e);return delete t.values.Default.paneState,delete t.values.Default.localPaneState,delete t.values.Default.gdocTitle,t}catch(e){return"Failed to parse settings"}}function p(e){switch(e){case KeyCode.BackSpace:return"BACKSPACE";case KeyCode.Delete:return"DELETE";case KeyCode.Enter:return"ENTER";case KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}function m(e){return e.replace(/&?access_token=[^&]*/g,"")}function f(e){e.platformConfig=t.getUserPlatformConfig()}function g(e,t,i){return!!(i&&i.body&&i.body.trace&&i.body.trace.frames&&i.body.trace.frames[0]&&de.indexOf(i.body.trace.frames[0].filename)>=0)}function v(){var e=G.settings.get(Settings.activeUser);return e?"MooDoRDebug"+(new Date).getTime()+"_"+e:"Unknown"}function y(e,t){function i(){try{return e.apply(this,arguments)}catch(e){G.reportError(e),t&&t(e)}}return i}function b(e){try{G.PAssert(2814,e,"Must specify a callback")}catch(e){G.reportError(e)}return function(){try{if(e)return e.apply(void 0,arguments)}catch(e){G.reportError(e,arguments)}}}function S(e,t){return e&&t&&"object"==typeof e&&"object"==typeof t?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(i,n){return i&&e[n]===t[n]},!0):e===t}function E(e,t){try{G.PAssert(2825,!1===e.isLoaded,"Must not be loading the same API multiple times")}catch(e){G.reportError(e)}if(t&&t.error){if(2===e.numRetries)for(var i=0;i<e.timeoutCBs.length;++i)try{e.timeoutCBs[i]()}catch(e){G.reportError(e)}e.numRetries++,e.lastTimeout=Re[e.numRetries]||3e3,e.timer=setTimeout(function(){e.timer=void 0,window.gapi.client.load(e.api,e.version,E.bind(window,e))},1e3*e.lastTimeout)}else{for(var i=0;i<e.successCBs.length;++i)try{e.successCBs[i]()}catch(e){G.reportError(e)}e.successCBs=[],e.timeoutCBs=[],e.isLoaded=!0}}function C(e,t,i){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onreadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())},i&&(e.onerror=i)}function P(e){for(var t="",i=0;i<e.length;++i)t+=" "+G.safeStringify(e[i]);return t}function T(e,t){return!!e&&(t?e.lastFindPass===Ee:e.lastFindPass<Ee)}function D(e,t){if(e){var i=T(e,t);try{G.PAssert(2907,i,"Item should always be valid")}catch(e){G.reportError(e)}return e.lastFindPass=Ee,i}return!1}function M(e,t,i){var n,r=i&&i.isTest,a=i&&i.ignoreSearch,s=i&&i.sameLevel,o=i&&i.includeNotes;if(D(e,r)){var c=e.parent();if(c){if(e.isNote())return e.parent();var l=c.getChildIndex(e);if(l>0)for(;!n;){for(var d=!1,h=l-1;h>=0;h--){var u=c.getChild(h),p=D(u,r);if(!p){try{G.PAssert(2909,!1,"Invalid child found during findPreviousItem")}catch(e){G.reportError(e)}return}if(s||!u.hasChildren()||t&&u.isCollapsed(t,!1)){if(a||!t||!u.isHidden(t,!1)){n=u,d=!0;break}}else if(a||!t||!u.isHidden(t,!1)){c=u,l=u.numChildren(),d=!0;break}}if(s)break;d||(n=c)}else s||(n=e.parent());o&&n&&n.hasNote()&&(n=n.getNote());try{G.PAssert(2910,!s||!n||n.parent()===e.parent(),"Previous item must share the same parent")}catch(e){G.reportError(e)}try{G.PAssert(2911,r||!n||t&&n.isCollapsed(t,!1)||e===_(n,t,{
isTest:!0,ignoreSearch:a,sameLevel:s}),"Previous/Next should always match")}catch(e){G.reportError(e)}return n}}}function _(e,t,i){var n,r=i&&i.isTest,a=i&&i.ignoreSearch,s=i&&i.sameLevel,o=i&&i.includeNotes;if(e){if(o&&e.hasNote())return e.getNote();if(e.isNote()&&(e=e.parent()),!s&&e.hasChildren()&&(!t||!e.isCollapsed(t,!1)))for(var c=e.numChildren(),l=0;l<c;++l){var d=e.getChild(l),h=D(d,r);if(!h){try{G.PAssert(2913,!1,"Invalid child found during findNextItem A")}catch(e){G.reportError(e)}return}if(a||!t||!d.isHidden(t,!1)){n=d,i&&i.numLevels++;break}}for(var u=e;!n;){if(!D(u,r)){try{G.PAssert(2914,!1,"Invalid parent found during findNextItem B")}catch(e){G.reportError(e)}break}var p=u.parent();if(!p)break;var m=p.getChildIndex(u),c=p.numChildren();if(!t||!p.isCollapsed(t,!1))for(var l=m+1;l<c;++l){var d=p.getChild(l),h=D(d,r);if(!h){try{G.PAssert(2916,!1,"Invalid child found during findNextItem C")}catch(e){G.reportError(e)}return}if(a||!t||!d.isHidden(t,!1)){n=d;break}}if(u=p,i&&!n&&i.numLevels--,s||t&&u===t.getItem())break}try{G.PAssert(2917,!s||!n||n.parent()===e.parent(),"Next item must share the same parent")}catch(e){G.reportError(e)}try{G.PAssert(2918,r||!n||e===M(n,t,{isTest:!0,ignoreSearch:a,sameLevel:s}),"Previous/Next should always match")}catch(e){G.reportError(e)}return n}}function I(){if(Pe.pane){var e=0+6*Pe.speed,t=Pe.pane.addScrollDelta(e);Te&&t?requestAnimationFrame(I):(Pe.speed=0,Pe.pane=void 0,Te=!1)}}function A(e){if(e){var t=G.dataFor(e);t&&t.addPadding&&t.addPadding()}}function w(e,t,i){for(var n=e.pane,r=e.overview,a=0;a<t.length;++a){var s=t[a];if(!e.headers||s.showInOverview(e.includeArchived)){if((!e.comparator||e.comparator(s))&&e.each){if(!1===e.each(s))return!1}r&&!isNaN(e.collapseAfterDepth)&&(i<e.collapseAfterDepth&&1===n.getPerPaneState(s.id,PerPaneStateField.CollapsedOverview)?n.setPerPaneState(s.id,PerPaneStateField.CollapsedOverview,void 0):i>=e.collapseAfterDepth&&void 0===n.getPerPaneState(s.id,PerPaneStateField.CollapsedOverview)&&n.setPerPaneState(s.id,PerPaneStateField.CollapsedOverview,1)),k(s,e,i+1)}}}function k(e,t,i){i=i||0;var n,r=t.noCollapsed,a=t.pane,s=t.overview;t.includeNotes&&!t.headers&&e.hasNote()&&(t.comparator&&!t.comparator(e.getNote())||t.each&&(n=t.each(e.getNote()))),!1===n||r&&0!==i&&e.isCollapsed(a,s)||!1!==(n=w(t,e.items.get(),i))&&t.includeArchived&&e.hasArchivedChildren()&&w(t,e.archivedItems(!0),i)}function x(e,t){try{G.PAssert(2988,"string"!=typeof e,"Should only pass objects to the obj mapping function",e)}catch(e){G.reportError(e)}var i={};for(var n in e){try{G.PAssert(2989,e.hasOwnProperty(n),"This should always be the case, the prototype shouldn't be extended")}catch(e){G.reportError(e)}if(void 0!==e[n]&&null!==e[n]){var r=t[n];if(r)i[r]=e[n];else{try{G.PAssert(2990,!1,"Incoming field should be added to the field map",n)}catch(e){G.reportError(e)}i[n]=e[n]}}}return i}function R(e,t,i){try{G.PAssert(3001,void 0!==i,"Must pass in valid key data to type")}catch(e){G.reportError(e)}if(e||(e=X.getStartElement()),document.createEvent&&e){var n=document.createEvent("Event");n.normCode=i.normCode,n.shiftKey=!!i.shiftKey,n.altKey=!!i.altKey,n.ctrlKey=!!i.ctrlKey,n.metaKey=!!i.metaKey,n.synthetic=!0,n.initEvent(t,!0,!0),e.dispatchEvent(n)}else if(e)try{G.PAssert(3002,!1,"Unable to fire key event")}catch(e){G.reportError(e)}else try{G.PAssert(3003,!1,"No element available to fire key event on")}catch(e){G.reportError(e)}}function O(e,t,i,n){try{G.PAssert(3004,void 0!==i,"Must pass in a valid button to click with")}catch(e){G.reportError(e)}if(e||(e=Y.getSelectionNode()),document.createEvent&&e){var r=document.createEvent("Event");if(r.button=i,r.synthetic=!0,n)for(var a in n)r[a]=n[a];r.initEvent(t,!0,!0),e.dispatchEvent(r)}else if(e)try{G.PAssert(3005,!1,"Unable to fire click event")}catch(e){G.reportError(e)}else try{G.PAssert(3006,!1,"No element available to fire click event on")}catch(e){G.reportError(e)}}function L(){document.removeEventListener("DOMContentLoaded",L,!1),window.removeEventListener("load",L,!1);for(var e=0;e<ke.length;++e)ke[e]();ke=void 0}function N(e){var t="";if("object"==typeof e){var i=[];for(var n in e)i[i.length]=encodeURIComponent(n)+"="+encodeURIComponent(e[n]);t=i.join("&").replace(/%20/g,"+")}else{try{G.PAssert(3040,"string"==typeof e,"Only Objects or Strings are currently supported")}catch(e){G.reportError(e)}t=e}return t}function F(e){var t=m(e),i=t.split("?")[0];return xe[i]||(xe[i]={requests:0,successes:0,retries:0,failures:0}),xe[i]}function B(e){F(e).requests++}function U(e){F(e).successes++}function H(e){F(e).retries++}function V(e){F(e).failures++}function q(e){var t;if(t=W(e.url)){e.iid=Ne++;var i=e.onreadystatechange;e.onreadystatechange=function(){i&&i.apply(e,arguments),t(e)}}}function W(e){return!!e&&Fe[e.split("?")[0]]}function z(e){var t=!1;if(e&&e.url){var i=e.url.split("?")[0];Be.indexOf(i)>=0&&(t=!0)}return t}var G={vmMain:void 0,vmDebug:void 0,topBarHeight:t.android?56:44,agendaPadding:34,archivedPadding:34,itemTransitionTime:100,iOSDragTime:400,iOSDragTimeKeyboardOpen:200,scrollbarWidth:12,hasFocus:!0,zoomTime:0,demoMode:!1,intro:void 0,focusedPane:void 0,focusedItem:void 0,ClickThreshold:5,isFirstRun:!1,isReconnected:!1,isBlocked:!1,blockedMessage:"",authImmediateFailed:!1,authUserLoggedIn:!1,noLocalWrites:!1,noLocalWritesReason:i.LocalWriteReason.Enabled,isLoadingRemote:!1,isSendingEmail:!1,isSavingDrafts:!1,isKeyboardOpen:!1,itemMenuOpenedOn:void 0,errorPlatformInfo:void 0,nativeBacklog:[],nativeBridge:{sendToApp:function(e,t){G.nativeBacklog.push({method:e,data:t})}},elements:{},SPThresholdLeft:8,SPThresholdRight:42,MobileSideTapThreshold:40,MobileSideTapThresholdKeyboardOpen:15,minItemHeight:32,colorBlue:"#09d",colorLightBlue:"#02b1ff",colorRed:"#d43",colorLightRed:"#f34433",MinItemWidth:50};G.paneTop=t.mobile?G.topBarHeight:t.app?20:0,G.overviewPaddingStart=32,G.overviewPaddingIncrement=18;var j,K,Y,X;require(["VMLI","VMPane","NativeSel","Sel"],function(e,t,i,n){j=e,K=t,Y=i,X=n}),window.ScrollDuration={Snap:0,Default:200,Slow:500},window.KeyCode={BackSpace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,F1:112,F4:115,F12:123,Equals:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222},window.ButtonCode={None:-1,Left:0,Middle:1,Right:2},window.Direction={Up:-1,None:0,Down:1},window.TextSpace="\ufeff",window.AttachChar=" ",window.EmbedAttachChar=" ",window.DriveStatus={Offline:0,Connecting:1,Saving:2,Saved:3,Reconnecting:4},window.PaneMode={Outline:"PaneOutline",Timeline:"PaneTimeline",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail"},window.MessageAction={Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenLinkedSettings:17,OpenGeneralSettings:18,OpenCalendarSettings:19},window.MessageType={Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},window.MessageID={Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,OldUserNewTrial:32,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,NeedGmailPermission:37,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,MissingOffline:41,MissingOfflineMobile:42,FlatSearchMultiSelect:43,FlatSearchEnter:44,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49},window.VMLIFlag={None:0,Header:1,Collapsed:2,Selected:4,Highlighted:8,NumList:16,Note:32,Multiline:64,Archived:128,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},window.UninitializedVersion=-1,window.VersionType={Structure:1,Text:2},window.SaveFlag={None:0,Prop:1,Text:2,All:3},window.RepeatFreq={Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},window.DateType={Once:1,Repeat:2},window.ChangeType={None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,Rollover:1048576,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},window.StorageType={InMemory:1,LocalStorage:2,IndexedDB:3},window.LoginState={NONE:0,LOGGED_OUT:1,LOGGED_IN:2},window.ReturnValue={Success:0,Error:1,FatalError:2},window.OAuthSchemeType={Invalid:-1,None:0,Web:1,Native:2,Count:2},window.ACProvider={None:0,Contact:1,DatePicker:2,DateList:3,Tag:4,Search:5},window.DataSource={Paste:1,Drop:2,Plugin:3},window.PluginID={Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar"},window.PluginSettingsID={},window.PluginLoad={None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},window.PluginDependency={DemoMode:"DemoMode",GoogleLogin:"GoogleLogin",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess",LocalLoaded:"LocalLoaded"},window.PluginRenderTypes={Generic:0,StyledText:1,UnstyledText:2,AutocompleteText:3,AgendaEntry:4,Measure:5},window.PluginRenderers={Unknown:-1,DriveFile:0,EmailThread:1,CalendarEvent:2},window.PerPaneStateField={Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},window.Modals={ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",RevisionHistory:"revisionHistory",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",Welcome:"welcome",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode"},window.PremiumStatus={Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},function(){function e(e){return e}window.PrivateAPIErrorCodes={Success:0,UnknownFailure:e(1),Unexpected:e(2),DatabaseReadError:e(3),DatabaseWriteError:e(4),MissingParameter:e(5),InvalidParameter:e(6),UnauthorizedUser:e(7),ErrorSendingEmail:e(8),AlreadyReferred:e(9),ErrorContactingRemote:e(10),BraintreeUnknown:e(11),InvalidToken:e(12),InvalidReferralCode:e(13),NoSignupFound:e(14),TrialOver:e(15),RemoteServerError:e(16),TokenMissing:e(17),BraintreePaypalBlock:e(18),BraintreeInvalidCCN:e(19),AlreadyExists:e(20),DomainPolicy:e(21),InvalidCode:e(22)}}(),window.DataChangeType={Add:1,Remove:2,Change:3},window.SearchResultStatus={Done:1,TooMany:2,None:3,Error:4},window.Settings={theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",lastTaskSync:"lastTaskSync",lastQuickAddSync:"lastQuickAddSync",disableNotifications:"disableNotifications",notificationDelay:"notificationTime",rootFolderId:"rootFolderId",attachFolderId:"attachFolderId",authScopes:"authScopes",localIntegrity:"localIntegrity",localDataVersion:"localDataVersion",localRecoverVersion:"localRecoverVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",userId:"userId",displayName:"displayName",noSounds:"noSounds",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",closedImport:"closedImport",closedHelps:"closedHelps",oauthScheme:"oauthScheme",premiumStatus:"zzp",enableOfflineAuth:"enableOfflineAuth",trialStart:"pzs",trialDuration:"pzd",trialExtended:"pze",premiumEndDate:"ped",notifiedTrialOver:"notifiedTrialOver",notifiedTrialEndSoon:"notifiedTrialEndSoon",inTooltipIntro:"inTooltipIntro",keyboardToolbarScroll:"keyboardToolbarScroll",dayWeekStart:"dayWeekStart",trialOverHidden:"trialOverHidden",showBullets:"showBullets",bulletOpacity:"bulletOpacity",checkboxOpacity:"checkboxOpacity",checkboxBackgroundOpacity:"checkboxBackgroundOpacity",showVerticalLines:"showVerticalLines",verticalLinesColor:"verticalLinesColor",boldHeaders:"boldHeaders",itemPadding:"itemPadding",notePadding:"notePadding",itemLineHeight:"itemLineHeight",noteLineHeight:"noteLineHeight",itemIndentSize:"itemIndentSize",fontSize:"fontSize",fontSizeHeader:"fontSizeHeader",fontSizeHeaderTopLevel:"fontSizeHeaderTopLevel",noteFontSize:"noteFontSize",tagColor:"tagColor",dateColor:"dateColor",contactColor:"contactColor",linkColor:"linkColor",underlineP:"underlineP",layoutTheme:"layoutTheme",grayscale:"grayscale",helpState:"helpState",localPaneState:"localPaneState",workspaces:"workspaces",selectedWorkspace:"selectedWorkspace",paneHistoryMobile:"paneHistoryMobile",cacheSizeRatio:"cacheSizeRatio",monthlyInvoice:"monthlyInvoice",invoiceEmail:"invoiceEmail",invoiceCompany:"invoiceCompany",invoiceAddress:"invoiceAddress",isUnsubscribed:"isUnsubscribed",showSidebar:"showSidebar",searchExpandsCollapsed:"searchExpandsCollapsed",openEvernoteApp:"openEvernoteApp",closedVideo:"closedVideo",dateFormat:"dateFormat"},window.__TEXT_CHANGED_UPDATES={NoUpdate:0,PaneSkipped:0,CausedUpdate:0},G.inMaskOnly=function(e,t){return 0==(~t&e)},G.isFlagSet=function(e,t){return(e&t)===t},G.isOneFlagSet=function(e,t){var i=e&t;return 0!==i&&0==(i&i-1)},G.isAtLeastOneFlagSet=function(e,t){return 0!=(e&t)},G.forEachFlagSet=function(e,t){for(;0!==e;){t(Math.abs(e&-e)),e&=e-1}},G.PCMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete,G.PMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2,G.fieldMapIn={isArchived:"a",dateCreated:"c",date:"d",duration:"e",formats:"f",durationText:"g",favorites:"h",items:"i",isNote:"k",modifiedOffline:"l",isCollapsed:"m",note:"n",modifiedOfflineText:"o",priority:"p",dateFormat:"q",repeatDate:"r",dateText:"s",text:"t",versionText:"u",version:"v",isDeleted:"x",isComplete:"z",archivedItems:"ai",allDayDate:"ad",id:"id",isStarred:"*",dateCompleted:"^"},G.priorityMapOut={},G.priorityMapOut[VMLIFlag.None]=" ",G.priorityMapOut[VMLIFlag.P0]=" p0",G.priorityMapOut[VMLIFlag.P1]=" p1",G.priorityMapOut[VMLIFlag.P2]=" p2",window.NumListPrefix="#.",window.NumListPrefixOther="1.",window.DatePrefix="@",window.ContactPrefix="+",window.TagPrefix="#";var Q={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};G.escape=function(e){return String(e).replace(/[&\"<>]/g,function(e){return Q[e]})},G.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},G.stripTagsBasic=function(e){return e.replace(/<.*>/g,"")},G.stripFormattingTags=function(e){return e.replace(/<\/?[biu]>/g,"")},G.trimPunc=function(e){return e.replace(/[:,\.\'\"\)\]]$/g,"")},G.getTransitionClass=function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t},G.setTransformStyle=function(e,i,n){try{G.PAssert(2758,e,"Must provide a valid element")}catch(e){G.reportError(e)}if(e){try{G.PAssert(2759,void 0!==i,"Must supply a valid X offset")}catch(e){G.reportError(e)}try{G.PAssert(2760,void 0!==n,"Must supply a valid Y offset")}catch(e){G.reportError(e)}t.ie?e.style[t.transform.style]="translate("+i+"px, "+n+"px)":e.style[t.transform.style]="translate3d("+i+"px, "+n+"px, 0px)"}},G.setTransitionStyle=function(e,i,n,r){try{G.PAssert(2761,e,"Must provide a valid element")}catch(e){G.reportError(e)}e&&(r=r||"ease",e.style[t.transition.style]=i+" "+n+"ms "+r,setTimeout(function(){e.style[t.transition.style]=""},n))};G.setTransform=function(e,i,n,r,a){r>0?(G.setTransitionStyle(e,t.transform.prop,r,a),G.setTransformStyle(e,i,n)):i||n?G.setTransformStyle(e,i,n):e.style[t.transform.style]="none"},G.reload=function(e){try{G.PAssert(2762,!$,"Page should not be reloaded while waiting for an appcache update to finish.")}catch(e){G.reportError(e)}$&&G.reportError(new Error("Page requesting reload while waiting for AppCache update.")),window.location.reload(e)},G.isSetupPageOpen=!1,G.isMainPageOpen=!1,G.openMainPage=function(){G.isSetupPageOpen=!1,G.isMainPageOpen=!0;var e=document.getElementById("outerWrapper"),t=document.getElementById("setupWrapper");e&&t&&(G.removeClass(e,"none"),G.addClass(t,"none"))},G.openSetupPage=function(){G.isSetupPageOpen=!0,G.isMainPageOpen=!1,G.addClass(document.getElementById("outerWrapper"),"none"),G.removeClass(document.getElementById("setupWrapper"),"none")};var J=!1,$=!1;G.setAppCacheUpdateState=function(e){$=e,e&&(J=!0)},G.isEmpty=function(e){for(var t in e)return!1;return!0},G.isEmail=function(e){var t=!1;if(e){t=!!new RegExp(/\S+@\S+\.\S+/i).exec(e),t&&(t=e.indexOf('"')<0)}return t},G.parseTokensFromText=function(e){for(var t,i=[],n=/(?:(?:[\"]([^\"<>]*)[\"]\s))|(?:([^\",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,r=0;null!==(t=n.exec(e));){var a=e.substring(r,t.index),s=t[1]||t[2],o=t[3]||t[5];r=n.lastIndex,a&&a.trim().length>0&&i.push({text:a,type:"text"}),i.push({text:s||o,email:o,type:"contact"})}var c=e.substring(r,e.length);return c&&c.length>0&&i.push({text:c,type:"text"}),i},G.parseEmailAddresses=function(e){return a.parse(e)},G.isWhiteSpace=function(e){return/^\s*$/.test(e)},G.removeDOM=function(e){try{G.PAssert(2763,e,"Must specify a valid DOM id to remove")}catch(e){G.reportError(e)}var t=document.getElementById(e);try{G.PAssert(2764,t,"DOM Element must exist to remove it")}catch(e){G.reportError(e)}t&&t.parentNode.removeChild(t)},G.isRunningScript=function(){return G.AScript&&G.AScript.isRunning};var Z=!1;G.goOnline=function(){Z=!1},G.goOffline=function(){Z=!0},G.isOffline=function(){return Z},G.preventLocalWrites=function(e){try{G.PAssert(2765,!G.noLocalWrites,"Should only disable local writes once")}catch(e){G.reportError(e)}try{G.PAssert(2766,e>=0,"Must provide a valid reason for disabling local writes")}catch(e){G.reportError(e)}ShouldLog(LogLevels.Warning)&&log("---- WARNING: Local Writes Disabled ----"),G.noLocalWrites=!0,G.noLocalWritesReason=e},G.shouldWriteLocal=function(){return!G.noLocalWrites},G.isLocalWriteReason=function(e){return G.noLocalWritesReason===e},G.enableDemoMode=function(){G.demoMode=!0;var e=n.getURLParam("dmode");e&&G.runOnLoad(function(){G.enableMinMode(e)}),G.preventLocalWrites(i.LocalWriteReason.DemoMode)},G.isDemoMode=function(){return G.demoMode},window.DisplayMode={Default:0,InIframe:1,NoPaneHeaders:2,Invisible:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,PromptStart:4096,FullMin:8191},G.activeDisplayMode=DisplayMode.Default,G.isDisplayModeActive=function(e){return(G.activeDisplayMode&e)===e},G.isDemoInIframe=function(){return this.isDisplayModeActive(DisplayMode.InIframe)},G.enableMinMode=function(e){try{if(G.addClass(document.body,"minMode"),G.isMinMode=!0,e=parseInt(e),t.touch||(e&DisplayMode.InIframe&&G.addClass(document.documentElement,"inIframe"),e&DisplayMode.Invisible&&G.addClass(document.documentElement,"invisible"),e&DisplayMode.NoPaneHeaders&&G.addClass(document.body,"noPaneHeaders"),e&DisplayMode.NoMinPaneSize&&(G.minPaneWidth=0),e&DisplayMode.NoPaneStyle&&G.addClass(document.body,"noPaneStyle")),e&DisplayMode.NoPanePadding&&(G.addClass(document.body,"noPanePadding"),G.noPanePadding=!0),e&DisplayMode.NoScrollbars&&(G.noScrollbars=!0),e&DisplayMode.NoBackground&&G.addClass(document.documentElement,"noBackground"),e&DisplayMode.NoInteraction){var i=document.getElementById("outerWrapper"),n=document.createElement("div");n.id="preventInteraction",i.appendChild(n),e&DisplayMode.PromptStart&&G.setupClick(n,n,function(){var e=G.toasts.getMessageById(MessageID.PromptScriptStart);e&&(e.doAction(),e.hide())})}e&DisplayMode.ShowDemoExit&&setTimeout(function(){G.toasts.pushMessage(MessageID.ExitDemo)},0),e&DisplayMode.PromptStart&&setTimeout(function(){G.toasts.pushMessage(MessageID.PromptScriptStart)},0),G.activeDisplayMode=e}catch(e){G.reportError(e)}},G.setDimension=function(e,t){window.ga&&!G.isDemoMode()&&ga("set",e,t)},G.sendEvent=function(e,t,i){try{G.PAssert(2767,void 0===i||G.isNumber(i),"Values must be numeric")}catch(e){G.reportError(e)}if(window.ga&&!G.isDemoMode())try{ga("send","event",e,t,G.getAnonUserIdentifier(),i)}catch(n){G.reportError(n,"Category: "+e+" Action: "+t+" Value: "+i)}},G.sendTimeEvent=function(e,t,i){try{G.PAssert(2768,G.isNumber(i),"Values must be numeric")}catch(e){G.reportError(e)}if(window.ga&&!G.isDemoMode())try{ga("send","timing",e,t,i,G.getAnonUserIdentifier())}catch(n){G.reportError(n,"Category: "+e+" Variable: "+t+" Value: "+i)}};var ee;G.startTimeEvent=function(e,t){if(window.log&&window.log.now){try{G.PAssert(2769,void 0===ee,"This function needs to be updated to allow nested timing events")}catch(e){G.reportError(e)}ee={startTime:log.now(),category:e,variable:t}}},G.endTimeEvent=function(){if(window.log&&window.log.now){try{G.PAssert(2770,void 0!==ee,"Must have started a timing event")}catch(e){G.reportError(e)}if(ee){var e=log.now()-ee.startTime;G.sendTimeEvent(ee.category,ee.variable,e),ee=void 0}}};var te={};G.registerEvent=function(e,t,i){try{G.PAssert(2771,!te.hasOwnProperty(e),"Should only register an event once")}catch(e){G.reportError(e)}try{G.PAssert(2772,void 0!==e,"Must specify a name for the event")}catch(e){G.reportError(e)}try{G.PAssert(2773,void 0!==t,"Must specify a category for the event")}catch(e){G.reportError(e)}try{G.PAssert(2774,void 0!==i,"Must specify an action for the event")}catch(e){G.reportError(e)}var n={category:t,action:i,label:G.getAnonUserIdentifier(),count:0};te[e]=n},G.aggregateEvent=function(e,t){try{G.PAssert(2775,te.hasOwnProperty(e),"Must register an event before using it")}catch(e){G.reportError(e)}void 0===t&&(t=1),te[e]&&(te[e].count+=t)},G.UIAction=function(e){G.sendEvent("UIAction",e)};var ie=976910954,ne=0x6bf609b2d12c;G.reportAdConversion=function(e,t){try{c(e,t)}catch(e){G.reportError(e)}try{l(e,t)}catch(e){G.reportError(e)}};var re=!1;G.pageDataCleared=function(){re=!0},G.hasPageDataBeenCleared=function(){return re},G.onunload=function(){log("Unloading the page");try{for(var e in te){var i=te[e];G.sendEvent(i.category,i.action,i.count),i.count=0}G.failedGapiLoad?G.sendEvent("ScriptLoad","GapiFailed"):gapiCalled||G.sendEvent("ScriptLoad","GapiNotLoaded");var n=require("Dispatcher");n&&n.fireEvent("onUnload",[]),t.mobile&&G.closeKeyboard(),G.vmMain&&G.settings.get(Settings.gdocId)&&G.vmMain.paneManager.savePaneState();var r,a=require("gdata");if(re)G.vmMain&&G.vmMain.pluginManager&&(r=G.vmMain.pluginManager.onShutdown(!1));else{G.vmMain&&G.vmMain.pluginManager&&(r=G.vmMain.pluginManager.onShutdown(!0));try{a&&G.settings&&G.settings.set(Settings.lastServerVersion,a.getServerVersion())}catch(e){}}if(G.UIAction("PageUnload"),G.isLoadingRemote)return"We are still syncing your changes. Do you still want to quit?";if(G.isSendingEmail)return"Some emails have not been sent. Closing Moo.do will stop them from sending. Do you still want to quit?";if(G.isSavingDrafts)return"Your drafts are still being saved. Do you still want to quit?";if(a&&a.hasPotentialUnsavedData()&&!re)return"You have made changes that have not been saved to the server. Do you still want to quit?";if(r)return r[0]}catch(e){G.reportError(e)}},t.demo||(window.onbeforeunload=G.onunload);var ae=LoginState.LOGGED_OUT;G.getLoginState=function(){var e=ae;if(G.shouldWriteLocal())try{var t=n.storage.getItem("loginState");null!==t&&void 0!==t&&(e=G.parseInt(t))}catch(e){G.reportError(e)}try{G.PAssert(2776,e===LoginState.NONE||e===LoginState.LOGGED_OUT||e===LoginState.LOGGED_IN,"Invalid login state set")}catch(e){G.reportError(e)}return e},G.setLoginState=function(e){try{G.PAssert(2777,null!==e&&void 0!==e&&!isNaN(e),"Should always be a valid LoginState enum value")}catch(e){G.reportError(e)}if(ae=e,G.shouldWriteLocal())try{(isNaN(e)||null===e||void 0===e)&&(e=LoginState.LOGGED_OUT);try{G.PAssert(2778,e===LoginState.NONE||e===LoginState.LOGGED_OUT||e===LoginState.LOGGED_IN,"Invalid login state set")}catch(e){G.reportError(e)}n.storage.setItem("loginState",e)}catch(e){G.reportError(e)}};G.applyBindings=function(t,i){var n=document.getElementById(i);try{G.PAssert(2794,t,"A valid model must be defined when apply bindings")}catch(e){G.reportError(e)}try{G.PAssert(2795,n,"A valid element must be defined when apply bindings")}catch(e){G.reportError(e)}if(n&&t)try{e.applyBindings(t,n)}catch(e){throw e.message+=" | Binding on: "+G.elementToString(n),G.reportError(e),e}else{var r="Invalid model or element passed to applyBindings | ";r+=n?"NoModel - Elem: "+G.elementToString(n):t?"NoElem - Elem: #"+i:"NoModelNoElem - Elem: #"+i,G.reportError(new Error(r))}},G.createObservable=function(t,i,n){return e.observable(t)},G.createObservableArray=function(t,i,n){return e.observableArray(t)},e.bindingHandlers.load={init:function(e,t,i,n,r){try{G.PAssert(2796,n,"Must always be passing in a valid view model to load - "+G.elementToString(e))}catch(e){G.reportError(e)}try{G.PAssert(2797,n.onLoad,"If no load function is specified, remove the binding from the template - "+G.elementToString(e))}catch(e){G.reportError(e)}var a,s=r.$parents.length-2;s>=0&&(a=r.$parents[s]),n&&n.onLoad&&n.onLoad(e,a)}},e.bindingHandlers.check={init:function(e,t,i,n){var r=t();r()&&G.addClass(e,"checked"),G.setupClick(e,n,{onClick:function(t){r(!r()),r()?G.addClass(e,"checked"):G.removeClass(e,"checked"),t.preventDefault(),t.stopPropagation()}})},update:function(e,t){t()()?G.addClass(e,"checked"):G.removeClass(e,"checked")}};var se={timeout:0,onStart:function(e){e.pressedAlready||(this.pressed=!0,e.pressedAlready=!0,this.timeout=setTimeout(function(){G.addClass(this,"pressed"),this.pressed||setTimeout(function(){G.removeClass(this,"pressed")}.bind(this),60)}.bind(this),120))},onFirstMove:function(){this.pressed&&(clearTimeout(this.timeout),G.removeClass(this,"pressed"),this.pressed=!1)},onEnd:function(){this.pressed&&(G.removeClass(this,"pressed"),this.pressed=!1)}};e.bindingHandlers.ripple={init:function(e,t,i,n){G.setupClick(e,e,se)}},e.bindingHandlers.tap={init:function(e,t,i,n){G.setupClick(e,n,t())}},e.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},e.bindingHandlers.tooltip={init:function(i,n){t.mobile||G.setupMouseOver(i,e.utils.unwrapObservable(n()),!1)},update:function(i,n){t.mobile||G.setupMouseOver(i,e.utils.unwrapObservable(n()),!0)}},G.setupMouseOver=function(e,i,n){try{G.PAssert(2798,!t.mobile)}catch(e){G.reportError(e)}G.tooltip?n?G.tooltip.update(e,i):G.tooltip.register(e,i):G.reportError(new Error("Tooltips registered before VMTooltip created"))},"function"!=typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}):String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!=typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(e,t){for(var i=-1,n=t-1;n>=0;--n)if(this[n]===e){i=n;break}return i}),e.bindingHandlers.css2=e.bindingHandlers.css,G.findFirstDiff=function(e,t,i,n){if(!e)return n?0:t.length;if(!t)return n?e.length:0;for(var r=Math.min(e.length,t.length),a=0;a<r;++a)if(i){if(e.charAt(a).toLowerCase()!==t.charAt(a).toLowerCase())return a}else if(e.charAt(a)!==t.charAt(a))return a;return n?e.length:t.length},G.findMatchingLength=function(e,t,i){if(!e||!t)return 0;for(var n=Math.min(e.length,t.length),r=0;r<n;++r)if(i){if(e.charAt(r).toLowerCase()!==t.charAt(r).toLowerCase())return r}else if(e.charAt(r)!==t.charAt(r))return r;return n},G.TEMP_PREFIX="~T^";var oe=0;G.generateTempId=function(){return G.TEMP_PREFIX+Date.now()+ ++oe},G.isTempId=function(e){return e&&e[0]===G.TEMP_PREFIX[0]&&e[1]===G.TEMP_PREFIX[1]&&e[2]===G.TEMP_PREFIX[2]},G.isLocalItem=function(e){try{G.PAssert(2799,e.id,"All items should have an ID even if it is a temp one")}catch(e){G.reportError(e)}return G.isTempId(e.id)},G.requestNotification=function(e){var t=document.forms.requestNotification,i=document.getElementById("notificationResult"),n=t.email.value;return void 0===n||null===n||n.length<5?i.innerText="Please enter a valid email address.":G.XHR_PrivateAPI({type:"POST",path:"/feedback/notification",data:{email:n,platform:e},cb:function(e){200===e.status?(t.email.value="",i.innerText="Thanks for your interest!"):i.innerText="There was an error processing your request, please try again in a few minutes."}}),!1},G.getUserIdentifier=function(){return G.getActiveUser()||G.vmMain&&G.vmMain.getUserEmail()||"me"},G.setActiveUser=function(e){try{G.PAssert(2800,e,"Must provide an email")}catch(e){G.reportError(e)}try{G.PAssert(2801,"me"!==e,'Active user must never be "me"')}catch(e){G.reportError(e)}"me"!==e&&G.settings.set(Settings.activeUser,e)},G.getActiveUser=function(){var e=G.settings.get(Settings.activeUser);return"me"!==e?e:void 0};var ce;G.getAnonUserIdentifier=function(){if(!ce){var e=G.getUserIdentifier();ce=e[0]+e[1]+e[2]+d(e,17124123)}return ce};G.hashString=function(e){try{G.PAssert(2802,G.isString(e),"Must always be passing a string to hash")}catch(e){G.reportError(e)}return d(e,129831293)},G.getLoadedScripts=function(e){try{for(var t=document.getElementsByTagName("script"),i=[],n=0;n<t.length;++n){var r=t[n];r.src&&i.push(r.src)}e.loadedScripts=i}catch(t){e.loadedScripts="ERROR: "+t.message}},G.getAppStats=function(e){if(e.numPanes=window.__TOTAL_PANES,e.numItems=window.__TOTAL_ITEMS,e.numArchivedItems=window.__TOTAL_ARCHIVED_ITEMS,e.numArchiveParents=window.__TOTAL_ARCHIVE_PARENTS,e.parseTextCalls=window.__PARSE_STATS,e.textChangedUpdates=window.__TEXT_CHANGED_UPDATES,e.notificationUpdatesFull=window.__FULL_NOTIFICATION_UPDATES,e.notificationUpdatesSingle=window.__SINGLE_NOTIFICATION_UPDATES,e.XHRStats=G.getXHRStats(),G.vmMain&&G.vmMain.pluginManager){try{e.pluginStats=G.vmMain.pluginManager.getStats()}catch(t){e.pluginStats="Error: "+t.message}try{e.pluginState=G.vmMain.pluginManager.getState()}catch(t){e.pluginState="Error: "+t.message}}if(G.vmMain&&G.vmMain.recurringTaskManager)try{e.taskStats=G.vmMain.recurringTaskManager.getStats()}catch(t){e.taskStats="Error: "+t.message}if(DETAILED_STATS)try{e.previewCacheStats=require("gdata").getPreviewCacheStats()}catch(t){e.previewCacheStats="Error: "+t.message}try{e.measureStats=require("Measure").getMeasureStats()}catch(t){e.measureStats="Error: "+t.message}},G.getRunningState=function(e){var t;try{G.vmMain.paneManager.hasLoadedPaneState()&&(t=G.vmMain.paneManager.getPaneState())}catch(e){log("Failed to get paneState")}e.isDebug=!1,e.isDemo=G.isDemoMode(),e.localWrites=G.shouldWriteLocal(),e.authUserLoggedIn=G.authUserLoggedIn,e.currentLocalWrites=function(){try{n.storage.setItem("poke",Math.random())}catch(e){return!1}return!0},e.isReconnected=G.isReconnected,e.url=m(window.location.href),e.paneState=t?h(t):"Missing Pane State",e.localSettings=G.settings?u(G.settings.getRawSettings()):"Not Initialized",e.remoteSettingsLoaded=!!G.settings&&G.settings.hasLoadedRemote(),e.loginState=G.getLoginState(),e.checkpoints=window.__checkpoints,e.gapiLoadError=window.gapiLoadError,e.gapiTimeout=window.gapiTimeout,
e.gapiClientLoadError=window.gapiClientLoadError,e.gapiClientTimeout=window.gapiClientTimeout,e.DOMReadyState=document.readyState,e.isKeyboardOpen=G.isKeyboardOpen,e.localStorageQuotaError=n.localStorageQuotaError,e.jsVersion=window.__jsVersion,e.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.eventStream=G.getEventStream(),e.trackerStream=G.getTrackerStream(),e.criticalErrorReported=G.criticalErrorReported(),G.getLoadedScripts(e);try{e.nativesel=G.parseExtra(window.getSelection())}catch(t){e.nativesel="Error: "+t.message}try{e.apiStats=G.getGoogleAPIStats()}catch(t){e.apiStats="Error: "+t.message}try{e.customsel=require("Sel").dumpState()}catch(t){e.customsel="Error: "+t.message}try{e.errorPlatformInfo=JSON.stringify(G.errorPlatformInfo)}catch(t){e.errorPlatformInfo="Error: "+t.message}try{e.validScreens=JSON.stringify(window.Screens)}catch(t){e.validScreens="Error: "+t.message}G.vmMain?(e.isBatchingUpdateItems=G.vmMain.isUpdatingItems(),e.lastActivity=G.vmMain.lastActivity,G.vmMain.root()?e.rootId=G.vmMain.root().id:e.rootId="Undefined Root"):e.rootId="VMMain Not Initialized"},G.getPremiumInfo=function(e){if(G.billingManager){var t={premiumStatus:G.billingManager.getPremiumStatus(),billingIdentifier:G.billingManager.getBillingIdentifier(),btRequested:G.billingManager._braintreeRequested,btLoaded:G.billingManager._braintreeLoaded,ctRequested:G.billingManager._clientTokenRequested,ctLoaded:G.billingManager._clientTokenLoaded,lastSignupError:G.billingManager._lastSignupError};e.premiumInfo=t}else e.premiumInfo="Billing Manager Not Loaded"},G.computeRealtimeLoadStatus=function(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&G.isFunction(window.gapi.drive.realtime.load))}},G.getAppInfo=function(e){var i="Loaded";G.failedGapiLoad?i="ErrorLoading":gapiCalled||(i="NotLoaded");var n=Date.now();e.gapiStatus=i,e.gapiTimeout=window.gapiTimeout,e.sessionID=window.__SESSION_ID,e.sessionStart=window.__SESSION_BEGIN,e.reportTime=n,e.runningTime=n-window.__SESSION_BEGIN,e.appCacheUpdated=J,e.realtimeLoadStatus=this.computeRealtimeLoadStatus(),t.getPlatformInfo(e),G.getRunningState(e),G.getAppStats(e),G.getPremiumInfo(e);try{require("gdata").getState(e)}catch(t){e.gState="ERROR"}try{require("goog").getTokenStats(e)}catch(t){e.tokenStats="ERROR"}try{require("goog").getOAuthData(e)}catch(t){e.oauthData="ERROR"}try{require("data").getDBState(e)}catch(t){e.dbState="ERROR"}try{if(window.gapi&&window.gapi.auth){var r=gapi.auth.getToken();r?(e.tokenScope=r.scope,e.hasIDToken=!!r.id_token):(e.tokenScope="NO TOKEN",e.hasIDToken="NO TOKEN")}else e.tokenScope="NOT LOADED"}catch(t){e.tokenScope="ERROR"}try{e.linkedAccounts=require("AccountManager").getInfo()}catch(t){e.linkedAccounts="ERROR"}try{e.cacheState=require("CacheManager").getInfo()}catch(t){e.cacheState="ERROR"}},G.reportSignup=function(e,t,n){try{G.PAssert(2803,e,"Must specify a valid email address to signup with")}catch(e){G.reportError(e)}try{G.PAssert(2804,t,"Must provide valid signup info in addition to an email address")}catch(e){G.reportError(e)}e&&t&&(G.sendEvent("Subscribe","NewUser"),t.email=e,f(t),G.XHR_PrivateAPI({type:"POST",path:"/tracking/signup",data:t,requireAuth:!0,cb:function(e){200!==e.status?(ShouldLog(LogLevels.Error)&&log("Failed to report signup",e.responseText,e),n&&n(!1)):n&&n(!0)}}),G.reportAdConversion(i.ConversionID.Signup))};var le=!1;G.criticalErrorReported=function(){return le},G.handleCriticalError=function(){le=!0;try{if(G.isDemoMode())G.reload();else{var e=document.createElement("div");e.id="criticalError",e.textContent="There was a critical error while loading the app, "+t.actionVerb()+" to reload.",t.isTouchDevice?e.addEventListener(t.touchStartEvent,function(){G.reload()},!0):e.addEventListener(t.upEvent,function(){G.reload()},!0),G.prependChild(document.body,e),G.removeDOM("outerWrapper"),G.removeDOM("setupWrapper"),G.removeDOM("templates")}}catch(e){G.reportError(e)}},G.hasOnlineBlockingError=function(){return G.isBlocked||navigator.onLine&&G.failedGapiLoad&&!window.gapiCalled||window.gapiTimeout&&!window.gapiCalled},G.hasCookieBlockingError=function(){return G.authImmediateFailed&&G.vmSetup&&G.vmSetup.getPageLoadLoginState()===LoginState.LOGGED_IN},G.safeStringify=function(e){try{return JSON.stringify(e)}catch(e){}},G.reportEvent=function(e){if(!G.isDemoMode()){var t=G.parseExtra(e);t&&G.eventStream.push(t)}},G.getEventStream=function(){return G.eventStream.ordered()},window.__getEventStream=G.getEventStream,G.getTrackerStream=function(){try{return require("tracker").stringifyGroups()}catch(e){log("Error getting tracker stream: ",e.message)}},G.parseExtra=function(e){var t;if(e)try{var i;if(e instanceof window.KeyboardEvent){var n=G.elementToString(e.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(n)<0&&(i={type:e.type,currentTarget:G.elementToString(e.currentTarget),target:n,keyCode:p(e.keyCode),normCode:p(e.normCode),ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()})}else if(e instanceof window.MouseEvent)i={type:e.type,currentTarget:G.elementToString(e.currentTarget),relatedTarget:G.elementToString(e.relatedTarget),target:G.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof window.TouchEvent){i={type:e.type,currentTarget:G.elementToString(e.currentTarget),relatedTarget:G.elementToString(e.relatedTarget),target:G.elementToString(e.target),tstamp:Date.now()};var r=e.touches[0];r&&(i.clientX=r.clientX,i.clientY=r.clientY)}else if(window.PointerEvent&&e instanceof window.PointerEvent)i={type:e.type,currentTarget:G.elementToString(e.currentTarget),relatedTarget:G.elementToString(e.relatedTarget),target:G.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof window.Event)i={type:e.type,name:e.name,code:e.code,message:e.message,currentTarget:G.elementToString(e.currentTarget),relatedTarget:G.elementToString(e.relatedTarget),target:G.elementToString(e.target),tstamp:Date.now()};else if(e instanceof window.Selection)if(0===e.rangeCount)i={rangeCount:0};else{var a=e.getRangeAt(0),s=a.startContainer,o=!1,c=a.endContainer,l=!1;s.nodeType===Node.TEXT_NODE&&(s=s.parentNode,o=!0),c.nodeType===Node.TEXT_NODE&&(c=c.parentNode,l=!0),i={rangeCount:e.rangeCount,startContainer:G.getElementPath(s),startWasTextNode:o,startOffset:a.startOffset,endContainer:G.getElementPath(c),endWasTextNode:l,endOffset:a.endOffset}}else i=e;t=i?G.safeStringify(i):void 0}catch(e){log("Error parsing extra "+e.message)}return t},window.__jsVersion="1525507307692",window.__devServerURL="##DEV_SERVER_URL##";var de=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"];window.__MAX_ERRORS_REPORTED=50,require(["goog"],function(){Rollbar.configure({payload:{environment:t.getDeployVar(DeployVariable.Environment),person:{id:G.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:__jsVersion,guess_uncaught_frames:!0}}},maxItems:__MAX_ERRORS_REPORTED,checkIgnore:g})});var he=0,ue=!1,pe=!1;G.handleJSError=function(e,t,i,n,r){if(n||window.__error("JS Error: "+e,"  Stack: ",t,"  Extra: ",i),e||t){r||(r=LogLevels.Error);try{var a=window.__LOG_BUFFER.ordered().join("\r\n"),s=G.getUserIdentifier();pe||("me"!==s&&(pe=!0),Rollbar.configure({payload:{person:{id:s}},maxItems:__MAX_ERRORS_REPORTED,checkIgnore:g}));var o=G.parseExtra(i);!function(){if(++he<=window.__MAX_ERRORS_REPORTED){var i={};if(!ue){ue=!0;try{G.getAppInfo(i)}catch(e){Rollbar.error(e)}ue=!1}i.numReported=he;var n={url:m(window.location.href),logs:a,info:i,user:s,extra:o,jsVersion:window.__jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"};if(window.Rollbar){var c={message:e,stack:t};r===LogLevels.Error?(Rollbar.error(c,n),G.sendEvent("ErrorReport","Error")):r===LogLevels.Warning?(Rollbar.warning(c,n),G.sendEvent("ErrorReport","Warning")):(Rollbar.error(c,n),G.sendEvent("ErrorReport","Unknown"))}else n.msg=e,n.stack=t,G.XHR_PrivateAPI({type:"POST",path:"/feedback/error",data:n,cb:function(e){200!==e.status?log("Failed to report remote error",e.responseText,e):log("Reported Remote Error: ",e.responseText)}})}}()}catch(i){log("Badness happened reporting errors to server: ",i);try{Rollbar.error({message:e,stack:t}),Rollbar.error(i)}catch(e){log("More badness happened reporting errors to rollbar: ",e)}}}else;},window.onerror=function(e,t,i,n,r){r?(log("Reported Global OnError: "+e+" Script: "+t+" Line: "+i+" Column: "+n),G.reportError(r)):(log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+i+" Column: "+n),G.reportError(e))},G.reportError=function(e,t,i){!e||t||e.message||e.stack?e&&e.e&&G.isString(e.e)&&(e={message:e.e,stack:G.getCurrentStack("")}):(t=e,e=void 0),e||(e={message:"Undefined error passed to reporter",stack:G.getCurrentStack("")}),G.handleJSError(e.message,e.stack,t,!1,i)},window.__SendInfo=function(e){return G.handleJSError("Remote Client Info",void 0,e,!0),"Thank you for providing your client info!"},window.__CreateDebugSession=function(e){if(window.remote)return"Debug session already started";var t=e||v();window.rcon=window.console,G.handleJSError("Remote Debug Session",void 0,t,!0),G.addScript("http://jsconsole.com/remote.js?"+t,"rDebugScript");var i=!1,n=0,r="";return window.rdbg={startProfile:function(e){try{return i?"Profiler already running":(r=e||"RDBGProfile_"+n,window.rcon.profile(r),i=!0,"Profiler Started: "+r)}catch(e){return"Error starting profile: "+e.message}},stopProfile:function(){try{if(i){window.rcon.profileEnd(r),i=!1;var e="Profile Completed: "+r;return r="",n++,e}return"Profiler not running, use startProfile()"}catch(e){return"Error stopping profile: "+e.message}}},"Your remote debug session has started: "+t},(n.hasURLParam("rsession")||n.hasURLParam("rdebug","true"))&&setTimeout(function(){var e=n.getURLParam("rsession")||v();window.__CreateDebugSession(e),log("%c---- REMOTE DEBUGGING ENABLED: "+e+" ----","color: green")},2e3),window.Checkpoint={MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},G.checkpoint=function(e){window.__checkpoints|=e},G.hasSentLowMemoryWarning=!1,G.handleLowMemory=function(e){G.hasSentLowMemoryWarning||(G.hasSentLowMemoryWarning=!0,log("Low Memory Event: ",e),G.isNumber(e)&&(e=Math.round(e/1024/1024)+"MB"))};var me=/function\s+([^(]*?)\s*\(([^)]*)\)/,fe=!0;G.getCurrentStack=function(e){var i;if(fe||t.noErrorStacks)try{i=JSON.stringify(e)}catch(n){log("Error stringifying stack message",n,e)}if(fe){var n=new Error(i||e);if(n.stack)return n.stack}fe=!1;try{for(var r=["GenError: "+(i||e)],a=arguments.callee.caller,s=0;a&&s++<75;){var o,c=a.toString(),l=me.exec(c);o=l&&3===l.length&&""!==l[1]&&void 0!==l[1]?"at "+l[1]+"("+l[2].replace(/[\r\n]/g,"")+")":l&&3===l.length?"at <anonymous> ("+l[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",r.push(o),a=a.caller}return r.join("\n")}catch(e){log("Error generating stack trace",e)}return""};var ge=0;G.checkForRemoteChanges=function(){var e=Date.now();if(ge-e>=12e5)try{G.AppCache&&G.AppCache.checkForUpdate(),G.vmMain&&G.vmMain.vmPicker&&G.vmMain.vmPicker.refreshFiles()}catch(e){G.reportError(e)}finally{ge=e}},G.protectFn=y,function(){var e=function(e){var t=window[e];window[e]=function(){var e=Array.prototype.slice.call(arguments),i=e[0];return"function"==typeof i&&(e[0]=y(i)),t.apply?t.apply(this,e):t(e[0],e[1])}};e("setTimeout"),e("setInterval")}();var ve=t.mobile?30:50;window.__LOG_BUFFER=new r(ve);var ye=window.log;G.isDemoMode()||(window.log=function(){try{window.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(e){window.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}console.log.apply(console,arguments)},window.__log=function(){try{window.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(e){window.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}});try{window.console.error=function(){try{var e=arguments[0],t=arguments[1];2===arguments.length&&G.isString(e)&&G.isString(t)?G.reportError({message:e,stack:t}):window.__error.apply(window,arguments)}catch(e){window.__error.apply(window,arguments),G.reportError(e)}}}catch(e){G.reportError(e),log("Unable to override console.error")}for(var be in ye)window.log[be]=ye[be];G.getObjectInfo=function(e){try{if(e&&e.constructor)return e.constructor.name}catch(e){G.reportError(e)}return typeof e},G.packedFnToString=function(e){for(var t="",i=0;i<e.length;++i)t+=e[i]+".";return t},G.unpackFn=function(e,t){try{G.PAssert(2806,G.isFunction(e)||G.isArray(e),"Must supply either a valid function or packed function")}catch(e){G.reportError(e)}var i=NaN;if(G.isFunction(e))i=e;else if(e)try{i=t||window;for(var n=0;n<e.length;++n){try{G.PAssert(2807,G.isString(e[n]),"Packed fns must only contain strings: "+n)}catch(e){G.reportError(e)}try{G.PAssert(2808,i,"Must be able to unpack each step in object chain: "+e[n]+" in "+G.packedFnToString(e))}catch(e){G.reportError(e)}if(!i){i=NaN;break}i=i[e[n]]}}catch(e){G.reportError(e),i=NaN}return i},G.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},G.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},G.isString=function(e){return"string"==typeof e},G.isObject=function(e){return"object"==typeof e&&null!==e&&!G.isArray(e)},G.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},G.isBoolean=function(e){return!0===e||!1===e},G.isAnything=function(e){return!0},G.isValidColor=function(e){var t=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;return G.isString(e)&&null!==t.exec(e)},G.parseInt=function(e){return parseInt(e,10)},G.parseBoolean=function(e){return!0===e||"true"===e},G.parseDate=function(e){var t=new Date(e);return G.isDateValid(t)?t:void 0},G.isValidChangeType=function(e){if(void 0!==e&&null!==e){var t=e&~ChangeType.All;if(G.inMaskOnly(e,ChangeType.Valid))return(t&ChangeType.Locations)===ChangeType.None||G.isOneFlagSet(t,ChangeType.Local|ChangeType.Remote|ChangeType.Auto)}return!1},G.isRemoteChange=function(e){try{G.PAssert(2809,G.isValidChangeType(e),"Must supply a valid changeType")}catch(e){G.reportError(e)}var t=e&~ChangeType.All;return G.isValidChangeType(e)&&G.isFlagSet(t,ChangeType.Remote)},G.isUndoRedoChange=function(e){try{G.PAssert(2810,G.isValidChangeType(e),"Must supply a valid changeType")}catch(e){G.reportError(e)}var t=e&~ChangeType.All;return G.isValidChangeType(e)&&G.isFlagSet(t,ChangeType.UndoRedo)},G.isLocalChange=function(e){try{G.PAssert(2811,G.isValidChangeType(e),"Must supply a valid changeType")}catch(e){G.reportError(e)}var t=e&~ChangeType.All;return G.isValidChangeType(e)&&G.isFlagSet(t,ChangeType.Local)},G.isAutoChange=function(e){try{G.PAssert(2812,G.isValidChangeType(e),"Must supply a valid changeType")}catch(e){G.reportError(e)}var t=e&~ChangeType.All;return G.isValidChangeType(e)&&G.isFlagSet(t,ChangeType.Auto)},G.changeToString=function(e){try{G.PAssert(2813,void 0!==e,"Must supply a valid changeType")}catch(e){G.reportError(e)}var t=[];G.forEachFlagSet(e,function(e){switch(e){case ChangeType.Local:t.push("Local");break;case ChangeType.Remote:t.push("Remote");break;case ChangeType.Auto:t.push("Auto");break;case ChangeType.Structure:t.push("Structure");break;case ChangeType.Text:t.push("Text");break;case ChangeType.Property:t.push("Property");break;case ChangeType.Rollover:t.push("Rollover");break;case ChangeType.DocLoad:t.push("DocLoad");break;case ChangeType.ItemLoad:t.push("ItemLoad");break;case ChangeType.UndoRedo:t.push("UndoRedo");break;case ChangeType.PluginLoad:t.push("PluginLoad");break;default:t.push("Unknown:"+e)}});return"[ "+(0===t.length?"None":t.join(" "))+" ]"},G.isDOMNode=function(e){return window.HTMLElement?e instanceof HTMLElement:e&&e.tagName&&e.nodeType===Node.ELEMENT_NODE},G.isTextNode=function(e){return e&&e.nodeType===Node.TEXT_NODE},G.ensureDOMNode=function(e){var t;return G.isDOMNode(e)?t=e:G.isTextNode(e)&&(t=e.parentElement),t},G.enumToString=function(e,t){for(var i in e)if(e[i]===t)return i;return null},G.elementToString=function(e,t){if(e){var i=e.nodeName;return e.id&&(i+="#"+e.id),e.className&&(i+="."+e.className.replace(/ /g,".")),t&&e.innerText&&(i+=":"+e.innerText.length),i}return"UNDEFINED"},G.getElementPath=function(e,t){var i=!0,n="";try{for(;e&&"container"!==e.id&&e!==document.documentElement&&e!==document.body;)n+=i?G.elementToString(e,t)+" ":G.elementToString(e)+" ",i=!1,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e.parentElement}catch(e){n+=e.message}return n};G.setupClick=function(e,n,r){function a(e,t){try{G.PAssert(2817,!n.isDestroyed||!n.isDestroyed(),"Owner must not be destroyed to handle a click")}catch(e){G.reportError(e)}return r[e].call(n,t)}function s(e){var t=e.eventX-this.lastX,i=e.eventY-this.lastY;if(0!==t||0!==i){var n=!this.moved;if(this.lastX=e.eventX,this.lastY=e.eventY,e.distanceX=this.distanceX=this.distanceX+Math.abs(t),e.distanceY=this.distanceY=this.distanceY+Math.abs(i),(this.moved||e.distanceX>G.ClickThreshold||e.distanceY>G.ClickThreshold)&&(this.moved=!0,e.moved=this.moved),(r.onMove||r.onFirstMove)&&(e.diffX=e.eventX-this.startX,e.diffY=e.eventY-this.startY,e.xThisFrame=t,e.yThisFrame=i,e.startX=this.startX,e.startY=this.startY,e.startClientX=this.startClientX,e.startClientY=this.startClientY,e.startSrc=this.startSrc,n&&r.onFirstMove&&a("onFirstMove",e),r.onMove)){a("onMove",e)&&e.stopImmediatePropagation()}}}function o(e){var n=Date.now(),s=this.lastTouch||n,o=Math.max(0,n-s);this.numClicks?this.numClicks++:this.numClicks=1,e.moved=this.moved,e.timeDelta=o,e.diffX=this.lastX-this.startX,e.diffY=this.lastY-this.startY,e.startX=this.startX,e.startY=this.startY,e.startSrc=this.startSrc,this.startSrc=void 0,o<i.DoubleClickTime&&o>0&&r.onDoubleClick&&!this.moved&&a("onDoubleClick",e),isNaN(e.button)||e.button===ButtonCode.Left?(this.lastTouch=n,!r.onClick||this.moved||t.mac&&e.ctrlKey||a("onClick",e),r.onEnd&&a("onEnd",e)):e.button===ButtonCode.Middle&&r.onMiddleClick&&!this.moved&&a("onMiddleClick",e),setTimeout(function(){this.lastTouch=void 0,this.numClicks=void 0}.bind(this),i.DoubleClickTime)}function c(e){r.onCancel&&a("onCancel",e)}function l(e){e.timeStart=this.timeStart=Date.now(),this.startSrc=e.target,e.startSrc=e.target,this.moved=!1,e.startX=this.startX=e.eventX,e.startY=this.startY=e.eventY,e.startClientX=this.startClientX=e.clientX,e.startClientY=this.startClientY=e.clientY,this.lastX=e.eventX,this.lastY=e.eventY,this.distanceX=0,this.distanceY=0,(isNaN(e.button)||e.button===ButtonCode.Left||e.button===ButtonCode.Right)&&((isNaN(e.button)||e.button===ButtonCode.Left)&&r.onStart?a("onStart",e):e.button===ButtonCode.Right&&r.onRightStart&&a("onRightStart",e)),isNaN(e.changeLastY)||(this.lastY+=e.changeLastY)}function d(i){var n=t.ie?i:i.touches[0];if(i.eventX=n.pageX,i.eventY=n.pageY,i.clientX=n.clientX,i.clientY=n.clientY,s.call(e,i),i.returnFalse)return!1}function h(i){document.removeEventListener(t.touchMoveEvent,C,S),document.removeEventListener(t.touchEndEvent,P,S),document.removeEventListener(t.touchCancelEvent,T,S);var n=t.ie?i:i.changedTouches[0];if(i.eventX=n.pageX,i.eventY=n.pageY,i.clientX=n.clientX,i.clientY=n.clientY,o.call(e,i),i.returnFalse)return!1}function u(i){if(document.removeEventListener(t.touchMoveEvent,C,S),document.removeEventListener(t.touchEndEvent,P,S),document.removeEventListener(t.touchCancelEvent,T,S),c.call(e,i),i.returnFalse)return!1}function p(i){if(!i.handled){this.lastInputTouch=!0;var n=t.ie?i:i.touches[0];return i.eventX=n.pageX,i.eventY=n.pageY,i.clientX=n.clientX,i.clientY=n.clientY,l.call(e,i),i.ignore||(document.addEventListener(t.touchMoveEvent,C,S),document.addEventListener(t.touchEndEvent,P,S),document.addEventListener(t.touchCancelEvent,T,S)),!i.returnFalse&&void 0}}function m(t){if(!this.lastInputTouch)return t.eventX=t.pageX,t.eventY=t.pageY,s.call(e,t),!t.returnFalse&&void 0}function f(i){if(!i.handled&&!this.lastInputTouch)return document.removeEventListener(t.moveEvent,M,S),document.removeEventListener(t.upEvent,_,S),i.button===ButtonCode.Left&&o.call(e,i),!i.returnFalse&&void 0}function g(i){if(!i.handled&&!this.lastInputTouch)return this.lastInputTouch=!1,i.eventX=i.pageX,i.eventY=i.pageY,l.call(e,i),i.ignore||(i.button===ButtonCode.Left&&document.addEventListener(t.moveEvent,M,S),document.addEventListener(t.upEvent,_,S)),!i.returnFalse&&void 0}function v(e){e.handled||this.lastInputTouch||r.onRightClick&&a("onRightClick",e)}function y(e){return e.preventDefault(),e.stopImmediatePropagation(),!1}try{G.PAssert(2815,e,"Expecting an object to bind the click handlers to.")}catch(e){G.reportError(e)}try{G.PAssert(2816,n,"Must specify a valid owner for click handlers")}catch(e){G.reportError(e)}n||(n=e);var S=!1;G.isFunction(r)?r={onClick:r}:r&&r.useCapture&&(S=r.useCapture);var E=b(p),C=b(d),P=b(h),T=b(u),D=b(g),M=b(m),_=b(f),I=b(v);return t.isTouchDevice&&t.isMobileBrowser?e.addEventListener(t.touchStartEvent,E,S):e.addEventListener(t.downEvent,D,S),t.usePointerEvents&&t.mobile&&e.addEventListener("mousedown",y,S),r.onRightClick&&!t.mobile&&e.addEventListener("contextmenu",I,S),this},"function"!=typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(e,t){if(!e)return this;for(var i=0,n=e.length;i<n;++i){for(var r=!0,a=0,s=this.length;a<s;++a)if(t&&t(e[i],this[a])||!t&&e[i]===this[a]){r=!1;break}r&&this.push(e[i])}return this}),"function"!=typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(e){try{G.PAssert(2819,G.isArray(e),"Must only supply array to remove: "+typeof Array)}catch(e){G.reportError(e)}return this.push.apply(this,e)}),"function"!=typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(e){try{G.PAssert(2820,G.isArray(e),"Must only supply array to remove: "+typeof Array)}catch(e){G.reportError(e)}return this.filter(function(t){return!e||e.indexOf(t)<0})}),"function"!=typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(e){return this.splice(e,1)[0]}),"function"!=typeof Array.prototype.remove&&(Array.prototype.remove=function(e,t){var i=this.indexOf(e,t);return i>=0&&this.removeAt.call(this,i),i}),"function"!=typeof Array.prototype.equals&&(Array.prototype.equals=function(e){if(!e)return!1;if(this.length!==e.length)return!1;for(var t=0,i=this.length;t<i;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!==e[t]&&!S(this[t],e[t]))return!1;return!0}),"function"!=typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(e,t){try{G.PAssert(2821,void 0!==t,"Called indexOfWithProperty with an undefined value")}catch(e){G.reportError(e)}for(var i=0;i<this.length;i++)if(this[i][e]===t)return i;return-1}),"function"!=typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(e,t){try{G.PAssert(2822,void 0!==e&&null!==e,"Require a valid element to insert")}catch(e){G.reportError(e)}try{G.PAssert(2823,t,"Require a valid comparison function")}catch(e){G.reportError(e)}for(var i=0,n=this.length-1;i<=n;){var r=i+n>>1,a=t(this[r],e);if(a<0)i=r+1;else{if(!(a>0))return r;n=r-1}}return i}),G.numberComparator=function(e,t){return e-t},"function"!=typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(e,t){var i=this.findInsertIndex(e,t);if(0===t(this[i],e))return this[i]}),"function"!=typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(e,t){var i=this.findInsertIndex(e,t);return this.splice.apply(this,[i,0,e]),i}),G.insertIntoText=function(e,t,i){try{G.PAssert(2824,i<=e.length)}catch(e){G.reportError(e)}return e.substr(0,i)+t+e.substr(i,e.length-i)},e.observableArray.fn.insertSorted=function(e,t){this.valueWillMutate();var i=this.peek().insertSorted(e,t);return this.valueHasMutated(),i},G.arrayUnion=function(e,t){for(var i=[],n=0;n<e.length;n++)i.indexOf(e[n])<0&&i.push(e[n]);for(var n=0;n<t.length;n++)i.indexOf(t[n])<0&&i.push(t[n]);return i},G.arrayDiff=function(e,t){for(var i=[],n=0;n<e.length;n++)t.indexOf(e[n])<0&&i.push(e[n]);for(var n=0;n<t.length;n++)e.indexOf(t[n])<0&&i.push(t[n]);return i},G.arrayIntersection=function(e,t){for(var i=[],n=0;n<e.length;n++)t.indexOf(e[n])>=0&&i.push(e[n]);return i},G.arrayUniques=function(e,t){e=e||[];var i=[];if(t)for(var n=0;n<e.length;++n){for(var r=!0,a=e[n],s=0;s<i.length;++s)if(t(a,i[s])){r=!1;break}r&&i.push(a)}else for(var n=0,s=e.length;n<s;n++)i.indexOf(e[n])<0&&i.push(e[n]);return i},G.mergeObjects=function(e,t){var i=Array.isArray(t),n=i&&[]||{};return i?(e=e||[],n=n.concat(e),t.forEach(function(t,i){void 0===n[i]?n[i]=t:"object"==typeof t?n[i]=G.mergeObjects(e[i],t):-1===e.indexOf(t)&&n.push(t)})):(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){n[t]=e[t]}),Object.keys(t).forEach(function(i){"object"==typeof t[i]&&t[i]&&e[i]?n[i]=G.mergeObjects(e[i],t[i]):n[i]=t[i]})),n};var Se={};G.loadGoogleAPI=function(e,t,i,n){try{G.PAssert(2826,e,"Must supply a valid API name")}catch(e){G.reportError(e)}try{G.PAssert(2827,t,"Must supply a valid API version")}catch(e){G.reportError(e)}try{G.PAssert(2828,i,"Must supply a valid cb")}catch(e){G.reportError(e)}if(window.gapi&&window.gapi.client){var r=Se[e];if(r){try{G.PAssert(2829,r.version===t,"Must only load a single version of an API")}catch(e){G.reportError(e)}r.isLoaded?i():(r.successCBs.push(i),n&&r.timeoutCBs.push(n))}else Se[e]=r={api:e,version:t,isLoaded:!1,numRetries:0,lastTimeout:0,timer:void 0,successCBs:[i],timeoutCBs:[]},n&&r.timeoutCBs.push(n),window.gapi.client.load(e,t,E.bind(window,r))}else{var a=function(){try{G.PAssert(2830,window.gapi&&window.gapi.client,"Must have properly loaded the gapi client lib")}catch(e){G.reportError(e)}G.removeCustomEventListener("gapiLoaded",a),G.loadGoogleAPI(e,t,i,n)};G.addCustomEventListener("gapiLoaded",a)}},G.setupGoogleAPIListener=function(){window.addEventListener("online",function(){for(var e in Se){var t=Se[e];!t.isLoaded&&t.timer&&(clearTimeout(t.timer),t.timer=setTimeout(function(){window.gapi.client.load(t.api,t.version,E.bind(window,t))},1e3*Re[1]))}})},G.getGoogleAPIStats=function(){var e={};if(window.gapi&&window.gapi.client)for(var t in Se){var i=Se[t],n={api:i.api,version:i.version,isLoaded:i.isLoaded,numRetries:i.numRetries,lastTimeout:i.lastTimeout,hasTimeout:!!i.timer};if(i.isLoaded)try{n.isAccessible=!!window.gapi.client[t]}catch(e){n.isAccessible=!1}else n.isAccessible=!1;e[t]=n}else e.error="GAPI Client not loaded";return e},G.clamp=function(e,t,i){return Math.max(t,Math.min(i,e))},G.pad2=function(e){return e=""+e,1===e.length?"0"+e:""+e},G.randParam=function(){return"?t="+Date.now()},G.createPath=function(e){return window.location.protocol+"//"+window.location.host+"/"+e},G.addScript=function(e,t,i,n){try{G.PAssert(2831,!t||null===document.getElementById(t),"Should never include the same script ID multiple times")}catch(e){G.reportError(e)}var r=document.createElement("script");r.src=e,t&&(r.id=t),i&&C(r,i,n);try{G.PAssert(2832,void 0!==r,"Should always be able to create a valid script object")}catch(e){G.reportError(e)}void 0!==r&&document.getElementsByTagName("head")[0].appendChild(r)},G.addScriptHack=function(e,t,i,n){window.define.amd=void 0,G.addScript(e,t,function(){window.define.amd={jQuery:!0},i&&i()},function(){window.define.amd={jQuery:!0},n&&n()})},G.addStylesheet=function(e,t,i){var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t&&C(n,t,i),void 0!==n&&document.getElementsByTagName("head")[0].appendChild(n)},G.reportGapiScriptError=function(e,t){log("Failed to load GAPI!",t),G.failedGapiLoad=!0,G.blockedMessage="An extension has blocked apis.google.com from loading.",G.vmMain?G.vmMain.handleGapiLoadError():require(["Dispatcher"],function(e){e.listen("VMMainLoaded",function(){G.vmMain.handleGapiLoadError()})})},G.reportGapiScriptLoad=function(e,t){},G.DAssert=function(){},G.PAssert=function(e,t){if(!t){var i={isAssert:!0,tag:e};try{var n=P(Array.prototype.slice.call(arguments,2));arguments.length>2?log("Assert Failure "+e+": "+n):log("Assert Failure "+e),G.reportError(new Error("Assert Failure: "+n),i,LogLevels.Warning)}catch(t){log("Exception in PAssert "+e+": ",t),G.reportError(t,i)}}},G.getElementParent=function(e){for(;e;){if(G.hasClass(e,"item")||G.hasClass(e,"paneHiddenInput"))return e;e=e.parentNode}};var Ee=0;G.getPreviousItem=function(e,t,i){return Ee++,M(e,t,i)},G.getNextItem=function(e,t,i){return Ee++,_(e,t,i)},G.getFirstItem=function(e,t){try{G.PAssert(2925,e.belongsToSameItemStore(t),"Must match item stores")}catch(e){G.reportError(e)}if(e.id===t.id||t.parent().id===e.id)return e;if(e.parent().id===t.id)return t;var i,n,r=e,a=void 0;do{i=t,n=void 0;do{if(r.id===i.id){if(void 0===a)return e;if(void 0===n)return t;try{G.PAssert(2926,r.id===n.parent().id,"Must share a common parent")}catch(e){G.reportError(e)}try{G.PAssert(2927,r.id===a.parent().id,"Must share a common parent")}catch(e){G.reportError(e)}try{G.PAssert(2928,a.id!==n.id,"If both previous items match, they should have been the common ancestor")}catch(e){G.reportError(e)}return a.getIndex()<n.getIndex()?e:t}n=i}while(void 0!==(i=i.parent()));a=r}while(void 0!==(r=r.parent()));try{G.PAssert(2929,!1,"One item must appear first in the tree")}catch(e){G.reportError(e)}},G.animateTransform=function(e,i){function n(){i.clearTransform&&(e.style[t.transform.style]="",e.style[t.transformOrigin.style]=""),i.onComplete&&i.onComplete()}try{G.PAssert(2930,e,"Must supply a valid element to transform")}catch(e){G.reportError(e)}try{G.PAssert(2931,i,"Options must always be defined")}catch(e){G.reportError(e)}if(e){var r=i.transform;if(!isNaN(i.delay)){var a=i.delay;return i.delay=void 0,void setTimeout(G.animateTransform,a,e,i)}if(i.time){var s=G.getTransitionClass(i.time);G.addClass(e,s),setTimeout(function(){G.removeClass(e,s),n()},i.time)}else n();isNaN(i.opacity)||(e.style.opacity=i.opacity),r||isNaN(i.left)||isNaN(i.top)||(r="translate3d("+i.left+"px, "+i.top+"px, 0)"),i.origin&&(e.style[t.transformOrigin.style]=i.origin),e.style[t.transform.style]=r}},G.easeOut=function(e,t,i){return-i*e*(e-2)+t};var Ce={};G.scrollTo=function(e,t,i,n,r){function a(u){h||(h=u-20);var p=Math.min((u-h)/i,1);if(void 0!==e){var m=G.easeOut(p,o,c);n.scrollLeft=m}if(void 0!==t){var f=G.easeOut(p,l,d);n.scrollTop=f}1===p?(delete Ce[s],r&&r()):Ce[s]=requestAnimationFrame(a)}try{G.PAssert(2932,void 0!==e||void 0!==t,"Must be scrolling something")}catch(e){G.reportError(e)}try{G.PAssert(2933,void 0===e||G.isNumber(e),"Must provide a valid scrollPosX")}catch(e){G.reportError(e)}try{G.PAssert(2934,void 0===t||G.isNumber(t),"Must provide a valid scrollPosY")}catch(e){G.reportError(e)}try{G.PAssert(2935,G.isNumber(i),"Must provide a valid duration")}catch(e){G.reportError(e)}try{G.PAssert(2936,G.isDOMNode(n),"Must provide a valid element to scroll")}catch(e){G.reportError(e)}try{G.PAssert(2937,!r||G.isFunction(r),"Must provide a valid scrollDone callback")}catch(e){G.reportError(e)}var s=n.getAttribute("data-moo-id")||n.id;try{G.PAssert(2938,s,"Should only scroll elements with ids")}catch(e){G.reportError(e)}if(Ce[s]&&(cancelAnimationFrame(Ce[s]),delete Ce[s]),!n)return void G.reportError(new Error("Must specify an element to scroll to"));if(i>0){if(void 0!==e)var o=n.scrollLeft,c=e-o;if(void 0!==t)var l=n.scrollTop,d=t-l;var h;(Math.abs(c)>0||Math.abs(d)>0)&&(Ce[s]=requestAnimationFrame(a))
}else n&&(void 0!==e&&(n.scrollLeft=e),void 0!==t&&(n.scrollTop=t)),r&&r()},G.computeScrollSpeed=function(e,t,i){return i=G.clamp(i,e,t),(t-e-(t-i))/(t-e)};var Pe={speed:0,pane:void 0},Te=!1;G.repeatScroll=function(e,t){try{G.PAssert(2939,t&&!G.isString(t),"Must pass a valid pane object to repeatScroll")}catch(e){G.reportError(e)}Pe.speed=e,Pe.pane=t,Te||(Te=!0,requestAnimationFrame(I))},G.cancelRepeatScroll=function(){Te=!1},G.elementInPane=function(e){if(e)for(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);e;){if(G.hasClass(e,"pane")||G.hasClass(e,"paneOverview"))return!!e;e=e.parentElement}return!1},G.elementInPaneEdit=function(e){var t=!1,i=G.getPaneForElement(e);return i&&G.isAncestor(e,i.getContentElement())&&(t=!0),t},G.elementInNonPaneEdit=function(e){var t=!1;if(e&&(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),!G.elementInPaneEdit(e)))for(;e;){if(G.isKeyboardInputElement(e)){t=!0;break}e=e.parentElement}return t},G.isNonPaneDropTarget=function(e){var t=!1;return G.elementInNonPaneEdit(e)?t=!0:G.findParent(e,"validDropTarget")&&(t=!0),t},G.scrollIntoView=function(e,i,n){try{G.PAssert(2940,G.isDOMNode(e),"Must supply a valid DOM node to scroll into view")}catch(e){G.reportError(e)}try{G.PAssert(2941,G.isNumber(i)&&i>=0,"Must supply a valid scroll duration")}catch(e){G.reportError(e)}try{G.PAssert(2942,!n||G.isFunction(n),"Callback must be a function")}catch(e){G.reportError(e)}try{G.PAssert(2943,!G.getReactCell(e),"Use methods on VMPane to scroll VMLIs")}catch(e){G.reportError(e)}var r=!1;if(e){var a=G.findParent(e,"scroller")||G.findParent(e,"fancyScrollContent");try{G.PAssert(2944,a,"Every element must be a child of a scroller to be able to scroll it into view")}catch(e){G.reportError(e)}try{G.PAssert(2945,!G.hasClass(a,"customScroller"),"Must not be scrolling this way, use methods on VMPane instead")}catch(e){G.reportError(e)}if(a){var s,o=a.getBoundingClientRect(),c=o.bottom,l=e.getBoundingClientRect(),d=Math.min(l.bottom,l.top+80),h=a.scrollTop;if(t.mobile){var u=t.orientation===Orientation.Landscape?G.topBarHeight:120;c=Math.max(o.top+u,c-400)}l.top<o.top?s=h+l.top-o.top:d>c&&l.top>o.top&&(s=h+d-c),void 0!==s&&(G.scrollTo(void 0,s,i,a,n),r=!0)}}return r},G.isKeyboardInputElement=function(e){if(e){if("checkbox"===e.type)return!1;if("INPUT"===e.nodeName||"textarea"===e.type||G.findParentAttr(e,"contenteditable","true"))return!0}return!1},G.openKeyboardOnIndex=function(e,t,i,n,r){G.batchRenderUpdates(function(){G._openKeyboardOnIndex(e,t,i,n,r)})},G._openKeyboardOnIndex=function(e,n,r,a,s){try{G.PAssert(2946,t.mobile,"Should only be opening keyboard on mobile devices")}catch(e){G.reportError(e)}var o=n.getScrollOffset(),c=!1;if(G.keyboardToolbar.preShow(),!G.isKeyboardOpen){var l=function(){a&&a(),t.iosui&&G.keyboardToolbar.show(i.KeyboardToolbarMode.Item),G.enforceScroll()};n.addPadding(),t.app||t.android||t.mobileie?c=n.scrollIndexIntoView(r,t.keyboardOpenTime,l):(c=n.scrollIndexIntoView(r,t.keyboardOpenTime),l()),G.keyboardToolbar.hideTopBarIfLandscape()}return c&&t.app&&!t.android&&!t.ioswk||(a&&a(),G.keyboardToolbar.show(i.KeyboardToolbarMode.Item)),_e=n,Ie=s,Ae=o,Me=De.Item,t.ios&&G.preventClick(),e.preventDefault(),e.stopImmediatePropagation?e.stopImmediatePropagation():e.stopPropagation(),e.returnFalse=!0,G.enforceScroll(),c},G.openKeyboardOnElement=function(e,n,r,a){try{G.PAssert(2947,t.mobile,"Should only be opening keyboard on mobile devices")}catch(e){G.reportError(e)}try{G.PAssert(2948,G.isDOMNode(n),"Must supply a valid element")}catch(e){G.reportError(e)}var s,o;if(n){s=G.findParent(n,"scroller");try{G.PAssert(2949,!G.hasClass(n,"paneScroller"),"Must never scroll a custom scroller this way")}catch(e){G.reportError(e)}o=s?s.scrollTop:0}var c=!1;if(G.keyboardToolbar.preShow(),!G.isKeyboardOpen){var l=function(){G.keyboardToolbar.show(i.KeyboardToolbarMode.Modal),r&&r(),G.enforceScroll()};A(s),t.app&&!t.ioswk||t.android||t.mobileie?c=G.scrollIntoView(n,t.keyboardOpenTime,l):(c=G.scrollIntoView(n,t.keyboardOpenTime),l()),G.keyboardToolbar.hideTopBarIfLandscape()}return c&&t.app&&!t.android||(r&&r(),G.keyboardToolbar.show(i.KeyboardToolbarMode.Modal)),_e=s,Ie=a,Ae=o,Me=De.Element,t.ios&&G.preventClick(),e.stopImmediatePropagation(),e.returnFalse=!0,G.enforceScroll(),c};var De={None:0,Item:1,Element:2},Me=De.None,_e=void 0,Ie=void 0,Ae=0;G.closeKeyboard=function(){t.mobile&&G.batchRenderUpdates(G._closeKeyboard)},G._closeKeyboard=function(){X&&X.reset(),G.blurActiveElement()},G.onCloseKeyboardItem=function(){G.isKeyboardOpen&&(_e.addPadding(),_e.setScrollOffset(Ae,t.keyboardOpenTime),G.isKeyboardOpen=!1,Ie&&Ie())},G.onCloseKeyboardElement=function(){if(G.isKeyboardOpen){try{G.PAssert(2950,_e,"Must have a valid scroller")}catch(e){G.reportError(e)}G.scrollTo(void 0,Ae,t.keyboardOpenTime,_e),G.isKeyboardOpen=!1,Ie&&Ie()}},G.onCloseKeyboard=function(){Me===De.Item?G.onCloseKeyboardItem():Me===De.Element&&G.onCloseKeyboardElement()},G.blurActiveElement=function(e){G.ignoreSelectionChange=!!e,document.activeElement&&document.activeElement.blur(),setTimeout(function(){G.ignoreSelectionChange=!1},100)},G.preventScrollPropagation=function(e){try{G.PAssert(2951,G.isDOMNode(e),"Must pass in a valid element")}catch(e){G.reportError(e)}try{G.PAssert(2952,!G.hasClass(e,"customScroller"),"Should not prevent scroll prop on pane")}catch(e){G.reportError(e)}return e.scrollHeight!==e.clientHeight&&(0===e.scrollTop?e.scrollTop=1:e.scrollTop+e.offsetHeight>=e.scrollHeight&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1),!0)},G.trimString=function(e){e=e.replace(/^\s\s*/,"");for(var t=/\s/,i=e.length;t.test(e.charAt(--i)););return e.slice(0,i+1)},G.enforceScroll=function(e,i){(e||(t.ios||t.android)&&(!t.app||t.ios71))&&(setTimeout(function(){window.scrollTo(0,i||0)},0),requestAnimationFrame(function(){window.scrollTo(0,i||0)}),window.scrollTo(0,i||0),document.body.scrollTop=0)},G.preventDefault=function(e){if(e&&e.preventDefault)e.preventDefault();else try{G.PAssert(2982,!1,"Invalid event object: "+e)}catch(e){G.reportError(e)}},G.stopPropagation=function(e){if(e&&e.stopPropagation)e.stopPropagation();else try{G.PAssert(2983,!1,"Invalid event object: "+e)}catch(e){G.reportError(e)}},G.preventClick=function(){G.addClass(G.element("outerWrapper"),"noClick"),window.ontouchstart=G.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,G.removeClass(G.element("outerWrapper"),"noClick")})},G.searchVMLIs=function(e){try{G.PAssert(2984,e,"Must supply a valid options param")}catch(e){G.reportError(e)}G.vmMain.notifySearchStart();try{if(e.itemStoreFilter){G.vmMain.itemStoreManager.runForEachStore(function(t){var i=e.item;k(i&&i.belongsToItemStore(t)?i:t.getRoot(),e)},e.itemStoreFilter)}else if(e.item){try{G.PAssert(2985,!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(e){G.reportError(e)}k(e.item,e)}else if(e.itemStore){try{G.PAssert(2986,!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(e){G.reportError(e)}k(e.itemStore.getRoot(),e)}else{try{G.PAssert(2987,!1,"Must specify a valid search root, using the default root is deprecated")}catch(e){G.reportError(e)}G.vmMain.itemStoreManager.getDefaultItemStore().getRoot()}}catch(e){G.reportError(e)}G.vmMain.notifySearchEnd()},G.searchVMLIsAsArray=function(e){var t=[];return e.each=function(e){t.push(e)},G.searchVMLIs(e),t},G.getActiveSearch=function(){return G.focusedPane.search},G.invertObject=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t},G.fieldMapOut=G.invertObject(G.fieldMapIn),G.translateFieldIn=function(e){try{G.PAssert(2991,G.fieldMapIn[e],"Incoming field should be added to the field map",e)}catch(e){G.reportError(e)}try{G.PAssert(2992,"string"==typeof e,"Should only pass strings to the field mapping function",e)}catch(e){G.reportError(e)}return G.fieldMapIn[e]||e},G.translateFieldOut=function(e){try{G.PAssert(2993,G.fieldMapOut[e],"Incoming field should be added to the field map",e)}catch(e){G.reportError(e)}try{G.PAssert(2994,"string"==typeof e,"Should only pass strings to the field mapping function",e)}catch(e){G.reportError(e)}return G.fieldMapOut[e]||e},G.translateObjIn=function(e){return x(e,G.fieldMapIn)},G.translateObjOut=function(e){return x(e,G.fieldMapOut)};var we={};G.addCustomEventListener=function(e,t,i){try{G.PAssert(2995,e,"Must provide a valid event name")}catch(e){G.reportError(e)}try{G.PAssert(2996,t,"Must provide a valid event handler to add")}catch(e){G.reportError(e)}if(void 0!==i){var n=we[e],r={fn:t,pri:i};n?we[e].insertSorted(r,function(e,t){return e<t?1:-1}):(we[e]=[r],window.addEventListener(e,function(t){for(var i=0;i<we[e].length;++i){if(!1===we[e][i].fn(t))break}}))}else window.addEventListener(e,t)},G.removeCustomEventListener=function(e,t,i){try{G.PAssert(2997,e,"Must provide a valid event name")}catch(e){G.reportError(e)}try{G.PAssert(2998,t,"Must provide a valid event handler to remove")}catch(e){G.reportError(e)}if(i){for(var n=we[e],r=!1,a=0;a<n.length;++a)if(n[a].fn===t){r=!0,n.removeAt(a);break}n.length;try{G.PAssert(2999,r,"Event listener should always be found when removing")}catch(e){G.reportError(e)}}else window.removeEventListener(e,t)},G.fireCustomEvent=function(e,t,i){if(document.createEvent){var n=document.createEvent("Event");return t&&(n.data=t),n.initEvent(e,!0,!0),(i||window).dispatchEvent(n)}try{G.PAssert(3e3,!1,"Unable to fire custom event")}catch(e){G.reportError(e)}},G.fireKeyEvent=function(e,t,i){R(e,"keydown",t),R(e,"keypress",i||t),R(e,"keyup",t)},G.fireClickEvent=function(e,t){O(e,"mousedown",t),O(e,"mouseup",t),O(e,"mouseclick",t)},G.fireMouseUp=function(e,t){O(e,"mouseclick",t)},G.fireDragStart=function(e){O(e,"mousedown",ButtonCode.Left,{offsetX:10,offsetY:10,clientX:10,clientY:10})},G.fireDragMove=function(e,t,i){if(e||(e=Y.getSelectionNode()),document.createEvent){var n=document.createEvent("Event");n.pageX=t,n.pageY=i,n.synthetic=!0,n.initEvent("mousemove",!0,!0),e.dispatchEvent(n)}else try{G.PAssert(3007,!1,"Unable to fire click event")}catch(e){G.reportError(e)}},G.fireDragEnd=function(e){O(e,"mouseup",ButtonCode.Left)},G.clone=function(e,t){var i={};for(var n in e)e.hasOwnProperty(n)&&(t&&G.isFunction(e[n])||(i[n]=e[n]));return i},G.cloneMouseEvent=function(e){return{altKey:e.altKey,button:e.button,buttons:e.buttons,clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,currentTarget:e.currentTarget,fromElement:e.fromElement,metaKey:e.metaKey,pageX:e.pageX,pageY:e.pageY,relatedTarget:e.relatedTarget,shiftKey:e.shiftKey,target:e.target,timestamp:e.timestamp,toElement:e.toElement,type:e.type,view:e.view,which:e.which,x:e.x,y:e.y,preventDefault:e.preventDefault.bind(e),stopPropagation:e.stopPropagation.bind(e),stopImmediatePropagation:e.stopImmediatePropagation.bind(e)}},G.loadXML=function(e){try{if(void 0!==window.DOMParser)return(new window.DOMParser).parseFromString(e,"text/xml");if(void 0!==window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}try{G.PAssert(3008,!1,"No XML parser found")}catch(e){G.reportError(e)}return}catch(e){return void G.reportError(e)}},G.adjustOriginToBeInsideBounds=function(e,t,i,n,r,a){var s={x:t.left,y:t.top};return i=i||0,n=n||0,r=r||0,a=a||0,t.bottom+a>e.bottom&&(s.y=Math.max(n,t.top-(t.bottom+a-e.bottom))),t.top-a<e.top&&(s.y=Math.max(n,t.top)),t.right+r>e.right&&(s.x=Math.max(i,t.left-(t.right+r-e.right))),s},G.adjustLeftToBeInsideBounds=function(e,t,i,n){return t+i+n>e.right&&(t=e.right-n-i),t},G.adjustHeightToBeInsideBounds=function(e,t,i,n,r){if(t.bottom+r>e.bottom&&(t.bottom=e.bottom-r,t.bottom-t.top<i)){var a=Math.max(0,t.bottom-i);t.top=a}return Math.min(n,t.bottom-t.top)},G.setOrigin=function(e,t,i){var n=e.left-t,r=e.top-i;e.left-=n,e.right-=n,e.top-=r,e.bottom-=r},G.copyStyles=function(e,t,i){try{G.PAssert(3009,e,"Must have a valid source element")}catch(e){G.reportError(e)}try{G.PAssert(3010,t,"Must have a valid dest element")}catch(e){G.reportError(e)}try{G.PAssert(3011,i,"Must have a valid list of styles to copy")}catch(e){G.reportError(e)}var n=window.getComputedStyle(e);if(n){for(var r=[],a=0;a<i.length;++a)r[a]=n[i[a]];for(var a=0;a<r.length;++a)t.style[i[a]]=r[a]}},G.hasClass=function(e,t){try{G.PAssert(3012,e,"Must pass in a valid element")}catch(e){G.reportError(e)}return e&&e.classList?e.classList.contains(t):void 0},G.removeClass=function(e,t){try{G.PAssert(3013,e,"Must pass in a valid element")}catch(e){G.reportError(e)}e&&e.classList&&e.classList.remove(t)},G.addClass=function(e,t){try{G.PAssert(3014,e,"Must pass in a valid element")}catch(e){G.reportError(e)}e&&e.classList&&e.classList.add(t)},G.toggleClass=function(e,t){try{G.PAssert(3015,e,"Must pass in a valid element")}catch(e){G.reportError(e)}e&&e.classList&&e.classList.toggle(t)},G.css=function(e,t){try{G.PAssert(3016,e,"Must pass in a valid element")}catch(e){G.reportError(e)}if(e)for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];"number"==typeof n&&(n+="px"),e.style[i]=n}},G.findChild=function(e,t){try{G.PAssert(3017,e,"Must pass in a valid element")}catch(e){G.reportError(e)}if(e)for(var i=0;i<e.childElementCount;++i){var n=e.children[i];if(G.hasClass(n,t))return n;var r=G.findChild(n,t);if(r)return r}},G.getPluginForElement=function(e){return G.findParent(e,"plugin",4)},G.findParentInItem=function(e,t){for(;e&&!G.hasClass(e,"item");){if(G.hasClass(e,t))return e;e=e.parentNode}},G.findParent=function(e,t,i){try{G.PAssert(3018,e,"Must pass in a valid element")}catch(e){G.reportError(e)}if(i||(i=1e3),e)for(var n=e,r=0;r<i&&n;++r,n=n.parentNode)if(G.hasClass(n,t))return n},G.findParentID=function(e,t,i){try{G.PAssert(3020,e,"Must pass in a valid element")}catch(e){G.reportError(e)}if(i||(i=1e4),e)for(var n=e,r=0;r<i&&n;++r,n=n.parentNode)if(n.id===t)return n},G.findParentAttr=function(e,t,i){try{G.PAssert(3021,e,"Must pass in a valid element")}catch(e){G.reportError(e)}if(e)for(var n=e;n&&n.getAttribute;n=n.parentNode)if(n.getAttribute(t)===i)return n},G.isAncestor=function(e,t){try{G.PAssert(3022,e,"Must have a valid element")}catch(e){G.reportError(e)}try{G.PAssert(3023,t,"Must have a valid candidate")}catch(e){G.reportError(e)}for(;e&&e!==t;)e=e.parentNode;return!!e},G.firstChildTag=function(e,t){try{G.PAssert(3024,e,"Must pass in a valid element")}catch(e){G.reportError(e)}try{G.PAssert(3025,t,"Must pass in a valid tag to check")}catch(e){G.reportError(e)}if(e)for(var i=t.toUpperCase(),n=0;n<e.childElementCount;++n)if(e.children[n].tagName===i)return e.children[n]},G.insertAfter=function(e,t){try{G.PAssert(3027,e,"Must pass in a valid element")}catch(e){G.reportError(e)}try{G.PAssert(3028,t,"Must pass in a valid element")}catch(e){G.reportError(e)}e.parentNode.insertBefore(t,e.nextSibling)},G.prependChild=function(e,t){try{G.PAssert(3029,e,"Must pass in a valid element")}catch(e){G.reportError(e)}try{G.PAssert(3030,t,"Must pass in a valid element")}catch(e){G.reportError(e)}e.insertBefore(t,e.firstChild)},G.getAncestorChain=function(e){for(var t=[],i=e;i;)i.push(i),i=i.parentNode;return t},G.findCommonAncestor=function(e){for(var t=G.getAncestorChain(e),i=0,n=1;n<e.length&&i+1<t.length;++n)for(var r=e[n];r;){r=r.parentNode;var a=t.indexOf(r,i);if(a>=0){i=a;break}}return t[i]},G.isAttachedToDoc=function(e){try{G.PAssert(3032,e,"Must supply a valid element to check")}catch(e){G.reportError(e)}try{G.PAssert(3033,e.ownerDocument,"Checked element must have a valid owner document")}catch(e){G.reportError(e)}return!!e.ownerDocument&&(e.ownerDocument.body.contains(e)||e.ownerDocument.documentElement===e)},G.offset=function(e){try{G.PAssert(3034,e,"Must pass in a valid element")}catch(e){G.reportError(e)}var t=e.getBoundingClientRect(),i=e.ownerDocument,n=e.ownerDocument.documentElement,r=i.defaultView;return{top:t.top+r.pageYOffset-n.clientTop,left:t.left+r.pageXOffset-n.clientLeft}},G.position=function(e){var t=e.offsetParent,i=e.getBoundingClientRect(),n=t.getBoundingClientRect();return{left:i.left-n.left,top:i.top-n.top}},G.height=function(e){try{G.PAssert(3036,e,"Must pass in a valid element")}catch(e){G.reportError(e)}var t=e.offsetHeight,i=window.getComputedStyle(e);return i?("border-box"!==i.boxSizing&&(t-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)),t-=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::height"),t},G.width=function(e){try{G.PAssert(3038,e,"Must pass in a valid element")}catch(e){G.reportError(e)}var t=e.offsetWidth,i=window.getComputedStyle(e);return i?("border-box"!==i.boxSizing&&(t-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight)),t-=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::width"),t};var ke;G.runOnLoad=function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e):(ke||(ke=[],document.addEventListener("DOMContentLoaded",L,!1),window.addEventListener("load",L,!1)),ke[ke.length]=e)},G.sendFeedback=function(e,t,i){var n={};G.getAppInfo(n),n.eventStream=void 0;var r=t+"\r\n\r\n\r\n"+JSON.stringify(n,void 0,3),a={name:e,notes:r};a.email=G.getUserIdentifier(),a.premiumStatus=G.billingManager.getPremiumStatus(),function(){G.XHR_PrivateAPI({type:"POST",path:"/feedback/suggestion",data:a,cb:function(e){log("XHR Response: ",e.status,e),i()}.bind(this)})}.bind(this)()};var xe={};G.getXHRStats=function(){return xe};var Re=[0,5,15,35,80,170,400,1200],Oe=[0,408,429,500,502,503,504];G.XHR=function(e){function t(){try{G.PAssert(3043,h<d,"Should not be calling retry once retries have been exhausted")}catch(e){G.reportError(e)}h<d?(h++,H(n),setTimeout(i,1e3*Re[h])):(V(n),G.reportError(new Error("XHR Failed: "+n)))}function i(){var e=new XMLHttpRequest;if(e.timeout=l,e.onreadystatechange=function(){4===e.readyState&&(200!==e.status?h<d?(e.retry=t,c&&Oe.indexOf(e.status)>=0?e.retry():a(e)):(V(n),a(e)):(U(n),a(e)))},u&&p?e.open(r.toUpperCase(),n,!0,u,p):e.open(r.toUpperCase(),n,!0),o)for(var i in o)e.setRequestHeader(i,o[i]);if(s){e.setRequestHeader("Accept","*/*"),o&&o["Content-Type"]||e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var m;m=s instanceof Blob?s:N(s),e.send(m)}else e.send()}try{G.PAssert(3041,e.url,"Must specify a valid URL to use")}catch(e){G.reportError(e)}try{G.PAssert(3042,e.type,"Must specify a valid request type")}catch(e){G.reportError(e)}var n=e.url,r=e.type,a=e.cb,s=e.data,o=e.headers,c=e.autoRetry,l=e.timeout,d=Math.min(e.maxRetries||2,6),h=0,u=e.username,p=e.password;B(n),i()},G.XHR_PrivateAPI=function(e){try{G.PAssert(3044,e.type,"Must supply a valid type")}catch(e){G.reportError(e)}try{G.PAssert(3045,e.path&&e.path.startsWith("/"),"Must supply a valid path"+e.path)}catch(e){G.reportError(e)}var i=(require("goog"),require("AccountManager")),n=t.getDeployVar(DeployVariable.APIProtocol),r=t.getDeployVar(DeployVariable.APIHost);if(e.requireAuth){try{G.PAssert(3046,i.isCurrentlyAuthorized("me"),"Must have a valid auth token before making API calls")}catch(e){G.reportError(e)}if(!i.isCurrentlyAuthorized("me"))return void i.onUserAuthorized("me",function(){G.XHR_PrivateAPI(e)});var a=i.getDefaultIDToken();try{G.PAssert(3047,a,"Must have a valid ID token")}catch(e){G.reportError(e)}var s=i.getDefaultAccessToken();try{G.PAssert(3048,s,"If account is authorized it must have a valid token")}catch(e){G.reportError(e)}var o=i.getAccountGID("me");try{G.PAssert(3049,o,"If account is authorized it must have a valid GID")}catch(e){G.reportError(e)}var c=i.getAccountTokenSync("me");try{G.PAssert(3050,i.isTokenValid(c),"Must have a valid account token: ",c)}catch(e){G.reportError(e)}e.headers||(e.headers={});try{G.PAssert(3051,!e.headers.token,"Callers should not be setting access token themselves")}catch(e){G.reportError(e)}try{G.PAssert(3052,!e.headers.id_token,"Callers should not be setting id_token themselves")}catch(e){G.reportError(e)}try{G.PAssert(3053,!e.headers.gid,"Callers should not be setting user GID themselves")}catch(e){G.reportError(e)}a&&(e.headers.id_token=a),e.headers.token=s,e.headers.gid=o}var l={type:e.type,url:n+r+"/private/v1"+e.path,data:e.data,cb:e.cb,headers:e.headers,autoRetry:e.autoRetry,maxRetries:e.maxRetries};G.XHR(l)},G.XHR_PublicAPI=function(e){};var Le=!1,Ne=1,Fe={};G.registerURLForNotifyXHR=function(e,t){return Fe[e]||(Fe[e]=t),Le};var Be=["https://drive.google.com/otservice/save","https://drive.google.com/otservice/bind"];G.wrapXHR=function(){try{var e=window.XMLHttpRequest.prototype.open,t=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.open=function(t,i,n,r,a){this.url=i,void 0===n&&(n=!0);try{e.call(this,t,i,n,r,a)}catch(e){throw G.reportError(e),e}},window.XMLHttpRequest.prototype.send=function(e){q(this),!this.timeout&&z(this)&&(this.timeout=G.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&t.call(this,e)}catch(e){throw G.reportError(e),e}}}catch(e){return void G.reportError(e)}Le=!0},G.wrapXHR(),G.areObjectsEqual=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},G.JSONP=function(e){try{G.PAssert(3054,e.url,"Must supply a valid URL to fetch")}catch(e){G.reportError(e)}try{G.PAssert(3055,e.cb,"Must supply a valid callback")}catch(e){G.reportError(e)}var t=e.url,i=e.data,n=e.cb;if(i){for(var r="",a=Object.keys(i),s=0;s<a.length;s++)r+=encodeURIComponent(a[s])+"="+encodeURIComponent(i[a[s]]),s!==a.length-1&&(r+="&");t+="?"+r}var o=Date.now(),c="jsonp"+Math.round(o+10001*Math.random());window[c]=function(e){n(e),delete window[c]},-1===t.indexOf("?")?t+="?":t+="&";var l=document.createElement("script");l.id=c,l.setAttribute("src",t+"callback="+c),document.getElementsByTagName("head")[0].appendChild(l)},G.element=function(e,t){try{G.PAssert(3056,e,"Tried to get an element without an id")}catch(e){G.reportError(e)}G.elements[e]&&!t||(G.elements[e]=document.getElementById(e));try{G.PAssert(3057,G.elements[e],"Tried to get an element that doesn't exist",e)}catch(e){G.reportError(e)}return G.elements[e]},G.openUrl=function(e,i,n){try{G.PAssert(3058,e,"Must always provide a valid URL to open")}catch(e){G.reportError(e)}if(!e)return!1;var r=G.parseEvernoteLink(e);if(r){var a=G.settings.get(Settings.openEvernoteApp);if(void 0===a)return void G.menus.confirm("Open Evernote links in Evernote app?",function(t){G.settings.set(Settings.openEvernoteApp,t),G.openUrl(e,i,n)});a&&(r.viewUrl?e=r.viewUrl:(e="evernote:///view/"+r.userId+"/"+r.shardId+"/"+r.noteGuid+"/"+r.noteGuid+"/",console.log(e)))}if(t.standalone){var s=document.createElement("a");s.setAttribute("href",e),s.setAttribute("target","_blank"),s.setAttribute("rel","noopener noreferrer");var o=document.createEvent("HTMLEvents");o.initEvent("click",!0,!0),s.dispatchEvent(o)}else if(t.app){var c=t.ios&&t.appv>=5||t.android&&t.appv>=5||t.isChrome;c||!e.startsWith("http://")&&!e.startsWith("https://")?e.startsWith("/")&&(e=window.location.host+e):e=e.replace("http://","").replace("https://",""),e.startsWith("callto:")&&(e=e.replace("callto:","tel:")),t.ios&&e.startsWith("tel:")?(e.indexOf("://")<0&&(e=e.replace("tel:","tel://")),G.nativeBridge.sendToApp("openURL",e)):t.ios&&e.startsWith("mailto:")?open(e):G.nativeBridge.sendToApp("openURL",e),i&&(G.handlerPreventStop(i),i.returnFalse=!0)}else n=n||e.startsWith("evernote:///")||e.startsWith("onenote:")||e.startsWith("bear:"),n?open(e,"_self"):open(e,"_blank");return!0},G.isUrlImage=function(e){return e=e.toLowerCase(),e.endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".gif")},G.isDateSoft=function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1},G.getSoftDate=function(e){if(e)switch(e.toUpperCase()){case"NEXT":return Date.today().add({hours:12});case"SOON":return Date.today().add({days:1,hours:12});case"LATER":return Date.today().add({days:3,hours:12});case"SOMEDAY":return Date.today().add({days:14,hours:12});case"NOW":return Date.today().add({hours:-1})}},G.isDateValid=function(e){return e&&e instanceof Date&&!isNaN(e.getTime())},G.getLocationOrigin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")};var Ue;G.isSpellcheckEnabled=function(){return Ue},G.handlerPreventStop=function(e){e.preventDefault(),e.stopImmediatePropagation?e.stopImmediatePropagation():e.stopPropagation()},G.handlerStopProp=function(e){e.stopImmediatePropagation()},G.fFalse=function(){return!1},G.fTrue=function(){return!0},G.emptyFn=function(){},G.weeks=function(e){return 6048e5*e},G.days=function(e){return 864e5*e},G.hours=function(e){return 36e5*e},G.minutes=function(e){return 6e4*e},G.seconds=function(e){return 1e3*e},G.round=function(e,t){return t=t||2,Number(Math.round(e+"e"+t)+"e-"+t)},G.toFileSize=function(e){if(e){var t=Math.log(e)/Math.log(1024)|0;return(e/Math.pow(1024,t)).toFixed(2)+" "+(0===t?"bytes":"KMGTPEZY"[t-1]+"B")}return null},G.curry=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments,0)))}},G.saveFile=function(e,i){if(t.appPlatform===AppPlatform.Chrome)try{G.nativeBridge.sendToApp("exportData",{content:e,filename:i})}catch(e){G.reportError(e)}else{var n=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(n,i)}};var He=[];G.downloadFile=function(e,i){if(t.supportsNativeDownload()){try{G.PAssert(3060,!He[e],"Should not double create a download for the same file")}catch(e){G.reportError(e)}He[e]=G.toasts.pushMessage({text:"Downloading "+i+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),G.nativeBridge.sendToApp("downloadURL",{url:e,name:i})}else if(document.createEvent){var n=document.createElement("a");n.href=e;var r=document.createEvent("MouseEvents");r.initEvent("click",!0,!0),n.dispatchEvent(r)}else window.open(e,"_self")},G.handleNativeDownloadProgress=function(e){var t=e.url,i=e.name,n=e.progress,r=He[t];r&&(1===n?(r.hide(),delete He[t]):r.setText("Downloading "+i+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+Math.round(100*n)+"%"))},G.printPage=function(e){if(!t.app){window.open(e).print()}},n.hasURLParam("nolocal","true")&&(G.noLocalWrites=!0,G.noLocalWritesReason=i.LocalWriteReason.NoLocal),G.eventStream=new r(25),window.__CHECK_OAUTH=function(){G.XHR({type:"GET",url:"https://accounts.google.com/o/oauth2/auth?scope=email&redirect_uri=http://moo.do&response_type=token&client_id=597847337936.apps.googleusercontent.com",cb:function(e){log("XHR OAuth: ",e)}})},G.createCustomScroller=function(e){return new s(e,{scrollbars:!0,shrinkScrollbars:"clip",bindToWrapper:!0,preventDefault:!1,scrollX:!1,scrollY:!0,deceleratopn:.005,probeType:3,useTransition:!1})};var Ve={};G.setReactCell=function(e,t){try{G.PAssert(3061,!Ve[t]||Ve[t]===e,"Should never overwrite a react item, always clear first")}catch(e){G.reportError(e)}Ve[t]=e},G.getReactCell=function(e){var t;if(e.nodeType!==Node.TEXT_NODE){var i=e.getAttribute("data-moo-id");t=Ve[i]}return t},G.clearReactCell=function(e,t){try{G.PAssert(3062,Ve[t]===e,"Must be clearing the same item that was set")}catch(e){G.reportError(e)}Ve[t]=void 0};var qe={};G.__dbgGetReactElemenets=function(){return qe},G.setDataFor=function(e,t,i){try{G.PAssert(3063,!qe[i]||qe[i]===t,"Should never overwrite a react element, always clear first")}catch(e){G.reportError(e)}qe[i]=t},G.clearDataFor=function(e){delete qe[e]},G.dataFor=function(t,i,n){if(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode),i){for(var r=t;t&&t!==document;){var a=t.getAttribute("data-moo-id");if(qe[a])return qe[a];t=t.parentNode}return!n&&e.dataFor(r)}if(t){var a=t.getAttribute("data-moo-id");return qe[a]||!n&&e.dataFor(t)}},G.getItemForElement=function(e){var t=G.dataFor(e,!0,!0);try{G.PAssert(3064,!t||G.isVMLI(t),"Must always find a valid VMLI for a given element: "+G.elementToString(e))}catch(e){G.reportError(e)}if(G.isVMLI(t))return t},G.getIndexForElement=function(e){var t=-1,i=G.findParent(e,"item");if(i){var n=G.getReactCellForElement(i);n&&(t=n.getIndex())}return t},G.getPaneForElement=function(e){var t=G.findParent(e,"pane");if(t)return G.dataFor(t);var i=G.findParent(e,"paneOverviewScroller");return i?G.dataFor(i):G.findParent(e,"mobileUIBottom")?G.focusedPane:void 0},G.getReactCellForElement=function(e){for(;e&&e!==document.body;){var t=G.getReactCell(e);if(t)return t;e=e.parentNode}try{G.PAssert(3067,!1,"Should always be able to find a valid item for a given element",G.getElementPath(e))}catch(e){G.reportError(e)}},G.getCellForElement=function(e){var t=G.getReactCellForElement(e);if(t)return t.getCell()},G.classNames=function(){for(var e=arguments,t=[],i=0;i<e.length;i++){var n=e[i];if(n)if(G.isString(n)||G.isNumber(n))t.push(n);else if("object"==typeof n)for(var r in n)n.hasOwnProperty(r)&&n[r]&&t.push(r)}return t.join(" ")},G.extend=function(e,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},G.isVMLI=function(e){return e instanceof j},G.isPane=function(e){return e instanceof K},G.decodeURLObject=function(e){var t;if(e){var i=G.b64_to_utf8(e);try{t=JSON.parse(i)}catch(e){G.reportError(e)}}return t},G.encodeMIMEHeader=function(e){return"=?UTF-8?B?"+window.btoa(unescape(encodeURIComponent(e)))+"?="},G.utf8_to_b64=function(e){var t;try{t=window.btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_")}catch(t){G.reportError(t,e)}return t},G.b64_to_utf8=function(e){var t;try{t=decodeURIComponent(escape(window.atob(e.replace(/-/g,"+").replace(/_/g,"/"))))}catch(t){G.reportError(t,e)}return t},G.qp_to_utf8=function(e){var t;try{t=e.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,function(e,t){var i=parseInt(t,16);return String.fromCharCode(i)})}catch(t){G.reportError(t,e)}return t},G.isHTTPStatusCode=function(e,t){return e&&e.error&&e.error.code===t},G.hasGoogleError=function(e,t,i){try{G.PAssert(3068,e,"Must specify a valid result object")}catch(e){G.reportError(e)}try{G.PAssert(3069,t,"Must specify a valid error domain")}catch(e){G.reportError(e)}try{G.PAssert(3070,i,"Must specify a valid error reason")}catch(e){G.reportError(e)}var n=!1;if(e&&e.error&&e.errors)for(var r=e.error.errors,a=0;a<r.length;++a){var s=r[a];if(s.domain===t&&s.reason===i){n=!0;break}}return n},G.timeouts={},G.hasTimeoutOnce=function(e){return!!G.timeouts[e]},G.timeoutOnce=function(e,t,i,n,r,a,s,o){try{G.PAssert(3071,e,"Must supply a valid name")}catch(e){G.reportError(e)}try{G.PAssert(3072,G.isFunction(t),"must supply a valid cb fn")}catch(e){G.reportError(e)}try{G.PAssert(3073,arguments.length<=8,"Too many args passed in")}catch(e){G.reportError(e)}var c=G.timeouts[e];c&&clearTimeout(c),G.timeouts[e]=setTimeout(function(){delete G.timeouts[e],t(n,r,a,s,o)},i)},G.clearTimeoutOnce=function(e){var t=G.timeouts[e];t&&(clearTimeout(t),delete G.timeouts[e])},G.animFrameOnce=function(e,t){var i=G.timeouts[e];i&&cancelAnimationFrame(i),G.timeouts[e]=requestAnimationFrame(t)},G.contentSetAuto=void 0,G.reEnableNone=function(e){try{G.PAssert(3074,e,"Must have a valid element to set pointer-events on")}catch(e){G.reportError(e)}e.style["pointer-events"]=""},G.elementFromPoint=function(e,t){return document.elementFromPoint(e,t)},G.parentTextForItem=function(e){for(var t=e.parents(),i="",n=1;n<t.length;n++){n>1&&(i+="  |  ");i+=t[n].generateTitleText(t[n].getParsedTextWithoutPrefix())}return i},G.scrollToAndHighlightItem=function(e,t){e.highlight(),G.vmMain.paneManager.runForEachPane(function(i){if(i!==t){var n=i.indexOfItem(e);if(n<0&&i.type===PaneMode.Outline&&e.isDescendantOf(i.item.get())&&i.search.isMatched(e)){G.vmMain.beginUpdateItems();for(var r=e.parent();r&&r!==i.item.get();)r.isCollapsed(i,!1)&&(i.setIgnoreRestoreScroll(!0),r.setCollapsed(!1,i,!1)),r=r.parent();G.vmMain.commitUpdateItems(),n=i.indexOfItem(e)}n>=0&&i.scrollIndexToMiddle(n,ScrollDuration.Default)}})},
G.batchRenderUpdates=function(e,t,i,n,r,a){return o.unstable_batchedUpdates(e,t,i,n,r,a)},G.hexToRgb=function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}},G.hexToRgbStr=function(e){return parseInt(e.substr(1,2),16)+","+parseInt(e.substr(3,2),16)+","+parseInt(e.substr(5,2),16)},G.rgbToHex=function(e,t,i){return[G.pad2(Math.round(e).toString(16)),G.pad2(Math.round(t).toString(16)),G.pad2(Math.round(i).toString(16))].join("")},t.demo&&G.enableDemoMode(),G.setupGoogleAPIListener(),G.fieldMapValidators={isArchived:G.isBoolean,dateCreated:G.isNumber,date:G.isNumber,duration:G.isNumber,formats:G.isAnything,durationText:G.isString,favorites:G.isAnything,items:G.isArray,isNote:G.isBoolean,modifiedOffline:G.isBoolean,isCollapsed:G.isBoolean,note:G.isString,modifiedOfflineText:G.isBoolean,priority:G.isNumber,repeatDate:G.isAnything,dateText:G.isString,text:G.isString,versionText:G.isNumber,version:G.isNumber,isDeleted:G.isBoolean,isComplete:G.isBoolean,archivedItems:G.isArray,allDayDate:G.isBoolean,id:G.isString,isStarred:G.isBoolean,dateCompleted:G.isNumber,dateFormat:G.isString},G.fixFieldDate=function(e){var t;if(G.isString(e)){var i=new Date(e);i&&(t=i.getTime())}else e instanceof Date?t=e.getTime():G.isNumber(e)&&(t=e);return t},G.fieldMapFixer={date:G.fixFieldDate,dateCompleted:G.fixFieldDate};var We=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g;return G.parseEvernoteLink=function(e){if(e.startsWith("evernote:///view/"))return{viewUrl:e};var t;return We.lastIndex=0,null!==(t=We.exec(e))?{shardId:t[1],userId:t[2],noteGuid:t[3]}:void 0},G.isOneNoteLink=function(e){return e.startsWith("onenote:https://")},G.isBearLink=function(e){return e.startsWith("bear://x-callback-url/")},G}),define("fakeTimers",function(){}),define("gdata",["util","globals","Constants","data","platform","RingBuffer","Observable"],function(e,t,i,n,r,a,s){function o(){t.menus.alert({text:"You are using an out of date document - please contact support@moo.do for help.",actionText:"OKAY",callback:function(){function e(){t.reportError(new Error("Successfully deleted out of date doc - "+t.settings.get(Settings.gdocId))),n.clearData(function(){t.reload()})}function i(){t.reportError(new Error("Error deleting out of date doc - "+response.error)),n.clearData(function(){t.reload()})}t.vmMain.remoteAPI().driveTrash(t.settings.get(Settings.gdocId),e,i)}})}function c(){try{t.PAssert(3124,!M.inCompoundOperation,"Should never be in a compound operation after sync block finishes")}catch(e){t.reportError(e)}try{t.PAssert(3125,!M.wantCompoundOperation,"Should never want a compound operation after a sync block finishes")}catch(e){t.reportError(e)}if(M.inCompoundOperation){try{M.inCompoundOperation=!1,M.wantCompoundOperation=!1,t.vmMain.notifyDriveOperationError(),M.model.endCompoundOperation()}catch(e){t.reportError(e)}t.reportError(new Error("Compound operation open after sync block finished"))}w=void 0}function l(e){try{t.PAssert(3131,e,"Must have a valid local item to attach events to")}catch(e){t.reportError(e)}try{t.PAssert(3132,e instanceof A,"Must pass in a valid instace of a local item")}catch(e){t.reportError(e)}try{t.PAssert(3133,e.shouldSave(),"Item must be marked as saveable")}catch(e){t.reportError(e)}try{t.PAssert(3134,e.data,"Must have a valid remote item to attach events to")}catch(e){t.reportError(e)}e.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,e.onObjectChanged.bind(e))}function d(e){M.beginWriteAction();try{t.PAssert(3176,e instanceof A)}catch(e){t.reportError(e)}try{t.PAssert(3177,e.shouldSave(),"Item must be marked as saveable")}catch(e){t.reportError(e)}try{t.PAssert(3178,e.data,"Must have valid remote item to attach events to and create")}catch(e){t.reportError(e)}var i=M.get(e.data,"items");return i||(i=M.model.createList(),M.set(e.data,"items",i)),i}function h(e){M.beginWriteAction();try{t.PAssert(3179,e instanceof A)}catch(e){t.reportError(e)}try{t.PAssert(3180,e.shouldSave(),"Item must be marked as saveable")}catch(e){t.reportError(e)}try{t.PAssert(3181,e.data,"Must have valid remote item to attach events to and create")}catch(e){t.reportError(e)}var i=M.get(e.data,"archivedItems");return i||(i=M.model.createList(),M.set(e.data,"archivedItems",i)),i}function u(e){M.beginWriteAction();var t=M.getVersion(e,VersionType.Structure);t=t?t+1:1;M.set(e,"version",t)}function p(e){M.beginWriteAction();var t=M.getVersion(e,VersionType.Text);t=t?t+1:1;M.set(e,"versionText",t)}function m(e,i,n){n||(n=new Error("DocError: "+e+"."+i)),M.docErrors.push({fn:e,type:i,data:n}),t.reportError(n)}function f(e,i){try{t.PAssert(3224,e.shouldSave(),"Item must be marked as saveable")}catch(e){t.reportError(e)}var r=M.canSave(e);if(r){if(t.isEmpty(i))return void(ShouldLog(LogLevels.Warning)&&log("Skipped remote saving an empty object"));M.beginWriteAction(),n.addPendingUpdate(e.id),i.hasOwnProperty("dateFormat")&&M.set(r,"dateFormat",i.dateFormat);for(var a in i){try{t.PAssert(3225,i.hasOwnProperty(a),"Changes should only contain properties they own")}catch(e){t.reportError(e)}if(i.hasOwnProperty(a))switch(a){case"text":try{t.PAssert(3226,t.isString(i.text))}catch(e){t.reportError(e)}try{t.PAssert(3227,i.text.indexOf(window.AttachChar)<0,"Remote syncd changes should never contain AttachChar")}catch(e){t.reportError(e)}try{t.PAssert(3228,e.isNote()||i.text.indexOf("\n")<0,"Remote syncd changes should never contain newlines")}catch(e){t.reportError(e)}M.set(r,"text",i.text);break;case"date":try{t.PAssert(3229,!i.date||t.isNumber(i.date),"Invalid date type")}catch(e){t.reportError(e)}M.set(r,"date",i.date);break;case"dateFormat":break;case"repeatDate":try{t.PAssert(3230,!i.repeatDate||t.isString(i.repeatDate),"Invalid repeat date type")}catch(e){t.reportError(e)}M.set(r,"repeatDate",i.repeatDate);break;case"dateCreated":try{t.PAssert(3231,t.isNumber(i.dateCreated),"Invalid dateCreated type")}catch(e){t.reportError(e)}M.set(r,"dateCreated",i.dateCreated);break;case"dateCompleted":try{t.PAssert(3232,!i.dateCompleted||t.isNumber(i.dateCompleted),"Invalid dateCompleted type")}catch(e){t.reportError(e)}M.set(r,"dateCompleted",i.dateCompleted);break;case"allDayDate":case"priority":case"isComplete":case"isStarred":case"favorites":M.set(r,a,i[a]);break;case"isCollapsed":case"isArchived":case"isNote":case"note":try{t.PAssert(3233,!1,"These properties are not set this way")}catch(e){t.reportError(e)}M.set(r,a,i[a]);break;case"modifiedOfflineText":case"dateText":case"durationText":case"duration":break;default:try{t.PAssert(3234,!1,"Attempting to remotely save an unknown field: ",a)}catch(e){t.reportError(e)}}}p(r)}}function g(e){return B[Math.min(e,B.length-1)]}function v(){try{t.PAssert(3237,H===U.Error||H===U.XHRError,"Invalid state for request reconnect: ",H)}catch(e){t.reportError(e)}clearTimeout(N),N=void 0,t.goog.reconnectToActiveDocument()}function y(e){var i=H;if(H=e,log("Change Realtime Status: ",i," -> ",e),i!==e)switch(i){case U.Disconnected:try{t.PAssert(3240,e===U.Connecting,"Invalid state switch",i,e)}catch(e){t.reportError(e)}break;case U.XHRError:case U.Error:try{t.PAssert(3241,e===U.Reconnecting||e===U.Connected,"Invalid state switch",i,e)}catch(e){t.reportError(e)}e===U.Connected&&M.notifyReconnectSuccess();break;case U.Connected:try{t.PAssert(3242,e===U.Error,"Invalid state switch",i,e)}catch(e){t.reportError(e)}e===U.Error&&(M.close(),M.setupReconnect());break;case U.Connecting:case U.Reconnecting:try{t.PAssert(3243,e===U.Error||e===U.Connected,"Invalid state switch",i,e)}catch(e){t.reportError(e)}e===U.Error?(M.close(),M.setupReconnect()):e===U.XHRError?(M.close(),M.notifyReconnectFailure()):e===U.Connected&&i===U.Reconnecting&&M.notifyReconnectSuccess();break;default:try{t.PAssert(3244,!1,"Invalid status: ",i,e)}catch(e){t.reportError(e)}}}function b(e){try{t.PAssert(3245,e,"Must pass a valid CB for doc loaded")}catch(e){t.reportError(e)}return function(i){t.batchRenderUpdates(function(){y(U.Connected),V++,e(i)})}}function S(e){try{t.PAssert(3246,e,"Must pass a valid CB for doc initialized")}catch(e){t.reportError(e)}return function(t){y(U.Connected),e(t)}}function E(e){try{t.PAssert(3247,e,"Must pass a valid CB for doc error")}catch(e){t.reportError(e)}return function(t){e(t)&&y(U.Error)}}function C(e){(!e||4===e.readyState&&200!==e.status)&&y(U.XHRError)}function P(e){try{t.PAssert(3264,!e||t.isString(e),"Must always be saving a string to remote cache")}catch(e){t.reportError(e)}return e?e.length:0}function T(e){try{t.PAssert(3265,!e||t.isObject(e),"Must always pass in a valid object")}catch(e){t.reportError(e)}var i={};for(var n in e)if(e.hasOwnProperty(n)){var r;try{r=t.isString(e[n])?e[n].length:JSON.stringify(e[n])}catch(e){t.reportError(e)}i[n]=r}}function D(e,i){for(var n=!0,r=i.get("data"),a=r.items(),s=0;s<a.length;++s){var o=a[s][0],c=a[s][1];try{var l=JSON.parse(c);e._isPreviewData(l)||(n=!1,e._displayMissingProperties(o,l,PluginLoad.Preview))}catch(e){t.reportError(e),n=!1}}return n}var M={isClosed:!0,initialized:!1,loadedOnce:!1,actionsPreventUndo:!1,wantCompoundOperation:!1,inCompoundOperation:!1,flushingDeferredActions:!1,deferredActionsCommitted:!1,hasPendingDeferredActions:!1,authenticatedUser:new s,numChanges:0,lastChangeTime:new s(t.parseInt(e.storage.getItem("lastDocSyncTime"))||0)};M.lastChangeTime.listen(function(i){try{t.PAssert(3075,t.isNumber(i),"Must always provide a valid timestamp for lastDocSyncTime")}catch(e){t.reportError(e)}e.storage.setItem("lastDocSyncTime",i)});M.offlineTimeoutMS=r.mobile?12e3:8e3;M.currentVersion=function(){return 6},M.isReadOnly=function(){var e=!1;return M.model&&(e=M.model.isReadOnly),e};var _={},I={};M.cacheItem=function(e){try{t.PAssert(3076,void 0===I[e.id]||I[e.id]===e,"Should not be caching different items with the same ID")}catch(e){t.reportError(e)}if(I[e.id]=e,_[e.id]){try{t.PAssert(3077,_[e.id]===e,"Should not be caching different items with the same ID in deleted")}catch(e){t.reportError(e)}delete _[e.id]}},M.getCacheItem=function(e){return I[e]},M.getDeletedCacheItem=function(e){return _[e]},M.removeItemFromCache=function(e){try{t.PAssert(3078,void 0!==I[e],"Item cache should contain a valid entry for item")}catch(e){t.reportError(e)}try{t.PAssert(3079,void 0===_[e],"Should never already have item in deleted cache")}catch(e){t.reportError(e)}_[e]=I[e],delete I[e]},M.restoreDeletedItem=function(e){try{t.PAssert(3080,void 0!==_[e],"Deleted item cache should contain a valid entry for item")}catch(e){t.reportError(e)}try{t.PAssert(3081,void 0===I[e],"Should never already have an item in the item cache")}catch(e){t.reportError(e)}I[e]=_[e],delete _[e]},M.getState=function(e){try{var t={};if(M.doc)try{var i=M.doc.getModel();t.isReadOnly=i.isReadOnly,t.serverVersion=i.serverVersion,t.size=i.bytesUsed,t.saveDelay=M.doc.saveDelay}catch(t){e.docAccessError=!0}t.lastPending=X,t.lastSaving=Q,t.isClosed=M.isClosed,t.initialized=M.initialized,t.numChanges=M.numChanges,t.lastChanged=M.lastChangeTime.get(),e.gState=t,e.gDocErrors=M.docErrors,e.gdataRealtimeStatus=M.getDriveRealtimeStatus()}catch(t){log("Error getting information in gdata::getState()"+t.message),e.gState="EXCEPTION"}};var n,A;M.checkRemoteIntegrity=function(){function e(e,t){if(e)for(var n=0;n<e.length;++n){var a=e.get(n).id;a||(log(a,": Child does not have a valid reference in our remote database"),i=!0),r[a]?r[a].ref?(log(a,": Item is referenced remotely multiple times"),log("   ",r[a].ref),log("   ",o.id),i=!0,M.beginWriteAction(),M.setItemParent(e.get(n),M.getCacheItem(r[a.ref])),e.remove(n)):r[a].ref=o.id:r[a]={exist:!1,arch:t,ref:o.id}}}M.beginAction(),ShouldLog(LogLevels.Timing)&&log("Verifying Remote Data: ",log.now());var i=!1,r={},a=!1;for(var s in I){var o=I[s];r[o.id]?r[o.id].exist?(log(o.id,": Duplicated IDs in the remote database",o),i=!0):r[o.id].exist=!0:r[o.id]={exist:!0,ref:!1},o.id===M.rootID&&(a&&(log(o.id,": Multiple roots present remotely",o),i=!0),a=!0,r[o.id].isRoot=!0),M.getItemParent(o)||r[o.id].isRoot||log(o.id,": Missing remote parent field",o);e(M.get(o,"items"),!1);e(M.get(o,"archivedItems"),!0);var c=M.get(o,"note");c&&(r[c.id]?r[c.id].ref?(log(c,": Note is referenced remotely multiple times: "),log("    ",r[c.id].ref),log("    ",o.id),i=!0,M.beginWriteAction(),M.set(o,"note",void 0)):r[c.id].ref=o.id:r[c.id]={exist:!1,isNote:!0,ref:o.id})}a||log("No root present");for(var l in r){var d=r[l];if(!d.exist){try{t.PAssert(3083,!1,"This should never happen as the database is inline with the item tree now")}catch(e){t.reportError(e)}log(l,": Item is referenced remotely as a child but does not exist in the database");var h=I[d.ref];try{t.PAssert(3084,h,"Parent must exist otherwise it couldn't reference this item")}catch(e){t.reportError(e)}if(d.isNote)M.beginWriteAction(),M.set(h,"note",void 0);else{var u=M.getItemList(h,d.arch);try{t.PAssert(3085,u,"If the item has been seen here, we will always have a valid parent list")}catch(e){t.reportError(e)}if(u){var p=u.indexOf(l);if(p>=0)M.beginWriteAction(),u.remove(p);else try{t.PAssert(3086,!1,"If we previously saw this item, we expect to be able to delete it from the parent list")}catch(e){t.reportError(e)}}}}d.ref||d.isRoot||(log(l,": Item exists remotely but is not referenced by a parent"),log("   : ",M.get(I[l],"text")),M.removeItemFromCache(l)),d.isRoot&&d.ref&&(log(l,": Remote root has a parent"),!0)}n.removeDeletedItems(r),M.endAction(),ShouldLog(LogLevels.Timing)&&log("Done Verifying Remote Data: ",log.now())},M.migrateData=function(){function e(){2===++h&&t.reload()}var i=!1,r=!1,a=!1,s=!1,c=!1,l=M.root.get("dataVersion");try{t.PAssert(3096,t.isNumber(l),"Remote data version must always be numeric",l)}catch(e){t.reportError(e)}if(l<6){M.beginAction(),log("Migrating to latest version: ",l);try{switch(l){case 0:case 1:case 2:case 3:case 4:s=!0,log("Remote Migration Completed");break;case 5:break;default:try{t.PAssert(3097,!1,"Unknown remoteVersion: ",l)}catch(e){t.reportError(e)}}}catch(e){a=!0,t.reportError(e)}M.endAction(),M.model.getRoot().set("dataVersion",6),log("Done Migrating Remote Data!",6)}else l>6&&(r=!0,i=!0);if(n.hasLocalData){var d=t.settings.get(Settings.localDataVersion)||0;try{t.PAssert(3099,t.isNumber(d),"Local data version must be numeric",d)}catch(e){t.reportError(e)}if(t.isNumber(d)){if(d<6){try{switch(d){case 0:case 1:case 2:case 3:case 4:i=!0,c=!0,log("Local Migration Completed");break;case 5:t.vmMain.cacheManager.notifyMigrationRequired();break;default:try{t.PAssert(3100,!1,"Unknown localVersion",d)}catch(e){t.reportError(e)}}}catch(e){r=!0,t.reportError(e)}t.settings.set(Settings.localDataVersion,6),log("Done Migrating Local Data!",6)}else if(d>6)try{t.PAssert(3101,!1,"localVersion is greater than our CURRENT_VERSION",d,6)}catch(e){t.reportError(e)}}else i=!0,t.menus.alert({text:"There was an error loading your document, please try loading a different document and contact support@moo.do.",actionText:"OKAY"})}else t.settings.set(Settings.localDataVersion,l);if(s)o();else if(c)t.AppCache.runOnFinish(function(){n.clearDataAndReload()},!0);else if(r||a)if(r&&!a)t.AppCache.runOnFinish(function(){t.reload()},!0);else if(a&&!r)M.registerSaveNotify(function(){t.reload()});else{var h=0;t.AppCache.runOnFinish(e,!0),M.registerSaveNotify(e)}if(!i){var u=M.model.getRoot().get("recoverVersion")||0,p=t.settings.get(Settings.localRecoverVersion);void 0===p||!n.hasLocalData&&u>p?t.settings.set(Settings.localRecoverVersion,u):u>p&&n.hasLocalData&&(i=!0,n.addDefaultSkipSetting(Settings.gdocId,"Default"),n.addDefaultSkipSetting(Settings.gdocTitle,"Default"),t.AppCache.runOnFinish(function(){n.clearDataAndReload()},!0))}return i},M.beginAction=function(e){if(M.model&&!M.isReadOnly()){try{t.PAssert(3114,!M.flushingDeferredActions,"Should never begin a new action while flushing")}catch(e){t.reportError(e)}try{t.PAssert(3115,!M.inCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}try{t.PAssert(3116,!M.wantCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}try{t.PAssert(3117,!M.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}M.wantCompoundOperation=!0,M.actionsPreventUndo=!!e}};var w;M.beginWriteAction=function(e){if(M.model&&!M.isReadOnly()){try{t.PAssert(3118,void 0===e||M.actionsPreventUndo===!!e,"Compound operations prevent undo must match",M.actionsPreventUndo,e)}catch(e){t.reportError(e)}if(!M.flushingDeferredActions){try{t.PAssert(3119,M.inCompoundOperation||M.wantCompoundOperation,"If performing an action, we should have already requested a compound operation")}catch(e){t.reportError(e)}if(!M.inCompoundOperation&&M.wantCompoundOperation)try{M.deferredActionsCommitted&&M.flushDeferredActions(),w=setTimeout(c,0);M.model.beginCompoundOperation(void 0,!M.actionsPreventUndo),M.inCompoundOperation=!0,M.wantCompoundOperation=!1,M.deferredActionsCommitted||M.executeDeferredActions()}catch(e){t.reportError(e)}else try{t.PAssert(3120,!M.wantCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}}}},M.endAction=function(){if(M.model&&!M.isReadOnly()){try{t.PAssert(3121,!M.flushingDeferredActions,"Should never end an action while flushing")}catch(e){t.reportError(e)}try{t.PAssert(3122,!M.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(3123,M.inCompoundOperation||M.wantCompoundOperation,"If ending an action, a beginning should have happened")}catch(e){t.reportError(e)}try{M.hasPendingDeferredActions&&(M.deferredActionsCommitted=!0),M.inCompoundOperation&&M.model.endCompoundOperation()}catch(e){t.goog.recoverFromError(e)}finally{M.inCompoundOperation=!1,M.wantCompoundOperation=!1,M.actionsPreventUndo=!1,clearTimeout(w),w=void 0}}};var k,x={};M.performDeferredAction=function(e,i){try{t.PAssert(3126,e,"Must supply a valid item to perform the action on")}catch(e){t.reportError(e)}try{t.PAssert(3127,i,"Must supply a valid action to be performed")}catch(e){t.reportError(e)}if(M.model&&!M.isReadOnly()){try{t.PAssert(3128,!M.inCompoundOperation,"Cannot perform deferred action after a compound operation has started")}catch(e){t.reportError(e)}if(x[e.id])for(var n in i)x[e.id].changes[n]=i[n];else x[e.id]={item:e,changes:i};M.hasPendingDeferredActions=!0,clearTimeout(k),k=setTimeout(M.flushDeferredActions,800)}},M.executeDeferredActions=function(){M.flushingDeferredActions=!0;try{for(var e in x)f(x[e].item,x[e].changes)}catch(e){t.reportError(e)}finally{M.flushingDeferredActions=!1,M.hasPendingDeferredActions=!1,x={},M.deferredActionsCommitted=!1}},M.flushDeferredActions=function(){if(M.model&&!M.isClosed){try{t.PAssert(3129,!M.flushingDeferredActions,"Should never recursively call flushDeferredActions")}catch(e){t.reportError(e)}try{t.PAssert(3130,!M.inCompoundOperation,"Must flush deferred actions before starting a compound operation")}catch(e){t.reportError(e)}if(M.hasPendingDeferredActions){clearTimeout(k),k=void 0;try{M.model.beginCompoundOperation(void 0),M.executeDeferredActions(),M.model.endCompoundOperation()}catch(e){t.reportError(e)}}}},M.hasPotentialUnsavedData=function(){return!(!n||!n.hasMadeInMemoryOnlyUpdate||M.isConnected()&&!(M.doc.saveDelay>t.seconds(1)))},M.hasDeferredAction=function(e){return!!x[e]},M.createNewItem=function(e,i,n){try{t.PAssert(3135,!M.isReadOnly(),"Should never create a new item in a read-only doc")}catch(e){t.reportError(e)}M.beginWriteAction();try{t.PAssert(3136,e instanceof A,"Must pass in a valid instace of a local item")}catch(e){t.reportError(e)}try{t.PAssert(3137,e.shouldSave(),"Item must be marked as saveable")}catch(e){t.reportError(e)}try{t.PAssert(3138,M.inCompoundOperation,"Should always create an item inside of a compound operation")}catch(e){t.reportError(e)}try{t.PAssert(3139,!M.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(3140,M.model,"Need a valid model to create collaborative items")}catch(e){t.reportError(e)}try{t.PAssert(3141,!e.data,"When initializing a new item, it should have no gdata components already")}catch(e){t.reportError(e)}var r=M.model.createMap();e.data=r,e.data.connectIdentifier=M.connectIdentifier();try{t.PAssert(3142,e.getRawText().indexOf(window.AttachChar)<0,"Remote syncd changes should never contain AttachChar")}catch(e){t.reportError(e)}if(M.set(r,"text",e.getRawText()),i){var a=M.model.createList();M.set(r,"items",a)}if(n){var s=M.model.createList();M.set(r,"archivedItems",s)}return M.set(r,"dateCreated",e.dateCreated.getTime()),e.id=r.id,I[r.id]||(I[r.id]=r),r.id},M.initializeNewItem=function(e){try{t.PAssert(3143,!M.isReadOnly(),"Should never initialize a new item in a read-only doc")}catch(e){t.reportError(e)}M.beginWriteAction();try{t.PAssert(3144,e instanceof A,"Must pass in a valid instace of a local item")}catch(e){t.reportError(e)}try{t.PAssert(3145,e.shouldSave(),"Item must be marked as saveable")}catch(e){t.reportError(e)}try{t.PAssert(3146,!M.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(3147,M.inCompoundOperation,"Should always initialize an item inside of a compound operation")}catch(e){t.reportError(e)}if(e.hasChildren()){var i=e.getItems(),n=d(e);try{t.PAssert(3148,n,"Must have a valid collab list for normal init")}catch(e){t.reportError(e)}for(var r=0;r<i.length;++r){try{t.PAssert(3149,i[r].data,"Item must have a valid remote to be added to a collab list")}catch(e){t.reportError(e)}M.setItemParent(i[r].data,e.data),n.push(i[r].data)}}if(e.hasArchivedChildren()){var a=e.archivedItems(!0),s=h(e);try{t.PAssert(3150,s,"Must have a valid collab list for archived init")}catch(e){t.reportError(e)}for(var r=0;r<a.length;++r){try{t.PAssert(3151,a[r].data,"Item must have a valid remote to be added to a collab list")}catch(e){t.reportError(e)}M.setItemParent(a[r].data,e.data),s.push(a[r].data)}}if(e.hasNote()){var o=e.getNote();try{t.PAssert(3152,o.data,"Note must have a valid remote to be added to an item")}catch(e){t.reportError(e)}M.setItemParent(o.data,e.data),M.set(e.data,"note",o.data)}e.isNote()&&M.set(e.data,"isNote",!0),e.parent()&&M.setItemParent(e.data,e.parent().data),l(e)},M.attachEventsToItem=function(e){try{t.PAssert(3153,e instanceof A,"Must pass in a valid local item")}catch(e){t.reportError(e)}try{t.PAssert(3154,e.shouldSave(),"Item must be marked as saveable")}catch(e){t.reportError(e)}try{t.PAssert(3155,e.data,"Must have loaded data from gdrive before attaching events to item")}catch(e){t.reportError(e)}l(e)};var R;M.registerForUndoRedoStateChange=function(e){M.model?(M.model.addEventListener(gapi.drive.realtime.EventType.UNDO_REDO_STATE_CHANGED,e.stateChangeForUndoRedo),e.stateChangeForUndoRedo({canUndo:M.model.canUndo,canRedo:M.model.canRedo})):R=e},M.registerForSaveStateChange=function(e){try{t.PAssert(3156,M.doc,"Must have a valid doc to connect to")}catch(e){t.reportError(e)}M.doc.addEventListener(gapi.drive.realtime.EventType.DOCUMENT_SAVE_STATE_CHANGED,e)},M.loadCollaborators=function(){for(var e,i=M.doc.getCollaborators(),n=0;n<i.length;++n){var r=i[n];r.isMe&&(e=r)}M.authenticatedUser.set(e),e&&t.settings.set(Settings.displayName,e.displayName)},M.undoAction=function(){M.flushDeferredActions();try{t.PAssert(3157,!M.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(3158,M.model.canUndo,"Remote model must be able to undo")}catch(e){t.reportError(e)}try{M.model.undo()}catch(e){t.reportError(e)}},M.redoAction=function(){M.flushDeferredActions();try{t.PAssert(3159,!M.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(3160,M.model.canRedo,"Remote model must be able to redo")}catch(e){t.reportError(e)}t.vmMain.beginUpdateItems();try{M.model.redo()}catch(e){t.reportError(e)}t.vmMain.commitUpdateItems()},M.getItemParent=function(e){return e._mdParent},M.setItemParent=function(e,i){try{t.PAssert(3161,e,"Must provide a valid model when setting the item parent")}catch(e){t.reportError(e)}try{t.PAssert(3162,!(e instanceof A),"Must pass in a valid remote item for child")}catch(e){t.reportError(e)}try{t.PAssert(3163,!(i instanceof A),"Must pass in a valid remote item for parent")}catch(e){t.reportError(e)}try{t.PAssert(3164,!e||e.type===gapi.drive.realtime.CollaborativeTypes.COLLABORATIVE_MAP,"Model must be a valid Map")}catch(e){t.reportError(e)}try{t.PAssert(3165,!i||i.type===gapi.drive.realtime.CollaborativeTypes.COLLABORATIVE_MAP,"Parent must be a valid Map")}catch(e){t.reportError(e)}e._mdParent=i},M.getItemList=function(e,i){M.beginWriteAction();try{t.PAssert(3173,!(e instanceof A),"Must pass in a valid remote item")}catch(e){t.reportError(e)}return i?M.get(e,"archivedItems"):M.get(e,"items")},M.ensureItemList=function(e,i){M.beginWriteAction();try{t.PAssert(3174,e instanceof A,"Must pass in a valid local item")}catch(e){t.reportError(e)}try{t.PAssert(3175,e.shouldSave(),"Item must be marked as saveable")}catch(e){t.reportError(e)}return i?h(e):d(e)},M.canSave=function(e){if(M.initialized){var i=e instanceof A?e.data:e;try{t.PAssert(3182,i,"Must have a valid remote item to make changes")}catch(e){t.reportError(e)}try{t.PAssert(3183,!M.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(3184,!i||i.connectIdentifier===M.connectIdentifier(),"Using remote item data that is out of date",i?i.connectIdentifier:-1,M.connectIdentifier())}catch(e){t.reportError(e)}return!(!i||M.isClosed||i.connectIdentifier!==M.connectIdentifier())&&i}},M.deleteTree=function(e){M.beginWriteAction();try{t.PAssert(3185,e,"Must provide a valid item instance to deleteTree")}catch(e){t.reportError(e)}try{t.PAssert(3186,!(e instanceof A),"Must not be a VMLI, should be a remote item")}catch(e){t.reportError(e)}try{t.PAssert(3187,!t.isString(e),"Must pass in a valid remote item not an ID")}catch(e){t.reportError(e)}if(e){M.setItemParent(e,void 0);var i=n.getItem(e.id);i&&i.data&&i.data===e&&(i.data=void 0);var r=M.getItemList(e,!1);if(r)for(var a=0;a<r.length;++a){var s=r.get(a);M.deleteTree(s)}var o=M.getItemList(e,!0);if(o)for(var a=0;a<o.length;++a){var c=o.get(a);M.deleteTree(c)}M.removeItemFromCache(e.id)}};var O={NoteSet:"noteSet",ItemAdded:"itemAdded",ItemsAdded:"itemsAdded",ItemRemoved:"itemRemoved",ItemMoved:"itemMoved",ItemArchived:"itemArchived",ItemUnarchived:"itemUnarchived"},L={Exception:"Exception",NoData:"NoData",NoSrcList:"NoSrcList",NoDstList:"NoDstList",InvalidSrcIndex:"InvalidSrcIndex",InvalidDstIndex:"InvalidDstIndex"};M.docErrors=[],M.noteSet=function(e,i){if(!M.isConnected())return ReturnValue.Success;if(M.isReadOnly())return ReturnValue.Success;M.beginWriteAction();try{t.PAssert(3188,e,"Must provide a valid item to set a note on")}catch(e){t.reportError(e)}try{t.PAssert(3189,!i||i.isNote(),"Must be removing a note or setting note with a valid note item")}catch(e){t.reportError(e)}try{var n=M.canSave(e);if(!n)return m(O.NoteSet,L.NoData),ReturnValue.Error;var r;if(i){if(!(r=M.canSave(i)))return m(O.NoteSet,L.NoData),ReturnValue.Error;M.set(r,"isNote",!0)}try{t.PAssert(3190,!i||!M.get(n,"note"),"Should not set a note on an item that already has a note")}catch(e){t.reportError(e)}M.set(n,"note",r)}catch(e){throw m(O.NoteSet,L.Exception,e),e}return ReturnValue.Success},M.itemAdded=function(e){if(!M.isConnected())return ReturnValue.Success;if(M.isReadOnly())return ReturnValue.Success;M.beginWriteAction();var i=e.item,r=e.addedItem,a=e.index,s=e.isArchived,o=e.noVersion;try{t.PAssert(3191,void 0!==i&&void 0!==r&&void 0!==s,"itemAdded is missing parameters")}catch(e){t.reportError(e)}try{t.PAssert(3192,a>=-1||void 0===a,"Invalid index",a)}catch(e){t.reportError(e)}try{var c=M.canSave(i);if(!c)return m(O.ItemAdded,L.NoData),ReturnValue.Error;var l=M.canSave(r);if(!l)return m(O.ItemAdded,L.NoData),ReturnValue.Error;n.addPendingUpdate(i.id),n.addPendingUpdate(r.id);try{t.PAssert(3193,!i.isNote(),"Should not add a child to a note")}catch(e){t.reportError(e)}var d=M.ensureItemList(i,s);try{t.PAssert(3194,d,"Must have a valid remote list to add the item to")}catch(e){t.reportError(e)}try{t.PAssert(3195,isNaN(a)||a<=d.length,"Should not try to insert an item after the end of the array")}catch(e){t.reportError(e)}try{t.PAssert(3196,isNaN(a)||a>=0,"Should not try to insert an item at a negative index")}catch(e){t.reportError(e)}a<0||isNaN(a)||a>d.length?d.push(l):d.insert(a,l),o||u(l),M.setItemParent(l,c),M.cacheItem(l)}catch(e){throw m(O.ItemAdded,L.Exception,e),e}return ReturnValue.Success},M.itemsAdded=function(e){if(!M.isConnected())return ReturnValue.Success;if(M.isReadOnly())return ReturnValue.Success;M.beginWriteAction();var i=e.item;try{t.PAssert(3197,i instanceof A,"Passed in item must be a VMLI")}catch(e){t.reportError(e)}var r=e.addedItems,a=e.index,s=e.isArchived,o=e.noVersion;try{t.PAssert(3198,void 0!==i&&void 0!==r&&void 0!==s,"itemsAdded is missing parameters")}catch(e){t.reportError(e)}try{t.PAssert(3199,isNaN(a)||a>=0,"Must provide a valid item index when adding an item to a remote list")}catch(e){t.reportError(e)}try{var c=M.canSave(i);if(!c)return m(O.ItemsAdded,L.NoData),ReturnValue.Error;var l=M.ensureItemList(i,s);try{t.PAssert(3200,l,"Must have a valid remote list to add the item to")}catch(e){t.reportError(e)}try{t.PAssert(3201,a<=l.length,"Should not insert items after the end of the remote list")}catch(e){t.reportError(e)}for(var d=new Array(r.length),h=0;h<r.length;++h){try{t.PAssert(3202,!r[h].isNote(),"Should never be adding a note as a child")}catch(e){t.reportError(e)}d[h]=r[h].data,n.addPendingUpdate(r[h].id),!o&&d[h]&&u(d[h]),M.setItemParent(d[h],i),M.cacheItem(d[h])}n.addPendingUpdate(i.id);try{t.PAssert(3203,!i.isNote(),"Should never be adding a child to a note")}catch(e){t.reportError(e)}if(a<0||isNaN(a)){try{t.PAssert(3204,s,"Only archived items should be inserted into a list by pushing")}catch(e){t.reportError(e)}l.pushAll(d)}else l.insertAll(a,d)}catch(e){throw m(O.ItemsAdded,L.Exception,e),e}return ReturnValue.Success},M.itemRemoved=function(e){if(!M.isConnected())return ReturnValue.Success;if(M.isReadOnly())return ReturnValue.Success;M.beginWriteAction();var i=e.item,r=e.index,a=e.numToRemove,s=e.isArchived,o=e.noDelete,c=e.noVersion;try{t.PAssert(3205,void 0!==i&&void 0!==r&&void 0!==a&&void 0!==s,"itemRemoved is missing parameters")}catch(e){t.reportError(e)}try{t.PAssert(3206,r>=0,"Must have a valid index to remove from")}catch(e){t.reportError(e)}try{var l=M.canSave(i);if(!l)return m(O.ItemRemoved,L.NoData),ReturnValue.Error;isNaN(a)&&(a=1);var d=M.getItemList(l,s);if(!d)return m(O.ItemRemoved,L.NoSrcList),ReturnValue.Error;try{t.PAssert(3207,r+a<=d.length,"Should not be removing items past the end of the remote list")}catch(e){t.reportError(e)}for(var h=r;h<r+a;++h){var p=d.get(h);n.addPendingUpdate(p.id),c||u(p),o||M.deleteTree(p)}n.addPendingUpdate(i.id),1===a?d.remove(r):d.removeRange(r,r+a)}catch(e){throw m(O.ItemRemoved,L.Exception,e),e}return ReturnValue.Success},M.itemMoved=function(e){if(!M.isConnected())return ReturnValue.Success;if(M.isReadOnly())return ReturnValue.Success;M.beginWriteAction();var i=e.item,r=e.newInfo,a=e.oldParent,s=e.oldInfo,o=e.noVersion;try{t.PAssert(3208,void 0!==i&&void 0!==r&&void 0!==a&&void 0!==s,"itemMoved is missing parameters")}catch(e){t.reportError(e)}try{t.PAssert(3209,r&&r.index>=-1,"Must supply a valid new item index")}catch(e){t.reportError(e)}try{t.PAssert(3210,r&&void 0!==r.isArchived,"Must determine if this item is archived or not")}catch(e){t.reportError(e)}try{t.PAssert(3211,a,"Must specify a valid old parent")}catch(e){t.reportError(e)}try{t.PAssert(3212,s&&s.index>=0,"Must supply a valid old item index")}catch(e){t.reportError(e)}try{t.PAssert(3213,s&&void 0!==s.isArchived,"Must determine if this item was archived or not")}catch(e){t.reportError(e)}try{var c=M.canSave(i);if(!c)return m(O.ItemMoved,L.NoData),ReturnValue.Error;var l=M.canSave(a);if(!l)return m(O.ItemMoved,L.NoData),
ReturnValue.Error;var d=M.canSave(i.parent());if(!d)return m(O.ItemMoved,L.NoData),ReturnValue.Error;var h=M.getItemList(l,s.isArchived);if(!h)return m(O.ItemMoved,L.NoSrcList),ReturnValue.Error;if(s.index>=h.length)return m(O.ItemMoved,L.InvalidSrcIndex),ReturnValue.Error;var p=M.ensureItemList(i.parent(),r.isArchived);if(!p)return m(O.ItemMoved,L.NoDstList),ReturnValue.Error;if(r.index>p.length)return m(O.ItemMoved,L.InvalidDstIndex),ReturnValue.Error;var f=r.index;(r.index<0||isNaN(r.index)||r.index>p.length)&&(f=p.length),h.moveToList(s.index,p,f),M.setItemParent(c,d),n.addPendingUpdate(i.id),n.addPendingUpdate(a.id),n.addPendingUpdate(i.parent().id);try{t.PAssert(3214,!i.isNote(),"Should never move a note as a child")}catch(e){t.reportError(e)}try{t.PAssert(3215,!i.parent().isNote(),"Notes should never have children")}catch(e){t.reportError(e)}o||u(c)}catch(e){throw m(O.ItemMoved,L.Exception,e),e}return ReturnValue.Success},M.itemArchived=function(e,i,r){if(!M.isConnected())return ReturnValue.Success;if(M.isReadOnly())return ReturnValue.Success;M.beginWriteAction();try{t.PAssert(3216,r>=0,"Must have a valid index to remove from")}catch(e){t.reportError(e)}try{var a=M.canSave(e);if(!a)return m(O.ItemArchived,L.NoData),ReturnValue.Error;if(!M.canSave(i))return m(O.ItemArchived,L.NoData),ReturnValue.Error;var s=M.getItemList(a,!1);if(!s)return m(O.ItemArchived,L.NoSrcList),ReturnValue.Error;var o=h(e);if(!o)return m(O.ItemArchived,L.NoDstList),ReturnValue.Error;if(!(r<s.length))return m(O.ItemArchived,L.InvalidSrcIndex),ReturnValue.Error;s.moveToList(r,o,o.length),n.addPendingUpdate(e.id),n.addPendingUpdate(i.id);try{t.PAssert(3217,!e.isNote(),"Parents should never be archiving notes")}catch(e){t.reportError(e)}u(i.data)}catch(e){throw m(O.ItemArchived,L.Exception,e),e}return ReturnValue.Success},M.itemUnarchived=function(e,i,r,a){if(!M.isConnected())return ReturnValue.Success;if(M.isReadOnly())return ReturnValue.Success;M.beginWriteAction();try{t.PAssert(3218,r>=0,"Must have a valid index to remove from")}catch(e){t.reportError(e)}try{var s=M.canSave(e);try{t.PAssert(3219,s,"Must have valid item data when archiving an item")}catch(e){t.reportError(e)}if(!s)return m(O.ItemUnarchived,L.NoData),ReturnValue.Error;if(!M.canSave(i))return m(O.ItemUnarchived,L.NoData),ReturnValue.Error;var o=M.get(s,"items");try{t.PAssert(3220,o,"Must be an items array present")}catch(e){t.reportError(e)}var c=M.get(s,"archivedItems");try{t.PAssert(3221,c,"Must be an archived items array present")}catch(e){t.reportError(e)}c.moveToList(r,o,a),n.addPendingUpdate(e.id),n.addPendingUpdate(i.id),u(i.data)}catch(e){throw m(O.ItemUnarchived,L.Exception,e),e}return ReturnValue.Success},M.saveChanges=function(e,i){if(M.isConnected()&&!M.isReadOnly()){if(i&&i.text){try{t.PAssert(3222,i.text.indexOf(window.AttachChar)<0,"Remote syncd changes should never contain AttachChar")}catch(e){t.reportError(e)}try{t.PAssert(3223,e.isNote()||i.text.indexOf("\n")<0,"Remove syncd changes should never contain newlines")}catch(e){t.reportError(e)}}M.inCompoundOperation||M.actionsPreventUndo?f(e,i):M.performDeferredAction(e,i)}},M.resetDriveData=function(){I={},M.initialized=!1,M.doc=void 0,M.model=void 0,M.root=void 0,M.rootItem=void 0,M.rootID=void 0,window.__remoteDoc=void 0,M.cachesRemote=void 0,n.forEachModel(function(e){e.resetDriveData()}),t.vmMain.notifyDriveDisconnect(),M.inCompoundOperation=!1,M.wantCompoundOperation=!1,M.flushingDeferredActions=!1,M.deferredActionsCommitted=!1,clearTimeout(w),w=void 0,clearTimeout(k),k=void 0,M.hasPendingDeferredActions=!1,x={}},M.clearItemEventListeners=function(){n.forEachModel(function(e){e.data&&e.data.removeAllEventListeners()})},M.close=function(e){try{t.PAssert(3235,e||H===U.Error,"Invalid state for document close: ",H)}catch(e){t.reportError(e)}try{t.PAssert(3236,!M.wantCompoundOperation,"Closing the doc with a deferred compound operation")}catch(e){t.reportError(e)}if(M.doc&&!M.isClosed){log("---- Closing Remote Document! ----"),M.isClosed=!0,t.vmMain.setGDriveStatus(DriveStatus.Offline);try{M.doc.close()}catch(e){log("Error Closing Doc: ",e)}M.resetDriveData()}else t.vmMain.isReconnecting()&&t.vmMain.setGDriveStatus(DriveStatus.Offline)};var N,F=0,B=[1e3,2e4,4e4,6e4,9e4];M.setupReconnect=function(){try{t.PAssert(3238,H===U.Error||H===U.XHRError,"Invalid state for setup reconnect: ",H)}catch(e){t.reportError(e)}try{t.PAssert(3239,!N,"Reconnect timer already active")}catch(e){t.reportError(e)}var e=g(F++);clearTimeout(N),N=setTimeout(v,e)},M.notifyReconnectFailure=function(){M.setupReconnect()},M.notifyReconnectSuccess=function(){F=0,clearTimeout(N),N=void 0};var U={Disconnected:0,Connecting:1,Connected:2,Reconnecting:3,Error:4,XHRError:5},H=U.Disconnected;M.getDriveRealtimeStatus=function(){return H};var V=1;M.connectIdentifier=function(){return V};var q=!1;if(M.driveRealtimeLoad=function(e,i,n,r){try{t.PAssert(3248,H===U.Disconnected||H===U.Error,"Loading realtime document from invalid state")}catch(e){t.reportError(e)}var a=H;if(H===U.Disconnected?y(U.Connecting):H!==U.Error&&H!==U.XHRError||y(U.Reconnecting),a===U.Disconnected||a===U.Error||a===U.XHRError){q=t.registerURLForNotifyXHR("https://drive.google.com/otservice/gs",C);try{t.PAssert(3249,q,"XHR must always be successfully wrapped")}catch(e){t.reportError(e)}t.checkpoint(Checkpoint.DocLoadRequested),gapi.drive.realtime.load(e,b(i),S(n),E(r))}},M.onInitialized=function(e){log("Initializing",e),n||(n=require("data")),A||(A=require("VMLI"));var r=e.createMap(),a=e.createList();M.set(r,"text",i.RootItemName),M.set(r,"items",a),M.set(r,"archivedItems",e.createList()),M.set(r,"dateCreated",Date.now());var s=e.getRoot();s.set("dataVersion",6),s.set("root",r);var o=t.vmMain.docManager.getOpenDoc();try{t.PAssert(3250,o,"Must have an open doc to be initializing a realtime doc")}catch(e){t.reportError(e)}o.getDocumentFolder(function(e){s.set("docFolderID",e)}),s.set("settings",e.createMap()),s.set("caches",e.createMap())},M.onFirstInitialized=function(e){function i(t,i){var n=e.createMap();M.set(n,"text",i);var r=M.get(t,"items");return r||(r=e.createList(),M.set(t,"items",r)),r.push(n),n}var n=e.getRoot().get("root"),r=i(n,"# Welcome to Moo.do");i(r,"Press **Tab** to indent and **Shift + Tab** to unindent"),i(r,"Use #tags and dates @today 4pm to get organized"),i(r,""),r=i(n,"# Start a line with # to create a project"),i(r,"[ Start a line with [ to create a task"),r=i(r,"# Use hierarchy to organize projects and sub-projects"),i(r,"Now delete this and add your own projects"),t.vmMain.runFirstRun()},DETAILED_STATS){var W={reads:0,writes:0,missedWrites:0,exists:0,updates:0,deletes:0,ensures:0,rchanges:0};M.getPreviewCacheStats=function(){return W},window.__dumpRCacheStats=function(){log("---- RCache Stats ----"),log(" Reads: "+W.reads),log(" Writes: "+W.writes),log(" MWrites: "+W.missedWrites),log(" Exists: "+W.exists),log(" Updates: "+W.updates),log(" Deletes: "+W.deletes),log(" Ensures: "+W.ensures),log(" RChanges: "+W.rchanges),log("----------------------")}}var z={};M.maxCacheEntrySize=function(){return 300},M.cacheChanged=function(e,i){if(i.ocHandled||i.isLocal)return!1;for(var n=0;n<i.events.length;++n){var r=i.events[n];switch(DETAILED_STATS&&W.rchanges++,r.type){case gapi.drive.realtime.EventType.VALUES_ADDED:M.notifyListeners(e,DataChangeType.Add,r.property,r.newValue);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:M.notifyListeners(e,DataChangeType.Remove,r.property,r.newValue);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:M.notifyListeners(e,DataChangeType.Change,r.property,r.newValue);break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:default:try{t.PAssert(3251,!1,"Unexpected event type")}catch(e){t.reportError(e)}}}};var G={};M.notifyListeners=function(e,i,n,r){var a=G[e];try{t.PAssert(3252,a&&a.length>0,"Should always have an interested party if we are receiving notifications")}catch(e){t.reportError(e)}try{var s;r&&(s=JSON.parse(r),s.id=n);for(var o=0;o<a.length;++o)try{a[o](i,n,s)}catch(e){t.reportError(e)}}catch(e){t.reportError(e)}},M.hookCacheListeners=function(){for(var e in G)try{M.hookCacheListener(e)}catch(e){t.reportError(e)}},M.hookCacheListener=function(e){var i=M.cachesRemote.get(e);try{t.PAssert(3253,i,"If we are listening for a cache, it must have been ensured first")}catch(e){t.reportError(e)}var n=!1;if(i){var r=i.get("data");try{t.PAssert(3254,r,"Malformed cache, must have a data entry present")}catch(e){t.reportError(e)}r&&(r.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,M.cacheChanged.bind(M,e)),n=!0)}return n},M.registerForCacheChanges=function(e,i){try{t.PAssert(3255,i,"Must provide a valid callback function for cache changes")}catch(e){t.reportError(e)}var n=!1,r=G[e];if(r){try{t.PAssert(3256,r.indexOf(i)<0,"Should never double register a listener")}catch(e){t.reportError(e)}r.push(i)}else G[e]=[i];return M.isCacheAvailable(e)&&(n=M.hookCacheListener(e)),n},M.unregisterForCacheChanges=function(e,i){var n=G[e];try{t.PAssert(3257,n,"Must have previously registered with a cache")}catch(e){t.reportError(e)}var r=n.remove(i);try{t.PAssert(3258,r>=0,"Did not try to remove a valid listener")}catch(e){t.reportError(e)}return r>=0},M.loadDataCaches=function(){M.cachesRemote=M.root.get("caches"),M.cachesRemote||(M.cachesRemote=M.model.createMap(),M.root.set("caches",M.cachesRemote));try{var e=M.verifyCaches();try{t.PAssert(3259,e,"Preview caches are not in a fully valid state")}catch(e){t.reportError(e)}}catch(e){t.reportError(e)}M.writeMissedCacheEntries(),M.sendAvailableNotifications(),M.hookCacheListeners()},M.queryCache=function(e,i){try{t.PAssert(3260,M.cachesRemote,"Caches must have been initialized")}catch(e){t.reportError(e)}try{t.PAssert(3261,!t.isTempId(i),"Should not query remote cache for local only items")}catch(e){t.reportError(e)}DETAILED_STATS&&W.reads++;var n=M.ensureCache(e);if(n){var r=JSON.parse(n.get("data").get(i));if(r)return r.id=i,r}},M.hasCacheEntry=function(e,i){try{t.PAssert(3262,M.cachesRemote,"Caches must have been initialized")}catch(e){t.reportError(e)}try{t.PAssert(3263,!t.isTempId(i),"Should not query remote cache for local only items")}catch(e){t.reportError(e)}DETAILED_STATS&&W.exists++;var n=M.ensureCache(e);return!!n&&!!n.get("data").get(i)},M.updateCache=function(e,i,n){try{t.PAssert(3266,!t.isTempId(i),"Should never save a local only item to the remote cache")}catch(e){t.reportError(e)}var r,a=M.ensureCache(e),s=n;try{try{t.PAssert(3267,!t.isString(n),"Should only be saving objects rather than raw strings in cache")}catch(e){t.reportError(e)}n=JSON.stringify(n)}catch(e){t.reportError(e),n=void 0}if(a){r=a.get("data").get(i);var o=P(r),c=P(n);if(c<M.maxCacheEntrySize())try{var l=T(s);try{t.PAssert(3268,c<M.maxCacheEntrySize(),"New cache entry too large",c,l)}catch(e){t.reportError(e)}}catch(e){t.reportError(e)}var d=c-o,h=a.get("info");if(r?DETAILED_STATS&&W.updates++:h.set("entries",h.get("entries")+1),d>0&&h.set("size",h.get("size")+d),void 0!==n)DETAILED_STATS&&W.writes++,a.get("data").set(i,n);else{try{t.PAssert(3269,r,"Should never be setting undefined->undefined")}catch(e){t.reportError(e)}DETAILED_STATS&&W.deletes++,a.get("data").delete(i)}}else DETAILED_STATS&&W.missedWrites++,M.notifyMissedCacheWrite(e,i,s);return r},M.ensureCache=function(e){DETAILED_STATS&&W.ensures++;var t;if(M.cachesRemote&&!(t=M.cachesRemote.get(e))){M.model.beginCompoundOperation(),t=M.model.createMap();var i=M.model.createMap();i.set("entries",0),i.set("size",0),t.set("info",i);var n=M.model.createMap();t.set("data",n),M.cachesRemote.set(e,t),M.model.endCompoundOperation()}return t},M.clearCache=function(e){try{t.PAssert(3270,M.cachesRemote,"Caches must have been initialized")}catch(e){t.reportError(e)}if(M.cachesRemote){var i=M.cachesRemote.get(e);if(i){i.get("data").clear();var n=i.get("info");try{t.PAssert(3271,n,"Malformed cache, every cache must have an info object")}catch(e){t.reportError(e)}n.set("entries",0),n.set("size",0)}}},M.clearCaches=function(){},M.getCacheSize=function(e){try{t.PAssert(3272,M.cachesRemote,"Caches must have been initialized to get cache size")}catch(e){t.reportError(e)}if(M.cachesRemote){var i=M.cachesRemote.get(e);if(i)return i.get("info").get("size")}return 0},M.verifyCaches=function(){try{t.PAssert(3273,M.cachesRemote,"Caches must have been initialized to verify")}catch(e){t.reportError(e)}try{t.PAssert(3274,t.vmMain&&t.vmMain.pluginManager,"Must have intiialized VMMain and PluginManager")}catch(e){t.reportError(e)}var e=!0;if(M.cachesRemote)for(var i=M.cachesRemote.keys(),n=0;n<i.length;++n){var r=t.vmMain.pluginManager.getPluginFromPreviewCache(i[n]);if(r){var a=D(r,M.cachesRemote.get(i[n]));a||(e=!1)}else try{t.PAssert(3275,!1,"Unknown plugin in preview cache: ",i[n])}catch(e){t.reportError(e)}}return e},M.isCacheAvailable=function(e){return!(!M.cachesRemote||!M.cachesRemote.get(e))};var j=[];M.requestNotifyWhenAvailable=function(e){try{t.PAssert(3276,j.indexOf(e)<0,"Should not push same callback multiple times")}catch(e){t.reportError(e)}M.cachesRemote||t.isDemoMode()?e():j.push(e)},M.sendAvailableNotifications=function(){for(var e=0;e<j.length;++e)j[e]();j=[]},M.notifyMissedCacheWrite=function(e,t,i){z[e]||(z[e]={}),z[e][t]=i},M.writeMissedCacheEntries=function(){try{t.PAssert(3277,M.cachesRemote,"When flushing missed cache writes, must have access to remote doc cache")}catch(e){t.reportError(e)}var e=0;for(var i in z){var n=z[i];for(var r in n){var a=n[r];M.updateCache(i,r,a),e++}}z={},e>0&&t.reportError(new Error("Writing missed cache entries: "+e))},M.poke=function(){if(M.root&&!M.isClosed&&!M.isReadOnly())try{var e=M.root.get("poke");M.model.beginCompoundOperation("poke",!1),e?M.root.set("poke",e+1):M.root.set("poke",1),M.model.endCompoundOperation()}catch(e){log("Exception during poke, reconnecting: ",e),M.close(),M.setupReconnect()}},window.__poke=M.poke,M.rootChanged=function(e){if(e.ocHandled||e.isLocal||M.root&&M.root.id!==e.target.id)return!1;for(var i=0;i<e.events.length;++i){var r=e.events[i];switch(r.type){case gapi.drive.realtime.EventType.VALUES_ADDED:case gapi.drive.realtime.EventType.VALUES_REMOVED:break;case gapi.drive.realtime.EventType.VALUE_CHANGED:if("dataVersion"===r.property)r.newValue>6?t.AppCache.checkForUpdate(!0):r.newVersion<6&&t.reportError(new Error("Remote setting dataVersion to invalid value"+r.newVersion));else if("recoverVersion"===r.property){M.clearItemEventListeners();var a=t.settings.get(Settings.localRecoverVersion);a<r.newValue&&(t.settings.set(Settings.localRecoverVersion,r.newValue),n.addDefaultSkipSetting(Settings.gdocId,"Default"),n.addDefaultSkipSetting(Settings.gdocTitle,"Default"),M.close(!0),t.menus.alert({text:"A remote user has recovered this document. The app needs to restart to continue editing.",actionText:"OKAY",callback:n.clearDataAndReload}))}break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:default:try{t.PAssert(3278,!1,"Unexpected event type")}catch(e){t.reportError(e)}}}},M.isConnected=function(){return M.initialized&&!M.isClosed&&!!M.model};M.onLoad=function(e){try{try{window.__LOAD_HANDLES.push(t.getCurrentStack("Document Opened Handled"))}catch(e){t.reportError(e)}try{t.PAssert(3282,M.isClosed,"Document must not already be open when we are loading")}catch(e){t.reportError(e)}try{M.isClosed||t.reportError(new Error("Multi-Document Load"),window.__LOAD_REQUESTS.ordered())}catch(e){t.reportError(e)}M.initialized=!0,M.loadedOnce=!0,ShouldLog(LogLevels.Timing)&&log("Loading document from gdrive",log.now()),n||(n=require("data")),A||(A=require("VMLI")),M.doc=e,M.model=e.getModel(),M.root=M.model.getRoot(),M.isReadOnly()&&t.vmMain.gdriveStatusObs.notify(),M.root.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,M.rootChanged),M.isClosed=!1,M.registerForSaveStateChange(M.onSaveStateChange);return M.migrateData()?(log("---- Skipping Document Load! ----"),M.isClosed=!0,M.initialized=!1,M.doc=void 0,M.model=void 0,M.root=void 0,!1):(M.loadDataCaches(),M.rootItem=M.root.get("root"),M.rootItem?(M.rootID=M.rootItem.id,window.__remoteDoc=e,R&&(M.registerForUndoRedoStateChange(R),R=void 0),t.vmMain&&t.vmMain.isLoaded?t.vmMain.loadGDriveData():t.requireGDriveDataCallback=!0,M.loadCollaborators(),!0):void t.menus.alert({text:"Moo.do has encountered an error. The developers have been notified to make sure this doesn't happen again. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",callback:function(){n.clearData(function(){t.reload()})}}))}catch(e){t.reportError(e)}},M.getServerVersion=function(){if(M.model&&!M.isClosed)return M.model.serverVersion};var K=[];M.registerSaveNotify=function(e){K.push(e)};var Y,X=!1,Q=!1;return M.onSaveStateChange=function(e){if(X!==e.isPending||Q!==e.isSaving){if(e.isSaving||e.isPending)navigator.onLine?e.isSaving&&(e.isPending||t.vmMain.setGDriveStatus(DriveStatus.Saving),clearTimeout(Y),Y=setTimeout(M.onErrorSaving,M.offlineTimeoutMS)):t.vmMain.setGDriveStatus(DriveStatus.Offline);else{t.vmMain.setGDriveStatus(DriveStatus.Saved),n.clearPendingUpdates(),clearTimeout(Y),Y=void 0,t.toasts.clearMessage(MessageID.ConnectionError);for(var i=0;i<K.length;++i)K[i](M.numChanges);M.numChanges=0,M.lastChangeTime.set(Date.now())}X=e.isPending,Q=e.isSaving}},M.onErrorSaving=function(){t.vmMain.setGDriveStatus(DriveStatus.Offline),Y=void 0},M.getVersion=function(e,i){try{t.PAssert(3283,!(e instanceof A),"Must pass in a valid remote item: ",t.getObjectInfo(e))}catch(e){t.reportError(e)}var n;switch(i){case VersionType.Structure:n=e.get(t.translateFieldIn("version"));break;case VersionType.Text:n=e.get(t.translateFieldIn("versionText"));break;default:n=-2;try{t.PAssert(3284,!1,"Invalid version type")}catch(e){t.reportError(e)}}return n||0},M.get=function(e,i){try{t.PAssert(3285,!(e instanceof A),"Must pass in a valid remote item: ",t.getObjectInfo(e))}catch(e){t.reportError(e)}return e.get(t.translateFieldIn(i))},M.set=function(e,i,n){try{t.PAssert(3286,!M.isReadOnly(),"Should never perform a write action on a read-only doc")}catch(e){t.reportError(e)}M.beginWriteAction();try{t.PAssert(3287,!(e instanceof A),"Must pass in a valid remote item: ",t.getObjectInfo(e))}catch(e){t.reportError(e)}return void 0===n&&(n=null),e.set(t.translateFieldIn(i),n)},M.delete=function(e,i){try{t.PAssert(3288,!M.isReadOnly(),"Should never perform a write action on a read-only doc")}catch(e){t.reportError(e)}M.beginWriteAction();try{t.PAssert(3289,!(e instanceof A),"Must pass in a valid remote item: ",t.getObjectInfo(e))}catch(e){t.reportError(e)}return e.delete(t.translateFieldIn(i))},M.findInTree=function(e){try{t.PAssert(3292,e,"Must provide a valid item to find")}catch(e){t.reportError(e)}var i=!1,n=M.getItemParent(e);if(n){var r=M.getItemList(n,!1),a=-1;if(r&&(a=r.indexOf(e)),a<0){var s=M.getItemList(n,!0);s&&(a=s.indexOf(e))>=0&&(i=!0)}}var o=void 0;return n&&a>=0&&(o={parent:n,index:a,isArchived:i}),o},M});var idbModules={util:{}},cleanInterface=!1;!function(){"use strict";var e={test:!0};if(Object.defineProperty)try{Object.defineProperty(e,"test",{enumerable:!1}),e.test&&(cleanInterface=!0)}catch(e){}}(),function(e){"use strict";function t(e,t,i){i.target=t,"function"==typeof t[e]&&t[e].apply(t,[i])}var i=function(){this.length=0,this._items=[],cleanInterface&&Object.defineProperty(this,"_items",{enumerable:!1})};if(i.prototype={contains:function(e){return-1!==this._items.indexOf(e)},item:function(e){return this._items[e]},indexOf:function(e){return this._items.indexOf(e)},push:function(e){this._items.push(e),this.length+=1;for(var t=0;t<this._items.length;t++)this[t]=this._items[t]},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length;for(var e in this)e===String(parseInt(e,10))&&delete this[e];for(e=0;e<this._items.length;e++)this[e]=this._items[e]}},cleanInterface)for(var n in{indexOf:!1,push:!1,splice:!1})Object.defineProperty(i.prototype,n,{enumerable:!1});e.util.callback=t,e.util.StringList=i,e.util.quote=function(e){return'"'+e+'"'}}(idbModules),function(e){"use strict";e.Sca=window.Sca}(idbModules),function(idbModules){"use strict";function validateKey(e){var t=typeof e;if("string"===t||"number"===t&&!isNaN(e)||e instanceof Date);else{if(!(e instanceof Array))throw idbModules.util.createDOMException("DataError","Not a valid key");for(var i=0;i<e.length;i++)validateKey(e[i])}}function getKeyPath(value,keyPath){try{return eval("value."+keyPath)}catch(e){return}}function setKeyPath(e,t,i){for(var n=t.split("."),r=0;r<n.length-1;r++){var a=n[r];e=e[a]=e[a]||{}}e[n[n.length-1]]=i}var collations=["","number","string","boolean","object","undefined"],getGenericEncoder=function(){return{encode:function(e){return collations.indexOf(typeof e)+"-"+JSON.stringify(e)},decode:function(e){return void 0===e?void 0:JSON.parse(e.substring(2))}}},types={boolean:getGenericEncoder(),object:getGenericEncoder(),number:{encode:function(e){return collations.indexOf("number")+"-"+e},decode:function(e){return parseFloat(e.substring(2))}},string:{encode:function(e){return collations.indexOf("string")+"-"+e},decode:function(e){return""+e.substring(2)}},undefined:{encode:function(e){return collations.indexOf("undefined")+"-undefined"},decode:function(e){}}};idbModules.Key={encode:function(e){return types[typeof e].encode(e)},encodeKey:function(e){return validateKey(e),types[typeof e].encode(e)},decode:function(e){return types[collations[e.substring(0,1)]].decode(e)},validateKey:validateKey,getKeyPath:getKeyPath,setKeyPath:setKeyPath}}(idbModules),function(e){"use strict";function t(e,t){var i=new window.Event(e);return i.debug=t,Object.defineProperty(i,"target",{writable:!0}),i}function i(e,t){this.type=e,this.debug=t,this.bubbles=!1,this.cancelable=!1,this.eventPhase=0,this.timeStamp=(new Date).valueOf()}var n=!1;try{var r=t("test type","test debug"),a={test:"test target"};r.target=a,r instanceof window.Event&&"test type"===r.type&&"test debug"===r.debug&&r.target===a&&(n=!0)}catch(e){}n?(e.Event=window.Event,e.IDBVersionChangeEvent=window.Event,e.util.createEvent=t):(e.Event=i,e.IDBVersionChangeEvent=i,e.util.createEvent=function(e,t){return new i(e,t)})}(idbModules),function(e){"use strict";function t(e,t){var i=new DOMException.prototype.constructor(0,t);return i.name=e||"DOMException",i.message=t,i}function i(e,t){e=e||"DOMError";var i=new DOMError(e,t);return i.name===e||(i.name=e),i.message===t||(i.message=t),i}function n(e,t){var i=new Error(t);return i.name=e||"DOMException",i.message=t,i}function r(e,t,i){}var a,s=!1,o=!1,c=!1;try{Object.getOwnPropertyDescription&&Object.getOwnPropertyDescription(DOMException.prototype,"name").set&&(s=!0),s&&(a=t("test name","test message"))instanceof DOMException&&"test name"===a.name&&"test message"===a.message&&(o=!0)}catch(e){}try{a=i("test name","test message"),a instanceof DOMError&&"test name"===a.name&&"test message"===a.message&&(c=!0)}catch(e){}e.util.logError=r,o?(e.DOMException=DOMException,e.util.createDOMException=function(e,i,n){return t(e,i)}):(e.DOMException=Error,e.util.createDOMException=function(e,t,i){return n(e,t)}),c?(e.DOMError=DOMError,e.util.createDOMError=function(e,t,n){return i(e,t)}):(e.DOMError=Error,e.util.createDOMError=function(e,t,i){return n(e,t)})}(idbModules),function(e){"use strict";function t(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"}function i(){this.onblocked=this.onupgradeneeded=null}i.prototype=new t,i.prototype.constructor=i,e.IDBRequest=t,e.IDBOpenDBRequest=i}(idbModules),function(e,t){"use strict";function i(e,t,i,n){this.lower=e,this.upper=t,this.lowerOpen=i,this.upperOpen=n}i.only=function(e){return new i(e,e,!1,!1)},i.lowerBound=function(e,t){return new i(e,void 0,t,void 0)},i.upperBound=function(e,t){return new i(void 0,e,void 0,t)},i.bound=function(e,t,n,r){return new i(e,t,n,r)},e.IDBKeyRange=i}(idbModules),function(e,t){"use strict";function i(i,n,r,a,s,o){if(!i||i instanceof e.IDBKeyRange||(i=new e.IDBKeyRange(i,i,!1,!1)),this.__range=i,this.__req=a,this.source=r,this.key=t,this.direction=n,this.__keyColumnName=s,this.__valueColumnName=o,this.__valueDecoder="value"===o?e.Sca:e.Key,!this.source.transaction.__active)throw e.util.createDOMException("TransactionInactiveError","The transaction this IDBObjectStore belongs to is not active.");this.__offset=-1,this.__lastKeyContinued=t,this.continue()}i.prototype.__find=function(i,n,r,a,s){s=s||1;var o=this,c=["SELECT * FROM ",e.util.quote(o.source.name)],l=[];c.push("WHERE ",o.__keyColumnName," NOT NULL"),!o.__range||o.__range.lower===t&&o.__range.upper===t||(c.push("AND"),o.__range.lower!==t&&(c.push(o.__keyColumnName+(o.__range.lowerOpen?" >":" >= ")+" ?"),l.push(e.Key.encode(o.__range.lower))),o.__range.lower!==t&&o.__range.upper!==t&&c.push("AND"),o.__range.upper!==t&&(c.push(o.__keyColumnName+(o.__range.upperOpen?" < ":" <= ")+" ?"),l.push(e.Key.encode(o.__range.upper)))),void 0!==i&&(o.__lastKeyContinued=i,o.__offset=0),o.__lastKeyContinued!==t&&(c.push("AND "+o.__keyColumnName+" >= ?"),l.push(e.Key.encode(o.__lastKeyContinued)));var d="prev"===o.direction||"prevunique"===o.direction?"DESC":"ASC";c.push("ORDER BY ",o.__keyColumnName," "+d),c.push("LIMIT "+s+" OFFSET "+o.__offset),o.__prefetchedData=null,n.executeSql(c.join(" "),l,function(e,i){i.rows.length>1?(o.__prefetchedData=i.rows,o.__prefetchedIndex=0,o.__decode(i.rows.item(0),r)):1===i.rows.length?o.__decode(i.rows.item(0),r):r(t,t)},function(e,t){a(t)})},i.prototype.__decode=function(t,i){i(e.Key.decode(t[this.__keyColumnName]),this.__valueDecoder.decode(t[this.__valueColumnName]),e.Key.decode(t.key))},i.prototype.continue=function(i){var n=e.cursorPreloadPackSize||1e3,r=this;this.source.transaction.__addToTransactionQueue(function(e,a,s,o){r.__offset++;var c=function(e,i,n){r.key=e,r.value=i,r.primaryKey=n,s(void 0!==r.key?r:t,r.__req)};if(r.__prefetchedData&&++r.__prefetchedIndex<r.__prefetchedData.length)return void r.__decode(r.__prefetchedData.item(r.__prefetchedIndex),c);r.__find(i,e,c,o,n)})},i.prototype.advance=function(i){if(i<=0)throw e.util.createDOMException("Type Error","Count is invalid - 0 or negative",i);var n=this;this.source.transaction.__addToTransactionQueue(function(e,r,a,s){n.__offset+=i,n.__find(t,e,function(e,i){n.key=e,n.value=i,a(void 0!==n.key?n:t,n.__req)},s)})},i.prototype.update=function(i){var n=this;n.source.transaction.__assertWritable();var r=this.source.transaction.__createRequest();return e.Sca.encode(i,function(a){n.source.transaction.__pushToQueue(r,function(r,s,o,c){n.__find(t,r,function(t,s,l){for(var d=n.source,h=[a],u="UPDATE "+e.util.quote(d.name)+" SET value = ?",p=0;p<d.indexNames.length;p++){var m=d.__indexes[d.indexNames[p]];u+=", "+m.name+" = ?",h.push(e.Key.encode(e.Key.getKeyPath(i,m.keyPath)))}u+=" WHERE key = ?",h.push(e.Key.encode(l)),r.executeSql(u,h,function(e,i){n.__prefetchedData=null,1===i.rowsAffected?o(t):c("No rows with key found"+t)},function(e,t){c(t)})},c)})}),r},i.prototype.delete=function(){var i=this;return i.source.transaction.__assertWritable(),this.source.transaction.__addToTransactionQueue(function(n,r,a,s){i.__find(t,n,function(r,o,c){var l="DELETE FROM  "+e.util.quote(i.source.name)+" WHERE key = ?";n.executeSql(l,[e.Key.encode(c)],function(e,n){i.__prefetchedData=null,1===n.rowsAffected?(i.__offset--,a(t)):s("No rows with key found"+r)},function(e,t){s(t)})},s)})},e.IDBCursor=i}(idbModules),function(e,t){"use strict";function i(e,t){this.objectStore=e,this.name=t.columnName,this.keyPath=t.keyPath,this.multiEntry=t.optionalParams&&t.optionalParams.multiEntry,this.unique=t.optionalParams&&t.optionalParams.unique}i.__createIndex=function(t,i){t.__indexes[i.name]=i,t.indexNames.push(i.name),t.transaction.__addToTransactionQueue(function(n,r,a,s){function o(t,n){s(e.util.createDOMException(0,'Could not create index "'+i.name+'"',n))}var c=["ALTER TABLE",e.util.quote(t.name),"ADD",e.util.quote(i.name),"BLOB"].join(" ");n.executeSql(c,[],function(n,r){n.executeSql("SELECT * FROM "+e.util.quote(t.name),[],function(n,r){function s(a){if(a<r.rows.length)try{var l=e.Sca.decode(r.rows.item(a).value),d=e.Key.getKeyPath(l,i.keyPath);n.executeSql("UPDATE "+e.util.quote(t.name)+" set "+e.util.quote(i.name)+" = ? where key = ?",[e.Key.encode(d),r.rows.item(a).key],function(e,t){s(a+1)},o)}catch(e){s(a+1)}else c()}function c(){for(var e={},r=0;r<t.indexNames.length;r++){var s=t.__indexes[t.indexNames[r]];e[s.name]={columnName:s.name,keyPath:s.keyPath,optionalParams:{unique:s.unique,multiEntry:s.multiEntry}}}n.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[JSON.stringify(e),t.name],function(){a(i)},o)}s(0)},o)},o)})},i.__deleteIndex=function(e,t){e.__indexes[t.name]=void 0,e.indexNames.splice(e.indexNames.indexOf(t.name),1)},i.prototype.__fetchIndexData=function(t,i){var n,r=this;return 1===arguments.length?(i=t,t=void 0,n=!1):(t=e.Key.encodeKey(t),n=!0),r.objectStore.transaction.__addToTransactionQueue(function(a,s,o,c){var l=["SELECT * FROM ",e.util.quote(r.objectStore.name)," WHERE",e.util.quote(r.name),"NOT NULL"],d=[];n&&(l.push("AND",e.util.quote(r.name)," = ?"),d.push(t)),a.executeSql(l.join(" "),d,function(t,n){var r;r="count"===i?n.rows.length:0===n.rows.length?void 0:"key"===i?e.Key.decode(n.rows.item(0).key):e.Sca.decode(n.rows.item(0).value),o(r)},c)})},i.prototype.openCursor=function(t,i){var n=new e.IDBRequest;new e.IDBCursor(t,i,this.objectStore,n,this.name,"value");return n},i.prototype.openKeyCursor=function(t,i){var n=new e.IDBRequest;new e.IDBCursor(t,i,this.objectStore,n,this.name,"key");return n},i.prototype.get=function(e){if(0===arguments.length)throw new TypeError("No key was specified");return this.__fetchIndexData(e,"value")},i.prototype.getKey=function(e){if(0===arguments.length)throw new TypeError("No key was specified");return this.__fetchIndexData(e,"key")},i.prototype.count=function(e){return 0===arguments.length?this.__fetchIndexData("count"):this.__fetchIndexData(e,"count")},e.IDBIndex=i}(idbModules),function(e){"use strict";function t(t,i){this.name=t.name,this.keyPath=t.keyPath||null,this.autoIncrement="string"==typeof t.autoInc?"true"===t.autoInc:!!t.autoInc,this.transaction=i,this.__indexes={},this.indexNames=new e.util.StringList;var n="object"==typeof t.indexList?t.indexList:JSON.parse(t.indexList);for(var r in n)if(n.hasOwnProperty(r)){var a=new e.IDBIndex(this,n[r]);this.__indexes[a.name]=a,this.indexNames.push(a.name)}}t.__createObjectStore=function(t,i){t.__objectStores[i.name]=i,t.objectStoreNames.push(i.name);var n=t.__versionTransaction;e.IDBTransaction.__assertVersionChange(n),n.__addToTransactionQueue(function(t,n,r,a){function s(t,n){throw e.util.createDOMException(0,'Could not create object store "'+i.name+'"',n)}var o=["CREATE TABLE",e.util.quote(i.name),"(key BLOB",i.autoIncrement?"UNIQUE, inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");t.executeSql(o,[],function(e,t){e.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[i.name,i.keyPath,i.autoIncrement,"{}"],function(){r(i)},s)},s)})},t.__deleteObjectStore=function(t,i){t.__objectStores[i.name]=void 0,t.objectStoreNames.splice(t.objectStoreNames.indexOf(i.name),1);var n=t.__versionTransaction;e.IDBTransaction.__assertVersionChange(n),n.__addToTransactionQueue(function(n,r,a,s){function o(t,i){s(e.util.createDOMException(0,"Could not delete ObjectStore",i))}t.__db.transaction(function(t){t.executeSql("SELECT * FROM __sys__ where name = ?",[i.name],function(t,n){n.rows.length>0&&t.executeSql("DROP TABLE "+e.util.quote(i.name),[],function(){t.executeSql("DELETE FROM __sys__ WHERE name = ?",[i.name],function(){a()},o)},o)})})})},t.prototype.__validateKey=function(t,i){if(this.keyPath){
if(void 0!==i)throw e.util.createDOMException("DataError","The object store uses in-line keys and the key parameter was provided",this);if(!t||"object"!=typeof t)throw e.util.createDOMException("DataError","KeyPath was specified, but value was not an object");if(void 0===(i=e.Key.getKeyPath(t,this.keyPath))){if(this.autoIncrement)return;throw e.util.createDOMException("DataError","Could not eval key from keyPath")}}else if(void 0===i){if(this.autoIncrement)return;throw e.util.createDOMException("DataError","The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",this)}e.Key.validateKey(i)},t.prototype.__deriveKey=function(t,i,n,r,a){function s(i){t.executeSql("SELECT * FROM sqlite_sequence where name like ?",[o.name],function(e,t){i(1!==t.rows.length?1:t.rows.item(0).seq+1)},function(t,i){a(e.util.createDOMException("DataError","Could not get the auto increment value for key",i))})}var o=this;if(o.keyPath){var c=e.Key.getKeyPath(i,o.keyPath);void 0===c&&o.autoIncrement?s(function(t){try{e.Key.setKeyPath(i,o.keyPath,t),r(t)}catch(t){a(e.util.createDOMException("DataError","Could not assign a generated value to the keyPath",t))}}):r(c)}else void 0===n&&o.autoIncrement?s(r):r(n)},t.prototype.__insertData=function(t,i,n,r,a,s){try{var o={};void 0!==r&&(o.key=e.Key.encodeKey(r));for(var c=0;c<this.indexNames.length;c++){var l=this.__indexes[this.indexNames[c]];o[l.name]=e.Key.encode(e.Key.getKeyPath(n,l.keyPath))}var d=["INSERT INTO ",e.util.quote(this.name),"("],h=[" VALUES ("],u=[];for(var p in o)d.push(e.util.quote(p)+","),h.push("?,"),u.push(o[p]);d.push("value )"),h.push("?)"),u.push(i);var m=d.join(" ")+h.join(" ");t.executeSql(m,u,function(t,i){e.Sca.encode(r,function(t){t=e.Sca.decode(t),a(t)})},function(t,i){s(e.util.createDOMError("ConstraintError",i.message,i))})}catch(e){s(e)}},t.prototype.add=function(t,i){var n=this;if(0===arguments.length)throw new TypeError("No value was specified");this.__validateKey(t,i),n.transaction.__assertWritable();var r=n.transaction.__createRequest();return n.transaction.__pushToQueue(r,function(r,a,s,o){n.__deriveKey(r,t,i,function(i){e.Sca.encode(t,function(e){n.__insertData(r,e,t,i,s,o)})},o)}),r},t.prototype.put=function(t,i){var n=this;if(0===arguments.length)throw new TypeError("No value was specified");this.__validateKey(t,i),n.transaction.__assertWritable();var r=n.transaction.__createRequest();return n.transaction.__pushToQueue(r,function(r,a,s,o){n.__deriveKey(r,t,i,function(i){e.Sca.encode(t,function(a){var c="DELETE FROM "+e.util.quote(n.name)+" where key = ?";r.executeSql(c,[e.Key.encode(i)],function(e,r){n.__insertData(e,a,t,i,s,o)},function(e,t){o(t)})})},o)}),r},t.prototype.get=function(t){var i=this;if(0===arguments.length)throw new TypeError("No key was specified");var n=e.Key.encodeKey(t);return i.transaction.__addToTransactionQueue(function(t,r,a,s){t.executeSql("SELECT * FROM "+e.util.quote(i.name)+" where key = ?",[n],function(t,i){var n;try{if(0===i.rows.length)return a();n=e.Sca.decode(i.rows.item(0).value)}catch(e){}a(n)},function(e,t){s(t)})})},t.prototype.delete=function(t){var i=this;if(0===arguments.length)throw new TypeError("No key was specified");i.transaction.__assertWritable();var n=e.Key.encodeKey(t);return i.transaction.__addToTransactionQueue(function(t,r,a,s){t.executeSql("DELETE FROM "+e.util.quote(i.name)+" where key = ?",[n],function(e,t){a()},function(e,t){s(t)})})},t.prototype.clear=function(){var t=this;return t.transaction.__assertWritable(),t.transaction.__addToTransactionQueue(function(i,n,r,a){i.executeSql("DELETE FROM "+e.util.quote(t.name),[],function(e,t){r()},function(e,t){a(t)})})},t.prototype.count=function(t){var i=this,n=!1;return arguments.length>0&&null!==t&&(n=!0,t=e.Key.encodeKey(t)),i.transaction.__addToTransactionQueue(function(r,a,s,o){var c="SELECT * FROM "+e.util.quote(i.name)+(n?" WHERE key = ?":""),l=[];n&&l.push(t),r.executeSql(c,l,function(e,t){s(t.rows.length)},function(e,t){o(t)})})},t.prototype.openCursor=function(t,i){var n=new e.IDBRequest;new e.IDBCursor(t,i,this,n,"key","value");return n},t.prototype.index=function(t){if(0===arguments.length)throw new TypeError("No index name was specified");var i=this.__indexes[t];if(!i)throw e.util.createDOMException("NotFoundError",'Index "'+t+'" does not exist on '+this.name);return i},t.prototype.createIndex=function(t,i,n){if(0===arguments.length)throw new TypeError("No index name was specified");if(1===arguments.length)throw new TypeError("No key path was specified");if(this.__indexes[t])throw e.util.createDOMException("ConstraintError",'Index "'+t+'" already exists on '+this.name);this.transaction.__assertVersionChange(),n=n||{};var r={columnName:t,keyPath:i,optionalParams:{unique:!!n.unique,multiEntry:!!n.multiEntry}},a=new e.IDBIndex(this,r);return e.IDBIndex.__createIndex(this,a),a},t.prototype.deleteIndex=function(t){if(0===arguments.length)throw new TypeError("No index name was specified");var i=this.__indexes[t];if(!i)throw e.util.createDOMException("NotFoundError",'Index "'+t+'" does not exist on '+this.name);this.transaction.__assertVersionChange(),e.IDBIndex.__deleteIndex(this,i)},e.IDBObjectStore=t}(idbModules),function(e){"use strict";function t(e,t,i){this.__active=!0,this.__running=!1,this.__requests=[],this.__storeNames=t,this.mode=i,this.db=e,this.error=null,this.onabort=this.onerror=this.oncomplete=null;var n=this;setTimeout(function(){n.__executeRequests()},0)}t.prototype.__executeRequests=function(){function t(t){try{e.util.logError("Error","An error occurred in a transaction",t),n.error=t;var i=e.util.createEvent("error");e.util.callback("onerror",n,i)}finally{n.abort()}}function i(){var t=e.util.createEvent("complete");e.util.callback("oncomplete",n,t),e.util.callback("__oncomplete",n,t)}if(!this.__running){this.__running=!0;var n=this;n.db.__db.transaction(function(r){function a(t,i){i&&(c.req=i),c.req.readyState="done",c.req.result=t,delete c.req.error;var n=e.util.createEvent("success");e.util.callback("onsuccess",c.req,n),l++,o()}function s(i,n){1===arguments.length&&(n=i);try{c.req.readyState="done",c.req.error=n||"DOMError";var r=e.util.createEvent("error",n);e.util.callback("onerror",c.req,r)}finally{t(n)}}function o(){if(l>=n.__requests.length)n.__requests=[],n.__active&&(n.__active=!1,i());else try{c=n.__requests[l],c.op(r,c.args,a,s)}catch(e){s(e)}}n.__tx=r;var c=null,l=0;o()},t)}},t.prototype.__createRequest=function(){var t=new e.IDBRequest;return t.source=this.db,t.transaction=this,t},t.prototype.__addToTransactionQueue=function(e,t){var i=this.__createRequest();return this.__pushToQueue(i,e,t),i},t.prototype.__pushToQueue=function(e,t,i){this.__assertActive(),this.__requests.push({op:t,args:i,req:e})},t.prototype.__assertActive=function(){if(!this.__active)throw e.util.createDOMException("TransactionInactiveError","A request was placed against a transaction which is currently not active, or which is finished")},t.prototype.__assertWritable=function(){if(this.mode===t.READ_ONLY)throw e.util.createDOMException("ReadOnlyError","The transaction is read only")},t.prototype.__assertVersionChange=function(){t.__assertVersionChange(this)},t.__assertVersionChange=function(i){if(!i||i.mode!==t.VERSION_CHANGE)throw e.util.createDOMException("InvalidStateError","Not a version transaction")},t.prototype.objectStore=function(i){if(0===arguments.length)throw new TypeError("No object store name was specified");if(!this.__active)throw e.util.createDOMException("InvalidStateError","A request was placed against a transaction which is currently not active, or which is finished");if(-1===this.__storeNames.indexOf(i)&&this.mode!==t.VERSION_CHANGE)throw e.util.createDOMException("NotFoundError",i+" is not participating in this transaction");var n=this.db.__objectStores[i];if(!n)throw e.util.createDOMException("NotFoundError",i+" does not exist in "+this.db.name);return n.transaction=this,n},t.prototype.abort=function(){var t=this;t.__active=!1;var i=e.util.createEvent("abort");setTimeout(function(){e.util.callback("onabort",t,i)},0)},t.READ_ONLY="readonly",t.READ_WRITE="readwrite",t.VERSION_CHANGE="versionchange",e.IDBTransaction=t}(idbModules),function(e){"use strict";function t(t,i,n,r){this.__db=t,this.__closed=!1,this.version=n,this.name=i,this.onabort=this.onerror=this.onversionchange=this.onclose=null,this.__objectStores={},this.objectStoreNames=new e.util.StringList;for(var a=0;a<r.rows.length;a++){var s=new e.IDBObjectStore(r.rows.item(a));this.__objectStores[s.name]=s,this.objectStoreNames.push(s.name)}}t.prototype.createObjectStore=function(t,i){if(0===arguments.length)throw new TypeError("No object store name was specified");if(this.__objectStores[t])throw e.util.createDOMException("ConstraintError",'Object store "'+t+'" already exists in '+this.name);this.__versionTransaction.__assertVersionChange(),i=i||{};var n={name:t,keyPath:i.keyPath||null,autoInc:!!i.autoIncrement,indexList:{}},r=new e.IDBObjectStore(n,this.__versionTransaction);return e.IDBObjectStore.__createObjectStore(this,r),r},t.prototype.deleteObjectStore=function(t){if(0===arguments.length)throw new TypeError("No object store name was specified");var i=this.__objectStores[t];if(!i)throw e.util.createDOMException("NotFoundError",'Object store "'+t+'" does not exist in '+this.name);this.__versionTransaction.__assertVersionChange(),e.IDBObjectStore.__deleteObjectStore(this,i)},t.prototype.close=function(){this.__closed=!0},t.prototype.transaction=function(t,i){if(this.__closed)throw e.util.createDOMException("InvalidStateError","An attempt was made to start a new transaction on a database connection that is not open");if((i="number"==typeof i?1===i?IDBTransaction.READ_WRITE:IDBTransaction.READ_ONLY:i||IDBTransaction.READ_ONLY)!==IDBTransaction.READ_ONLY&&i!==IDBTransaction.READ_WRITE)throw new TypeError("Invalid transaction mode: "+i);if(t="string"==typeof t?[t]:t,0===t.length)throw e.util.createDOMException("InvalidAccessError","No object store names were specified");for(var n=0;n<t.length;n++)if(!this.objectStoreNames.contains(t[n]))throw e.util.createDOMException("NotFoundError",'The "'+t[n]+'" object store does not exist');return new e.IDBTransaction(this,t,i)},e.IDBDatabase=t}(idbModules),function(e){"use strict";function t(){this.Event=e.Event,this.DOMException=e.DOMException,this.DOMError=e.DOMError}var i,n,r=26214400,a=!1,s=!1;t.prototype.loadShim=function(){window.openDatabase&&(i=window.openDatabase("__sysdb__",1,"System Database",r),i.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){this.notifyIsReady(!0)}.bind(this),function(){this.notifyIsReady(!1)}.bind(this))}.bind(this),function(){this.notifyIsReady(!1)}.bind(this)))},t.prototype.notifyIsReady=function(e){if(a=!0,s=e,n){for(var t=0;t<n.length;++t)n[t](s);n=void 0}},t.prototype.onIsReady=function(e){a?setTimeout(function(){e(s)},0):n?n.push(e):n=[e]},t.prototype.open=function(t,n){function a(t){if(!c){c=!0;var i=e.util.createEvent("error",arguments);o.readyState="done",o.error=t||"DOMError",e.util.callback("onerror",o,i)}}function s(s){var c;try{c=window.openDatabase(t,1,t,r)}catch(e){return void a(e)}if(o.readyState="done",void 0===n&&(n=s||1),n<=0||s>n){return void a(e.util.createDOMError("VersionError","An attempt was made to open a database using a lower version than the existing version.",n))}c.transaction(function(r){r.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){r.executeSql("SELECT * FROM __sys__",[],function(r,l){var d=e.util.createEvent("success");o.source=o.result=new e.IDBDatabase(c,t,n,l),s<n?i.transaction(function(i){i.executeSql("UPDATE dbVersions set version = ? where name = ?",[n,t],function(){var t=e.util.createEvent("upgradeneeded");t.oldVersion=s,t.newVersion=n,o.transaction=o.result.__versionTransaction=new e.IDBTransaction(o.source,[],e.IDBTransaction.VERSION_CHANGE),o.transaction.__addToTransactionQueue(function(i,n,r){e.util.callback("onupgradeneeded",o,t),r()}),o.transaction.__oncomplete=function(){o.transaction=null;var t=e.util.createEvent("success");e.util.callback("onsuccess",o,t)}},a)},a):e.util.callback("onsuccess",o,d)},a)},a)},a)}var o=new e.IDBOpenDBRequest,c=!1;if(0===arguments.length)throw new TypeError("Database name is required");if(2===arguments.length&&(n=parseFloat(n),isNaN(n)||!isFinite(n)||n<=0))throw new TypeError("Invalid database version: "+n);return t+="",i.transaction(function(e){e.executeSql("SELECT * FROM dbVersions where name = ?",[t],function(e,i){0===i.rows.length?e.executeSql("INSERT INTO dbVersions VALUES (?,?)",[t,n||1],function(){s(0)},a):s(i.rows.item(0).version)},a)},a),o},t.prototype.deleteDatabase=function(t){function n(t){if(!o){s.readyState="done",s.error="DOMError";var i=e.util.createEvent("error");i.message=t,i.debug=arguments,e.util.callback("onerror",s,i),o=!0}}function a(){i.transaction(function(i){i.executeSql("DELETE FROM dbVersions where name = ? ",[t],function(){s.result=void 0;var t=e.util.createEvent("success");t.newVersion=null,t.oldVersion=c,e.util.callback("onsuccess",s,t)},n)},n)}var s=new e.IDBOpenDBRequest,o=!1,c=null;if(0===arguments.length)throw new TypeError("Database name is required");return t+="",i.transaction(function(i){i.executeSql("SELECT * FROM dbVersions where name = ?",[t],function(i,o){if(0===o.rows.length){s.result=void 0;var l=e.util.createEvent("success");return l.newVersion=null,l.oldVersion=c,void e.util.callback("onsuccess",s,l)}c=o.rows.item(0).version,window.openDatabase(t,1,t,r).transaction(function(t){t.executeSql("SELECT * FROM __sys__",[],function(t,i){var r=i.rows;!function i(s){s>=r.length?t.executeSql("DROP TABLE __sys__",[],function(){a()},n):t.executeSql("DROP TABLE "+e.util.quote(r.item(s).name),[],function(){i(s+1)},function(){i(s+1)})}(0)},function(e){a()})},n)})},n),s},t.prototype.cmp=function(t,i){return e.Key.encodeKey(t)>e.Key.encodeKey(i)?1:t===i?0:-1},e.shimIndexedDB=new t,e.IDBFactory=t}(idbModules),function(e,t){"use strict";function i(t,i){try{e[t]=i}catch(e){}if(e[t]!==i&&Object.defineProperty){try{Object.defineProperty(e,t,{value:i})}catch(e){}e[t]!==i&&e.console&&console.warn&&console.warn("Unable to shim "+t)}}void 0!==e.openDatabase&&(i("shimIndexedDB",t.shimIndexedDB),e.shimIndexedDB&&(e.shimIndexedDB.__useShim=function(){try{e.shimIndexedDB.loadShim(),i("dbProvider",t.shimIndexedDB),i("IDBFactory",t.IDBFactory),i("IDBDatabase",t.IDBDatabase),i("IDBObjectStore",t.IDBObjectStore),i("IDBIndex",t.IDBIndex),i("IDBTransaction",t.IDBTransaction),i("IDBCursor",t.IDBCursor),i("IDBKeyRange",t.IDBKeyRange),i("IDBRequest",t.IDBRequest),i("IDBOpenDBRequest",t.IDBOpenDBRequest),i("IDBVersionChangeEvent",t.IDBVersionChangeEvent)}catch(e){console.log("Error loading SQL shim")}})),e.dbProvider=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.oIndexedDB||e.msIndexedDB;var n=!1;if((navigator.userAgent.match(/iPad/)||navigator.userAgent.match(/iPhone/)||navigator.userAgent.match(/iPod/)||navigator.userAgent.match(/Android 2/)||navigator.userAgent.match(/Android 3/)||navigator.userAgent.match(/Android 4\.[0-3]/))&&(navigator.userAgent.match(/Chrome/)||navigator.userAgent.match(/CriOS/)||(n=!0)),e.location.hash.indexOf("forcesql=true")>=0||(void 0===e.indexedDB||null===e.indexedDB||n)&&void 0!==e.openDatabase)e.shimIndexedDB.__useShim();else{e.IDBDatabase=e.IDBDatabase||e.webkitIDBDatabase,e.IDBTransaction=e.IDBTransaction||e.webkitIDBTransaction,e.IDBCursor=e.IDBCursor||e.webkitIDBCursor,e.IDBKeyRange=e.IDBKeyRange||e.webkitIDBKeyRange,e.IDBTransaction||(e.IDBTransaction={});try{e.IDBTransaction.READ_ONLY=e.IDBTransaction.READ_ONLY||"readonly",e.IDBTransaction.READ_WRITE=e.IDBTransaction.READ_WRITE||"readwrite"}catch(e){}}}(window,idbModules),define("IndexedDBShim",function(){}),define("database",["IndexedDBShim"],function(e){"use strict";var t=window.dbProvider,i=window.IDBKeyRange||window.webkitIDBKeyRange,n={readonly:"readonly",readwrite:"readwrite"},r=Object.prototype.hasOwnProperty;if(!t)return void console.log("IndexedDB is not available");var a=function(e){return e},s=function(){var e,t=[],i=function(i,n){if(t){n=n||[],e=e||[i,n];for(var r=0,a=t.length;r<a;r++)t[r].apply(e[0],e[1]);t=[]}};this.add=function(){for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return e&&i(),this},this.execute=function(){return i(this,arguments),this}},o=function(e){var t="progress",i=[["resolve","done",new s,"resolved"],["reject","fail",new s,"rejected"],["notify","progress",new s]],n={},r={state:function(){return t},then:function(){var e=arguments;return o(function(t){i.forEach(function(i,r){var a=e[r];n[i[1]]("function"==typeof a?function(){var e=a.apply(this,arguments);e&&"function"==typeof e.promise&&e.promise().done(t.resolve).fail(t.reject).progress(t.notify)}:t[i[0]])})}).promise()},promise:function(e){return e?(Object.keys(r).forEach(function(t){e[t]=r[t]}),e):r}};return i.forEach(function(e,i){var a=e[2],s=e[3];r[e[1]]=a.add,s&&a.add(function(){t=s}),n[e[0]]=a.execute}),r.promise(n),e&&e.call(n,n),n},c=function(e,t){var i=this,a=!1;this.add=function(t){if(a)throw"Database has been closed";for(var r=[],s=0,c=0;c<arguments.length-1;c++)if(Array.isArray(arguments[c+1]))for(var l=0;l<arguments[c+1].length;l++)r[s]=arguments[c+1][l],s++;else r[s]=arguments[c+1],s++;var d=e.transaction(t,n.readwrite),h=d.objectStore(t),u=o();return r.forEach(function(e){var t;if(e.item&&e.key){var i=e.key;e=e.item,t=h.add(e,i)}else t=h.add(e);t.onsuccess=function(t){var i=t.target,n=i.source.keyPath;null===n&&(n="__id__"),Object.defineProperty(e,n,{value:i.result,enumerable:!0}),u.notify()}}),d.oncomplete=function(){u.resolve(r,i)},d.onerror=function(e){u.reject(r,e)},d.onabort=function(e){u.reject(r,e)},u.promise()},this.update=function(t){if(a)throw"Database has been closed";for(var r=[],s=0;s<arguments.length-1;s++)r[s]=arguments[s+1];var c=e.transaction(t,n.readwrite),l=c.objectStore(t),d=o();return r.forEach(function(e){var t;if(e.item&&e.key){var i=e.key;e=e.item,t=l.put(e,i)}else t=l.put(e);t.onsuccess=function(e){d.notify()}}),c.oncomplete=function(){d.resolve(r,i)},c.onerror=function(e){d.reject(r,e)},c.onabort=function(e){d.reject(r,e)},d.promise()},this.updateObject=function(t){if(a)throw"Database has been closed";var r=e.transaction(t,n.readwrite),s=r.objectStore(t),c=o(),l=arguments[1];for(var d in l)s.put(l[d]);return r.oncomplete=function(){c.resolve(l,i)},r.onerror=function(e){c.reject(l,e)},r.onabort=function(e){c.reject(l,e)},c.promise()},this.remove=function(t,i){if(a)throw"Database has been closed";var r=e.transaction(t,n.readwrite),s=r.objectStore(t),c=o();s.delete(i);return r.oncomplete=function(){c.resolve(i)},r.onerror=function(e){c.reject(e)},c.promise()},this.clear=function(t){if(a)throw"Database has been closed";var i=e.transaction(t,n.readwrite),r=i.objectStore(t),s=o();r.clear();return i.oncomplete=function(){s.resolve()},i.onerror=function(e){s.reject(e)},s.promise()},this.close=function(){if(a)throw"Database has been closed";e.close(),a=!0,delete u[t]},this.handleDisconnect=function(t){e.onclose=t,e.onerror=t,e.onabort=t},this._getRawDB=function(){return e},this.get=function(t,i){if(a)throw"Database has been closed";var n=e.transaction(t),r=n.objectStore(t),s=o();return r.get(i).onsuccess=function(e){s.resolve(e.target.result)},n.onerror=function(e){s.reject(e)},s.promise()},this.query=function(t,i){if(a)throw"Database has been closed";return new l(t,e,i)};for(var s=0,c=e.objectStoreNames.length;s<c;s++)!function(e){i[e]={};for(var t in i)r.call(i,t)&&"close"!==t&&(i[e][t]=function(t){return function(){var n=[e].concat([].slice.call(arguments,0));return i[t].apply(i,n)}}(t))}(e.objectStoreNames[s])},l=function(e,t,r){var s=this,c=!1,l=function(){var i=t.transaction(e,n.readonly),r=i.objectStore(e),a=[],s=o();return r.openCursor().onsuccess=function(e){var t=e.target.result;t&&(a.push(t.value),t.continue())},i.oncomplete=function(){s.resolve(a)},i.onerror=s.reject,i.onabort=s.reject,s.promise()},d=function(a,s,l,d,h,u,p){var m=t.transaction(e,c?n.readwrite:n.readonly),f=m.objectStore(e),g=r?f.index(r):f,v=a?i[a].apply(null,s):null,y=[],b=o(),S=[v],h=h||null,u=u||void 0,E=0;"count"!==l&&S.push(d||"next");var C=!!c&&Object.keys(c),P=function(e){for(var t=0;t<C.length;t++){var i=C[t],n=c[i];n instanceof Function&&(n=n(e)),e[i]=n}return e};return g[l].apply(g,S).onsuccess=function(e){var t=e.target.result;if("number"==typeof t)y=t;else if(t)if(null!==h&&h[0]>E)E=h[0],t.advance(h[0]);else if(null!==h&&E>=h[0]+h[1]);else{var i=!0,n="value"in t?t.value:t.key;u&&u.forEach(function(e){e&&e.length&&(i=2===e.length?n[e[0]]===e[1]:e[0].apply(void 0,[n]))}),i&&(E++,y.push(p(n)),c&&(n=P(n),t.update(n))),t.continue()}},m.oncomplete=function(){b.resolve(y)},m.onerror=function(e){b.reject(e)},m.onabort=function(e){b.reject(e)},b.promise()},h=function(e,t){var i="next",n="openCursor",r=[],s=null,o=a,h=!1,u=function(){return d(e,t,n,h?i+"unique":i,s,r,o)},p=function(){return l()},m=function(){return s=Array.prototype.slice.call(arguments,0,2),1==s.length&&s.unshift(0),{execute:u}},f=function(){return i=null,n="count",{execute:u}},g=function(){return n="openKeyCursor",{desc:y,execute:u,filter:v,distinct:b,map:E}},v=function(){return r.push(Array.prototype.slice.call(arguments,0,2)),{keys:g,execute:u,fastExecute:p,count:f,filter:v,desc:y,distinct:b,modify:S,limit:m,map:E}},y=function(){return i="prev",{keys:g,execute:u,filter:v,distinct:b,modify:S,map:E}},b=function(){return h=!0,{keys:g,count:f,execute:u,filter:v,desc:y,modify:S,map:E}},S=function(e){return c=e,{execute:u}},E=function(e){return o=e,{execute:u,count:f,keys:g,filter:v,desc:y,distinct:b,modify:S,limit:m,map:E}};return{execute:u,count:f,keys:g,filter:v,desc:y,distinct:b,modify:S,limit:m,map:E}};"only bound upperBound lowerBound".split(" ").forEach(function(e){s[e]=function(){return new h(e,arguments)}}),this.filter=function(){var e=new h(null,null);return e.filter.apply(e,arguments)},this.all=function(){return this.filter()}},d=function(e,t,i){"function"==typeof t&&(t=t());for(var n in t){var a,s=t[n];if(!r.call(t,n)||i.objectStoreNames.contains(n)){a=(e.currentTarget||e.target).transaction.objectStore(n)}else a=i.createObjectStore(n,s.key);for(var o in s.indexes)if(!a.indexNames.contains(o)){var c=s.indexes[o];a.createIndex(o,c.key||o,Object.keys(c).length?c:{unique:!1})}}},h=function(e,t,i,n){var r=e.target.result,a=new c(r,t),s=o();return s.resolve(a),u[t]=r,s.promise()},u={};return{version:"0.9.0",open:function(e){var i,n=o();return u[e.server]?h({target:{result:u[e.server]}},e.server,e.version,e.schema).done(n.resolve).fail(n.reject).progress(n.notify):(i=t.open(e.server,e.version),i?(i.onsuccess=function(t){h(t,e.server,e.version,e.schema).done(n.resolve).fail(n.reject).progress(n.notify)},i.onupgradeneeded=function(t){d(t,e.schema,t.target.result)},i.onerror=function(e){n.reject(e)}):n.reject({target:{error:{name:"DBOpenError"}}})),n.promise()}}}),define("EventDispatcher",["globals"],function(e){return{_ensureListeners:function(){return this._listeners||(this._listeners={}),this._listeners},clearListeners:function(){this._listeners=void 0},listen:function(){for(var t=this._ensureListeners(),i=0;i<arguments.length-1;++i){try{e.PAssert(3293,"callbacks"!==arguments[i],"Invalid event name/grouping")}catch(t){e.reportError(t)}try{e.PAssert(3294,e.isString(arguments[i])||e.isFunction(arguments[i]),"Only accept string or functions for listen")}catch(t){e.reportError(t)}t[arguments[i]]||(t[arguments[i]]={callbacks:[]}),t=t[arguments[i]]}var n=arguments[arguments.length-1];try{e.PAssert(3295,e.isFunction(n),"Listeners must always be valid functions")}catch(t){e.reportError(t)}try{e.PAssert(3296,t.callbacks.indexOf(n)<0,"Should never listen with the same function twice")}catch(t){e.reportError(t)}t.callbacks.push(n)},isListening:function(){var t=this._ensureListeners(),i=arguments[arguments.length-1];try{e.PAssert(3297,e.isFunction(i),"Listeners must always be valid functions")}catch(t){e.reportError(t)}for(var n=0;n<arguments.length-1;++n)t[arguments[n]]&&(t=t[arguments[n]]);return t&&t.callbacks&&t.callbacks.indexOf(i)>=0},unlisten:function(){var t=this._ensureListeners(),i=arguments[arguments.length-1];try{e.PAssert(3298,e.isFunction(i),"Listeners must always be valid functions")}catch(t){e.reportError(t)}for(var n=0;n<arguments.length-1;++n){try{e.PAssert(3299,"callbacks"!==arguments[n],"Invalid event name/grouping")}catch(t){e.reportError(t)}try{e.PAssert(3300,e.isString(arguments[n]),"Only accept string for unlisten")}catch(t){e.reportError(t)}try{e.PAssert(3301,t[arguments[n]],"Cannot unlisten something that has never been listened")}catch(t){e.reportError(t)}t[arguments[n]]&&(t=t[arguments[n]])}try{e.PAssert(3302,t&&t.callbacks&&t.callbacks.indexOf(i)>=0,"Cannot unlisten something that has never been listened")}catch(t){e.reportError(t)}t.callbacks&&t.callbacks.remove(i)},fireEvent:function(){var t=!0,i=this._ensureListeners(),n=arguments[arguments.length-1];try{e.PAssert(3303,void 0===n||e.isArray(n),"Last argument to fireEvent must be an array")}catch(t){e.reportError(t)}for(var r=0;r<arguments.length-1;++r){try{e.PAssert(3304,"callbacks"!==arguments[r],"Invalid event name/grouping")}catch(t){e.reportError(t)}try{e.PAssert(3305,e.isString(arguments[r])||e.isArray(arguments[r]),"Only accept strings for firing event")}catch(t){e.reportError(t)}if(!i[arguments[r]])break;i=i[arguments[r]];for(var a=0;a<i.callbacks.length;++a)try{t=i.callbacks[a].apply(this,n)&&t}catch(t){e.reportError(t)}}return t}}}),define("Dispatcher",["util","EventDispatcher"],function(e,t){function i(){}return e.defineBase(i),e.extend(i.prototype,t),new i}),define("demo",["globals","Dispatcher"],function(e,t){function i(){this.cache={},this.loadedGapiData={},this._isRemoteHooked=!1,this.resetListener=void 0}return i.prototype={setGapiData:function(t,i){try{e.PAssert(3306,e.isObject(i)&&!e.isArray(i),"Setting malformed data",t)}catch(t){e.reportError(t)}this.loadedGapiData[t]=[];for(var n in i)i[n].id=n,this.loadedGapiData[t].push(i[n])},setGapiDataDirect:function(t,i){try{e.PAssert(3307,e.isArray(i),"Setting malformed data",t)}catch(t){e.reportError(t)}this.loadedGapiData[t]||(this.loadedGapiData[t]=i)},clearGapiData:function(){this.loadedGapiData={}},loadRemoteData:function(t,i){try{e.PAssert(3308,t&&i,"Must supply valid remote load info as well as a cb when data is loaded")}catch(t){e.reportError(t)}var n=t.split(".");this.cache[n[0]]?i(JSON.parse(JSON.stringify(this.cache[n[0]][n[1]]))):e.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+n[0]+".json",cb:function(e){if(200===e.status)try{var t=JSON.parse(e.responseText);this.cache[n[0]]=t,n[1]||(n[1]="0");var r=t[n[1]];if(r){var a=JSON.parse(JSON.stringify(r));i(a)}else log("Invalid data slot")}catch(e){log("Error parsing demo data: "+e.message)}else log("Error getting demo data",e.status,e.responseText)}.bind(this)})},stubGapi:function(){try{e.PAssert(3309,!window.gapi,"Should not have loaded gapi when stubbing")}catch(t){e.reportError(t)}var i=function(){},n=function(){return{then:i,execute:i}},r=[];t.listen("resetEverything",function(){for(var e=0;e<r.length;++e)clearTimeout(r[e]);r=[]});var a=function(e,t){var i=setTimeout(function(){r.remove(i),e({success:!0})},0);r.push(i)},s=function(e){return{then:function(t,i,n){return require("apis").getAPIForRequest(e)(e.__rawParams).then(t,i,n)},execute:function(){}}};window.gapi={auth:{getToken:function(){return{expires_in:3600,expires_at:Math.floor((Date.now()+e.minutes(60))/1e3),access_token:"InvalidToken",id_token:"InvalidIDToken",scope:[GScope.UserInfoEmail,GScope.Calendar,GScope.GmailCompose,GScope.GmailModify]}}},client:{request:s,load:i,setApiKey:i,newBatch:function(){return{add:i,then:a}},drive:{files:{get:n,list:n,trash:n,insert:n,patch:n},permissions:{list:n,insert:n,delete:n},properties:{insert:n},parents:{insert:n},changes:{list:n}},gmail:{users:{threads:{list:n,get:n,modify:n,trash:n,untrash:n},labels:{list:n,create:n},history:{list:n},messages:{get:n,send:n,trash:n,untrash:n},drafts:{create:n,update:n,send:n,delete:n,list:n},settings:{sendAs:{list:n}}}},calendar:{settings:{list:n},events:{get:n,list:n,patch:n,insert:n,delete:n},calendars:{insert:n},calendarList:{list:n}}}}},areRemoteFunctionsHooked:function(){return this._isRemoteHooked},hookRemoteFunctions:function(){function i(t,i){try{e.PAssert(3311,t,"Must load local or remote data to perform queries")}catch(t){e.reportError(t)}for(var n=0;n<t.length;++n)if(t[n].id===i)return t[n]}function n(t,i){try{e.PAssert(3312,t,"Must load local or remote data to perform queries")}catch(t){e.reportError(t)}for(var n=[],r=0;r<t.length;++r)(t[r].parents[0].id===i||"root"===i&&t[r].parents[0].isRoot)&&n.push(t[r]);return n}function r(t,i,n){try{e.PAssert(3313,t,"Must load local or remote data to perform queries")}catch(t){e.reportError(t)}var r=[];if(e.isArray(n));else if(t)for(var a=0;a<t.length;++a)t[a][i]===n&&r.push(t[a]);return r}function a(t,i,n){try{e.PAssert(3314,t,"Must load local or remote data to perform queries")}catch(t){e.reportError(t)}for(var r=[],a=0;a<t.length;++a)t[a][i].indexOf(n)>=0&&r.push(t[a]);return r}function s(t,i){try{e.PAssert(3315,t,"Must load local or remote data to perform queries")}catch(t){e.reportError(t)}for(var n=0;n<t.length;++n){var r=i(t[n]);if(r)return r}}function o(t){return function(i,n,r){var a;try{a=t(r)}catch(t){e.reportError(t)}var s=setTimeout(function(){h.remove(s),a?i.call(r,{result:a}):n.call(r,{error:!0})},d);h.push(s)}}function c(e){return function(t,i,n){var r=e(n),a=setTimeout(function(){h.remove(a),r?t(r):i({error:!0})},d);h.push(a)}}function l(e){return{then:o(e),execute:c(e)}}try{e.PAssert(3310,!this._isRemoteHooked,"Should not hook remote functions more than once")}catch(t){e.reportError(t)}this.stubGapi(),this._isRemoteHooked=!0;var d=0,h=[],u=this;t.listen("resetEverything",function(){for(var e=0;e<h.length;++e)clearTimeout(h[e]);h=[]}),function(){gapi.client.drive.files.get=function(e){function t(t){return i(u.loadedGapiData.Drive,e.fileId)}return l(t)},gapi.client.drive.files.list=function(e){function t(t){if("mimeType='application/vnd.google-apps.drive-sdk.597847337936' and trashed=false"===e.q)return{items:u.loadedGapiData.documents};var i=/\'(.*)\' in parents/g,r=/title contains \'([^\']*)\'/g,s=/mimeType contains \'([^\']*)\'/g,o=i.exec(e.q),c=r.exec(e.q),l=s.exec(e.q),d=u.loadedGapiData.Drive;return o&&(d=n(d,o[1])),c&&(d=a(d,"title",c[1])),l&&(d=a(d,"mimeType",l[1])),{items:d}}return l(t)},gapi.client.drive.files.trash=function(e){return l(emptyImpl)},gapi.client.drive.files.insert=function(e){return l(emptyImpl)},gapi.client.drive.files.patch=function(e){return l(emptyImpl)},gapi.client.drive.permissions.list=function(e){function t(e){return{items:u.loadedGapiData.permissions}}return l(t)},gapi.client.drive.permissions.insert=function(e){return l(emptyImpl)},gapi.client.drive.permissions.delete=function(e){return l(emptyImpl)},gapi.client.drive.properties.insert=function(e){return l(emptyImpl)}}(),function(){gapi.client.gmail.users.threads.list=function(e){function t(t){return{threads:r(u.loadedGapiData.Gmail,"hideInPane",void 0).filter(function(t){return"me"===e.userId||t.accountID===e.userId})}}return l(t)},gapi.client.gmail.users.threads.modify=function(e){function t(t){var n=i(u.loadedGapiData.Gmail,e.id)[0];if(!n)return{};if(n.labelIds||(n.labelIds=[]),e.removeLabelIds)for(var r=0;r<e.removeLabelIds.length;++r)n.labelIds.remove(e.removeLabelIds[r]);e.addLabelIds&&n.labelids.pushOnlyUniques(e.addLabelIds)}return l(t)},gapi.client.gmail.users.threads.get=function(e){function t(t){return i(u.loadedGapiData.Gmail,e.id)}return l(t)},gapi.client.gmail.users.messages.get=function(e){function t(t){return s(u.loadedGapiData.Gmail,function(t){
for(var i=0;i<t.messages.length;++i)if(t.messages[i].id===e.id)return t.messages[i]})}return l(t)},gapi.client.gmail.users.messages.send=function(t){function i(i){return{id:e.generateTempId(),threadId:t.resource.threadId||e.generateTempId().substr(3),labelIds:["SENT","UNREAD"]}}return l(i)},gapi.client.gmail.users.labels.list=function(e){function t(e){return{labels:u.loadedGapiData.Gmail_Labels}}return l(t)},gapi.client.gmail.users.labels.create=function(t){function i(i){var n=r(u.loadedGapiData.Gmail_Labels,"name",t.resource.name)[0];if(n)return n;var a=e.generateTempId().substr(3);return n={name:t.resource.name,id:a},u.loadedGapiData.Gmail_Labels||(u.loadedGapiData.Gmail_Labels=[]),u.loadedGapiData.Gmail_Labels.push(n),n}return l(i)},gapi.client.gmail.users.settings.sendAs.list=function(e){function t(e){return{sendAs:[{displayName:"Demo User",isDefault:!0,isPrimary:!0,replyToAddress:"",sendAsEmail:"demo@moo.do",signature:""}]}}return l(t)}}(),function(){gapi.client.calendar.calendarList.list=function(e){function t(e){return{items:u.loadedGapiData.calendarList}}return l(t)},gapi.client.calendar.events.get=function(e){function t(t){return i(u.loadedGapiData.GCalendar,e.eventId)}return l(t)}}()}},new i}),define("VMContact",["globals"],function(e){function t(t){try{e.PAssert(3316,e.isObject(t),"Should always supply a valid object to init a contact")}catch(t){e.reportError(t)}this.id=t.id,this.type="contact",this.text=t.text||"",this.phoneNumbers=t.phoneNumbers||[],this.emails=t.emails||[],this.init()}return t.prototype={init:function(){for(var e=0;e<this.phoneNumbers.length;e++)this.phoneNumbers[e].link=this.formatPhone(this.phoneNumbers[e].number),this.phoneNumbers[e].type=this.phoneNumbers[e].type[0];for(var e=0;e<this.emails.length;e++)this.emails[e].link="mailto:"+this.emails[e].address},_phoneRegex:/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/,formatPhone:function(t){if(this._phoneRegex.test(t)){var i=t.match(this._phoneRegex),n="";return i[1]&&(n+="+1-"+i[1]+"-"),"tel:"+(n+=i[2]+"-"+i[3])}var r=t.replace(/\D+/g,"");try{e.PAssert(3317,r&&""!==r,"Invalid phone number format: "+t)}catch(t){e.reportError(t)}return t.startsWith("+")&&(r="+"+r),"tel:"+r},onTapNumber:function(t){e.autocomplete.hide(),e.openUrl(this.link,t,!0)},onTapEmail:function(t){var i=e.vmMain.getDefaultEmailPlugin();if(i.isActive()){e.autocomplete.hide();var n={to:[{text:"",email:this.address}]};e.menus.openComposeEmail(i,void 0,void 0,n)}else e.openUrl(this.link,t,!0)},onTap:{onClick:function(t){e.hasClass(t.target,"contactPhone")||e.hasClass(t.target,"contactEmail")||e.autocomplete.onTapped(this.text,this.text.length,!0)}}},t}),define("ObservableArray",["require","globals","util","Listener","Observable"],function(e){function t(e,t){this._super.constructor.call(this,e,t),this._value=e||[],this.version=0}var i=e("globals"),n=e("util"),r=(e("Listener"),e("Observable")),a={notify:function(e,t,i){0===arguments.length&&this.version++,this._super.notify.apply(this,arguments)},length:function(){return this._value.length},set:function(e,t){try{i.PAssert(3318,e&&i.isArray(e),"Value set on an Observable array must be an array",e)}catch(e){i.reportError(e)}this._value=e,this.version++,!1!==t&&this.notify(this._value)},clear:function(e){this.set([],e)},remove:function(e,t){var n=[];if(i.isFunction(e))for(var r=0;r<this._value.length;r++){var a=this._value[r];e(a)&&(n.push(a),this._value.splice(r,1),r--)}else n=this._value.remove(e);return this.version++,!1!==t&&this.notify(this._value),n},removeAt:function(e,t){var i=this._value.removeAt(e);return this.version++,!1!==t&&this.notify(this._value),i},push:function(e,t){var i=this._value.push(e);return this.version++,!1!==t&&this.notify(this._value),i},insertSorted:function(e,t,i){var n=this._value.insertSorted(e,t);return this.version++,!1!==i&&this.notify(this._value),n},splice:function(e,t,i,n){var r;return r=i?this._value.splice(e,t,i):this._value.splice(e,t),this.version++,!1!==n&&this.notify(this._value),r},indexOf:function(e){return this._value.indexOf(e)},indexOfWithProperty:function(e,t){return this._value.indexOfWithProperty(e,t)}};return n.inherit(r,t),n.extend(t.prototype,a),t}),define("VMContactManager",["globals","VMContact","Observable","ObservableArray"],function(e,t,i,n){function r(){this._contactCache={},this._contacts=new n,this._contactsByName={},this._contactNames={___info___:{count:0}},this.init()}return r.prototype={init:function(){},loadContacts:function(t,i){try{e.PAssert(3319,0===this._contacts.get().length,"Should only load contacts once")}catch(t){e.reportError(t)}var n=!1;if(t){for(var r=[],a=0;a<t.length;++a){var s=t[a];if(s.name&&(s.text=s.name,t[a].text=s.name,delete t[a].name,n=!0),!i&&s.isDemo||s.text&&!s.phoneNumbers&&!s.emails)n=!0;else{if(s.text){var o=e.escape(s.text);this._contactNames[o]="",this._contactsByName[s.text]=s,r.push(s)}try{e.PAssert(3320,s.id,"Each contact must have a valid id")}catch(t){e.reportError(t)}}}r.sort(this.contactComparator),this._contactNames.___info___.count=r.length,this._contacts.set(r)}else this.clearContacts();return n},addContact:function(i){try{e.PAssert(3321,i.id,"Incoming contacts must have a valid id")}catch(t){e.reportError(t)}try{e.PAssert(3322,i.text,"All contacts are expected to have a text")}catch(t){e.reportError(t)}var n=this._contactsByName[i.text];if(i.emails){for(var r=[],a=0;a<i.emails.length;a++){for(var s=i.emails[a],o=!1,c=0;c<r.length;c++)if(r[c].address.toLowerCase()===s.address.toLowerCase()){o=!0;break}o||r.push(s)}i.emails=r}if(n)i.emails&&(n.emails||(n.emails=[]),n.emails.pushOnlyUniques(i.emails,this.emailComparator)),i.phoneNumbers&&(n.phoneNumbers||(n.phoneNumbers=[]),n.phoneNumbers.pushOnlyUniques(i.phoneNumbers,this.phoneComparator));else{if(this._contacts.insertSorted(i,this.contactComparator),i.text){var l=e.escape(i.text);this._contactNames[l]="",this._contactsByName[i.text]=i}this._contactNames.___info___.count=this._contacts.get().length}this._contactCache[i.id]&&(this._contactCache[i.id]=new t(i))},updateContact:function(t){try{e.PAssert(3323,t.id,"Incoming contacts must have a valid id")}catch(t){e.reportError(t)}try{e.PAssert(3324,t.text,"All contacts are expected to have a text")}catch(t){e.reportError(t)}for(var i=!1,n=0;n<this._contacts.get().length;++n){var r=this._contacts.get()[n];if(r.id===t.id){r.text=t.text,r.emails=r.phoneNumbers=void 0,this.addContact(t),i=!0;break}}if(!i)return this.addContact(t),!0},clearContacts:function(){this._contactCache={},this._contacts.clear(),this._contactsByName={},this._contactNames={___info___:{count:0}}},numContacts:function(){var t=this._contacts.get().length;try{e.PAssert(3325,t===this._contactNames.___info___.count,"Contact names count should match contacts value")}catch(t){e.reportError(t)}return t},getContacts:function(){return this._contactNames},previewTemplate:function(){return"template-contact"},getItemStyledText:function(e){return e.text},getItemText:function(e){return e.text},getItemTextLength:function(e){return e.text.length},contactComparator:function(e,t){return e.text&&t.text?e.text.localeCompare(t.text):e.text&&!t.text?1:!e.text&&t.text?-1:void 0},emailComparator:function(e,t){return e.address.toLowerCase()===t.address.toLowerCase()},emailComparatorSort:function(e,t){return e.address&&t.address?e.address.toLowerCase().localeCompare(t.address.toLowerCase()):e.address&&!t.address?1:!e.address&&t.address?-1:void 0},phoneComparator:function(e,t){return e===t||e.number===t.number},ensureCacheObject:function(i){try{e.PAssert(3326,i,"Must have valid data to store in cache")}catch(t){e.reportError(t)}if(this._contactCache[i.id])return this._contactCache[i.id];var n=new t(i);return this._contactCache[i.id]=n,n},findMatchExact:function(e){var t=this._contactsByName[e];if(t)return this.ensureCacheObject(t)},findMatchLike:function(t,i){try{e.PAssert(3327,void 0!==t,"Must provide a valid contact part")}catch(t){e.reportError(t)}for(var n=t.toUpperCase(),r=[],a=this._contacts.get(),s=0;s<a.length;++s){var o=a[s],c=!1;if(o.text.toUpperCase().indexOf(n)>=0&&(c=!0),o.emails)for(var l=0;!c&&l<o.emails.length;++l){var d=o.emails[l].address;if(d.toUpperCase().indexOf(n)>=0){c=!0;break}}if(o.phoneNumbers)for(var l=0;!c&&l<o.phoneNumbers.length;++l){var h=o.phoneNumbers[l].number;if(h.indexOf(n)>=0){c=!0;break}}if(c&&(r.push(this.ensureCacheObject(o)),r.length>=i))break}return r.sort(this.contactComparator),r},findContactByEmail:function(e){for(var t=0;t<this._contacts.get().length;++t){var i=this._contacts.get()[t];if(i.emails)for(var n=0;n<i.emails.length;++n)if(i.emails[n].address===e)return i}},findEmailsLike:function(t,i){try{e.PAssert(3328,void 0!==t,"Must provide a valid email part")}catch(t){e.reportError(t)}i=i||20;for(var n=[],r=t.toUpperCase(),a=0;a<this._contacts.get().length;++a){var s=this._contacts.get()[a];if(s&&s.emails){var o=!1;s.text&&s.text.toUpperCase().indexOf(r)>=0&&(o=!0);for(var c=0;c<s.emails.length;++c){var l=s.emails[c].address;(o||l.toUpperCase().indexOf(r)>=0)&&n.push({type:"contact",text:s.text,email:l})}}if(n.length>=i)break}return n.sort(this.emailComparatorSort),n}},r}),define("ItemStore",["globals","util","Dispatcher"],function(e,t,i){function n(t,i,n,r,a,s,o,c,l){this.id=t;try{e.PAssert(3329,e.isFunction(c),"Must supply a valid parser")}catch(t){e.reportError(t)}this._readonly=!!i,this._isDestructible=!!n,this._enabledFilters=o,this._trackGlobally=!!r,this._requireStoredEls=!!a,this._listenToItemStateChanged=!!s,this._constructor=void 0,this._parser=c,this._owner=l,this._root=void 0,this._data={},this._destroyed=!1,this.init()}return n.prototype={init:function(){this._constructor=require("VMLI"),t.forceBind("updateItems",this),t.forceBind("_markPaneDirty",this),this._listenToItemStateChanged&&i.listen("itemStateChanged",this.updateItems)},getParser:function(){return this._parser},areFiltersEnabled:function(t){return e.isAtLeastOneFlagSet(this._enabledFilters,t)},getEnabledFilters:function(){return this._enabledFilters},isOwner:function(e){return this._owner===e},destroy:function(){try{e.PAssert(3330,this._isDestructible,"Item store must be destructible to destroy")}catch(t){e.reportError(t)}this._listenToItemStateChanged&&i.unlisten("itemStateChanged",this.updateItems),this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0,t.destroy(this)},checkDestroyed:function(){try{e.PAssert(3331,!this._destroyed,"Should not be using a destroyed item store")}catch(t){e.reportError(t)}},trackGlobally:function(){return this._trackGlobally},requireStoredEls:function(){return this._requireStoredEls},clearStore:function(){if(this._isDestructible){e.vmMain.beginUpdateItems();for(var t in this._data)this._root&&t===this._root.id||this._data[t].destroy();e.vmMain.commitUpdateItems()}this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)},createRoot:function(e,t){return this.checkDestroyed(),this._root=this.createItem(e,t,void 0,{isRoot:!0},ChangeType.None),this._root},setRoot:function(t){this.checkDestroyed();try{e.PAssert(3332,t,"Must specify a valid root item")}catch(t){e.reportError(t)}try{e.PAssert(3333,t.belongsToItemStore(this),"Root item must belong to this item store")}catch(t){e.reportError(t)}this._root=t},createItem:function(t,i,n,r,a){try{e.PAssert(3334,n||r&&r.isRoot,"Must always sepcify a valid parentID when creating a new item")}catch(t){e.reportError(t)}this.checkDestroyed();try{e.PAssert(3335,!this._data[t],"Should never double-create for the same item, should use update instead")}catch(t){e.reportError(t)}void 0===a&&(a=ChangeType.None);var s;if(n){s=this._data[n];try{e.PAssert(3336,s,"Parent must be valid if defined")}catch(t){e.reportError(t)}}var o={id:t,text:i};if(r)for(var c in r)r.hasOwnProperty(c)&&(o[c]=r[c]);var l=new this._constructor(o,{store:this,parent:s,changeType:a,canDestroy:this._isDestructible,noSave:this._readonly});return this._data[l.id]=l,l},createItemRaw:function(t,i){try{e.PAssert(3337,i.parent||i&&(i.isRoot||i.noSave||i.noParentOkay),"Must always sepcify a valid parentID when creating a new item")}catch(t){e.reportError(t)}this.checkDestroyed();try{e.PAssert(3338,!!i.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(t){e.reportError(t)}try{e.PAssert(3339,!!i.noSave===this._readonly,"When creating raw items, noSave must match")}catch(t){e.reportError(t)}i.store=this;var n=new this._constructor(t,i);try{e.PAssert(3340,!this._data[n.id],"Should not create an item that already exists in this store")}catch(t){e.reportError(t)}return this._data[n.id]=n,n},destroyItem:function(t){try{e.PAssert(3341,this._isDestructible,"ItemStore must be destructible to destroy items")}catch(t){e.reportError(t)}var i=this._data[t];try{e.PAssert(3342,i,"Must always destroy a valid item")}catch(t){e.reportError(t)}try{e.PAssert(3343,!i.isDestroyed(),"Should never destroy an item twice")}catch(t){e.reportError(t)}i.parent()&&(i.parent().removeChild(i,ChangeType.Local),i.parent(void 0)),i.destroy(),delete this._data[t]},modifyItemID:function(t,i){try{e.PAssert(3344,t.belongsToItemStore(this),"Item must belong to this item store")}catch(t){e.reportError(t)}try{e.PAssert(3345,t.id!==i,"Must actually be modifying the item ID")}catch(t){e.reportError(t)}try{e.PAssert(3346,this._data[t.id],"Must have a valid item stored under the current ID: "+t.id+" - "+i+" - "+t.isDestroyed())}catch(t){e.reportError(t)}try{e.PAssert(3347,!this._data[i],"Must not be overwriting an existing item"+t.id+" - "+i+" - "+t.isDestroyed())}catch(t){e.reportError(t)}delete this._data[t.id],this._data[i]=t},manualModifyItemID:function(t,i){try{e.PAssert(3348,!this._data[i],"Must not be overwriting an existing item"+t+" - "+i)}catch(t){e.reportError(t)}var n=this._data[t];try{e.PAssert(3349,n,"Must have valid item to change its ID")}catch(t){e.reportError(t)}n&&(delete this._data[t],this._data[i]=n)},getItem:function(e){return this.checkDestroyed(),this._data[e]},hasItem:function(e){return this.checkDestroyed(),!!this._data[e]},getRoot:function(){return this.checkDestroyed(),this._root},isRoot:function(e){return this.checkDestroyed(),this._root===e},getCount:function(){return this.checkDestroyed(),Object.keys(this._data).length},forEach:function(e){this.checkDestroyed();for(var t in this._data)this._data[t]&&e(this._data[t])},_markPaneDirty:function(e){e.usesItemStore(this)&&e.setItemsDirty()},updateItems:function(t){t&&!t.belongsToItemStore(this)||(e.vmMain.paneManager.runForEachPane(this._markPaneDirty),e.vmMain.updateAllItems())}},t.defineBase(n),n}),define("data",["globals","util","Constants","gdata","database","demo","platform","VMContactManager","ItemStore"],function(e,t,i,n,r,a,s,o,c){function l(t,i){var n=e.fieldMapValidators[t];return n&&n(i)||void 0===i||null===i}function d(){}function h(t,i){if(i&&i.target){var n=i.target.error;if(n){log("Transaction Error Info: ",n.type,n.name,n.code,n.message);var r="QuotaExceededError"===n.name||4===n.code;"InvalidStateError"===n.name||r?b.notifyDBUnexpectedClose(r):e.reportError(new Error("IDB Transaction Error"),n)}else e.reportError(new Error("Unexpected transaction error A"),i)}else e.reportError(new Error("Unexpected transaction error B"),i)}function u(e){var t=b.getItem(e);if(t){var i=t.items;if(i)for(var n=0;n<i.length;++n)u(i[n]);b.dbDeleteItem(t.id)}}function p(t,i,n,r){try{e.PAssert(3399,t,"Must provide a valid item")}catch(t){e.reportError(t)}try{e.PAssert(3400,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}var a=e.isLocalChange(r)?SaveFlag.Prop:SaveFlag.None;t.save({items:t.getItemsArrayForSave()},a),i.save({isArchived:n},a)}function m(t){try{e.PAssert(3421,t&&t.data,"Item must have valid remote data associated with it to be in the tree")}catch(t){e.reportError(t)}if(t&&t.data){if(!b.pendingRemoteUpdates[t.id]){var i=t.getVersion(VersionType.Structure)===n.getVersion(t.data,VersionType.Structure),r=t.getVersion(VersionType.Text)===n.getVersion(t.data,VersionType.Text),a={};i||(a.version=n.getVersion(t.data,VersionType.Structure),t.setVersion(VersionType.Structure,n.getVersion(t.data,VersionType.Structure))),r||(a.versionText=n.getVersion(t.data,VersionType.Text),t.setVersion(VersionType.Text,n.getVersion(t.data,VersionType.Text))),this.modifiedOffline&&(a.modifiedOffline=!1,t.modifiedOffline=!1),this.modifiedOfflineText&&!n.hasDeferredAction(t.id)&&(a.modifiedOfflineText=!1,t.modifiedOfflineText=!1),e.isEmpty(a)||(a.id=t.id,b.dbUpdateItem({id:t.id,changes:a,saveFlags:SaveFlag.None}))}for(var s=t.getItems(),o=0;o<s.length;++o)m(s[o]);if(t.hasArchivedChildren())for(var c=t.archivedItems(!0),o=0;o<c.length;++o)m(c[o])}}function f(e,t,i){var n=e[t];return n?',"'+t+'":'+(i?i(n):n):""}function g(t){return I.lastIndex=0,I.test(t)?t.replace(I,function(t){var i=A[t];return e.isString(i)?i:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}):t}function v(t){var i;try{var n=new Date(t);e.isDateValid(n)&&(i=n.getTime())}catch(t){e.reportError(t)}return i}function y(e,t,i,n){var r="";t&&(r+=",");var a=b.getModel(e.id),s=g(a.generateExportText(a.getParsedText())),e=b.getItem(e.id);if(r+='{"text":"'+s+'"'+f(e,"date",v)+f(e,"dateCompleted")+f(e,"priority")+f(e,"isComplete")+f(e,"isStarred")+f(e,"isArchived")+f(e,"isNote"),e.note&&n&&(r+=',"note":'+y(b.getItem(e.note),!1,i,n)),e.items&&e.items.length>0){r+=',"items":[';for(var o=0;o<e.items.length;o++){var c=b.getItem(e.items[o]);(!c.isArchived||c.isArchived&&i)&&(r+=y(c,o>0,i,n))}r+="]"}return r+="}"}var b={pendingRemoteUpdates:{},itemCache:{},dbDataCache:{},loadedItemCount:0,hasLocalData:!1,freezeUpdates:!1,hasMadeInMemoryOnlyUpdate:!1,dbClosed:!1,overQuota:!1,dbi:void 0,contactManager:new o};b.forEachModel=function(t){try{e.PAssert(3350,t,"Must pass a valid function to iterate on")}catch(t){e.reportError(t)}for(var i in b.itemCache)b.itemCache[i]&&t(b.itemCache[i])},b.getModel=function(t){try{e.PAssert(3351,e.isString(t),"ID must be a valid string: "+e.getObjectInfo(t))}catch(t){e.reportError(t)}try{e.PAssert(3352,t,"Tried to get a model with an invalid id")}catch(t){e.reportError(t)}return b.itemCache[t]},b.setModel=function(t){try{e.PAssert(3353,t,"Tried to set an invalid model")}catch(t){e.reportError(t)}try{e.PAssert(3354,t.id,"Tried to set a model with an invalid id")}catch(t){e.reportError(t)}try{e.PAssert(3355,e.isString(t.id),"ID must be a valid string: "+e.getObjectInfo(t.id))}catch(t){e.reportError(t)}try{e.PAssert(3356,void 0===b.itemCache[t.id],"Must not be replacing a model with another copy")}catch(t){e.reportError(t)}b.itemCache[t.id]=t},b.clearModel=function(t){try{e.PAssert(3357,e.isString(t),"ID must be a valid string: ",e.getObjectInfo(t))}catch(t){e.reportError(t)}try{e.PAssert(3358,void 0!==b.itemCache[t],"Must not clear a model that does not exist")}catch(t){e.reportError(t)}b.itemCache[t]=void 0},b.getItem=function(t){try{e.PAssert(3359,e.isString(t),"ID must be a valid string:"+e.getObjectInfo(t))}catch(t){e.reportError(t)}try{e.PAssert(3360,t,"Tried to get an item that doesn't exist")}catch(t){e.reportError(t)}return b.dbDataCache[t]},b.setItem=function(t,i){try{e.PAssert(3361,e.isString(t),"ID must be a valid string: "+e.getObjectInfo(t))}catch(t){e.reportError(t)}try{e.PAssert(3362,t,"Tried to set an item with an invalid id")}catch(t){e.reportError(t)}try{e.PAssert(3363,void 0===b.dbDataCache[t]||void 0===i,"Must not be replacing an item with another copy")}catch(t){e.reportError(t)}b.dbDataCache[t]=i},b.validateItemData=function(t){try{for(var i in t){var n=l(i,t[i])||!1;try{e.PAssert(3364,n,"Invalid data set in item: ",i,"=",t[i],typeof t[i])}catch(t){e.reportError(t)}n||b.fixItemData(t,i)}}catch(e){b.reportError(e)}},b.fixItemData=function(t,i){var n=!1,r=e.fieldMapFixer[i];if(r){var a=r(t[i]);log("Value Fixed: ",t[i],"->",a),t[i]=a;try{e.PAssert(3365,l(i,a),"Fixed field must always be valid")}catch(t){e.reportError(t)}n=!0}return n},b.clearItems=function(){b.dbDataCache={},b.itemCache={}},b.clearPlugins=function(){e.vmMain.pluginManager.onClearData()},b.getRootItem=function(){return b.rootId?b.getItem(b.rootId):void 0},b.getRootModel=function(){return b.rootId?b.getModel(b.rootId):void 0},b.createVMLI=function(t,i){return e.vmMain.itemStoreManager.getDefaultItemStore().createItemRaw(t,i)},b.createTempVMLI=function(t,i){return i.noSave=!0,i.canDestroy=!0,e.vmMain.itemStoreManager.getTempItemStore().createItemRaw(t,i)},b.destroyTempVMLI=function(t){e.vmMain.itemStoreManager.getTempItemStore().destroyItem(t)},b.initializeIndexedDB=function(n){function a(a){a&&r?r.open({server:"duchess",version:o,schema:{items:{key:{keyPath:"id"}},settings:{},caches:{key:{keyPath:"cid"}}}}).done(function(t){b.dbi=t;try{t.handleDisconnect(function(e){log("DB Disconnect Event: ",e)})}catch(t){e.reportError(t)}for(var i=0;i<S.length;++i)S[i](!0);S=[],n()}).fail(function(r){try{log("Error loading local DB client - "+r.target.error.name+": "+r.target.error.message)}catch(e){log("Error loading local DB client - Invalid Error Message")}e.preventLocalWrites(i.LocalWriteReason.Generic),"Firefox"===s.browser?r.target&&r.target.error&&"InvalidStateError"===r.target.error.name||e.reportError(new Error("DB Load Failure"),r):"Safari"===s.browser?r.target&&r.target.error&&"DBOpenError"===r.target.error.name||e.reportError(new Error("DB Load Failure"),r):e.reportError(new Error("DB Load Failure"),r),"VersionError"===r.target.error.name&&(t.hasURLParam("versionError")||e.AppCache.runOnFinish(function(){t.insertURLParam("versionError",!0)},!0)),n()}):(e.preventLocalWrites(i.LocalWriteReason.Generic),n())}var o=3;window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?window.indexedDB.onIsReady(a):setTimeout(function(){a(!0)},0)},b.getDBState=function(e){e.dbClosedUnexpected=b.dbClosed,e.hasLocalData=b.hasLocalData,e.hasMadeInMemoryOnlyUpdate=b.hasMadeInMemoryOnlyUpdate};var S=[];b.onCachesAvailable=function(t){b.dbi?t(!0):e.shouldWriteLocal()?S.push(t):t(!1)},b.openCacheDatabase=function(e,t,i,n){var a=function(){r?r.open({server:e,version:t,schema:i}).done(function(e){n(e)}).fail(function(e){n(void 0)}):n(void 0)};window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?a():setTimeout(a,0)};var E={};b.openCacheTable=function(e){if(b.dbi)return E[e]=void 0===E[e]?1:E[e]+1,b.dbi.caches},b.closeCacheTable=function(t){try{e.PAssert(3366,E[t]>0,"Must have previously opened the cache to close it")}catch(t){e.reportError(t)}E[t]--};var C=!1;b.localDataLoaded=function(){return C},b.loadFromIndexedDB=function(t){try{e.PAssert(3368,!C,"Should never load local data twice")}catch(t){e.reportError(t)}if(ShouldLog(LogLevels.Timing)&&log("Loading DB: ",log.now()),b.dbDataCache={},e.shouldWriteLocal())if(b.dbi&&b.dbi.items){var n=!1,r=!1,a=window.__preload,s=function(i){try{e.PAssert(3369,!r,"Should only process load results once")}catch(t){e.reportError(t)}r=!0,ShouldLog(LogLevels.Timing)&&log("Loaded DB: ",log.now()),b.loadedItemCount=0;for(var s=0;s<i.length;++s){var o=n?i[s]:e.translateObjOut(i[s]);i[s]&&i[s].id&&o&&(b.setItem(i[s].id,o),b.loadedItemCount++)}if(b.dbi.settings){var c=function(i){if(!e.criticalErrorReported()){if(C=!0,i){try{e.PAssert(3370,b.getItem(i.root),"If there is a root item defined there should be a corresponding local item")}catch(t){e.reportError(t)}b.rootId=i.root}t&&t()}};a.settingsPreload&&a.settingsPreload.root?c(a.settingsPreload.root):b.dbi.settings.get("root").done(c).fail(t)}else log("Unable to load local settings DB"),t&&t()};a?a.mainLoaded=!0:a=window.__preload={mainLoaded:!0};var o,c,l=function(e){c=Date.now(),o&&log("Time preload blocked: ",c-o),clearTimeout(a.mainTimeout),a.mainTimeout=void 0,a.dataResults=void 0,a.worker&&(a.worker.terminate(),a.worker=void 0),e?s(e):(n=!1,a.onDataLoaded=void 0,b.dbi.items.query().all().fastExecute().done(s))};a.runDataLoad?(n=!0,a.dataResults?(console.log("Preload data available"),l(a.dataResults)):(console.log("Blocked on preload"),o=Date.now(),a.onDataLoaded=l,a.mainTimeout=setTimeout(function(){e.reportError(new Error("Preload timeout"));try{e.PAssert(3371,!a.dataResults,"Should not have results defined")}catch(t){e.reportError(t)}n=!1,a.onDataLoaded=void 0,a.worker&&(a.worker.terminate(),a.worker=void 0),b.dbi.items.query().all().fastExecute().done(s)},15e3))):(console.log("Preload skipped"),b.dbi.items.query().all().fastExecute().done(s))}else log("Unable to load local items DB - db not connected"),C=!0,e.preventLocalWrites(i.LocalWriteReason.Generic),t&&t();else log("Unable to load local items DB - already disabled"),C=!0,t&&t()};var P;b.beginTransaction=function(){e.shouldWriteLocal()&&(P={})},b.transactionUpdate=function(t,i){try{e.PAssert(3372,e.shouldWriteLocal(),"Should never be writing during a transaction if local writes are disabled")}catch(t){e.reportError(t)}if(P[t])for(var n in i)P[t][n]=i[n];else P[t]=i},b.notifyDBUnexpectedClose=function(t){var n;t?(e.toasts.pushMessage(MessageID.QuotaError),b.overQuota=!0,n=i.LocalWriteReason.QuotaError):(e.toasts.pushMessage(MessageID.LocalWritesDisabled),n=i.LocalWriteReason.Generic),e.preventLocalWrites(n),b.dbClosed=!0;try{e.PAssert(3373,e.vmMain&&e.vmMain.pluginManager,"Should always have a plugin manager when reporting DB quota error")}catch(t){e.reportError(t)}e.vmMain&&e.vmMain.pluginManager&&t&&e.vmMain.pluginManager.onCacheLimitExceeded()},b.endTransaction=function(){if(e.shouldWriteLocal()&&b.dbi&&b.dbi.items)try{b.dbi.items.updateObject(P).done(d).fail(h)}catch(t){e.reportError(t),h()}else void 0!==P&&e.reportError(new Error("Started a transaction and stopped writes halfway through"));P=void 0},b.hasPendingDBTransaction=function(){return!!P},b.dbUpdateItem=function(t){if(!b.freezeUpdates){b.hasLocalData||e.isLoadingRemote||t.skipLocalModification||(b.hasLocalData=!0);var i=t.changes||{},n=t.id?t.id:i.id,r=t.callback,a=t.saveFlags;try{e.PAssert(3374,a===SaveFlag.None||a===SaveFlag.Prop||a===SaveFlag.Text||a===SaveFlag.All)}catch(t){e.reportError(t)}var s=b.getItem(n);if(e.shouldWriteLocal()){var o;try{e.PAssert(3375,!a||void 0===i.modifiedOffline&&void 0===i.modifiedOfflineText,"Shouldn't be setting a modified flag while passing them in with changes")}catch(t){e.reportError(t)}if(e.isFlagSet(a,SaveFlag.Prop)){try{e.PAssert(3376,void 0===i.modifiedOffline,"Shouldnt be passing in a value and assigning "+i.modifiedOffline)}catch(t){e.reportError(t)}i.modifiedOffline=!0;var c=b.getModel(n);c&&(c.modifiedOffline=!0)}if(e.isFlagSet(a,SaveFlag.Text)){try{e.PAssert(3377,void 0===i.modifiedOfflineText,"Shouldnt be passing in a value and assigning "+i.modifiedOfflineText)}catch(t){e.reportError(t)}i.modifiedOfflineText=!0;var c=b.getModel(n);c&&(c.modifiedOfflineText=!0)}if(s){for(var l in i)if(i.hasOwnProperty(l)){s[l]=i[l]}b.validateItemData(s),o=e.translateObjIn(s)}else{try{e.PAssert(3378,i.id,"Item being modified does not already exist as expected",i)}catch(t){e.reportError(t)}b.setItem(n,i),o=e.translateObjIn(i)}if(P){try{e.PAssert(3380,!r,"Callbacks not supported for updates inside of a transaction")}catch(t){e.reportError(t)}b.transactionUpdate(n,o)}else try{r?b.dbi.items.update(o).done(r).fail(r):b.dbi.items.update(o)}catch(t){"InvalidStateError"===t.name?b.notifyDBUnexpectedClose(!1):e.reportError(t)}}else{if(s)for(var l in i)i.hasOwnProperty(l)&&(s[l]=i[l]);else b.setItem(n,i);b.hasMadeInMemoryOnlyUpdate=!0,r&&r()}}},b.dbDeleteItem=function(t,i){if(!b.freezeUpdates&&(b.setItem(t,void 0),e.shouldWriteLocal()))try{i?b.dbi.items.remove(t).done(i).fail(i):b.dbi.items.remove(t)}catch(t){e.reportError(t)}},b.setRoot=function(t){if(!b.freezeUpdates){if(e.shouldWriteLocal())try{b.dbi.settings.update({key:"root",item:{root:t}})}catch(t){e.reportError(t)}return b.rootId=t,b.getRootItem()}},b.setPluginData=function(t){var i=Object.keys(t);a.clearGapiData();for(var n=0;n<i.length;++n){var r=i[n],s=e.vmMain.pluginManager.getPlugin(r),o=t[r].data;o&&(a.setGapiData(r,o),s&&s.forceLoad())}};var T=0,D={};b.demoDataId=void 0,b.loadDemoData=function(t,n,r){function s(e){e.id||(e.id="demo"+T++),b.setItem(e.id,e);var t=e.note;t&&(t.id||(t.id="demo"+T++),s(t),e.note=t.id);var i=e.items;if(i){for(var n=[],r=0;r<i.length;++r)i[r].id||(i[r].id="demo"+T++),n.push(i[r].id),s(i[r]);e.items=n}}function o(i){var a,o;i&&(a=i[0],o=i[1]),o&&(n&&b.clearPlugins(),b.setPluginData(o)),a&&(n&&(e.vmMain.itemStoreManager.runForEachStore(function(e){e.clearStore()}),b.clearItems()),s(a),b.setRoot(a.id),D[t]={root:a,plugins:o},C=!0,r&&r(a.id))}if(b.demoDataId=t,a.areRemoteFunctionsHooked()||a.hookRemoteFunctions(),n||void 0===t||""===t||void 0===D[t]){var c;if(t)a.loadRemoteData(t,o);else{try{e.PAssert(3381,!1,"Test data must be defined using #data=XXX.YYY in URL")}catch(t){e.reportError(t)}var c={text:i.RootItemName,items:[]};o([c])}}else{log("Use Preloaded demo data: ",t);var l=D[t];b.setRoot(l.root.id),l.plugins&&b.setPluginData(l.plugins),r&&r(l.root.id)}};var M=!1;b.initData=function(i){if(M)return!1;M=!0,ShouldLog(LogLevels.Timing)&&log("Initializing User Item Data",log.now());try{e.isDemoMode()?setTimeout(function(){var e=t.getURLParam("data");b.loadDemoData(e,!1,i)},0):(e.checkpoint(Checkpoint.InitData),b.initializeIndexedDB(function(){b.loadFromIndexedDB(function(){e.checkpoint(Checkpoint.DBLoaded),b.checkLocalIntegrity(function(t){b.loadLocalContacts(),t&&t.error&&e.reportError(new Error("Error during local integrity check")),i()})})}))}catch(t){e.reportError(t)}return!0},b.initializeItem=function(t){try{e.PAssert(3382,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}var i=t.id,r=!i||e.isLocalItem(t)||!t.data;if(r){var a=n.createNewItem(t,t.hasChildren(),t.hasArchivedChildren());i&&i!==a&&b.modifyItemId(i,a);for(var s=!1,o=t.numItems(),c=0;c<o;++c){var l=b.initializeItem(t.itemAtIndex(c));s=s||l}if(t.hasArchivedChildren())for(var d=t.archivedItems(!0),c=0;c<d.length;++c){var l=b.initializeItem(d[c]);s=s||l}if(t.hasNote()){var l=b.initializeItem(t.getNote());s=s||l}if(n.initializeNewItem(t),i&&i!==a){var h=t.parent();h&&h.save(null,SaveFlag.None)}}return r},b.checkLocalIntegrity=function(t){ShouldLog(LogLevels.Timing)&&log("Checking Local: ",log.now());var i=!1;b.ensureLocalCache(function(){ShouldLog(LogLevels.Timing)&&log("Verifying Local Data",log.now());var n=!1,r={};for(var a in b.dbDataCache)if(b.dbDataCache.hasOwnProperty(a)&&b.getItem(a)){var s=b.getItem(a);(s.i||s.t)&&(log("%cInvalid local properties on item: ","color: red",s),i=!0),r[s.id]?r[s.id].exist?(log(s.id,": Duplicated IDs in the local database",s),i=!0):(r[s.id].exist=!0,r[s.id].del=!!s.isDeleted):r[s.id]={exist:!0,ref:!1,del:!!s.isDeleted},s.id===b.rootId&&(n&&(log(s.id,": Multiple roots present locally",s),i=!0),n=!0,r[s.id].isRoot=!0),void 0===s.text&&(log("Found item with no text",s.id),s.text="",b.dbUpdateItem({id:a,changes:{text:""},saveFlags:SaveFlag.None})),s.note&&(r[s.note]?r[s.note].ref?(log(s.id,": Item note is used twice - ",s.note),i=!0):r[s.note].ref=s.id:r[s.note]={exist:!1,ref:s.id});for(var o=0;s.items&&o<s.items.length;++o){var c=-1;if(s.items[o]){var l=s.items[o],d=b.getItem(l);if(d){if(d.isArchived&&(c=o),c>=0&&!d.isArchived){log(l,": Unarchived child found after an archived one"),log("   ",s.id,": Parent with incorrectly ordered children"),i=!0;var h=s.items.removeAt(c);s.items.insert(o,h),c=o,b.dbUpdateItem({id:s.id,changes:{items:s.items},saveFlags:SaveFlag.None})}}else log(l,": Child does not have a valid reference on our local database"),i=!0;if(r[l])if(r[l].ref){log(l,": Item is referenced locally multiple times: ",d?b.getItem(l).id:"UNDEFINED"),log("   ",r[l].ref,": ",b.getItem(r[l].ref).id),log("   ",s.id,": <CLIENTDATA>"),i=!0;var p=s.items;p.removeAt(o),b.dbUpdateItem({id:a,changes:{items:p},saveFlags:SaveFlag.None})}else r[l].ref=s.id;else r[l]={exist:!1,ref:s.id}}else log(s.id,": Invalid item in local items array"),i=!0}}!n&&b.hasLocalData&&(log("No root present"),i=!0);for(var m in r){
var f=r[m];if(!f.exist){log(m,": Item is referenced locally as a child but does not exist in the database");var s=b.getItem(f.ref);try{e.PAssert(3383,s,"Parent of item must exist")}catch(t){e.reportError(t)}if(s){var p=s.items;p?p.remove(m):p=[],b.dbUpdateItem({id:s.id,changes:{items:p},saveFlags:SaveFlag.None})}}if(f.ref||f.isRoot||f.del||(log(m,": Item exists locally but is not referenced by a parent"),u(m)),f.ref&&f.del){log(m,": Item is referenced locally by a parent but has been deleted");var s=b.getItem(f.ref);try{e.PAssert(3384,s)}catch(t){e.reportError(t)}var p=s.items;p?p.remove(m):p=[],b.dbUpdateItem({id:s.id,changes:{items:p},saveFlags:SaveFlag.None})}if(f.isRoot&&f.ref&&(log(m,": Local root has a parent"),i=!0),f.del&&!f.ref){var s=b.getItem(m);e.isLocalItem(s)&&(log("Deleting Unreferenced Local Item: ",m),b.dbDeleteItem(m))}}ShouldLog(LogLevels.Timing)&&log("Done Verifying Local Data",log.now()),t({error:i,local:!1})})},b.removeDeletedItems=function(e){for(var t in b.dbDataCache){var i=b.getItem(t);i&&i.isDeleted&&(e[t]||b.dbDeleteItem(t))}},b.defaultSkipSettings={Default:[Settings.authScopes,Settings.activeUser,Settings.userId,Settings.displayName,Settings.shownTutorial,Settings.helpPaneState,Settings.oauthScheme,Settings.enableOfflineAuth,Settings.premiumStatus,Settings.trialStart,Settings.trialDuration,Settings.trialExtended,Settings.theme,Settings.helpState,Settings.localPaneState,Settings.selectedWorkspace,Settings.notificationDelay]},b.addDefaultSkipSetting=function(e,t){b.defaultSkipSettings[t]||(b.defaultSkipSettings[t]=[]),b.defaultSkipSettings[t].push(e)},b.clearDataAndReload=function(i){t.hasURLParam("sinfo")&&t.removeURLParam("sinfo"),b.clearData(function(){setTimeout(e.reload,0)},b.defaultSkipSettings,i)},b.clearData=function(t,n,r){b.freezeUpdates=!0,e.shouldWriteLocal()||e.isLocalWriteReason(i.LocalWriteReason.QuotaError)?setTimeout(function(){function i(){if(!r){b.clearContacts();var i;i=e.isArray(n)?{Default:n}:n,e.settings.resetAll(i),e.vmMain&&e.vmMain.pluginManager&&e.vmMain.pluginManager.onPurgeData()}e.vmMain&&e.vmMain.cacheManager&&(r?e.vmMain.cacheManager.clearPerDocCaches(!0):e.vmMain.cacheManager.clearLocalCaches(!0)),setTimeout(function(){t&&t()},0)}function a(){if(b.dbi.items)try{b.dbi.items.clear().done(function(){s()}).fail(function(){log("Failed to reset items!"+arguments),s()})}catch(t){e.reportError(t),s()}else s()}function s(){if(b.dbi.caches)try{b.dbi.caches.clear().done(function(){i()}).fail(function(){log("Failed to reset items!"+arguments),i()})}catch(t){e.reportError(t),i()}else i()}if(e.pageDataCleared(),!b.dbi)return void b.initializeIndexedDB(function(){b.clearData(t,n)});if(b.dbi.settings)try{b.dbi.settings.clear().done(function(){a()}).fail(function(){log("Failed to reset settings!"+arguments),a()})}catch(t){e.reportError(t),a()}else a()},0):t&&setTimeout(t,0)};var _=!1;b.clearLocalContacts=function(){if(_=!1,e.shouldWriteLocal())try{t.storage.setItem("ctcs","[]")}catch(t){e.reportError(t)}b.contactManager.clearContacts(),e.settings.set(Settings.lastContactSync,void 0)},b.loadLocalContacts=function(){if(!_&&(_=!0,e.shouldWriteLocal()))try{var i=t.storage.getItem("ctcs"),n=i?JSON.parse(i):void 0;b.contactManager.loadContacts(n,!1)}catch(t){e.reportError(t)}},b.areLocalContactsLoaded=function(){return _},b.saveContacts=function(){e.shouldWriteLocal()&&t.storage.setItem("ctcs",JSON.stringify(b.contactManager._contacts.get()))},b.clearContacts=function(){e.settings.reset(Settings.lastContactSync),e.shouldWriteLocal()&&t.storage.removeItem("ctcs",void 0)},b.insertItem=function(t,i,r){try{e.PAssert(3385,e.isVMLI(t),"Must pass in a valid item")}catch(t){e.reportError(t)}try{e.PAssert(3386,e.isVMLI(i),"Must pass in a valid insert item")}catch(t){e.reportError(t)}try{e.PAssert(3387,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(3388,void 0===r||r>=0,"Must pass in a valid index")}catch(t){e.reportError(t)}t.save({items:t.getItemsArrayForSave()},SaveFlag.Prop),n.itemAdded({item:t,addedItem:i,index:r,isArchived:!1})},b.insertItems=function(t,i,r){try{e.PAssert(3389,t,"Must pass in a valid item")}catch(t){e.reportError(t)}try{e.PAssert(3390,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(3391,void 0===r||r>=0,"Must pass in a valid index")}catch(t){e.reportError(t)}t.save({items:t.getItemsArrayForSave()},SaveFlag.Prop),1===i.length?n.itemAdded({item:t,addedItem:i[0],index:r,isArchived:!1}):n.itemsAdded({item:t,addedItems:i,index:r,isArchived:!1})},b.removeItem=function(t,i,r,a,s){try{e.PAssert(3392,t,"Must pass in a valid item")}catch(t){e.reportError(t)}try{e.PAssert(3393,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(3394,void 0===i||i>=0,"Must pass in a valid index")}catch(t){e.reportError(t)}var o=e.isLocalChange(s)?SaveFlag.Prop:SaveFlag.None;t.save({items:t.getItemsArrayForSave()},o),e.isLocalChange(s)&&n.itemRemoved({item:t,index:i,numToRemove:1,isArchived:a})},b.moveItem=function(t,i){var r=t.item,a=t.newInfo,s=t.oldParent,o=t.oldInfo,c=t.noVersion,l=e.isLocalChange(i)?SaveFlag.Prop:SaveFlag.None;try{e.PAssert(3395,void 0!==r&&void 0!==a&&void 0!==s&&void 0!==o,"moveItem is missing parameters")}catch(t){e.reportError(t)}try{e.PAssert(3396,r.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(3397,s.shouldSave(),"Old parent must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(3398,r.parent().shouldSave(),"New parent must be marked as saveable")}catch(t){e.reportError(t)}s.save({items:s.getItemsArrayForSave()},l),r.parent().save({items:r.parent().getItemsArrayForSave()},l),o.isArchived!==a.isArchived&&(r.isArchived(a.isArchived,i),r.save({isArchived:a.isArchived},l)),e.isLocalChange(i)&&(b.saveChanges(r,{},l),n.itemMoved({item:r,newInfo:a,oldParent:s,oldInfo:o,noVersion:c}))},b.archiveItem=function(t,i,r,a){try{e.PAssert(3401,t,"Must provide a valid item")}catch(t){e.reportError(t)}try{e.PAssert(3402,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(3403,i>=0,"Must have a valid index to remove from")}catch(t){e.reportError(t)}p(t,r,!0,a),e.isLocalChange(a)&&n.itemArchived(t,r,i)},b.unarchiveItem=function(t,i,r,a){try{e.PAssert(3404,t,"Must provide a valid item")}catch(t){e.reportError(t)}try{e.PAssert(3405,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(3406,i>=0,"Must have a valid index to remove from")}catch(t){e.reportError(t)}p(t,r,!1,a),e.isLocalChange(a)&&n.itemUnarchived(t,r,i,t.numItems()-1)},b.modifyItemId=function(t,i,n){var r=b.getItem(t),a=b.getModel(t);try{e.PAssert(3407,a.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}if(e.vmMain.itemStoreManager.getDefaultItemStore().manualModifyItemID(t,i),r.id=i,a.id=i,b.pendingRemoteUpdates[t]&&(b.pendingRemoteUpdates[t]=void 0,b.pendingRemoteUpdates[i]=!0),r.version=-1,r.versionText=-1,"root"===t)for(var s=r.items.length-1;s>=0;s--){var o=b.getItem(r.items[s]);if(e.isLocalItem(o)&&!o.modifiedOffline&&!o.modifiedOfflineText){r.items.removeAt(s);try{e.PAssert(3408,a.itemAtIndex(s).id===o.id,"Item arrays should match")}catch(t){e.reportError(t)}a.getItems().removeAt(s)}}try{e.PAssert(3409,!b.itemCache[i],"Should not be overwriting an item in the d.itemCache")}catch(t){e.reportError(t)}try{e.PAssert(3410,!b.dbDataCache[i],"Should not be overwriting an item in the d.dbDataCache")}catch(t){e.reportError(t)}b.itemCache[i]=b.itemCache[t],b.dbDataCache[i]=r,b.dbDeleteItem(t),b.dbUpdateItem({changes:r,callback:n,skipLocalModification:!0,saveFlags:SaveFlag.None}),b.dbDataCache[t]=void 0,delete b.dbDataCache[t],b.itemCache[t]=void 0,delete b.itemCache[t]},b.deleteItem=function(t,i){try{e.PAssert(3411,t,"Must provide a valid item")}catch(t){e.reportError(t)}try{e.PAssert(3412,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(3413,!t.isDeleted(),"Should never try to delete an item that has already been deleted")}catch(t){e.reportError(t)}if(b.getItem(t.id))t.isDeleted(!0,i),b.dbUpdateItem({id:t.id,changes:{isDeleted:!0},saveFlags:SaveFlag.Prop});else try{e.PAssert(3414,"Expected local item, didnt find one",t.id)}catch(t){e.reportError(t)}},b.undeleteItem=function(t,i){if(b.getItem(t.id))t.isDeleted(!1,i),b.dbUpdateItem({id:t.id,changes:{isDeleted:void 0},saveFlags:SaveFlag.Prop});else try{e.PAssert(3415,"Expected local item, didnt find one",t.id)}catch(t){e.reportError(t)}},b.saveChanges=function(t,i,n){if(t){try{e.PAssert(3417,t.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}i||(i={}),b.dbUpdateItem({id:t.id,changes:i,saveFlags:n})}else{log("Incoming item to save has no item!",t,i);try{e.PAssert(3416,!1,"Incoming item to save has no item!")}catch(t){e.reportError(t)}}},b.addPendingUpdate=function(t){try{e.PAssert(3418,t,"Invalid ID")}catch(t){e.reportError(t)}try{e.PAssert(3419,e.isString(t),"Must provide a valid id string")}catch(t){e.reportError(t)}b.pendingRemoteUpdates[t]||(b.pendingRemoteUpdates[t]=!0)},b.clearPendingUpdate=function(e){delete b.pendingRemoteUpdates[e]},b.clearPendingUpdates=function(){for(var t in b.pendingRemoteUpdates){try{e.PAssert(3420,b.pendingRemoteUpdates.hasOwnProperty(t))}catch(t){e.reportError(t)}var i=b.getModel(t),r=b.getItem(t);if(r&&r.isDeleted)b.dbDeleteItem(t);else if(i&&i.data){var a={id:t,modifiedOffline:!1};i.modifiedOffline=!1,n.hasDeferredAction(i.id)||(i.modifiedOfflineText=!1,a.modifiedOfflineText=!1);var s=n.getVersion(i.data,VersionType.Structure),o=n.getVersion(i.data,VersionType.Text);s!=i.getVersion(VersionType.Structure)&&(a.version=s,i.setVersion(VersionType.Structure,s)),o!=i.getVersion(VersionType.Text)&&(a.versionText=o,i.setVersion(VersionType.Text,o)),b.dbUpdateItem({id:t,changes:a,saveFlags:SaveFlag.None})}}b.pendingRemoteUpdates={},setTimeout(function(){m(this.getRootModel())}.bind(this),0)},b.toDropHtml=function(t){var i="";if(!t.isArchived()&&(i+="<li>"+e.escape(t.getParsedText())+"</li>",t.hasChildren())){i+="<ul>";for(var n=0;n<t.numChildren();++n)i+=b.toDropHtml(t.getChild(n));i+="</ul>"}return i},b.toHtml=function(t,i,n){var r="<ul>";if(t.items)for(var a=0;a<t.items.length;a++){var s=b.getItem(t.items[a]),o=b.getModel(s.id),c=e.escape(o.getParsedText());if(!s.isArchived||s.isArchived&&i){if(r+="<li>"+c,s.note&&n){r+="<li>";var l=b.getModel(s.note);r+=e.escape(l.getParsedText()),r+="</li>"}s.items&&s.items.length>0&&(r+=b.toHtml(s,i,n)),r+="</li>"}}return r+="</ul>"},b.toPlainText=function(e,t,i,n){isNaN(t)&&(t=0);var r="";if(e.items)for(var a=0;a<e.items.length;a++){var s=b.getItem(e.items[a]),o=b.getModel(s.id);if(!s.isArchived||s.isArchived&&i){for(var c=0;c<t;c++)r+="\t";if(r+=o.getParsedText()+"\n",s.note&&n){var l=b.getModel(s.note);r+=l.getParsedText()+"\n"}s.items&&s.items.length>0&&(r+=b.toPlainText(s,t+1,i,n))}}return r};var I=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,A={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return b.toJSON=function(t,i,r,a){var s=y(t,i,r,a),o='{"moodoVer":'+(e.settings.get(Settings.localDataVersion)||n.currentVersion())+',"moodoRoot":'+s+"}";try{var c=JSON.parse(o),l=JSON.stringify(c);try{e.PAssert(3426,l===o,o)}catch(t){e.reportError(t)}}catch(t){e.reportError(t)}return o},b.createRootItem=function(e){b.setRoot(e),b.dbUpdateItem({changes:{id:e,text:i.RootItemName,items:[]},skipLocalModification:!0,saveFlags:SaveFlag.None,callback:function(){}})},b.ensureLocalCache=function(e){b.getRootItem()?(b.loadedItemCount>1&&(b.hasLocalData=!0),e()):e()},b.printIndexedDB=function(){},b}),define("MBatch",["require","exports","module","globals","Constants"],function(e,t,i){var n=e("globals"),r=e("Constants"),a=function(e,t){this._batchConstructor=e,this._batchParams=t,this._batchedRequests={},this._successCB=n.emptyFn,this._failureCB=n.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=n.generateTempId()};return a.prototype={add:function(e,t,i){try{n.PAssert(3435,e,"Must provide a valid request to add to batch")}catch(e){n.reportError(e)}try{n.PAssert(3436,t,"Must supply a valid group ID when adding to a batch")}catch(e){n.reportError(e)}try{n.PAssert(3437,!this._hasRun,"Should never add new requests to a batch that has already run")}catch(e){n.reportError(e)}var r=this._ensureGroup(t);return this._addRequestToGroup(t,i,e),r},then:function(e,t,i){this._successCB=e||n.emptyFn,this._failureCB=t||n.emptyFn,this._context=i,this._run()},execute:function(e){this._successCB=e,this._failureCB=e,this._run()},getBatchID:function(){return this._batchID},_ensureGroup:function(e){var t=!1;return this._batchedRequests[e]||(this._batchedRequests[e]={size:0,batch:this._createBatchInternal()},t=!0),t},_addRequestToGroup:function(e,t,i){var a=this._getGroupBatch(e),s=this._getGroupSize(e);try{n.PAssert(3438,s<=r.MaxBatchSize,"Too many requests for a single batch")}catch(e){n.reportError(e)}t?a.add(i,{id:t}):a.add(i)},_getGroupBatch:function(e){try{n.PAssert(3439,this._batchedRequests[e],"Must ensure before querying")}catch(e){n.reportError(e)}return this._batchedRequests[e].batch},_getGroupSize:function(e){try{n.PAssert(3440,this._batchedRequests[e],"Must ensure before querying")}catch(e){n.reportError(e)}return this._batchedRequests[e].size},_getBatchURL:function(){return this._baseURL},_run:function(){try{n.PAssert(3441,!this._hasRun,"Should never run a batch twice")}catch(e){n.reportError(e)}this._hasRun=!0;for(var e in this._batchedRequests){this._getGroupBatch(e).then(this._handleSuccess.bind(this),this._handleFailure.bind(this))}},_createBatchInternal:function(){return new this._batchConstructor(this._batchParams)},_handleSuccess:function(e){try{n.PAssert(3442,this._hasRun,"Must run batch before success")}catch(e){n.reportError(e)}this._successCB.call(this._context,e)},_handleFailure:function(e){try{n.PAssert(3443,this._hasRun,"Must run batch before failure")}catch(e){n.reportError(e)}this._failureCB.call(this._context,e)}},a}),define("AccountManager",["require","exports","module","globals","Constants","platform","Trigger","goog","goog","goog","goog","goog","goog","goog"],function(e,t,i){function n(){this._isConnecting=!1,this._isConnected=!1,this._linkedAccounts={},this._decodedIDTokens={},this.onAccountsUpdated=new o,this._authCBList={},this._connectedCBList=[],this._signupCBList=[],this._signupUserDataRequested=!1,this._iteratingAuthList=!1,r.isDemoMode()&&setTimeout(function(){var e=[GScope.UserInfoEmail,GScope.Calendar,GScope.GmailCompose,GScope.GmailModify];this.addLinkedAccount("me","Moo.do User","InvalidGID",e,{expires_in:3600,expires_at:Math.floor((Date.now()+r.minutes(60))/1e3),access_token:"InvalidToken",id_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJERU1PIiwibmFtZSI6IkRlbW8gQWNjb3VudCIsImF1ZCI6IjU5Nzg0NzMzNzkzNi5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF6cCI6IjU5Nzg0NzMzNzkzNi5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImVtYWlsIjoibWUiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiaXNzIjoiYWNjb3VudHMuZ29vZ2xlLmNvbSJ9.uHbEA0ZvxneZiXwmiL9nnt3J-HYLXBbjwmpoeFkyHh8",scope:e},PrivateAPIErrorCodes.Success)}.bind(this))}var r=e("globals"),a=e("Constants"),s=e("platform"),o=e("Trigger"),c=r.seconds(30),l=r.seconds(15),d=r.seconds(2);return n.prototype={getInfo:function(){var e={};for(var t in this._linkedAccounts){var i=this._linkedAccounts[t];if(i){var n=void 0;this.isTokenValid(i.token)&&(n={scope:i.token.scope,hasIDToken:!!i.token.id_token}),e[t]={scopes:i.scopes,gid:i.gid,error:i.serverError,validToken:this.isTokenValid(i.token),hasToken:this.hasToken(i.token),token:n}}else e[t]="UNDEFINED ACCOUNT"}return e},getDefaultAccessToken:function(){var e=this.getAccountTokenSync("me");try{r.PAssert(3444,e,"Must verify that a valid token is available before requesting")}catch(e){r.reportError(e)}return e?e.access_token:void 0},getDefaultIDToken:function(){var e=this.getAccountTokenSync("me");try{r.PAssert(3445,e,"Must verify that a valid token is available before requesting")}catch(e){r.reportError(e)}return e?e.id_token:void 0},_areEmailsEqual:function(e,t){return e&&t&&e.toUpperCase()===t.toUpperCase()},getDefaultEmail:function(){var e=this._getDecodedIDToken("me");return e?e.email:"me"},getDefaultGID:function(){var e=this._getDecodedIDToken("me");return e?e.sub:void 0},isDefaultEmail:function(e){return"me"===e||this._areEmailsEqual(e,this.getDefaultEmail())||this._areEmailsEqual(e,r.getActiveUser())},_generateState:function(){return"Dchs"+(new Date).getTime()},requestNoneLink:function(e,t){},requestWebLink:function(e,t,i){try{r.PAssert(3446,e,"Must provide a valid email to link")}catch(e){r.reportError(e)}try{r.PAssert(3447,r.isArray(t),"Must always provide a valid scopes array")}catch(e){r.reportError(e)}try{r.PAssert(3448,t.indexOf(GScope.UserInfoEmail)>=0,"Must request profile scope")}catch(e){r.reportError(e)}try{r.PAssert(3449,!s.app,"Should never use web link in native app")}catch(e){r.reportError(e)}var n=this._generateState(),a=this._createAuthURL(e,t,n);window.open(a,"googleauth","height=600,width=550");var o=function(t){var a=r.getLocationOrigin(),s=!1;try{s=t.data.state===n}catch(e){r.reportError(e)}if(a&&s)return window.removeEventListener("message",o),t.data.code?this._handleGoogleAuthorized(e,t.data,n,i):i()}.bind(this);window.addEventListener("message",o)},requestNativeLink:function(t,i,n){try{r.PAssert(3450,t&&"me"!==t,"Must provide a valid email to link")}catch(e){r.reportError(e)}try{r.PAssert(3451,r.isArray(i),"Must always provide a valid scopes array")}catch(e){r.reportError(e)}try{r.PAssert(3452,i.indexOf(GScope.UserInfoEmail)>=0,"Must request profile scope")}catch(e){r.reportError(e)}var a=this._generateState(),s={scope:i.join(" ")+" profile",immediate:!1,offline:!0,state:a,login_hint:t,redirect_uri:this._getRedirectURL()};e("goog").requestNativeOAuth(s,function(e){return e.code?this._handleGoogleAuthorized(t,e,a,n):n()}.bind(this))},_getRedirectURL:function(){return window.location.protocol+"//"+window.location.host+"/oauthRelay.html"},_createAuthURL:function(t,i,n){try{r.PAssert(3453,r.isArray(i)&&i.length>0,"Must pass in a valid scopes array")}catch(e){r.reportError(e)}var a={scope:i.join(" ")+" profile",state:n,login_hint:t,redirect_uri:this._getRedirectURL(),response_type:"code",access_type:"offline",include_granted_scopes:!0,prompt:"consent",client_id:e("goog").CLIENT_ID},s=[];for(var o in a)s.push(o+"="+encodeURIComponent(a[o]));return"https://accounts.google.com/o/oauth2/v2/auth?"+s.join("&")},unlinkAccount:function(e,t,i){if(!t)return i(!0);var n={email:e,gidLinked:t};r.XHR_PrivateAPI({type:"POST",path:"/user/unlinkAccount",data:n,requireAuth:!0,autoRetry:!0,cb:function(e){return i(e.status===a.HTTPStatusCode.Success?!0:!1)}.bind(this)})},_handleGoogleAuthorized:function(e,t,i,n){var s={email:e,state:i,code:t.code,redir:this._getRedirectURL()};r.XHR_PrivateAPI({type:"POST",path:"/user/linkAccount",data:s,requireAuth:!0,autoRetry:!0,maxRetries:1,cb:function(t){if(t.status===a.HTTPStatusCode.Success&&t.response){var i,s;try{var o=JSON.parse(t.response).data;try{r.PAssert(3454,o.gidLinked,"Must receive a valid GID back from the server")}catch(e){r.reportError(e)}i=o.access_token;try{r.PAssert(3455,i&&i.id_token,"Missing valid ID token from linking account: ",i)}catch(e){r.reportError(e)}s=this.addLinkedAccount(e,o.gidLinked,o.name,i.scope,i,PrivateAPIErrorCodes.Success)}catch(e){r.reportError(e)}return n(i,s)}return n()}.bind(this)})},removeLinkedAccount:function(e,t){var i=this._getLinkedAccount(e);try{r.PAssert(3456,i,"Must always have linked account data when removing")}catch(e){r.reportError(e)}if(!i)return t(!0);this.unlinkAccount(e,i.gid,function(i){return this._deleteLinkedAccount(e),this.onAccountsUpdated.notify(),t(i)}.bind(this))},addLinkedAccount:function(e,t,i,n,a,s){try{r.PAssert(3457,!a||void 0===n||n.indexOf(GScope.UserInfoEmail)>=0,"Must request profile scope")}catch(e){r.reportError(e)}try{r.PAssert(3458,!this._hasLinkedAccount(e)||void 0===this._getLinkedAccount(e).gid||this._getLinkedAccount(e).gid===t,"Google ID should never change")}catch(e){r.reportError(e)}try{r.PAssert(3459,void 0!==s||void 0===t,"Must supply a valid error code if this is a non-temp account")}catch(e){r.reportError(e)}var o=this._getLinkedAccount(e);o&&this._clearRefreshTimeout(o);var c,l={lastRefreshRequested:o?o.lastRefreshRequested:0,refreshTimeout:void 0,refreshScheduleTime:0,isRequestingToken:!1,serverError:s||PrivateAPIErrorCodes.Success,scopes:n||[],gid:t,name:i};if(a){c=this._runDecodeIDToken(a).email}else c=e;delete this._linkedAccounts[e],this._linkedAccounts[c]=l,a&&this.updateAccountToken(e,a),this.onAccountsUpdated.notify();try{if(!r.isDemoMode())for(var d=r.vmMain.pluginManager.getPlugin(PluginID.Gmail),h=d.getSyncAccounts(),u=0;u<h.length;++u)try{r.PAssert(3460,h[u]===c||h[u].toUpperCase()!==c.toUpperCase(),"Gmail sync account does not match linked account casing")}catch(e){r.reportError(e)}}catch(e){r.reportError(e)}return c},updateAccountToken:function(e,t){try{r.PAssert(3461,t,"Must provide a token when updating")}catch(e){r.reportError(e)}try{r.PAssert(3462,this.isTokenValid(t),"Token must be valid to be updated")}catch(e){r.reportError(e)}var i=this._getLinkedAccount(e);if(i){i.token=t,i.serverError=PrivateAPIErrorCodes.Success;var n=1e3*(r.parseInt(t.expires_in)-600);r.isDemoMode()||this._createTokenRefresh(e,i,n),this.notifyUserAuthorized(e,t)}},_clearAccountToken:function(e,t){var i=this._getLinkedAccount(e);i&&(i.token=void 0,i.serverError=t||PrivateAPIErrorCodes.Success,this._clearRefreshTimeout(i),this.onAccountsUpdated.notify())},updateServerLinkedAccount:function(e,t,i,n,r,a){this.addLinkedAccount(e,t,i,n,r,a)},_getLinkedAccount:function(e){var t;for(var i in this._linkedAccounts)if(this._areEmailsEqual(i,e)){t=this._linkedAccounts[i];break}return t},_deleteLinkedAccount:function(e){for(var t in this._linkedAccounts)this._areEmailsEqual(t,e)&&(this._clearRefreshTimeout(this._linkedAccounts[t]),delete this._linkedAccounts[t])},_hasLinkedAccount:function(e){return!!this._getLinkedAccount(e)},getLinkedAccounts:function(){var e=[];for(var t in this._linkedAccounts)e.push(t);return e},_getDecodedIDToken:function(e){var t;return this._decodedIDTokens[e]&&(t=this._decodedIDTokens[e]),t},_decodeIDToken:function(e){var t=this.getAccountTokenSync(e);try{r.PAssert(3463,t,"Must always call this method when user is authorized")}catch(e){r.reportError(e)}try{r.PAssert(3464,!t||t.id_token,"All authorized users must have a valid id token")}catch(e){r.reportError(e)}return this._runDecodeIDToken(t)},_runDecodeIDToken:function(e){var t;if(e&&e.id_token){var i=e.id_token,n=i.split(".");try{r.PAssert(3465,n&&3===n.length&&n[0]&&n[1]&&n[2],"A valid JWT should always have three parts: "+i)}catch(e){r.reportError(e)}try{t=JSON.parse(r.b64_to_utf8(n[1]))}catch(t){r.reportError(t,e.id_token)}}return t},getAccountGID:function(e){var t;if(this.isDefaultEmail(e)&&!r.isDemoMode()){var i=this._getDecodedIDToken(e);t=i&&i.sub?i.sub:r.vmMain.getUserID()}else if(this._hasLinkedAccount(e))t=this._getLinkedAccount(e).gid;else try{r.PAssert(3466,!1,"Unknown account email requested: ",e)}catch(e){r.reportError(e)}return t},getAccountEmail:function(e){var t;for(var i in this._linkedAccounts)if(this._linkedAccounts[i].gid===e){t=i;break}if(!t){var n=this._getDecodedIDToken("me");n&&n.email?n.sub===e&&(t=n.email):e===r.vmMain.getUserID()&&(t="me")}return t},getAccountName:function(e){var t;if(this.isDefaultEmail(e))t=r.vmMain.getUserName();else if(this._hasLinkedAccount(e)){var i=this._getLinkedAccount(e);i.name&&(t=i.name)}else try{r.PAssert(3467,!1,"Unknown account name requested: ",e)}catch(e){r.reportError(e)}return t},getAccountDomain:function(e){var t;if(this.isDefaultEmail(e)){var i=this._getDecodedIDToken(e);t=i&&i.hd?i.hd:r.vmMain.getAccountDomain()}return t},isAccountValidLinked:function(e){var t=!1;return this._hasLinkedAccount(e)&&(t=!!this._getLinkedAccount(e).token),t},isLinkedAccountAuthorized:function(e,t){var i=!1,n=this._getLinkedAccount(e);return n&&n.token&&(!t||n.scopes.indexOf(t)>=0)&&(i=!0),i},isAuthorized:function(t,i){try{r.PAssert(3468,i,"Must provide a valid scope to check authorization for")}catch(e){r.reportError(e)}var n=!1;if(this._hasLinkedAccount(t)||this.isDefaultEmail(t)){var a=this.getAuthorizedScopes(t);a&&a.indexOf(i)>=0&&(n=!0)}else{var s=r.getActiveUser(),o=e("goog").getAuthorizedScopes();t===s&&(!i||o.indexOf(i)>=0)&&(n=!0)}return n},isCurrentlyAuthorized:function(e){try{r.PAssert(3469,e,"Must provide a valid email")}catch(e){r.reportError(e)}var t=!1;return r.isDemoMode()?t=!0:this.hasValidAccessToken(e)&&(t=!0),t},_refreshToken:function(e){var t=this._getLinkedAccount(e);try{r.PAssert(3470,t,"Must have properly linked account before requesting a token")}catch(e){r.reportError(e)}t&&(this._clearRefreshTimeout(t),this._getAccountToken(e,!0,function(i,n){if(i&&!i.error)this.updateAccountToken(e,i);else{try{r.PAssert(3471,void 0!==n,"Missing error code on token failure")}catch(e){r.reportError(e)}if(this._clearAccountToken(e,n),t.serverError===PrivateAPIErrorCodes.Success){try{r.PAssert(3472,!t.refreshTimeout,"Should not have a refresh timeout after failure")}catch(e){r.reportError(e)}this._createTokenRefresh(e,t,c)}}}.bind(this)))},_createTokenRefresh:function(e,t,i){try{r.PAssert(3473,i>0,"Should never schedule an immediate token refresh")}catch(e){r.reportError(e)}if(!t.refreshTimeout){var n=!1,a=Date.now()-t.lastRefreshRequested;t.serverError!==PrivateAPIErrorCodes.TokenMissing?n=!0:a>r.minutes(90)&&(n=!0),n&&(t.refreshTimeout=setTimeout(this._refreshToken.bind(this,e),i),t.lastRefreshRequested=Date.now(),t.refreshScheduleTime=t.lastRefreshRequested+i)}},_clearRefreshTimeout:function(e){clearTimeout(e.refreshTimeout),e.refreshTimeout=void 0,e.refreshScheduleTime=0},_isRefreshTimeoutValid:function(e){var t=!1;return e.refreshTimeout&&e.refreshScheduleTime>=Date.now()&&(t=!0),t},isMissingAccountToken:function(){var e=!1;for(var t in this._linkedAccounts){if(this._linkedAccounts[t].serverError===PrivateAPIErrorCodes.TokenMissing){e=!0;break}}return e},notifyUnauthorizedRequest:function(e){var t=this._getLinkedAccount(e);if(t){if(!this._isRefreshTimeoutValid(t)){var i=Date.now()-t.lastRefreshRequested;i>r.seconds(90)&&(this._clearRefreshTimeout(t),this._createTokenRefresh(e,t,d))}}else this.isConnected()||this.isConnecting()||r.billingManager.checkRemotePremiumStatus()},notifyUnauthorizedAccount:function(e,t,i){log("Unauthorized Request: ",e,t,i),this._invalidateAccountToken(e,function(e,t){e?t?log("Account Token Refreshed for Invalidation"):log("Account Token Invalidated"):log("Account Token Failed Invalidation")})},getAccountToken:function(e,t){return this._getAccountToken(e,!1,t)},_getErrorString:function(e){var t;switch(e){case PrivateAPIErrorCodes.TokenMissing:t="Authorization has been revoked.";break;case PrivateAPIErrorCodes.InvalidToken:t="There is an error with your offline authorization. Please try disabling 'Offline Features' and re-authorizing.";break;case PrivateAPIErrorCodes.DomainPolicy:t="Access denied by a security policy established by the Google Apps administrator of your organization. Please contact your administrator for further assistance.";break;default:try{r.PAssert(3474,!1,"Unknown error code for account authorization: "+e)}catch(e){r.reportError(e)}t="There was an error authorizing your account."}return t},getAccountError:function(e){var t,i=this._getLinkedAccount(e);return i?i.serverError!==PrivateAPIErrorCodes.Success&&(t=this._getErrorString(i.serverError)):t="There was an error authorizing your account.",t},_invalidateAccountToken:function(e,t,i){var n=this.getAccountGID(e);if(n&&this._getLinkedAccount(e)){var s={gid:n};this._clearAccountToken(e,PrivateAPIErrorCodes.InvalidToken),this.onUserAuthorized("me",function(){r.XHR_PrivateAPI({type:"POST",path:"/user/invalidateAccountToken",data:s,requireAuth:!0,autoRetry:!0,cb:function(i){if(i.status!==a.HTTPStatusCode.Success||!i.response)return t(!1,!1);try{var n=JSON.parse(i.response);if(n.success&&n.data){var s=n.data;return s&&!s.error?(this.updateAccountToken(e,s),t(!0,!0)):t(!0,!1)}return t(!0,!1)}catch(e){return r.reportError(e),t(!0,!1)}}.bind(this)})}.bind(this))}else{if(i)return t(!1,!1);r.billingManager.onBillingIdentifierAvailable(function(){this._invalidateAccountToken(e,t,!0)}.bind(this))}},_getAccountToken:function(e,t,i){var n=this._getLinkedAccount(e);try{r.PAssert(3475,n,"Must have properly linked account before requesting a token")}catch(e){r.reportError(e)}if(!n)return setTimeout(i,0);if(!t&&this.isTokenValid(n.token))return setTimeout(i,0,n.token,PrivateAPIErrorCodes.Success);var s=this._generateState(),o={gid:n.gid,state:s};try{r.PAssert(3477,n.gid,"Must have a valid GID for account")}catch(e){r.reportError(e)}n.isRequestingToken=!0,this.onUserAuthorized("me",function(){r.XHR_PrivateAPI({type:"POST",path:"/user/getAccountToken",data:o,requireAuth:!0,autoRetry:!0,cb:function(s){if(n.isRequestingToken=!1,s.response){var o;try{o=JSON.parse(s.response)}catch(e){r.reportError(e)}return s.status===a.HTTPStatusCode.Success?o&&o.success?i(o.data,PrivateAPIErrorCodes.Success):(this._clearAccountToken(e,PrivateAPIErrorCodes.TokenMissing),i(void 0,PrivateAPIErrorCodes.TokenMissing)):(this._clearAccountToken(e,o.code),i(void 0,o.code))}if(s.status===a.HTTPStatusCode.Success)return this._clearAccountToken(e,PrivateAPIErrorCodes.TokenMissing),i(void 0,PrivateAPIErrorCodes.TokenMissing);setTimeout(this._getAccountToken.bind(this),l,e,t,i)}.bind(this)})}.bind(this))},_getAccountTokenRaw:function(e){var t;if(e&&this.isAccountValidLinked(e)){var i=this._getLinkedAccount(e);i&&(t=i.token)}else this.isJSAuthLibLoaded()&&this.isDefaultEmail(e)&&(t=this.getJSAuthLibToken());return t},getAccountTokenSync:function(e){try{r.PAssert(3479,e,"Must provide a valid email to retreive the token for")}catch(e){r.reportError(e)}if(this.isDefaultEmail(e)){var t=this._getAccountTokenRaw(e);try{r.PAssert(3480,this.isTokenValid(t)||r.isDemoMode(),"Must ensure token is valid before requesting sync")}catch(e){r.reportError(e)}return t}var i=this._getLinkedAccount(e);try{r.PAssert(3481,i,"Must have properly linked account before getting a token")}catch(e){r.reportError(e)}try{r.PAssert(3482,this.isTokenValid(i.token)||r.isDemoMode(),"Must ensure token is valid before requesting sync")}catch(e){r.reportError(e)}return i.token},getAccessTokenSync:function(e){var t=this.getAccountTokenSync(e);return t?t.access_token:void 0},getAuthorizedScopes:function(t){var i;if(this.isAccountValidLinked(t))i=this._getLinkedAccount(t).scopes;else if(this.isDefaultEmail(t))try{if(this.isJSAuthLibLoaded()){var n=this.getJSAuthLibToken();if(n){i=n.scope;try{r.PAssert(3483,r.isArray(i),"Must always be a valid scopes array on auth token")}catch(e){r.reportError(e)}}else i=r.getActiveUser()===t?e("goog").getAuthorizedScopes().slice(0):[]}else i=r.getActiveUser()===t?e("goog").getAuthorizedScopes().slice(0):[]}catch(e){r.reportError(e),i=[]}else{try{r.PAssert(3484,this._hasLinkedAccount(t),"Unknown account email requested: ",t)}catch(e){r.reportError(e)}i=[]}return i},onConnected:function(e){this._isConnected?setTimeout(e,0):this._connectedCBList.push(e)},setConnected:function(){try{r.PAssert(3485,!this._isConnected,"Should not already be connected")}catch(e){r.reportError(e)}if(!this._isConnected){this._isConnected=!0;for(var e=0;e<this._connectedCBList.length;++e){var t=this._connectedCBList[e];try{t()}catch(e){r.reportError(e)}}}},isConnected:function(){return this._isConnected},setConnecting:function(){try{r.PAssert(3486,!this._isConnecting,"Should not already be connecting")}catch(e){r.reportError(e)}try{r.PAssert(3487,!this._isConnected,"Should not already be connected")}catch(e){r.reportError(e)}this._isConnecting||(this._isConnecting=!0)},setNotConnecting:function(){try{
r.PAssert(3488,this._isConnecting,"Must already be connecting to cancel")}catch(e){r.reportError(e)}try{r.PAssert(3489,!this._isConnected,"Should not already be connected if canceling")}catch(e){r.reportError(e)}this._isConnecting&&(this._isConnecting=!1)},isConnecting:function(){return this._isConnecting},notifyUserAuthorized:function(e,t){try{r.PAssert(3490,r.isString(e),"Must provide a valid email addr for authorization")}catch(e){r.reportError(e)}try{r.PAssert(3491,r.isObject(t),"Must provide a valid auth token")}catch(e){r.reportError(e)}var i=this._runDecodeIDToken(t);if(i&&i.email){try{r.PAssert(3492,this._areEmailsEqual(i.email,e)||"me"===e,"Emails must match id_token")}catch(e){r.reportError(e)}this._decodedIDTokens[i.email]=i,this.isDefaultEmail(e)&&(this._decodedIDTokens.me=i)}this._iteratingAuthList=!0;for(var n=this._authCBList[e],a=0;n&&a<n.length;++a)try{n[a]()}catch(e){r.reportError(e)}this._authCBList[e]=[],this._iteratingAuthList=!1;try{r.PAssert(3493,r.isDemoMode()||r.vmMain&&r.vmMain.pluginManager,"Must have initialized plugin manager before users are authorized")}catch(e){r.reportError(e)}r.vmMain&&r.vmMain.pluginManager&&(r.vmMain.pluginManager.notifyAuthorizationAdded(e),this.isDefaultEmail(e)&&r.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.GoogleLogin,t.scope))},onUserAuthorized:function(e,t,i){try{r.PAssert(3494,!this._iteratingAuthList,"Should not queue additional authorizations while iterating")}catch(e){r.reportError(e)}this.isCurrentlyAuthorized(e)?setTimeout(t,0):(this._authCBList[e]||(this._authCBList[e]=[]),this._authCBList[e].push(t),i&&setTimeout(function(){this._authCBList[e].remove(t)>=0&&t()}.bind(this),i))},notifyRemoteAccountsLinked:function(){r.vmMain.pluginManager.verifyAuthorization(this.getDefaultEmail())},verifyLinkedTokenScopes:function(e,t){var i=[];if(t)if(this._hasLinkedAccount(e)){var n=this._getLinkedAccount(e);if(n.token&&n.token.scope)for(var r=0;r<t.length;++r)n.token.scope.indexOf(t[r])<0&&i.push(t[r]);else i=t.slice(0)}else if(this.isConnected()&&this.isDefaultEmail(e)&&this.isJSAuthLibLoaded()){var a=this.getJSAuthLibToken();if(a&&a.scope)for(var r=0;r<t.length;++r)a.scope.indexOf(t[r])<0&&i.push(t[r]);else i.pushArray(t)}return i},isTokenValid:function(e){try{r.PAssert(3495,!e||!r.isString(e),"Must supply a valid token object to check if valid")}catch(e){r.reportError(e)}var t=!1;if(e&&e.expires_at){var i=1e3*r.parseInt(e.expires_at),n=Date.now()+r.minutes(5);try{var a=new Date(i),s=(new Date).addHours(5);try{r.PAssert(3496,a.isBefore(s),"Token lease must be under five hours: ",e.expires_at)}catch(e){r.reportError(e)}}catch(e){r.reportError(e)}i>n&&(t=!0)}return t},hasToken:function(e){return!!e},hasValidAccessToken:function(e){var t=!1;try{r.PAssert(3497,r.isString(e),"Must supply a valid email to check access token")}catch(e){r.reportError(e)}var i=this._getAccountTokenRaw(e);return i&&this.isTokenValid(i)&&(t=!0),t},getSignupUserData:function(e){this._signupCBList.push(e),this._signupUserDataRequested||(this._signupUserDataRequested=!0,r.XHR({type:"GET",url:"https://www.googleapis.com/oauth2/v2/userinfo?alt=json&access_token="+this.getDefaultAccessToken(),autoRetry:!0,cb:function(e){if(this._signupUserDataRequested=!1,200===e.status){var t={};try{t=JSON.parse(e.responseText)}catch(t){r.reportError(new Error("Error parsing user info"),e.responseText)}for(var i=0;i<this._signupCBList.length;++i)this._signupCBList[i](t);this._signupCBList=[]}}.bind(this)}))},getJSAuthLibToken:function(){var e;return this.isJSAuthLibLoaded()&&(e=window.gapi.auth.getToken()),e},isJSAuthLibLoaded:function(){return!!(window.gapi&&window.gapi.auth&&window.gapi.auth.authorize)},canRunAuthenticate:function(){return this.isJSAuthLibLoaded()||s.isFeatureEnabled(a.Feature.OAuth)}},new n}),define("apis",["require","exports","module","globals","MBatch","AccountManager"],function(e,t,i){var n=e("globals"),r=e("MBatch"),a=e("AccountManager"),s=function(){};return s.prototype={fns:function(e){return this._data.gapi.client[e]},generatePackedFns:function(e){var t=this._data.gapi.client[e],i=["gapi","client",e];this._iterateAPI(t,i)},_iterateAPI:function(e,t){if(n.isString(e.path))e.packedFn||(log("WARNING: Missing Pre-Packed Fn: [ '"+t.join("', '")+"' ]"),e.packedFn=t.slice(0));else for(var i in e)n.isObject(e[i])&&(t.push(i),this._iterateAPI(e[i],t),t.pop())},_constructPath:function(e,t){var i=n.clone(t);for(var r in t){var a=new RegExp("\\{"+r+"\\}"),s=e.replace(a,encodeURIComponent(t[r]));s!==e&&delete i[r],e=s}return delete i.resource,delete i.timeoutMS,delete i.forceNoDupe,{path:e,fields:i}},_constructHeaders:function(e,t){var i={Authorization:"Bearer "+a.getAccountTokenSync(t).access_token};for(var n in e)i[n]=e[n];return i},canConstruct:function(e){var t=!1;return n.isFunction(e)||(t=!!n.unpackFn(e,this._data)),t},createBatch:function(e){return new r(gapi.client.newBatch,e)},createRequest:function(e,t,i){var r,a=n.unpackFn(t,this._data);if(a){var s=this._constructPath(a.path,i),o=this._constructHeaders(a.headers,e),c={path:s.path,method:a.method||"GET",params:s.fields,body:i.resource,headers:o};n.isDemoMode()&&(c.__packedFn=t,c.__rawParams=i),r=gapi.client.request(c)}else{var l=n.unpackFn(t);l&&(r=l(i))}return r},getAPIForRequest:function(e){try{n.PAssert(3498,n.isDemoMode(),"Must only reverse the path in demo mode")}catch(e){n.reportError(e)}return n.unpackFn(e.__packedFn)},_data:{gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}},new s}),define("goog",["data","globals","util","Constants","apis","gdata","platform","RingBuffer","Dispatcher","Observable","AccountManager"],function(e,t,i,n,r,a,s,o,c,l,d){function h(e){if(e){var i=e.error;i.code===n.HTTPStatusCode.Forbidden?t.toasts.pushMessage({text:"Google Drive Error: "+i.message+".",action:MessageAction.OpenURL,actionText:"LEARN MORE",data:{url:"https://support.google.com/drive/answer/2500820"}}):t.toasts.pushMessage({text:i.message+". Please reload to try again.",action:MessageAction.Reload}),t.reportError(new Error("Failed to find default doc: "+e.error.code),e)}else t.toasts.pushMessage({text:"There was an internal error in Google Drive. Please reload to try again.",action:MessageAction.Reload});t.vmMain.setGDriveStatus(DriveStatus.Offline)}function u(){function e(){var e=t.vmMain.docManager;e.loadDocList(function(i,n){if(i){var r=e.getAutoDefaultDoc();r?q.onDefaultRealtimeFileOpened(r.getData(),!1):e.hasTrashedDocuments()?t.vmMain.showTrashedDocumentError():q.createDefaultRealtimeFile()}else h(n)})}t.vmMain.setGDriveStatus(DriveStatus.Connecting);var i={getAllPages:!0,maxResults:1},n="(title='"+q.LEGACY_DefaultDriveDocTitle+"' or properties has {key='"+q.DefaultProperty+"' and value='"+q.DefaultPropertyValue+"' and visibility='PRIVATE'}) and 'me' in owners and trashed=false",r=function(i){0===i.length?t.vmMain&&t.vmMain.docManager?e():c.listen("VMMainLoaded",e):q.onDefaultRealtimeFileOpened(i[0],!1)},a=function(e){h(e)};t.vmMain.remoteAPI().driveFilesList(n,r,a,i)}function p(e){try{t.PAssert(3510,!t.isDemoMode(),"Should not be creating file structure in demo mode")}catch(e){t.reportError(e)}try{t.PAssert(3511,void 0===ne,"Must not already have a root folder")}catch(e){t.reportError(e)}try{t.PAssert(3512,e,"Must supply a valid callback when done creating the default file structure")}catch(e){t.reportError(e)}var i=r.fns("drive").files.insert.packedFn,n={resource:{mimeType:q.FOLDER_MIMETYPE,title:q.DefaultFolderTitle,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:q.DefaultRootFolderProperty,value:q.DefaultRootFolderPropertyValue,visibility:"PRIVATE"}]}},a=function(t){return e(t.id)},s=function(t){return e()};t.vmMain.remoteAPI().runRemoteSingleRequest(i,n,a,s)}function m(e){try{t.PAssert(3513,!t.isDemoMode(),"Should not be creating attach folder in demo mode")}catch(e){t.reportError(e)}try{t.PAssert(3514,ne,"Must have already created and found the root folder")}catch(e){t.reportError(e)}try{t.PAssert(3515,void 0===re,"Must not already have an attach folder")}catch(e){t.reportError(e)}try{t.PAssert(3516,e,"Must supply a valid callback when done creating the attachment file structure")}catch(e){t.reportError(e)}var i=r.fns("drive").files.insert.packedFn,n={resource:{mimeType:q.FOLDER_MIMETYPE,title:q.DefaultAttachTitle,writersCanShare:!1,folderColorRgb:"#FF7537",parents:[{id:ne}],properties:[{key:q.DefaultAttachFolderProperty,value:q.DefaultAttachFolderPropertyValue,visibility:"PRIVATE"}]}},a=function(t){return e(t.id)},s=function(t){return e()};t.vmMain.remoteAPI().runRemoteSingleRequest(i,n,a,s)}function f(e){log("First Run Drive Document"),g(e),a.onFirstInitialized(e),d.getSignupUserData(function(e){t.reportSignup(e.email,e)})}function g(e){log("Drive Document Initialized"),a.onInitialized(e),d.onUserAuthorized("me",function(){t.sendEvent("Documents","CreateNew")})}function v(e){if(ShouldLog(LogLevels.Timing)&&log("Drive document load started: ",log.now()),t.checkpoint(Checkpoint.DocLoaded),t.vmMain.setGDriveStatus(DriveStatus.Saved),a.onLoad(e)){if(ShouldLog(LogLevels.Timing)&&log("Drive document load done: ",log.now()),q.startWatchdog(),!e.getModel().getRoot().get("docFolderID")){var i=t.vmMain.docManager.getOpenDoc();try{t.PAssert(3528,i,"Must have an open doc to load a realtime doc")}catch(e){t.reportError(e)}i.getDocumentFolder(function(t){e.getModel().getRoot().set("docFolderID",t)})}e.getModel().getRoot().get("attachFolderID")||q.getAttachFolder(function(t){e.getModel().getRoot().set("attachFolderID",t)}),e.getModel().bytesUsed>=z*G?t.menus.alert({text:"Your document is nearing our maximum size. Consider starting a new document.",actionText:"OKAY"}):e.getModel().bytesUsed>=z*j&&t.menus.alert({text:"Your document has reached our maximum allowed size. You must create a new document to continue editing.",actionText:"OKAY"}),q.isLoaded=!0,t.vmMain.notifySuccessfulLoad(),t.fireCustomEvent("docLoaded")}}function y(n){switch(ShouldLog(LogLevels.Error)&&log("Doc Load Error - ",JSON.stringify(n)),n.type){case gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED:try{t.PAssert(3529,!n.isFatal,"Token refresh required causes a non-fatal error")}catch(e){t.reportError(e)}q.recoverFromError();break;case gapi.drive.realtime.ErrorType.INVALID_COMPOUND_OPERATION:try{t.PAssert(3530,n.isFatal,"Invalid compound operation causes a fatal error")}catch(e){t.reportError(e)}ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+n.type+"] Fatal: "+n.isFatal),t.reportError(new Error("Invalid Compound Operation: "+t.safeStringify(n)));break;case gapi.drive.realtime.ErrorType.CONCURRENT_CREATION:case gapi.drive.realtime.ErrorType.CLIENT_ERROR:ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+n.type+"] Fatal: "+n.isFatal),t.reportError(new Error("Client Error: "+t.safeStringify(n))),q.clearDocInfo(),S();break;case gapi.drive.realtime.ErrorType.FORBIDDEN:ShouldLog(LogLevels.Error)&&log("Unable to access or find the requested document");var r=t.decodeURLObject(i.getURLParam("sinfo"));r&&r.fromUser?t.menus.alert({text:"Moo.do is not able to access the document you requested. Please contact "+r.fromUser+" to make sure you have permission to view the document.",actionText:"RELOAD",callback:e.clearDataAndReload}):t.menus.alert({text:"Moo.do has lost access to your document. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",callback:e.clearDataAndReload}),t.reportError(new Error("DocError Forbidden"),r),t.vmMain.notifyFailedLoad();break;case gapi.drive.realtime.ErrorType.NOT_FOUND:ShouldLog(LogLevels.Error)&&log("Unable to access or find the requested document");var r=t.decodeURLObject(i.getURLParam("sinfo"));r&&r.fromUser?t.menus.alert({text:"Moo.do cannot find your document. Please contact "+r.fromUser+" to ensure the document still exists.",actionText:"RELOAD",callback:e.clearDataAndReload}):t.menus.alert({text:"Moo.do cannot find your document. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",callback:e.clearDataAndReload}),t.reportError(new Error("DocError NotFound"),r),t.vmMain.notifyFailedLoad();break;case gapi.drive.realtime.ErrorType.SERVER_ERROR:ShouldLog(LogLevels.Error)&&log("Received server error: "+t.safeStringify(n)),n.isFatal&&(t.reportError(new Error("Fatal Server Error"),n),t.vmMain.setGDriveStatus(DriveStatus.Offline));break;case"fatal_network_error":ShouldLog(LogLevels.Error)&&log("Fatal network error: "+t.safeStringify(n)),n.isFatal&&t.vmMain.setGDriveStatus(DriveStatus.Offline);break;default:ShouldLog(LogLevels.Error)&&log("Unkown Doc Error - "+t.safeStringify(n)),t.reportError(new Error("Unknown Doc Error: "+t.safeStringify(n)))}return n.isFatal}function b(e,i,n){if(e){ShouldLog(LogLevels.Timing)&&log("Drive document requested: ",log.now());t.vmMain.docManager.loadDocFromData({id:e,title:i},!1).open(),q.setDocInfo(e,i);try{var r=n?f:g;a.driveRealtimeLoad(e,v,r,y);try{window.__LOAD_REQUESTS.push(t.getCurrentStack("Normal Load ["+n+"]"))}catch(e){t.reportError(e)}}catch(e){q.recoverFromError(e)}}else S()}function S(){u()}function E(e,t){function i(n){e[n].then(function(r){e.length>n+1?setTimeout(function(){i(n+1)},oe):t(!0)},function(){t(!1)})}if(0===e.length)return t(!0);i(0)}function C(e,i){var n={getAllPages:!0,maxPageResults:500},a=function(n){try{if(n.length>0){for(var a=r.createBatch(),s=0;s<n.length;++s){var o=r.createRequest("me",r.fns("drive").children.delete.packedFn,{folderId:e,childId:n[s].id});a.add(o,"default",n[s].id)}i(a)}else i(void 0)}catch(e){t.reportError(e),i(void 0)}},s=function(e,t){i(void 0)};t.vmMain.remoteAPI().driveChildrenList(e,a,s,n)}function P(){for(var e=[],i=0;i<J.length;++i){var n=q.scopes.indexOf(J[i]),r=K.indexOf(J[i])>=0;n>=0&&!r&&e.push(n)}var a=JSON.stringify(e);t.settings.set(Settings.authScopes,a)}function T(e){e>0&&t.vmMain.updateAllItems(!1,!0)}function D(){return""+Math.floor((Date.now()-t.minutes(1))/1e3)}function M(e,i){return""+Math.floor(t.parseInt(i)+1e3*t.parseInt(e)/1e3)}function _(e){try{t.PAssert(3542,d.isJSAuthLibLoaded(),"Auth lib must be loaded to set token")}catch(e){t.reportError(e)}try{t.PAssert(3543,e.id_token,"Token must provide a valid id_token value",e)}catch(e){t.reportError(e)}try{t.PAssert(3544,e.access_token,"Token must provide a valid access_token value",e)}catch(e){t.reportError(e)}try{t.PAssert(3545,e.expires_in||e.expires_at,"Token must provide a valid expires_in value",e)}catch(e){t.reportError(e)}e.issued_at||(e.issued_at=D()),e.expires_in?e.expires_at||(e.expires_at=M()):e.expires_in=parseInt(e.expires_at)-parseInt(e.issued_at),window.gapi.auth.setToken(e)}function I(){try{t.PAssert(3546,void 0!==ce,"Should always have a valid token value")}catch(e){t.reportError(e)}t.isString(ce.scope)&&(ce.scope=ce.scope.split(" ")),_(ce)}function A(){ue=!0,t.settings.set(Settings.oauthScheme,fe)}function w(){for(var e=OAuthSchemeType.Count;e>=0;e--)if(pe[e])return e}function k(e,t){return t>e}function x(e){return function(t,i){e(t,function(e){e&&!e.error&&A(),i(e)})}}function R(){try{t.PAssert(3555,!ue,"Should not be setting up OAuth if locked into the current scheme")}catch(e){t.reportError(e)}if(!ue){var e=w();if(k(fe,e))switch(fe=e,e){case OAuthSchemeType.None:me={authorize:x(q.requestNoneOAuth),link:d.requestNoneLink.bind(d)};break;case OAuthSchemeType.Web:try{t.PAssert(3556,d.isJSAuthLibLoaded(),"GAPI Auth should always be valid at this point")}catch(e){t.reportError(e)}me={authorize:x(window.gapi.auth.authorize),link:d.requestWebLink.bind(d)};break;case OAuthSchemeType.Native:try{t.PAssert(3557,s.app,"Native auth should be used in a native app")}catch(e){t.reportError(e)}me={authorize:x(q.requestNativeOAuth),link:d.requestNativeLink.bind(d)};break;default:try{t.PAssert(3558,!1,"Invalid OAuth scheme type")}catch(e){t.reportError(e)}}}}function O(e){return parseInt(e.id.split("_")[1])}function L(e,i,n){if(e&&!e.error){try{t.PAssert(3561,e.scope,"Scopes must be valid")}catch(e){t.reportError(e)}q.numTokenRequestSuccess++,t.isString(e.scope)&&(e.scope=e.scope.split(" "));var r=J,s=t.arrayUniques(e.scope);i&&s.pushOnlyUniques(r),J=s,r.equals(s)||P();var o=1e3*(parseInt(e.expires_in)-600);te=Date.now()+o,clearTimeout(ee),ee=setTimeout(U,o),ae=W,a.poke();var l=function(){t.vmMain.realtimeDocManager.notifyGoogleAuthorization(J),d.notifyUserAuthorized("me",e)};t.vmMain?l():c.listen("VMMainLoaded",function(){l()}),setTimeout(function(){for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;++t)if(e[t].src.startsWith("https://accounts.google.com/o/oauth2/auth?"))if(""===e[t].id)e[t].id="auth_"+ge++;else{var i=O(e[t]);i!==ge&&i!==ge-1&&e[t].parentElement.removeChild(e[t])}},0)}else log("Error authorizing token: "+(e?e.error:"UNDEFINED")),q.numTokenRequestFailed++;n&&n(e)}function N(e,i){for(var n=[],r=0;r<e.length;++r){var a=e[r],s=q.scopes.indexOf(a)>=0||!i&&a===GScope.TasksRO;try{t.PAssert(3562,s||X.indexOf(a)>=0,"Unknown scope requested: ",a)}catch(e){t.reportError(e)}Y.indexOf(a)<0&&s&&(!Q[a]||e.indexOf(Q[a])<0)&&n.push(a)}return n}function F(){var e=q.getAuthorizedScopes().slice(0);return t.vmMain.pluginManager.runForEachPlugin(function(t){if(t.isEnabled()){var i=t.googleScopes();i&&e.pushArray(i)}}),t.settings.get(Settings.syncContacts)&&e.push(GScope.Contacts),N(e,!1)}function B(e,i){var n=!0;i&&!i.endsWith("@gmail.com")&&e.length>7&&(n=!1),n||(e.remove(GScope.DriveInstall),e.length>7&&(e.remove(GScope.Contacts),e.length>7&&t.reportError(new Error("Unfixable too many scoops! "+e))))}function U(e){try{t.PAssert(3563,me&&me.authorize,"Must have locked in a valid auth scheme to refresh")}catch(e){t.reportError(e)}if(!me||!me.authorize)return e(void 0),!1;try{t.PAssert(3565,J.length>=q.requiredScopes.length,"We lost some required scopes somewhere...")}catch(e){t.reportError(e)}ie=!0;var i=d.getJSAuthLibToken();if(i){var n=1e3*t.parseInt(i.expires_in),r=Math.min(Date.now()-1e3*t.parseInt(i.issued_at),n);q.totalTokenLifetime+=r}var a=t.vmMain.getUserEmail(),s=N(J,!0);B(s,a);var o={client_id:q.CLIENT_ID,scope:s.join(" "),immediate:!0,include_granted_scopes:!0,login_hint:a,response_type:"token id_token",authuser:-1};return q.numTokensRequested++,me.authorize(o,function(t){ve=!0,ie=!1,L(t,!1,e)}),!0}function H(){if(q.numScriptLoads++,clearTimeout(Se),Se=void 0,q.isGoogleClientAPILoaded())q.isRealtimeAPILoaded()?be=!1:(be=!1,GoogleClientAPILoaded());else{var e=document.getElementById("gapiScript");e&&e.parentNode.removeChild(e),t.addScript("https://apis.google.com/js/api.js?onload=GoogleClientAPILoaded","gapiScript",function(){log("GAPI Reload Success"),be=!1},function(){log("GAPI Reload Failed"),be=!1}),ye-- >0?Se=setTimeout(H,t.seconds(20)):be=!1}}function V(e){q.numTokenRefreshes++,clearTimeout(Ee),Ee=void 0,ve?(a.poke(),setTimeout(function(){(!a.doc||a.doc.saveDelay>=t.seconds(30)&&a.doc.saveDelay<=t.seconds(50))&&U()},t.seconds(40)),t.toasts.clearMessage(MessageID.ConnectionError),e&&e()):(U(),Ee=setTimeout(function(){V(e)},t.seconds(10)))}var q={CLIENT_ID:"597847337936.apps.googleusercontent.com",eventSubscribers:[]};t.goog=q;var W=1e4,z=10485760,G=.85,j=.95;q.APP_ID="597847337936",q.REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk",q.FOLDER_MIMETYPE="application/vnd.google-apps.folder",q.MoodoMimetype=q.REALTIME_MIMETYPE+"."+q.APP_ID,window.GScope={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",DriveFull:"https://www.googleapis.com/auth/drive",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveInstall:"https://www.googleapis.com/auth/drive.install",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",GmailRO:"https://www.googleapis.com/auth/gmail.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify"};var K=[GScope.TasksRO],Y=[GScope.UserInfoProfile,GScope.GmailRO],X=["https://www.googleapis.com/auth/plus.me","https://www.googleapis.com/auth/contacts",GScope.TasksRO,"email","openid","profile"],Q={};!function(){Q[GScope.CalendarRO]=GScope.Calendar,Q[GScope.Drive]=GScope.DriveFull,Q[GScope.DriveMetadataRO]=GScope.DriveFull}(),q.LEGACY_DefaultDriveDocTitle="DuchessBeta",q.DefaultDocTitle="My Tasks",q.DefaultFolderTitle="_Moo.do Files (Do not delete)",q.DefaultAttachTitle="Shared Attachments",q.DefaultProperty="MooDoDefault",q.DefaultPropertyValue="TRUE",q.DefaultRootFolderProperty="MooDoDefaultRoot",q.DefaultRootFolderPropertyValue="TRUE",q.DefaultAttachFolderProperty="MooDoDefaultAttach",q.DefaultAttachFolderPropertyValue="TRUE",q.DocFolderTitlePrefix="Moodo_",q.DocFolderProperty="MooDoFolder",q.DocFolderPropertyPrefix="MDSF_",q.DocFolderTitleProperty="MooDoTitle",q.requiredScopes=[GScope.Drive,GScope.UserInfoEmail,GScope.DriveInstall,GScope.DriveAppData],q.requestScopes=[],q.scopes=[GScope.Calendar,GScope.CalendarRO,GScope.Contacts,GScope.Drive,GScope.UserInfoEmail,GScope.DriveFull,GScope.UserInfoProfile,GScope.DriveInstall,GScope.DriveAppData,GScope.DriveMetadataRO,GScope.GmailRO,GScope.GmailModify,GScope.GmailCompose];var J=[];q.getAuthorizedScopes=function(){return J};q.isLoaded=!1,q.init=function(){d.isJSAuthLibLoaded()?q.addOAuthMethod(OAuthSchemeType.Web):window.addEventListener("gapiLoaded",function(){q.addOAuthMethod(OAuthSchemeType.Web)});var e=t.settings.get(Settings.oauthScheme);if(void 0!==e&&e!=OAuthSchemeType.Web)try{var n=t.parseInt(e);q.addOAuthMethod(n)}catch(e){t.reportError(e)}R();var r=t.settings.get(Settings.authScopes);if(r){var a;try{a=JSON.parse(r)}catch(e){t.reportError(e)}if(a){for(var o=0;o<a.length;++o){try{t.PAssert(3501,a[o]>=0,"Each saved scope should be a valid array index")}catch(e){t.reportError(e)}a[o]>=0&&q.requestScopes.push(q.scopes[a[o]])}q.requestScopes=t.arrayUniques(q.requestScopes)}}else q.requestScopes=q.requiredScopes;J=q.requestScopes,s.syncContacts&&i.getURLParam("access_token")&&!i.hasURLParam("error")&&(J.indexOf(GScope.Contacts)<0&&(J.push(GScope.Contacts),P()),t.settings.set(Settings.syncContacts,!0)),t.settings.registerForChangeNotification(Settings.syncContacts,void 0,function(e,i){i&&q.authAndLoadContacts(!1,function(e){t.settings.set(Settings.syncContacts,e)})}),d.onUserAuthorized("me",function(){window.ga&&ga("set","&uid",t.getAnonUserIdentifier())})},q.ensureRequiredScopesAreRequested=function(){for(var e=!1,i=0;i<q.requiredScopes.length;++i)if(J.indexOf(q.requiredScopes[i])<0){e=!0;break}e&&q.runAuthenticate(q.requiredScopes,!0,!1,function(e){!e||e.error?t.toasts.pushMessage({text:"We need additional permissions to give you the best experience.",actionText:"AUTHORIZE",action:function(){q.runAuthenticate(q.requiredScopes,!1,!1,function(e){e&&!e.error||t.toasts.pushMessage({text:"There was an error authenticating. Please try again.",actionText:"AUTHORIZE",action:q.ensureRequiredScopesAreRequested})})}}):P()})};var $;q.startWatchdog=function(){$||($=setInterval(q.watchdogFn,96e4))},q.stopWatchdog=function(){clearInterval($),$=void 0};var Z=0;q.watchdogFn=function(){var e=Date.now();if(Z-e>=96e4){try{var i=d.getJSAuthLibToken();if(i){var n=1e3*parseInt(i.expires_at);e>n?(ShouldLog(LogLevels.Error)&&log("Active token is no longer valid: "+e+" vs. "+n),U(),t.reportError(new Error("Watchdog found expired token on client"))):a.poke()}else ShouldLog(LogLevels.Error)&&log("No active token on client!"),U(),t.reportError(new Error("Watchdog found client with no token set"))}catch(e){t.reportError(e)}finally{Z=e}t.checkForRemoteChanges()}},q.hasPermission=function(e){return J.indexOf(e)>-1};var ee,te,ie=!0;q.onFocusHandler=function(){te&&Date.now()>te&&!ie&&U()},q.onBlurHandler=function(){ee&&clearTimeout(ee)},q.getContactInfo=function(i,n){function r(e){if(e)try{t.settings.set(Settings.lastContactSync,new Date(e.feed.updated.$t))}catch(e){t.reportError(e)}n(e)}var a=d.getAccessTokenSync(i);if(!a)return void n(void 0);var s="https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json",o=t.settings.get(Settings.lastContactSync),c=e.areLocalContactsLoaded()&&0===e.contactManager.numContacts();if(o&&!c){s+="&updated-min="+new Date(o).toString("yyyy-MM-ddTHH:mm:ss")}s+="&max-results=10000",s+="&access_token="+a,t.JSONP({url:s,cb:r})},q.loadedContacts=!1,q.loadContacts=function(i){if(q.loadedContacts)return void i(0);q.loadedContacts=!0,e.loadLocalContacts();var n=e.contactManager.numContacts(),r=t.vmMain.getUserEmail();d.onUserAuthorized(r,function(){q.getContactInfo(r,function(t){if(!t)return void i(-1);log("Loading Remote Contacts!",parseInt(t.feed.openSearch$totalResults.$t));var r=0;if(t&&t.feed&&t.feed.entry&&t.feed.entry.length){r=t.feed.entry.length;for(var a=t.feed.entry,s=0;s<a.length;s++){var o=a[s],c={id:/\/([^\s\/]+$)/gi.exec(o.id.$t)[1],text:""};if(o.gd$name&&o.gd$name.gd$fullName){var l=o.gd$name.gd$fullName.$t;c.text=l,"'"===c.text[0]&&(c.text=c.text.substr(1))}if(o.gd$email){for(var d=o.gd$email,h=0;h<d.length;h++)delete d[h].rel,!c.text&&d[h].primary&&(c.text=d[h].address);!c.text&&d.length>0&&(c.text=d[0].address),c.emails=d}if(o.gd$phoneNumber){var u=o.gd$phoneNumber;c.phoneNumbers=[];for(var h=0;h<u.length;h++){var p={number:u[h].$t};u[h].rel?p.type=u[h].rel.replace("http://schemas.google.com/g/2005#",""):p.type=u[h].label,c.phoneNumbers.push(p)}}c.text&&(0===n?e.contactManager.addContact(c):e.contactManager.updateContact(c))}}r>0&&e.saveContacts(),i&&i(r)})})},q.setDocInfo=function(e,i){t.settings.set(Settings.gdocId,e),t.settings.set(Settings.gdocTitle,i)},q.getDocId=function(){return t.vmMain.docManager.getOpenDoc().id},q.clearDocInfo=function(){t.settings.reset(Settings.gdocId),t.settings.reset(Settings.gdocTitle)};var ne,re;q.getAttachFolder=function(e){function i(){function i(){m(function(i){return i?(re=i,t.settings.set(Settings.attachFolderId,re),e(re)):e()})}if(re)e(re);else{var n=t.settings.get(Settings.attachFolderId);if(n){var r=function(t){if(t)return re=n,e(n);i()},a=function(n){if(t.settings.set(Settings.attachFolderId,void 0),!n||!n.error||404!==n.error.code)return e();i()};t.vmMain.remoteAPI().driveFilesGet(n,r,a)}else{
var s="properties has {key='"+q.DefaultAttachFolderProperty+"' and value='"+q.DefaultAttachFolderPropertyValue+"' and visibility='PRIVATE'} and 'me' in owners and trashed=false",o={getAllPages:!0},r=function(n){if(n.length>0){try{t.PAssert(3506,1===n.length,"Must have a single root folder present")}catch(e){t.reportError(e)}var r=n[0];return re=r.id,t.settings.set(Settings.attachFolderId,re),e(r.id)}i()},a=function(t){return e()};t.vmMain.remoteAPI().driveFilesList(s,r,a,o)}}}try{t.PAssert(3504,!t.isDemoMode(),"Should not be creating file structure in demo mode")}catch(e){t.reportError(e)}try{t.PAssert(3505,e,"Must provide a valid callback when getting the root folder")}catch(e){t.reportError(e)}ne?i():q.getRootFolder(i)},q.getRootFolder=function(e){function i(){p(function(i){return i?(ne=i,t.settings.set(Settings.rootFolderId,ne),e(ne)):e()})}try{t.PAssert(3507,!t.isDemoMode(),"Should not be creating file structure in demo mode")}catch(e){t.reportError(e)}try{t.PAssert(3508,e,"Must provide a valid callback when getting the root folder")}catch(e){t.reportError(e)}if(ne)return e(ne);var n=t.settings.get(Settings.rootFolderId);if(n){var r=function(t){if(t)return ne=n,e(n);i()},a=function(n){if(t.settings.set(Settings.rootFolderId,void 0),!n||!n.error||404!==n.error.code)return e();i()};t.vmMain.remoteAPI().driveFilesGet(n,r,a)}else{var s="properties has {key='"+q.DefaultRootFolderProperty+"' and value='"+q.DefaultRootFolderPropertyValue+"' and visibility='PRIVATE'} and 'me' in owners and trashed=false",o={getAllPages:!0},r=function(n){if(n.length>0){try{t.PAssert(3509,1===n.length,"Must have a single root folder present")}catch(e){t.reportError(e)}var r=n[0];return ne=r.id,t.settings.set(Settings.rootFolderId,ne),e(r.id)}i()},a=function(t){return e()};t.vmMain.remoteAPI().driveFilesList(s,r,a,o)}},q.createDefaultRealtimeFile=function(){var e=t.vmMain.docManager.createNewDoc();q.createAndSetupDocument(e,!0,function(n){if(!n||n.error)h();else{t.vmMain.docManager.setDoc(e);var r=i.getURLParam("file");if(r)try{try{t.PAssert(3520,gapi.drive,"gapi.drive should exist")}catch(e){t.reportError(e)}i.removeURLParam("file");t.vmMain.docManager.loadDocFromData({id:r},!1).open(),q.setDocInfo(r,void 0),a.driveRealtimeLoad(r,v,g,y);try{window.__LOAD_REQUESTS.push(t.getCurrentStack("File Request After Default Load"))}catch(e){t.reportError(e)}}catch(e){t.reportError(e)}else q.onDefaultRealtimeFileOpened(n,!0)}})},q.createAndSetupDocument=function(e,i,n){try{t.PAssert(3521,n,"Must pass in a valid creation callback")}catch(e){t.reportError(e)}q.getRootFolder(function(a){var s;i&&(s=[{key:q.DefaultProperty,value:q.DefaultPropertyValue,visibility:"PRIVATE"}]);var o=r.fns("drive").files.insert.packedFn,c={fields:"createdDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,userPermission(id,role,type)",resource:{mimeType:q.REALTIME_MIMETYPE,title:e.getTitle()||q.DefaultDocTitle,writersCanShare:!1,parents:[{id:a}],properties:s}},l=function(t){e.updateData(t),e.createDocumentFileStructure(function(e){return n(t)})},d=function(e){return n(void 0)};t.vmMain.remoteAPI().runRemoteSingleRequest(o,c,l,d)})};var ae=W;q.recoverFromError=function(e){e&&(ShouldLog(LogLevels.Error)&&log("GDrive Error: ",e),t.reportError(e)),t.vmMain.setGDriveStatus(DriveStatus.Connecting),U(function(e){if(!e||e.error){t.toasts.pushMessage(MessageID.ConnectionError),t.vmMain.setGDriveStatus(DriveStatus.Offline);var i="Unable to refresh authentication token - ",n=!0;e?(i+=e.error,"immediate_failed"===e.error&&(n=!1)):i+="No Token",n?t.reportError(new Error(i)):ShouldLog(LogLevels.Error)&&log("Refresh Auth Failed: ",i),ae<16e4&&(setTimeout(q.recoverFromError,ae),ae*=2)}})},q.onDefaultRealtimeFileOpened=function(e,i){e&&e.id?b(e.id,e.title,i):t.reportError(new Error("We should always find a valid document with a defined id"))};var se=!1;q.loadClientDefaultFile=function(){var i=n.DocLoadSkipReason.None,r=!!t.vmMain,a=q.isRealtimeAPILoaded();if(se)i=n.DocLoadSkipReason.Already;else if(r)if(a)if(d.isCurrentlyAuthorized("me"))if(t.getLoginState()==LoginState.LOGGED_IN){t.checkpoint(Checkpoint.LoadDefaultFile),se=!0,ShouldLog(LogLevels.Timing)&&log("Loading Default Client File: ",log.now()),t.vmMain.setGDriveStatus(DriveStatus.Connecting);var s=d.getDefaultEmail(),o=t.getActiveUser();o&&s&&s!==o?e.clearData(function(){t.reload()}):!o&&s&&t.setActiveUser(s),b(t.settings.get(Settings.gdocId),t.settings.get(Settings.gdocTitle),!1),q.authAndLoadContacts(!1)}else i=n.DocLoadSkipReason.LoginState;else i=n.DocLoadSkipReason.NotAuth;else i=n.DocLoadSkipReason.Drive;else i=n.DocLoadSkipReason.Main;return i},q.reconnectToActiveDocument=function(){var e=!!t.vmMain,i=q.isRealtimeAPILoaded(),n=t.getLoginState()==LoginState.LOGGED_IN,r=d.getDefaultAccessToken();try{t.PAssert(3531,!a.isConnected(),"Should not try to reconnect if gdata is still connected")}catch(e){t.reportError(e)}e&&i&&n&&r&&!a.isConnected()&&!t.vmMain.isReconnecting()&&(t.vmMain.setGDriveStatus(DriveStatus.Reconnecting),t.isReconnected=!0,b(t.settings.get(Settings.gdocId),t.settings.get(Settings.gdocTitle),!1))},q.deleteAppDataFiles=function(e){var i=function(t){for(var i=r.createBatch(),n=0,a=0;a<t.length;++a){var s=r.createRequest("me",r.fns("drive").files.trash.packedFn,{fileId:t[a].id});i.add(s,"default",t[a].id),n++}n>0?i.then(function(t){e(!0)},function(){e(!1)}):e(!0)},n=function(t,i){e(!1)},a={getAllPages:!0};t.vmMain.remoteAPI().driveFilesList("'appfolder' in parents",i,n,a)},q.deleteAllFiles=function(e,t){for(var i=r.createBatch(),n=0,a=0;a<e.length;++a)if(e[a].hasDriveBacking()){var s=e[a].getData();if(s.userPermission&&"owner"===s.userPermission.role){var o=r.createRequest("me",r.fns("drive").files.trash.packedFn,{fileId:e[a].id});i.add(o,"default",e[a].id),n++}}n>0?i.then(function(e){q.deleteAppDataFiles(t)},function(){t(!1)}):q.deleteAppDataFiles(t)},q.DeleteErrorCode={None:0,RootFolder:1,UnlinkFailure:2,UnlinkException:3,MissingFolders:4,FolderException:5,MissingRoot:6},q.deleteAccount=function(e){q._deleteAccount(e)};var oe=1500;q._deleteAccount=function(e){var i=0,n=0,r=[];q.getRootFolder(function(a){function s(e){var i=function(){e(!0,q.DeleteErrorCode.None)},n=function(){e(!1,q.DeleteErrorCode.RootFolder)};t.vmMain.remoteAPI().driveFilesTrash(a,i,n)}if(a){var o="'"+a+"' in parents",c={getAllPages:!0,maxPageResults:999},l=function(a){try{if((n=a.length)>0)for(var o=0;o<a.length;++o){var c=a[o];"owner"===c.userPermission.role?C(c.id,function(a){a&&r.push(a),++i===n&&E(r,function(i){try{i?s(e):e(!1,q.DeleteErrorCode.UnlinkFailure)}catch(i){t.reportError(i),e(!1,q.DeleteErrorCode.UnlinkException)}})}):n--}else s(e)}catch(i){t.reportError(i),e(!1,q.DeleteErrorCode.FolderException)}},d=function(t,i){e(!1,q.DeleteErrorCode.MissingFolders)};t.vmMain.remoteAPI().driveFilesList(o,l,d,c)}else e(!1,q.DeleteErrorCode.MissingRoot)})},q.authAndLoadContacts=function(e,t){d.onConnected(function(){q._authAndLoadContacts(e,t)})},q._authAndLoadContacts=function(e,i){if(t.settings.get(Settings.syncContacts)){var n=t.vmMain.getUserEmail();d.isAuthorized(n,GScope.Contacts)?q.loadContacts(function(e){T(e),i&&i(e>=0)}):q.runAuthenticate([GScope.Contacts],!0,e,function(e){s.mobile||e&&!e.error?q.loadContacts(function(e){T(e),i&&i(e>0)}):(t.toasts.pushMessage(MessageID.LostPermission),d.notifyUnauthorizedAccount(n,[GScope.Contacts],e?e.error:"Missing token"),t.settings.set(Settings.syncContacts,!1),i&&i(!1))})}},q.refreshContacts=function(i){return e.clearLocalContacts(),q.loadedContacts=!1,!!t.settings.get(Settings.syncContacts)&&(q.authAndLoadContacts(!0,function(e){i&&i()}.bind(this)),!0)},window.__LOAD_HANDLES=new o(5),window.__LOAD_REQUESTS=new o(5),q.checkTokenInHash=function(){var e=!1;if(i.hasURLParam("access_token"))try{var n,r=i.getURLParam("scope");r&&(n=r.split("+"));var a=i.hasURLParam("issued_at")?i.getURLParam("issued_at"):D(),s=i.getURLParam("expires_in"),o=i.hasURLParam("expires_at")?i.getURLParam("expires_at"):M(s,a),c={access_token:i.getURLParam("access_token"),id_token:i.getURLParam("id_token"),issued_at:a,expires_in:s,expires_at:o,scope:n,token_type:i.getURLParam("token_type")};_(c),e=!0,i.removeURLParam("access_token",!0),i.removeURLParam("issued_at",!0),i.removeURLParam("expires_in",!0),i.removeURLParam("expires_at",!0),i.removeURLParam("scope",!0),i.removeURLParam("token_type",!0),i.removeURLParam("id_token",!0),i.hasURLParam("login")||i.insertURLParam("login",!0,!0),d.notifyUserAuthorized("me",c)}catch(e){t.reportError(e)}return e};var ce;q.setExternalAccessToken=function(e){ce=e;var i=d._runDecodeIDToken(e);try{t.PAssert(3547,"me"===d.getDefaultEmail()||d.isDefaultEmail(i.email),"Must only set external access token with default email")}catch(e){t.reportError(e)}d.isJSAuthLibLoaded()?I():window.addEventListener("gapiLoaded",I)};var le=0,de={};q.requestNativeOAuth=function(e,i){try{t.PAssert(3548,e,"Must supply valid OAuth config")}catch(e){t.reportError(e)}try{t.PAssert(3549,i,"Must specify a callback function for OAuth respose")}catch(e){t.reportError(e)}try{t.PAssert(3550,!e.offline||!e.immediate,"Cannot request immediate offline access")}catch(e){t.reportError(e)}var n=++le,r={id:n,scope:e.scope,immediate:!!e.immediate,offline:!!e.offline,state:e.state,login_hint:e.login_hint,include_granted_scopes:!0,redirect_uri:e.redirect_uri};t.nativeBridge.sendToApp("getOAuth",r);de[n]=i},q.handleNativeOAuthResponse=function(e){try{t.PAssert(3551,e&&!t.isString(e),"Must supply valid oauth response data")}catch(e){t.reportError(e)}try{t.PAssert(3552,!e||e.id,"Response must have a valid request ID associated with it")}catch(e){t.reportError(e)}var i=de[e.id];if(i)if(de[e.id]=void 0,e.success&&e.token&&!e.token.error)e.token.id_token&&e.token.access_token?q.setExternalAccessToken(e.token):e.token.code||t.reportError(new Error("Token missing expected properties"),e),i(e.token);else{try{log("Native Token Error: ",JSON.stringify(e))}catch(e){t.reportError(e)}i(e.token)}else try{t.PAssert(3553,!1,"OAuth callback without a valid handler: ",e.id)}catch(e){t.reportError(e)}};var he=[];q.requestNoneOAuth=function(e,t){he.push({config:e,cb:t})};var ue=!1,pe=[];pe[OAuthSchemeType.None]=!0;var me,fe=OAuthSchemeType.Invalid;q.addOAuthMethod=function(e){if(!pe[e])if(q.isOAuthMethodValid(e))pe[e]=!0,ue||R();else try{t.PAssert(3554,!1,"Adding invalid OAuth method: ",e)}catch(e){t.reportError(e)}},q.isOAuthMethodValid=function(e){var t=!1;switch(e){case OAuthSchemeType.Native:s.app&&(t=!0);break;case OAuthSchemeType.Web:case OAuthSchemeType.None:t=!0}return t},q.getOAuthMethod=function(){return fe},q.linkAccount=function(e,t,i){return me.link(e,t,i)},q.runAuthenticateOffline=function(e,n){var r=t.vmMain.getUserEmail();try{t.PAssert(3559,r===i.getURLParam("user")||!i.getURLParam("user"),"Do not try to login a user that is not valid")}catch(e){t.reportError(e)}q.numTokensRequestedOffline++;var a=e.slice(0);a.indexOf(GScope.UserInfoEmail)<0&&a.push(GScope.UserInfoEmail);for(var s=!1,o=0;o<a.length;++o)if(!d.isLinkedAccountAuthorized(r,a[o])){s=!0;break}if(s){var c=d.getAuthorizedScopes(r);a.pushOnlyUniques(c),q.linkAccount(r,a,function(e){e&&!e.error&&(t.toasts.clearMessage(MessageID.MissingOffline),t.toasts.clearMessage(MessageID.MissingOfflineMobile),q.setExternalAccessToken(e)),L(e,!0,n)})}else d.getAccountToken(r,n)},q.runAuthenticate=function(e,n,r,a){if(!d.canRunAuthenticate())return log("Connection: runAuthenticate - Skipped"),a&&a(),!1;var o=t.getActiveUser()||void 0;try{t.PAssert(3560,o===i.getURLParam("user")||!i.getURLParam("user"),"Do not try to login a user that is not valid")}catch(e){t.reportError(e)}if(n&&!o&&!i.hasURLParam("login",!0))return a&&a(),!1;var c,l=d.getJSAuthLibToken();if(l){if(t.isArray(l.scope))c=l.scope.slice();else if(t.isString(l.scope))try{c=l.scope.split(" ")}catch(e){t.reportError(e)}else c=[];var h=0;if(l.scope)for(var u=0;u<e.length;++u)l.scope.indexOf(e[u])<0&&(c.push(e[u]),h++);else c=e,h=e.length;0===h&&(c=[])}else c=e;if(c.length>0){var p=N(c);B(p,o);var m={client_id:q.CLIENT_ID,scope:p.join(" "),immediate:n,include_granted_scopes:!0,login_hint:o,response_type:"token id_token",authuser:-1};s.requireCustomRedirect&&!n&&(m.redirect_uri=s.customRedirectString,s.customRedirectState&&(c.indexOf(GScope.Contacts)>=0&&(s.customRedirectState.syncContacts=!0),m.state=s.iosui?s.customRedirectState:JSON.stringify(s.customRedirectState))),ie=!0;q.numTokensRequested++,me.authorize(m,function(e){ie=!1,ShouldLog(LogLevels.Timing)&&log("GAPI Authorized: ",log.now()),(!e||e.error)&&n&&r?(q.numTokenRequestFailed++,q.runAuthenticate(c,!1,!1,a)):(e&&!e.error&&(s.app||i.hasURLParam("login","true"))&&(t.vmSetup?t.vmSetup.setLoginState(LoginState.LOGGED_IN):t.setLoginState(LoginState.LOGGED_IN)),L(e,!1,a),e&&!e.error&&(s.app||i.hasURLParam("login","true"))&&q.loadClientDefaultFile())})}else ShouldLog(LogLevels.Error)&&log("Authorization request with no scopes: ",c),a&&a(l);return!0};var ge=0;q.totalTokenLifetime=0,q.numTokensRequested=0,q.numTokensRequestedOffline=0,q.numTokenRequestSuccess=0,q.numTokenRequestFailed=0,q.getTokenStats=function(e){var t={totalLifetime:q.totalTokenLifetime,averageLifetime:q.totalTokenLifetime/(q.numTokenRequestFailed+q.numTokenRequestSuccess),numRequested:q.numTokensRequested,numRequestedOffline:q.numTokensRequestedOffline,numRequestSuccess:q.numTokenRequestSuccess,numRequestFailed:q.numTokenRequestFailed};e.tokenStats=t},q.numScriptLoads=0,q.numTokenRefreshes=0,q.numOnlines=0,q.numEnsureDocs=0,q.getOAuthData=function(e){var t={isLocked:ue,availableSchemes:pe,currentScheme:fe,nativeOAuthCount:le,numScriptLoads:q.numScriptLoads,numTokenRefreshes:q.numTokenRefreshes,numOnlines:q.numOnlines,numEnsureDocs:q.numEnsureDocs};e.oauthData=t};var ve=!1;q.ensureScopeAccess=function(e){for(var i=q.getAuthorizedScopes(),n=F(),r=!1,a=0;a<n.length;++a)if(i.indexOf(n[a])<0){r=!0;break}r?(log("Current Scopes: "+i.join(", ")),log("Necessary Scopes: "+n.join(", ")),t.reportError(new Error("Missing offline auth scopes")),q.runAuthenticate(n,!1,!1,function(t){t?log("Authenticated Scopes: "+(t.scope?t.scope.join(", "):void 0)):log("Failed to authorize to ensure scopes - no token"),e(t&&!t.error)})):(log("Determined no extra auth necessary for missing token"),e(!0))},q.isRealtimeAPILoaded=function(){return!!(window.gapi&&window.gapi.client&&window.gapi.drive&&window.gapi.drive.realtime)},q.isGoogleClientAPILoaded=function(){return!(!window.gapi||!window.gapi.load)};var ye=-1,be=!1,Se=void 0,Ee=void 0;return q.goOnline=function(){return q.numOnlines++,q.isGoogleClientAPILoaded()&&q.isRealtimeAPILoaded()?!Ee&&(ve=!1,Ee=setTimeout(function(){V()},t.seconds(2)),!0):(ye=2,be||Se||(be=!0,Se=setTimeout(H,t.seconds(5))),!1)},q.ensureDocConnection=function(){q.numEnsureDocs++,q.isGoogleClientAPILoaded()&&q.isRealtimeAPILoaded()?V(function(){se?a.isConnected()||q.reconnectToActiveDocument():q.loadClientDefaultFile()}):q.goOnline()},q.init(),q}),define("LocalCache",["globals","util","platform"],function(e,t,i){function n(e,t,i){this._id=e,this._name=t,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._metadata={},this._useInMemoryStore=!i||!i.noInMemoryCache,this._useMetadataInMemoryStore=!i||!i.noMetadataInMemoryCache,this._isPerDoc=i&&i.isPerDoc,this.open()}var r={getStats:function(e){this.getFilterEntries(function(){return!0},function(t){var i={id:this._id,count:t.length,size:JSON.stringify(t).length};e(i)}.bind(this))},getState:function(){return{isOpen:this._isOpen,isReady:this._isReady,isAllLoaded:this._isAllLoaded,storageError:this._storageError}},enableLogging:function(){this._loggingEnabled=!0},disableLogging:function(){this._loggingEnabled=!1},isLoggingEnabled:function(){return this._loggingEnabled},usesDiskSpace:function(){return this._usesDiskSpace},_cacheInMemory:function(){return this._useInMemoryStore},_cacheMetadataInMemory:function(){return this._useMetadataInMemoryStore},_hasLoadedAll:function(){return this._isAllLoaded},isPerDoc:function(){return this._isPerDoc},getStorageType:function(){try{e.PAssert(3566,!1,"SubClass must override")}catch(t){e.reportError(t)}},open:function(){this._isOpen=!0},close:function(){this._isOpen=!1,this._isReady=!1},isOpen:function(){return this._isOpen},isReady:function(){return this._isOpen&&this._isReady},requestPreloadData:function(t){try{e.PAssert(3567,!this._preloadConsumed,"Should never consume preload data twice")}catch(t){e.reportError(t)}this._preloadConsumed=!0;var i=window.__preload;if(!(i&&i.cachePreloads&&i.cachePreloads.indexOf(this._id)>=0))return t(void 0);if(i.cacheResults[this._id]){try{e.PAssert(3568,!i.cacheCallbacks[this._id],"Should never have active callbacks and results")}catch(t){e.reportError(t)}var n=i.cacheResults[this._id];return delete i.cacheResults[this._id],i.cachePreloads.remove(this._id),t(n)}i.cacheCallbacks[this._id]||(i.cacheCallbacks[this._id]=[]),i.cacheCallbacks[this._id].push(t)},isMetadataReady:function(){return this._isOpen&&this._isMetadataReady},notifyCacheReady:function(e){if(e){this._storageError=!1,this._isReady=!0;for(var t=0;t<this._onReadyFns.length;++t)this._onReadyFns[t]();this._onReadyFns=[]}else this._storageError=!0,this._isReady=!1},notifyCacheMetadataReady:function(e){if(e){this._isMetadataReady=!0;for(var t=0;t<this._onMetadataReadyFns.length;++t)this._onMetadataReadyFns[t]();this._onMetadataReadyFns=[]}else this._isMetadataReady=!1},onCacheReady:function(t){try{e.PAssert(3569,t,"Must provide a valid cb")}catch(t){e.reportError(t)}if(this._isReady)setTimeout(t,0);else{try{e.PAssert(3570,this._onReadyFns.indexOf(t)<0,"Must not double register a cache ready fn")}catch(t){e.reportError(t)}this._onReadyFns.push(t)}},onCacheMetadataReady:function(t){try{e.PAssert(3571,t,"Must provide a valid cb")}catch(t){e.reportError(t)}if(this._isMetadataReady)setTimeout(t,0);else{try{e.PAssert(3572,this._onMetadataReadyFns.indexOf(t)<0,"Must not double register a cache metadata ready fn")}catch(t){e.reportError(t)}this._onMetadataReadyFns.push(t)}},setMetadata:function(t,i,n){try{e.PAssert(3573,!n,"In memory query is sync")}catch(t){e.reportError(t)}this._cacheMetadataInMemory()&&(this._metadata[t]=i)},removeMetadata:function(t,i){try{e.PAssert(3574,!i,"In memory query is sync")}catch(t){e.reportError(t)}this._cacheMetadataInMemory()&&delete this._metadata[t]},getMetadata:function(t,i){try{e.PAssert(3575,!i,"In memory query is sync")}catch(t){e.reportError(t)}return this._cacheMetadataInMemory()?this._metadata[t]:void 0},_setRawInMemoryMetadata:function(t){try{e.PAssert(3576,this._cacheMetadataInMemory(),"Must be running an in-memory cache")}catch(t){e.reportError(t)}this._metadata=t},_getRawInMemoryMetadata:function(){return this._cacheMetadataInMemory()?this._metadata:void 0},_setRawInMemoryCache:function(t){try{e.PAssert(3577,this._cacheInMemory(),"Must be running an in-memory cache")}catch(t){e.reportError(t)}this._cache=t},_getRawInMemoryCache:function(){return this._cacheInMemory()?this._cache:void 0},count:function(t){try{e.PAssert(3578,!t,"In memory query is sync")}catch(t){e.reportError(t)}return this._cacheInMemory()?Object.keys(this._cache).length:void 0},size:function(t){try{e.PAssert(3579,!t,"In memory query is sync")}catch(t){e.reportError(t)}return this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0},loadAll:function(t){try{e.PAssert(3580,!t,"In memory query is sync")}catch(t){e.reportError(t)}this._isAllLoaded=!0},getEntrySync:function(e){return this._cacheInMemory()?this._cache[e]:void 0},getEntry:function(t,i){try{e.PAssert(3581,!i,"In memory query is sync")}catch(t){e.reportError(t)}return this._cacheInMemory()?this._cache[t]:void 0},getBoundEntries:function(t,i,n,r){try{e.PAssert(3582,!r,"In memory query is sync")}catch(t){e.reportError(t)}var a;if(this._cacheInMemory()){a=[];for(var s in this._cache)this._cache[s][t]>=i&&this._cache[s][t]<=n&&a.push(this._cache[s])}return a},getFilterEntries:function(t,i){try{e.PAssert(3583,!i,"In memory query is sync")}catch(t){e.reportError(t)}var n;if(this._cacheInMemory()){n=[];for(var r in this._cache)t(this._cache[r])&&n.push(this._cache[r])}return n},removeEntry:function(t,i){try{e.PAssert(3584,!i,"In memory query is sync")}catch(t){e.reportError(t)}this._cacheInMemory()&&delete this._cache[t]},hasEntry:function(t,i){try{e.PAssert(3586,!i,"In memory query is sync")}catch(t){e.reportError(t)}return!!this._cacheInMemory()&&this._cache.hasOwnProperty(t)},cacheEntry:function(t,i,n){try{e.PAssert(3587,!n,"In memory query is sync")}catch(t){e.reportError(t)}this.isLoggingEnabled()&&log("Cache Entry: ",t,i),this._cacheInMemory()&&i&&(this._cache[t]=i)},clearCache:function(t){try{e.PAssert(3588,!t,"In memory query is sync")}catch(t){e.reportError(t)}this._cache={}},clearMetadata:function(t){try{e.PAssert(3589,!t,"In memory query is sync")}catch(t){e.reportError(t)}this._metadata={}},clearBackingStore:function(t){try{e.PAssert(3590,!1,"SubClass must override")}catch(t){e.reportError(t)}},dumpData:function(e){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)},onCacheError:function(t){e.reportError(t)}};return t.defineBase(n),t.extend(n.prototype,r),n}),define("LocalCacheMemory",["globals","util","data","LocalCache"],function(e,t,i,n){function r(t,i,n){if(n){try{e.PAssert(3591,!n.noInMemoryCache,"Invalid in-memory cache option")}catch(t){e.reportError(t)}try{e.PAssert(3592,!n.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(t){e.reportError(t)}n.noInMemoryCache=!1,n.noMetadataInMemoryCache=!1}this._super.constructor.call(this,t,i,n),this._db=void 0}var a={getStorageType:function(){return StorageType.InMemory},setMetadata:function(e,t,i){this._super.setMetadata.call(this,e,t),i&&i(!0)},removeMetadata:function(e,t){this._super.removeMetadata.call(this,e),t&&t(!0)},getMetadata:function(e,t){var i=this._super.getMetadata.call(this,e)||void 0;t&&t(i)},count:function(t){try{e.PAssert(3593,t,"Must provide a valid callback")}catch(t){e.reportError(t)}var i=this._super.count.call(this);t&&t(i)},size:function(t){try{e.PAssert(3594,t,"Must provide a valid callback")}catch(t){e.reportError(t)}var i=this._super.size.call(this);t&&t(i)},loadAll:function(e){this._super.loadAll.call(this),e&&e(!0)},getEntrySync:function(t){try{e.PAssert(3595,t,"Must provide a valid ID to get")}catch(t){e.reportError(t)}return this._super.getEntrySync.call(this,t)||void 0},getEntry:function(t,i){try{e.PAssert(3596,t,"Must provide a valid ID to get")}catch(t){e.reportError(t)}try{e.PAssert(3597,i,"Must provide a valid entry callback")}catch(t){e.reportError(t)}var n=this._super.getEntry.call(this,t)||void 0;i&&i(n,t)},getBoundEntries:function(t,i,n,r){try{e.PAssert(3598,t,"Must specify a valid index")}catch(t){e.reportError(t)}try{e.PAssert(3599,r,"Must provide a valid entry callback")}catch(t){e.reportError(t)}var a=this._super.getBoundEntries.call(this,t,i,n)||[];r&&r(a)},getFilterEntries:function(t,i){try{e.PAssert(3600,e.isFunction(t),"Must specify a valid filter function")}catch(t){e.reportError(t)}try{e.PAssert(3601,i,"Must provide a valid entry callback")}catch(t){e.reportError(t)}var n=this._super.getFilterEntries.call(this,t)||[];i&&i(n)},removeEntry:function(t,i){try{e.PAssert(3602,t,"Must provide valid data id")}catch(t){e.reportError(t)}this._super.removeEntry.call(this,t),i&&i(!0)},hasEntry:function(e,t){var i=this._super.hasEntry.call(this,e);t&&t(i)},cacheEntry:function(t,i,n){try{e.PAssert(3603,t,"Must provide valid data id")}catch(t){e.reportError(t)}this._super.cacheEntry.call(this,t,i),n&&n(!0)},clearCache:function(e){this._super.clearCache.call(this),e&&e(!0)},clearMetadata:function(e){this._super.clearMetadata.call(this),e&&e(!0)},clearBackingStore:function(e){e&&e(!0)}};return t.inherit(n,r),t.extend(r.prototype,a),r}),define("LocalCacheIDB",["globals","util","data","LocalCache"],function(e,t,i,n){function r(e,t,i){this._usesDiskSpace=!0,this._db=void 0,this._cacheTable=void 0,this._metadataTable=void 0,this._version=2,this._schema=this._getDefaultSchema(),this._super.constructor.call(this,e,t,i)}var a={_makeID:function(e){return e},validID:function(e){return!0},_metadataID:function(e){return e},getStorageType:function(){return StorageType.IndexedDB},_migrateEntry:function(e,t,i){delete e.cid,this._cacheTable.update(e).done(t).fail(i)},_migrateMetadata:function(e,t,i){delete e.cid,this._super.setMetadata.call(this,e.id,e.value),this._metadataTable.update(e).done(t).fail(i)},_runMigration:function(e){i.onCachesAvailable(function(){var t=i.openCacheTable(this._id);t.query().bound(this._id,this._id+"￿").execute().done(function(n){function r(){o&&c+l===d&&(log("Migration Completed: ",c,l,d,o),i.closeCacheTable(h),e(!0))}function a(){c++,r()}function s(e){l++,r()}for(var o=!1,c=0,l=0,d=0,h=this._id,u=0;n&&u<n.length;++u)t.remove(n[u].cid),this._migrateEntry(n[u],a,s),d++;t.query().bound("Meta_Moo_","Meta_Moo_￿").execute().done(function(e){for(var i=0;e&&i<e.length;++i)e[i].cid.endsWith(this._id)&&(t.remove(e[i].cid),this._migrateMetadata(e[i],a,s),d++);o=!0,r()}.bind(this))}.bind(this))}.bind(this))},open:function(){this._super.open.call(this),i.openCacheDatabase(this._id,this._version,this._schema,function(t){try{e.PAssert(3604,!this._db,"Should not open the cache DB twice")}catch(t){e.reportError(t)}t&&(this._db=t,this._cacheTable=t.cache,this._metadataTable=t.metadata),e.vmMain.cacheManager.needsMigration()?this._runMigration(function(e){log("Cache data migrated: ",this._id),this.notifyCacheMetadataReady(!!t),this.notifyCacheReady(!!t)}.bind(this)):(this.notifyCacheMetadataReady(!!t),this.notifyCacheReady(!!t))}.bind(this))},close:function(){this._super.close.call(this),this._db.close(),this._db=void 0,this._cacheTable=void 0,this._metadataTable=void 0},isReady:function(){return this._super.isReady.call(this)&&this._db&&this._cacheTable},isMetadataReady:function(){return this._super.isReady.call(this)&&this._db&&this._metadataTable},notifyCacheReady:function(e){this._super.notifyCacheReady.call(this,e)},notifyCacheMetadataReady:function(e){this._super.notifyCacheMetadataReady.call(this,e)},setMetadata:function(e,t,i){if(this._super.setMetadata.call(this,e,t),this.isMetadataReady()){var n={id:e,value:t};try{this._metadataTable.update(n).done(function(){i&&i(!0)}).fail(function(e,t){this.onCacheError(t),i&&i(!1)}.bind(this))}catch(e){this.onTransactionError(e),i&&i(!1)}}else i&&i(!1)},removeMetadata:function(e,t){if(this._super.removeMetadata.call(this,e),this.isMetadataReady())try{this._metadataTable.remove(this._metadataID(e)).done(function(){t&&t(!0)}).fail(function(e){log("IDB removeMetadata Error: ",e),t&&t(!1)})}catch(e){this.onTransactionError(e),t&&t(!1)}else t&&t(!1)},getMetadata:function(t,i){var n=this._super.getMetadata.call(this,t);if(n)i(n);else if(this.isMetadataReady())try{this._metadataTable.query().only(this._metadataID(t)).limit(1).execute().done(function(t){var n;try{e.PAssert(3605,!t||0===t.length||1===t.length&&t[0],"Mismatch in metadata value")}catch(t){e.reportError(t)}t&&1===t.length&&t[0]&&(n=t[0].value),i(n)}).fail(function(e){log("IDB getMetadata Error: ",e),i(void 0)})}catch(e){this.onTransactionError(e),i(void 0)}else i(void 0)},count:function(e){if(this.isReady())try{this._cacheTable.query().all().count().execute().done(function(t){e(t)}).fail(function(t){e()})}catch(t){this.onTransactionError(t),e()}else e()},size:function(e){if(this.isReady())try{this._cacheTable.query().all().execute().done(function(t){for(var i=0,n=0;n<t.length;++n)i+=this._entrySize(t[n]);e(i)}).fail(function(t){e()})}catch(t){this.onTransactionError(t),e()}else e()},loadAll:function(e){if(this.isReady())try{this._cacheTable.query().all().execute().done(function(t){for(var i=0;i<t.length;++i)this._super.cacheEntry.call(this,t[i].id,t[i]);this._super.loadAll.call(this),e(!0,t)}.bind(this)).fail(function(t){log("IDB loadAll Error: ",t),this._super.loadAll.call(this),e(!1)})}catch(t){this.onTransactionError(t),e(!1)}else e(!1)},getEntrySync:function(t){try{e.PAssert(3606,!1,"Sync access to IDB is not supported")}catch(t){e.reportError(t)}},getEntry:function(t,i){try{e.PAssert(3607,t,"Must provide a valid ID to get")}catch(t){e.reportError(t)}try{e.PAssert(3608,i,"Must provide a valid entry callback")}catch(t){e.reportError(t)}var n=this._super.getEntry.call(this,t);if(n)i(n);else if(this.isReady())try{this._cacheTable.query().only(this._makeID(t)).limit(1).execute().done(function(e){var n;e&&1===e.length&&(n=e[0],this._super.cacheEntry.call(this,t,n)),i(n,t)}.bind(this)).fail(function(e){log("IDB getEntry Error: ",e),i(void 0)})}catch(e){this.onTransactionError(e),i(void 0)}else i(void 0)},getBoundEntries:function(t,i,n,r){try{e.PAssert(3609,t,"Must specify a valid index to query")}catch(t){e.reportError(t)}try{e.PAssert(3610,r,"Must provide a valid entry callback")}catch(t){e.reportError(t)}if(this.isReady())try{this._cacheTable.query().filter(function(e){return e[t]>=i&&e[t]<=n}).execute().done(function(e){r(e,!0)}.bind(this)).fail(function(e){r([],!1)}.bind(this))}catch(e){this.onTransactionError(e),r([],!1)}else r([],!1)},getFilterEntries:function(t,i){try{e.PAssert(3611,e.isFunction(t),"Must specify a valid filter function")}catch(t){e.reportError(t)}try{e.PAssert(3612,i,"Must provide a valid entry callback")}catch(t){e.reportError(t)}if(this.isReady())try{this._cacheTable.query().filter(t).execute().done(function(e){i(e,!0)}.bind(this)).fail(function(e){i([],!1)}.bind(this))}catch(e){this.onTransactionError(e),i(!1)}else i([],!1)},removeEntry:function(t,i){try{e.PAssert(3613,t,"Must provide valid data id")}catch(t){e.reportError(t)}if(this._super.removeEntry.call(this,t),this.isReady())try{this._cacheTable.remove(this._makeID(t)).done(function(){i&&i(!0)}).fail(function(e){log("IDB removeEntry Error: ",e),i&&i(!1)})}catch(e){this.onTransactionError(e),i&&i(!1)}else i&&i(!1)},hasEntry:function(e,t){if(this._super.hasEntry.call(this,e))t(!0);else if(this.isReady())try{this._cacheTable.query().only(this._makeID(e)).limit(1).execute().done(function(i){var n;i&&1===i.length&&(n=i[0],this._super.cacheEntry.call(this,e,n)),t(!!n)}.bind(this)).fail(function(e){log("IDB hasEntry Error: ",e),t(!1)})}catch(e){this.onTransactionError(e),t(!1)}else t(!1)},_entrySize:function(t){var i=0;try{i=2*JSON.stringify(t).length}catch(t){e.reportError(t)}return i},cacheEntry:function(t,i,n){try{e.PAssert(3614,t,"Must provide valid data id")}catch(t){e.reportError(t)}try{e.PAssert(3615,i.id,"Data must also contain a valid item id")}catch(t){e.reportError(t)}if(this._super.cacheEntry.call(this,t,i),this.isReady()){try{this._cacheTable.update(i).done(function(){if(n)try{n(!0)}catch(t){e.reportError(t)}}).fail(function(e,t){this.onCacheError(t),n&&n(!1)}.bind(this))}catch(e){this.onTransactionError(e),n&&n(!1)}}else n&&n(!1)},clearCache:function(e){if(this._super.clearCache.call(this),this.isReady())try{this._cacheTable.clear().done(function(){e&&e(!0)}).fail(function(t){log("IDB clearcache Error: ",t),e&&e(!1)})}catch(t){this.onTransactionError(t),e&&e(!1)}else e&&e(!1)},clearMetadata:function(e){if(this._super.clearMetadata.call(this),this.isReady())try{this._metadataTable.clear().done(function(){e&&e(!0)}.bind(this)).fail(function(t){log("IDB clearMetadata Error: ",t),e&&e(!1)})}catch(t){this.onTransactionError(t),e&&e(!1)}else e&&e(!1)},dumpData:function(e){e?this._super.dumpData.call(this,e):(console.log("-- Cache: ",this._id,"--"),this.isReady()?this._cacheTable.query().all().execute().done(function(e){for(var t=0;t<e.length;++t)console.log(e[t])}).fail(function(e){console.log("Error running IDB query: ",e)}):console.log("Cache not ready"))},
_getDefaultSchema:function(){return{cache:{key:{keyPath:"id"}},metadata:{key:{keyPath:"id"}}}},onTransactionError:function(e){i.notifyDBUnexpectedClose(!1)},onCacheError:function(t){if(t&&t.target)try{var n=t.target.error;n?"QuotaExceededError"===n.name||4===n.code?e.vmMain.cacheManager.hasReportedQuotaError()||(e.vmMain.cacheManager.reportQuotaExceeded(),e.vmMain.pluginManager.onCacheLimitExceeded()):"InvalidStateError"===n.name?i.notifyDBUnexpectedClose(!1):e.reportError(new Error("IDB Cache Transaction Error"),t):e.reportError(new Error("IDB Cache Transaction Error [No Target Error]"),t)}catch(t){e.reportError(t)}}};return t.inherit(n,r),t.extend(r.prototype,a),r}),define("LocalCacheLocalStorage",["globals","util","data","LocalCache","Dispatcher"],function(e,t,i,n,r){function a(i,n,a){if(a){try{e.PAssert(3617,!a.noInMemoryCache,"Invalid in-memory cache option")}catch(t){e.reportError(t)}try{e.PAssert(3618,!a.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(t){e.reportError(t)}a.noInMemoryCache=!1,a.noMetadataInMemoryCache=!1,this.saveTime=isNaN(a.saveTime)?s:a.saveTime,a.writeOnUnload&&r.listen("onUnload",this.writeCache.bind(this)),a.clearBackingOnLoad&&(this.clearBackingOnLoad=!0,r.listen("enterForeground",this.clearBackingStore.bind(this)))}else this.saveTime=s;this._super.constructor.call(this,i,n,a),this._saveTimeout=void 0,t.forceBind("writeCache",this)}var s=5e3,o={_localStorageKey:function(){return"MDC_"+this._id},_onWrite:function(e){e||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))},writeCache:function(){var i,n=(performance.now(),{metadata:this._getRawInMemoryMetadata(),cache:this._getRawInMemoryCache()});try{i=JSON.stringify(n),t.storage.setItem(this._localStorageKey(),i)}catch(t){e.reportError(t)}},close:function(){this._onWrite(!0),this._super.close.call(this)},getStorageType:function(){return StorageType.LocalStorage},setMetadata:function(e,t,i){this._super.setMetadata.call(this,e,t),this._onWrite(),i&&i(!0)},getMetadata:function(e,t){var i=this._super.getMetadata.call(this,e)||void 0;t&&t(i)},count:function(t){try{e.PAssert(3619,t,"Must provide a valid callback")}catch(t){e.reportError(t)}var i=this._super.count.call(this);t&&t(i)},size:function(t){try{e.PAssert(3620,t,"Must provide a valid callback")}catch(t){e.reportError(t)}var i=this._super.size.call(this);t&&t(i)},loadAll:function(i){try{var n=t.storage.getItem(this._localStorageKey());if(n){var r=JSON.parse(n);this._setRawInMemoryMetadata(r.metadata),this._setRawInMemoryCache(r.cache)}this._super.loadAll.call(this),this.clearBackingOnLoad&&this.clearBackingStore(),i&&i(!0)}catch(t){e.reportError(t),this._super.loadAll.call(this),i&&i(!1)}},getEntrySync:function(t){try{e.PAssert(3621,t,"Must provide a valid ID to get")}catch(t){e.reportError(t)}return this._super.getEntrySync.call(this,t)||void 0},getEntry:function(t,i){try{e.PAssert(3622,t,"Must provide a valid ID to get")}catch(t){e.reportError(t)}try{e.PAssert(3623,i,"Must provide a valid entry callback")}catch(t){e.reportError(t)}var n=this._super.getEntry.call(this,t)||void 0;i&&i(n,t)},getBoundEntries:function(e,t,i,n){var r=this._super.getBoundEntries.call(this,e,t,i);n&&n(r)},getFilterEntries:function(e,t){var i=this._super.getFilterEntries.call(this,e);t&&t(i)},removeEntry:function(t,i){try{e.PAssert(3624,t,"Must provide valid data id")}catch(t){e.reportError(t)}this._super.removeEntry.call(this,t),this._onWrite(),i&&i(!0)},hasEntry:function(e,t){var i=this._super.hasEntry.call(this,e);t&&t(i)},cacheEntry:function(t,i,n){try{e.PAssert(3625,t,"Must provide valid data id")}catch(t){e.reportError(t)}this._super.cacheEntry.call(this,t,i),this._onWrite(),n&&n(!0)},clearCache:function(e){this._super.clearCache.call(this),this._onWrite(!0),e&&e(!0)},clearMetadata:function(e){this._super.clearMetadata.call(this),this._onWrite(),e&&e(!0)},clearBackingStore:function(e){t.storage.removeItem(this._localStorageKey()),e&&e(!0)}};return t.inherit(n,a),t.extend(a.prototype,o),a}),define("CacheManager",["globals","util","data","LocalCache","LocalCacheMemory","LocalCacheIDB","LocalCacheLocalStorage"],function(e,t,i,n,r,a,s){var o=function(){this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[],this.init()};return o.prototype={init:function(){this._storageReady[StorageType.InMemory]=!0,this._storageReady[StorageType.LocalStorage]=!0},getInfo:function(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}},registerLocalCache:function(t,i,n,o){try{e.PAssert(3626,t,"Must provide a valid cache ID")}catch(t){e.reportError(t)}try{e.PAssert(3627,i,"Must have a valid cache name")}catch(t){e.reportError(t)}var c=this._createCacheId(t,i);try{e.PAssert(3628,void 0===this._registeredCaches[c],"Must not have a previously registered cache with the same id")}catch(t){e.reportError(t)}e.shouldWriteLocal()||(n=StorageType.InMemory,o&&(o.noInMemoryCache=!1,o.noMetadataInMemoryCache=!1));var l;switch(n){case StorageType.InMemory:l=new r(c,i,o);break;case StorageType.LocalStorage:l=new s(c,i,o);break;case StorageType.IndexedDB:l=new a(c,i,o)}try{e.PAssert(3629,l,"Must have valid cache after creation")}catch(t){e.reportError(t)}return this._registeredCaches[t]=l,this._storageReady[n]&&(l.notifyCacheMetadataReady(!0),l.notifyCacheReady(!0)),l},clearLocalCache:function(t,i){var n=this._registeredCaches[t];try{e.PAssert(3630,n,"Must have valid local cache")}catch(t){e.reportError(t)}n.clearCache(),i&&n.clearMetadata()},clearLocalCaches:function(e){for(var t in this._registeredCaches)this.clearLocalCache(t,e)},clearPerDocCaches:function(e){for(var t in this._registeredCaches){this._registeredCaches[t].isPerDoc()&&this.clearLocalCache(t,e)}},_notifyIDBReady:function(e){},_createCacheId:function(e,t){return e},notifyMigrationRequired:function(){this._migrationRequired=!0},needsMigration:function(){return this._migrationRequired||5===e.settings.get(Settings.localDataVersion)},hasReportedQuotaError:function(){return this._reportedQuotaError},reportQuotaExceeded:function(){this._reportedQuotaError||(this._reportedQuotaError=!0,e.reportError(new Error("Quota exceeded!")))}},new o}),define("VMLIElement",["globals","util"],function(e,t){function i(t,i,n){this._parsedText=t,this._textLength=t.length,this._attrs=i?e.clone(i):{},this._width=void 0,this.isFirstInstanceInItem=n}var n={setWidth:function(e){this._width=e},getWidth:function(e){return this._width||(!e&&this.isMarkup()?0:void 0)},getParsedText:function(){return this._parsedText},getOrigTextLength:function(){return this._textLength},setParsedText:function(e){this._parsedText=e},getStyledText:function(t){var i;if(this.getAttr("plugin")){try{e.PAssert(3631,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(t){e.reportError(t)}var n=e.vmMain.pluginManager.getPlugin(this._attrs.plugin),r=n.getAttachment(this.getAttr("plugin-id"));i=n._getDisplayText(r,t)}else i=e.escape(this._parsedText);return i},getAttrs:function(){return this._attrs},getAttr:function(e){var t;return this._attrs&&(t=this._attrs[e]),t},hasAttrs:function(){return!!this._attrs},getClasses:function(){var e;return this._attrs&&(e=this._attrs.cls),e},hasClasses:function(){var e=this.getClasses();return!!e&&e.length>0},hasClass:function(e){var t=!1,i=this.getClasses();return i&&(t=i.indexOf(e)>=0),t},getClassString:function(){var e="",t=this.getClasses();return t&&(e=t.join(" ")),e},addClass:function(e){this._attrs||(this._attrs={}),this._attrs.cls||(this._attrs.cls=[]),this._attrs.cls.push(e)},mergeAttrs:function(t){if(t)if(this._attrs){t.cls&&(this._attrs.cls?this._attrs.cls=this._attrs.cls.concat(t.cls):this._attrs.cls=t.cls);var i=this._attrs["data-href"]||t["data-href"];i&&(this._attrs["data-href"]=i);try{e.PAssert(3632,void 0===this._attrs.plugin||void 0===t.plugin||this._attrs.plugin===t.plugin,"A single element cannot match multiple plugins")}catch(t){e.reportError(t)}var n=this._attrs.plugin||t.plugin;n&&(this._attrs.plugin=n);try{e.PAssert(3633,void 0===this._attrs["plugin-id"]||void 0===t["plugin-id"]||this._attrs["plugin-id"]===t["plugin-id"],"A single element cannot match multiple plugins")}catch(t){e.reportError(t)}var r=this._attrs["plugin-id"]||t["plugin-id"];r&&(this._attrs["plugin-id"]=r);var a=this._attrs.appLink||t.appLink;a&&(this._attrs.appLink=a)}else this._attrs=t},isMarkup:function(){return this.hasClass("mdMarkup")}};return t.extend(i.prototype,n),i}),define("SettingsManager",["require","globals","util","Constants","EventDispatcher"],function(e){function t(){this._versions={},this._values={},this._changeListeners=[],this._apiNotifications={},this._localLoaded=!1,this._localLoadError=!1,this._localWriteError=!1,this._remoteLoaded=!1,this._remoteLoadError=!1,this._remoteSettings=void 0,this.init()}var i=e("globals"),n=e("util"),r=e("Constants"),a=e("EventDispatcher"),s=Settings.DefaultGroup="Default",o=Settings.UISettingsGroup="UISettings";return t.prototype={init:function(){this._testLocalWrites(),this.registerGroup(s),this.registerGroup(o),this.registerSetting(Settings.theme,s,!0,"light"),this.registerSetting(Settings.syncContacts,s,!0),this.registerSetting(Settings.shownTutorial,s,!0),this.registerSetting(Settings.rootFolderId,s,!0),this.registerSetting(Settings.attachFolderId,s,!0),this.registerSetting(Settings.enableOfflineAuth,s,!0),this.registerSetting(Settings.trialOverHidden,s,!0),this.registerSetting(Settings.helpState,s,!0),this.registerSetting(Settings.helpPaneState,s,!0),this.registerSetting(Settings.closedImport,s,!0),this.registerSetting(Settings.closedHelps,s,!0),this.registerSetting(Settings.inTooltipIntro,s,!0),this.registerSetting(Settings.closedVideo,s,!0),this.registerSetting(Settings.workspaces,s,!0),this.registerSetting(Settings.paneHistoryMobile,s,!0),this.registerSetting(Settings.notificationDelay,s,!0,30),this.registerSetting(Settings.searchExpandsCollapsed,s,!0),this.registerSetting(Settings.openEvernoteApp,s,!0),this.registerSetting(Settings.dateFormat,s,!0,r.DateFormat.MDY),this.registerSetting(Settings.dayWeekStart,s,!0,0),this.registerSetting(Settings.lastContactSync),this.registerSetting(Settings.lastTaskSync),this.registerSetting(Settings.lastQuickAddSync),this.registerSetting(Settings.disableNotifications),this.registerSetting(Settings.authScopes),this.registerSetting(Settings.localIntegrity),this.registerSetting(Settings.localDataVersion),this.registerSetting(Settings.localRecoverVersion),this.registerSetting(Settings.gdocId),this.registerSetting(Settings.gdocTitle),this.registerSetting(Settings.activeUser),this.registerSetting(Settings.userId),this.registerSetting(Settings.displayName),this.registerSetting(Settings.noSounds),this.registerSetting(Settings.lastServerVersion),this.registerSetting(Settings.oauthScheme),this.registerSetting(Settings.premiumStatus),this.registerSetting(Settings.trialStart),this.registerSetting(Settings.trialDuration),this.registerSetting(Settings.trialExtended),this.registerSetting(Settings.premiumEndDate),this.registerSetting(Settings.notifiedTrialOver),this.registerSetting(Settings.notifiedTrialEndSoon),this.registerSetting(Settings.localPaneState),this.registerSetting(Settings.selectedWorkspace),this.registerSetting(Settings.monthlyInvoice),this.registerSetting(Settings.invoiceEmail),this.registerSetting(Settings.invoiceCompany),this.registerSetting(Settings.invoiceAddress),this.registerSetting(Settings.isUnsubscribed),this.registerSetting(Settings.keyboardToolbarScroll),this.registerSetting(Settings.showSidebar,s,!1,!0),this.registerSetting(Settings.cacheSizeRatio,s,!1,1),this.registerSetting(Settings.showBullets,o,!0,!1),this.registerSetting(Settings.bulletOpacity,o,!0,40),this.registerSetting(Settings.checkboxOpacity,o,!0,25),this.registerSetting(Settings.checkboxBackgroundOpacity,o,!0,0),this.registerSetting(Settings.showVerticalLines,o,!0,!1),this.registerSetting(Settings.verticalLinesColor,o,!0,"#EEEEEE"),this.registerSetting(Settings.boldHeaders,o,!0,!1),this.registerSetting(Settings.itemPadding,o,!0,5),this.registerSetting(Settings.notePadding,o,!0,0),this.registerSetting(Settings.itemLineHeight,o,!0,18),this.registerSetting(Settings.noteLineHeight,o,!0,18),this.registerSetting(Settings.fontSize,o,!0,14),this.registerSetting(Settings.fontSizeHeader,o,!0,16),this.registerSetting(Settings.fontSizeHeaderTopLevel,o,!0,20),this.registerSetting(Settings.noteFontSize,o,!0,12),this.registerSetting(Settings.itemIndentSize,o,!0,30),this.registerSetting(Settings.tagColor,o,!0,"#0099DD"),this.registerSetting(Settings.dateColor,o,!0,"#AA3300"),this.registerSetting(Settings.contactColor,o,!0,"#22AA66"),this.registerSetting(Settings.linkColor,o,!0,"#3333BB"),this.registerSetting(Settings.underlineP,o,!0,!1),this.registerSetting(Settings.layoutTheme,o,!0,r.DisplayTheme.Markdown),this.registerSetting(Settings.grayscale,o,!0,!1),this.registerAPIServerNotification(Settings.layoutTheme,o),this.registerAPIServerNotification(Settings.boldHeaders,o),this.registerAPIServerNotification(Settings.grayscale,o),this._setupLocalNotifications(),this._ensureLocalLoaded(),this._ensureRemoteSettings()},_setupLocalNotifications:function(){i.shouldWriteLocal()&&window.addEventListener("storage",function(e){if(e||(e=window.event),"localSettings"===e.key){var t,n;try{if(e.oldValue&&(t=this._deserializeSettings(e.oldValue)),e.newValue&&(n=this._deserializeSettings(e.newValue)),t&&n){try{i.PAssert(3636,t.values,"Must have a valid set of old settings")}catch(e){i.reportError(e)}try{i.PAssert(3637,n.values,"Must have a valid set of new settings")}catch(e){i.reportError(e)}for(var r=0;r<this._changeListeners.length;++r){var a=this._changeListeners[r];try{i.PAssert(3638,a,"Each listener must have a valid entry")}catch(e){i.reportError(e)}var s,o,c=t.values[a.groupID],l=n.values[a.groupID];if(c&&l?(s=c[a.key],o=l[a.key]):!c&&l?(s=void 0,o=l[a.key]):c&&!l&&(s=c[a.key],o=void 0),s!==o)try{a.fn(s,o)}catch(e){i.reportError(e)}}for(var d in n.versions){var l=n.versions[d],c=t.versions[d];if(l)for(var h in l){var u=l[h],p=c?c[h]:void 0;if(!c||p<u){var o=n.values[d][h],s=c?t.values[d][h]:void 0;this.fireEvent("settingChanged",d,h,[s,o])}}}}}catch(e){i.reportError(e)}if(this._localLoaded=!1,n)this._loadLocalSettings(n);else try{i.PAssert(3639,!1,"Unable to update settings to be empty")}catch(e){i.reportError(e)}}}.bind(this),!1)},registerForChangeNotification:function(e,t,n){try{i.PAssert(3640,e,"Must provide a valid key to watch")}catch(e){i.reportError(e)}try{i.PAssert(3641,n&&i.isFunction(n),"Must provide a valid callback fn",n)}catch(e){i.reportError(e)}t=t||s,this._changeListeners.push({key:e,groupID:t,fn:n})},_testLocalWrites:function(){var e=!1;try{n.storage.setItem("poke",0),e=!0}catch(e){i.preventLocalWrites(r.LocalWriteReason.NoPermission)}return e},registerGroup:function(e){this._versions[e]||(this._versions[e]={},this._values[e]={})},registerSetting:function(e,t,n,r){t=t||s,n=n||!1;try{i.PAssert(3643,this._versions[t],"Must first register a group before a setting in the group")}catch(e){i.reportError(e)}this._versions[t][e]||(this._versions[t][e]={version:-1,syncRemote:n}),void 0!==r&&void 0===this._values[t][e]&&(this._values[t][e]=r)},registerAPIServerNotification:function(e,t){t=t||s,this._apiNotifications[t]||(this._apiNotifications[t]={}),this._apiNotifications[t][e]=!0},get:function(e,t){t=t||s;try{i.PAssert(3645,e,"Must specify a valid setting to get")}catch(e){i.reportError(e)}try{i.PAssert(3646,this._versions[t],"Must first register a group before getting a setting from it")}catch(e){i.reportError(e)}try{i.PAssert(3647,!this._versions[t]||void 0!==this._versions[t][e],"Must first register a setting before getting a value from it: "+e)}catch(e){i.reportError(e)}return this._ensureLocalLoaded(),this._values[t][e]},set:function(e,t,n){n=n||s;try{i.PAssert(3648,e,"Must specify a valid setting to get")}catch(e){i.reportError(e)}try{i.PAssert(3649,this._versions[n],"Must first register a group before getting a setting from it")}catch(e){i.reportError(e)}try{i.PAssert(3650,!this._versions[n]||void 0!==this._versions[n][e],"Must first register a setting before setting a value to it")}catch(e){i.reportError(e)}var r=!1;this._ensureLocalLoaded();var a=this._values[n][e],o=this._versions[n][e].version;if((a!==t||i.isObject(t)||i.isArray(t))&&(r=!0),r){var c=this._versions[n][e].syncRemote,l=o+1;c&&this._remoteLoaded&&this._setRemoteValue(e,t,l,n),this._values[n][e]=t,this._versions[n][e].version=l,this._writeLocalSettings(),this._sendChangeNotification(n,e,a,t,ChangeType.Local)}},reset:function(e,t){t=t||s;try{i.PAssert(3651,e,"Must specify a valid setting to get")}catch(e){i.reportError(e)}try{i.PAssert(3652,void 0!==this._versions[t],"Must first register a group before getting a setting from it")}catch(e){i.reportError(e)}try{i.PAssert(3653,!1===this._versions[t][e].syncRemote,"Currently do not support resetting remote syncd settings")}catch(e){i.reportError(e)}this._ensureLocalLoaded();var n=this._values[t][e];delete this._values[t][e],this._writeLocalSettings(),this._sendChangeNotification(t,e,n,void 0,ChangeType.Local)},resetAll:function(e){try{i.PAssert(3655,!i.isArray(e),"Must pass in a valid settings object to skip")}catch(e){i.reportError(e)}if(i.isArray(e)){var t=e;e={},e[s]=t}for(var r in this._versions){var a=this._versions[r],o=e?e[r]:void 0;for(var c in a)(!o||o.indexOf(c)<0)&&(this._versions[r][c].version=-1,this._values[r][c]=void 0)}if(e)this._writeLocalSettings();else if(i.shouldWriteLocal())try{n.storage.setItem("localSettings","{}")}catch(e){i.reportError(e)}},_ensureLocalLoaded:function(){if(i.shouldWriteLocal()&&!this._localLoaded)try{var e=n.storage.getItem("localSettings");e||(i.isFirstRun=!0),this._loadLocalSettings(this._deserializeSettings(e))}catch(e){i.reportError(e),this._localLoadError=!0}},_serializeSettings:function(){var e={__version:1,versions:{},values:{}};for(var t in this._versions){var i=this._versions[t];for(var n in i){var r=this._versions[t][n].version,a=this._values[t][n];this._versions[t][n].syncRemote&&(e.versions[t]||(e.versions[t]={}),e.versions[t][n]=r),e.values[t]||(e.values[t]={}),void 0!==a&&(e.values[t][n]=a)}}return e},_deserializeSettings:function(e){var t={versions:{},values:{}};if(e)try{var n=JSON.parse(e);if(void 0===n.__version){t.versions[s]={},t.values[s]={};for(var r in n)if(r.startsWith("V~")){var a=n[r];t.versions[s][r.substr("V~".length)]=a}else{var o=n[r];t.values[s][r]=o}}else if(1===n.__version)t.versions=n.versions,t.values=n.values;else try{i.PAssert(3656,!1,"Invalid settings version")}catch(e){i.reportError(e)}}catch(e){i.reportError(e)}return t},_loadLocalSettings:function(e){try{i.PAssert(3657,!this._localLoaded,"Should not load settings from local twice")}catch(e){i.reportError(e)}try{i.PAssert(3658,e,"Must supply some valid parsed settings")}catch(e){i.reportError(e)}try{i.PAssert(3659,!e||e.versions,"Must have a valid constructed parsed settings - versions")}catch(e){i.reportError(e)}try{i.PAssert(3660,!e||e.values,"Must have a valid constructed parsed settings - values")}catch(e){i.reportError(e)}var t=e.versions,n=e.values;for(var r in t){var a=t[r];this._versions[r]||(this._versions[r]={});for(var s in a)this._versions[r][s]={version:a[s],syncRemote:!0}}for(var r in n){var a=n[r];this._values[r]||(this._values[r]={});for(var s in a)this._values[r][s]=a[s]}this._localLoaded=!0,this._localLoadError=!1},_writeLocalSettings:function(){if(i.shouldWriteLocal()||i.isLocalWriteReason(r.LocalWriteReason.QuotaError))try{var e=this._serializeSettings();n.storage.setItem("localSettings",JSON.stringify(e))}catch(e){i.reportError(e);try{n.storage.setItem("localSettings","{}")}catch(e){i.reportError(e)}this._localWriteError=!0}},_ensureRemoteSettings:function(){this._remoteRequested||this._remoteLoaded||i.vmMain&&i.vmMain.realtimeDocManager&&(this._remoteRequested=!0,i.vmMain.realtimeDocManager.registerForReadyNotification(DocType.GAppData,function(){this._remoteSettings=i.vmMain.realtimeDocManager.createDocument(DocType.GAppData,"RemoteSettings"),this._remoteSettings.open("RemoteSettings",this._onRemoteLoad.bind(this),this._onRemoteInit.bind(this),this._onRemoteError.bind(this))}.bind(this)))},_getRemoteEntry:function(e,t){if(this._remoteLoaded){var i=this._remoteSettings.getModel(),n=i.getRoot().get("settings"),r=n.get(t);if(r){return r.get(e)}}},_getRemoteValue:function(e,t){var i=this._getRemoteEntry(e,t);if(i)return i.value},_getRemoteVersion:function(e,t){var i=this._getRemoteEntry(e,t);return i?i.ver:-1},_setRemoteValue:function(e,t,i,n){if(n=n||s,this._remoteLoaded){var r=this._remoteSettings.getModel(),a=r.getRoot().get("settings"),o=a.get(n);o||(o=r.createMap(),a.set(n,o)),o.set(e,{value:t,ver:i})}},_sendChangeNotification:function(e,t,n,r,a){this.fireEvent("settingChanged",e,t,[n,r]);for(var s=0;s<this._changeListeners.length;++s){var o=this._changeListeners[s];if(e===o.groupID&&t===o.key)try{o.fn(n,r)}catch(e){i.reportError(e)}}!i.isDemoMode()&&i.isLocalChange(a)&&this._shouldNotifyAPIServer(e,t)&&this._notifyAPISever(e,t,r)},_findGroupForMap:function(e,t){for(var i=e.items(),n=0;n<i.length;++n)if(i[n][1]===t)return i[n][0]},_onRemoteSettingsChange:function(e){for(var t=0;t<e.events.length;++t){var i=e.events[t];if(!i.isLocal){var n=this._findGroupForMap(e.currentTarget,i.target);n&&i.newValue&&this._remoteSettingLoaded(i.property,i.newValue.value,i.newValue.ver,n)}}},_remoteSettingLoaded:function(e,t,n,r){try{i.PAssert(3662,r,"Must specify a valid groupID at this point")}catch(e){i.reportError(e)}this._versions[r]||this.registerGroup(r),this._versions[r][e]||this.registerSetting(e,r,!0);var a=this._values[r][e],s=this._versions[r][e].version;if(n>s)this._values[r][e]=t,this._versions[r][e].version=n,this._sendChangeNotification(r,e,a,t,ChangeType.Remote);else if(n<s)this._setRemoteValue(e,a,s,r),this._shouldNotifyAPIServer(r,e)&&this._notifyAPISever(r,e,a);else if(n===s)if(i.isArray(a)){try{i.PAssert(3663,i.isArray(t),"Must both be arrays or neither arrays")}catch(e){i.reportError(e)}try{i.PAssert(3664,a.equals(t),"Arrays must match")}catch(e){i.reportError(e)}}else if(i.isObject(a))try{i.PAssert(3665,i.areObjectsEqual(a,t),"Should match if the versions are the same: "+e+" - "+r)}catch(e){i.reportError(e)}else try{i.PAssert(3666,a===t,"Should match if the versions are the same: "+e+" - "+r)}catch(e){i.reportError(e)}else try{i.PAssert(3667,!1,"What - remote and local versions are messed up",n,s)}catch(e){i.reportError(e)}},_onRemoteLoad:function(e){try{i.PAssert(3668,this._localLoaded,"Local settings must be loaded before remote")}catch(e){i.reportError(e)}try{i.PAssert(3669,this._remoteRequested,"Remote document must have been requested")}catch(e){i.reportError(e)}this._remoteLoaded=!0;var t=!1,n=!1,r=e.getModel(),a=r.getRoot(),s=a.get("settings");a.get("info");try{for(var o=s.items(),c=0;c<o.length;++c)for(var l=o[c][0],d=o[c][1],h=d.items(),u=0;u<h.length;++u){var p=h[u][0],m=h[u][1],f=m.value,g=m.ver;t=t||this._remoteSettingLoaded(p,f,g,l)}for(var l in this._versions){var d=this._versions[l];for(var p in d)if(this._versions[l][p].syncRemote&&-1!==this._versions[l][p].version){var v=s.get(l);v||(n||(r.beginCompoundOperation("Sync Settings",!1),n=!0),v=r.createMap(),s.set(l,v));var y=v.get(p);y||(n||(r.beginCompoundOperation("Sync Settings",!1),n=!0),y={value:this._values[l][p],ver:this._versions[l][p].version},v.set(p,y))}}}catch(e){i.reportError(e)}n&&r.endCompoundOperation(),s.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,this._onRemoteSettingsChange.bind(this)),t&&this._writeLocalSettings()},_onRemoteError:function(e){try{i.PAssert(3670,this._localLoaded,"Local settings must be loaded before remote")}catch(e){i.reportError(e)}try{i.PAssert(3671,this._remoteRequested,"Remote document must have been requested")}catch(e){i.reportError(e)}this._remoteLoaded=!1,this._remoteLoadError=!0},_onRemoteInit:function(e){try{i.PAssert(3672,this._localLoaded,"Local settings must be loaded before remote")}catch(e){i.reportError(e)}try{i.PAssert(3673,this._remoteRequested,"Remote document must have been requested")}catch(e){i.reportError(e)}var t=e.getRoot(),n=e.createMap(),r=e.createMap();r.set("settingsVer",1),t.set("settings",n),t.set("info",r)},_shouldNotifyAPIServer:function(e,t){return this._apiNotifications[e]&&this._apiNotifications[e][t]},_notifyAPISever:function(e,t,n){i.billingManager.onConnected(function(){i.billingManager.onBillingIdentifierAvailable(function(){i.XHR_PrivateAPI({type:"POST",path:"/user/settings/set",data:{email:i.billingManager.getBillingIdentifier(),groupID:e,key:t,value:n},requireAuth:!0,autoRetry:!0,cb:function(r){200!==r.status&&i.reportError(new Error("Unable to notify API server of remote setting: "+r.status+" "+e+" "+t+" "+n))}})})})},getRawSettings:function(){var e;if(i.shouldWriteLocal())try{e=n.storage.getItem("localSettings")}catch(e){i.reportError(e)}else try{return JSON.stringify(this._serializeSettings())}catch(e){return i.reportError(e),'{m:"Invalid Settings"}'}return e},hasLoadedRemote:function(){return this._remoteLoaded},_dumpSettings:function(){log("---- Settings ----"),log("Versions: ",this._versions),log("Values: ",this._values)}},n.defineBase(t),n.extend(t.prototype,a),i.settings=new t,i.settings}),define("International",["platform","globals","Constants","SettingsManager"],function(e,t,i,n){function r(){this._localized=[],this._loadedDateFormat=void 0,this.init()}var a=/([\s]|^)(\d{1,2})[-\/.](\d{1,2})(?:[-\/.](\d{2,4}))?/g,s=/([\s]|^)(?:(\d{2,4})[-\/.])?(\d{1,2})(?:[-\/.](\d{1,2}))/g;return window.DFormat={LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},r.prototype={init:function(){var e=t.settings.get(Settings.dateFormat)||i.DateFormat.MDY;this._loadLocalized(e),t.settings.registerForChangeNotification(Settings.dateFormat,void 0,function(e,n){require(["Measure"],function(e){this._loadLocalized(n||i.DateFormat.MDY),t.vmMain.root()&&(t.vmMain.parseSubtree(t.vmMain.root(),ChangeType.Auto),e.clearItemCache(),e.clearLineCache(),t.vmMain.updateAllItems(!1,!0))}.bind(this))}.bind(this))},parseDate:function(e,t){return Date.parse(this.normalizeDateString(e,t))},parseDateDefaultFormat:function(e){return Date.parse(this.normalizeDateString(e,this.getCurrentDateFormat()))},getFormat:function(e){try{t.PAssert(3674,this._localized[e],"Invalid format request")}catch(e){t.reportError(e)}return this._localized[e]},getCurrentDateFormat:function(){return this._loadedDateFormat||i.DateFormat.MDY},_loadLocalized:function(e){if(this._loadedDateFormat=e,this._localized[DFormat.LongDayTime]="dddd h:mm tt",this._localized[DFormat.ShortTime]="h:mm tt",this._localized[DFormat.MonthDay]="MMM d",this._localized[DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[DFormat.MonthDayLong]="MMMM d",this._localized[DFormat.MonthDayYearLong]="MMMM d, yyyy",e===i.DateFormat.MDY)this._localized[DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[DFormat.ShortDate]="MM/dd",this._localized[DFormat.MonthDayYear]="MM/dd/yy",this._localized[DFormat.MonthDayYearShort]="M/d/yy",this._localized[DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[DFormat.DayDate]="ddd M/d",this._localized[DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[DFormat.MonthDayShort]="M/d";else if(e===i.DateFormat.DMY)this._localized[DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[DFormat.ShortDate]="dd/MM",this._localized[DFormat.MonthDayYear]="dd/MM/yy",this._localized[DFormat.MonthDayYearShort]="d/M/yy",this._localized[DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[DFormat.DayDate]="ddd d/M",this._localized[DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[DFormat.MonthDayShort]="d/M";else if(e===i.DateFormat.YMD)this._localized[DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[DFormat.ShortDate]="MM/dd",this._localized[DFormat.MonthDayYear]="yy/MM/dd",this._localized[DFormat.MonthDayYearShort]="yy/M/d",this._localized[DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[DFormat.DayDate]="ddd M/d",this._localized[DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[DFormat.MonthDayShort]="M/d";else try{t.PAssert(3675,!1,"Unsupport date format requested: "+e)}catch(e){t.reportError(e)}},formatDate:function(e,i,n){try{t.PAssert(3676,t.isDateValid(e),"Must provide a valid date to format")}catch(e){t.reportError(e)}try{t.PAssert(3677,i,"Must provide a valid format for the date")}catch(e){t.reportError(e)}var r;if(t.isDateValid(e)){var a=e.toString(this.getFormat(i));r=n&&n!==this._loadedDateFormat?this.convertDateFormat(a,this._loadedDateFormat,n):a}return r},_isParsedDateValid:function(e,i,n){var r=!0,a=t.parseInt(e),s=t.parseInt(i),o=t.parseInt(n);return void 0!==e&&a<13?r=!1:s<=0||s>12?r=!1:(o<=0||o>31)&&(r=!1),r},_detectDelim:function(e){var t="/";return e.indexOf("-")>=0?t="-":e.indexOf(".")>=0&&(t="."),t},convertDateFormat:function(e,n,r){try{t.PAssert(3678,n,"Must provide a date format to convert from")}catch(e){t.reportError(e)}try{t.PAssert(3679,r,"Must provide a date format to convert to")}catch(e){t.reportError(e)}var o=e;if(n!==r){s.lastIndex=0,a.lastIndex=0;var c;c=n===i.DateFormat.YMD?s:a;for(var l;null!==(l=c.exec(o));){var d,h,u,p,m=this._detectDelim(o);if(r===i.DateFormat.MDY)switch(n){case i.DateFormat.DMY:l[4]?(h=l[4],u=l[3],p=l[2],d=u+m+p+m+h):l[2]&&l[3]&&(u=l[3],p=l[2],d=u+m+p);break;case i.DateFormat.YMD:l[2]?(h=l[2],u=l[3],p=l[4],d=u+m+p+m+h):l[3]&&l[4]&&(u=l[3],p=l[4],d=u+m+p);break;default:try{t.PAssert(3680,!1,"Invalid date format requested from MDY: ",n)}catch(e){t.reportError(e)}}else if(r===i.DateFormat.DMY)switch(n){case i.DateFormat.MDY:l[4]?(h=l[4],u=l[2],p=l[3],d=p+m+u+m+h):l[2]&&l[3]&&(u=l[2],p=l[3],d=p+m+u);break;case i.DateFormat.YMD:l[2]?(h=l[2],u=l[3],p=l[4],d=p+m+u+m+h):l[3]&&l[4]&&(u=l[3],p=l[4],d=p+m+u);break;default:try{t.PAssert(3681,!1,"Invalid date format requested from DMY: ",n)}catch(e){t.reportError(e)}}else if(r===i.DateFormat.YMD)switch(n){case i.DateFormat.MDY:l[4]?(h=l[4],u=l[2],p=l[3],d=h+m+u+m+p):l[2]&&l[3]&&(u=l[2],p=l[3],d=u+m+p);break;case i.DateFormat.DMY:l[4]?(h=l[4],u=l[3],p=l[2],d=h+m+u+m+p):l[2]&&l[3]&&(u=l[3],p=l[2],d=u+m+p);break;default:try{t.PAssert(3682,!1,"Invalid date format requested from YMD: ",n)}catch(e){t.reportError(e)}}else try{t.PAssert(3683,!1,"Invalid date format requested: ",r)}catch(e){t.reportError(e)}d&&this._isParsedDateValid(h,u,p)&&(o=o.substr(0,l.index)+l[1]+d+o.substr(l.index+l[0].length))}}return o},normalizeDateString:function(e,t){var n=e,r=!1;e.startsWith(DatePrefix)&&(n=e.slice(1),r=!0);var a=this.convertDateFormat(n,t,i.DateFormat.MDY);return r?DatePrefix+a:a},getAppendDateText:function(e,i,n){var r,a=Date.today();r=e<a||e.getFullYear()!==a.getFullYear()?this.getFormat(DFormat.MonthDayYearShort):this.getFormat(DFormat.MonthDayShort);var s=e.toString(r);if(i instanceof Date)r=0===i.getMinutes()?" htt":" h:mmtt",s+=i.toString(r);else if(t.isNumber(i)){var o=Math.floor(i),c=o%12,l=t.pad2(60*(i-o));0===c&&(c=12),s+=" "+c+":"+l+(o>11?"pm":"am")}return isNaN(n)||(s+=" "+t.round(n,2)+"hr"),s}},new r}),define("DuchessHelpers",["globals","data","Constants","VMLIElement","platform","International"],function(e,t,i,n,r,a){function s(){}var o=", . ? ! ) ( : ; [ ] ' \"".split(" "),c=-1===navigator.userAgent.indexOf("Mac")?"ctrl":"⌘",l=0,d=["http","https","evernote","onenote","bear"];window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0}
;var h,u,p,m=new Date(9e12).getTime(),f=new Date(1401606e6),g=/^(next|today|tomorrow|yesterday|(?:sun|mon|tue(?:s)?|wed(?:nes)?|thu(?:rs)?|fri|sat(?:ur)?)(?:day)?)/i,v=/^(?:(?:([0]?[1-9]|1[0-2])(?::([0-5]\d))?(?:\s)?(am?|pm?|\b))|(?:([0]?\d|1\d|2[0-3]):([0-5]\d)))$/i,y=/(^#|[\(\s-]#)([^\s\),#]+)/g,b=/(?:^(?:[\*_]*?)@|[\(\s](?:[\*_]*?)@)([^\s\)\*_]{2,})(\s[^\s\)@\u2001\u2003\*_]{1,})?(\s[^\s\)@\u2001\u2003\*_]{1,})?/g,S=/\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/g,E=/(?:^|[\s\(\[])([^\(\[#@\s]+\.(?:com|org|net|io))/gi,C=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,P=/^(\#+|\-|\*|\[|\[\]|\[\s\]|\+|[0-9]+\.) /gi,T=/\[([^\[]+)\]\((\S+(?=\)))\)/g,D=/^(-{3,})$/g,M=/^([\*_]*)([^\*_]+)([\*_]*)/g,_=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,I=/(\*\*\*|___)(.*?)\1/g,A=/(\*\*|__)(.*?)\1/g,w=/(\*|_)(\u2005*?)([^\u2005|\*|_]+?)\2\1/gi,k={repeat:/^(ev(ery)?|after)\b/i,recur:/^(other|first|second|third|fourth|1st|2nd|3rd|4th|last)$/i,day:/^(((sun|mon|tue(s)?|wed(nes)?|thu(rs)?|fri|sat(ur)?)(day)?)(?:,|\sand\s)?)$/i,daysOfWeek:/^(weekday|weekend)$/i,len:/^(day|week|month|year|morning|afternoon|night)$/i,count:/^((\d{1,2})|one|two|three|four|five|six|seven|eight|nine|ten)$/i,month:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)$/i,at:/^at$/i,of:/^of$/i,in:/^in$/i,delim:/^and$/i,date:/^((\d{1,2})|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?)(?:,|\sand\s)?)$/i,year:/^((\d\d)|(\d\d\d\d))$/i,time:v,from:/^(from|starting)$/i,until:/^(until)$/i,measure:/^(days|weeks|months|years)$/i},x={"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,fou:4,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,days:RepeatFreq.Daily,weeks:RepeatFreq.Weekly,months:RepeatFreq.Monthly,years:RepeatFreq.Yearly},R={h:1,hr:1,hrs:1,hour:1,hours:1,Hours:1,m:2,min:2,mins:2,Minutes:2,d:3,day:3,days:3,Days:3,"-":1,until:1,to:1,till:1,EndDate:1,for:2,Duration:2},O={duration:/^(-\s|(?:for|until|to|till)\b)/i,len:/^(\d{1,3}(?:\.\d{1,2})?)(h(?:(?:ou)?r(?:s)?)?|m(?:in(?:s)?)?|d(?:ay(?:s)?)?)$/i},L=0,N=0,F=1;return s.prototype={isFlagSet:function(e,t){return(e&t)===t},trimPunc:function(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")},generateStyledLines:function(e,t,i){for(var n=this.linesToEls(e,t),r=[],a=0;a<n.length;++a)r.push(this.generateHTML(n[a],!1,i));return r},linesToEls:function(e,t){for(var i,r=[],a=[],s=0;s<t.length;++s){for(var o=0,c=t[s].start,l=t[s].length,d=0,h=0;h<e.length;++h){var u=e[h],p=u.getParsedText().length,m=Math.max(c-o,0);if(m<p){var f=Math.min(p-m,l-d);if(f>0){var g=u.getParsedText().substr(m,f);a.push(new n(g,u.getAttrs(),u.getAttr("appLink")&&i!==h&&(0===h||!e[h-1].getAttr("appLink")))),d+=f,i=h}}o+=p}r.push(a),a=[]}return r},replaceTextInEls:function(t,i,n,r){try{e.PAssert(3684,e.isArray(t),"Must supply a valid VMLIElement array")}catch(t){e.reportError(t)}try{e.PAssert(3685,i,"Must be replacing at least one of parsed or styled text")}catch(t){e.reportError(t)}for(var a=0,s=0;s<t.length;++s){var o=t[s],c=o.getParsedText();if(n+r>=a&&n<a+o.getOrigTextLength()){var l=n-a,d=Math.min(r,c.length-l),h=c.substr(0,l),u=c.substr(l+d);i&&o.setParsedText(h+i+u);break}a+=o.getOrigTextLength()}},getElAtOffset:function(e,t){for(var i=0,n=0;n<e.length;++n){var r=e[n],a=r.getOrigTextLength();if(t>=i&&t<i+a)return r;i+=a}},insertEl:function(t,i,r,a){try{e.PAssert(3686,e.isArray(i.cls),"Must always pass in a valid classes array")}catch(t){e.reportError(t)}try{e.PAssert(3687,e.isNumber(r),"Must have a valid start")}catch(t){e.reportError(t)}try{e.PAssert(3688,e.isNumber(a),"Must have a valid length")}catch(t){e.reportError(t)}for(var s,o=0,c=a,l=0;l<t.length;++l){var d=t[l],h=d.getParsedText();if(o<r+a&&r<o+d.getOrigTextLength()){var u=0,p=Math.max(r-o,0),m=Math.min(c,h.length),f=p+c,g=h.length-f;if(p>0){var v=h.substr(0,p);t.splice(l,0,new n(v,d.getAttrs())),u++}var y=h.substr(p,m);if(s=new n(y,d.getAttrs()),s.mergeAttrs(i),t.splice(l+u,1,s),u++,g>0){var b=h.substr(f,g);t.splice(l+u,0,new n(b,d.getAttrs()))}if(l+=u-1,c-=m,g>0)break}o+=d.getOrigTextLength()}return s},generateHTML:function(t,i,n,a){var s,o,l=[],d=!1;try{e.PAssert(3689,t,"C Item has no els: ")}catch(t){e.reportError(t)}t||(t=[]);for(var h=0;h<t.length;++h){var u=t[h],p=u.getAttrs(),m="",f="",g=u.getStyledText(n);if(i&&(g=g&&g.replace(/ /g,"&nbsp;")),!p||a&&u.hasClass("itemPrefix"))l.push(g);else{var v="",y="",b=u.getClassString();if(u.getAttr("appLink")&&(d||(o=(u.hasClass("evernote")?"Evernote":"")||(u.hasClass("onenote")?"OneNote":"")||(u.hasClass("bear")?"Bear":""),v+='<span class="appLink '+o+'">'),u.isFirstInstanceInItem&&(v+='<span contenteditable="false" class="appLinkStart"></span>'),d=!0),u.hasClass("link")){var S=u.getAttr("data-href");v+="<span ",y=u.hasClass("linkImage")?'tooltip="Click to open image.\n'+c+" + click to open in "+(r.app?"browser":"new tab")+'."':d?'tooltip="Click to open in '+o+'"':'tooltip="'+(S!==g?S+"\n":"")+c+' + click to open"',y+=">"+g+"</span>"}else u.hasClass("tag")?(v+="<span ",y+='tooltip="Click to show only '+g+"\n"+c+" + click to hide "+g+'">'+g+"</span>"):u.hasClass("email")?(v+="<span ",y+='tooltip="'+c+"+ click to email "+g+'">'+g+"</span>"):u.hasClass("plugin")?(v+='<span contenteditable="false" ',y+="><span>"+g+"</span></span>"):(v+="<span ",y+=">"+g+"</span>");for(var E in p)p.hasOwnProperty(E)&&("cls"===E?(f='class="'+b+'" ',"itemPrefix"===p[E][0]&&(s=!0)):"appLink"!==E&&(m+=E+'="'+p[E]+'" '));!d||h!==t.length-1&&t[h+1].getAttr("appLink")||(y+="</span>",d=!1),l.push(v+(f||"")+(m?" "+m:"")+y)}}return s&&1===t.length&&l.push("<span>"+TextSpace+"</span>"),l.join("")},getNowRelativeDate:function(t){var i;switch(t.toUpperCase()){case"NOW":i=Date.today().add({hours:11});break;case"NEXT":i=Date.today().add({hours:12});break;case"SOON":i=Date.today().add({days:2});break;case"LATER":i=Date.today().add({days:5});break;case"SOMEDAY":i=Date.today().add({days:14});break;default:try{e.PAssert(3690,!1,"Must supply a valid now relative date string")}catch(t){e.reportError(t)}}return i},_notifyParse:function(e){__PARSE_STATS.total++,__PARSE_STATS[e]++},runParseSinglePlugin:function(e,t){return this.parseSinglePlugin(e.getRawText(),t)},parseSinglePlugin:function(t,i){if(this._notifyParse("parseSinglePlugin"),!t||0===t.length)return{parsedText:void 0,els:void 0};try{e.PAssert(3691,!l,"We do not support recursive calls to parse")}catch(t){e.reportError(t)}l++;var r,a;if(" "===t[0]||" "===t[0]){var s=!e.isFlagSet(i,ChangeType.ItemLoad),o=e.vmMain.pluginManager.parseAttachmentEmbedString(t.slice(1,-1),s);a=[o],t=window.AttachChar,s&&(r=[new n(window.AttachChar,o.displayElement.attrs)])}else r=[new n(t)];return l--,{parsedText:t,attachments:a,els:r}},parseNote:function(e){return this._notifyParse("parseNote"),{parsedText:e.getRawText(),els:[new n(e.getRawText())]}},runParseText:function(e,n){var r;return r=this.isFlagSet(n,ChangeType.Local)?a.getCurrentDateFormat():e.getDateFormat(),r||(r=i.DateFormat.MDY),this.parseText(e.getRawText(),e.getDateTime(),e.getRepeatDate(),e.getDateText(),r,e.getDateCompletedTime(),n,t.contactManager.getContacts())},parseText:function(t,r,s,c,h,u,p,m,f,g){if(this._notifyParse("parseText"),!t||0===t.length)return{parsedText:void 0,els:[]};try{e.PAssert(3692,!l,"We do not support recursive calls to parse")}catch(t){e.reportError(t)}l++;var v,k,x,R,O,L,N,F,B,U=!1,H=t,V=t,q=0,W=0,z=!1,G=[new n(H)];if(!g&&(P.lastIndex=0,null!==(v=P.exec(H))&&(L=v[1]))){var j;q=v[0].length,0===L.indexOf("#")?(j="prefixHeader c-foreground-super-faded",N="header"):"["===L||"[]"===L||"[ ]"===L?(j="prefixTask icon-square-o",N="task"):"*"===L||"-"===L||"+"===L?(j="prefixBullet",N="bullet"):(j="prefixNumList",N="numList");this.insertEl(G,{cls:["itemPrefix",j]},0,q).setWidth(i.PrefixWidth),V=H.substr(q)}for(C.lastIndex=0;null!==(v=C.exec(H));){var K=e.vmMain.pluginManager.parseAttachmentEmbedString(v[1],!0),Y=this.insertEl(G,K.displayElement.attrs,v.index,v[0].length);this.replaceTextInEls(G,window.AttachChar,v.index,v[0].length);var X=G.indexOf(Y);X>0&&Y.addClass("padB"),X<G.length-1&&Y.addClass("padA"),U=!0,R?R.push(K):R=[K]}if(!R){for(T.lastIndex=0;null!==(v=T.exec(V));){var Q=v[2].indexOf("://")>0,J=Q?v[2]:"http://"+v[2],$=!!e.parseEvernoteLink(v[2]),Z=e.isOneNoteLink(v[2]),ee=e.isBearLink(v[2]),te=$||Z||ee,ie=["mdMarkup"];$?ie.push("evernote"):Z?ie.push("onenote"):ee&&ie.push("bear"),this.insertEl(G,{cls:ie,appLink:te},q+v.index,1),this.insertEl(G,{cls:["mdSpan","link","c-link"].concat(e.isUrlImage(J)?"linkImage":[]),appLink:te,"data-href":J},q+v.index+1,v[1].length),this.insertEl(G,{cls:["mdMarkup"],appLink:te},q+v.index+1+v[1].length,2),this.insertEl(G,{cls:["mdSpan","link","c-link","mdMarkup"].concat(e.isUrlImage(J)?"linkImage":[]),appLink:te,"data-href":J},q+v.index+v[1].length+3,v[2].length),this.insertEl(G,{cls:["mdMarkup"],appLink:te},q+v.index+v[1].length+v[2].length+3,1),z=!0}if(!z)if(S.lastIndex=0,null!==(v=S.exec(H))){var Q=d.indexOf(v[2])>=0,J=Q?v[0]:"http://"+v[0],$=e.parseEvernoteLink(J),Z=e.isOneNoteLink(J),ee=e.isBearLink(J),ne={cls:["link","c-link"].concat(e.isUrlImage(J)?"linkImage":[]),"data-href":J};$&&(ne.appLink=!0,ne.cls.push("evernote")),Z&&(ne.appLink=!0,ne.cls.push("onenote")),ee&&(ne.appLink=!0,ne.cls.push("bear")),this.insertEl(G,ne,v.index,v[0].length)}else if(E.lastIndex=0,null!==(v=E.exec(H))){var q=v[0].length-v[1].length,J=v[1].startsWith("http")?v[1]:"http://"+v[1],$=e.parseEvernoteLink(J),Z=e.isOneNoteLink(J),ee=e.isBearLink(J),ne={cls:["link","c-link"].concat(e.isUrlImage(J)?"linkImage":[]),"data-href":J};$&&(ne.appLink=!0,ne.cls.push("evernote")),Z&&(ne.appLink=!0,ne.cls.push("onenote")),ee&&(ne.appLink=!0,ne.cls.push("bear")),this.insertEl(G,ne,v.index+q,v[1].length)}for(I.lastIndex=0;null!==(v=I.exec(V));)this.isInTag(v)||this.getElAtOffset(G,v.index).hasClass("link")||(this.insertEl(G,{cls:["mdMarkup"]},q+v.index,v[1].length),this.insertEl(G,{cls:["mdSpan","mdBold","mdItalic"]},q+v.index+v[1].length,v[2].length),this.insertEl(G,{cls:["mdMarkup"]},q+v.index+v[1].length+v[2].length,v[1].length));var re=V.replace(I,"   $2   ");for(A.lastIndex=0;null!==(v=A.exec(re));)this.isInTag(v)||this.getElAtOffset(G,v.index).hasClass("link")||(this.insertEl(G,{cls:["mdMarkup"]},q+v.index,v[1].length),this.insertEl(G,{cls:["mdSpan","mdBold"]},q+v.index+v[1].length,v[2].length),this.insertEl(G,{cls:["mdMarkup"]},q+v.index+v[1].length+v[2].length,v[1].length));for(re=re.replace(A,"  $2  "),w.lastIndex=0;null!==(v=w.exec(re));)this.isInTag(v)||this.getElAtOffset(G,v.index).hasClass("link")||(this.insertEl(G,{cls:["mdMarkup"]},q+v.index,v[1].length),this.insertEl(G,{cls:["mdSpan","mdItalic"]},q+v.index+v[1].length+v[2].length,v[3].length),this.insertEl(G,{cls:["mdMarkup"]},q+v.index+v[1].length+v[2].length+v[3].length+v[2].length,v[1].length));for(D.lastIndex=0,null!==(v=D.exec(V))&&this.insertEl(G,{cls:["mdSpan","mdHR","c-border-heavy"]},0,H.length),_.lastIndex=0;null!==(v=_.exec(H));)this.getElAtOffset(G,v.index).hasClass("link")||this.insertEl(G,{cls:["email","c-contact"]},v.index,v[1].length)}if(m&&m.___info___.count>0&&H.indexOf(ContactPrefix)>=0){var ae,se=H.split(" "),oe=0;for(F=0;F<se.length;F++){var ce=se[F].replace(M,"$2"),le=se[F].indexOf(ce);if(0===ce.indexOf(ContactPrefix)){ae=void 0;var de=ce.substring(1);for(B=1;;B++){if(""===m[de])ae=de;else{var he=this.trimPunc(de);""===m[he]&&(ae=he)}if(!(F+B<se.length))break;de+=" "+se[F+B]}ae&&(W++,this.insertEl(G,{cls:["contact","c-contact"]},oe+le,ae.length+1))}oe+=se[F].length+1}}for(y.lastIndex=0;null!==(v=y.exec(H));){var ue=v.index+v[1].length-1,pe=v[2].length+1;o.indexOf(v[2].charAt(v[2].length-1))>=0&&pe--,k?k.push(v[2]):k=[v[2]],this.insertEl(G,{cls:["tag","c-tag"]},ue,pe)}for(b.lastIndex=0;null!==(v=b.exec(H));){var q=v[0].indexOf(DatePrefix),me=!1;for(F=1;F<v.length&&v[F];++F)if(me)v[F]=void 0;else{var fe=v[F][v[F].length-1];o.indexOf(fe)>=0&&(v[F]=v[F].slice(0,-1),me=!0)}var ge,ve=!f&&this.parseRepeatDate(s,c,h,u,p,H.substr(v.index+q+1));if(ve||v[1].startsWith("every")||"in"===v[1]){if(ve){ge=v.index+q,ve.replacedDate?(this.insertEl(G,{cls:["date","c-date"]},ge,ve.repLength+1),this.replaceTextInEls(G,ve.text,ge+1,ve.repLength),H=H.substr(0,ge+1)+ve.text+H.substr(ge+ve.repLength+1),U=!0):this.insertEl(G,{cls:["date","c-date"]},ge,ve.repLength+1),x?x.push(ve):x=[ve];var ye=new Date(ve.startDate);if(ye.hasTimeOfDay()){var be=ge+ve.text.length+1,Se=H.substr(be),Ee=this.parseDuration(ye,Se,h);if(Ee){var Ce=ge+ve.oldText.length+1;this.insertEl(G,{cls:["duration","c-date"]},Ce,Ee.durationText.length+1),O?O.push(Ee):O=[Ee]}}break}}else{var Pe=[v[1]?v[1]:"",v[2]?v[2]:"",v[3]?v[3]:""];if(e.isDateSoft(Pe[0])){var Te=!0;"NEXT"===Pe[0].toUpperCase()&&this.runDateParse(Pe,h)&&(Te=!1),Te&&(r=this.getNowRelativeDate(Pe[0]),Pe[1]="",Pe[2]="")}var De=this.computeDateInfo(r,c,h,a.getCurrentDateFormat(),p,Pe);if(De.isValid){var Me;ge=v.index+q,De.replacedDate?(this.insertEl(G,{cls:["date","c-date"]},ge,De.oldText.length+1),this.replaceTextInEls(G,De.text,ge+1,De.oldText.length),H=H.substr(0,ge+1)+De.text+H.substr(ge+De.oldText.length+1),U=!0,Me={type:DateType.Once,date:De.date,dateFormat:De.format,origText:De.oldText,text:De.text,explicitTime:De.date.hasTimeOfDay()}):(this.insertEl(G,{cls:["date","c-date"]},ge,De.text.length+1),Me={type:DateType.Once,date:De.date,dateFormat:De.format,origText:De.oldText,text:De.text,explicitTime:De.date.hasTimeOfDay()}),x?x.push(Me):x=[Me];var be=ge+De.text.length+1,Se=H.substr(be),Ee=this.parseDuration(De.date,Se,h);Ee&&(this.insertEl(G,{cls:["duration","c-date"]},be,Ee.durationText.length+1),Me.explicitTime||Ee.duration%e.days(1)==0||(Me.explicitTime=!0),O?O.push(Ee):O=[Ee]);break}}}R&&(C.lastIndex=0,H=H.replace(C,window.AttachChar));var _e={parsedText:U?H:void 0,dates:x,durations:O,tags:k,attachments:R,numContacts:W,prefix:L,prefixType:N,els:G};return l--,_e},getDurationLength:function(t){var i=O.len.exec(t),n=parseFloat(i[1]),r=0;switch(R[i[2].toLowerCase()]){case R.Hours:r=e.hours(n);break;case R.Minutes:r=e.minutes(n);break;case R.Days:r=e.days(n);break;default:try{e.PAssert(3693,!1,"Invalid duration length: "+i[2])}catch(t){e.reportError(t)}}return r},parseDuration:function(e,t,i){this.setDateTokens(t);var n=0;if(this.checkAndParse(O.duration)){if(R[h.toLowerCase()]===R.EndDate)if(this.checkAndParse(v,2)){var r=this.getTimeFromString(h),a=e.clone();a.setHours(r.hour),a.setMinutes(r.min),n=a-e}else this.checkAndParseDate(i)&&(n=p-e);else if(R[h.toLowerCase()]===R.Duration){for(;this.checkAndParse(O.len);)n+=this.getDurationLength(h);n--}}else{for(;this.checkAndParse(O.len);)n+=this.getDurationLength(h);n--}var s;return n>0&&(s={durationText:t.substr(1,L).trim(),duration:n}),s},getSoftText:function(e,t){return t<0?t>=-864e5?"yesterday":e.toString(a.getFormat(DFormat.MonthDayYear)):t<=864e5&&e.isToday()?"today":t<1728e5?"tomorrow":void 0},runDateParse:function(e,t){var i=e.join(""),n=a.parseDate(i,t);return!n&&e[1]&&(i=e[0]+e[1],n=a.parseDate(i,t)),!n&&e[0]&&(i=e[0],n=a.parseDate(i,t)),{dt:n,dateString:i}},computeDateInfo:function(t,i,n,r,s,o){var c,l,d=new Date(t).clearTime(),h=(new Date).clearTime(),u=d-h,p=i||o.join(""),m=p,f=!1;if(this.isFlagSet(s,ChangeType.Auto)||this.isFlagSet(s,ChangeType.Remote)&&this.isFlagSet(s,ChangeType.DocLoad)){if(c=new Date(t),void 0!==t&&(u<0||u>=0&&u<1728e5)){var y;if(g.lastIndex=0,null!==(y=g.exec(p))){if("NEXT"!==p.toUpperCase()&&(l=this.getSoftText(c,u))&&!p.toUpperCase().startsWith(l.toUpperCase())){if(void 0===i){var b=this.runDateParse(o,n);p=b.dateString}m=p.replace(y[0],l),f=!0}}else if(null!==(y=v.exec(p))){if((l=this.getSoftText(c,u))&&"today"!==l){if(void 0===i){var b=this.runDateParse(o,n);p=b.dateString}m=l+" "+p,f=!0}}else if(void 0===t||void 0===i){var b=this.runDateParse(o,n);b.dateString!==i&&(c=b.dt,p=b.dateString,m=b.dateString)}}else if(void 0===t||void 0===i){var S=this.isFlagSet(s,ChangeType.Rollover);if(e.isDemoMode()||!this.isFlagSet(s,ChangeType.Auto)||S){var b=this.runDateParse(o,n);c=b.dt,m=b.dateString,S||(p=b.dateString)}else void 0===t&&(c=void 0)}}else if(this.isFlagSet(s,ChangeType.Local)||this.isFlagSet(s,ChangeType.Remote))if(this.isFlagSet(s,ChangeType.PluginLoad))c=t?new Date(t):void 0;else{var b=this.runDateParse(o,n);c=b.dt,p=b.dateString,m=b.dateString}else{var b=this.runDateParse(o,n);c=b.dt,p=b.dateString,m=b.dateString}try{e.PAssert(3694,!c||!isNaN(c.getTime()),"Must be a valid parsed date")}catch(t){e.reportError(t)}var E;return n!==r?(E=a.convertDateFormat(m,n,r),f=!0):E=m,{isValid:!!c,oldText:p,text:E,date:c,format:n,replacedDate:f}},getRepeatStartDate:function(e){if(e&&"string"==typeof e){var t=e.split("|");if(t.length>3&&"1"===t[0])return new Date(parseInt(t[1]))}},setDateTokens:function(e){h=void 0,u=e.split(" "),F=1,L=u[0].length,N=0,p=void 0},checkAndParse:function(e,t){var i=!1;if(void 0===(t=void 0!==t&&t>1?Math.min(u.length-F,t):t)||1===t)F<u.length&&(i=u[F].match(e))&&(h=u[F],F++,L+=h.length+1);else if(t>1&&F+t<=u.length)for(var n=t;n>0;n--){for(var r="",a=0;a<n;++a)r+=u[F+a],a+1!==n&&(r+=" ");if(i=r.match(e)){h=r,F+=n,L+=r.length+1;break}}return i},checkAndParseDate:function(e){var t=!1;if(F+1<u.length&&!u[F+1].match(k.at)){var i=a.parseDate(u[F]+" "+u[F+1],e);i&&(t=!0,h=u[F]+u[F+1],p=i,F+=2,L+=h.length+2)}if(!t&&F<u.length){var n=a.parseDate(u[F],e);n&&(t=!0,h=u[F],p=n,F++,L+=h.length+1)}return t},computeStartDate:function(e,t,i,n,r,a){var s=a||new Date,o=(a?new Date(a):new Date).clearTime();if(void 0!==n&&o.setMonth(n),void 0!==i&&i>0&&i<=31){(Date.getDaysInMonth(o.getFullYear(),o.getMonth())<i||i<o.getDate())&&void 0===n&&o.addMonths(1),o.setDate(i)}return void 0!==t?(o.moveToNthOccurrence(e,t),o.isBefore(s)&&(o.addMonths(1),o.moveToNthOccurrence(e,t))):void 0!==e&&o.getDay()!==e&&(o.moveToDayOfWeek(e,-1),o.isBefore(s)&&o.moveToDayOfWeek(e)),void 0!==n&&o.isBefore(s)&&(o.addYears(1),o.setMonth(n)),r&&this.updateDateWithTime(o,r),o},updateDateWithTime:function(e,t){var i=this.getTimeFromString(t);e.setHours(i.hour),e.setMinutes(i.min),e.setMilliseconds(1)},getTimeFromString:function(t){var i,n,r,a,s,o=v.exec(t);void 0!==o[1]?(i=o[3].toUpperCase(),n=i===Date.CultureInfo.pmDesignator[0]||i===Date.CultureInfo.pmDesignator,r=e.parseInt(o[1])+(n?12:0),a=o[2]?e.parseInt(o[2]):0,s=o[1]):void 0!==o[4]&&void 0!==o[5]&&(r=e.parseInt(o[4]),a=e.parseInt(o[5]),s=o[4]);var c=!1;if(s){var l=e.parseInt(s);(s.startsWith("0")||0===l||l>12)&&(c=!0)}return i||c?i&&!c&&(n||12!==r?n&&24===r&&(r=12):r=0):r<8&&(r+=12),{hour:r,min:a}},parseRepeatDate:function(t,i,n,r,s,o){var c,l,d,u,g,v,y,b,S=!1,E=Date.today(),C=RepeatFreq.Daily,P=1;if(o.match(k.repeat)){this.setDateTokens(o);var T=!1;if(this.checkAndParse(k.recur)){switch(h){case"other":P=2;break;case"last":C=RepeatFreq.NthMonthInst,v=-1;break;default:C=RepeatFreq.NthMonthInst,v=x[h.substr(0,3).toLowerCase()]}T=!0}if(T&&"other"!==h||!this.checkAndParse(k.date))if(!T&&this.checkAndParse(k.count)){var D=e.parseInt(h);isNaN(D)&&(D=x[h]),this.checkAndParse(k.measure)&&(C=x[h.toLowerCase()],P=D,S=!0)}else if(this.checkAndParse(k.day)){C!==RepeatFreq.NthMonthInst&&(C=RepeatFreq.Weekly),g=x[h.substr(0,3).toLowerCase()];for(var M;(h.endsWith(",")||this.checkAndParse(k.delim))&&this.checkAndParse(k.day);){var _=x[h.substr(0,3).toLowerCase()];M?M.push(_):M=[g,_]}M&&(M.sort(),d=M),S=!0}else if(this.checkAndParse(k.daysOfWeek))C=RepeatFreq.Weekly,"weekday"===h?d=[1,2,3,4,5]:"weekend"===h&&(d=[0,6]),S=!0;else if(this.checkAndParse(k.month)){var I=h;if(this.checkAndParse(k.date)){var A=parseInt(h);A>0&&A<=31&&(y=A,b=x[I.substr(0,3).toLowerCase()],C=RepeatFreq.Yearly,S=!0)}}else if(T&&"other"!==h||!this.checkAndParse(k.len))if(T&&"last"!==h||!this.checkAndParse(k.len))T&&"other"!==h&&(C=RepeatFreq.DayOfMonth,y=v,v=void 0,S=!0);else switch(h){case"day":S=!0,C=RepeatFreq.EndOfMonthOffset}else{switch(h){case"day":C=RepeatFreq.Daily;break;case"week":C=RepeatFreq.Weekly;break;case"month":C=RepeatFreq.Monthly;break;case"year":C=RepeatFreq.Yearly;break;case"morning":C=RepeatFreq.Daily,u="9:00am";break;case"afternoon":C=RepeatFreq.Daily,u="2:00pm";break;case"night":C=RepeatFreq.Daily,u="7:00pm"}S=!0}else{for(var w,R=e.parseInt(this.trimPunc(h));(h.endsWith(",")||this.checkAndParse(k.delim))&&this.checkAndParse(k.date);){var O=e.parseInt(this.trimPunc(h));O>0&&O<=31&&(w?w.push(O):w=[R,O])}w&&w.length>1?(w.sort(e.numberComparator),C=RepeatFreq.DayOfMonth,y=w[0],d=w,S=!0):R>0&&R<=31&&(isNaN(R)||(C=RepeatFreq.DayOfMonth,y=R,S=!0),this.checkAndParse(k.measure)?(C=x[h.toLowerCase()],P=R,y=void 0,S=!0):(this.checkAndParse(k.of),this.checkAndParse(k.month)&&(y=R,b=x[h.substr(0,3).toLowerCase()],C=RepeatFreq.Yearly,S=!0)))}var F=!1;this.checkAndParse(k.at)&&(F=!0),this.checkAndParse(k.time,2)&&(u=h,S=!0);var B=!1,U=!1;if(this.checkAndParse(k.in)){U=!0;var H,V;this.checkAndParse(k.month)&&(H=x[h.substr(0,3).toLowerCase()]),this.checkAndParse(k.year)&&(V=parseInt(h)),void 0===H&&void 0===V||(l=new Date,q=new Date,B=!0,V&&(l.setYear(V),l.setMonth(11),q.setYear(V),q.setMonth(0)),void 0!==H&&(void 0!==V&&(l.getMonth()>H&&l.addYears(1),q.getMonth()>H&&q.addYears(1)),l.setMonth(H),q.setMonth(H)),l.moveToLastDayOfMonth(),q.setDate(1))}var q,W=L+1,z=L;this.checkAndParse(k.from)?(W=L+1,this.checkAndParseDate(n)&&(B&&!p.isAfter(q)||(q=p),B=!1,N=L)):N=L;var G=!1;F||u||(this.checkAndParse(k.at)&&(F=!0,G=!0),this.checkAndParse(k.time,2)&&(u=h,G=!0)),U||this.checkAndParse(k.until)&&this.checkAndParseDate(n)&&(l=p,G=!0),l&&l.isBefore(q)&&(S=!1)}else"everyday"===o&&(this.setDateTokens(o),S=!0,C=RepeatFreq.Daily,P=1);if(S){var j=this.getRepeatStartDate(t),K=this.isFlagSet(s,ChangeType.Remote)?j:q;if(d&&C===RepeatFreq.Weekly)for(var Y=(K||new Date).getDay(),X=0;X<d.length;++X)if(d[X]>=Y){g=d[X];break}var E=this.computeStartDate(g,v,y,b,u,K),Q=!!E;if(E&&(E.isBefore(f)&&(Q=!1),l&&l.isBefore(E)&&(Q=!1)),Q){var J,$,Z=!1,ee=o.substr(0,L);if(!r&&q&&t&&!B){$=o.substr(W,N);var te=this.computeDateInfo(j,void 0,n,n,s,[$]);te.replacedDate&&($=te.text)}else r&&r!==m&&(this.isFlagSet(s,ChangeType.Text)||($=a.formatDate(new Date(r),DFormat.MonthDayYear,n)));if($){var ie=o.substr(W,N);if(ie.toUpperCase()!==$.toUpperCase()){var ne=a.parseDate($,n);ne&&(u&&this.updateDateWithTime(ne,u),ee=ee.substr(0,z)+" from "+$+(G?ee.substr(N):""),J=ne.getTime(),Z=!0)}}var re,ae=o.substr(0,L),se=a.getCurrentDateFormat();n!==se?(re=a.convertDateFormat(ee,n,se),Z=!0):re=ee,c={type:DateType.Repeat,repLength:L,oldText:ae,text:re,dateFormat:n,startDate:J||E,endDate:l,frequency:C,separation:P,offsets:d,replacedDate:Z}}}return c},isInTag:function(e){for(var t=e.index;t>=0;t--){if(" "===e.input[t])return!1;if("#"===e.input[t])return!0}return!1}},new s}),define("DisplaySettings",["require","globals","util","platform","EventDispatcher","Sel"],function(e){function t(){this.styles={},this.stylesheet={},this.Themes={Classic:{showBullets:!1,bulletOpacity:50,checkboxOpacity:50,checkboxBackgroundOpacity:0,showVerticalLines:!1,boldHeaders:!0,itemLineHeight:18,itemPadding:7,itemIndentSize:20,fontSize:14,fontSizeHeader:14,fontSizeHeaderTopLevel:14},Outliner:{showBullets:!0,bulletOpacity:80,checkboxOpacity:80,checkboxBackgroundOpacity:0,showVerticalLines:!0,boldHeaders:!1,itemLineHeight:20,itemPadding:2,itemIndentSize:36,fontSize:15,fontSizeHeader:15,fontSizeHeaderTopLevel:15},Light:{showBullets:!0,bulletOpacity:20,checkboxOpacity:30,checkboxBackgroundOpacity:0,showVerticalLines:!0,boldHeaders:!1,itemLineHeight:20,itemPadding:3,itemIndentSize:20,fontSize:14,fontSizeHeader:14,fontSizeHeaderTopLevel:14},Markdown:{showBullets:!1,bulletOpacity:40,checkboxOpacity:25,checkboxBackgroundOpacity:0,showVerticalLines:!1,boldHeaders:!1,itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSize:14,fontSizeHeader:16,fontSizeHeaderTopLevel:20}},this.Defaults={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,Colors:{light:{bulletColor:"#444444",verticalLinesColor:"#EEEEEE",tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{bulletColor:"#F6F6F6",verticalLinesColor:"#262626",tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}};this.timeoutSettingChanged=void 0,r.forceBind("_updateSettings",this),r.forceBind("updateStyles",this),this.updateSettingValues(),a.mobile||(n.settings.listen("settingChanged",Settings.UISettingsGroup,this.onSettingChanged.bind(this)),n.runOnLoad(this.updateStyles))}var i,n=e("globals"),r=e("util"),a=e("platform"),s=e("EventDispatcher");return t.prototype={getSettingValue:function(e,t){var i=!t;if(t)if(n.billingManager)if(n.billingManager.hasPremiumFeatures())i=!0;else{var r=n.billingManager.getPremiumStatus();i=r===PremiumStatus.Unknown||r===PremiumStatus.Trial||r===PremiumStatus.Active||r===PremiumStatus.Never}else i=!0;if(i){var a=n.settings.get(e,Settings.UISettingsGroup);return a===this.Defaults.Desktop.Colors.light[e]?this.Defaults.Desktop.Colors[this._colorTheme][e]:a}return this.getThemeValue(e)},getThemeValue:function(e){var t=n.settings.get(Settings.layoutTheme,Settings.UISettingsGroup)||"Markdown",i=this.Themes[t][e];return void 0===i&&void 0===(i=this.Defaults.Desktop[e])&&(i=this.Defaults.Desktop.Colors[this._colorTheme][e]),i},setFromThemeValue:function(e){n.settings.set(e,this.getThemeValue(e),Settings.UISettingsGroup)},updateSettingValues:function(){this._colorTheme=n.settings.get(Settings.theme),this._bulletColor=this.Defaults.Desktop.Colors[this._colorTheme].bulletColor,this._showBullets=this.getSettingValue(Settings.showBullets),this._boldHeaders=this.getSettingValue(Settings.boldHeaders),this._fontSize=this.getSettingValue(Settings.fontSize,!0),this._fontSizeHeader=this.getSettingValue(Settings.fontSizeHeader,!0),this._fontSizeHeaderTopLevel=this.getSettingValue(Settings.fontSizeHeaderTopLevel,!0),this._noteFontSize=this.getSettingValue(Settings.noteFontSize,!0),this._itemPadding=this.getSettingValue(Settings.itemPadding,!0),this._notePadding=this.getSettingValue(Settings.notePadding,!0),this._itemLineHeight=this.getSettingValue(Settings.itemLineHeight,!0),this._noteLineHeight=this.Defaults.Desktop.noteLineHeight,this._itemIndentSize=this.getSettingValue(Settings.itemIndentSize,!0),this._bulletOpacity=this.getSettingValue(Settings.bulletOpacity,!0),this._checkboxOpacity=this.getSettingValue(Settings.checkboxOpacity,!0),this._checkboxBackgroundOpacity=this.getSettingValue(Settings.checkboxBackgroundOpacity,!0),this._showVerticalLines=this.getSettingValue(Settings.showVerticalLines,!0),this._verticalLinesColor=this.getSettingValue(Settings.verticalLinesColor,!0),this._tagColor=this.getSettingValue(Settings.tagColor,!0),this._dateColor=this.getSettingValue(Settings.dateColor,!0),this._contactColor=this.getSettingValue(Settings.contactColor,!0),this._linkColor=this.getSettingValue(Settings.linkColor,!0),this._grayscale=this.getSettingValue(Settings.grayscale)},onSettingChanged:function(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))},_updateSettings:function(){var t=this._fontSize,r=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var s=this._fontSize!==t||this._noteFontSize!==r;this.fireEvent("settingsChanged",[s]),n.vmMain&&n.vmMain.paneManager&&n.vmMain.paneManager.clearPaneCaches(),a.mobile||this.updateStyles(),n.vmMain&&n.vmMain.updateAllItems(!1,!0),i=i||e("Sel");try{n.PAssert(3695,i,"Sel was not yet loaded")}catch(e){n.reportError(e)}i&&i.updateCaret()},fontSize:function(){return a.mobile?15:this._fontSize},fontSizeHeader:function(){return this._fontSizeHeader},fontSizeHeaderTopLevel:function(){return this._fontSizeHeaderTopLevel},noteFontSize:function(){return a.mobile?12:this._noteFontSize},itemPadding:function(){return a.mobile?7:this._itemPadding},notePadding:function(){return a.mobile?0:this._notePadding},itemLineHeight:function(){return a.mobile?18:this._itemLineHeight},noteLineHeight:function(){return a.mobile?18:this._noteLineHeight},itemIndentSize:function(){return a.mobile?20:this._itemIndentSize},itemIndentStart:function(e){return a.phone?24:e.supportBullets&&this._showBullets?45:30},paddingForItemBottom:function(e){return e.hasNote()?0:this.itemPadding()},paddingForItemTop:function(e){return e.isNote()?this.notePadding():this.itemPadding()},fontSizeForItem:function(e,t){return e.isPrefixHeader()?t.isItemTopLevel(e)?this.fontSizeHeaderTopLevel():this.fontSizeHeader():e.isNote()?this.noteFontSize():this.fontSize()},lineHeightForItem:function(e,t){var i=this.itemLineHeight()-this.fontSize();return e.isNote()?this.noteLineHeight():this.fontSizeForItem(e,t)+i},boldHeaders:function(){return!!a.phone||this._boldHeaders},createSheet:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.rel="stylesheet",e.appendChild(t),this.sheet=t.sheet},changeColorTheme:function(e){e!==this._colorTheme&&(this._colorTheme=e,n.settings.set(Settings.theme,e),this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))},changeTheme:function(e){this.isChangingTheme=!0,n.settings.set(Settings.layoutTheme,e,Settings.UISettingsGroup),this.setFromThemeValue(Settings.showBullets),this.setFromThemeValue(Settings.bulletOpacity),this.setFromThemeValue(Settings.checkboxOpacity),this.setFromThemeValue(Settings.checkboxBackgroundOpacity),this.setFromThemeValue(Settings.showVerticalLines),this.setFromThemeValue(Settings.boldHeaders),this.setFromThemeValue(Settings.itemLineHeight),this.setFromThemeValue(Settings.itemPadding),this.setFromThemeValue(Settings.itemIndentSize),this.setFromThemeValue(Settings.fontSize),this.setFromThemeValue(Settings.fontSizeHeader),this.setFromThemeValue(Settings.fontSizeHeaderTopLevel),this.isChangingTheme=!1,this._updateSettings()},updateStyles:function(){try{n.PAssert(3696,!a.mobile,"Should not be running display settings on mobile")}catch(e){n.reportError(e)}if(!a.mobile){if(this.sheet){var e=this.sheet.ownerNode;e.parentNode.removeChild(e)}this.createSheet();var t=[];if(this.boldHeaders()&&t.push(".paneOutline .item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var i=this.itemIndentSize(),r=this._verticalLinesColor,s="rgba(255,255,255,0)";t.push(".vertLines { background: repeating-linear-gradient(to right, "+s+" 0, "+r+" 1px, "+s+" 2px, "+s+" "+i+"px) }")}t.push(".item:not(.hasNote) .line.last .itemPrefix:not(.prefixTask):before { bottom: "+this.itemPadding()+"px; }"),t.push(".item:not(.hasNote) .line.last .prefixTask:before { bottom: "+(this.itemPadding()+(this.itemLineHeight()-18)/2)+"px; }"),t.push(".line:not(.last) .prefixTask:before { bottom: "+(this.itemLineHeight()-18)/2+"px; }");var o="rgba("+n.hexToRgbStr(this._bulletColor)+","+.01*this._bulletOpacity+")";t.push(".prefixBullet:before { color: "+o+"; }"),t.push(".bullet { color: "+o+"; }"),t.push(".collapser { color: "+o+"; }");var c="rgba("+n.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxOpacity+")";t.push(".prefixTask { border-color: "+c+"; }");var l="rgba("+n.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxBackgroundOpacity+")";t.push(".prefixTask:not(.searchButton) { background-color: "+l+"; }"),t.push(".c-tag { color: "+this._tagColor+";}"),t.push(".c-date { color: "+this._dateColor+";}"),t.push(".c-contact { color: "+this._contactColor+";}"),t.push(".c-link { color: "+this._linkColor+";}"),t.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+this.Defaults.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }")
;n.settings.get(Settings.underlineP,Settings.UISettingsGroup)?n.addClass(document.body,"underlineTags"):n.removeClass(document.body,"underlineTags"),this._grayscale?n.addClass(document.body,"grayscale"):n.removeClass(document.body,"grayscale"),n.removeClass(document.body,"theme-light"),n.removeClass(document.body,"theme-dark"),n.addClass(document.body,"theme-"+this._colorTheme);for(var d=0;d<t.length;d++)this.sheet.insertRule(t[d],0)}},tagColor:function(){return this._tagColor},dateColor:function(){return this._dateColor},contactColor:function(){return this._contactColor},isDark:function(){return!a.mobile&&"dark"===this._colorTheme}},r.extend(t.prototype,s),new t}),define("FakeRange",["globals"],function(e){function t(e){this._range=e,this._range||(this._range=i._getSelectionRange())}var i;return require(["NativeSel"],function(e){i=e}),t.prototype={isValid:function(){return!!this._range},getNativeRange:function(){return this._range},getStartContainer:function(){return this._range.startContainer},getEndContainer:function(){return this._range.endContainer},getStartElement:function(){return e.getElementParent(this.getStartContainer())},getEndElement:function(){return e.getElementParent(this.getEndContainer())},getSelectOffsetsInElement:function(e){return i.getSelectOffsetsInElement(e,this._range)},getStartOffset:function(){return this._range.startOffset},getEndOffset:function(){return this._range.endOffset}},t}),define("NativeSel",["globals","platform","FakeRange"],function(e,t,i){function n(){}return n.prototype={createFakeRange:function(e,t,n,r){var a=this.createSelectionRange();return a.setStart(e,t),a.setEnd(n,r),new i(a)},createSelectionRange:function(){return document.createRange()},setSelection:function(i,n,r,a,s){if("TEXTAREA"===i.nodeName){try{e.PAssert(3697,i===r,"Cannot multiselect textareas")}catch(t){e.reportError(t)}i.focus(),i.selectionStart=n,i.selectionEnd=a,!s&&t.android&&setTimeout(this.setSelection.bind(this,i,n,r,a,!0),0)}else{var o=this.createSelectionRange();this.setSelectionValues(o,i,n,r,a),this.setSelectionRange(o)}},setSelectionRange:function(e){var t=window.getSelection();t.removeAllRanges(),e instanceof i&&(e=e.getNativeRange()),t.addRange(e)},insertNode:function(e){var t=this._getSelectionRange();t&&t.insertNode(e)},selectAfterNode:function(e){var t=document.createRange();t.setStartAfter(e),this.setSelectionRange(t)},setSelectionRangeToWhatItAlreadyIs:function(){var e=this._getSelectionRange();e&&this.setSelectionRange(e)},hasValidSelection:function(){return this.getSelectionRange(!0).isValid()||t.android&&document.activeElement&&"TEXTAREA"===document.activeElement.nodeName},getSelectionRange:function(e){var t;return e&&(t=this._getSelectionRange()),new i(t)},_getSelectionRange:function(){var e,t=window.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e},getSelectionNode:function(){var e=window.getSelection(),t=e.anchorNode;if(t)return t.nodeType===Node.TEXT_NODE?t.parentNode:t},getSelectedText:function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:void 0},clearSelection:function(){window.getSelection().removeAllRanges()},hasSelection:function(){var t=this._getSelectionRange();if(t&&t.startContainer!==document.documentElement){return e.getPaneForElement(t.startContainer)&&e.findParent(t.startContainer,"paneContent")}return!1},hasRawSelection:function(){return!!window.getSelection().anchorNode},getCursorSelectionRange:function(t){var n,r=e.ensureDOMNode(t.target);if(r){try{e.PAssert(3698,e.findParent(r,"item"),"getCursorSelectionRange must only be called when hovered item is item",r)}catch(t){e.reportError(t)}var a=r.getBoundingClientRect(),s=e.clamp(t.clientY,a.top+9,a.bottom-9);n=this._getCursorSelectionRange(t.clientX,s)}return n?new i(n):void 0},_getCursorSelectionRange:function(t,i){var n;if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(t,i);else if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(t,i);r&&(n=document.createRange(),n.setStart(r.offsetNode,r.offset),n.setEnd(r.offsetNode,r.offset))}else if(document.body.createTextRange){var a=this._getSelectionRange(),s=document.body.createTextRange();try{s.moveToPoint(t,i),s.select(),n=this._getSelectionRange(),this.setSelectionRange(a)}catch(e){}}else try{e.PAssert(3699,!1,"Unable to get selection range at cursor")}catch(t){e.reportError(t)}return n},_ensureSelectionInElement:function(t,i){try{e.PAssert(3700,t,"Must have a valid element")}catch(t){e.reportError(t)}try{e.PAssert(3701,i,"Must have a valid range")}catch(t){e.reportError(t)}e.isAncestor(i.startContainer,t)||i.setStart(t,0),e.isAncestor(i.endContainer,t)||i.setEnd(t,0),e.hasClass(i.startContainer,"textSelected")&&i.setStart(i.startContainer.parentElement.firstElementChild,i.startContainer.innerText.length),e.hasClass(i.endContainer,"textSelected")&&i.setEnd(i.endContainer.parentElement.firstElementChild,i.endContainer.innerText.length),e.hasClass(i.startContainer,"itemAddButton")&&i.setStartBefore(i.startContainer),e.hasClass(i.endContainer,"itemAddButton")&&i.setEndBefore(i.endContainer);var n=e.getPluginForElement(i.startContainer);if(n){var r=n.textContent.length,a=n.nodeType===Node.TEXT_NODE;!a&&0===i.startOffset||a&&i.startOffset<r/2?i.setStartBefore(n):i.setStartAfter(n)}var s=e.getPluginForElement(i.endContainer);if(s){var o=s.textContent.length,a=s.nodeType===Node.TEXT_NODE;!a&&0===i.endOffset||a&&i.endOffset<o/2?i.setEndBefore(s):i.setEndAfter(s)}},getSelectOffsetsInElement:function(t,i){var n={start:0,end:0,total:0};if("TEXTAREA"===t.nodeName){n.start=t.selectionStart,n.end=t.selectionEnd,n.total=t.value.length;var r=t.value.indexOf("\n");r>=0&&n.start>r&&(n.start--,n.end--,n.total--)}else if(t){try{e.PAssert(3702,i,"Must provide a valid range")}catch(t){e.reportError(t)}if(i){this._ensureSelectionInElement(t,i);var a=this._getComponentNode(i.startContainer,i.startOffset),s=i.startOffset,o=this._getComponentNode(i.endContainer,i.endOffset),c=i.endOffset;a&&a.textContent===TextSpace&&(s=0),o&&o.textContent===TextSpace&&(c=0);var l=0,d=this._getComponentNodesIn(t);if(d.length>0)for(var h=0;h<d.length;++h)d[h]===a&&(n.start=l+s),d[h]===o&&(n.end=l+c),l+=this._getComponentNodeLength(d[h]),void 0===o&&(h===c-1?n.end=l:0===h&&0===c&&(n.end=0)),void 0===a&&(h===s-1?n.start=l:0===h&&0===s&&(n.start=0));else n.start=0,n.end=0;n.total=l,isNaN(n.end)&&(n.end=l)}}try{e.PAssert(3703,!isNaN(n.start)&&!isNaN(n.end),"Must have valid start and end",n)}catch(t){e.reportError(t)}return n},getSelectOffsetsForMouseEvent:function(t){var i=e.getElementParent(t.target),n=this.getCursorSelectionRange(t);return n&&n.getSelectOffsetsInElement(i)},getOffsetChildElement:function(t,i){try{e.PAssert(3704,t,"Must supply a valid element")}catch(t){e.reportError(t)}if("TEXTAREA"===t.nodeName)return{element:t,offset:i};if(this._isComponentNode(t)){try{e.PAssert(3706,this._isComponentSelectable(t),"Component must be selectable")}catch(t){e.reportError(t)}return{element:t,offset:i}}for(var n=0,r=this._getComponentNodesIn(t),a=0;a<r.length;++a){var s=this._getComponentNodeLength(r[a]);if(n+s>=i)return{element:r[a],offset:i-n};n+=s}try{e.PAssert(3705,!1,"Unable to find offset child element")}catch(t){e.reportError(t)}},getChildNodeOffset:function(t){try{e.PAssert(3707,t,"Must supply a valid child element")}catch(t){e.reportError(t)}for(var i=0,n=this._getComponentNodesIn(e.getElementParent(t)),r=this._getComponentNodesIn(t),a=0;a<n.length&&n[a]!==r[0];++a)i+=this._getComponentNodeLength(n[a]);return i},_getComponentNodeLength:function(t){try{e.PAssert(3708,this._isComponentNode(t),"Supplied node must be a valid component")}catch(t){e.reportError(t)}return e.hasClass(t,"plugin")?1:1===t.length&&t.textContent===TextSpace?0:t.length},_getComponentNodesIn:function(e){if(this._isComponentNode(e))return[e];var t=[];return this._getComponentNodes(t,e),t},_isComponentNode:function(t){var i=!1;return t&&(t.nodeType===Node.TEXT_NODE&&!e.getPluginForElement(t)||e.hasClass(t,"plugin"))&&(i=!0),i},_isComponentSelectable:function(t){try{e.PAssert(3709,!t||this._isComponentNode(t),"Must either be an invalid node (not-selectable) or a component")}catch(t){e.reportError(t)}var i=!1;return t&&t.nodeType===Node.TEXT_NODE&&(i=!0),i},_getComponentNodes:function(e,t){if(t)if(this._isComponentNode(t))e.push(t);else if(t.childNodes)for(var i=0;i<t.childNodes.length;++i){var n=t.childNodes[i];this._getComponentNodes(e,n)}},_getComponentNode:function(t){var i;if(this._isComponentNode(t))i=t;else{var n=e.getPluginForElement(t);n&&(i=n)}return i},setSelectionValues:function(t,i,n,r,a){try{e.PAssert(3710,t,"Range must be supplied")}catch(t){e.reportError(t)}try{e.PAssert(3711,this._isComponentNode(i),"Must be selecting a valid component")}catch(t){e.reportError(t)}try{e.PAssert(3712,this._isComponentNode(r),"Must be selecting a valid component")}catch(t){e.reportError(t)}try{e.PAssert(3713,i!==r||n<=a,"Select elements must be different, or selection must start before it ends")}catch(t){e.reportError(t)}if(i.nodeType===Node.TEXT_NODE)t.setStart(i,n);else{try{e.PAssert(3714,e.hasClass(i,"plugin"),"Only other valid component is plugin")}catch(t){e.reportError(t)}try{e.PAssert(3715,0===n||1===n,"Must eiter be selecting before or after the plugin")}catch(t){e.reportError(t)}0===n?this._selectBeforeComponent(t,i,"setStart"):1===n&&this._selectAfterComponent(t,i,"setStart")}if(r.nodeType===Node.TEXT_NODE)t.setEnd(r,a);else{try{e.PAssert(3716,e.hasClass(r,"plugin"),"Only other valid component is plugin")}catch(t){e.reportError(t)}try{e.PAssert(3717,0===a||1===a,"Must eiter be selecting before or after the plugin")}catch(t){e.reportError(t)}0===a?this._selectBeforeComponent(t,r,"setEnd"):1===a&&this._selectAfterComponent(t,r,"setEnd")}},_selectBeforeComponent:function(e,t,i){var n=this._getPrevComponent(t);if(this._isComponentSelectable(n))e[i](n,this._getComponentNodeLength(n));else{var r=document.createTextNode("");t.parentNode.insertBefore(r,t),e[i](r,0)}},_selectAfterComponent:function(e,t,i){var n=this._getNextComponent(t);if(this._isComponentSelectable(n))e[i](n,0);else{var r=document.createTextNode("");t.parentNode.insertBefore(r,void 0),e[i](r,0)}},_getPrevComponent:function(t){try{e.PAssert(3718,t,"Must supply a valid node")}catch(t){e.reportError(t)}try{e.PAssert(3719,this._isComponentNode(t),"Supplied node must be a valid component itself")}catch(t){e.reportError(t)}var i=t.previousSibling;try{e.PAssert(3720,!i||this._isComponentNode(i),"Siblings must always be valid components")}catch(t){e.reportError(t)}return i},_getNextComponent:function(t){try{e.PAssert(3721,t,"Must supply a valid node")}catch(t){e.reportError(t)}try{e.PAssert(3722,this._isComponentNode(t),"Supplied node must be a valid component itself")}catch(t){e.reportError(t)}var i=t.nextSibling;try{e.PAssert(3723,!i||this._isComponentNode(i),"Siblings must always be valid components")}catch(t){e.reportError(t)}return i},selectElement:function(e,t){var i;if(isNaN(t))i=this.createSelectionRange(),i.selectNodeContents(e);else{var n=this.getOffsetChildElement(e,t);n&&(i=this.createFakeRange(n.element,n.offset,n.element,n.offset))}i&&this.setSelectionRange(i)},getSelectionInElement:function(t){var i=this._getSelectionRange();if(i&&e.isAncestor(i.startContainer,t)&&e.isAncestor(i.endContainer,t)){return this.getSelectOffsetsInElement(t,i)}},deleteRangeContents:function(){var e=this._getSelectionRange();e&&e.deleteContents()}},new n}),define("Measure",["globals","data","Constants","CacheManager","platform","DuchessHelpers","Dispatcher","DisplaySettings","Observable","NativeSel"],function(e,t,i,n,r,a,s,o,c,l){function d(e){return Math.round(e*f)/f}var h={" ":!0,"-":!0},u={};u[window.AttachChar]=!0;var p=function(){this.fontSize=o.fontSize(),this.needsFontUpdate=!1,this.isNote=!1,this.isBold=!1,this.needsFontUpdate=!0,this.canvasContext=void 0,this.canvasElement=void 0,this.measureTextItem=new c,this.measureTextPane=new c,this.registerWordCaches(["Normal","Bold","Note","Header","HeaderTopLevel"]),this._lineCache=n.registerLocalCache("LineCache","LineCache",StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0,isPerDoc:!0}),this._itemCache={},this._loadCaches(),o.listen("settingsChanged",this.onDisplaySettingsChanged.bind(this))},m={CallCount:{GetCaretOffset:0,GetClassStyles:0,MeasureItem:0,MeasureLines:0,MeasureWord:0,GetOffsetForPositionInLine:0},Cache:{ItemCacheMiss:0,ItemCacheHit:0,LinesCacheMiss:0,LinesCacheHit:0,CanvasStyleHit:0,CanvasStyleMiss:0,WordCacheHit:0,WordCacheMiss:0}},f=100;return p.prototype={registerWordCaches:function(e){this._wordCaches=[];for(var t=0;t<e.length;t++){var i=e[t],r=n.registerLocalCache("WordCache"+i,"WordCache"+i,StorageType.LocalStorage,{isPerDoc:!0});this._wordCaches.push(r),this["_wordCache"+i]=r}},updateFont:function(e){this.needsFontUpdate||this.fontSize!==e.fontSize||e.isBold!==this.isBold||e.isNote!==this.isNote||e.isPrefixHeader!==this.isPrefixHeader||e.isHeaderTopLevel!==this.isHeaderTopLevel?(this.fontSize=e.fontSize,this.isBold=!!e.isBold,this.isNote=!!e.isNote,this.isPrefixHeader=e.isPrefixHeader,this.isHeaderTopLevel=e.isHeaderTopLevel,this.canvasFont=(this.isBold?"bold ":"")+this.fontSize+"px Helvetica Neue, Helvetica, Arial, Sans-serif",m.Cache.CanvasStyleMiss++,this.canvasContext&&(this.canvasContext.font=this.canvasFont),this.needsFontUpdate=!1):m.Cache.CanvasStyleHit++},getCanvasElement:function(){return this.canvasElement||(this.canvasElement=document.createElement("canvas")),this.canvasElement},getCanvasContext:function(e){return this.canvasContext||(this.canvasContext=this.getCanvasElement().getContext("2d")),this.updateFont(e),this.canvasContext},getMeasureStats:function(){return m},_getLineOffset:function(t,i,n){var r=t.childNodes,a=0;if(r)for(var s=0;s<r.length;s++){var o=r[s];if(o===i){a+=n;break}if(e.hasClass(o,"plugin")?a+=1:o.nodeType===Node.TEXT_NODE?o.nodeValue!==TextSpace&&(a+=o.length):o.childNodes.length>0&&(a+=this._getLineOffset(o,i,n)),i&&e.isAncestor(i,o))break}return a},_getCaretPosition:function(t,n,a,s){var c,d,h,u,p=e.element("measureTextItem"),m=p.querySelector(".line"),f=m.getBoundingClientRect(),g=0;t>n.getParsedText().length&&(t=n.getParsedText().length);var v=l._getSelectionRange();l.selectElement(p,t);var y,b=l._getSelectionRange();if(b){d=e.findParent(b.startContainer,"line");var S=e.findParent(b.startContainer,"itemPrefix",2);if(d){h=[].indexOf.call(d.parentNode.children,d),u=this._getLineOffset(d,b.startContainer,b.startOffset),e.hasClass(b.startContainer,"plugin")?(y=b.startContainer.getBoundingClientRect(),c={left:b.startOffset>0?y.right+12:y.left,top:y.top}):S&&t===n.getPrefixLength()?(y=S.getBoundingClientRect(),c={left:f.left+i.PrefixWidth+(r.isFirefox?0:5),top:y.top}):s&&u===this._getLineOffset(d)&&d.nextSibling?(d=d.nextSibling,y=d.getBoundingClientRect(),c={left:y.left+5,top:y.top},u=0,h++):(y=b.getBoundingClientRect(),y.left===y.right&&0===y.left&&(y=b.getClientRects()[0]),c={left:y.left,top:y.top}),r.isFirefox||(c.left-=5);for(var E=d.parentNode.childNodes,C=0;C<h;C++)g+=this._getLineOffset(E[C]);return v&&l.setSelectionRange(v),{left:c.left-f.left,top:c.top-f.top+o.paddingForItemTop(n,a)-o.itemPadding(),line:h,lineOffset:u,lineLength:this._getLineOffset(d),lineStart:g}}}try{e.PAssert(3724,!1,"Failed to compute caret position: ",t,n.getParsedText().length,e.getElementPath(p))}catch(t){e.reportError(t)}return{left:0,top:0,line:0,lineOffset:0,lineLength:0,lineStart:0}},_measureCaretPosition:function(t,i,n,r){for(var a=e.element("measureText"),s=e.element("measureTextItem"),c=n.getStyledLinesForItem(t,!1,!0),l="",d=0;d<c.length;d++){l+='<span class="line" style="'+("font-size:"+o.fontSizeForItem(t,n)+"px;line-height:"+o.lineHeightForItem(t,n)+"px")+'">'+(c[d]||TextSpace)+"</span>"}return a.className="pane "+n.paneClass,s.className="item "+t.styleProps(n),s.innerHTML=l,this._getCaretPosition(i,t,n,r)},getCaretOffset:function(e,t,i,n){var r=require("Sel");if(m.CallCount.GetCaretOffset++,isNaN(i)&&(i=e.getParsedText().length),void 0===n){var a=t.caretPosition.get();if(a&&r.getStartOffset()===r.getEndOffset()&&r.getStartIndex()===r.getEndIndex())n=a.left-t.getPaddingForItem(r.getStartItem())<30;else{var s=r.isArrowSelectInverted(),o=s?r.getStartOffset():r.getEndOffset(),c=s?r.getStartItem():r.getEndItem(),l=this._measureCaretPosition(c,o,t,!0),d=this._measureCaretPosition(c,o,t,!1);l.left!==d.left&&(n=!s)}}return this._measureCaretPosition(e,i,t,n)},getCaretScreenPosition:function(t,i,n){try{e.PAssert(3725,i>=0,"Must provide a valid index")}catch(t){e.reportError(t)}var r=t.itemAtIndex(i);try{e.PAssert(3726,r,"Must be able to find a valid item at index")}catch(t){e.reportError(t)}if(t.isIndexMounted(i)){var a=t.elementAtIndex(i);try{e.PAssert(3727,a,"Must be able to get element for item at index")}catch(t){e.reportError(t)}var s=t.getPaddingForItem(r),o=this.getCaretOffset(r,t,n),c={left:-1,top:-1};if(a){var l=a.getBoundingClientRect();c.left=o.left+l.left+s,c.top=o.top+l.top}return c}return{left:-1,top:-1}},_getClassStyles:function(t,i,n){m.CallCount.GetClassStyles++;try{e.PAssert(3728,e.isVMLI(t),"Item must be a valid VMLI instance")}catch(t){e.reportError(t)}var r=t.isNote(),a=t.isPrefixHeader(),s=t.isPrefixHeader()&&i.isItemTopLevel(t);return{isBold:a||t.isHeader()&&o.boldHeaders()&&i.type===PaneMode.Outline||n.hasClass("contact")||n.hasClass("date")||n.hasClass("duration")||n.hasClass("tag"),fontSize:t.isNote()?o.noteFontSize():s&&o.fontSizeHeaderTopLevel()||a&&o.fontSizeHeader()||o.fontSize(),isPrefixHeader:a,isHeaderTopLevel:s,isNote:r,attrs:n.getAttrs()}},measureLines:function(t,i,n,r){try{e.PAssert(3729,e.isVMLI(t),"Must provide a valid item to measure lines for")}catch(t){e.reportError(t)}try{e.PAssert(3730,e.isPane(i),"Must provide a valid pane to measure lines for")}catch(t){e.reportError(t)}try{e.PAssert(3731,n>=0,"Max width must be greater than 0: ",n)}catch(t){e.reportError(t)}m.CallCount.MeasureLines++;var a=this.getItemDisplayText(t),s=r||!t.requireStoredEls();try{e.PAssert(3732,t&&(t.els||!t.requireStoredEls()),"A Item has no els: ",t.__TEMP_InitCalled,t.__TEMP_InitParseCalled,t.__TEMP_ParseCalled,t.__TEMP_SkippedInitParsed,t.isArchived(),e.vmMain.hasDisplayedArchivedItems())}catch(t){e.reportError(t)}if(0===a.length||!t||!t.els&&t.requireStoredEls())return t&&e.vmMain.runSingleParse(t,ChangeType.Auto),[{text:"",start:0,length:0,width:0}];if(!s){var o=this.getLinesFromCache(t,i,n);if(o){for(var c=a.length,l=0,p=0;p<o.length;p++)l+=o[p].length;if(c===l)return m.Cache.LinesCacheHit++,o}else m.Cache.LinesCacheMiss++}var f,g=[],v=t.els,y=0,b="",S=0,E=[],C=0;if(v&&t.requireStoredEls())for(var p=0;p<v.length;++p){var P=v[p],f=this._getClassStyles(t,i,P),T=P.getParsedText();if(void 0===P.getWidth(r)){var D=T.length;try{e.PAssert(3733,!f.plugin||T===window.AttachChar,"Plugin should only be set for attachment element")}catch(t){e.reportError(t)}for(var M=0;M<D;++M){var _=T[M];if(!h[_]||y===C||0===M&&p>0&&void 0!==v[p-1].getWidth(r)){b+=_;for(var I="",A=y+1;A<a.length;++A){var w=a[A];if(!h[w])break;I+=w}var k=I||u[_]||T[M+1]===window.AttachChar;if(k){var x=this.measureWord(i,b,f,s),R=this.measureWord(i,I,f,s);E.push({text:b,delim:I,styles:f,width:x,delimWidth:Math.min(R,n),isAttach:_===window.AttachChar}),b=""}}y++}if(b.length>0){var x=this.measureWord(i,b,f,s);E.push({text:b,delim:"",styles:f,width:x,delimWidth:0}),b=""}}else E.push({isPrefix:!0,text:T,width:P.getWidth(r),delimWidth:0,delim:""}),C+=T.length,y+=T.length}else{try{e.PAssert(3734,t&&!t.requireStoredEls(),"Items that do not have els must be marked as not requiring them to be cached")}catch(t){e.reportError(t)}t.els||e.vmMain.runSingleParse(t,ChangeType.Auto);try{e.PAssert(3735,t.els&&1===t.els.length,"Should always have a single el for non-measure cached items")}catch(t){e.reportError(t)}if((f=this._getClassStyles(t,i,t.els[0]))&&f.attrs)E.push({text:window.AttachChar,delim:"",styles:f,width:e.vmMain.pluginManager.measureAttachment(i,f),delimWidth:0});else{var b=t.els[0].getParsedText();E.push({text:b,delim:"",styles:f,width:this.measureWord(i,b,f,s),delimWidth:0})}}var O=0,L="";y=0;for(var p=0;p<E.length;++p){if(b=E[p],p>S&&O+b.width+b.delimWidth>n&&(g.push({text:L,start:y,length:L.length,width:d(O)}),y+=L.length,O=0,L="",S=p),!b.isPrefix&&b.width+b.delimWidth>n&&!b.isAttach){var N=0,F=0;O=0;for(var M=0;M<b.text.length;++M)O=F,(F+=this.measureChar(b.text[M],b.styles))>n&&M>0&&M-1>N&&(L=b.text.substring(N,M),g.push({text:L,start:y,length:L.length,width:d(O)}),y+=L.length,N=M,O=0,L="",M--,F=0);if(N>=0){var B=b.text.substring(N,b.text.length);B.length>0&&(b.text=b.text.substr(0,N),L=B+b.delim,O=this.measureWord(i,B,b.styles,!0),S=p)}}else O+=b.width+b.delimWidth,L+=b.text+b.delim;p===E.length-1&&g.push({text:L,start:y,length:L.length,width:d(O)})}return s||this.saveLinesToCache(t,i,n,g),g},getItemFromCache:function(t,i){var n,r=this._itemCache[t.id],a=i,s=this.getItemDisplayText(t);if(r&&r[a]&&r[a].isHeader===t.isHeader()&&s===r.text&&r[a].isNote===t.isNote()&&s.indexOf(window.AttachChar)<0){var o=r[a];if(o.els)m.Cache.ItemCacheHit++,n=o;else try{e.PAssert(3736,!1,"Getting item from cache with no els")}catch(t){e.reportError(t)}}return n||m.Cache.ItemCacheMiss++,n},saveItemToCache:function(t,i){try{e.PAssert(3737,i,"Must save a valid measured item to cache")}catch(t){e.reportError(t)}try{e.PAssert(3738,i.els,"Measured item must have els")}catch(t){e.reportError(t)}try{e.PAssert(3739,i.maxWidth,"Measured item must have a valid max width")}catch(t){e.reportError(t)}var n=this.getItemDisplayText(t),r=this._itemCache[t.id];if(r&&r.text===n){var a,s=0,o=Number.MAX_VALUE;for(var c in r)if(r.hasOwnProperty(c)){s++;var l=r[c],d=l.lastAccess;d<o&&(o=d,a=c)}s>=5&&delete r[a]}else r=this._itemCache[t.id]={text:n};r[i.maxWidth]=i},getLinesFromCache:function(t,i,n){if(i.useLineCache){var r,a,s,o=this._lineCache.getEntrySync(t.id);if(o)for(s=0;s<o.length&&!(r=o[s][n]);s++);if(r){var c=this.getItemDisplayText(t);if(e.isNumber(r))a=[{start:0,length:c.length,text:c}];else{a=new Array(r.length);for(var l=0,s=0;s<r.length;s++){var d=r[s];try{e.PAssert(3740,!e.isNumber(d),"Cached lines should always be line info rather than a number")}catch(t){e.reportError(t)}a[s]={start:l,length:d.length,text:c.substr(l,d.length)},l+=d.length}}}return a}},saveLinesToCache:function(e,t,i,n){if(t.useLineCache){var r;r=n.length>1?n:1;var a=this._lineCache.getEntrySync(e.id)||[];a.length>=5&&a.pop();for(var s=0;s<a.length;s++)a[s][i]&&(a.splice(s,1),s--);var o={};o[i]=r,a.splice(0,0,o),this._lineCache.cacheEntry(e.id,a)}},measureItem:function(t,i,n){m.CallCount.MeasureItem++;var r,s=i.maxWidthOfItem(t),o=this.getItemDisplayText(t),c=t.isHeader(),l=t.isNote(),d=n;try{e.PAssert(3741,e.isNumber(s),"Must provide a valid number for maxWidth: ",s)}catch(t){e.reportError(t)}try{e.PAssert(3742,s>=0,"Max width must be greater than 0: ",s)}catch(t){e.reportError(t)}if(0===o.length||s<e.MinItemWidth){var h=this.lineItemHeight(t,i,1),u=[{text:"",start:0,length:0,width:0,cls:"line",index:0}];return{height:h,maxWidth:s,lineLengths:[0],styledLines:[TextSpace],els:u,isHeader:c,isNote:l}}if(!(r=!d&&this.getItemFromCache(t,s))){for(var p,f=this.measureLines(t,i,s,n),g=[],v=[],p=0;p<f.length;++p){var y=f[p];g.push(y.length),v.push({text:y.text,start:y.start,length:y.length,width:y.width,cls:"line",index:p})}try{e.PAssert(3744,t&&(t.els||!t.requireStoredEls()),"B Item has no els: ",t.__TEMP_InitCalled,t.__TEMP_InitParseCalled,t.__TEMP_ParseCalled,t.__TEMP_SkippedInitParsed,t.isArchived(),e.vmMain.hasDisplayedArchivedItems())}catch(t){e.reportError(t)}if(!t.els&&t.requireStoredEls()){var h=this.lineItemHeight(t,i,1),u=[{text:"",start:0,length:0,width:0,cls:"line",index:0}];return{height:h,maxWidth:s,lineLengths:[],styledLines:[],els:u,isHeader:c,isNote:l}}var b=a.generateStyledLines(t.els,f,i);h=this.lineItemHeight(t,i,f.length),r={height:h,maxWidth:s,lineLengths:g,styledLines:b,els:v,isHeader:c,isNote:l,lastAccess:Date.now()},d||this.saveItemToCache(t,r)}return r},measureWord:function(t,i,n,r){m.CallCount.MeasureWord++;try{e.PAssert(3745,void 0!==i,"Must pass in a valid word")}catch(t){e.reportError(t)}try{e.PAssert(3746,n,"Must supply valid styles for word")}catch(t){e.reportError(t)}try{e.PAssert(3747,i.indexOf(window.AttachChar)<0||1===i.length,"AttachChar should not be processed with other chars")}catch(t){e.reportError(t)}if(i.length>0){if(i===window.AttachChar&&n&&n.attrs){try{e.PAssert(3748,!n.attrs||n.attrs.plugin,"Must have a valid plugin: ",n.attrs&&n.attrs.plugin)}catch(t){e.reportError(t)}try{e.PAssert(3749,!n.attrs||n.attrs["plugin-id"],"Must have a valid attachment",n.attrs&&n.attrs["plugin-id"])}catch(t){e.reportError(t)}return e.vmMain.pluginManager.measureAttachment(t,n)}var a=this._selectCache(n),s=a.getEntrySync(i);if(s)return m.Cache.WordCacheHit++,s;for(var o=0,c=0;c<i.length;c++)o+=this.measureChar(i[c],n);var l=d(o);return r||a.cacheEntry(i,l),l}return 0},measureChar:function(e,t){var i=this._selectCache(t),n=i.getEntrySync(e);if(n)return n;var r=this.getCanvasContext(t).measureText(e).width;return i.cacheEntry(e,r),r},getOffsetForScreenPositionInLine:function(e,t,i,n,r){var a;if(i.isIndexMounted(e)){var s=i.elementAtIndex(e),c=s.querySelectorAll(".line");if(c.length>n){var d=c[n],h=d.getBoundingClientRect(),u=l.getSelectOffsetsForMouseEvent({target:d,clientX:Math.min(r,h.right-2),clientY:h.top+2+(0===n?o.paddingForItemTop(t,i):0)});u&&(a=u.start)}}if(isNaN(a))for(var p=this.measureItem(t,i,!0),m=p.lineLengths,a=0,f=0;f<m.length;f++)a+=m[f];return a},clearCacheForItem:function(e){this._lineCache.removeEntry(e),this._itemCache[e]=void 0},_loadCaches:function(){for(var e=0;e<this._wordCaches.length;e++)this._wordCaches[e].loadAll();this._lineCache.loadAll()},clearWordCaches:function(){for(var e=0;e<this._wordCaches.length;e++)this._wordCaches[e].clearCache()},clearItemCache:function(){this._itemCache={}},clearLineCache:function(){this._lineCache.clearCache()},_selectCache:function(t){var i;if(t.isHeaderTopLevel)i=this._wordCacheHeaderTopLevel;else if(t.isPrefixHeader)i=this._wordCacheHeader;else if(t.isBold){try{e.PAssert(3750,!t.isNote,"Currently do not support bold+note")}catch(t){e.reportError(t)}i=this._wordCacheBold}else i=t.isNote?this._wordCacheNote:this._wordCacheNormal;return i},lineItemHeight:function(t,i,n){return e.isNumber(n)&&!t.isNote()||(n=1),o.paddingForItemTop(t,i)+o.paddingForItemBottom(t,i)+o.lineHeightForItem(t,i)*n},getItemDisplayText:function(e){return e.getParsedText()},onDisplaySettingsChanged:function(e){this.needsFontUpdate=!0,e&&this.clearWordCaches(),this.clearItemCache(),this.clearLineCache()}},new p}),define("EditHelpers",[],function(){function e(){}var t=[" ","-","/","[","]","(",")","*","_","@",".",":"];return e.prototype={getPreviousWord:function(e,i){for(var n=-1,r=0;r<t.length;r++)n=Math.max(n,e.prevIndexOf(t[r],i-1));return n},getNextWord:function(e,i){for(var n=e.length,r=0;r<t.length;r++){var a=e.indexOf(t[r],i);a>=0&&(n=Math.min(n,a))}return n}},new e}),define("Multiselect",["require","globals","Constants","util","platform","EventDispatcher","Observable","ObservableArray"],function(e){function t(){this.selected={},this.numSelected=new s(0),this._queueRemoveEditables=[],n.forceBind("reset",this)}var i=e("globals"),n=(e("Constants"),e("util")),r=e("platform"),a=e("EventDispatcher"),s=e("Observable"),o=e("ObservableArray");return t.prototype={_selectedObjForPane:function(e){try{i.PAssert(3751,e,"Multiselect should always pass in a pane")}catch(e){i.reportError(e)}e=e||i.focusedPane;var t=this.selected[e.id];return t||(t=this.selected[e.id]={arr:new o,isInverted:!1},r.mobile&&t.arr.listen(this.onChanged.bind(this,e))),t},_selectedForPaneObs:function(e){return this._selectedObjForPane(e).arr},_selectedForPane:function(e){return this._selectedObjForPane(e).arr.get()},onChanged:function(e){this.numSelected.set(this.numSelectedInPane(e))},isInverted:function(e){return this._selectedObjForPane(e).isInverted},setInverted:function(e,t){this._selectedObjForPane(t).isInverted=e},isSelected:function(e,t){return this._selectedForPane(t).indexOf(e)>=0},getSelected:function(e){return this._selectedForPane(e)},getSelectedItems:function(e,t){for(var i=this._selectedForPane(e),n=[],r=0;r<i.length;++r){var a=i[r];if(e.numItems()>a){var s=e.itemAtIndex(a);!s||!t&&s.isNote()||n.push(s)}}return n},numSelectedInPane:function(e){for(var t=0,i=this._selectedForPane(e),n=0;n<i.length;n++){var r=e.itemAtIndex(i[n]);!r||r.isNote&&r.isNote()||t++}return t},getFirstSelectedIndex:function(e){e=e||i.focusedPane;for(var t=this._selectedForPane(e),n=Number.MAX_VALUE,r=!1,a=0;a<t.length;a++){var s=t[a];s<n&&(n=s,r=!0)}return r?n:-1},getFirstSelectedItem:function(e){e=e||i.focusedPane;var t=this.getFirstSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)},getLastSelectedIndex:function(e){e=e||i.focusedPane;for(var t=this._selectedForPane(e),n=-1,r=0;r<t.length;r++){var a=t[r];a>n&&(n=a)}return n},getLastSelectedItem:function(e){e=e||i.focusedPane;var t=this.getLastSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)},_resetPaneID:function(e){var t=i.vmMain.paneManager,n=!0;if(t.isPaneActive(e)){var r=t.getPaneById(e);r.canResetMultiselect()?(this.setSelected([],r),this.selected[e].isInverted=!1):n=!1}else delete this.selected[e];return n},reset:function(e){var t=!0;if(e)e.canResetMultiselect()?this._resetPaneID(e.id):t=!1;else for(var i in this.selected)this.selected.hasOwnProperty(i)&&(t=t&&this._resetPaneID(i));t&&this.fireEvent("reset",[e])},clearEditables:function(e){for(var t=this.getSelectedItems(e),i=1===t.length?t[0]:void 0,n=0;n<this._queueRemoveEditables.length;n++){var r=this._queueRemoveEditables[n];r!==i&&(r.isEditable.set(!1),r.itemChanged.notify())}this._queueRemoveEditables=[]},setSelected:function(e,t,n){t=t||i.focusedPane;var a=this._selectedForPane(t),s=i.arrayDiff(a,e);this.setInverted(!1,t),this._selectedForPaneObs(t).set(e);for(var o=0;o<s.length;o++){var c=s[o];if(c<t.numItems()){var l=t.itemAtIndex(c);if(l){if(r.mobile&&t.isWriteable){1===e.length&&e[0]===c?l.isEditable.set(!0):n?this._queueRemoveEditables.push(l):l.isEditable.set(!1)}l.itemChanged.notify()}}}},toggleSelected:function(e,t,n){t=t||i.focusedPane;var r=this._selectedForPaneObs(t),a=t.itemAtIndex(e),s=r.indexOf(e);s>=0&&!0!==n?(r.remove(e),a.itemChanged.notify()):s<0&&!1!==n&&(r.push(e),a.itemChanged.notify())},addSelected:function(e,t){this.toggleSelected(e,t,!0)},removeSelected:function(e,t){this.toggleSelected(e,t,!1)},selectInOrder:function(e,t,n){n=n||i.focusedPane;for(var r=[],a=e;a<=t;a++)r.push(a);this.setSelected(r,n)},applyFnToSelected:function(e,t){i.vmMain.beginUpdateItems(),t=t||i.focusedPane;for(var n,r=this.getSelectedItems(t),a=0;a<r.length&&!1!==n;a++)n=e(r[a],a,r.length);i.vmMain.commitUpdateItems()}},n.extend(t.prototype,a),new t}),define("DesktopUI",["require","globals","Constants","util","platform","Dispatcher","Observable"],function(e){function t(){this.sidebarTransitioning=!1,this.isDraggingSidebar=new o(!1),this.lightboxPosition=new o,this.lightboxSrc=new o,this.lightboxElement=void 0}var i=e("globals"),n=e("Constants"),r=e("util"),a=e("platform"),s=e("Dispatcher"),o=e("Observable");return t.prototype={init:function(){this.showSidebar=new o(!a.isMailbirdSidebar()&&i.settings.get(Settings.showSidebar)&&!i.isDemoInIframe()),this.sidebarPosition=new o(this.showSidebar.get()?n.DesktopMenuWidth:n.DesktopMenuWidthSmall),a.mobile||(r.forceBind("onMouseOverPrefix",this),r.forceBind("onMouseLeavePrefix",this),s.listen("mouseover",this.handleMouseOver.bind(this)),s.listen("mouseout",this.handleMouseOut.bind(this)))},toggleSidebar:function(){this.sidebarTransitioning=!0;var e=!this.showSidebar.get();this.sidebarPosition.set(e?n.DesktopMenuWidth:n.DesktopMenuWidthSmall),this.setVisible(e)},getPosition:function(){
return a.isMailbirdSidebar()?0:this.sidebarPosition.get()},setPosition:function(e){this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarPosition.set(e)},setFromPosition:function(){this.sidebarTransitioning=!0;var e=this.sidebarPosition.get()<n.DesktopMenuWidth/2?n.DesktopMenuWidthSmall:n.DesktopMenuWidth;this.isDraggingSidebar.set(!1),this.sidebarPosition.set(e),this.setVisible(e!==n.DesktopMenuWidthSmall&&n.DesktopMenuWidth)},setVisible:function(e){i.settings.set(Settings.showSidebar,e),this.showSidebar.set(e)},getSidebarWidth:function(){return this.sidebarPosition.get()},onMouseOverPrefix:function(e){if(!i.dragDrop.isDragging){var t=(i.offset(e.target),i.dataFor(e.target,!0));if(t){this._isPrefixHoverMenuOpen={x:e.clientX,y:e.clientY};var n=i.getPaneForElement(e.target);i.menus.openContextMenuReact({componentName:"ReactContextMenuItem",key:"menu"+t.id,element:e.target,item:t,useItem:!0,pane:n,pos:{left:e.clientX,top:e.clientY},noBackdrop:!0,onClosed:function(){this._isPrefixHoverMenuOpen=!1}.bind(this)})}}},onMouseLeavePrefix:function(e){i.menus.closeContextMenuReact()},handleMouseOver:function(e){this._isPrefixHoverMenuOpen?i.findParent(e.target,"fancyContextMenu")?(clearTimeout(this.timeoutMouseLeavePrefix),this.timeoutMouseLeavePrefix=void 0):i.hasClass(e.target,"itemPrefix")||(clearTimeout(this.timeoutMouseLeavePrefix),this.timeoutMouseLeavePrefix=setTimeout(this.onMouseLeavePrefix,200,e)):i.hasClass(e.target,"itemPrefix")&&(clearTimeout(this.timeoutMouseOverPrefix),this.timeoutMouseOverPrefix=setTimeout(this.onMouseOverPrefix,700,e))},handleMouseOut:function(e){this.timeoutMouseOverPrefix&&(clearTimeout(this.timeoutMouseOverPrefix),this.timeoutMouseOverPrefix=void 0)},clearTimeoutMouseOverPrefix:function(){this.timeoutMouseOverPrefix&&(clearTimeout(this.timeoutMouseOverPrefix),this.timeoutMouseOverPrefix=void 0)}},new t}),define("Sel",["globals","Constants","platform","data","util","Dispatcher","Measure","Observable","NativeSel","EditHelpers","DisplaySettings","Multiselect","DesktopUI"],function(e,t,i,n,r,a,s,o,c,l,d,h,u){function p(){this._isValid=!1,this._isInRightClick=!1,this._isDirty=!1,this._isWatchingChange=!0,this._isMouseDown=!1,this.isWindowFocused=new o(!0),this.hoveredItem=void 0,this.hoveredReactCell=void 0,this._previousSelectedIndex=void 0,this._previousIsValid=void 0,this._selectedMap=[],this.mousePos={x:-1,y:-1},this.mouseDownPos={x:-1,y:-1},this._lastClickTime=0,this._numClicks=0,this._savedPaneSels={},this._itemHighlightPosition=void 0,this.itemHighlightPosition=new o,this.pane=new o,this.init()}var m,f,g={Start:"start",End:"end"};return require(["DragDrop","edit"],function(e,t){m=e,f=t}),p.prototype={init:function(){this.reset();var t={};i.mobile?(t.onMove=this.onMouseMoveMobile.bind(this),document.addEventListener("selectstart",this._onSelectStart.bind(this)),document.addEventListener("selectionchange",this._onSelectionChange.bind(this))):(t.onStart=this.onMouseDown.bind(this),t.onEnd=this.onMouseUp.bind(this),t.onRightStart=this.onRightMouseDown.bind(this),t.onMove=this.onMouseMove.bind(this),document.addEventListener("mousemove",this.onMouseMoveDocument.bind(this),!0)),e.setupClick(document,this,t),i.mobile||(window.addEventListener("blur",this.onWindowBlur.bind(this)),window.addEventListener("focus",this.onWindowFocus.bind(this))),a.listen("paneAdded",this.onPaneAdded.bind(this)),a.listen("paneRemoved",this.onPaneRemoved.bind(this)),r.forceBind("restore",this),r.forceBind("onScroll",this),r.forceBind("closeKeyboardIfNoSelection",this)},reset:function(t){this._isValid&&(this._setOffsetSide(g.Start,void 0),this._setIndexSide(g.Start,void 0),this._setOffsetSide(g.End,void 0),this._setIndexSide(g.End,void 0),this._dblClickOffsets=void 0,this.preferLineStart=!1,this._mouseOffset=-1,this._mouseMoved=!1,this._isValid=!1,this._isArrowSelectInverted=!1,this.getPane()&&this.getPane().caretPosition.set(void 0),this._updateSelection(),i.mobile&&e.keyboardToolbar&&(h.reset(),t||f.isTyping||a.fireEvent("closeKeyboard",[])))},dumpState:function(){var e={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.startIndex,offset:this.startOffset},end:{index:this.endIndex,offset:this.endOffset}};try{var t=!!this.pane.get();e.paneInfo=t?{hasPane:t,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop(),displayCount:this.pane.get().inViewCount()}:"No Pane Set"}catch(t){e.paneInfo="Invalid Pane"}try{void 0!==this.startIndex&&(e.start.item=this.pane.get().items.get()[this.startIndex].id)}catch(t){e.start.item="Invalid Item"}try{void 0!==this.endIndex&&(e.end.item=this.pane.get().items.get()[this.endIndex].id)}catch(t){e.end.item="Invalid Item"}return e},setValid:function(t){if(t){try{e.PAssert(3752,!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex())}catch(t){e.reportError(t)}try{e.PAssert(3753,!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex())}catch(t){e.reportError(t)}try{var i=this.pane.get().items.get()[this.startIndex];try{e.PAssert(3754,i&&(e.isVMLI(i)||e.isVMLI(i.item)),"Valid selection must always be into a VMLI for start item")}catch(t){e.reportError(t)}var n=this.pane.get().items.get()[this.endIndex];try{e.PAssert(3755,n&&(e.isVMLI(n)||e.isVMLI(n.item)),"Valid selection must always be into a VMLI for end item")}catch(t){e.reportError(t)}}catch(t){e.reportError(t)}}else this.reset();this._isValid=t},isArrowSelectInverted:function(){return this._isArrowSelectInverted},setArrowSelectInverted:function(e){this._isArrowSelectInverted=e},getStartItem:function(){return this.getPane().itemAtIndex(this.startIndex)},getStartObject:function(){return this.getPane().objectAtIndex(this.startIndex)},getStartOffset:function(){var e;return-1===this.startOffset?(e=this.getStartTotal(),this.startOffset=e):e=this.startOffset,e},getStartIndex:function(){return this.startIndex},getStartTotal:function(){return this.getStartItem().getParsedText().length},getEndItem:function(){return this.getPane().itemAtIndex(this.endIndex)},getEndObject:function(){return this.getPane().objectAtIndex(this.endIndex)},getEndOffset:function(){var e;return-1===this.endOffset?(e=this.getEndTotal(),this.endOffset=e):e=this.endOffset,e},getEndIndex:function(){return this.endIndex},getEndTotal:function(){return this.getEndItem().getParsedText().length},isMouseDown:function(){return this._isMouseDown},_mutateProperty:function(e,t){var i=this[e];this[e]=t,i!==t&&(this._isDirty=!0)},_setIndexSide:function(e,t){this._mutateProperty(e+"Index",t)},_setOffsetSide:function(e,t){this._mutateProperty(e+"Offset",t)},setSelection:function(e,t,i,n){this._setIndexSide(g.Start,e),this._setOffsetSide(g.Start,t),this._setIndexSide(g.End,i),this._setOffsetSide(g.End,n),this._downIndex=e,this._downOffset=t},isValid:function(){return this._isValid},checkValid:function(){var e=!1,t=this.getPane();if(t&&this.startIndex>=0&&this.startIndex<t.numItems()&&this.endIndex>=0&&this.endIndex<t.numItems())if(this.getStartItem()&&this.getEndItem()){var i=this.getStartItem(),n=i.getParsedText(),r=this.getEndItem(),a=r.getParsedText();this.startOffset>=0&&this.startOffset<=n.length&&this.endOffset>=0&&this.endOffset<=a.length&&(e=!0)}else e=!1;return!e&&this.isValid()&&(log("Sel is now invalid"),this.reset()),e},getPane:function(){try{e.PAssert(3756,this.pane.get()===e.focusedPane,"Should these always match?")}catch(t){e.reportError(t)}return this.pane.get()},clearSelection:function(e){this.reset(e)},onPaneAdded:function(e){e.useCustomScroller||i.mobile||e.addScrollListener(this.onScroll)},onPaneRemoved:function(e){e.useCustomScroller||i.mobile||e.removeScrollListener(this.onScroll),this.getPane()===e&&this.setFocusedPane(void 0)},onScroll:function(t){var i=e.getPaneForElement(t.target);if(this._isMouseDown&&i===this.getPane()&&i.isWriteable&&!m.isDragging){var n=this.getMousePos();this._mouseOffset=n.y+i.getScrollTop();var r=document.elementFromPoint(n.x,n.y),a={clientX:n.x,clientY:n.y,target:r};this._updateFromMouse(a),this._updateSelection()}},onRightMouseDown:function(t){var i=!0,n=e.getElementParent(t.target);if(n&&!e.findParent(n,"autocompleteItem",2)&&!e.hasClass(n,"itemNotInPane")){var r=e.getReactCellForElement(n);if(r){var a=e.getPaneForElement(n),s=r.getIndex();this.isSelected(s,a)&&(i=!1)}}i&&(this._isInRightClick=!0,this.onMouseDown(t,!0),this._isInRightClick=!1)},checkDoubleClick:function(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0},onMouseDown:function(n,r){var a=e.getPaneForElement(n.target);if(this.isWindowFocused.set(!0),e.findParent(n.target,"formattingToolbar")||(this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0)),!(!a||!i.mobile&&n.clientX-u.getSidebarWidth()>a.getLeft()+a.getWidth()-48)){u.clearTimeoutMouseOverPrefix(),this.setFocusedPane(a);var s=n.target,o=a.getInfiniteList();if(!(!a.supportSel||e.hasClass(s,"itemCheckbox")||e.hasClass(s,"itemPrefix")||e.findParent(s,"searchWrap")||!r&&e.hasClass(s,"collapser")||!r&&e.hasClass(s,"bullet")||!r&&e.hasClass(s,"itemEditButton")||e.findParent(s,"formattingToolbar"))){r||(this._isMouseDown=!0),this._selectionBeforeBlur=void 0,this.preferLineStart=!1;var d={x:this.mouseDownPos.x,y:this.mouseDownPos.y};this.mouseDownPos.x=n.pageX,this.mouseDownPos.y=n.pageY,a.onFocus();var h=e.getElementParent(n.target),p=e.findParent(n.target,"line"),m=!1;if(e.findParent(s,"paneContent")){if(a&&a.isWriteable&&a.isEditable){if(h&&p){if(r)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var f=Date.now();f-this._lastClickTime<t.DoubleClickTime&&Math.abs(n.pageX-this.mouseDownPos.x)<2&&Math.abs(n.pageY-this.mouseDownPos.y)<2&&Math.abs(n.pageX-d.x)<2&&Math.abs(n.pageY-d.y)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=f}var v=c.getCursorSelectionRange(n);if(v){var y=e.getReactCellForElement(n.target);if(y&&!y.props.overview){if(this.preferLineStart=n.clientX-e.offset(p).left<30,n.shiftKey)this._mouseMoved=!0,this._mouseOffset=n.eventY+a.getScrollTop(),this._updateFromMouse(n);else if(1===this._numClicks||this._numClicks>3){this._downIndex=y.getIndex();try{e.PAssert(3760,this._downIndex>=0,"Must have a valid index in react item")}catch(t){e.reportError(t)}if(this._downIndex<0)try{e.PAssert(3761,this._downIndex>=0,"Dead cell error",e.getElementPath(v.getStartElement()),e.getElementPath(n.target))}catch(t){e.reportError(t)}this._downItem=y.getItem();try{e.PAssert(3762,this._downItem,"Must have a valid item in react item")}catch(t){e.reportError(t)}this._setIndexSide(g.Start,this._downIndex),this._setIndexSide(g.End,this._downIndex);var b=v.getSelectOffsetsInElement(h);if(0===this._downItem.getParsedTextWithoutPrefix().length?this._downOffset=b.total:this._downOffset=b.start,!this.isSelected(this._downIndex,a)){var S=e.findParent(v.getStartContainer(),"mdSpan",2);if(S&&v.getStartOffset()===S.innerHTML.length){for(var E=S.nextElementSibling,C=0;E&&e.hasClass(E,"mdMarkup");)C+=E.innerHTML.length,E=E.nextElementSibling;E||(this._downOffset=Math.min(this._downOffset+C,b.total))}}this._setOffsetSide(g.Start,this._downOffset),this._setOffsetSide(g.End,this._downOffset)}else if(2===this._numClicks){var P=this._downItem.getParsedText(),T=l.getPreviousWord(P,this._downOffset)+1,D=l.getNextWord(P,this._downOffset);this._setOffsetSide(g.Start,T),this._setOffsetSide(g.End,D)}else 3===this._numClicks&&(this._setOffsetSide(g.Start,0),this._setOffsetSide(g.End,this._downItem.getParsedText().length));m=!0}}}else if(a.hasNonVMLIs){var M=e.dataFor(n.target,!0,!0);if(M)if(e.isPane(M))m=!1,n.preventDefault();else{var _=M.index;if(_>=0){var I=a.itemAtIndex(_);I||(_=a.indexOfNextVMLI(_)),_>=0&&(this._downIndex=_,this._setIndexSide(g.Start,_),this._setIndexSide(g.End,_),this._downOffset=0,this._setOffsetSide(g.Start,0),this._setOffsetSide(g.End,0),m=!0)}}}else if(e.findParent(n.target,"paneContent")&&!e.findParent(n.target,"addItemButton")&&!o.disablePointerEvents.get()){var A=a.indexOfLastItem();A>=0&&(n.shiftKey&&this.isValid()&&!r?this.selectIndices(this.getStartIndex(),this.getStartOffset(),A,-1):this.selectIndex(A,-1),m=!0),n.preventDefault()}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}}else;this.setValid(m&&this.checkValid()),this.isValid()&&(e.vmMain.setItemAnimationMode(t.ItemAnimationMode.None),this._updateSelection(),e.vmMain.resetItemAnimationMode()),o&&o.flushTimeoutPointerEvents()}}},getMousePos:function(){return this.mousePos},onMouseMoveDocument:function(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY},onMouseMove:function(n){try{e.PAssert(3763,!i.mobile,"Should not be called on mobile")}catch(t){e.reportError(t)}if(this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),n.target!==document.documentElement&&n.target.parentElement){var r=e.getPaneForElement(n.target);if(this._isValid&&this._isMouseDown&&r===this.getPane()&&r.supportSel&&r.isWriteable&&!m.isDragging)return this._mouseMoved=!0,e.vmMain.setItemAnimationMode(t.ItemAnimationMode.None),this._mouseOffset=n.eventY+r.getScrollTop(),this._updateFromMouse(n),this._updateSelection(),Math.abs(n.diffY)>40&&r.scrollFromMousePosition(n.clientY),n.preventDefault(),!1}},onMouseMoveMobile:function(e){this.mousePos.x=e.pageX||e.clientX,this.mousePos.y=e.pageY||e.clientY},onMouseUp:function(t){this._isMouseDown=!1,e.vmMain&&e.vmMain.resetItemAnimationMode();var n=e.isAttachedToDoc(t.target)&&e.getPaneForElement(t.target);!(n&&e.getElementParent(t.target))||e.hasClass(t.target,"contact")||!i.mobile&&n.supportBulletEdit&&e.hasClass(t.target,"bullet")||this.updateCaret(),this._itemHighlightPosition&&this.itemHighlightPosition.set(this._itemHighlightPosition),e.cancelRepeatScroll()},focusPane:function(e){this.setFocusedPane(e),e.focus(),this.updateCaret()},setFocusedPane:function(t){try{e.PAssert(3764,!i.mobile||t,"Should not be focusing no pane on mobile")}catch(t){e.reportError(t)}if(!t||!e.focusedPane||e.focusedPane.id!==t.id){var n=e.focusedPane;if(n&&n.isEditable&&this.isValid()&&(this._savedPaneSels[n.id]=this.save()),e.vmMain.beginUpdateItems(),this.reset(),h.reset(n),e.focusedPane=t,e.focusedItem=t?t.getItem():void 0,this.pane.set(t),i.mobile)n&&n.deactivate(),t&&t.activate();else if(t){var r=this._savedPaneSels[t.id];r?(r.pane=t,t.isLoaded?this.restore(r):setTimeout(this.restore,0,r),this._savedPaneSels[t.id]=void 0):this.reset()}e.vmMain.commitUpdateItems()}},_updateWith:function(t,i,n){var r=i===g.Start?n.getStartElement():n.getEndElement();try{e.PAssert(3765,r,"Trying to select in invalid container")}catch(t){e.reportError(t)}if(r){var a=e.getReactCellForElement(r),s=e.getElementParent(r),o=n.getSelectOffsetsInElement(s),c=i===g.Start?o.start:o.end;try{e.PAssert(3766,a.getItem(),"Should not be updating ReactCells without VMLIs")}catch(t){e.reportError(t)}if(this._setIndexSide(t,a.getIndex()),this._dblClickOffsets&&a.getIndex()===this._dblClickOffsets.index)if(t===g.Start)c=Math.min(c,this._dblClickOffsets.start);else if(t===g.End)c=Math.max(c,this._dblClickOffsets.end);else try{e.PAssert(3767,!1,"Invalid toUpdate value")}catch(t){e.reportError(t)}this._setOffsetSide(t,c);try{e.PAssert(3768,!isNaN(c),"Selection offsets should not be undefined")}catch(t){e.reportError(t)}}},_setSelectionOnSide:function(e,t,i){var n=e===g.Start?g.End:g.Start;this._setIndexSide(e,t),this._setOffsetSide(e,i),this._setIndexSide(n,this._downIndex),this._setOffsetSide(n,this._downOffset),this.setArrowSelectInverted(t<this._downIndex||t===this._downIndex&&i<this._downOffset)},_updateFromMouse:function(t){try{e.PAssert(3769,!i.mobile,"Should never be reading selection values from mouse on mobile, only accept taps")}catch(t){e.reportError(t)}var n=t.target;if(n){var r=e.focusedPane;if(!e.getElementParent(n)&&t.clientY<r.contentTop()){n=e.elementFromPoint(t.clientX,r.contentTop()+1,t.target);if(e.getElementParent(n)){var a=e.getReactCellForElement(n),s=e.getItemForElement(n);try{e.PAssert(3770,s,"If it is an LI it should be an item",n)}catch(t){e.reportError(t)}this._setIndexSide(g.Start,a.getIndex()),this._setOffsetSide(g.Start,0)}}else{var o,l,d,h=e.getElementParent(t.target);if(h){if((d=c.getCursorSelectionRange(t))&&d.getStartElement()){var a=e.getReactCellForElement(t.target);try{e.PAssert(3771,a,"Must be able to find a valid reactCell for the start element")}catch(t){e.reportError(t)}if(a){if((o=a.getIndex())<0)try{e.PAssert(3773,o>=0,"Dead cell error",e.getElementPath(d.getStartElement()),e.getElementPath(t.target))}catch(t){e.reportError(t)}if(e.findParent(d.getStartContainer(),"line")&&e.findParent(d.getEndContainer(),"line")){var u=d.getSelectOffsetsInElement(h);l=u.start}else e.findParent(d.getStartContainer(),"collapser")&&e.findParent(d.getEndContainer(),"collapser")&&(o<=this._downIndex?this._setSelectionOnSide(g.Start,o,0):this._setSelectionOnSide(g.End,o,0))}}}else if(r.hasNonVMLIs){var p=e.dataFor(t.target,!1,!0);if(p){var m=p.index;if(m>=0){var s=r.itemAtIndex(m);if(!s)if(m<this._downIndex){var f=r.indexOfNextVMLI(m);f>=0&&this._setSelectionOnSide(g.Start,f,0)}else{var f=r.indexOfPrevVMLI(m);if(f>=0){var s=r.itemAtIndex(f);this._setSelectionOnSide(g.End,f,s.getParsedText().length)}}}}}else if(e.hasClass(n,"paneContent")){var v=r.getLastItem();this._setIndexSide(g.End,r.numItems()-1),this._setOffsetSide(g.End,v?v.getParsedText().length:0)}if(!isNaN(o)&&!isNaN(l)&&d){var y=e.findParent(t.target,"line");if(y){this.preferLineStart=t.clientX-e.offset(y).left<30;var b;o<this._downIndex||o===this._downIndex&&l<this._downOffset?(b=g.End,this._updateWith(g.Start,g.Start,d),this.setArrowSelectInverted(!0)):(o>this._downIndex||o===this._downIndex&&l>=this._downOffset)&&(b=g.Start,this._updateWith(g.End,g.End,d),this.setArrowSelectInverted(!1),l===this._downOffset&&(this._isDirty=!0)),void 0!==b&&(this._setIndexSide(b,this._downIndex),this._dblClickOffsets?this._setOffsetSide(b,this._dblClickOffsets[b]):this._setOffsetSide(b,this._downOffset),this.setValid(!0))}}}}},setSelectionFromNativeRange:function(e){this._updateWith(g.Start,g.Start,e),this._updateWith(g.End,g.End,e),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))},_updateSelection:function(){if(this._isDirty){var n=0,r=this.getPane(),s=this._selectedMap;if(this._selectedMap=[],this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex())),this.getStartIndex()===this.getEndIndex()&&void 0!==this.getStartIndex()){try{e.PAssert(3774,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(t){e.reportError(t)}i.mobile&&h.setSelected([this.getStartIndex()],r),this._selectedMap[this.getStartIndex()]={start:this.getStartOffset(),end:this.getEndOffset()}}else for(var o=this.getStartIndex();o<=this.getEndIndex();++o){var c;if(o===this.getStartIndex())c={start:this.getStartOffset(),end:-1};else if(o===this.getEndIndex()){try{e.PAssert(3775,this.getEndOffset()<=this.getEndItem().getParsedText().length,"Selection is past end of text string")}catch(t){e.reportError(t)}c={start:0,end:this.getEndOffset()}}else c=!0;this._selectedMap[o]=c}if(r){var l=!1;s.forEach(function(e,t){if(void 0===this._selectedMap[t]&&t<r.numItems()){var i=r.itemAtIndex(t);i&&(i.itemChanged.notify(),l=l||r.checkHeightChanged(i,t),n++)}}.bind(this)),this._selectedMap.forEach(function(e,t){var i=s[t],a=this._selectedMap[t];if(void 0===i||i.start!==a.start||i.end!==a.end){var o=r.itemAtIndex(t);o&&(o.itemChanged.notify(),l=l||r.checkHeightChanged(o,t),n++)}}.bind(this)),l&&(e.vmMain.setItemAnimationMode(t.ItemAnimationMode.Move),r.updateItems(!1,!0),e.vmMain.resetItemAnimationMode())}this.updateCaret(),this._isDirty=!1,a.fireEvent("selectionChanged",[]);var d=this.getStartIndex(),u=this.isValid();if(d===this.getEndIndex()||!u){if(d!==this._previousSelectedIndex||u!==this._previousIsValid){var p=u?this.getStartItem():void 0;a.fireEvent("selectedIndexChanged",[d,r,p])}this._previousSelectedIndex=d,this._previousIsValid=u}}},_onSelectStart:function(e){return m=m||require("DragDrop"),!m.isDragging||(e.preventDefault(),!1)},_onSelectionChange:function(t){if(c.hasSelection()){if(i.android&&m.isDragging)return void c.clearSelection();if(i.mobile)if(this.getPane().isWriteable)if(i.android){if(this.isValid()){var n=this.getStartElement();n===document.activeElement&&this.setSelection(this.getStartIndex(),n.selectionStart,this.getEndIndex(),n.selectionEnd)}}else{var r=c.getSelectionRange(),a=r.getStartElement(),s=r.getEndElement();if(a&&s){var o=e.findParent(a,"item"),l=e.findParent(s,"item"),d=o&&l&&!e.hasClass(o,"dead")&&!e.hasClass(l,"dead");d&&this.setSelectionFromNativeRange(r)}}else this.reset()}e.timeoutOnce("closeKeyboardIfNoSelection",this.closeKeyboardIfNoSelection,100)},closeKeyboardIfNoSelection:function(){i.mobile&&!c.hasValidSelection()&&e.closeKeyboard()},updateCaret:function(){var t=this.getPane();if(t&&t.isWriteable){if(this.isValid()){var n=!this._isInRightClick&&this.getStartItem()===this.getEndItem()&&this.getStartItem()&&this.getStartItem().isNote();n?t.openNoteContextMenu():e.menus.isContextMenuOpen()&&e.menus.closeContextMenuReact()}if(!i.mobile)if(this.isValid()){if(this.getStartItem()&&this.getEndItem()&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()===this.getEndOffset()){var r=this.getStartItem(),a=t.topOfIndex(this.getStartIndex()),o=t.getPaddingForItem(r),c=s.getCaretOffset(r,t,this.getEndOffset(),this.preferLineStart),l=t.caretPosition.get();c.left=Math.floor(Math.min(c.left+o,t.getWidth()-10)),c.top+=a+(i.mobile?0:d.paddingForItemTop(r)),c.isVisible=!0,c.item=r,c.pane=t,this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0),l&&l.isVisible&&l.left===c.left&&l.top===c.top||t.caretPosition.set(c)}else{var h=t.caretPosition.get();h&&h.isVisible&&(h=e.clone(h),h.isVisible=!1,t.caretPosition.set(h));var r=this.getStartItem(),o=t.getPaddingForItem(r),u=t.topOfIndex(this.getStartIndex()),p=s.getCaretOffset(r,t,this.getStartOffset(),this.preferLineStart),m=s.getCaretOffset(r,t,this.getEndOffset(),this.preferLineStart);this._itemHighlightPosition={x:o+(p.left+m.left)/2,y:u}}n||!t.hiddenInput||this.isComposing||this.focusHiddenInput()}else t.caretPosition.set(void 0)}},focusHiddenInput:function(){var t=this.getPane();if(t&&t.isEditable&&t.hiddenInput){var i=c.createSelectionRange(),n=t.hiddenInput,r=0,a=1,s=t.scrollElement,o=s.scrollLeft,l=s.scrollTop;if(this.isValid()){var d=this.getStartItem(),h=d.getParsedText();n.innerHTML=e.escape(h),r=this.getStartOffset(),a=this.getStartItem()===this.getEndItem()?this.getEndOffset():this.getStartOffset()}n.firstChild&&0!==n.firstChild.length||(n.innerHTML=TextSpace);var u=n.firstChild;try{e.PAssert(3779,u,"Empty element must have a valid child")}catch(t){e.reportError(t)}try{n.focus(),i.setStart(u,r),i.setEnd(u,a),c.setSelectionRange(i)}catch(t){e.reportError(t)}s.scrollLeft=o,s.scrollTop=l}},isSelected:function(e,t){return t===this.getPane()&&!!this._selectedMap[e]},getSelectionAtIndex:function(e){return this._selectedMap[e]},selectIndex:function(e,t,i,n){return void 0===i&&(i=t),this.selectIndices(e,t,e,i,n)},selectIndices:function(n,r,a,s,o){try{e.PAssert(3780,n>=0,"Must supply a valid start index")}catch(t){e.reportError(t)}try{e.PAssert(3781,a>=0,"Must supply a valid end index")}catch(t){e.reportError(t)}try{e.PAssert(3782,a>n||a===n&&(s>=r||-1===s),"Must not pass reversed selection")}catch(t){e.reportError(t)}if(!(n<0||a<0)){var c,l,d=!1,u=this.getPane();if(u&&u.isWriteable){c=u.itemAtIndex(n),l=u.itemAtIndex(a);try{e.PAssert(3783,c,"Trying to select invalid start index")}catch(t){e.reportError(t)}try{e.PAssert(3784,l,"Trying to select invalid end index")}catch(t){e.reportError(t)}if(c&&l&&o!==t.SelectOption.AllowPrefix){var p=c.getPrefixLength(),m=l.getPrefixLength();r>=0&&r<p&&(r=p),s>=0&&s<m&&(s=m)}}if(c&&l&&(!this.isValid()||i.mobile||n!==this.getStartIndex()||r!==this.getStartOffset()||a!==this.getEndIndex()||s!==this.getEndOffset())){this.setSelection(n,r,a,s);try{e.PAssert(3785,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(t){e.reportError(t)}if(!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&(i.mobile&&i.android&&o===t.SelectOption.Delay||this._updateSelection()),i.mobile&&o!==t.SelectOption.DoNothing)if(i.android&&o===t.SelectOption.Delay)h.setSelected([n],u,!0),e.timeoutOnce("selectAfterEnter",function(){var e=u.elementAtIndex(n),t=u.elementAtIndex(a);this.selectElements(e,r,t,s),h.clearEditables(u),this._updateSelection()}.bind(this),0);else{var f=u.elementAtIndex(n),g=u.elementAtIndex(a);f&&g&&(e.clearTimeoutOnce("selectAfterEnter"),this.selectElements(f,r,g,s))}d=!0}else this.updateCaret();return d}},selectItem:function(t,i,n){try{e.PAssert(3786,e.isNumber(i),"Must pass a valid start offset")}catch(t){e.reportError(t)}try{e.PAssert(3787,e.isNumber(n)||void 0===n,"Must pass a valid end offset")}catch(t){e.reportError(t)}return void 0===n&&(n=i),this.selectItems(t,i,t,n)},selectItems:function(t,i,n,r){try{e.PAssert(3788,e.isVMLI(t),"Should only be passing VMLIs to start this fn")}catch(t){e.reportError(t)}try{e.PAssert(3789,e.isVMLI(n),"Should only be passing VMLIs to end this fn")}catch(t){e.reportError(t)}var a=this.getPane();if(a){var s=a.indexOfItem(t);try{e.PAssert(3790,s>=0,"Must be able to find the start item in the pane")}catch(t){e.reportError(t)}var o=a.indexOfItem(n);try{e.PAssert(3791,o>=0,"Must be able to find the end item in the pane")}catch(t){e.reportError(t)}return this.selectIndices(s,i,o,r)}},selectElements:function(t,n,r,a){try{e.PAssert(3792,!e.isVMLI(t),"Should not be passing VMLIs to start this fn")}catch(t){e.reportError(t)}try{e.PAssert(3793,!e.isVMLI(r),"Should not be passing VMLIs to end this fn")}catch(t){e.reportError(t)}this._isWatchingChange=!1,i.android&&(t=t.firstElementChild,r=r.firstElementChild);var s=!1,o=c.getOffsetChildElement(t,n),l=c.getOffsetChildElement(r,a);try{e.PAssert(3794,o&&o.element&&!isNaN(o.offset),"Start element is invalid")}catch(t){e.reportError(t)}try{e.PAssert(3795,l&&l.element&&!isNaN(l.offset),"End element is invalid")}catch(t){e.reportError(t)}return o&&o.element&&l&&l.element&&(c.setSelection(o.element,o.offset,l.element,l.offset),s=!0),this._isWatchingChange=!0,s},save:function(){if(this._isValid){try{e.PAssert(3796,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){e.reportError(t)}try{e.PAssert(3797,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){e.reportError(t)}return{pane:this.getPane(),startIndex:this.getStartIndex(),startItem:this.getStartItem(),startObject:this.getStartObject(),startOffset:this.getStartOffset(),endIndex:this.getEndIndex(),endItem:this.getEndItem(),endObject:this.getEndObject(),endOffset:this.getEndOffset()}}},restore:function(t){var i=!1;if(t){try{e.PAssert(3798,t.pane,"Must have a valid pane to restore selection to")}catch(t){e.reportError(t)}e.focusedPane=t.pane,e.focusedItem=t.pane.getItem(),this.pane.set(t.pane),t=t.pane.adjustSelectionFromPaneObject(t)}return t&&t.startItem&&t.endItem?(this.selectIndices(t.startIndex,t.startOffset,t.endIndex,t.endOffset),i=!0):this.reset(),i},scrollStartIntoView:function(t){if(this._isValid){try{e.PAssert(3799,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){e.reportError(t)}try{e.PAssert(3800,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){e.reportError(t)}e.focusedPane.scrollIndexIntoView(this.getStartIndex(),t?ScrollDuration.Snap:ScrollDuration.Default)}},scrollEndIntoView:function(){if(this._isValid){try{e.PAssert(3801,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){e.reportError(t)}try{e.PAssert(3802,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){e.reportError(t)}e.focusedPane.scrollIndexIntoView(this.getEndIndex(),ScrollDuration.Default)}},onWindowBlur:function(e){this.isWindowFocused.set(!1)},onWindowFocus:function(e){this.isWindowFocused.set(!0)},getSelectedItems:function(e){if(!this._isValid)return[];for(var t=[],i=this.getPane(),n=this.getStartIndex();n<=this.getEndIndex();++n){var r=i.itemAtIndex(n);!r||!e&&r.isNote()||t.push(r)}return t},getStartElement:function(){if(this._isValid&&!isNaN(this.getStartIndex()))return this.getPane().elementAtIndex(this.getStartIndex())},getEndElement:function(){if(this._isValid&&!isNaN(this.getEndIndex()))return this.getPane().elementAtIndex(this.getEndIndex())},setHovered:function(e,t,i){if(this.hoveredReactCell!==i){var n=this.hoveredItem;this.hoveredItem=t,this.hoveredReactCell=i,n&&n.itemChanged.notify(),t&&t.itemChanged.notify()}},isReactCellHovered:function(e){return this.hoveredReactCell===e},isItemHovered:function(e){return this.hoveredItem===e},insertTextAtCaret:function(t,i){this.pane.get().updateSelectionAndroid({target:this.getStartElement()});try{e.PAssert(3803,this.getStartIndex()===this.getEndIndex(),"Cannot insert text in multiselect")}catch(t){e.reportError(t)}var n=this.getStartIndex(),r=this.getStartItem(),a=this.getStartOffset(),s=this.getEndOffset(),o=r.getRawText();a!==s&&(o=o.substr(0,a)+o.substr(s,o.length-s)),i&&a>0&&" "!==o[a-1]&&(o=e.insertIntoText(o," ",a),a++),o=e.insertIntoText(o,t,a),a+=t.length,r.setText(o,!0,ChangeType.Local),this.selectIndex(n,a)}},new p}),define("tracker",["globals","util","platform","data","gdata","Sel"],function(e,t,i,n,r,a){function s(){this.disabled=!1,this.allowOfflineUndo=!1,this.cursor=-1,this.groupID=0,this.groups=[],this.externalUndoRedo=!1,this.undoRedoActive=!1,this.canRedo=!1,this.canUndo=!1,this._performingActions=!1,this._currentAction=[],this._actionsPreventUndo=!1,this._aggregateActions=0,this._externalStateChanged=[],t.forceBind("stateChangeForUndoRedo",this),this.init()}function o(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.itemID);try{e.PAssert(3804,s,"Expected model to exist: ",r)}catch(t){e.reportError(t)}var o=s.getParsedText(),c=0;"\ufeff"===o[0]&&(c=1);var l=o.slice(c,r.position)+o.slice(r.position+r.text.length);s.setText(l,!0,ChangeType.Local),a.selectItem(s,r.position)}}function c(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.itemID);try{e.PAssert(3805,s,"Expected model to exist: ",r)}catch(t){e.reportError(t)}var o=s.getParsedText(),c=o.slice(0,r.position)+r.text+o.slice(r.position);0===c.length&&(c="\ufeff"),s.setText(c,!0,ChangeType.Local),a.selectItem(s,r.position,r.position+r.text.length)}}function l(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.itemID);try{e.PAssert(3806,s,"Expected model to exist: ",r)}catch(t){e.reportError(t)}var o=s.getParsedText(),c=0;"\ufeff"===o[0]&&(c=1);var l=o.slice(c,r.position)+r.text+o.slice(r.position);s.setText(l,!0,ChangeType.Local),a.selectItem(s,r.position,r.position+r.text.length)}}function d(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.itemID);try{e.PAssert(3807,s,"Expected model to exist: ",r)}catch(t){e.reportError(t)}var o=s.getParsedText(),c=o.slice(0,r.position)+o.slice(r.position+r.text.length);0===c.length&&(c="\ufeff"),s.setText(c,!0,ChangeType.Local),a.selectItem(s,r.position)}}function h(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.parent);try{e.PAssert(3808,s,"Expected model to exist: ",r)}catch(t){e.reportError(t)}var o=s.removeChildAtIndex(r.position,ChangeType.Local);try{e.PAssert(3809,o.id===r.itemID,"Expected data to match removed child: ",o,r)}catch(t){e.reportError(t)}o.parent(void 0),n.deleteItem(o,ChangeType.Local);var c=s;r.position>0&&(c=s.getChild(r.position-1)),
e.focusedPane.indexOfItem(c)>=0&&a.selectItem(c,c.getParsedText().length),s.save({items:s.getItemsArrayForSave()},SaveFlag.None)}}function u(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.parent);try{e.PAssert(3810,s,"Expected parent model to exist: ",r)}catch(t){e.reportError(t)}var o=n.getModel(r.itemID);try{e.PAssert(3811,o,"Expected child model to exist: ",r)}catch(t){e.reportError(t)}n.undeleteItem(o,ChangeType.Local),o.parent(s),s.items.splice(r.position,0,o),a.selectItem(o,0),s.save({items:s.getItemsArrayForSave()},SaveFlag.None)}}function p(t){for(var r=0;r<t.length;++r){var s=t[r],o=n.getModel(s.parent);try{e.PAssert(3813,o,"Expected model to exist: ",s)}catch(t){e.reportError(t)}var c=n.getModel(s.itemID);try{e.PAssert(3814,c,"Expected model to exist: ",s)}catch(t){e.reportError(t)}n.undeleteItem(c,ChangeType.Local),c.parent(o),o.items.splice(s.position,0,c),i.mobile||a.selectItem(c,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function m(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.parent);try{e.PAssert(3816,s,"Expected model to exist: ",r)}catch(t){e.reportError(t)}var o=s.removeChildAtIndex(r.position,ChangeType.Local);try{e.PAssert(3817,o.id===r.itemID,"Expected data to match removed child: ",o,r)}catch(t){e.reportError(t)}o.parent(void 0),n.deleteItem(o,ChangeType.Local);var c=s;r.position>0&&(c=s.getChild(r.position-1)),a.selectItem(c,c.getParsedText().length),s.save({items:s.getItemsArrayForSave()},SaveFlag.None)}}function f(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.oldParent);try{e.PAssert(3818,s,"Expected oldParent model to exist: ",r)}catch(t){e.reportError(t)}var o=n.getModel(r.newParent);try{e.PAssert(3819,o,"Expected newParent model to exist: ",r)}catch(t){e.reportError(t)}var c=o.removeChildAtIndex(r.newPosition,ChangeType.Local);try{e.PAssert(3820,c.id===r.itemID,"Expected data to match child: ",c,r)}catch(t){e.reportError(t)}c.parent(s),s.items.splice(r.oldPosition,0,c),a.selectItem(c,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None),s.save({items:s.getItemsArrayForSave()},SaveFlag.None)}}function g(t){for(var i=0;i<t.length;++i){var r=t[i],s=n.getModel(r.oldParent);try{e.PAssert(3821,s,"Expected oldParent model to exist: ",r)}catch(t){e.reportError(t)}var o=n.getModel(r.newParent);try{e.PAssert(3822,o,"Expected newParent model to exist: ",r)}catch(t){e.reportError(t)}var c=s.removeChildAtIndex(r.oldPosition,ChangeType.Local);try{e.PAssert(3823,c.id===r.itemID)}catch(t){e.reportError(t)}c.parent(o),o.items.splice(r.newPosition,0,c),a.selectItem(c,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None),s.save({items:s.getItemsArrayForSave()},SaveFlag.None)}}function v(t){for(var i=0;i<t.length;++i){var r=t[i],a=n.getModel(r.itemID);try{e.PAssert(3824,a,"Expected model to exist: ",r)}catch(t){e.reportError(t)}try{e.PAssert(3825,a[r.field],"Expected field to exist: ",r)}catch(t){e.reportError(t)}a[r.field](r.oldValue,ChangeType.Local)}}function y(t){for(var i=0;i<t.length;++i){var r=t[i],a=n.getModel(r.itemID);try{e.PAssert(3826,a,"Expected model to exist: ",r)}catch(t){e.reportError(t)}try{e.PAssert(3827,a[r.field],"Expected field to exist: ",r)}catch(t){e.reportError(t)}a[r.field](r.newValue)}}function b(t){for(var i=0;i<t.length;++i){var r=t[i],a=n.getModel(r.itemID);try{e.PAssert(3828,a,"Expected model to exist: ",r)}catch(t){e.reportError(t)}}}function S(t){for(var i=0;i<t.length;++i){var r=t[i],a=n.getModel(r.itemID);try{e.PAssert(3829,a,"Expected model to exist: ",r)}catch(t){e.reportError(t)}}}function E(t){var i=t[0],r=n.getModel(i.oldItemID);try{e.PAssert(3830,r,"Expected model to exist: ",i)}catch(t){e.reportError(t)}if(i.zoomIn)e.vmMain.zoomout(r,!0);else if(i.zoomOut)e.vmMain.zoomin(r,!0);else try{e.PAssert(3831,!1,"Zoom action must define either zoomIn or zoomOut")}catch(t){e.reportError(t)}}function C(t){var i=t[0],r=n.getModel(i.itemID);try{e.PAssert(3832,r,"Expected model to exist: ",i)}catch(t){e.reportError(t)}if(i.zoomIn)e.vmMain.zoomout(r,!0);else if(i.zoomOut)e.vmMain.zoomin(r,!0);else try{e.PAssert(3833,!1,"Zoom action must define either zoomIn or zoomOut")}catch(t){e.reportError(t)}}function P(t){switch(t[0].type){case TrackerUIAction.RemovePane:case TrackerUIAction.SwitchPaneMode:break;default:try{e.PAssert(3834,!1,"Invalid UIAction")}catch(t){e.reportError(t)}}}function T(e){}window.TrackerType={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11,Mobile:12},window.TrackerMisc={ToggleOverview:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,OpenDocumentsMenu:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19,AddToGCal:20,OpenEmail:21,ComposeEmail:22,DriveUpload:23,OpenDisplaySettings:24,DragItem:25,OpenAddPaneMenu:26,SetPrefix:27,OpenCalendarsMenu:28,OpenHelp:29},window.TrackerMiscMobile={OpenKeyboard:1,CloseKeyboard:2,PaneCalendar:3,PaneOutline:4,OpenAutocomplete:5,CloseAutocomplete:6,AtButton:7,OpenMultiselect:8,CloseMultiselect:9},window.TrackerUIAction={AddPane:1,RemovePane:2,SwitchPaneMode:3,OpenSettingsMenu:4,AddBoard:5};return s.prototype={init:function(){this.listeners=[],r.registerForUndoRedoStateChange(this)},addListener:function(e){this.listeners.push(e)},removeListener:function(e){this.listeners.remove(e)},_getNextGroupID:function(){return this.groupID+1},_useNextGroupID:function(){return++this.groupID},_getCurrentGroup:function(){return this.groups[this.cursor]},_getCurrentAction:function(){return this.groups[this.cursor].events[this.groups[this.cursor].events.length-1]},_pushGroup:function(){var e=this._useNextGroupID();return this.groups.push({id:e,events:[],persisted:!1}),this.cursor<74&&this.cursor++,this.groups.length>75&&this._handleGroupTrimmed(this.groups.shift()),e},_doAction:function(t,i){var n=this._getCurrentGroup();try{e.PAssert(3835,n,"Expected group to exist")}catch(t){e.reportError(t)}var r={type:t,data:i};switch(t){case TrackerType.Insert:r.cb={undo:o,redo:c};break;case TrackerType.Remove:r.cb={undo:l,redo:d};break;case TrackerType.Create:r.cb={undo:h,redo:u};break;case TrackerType.Delete:r.cb={undo:p,redo:m};break;case TrackerType.Move:r.cb={undo:f,redo:g};break;case TrackerType.Update:r.cb={undo:v,redo:y};break;case TrackerType.Format:r.cb={undo:b,redo:S};break;case TrackerType.Zoom:r.cb={undo:E,redo:C};break;case TrackerType.UIAction:r.cb={undo:P,redo:T};break;default:try{e.PAssert(3836,!1,"Expected TrackerType, received: ",t)}catch(t){e.reportError(t)}}n.events.push(r)},_handleGroupTrimmed:function(t){for(var i=0;i<t.events.length;++i){var n=t.events[i];switch(n.type){case TrackerType.Insert:case TrackerType.Remove:case TrackerType.Create:case TrackerType.Delete:case TrackerType.Move:case TrackerType.Update:case TrackerType.Format:case TrackerType.Zoom:case TrackerType.UIAction:break;default:try{e.PAssert(3837,!1,"Expected TrackerType, received: ",n.type)}catch(t){e.reportError(t)}}}},_mergeAction:function(t,i){log("Tracker Action Merged: ",t,i);var n=this._getCurrentAction();try{e.PAssert(3838,n,"Expected action to exist")}catch(t){e.reportError(t)}switch(t){case TrackerType.Insert:case TrackerType.Remove:case TrackerType.Create:case TrackerType.Delete:case TrackerType.Move:case TrackerType.Update:break;case TrackerType.Format:try{e.PAssert(3839,!1,"Formats cannot be merged")}catch(t){e.reportError(t)}break;case TrackerType.Zoom:try{e.PAssert(3840,!1,"Zooms cannot be merged")}catch(t){e.reportError(t)}break;case TrackerType.UIAction:try{e.PAssert(3841,!1,"UIActions cannot be merged")}catch(t){e.reportError(t)}break;default:try{e.PAssert(3842,!1,"Expected TrackerType, received: ",t)}catch(t){e.reportError(t)}}},_canMerge:function(e){var t=!1,i=this._getCurrentGroup();return i&&i.events.length>0&&(i.events[i.events.length-1].type===e?e===TrackerType.Insert&&(t=!0):t=!1),t},_canCombine:function(e,t){var i=this._getCurrentGroup();return i&&(i.id===t||0===i.events.length)},performActions:function(t){try{e.PAssert(3843,!this.disabled||e.intro,"Can only perform actions when enabled or during the intro")}catch(t){e.reportError(t)}try{e.PAssert(3844,!this._performingActions,"Can not nest performing actions")}catch(t){e.reportError(t)}if(this._performingActions=!0,t&&t.length>0){if(!this.disabled){var i=void 0;this.cursor!=this.groups.length-1?(this.groups.splice(this.cursor+1,this.groups.length-(this.cursor+1)),i=this._pushGroup()):i=this._getNextGroupID()}for(var n=0;n<t.length;++n){var r=t[n];this.fireActionEvent(r),this.disabled||(this._canCombine(r.type,i)?this._canMerge(r.type)?this._mergeAction(r.type,r.data):this._doAction(r.type,r.data):(i=this._pushGroup(),this._doAction(r.type,r.data)))}}this._performingActions=!1},beginAction:function(t){try{e.PAssert(3845,!this._performingActions,"Should never begin an action while replaying old actions")}catch(t){e.reportError(t)}if(0===this._aggregateActions){this._actionsPreventUndo=!!t,r.beginAction(t);try{e.PAssert(3846,0===this._currentAction.length,"Current actions should always be empty when starting a new action")}catch(t){e.reportError(t)}}this._aggregateActions++},performAction:function(t,i){try{e.PAssert(3847,!this._performingActions,"Should never perform an action while replaying old actions")}catch(t){e.reportError(t)}var n=!e.vmMain.isLoaded||e.isLoadingRemote;this.disabled?e.intro&&(n||this.performActions([{type:t,data:[i]}])):this._aggregateActions?this._currentAction.push({type:t,data:[i]}):this.performActions([{type:t,data:[i]}])},endAction:function(){try{e.PAssert(3848,!this._performingActions,"Should never end an action while replaying old actions")}catch(t){e.reportError(t)}try{e.PAssert(3849,0!==this._aggregateActions,"Must have called beginAction before calling endAction")}catch(t){e.reportError(t)}1===this._aggregateActions&&(this.disabled&&!e.intro||this.performActions(this._currentAction),this._currentAction.length=0,r.endAction(),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},resetAggregateActionCount:function(){this._aggregateActions=0},_processStateChangedSelection:function(t,i){try{e.PAssert(3850,!this.undoRedoActive,"Must not currently be undoing/redoing an action when setting selection")}catch(t){e.reportError(t)}var r,s=0,o=0;if(e.isKeyboardOPen||!e.keyboardToolbar){for(var c=0;c<t.length;++c){var l=t[c],d=l.data,h=n.getModel(d.itemID);try{e.PAssert(3851,h,"Expected model to exist: ",d)}catch(t){e.reportError(t)}switch(l.type){case TrackerType.Insert:r=h,s=d.position,o=d.text.length;break;case TrackerType.Remove:r=h,s=d.position,o=0;break;case TrackerType.SetText:e.focusedPane.indexOfItem(h)>=0&&(r=h,s=d.position,o=0);break;case TrackerType.Create:r=h,s=0,o=0;break;case TrackerType.Delete:if(d.previous){var u=n.getModel(d.previous);u&&u.isDescendantOf(e.focusedPane.getItem())&&(r=u,s=u.getParsedText().length,o=0)}}}var p=-1;e.focusedPane&&(r?p=i&&i.item===r?e.focusedPane.closestIndexOfObject(i):e.focusedPane.indexOfItem(r):(s=a.getStartOffset()||0,p=i?e.focusedPane.closestIndexOfObject(i):-1,o=0)),p>=0?(a.selectIndex(p,s,s+o),r&&e.focusedPane.scrollItemIntoView(r,ScrollDuration.Default)):a.reset()}this._externalStateChanged=[]},notifyStateChangedFromUndoRedo:function(t,i){try{e.PAssert(3852,this.undoRedoActive)}catch(t){e.reportError(t)}this._externalStateChanged.push({type:t,data:i})},undoAction:function(){e.vmMain.canRunUndoRedo()||e.toasts.pushMessage(MessageID.OfflineUndo),this.undoRedoActive=!0;try{e.PAssert(3853,!this._performingActions)}catch(t){e.reportError(t)}this.beforeUndoRedo();var t=a.isValid()?a.getStartObject():void 0;if(!this.disabled&&this.allowOfflineUndo){if(this.cursor>=0)for(var i=this.groups[this.cursor--],n=i.events.length-1;n>=0;n--){var s=i.events[n];s.cb.undo(s.data)}}else if(this.canUndo){try{e.PAssert(3854,this.externalUndoRedo)}catch(t){e.reportError(t)}r.undoAction()}this.afterUndoRedo(),this.undoRedoActive=!1,this._processStateChangedSelection(this._externalStateChanged,t),this.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{undo:!0}]})},redoAction:function(){e.vmMain.canRunUndoRedo()||e.toasts.pushMessage(MessageID.OfflineUndo),this.undoRedoActive=!0;try{e.PAssert(3855,!this._performingActions)}catch(t){e.reportError(t)}this.beforeUndoRedo();var t=a.isValid()?a.getStartObject():void 0;if(!this.disabled&&this.allowOfflineUndo){if(this.cursor>=-1&&this.cursor<this.groups.length-1)for(var i=this.groups[++this.cursor],n=0;n<i.events.length;++n){var s=i.events[n];s.cb.redo(s.data)}}else if(this.canRedo){try{e.PAssert(3856,this.externalUndoRedo)}catch(t){e.reportError(t)}r.redoAction()}this.afterUndoRedo(),this.undoRedoActive=!1,this._processStateChangedSelection(this._externalStateChanged,t),this.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{redo:!0}]})},beforeUndoRedo:function(){e.vmMain.beginUpdateItems()},afterUndoRedo:function(){e.vmMain.commitUpdateItems()},miscAction:function(e){this.fireActionEvent(e)},resetState:function(){this._performingActions=!1,this._externalStateChanged=[],this._currentAction=[],this.undoRedoActive=!1,this.cursor=-1,this.groupID=0,this.groups=[]},_getOrderedGroups:function(){return this.groups.slice(this.cursor).concat(this.groups.slice(0,this.cursor))},stringifyGroups:function(){return"Tracker: "+this._getOrderedGroups().length},stateChangeForUndoRedo:function(e){this.externalUndoRedo=!0,this.disabled=!0,this.canRedo=e.canRedo,this.canUndo=e.canUndo},fireActionEvent:function(t){try{if(t.data||(t.data={}),this.listeners)for(var i=0;i<this.listeners.length;i++)this.listeners[i](t)}catch(t){e.reportError(t)}}},new s}),define("DragDrop",["globals","Constants","platform","tracker","data","Observable","ObservableArray","Sel","NativeSel","Dispatcher"],function(e,t,i,n,r,a,s,o,c,l){function d(){this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.dragItem=void 0,this.draggingItems=[],this.position=void 0,this.isVisible=new a(!1),this.transform=new a({left:0,top:0}),this.linePosition=new a,this.isDraggingPane=new a(!1),this.draggingToOutline=new a,this.dragTargetHovered=new a,window.addEventListener("dragover",this.handleDragOver.bind(this)),window.addEventListener("dragleave",this.handleDragLeave.bind(this)),window.addEventListener("drop",this.handleDrop.bind(this)),e.dragDrop=this}var h;return require(["copypaste"],function(e){h=e}),d.prototype={stop:function(){this.activePane&&!this.activePane.isDestroyed()?this.activePane.notifyDragEnd():e.vmMain.paneManager.runForEachPane(function(e){e.notifyDragEnd()});for(var t=this.draggingItems,i=0;i<t.length;++i)t[i].draggedInPane.set(!1);this.draggingItems=[],this.isDragging=!1,this.dragItem=void 0,this.position=void 0,this.externalData=void 0},finish:function(){this.isVisible.set(!1),this.agendaInfo=void 0,l.fireEvent("endDrag",[])},start:function(i,r,a,s,c,l,d,h){this.isDragging&&(this.stop(),this.finish()),o.reset(),e.vmMain.setItemAnimationMode(t.ItemAnimationMode.None),this.isDragging=!0,this.activePane=c,this.dragInfo=null,this.startPane=c,this.startInfo=l,this.dataTransfer=d,this.dragItem=i,this.startDragitem=i,this.fromOverview=h,this.externalData=void 0,this.draggingItems=r,this.position={left:a,top:s},this.transform.set({left:0,top:0},!1);for(var u=0;u<r.length;++u)r[u].draggedInPane.set(e.focusedPane);this.isVisible.set(!0),this.activePane.notifyDragStart(),n.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DragItem,data:{itemID:this.id,fromPane:c}})},startExternal:function(e){this.isDragging=!0,this.activePane=e,this.startPane=e,this.draggingItems=[],this.isVisible.set(!0),this.activePane.notifyDragStart()},setExternalData:function(e){this.externalData=e},setTransform:function(e,t){this.isVisible.set(!0,!1),this.transform.set({left:e,top:t})},handleDragOver:function(t){var n=e.elementFromPoint(t.clientX,t.clientY),r=e.getPaneForElement(n);if(this.activePane&&r!==this.activePane&&this.revertDrag(),i.mobile){var a=e.findParent(n,"dragTarget",3);a&&(a=a.id),this.dragTargetHovered.set(a)}if(r){this.isDragging||this.startExternal(r),this.activePane=r;var s=!!e.findParent(n,"paneOverviewScroller");r.canAcceptDragOver(t.dataTransfer.pane,t.item,n,s)?this.dragInfo=r.handleDragOver(t.dataTransfer.pane,t.item,n,t.clientX,t.clientY):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||e.cancelRepeatScroll(),!1},revertDrag:function(){this.dragInfo=null,this.activePane.revertDrag()},handleDropItem:function(t,n,r){var a=t,s=this.activePane;this.isDropping=!0,e.cancelRepeatScroll();var o=document.elementFromPoint(n.clientX,n.clientY);if(o&&e.findParent(o,"mobileDropBucket"))e.vmMain.dropBucket.addItemEntry(t,s),this.dragTargetHovered.set(void 0);else if(i.mobile&&o&&e.findParent(o,"mobileDragToOutline"))this.draggingToOutline.set({item:t,pane:this.activePane}),e.vmMain.switchPaneMobile(PaneMode.Outline,!0),this.dragTargetHovered.set(void 0);else if(this.dragInfo&&s)e.vmMain.beginUpdateItems(),s.handleDragDrop(t,n,this.dragInfo,r),e.vmMain.commitUpdateItems();else if(e.isNonPaneDropTarget(n.target)){var l,s=n.dataTransfer.pane;if(s){l=s.notifyDropFromToEdit(t,n.target);try{e.PAssert(3858,!l||e.isDOMNode(l),"Must always return DOM elements to insert")}catch(t){e.reportError(t)}}if(l){var d=c._getCursorSelectionRange(n.clientX,n.clientY);c.setSelectionRange(d),c.insertNode(l)}}return this.isDropping=!1,a},handleDrop:function(t){if(this.activePane&&(e.elementInPane(t.target)||t.fromDropBucket)){var a=t.dataTransfer.item;if(a)this.handleDropItem(a,t);else{if(!e.vmMain.pluginManager.handleDropEvent(t,function(e,i){n.beginAction();var a=r.createVMLI({text:e},{changeType:ChangeType.AllLocal,noParentOkay:!0});return a=this.handleDropItem(a,t,i),n.endAction(),a}.bind(this)))if(t.dataTransfer.getData(i.ie?"Text":"text/plain")||t.dataTransfer.getData("text/html")){var s=c.getCursorSelectionRange(t);try{e.PAssert(3859,s,"Range should always be properly set")}catch(t){e.reportError(t)}o.setFocusedPane(this.activePane),n.beginAction();var l=r.createVMLI({text:""},{changeType:ChangeType.AllLocal,noParentOkay:!0});l=this.handleDropItem(l,t,!0),o.selectItem(l,0),h.insert(t.dataTransfer,t,DataSource.Drop),n.endAction()}else if(this.externalData){var d=this.externalData;this.externalData=void 0;var u=d.split(":"),p=(u.removeAt(0),u.removeAt(0)),m=u.join(":"),f="["+p+"]("+m+")";n.beginAction();var l=r.createVMLI({text:f},{changeType:ChangeType.AllLocal});l=this.handleDropItem(l,t,!0),n.endAction()}}}else e.isNonPaneDropTarget(t.target)&&t.dataTransfer.item&&this.handleDropItem(t.dataTransfer.item,t);this.isDragging=!1,this.isVisible.set(!1),e.vmMain.resetItemAnimationMode(),t.stopPropagation(),t.preventDefault()},handleDragLeave:function(e){e.clientX||e.clientY||(this.isDragging=!1,this.isVisible.set(!1))},setAgendaInfo:function(e){this.agendaInfo=e},stopDraggingToOutline:function(){var t=this.draggingToOutline.get();t&&t.pane&&setTimeout(function(){e.vmMain.switchPaneMobile(t.pane.type,!0)},300),this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}},new d}),define("ObservableComputed",["require","globals","util","Listener","Observable"],function(e){function t(e,t,r){this._destroyed=!1,n.forceBind("onChanged",this);for(var a=0;a<e.length;a++)e[a].listen(this.onChanged);this._observables=e,t&&i.isFunction(t)?this.checkFn=t:this.checkFn="or"===t?this.checkFnOr:this.checkFnAnd;var s=this.checkFn();this._super.constructor.call(this,s,r)}var i=e("globals"),n=e("util"),r=(e("Listener"),e("Observable")),a={checkFnOr:function(){for(var e=!1,t=0;!e&&t<this._observables.length;t++)e=e||this._observables[t].get();return e},checkFnAnd:function(){for(var e=!0,t=0;e&&t<this._observables.length;t++)e=e&&this._observables[t].get();return e},onChanged:function(){var e=this._value,t=this.checkFn();t!==e&&this._super.set.call(this,t)},destroy:function(){this._destroyed=!0;for(var e=0;e<this._observables.length;++e)this._observables[e].unlisten(this.onChanged)}};return n.inherit(r,t),n.extend(t.prototype,a),t}),define("MobileUI",["require","globals","Constants","platform","Observable","ObservableComputed","DragDrop","Sel","Multiselect"],function(e){function t(){this.swipeMode=d.None,this.swipeX=0,this.swipePoints=[],this.multiselectAnimate=!1,this.multiselectOffset=new a(0),this.topBarMode=new a(n.TopBarMode.Normal),this._isDisabled=!r.mobile}var i=e("globals"),n=e("Constants"),r=e("platform"),a=e("Observable"),s=e("ObservableComputed"),o=e("DragDrop"),c=e("Sel"),l=e("Multiselect"),d={None:0,Item:1,Multiselect:2,Overview:3};return t.prototype={init:function(){this.bottomBarHeight=new s([i.vmMain.gdriveStatusObs],this.getBottomBarHeight.bind(this))},isSwiping:function(){return this._isSwiping},disable:function(){this._isDisabled=!0},enable:function(){try{i.PAssert(3860,r.mobile,"Should never enable MobileUI on desktop")}catch(e){i.reportError(e)}this._isDisabled=!1},isDisabled:function(){return this._isDisabled||i.isKeyboardOpen},start:function(e){if(r.mobile&&this.enable(),i.focusedPane.isOverviewVisible()&&e.clientX>this.overviewWidth())return!0},update:function(e){if(!this.isDisabled()&&!o.draggingToOutline.get()){var t=i.dataFor(e.startSrc,!0);this.swipeMode===d.None&&(i.focusedPane.isOverviewVisible()?this.swipeMode=d.Overview:Math.abs(e.distanceY)<i.ClickThreshold&&Math.abs(e.diffX)>i.ClickThreshold&&(this.isInMultiselect()?this.swipeMode=d.Multiselect:t&&i.isVMLI(t)&&!t.isNote()&&(this.swipeMode=d.Item)));var a=e.diffX;if(this.swipePoints.splice(0,0,{time:Date.now(),x:e.xThisFrame}),this.swipePoints.length>20&&this.swipePoints.splice(this.swipePoints.length-1,1),this.swipeMode===d.Multiselect)a=i.clamp(-n.RightMenuWidth+a,-n.RightMenuWidth,0),this.updateMultiselectPosition(a);else if(this.swipeMode===d.Overview)a=i.clamp(this.overviewWidth()+a,0,this.overviewWidth()),i.focusedPane.updatePosition(a,!1);else if(this.swipeMode===d.Item&&t){var s=i.getCellForElement(e.target);try{i.PAssert(3861,s,"Expected cell for swipe")}catch(e){i.reportError(e)}s&&(a=i.clamp(a,-r.windowWidth(),r.windowWidth()),s.isAnimatingOffsetX=!1,s.offsetX.set(a))}this.lastX=e.diffX}return this.swipeMode!==d.None&&e.preventDefault(),this.swipeMode!==d.None},onClickPane:function(e){var t=i.focusedPane;!this.isDisabled()&&t.isOverviewVisible()&&(i.closeKeyboard(),this.setOverviewVisibility(t,!1))},end:function(e){var t=i.focusedPane,a=this.swipeMode!==d.None;if(!this.isDisabled())if(this.swipeMode===d.Item){var s=i.dataFor(e.startSrc,!0);if(s&&i.isVMLI(s)){var o=i.getCellForElement(e.target),c=i.getItemForElement(e.target);try{i.PAssert(3862,o&&c,"Expected cell and item for swipe")}catch(e){i.reportError(e)}if(o){var l=t.getSwipeMenuItem(c,o.offsetX.get());o.isAnimatingOffsetX=!0,o.offsetX.set(0),l.fn&&l.fn(c)}}}else if(this.swipeMode===d.Multiselect||this.swipeMode===d.Overview){for(var h,u,p=Date.now(),m=0,f=0,g=0;g<this.swipePoints.length;g++){var v=this.swipePoints[g];if(!(p-v.time<300))break;m+=v.x,f=p-v.time}var y=m?m/(f/1e3):0;y<-200?h=0:y>200?h=1:this.swipeMode===d.Overview?h=Math.round((this.overviewWidth()+this.lastX)/r.windowWidth()):this.swipeMode===d.Multiselect&&(h=Math.round(this.lastX/n.RightMenuWidth)),this.swipeMode===d.Overview?(u=h>0,this.setOverviewVisibility(t,u),u&&i.closeKeyboard()):this.swipeMode===d.Multiselect&&(u=0===h,this.setMultiselectVisibility(u))}return this.swipeMode=d.None,this.swipePoints.length=0,a},setOverviewVisibility:function(e,t){e.updatePosition(t?this.overviewWidth():0,!0),e.overview.setVisibility(t)},toggleOverviewVisibility:function(e){e=e||i.focusedPane;var t=!e.isOverviewVisible();this.setOverviewVisibility(e,t)},overviewWidth:function(){return Math.min(Math.floor(.85*r.windowWidth()),400)},isInMultiselect:function(){return 0!==this.multiselectOffset.get()},updateMultiselectPosition:function(e,t){this.multiselectAnimate=t,this.multiselectOffset.set(e),this.topBarMode.set(0!==e?n.TopBarMode.Multiselect:n.TopBarMode.Normal),0!==e&&i.closeKeyboard()},setMultiselectVisibility:function(e){this.updateMultiselectPosition(e?-n.RightMenuWidth:0,!0),e||l.reset()},setTopBarMode:function(e){this.topBarMode.set(e)},resetTopBarMode:function(){var e=this.topBarMode.get();e===n.TopBarMode.Multiselect?(this.updateMultiselectPosition(0,!0),l.reset()):e===n.TopBarMode.Note&&(i.menus.closeContextMenuReact(),c.reset()),i.autocomplete.hide(),this.topBarMode.set(n.TopBarMode.Normal)},getBottomBarHeight:function(){return n.MobileBottomHeight+(i.vmMain.onlineText()?14:0)}},new t}),define("VMLI_TapHandlers",["require","globals","data","platform","DragDrop","NativeSel","Sel","DesktopUI","Dispatcher","MobileUI","Multiselect"],function(e){var t=e("globals"),i=e("data"),n=e("platform"),r=e("DragDrop"),a=e("NativeSel"),s=e("Sel"),o=(e("DesktopUI"),e("Dispatcher")),c=e("MobileUI"),l=e("Multiselect");return{dragStart:function(e,i){var a=e.pane||t.focusedPane;try{t.PAssert(3863,!n.mobile||a.isItemDraggable(this),"Should not be able to drag/drop on timeline on mobile")}catch(e){t.reportError(e)}try{t.PAssert(3864,a.isItemDraggable(this),"Pane must be draggable in order to start a drag")}catch(e){t.reportError(e)}try{t.PAssert(3865,r.startDragItem,"Should always have a valid item to start dragging from")}catch(e){t.reportError(e)}var s=t.getElementParent(e.startSrc||e.target);try{t.PAssert(3866,s,"Must have a valid target node")}catch(e){t.reportError(e)}if(s){r.startDragItem=void 0,r.dragItem=this;var o=[this];if(!i){var c=a.getItemSearchParams();c.includeNotes=!1,c.item=this,c.itemStoreFilter=void 0,o=o.concat(t.searchVMLIsAsArray(c))}var l=t.offset(s),d=l.left,h=l.top;n.mobile?a.addScrollListener(this.dragScroll):t.vmMain.paneManager.runForEachPane(function(e){e.addScrollListener(this.dragScroll)}.bind(this));var u={x:e.eventX,y:e.eventY},p={dropEffect:a.dropEffect(this),item:this,element:s,pane:a};r.start(this,o,d,h,a,u,p,i),t.disableMouseMove=!0}},dragMove:function(e){try{t.PAssert(3867,r.startInfo,"Must have started a drag to be valid")}catch(e){t.reportError(e)}if(r.startInfo){if("touchmove"===e.type){if(!e.cancelable)return void this.dragEnd(e);e.returnValue=!1,e.returnFalse=!0,e.preventDefault(),e.stopPropagation()}var i=e.eventX-r.startInfo.x,n=e.eventY-r.startInfo.y,a=t.elementFromPoint(e.eventX,e.eventY);r.setTransform(i,n),a&&r.handleDragOver({item:this,target:a,dataTransfer:r.dataTransfer,diffY:e.diffY,clientX:e.eventX,clientY:e.eventY,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn})}},dragScroll:function(e){if(r.isDragging){var i={eventX:s.mousePos.x,eventY:s.mousePos.y,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,diffY:0};this.dragMove(i)}},dragEnd:function(e){t.disableMouseMove=!1,r.stop(),e.target!==document.documentElement&&r.handleDrop({target:e.target,clientX:e.clientX,clientY:e.clientY,dataTransfer:r.dataTransfer,fromDropBucket:e.fromDropBucket,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn}),r.finish(),n.mobile?t.focusedPane.removeScrollListener(this.dragScroll):t.vmMain.paneManager.runForEachPane(function(e){e.removeScrollListener(this.dragScroll)}.bind(this)),t.disableMouseMove=!1},onTouchHoldTimeout:function(e){this._destroyed||(t.isKeyboardOpen?this.isLoupeOpen=!0:t.focusedPane&&t.focusedPane.isDropTarget&&this.isDraggable()&&t.focusedPane.isItemDraggable(this)&&!t.findParent(e.target,"androidInput")&&(this.isEditable.set(!1),r.startDragItem=this,this.dragStart(e),this.dragMove(e)))},checkDragOnStart:function(e){r.startDragItem=this},checkDragOnMove:function(e,i){if(r.startDragItem&&(!n.touch||Math.abs(e.distanceY)>t.ClickThreshold&&Math.abs(e.distanceX)<t.ClickThreshold)){var a=e.pane||t.focusedPane;r.startDragItem===this&&this.isDraggable()&&a.isItemDraggable(this)&&this.dragStart(e,i)}r.isDragging&&this.dragMove(e)},checkDragOnEnd:function(e){r.startDragItem=void 0,r.isDragging&&this.dragEnd(e)},onStart:function(e,i){var r=t.focusedPane;if(t.scrollAtTouchStart=r.getScrollOffset(),n.mobile&&(t.isKeyboardOpen||this.isEditable.set(!1),!t.isKeyboardOpen&&n.useCustomScroller&&i.preventDefault()),t.hasClass(i.target,"paneScroller"))n.useCustomScroller&&i.preventDefault();else if(!n.mobile&&t.hasClass(i.target,"prefixNumList"))i.preventDefault(),i.stopImmediatePropagation();else if(!n.mobile&&t.hasClass(i.target,"emptyItemAddButton"))t.menus.openContextMenuReact({componentName:"ReactContextMenuAddItem",element:i.target,item:this}),i.preventDefault(),i.stopImmediatePropagation();else if(!n.mobile&&t.hasClass(i.target,"link")){var a=i.target.getAttribute("data-href"),c=s.isSelected(e,r);c||n.mac&&i.metaKey||!n.mac&&i.ctrlKey||!t.isUrlImage(a)?(n.mac&&i.metaKey||!n.mac&&i.ctrlKey||n.mobile||t.findParent(i.target,"appLink",2)&&!c)&&(t.openUrl(a,i),t.handlerPreventStop(i)):(t.menus.openLightbox(a),t.handlerPreventStop(i))}else n.mobile&&!n.ie&&"UL"!==i.target.tagName&&r.isItemDraggable(this)&&!o.isListening("touchHoldTimeout",this.onTouchHoldTimeout)&&o.listen("touchHoldTimeout",this.onTouchHoldTimeout),!n.mobile&&this.isDraggable()&&r.isItemDraggable(this)&&(n.mobile&&i.clientX<this.getPadding(r)||!n.mobile&&t.hasClass(i.target,"collapser")||!n.mobile&&t.hasClass(i.target,"itemEditButton")||!n.mobile&&t.hasClass(i.target,"itemPrefix")||!n.mobile&&t.hasClass(i.target,"bullet")||t.findParent(i.target,"plugin"))?(this.checkDragOnStart(i),t.vmMain.updateCursorFromEvent(i)):n.mobile&&i.clientX>r.getWidth()-t.SPThresholdRight||!n.mobile&&t.hasClass(i.target,"itemCheckbox")||(!n.mobile&&t.hasClass(i.target,"itemAddButton")?(i.preventDefault(),i.stopImmediatePropagation()):t.vmMain.pluginManager.handleTapStart(this,r,i))},onMove:function(e,t){this.checkDragOnMove(e,!1)},onClick:function(e,o){var d=t.focusedPane,h=n.mobile&&r.draggingToOutline.get();if(n.mobile&&r.isDragging)o.preventDefault(),n.mobile&&this.isEditable.set(!1);else if(n.mobile&&c.isInMultiselect()){l.toggleSelected(e);var u;if(this.isNote()?u=e-1:this.hasNote()&&(u=e+1),!isNaN(u)){var p=l.isSelected(e,d);l.toggleSelected(u,d,p)}}else if(h)h.pane.moveItem(h.item,this),r.stopDraggingToOutline();else if(n.mobile&&o.clientX<d.getPaddingForItem(this)||!n.mobile&&t.hasClass(o.target,"collapser"))d.handleLeftSideTap(this,o),o.preventDefault(),o.stopImmediatePropagation();else if(!n.mobile||!t.hasClass(o.target,"link")||n.mobile&&t.isKeyboardOpen)if(!n.mobile&&t.hasClass(o.target,"itemCheckbox")||t.hasClass(o.target,"prefixTask"))d.handleRightSideTap(this,o),o.preventDefault(),o.stopImmediatePropagation();else if(!n.mobile&&t.hasClass(o.target,"itemAddButton")){this.addItemAtIndex("",0,d);var m=d.indexOfNextVMLI(e,!1,!0);s.selectIndex(m,0),o.preventDefault(),o.stopImmediatePropagation()}else if(!n.mobile&&d.supportBulletZoom&&(t.hasClass(o.target,"bullet")||t.hasClass(o.target,"prefixBullet")||t.hasClass(o.target,"prefixHeader")))t.vmMain.zoomin(this);else if(!n.mobile&&t.hasClass(o.target,"itemEditButton"))s.reset(),t.menus.openContextMenuReact({componentName:"ReactItemDetailsPopup",element:t.findParent(o.target,"item"),item:this,pane:d,selectIndex:0}),o.preventDefault(),o.stopImmediatePropagation();else if("SPAN"===o.target.tagName&&t.hasClass(o.target,"itemDataPageLoad"))this.notifyPaginationUpdate();else if(!t.hasClass(o.target,"tag")||n.mobile&&t.isKeyboardOpen)if(!t.hasClass(o.target,"contact")||n.mobile&&t.isKeyboardOpen){if(!n.mobile&&t.hasClass(o.target,"date")){if(n.mac&&o.metaKey||!n.mac&&o.ctrlKey){s.reset();var f=o.target.textContent;o.shiftKey?d.search.setValue(f):d.search.addToValue(f)}}else if(!n.mobile&&t.hasClass(o.target,"email")){if(n.mac&&o.metaKey||!n.mac&&o.ctrlKey){var g=t.vmMain.getDefaultEmailPlugin();if(g.isActive()){s.reset();var f=o.target.textContent,v={to:[{text:"",
email:f}]};t.menus.openComposeEmail(g,void 0,void 0,v)}}}else if(t.vmMain.pluginManager.handleTapClick(this,d,o))n.mobile?(o.preventDefault(),o.stopImmediatePropagation()):r.isDragging&&this.dragEnd(o);else if(t.autocomplete&&t.autocomplete.hide(),n.mobile){var y=document.activeElement,b=d.getScrollOffset(),S=Math.abs(b-t.scrollAtTouchStart)>0;if(this.allowTextEditing()){if(d.isWriteable&&!S){var E,C=this;if(n.ios&&this.isEditable.set(!0),n.mobile&&this===d.getItem())C=d.getLastItem(),E=C.getParsedText().length;else if(t.getElementParent(o.target))if(n.mobile&&o.clientX<this.getPadding(d))E=0;else{var P=a.getSelectOffsetsForMouseEvent(o);E=P?P.start:0}else E=C.getParsedText().length;n.android&&this.isEditable.set(!0);try{t.PAssert(3868,C,"Click on undefined item should not happen")}catch(e){t.reportError(e)}t.isKeyboardOpen&&y&&!t.findParentID(y,"search")||t.openKeyboardOnIndex(o,d,e,function(){d.onFocus(),s.selectIndex(e,E)},function(){d.onBlur()}),s.selectIndex(e,E),setTimeout(function(){l.setSelected([e],d)},100)}}else o.preventDefault()}}else{if(n.mac&&o.metaKey||!n.mac&&o.ctrlKey){s.reset();var f=o.target.textContent;o.shiftKey?d.search.setValue(f):d.search.addToValue(f)}else if(!n.mobile||!t.isKeyboardOpen){var f=o.target.textContent,T=i.contactManager.findMatchExact(f[0]===ContactPrefix?f.substr(1):f);T&&t.menus.openContextMenuReact({componentName:"ReactContextMenuContactDetails",position:"bottom",element:o.target,contact:T})}n.mobile&&(o.preventDefault(),o.stopImmediatePropagation())}else{s.reset(),l.reset();var f=o.target.textContent;o.shiftKey?d.search.setValue(f):d.search.toggleText(f,n.mac&&o.metaKey||!n.mac&&o.ctrlKey),n.mobile&&(o.preventDefault(),o.stopImmediatePropagation())}else{var D=o.target.getAttribute("data-href");t.openUrl(D,o),t.handlerPreventStop(o)}},onEnd:function(e){o.isListening("touchHoldTimeout",this.onTouchHoldTimeout)&&o.unlisten("touchHoldTimeout",this.onTouchHoldTimeout),this.checkDragOnEnd(e),t.itemMenuOpenedOn===this&&t.menus.menuItemSelected(e.target),c.isInMultiselect()&&(e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0),this.isLoupeOpen=!1,t.vmMain.updateCursorFromEvent(e)},onCancel:function(e){r.isDragging&&this.dragEnd(e)},onRightClick:function(e,i){t.menus.openContextMenuReact({componentName:"ReactContextMenuItem",key:"menu"+this.id+i.clientX+i.clientY,element:i.target,item:this,pane:t.focusedPane,pos:{left:i.pageX,top:i.pageY}}),i.preventDefault(),i.stopPropagation()},onDoubleClick:function(e,i){var a=t.focusedPane;!n.mobile&&t.vmMain.pluginManager.handleDoubleTap(this,a,i)&&(n.mobile?(i.preventDefault(),i.stopImmediatePropagation()):r.isDragging&&this.dragEnd(i))},onAutocompleteTapped:function(e,i,n){try{t.PAssert(3869,n,"Must be tracking the current AC tag")}catch(e){t.reportError(e)}var r=this.getParsedText(),a=s.getStartOffset()-n.length,o=r.substr(0,a)+e+r.substr(s.getStartOffset()+1);s.getPane().focus(),this.setText(o,!0,ChangeType.Local),s.selectIndex(s.getStartIndex(),a+i)}}}),define("RepeatDate",["globals"],function(e){function t(i){if(this._valid=!0,this._initData=i,this._maxCount=n,e.isString(i))this.fromString(i);else if(e.isArray(i))this.fromICal(i);else if(i instanceof t)this._startDate=new Date(i._startDate),this._endDate=i._endDate?new Date(i._endDate):void 0,this._frequency=i._frequency,this._separation=i._separation,this._offsets=i._offsets?i._offsets.slice():void 0;else if(e.isObject(i)){try{e.PAssert(3870,i.type===DateType.Repeat,"Must have a valid date type set")}catch(t){e.reportError(t)}this._startDate=new Date(i.startDate),this._endDate=i.endDate?new Date(i.endDate):void 0,this._frequency=i.frequency,this._separation=i.separation||1,this._offsets=i.offsets}else{try{e.PAssert(3871,!1,"Invalid object passed to RepeatDate constructor",i)}catch(t){e.reportError(t)}this._valid=!1}if(this._startDate){try{e.PAssert(3872,this._startDate instanceof Date,"Must be a valid date instance")}catch(t){e.reportError(t)}try{e.PAssert(3873,this._startDate.isAfter(r),"Start date must be after the minimum start date")}catch(t){e.reportError(t)}try{e.PAssert(3874,!this._endDate||this._endDate instanceof Date,"Must be a valid date instance")}catch(t){e.reportError(t)}try{e.PAssert(3875,!this._offsets||this._offsets.length>=1,"Must always store at least one offset if _offsets is defined",this._offsets)}catch(t){e.reportError(t)}if(this._endDate&&!this._startDate.isBefore(this._endDate)&&!this._startDate.equals(this._endDate)){this._valid=!1;try{e.PAssert(3877,!1,"Start date must always be before the end date")}catch(t){e.reportError(t)}}}else this._valid=!1;this._doneGenerating=!this._valid,this._cache=[],this._cacheDate=new Date(this._startDate)}var i=["SU","MO","TU","WE","TH","FR","SA"],n=500,r=new Date(1401606e6);return t.prototype={isValid:function(){return this._valid},_isValidDate:function(e){return e&&e instanceof Date},setStartDate:function(t){try{e.PAssert(3878,t,"Must provide a valid date")}catch(t){e.reportError(t)}if(this._startDate=new Date(t),this._endDate&&!this._startDate.isBefore(this._endDate)&&!this._startDate.equals(this._endDate)){this._valid=!1;try{e.PAssert(3879,!1,"Start date must always be before the end date")}catch(t){e.reportError(t)}}this._resetCache()},getStartDate:function(){return this._startDate},getEndDate:function(){return this._endDate},_isBeforeEnd:function(t){try{e.PAssert(3880,this._isValidDate(t),"Must provide a valid date: ",t)}catch(t){e.reportError(t)}var i=this._cache.length<this._maxCount,n=!this._endDate||(t.isBefore(this._endDate)||t.equals(this._endDate));return i&&n},_resetCache:function(){this._cache=[],this._cacheDate=new Date(this._startDate),this._doneGenerating=!this._valid},_getNext:function(e){return this._cache.length<e&&this._generate(e),this._cache.slice(0,e)},_generateUntil:function(t){try{e.PAssert(3881,this._isValidDate(t),"Must provide a valid date to generate until: ",t)}catch(t){e.reportError(t)}for(var i=!1,n=0;!this._doneGenerating&&(!this._getLastCachedDate()||this._getLastCachedDate().isBefore(t))&&n<50;)this._generateNext(1),i=!0,n++;return i},_generateNext:function(t){try{e.PAssert(3882,t>0,"Must request a valid number of additional dates")}catch(t){e.reportError(t)}this._generate(this._cache.length+t)},_doGenerateInstance:function(t,i,n){var r=!1;switch(i){case RepeatFreq.Weekly:r=t.getDay()<=n;break;case RepeatFreq.DayOfMonth:r=t.getDate()<=n;break;default:try{e.PAssert(3883,!1,"Invalid repeat frequency for offset dates",i)}catch(t){e.reportError(t)}}return r},_generate:function(t){try{e.PAssert(3884,t>0,"Must request a valid number of dates")}catch(t){e.reportError(t)}try{e.PAssert(3885,t<this._maxCount,"Must request less than maxCount dates")}catch(t){e.reportError(t)}var i=new Date(this._cacheDate);t=Math.min(t,this._maxCount);for(var n=0;n<t&&this._cache.length<t&&this._isBeforeEnd(i);){if(this._offsets)for(var r=0;r<this._offsets.length&&this._cache.length<t;++r){var a=this._offsets[r],s=new Date(i);if(this._doGenerateInstance(s,this._frequency,a)){switch(this._frequency){case RepeatFreq.Weekly:s.addDays(a-s.getDay());break;case RepeatFreq.DayOfMonth:s.addDays(a-s.getDate());break;default:try{e.PAssert(3886,!1,"Invalid repeat frequency for offset dates",this._frequency)}catch(t){e.reportError(t)}}var o=this._cache[this._cache.length-1];!this._isBeforeEnd(s)||o&&!s.isAfter(o)?this._isBeforeEnd(s)||(this._doneGenerating=!0):this._cache.push(s)}}else{var s=new Date(i),o=this._cache[this._cache.length-1];if(!this._isBeforeEnd(s)||o&&!s.isAfter(o))return void(this._isBeforeEnd(s)||(this._doneGenerating=!0));this._cache.push(s)}switch(this._frequency){case RepeatFreq.Daily:i.addDays(this._separation);break;case RepeatFreq.Weekly:this._offsets&&this._offsets.length>1&&i.getDay()!==this._offsets[0]&&i.moveToDayOfWeek(this._offsets[0],-1),i.addWeeks(this._separation);break;case RepeatFreq.Monthly:i.addMonths(this._separation);break;case RepeatFreq.NthMonthInst:var c=this._startDate.getDay(),l=Math.ceil(this._startDate.getDate()/7);i.addMonths(this._separation),4!==l&&5!==l||(l=-1),i.moveToNthOccurrence(c,l);break;case RepeatFreq.Yearly:i.addYears(this._separation);break;case RepeatFreq.EndOfMonthOffset:i.addMonths(this._separation);var d=this._startDate.getDate(),h=this._startDate.getDaysInMonth(),u=h-d;i.setDate(i.getDaysInMonth()-u);break;case RepeatFreq.DayOfMonth:for(var r=0;r<this._separation;++r)this.getNextValidMonth(i,this._startDate.getDate());break;case RepeatFreq.Once:default:try{e.PAssert(3887,!1,"Invalid repeat frequency")}catch(t){e.reportError(t)}return void(this._doneGenerating=!0)}this._cacheDate=i,n++}this._isBeforeEnd(i)||(this._doneGenerating=!0)},getNextValidMonth:function(t,i){try{e.PAssert(3888,this._isValidDate(t),"Must provide a valid date: ",t)}catch(t){e.reportError(t)}if(t.addMonths(1),t.getDate()!==i){i>t.getDaysInMonth()&&(t.addMonths(1),t.setDate(i))}},includesDate:function(e){for(var t=this.getDates(!1),i=0;i<t.length;i++){if(t[i].clone().clearTime().equals(e))return!0}return!1},getDates:function(t){try{e.PAssert(3889,this._valid,"Must not call getDates with invalid RepeatDate: ",this._initData)}catch(t){e.reportError(t)}var i=new Date;this._generate(4),this._generateUntil(i);var n=this._cache.findInsertIndex(i,Date.compare),r=this._cache.length-n;r<4&&this._generateNext(4-r);var a=t?Math.max(n,0):Math.max(n-3,0),s=Math.min(n+4,this._cache.length);return this._cache.slice(a,s)},getDateOnDay:function(e){var t=this._cache.findInsertIndex(e,Date.compare);return this._cache[t]},next:function(e){if(e>0)return this._getNext(e)},nextIndex:function(t){try{e.PAssert(3892,this._valid,"Must not call nextIndex with invalid RepeatDate: ",this._initData)}catch(t){e.reportError(t)}try{e.PAssert(3893,!t||this._isValidDate(t),"Must provide a valid from date",t)}catch(t){e.reportError(t)}var i=t?new Date(t):this._startDate;if(this._generateUntil(i))return this._cache.length-1;for(var n=0;n<this._cache.length;++n)if(this._cache[n].isAfter(i)||this._cache[n].equals(i))return n;return this._generateNext(1),this._cache.length-1},nextComplete:function(t){try{e.PAssert(3894,this._valid,"Must not call nextComplete with invalid RepeatDate: ",this._initData)}catch(t){e.reportError(t)}try{e.PAssert(3895,!t||this._isValidDate(t),"Must provide a valid from date",t)}catch(t){e.reportError(t)}var i=this.nextIndex(t);return this._cache[i]},nextActive:function(t){try{e.PAssert(3898,this._valid,"Must not call nextActive with invalid RepeatDate: ",this._initData)}catch(t){e.reportError(t)}try{e.PAssert(3899,!t||this._isValidDate(t),"Must provide a valid from date",t)}catch(t){e.reportError(t)}var i=this.nextIndex(t);return this._cache.length<=i+1&&this._generateNext(1),this._cache[i+1]},_getLastCachedDate:function(){return this._cache[this._cache.length-1]},hasTimeOfDay:function(){return!!this._valid&&this._startDate.hasTimeOfDay()},isRepeatDate:function(){return!0},getTimeOfDay:function(){return this._valid?this._startDate.getTimeOfDay():0},getTime:function(e){return this._valid?this._startDate.toString(e):""},equals:function(i){if(this._valid){if(e.isString(i))return this.toString()===i;if(i instanceof t){if(i._valid){var n=!isNaN(this._startDate)&&!isNaN(i._startDate)&&this._startDate.equals(i._startDate),r=this._endDate?this._endDate.equals(i._endDate):this._endDate===i._endDate,a=this._frequency===i._frequency,s=this._separation===i._separation,o=this._offsets?this._offsets.equals(i._offsets):this._offsets===i._offsets;return n&&r&&a&&s&&o}}else if(e.isObject(i)){try{e.PAssert(3902,i.type===DateType.Repeat,"Must have a valid date type set")}catch(t){e.reportError(t)}var c=new Date(i.startDate);try{e.PAssert(3903,this._isValidDate(c),"Must provide a valid comp date",c)}catch(t){e.reportError(t)}var n=!isNaN(this._startDate)&&!isNaN(c)&&this._startDate.equals(c),r=this._endDate==(i._endDate?new Date(i._endDate):void 0),a=this._frequency===i.frequency,s=this._separation===i._separation,o=this._offsets?this._offsets.equals(i._offsets):this._offsets===i._offsets;return n&&r&&a&&s&&o}}return!1},fromString:function(t){try{var i=t.split("|"),n=i[0];if("1"===n){this._startDate=new Date(parseInt(i[1])),this._endDate=i[2]?new Date(parseInt(i[2])):void 0,this._frequency=parseInt(i[3]),this._separation=parseInt(i[4]);try{e.PAssert(3904,e.isNumber(this._frequency),"Invalid frequency",i[3])}catch(t){e.reportError(t)}try{e.PAssert(3905,e.isNumber(this._separation),"Invalid frequency",i[4])}catch(t){e.reportError(t)}if(this._offsets=void 0,i[5]){var r=i[5].split(",");if(r.length>0){this._offsets=[];for(var a=0;a<r.length;++a){var s=parseInt(r[a]);try{e.PAssert(3906,e.isNumber(s),"Date offsets must be valid numbers",r[a])}catch(t){e.reportError(t)}this._offsets.push(s)}}}if(!this._isValidDate(this._startDate)||this._endDate&&!this._isValidDate(this._endDate)){try{e.PAssert(3907,!1,"Invalid start or end date parsing from string",this._startDate,this._endDate)}catch(t){e.reportError(t)}this._valid=!1}}else{try{e.PAssert(3908,!1,"Unknown repeated date version: ",n)}catch(t){e.reportError(t)}this._valid=!1}}catch(t){this._valid=!1,e.reportError(t)}this._resetCache()},toString:function(){if(this._valid){var e=this._startDate.getTime(),t=this._endDate?this._endDate.getTime():"",i=this._offsets&&this._offsets.length>1?this._offsets.join(","):"";return"1|"+e+"|"+t+"|"+this._frequency+"|"+this._separation+"|"+i}},toICal:function(){var t=[],n={};if(this._valid){switch(this._startDate&&t.push("DTSTART:"+this._startDate.getTime()+"Z"),this._endDate&&(n.UNTIL=this._endDate.getTime()+"Z"),this._frequency){case RepeatFreq.Daily:n.FREQ="DAILY";break;case RepeatFreq.Weekly:n.FREQ="WEEKLY";for(var r=this._startDate.clone(),a=[i[r.getDay()]],s=0;s<this._offsets.length;++s)r.moveToDayOfWeek(this._offsets[s]),a.push(i[r.getDay()]);n.BYDAY=a.toString();break;case RepeatFreq.Monthly:n.FREQ="MONTHLY";break;case RepeatFreq.DayOfMonth:n.FREQ="MONTHLY",n.BYMONTHDAY=this._startDate.getDate();break;case RepeatFreq.Yearly:n.FREQ="YEARLY";break;case RepeatFreq.EndOfMonthOffset:n.FREQ="MONTHLY",n.BYMONTHDAY=-this._startDate.getDate();break;case RepeatFreq.NthMonthInst:n.FREQ="MONTHLY",n.BYDAY=i[this._getStartDate.getDay()],n.BYSETPOS=Math.ceil(this._getStartDate.getDate()/7);break;default:try{e.PAssert(3909,!1,"Invalid repeat date frequencey: "+this._frequency)}catch(t){e.reportError(t)}}n.INTERVAL=this._separation;var o="RRULE:";for(var c in n)o+=c+"="+n[c]+";";t.push(o)}return t},_handleICalString:function(e,t){for(var i=e.split(";"),n=0;n<i.length;++n){var r=i[n],a=r.split("=");t(a[0],a[1])}},_handleDTSTART:function(t){try{e.PAssert(3910,t.endsWith("Z"),"Timestamp must be in UTC time: "+t)}catch(t){e.reportError(t)}log("DTSTART: ",t),this._startDate=new Date(parseInt(t.slice(0,-1)));try{e.PAssert(3911,this._startDate,"Must have a valid start date: "+t)}catch(t){e.reportError(t)}},_handleRRULE:function(t){this._handleICalString(t,function(t,n){switch(log("RRULE: ",t,"->",n),t){case"FREQ":switch(n){case"DAILY":this._frequency=RepeatFreq.Daily;break;case"WEEKLY":this._frequency=RepeatFreq.Weekly;break;case"MONTHLY":this._frequency=RepeatFreq.Monthly;break;case"YEARLY":this._frequency=RepeatFreq.Yearly;break;case"SECONDLY":case"MINUTELY":case"HOURLY":default:try{e.PAssert(3912,!1,"Invalid RRULE FREQ value: ",n)}catch(t){e.reportError(t)}}break;case"UNTIL":try{e.PAssert(3913,n.indexOf("T")<0,"Do not currently support date-time")}catch(t){e.reportError(t)}var r=n.substring(0,4),a=n.substring(4,6),s=n.substring(6,8);this._endDate=new Date(r,a,s);break;case"COUNT":this._maxCount=parseInt(n);break;case"INTERVAL":this._separation=parseInt(n);break;case"BYDAY":var o=n.split(",");this._offsets=[];for(var c=0;c<o.length;++c){var l=i.indexOf(o[c]);l>=0?this._offsets.push(l):this._offsets.push(parseInt(o[c]))}break;case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYMONTH":case"BYSETPOS":case"WKST":break;case"BYSECOND":case"BYMINUTE":case"BYHOUR":default:try{e.PAssert(3914,!1,"Invalid RRULE action: ",t)}catch(t){e.reportError(t)}}})},_handleEXRULE:function(e){this._handleICalString(e,function(e,t){log("EXRULE: ",e,"->",t)})},_handleRDATE:function(e){this._handleICalString(e,function(e,t){log("RDATE: ",e,"->",t)})},_handleEXDATE:function(e){this._handleICalString(e,function(e,t){log("EXDATE: ",e,"->",t)})},fromICal:function(t){try{e.PAssert(3915,2===t.length,"Only handle single instance RRULE with added DTSTART")}catch(t){e.reportError(t)}for(var i=0;i<t.length;++i){var n=t[i],r=n.split(":"),a=r[0],s=r[1];switch(a){case"DTSTART":this._handleDTSTART(s);break;case"RRULE":this._handleRRULE(s);break;case"EXRULE":this._handleEXRULE(s);break;case"RDATE":this._handleRDATE(s);break;case"EXDATE":this._handleEXDATE(s);break;default:try{e.PAssert(3916,!1,"Invalid recurrence rule: "+a)}catch(t){e.reportError(t)}}}},getHours:function(){return this._startDate.getHours()},getMinutes:function(){return this._startDate.getMinutes()}},t}),define("VMLI_Text",["data","gdata","globals","Constants","platform","tracker","RepeatDate","Measure","DuchessHelpers","Sel","Dispatcher"],function(e,t,i,n,r,a,s,o,c,l,d){"use strict";return{_runAndGetSaveData:function(e,t,n){try{i.PAssert(3917,t,"We do not support deferred text paring")}catch(e){i.reportError(e)}if(this.shouldSave())var r=this.getMetaTextSaveData();if(this.setRawText(this.generateSaveText(e)),this.parseText(t,n),this.shouldSave()){var a=this.getMetaTextSaveData(),s={};for(var o in a)r[o]!==a[o]&&(s[o]=a[o])}return s},setText:function(e,n,r){try{i.PAssert(3918,i.isLocalChange(r)||!e||e.indexOf(window.AttachChar)<0,"Should never be setting text with an attach char in it")}catch(e){i.reportError(e)}try{i.PAssert(3919,this.isNote()||!e||e.indexOf("\n")<0,"Non-notes should never have newlines")}catch(e){i.reportError(e)}try{i.PAssert(3920,!e||i.isRemoteChange(r)||e.indexOf(window.TextSpace)<0,"Should never insert text space into item when editing locally")}catch(e){i.reportError(e)}r|=ChangeType.Text,!this.isNote()&&e&&e.indexOf("\n")>=0&&(e=e.replace(/\n/g," ")),this.isInitialized&&o.clearCacheForItem(this.id);var a=this._runAndGetSaveData(e,n,r);if(this.shouldSave()){a.text=this.generateSaveText(e);var s;i.isLocalChange(r)&&!i.isUndoRedoChange(r)?(t.saveChanges(this,a),s=SaveFlag.Text):s=SaveFlag.None,a.dateText=this.getDateText(),a.durationText=this.getDurationText(),this.save(a,s)}},metricsInPane:function(e,t){var n;try{var r=t>=0&&l.isSelected(t,e);n=o.measureItem(this,e,r)}catch(e){i.reportError(e)}return n},sizeInPane:function(e,t,i){if(i){return(r.mobile?n.OverviewItemHeightMobile:n.OverviewItemHeightDesktop)+((this===e.getItem()?8:0)||(this===e.getRootItem()?2:0))}return this.isNote()?o.lineItemHeight(this,e,1):this.metricsInPane(e,t).height},generateExportText:function(e,t){return void 0!==e&&null!==e?this._generateUsableText(e,"getExportString",t):null},generateSaveText:function(e,t){return void 0!==e&&null!==e?this._generateUsableText(e,"getEmbedString",t):null},generateTitleText:function(e){return this._generateUsableText(e,"getTitleString").replace(/[\*_]/g,"")},_generateUsableText:function(e,t,n){try{i.PAssert(3921,this.hasAttachments()||e.indexOf(window.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(e){i.reportError(e)}var r=e;if(this.hasAttachments()&&e.indexOf(window.AttachChar)>=0){var a=n||0,s=this.getNumAttachments();r=e.replace(/\u2000/g,function(){if(a<s){var e=this.getAttachment(a);return a++,e[t]()}try{i.PAssert(3922,!1,"Unable to find valid attachment for AttachChar")}catch(e){i.reportError(e)}return""}.bind(this));try{i.PAssert(3923,r.indexOf(window.AttachChar)<0,"Should convert all attachments to their string form")}catch(e){i.reportError(e)}}return r},splitUsableText:function(e,t,n){try{i.PAssert(3924,this.hasAttachments()||e.indexOf(window.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(e){i.reportError(e)}var r=e.substring(0,t)+e.substring(n),a=t;if(this.hasAttachments()&&e.indexOf(window.AttachChar)>=0){var s=0,o=this.getNumAttachments();r=e.replace(/\u2000/g,function(e,i){if(s<o){var n=this.getAttachment(s);s++;var r=n.getEmbedString();return i<t&&(a+=Math.max(r.length-1,0)),r}return window.AttachChar}.bind(this));try{i.PAssert(3925,r.indexOf(window.AttachChar)<0,"Should convert all attachments to their string form")}catch(e){i.reportError(e)}}return{before:r.substring(0,a),after:r.substring(a)}},parseText:function(e,t,n){try{i.PAssert(3926,!this.isDestroyed(),"Must not parse a destroyed VMLI")}catch(e){i.reportError(e)}try{i.PAssert(3927,e,"Currently we only support immediate parsing")}catch(e){i.reportError(e)}try{i.PAssert(3928,i.isValidChangeType(t),"Must specify a valid changetype")}catch(e){i.reportError(e)}this.__TEMP_ParseCalled=!0;var r;if(e){if(this.isNote())r=c.parseNote(this);else{var s=this.getParser();try{i.PAssert(3929,s,"Must be able to get valid parse function for item")}catch(e){i.reportError(e)}if(!s)return;r=s(this,t)}i.isFlagSet(t,ChangeType.Local)&&r.numContacts>0&&a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddContact,data:[{itemID:this.id}]})}else try{i.PAssert(3930,!1,"Should always be using immediate parse")}catch(e){i.reportError(e)}var o=this.isPrefixNumList(),l=this.styleText(r,e,t,n);return this.itemChanged.notify(),this.isInitialized&&this.isPrefixNumList()!==o&&d.fireEvent("numListChanged",[]),l},styleText:function(e,t,n,r){try{i.PAssert(3931,t,"Currently we only support full parses")}catch(e){i.reportError(e)}try{i.PAssert(3932,i.isValidChangeType(n),"Must specify a valid changetype")}catch(e){i.reportError(e)}try{i.PAssert(3933,!(!e&&t),"In a full parse, styleInfo should always be defined")}catch(e){i.reportError(e)}var o=!1;if(e){t&&this.setParsedText(e.parsedText);try{i.PAssert(3934,e.els||i.isFlagSet(n,ChangeType.ItemLoad),"Must always return an els list")}catch(e){i.reportError(e)}if(e.els&&(this.els=e.els),this.prefix=e.prefix,this.prefix&&a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SetPrefix,data:{itemID:this.id,prefix:this.prefix}}),e.dates){0===e.dates.length&&(this.date()||this.repeatDate())&&(this.setDateText(void 0),this.setDurationText(void 0),this.repeatDate()&&!this.isForceCompleted()&&(this.dateCompleted=void 0,r&&(o=!0,r.dateCompleted=void 0)),this.setDateFormat(void 0),this.date(null,n),this.repeatDate(null,n),this.setDuration(0),r&&(o=!0,r.date=void 0,r.dateText=void 0,r.dateFormat=void 0,r.repeatDate=void 0,r.duration=void 0,r.durationText=void 0));for(var c=0;c<e.dates.length;++c){var l=e.dates[c];if(l.type===DateType.Once)this.getDateText()!==l.origText&&(this.setDateText(l.origText),r&&(o=!0,r.dateText=l.origText)),l.date&&this.date()&&l.date==this.date()||(!!l.date^!!this.date()||l.dateFormat!==this.getDateFormat()||this.date()&&l.date.getTime()!==this.date().getTime())&&(this.setDateFormat(l.dateFormat),this.date(l.date,n),r&&(o=!0,r.date=l.date?l.date.getTime():void 0,r.dateFormat=l.dateFormat)),this.repeatDate()&&(this.repeatDate(null,n),r&&(o=!0,r.repeatDate=void 0));else if(l.type===DateType.Repeat){var d=l.oldText||l.text;this.getDateText()!==d&&(this.setDateText(d),r&&(o=!0,r.dateText=d));var h=new s(l);h.isValid()?(!this.repeatDate()||l.dateFormat!==this.getDateFormat()||!h.equals(this.repeatDate())||!!h^!!this.repeatDate())&&((!h||this.repeatDate()&&!this.repeatDate().getStartDate().equals(h.getStartDate()))&&(this.isForceCompleted()||(this.dateCompleted=void 0,r&&(o=!0,r.dateCompleted=void 0))),this.setDateFormat(l.dateFormat),this.repeatDate(h,n),r&&(o=!0,r.repeatDate=h.toString())):i.reportError(new Error("Local invalid repeat date: "+l)),this.date()&&(this.date(null,n),r&&(o=!0,r.date=void 0))}}}else(this.date()||this.repeatDate())&&t&&(this.setDateText(void 0),this.setDurationText(void 0),this.repeatDate()&&!this.isForceCompleted()&&(this.dateCompleted=void 0,r&&(o=!0,r.dateCompleted=void 0)),this.setDateFormat(void 0),this.date(null,n),this.repeatDate(null,n),this.setDuration(0),r&&(o=!0,r.date=void 0,r.dateText=void 0,r.dateFormat=void 0,r.repeatDate=void 0,r.duration=void 0,r.durationText=void 0));if(e.durations&&e.durations.length>0)for(var c=0;c<e.durations.length;++c){var u=e.durations[c];this.setDuration(u.duration),this.setDurationText(u.durationText)}else this.getDuration()>0&&(this.setDuration(0),this.setDurationText(void 0),r&&(o=!0,r.duration=void 0,r.durationText=void 0));if((e.tags||this._activeTags)&&this.setTags(e.tags),e.attachments||this.hasAttachments()){for(var p=[],c=0;e.attachments&&c<e.attachments.length;++c){var m=i.vmMain.pluginManager.getAttachment(e.attachments[c]);m&&(p.push(m),i.isLocalChange(n)&&!m.getOldID()&&m.notifyItemTextChanged(this,!1))}this.setAttachments(p,n)}}return o},getCalendarRawText:function(){return this.getRawText().replace(this.getItemDateString(),"").replace(/^ +/g,"").replace(/ +$/g,"")},getCalendarParsedText:function(){var e;if(this.hasAttachmentType(n.PluginType.Email)){e=this.getAttachmentByType(n.PluginType.Email).getField("subject")}else e=this.getParsedTextWithoutPrefix().replace(this.getItemDateString(),"").replace(/\u2000/g,"");return e.trim()},getStyledTextAsOneLine:function(e){return c.generateHTML(this.els,!1,void 0,e)},hasText:function(){var e=this.getParsedText();return this.getDateText()&&(e=e.replace(DatePrefix+this.getDateText(),"")),e=e.replace(/ /g,""),e.length>0},setPrefix:function(e){var t=this.getRawText(),i=this.getPrefix();i&&(t=t.substr(i.length)),this.prefix=e,t=(e?e+" ":"")+t,this.setText(t,!0,ChangeType.Local)},getPrefix:function(){return this.prefix?this.prefix+" ":""},getPrefixLength:function(){return this.prefix?this.prefix.length+1:0},isPrefixHeader:function(){return this.prefix&&0===this.prefix.indexOf(n.Prefix.Header)},isPrefixTask:function(){return this.prefix&&this.prefix===n.Prefix.Task||this.prefix===n.Prefix.Task2||this.prefix===n.Prefix.Task3},isPrefixBullet:function(){return this.prefix&&this.prefix===n.Prefix.Bullet||this.prefix===n.Prefix.Bullet2||this.prefix===n.Prefix.Bullet3},isPrefixNumList:function(){return this.prefix&&this.prefix[0]>=0&&this.prefix[0]<10},numListNumber:function(){if(this.isPrefixNumList()){for(var e=1,t=this.parent(),i=this.getIndex()-1;i>=0;--i,++e){var n=t.getChild(i);if(!n||!n.isPrefixNumList())break}return e}},shouldCopyPrefix:function(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()},getParsedTextWithoutPrefix:function(){var e=this.getPrefix(),t=this.getParsedText();return e?t.substr(e.length):t},applyFormatToSelection:function(e,t,i,r){var a,s,o,c=this.getParsedText(),l=t,d=i,h=!1;for(o=t;o>=Math.max(t-e.length,0);o--)if(c.substr(o,e.length)===e){a=o;break}for(o=i-e.length;o<=i;o++)if(c.substr(o,e.length)===e){s=o;break}return isNaN(a)||isNaN(s)||r===n.SetMode.Yes?r!==n.SetMode.No&&(l=t+e.length,d=i+e.length,c=c.substr(0,t)+e+c.substr(t,i-t)+e+c.substr(i),h=!0):(l=a,d=s-e.length,c=c.substr(0,a)+c.substr(a+e.length,s-a-e.length)+c.substr(s+e.length)),this.setText(c,!0,ChangeType.Local),{didSet:h,selStart:l,selEnd:d}},insertLinkAtSelection:function(){if(l.isValid()&&l.getStartIndex()===l.getEndIndex()){var e=l.getStartOffset(),t=l.getEndOffset(),n=this.getRawText(),r=n.substr(e,t-e);i.menus.openContextMenuReact({componentName:"ReactContextMenuInsertLink",element:l.getEndElement(),onInsertLink:this.onInsertLink,text:r})}},onInsertLink:function(e){if(l.isValid()&&l.getStartIndex()===l.getEndIndex()){var t=l.getStartOffset(),i=l.getEndOffset(),n=this.getRawText(),r=n.substr(t,i-t),a=i+e.text.length+e.url.length+4-r.length;n=n.substr(0,t)+"["+e.text+"]("+e.url+")"+n.substr(i),this.setText(n,!0,ChangeType.Local),l.selectIndex(l.getStartIndex(),a)}}}}),define("VMLI_Drive",["globals","data","gdata","tracker","RepeatDate","Sel"],function(e,t,i,n,r,a){return function(s){function o(e,t){i.cacheItem(t),l(t,i.get(t,"note")),c(t,i.get(t,"items")),c(t,i.get(t,"archivedItems"))}function c(n,r){if(r)for(var a=0;a<r.length;++a){var s=r.get(a);try{e.PAssert(3935,s,"Item must exist to get it from the array")}catch(t){e.reportError(t)}if(s&&s.id){i.setItemParent(s,n);var c=t.getModel(s.id);c?c.linkToGDrive(s):o(n,s)}else{if(s)try{e.reportError(new Error("Item in list without defined ID: "+e.getObjectInfo(s)+" : "+JSON.stringify(s)))}catch(t){e.reportError(t)}else e.reportError(new Error("Removing undefined/null value form remote list"));r.remove(a),a--}}}function l(e,n){if(n){i.setItemParent(n,e);var r=t.getModel(n.id);r?r.linkToGDrive(n):i.cacheItem(n)}}return{changeTypeFromEvent:function(e){var t;return this.isLocalEvent(e)?(t=ChangeType.Local,n.undoRedoActive&&(t|=ChangeType.UndoRedo)):t=ChangeType.Remote,t},linkToGDrive:function(t,n){try{e.PAssert(3936,t,"Must be passing in valid data")}catch(t){e.reportError(t)}if(!this.data){if(t){try{e.PAssert(3937,void 0===t.connectIdentifier,"Should never have a connect identifier present during link")}catch(t){e.reportError(t)}t.connectIdentifier=i.connectIdentifier(),this.data=t,i.cacheItem(t)}this.setRemoteVersion(VersionType.Structure,i.getVersion(t,VersionType.Structure)),this.setRemoteVersion(VersionType.Text,i.getVersion(t,VersionType.Text)),n&&(this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text))),l(t,i.get(t,"note")),c(t,i.get(t,"items")),c(t,i.get(t,"archivedItems"))}},initFromGDrive:function(t){try{e.PAssert(3942,t,"To initialize from gdrive a valid remote data object must be passed in")}catch(t){e.reportError(t)}try{e.PAssert(3943,!n.undoRedoActive,"Should not be initializing new VMLIs from gdrive during undo/redo")}catch(t){e.reportError(t)}if(!t)return void e.reportError(new Error("FATAL ERROR - No remote data for item"));if(this.data=t,t.connectIdentifier)try{e.PAssert(3946,t.connectIdentifier===i.connectIdentifier(),"Should never have a connect identifier present during link")}catch(t){e.reportError(t)}else t.connectIdentifier=i.connectIdentifier();if(i.getItemParent(this.data))try{e.PAssert(3947,i.getItemParent(this.data).id===this.parent().id,"Item parent must match")}catch(t){e.reportError(t)}else this.parent()&&i.setItemParent(this.data,this.parent().data);i.cacheItem(this.data);var r=void 0===this.id||this.forceModifiedItems,a=r?void 0:{},s=!1;this.id=t.id;try{s=this.resolveMisc(a)||s,s=this.resolveText(a)||s,s&&e.vmMain.addParseItem(this,ChangeType.Remote|ChangeType.DocLoad|ChangeType.All),this.computeDisplayComplete(),this.isNote()||this.resolveItems(a)}catch(t){e.reportError(t)}if(r){try{e.PAssert(3948,void 0===a,"If doing a full save, remoteChanges should always be undefined")}catch(t){e.reportError(t)}this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text)),this.save(null,SaveFlag.None)}else if(!e.isEmpty(a)){!0!==a.isDeleted&&(a.isDeleted=void 0);try{e.PAssert(3949,a.hasOwnProperty("version")||a.hasOwnProperty("versionText"),"If making remote changes, the version should have changed")}catch(t){e.reportError(t)}a.hasOwnProperty("version")&&this.setVersion(VersionType.Structure,a.version),a.hasOwnProperty("versionText")&&this.setVersion(VersionType.Text,a.versionText),this.save(a,SaveFlag.None)}i.attachEventsToItem(this)},resolveText:function(n){var r=!1;if(this.modifiedOfflineText&&!this.forceModifiedItems)if(this.isLocalVersionNewer(VersionType.Text))i.saveChanges(this,{text:this.getRawText()});else{var a=i.get(this.data,"text");try{e.PAssert(3950,void 0!==a,"Every item should have text associated with it from gdrive")}catch(t){e.reportError(t)}var s=this.getRawText(),o=!1;if(s!==a&&(o=!0),o)if(this.isNote())this.setText(a,!0,ChangeType.Remote|ChangeType.DocLoad|ChangeType.Text),e.vmMain.addModifiedItem(this,ChangeType.Remote|ChangeType.DocLoad|ChangeType.Text),n&&(n.text=this.getRawText(),n.modifiedOfflineText=!1);else{var c=this.getIndex(),l=t.createVMLI({text:this.getRawText()},{parent:this.parent(),changeType:ChangeType.Local|ChangeType.DocLoad});this.parent().insertItem(l,c+1),
this.setText(a,!0,ChangeType.Remote|ChangeType.DocLoad),e.vmMain.addModifiedItem(this,ChangeType.Remote|ChangeType.Text|ChangeType.DocLoad),n&&(n.text=this.getRawText(),n.dateText=this.getDateText(),n.dateFormat=this.getDateFormat(),n.durationText=this.getDurationText())}else n&&(n.modifiedOfflineText=!1);n&&(n.versionText=this.getRemoteVersion(VersionType.Text),e.vmMain.addModifiedItem(this,ChangeType.Remote|ChangeType.Text|ChangeType.DocLoad,n))}else if(this.isRemoteVersionNewer(VersionType.Text)){var a=i.get(this.data,"text");try{e.PAssert(3951,void 0!==a,"Every item should have text associated with it from gdrive")}catch(t){e.reportError(t)}this.getRawText()!==a&&(this.setText(a,!0,ChangeType.Remote|ChangeType.DocLoad),n&&(n.text=this.getRawText(),n.dateText=this.getDateText(),n.dateFormat=this.getDateFormat(),n.durationText=this.getDurationText()),this.isVersionUninitialized(VersionType.Text)||(r=!0)),n&&this.getVersion(VersionType.Text)!==this.getRemoteVersion(VersionType.Text)&&(n.versionText=this.getRemoteVersion(VersionType.Text),e.vmMain.addModifiedItem(this,ChangeType.Remote|ChangeType.Text|ChangeType.DocLoad,n))}return r},resolveMisc:function(t){var n=this.modifiedOfflineText&&this.isLocalVersionNewer(VersionType.Text),a=!1,s=!1;if(n||this.isRemoteVersionNewer(VersionType.Structure)||this.isRemoteVersionNewer(VersionType.Text)){var o={},c=i.get(this.data,"dateFormat");(c||this.getDateFormat())&&this.getDateFormat()!==c&&(n?(o.dateFormat=this.getDateFormat(),s=!0):(this.setDateFormat(c,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad),t&&(t.dateFormat=this.getDateFormat())));var l=i.get(this.data,"date");if((l||this.date())&&(!this.date()||this.date().getTime()!==l))if(n&&this.date())o.date=this.date().getTime(),s=!0;else{if(l){var d=new Date(l);this.date(d,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad)}else this.date(null,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad);t&&(t.date=this.getDateTime()),this.isVersionUninitialized(VersionType.Text)||(a=!0)}var h=i.get(this.data,"dateCompleted");if((h||this.dateCompleted)&&(!this.dateCompleted||!h||this.dateCompleted.getTime()!==h))if(n)o.dateCompleted=this.dateCompleted?this.dateCompleted.getTime():void 0,s=!0;else{var u=h;try{e.PAssert(3952,"string"!=typeof h,"Invalid date format stored")}catch(t){e.reportError(t)}this.dateCompleted=new Date(u),t&&(t.dateCompleted=u)}var p=i.get(this.data,"repeatDate");if((p||this.repeatDate())&&(!this.repeatDate()||!this.repeatDate().equals(p)))if(n&&this.repeatDate())o.repeatDate=this.repeatDate().toString(),s=!0;else{if(p){var m=new r(p);m.isValid()?this.repeatDate(m,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad):e.reportError(new Error("Remote init invalid repeat date: "+p))}else this.repeatDate(null,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad);t&&(t.repeatDate=this.getRepeatDate()),this.isVersionUninitialized(VersionType.Text)||(a=!0)}var f=i.get(this.data,"dateCreated");if(!this.dateCreated||!f||this.dateCreated.getTime()!==f)if(n)o.dateCreated=this.dateCreated?this.dateCreated.getTime():void 0,s=!0;else{var u=f;try{e.PAssert(3953,"string"!=typeof f,"Invalid date format stored")}catch(t){e.reportError(t)}this.dateCreated=new Date(u),t&&(t.dateCreated=u)}var g=i.get(this.data,"priority");(g||this.priority())&&this.priority()!==g&&(n?(o.priority=this.priority(),s=!0):(null===g&&(g=VMLIFlag.None),this.priority(g,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad)));var v=i.get(this.data,"isStarred");(v||this.isStarred())&&this.isStarred()!==v&&(n?(o.isStarred=this.isStarred(),s=!0):(null===v&&(v=!1),this.isStarred(v,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad)));var y=i.get(this.data,"isComplete");(y||this.isComplete())&&this.isComplete()!==y&&(n?(o.isComplete=this.isComplete(),s=!0):(null===y&&(y=!1),this.isComplete(y,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad)));var b=i.get(this.data,"favorites");if((b||this.getFavorites())&&b!=this.getFavorites()&&(n?(o.favorites=this.getFavorites(),s=!0):(null===b&&(b=void 0),this.setFavorites(b,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad))),n){try{e.PAssert(3954,s===!e.isEmpty(o),"Verify modLocal is computed properly. It should track any changes to localChanges")}catch(t){e.reportError(t)}!0===s&&i.saveChanges(this,o)}}return a},resolveNote:function(n){var r=i.get(this.data,"note"),a=this.hasNote()?this.getNote():void 0;if(r)if(a)a.initFromGDrive(r);else{var s=t.getItem(r.id);if(s){if(s.isDeleted){try{e.PAssert(3955,e.isReconnected||!a,"The local model should never exist when an item has been marked as deleted locally")}catch(t){e.reportError(t)}try{e.PAssert(3956,s.modifiedOffline,"How did the note get deleted if it wasn't modified offline?")}catch(t){e.reportError(t)}i.getVersion(r,VersionType.Structure)==s.version?i.noteSet(this,void 0):(a=t.createVMLI({data:r,isNote:!0},{parent:this,changeType:ChangeType.Remote|ChangeType.DocLoad}),t.undeleteItem(a,ChangeType.AllRemote|ChangeType.DocLoad),this.setNote(a,ChangeType.AllRemote|ChangeType.DocLoad),e.vmMain.addModifiedItem(a,ChangeType.AllRemote|ChangeType.DocLoad))}}else a=t.createVMLI({data:r,isNote:!0},{parent:this,changeType:ChangeType.Remote|ChangeType.DocLoad}),this.setNote(a,ChangeType.AllRemote),e.vmMain.addModifiedItem(a,ChangeType.AllRemote|ChangeType.DocLoad)}else a&&(t.initializeItem(a),i.noteSet(this,a))},resolveItemsHelper:function(n,r){var a,s,o,c,l,d,h,u=i.getItemList(this.data,n);h=n?this.hasArchivedChildren()?this.archivedItems(!0):[]:this.getItems();try{e.PAssert(3957,h,"Item arrays must exist")}catch(t){e.reportError(t)}for(a=0;u&&a<u.length;a++)if(s=u.get(a)){try{e.PAssert(3959,void 0===i.loadSeen[s.id]||!1===i.loadSeen[s.id],"Items can only be seen once on the remote.")}catch(t){e.reportError(t)}i.loadSeen[s.id]=this.id;var o=this.getIndexOf(s.id,n);if(o>=0)l=h[o],l.initFromGDrive(s);else if(c=t.getItem(s.id),l=t.getModel(s.id),c)if(c.isDeleted){try{e.PAssert(3961,c.modifiedOffline,"How did the item get deleted if it wasn't modified offline?")}catch(t){e.reportError(t)}if(i.getVersion(s,VersionType.Structure)==c.version){i.itemRemoved({item:this,index:a,numToRemove:1,isArchived:n});a--}else{if(l){try{e.PAssert(3962,void 0===l.parent(),"Should never have a parent if deleted")}catch(t){e.reportError(t)}try{e.PAssert(3963,l.data===s,"Local model should match remote data")}catch(t){e.reportError(t)}l.parent(this)}else l=t.createVMLI({data:s,isArchived:n},{parent:this,changeType:ChangeType.Remote|ChangeType.DocLoad});t.undeleteItem(l,ChangeType.Remote|ChangeType.DocLoad),h.splice(a,0,l),d=!0,e.vmMain.addModifiedItem(l,ChangeType.Remote|ChangeType.Structure|ChangeType.DocLoad)}}else if(l&&l.modifiedOffline)if(l.isLocalVersionNewer(VersionType.Structure)){try{e.PAssert(3964,i.loadSeen[s.id]===this.id)}catch(t){e.reportError(t)}i.loadSeen[s.id]=!1}else l.moveTo({parent:this,index:a,shouldBeArchived:n},ChangeType.Remote|ChangeType.DocLoad),l.initFromGDrive(s),d=!0,e.vmMain.addModifiedItem(l,ChangeType.Remote|ChangeType.Structure|ChangeType.DocLoad);else l?(l.moveTo({parent:this,index:a,shouldBeArchived:n},ChangeType.Remote|ChangeType.DocLoad),l.initFromGDrive(s),d=!0,e.vmMain.addModifiedItem(l,ChangeType.Remote|ChangeType.Structure|ChangeType.DocLoad)):e.reportError(new Error("Local model does not exist for local item that was not deleted."));else{try{e.PAssert(3960,!l,"The local model should never exist if there is no corresponding item entry")}catch(t){e.reportError(t)}l=t.createVMLI({data:s,isArchived:n},{parent:this,changeType:ChangeType.Remote|ChangeType.DocLoad}),h.splice(a,0,l),d=!0,e.vmMain.addModifiedItem(l,ChangeType.AllRemote|ChangeType.DocLoad)}}else try{e.PAssert(3958,s,"Item in remote list does not exist")}catch(t){e.reportError(t)}if(t.hasLocalData){for(a=0;a<h.length;a++)if(l=h[a],i.loadSeen[l.id]!==this.id)if(s=l.data){if(l.modifiedOffline&&l.isLocalVersionNewer(VersionType.Structure)){var p=i.findInTree(s);if(p){i.itemMoved({item:l,newInfo:{index:a,isArchived:n},oldParent:p.parent,oldInfo:p})}else{var m=i.getDeletedCacheItem(s.id);if(m){try{e.PAssert(3971,!i.getItemParent(m),"Deleted items should never have parents")}catch(t){e.reportError(t)}i.restoreDeletedItem(s.id),i.itemAdded({item:this,addedItem:s,index:a,isArchived:n})}}l.initFromGDrive(s)}}else if(l.modifiedOfflineText){var f,g=[];if(n?l.hasArchivedChildren()&&(f=l.archivedItems(!0)):f=l.getItems(),f)for(var v=0;v<f.length;++v)if(f[v].data&&f[v].isLocalVersionNewer(VersionType.Structure)){var p=i.findInTree(f[v].data);try{e.PAssert(3966,p,"Item should be found in tree")}catch(t){e.reportError(t)}p&&g.push({parent:p.parent,child:f[v]})}t.initializeItem(l),i.itemAdded({item:this,addedItem:l,index:a,isArchived:n});for(var v=0;v<g.length;++v){var y=g[v];try{e.PAssert(3967,y,"Must have valid data to remove")}catch(t){e.reportError(t)}var b=y.child.isArchived(),S=i.getItemList(y.parent,b);try{e.PAssert(3968,S,"The item has children, it must have a list")}catch(t){e.reportError(t)}var E=S.indexOf(y.child.data);try{e.PAssert(3969,E>=0,"Remote item must be in the parents list")}catch(t){e.reportError(t)}i.itemRemoved({item:y.parent,index:E,numToRemove:1,isArchived:b})}l.initFromGDrive(l.data)}else{try{e.PAssert(3970,t.getItem(l.id),"Trying to delete an item locally that doesn't exist locally")}catch(t){e.reportError(t)}this.deleteChild(l,void 0,void 0,ChangeType.Remote|ChangeType.DocLoad),a--,d=!0,e.vmMain.addModifiedItem(l,ChangeType.Remote|ChangeType.Structure|ChangeType.DocLoad)}if(!n&&u&&(u.length>0||h.length>0)){var C,P=[],T=[],D=u.asArray(),M=!1;for(a=0;a<D.length;++a){var _=D[a].id;if(!_)try{e.PAssert(3972,_,"Item in list without an ID defined: "+JSON.stringify(D[a]))}catch(t){e.reportError(t)}var I=t.getModel(_);try{e.PAssert(3973,I,"If the remote ID exists the local item should have been created.")}catch(t){e.reportError(t)}var o=this.getIndexOf(_);I&&I.modifiedOffline&&I.isLocalVersionNewer(VersionType.Structure)?o>=0?P.push(o):(C||(C=[]),log(this.id+": Item in remote array not found in local array: ",_),C.push(_)):o>=0?(T.push(_),o!==a&&(M=!0)):(C||(C=[]),log(this.id+": Item in remote array not found in local array: ",_),C.push(_))}if(M||P.length>0){for(P.sort(e.numberComparator),a=0;a<P.length;a++){var c=h[P[a]];c&&T.splice(P[a],0,c.id)}C&&C.length>0&&(T=T.concat(C));for(a=0;a<T.length;++a)for(var A=T[a],v=a;v<u.length;++v){var w=u.get(v);if(A===w.id){if(a!==v){var k=t.getModel(w.id),x={index:v,isArchived:!1},R={index:a,isArchived:!1};i.itemMoved({item:k,newInfo:R,oldParent:this,oldInfo:x}),d=!0,e.vmMain.addModifiedItem(k,ChangeType.Remote|ChangeType.Structure)}break}}for(a=0;a<T.length;++a)for(var A=T[a],v=a;v<h.length;++v){var w=h[v];if(A===w.id){if(a!==v){w.moveTo({parent:this,index:a,shouldBeArchived:!1},ChangeType.Remote),d=!0,e.vmMain.addModifiedItem(w,ChangeType.Remote|ChangeType.Structure)}break}}}}}d&&(n?this.hasArchivedChildren()&&this.archivedItems().notify():this.getItemStore().updateItems(this),n&&!this.hasArchivedChildren()&&this.archivedItems().set(h),r&&(r.items=this.getItemsArrayForSave(),r.version=this.getRemoteVersion(VersionType.Structure)))},resolveItems:function(t){try{e.PAssert(3979,!this.isNote(),"Should never resolve items on a note")}catch(t){e.reportError(t)}this.resolveItemsHelper(!1,t),this.resolveItemsHelper(!0,t),this.resolveNote(t)},isMoveEvent:function(e){var t=!1;return e.type===gapi.drive.realtime.EventType.VALUES_ADDED?t=void 0!==e.movedFromList&&null!==e.movedFromList:e.type===gapi.drive.realtime.EventType.VALUES_REMOVED&&(t=void 0!==e.movedToList&&null!==e.movedToList),t},isLocalEvent:function(t){var i=t.isLocal;if(n.undoRedoActive)try{e.PAssert(3980,i,"Must be a local event during undo/redo")}catch(t){e.reportError(t)}return i},onValueChanged:function(t){if(!t.isLocal||n.undoRedoActive){var a=e.translateFieldOut(t.property);if(this.id===t.target.id){var s=this.changeTypeFromEvent(t)|ChangeType.Property,o=!1;switch(a){case"version":case"versionText":var c="_"+a,l=i.get(this.data,a);if(l>this[c]||void 0===this[c]){var d={};"version"===a?d.modifiedOffline=!1:"versionText"===a&&(d.modifiedOfflineText=!1),d[a]=this[c]=l,this.save(d,SaveFlag.None)}break;case"priority":this.priority(t.newValue,s);break;case"isComplete":this.isComplete(t.newValue,s);break;case"isStarred":this.isStarred(t.newValue,s);break;case"dateCompleted":this.dateCompleted=t.newValue?new Date(t.newValue):null,this.save({dateCompleted:t.newValue},SaveFlag.None),o=!0;break;case"isArchived":this.isArchived(t.newValue,s),this.save({isArchived:t.newValue},SaveFlag.None);break;case"dateFormat":this.setDateFormat(t.newValue),this.save({dateFormat:t.newValue},SaveFlag.None);break;case"date":this.date(t.newValue?new Date(t.newValue):null,s),this.save({date:t.newValue},SaveFlag.None);break;case"repeatDate":var h=t.newValue?new r(t.newValue):null;!h||h.isValid()?(this.repeatDate(h,s),this.save({repeatDate:t.newValue},SaveFlag.None)):e.reportError(new Error("Remote invalid repeat date: "+t.newValue));break;case"allDayDate":break;case"note":t.newValue?this.addRemoteNote(t.newValue,s):this.hasNote()&&this.removeRemoteNote(s);break;case"items":case"archivedItems":var u=!("items"===a);if(t.newValue)for(var p=0;p<t.newValue.length;++p){var m=t.newValue.get(p);this.addRemoteItem(m,p,u,s)}else{try{e.PAssert(3982,0===t.oldValue.length,"Expected no items in list")}catch(t){e.reportError(t)}this.removeAllRemoteItems(u)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None);break;case"dateCreated":break;case"text":this.onTextChanged(t);break;default:ShouldLog(LogLevels.Error)&&log("Unhandled value changed remotely: ",a,t)}o&&this.parseText(!0,s)}}},onTextChanged:function(t){if(!t.isLocal||n.undoRedoActive){var r=this.changeTypeFromEvent(t)|ChangeType.Text,a=i.get(this.data,"text");if(a!==this.getRawText()&&(this.setText(a,!0,r),n.undoRedoActive)){var s=TrackerType.SetText;n.notifyStateChangedFromUndoRedo(s,{itemID:this.id,position:e.findFirstDiff(t.newValue,t.oldValue,!1,!0),text:t.newValue})}}},addRemoteItem:function(e,r,a,s){i.cacheItem(e);var o=e.id,c=a?this.archivedItems():this.items,l=c.get();if(r<l.length&&l[r].id===o)return void log("Skipping addRemoteItem - "+r+" vs. "+l.length);var d=t.getModel(o);d||(d=t.createVMLI({data:e},{parent:this,changeType:s})),i.setItemParent(e,this.data),d.isDeleted()&&(d.isDeleted(!1,s),d.save(null,SaveFlag.None)),d.isArchived()!==a&&(d.isArchived(a,ChangeType.Remote),d.save({isArchived:a},SaveFlag.None)),d.parent(this),c.splice(r,0,d),n.undoRedoActive&&n.notifyStateChangedFromUndoRedo(TrackerType.Create,{itemID:d.id,parent:this.id,position:r,text:i.get(e,"text")})},removeAllRemoteItems:function(e){var t;if(e?this.hasArchivedChildren()&&(t=this.archivedItems(),t.set([])):(t=this.items,t.set([])),t)for(var n=0;n<t.get().length;++n)i.setItemParent(t.get()[n],void 0)},removeRemoteItem:function(r,a,s,o,c){var l;if(s){try{e.PAssert(3983,this.hasArchivedChildren(),"Must have a valid item list to remove from")}catch(t){e.reportError(t)}l=this.archivedItems()}else l=this.items;var d=l.get()[a];if(d&&d.id===r.id){try{e.PAssert(3984,d,"Expect a valid local item to remove")}catch(t){e.reportError(t)}try{e.PAssert(3985,r.id===d.id,"Remote item should match local items")}catch(t){e.reportError(t)}if(o&&(i.setItemParent(r,void 0),i.removeItemFromCache(r.id)),n.undoRedoActive){var h=e.getPreviousItem(d);n.notifyStateChangedFromUndoRedo(TrackerType.Delete,{itemID:d.id,parent:this.id,position:a,previous:h?h.id:void 0})}l.splice(a,1),o&&t.deleteItem(d,c)}},addRemoteNote:function(n,r){try{e.PAssert(3986,!this.hasNote(),"State of note should always match when adding")}catch(t){e.reportError(t)}var a=n.id;i.cacheItem(n);var s=t.getModel(a);s||(s=t.createVMLI({data:n,isNote:!0},{parent:this,changeType:r}));try{e.PAssert(3987,s.isNote(),"Must always be a valid note")}catch(t){e.reportError(t)}s.parent(this),s.isDeleted()&&(s.isDeleted(!1,r),s.save(null,SaveFlag.None)),this.setNote(s,r)},removeRemoteNote:function(i){try{e.PAssert(3988,this.hasNote(),"State of note should always match when removing")}catch(t){e.reportError(t)}var n=this.getNote();this.setNote(void 0,i),n.isDeleted()||t.deleteItem(n,i)},onListAdded:function(t){if(!t.isLocal||n.undoRedoActive){i.numChanges++;var r=this.changeTypeFromEvent(t),a=!1,s=!0,o=i.get(this.data,"items");if(o&&t.target.id===o.id)s=t.target.id===o.id;else{var c=i.get(this.data,"archivedItems");c&&t.target.id===c.id&&(a=!0),s=c&&t.target.id===c.id}if(!s)return void log("Skipping list add due to invalid target");var l,d,h;t.values.length>0?(d=t.index,h=d+t.values.length,l=function(e){return t.values[e]}):(d=0,h=t.target.length,l=function(e){return t.target.get(e)});for(var u=(this.isMoveEvent(t),d);u<h;++u){var p=u-d,m=l(p);try{e.PAssert(3991,m,"Always expect a valid item at each index")}catch(t){e.reportError(t)}this.addRemoteItem(m,u,a,r)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None),this._selectionBeforeBlur=void 0}},onListRemoved:function(t){if(!t.isLocal||n.undoRedoActive){var r=this.changeTypeFromEvent(t);i.numChanges++;var a,s=!1,o=!0,c=i.get(this.data,"items");if(c&&t.target.id===c.id)o=t.target.id===c.id;else{var l=i.get(this.data,"archivedItems");l&&t.target.id===l.id&&(s=!0),o=l&&t.target.id===l.id}if(!o)return void log("Skipping list remove due to invalid target");for(var d=t.index,h=d+t.values.length,u=this.isMoveEvent(t),p=h-1;p>=d;p--){var m=p-d;try{e.PAssert(3997,!!t.values[m],"Always expect a valid item at each index")}catch(t){e.reportError(t)}var a=t.values[m];this.removeRemoteItem(a,p,s,!u,r)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None),this._selectionBeforeBlur=void 0}},onListSet:function(t){try{e.PAssert(3998,!1,"What? This shouldn't happen!",t)}catch(t){e.reportError(t)}},onObjectChanged:function(t){if(t.ocHandled)return ShouldLog(LogLevels.Warning|LogLevels.Verbose)&&log("Event Already Handled: ",t.ocHandled,"-",this.id,t.events[0].type),!1;i.numChanges++,t.ocHandled=this.id,t.stopPropagation();var r;if(t.isLocal&&!n.undoRedoActive)return!1;i.lastChangeTime.set(Date.now());var s;n.undoRedoActive||(s=a.save(),a.reset()),e.vmMain.beginUpdateItems();for(var r=0;r<t.events.length;++r){var o=t.events[r];if(o.ocHandled)log("Sub-Event Already Handled: ",o.ocHandled,"-",this.id,o.type);else{o.ocHandled=this.id;try{switch(o.type){case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:this.onTextChanged(o);break;case gapi.drive.realtime.EventType.VALUES_ADDED:this.onListAdded(o);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:this.onListRemoved(o);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:this.onValueChanged(o);break;case gapi.drive.realtime.EventType.VALUES_SET:try{e.PAssert(3999,!1,"VALUES_SET should never be triggered")}catch(t){e.reportError(t)}break;default:try{e.PAssert(4e3,!1,"Unexpected event type")}catch(t){e.reportError(t)}}}catch(t){e.reportError(t)}}}return e.vmMain.commitUpdateItems(),s&&a.restore(s),!1}}}}),define("sounds",["globals","platform"],function(e,t){function i(e,t){var i=document.createElement("source");i.src=t,e.appendChild(i)}var n={},r={};return n.add=function(e){if(n[e]=e,!r[e]){var t=document.createElement("audio");i(t,"sounds/"+e+".mp3"),t.preload="auto",r[e]=t}},n.play=function(t){if(!e.settings.get(Settings.noSounds)){if(!r[t])return log("Tried to play a sound that has not been loaded:",t),void console.trace();try{r[t].play()}catch(e){log("Failed to play audio",e)}}},n}),define("Favorites",["require","exports","module","globals","Constants"],function(e,t,i){function n(){this._favMap={}}var r=e("globals");e("Constants");return n.prototype={_ensureGroup:function(e){var t=[];return this._favMap[e]||(this._favMap[e]=t),t},notifyAdd:function(e,t){var i=this._ensureGroup(t);try{r.PAssert(4001,i.indexOf(e)<0,"Should not double add item to group")}catch(e){r.reportError(e)}i.push(e)},notifyRemove:function(e,t){var i=this._ensureGroup(t);try{r.PAssert(4002,i.indexOf(e)>=0,"Must have been added to group before removing")}catch(e){r.reportError(e)}i.remove(e)},getItems:function(e){return this._favMap[e]},hasItems:function(e){var t=this.getItems(e);return t&&t.length>0}},new n}),define("VMLI",["globals","util","platform","Constants","data","gdata","VMLI_TapHandlers","VMLI_Text","VMLI_Drive","tracker","sounds","RepeatDate","International","Observable","ObservableArray","Trigger","Dispatcher","DisplaySettings","Favorites","Measure","Sel"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m,f,g,v,y,b,S){function E(i,n){this.isInitialized=!1;try{e.PAssert(4003,n,"Each VMLI must be given a set of additional info")}catch(t){e.reportError(t)}try{e.PAssert(4004,e.isValidChangeType(n.changeType),"Must specify a valid change type when creating a VMLI")}catch(t){e.reportError(t)}try{e.PAssert(4005,n.store,"Must supply a valid itemStore for each VMLI")}catch(t){e.reportError(t)}try{e.PAssert(4006,!n.parent||n.parent._store===n.store,"All VMLIs in a tree must share the same owner")}catch(t){e.reportError(t)}if(this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1,!i.id&&i.data&&i.data.id)i.id=i.data.id;else if(i.id&&i.data)try{e.PAssert(4007,i.id===i.data.id,"If passing in a local id and a remote ID, they should match")}catch(t){e.reportError(t)}try{e.PAssert(4008,void 0===i.v,"We should never be passing in 'v'")}catch(t){e.reportError(t)}try{e.PAssert(4009,void 0===i.extern,"We should never be passing in 'extern'")}catch(t){e.reportError(t)}try{e.PAssert(4010,n.store,"Must specify a valid item store this item belongs to")}catch(t){e.reportError(t)}this._store=n.store,this._parent=n?n.parent:void 0,this._rawText=i.data?"":i.text,this._searchText=i.data?"":i.text?i.text.toLowerCase():"",this._parsedText=void 0,this._notePreviewText=void 0,this.els=void 0,this._isArchived=i.isArchived||!1,this._numArchivedAncestors=this._parent?this._parent._numArchivedAncestors+(this._parent.isArchived()?1:0):0,this._numArchivedDescendants=0,this._isArchived&&this._notifyAncestorsArchived(!0),t.forceBind("itemsHasMutated",this),this.items=new m([],this.itemsHasMutated),this._note=void 0,this.itemChanged=new f,this._archivedItems=void 0,this._demandLoadChildren=i.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=n.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._dateTempForced=void 0,this._dateFormat=i.dateFormat,this._repeatDate=void 0,this._attachments=void 0,this.draggedInPane=new p(!1);var r=VMLIFlag.None;i.isComplete&&(r|=VMLIFlag.Complete),i.isStarred&&(r|=VMLIFlag.Starred),i.isNote&&(r|=VMLIFlag.Note),i.isArchived&&(r|=VMLIFlag.Archived),i.priority&&(r|=i.priority),this.flags=new p(r),this.prefix=void 0,this._favorites=void 0,this._dateText=i.dateText,this.dateCreated=i.dateCreated?new Date(i.dateCreated):new Date,this.dateCompleted=i.dateCompleted?new Date(i.dateCompleted):void 0,this._durationMS=i.duration,this._durationText=i.durationText,this._activeTags=void 0,this._isDeleted=i.isDeleted||!1,this.modifiedOffline=void 0,this.modifiedOfflineText=void 0,this.highlightTimeout=void 0,this.data=void 0,this._version=window.UninitializedVersion,this._versionText=window.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new p(n.isEditable||!1),this.levelsDeep=new p(this._parent?this._parent.levelsDeep.get()+1:0),this.isHighlighted=new p,window.__TOTAL_ITEMS++,i.isArchived&&window.__TOTAL_ARCHIVED_ITEMS++,this._needsParse=!1,this.isLoaded=void 0,this.init(i,n),t.forceBind("dragScroll",this),t.forceBind("onTouchHoldTimeout",this),t.forceBind("sizeInPane",this),t.forceBind("onInsertLink",this),this.isInitialized=!0}window.__TOTAL_ITEMS=0,window.__TOTAL_ARCHIVED_ITEMS=0,window.__TOTAL_ARCHIVE_PARENTS=0;var C=new Date(9e12);return E.prototype={getReactKey:function(){return this._store.id+this.id},notifyDemandLoadUpdate:function(e,t){e&&!this._loadedOnDemandData&&(t.requestDemandLoadData(this),this.notifyLoadedData())},notifyLoadedData:function(){this._loadedOnDemandData=!0},notifyLoadDataFailed:function(e){this.setCollapsed(!1,e,!1),this._loadedOnDemandData=!1},isDemandLoad:function(){return this._demandLoadChildren},isDemandNotYetLoaded:function(){return this._demandLoadChildren&&!this._loadedOnDemandData},showInOverview:function(e){return this.numItems()>0||this._demandLoadChildren||e&&this.hasArchivedChildren()},paginationTokenInUse:function(){try{e.PAssert(4011,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(t){e.reportError(t)}return this._paginationToken.isInUse()},hasPaginationToken:function(){return!!(this.flags.get()&VMLIFlag.HasPageToken)},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._paginationToken},setPaginationToken:function(t){try{e.PAssert(4012,t,"Should never be setting an undefined token - use clear instead")}catch(t){e.reportError(t)}try{e.PAssert(4013,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(t){e.reportError(t)}this._paginationToken=t,this.setFlags(this.flags.get()|VMLIFlag.HasPageToken)},clearPaginationToken:function(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0,this.setFlags(this.flags.get()&~VMLIFlag.HasPageToken)},beginDataPageLoad:function(){try{e.PAssert(4015,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(t){e.reportError(t)}try{e.PAssert(4016,!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load")}catch(t){e.reportError(t)}return this._paginationToken.notifyBeginUse(),this._paginationToken},endDataPageLoad:function(t){try{e.PAssert(4018,this._paginationToken,"Should always have a valid pagination token when done loading a data page")}catch(t){e.reportError(t)}try{e.PAssert(4019,this._paginationToken.isInUse(),"Token should always be in use when running a request")}catch(t){e.reportError(t)}t?this._paginationToken.notifyEndUse():this.setFlags(this.flags.get()&~VMLIFlag.HasPageToken)},notifyPaginationUpdate:function(){try{e.PAssert(4020,this._paginationToken,"Must have a valid token to get next page of data")}catch(t){e.reportError(t)}this._paginationToken&&e.focusedPane.requestDataPage(this)},canHaveNote:function(){var t=this.belongsToItemStore(e.vmMain.itemStoreManager.getDefaultItemStore()),i=this.belongsToItemStore(e.vmMain.itemStoreManager.getTempItemStore());return t||i},createNote:function(){try{e.PAssert(4021,!this.isNote(),"Should never create a note on a note item")}catch(t){e.reportError(t)}var t;return this.hasNote()?t=this.getNote():(t=this.getItemStore().createItem(e.generateTempId(),"",this.id,{isNote:!0,forceSave:!0},ChangeType.AllLocal),this.setNote(t,ChangeType.Local)),t},editNote:function(){var t=e.focusedPane,i=S.getStartObject();if(this.isNote())S.selectIndex(S.getStartIndex(),this.getParsedText().length);else{this.hasNote()||(l.beginAction(),this.createNote(),l.endAction());var n=this.getNote(),r=t.indexOfObject(i);setTimeout(function(){S.selectIndex(r+1,n.getParsedText().length)},0)}},hasNote:function(){return void 0!==this._note},getNote:function(){try{e.PAssert(4022,this.hasNote(),"Must have a note to get one")}catch(t){e.reportError(t)}return this._note},setNote:function(t,i){try{e.PAssert(4023,e.isValidChangeType(i),"Must supply a valid changeType")}catch(t){e.reportError(t)}try{e.PAssert(4024,!t||this.belongsToSameItemStore(t),"Note must belong to the same item store")}catch(t){e.reportError(t)}try{e.PAssert(4025,!this.isNote(),"Should never set a note on a note")}catch(t){e.reportError(t)}try{e.PAssert(4026,!this._note||!t,"Should never set a note multiple times on a single item")}catch(t){e.reportError(t)}try{e.PAssert(4027,!t||t.isNote(),"Should only set items that are notes as notes")}catch(t){e.reportError(t)}try{e.PAssert(4028,!t||!t.isDeleted(),"Should note set a deleted note")}catch(t){e.reportError(t)}try{e.PAssert(4029,!t||t instanceof E,"Note must be a valid VMLI")}catch(t){e.reportError(t)}try{e.PAssert(4030,!t||t.parent()===this,"Should always have a valid parent set before setting note on item")}catch(t){e.reportError(t)}var n=this._note;if(this._note=t,this.shouldSave()){var s=t?t.id:void 0;this.save({note:s},SaveFlag.Prop),e.isLocalChange(i)&&!e.isUndoRedoChange(i)&&(l.beginAction(),a.noteSet(this,t),l.endAction()),t||!n||n.isDeleted()||r.deleteItem(n,i)}g.fireEvent("itemNoteSet",[{item:this}]),this.itemsHasMutated()},isNote:function(e){if(void 0===e)return this._isFlagHelper(VMLIFlag.Note);if(e!==this._isFlagHelper(VMLIFlag.Note)){var t=e?this.flags.get()|VMLIFlag.Note:this.flags.get()&~VMLIFlag.Note;this.setFlags(t)}},addFavorite:function(t,i){this._favorites||(this._favorites=[]);try{e.PAssert(4031,!this._favorites.indexOf(t)<0,"Must not already be in the favorites group")}catch(t){e.reportError(t)}if(this._favorites.push(t),y.notifyAdd(this,t),this.shouldSave()){var n={favorites:this._favorites};e.isLocalChange(i)&&!e.isUndoRedoChange(i)&&(a.saveChanges(this,n),n=e.clone(n)),this.save(n,SaveFlag.Prop)}},removeFavorite:function(t,i){try{e.PAssert(4032,this._favorites,"Must always have favorites defined before removing from item")}catch(t){e.reportError(t)}try{e.PAssert(4033,!this._favorites.indexOf(t)>=0,"Must already be in the favorites group")}catch(t){e.reportError(t)}if(this._favorites.remove(t),y.notifyRemove(this,t),this.shouldSave()){var n={favorites:this._favorites};e.isLocalChange(i)&&!e.isUndoRedoChange(i)&&(a.saveChanges(this,n),n=e.clone(n)),this.save(n,SaveFlag.Prop)}},setFavorites:function(t,i){for(var n=(t||[]).removeArray(this._favorites),r=(this._favorites||[]).removeArray(t),s=0;s<r.length;++s)y.notifyRemove(this,r[s]);for(var s=0;s<n.length;++s)y.notifyAdd(this,n[s]);if(this._favorites=t,this.shouldSave()){for(var o=[],s=0;s<t.length;s++)o[s]=e.clone(t[s],!0);var c={favorites:o};e.isLocalChange(i)&&!e.isUndoRedoChange(i)&&(a.saveChanges(this,c),c=e.clone(c)),this.save(c,SaveFlag.Prop)}},getFavorites:function(){return this._favorites},shouldSave:function(){return this._shouldSave},canDestroy:function(){return this._canDestroy},_getLineStyle:function(){return this.flags.get()&e.LSMask},_getPriority:function(){return this.flags.get()&e.PMask},getPadding:function(t,i){try{e.PAssert(4034,t&&t.getItem(),"Invalid pane")}catch(t){e.reportError(t)}if(this.isNote())return this.parent().getPadding(t);var n;if(i)n=1;else if(t.isSearchedFlat()){for(var r=this;r;){if(t.search.isFlatSearchResult(r)){n=r.levelsDeep.get()-1;break}r=r.parent()}try{e.PAssert(4035,!isNaN(n),"Item has no root depth",!!this.parent())}catch(t){e.reportError(t)}isNaN(n)&&(n=1)}else n=t.getItem().levelsDeep.get();var a=this.levelsDeep.get()-n-(i?t.overviewPadLevels:1);return this.getPaddingForLevel(a,t,i)},getPaddingForLevel:function(t,i,n){t=Math.max(t,0);var r;r=n?e.overviewPaddingStart+t*e.overviewPaddingIncrement:v.itemIndentStart(i)+t*v.itemIndentSize(i);try{e.PAssert(4036,e.isNumber(r),"Must have a valid padding")}catch(t){e.reportError(t)}return r},getSpanWidth:function(t){var i=this.getPadding(t);return t.getWidth()-i-e.SPThresholdRight},_updateStylePadding:function(t,i){try{e.PAssert(4037,this._parent,"Must have a valid parent to update padding, root should never change")}catch(t){e.reportError(t)}var n=t+1,r=this.levelsDeep.get()!==n;if(r||i){r&&this.levelsDeep.set(n);for(var a=this.getItems(),s=0;s<a.length;++s)a[s]._updateStylePadding(n,i)}},setFlags:function(e){this.flags.set(e)},getPriorityProps:function(){var t=this.flags.get();return e.priorityMapOut[t&e.PMask]+" "},styleProps:function(t){var i=this.flags.get(),n=this.isHeader()&&!t.isSearchedFlat()?"pHeader ":"";if(i&VMLIFlag.Highlighted&&t!==e.focusedPane&&(n+="highlight "),this.isArchived()&&(n+="archived "),
this.isPrefixHeader()?n+="itemHeader ":this.isPrefixTask()?n+="itemTask ":this.isPrefixBullet()?n+="itemBullet ":this.isPrefixNumList()&&(n+="itemNumList "),t.isItemTopLevel(this)&&(n+="topLevel "),i&VMLIFlag.Complete?(!this.repeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===C.getTime())&&(n+="pComplete c-foreground-super-faded c-before-super-faded "):!(i&VMLIFlag.Note)&&i&VMLIFlag.DisplayComplete?n+="pDisplayComplete c-foreground-super-faded c-before-super-faded ":i&e.PMask?n+=e.priorityMapOut[i&e.PMask]+" ":n+="pNormal ",i&VMLIFlag.Starred&&!(i&VMLIFlag.Complete||i&VMLIFlag.DisplayComplete)&&(n+="pStar c-star "),i&VMLIFlag.Note){n+="pNote c-foreground-faded ";var r=this.parent().flags.get();(r&VMLIFlag.Complete||r&VMLIFlag.DisplayComplete)&&(n+="pComplete c-foreground-super-faded c-before-super-faded "),r&e.PMask&&(n+=e.priorityMapOut[r&e.PMask]+" "),r&VMLIFlag.Starred&&!(r&VMLIFlag.Complete||r&VMLIFlag.DisplayComplete)&&(n+="pStar c-star "),i&VMLIFlag.Multiline&&(n+="multiline ")}var a=this.getAttachments();if(a)for(var s=0;s<a.length;++s){var o=a[s];if(o.isLoaded()){var c=o.getPlugin().getCssClass(o,t);c&&(n+=c)}}return n},onAttachmentIDChange:function(e,t){this.setText(this.getParsedText(),!0,ChangeType.Local)},onAttachmentUpdate:function(e,t,i){e.fieldsHaveParseEffect(t)&&(b.clearCacheForItem(this.id),this.parseText(!0,i),g.fireEvent("itemTextChanged",[{item:this}]))},setAttachments:function(e,t){var i=!1;if(!this._attachments&&e&&(this._attachments=[]),this._attachments){for(var n=this._attachments,r=0;r<n.length;++r)e.indexOf(n[r])<0&&(n[r].unsubscribe(this),n[r].notifyItemTextChanged(this,!0),this.shouldSave()&&n[r].markUnused(t),i=!0);for(var r=0;r<e.length;++r){var a=e[r];if(n.indexOf(a)<0){if(a.shouldBeDeleted()){var s=a.getEmbedString(),o=this.getRawText().replace(s,"File failed to upload");return void requestAnimationFrame(function(){this.setText(o,!0,ChangeType.Local)}.bind(this))}a.subscribe(this),this.shouldSave()&&a.markInUse(t),i=!0}}i&&(this._attachments=e)}i&&this.itemChanged.notify()},getAttachment:function(t){try{e.PAssert(4038,this._attachments,"Must have valid attachments in order to query")}catch(t){e.reportError(t)}if(this._attachments)return this._attachments[t]},hasAttachment:function(e){if(this._attachments)for(var t=0;t<this._attachments.length;++t)if(this._attachments[t].id===e)return!0;return!1},hasPluginAttachment:function(t){try{e.PAssert(4039,t,"Must provide a valid plugin type to query")}catch(t){e.reportError(t)}if(this._attachments)for(var i=0;i<this._attachments.length;++i)if(this._attachments[i].getPlugin().id===t)return!0;return!1},getAttachmentById:function(t){try{e.PAssert(4040,this._attachments,"Must have valid attachments in order to query")}catch(t){e.reportError(t)}if(this._attachments)for(var i=0;i<this._attachments.length;++i)if(this._attachments[i].id===t)return this._attachments[i]},getAttachmentByType:function(t){try{e.PAssert(4041,t,"Must provide a valid plugin type to query")}catch(t){e.reportError(t)}if(this._attachments)for(var i=0;i<this._attachments.length;++i){var n=this._attachments[i];if(n.isType(t))return n}},getAttachmentByPlugin:function(t){try{e.PAssert(4042,t,"Must provide a valid plugin type to query")}catch(t){e.reportError(t)}if(this._attachments)for(var i=0;i<this._attachments.length;++i){var n=this._attachments[i];if(n.isPlugin(t))return n}},getAttachments:function(){if(this._attachments&&this._attachments.length>0)return this._attachments},hasAttachments:function(){return this._attachments&&this._attachments.length>0},getNumAttachments:function(){return this._attachments?this._attachments.length:0},hasAttachmentType:function(t){return e.vmMain.pluginManager.hasAttachmentType(this,t)},copyProperties:function(e){this.isStarred(e.isStarred(),ChangeType.Auto),this.isComplete(e.isComplete(),ChangeType.Auto),this.priority(e.priority(),ChangeType.Auto)},moveNote:function(t,i){try{e.PAssert(4043,t.hasNote(),"Must have a note to move")}catch(t){e.reportError(t)}try{e.PAssert(4044,!this.hasNote(),"Must not already have a note")}catch(t){e.reportError(t)}var n=t.getNote();t.setNote(void 0,i),n&&(n.parent(this),this.setNote(n,i))},parent:function(){if(1===arguments.length){try{e.PAssert(4045,arguments[0]instanceof E||void 0===arguments[0],"Parent must be a VMLI")}catch(t){e.reportError(t)}var t=arguments[0],i=this._parent;try{e.PAssert(4046,!t||t._store===this._store,"All VMLIs in the same tree must share the same owner")}catch(t){e.reportError(t)}if(t!==i)if(void 0!==t){var n=this._numArchivedDescendants+(this.isArchived()?1:0);this._notifyAncestorsArchived(!1,n),this._parent=t,this._notifyAncestorsArchived(!0,n),this._numArchivedAncestors=this._parent._numArchivedAncestors+(this._parent.isArchived()?1:0),this._notifyDescendantsArchived(!0,this._numArchivedAncestors),this._updateStylePadding(this._parent.levelsDeep.get(),!1)}else{this._parent=t;var r=i._numArchivedAncestors+(i.isArchived()?1:0);this._numArchivedAncestors-=r,this._notifyDescendantsArchived(!1,r);var n=this._numArchivedDescendants+(this.isArchived()?1:0);this._notifyAncestorsArchived(!1,n)}}return this._parent},getParser:function(){var e,t=this.getItemStore();return t&&(e=t.getParser()),e},requireStoredEls:function(){var e=this.getItemStore();return!!e&&e.requireStoredEls()},getItemStore:function(){try{e.PAssert(4047,this._store,"Should never be getting the item store from a destroyed VMLI")}catch(t){e.reportError(t)}return this._store},belongsToSameItemStore:function(e){return this.getItemStore()===e.getItemStore()},belongsToItemStore:function(e){return this.getItemStore()===e},archivedItems:function(e){return this._archivedItems||(this._archivedItems=new m,window.__TOTAL_ARCHIVE_PARENTS++),e?this._archivedItems.get():this._archivedItems},hasArchivedChildren:function(){return void 0!==this._archivedItems&&this._archivedItems.get().length>0},notifyItemPropertyChanged:function(e,t){if(this.hasAttachments())for(var i=this.getAttachments(),n=0;n<i.length;++n)i[n].notifyItemPropertyChanged(this,e,t)},_notifyAncestorsArchived:function(t,i){var n=this.parent();try{e.PAssert(4048,void 0===i||i>=0,"Must not specify a zero or negative number")}catch(t){e.reportError(t)}if((i=void 0===i?1:i)>0)for(;n;){t?n._numArchivedDescendants+=i:n._numArchivedDescendants-=i;try{e.PAssert(4049,n._numArchivedDescendants>=0,"Must never have a negative number of archived descendants")}catch(t){e.reportError(t)}n=n.parent()}},_notifyDescendantsArchived:function(t,i){try{e.PAssert(4050,void 0===i||i>=0,"Must not specify a zero or negative number")}catch(t){e.reportError(t)}if((i=void 0===i?1:i)>0){t?this._numArchivedAncestors+=i:this._numArchivedAncestors-=i;try{e.PAssert(4051,this._numArchivedAncestors>=0,"Must never have a negative number of archived ancestors")}catch(t){e.reportError(t)}for(var n=this.getItems(),r=0;r<n.length;++r)n[r]._notifyDescendantsArchived(t,i);if(this.hasArchivedChildren())for(var a=this.archivedItems(!0),r=0;r<a.length;++r)a[r]._notifyDescendantsArchived(t,i)}},isArchived:function(t,i){if(void 0!==t){try{e.PAssert(4052,e.isValidChangeType(i),"Must supply a valid changetype when completing an item: "+i)}catch(t){e.reportError(t)}var n=this._isArchived;if(this._isArchived=t,t!==n){void 0!==this._parsedText&&void 0!==this.els||this.parseText(!0,i);for(var r=this.getItems(),a=0;a<r.length;++a)r[a]._notifyDescendantsArchived(this._isArchived);if(this.hasArchivedChildren())for(var s=this.archivedItems(!0),a=0;a<s.length;++a)s[a]._notifyDescendantsArchived(this._isArchived);this._notifyAncestorsArchived(this._isArchived);var o=this._isFlagHelper(VMLIFlag.Archived);this._isFlagHelper(VMLIFlag.Archived,!o),this.notifyItemPropertyChanged(i,"isArchived"),g.fireEvent("itemStateChanged",[this])}}return this._isArchived},hasArchivedDescendant:function(){return this._numArchivedDescendants>0},hasArchivedAncestor:function(){return this._numArchivedAncestors>0},getArchivedAncestor:function(e){for(var t,i=e?this:this.parent();void 0!==i&&(!i.isArchived()||(t=i,e));)i=i.parent();return t},getLevelsToArchivedAncestor:function(t){try{e.PAssert(4055,t||!this.isArchived(),"Should not be getting the archived ancestor for an archived item")}catch(t){e.reportError(t)}for(var i=0,n=0,r=t?this:this.parent();void 0!==r&&(n++,!r.isArchived()||(i=n,t));)r=r.parent();return i},isHidden:function(t){try{e.PAssert(4056,t,"Must specify the pane for the item being checked")}catch(t){e.reportError(t)}try{e.PAssert(4057,!t||t.search,"Pane search obj must exist: ",t.isDestroyed())}catch(t){e.reportError(t)}return!(!t||!t.search)&&!t.search.isMatched(this)},getRawText:function(){return this._rawText},getParsedText:function(){try{e.PAssert(4058,!1===this._needsParse,"Text should be parsed before calling get")}catch(t){e.reportError(t)}return void 0!==this._parsedText?this._parsedText:this._rawText},getSearchText:function(){try{e.PAssert(4059,void 0!==this._searchText,"Item should always have search text")}catch(t){e.reportError(t)}return this._searchText},setRawText:function(t){void 0!==t&&null!==t||(t="");try{e.PAssert(4060,t.indexOf(window.AttachChar)<0,"Should never have an AttachChar present in raw text")}catch(t){e.reportError(t)}this._rawText=t,this._searchText=t.toLowerCase(),this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0},setParsedText:function(e){this._parsedText=e,e&&(this._searchText=e.toLowerCase()),this._needsParse=!1},priority:function(t,i){if(void 0===t)return this._getPriority();try{e.PAssert(4062,e.isValidChangeType(i),"Must supply a valid changetype when completing an item: "+i)}catch(t){e.reportError(t)}try{e.PAssert(4063,null===t||e.priorityMapOut[t],"Priority must be defined in globals")}catch(t){e.reportError(t)}var n=this._getPriority();if(t!==n){var r=this.flags.get(),s=r&~e.PCMask|t;if(r&VMLIFlag.Complete&&(s&=~VMLIFlag.Complete),this.setFlags(s),this.shouldSave()){var o,c={priority:t};e.isLocalChange(i)&&!e.isUndoRedoChange(i)?(a.saveChanges(this,c),c=e.clone(c),o=SaveFlag.Text):o=SaveFlag.None,this.save(c,o)}this.notifyItemPropertyChanged(i,"priority"),g.fireEvent("itemStateChanged",[this]),l.performAction(TrackerType.Update,{itemID:this.id,field:"priority",newValue:t,oldValue:n})}},isScheduled:function(){return!!this._date||!!this._repeatDate},getDuration:function(){return this._durationMS||0},setDuration:function(e){this._durationMS!==e&&(this._durationMS=e,g.fireEvent("itemStateChanged",[this]))},getDurationText:function(){return this._durationText||""},setDurationText:function(e){this._durationText=e},getDateText:function(){return this._dateText},setDateText:function(e){this._dateText=e},getItemDateString:function(){var e=DatePrefix+this.getDateText();return this.getDurationText()&&(e+=" "+this.getDurationText()),e},getEndDate:function(t){try{e.PAssert(4064,this.date(),"Must have a valid date")}catch(t){e.reportError(t)}var i=this.getDate(t);return i?i.clone().addMilliseconds(this.getDuration()):void 0},isMultidayEvent:function(){var e=!1;if(this.date()&&this.getDuration()>0){var t=this.getEndDate();this.date().isSameDay(t)||(e=!0)}return e},forceDate:function(e){this._dateTempForced=e},date:function(t,i){if(void 0!==t){try{e.PAssert(4066,null===t||e.isDateValid(t),"Must pass in a valid date object")}catch(t){e.reportError(t)}try{e.PAssert(4067,e.isValidChangeType(i),"Must have a valid changeType")}catch(t){e.reportError(t)}if(t!==this._date){null===t&&(t=void 0);try{e.PAssert(4068,void 0===t||!isNaN(t.getTime()),"Must be setting a valid date")}catch(t){e.reportError(t)}this._date=t,e.timeline.updateNotifications(this),g.fireEvent("itemStateChanged",[this]),e.isLocalChange(i)&&l.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:{itemID:this.id,date:t}})}}return this.getDate()},getDate:function(e){return e||!this._dateTempForced||this._dateTempForced.isRepeatDate()?this._date:this._dateTempForced},getDateFormat:function(){return this._dateFormat},setDateFormat:function(e){this._dateFormat=e},repeatDate:function(t,i){if(void 0!==t){try{e.PAssert(4069,!t||t instanceof h,"Must pass in a valid repeat date object")}catch(t){e.reportError(t)}try{e.PAssert(4070,e.isValidChangeType(i),"Must have a valid changeType")}catch(t){e.reportError(t)}t!==this._repeatDate&&(null===t&&(t=void 0),this._repeatDate=t,!t&&this.dateCompleted&&this.dateCompleted.getTime()!==C.getTime()&&this.isComplete(!1,i),e.timeline.updateNotifications(this),g.fireEvent("itemStateChanged",[this]),e.isLocalChange(i)&&l.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:{itemID:this.id,date:t}}))}return this._dateTempForced&&this._dateTempForced.isRepeatDate()?this._dateTempForced:this._repeatDate},allDayDate:function(){return this._date?!this._date.hasTimeOfDay():!!this.repeatDate()&&!this.repeatDate().hasTimeOfDay()},_isFlagHelper:function(e,t){if(void 0!==t){var i=t?this.flags.get()|e:this.flags.get()&~e;return void this.setFlags(i)}return!!(this.flags.get()&e)},isDeleted:function(t,i){if(void 0!==t){try{e.PAssert(4071,e.isValidChangeType(i),"Must supply a valid changetype to delete an item: "+i)}catch(t){e.reportError(t)}this._isDeleted=t;for(var n=0;this._favorites&&n<this._favorites.length;++n){var r=this._favorites[n];t?y.notifyRemove(this,r):y.notifyAdd(this,r)}if(this._attachments)for(var a=this._attachments,n=0;n<a.length;++n)t?(a[n].unsubscribe(this),this.shouldSave()&&a[n].markUnused(i)):(a[n].subscribe(this),this.shouldSave()&&a[n].markInUse(i))}return this._isDeleted},isImportant:function(){return this._getPriority()},forceComplete:function(e,t){return this.isComplete(e,t,!0)},isDisplayComplete:function(){return this._isFlagHelper(VMLIFlag.DisplayComplete)},computeDisplayComplete:function(){var e=this.parent(),t=e&&!this.isComplete()&&(e.isComplete()||e._isFlagHelper(VMLIFlag.DisplayComplete));this._isFlagHelper(VMLIFlag.DisplayComplete,t)},propagateDisplayComplete:function(e){this.computeDisplayComplete();for(var t=0;t<this.numItems();t++){var i=this.itemAtIndex(t);i.isComplete()||i.propagateDisplayComplete()}},isComplete:function(t,i,n){if(void 0===t)return this._isFlagHelper(VMLIFlag.Complete)&&(!this.repeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===C.getTime());var s={isComplete:t};try{e.PAssert(4072,e.isValidChangeType(i),"Must supply a valid changetype when completing an item: "+i)}catch(t){e.reportError(t)}if(t!==this._isFlagHelper(VMLIFlag.Complete)||this.repeatDate()){if(t){if(this.repeatDate()){try{e.PAssert(4073,!this.dateCompleted||this.dateCompleted.getTime()!==C.getTime(),"If the passed in value is true then the repeated date should never be forced")}catch(t){e.reportError(t)}if(n)this.dateCompleted=C;else{var o=this.repeatDate().nextComplete(this.dateCompleted),c=this.repeatDate().nextActive(this.dateCompleted);if(c){if(e.isLocalChange(i)&&!e.isUndoRedoChange(i)){this.dateCompleted=c,l.beginAction(),e.focusedPane.setIgnoreRestoreScroll(!0);var d=o.hasTimeOfDay()?DFormat.DayYearTime:DFormat.MonthDayYear,h=this.getRawText().replace(this.getDateText(),o.toString(u.getFormat(d))),p=r.createVMLI({text:h,isComplete:!0,dateCompleted:Date.now()},{parent:this.parent(),changeType:ChangeType.AllLocal});this.parent().insertItem(p,this.getIndex()),this.repeatDate().setStartDate(c),s.repeatDate=this.repeatDate().toString(),g.fireEvent("itemStateChanged",[this]),e.vmMain.runSingleParse(this,i|ChangeType.Property),l.endAction()}}else this.dateCompleted=C,e.isLocalChange(i)&&!e.isUndoRedoChange(i)&&e.vmMain.runSingleParse(this,i|ChangeType.Property),n=!0}s.dateCompleted=this.getDateCompletedTime()}else this.dateCompleted||(this.dateCompleted=new Date,s.dateCompleted=this.getDateCompletedTime());e.isLocalChange(i)&&e.aggregateEvent("ItemCompleted")}else this.dateCompleted=void 0,s.dateCompleted=void 0,n=!0;if(this.shouldSave()){var m;e.isLocalChange(i)&&!e.isUndoRedoChange(i)?(a.saveChanges(this,s),s=e.clone(s),m=SaveFlag.Text):m=SaveFlag.None,this.save(s,m)}this.notifyItemPropertyChanged(i,"isComplete"),l.performAction(TrackerType.Update,{itemID:this.id,field:"isComplete",newValue:t,oldValue:!t})}!n&&this.repeatDate()||(this._isFlagHelper(VMLIFlag.Complete,t),this.propagateDisplayComplete(),e.timeline.updateNotifications(this),g.fireEvent("itemStateChanged",[this]))},isStarred:function(t,i){if(void 0===t)return this._isFlagHelper(VMLIFlag.Starred);try{e.PAssert(4074,e.isValidChangeType(i),"Must supply a valid changetype when completing an item: "+i)}catch(t){e.reportError(t)}if(t!==this._isFlagHelper(VMLIFlag.Starred)){var n=this.flags.get();t&&n&VMLIFlag.Complete&&(n&=~VMLIFlag.Complete);var r=t?n|VMLIFlag.Starred:n&~VMLIFlag.Starred;this.setFlags(r);var s={isStarred:t};if(this.shouldSave()){var o;e.isLocalChange(i)&&!e.isUndoRedoChange(i)?(a.saveChanges(this,s),s=e.clone(s),o=SaveFlag.Text):o=SaveFlag.None,this.save(s,o)}this.notifyItemPropertyChanged(i,"isStarred"),g.fireEvent("itemStateChanged",[this]),l.performAction(TrackerType.Update,{itemID:this.id,field:"isStarred",newValue:t,oldValue:!t})}},isHeader:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)},hasVisibleChildren:function(e){if(this.isNote())return!1;for(var t=this.getItems(),i=0;i<t.length;i++)if(!t[i].isHidden(e))return!0;return!1},hasHeaderChildren:function(){if(this.isNote())return!1;for(var e=this.getItems(),t=0;t<e.length;t++)if(e[t].isHeader())return!0;return!1},getCollapsedField:function(t,i){return i?PerPaneStateField.CollapsedOverview:e.settings.get(Settings.searchExpandsCollapsed)&&t.isSearched()?PerPaneStateField.CollapsedSearch:PerPaneStateField.Collapsed},isCollapsed:function(t,i){try{e.PAssert(4075,t,"Must specify the pane for the item being checked for collapsed")}catch(t){e.reportError(t)}if(!t||t.isSearchedFlat())return!1;var n=t.getPerPaneState(this.id,this.getCollapsedField(t,i));return void 0===n&&this.isDemandLoad()?0===this.numItems()||!t.isSearched()&&!i:!!n},setCollapsed:function(t,i,n,r){try{e.PAssert(4076,i,"Must specify the pane for the item being checked for collapsed")}catch(t){e.reportError(t)}if(!i)return!1;var a=this.isCollapsed(i,n);return void 0!==t&&(t&&!this.isCollapsible()||(i.setPerPaneState(this.id,this.getCollapsedField(i,n),t),!1!==r&&e.vmMain.paneManager.updatePaneStateForPane(i),l.performAction(TrackerType.Update,{itemID:this.id,field:"isCollapsed",pane:i,newValue:t,oldValue:a}),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!t,e.focusedPane),t!==a&&i.updateItems())),this.itemChanged.notify(),!!i&&i.getPerPaneState(this.id,n?PerPaneStateField.CollapsedOverview:PerPaneStateField.Collapsed)},toggleCollapsed:function(t){try{e.PAssert(4077,t,"Must specify the pane that this item is being collapsed in")}catch(t){e.reportError(t)}this.setCollapsed(!this.isCollapsed(t,!1),t,!1)},isCollapsible:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)},isDraggable:function(){return!this.isNote()},setTags:function(e){this._activeTags=e},getTags:function(){return this._activeTags},hasCompletedAncestor:function(){for(var e=this.parent();e;){if(e.isComplete())return!0;e=e.parent()}},hasTime:function(){return this.date()?this.date().hasTimeOfDay():this.repeatDate()?this.repeatDate().hasTimeOfDay():!!this.dateCompleted},getTimeOfDay:function(){return this.date()?this.date().getTimeOfDay():this.repeatDate()?this.repeatDate().getTimeOfDay():this.dateCompleted?this.dateCompleted.getTimeOfDay():0},time:function(){var e="";return this.dateCompleted?e=this.dateCompleted.toString(u.getFormat(DFormat.ShortTime)):this.date()?e=this.date().hasTimeOfDay()?this.date().toString(u.getFormat(DFormat.ShortTime)):"All day":this.repeatDate()&&(e=this.repeatDate().hasTimeOfDay()?this.repeatDate().getTime(u.getFormat(DFormat.ShortTime)):"All day"),e},createDateString:function(e){return e.isBefore(Date.today().addWeeks(1))?e.toString(u.getFormat(DFormat.LongDayTime)):e.toString(u.getFormat(DFormat.ShortDayTime))},fullTime:function(){var e=this.date();if(!e)return"";this.createDateString(e)},isVersionUninitialized:function(t){var i;switch(t){case VersionType.Structure:i=this._version;break;case VersionType.Text:i=this._versionText;break;default:i=-2;try{e.PAssert(4078,!1,"Invalid version type")}catch(t){e.reportError(t)}}return(i||0)===window.UninitializedVersion},setVersion:function(t,i){try{e.PAssert(4079,e.isNumber(i),"Must always be setting a version to a number: ",i)}catch(t){e.reportError(t)}switch(t){case VersionType.Structure:this._version=i;break;case VersionType.Text:this._versionText=i;break;default:try{e.PAssert(4080,!1,"Invalid version type")}catch(t){e.reportError(t)}}},getVersion:function(t){var i;switch(t){case VersionType.Structure:i=this._version;break;case VersionType.Text:i=this._versionText;break;default:i=-2;try{e.PAssert(4081,!1,"Invalid version type")}catch(t){e.reportError(t)}}return i||0},setRemoteVersion:function(t,i){try{e.PAssert(4082,void 0===i||e.isNumber(i),"Must always be setting a remote version to a number: ",i)}catch(t){e.reportError(t)}switch(t){case VersionType.Structure:this._versionRemote=i;break;case VersionType.Text:this._versionRemoteText=i;break;default:try{e.PAssert(4083,!1,"Invalid version type")}catch(t){e.reportError(t)}}},getRemoteVersion:function(t,i){var n;switch(t){case VersionType.Structure:n=this._versionRemote;break;case VersionType.Text:n=this._versionRemoteText;break;default:n=-2;try{e.PAssert(4084,!1,"Invalid version type")}catch(t){e.reportError(t)}}return n||i?n:0},isLocalVersionNewer:function(e){return this.getVersion(e)==this.getRemoteVersion(e)||void 0===this.getRemoteVersion(e,!0)},isRemoteVersionNewer:function(e){return!this.isLocalVersionNewer(e)},init:function(t,i){this._shouldSave=!(i&&i.noSave);try{e.PAssert(4085,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(t){e.reportError(t)}if(t.data){try{e.PAssert(4086,this.shouldSave(),"Should never be loading from remote with item that doesnt save")}catch(t){e.reportError(t)}var n=a.getVersion(t.data,VersionType.Structure),s=a.getVersion(t.data,VersionType.Text);this.setRemoteVersion(VersionType.Structure,n),this.setRemoteVersion(VersionType.Text,s),l.beginAction(),this.initFromGDrive(t.data),l.endAction(),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0)}else{if(void 0!==t.version&&this.setVersion(VersionType.Structure,t.version),void 0!==t.versionText&&this.setVersion(VersionType.Text,t.versionText),this.modifiedOffline=t.modifiedOffline,this.modifiedOfflineText=t.modifiedOfflineText,this.modifiedOffline,this.modifiedOfflineText,e.vmMain.isLoaded&&this.shouldSave()&&a.isConnected()&&t.id!==r.rootId?r.initializeItem(this):this.id=t.id||e.generateTempId(),t.date){var o=new Date(t.date);e.isDateValid(o)?this.date(o,i.changeType):e.reportError(new Error("Initial invalid date: ",t.date))}if(t.repeatDate){var c=new h(t.repeatDate);c.isValid()?this.repeatDate(c,i.changeType):e.reportError(new Error("Initial invalid repeat date: "+t.repeatDate))}t.dateCompleted&&(this.dateCompleted=new Date(t.dateCompleted)),t.favorites&&this.setFavorites(t.favorites,i.changeType),this.computeDisplayComplete(),(t.items&&t.items.length>0||t.note)&&this.updateItems(t.items,t.note,i.changeType)}if(this.__TEMP_InitCalled=!0,!this.isArchived()||e.vmMain.hasDisplayedArchivedItems()){try{e.PAssert(4087,i,"Currently we have required properties in extraInfo")}catch(t){e.reportError(t)}var d=i?i.changeType:ChangeType.Auto;try{e.PAssert(4088,e.isValidChangeType(d),"Must supply a valid changetype to VMLIs")}catch(t){e.reportError(t)}this.__TEMP_InitParseCalled=!0,this.parseText(!0,i.changeType|ChangeType.ItemLoad)}else this.__TEMP_SkippedInitParsed=!0;if(this.shouldSave()&&!e.isAutoChange(i.changeType)){var u;e.isLocalChange(i.changeType)?(u=SaveFlag.All,(this.date()||this.repeatDate())&&a.saveChanges(this,this.getMetaTextSaveData()),this.isComplete()&&a.saveChanges(this,{isComplete:this.isComplete()}),this.priority()&&a.saveChanges(this,{priority:this.priority()}),this.isStarred()&&a.saveChanges(this,{isStarred:this.isStarred()})):u=SaveFlag.None,this.getItemStore().trackGlobally()&&r.setModel(this),this.save(void 0,u)}else this.getItemStore().trackGlobally()&&r.setModel(this);e.isLocalChange(i.changeType)&&e.aggregateEvent("ItemCreated")},onLoad:function(e){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(e,!1)||e.isSearched()||this.notifyDemandLoadUpdate(!0,e),this.isLoaded=!0)},destroy:function(){try{e.PAssert(4089,this._canDestroy,"VMLI must be explicitly marked as destroyable")}catch(t){e.reportError(t)}try{e.PAssert(4090,!this.shouldSave()||e.isDemoMode(),"Should never destory a saveable VMLI")}catch(t){e.reportError(t)}var i=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var n=this._attachments,a=0;a<n.length;++a){n[a].unsubscribe(this)}this._attachments=void 0}i.trackGlobally()&&r.clearModel(this.id),this.items.unlisten(this.itemsHasMutated),g.fireEvent("itemStateChanged",[this]),this._store=void 0,t.destroy(this)},isDestroyed:function(){return this._destroyed},getACText:function(){return this.getParsedText()},resetDriveData:function(){this._versionRemote=void 0,this._versionRemoteText=void 0,this.data&&this.data.removeAllEventListeners(),this.data=void 0},isFullscreen:function(){return e.focusedItem===this},findItem:function(e){var t=this.getIndexOf(e.id,!1);return t>=0?{index:t,arr:this.items,isArchived:!1}:this.hasArchivedChildren()&&(t=this.getIndexOf(e.id,!0))>=0?{index:t,arr:this.archivedItems(),isArchived:!0}:void 0},updateItems:function(t,i,n){var s=!1,o=!1;if(t&&t.length>0){var c,l;this.data&&(c=a.get(this.data,"items"),l=a.get(this.data,"archivedItems"));try{e.PAssert(4093,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(t){e.reportError(t)}try{e.PAssert(4094,!this.hasArchivedChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(t){e.reportError(t)}for(var d=0;d<t.length;++d){var h=t[d],u=void 0;if(h instanceof E?u=h:e.isString(h)&&(u=r.getModel(h)),u){var p=r.getItem(u.parent().id);if(p&&p.id!==this.id){var m=p.items.indexOf(u.id);try{e.PAssert(4097,-1===m,"Expect that the old parent has been notified")}catch(t){e.reportError(t)}var f=u.getIndex();f>-1&&u.parent().removeChildAtIndex(f,n)}u.parent(this)}else if("object"!=typeof h){var g=r.getItem(h);try{e.PAssert(4095,g,"Referenced item doesn't exist",h)}catch(t){e.reportError(t)}g&&(u=r.createVMLI(g,{parent:this,changeType:n}))}else{try{e.PAssert(4096,h,"Item must exist otherwise we arent creating anything")}catch(t){e.reportError(t)}h&&(u=r.createVMLI(h,{parent:this,changeType:n}))}try{e.PAssert(4098,u,"There must be a model at this point")}catch(t){e.reportError(t)}u&&(u.isArchived()?(o=!0,this.archivedItems(!0).push(u),!l&&this.data&&(l=a.ensureItemList(this,!0)),l&&l.push(u.data)):(s=!0,this.items.push(u),!c&&this.data&&(c=a.ensureItemList(this,!1)),c&&c.push(u.data)))}}if(i){try{e.PAssert(4099,!this._note,"Must not already have a valid note set")}catch(t){e.reportError(t)}try{e.PAssert(4100,e.isString(i),"Note must be a valid ID")}catch(t){e.reportError(t)}var v=r.getModel(i);if(!v){var g=r.getItem(i);try{e.PAssert(4101,g,"Referenced note doesn't exist",i)}catch(t){e.reportError(t)}g&&(g.isNote=!0,v=r.createVMLI(g,{parent:this,changeType:n}))}try{e.PAssert(4102,v,"Must have a valid note VM at this point")}catch(t){e.reportError(t)}this._note=v,s=!0}s&&this.itemsHasMutated(),o&&this.archivedItems().notify()},addItemAtIndex:function(t,i,n){try{e.PAssert(4103,n,"Must pass pane when adding item at index")}catch(t){e.reportError(t)}l.beginAction();var a=r.createVMLI({text:t},{parent:this,changeType:ChangeType.AllLocal,isEditable:!0});return this.insertItem(a,i),l.performAction(TrackerType.Create,{itemID:a.id,parent:this.id,position:isNaN(i)?this.numItems()-1:i,text:t}),this.isCollapsed(n,!1)&&this.setCollapsed(!1,n),l.endAction(),a},insertItem:function(t,i){try{e.PAssert(4104,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4105,t,"Must specify a valid item to be inserted")}catch(t){e.reportError(t)}try{e.PAssert(4106,!t.isArchived(),"Should not be inserting an archived item into the items array")}catch(t){e.reportError(t)}try{e.PAssert(4107,this.belongsToSameItemStore(t),"Items must belong to the same item store")}catch(t){e.reportError(t)}isNaN(i)?this.items.push(t):this.items.splice(i,0,t),this.shouldSave()&&r.insertItem(this,t,i)},insertSorted:function(t,i,n){try{e.PAssert(4108,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4109,t,"Must specify a valid item to be inserted")}catch(t){e.reportError(t)}try{e.PAssert(4110,!t.isArchived(),"Should not be inserting an archived item into the items array")}catch(t){e.reportError(t)}try{e.PAssert(4111,i,"Must supply a valid comparator")}catch(t){e.reportError(t)}try{e.PAssert(4112,this.belongsToSameItemStore(t),"Items must belong to the same item store")}catch(t){e.reportError(t)}var a=this.items.insertSorted(t,i,n);this.shouldSave()&&r.insertItem(this,t,a)},moveTo:function(t,i){var n=t.parent,a=t.index,s=t.shouldBeArchived,o=t.noVersion;t.underlying,t.fromTab;try{e.PAssert(4113,n instanceof E,"New parent must be a valid VMLI")}catch(t){e.reportError(t)}void 0===a&&(a=-1),void 0===s&&(s=!1);var c=this.parent(),l=c.findItem(this);if(l){var d=a,h=a;if(c===n){if(l.index===d)return;l.index<d&&d--}e.vmMain.beginUpdateItems(),l.arr.splice(l.index,1);var u=s?n.archivedItems():n.items;if(d<0?u.push(this,!1):u.splice(d,0,this,!1),this.parent(n),u.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),e.vmMain.commitUpdateItems(),this.shouldSave()){var p={index:h,isArchived:s};r.moveItem({item:this,newInfo:p,oldParent:c,oldInfo:l,noVersion:o},i)}if(s)try{e.PAssert(4114,this.isArchived(),"If moving to an archived array, the item should already be archived")}catch(t){e.reportError(t)}else try{e.PAssert(4115,!this.isArchived(),"If moving to a non-archived array item should not already be archived")}catch(t){e.reportError(t)}c.propagateDisplayComplete(),n.propagateDisplayComplete()}},getItemsArrayForSave:function(){try{e.PAssert(4116,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}for(var t=[],i=this.getItems(),n=0;n<i.length;++n)t.push(i[n].id);if(this.hasArchivedChildren())for(var r=this.archivedItems(!0),n=0;n<r.length;++n)t.push(r[n].id);return t},getDateTime:function(){if(this.date())return this.date().getTime()},getRepeatDate:function(){if(this.repeatDate())return this.repeatDate().toString()},getDateCompletedTime:function(){if(this.dateCompleted)return this.dateCompleted.getTime()},isForceCompleted:function(){return!(!this.dateCompleted||!this.dateCompleted.equals(C))},getMetaTextSaveData:function(){var e,t,i=this.getDate(!0),n=this.repeatDate();return void 0!==i&&(e=i.getTime()),void 0!==n&&(t=n.toString()),{date:e,dateFormat:this.getDateFormat(),repeatDate:t,dateCompleted:this.getDateCompletedTime()}},_generateNotificationEntry:function(t){var i,n=t.toJSON(),r=new Date(t);try{e.PAssert(4117,e.isDateValid(r),"Must provide a valid alert date: "+t+" - "+this.getDateText())}catch(t){e.reportError(t)}return i=t.hasTimeOfDay()?r.addMinutes(-e.settings.get(Settings.notificationDelay)).toJSON():r.addDays(-1).clearTime().addHours(17).toJSON(),{id:this.id,text:this.getParsedTextWithoutPrefix(),date:n,alertDate:i}},getNotificationEntries:function(){try{e.PAssert(4118,this.date()||this.repeatDate(),"Must have a valid date")}catch(t){e.reportError(t)}try{e.PAssert(4119,!this.allDayDate(),"All day dates should not be scheduled")}catch(t){e.reportError(t)}if(!this.allDayDate())try{if(this.date())return this._generateNotificationEntry(this.date());if(this.repeatDate()){for(var t=[],i=this.repeatDate().getDates(!0),n=0;n<i.length;++n){var r=this._generateNotificationEntry(i[n]);r.id=r.id+"_"+n,
t.push(r)}return t}}catch(t){return void e.reportError(t)}},getDebugData:function(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isArchived:this.isArchived(),isDeleted:this.isDeleted(),version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText}},getFullSaveData:function(){try{e.PAssert(4120,this.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}var t={id:this.id,text:this.getRawText(),date:this.getDateTime(),repeatDate:this.getRepeatDate(),dateText:this.getDateText(),dateCreated:this.dateCreated.getTime(),dateCompleted:this.getDateCompletedTime(),duration:this.getDuration(),durationText:this.getDurationText(),dateFormat:this.getDateFormat(),favorites:this.getFavorites()||void 0,priority:this._getPriority()||void 0,isComplete:this.isComplete()||void 0,isStarred:this.isStarred()||void 0,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isNote:this.isNote()||void 0,isDeleted:void 0,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return this.isNote()||(t.items=this.getItemsArrayForSave()),t},save:function(t,i){try{e.PAssert(4121,this.shouldSave(),"Item must be marked as saveable")}catch(t){e.reportError(t)}try{e.PAssert(4122,void 0!==i,"Must specify saveFlags for the changes that are being saved")}catch(t){e.reportError(t)}if(t){r.getItem(this.id)||t.id?(t.items&&(t.items=this.getItemsArrayForSave(),e.isFlagSet(i,SaveFlag.Prop)||(this.modifiedOffline=!1,t.modifiedOffline=!1)),void 0!==t.text&&(e.isFlagSet(i,SaveFlag.Text)||(this.modifiedOfflineText=!1,t.modifiedOfflineText=!1),g.fireEvent("itemTextChanged",[{item:this,force:i===SaveFlag.None}]))):t=this.getFullSaveData()}else t=this.getFullSaveData();r.saveChanges(this,t,i)},highlight:function(){var e=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout(function(){e.isHighlighted.set(!0)},0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout(function(){e.isHighlighted.set(!1)},2e3)},getElement:function(e){},getSpan:function(e){},getOverviewElement:function(e){},removeChild:function(t,i){try{e.PAssert(4125,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4126,!t.isNote(),"Do not use remove child to remove notes from items")}catch(t){e.reportError(t)}var n;if(t.isArchived()){try{e.PAssert(4129,this.hasArchivedChildren(),"For a child to be archived, this item must have valid archived children")}catch(t){e.reportError(t)}if(this.hasArchivedChildren()){if((n=this.archivedItems(!0).remove(t))>=0)this.shouldSave()&&r.removeItem(this,n,t,!0,i);else{try{e.PAssert(4130,!1,"Archived child not found in parent")}catch(t){e.reportError(t)}try{e.PAssert(4131,this===t.parent(),"Parent of archived child is not set to this item, should not remove: "+t.parent())}catch(t){e.reportError(t)}}this.archivedItems().notify()}}else if((n=this.items.remove(t))>=0)this.shouldSave()&&r.removeItem(this,n,t,!1,i);else{try{e.PAssert(4127,!1,"Child not found in parent")}catch(t){e.reportError(t)}try{e.PAssert(4128,this===t.parent(),"Parent of child is not set to this item, should not remove: "+t.parent())}catch(t){e.reportError(t)}}return n},removeChildAtIndex:function(t,i){try{e.PAssert(4132,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4133,!this.itemAtIndex(t).isArchived())}catch(t){e.reportError(t)}var n=this.items.removeAt(t);return this.shouldSave()&&r.removeItem(this,t,n,!1,i),n},archiveChild:function(t,i){try{e.PAssert(4134,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4135,!t.isNote(),"Do not use archive child on notes")}catch(t){e.reportError(t)}var n=!1;if(!t.isArchived()){l.beginAction(),t.isArchived(!0,i),this.archivedItems().push(t);var a=this.items.remove(t);try{e.PAssert(4136,a>=0,"Must be able to find child in items list")}catch(t){e.reportError(t)}this.shouldSave()&&r.archiveItem(this,a,t,i),l.endAction(),n=!0}return n},unarchiveChild:function(t,i){try{e.PAssert(4137,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4138,!t.isNote(),"Do not use unarchive child on notes")}catch(t){e.reportError(t)}var n=!1;if(t.isArchived()){l.beginAction();try{e.PAssert(4139,t.isArchived(),"Child must be archived to be unarchived")}catch(t){e.reportError(t)}try{e.PAssert(4140,this.hasArchivedChildren(),"Parent must have archived children to unarchive a child")}catch(t){e.reportError(t)}t.isArchived(!1,i);var a=this.archivedItems(!0).remove(t);this.items.push(t),this.shouldSave()&&r.unarchiveItem(this,a,t,i),this.archivedItems().notify(),l.endAction(),n=!0}return n},_moveChildrenHelper:function(t,i){var n=t.newParent,r=t.index,a=t.isArchived;try{e.PAssert(4141,void 0!==n&&void 0!==a,"_moveChildrenHelper is missing parameters")}catch(t){e.reportError(t)}var s=a?this.archivedItems(!0):this.getItems(),o=s;if(o.length>0){var c=a?n.archivedItems(!0):n.getItems();!a&&(isNaN(r)||r<0)&&(r=c.length);for(var d=0;o.length>0;){try{e.PAssert(4142,o[d]!==n,"Should never be reparenting to a child")}catch(t){e.reportError(t)}var h=o[0].id;o[0].moveTo({parent:n,index:r+d,shouldBeArchived:a,underlying:!0},i),l.performAction(TrackerType.Move,{itemID:h,oldParent:this.id,oldPosition:d,newParent:n.id,newPosition:r+d}),d++}}},moveChildren:function(t,i,n){try{e.PAssert(4143,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4144,this.id!==t.id,"Do not use moveChildren to move a child to the same parent")}catch(t){e.reportError(t)}if(t.parent()===this){var r=this.removeChild(t,n);l.performAction(TrackerType.Delete,{itemID:t.id,parent:this.id,position:r})}e.vmMain.beginUpdateItems(),this._moveChildrenHelper({newParent:t,index:i,isArchived:!1},n),this._moveChildrenHelper({newParent:t,index:i,isArchived:!0},n),e.vmMain.commitUpdateItems()},deleteSelf:function(e){this.parent().deleteChild(this,void 0,void 0,e),this.parent(void 0)},deleteChild:function(t,i,n,a){try{e.PAssert(4145,t,"Must provide a valid child to delete")}catch(t){e.reportError(t)}try{e.PAssert(4146,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}if(l.beginAction(),e.vmMain.beginUpdateItems(),t.isNote())this.setNote(void 0,a);else if(t.hasChildren()||t.hasArchivedChildren())if(i)t.moveChildren(i,n,a);else for(var s=t.getItems(),o=s.length-1;o>=0;o--)t.deleteChild(s[o],void 0,void 0,a);if(t.hasNote()&&t.setNote(void 0,a),!t.isDeleted()){if(!t.isNote()){var c=this.removeChild(t,a);l.performAction(TrackerType.Delete,{itemID:t.id,parent:this.id,position:c})}this.shouldSave()&&r.deleteItem(t,a)}t.notifyItemPropertyChanged(a,"isDeleted"),g.fireEvent("itemStateChanged",[this]),e.timeline.updateNotifications(t),e.vmMain.commitUpdateItems(),l.endAction()},replaceChild:function(t,i,n){try{e.PAssert(4147,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4148,!t.isNote(),"Old child should not be a note")}catch(t){e.reportError(t)}try{e.PAssert(4149,!i.isNote(),"New child should not be a note")}catch(t){e.reportError(t)}var a=t.getIndex();this.items.removeAt(a),l.performAction(TrackerType.Delete,{itemID:t.id,parent:this.id,position:a}),r.deleteItem(t,n),i.moveTo({parent:this,index:a},n),r.removeItem(this,a+1,t,!1,n),t.moveChildren(i,i.numChildren(),n);var s=i.parent().id;if(s!==this.id){var o=i.parent().items.remove(i);l.performAction(TrackerType.Move,{itemID:i.id,oldParent:s,oldPosition:o,newParent:this.id,newPosition:a})}},getChildren:function(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()},getChild:function(t){try{e.PAssert(4150,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4151,t>=0,"Child index is out of range: ",t)}catch(t){e.reportError(t)}try{e.PAssert(4152,t<this.numItems(),"Child index out of range: ",t,this.numItems())}catch(t){e.reportError(t)}return this.itemAtIndex(t)},getFirstChild:function(){try{e.PAssert(4153,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}return this.hasChildren()?this.itemAtIndex(0):void 0},isFirstChild:function(){try{e.PAssert(4154,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}return!!this.parent()&&this.parent().getFirstChild()===this},getLastChild:function(){try{e.PAssert(4155,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0},isLastChild:function(){try{e.PAssert(4156,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}return!!this.parent()&&this.parent().getLastChild()===this},isDescendantOf:function(e){for(var t=this.parent();t&&t!==e;)t=t.parent();return void 0!==t},getChildIndex:function(t){try{e.PAssert(4157,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4158,!t.isNote(),"Should not get the index of an item note")}catch(t){e.reportError(t)}return this.getIndexOf(t.id,t.isArchived())},getIndexOf:function(t,i){try{e.PAssert(4159,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4160,e.isString(t),"ID must be a valid string: "+e.getObjectInfo(t))}catch(t){e.reportError(t)}var n,r=-1;if(i?this.hasArchivedChildren()&&(n=this.archivedItems(!0)):n=this.getItems(),n)for(var a=0;a<n.length;++a)if(n[a].id===t){r=a;break}return r},getRemoteIndexOf:function(t,i){try{e.PAssert(4161,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}try{e.PAssert(4162,!t.isNote(),"Should never be getting a remote child index of a note")}catch(t){e.reportError(t)}var n=a.getItemList(this.data,i),r=-1;return n&&(r=n.indexOf(t)),r},getIndex:function(){try{e.PAssert(4164,!this.isNote(),"Should never be getting a child index of a note")}catch(t){e.reportError(t)}return this.parent().getChildIndex(this)},hasChildren:function(){return!this.isNote()&&this.numItems()>0},numChildren:function(){try{e.PAssert(4165,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}return this.numItems()},canZoom:function(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)},parents:function(){for(var e=[],t=this.parent();t;)e.splice(0,0,t),t=t.parent();return e},getArchivedTitle:function(){for(var e="",t=this.parent();t.parent();)e=t.getParsedText()+(e?" | "+e:""),t=t.parent();return e||(e=r.getRootModel().getParsedText()),e},getSiblings:function(t){try{e.PAssert(4166,!this.isNote(),"Notes cannot use this function")}catch(t){e.reportError(t)}t=t||0;var i=[];if(this.parent())for(var n=this.parent().getItems(),r=t,a=n.length;r<a;r++)n[r]!==this&&i.push(n[r]);return i},nextSibling:function(){var e=this.getIndex();return this.parent().getItems()[e+1]},isRootItem:function(){var e=this.getItemStore();return!!e&&e.isRoot(this)},clone:function(t,i){try{e.PAssert(4167,!e.isAutoChange(i),"Cloning should always be a user action")}catch(t){e.reportError(t)}var n=t.getItemStore(),r=n.createItemRaw({text:this.getRawText(),isComplete:this.isComplete(),dateText:this.getDateText(),date:this.date(),dateFormat:this.getDateFormat(),duration:this.getDuration(),durationText:this.getDurationText(),priority:this.priority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:t,changeType:i});r.shouldSave()&&e.isLocalChange(i)&&r.save(void 0,SaveFlag.None);for(var a=0;a<this.numItems();++a){var s=this.itemAtIndex(a).clone(r,i);r.insertItem(s)}if(this.hasNote()){var o=this.getNote().clone(r,i);r.setNote(o,i)}return r},getItems:function(){return this.items.get()},itemAtIndex:function(e){return this.items.get()[e]},numItems:function(){return this.items.get().length},itemsHasMutated:function(){try{e.PAssert(4168,!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id)}catch(t){e.reportError(t)}!this._destroyed&&this.isInitialized&&(b.clearCacheForItem(this.id),g.fireEvent("itemBoldChanged",[{item:this}]),this.getItemStore().updateItems(this),this.itemChanged.notify())},numChildrenRecursive:function(){var t=0,i={item:this};return i.each=function(e){t++},e.searchVMLIs(i),t},isOnDate:function(e){var t=this.date(),i=this.repeatDate();if(t){if(e.hasTimeOfDay()){if(t.equals(e))return!0}else if(t.clone().clearTime().equals(e))return!0}else if(i&&i.includesDate(e))return!0},getCalendarColor:function(){var e;if(this.isComplete())return"#ddd";if(this.hasAttachmentType(n.PluginType.Calendar)){var t=this.getAttachmentByType(n.PluginType.Calendar);e=t.getPlugin().getCalendarBackgroundColor(t.getField("calendarID"))}else e="rgba(0, 153, 221, 0.85)";return e},getCalendarDisplayProps:function(){var e;if(this.hasAttachmentType(n.PluginType.Calendar)){var t=this.getAttachmentByType(n.PluginType.Calendar);e=t.getPlugin().getCalendarDisplayProps(t.getField("calendarID"))}return e},allowTextEditing:function(){var t=!0;return(i.android&&this.hasAttachments()||!e.vmMain.pluginManager.allowTextEditing(this))&&(t=!1),t},getPreviousItem:function(){var e=this.parent(),t=e.getChildIndex(this);if(t>0)return e.getChild(t-1)}},t.defineBase(E),t.extend(E.prototype,s),t.extend(E.prototype,o),t.extend(E.prototype,c(E)),E}),define("edit",["globals","Constants","platform","data","VMLI","tracker","NativeSel","Sel","EditHelpers","Measure","Multiselect"],function(e,t,i,n,r,a,s,o,c,l,d){function h(){}var u={None:0,Left:1,Right:2,StartLine:3,EndLine:4,LeftWord:5,RightWord:6,Down:7,Up:8,PageDown:9,PageUp:10,Top:11,Bottom:12,PrevHeader:13,NextHeader:14,All:15},p=[KeyCode.Tab,KeyCode.BackSpace,KeyCode.Delete],m=[KeyCode.UpArrow,KeyCode.DownArrow,KeyCode.LeftArrow,KeyCode.RightArrow,KeyCode.Home,KeyCode.End,KeyCode.A,KeyCode.E,KeyCode.PageUp,KeyCode.PageDown];return h.prototype={getNavigationAction:function(e){var t=i.mac,n=e.ctrlKey&&!e.altKey&&!e.metaKey,r=e.altKey&&!e.ctrlKey&&!e.metaKey,a=e.metaKey&&!e.ctrlKey&&!e.altKey,s=!e.ctrlKey&&!e.altKey&&!e.metaKey,o=e.normCode,c=KeyCode,l=u;if(o===c.LeftArrow){if(n&&!i.mac||r&&i.mac)return l.LeftWord;if(a&&t)return l.StartLine;if(s)return l.Left}if(o===c.RightArrow){if(n&&!i.mac||r&&i.mac)return l.RightWord;if(a&&t)return l.EndLine;if(s)return l.Right}if(o===c.UpArrow){if(t&&a)return l.Top;if(t&&n)return l.PageUp;if(t&&r)return l.StartLine;if(!t&&n)return l.PrevHeader;if(s)return l.Up}if(o===c.DownArrow){if(t&&a)return l.Bottom;if(t&&n)return l.PageDown;if(t&&r)return l.EndLine;if(!t&&n)return l.NextHeader;if(s)return l.Down}if(o===c.A&&n&&t)return l.StartLine;if(o===c.E&&n&&t)return l.EndLine;if(o===c.Home&&!t){if(n)return l.Top;if(s)return l.StartLine}if(o===c.End&&!t){if(n)return l.Bottom;if(s)return l.EndLine}return o===c.PageUp&&s?l.PageUp:o===c.PageDown&&s?l.PageDown:o===c.A&&a&&t||o===c.A&&n&&!t?l.All:l.None},updateAutocomplete:function(t){var i=t&&t.normCode&&m.indexOf(t.normCode)>=0&&"#"!==t.key;e.autocomplete&&!e.isDemoRunning&&(o.isValid()&&o.getStartItem()===o.getEndItem()&&o.getStartOffset()===o.getEndOffset()?e.autocomplete.update({owner:o.getStartItem(),index:o.getStartIndex(),start:o.getStartOffset(),fromArrows:i}):e.autocomplete.hide())},stopPropagation:function(t){try{e.PAssert(4169,t.stopImmediatePropagation,"Should always be defined")}catch(t){e.reportError(t)}t.stopImmediatePropagation&&t.stopImmediatePropagation()},preventDefault:function(t){try{e.PAssert(4170,t.preventDefault,"Should always be defined")}catch(t){e.reportError(t)}t.preventDefault&&t.preventDefault()},keyup:function(e,t){if(i.mobile&&o.scrollStartIntoView(i.ios),this.stopPropagation(t),this.preventDefault(t),this.isTyping=!1,t.handled)return!0},handleSelectAll:function(e){var i=e.indexOfFirstItem(),n=e.indexOfLastItem();return o.selectIndices(i,0,n,-1,t.SelectOption.AllowPrefix),!1},handleSelectAllItem:function(){if(e.focusedPane&&e.focusedPane.isWriteable)return o.selectIndex(o.getStartIndex(),0,-1),!1},_move:function(i,n){try{e.PAssert(4171,i===Direction.Up||i===Direction.Down,"Must move in a direction")}catch(t){e.reportError(t)}var r=e.focusedPane,s=o.getStartIndex(),c=o.getEndIndex(),l=o.getStartItem(),d=o.getEndItem(),h=!1;if(l.parent()===d.parent()&&(h=!0),!h){if(!r.getNextItem(o.getEndIndex(),!0))for(;d;){if(l.parent()===d.parent()){h=!0;break}d=d.parent()}}if(h){var u,p;if(i===Direction.Up?(u=r.getPreviousItem(s,!0),p=d.getIndex()+1):(u=r.getNextItem(c,!0),p=l.getIndex()),u){a.beginAction();var m=o.save();o.reset();var f=1+u.numChildrenRecursive();e.vmMain.setItemAnimationMode(t.ItemAnimationMode.Move),u.moveTo({parent:u.parent(),index:p},ChangeType.Local),e.vmMain.resetItemAnimationMode(),i===Direction.Up?(m.startIndex-=f,m.endIndex-=f):i===Direction.Down&&(m.startIndex+=f,m.endIndex+=f),o.restore(m),i===Direction.Up?o.scrollStartIntoView():o.scrollEndIntoView(),a.endAction()}}},moveUp:function(t){e.focusedPane.type!==PaneMode.Timeline&&o.isValid()&&this._move(Direction.Up,t)},moveDown:function(t){e.focusedPane.type!==PaneMode.Timeline&&o.isValid()&&this._move(Direction.Down,t)},handleArrows:function(t,n){var r=e.focusedPane;if(!o.isValid())return!0;var a=this.getNavigationAction(n),s=u;switch(o.preferLineStart=!1,a){case s.Left:case s.Right:case s.StartLine:case s.EndLine:case s.LeftWord:case s.RightWord:var d,h,p,m,f,g,v=a===s.Left||a===s.LeftWord||a===s.StartLine,y=a===s.Right||a===s.RightWord||a===s.EndLine;if(v&&(!n.shiftKey||o.isArrowSelectInverted())||y&&n.shiftKey&&o.isArrowSelectInverted()||a===s.StartLine&&o.getStartIndex()===o.getEndIndex()?(p=o.getStartOffset(),m=o.getStartIndex(),g=o.getStartTotal(),d=o.getStartItem()):(p=o.getEndOffset(),m=o.getEndIndex(),g=o.getEndTotal(),d=o.getEndItem()),h=d.getParsedText(),a===s.StartLine){var b=l.getCaretOffset(d,r,p);f=b.lineStart,m=o.isArrowSelectInverted()?o.getStartIndex():o.getEndIndex(),g=o.isArrowSelectInverted()?o.getStartTotal():o.getEndTotal()}else if(a===s.EndLine){var b=l.getCaretOffset(d,r,p),S=d.metricsInPane(r,m);f=b.lineStart+b.lineLength,m=o.isArrowSelectInverted()?o.getStartIndex():o.getEndIndex()}else if(a===s.LeftWord){var E=c.getPreviousWord(h,p-1),C=h.prevIndexOf(window.AttachChar,p);if(C<0||C<=E)if(-1===E&&0===p)if(m>0){if((m=r.indexOfPrevVMLI(m,!1,!0))>=0){var P=r.itemAtIndex(m).getParsedText();f=c.getPreviousWord(P,P.length-1)+1,g=P.length}}else f=-1;else f=E+1;else C>E&&(f=C+1,C+1===p&&f--)}else if(a===s.RightWord){var T=c.getNextWord(h,p+1),D=h.indexOf(window.AttachChar,p);if(D<0||D>=T)if(T===g)if(p===g)if(m<r.numItems()-1){if((m=r.indexOfNextVMLI(m,!1,!0))>=0){var M=r.itemAtIndex(m).getParsedText();T=c.getNextWord(M,0),g=M.length,-1===T&&(T=M.length),f=T}}else f=g+1;else f=g;else f=T;else(T>D||T<0)&&D>=0&&(f=D,D===p&&f++)}else a===s.Left?f=o.getStartOffset()===o.getEndOffset()||n.shiftKey?p-1:o.getStartOffset():a===s.Right&&(f=o.getStartOffset()===o.getEndOffset()||n.shiftKey?p+1:o.getEndOffset());if(o.preferLineStart=v,f<o.getStartItem().getPrefixLength()&&a!==s.StartLine?m>0?(m=r.indexOfPrevVMLI(m,!1,!0),f=-1):f=0:f>g&&(m<r.numItems()-1?(m=r.indexOfNextVMLI(m,!1,!0),f=0):f=g),n.shiftKey){var _=o.isArrowSelectInverted()?o.getEndIndex():o.getStartIndex(),I=o.isArrowSelectInverted()?o.getEndOffset():o.getStartOffset();!o.isArrowSelectInverted()&&v&&m<=o.getStartIndex()&&f>=-1&&f<o.getStartOffset()?o.setArrowSelectInverted(!0):o.isArrowSelectInverted()&&y&&m>=o.getEndIndex()&&f>o.getEndOffset()&&o.setArrowSelectInverted(!1),o.isArrowSelectInverted()?o.selectIndices(m,f,_,I):o.selectIndices(_,I,m,f)}else o.selectIndex(m,f);if(i.isFirefox)if(n.normCode===KeyCode.LeftArrow){var A=d.getParsedText()[o.getStartOffset()-1];if(A===window.AttachChar&&!n.shiftKey)return o.selectItem(d,o.getStartOffset()-1),!1}else if(n.normCode===KeyCode.RightArrow){var w=d.getParsedText()[o.getEndOffset()];if(w===window.AttachChar&&!n.shiftKey)return o.selectItem(d,o.getEndOffset()+1),!1}v?o.scrollStartIntoView():o.scrollEndIntoView();break;case s.Up:case s.Down:case s.Top:case s.Bottom:case s.PageUp:case s.PageDown:case s.PrevHeader:case s.NextHeader:var m,k,p,x=a===s.Up||a===s.Top||a===s.PageUp,R=a===s.Down||a===s.Bottom||a===s.PageDown;x&&(!n.shiftKey||o.isArrowSelectInverted())||R&&n.shiftKey&&o.isArrowSelectInverted()?(p=o.getStartOffset(),m=o.getStartIndex(),k=o.getStartItem()):(p=o.getEndOffset(),m=o.getEndIndex(),k=o.getEndItem());var f,O=l.getCaretOffset(k,r,p),L=l.getCaretScreenPosition(r,m,p),N=(O.lineOffset,L.left);if(o.preferLineStart=O.lineOffset<=2,a===s.Up){var F=O.line-1;if(0===m&&F<0)f=0,F=0;else{if(F<0&&m>0&&(m=r.indexOfPrevVMLI(m,!1,!0))>=0){k=r.itemAtIndex(m);F=l.getCaretOffset(k,r).line}F>=0&&(f=l.getOffsetForScreenPositionInLine(m,k,r,F,N))}}else if(a===s.Down){var F=O.line+1,S=k.metricsInPane(r,m);F>S.styledLines.length-1&&(m<r.numItems()-1?(m=r.indexOfNextVMLI(m,!1,!0),m>=0?(k=r.itemAtIndex(m),F=0):F=O.line):F=O.line),f=l.getOffsetForScreenPositionInLine(m,k,r,F,N)}else if(a===s.Top)m=r.indexOfFirstItem(),f=0;else if(a===s.Bottom){var B=r.getLastItem(),U=r.numItems();B&&U>0&&(m=r.indexOfLastItem(),f=B.getParsedText().length)}else if(a===s.PageUp){var H=r.indexPageUp(o.getStartIndex());m=H,f=0}else if(a===s.PageDown){var V=r.indexPageDown(o.getStartIndex());m=V;var d=r.itemAtIndex(V);f=d.getParsedText().length}else{if(a===s.PrevHeader&&r.type!==PaneMode.Timeline){var q,d=o.getStartItem();if(d.parent()===e.focusedItem){if(!d.isFirstChild()){try{e.PAssert(4172,d.getIndex()>0,"Should never hit this with the first item in the list")}catch(t){e.reportError(t)}q=d.parent().getChild(d.getIndex()-1)}}else{for(;d.parent()!==e.focusedItem;)d=d.parent();q=d}return void 0!==q&&o.selectItem(q,-1),!1}if(a===s.NextHeader&&r.type!==PaneMode.Timeline){var q,d=o.getEndItem();if(d.parent()===e.focusedItem)d.isLastChild()||(q=d.parent().getChild(d.getIndex()+1));else{for(;d.parent()!==e.focusedItem;)d=d.parent();d.isLastChild()||(q=d.parent().getChild(d.getIndex()+1))}return void 0!==q&&o.selectItem(q,-1),!1}}if(m>=0&&!isNaN(f))if(n.shiftKey){var _=o.isArrowSelectInverted()?o.getEndIndex():o.getStartIndex(),I=o.isArrowSelectInverted()?o.getEndOffset():o.getStartOffset();!o.isArrowSelectInverted()&&x&&(m===o.getStartIndex()&&f<o.getStartOffset()||m<o.getStartIndex())?o.setArrowSelectInverted(!0):o.isArrowSelectInverted()&&R&&(m===o.getEndIndex()&&f>o.getEndOffset()||m>o.getEndIndex())&&o.setArrowSelectInverted(!1),o.isArrowSelectInverted()?o.selectIndices(m,f,_,I):o.selectIndices(_,I,m,f)}else o.selectIndex(m,f);x?o.scrollStartIntoView():o.scrollEndIntoView();break;case s.All:this.handleSelectAll(r)}return a===s.None},keydown:function(n,r){this.isTyping=!0;var a=!0;return p.indexOf(r.normCode)>=0?a=this.keypress(n,r,!0):i.mac&&r.ctrlKey&&r.normCode===KeyCode.D?a=this.keypress(n,r,!0):m.indexOf(r.normCode)>=0?(e.vmMain.setItemAnimationMode(t.ItemAnimationMode.None),a=this.handleArrows(n,r),e.vmMain.resetItemAnimationMode(),i.ios||this.updateAutocomplete(r)):i.mac&&r.metaKey||!i.mac&&r.ctrlKey&&!r.altKey?r.normCode!==KeyCode.Y&&r.normCode!==KeyCode.Z||(a=this.keypress(n,r,!0)):i.mac&&r.ctrlKey&&r.normCode===KeyCode.H&&this.preventDefault(r),!i.mobile&&a&&this.keyWantsScrollIntoView(r,!0)&&o.scrollStartIntoView(),a},checkKeypressSpecialCases:function(e,t){var i;return e.ctrlKey&&e.altKey&&t?i=!0:e.metaKey&&e.normCode===KeyCode.Tilde&&(i=!1),i},isMultiselectDangerous:function(){var t=e.focusedPane;if(t.type===PaneMode.Timeline)return"Are you sure you want to delete multiple items from the agenda?";for(var i=t.indexOfNextVMLI(o.getStartIndex()-1),n=t.indexOfPrevVMLI(o.getEndIndex()+1),r=i,a=0;!isNaN(r)&&r>=0&&r<=n;){var s=t.itemAtIndex(r);if(t.isSearchedFlat()){if(t.search.isFlatSearchResult(s)&&a++,a>=2)return MessageID.FlatSearchMultiSelect}else if(++a>=8)return"You have selected a large number of items to delete. Are you sure?";r=t.indexOfNextVMLI(r)}return!1},keypress:function(t,n,r,s){var c=[KeyCode.Enter,KeyCode.D];try{e.PAssert(4173,n.stopPropagation,"Should always be defined")}catch(t){e.reportError(t)}n.stopPropagation&&n.stopPropagation();var l=!0,d=n.normCode>=32||c.indexOf(n.normCode)>=0;if(0!==n.which&&(r||d)){if(i.mac&&n.metaKey||!i.mac&&n.ctrlKey)switch(String.fromCharCode(n.normCode)){case"c":case"C":return n.handled=!0,!0;case"v":case"V":return n.handled=!0,!0;case"x":case"X":return n.handled=!0,!0;case"Y":case"y":case"Z":case"z":try{e.PAssert(4174,!1,"Should not be handled undo/redo hotkeys here")}catch(t){e.reportError(t)}return n.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return n.handled=!0,!0}var h=o.getStartItem();o.getStartObject(),a.beginAction();var u=[KeyCode.Tab,KeyCode.Enter,KeyCode.BackSpace,KeyCode.Delete,KeyCode.D];if(o.getStartIndex()!==o.getEndIndex()&&n.normCode!==KeyCode.Tab&&(!n.metaKey&&!n.ctrlKey&&!n.optKey||u.indexOf(n.normCode)>=0))if(e.focusedPane.type===PaneMode.Timeline)e.toasts.pushMessage({text:"Deleting multiple items from this pane is not currently supported. Please delete them individually.",actionText:"OKAY"}),l=!1;else{e.vmMain.beginUpdateItems();var p;if(!s&&(p=this.isMultiselectDangerous())){if(e.focusedPane.isSearchedFlat())e.toasts.pushMessage(MessageID.FlatSearchMultiSelect);else{var m=o.save();e.menus.confirm(p,function(e){o.restore(m),e&&this.keypress(t,n,r,!0)}.bind(this))}l=!1}else l=!!e.focusedPane.isEditable&&l&&this.handleMultiselect(n);e.vmMain.commitUpdateItems()}l&&u.indexOf(n.normCode)>=0&&(e.vmMain.beginUpdateItems(),n.ctrlKey||n.normCode!==KeyCode.Tab?n.normCode===KeyCode.Enter?(e.focusedPane.type===PaneMode.Timeline&&(e.focusedPane.preventUpdateItemsForItem=!1),l=!!e.focusedPane.isEditable&&l&&this.handleEnter(n)):n.normCode===KeyCode.BackSpace?l=!!(h&&h.allowTextEditing()&&e.focusedPane.isEditable)&&l&&this.handleBackspace(n):(n.normCode===KeyCode.Delete||i.mac&&n.ctrlKey&&n.normCode===KeyCode.D)&&(l=!!(h&&h.allowTextEditing()&&e.focusedPane.isEditable)&&l&&this.handleDelete(n)):e.focusedPane.type===PaneMode.Timeline?l=!1:e.focusedPane.isEditable&&(l=l&&this.handleTab(n)),e.vmMain.commitUpdateItems()),a.endAction()}return!i.mobile&&this.keyWantsScrollIntoView(n,r)&&o.scrollStartIntoView(),l},handleMultiselect:function(i){var n=e.focusedPane,r=n.indexOfNextVMLI(o.getStartIndex()-1),s=n.indexOfPrevVMLI(o.getEndIndex()+1),c=o.getStartOffset(),l=o.getEndOffset();o.selectIndices(r,c,s,l,t.SelectOption.AllowPrefix);var d=!0,h=n.objectAtIndex(r),u=(n.objectAtIndex(s),o.getStartItem()),p=o.getEndItem();if(u.isNote()&&(u=u.parent()),p.isNote()&&(p=p.parent()),!n.hasNonVMLIs&&u===p)return!1;if(i.normCode===KeyCode.Enter&&i.shiftKey)return!0;for(var m=[],s=s,f=n.indexOfNextVMLI(r),g=0;f&&f>=0&&(f<s||f===s&&o.getEndOffset()===o.getEndTotal());){var v=n.itemAtIndex(f);v.parent()===e.focusedPane.getItem()&&v.isHeader()&&g++,m.indexOf(v)<0&&v!==u&&m.push(v),f=n.indexOfNextVMLI(f)}var y,b=o.getEndItem().levelsDeep.get()-o.getStartItem().levelsDeep.get();if(o.getStartOffset()>0||o.getEndOffset()<o.getEndTotal()){var S=u.splitUsableText(u.getParsedText(),o.getStartOffset(),o.getStartOffset()),E=p.splitUsableText(p.getParsedText(),o.getEndOffset(),o.getEndOffset());y=S.before+E.after,a.performAction(TrackerType.Remove,{itemID:u.id,position:o.getStartOffset(),text:u.getParsedText().slice(o.getStartOffset())}),a.performAction(TrackerType.Insert,{itemID:u.id,position:o.getStartOffset(),text:p.getParsedText().substring(o.getEndOffset())}),m.indexOf(p)<0&&m.push(p),0===o.getStartOffset()&&u.copyProperties(p)}else a.performAction(TrackerType.Remove,{itemID:u.id,position:0,text:u.getParsedText()}),y="";if(i.normCode!==KeyCode.BackSpace&&i.normCode!==KeyCode.Delete&&i.normCode!==KeyCode.Enter||(d=!1),u.setText(y,!0,ChangeType.Local),p.moveChildren(u,0,ChangeType.Local),b>0){for(var C=[],P=p.nextSibling();b>0&&P;){var f=P.getIndex(),T=P.parent().getItems().slice(f);C=C.concat(T),P=P.parent().nextSibling(),b--}if(C.length>0)for(var D=u,f=0,M=0;M<C.length;M++){var v=C[M],_=v.parent();if(m.indexOf(_)>=0){var I=v.getIndex();v.moveTo({parent:D,index:f},ChangeType.Local),a.performAction(TrackerType.Move,{itemID:v.id,oldParent:_.id,oldPosition:I,newParent:D.id,newPosition:f}),f++}}}else if(m.indexOf(p.parent())>=0)for(var D=u.parent(),v=n.getNextItem(s,!0);v;){var f=D.numItems(),_=v.parent(),I=_.getChildIndex(v);v.moveTo({parent:D,index:f},ChangeType.Local),a.performAction(TrackerType.Move,{itemID:v.id,oldParent:_.id,oldPosition:I,newParent:D.id,newPosition:f}),v=n.getNextItem(s,!0)}for(var M=0;M<m.length;M++){var v=m[M];try{e.PAssert(4175,v,"Item must exist")}catch(t){e.reportError(t)}v.isDeleted()||v.parent().deleteChild(v,void 0,void 0,ChangeType.Local)}if(n.hasNonVMLIs){var A=n.closestIndexOfObject(h);try{e.PAssert(4176,A>0,"Could not find item to select")}catch(t){e.reportError(t)}A>0&&o.selectIndex(A,o.getStartOffset())}else o.selectIndex(r,c);return d},handleTab:function(t){e.vmMain.beginUpdateItems();var i=o.getPane(),n=o.getStartItem(),r=o.getEndItem(),s=o.getStartObject(),c=o.getEndObject(),l=t.normCode===KeyCode.Tab&&!t.shiftKey||t.normCode===KeyCode.RightArrow;n&&n.isNote()&&(n=n.parent()),r&&r.isNote()&&(r=r.parent());var d,h=n,u={},p=[n],m={},f={};if(f[n.id]=!0,n!==r)do{var g={numLevels:0,ignoreSearch:!0};h=e.getNextItem(h,i,g),h&&(p.push(h),f[h.id]=!0)}while(h!==r&&void 0!==h);var v,y,b,S;for(t.shiftKey?(y=function(){v=p.length-1},b=function(){return v>=0},S=function(){v--}):(y=function(){v=0},b=function(){return v<p.length},S=function(){v++}),y();b();S()){var E=p[v];try{e.PAssert(4177,E,"Must always be tabbing/untabbing valid items")}catch(t){e.reportError(t)}var C,P,T=E.parent(),D=T.getItems().indexOf(E);if(l){if(C=D>0,i.search.isFlatSearchResult(E)&&(C=!1,e.toasts.pushMessage(MessageID.FlatSearchTab)),C){for(d=T.itemAtIndex(D-1);d.isHidden(i);){if(--D<=0)return e.vmMain.commitUpdateItems(),!1;d=T.itemAtIndex(D-1)}m[T.id]||(u[E.parent().id]=E.parent(),u[d.id]=d,E.moveTo({parent:d,fromTab:!0},ChangeType.Local),d.isCollapsed(i,!1)&&d.setCollapsed(!1,i)),m[E.id]=!0,a.performAction(TrackerType.Move,{itemID:E.id,oldParent:T.id,oldPosition:D,newParent:d.id,newPosition:d.numItems()-1})}else d=T,m[E.id]=m[T.id];for(var M=!1,_=E;_;){if(m[_.id]){_.isCollapsed(i,!1)||(M=!0);break}_=_.parent()}var I=E.getIndex()+1;if(M){var A=E.getItems(),w=0;for(P=0;P<A.length;P++){var k=A[P];if(!f[k.id]){if(k.isHidden(i,!1))continue;u[k.parent().id]=k.parent(),u[E.parent().id]=E.parent();var x=I+w;k.moveTo({parent:E.parent(),index:x,fromTab:!0},ChangeType.Local),m[k.id]=!0,a.performAction(TrackerType.Move,{itemID:k.id,oldParent:E.id,oldPosition:P,newParent:E.parent().id,newPosition:x}),w++,P--}}}}else if(C=E.parent()!==e.focusedItem,(i.search.isFlatSearchResult(E)||i.search.isFlatSearchResult(E.parent()))&&(C=!1,e.toasts.pushMessage(MessageID.FlatSearchTab)),C){d=E.parent().parent();var R=T.getItems();for(P=D+1;R[D+1];){var O=R[D+1];f[O.id]||O.isHidden(i)?D++:(u[O.parent().id]=O.parent(),u[E.id]=E,O.moveTo({parent:E,fromTab:!0},ChangeType.Local),m[O.id]=!0,a.performAction(TrackerType.Move,{itemID:O.id,oldParent:T.id,oldPosition:P,newParent:E.id,newPosition:E.numItems()-1})),P++}if(f[T.id]>=0&&(!T.parent()||T.parent()!==e.focusedItem))continue;var L=d.getItems().indexOf(T);u[E.parent().id]=E.parent(),u[d.id]=d,E.moveTo({parent:d,index:L+1,fromTab:!0},ChangeType.Local),m[E.id]=!0,a.performAction(TrackerType.Move,{itemID:E.id,oldParent:T.id,oldPosition:D,newParent:d.id,newPosition:L+1})}}if(i.setIgnoreRestoreScroll(!0),e.vmMain.commitUpdateItems(!1,!0),s||c){try{e.PAssert(4178,s&&c)}catch(t){e.reportError(t)}var N=i.indexOfObject(s),F=i.indexOfObject(c);N>=0&&F>=0&&o.selectIndices(N,o.getStartOffset(),F,o.getEndOffset())}t.handled=!0;try{e.PAssert(4179,t.preventDefault,"Should always be defined")}catch(t){e.reportError(t)}
return t.preventDefault&&t.preventDefault(),!1},handleEnter:function(r){var s=e.focusedPane,c=o.getStartItem();if(!c){try{e.PAssert(4180,!1,"Invalid item in handleEnter")}catch(t){e.reportError(t)}return!1}var l=c.parent();if(!l){try{e.PAssert(4181,!1,"Invalid parent in handleEnter")}catch(t){e.reportError(t)}return!1}var d,h=l.getItems().indexOf(c),u=c.getParsedText(),p=!1,m=l,f=o.getStartObject();if(r.shiftKey)return c.isNote()||c.editNote(),r.preventDefault(),!1;if(c.isNote()){if(!i.mobile)return r.preventDefault(),!1}else{if(s.search.isFlatSearchResult(c))return e.toasts.pushMessage(MessageID.FlatSearchEnter),r.preventDefault(),!1;if(c.shouldCopyPrefix()&&u===c.getPrefix())c.setText("",!0,ChangeType.Local),o.selectIndex(o.getStartIndex(),0);else{if(!c.getPrefix()||o.getStartOffset()!==o.getStartItem().getPrefixLength()||o.getEndOffset()!==o.getEndTotal()){var g=!0,v=!1,y=!1,b={text:""};if(s.setIgnoreRestoreScroll(!0),s.type===PaneMode.Timeline){var S=o.getStartObject(),E=S.block;E.isStarred?b.isStarred=!0:E.isImportant?b.priority=c.priority():E.date&&c.getDateText()&&(b.text=" @"+c.getDateText()),c.shouldSave()||(m=n.getRootModel(),h=-1)}else if(c.hasAttachmentType(t.PluginType.Calendar));else if(o.getEndOffset()===o.getEndItem().getPrefixLength()&&""!==u)h--,g=!1,v=!0;else if(o.getStartOffset()>=o.getStartTotal())(p=!c.isCollapsed(s,!1)&&(c.numItems()>0||c.isHeader()||c.isPrefixHeader()))&&(m=c);else if(o.getStartOffset()===o.getStartItem().getPrefixLength()&&o.getEndOffset()===o.getEndTotal())c.setText(c.getPrefix(),!0,ChangeType.Local),a.performAction(TrackerType.Remove,{itemID:c.id,position:0,text:u});else{var C=c.splitUsableText(u,o.getStartOffset(),o.getEndOffset());b.text=C.after,e.vmMain.setItemAnimationMode(t.ItemAnimationMode.Move),c.setText(C.before,!0,ChangeType.Local),a.performAction(TrackerType.Remove,{itemID:c.id,position:0,text:u.substring(0,o.getEndOffset())}),y=!0,p=!c.isCollapsed(s,!1)&&(c.numItems()>0||c.isHeader()),p&&(m=c)}if(!p&&c.shouldCopyPrefix()&&(b.text=c.getPrefix()+b.text),d=n.createVMLI(b,{parent:m,changeType:ChangeType.AllLocal,isEditable:!0}),y&&d.copyProperties(c),d.parseText(!0,ChangeType.Local|ChangeType.All),p)c.insertItem(d,0),a.performAction(TrackerType.Create,{itemID:d.id,parent:c.id,position:0,text:d.getParsedText()});else{try{e.PAssert(4182,!d.isNote(),"Should never be inserting a note here")}catch(t){e.reportError(t)}m.insertItem(d,h+1),a.performAction(TrackerType.Create,{itemID:d.id,parent:m.id,position:h+1,text:d.getParsedText()})}e.vmMain.resetItemAnimationMode();var P=g?d:c;try{e.PAssert(4183,P,"Expected another item to exist")}catch(t){e.reportError(t)}var T=s.indexOfObject(f),D=g?s.indexOfNextVMLI(T,!1,!0):v?T-1:T,M=P.shouldCopyPrefix()&&P.getPrefixLength()||0;if(D<0){var _=s.indexOfLastItem(),I=s.getLastItem();_>=0&&_!==T&&I&&(D=_,M=I.getParsedText().length)}D>=0&&o.selectIndex(D,M,M,i.android&&t.SelectOption.Delay);try{e.PAssert(4184,r.preventDefault,"Should always be defined")}catch(t){e.reportError(t)}return r.preventDefault&&r.preventDefault(),!1}c.setText(c.getPrefix(),!0,ChangeType.Local),o.selectIndex(o.getStartIndex(),0),a.performAction(TrackerType.Remove,{itemID:c.id,position:0,text:u})}}},handleBackspace:function(n){var r=o.getStartItem(),s=o.getStartIndex(),l=e.focusedPane;if(!r){try{e.PAssert(4185,!1,"Invalid item in handleBackspace")}catch(t){e.reportError(t)}return!1}var d=r.parent();try{e.PAssert(4186,d,"Must always have a valid parent for an item")}catch(t){e.reportError(t)}i.ie&&(n.preventDefault(),n.stopImmediatePropagation());var h=r.getParsedText(),u="",p=0,m=!0,f=r.hasAttachmentType(t.PluginType.Calendar);if(0===o.getStartOffset()&&0===o.getEndOffset()||""===h)if(r.isNote()&&""!==h)m=!1;else if(f)m=!1;else if(o.getStartIndex()>0){var g=e.focusedPane.indexOfPrevVMLI(o.getStartIndex(),!0,!0),v=g>=0&&e.focusedPane.itemAtIndex(g);if(v&&v.allowTextEditing()){if((l.type===PaneMode.Timeline||l.search.isFlatSearchResult(r))&&(h=h.replace(r.getItemDateString(),"").trim(),0!==h.length&&(m=!1)),m){l.setIgnoreRestoreScroll(!0);var y=v.getParsedText(),b=v.isFullscreen()?0:g,S=l.objectAtIndex(b),E=v.isFullscreen()?0:y.length;o.selectIndex(b,E),d.deleteChild(r,v,0,ChangeType.Local),h.length>0&&""!==h&&(0===y.length&&v.copyProperties(r),v.setText(v.generateSaveText(y)+r.generateSaveText(h),!0,ChangeType.Local),r.hasNote()&&(v.hasNote()||v.moveNote(r,ChangeType.Local)),a.performAction(TrackerType.Insert,{itemID:v.id,position:y.length,text:h})),b=l.indexOfObject(S),o.selectIndex(b,E),m=!1}}else m=!1}else m=!1;else if(o.getStartOffset()===o.getEndOffset()&&o.getStartOffset()<=r.getPrefixLength())a.performAction(TrackerType.Remove,{itemID:r.id,position:0,text:h.slice(0,r.getPrefixLength())}),u=h.substr(r.getPrefixLength()),p=0;else if(0===o.getStartOffset()&&o.getEndOffset()===h.length)a.performAction(TrackerType.Remove,{itemID:r.id,position:0,text:r.getParsedText()}),u="",p=0;else if(n.metaKey)if(r.isNote()){var C=h.prevIndexOf("\n",o.getEndOffset());C<0?(u=h.substring(o.getEndOffset()),p=0,a.performAction(TrackerType.Remove,{itemID:r.id,position:0,text:h.slice(0,o.getEndOffset())})):(u=h.substring(0,C)+h.substring(o.getEndOffset()),p=C,a.performAction(TrackerType.Remove,{itemID:r.id,position:0,text:h.slice(C,o.getEndOffset())}))}else u=r.getPrefix()+h.substring(o.getEndOffset()),a.performAction(TrackerType.Remove,{itemID:r.id,position:0,text:h.slice(0,o.getEndOffset())}),p=0;else if((i.mac&&n.altKey||!i.mac&&n.ctrlKey)&&o.getStartOffset()===o.getEndOffset()){var P=h.substring(o.getStartOffset()),T=c.getPreviousWord(h,o.getStartOffset()-1)+1;T>=0?(a.performAction(TrackerType.Remove,{itemID:r.id,position:T,text:h.slice(T,o.getStartOffset())}),u=h.substring(0,T)+P,p=T):(o.getStartOffset()===h.length?0===o.getStartOffset()&&(u="",a.performAction(TrackerType.Remove,{itemID:r.id,position:0,text:h})):(a.performAction(TrackerType.Remove,{itemID:r.id,position:0,text:h.slice(0,o.getStartOffset())}),u=P),p=0)}else if(o.getStartOffset()!==o.getEndOffset()){var D=h.slice(o.getStartOffset(),o.getEndOffset());f&&D.indexOf(window.AttachChar)>=0&&D.indexOf(window.DatePrefix)<0?(a.performAction(TrackerType.Remove,{itemID:r.id,position:o.getStartOffset(),text:D.replace(window.AttachChar,"")}),u=h.substr(0,o.getStartOffset())+h.substr(o.getEndOffset())+window.AttachChar):(a.performAction(TrackerType.Remove,{itemID:r.id,position:o.getStartOffset(),text:D}),u=h.substr(0,o.getStartOffset())+h.substr(o.getEndOffset())),p=o.getStartOffset()}else{var M=1;h.length>1&&""===h[o.getStartOffset()-1]&&M++,f&&h.charAt(o.getStartOffset()-1)===window.AttachChar?" "===h.charAt(o.getStartOffset()-2)?(u=h.substr(0,o.getStartOffset()-3)+h.substr(o.getStartOffset()-2),p=o.getStartOffset()-3):(u=h.substr(0,o.getStartOffset()-2)+h.substr(o.getStartOffset()-1),p=o.getStartOffset()-2):(u=h.substr(0,o.getStartOffset()-M)+h.substr(o.getStartOffset()),a.performAction(TrackerType.Remove,{itemID:r.id,position:o.getStartOffset()-M,text:h.slice(o.getStartOffset()-M,o.getStartOffset())}),p=o.getStartOffset()-M),!f||u!==" "+window.AttachChar&&u!==window.AttachChar||(u="",p=0)}return m&&(r.setText(u,!0,ChangeType.Local),o.selectIndex(s,p),this.updateAutocomplete(n)),!1},handleDelete:function(n){var r=o.getStartItem(),s=e.focusedPane;if(!r)return!1;var l,d=r.parent(),h=r.getParsedText(),u=!0,p=r.hasAttachmentType(t.PluginType.Calendar);if(""===h){if(s.type===PaneMode.Timeline)u=!1;else if(r.isNote())d.setNote(void 0,ChangeType.Local),o.selectItem(d,-1);else if(o.getStartIndex()<s.numItems()-1){var m=o.getStartIndex();s.setIgnoreRestoreScroll(!0),s.numItems()>1&&(r.hasChildren()?d.replaceChild(r,r.getFirstChild(),ChangeType.Local):d.deleteChild(r,d,m,ChangeType.Local)),o.selectIndex(m,0)}}else if(o.getStartOffset()===o.getStartTotal()&&o.getEndOffset()===o.getEndTotal())if(s.type===PaneMode.Timeline)u=!1;else if(r.isNote())u=!1;else{var f=s.indexOfNextVMLI(o.getStartIndex(),!0,!0),g=f>=0&&s.itemAtIndex(f);if(s.setIgnoreRestoreScroll(!0),g){var h=r.generateSaveText(h),v=g.generateSaveText(g.getParsedText());u&&(r.setText(h+v,!0,ChangeType.Local),a.performAction(TrackerType.Insert,{itemID:r.id,position:h.length,text:g.getParsedText()}),g.parent().deleteChild(g,r,0,ChangeType.Local),o.selectIndex(o.getEndIndex(),o.getEndOffset()))}}else if(n.metaKey)r.isNote()||(l=h.substring(0,o.getStartOffset()),r.setText(l,!0,ChangeType.Local),a.performAction(TrackerType.Remove,{itemID:r.id,position:0,text:h.slice(0,o.getStartOffset())}),o.selectIndex(o.getStartIndex(),o.getStartOffset()));else if((i.mac&&n.altKey||!i.mac&&n.ctrlKey)&&o.getStartOffset()===o.getEndOffset()){var y=c.getNextWord(h,o.getStartOffset()+1);y<0&&(y=o.getStartTotal()),y>=0&&(l=h.substring(0,o.getStartOffset())+h.substring(y),r.setText(l,!0,ChangeType.Local),a.performAction(TrackerType.Remove,{itemID:r.id,position:y,text:l}),o.selectIndex(o.getStartIndex(),o.getStartOffset()))}else{if(o.getStartOffset()!==o.getEndOffset()){var b=h.slice(o.getStartOffset(),o.getEndOffset());p&&b.indexOf(window.AttachChar)>=0&&b.indexOf(window.DatePrefix)<0?(l=h.substr(0,o.getStartOffset())+h.substr(o.getEndOffset())+window.AttachChar,a.performAction(TrackerType.Remove,{itemID:r.id,position:o.getStartOffset(),text:h.slice(o.getStartOffset(),o.getEndOffset())})):(l=h.substr(0,o.getStartOffset())+h.substr(o.getEndOffset()),a.performAction(TrackerType.Remove,{itemID:r.id,position:o.getStartOffset(),text:h.slice(o.getStartOffset(),o.getEndOffset())}))}else p&&h.charAt(o.getStartOffset())===window.AttachChar||(l=h.substr(0,o.getStartOffset())+h.substr(o.getStartOffset()+1),a.performAction(TrackerType.Remove,{itemID:r.id,position:o.getStartOffset(),text:h.slice(o.getStartOffset(),o.getStartOffset()+1)}));!p||l!==" "+window.AttachChar&&l!==window.AttachChar&&l!==" "+window.AttachChar&&h!==window.AttachChar||(l=""),void 0!==l&&(r.setText(l,!0,ChangeType.Local),o.selectIndex(o.getStartIndex(),o.getStartOffset()),this.updateAutocomplete(n))}return!1},keyWantsScrollIntoView:function(e,t){switch(e.normCode){case KeyCode.LeftMeta:case KeyCode.RightMeta:case KeyCode.Alt:case KeyCode.Shift:case KeyCode.Ctrl:case KeyCode.LeftArrow:case KeyCode.RightArrow:case KeyCode.UpArrow:case KeyCode.DownArrow:return!1}return!(i.mac&&e.metaKey&&(t&&e.normCode===KeyCode.Tilde||!t&&"`"===String.fromCharCode(e.normCode)))&&((!(i.mac&&e.metaKey||!i.mac&&e.ctrlKey)||e.normCode!==KeyCode.Z&&e.normCode!==KeyCode.Y)&&!(e.normCode>=KeyCode.F1&&e.normCode<=KeyCode.F12))}},new h}),define("EmailHTML",["require","exports","module","globals"],function(e,t,i){function n(){}function r(e){var t;o.lastIndex=0;var i=o.exec(e);return i&&i[1]&&(t=i[1]),t}var a=e("globals"),s={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}},o=/^<(.*)>$/,c=/^[^:]+(?=:)/;return n.prototype={update:function(e,t,i,n){try{a.PAssert(4188,t,"Must supply a valid resource lib")}catch(e){a.reportError(e)}try{a.PAssert(4189,i,"Must supply a valid options obj")}catch(e){a.reportError(e)}var r;return"text/plain"===n?r=this._parsePlain(e,t,i):"text/html"===n?r=this._parseHTML(e,t,i):a.reportError("Unknown email mimeType: "+n),r?r.parsed=this._escapeHTMLEntities(r.parsed):r={parsed:void 0,missingResourceData:!0},r},_escapeHTMLEntities:function(e){var t=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,i=/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g;return e.replace(t,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(i,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})},getAttachmentLinks:function(e,t){var i=[],n=this._createDoc(e);if(n){var r=this._findLinkElements(n),s=this._findQuoteElements(n);try{i=this._findSpecialLinks(r,s,t).attachments}catch(e){a.reportError(e)}}return i},generatePlaintext:function(e,t){return this._createDoc(e).body.innerText},replaceSignature:function(e,t){var i,n=this._createDoc(e),r=this._findActiveSignature(n);if(r){var s=!!r.innerHTML;if(r.innerHTML=t||"",t)s||(r.parentNode.insertBefore(document.createElement("br"),r),r.parentNode.insertBefore(document.createElement("br"),r),r.parentNode.insertBefore(document.createTextNode("--"),r),r.parentNode.insertBefore(document.createElement("br"),r));else{var o=r.previousSibling;if(o&&"BR"===o.tagName){var c=o.previousSibling;if(c&&a.isTextNode(c)&&"--"===c.textContent){var l=c.previousSibling;if(l){var d=l.previousSibling;"BR"===l.tagName&&(l.parentElement.removeChild(l),d&&"BR"===d.tagName&&d.parentElement.removeChild(d))}o.parentElement.removeChild(o),c.parentElement.removeChild(c)}}}i=n.body.outerHTML}else i=e;return i},_ensurePartDoc:function(e){var t;switch(e.mimeType){case"text/plain":t=this._createDoc(this._parsePlain(e.decoded).parsed);break;case"text/html":t=this._createDoc(e.decoded);break;default:try{a.PAssert(4190,!1,"Unknown display part mimeType: "+e.mimeType)}catch(e){a.reportError(e)}}return t},_mergeDocs:function(e,t){if(e.body){var i=t.adoptNode(e.body),n=t.createElement("div");try{for(var r=0;r<i.attributes.length;++r){var s=i.attributes[r];n.setAttribute(s.name,s.value)}}catch(e){a.reportError(e)}try{for(;i.childNodes.length>0;)n.appendChild(i.firstChild)}catch(e){a.reportError(e)}try{t.body.appendChild(n)}catch(e){a.reportError(e)}}},combineParts:function(e){try{a.PAssert(4191,a.isArray(e)&&e.length>0,"Must always supply a valid part list with contents")}catch(e){a.reportError(e)}var t=this._createDoc("<body></body>");try{a.PAssert(4192,t,"Must always be able to create a valid document for first part in list")}catch(e){a.reportError(e)}if(t)for(var i=0;i<e.length;++i){var n=this._ensurePartDoc(e[i]);if(n)try{this._mergeDocs(n,t)}catch(e){a.reportError(e)}}return t?t.body.outerHTML:" "},removeElementById:function(e,t){try{a.PAssert(4193,a.isString(e),"Must pass in a valid decoded HTML email string")}catch(e){a.reportError(e)}try{a.PAssert(4194,a.isString(t),"Must provide a valid item ID")}catch(e){a.reportError(e)}var i=!1;try{var n=this._createDoc(e);n&&(i=this._removeElementById(n,t))}catch(e){a.reportError(e)}return i?n.body.outerHTML:e},_removeElementById:function(e,t){var i=!1,n=e.getElementById(t);return n&&(n.parentNode.removeChild(n),i=!0),i},removeElementsByAttribute:function(e,t,i){try{a.PAssert(4195,a.isString(e),"Must pass in a valid decoded HTML email string")}catch(e){a.reportError(e)}try{a.PAssert(4196,a.isString(t),"Must provide a valid item ID")}catch(e){a.reportError(e)}var n=!1;try{var r=this._createDoc(e);r&&(n=this._removeElementsByAttribute(r,t,i))}catch(e){a.reportError(e)}return n?r.body.outerHTML:e},_removeElementsByAttribute:function(e,t,i){var n,r=!1;n=void 0!==i&&null!==i?e.querySelectorAll("["+t+'="'+i+'"]'):e.querySelectorAll("["+t+"]");for(var a=0;a<n.length;++a){var s=n[a];s.parentNode.removeChild(s),r=!0}return r},_createFragment:function(){return{lines:[],isQuote:!1}},_createPlainFragments:function(e){var t=[],i=e.split("\n"),n=this._createFragment();t.push(n);for(var r=0;r<i.length;++r){var a=i[r].trim(),s=new RegExp(/^>+/).test(a);n.lines.length>0&&s!==n.isQuote&&""!==a&&(n=this._createFragment(),t.push(n)),n.lines.push(a),n.isQuote=n.isQuote||s}return t},_getFragmentText:function(e){var t,i,n="";if(e.isQuote){var r=this._generatePlaceholderID();t='<div id="'+r+'" place="true"></div><p quote="collapsed" group="'+r+'">',i="</p>"}else t="",i="";for(var a=0;a<e.lines.length;++a)n+=e.lines[a]+"\n";return t+n+i},_joinPlainFragments:function(e){for(var t="",i=0;i<e.length;++i){var n=e[i];t+=this._getFragmentText(n)}return t},_parsePlain:function(e,t,i){var n,r=this._escapeHTMLEntities(e),s=this._createPlainFragments(r);try{n=this._joinPlainFragments(s);var o=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gm;n=n.replace(o,'<a mlink="true" href="$1">$1</a>')}catch(e){a.reportError(e),n="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+n+"</body><html>"}},_parseHTML:function(e,t,i){var n={parsed:void 0},r=this._createDoc(e),s=this._findQuoteElements(r);if(s=this._cleanupDocQuotes(r,s,t),this._isFullQuote(r,s)||this._collapseAndMarkQuotes(r,s,!!i.collapseQuotes),i.createLinksFromText)try{this._createLinksFromText(r)}catch(e){a.reportError(e)}var o=this._findLinkElements(r);this._markLinks(o);try{n.specialLinks=this._findSpecialLinks(o,s,i)}catch(e){a.reportError(e)}try{n.parsedMetadata=this._parseMetadata(r)}catch(e){a.reportError(e)}try{var c=this._updateResourceImages(r,t);n.missingResourceData=c.missingResourceData}catch(e){a.reportError(e)}return this._trimTrailingWhitespace(r),this._trimQuoteWhitespace(s),n.parsed=r.body.outerHTML,n},_traverseNode:function(e,t){if(!1!==t(e))for(var i=e.childNodes.length-1;i>=0;i--)this._traverseNode(e.childNodes[i],t)},_sanitizeInputDoc:function(e,t){var i=s[t],n=function(e){if(e.nodeType===Node.COMMENT_NODE){try{a.PAssert(4197,0===e.childNodes.length,"A comment node should never have children")}catch(e){a.reportError(e)}e.parentNode.removeChild(e)}else if(e.nodeType===Node.TEXT_NODE);else if(i.bannedTags.indexOf(e.tagName.toLowerCase())>=0)e.parentNode.removeChild(e);else if(e.attributes.length>0){for(var t=i.allowedTagAttributes[e.tagName],n=e.attributes.length-1;n>=0;n--){var r=e.attributes[n].name;if(i.allowedAttributes.indexOf(r)<0&&(!t||t.indexOf(r)<0))e.removeAttribute(r);else{var s=e.getAttribute(r);s&&s.startsWith("javascript:")&&(console.log("Remove Inline JS: ",e.tagName,r),e.removeAttribute(r))}}var o=e.getAttribute("height");o&&o.indexOf("%")>=0&&(e.removeAttribute("height"),console.log("Remove Height: ",e.tagName,o))}};e.body&&this._traverseNode(e.body,n)},sanitizeContent:function(e){var t;if(e){var i=this._createDoc(e),n=function(e){e.nodeType===Node.TEXT_NODE?e.textContent=new Array(e.textContent.length+1).join("#"):"A"===e.nodeName&&e.removeAttribute("href")};try{this._traverseNode(i.body,n),t=i.body.outerHTML}catch(e){a.reportError(e),t="<<SANITIZED>>"}}else t="<<NO HTML CONTENT>>";return t},sanitizePlaintext:function(e){return e?a.isWhiteSpace(e)?"":"<<NonHTML-Sanitized: "+e.length+">>":"<<NO CONTENT>>"},getComposeBody:function(e,t){var i=!1;try{var n=this._createDoc(e);if(n){i=this._removeElementsByAttribute(n,"moodoAttach","true");var r=this._updateResourceImages(n,t);i=i||r.didUpdate}}catch(e){a.reportError(e)}return i?n.body.outerHTML:e},_createDoc:function(e){var t,i=new DOMParser;try{if(t=i.parseFromString(e,"text/html")){var n=this._parseJSONLD(t);this._sanitizeInputDoc(t,"Default"),n&&n.length>0&&this._reportMetadata(t,n)}}catch(e){a.reportError(e);try{t=i.parseFromString("Error parsing email message","text/html")}catch(e){a.reportError(e)}}return t},_updateResourceImages:function(e,t){for(var i={missingData:!1,didUpdate:!1},n=this._findImageElements(e),r=0;r<n.length;++r){var a=n[r];if(a.src.startsWith("cid:")){var s=a.src.substr(4);if(s){a.setAttribute("cid",s);var o=t.getByCID(s);if(o&&o.data){var c="data:"+o.mimeType+";base64,"+o.data;a.src=c,i.didUpdate=!0}else a.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",i.didUpdate=!0,o||(i.missingData=!0)}else a.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",i.didUpdate=!0}}return i},_findImageElements:function(e){return e.querySelectorAll("img")},_findLinkElements:function(e){return Array.prototype.slice.call(e.querySelectorAll("a"))},_sanitizeLink:function(e){if(e&&e.hasAttribute("href")){e.setAttribute("mlink",!0);var t=e.getAttribute("href");if(t.startsWith("file:"))e.setAttribute("href","");else{c.exec(t)||e.setAttribute("href","https://"+t)}}},_createLinksFromText:function(e){var t=function(t){var i=!0;if(t.nodeType===Node.TEXT_NODE){var n=t.textContent;if(n.indexOf("http")>=0||n.indexOf("www.")>=0){var r=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gm;if(r){var a=t.textContent.replace(r,'<a href="$1">$1</a>'),s=e.createElement("div");s.innerHTML=a;var o=s.childNodes.length;if(o>1||1===o&&"A"===s.childNodes[0].tagName){for(;s.firstChild;)t.parentNode.insertBefore(s.firstChild,t);t.parentNode.removeChild(t)}}}}else"A"===t.tagName&&(i=!1);return i}.bind(this);this._traverseNode(e.body,t)},_markLinks:function(e){for(var t=0;t<e.length;++t)this._sanitizeLink(e[t])},_isAttachmentURL:function(e){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(e)},_findSpecialLinks:function(e,t,i){for(var n={unsubscribe:[],twitter:[],attachments:[]},r=0;r<e.length;++r){var a=e[r];a.href&&this._isAttachmentURL(a.href)&&(i.ignoreQuotedAttachments&&this._isInsideQuote(a,t)||n.attachments.push({href:a.href,cid:a.id,name:a.innerText,type:"application/octet-stream"}))}return n},_parseMetadata:function(e){var t=this._parseMicrodata(e);return t&&t.length>0&&this._reportMetadata(e,t),t},_reportMetadata:function(e,t){a.reportError("Metadata Schemas Found: ",t)},_parseJSONLD:function(e){for(var t=[],i=e.getElementsByTagName("script"),n=0;n<i.length;++n){var r=i[n];if("application/ld+json"===r.getAttribute("type")){var s=r.innerText.trim();if(s)try{var o=JSON.parse(s);t.push(o)}catch(e){a.reportError(new Error("Invalid JSONLD Schema String"),s)}}}return t},_parseMicrodata:function(e){var t=e.querySelectorAll("[itemscope]");return Array.prototype.map.call(t,function(e){if(!e.hasAttribute("itemprop"))return this._parseMicrodataScope(e)}.bind(this)).filter(function(e){return!!e})},_parseMicrodataScope:function(e){var t={type:e.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(t,e),t},_recurseMicrodataScope:function(e,t){for(var i=0;i<t.children.length;++i){var n=t.children[i];if(n.hasAttribute("itemprop")){var r,a=n.getAttribute("itemprop");if(n.hasAttribute("itemscope"))r=this._parseMicrodataScope(n);else switch(n.tagName.toLowerCase()){case"a":case"area":case"link":r=n.getAttribute("href");break;case"meta":r=n.getAttribute("content");break;case"img":r=n.getAttribute("src");break;case"data":case"meter":r=n.getAttribute("value");break;case"time":r=n.getAttribute("datetime");break;default:r=n.hasAttribute("content")?n.getAttribute("content"):n.textContent}a&&r&&(e.properties[a]=r)}else this._recurseMicrodataScope(e,n)}},_cleanupDocQuotes:function(e,t,i){return t.filter(function(e){var t=!1;if("BLOCKQUOTE"===e.nodeName&&"cite"===e.getAttribute("type")){r(e.innerText)&&e&&e.parentNode&&(e.parentNode.removeChild(e),t=!0)}return!t})},_generatePlaceholderID:function(){return a.generateTempId()},_createQuotePlaceholder:function(e){var t=e.createElement("div");return t.id=this._generatePlaceholderID(),t.setAttribute("place",!0),t},_findFirstSiblingQuote:function(e,t){for(var i=e;i.previousElementSibling&&t.indexOf(i.previousElementSibling)>=0;)i=i.previousElementSibling;return i},_markAdjacentQuotes:function(e,t,i,n){for(;e&&i.indexOf(e)>=0;)e.setAttribute("quote",n),e.setAttribute("group",t),e=e.nextElementSibling},_collapseAndMarkQuotes:function(e,t,i){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getAttribute("quote")){var a=this._findFirstSiblingQuote(r,t),s=this._createQuotePlaceholder(e),o=0===n&&i?"collapsed":"uncollapsed";this._markAdjacentQuotes(a,s.id,t,o),a.parentNode.insertBefore(s,r)}}},_removeQuote:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},_removeQuotes:function(e,t){for(var i=0;i<t.length;++i)this._removeQuote(t[i])},_isFullQuote:function(e,t){for(var i=!0,n=0;n<e.body.childNodes.length;++n){var r=e.body.childNodes[n];if(""!==r.textContent.trim()&&t.indexOf(r)<0&&t.indexOf(r.firstElementChild)<0){i=!1;break}}return i},_findQuoteElements:function(e){var t=this._findGmailQuotes(e),i=this._findOffice365Quotes(e),n=this._findBlockquoteQuotes(e),r=[];return r.pushOnlyUniques(t),r.pushOnlyUniques(i),r.pushOnlyUniques(n),r=this._cleanupGmail(r),r=this._removeEmptyQuotes(r)},_cleanupGmail:function(e){return e.filter(function(t){var i=!1;if("BLOCKQUOTE"===t.nodeName&&a.hasClass(t,"gmail_quote"))for(var n=0;n<e.length;++n)for(var r=t.parentNode;r;){if(a.hasClass(r,"gmail_quote")){"DIV"===r.nodeName&&(i=!0);break}r=r.parentNode}return!i})},_removeEmptyQuotes:function(e){return e},_findGmailQuotes:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_quote"))},_findOffice365Quotes:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),i=e.getElementById('3D"divRplyFwdMsg"');return i&&t.push(i),t=t.map(function(e){return e.previousElementSibling&&"HR"===e.previousElementSibling.nodeName?e.parentElement:e})},_findBlockquoteQuotes:function(e){return Array.prototype.slice.call(e.querySelectorAll("blockquote"))},_findGmailSignatures:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_signature"))},_findActiveSignature:function(e){for(var t,i=this._findGmailSignatures(e),n=this._findQuoteElements(e),r=i.length-1;r>=0&&!t;r--){for(var s=i[r],o=!0,c=0;c<n.length;++c)if(a.isAncestor(s,n[c])){o=!1;break}o&&(t=s)}return t},_trimTrailingWhitespace:function(e){for(var t=e.body.childNodes,i=[],n=t.length-1;n>=0;n--){var r=t[n],a=t[n-1];if(!r||"BR"!==r.nodeName||!a||"BR"!==a.nodeName)break;i.push(r)}this._removeElements(i)},_trimQuoteWhitespace:function(e){for(var t=[],i=0;i<e.length;++i)for(var n=e[i].previousElementSibling;n;)"BR"===n.nodeName&&n.previousElementSibling&&"BR"===n.previousElementSibling.nodeName&&t.push(n),n=n.previousElementSibling;this._removeElements(t)},_removeElements:function(e){for(var t=0;t<e.length;++t){var i=e[t];try{i.parentNode&&i.parentNode.removeChild(i)}catch(e){}}},_isInsideQuote:function(e,t){for(;e.parentNode;){if(t.indexOf(e.parentNode)>=0)return!0;e=e.parentNode}return!1}},new n}),define("ResourceLib",["require","exports","module","globals"],function(e,t,i){function n(){this._lib={}}var r=e("globals");return n.prototype={add:function(e){try{r.PAssert(4199,1===arguments.length,"Only expect a single resource to be passed in, not a res,key pair")}catch(e){r.reportError(e)}try{r.PAssert(4200,e.id,"Must specify a valid resource ID")}catch(e){r.reportError(e)}try{r.PAssert(4201,!this._lib[e.id],"Should never have duped resources")}catch(e){r.reportError(e)}this._lib[e.id]=e},getByCID:function(e){var t;this._lib;return this.forEachResource(function(i){if(i.cid===e)return t=i,!1}),t},find:function(e){var t;if(this.has(e))t=this.getByCID(e);else{var i=e.split("@");t=this.getByCID(i[0])}return t},has:function(e){return!!this.getByCID(e)},remove:function(e){try{r.PAssert(4202,this._lib[e.id],"Must only remove resouces that actually exist")}catch(e){r.reportError(e)}delete this._lib[e.id]},isEmpty:function(){return r.isEmpty(this._lib)},forEachResource:function(e){for(var t in this._lib)try{if(!1===e(this._lib[t]))break}catch(e){r.reportError(e)}},clone:function(){var e=new n;for(var t in this._lib)e.add(r.clone(this._lib[t]));return e}},n}),function(e,t){"function"==typeof define&&define.amd?define("papaparse",[],t):"object"==typeof module&&"undefined"!=typeof exports?module.exports=t():e.Papa=t()}(this,function(){"use strict";function e(e,t){t=t||{};var i=t.dynamicTyping||!1;if(g(i)&&(t.dynamicTypingFunction=i,i={}),t.dynamicTyping=i,t.worker&&T.WORKERS_SUPPORTED){var o=l();return o.userStep=t.step,o.userChunk=t.chunk,o.userComplete=t.complete,o.userError=t.error,t.step=g(t.step),t.chunk=g(t.chunk),t.complete=g(t.complete),t.error=g(t.error),delete t.worker,void o.postMessage({input:e,config:t,workerId:o.id})}var c=null;return"string"==typeof e?c=t.download?new n(t):new a(t):!0===e.readable&&g(e.read)&&g(e.on)?c=new s(t):(y.File&&e instanceof File||e instanceof Object)&&(c=new r(t)),c.stream(e)}function t(e,t){function i(e){if("object"!=typeof e)return[];var t=[];for(var i in e)t.push(i);return t}function n(e,t){var i="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var n=e instanceof Array&&e.length>0,a=!(t[0]instanceof Array);if(n&&o){for(var s=0;s<e.length;s++)s>0&&(i+=c),i+=r(e[s],s);t.length>0&&(i+=l)}for(var d=0;d<t.length;d++){for(var h=n?e.length:t[d].length,u=0;u<h;u++){u>0&&(i+=c);var p=n&&a?e[u]:u;i+=r(t[d][p],u)}d<t.length-1&&(i+=l)}return i}function r(e,t){return void 0===e||null===e?"":(e=e.toString().replace(h,d+d),"boolean"==typeof s&&s||s instanceof Array&&s[t]||a(e,T.BAD_DELIMITERS)||e.indexOf(c)>-1||" "===e.charAt(0)||" "===e.charAt(e.length-1)?d+e+d:e)}function a(e,t){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return!0;return!1}var s=!1,o=!0,c=",",l="\r\n",d='"';!function(){"object"==typeof t&&("string"==typeof t.delimiter&&1===t.delimiter.length&&-1===T.BAD_DELIMITERS.indexOf(t.delimiter)&&(c=t.delimiter),("boolean"==typeof t.quotes||t.quotes instanceof Array)&&(s=t.quotes),"string"==typeof t.newline&&(l=t.newline),"string"==typeof t.quoteChar&&(d=t.quoteChar),"boolean"==typeof t.header&&(o=t.header))}();var h=new RegExp(d,"g");if("string"==typeof e&&(e=JSON.parse(e)),e instanceof Array){if(!e.length||e[0]instanceof Array)return n(null,e);if("object"==typeof e[0])return n(i(e[0]),e)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),e.data instanceof Array&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=e.data[0]instanceof Array?e.fields:i(e.data[0])),e.data[0]instanceof Array||"object"==typeof e.data[0]||(e.data=[e.data])),n(e.fields||[],e.data||[]);throw"exception: Unable to serialize unrecognized input"}function i(e){function t(e){var t=m(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new o(t),this._handle.streamer=this,this._config=t}this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},t.call(this,e),this.parseChunk=function(e){if(this.isFirstChunk&&g(this._config.beforeFirstChunk)){var t=this._config.beforeFirstChunk(e);void 0!==t&&(e=t)}this.isFirstChunk=!1;var i=this._partialLine+e;this._partialLine="";var n=this._handle.parse(i,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var r=n.meta.cursor;this._finished||(this._partialLine=i.substring(r-this._baseIndex),this._baseIndex=r),n&&n.data&&(this._rowCount+=n.data.length);var a=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(S)y.postMessage({results:n,workerId:T.WORKER_ID,finished:a});else if(g(this._config.chunk)){
if(this._config.chunk(n,this._handle),this._paused)return;n=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(n.data),this._completeResults.errors=this._completeResults.errors.concat(n.errors),this._completeResults.meta=n.meta),!a||!g(this._config.complete)||n&&n.meta.aborted||this._config.complete(this._completeResults,this._input),a||n&&n.meta.paused||this._nextChunk(),n}},this._sendError=function(e){g(this._config.error)?this._config.error(e):S&&this._config.error&&y.postMessage({workerId:T.WORKER_ID,error:e,finished:!1})}}function n(e){function t(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substr(t.lastIndexOf("/")+1))}e=e||{},e.chunkSize||(e.chunkSize=T.RemoteChunkSize),i.call(this,e);var n;this._nextChunk=b?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)return void this._chunkLoaded();if(n=new XMLHttpRequest,this._config.withCredentials&&(n.withCredentials=this._config.withCredentials),b||(n.onload=f(this._chunkLoaded,this),n.onerror=f(this._chunkError,this)),n.open("GET",this._input,!b),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var t in e)n.setRequestHeader(t,e[t])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;n.setRequestHeader("Range","bytes="+this._start+"-"+i),n.setRequestHeader("If-None-Match","webkit-no-cache")}try{n.send()}catch(e){this._chunkError(e.message)}b&&0===n.status?this._chunkError():this._start+=this._config.chunkSize},this._chunkLoaded=function(){if(4==n.readyState){if(n.status<200||n.status>=400)return void this._chunkError();this._finished=!this._config.chunkSize||this._start>t(n),this.parseChunk(n.responseText)}},this._chunkError=function(e){var t=n.statusText||e;this._sendError(t)}}function r(e){e=e||{},e.chunkSize||(e.chunkSize=T.LocalChunkSize),i.call(this,e);var t,n,r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?(t=new FileReader,t.onload=f(this._chunkLoaded,this),t.onerror=f(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,i)}var a=t.readAsText(e,this._config.encoding);r||this._chunkLoaded({target:{result:a}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function a(e){e=e||{},i.call(this,e);var t,n;this.stream=function(e){return t=e,n=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e=this._config.chunkSize,t=e?n.substr(0,e):n;return n=e?n.substr(e):"",this._finished=!n,this.parseChunk(t)}}}function s(e){e=e||{},i.call(this,e);var t=[],n=!0;this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._nextChunk=function(){t.length?this.parseChunk(t.shift()):n=!0},this._streamData=f(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=f(function(e){this._streamCleanUp(),this._sendError(e.message)},this),this._streamEnd=f(function(){this._streamCleanUp(),this._finished=!0,this._streamData("")},this),this._streamCleanUp=f(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function o(e){function t(){if(P&&f&&(h("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+T.DefaultDelimiter+"'"),f=!1),e.skipEmptyLines)for(var t=0;t<P.data.length;t++)1===P.data[t].length&&""===P.data[t][0]&&P.data.splice(t--,1);return i()&&n(),s()}function i(){return e.header&&0===C.length}function n(){if(P){for(var e=0;i()&&e<P.data.length;e++)for(var t=0;t<P.data[e].length;t++)C.push(P.data[e][t]);P.data.splice(0,1)}}function r(t){return e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)}function a(e,t){return r(e)?"true"===t||"TRUE"===t||"false"!==t&&"FALSE"!==t&&d(t):t}function s(){if(!P||!e.header&&!e.dynamicTyping)return P;for(var t=0;t<P.data.length;t++){for(var i=e.header?{}:[],n=0;n<P.data[t].length;n++){var r=n,s=P.data[t][n];e.header&&(r=n>=C.length?"__parsed_extra":C[n]),s=a(r,s),"__parsed_extra"===r?(i[r]=i[r]||[],i[r].push(s)):i[r]=s}P.data[t]=i,e.header&&(n>C.length?h("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+n,t):n<C.length&&h("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+n,t))}return e.header&&P.meta&&(P.meta.fields=C),P}function o(t,i){for(var n,r,a,s=[",","\t","|",";",T.RECORD_SEP,T.UNIT_SEP],o=0;o<s.length;o++){var l=s[o],d=0,h=0;a=void 0;for(var u=new c({delimiter:l,newline:i,preview:10}).parse(t),p=0;p<u.data.length;p++){var m=u.data[p].length;h+=m,void 0!==a?m>1&&(d+=Math.abs(m-a),a=m):a=m}u.data.length>0&&(h/=u.data.length),(void 0===r||d<r)&&h>1.99&&(r=d,n=l)}return e.delimiter=n,{successful:!!n,bestDelimiter:n}}function l(e){e=e.substr(0,1048576);var t=e.split("\r"),i=e.split("\n"),n=i.length>1&&i[0].length<t[0].length;if(1===t.length||n)return"\n";for(var r=0,a=0;a<t.length;a++)"\n"===t[a][0]&&r++;return r>=t.length/2?"\r\n":"\r"}function d(e){return v.test(e)?parseFloat(e):e}function h(e,t,i,n){P.errors.push({type:e,code:t,message:i,row:n})}var u,p,f,v=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,y=this,b=0,S=!1,E=!1,C=[],P={data:[],errors:[],meta:{}};if(g(e.step)){var D=e.step;e.step=function(n){if(P=n,i())t();else{if(t(),0===P.data.length)return;b+=n.data.length,e.preview&&b>e.preview?p.abort():D(P,y)}}}this.parse=function(i,n,r){if(e.newline||(e.newline=l(i)),f=!1,e.delimiter)g(e.delimiter)&&(e.delimiter=e.delimiter(i),P.meta.delimiter=e.delimiter);else{var a=o(i,e.newline);a.successful?e.delimiter=a.bestDelimiter:(f=!0,e.delimiter=T.DefaultDelimiter),P.meta.delimiter=e.delimiter}var s=m(e);return e.preview&&e.header&&s.preview++,u=i,p=new c(s),P=p.parse(u,n,r),t(),S?{meta:{paused:!0}}:P||{meta:{paused:!1}}},this.paused=function(){return S},this.pause=function(){S=!0,p.abort(),u=u.substr(p.getCharIndex())},this.resume=function(){S=!1,y.streamer.parseChunk(u)},this.aborted=function(){return E},this.abort=function(){E=!0,p.abort(),P.meta.aborted=!0,g(e.complete)&&e.complete(P),u=""}}function c(e){e=e||{};var t=e.delimiter,i=e.newline,n=e.comments,r=e.step,a=e.preview,s=e.fastMode,o=e.quoteChar||'"';if(("string"!=typeof t||T.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),n===t)throw"Comment character same as delimiter";!0===n?n="#":("string"!=typeof n||T.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!=i&&"\r"!=i&&"\r\n"!=i&&(i="\n");var c=0,l=!1;this.parse=function(e,d,h){function u(e){P.push(e),M=c}function p(t){return h?f():(void 0===t&&(t=e.substr(c)),D.push(t),c=y,u(D),C&&v(),f())}function m(t){c=t,u(D),D=[],w=e.indexOf(i,c)}function f(e){return{data:P,errors:T,meta:{delimiter:t,linebreak:i,aborted:l,truncated:!!e,cursor:M+(d||0)}}}function v(){r(f()),P=[],T=[]}if("string"!=typeof e)throw"Input must be a string";var y=e.length,b=t.length,S=i.length,E=n.length,C=g(r);c=0;var P=[],T=[],D=[],M=0;if(!e)return f();if(s||!1!==s&&-1===e.indexOf(o)){for(var _=e.split(i),I=0;I<_.length;I++){var D=_[I];if(c+=D.length,I!==_.length-1)c+=i.length;else if(h)return f();if(!n||D.substr(0,E)!==n){if(C){if(P=[],u(D.split(t)),v(),l)return f()}else u(D.split(t));if(a&&I>=a)return P=P.slice(0,a),f(!0)}}return f()}for(var A=e.indexOf(t,c),w=e.indexOf(i,c),k=new RegExp(o+o,"g");;)if(e[c]!==o)if(n&&0===D.length&&e.substr(c,E)===n){if(-1===w)return f();c=w+S,w=e.indexOf(i,c),A=e.indexOf(t,c)}else if(-1!==A&&(A<w||-1===w))D.push(e.substring(c,A)),c=A+b,A=e.indexOf(t,c);else{if(-1===w)break;if(D.push(e.substring(c,w)),m(w+S),C&&(v(),l))return f();if(a&&P.length>=a)return f(!0)}else{var x=c;for(c++;;){var x=e.indexOf(o,x+1);if(-1===x)return h||T.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:P.length,index:c}),p();if(x===y-1){var R=e.substring(c,x).replace(k,o);return p(R)}if(e[x+1]!==o){if(e[x+1]===t){D.push(e.substring(c,x).replace(k,o)),c=x+1+b,A=e.indexOf(t,c),w=e.indexOf(i,c);break}if(e.substr(x+1,S)===i){if(D.push(e.substring(c,x).replace(k,o)),m(x+1+S),A=e.indexOf(t,c),C&&(v(),l))return f();if(a&&P.length>=a)return f(!0);break}}else x++}}return p()},this.abort=function(){l=!0},this.getCharIndex=function(){return c}}function l(){if(!T.WORKERS_SUPPORTED)return!1;if(!E&&null===T.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var e=T.SCRIPT_PATH||v;e+=(-1!==e.indexOf("?")?"&":"?")+"papaworker";var t=new y.Worker(e);return t.onmessage=d,t.id=P++,C[t.id]=t,t}function d(e){var t=e.data,i=C[t.workerId],n=!1;if(t.error)i.userError(t.error,t.file);else if(t.results&&t.results.data){var r=function(){n=!0,h(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},a={abort:r,pause:u,resume:u};if(g(i.userStep)){for(var s=0;s<t.results.data.length&&(i.userStep({data:[t.results.data[s]],errors:t.results.errors,meta:t.results.meta},a),!n);s++);delete t.results}else g(i.userChunk)&&(i.userChunk(t.results,a,t.file),delete t.results)}t.finished&&!n&&h(t.workerId,t.results)}function h(e,t){var i=C[e];g(i.userComplete)&&i.userComplete(t),i.terminate(),delete C[e]}function u(){throw"Not implemented."}function p(e){var t=e.data;if(void 0===T.WORKER_ID&&t&&(T.WORKER_ID=t.workerId),"string"==typeof t.input)y.postMessage({workerId:T.WORKER_ID,results:T.parse(t.input,t.config),finished:!0});else if(y.File&&t.input instanceof File||t.input instanceof Object){var i=T.parse(t.input,t.config);i&&y.postMessage({workerId:T.WORKER_ID,results:i,finished:!0})}}function m(e){if("object"!=typeof e)return e;var t=e instanceof Array?[]:{};for(var i in e)t[i]=m(e[i]);return t}function f(e,t){return function(){e.apply(t,arguments)}}function g(e){return"function"==typeof e}var v,y=function(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==y?y:{}}(),b=!y.document&&!!y.postMessage,S=b&&/(\?|&)papaworker(=|&|$)/.test(y.location.search),E=!1,C={},P=0,T={};if(T.parse=e,T.unparse=t,T.RECORD_SEP=String.fromCharCode(30),T.UNIT_SEP=String.fromCharCode(31),T.BYTE_ORDER_MARK="\ufeff",T.BAD_DELIMITERS=["\r","\n",'"',T.BYTE_ORDER_MARK],T.WORKERS_SUPPORTED=!b&&!!y.Worker,T.SCRIPT_PATH=null,T.LocalChunkSize=10485760,T.RemoteChunkSize=5242880,T.DefaultDelimiter=",",T.Parser=c,T.ParserHandle=o,T.NetworkStreamer=n,T.FileStreamer=r,T.StringStreamer=a,T.ReadableStreamStreamer=s,y.jQuery){var D=y.jQuery;D.fn.parse=function(e){function t(){if(0===a.length)return void(g(e.complete)&&e.complete());var t=a[0];if(g(e.before)){var r=e.before(t.file,t.inputElem);if("object"==typeof r){if("abort"===r.action)return void i("AbortError",t.file,t.inputElem,r.reason);if("skip"===r.action)return void n();"object"==typeof r.config&&(t.instanceConfig=D.extend(t.instanceConfig,r.config))}else if("skip"===r)return void n()}var s=t.instanceConfig.complete;t.instanceConfig.complete=function(e){g(s)&&s(e,t.file,t.inputElem),n()},T.parse(t.file,t.instanceConfig)}function i(t,i,n,r){g(e.error)&&e.error({name:t},i,n,r)}function n(){a.splice(0,1),t()}var r=e.config||{},a=[];return this.each(function(e){if("INPUT"!==D(this).prop("tagName").toUpperCase()||"file"!==D(this).attr("type").toLowerCase()||!y.FileReader||!this.files||0===this.files.length)return!0;for(var t=0;t<this.files.length;t++)a.push({file:this.files[t],inputElem:this,instanceConfig:D.extend({},r)})}),t(),this}}return S?y.onmessage=p:T.WORKERS_SUPPORTED&&(v=function(){var e=document.getElementsByTagName("script");return e.length?e[e.length-1].src:""}(),document.body?document.addEventListener("DOMContentLoaded",function(){E=!0},!0):E=!0),n.prototype=Object.create(i.prototype),n.prototype.constructor=n,r.prototype=Object.create(i.prototype),r.prototype.constructor=r,a.prototype=Object.create(a.prototype),a.prototype.constructor=a,s.prototype=Object.create(i.prototype),s.prototype.constructor=s,T}),define("parse",["globals","VMLI","tracker","data","International","EmailHTML","papaparse"],function(e,t,i,n,r,a){function s(){}return s.prototype={_setSectionValue:function(e,t,i){e.hasOwnProperty(t)||(e[t]=i)},_parseSection:function(t,i){for(var n={},r=i;r<t.length;++r){var a=t[r];if(a){var s=a.indexOf(":"),o=[a.substr(0,s),a.substr(s+1)],c=o[0].split(";");switch(c[0]){case"BEGIN":var l=this._parseSection(t,r+1);r+=l.size,n[o[1]]=l.section;break;case"END":return{section:n,size:r-i+1};default:if(c.length>1){for(var d={value:o[1]},h=1;h<c.length;++h){var u=c[h].split("=");try{e.PAssert(4204,!d.hasOwnProperty(u[0]),"Should never overwrite line values")}catch(t){e.reportError(t)}d[u[0]]=u[1]}this._setSectionValue(n,c[0],d)}else this._setSectionValue(n,c[0],o[1]);break;case void 0:case null:try{e.PAssert(4205,!1,"Invalid ICS format: "+a)}catch(t){e.reportError(t)}}}}return n},parseICS:function(e){for(var t=e.split("\n"),i=[],n=0;n<t.length;++n){var r=t[n];r.startsWith(" ")?i[i.length-1]+=r.trim():i.push(r.trim())}return this._parseSection(i,0)},parseHead:function(e){for(var t={},i=0;i<e.childElementCount;++i){var n=e.children[i],r=n.nodeName;if(n.firstChild){var a=n.firstChild.textContent;t[r]=a}}return t},parseOPML:function(t,r){var a,s=function(t,i){var o,c=!0;switch(t.nodeName){case"#document":case"body":case"opml":break;case"head":c=!1;var l=this.parseHead(t);l&&l.title&&!a&&(a=n.createVMLI({text:l.title},{parent:n.getRootModel(),changeType:ChangeType.AllLocal}),n.getRootModel().insertItem(a));break;case"outline":i||(a?i=a:(i=a=n.createVMLI({text:r},{parent:n.getRootModel(),changeType:ChangeType.AllLocal}),n.getRootModel().insertItem(a)));var d=t.attributes.text,h=d?d.value:"",u=t.attributes.complete||t.attributes._complete,p=!(!u||"true"!==u.value),m=t.attributes.note||t.attributes._note,f={text:e.stripFormattingTags(h).replace(/[\r\n\t]/g," "),isComplete:p};if(o=n.createVMLI(f,{parent:i,changeType:ChangeType.AllLocal}),i.insertItem(o),m){var g=e.stripFormattingTags(m.value),v={text:g,isNote:!0},y=n.createVMLI(v,{parent:o,changeType:ChangeType.AllLocal});o.setNote(y,ChangeType.AllLocal)}break;default:log("Unknown OPML Node: ",t)}if(c)for(var b=0;b<t.childElementCount;++b)s(t.children[b],o);return o}.bind(this);return i.beginAction(),s(t),i.endAction(),!0},parseJSON:function(t,r){function a(e,t){var i=t||r||n.getRootModel(),s={text:e.text,dateCompleted:e.dateCompleted,dateFormat:e.dateFormat,priority:e.priority,isComplete:e.isComplete,isStarred:e.isStarred},o=n.createVMLI(s,{parent:i,changeType:ChangeType.AllLocal});if(i.insertItem(o),e.note){var c={text:e.note.text,isNote:!0},l=n.createVMLI(c,{parent:o,changeType:ChangeType.AllLocal});o.setNote(l,ChangeType.AllLocal)}if(e.items)for(var d=0;d<e.items.length;++d)a(e.items[d],o)}if(void 0!==t.moodoVer&&void 0!==t.moodoRoot)try{e.parseInt(t.moodoVer),i.beginAction();var s=t.moodoRoot;if(s.items)for(var o=0;o<s.items.length;++o)a(s.items[o]);return i.endAction(),!0}catch(t){e.reportError(t)}else if(void 0!==t.text&&void 0!==t.items)try{return i.beginAction(),a(t),i.endAction(),!0}catch(e){}return!1},_findLineParent:function(e,t,i){for(var n,r=Math.min(e.length-1,t-1),a=r;a>=0;--a){var s=e[a];if(s&&s.indentLevel===i-1){n=s;break}}return n},parseText:function(e){for(var t={items:[]},i=[],n=0;n<e.length;++n){var r=this._parseTextLine(e[n]);if(r){i.push(r);var a=this._findLineParent(i,n,r.indentLevel)||t;r.parent=a,a.items.push(r)}}return t},_parseTextLine:function(t){if(t&&t.length>0){return{indentLevel:Math.floor(t.search(/\S|$/)/4),text:e.trimString(t.replace(/[\ud800-\udfff]+/g,"")),items:[]}}},_createCSVEntry:function(e,t){for(var i={},n=0;n<e.length;++n)i[e[n]]=t[n];return i},parseCSV:function(e){for(var t=require("papaparse").parse(e),i=["Area","Client","Contacts","Category","Context","Created By","Date Created","Date Updated","Delegated To","Start Date","Due Date","Links","Notes","Originating Entry","Parent Entries","Priority","Short Description","Title","Star","Status","Website References"],n=[],r=t.data[0],a=0;a<r.length;++a)i.indexOf(r[a])<0?console.log("Unknown CSV Headers: ",r[a]):n.indexOf(r[a])>=0&&n.remove(r[a]);if(0===n.length)for(var s=[],a=1;a<t.data.length;++a)s.push(this._createCSVEntry(r,t.data[a]));else var o="Missing required export fields: "+n.join(", ");if(r.indexOf("Short Descrption")<0&&r.indexOf("Title")<0)var o="Missing required export fields: Short Descrption OR Title.";return s||o},_addMulti:function(e,t,i){return e[t]||(e[t]=i),e[t]},_getReference:function(e,t){var i;return"Evernote"!==t.type&&(i=e[t.value]),i},_hasReference:function(e,t){var i=!0;return"Evernote"!==t.type&&(i=!!e[t.value]),i},_parseIQTellFilename:function(e){return e.replace(/[\s_]-[\s_]Folder[\s_]Content(.*)\.csv/gi,"")},_visitIQTellNode:function(e,t,i){if(!e.isComplete){var r=n.createVMLI(e,{parent:t,changeType:ChangeType.AllLocal});if(e.__noteInfo){var a=n.createVMLI({text:e.__noteInfo,isNote:!0},{parent:r,changeType:ChangeType.AllLocal});r.setNote(a,ChangeType.AllLocal)}t.insertItem(r);for(var s=0;s<e.children.length;++s)this._visitIQTellNode(e.children[s],r,i+1)}return r},_createVMLITree:function(e){return this._visitIQTellNode(e,n.getRootModel(),0)},_createIQTellText:function(e){var t=e.desc;return e.context&&(t+=" #"+e.context),e.date&&(t+=" @"+e.date.toString(r.getFormat(DFormat.MonthDayYear))),t},_lookupNode:function(t,i){return t[e.hashString(i)]},_storeNode:function(t,i,n){t[e.hashString(i)]=n},_beginImport:function(e){this._reportedImportError=!1,this._rawImportData=e},_endImport:function(){this._reportedImportError=!1,this._rawImportData=void 0},_reportRecursiveImport:function(){this._reportRecursiveImport||e.reportError(new Error("Recursive import failure"),this._rawImportData)},_ensureIQTellNode:function(t,i,n,r){try{e.PAssert(4206,n,"Must always provide a valid entry")}catch(t){e.reportError(t)}try{e.PAssert(4207,!n||n.desc,"Entry must always have a valid description")}catch(t){e.reportError(t)}if(r>60&&this._reportRecursiveImport(),!this._lookupNode(t,n.desc)){var s=this._createIQTellText(n),o={text:s,isStarred:n.star,isComplete:n.isComplete,priority:n.priority,parent:void 0,children:[],__noteInfo:void 0,__raw:n};if(n.notes){try{e.PAssert(4208,e.isString(n.notes),"Note must be a valid string")}catch(t){e.reportError(t)}var c=a.generatePlaintext(n.notes,{});o.__noteInfo=c?c.replace(/(\s*\r?\n){2,}/gm,"\r\n").replace(/^\s*\r?\n/gm,"").replace(/\r([^\n])/gm,"\r\n$1").replace(/\r\n/gm,"\n"):n.notes}for(var l,d=0;d<n.parents.length;++d){l=this._lookupNode(t,n.parents[d].value),l||(l=this._ensureIQTellNode(t,i,i[n.parents[d].value],r+1));break}l||(l=this._lookupNode(t,"__MDFile__"+n.file)),o.parent=l,l.children.push(o),this._storeNode(t,n.desc,o)}return this._lookupNode(t,n.desc)},_createIQTellTree:function(e,t){var i={};log("Creating Tree From: ",e,t);for(var n={text:"IQTell Import",parent:void 0,children:[]},r=0;r<t.length;++r){var a=this._parseIQTellFilename(t[r]),s={text:a,parent:n,children:[]};this._storeNode(i,"__MDFile__"+a,s),n.children.push(s)}for(var o in e)this._ensureIQTellNode(i,e,e[o],0);return this._createVMLITree(n)},_parseIQTellDate:function(e){var t;try{e&&(t=r.parseDate(e,C.DateFormat.MDY))}catch(e){}return t},_parseIQTellPriority:function(e){var t;switch(e){case"1 - Low":t=VMLIFlag.P2;break;case"2 - Medium":t=VMLIFlag.P1;break;case"3 - High":t=VMLIFlag.P0;break;default:t=VMLIFlag.None}return t},iqtellProcess:function(t,i){var n={},r=[];for(var a in t)for(var s=t[a],o=0;o<s.length;++o){var c=s[o],l=c["Short Description"]||c.Title;if(l){var d={raw:c,generated:!1,context:c.Context,file:this._parseIQTellFilename(a),children:[],category:c.Category,area:c.Area,parents:this._parseEntries(c["Parent Entries"]),desc:l,links:this._parseEntries(c.Links),notes:c.Notes,date:this._parseIQTellDate(c["Due Date"]||c["Follow-up Date"]),isComplete:"Completed"===c.Status||"Canceled"===c.Status,priority:this._parseIQTellPriority(c.Priority),star:"Yes"===c.Star};this._addMulti(n,l,d),r.push(d)}}for(var o=0;o<r.length;++o){for(var d=r[o],h=0;h<d.parents.length;++h){var u=this._getReference(n,d.parents[h]);u||this._hasReference(n,d.parents[h])?u.children.push(d):this._addMulti(n,d.parents[h].value,{raw:{},generated:!0,file:d.file,children:[d],parents:[],desc:d.parents[h].value,links:[],notes:void 0,priority:void 0,star:void 0})}for(var h=0;h<d.links.length;++h){var u=this._getReference(n,d.links[h]);if(!u&&!this._hasReference(n,d.links[h]))var u=this._addMulti(n,d.links[h].value,{raw:{},generated:!0,file:d.file,children:[],parents:[{type:"generated",value:d.desc}],desc:d.links[h].value,links:[],notes:void 0,priority:void 0,star:void 0});d.children.push(u)}}this._beginImport(i);var p;try{p=this._createIQTellTree(n,Object.keys(t))}catch(t){e.reportError(t)}return this._endImport(),p},_parseEntries:function(e){var t=[];if(e){for(var i=e.split(", "),n=["Organization","Contact","Prospect","Email","Evernote","Project","Sub-Project","Subtask","Action"],r=[],a=i.length-1;a>=0;a--){var s=i[a],o=/^([^:]*):\s(.*)/.exec(s);(!o||!o[1]||n.indexOf(o[1])<0)&&a>0?(i[a-1]+=", "+i[a],i.removeAt(a)):r.push(s)}for(var a=0;a<r.length;++a){var c=r[a],l=c.indexOf(":");if(l>0){var d=c.substr(0,l),h=c.substr(l+2);t.push({type:d,value:h})}}}return t},stripParents:function(e){if(e.parent=void 0,e.items)for(var t=0;t<e.items.length;t++)this.stripParents(e.items[t])},parseClassName:function(e,t){if(e)return e.indexOf("high")>=0?t.priority=VMLIFlag.P0:e.indexOf("medium")>=0?t.priority=VMLIFlag.P1:e.indexOf("low")>=0&&(t.priority=VMLIFlag.P2),e.indexOf("complete")>=0&&(t.isComplete=!0),e.indexOf("starred")>=0&&(t.isStarred=!0),t},traverseDOM:function(t){function i(e){e.nodeType!==Node.TEXT_NODE&&("UL"===e.tagName||"OL"===e.tagName?(d=d.parent,f=!0):"DIV"===e.tagName||"P"===e.tagName?(m=!0,u=""):"A"===e.tagName&&(d.text+="]("+e.getAttribute("href")+")"))}function n(e,t){isNaN(t)&&(t=0);for(var i="",r=0;r<t;r++)i+="--";if(t&&console.log(i,e.text),e.items)for(var r=0;r<e.items.length;r++)n(e.items[r],t+1)}var r=t.root,a=t.stripParents,s=t.shouldPrint,o=t.preserveWhitespace,c=r.firstChild,l={items:[]},d={text:"",parent:l};l.items.push(d);var h,u,p,m=!1,f=!1,g=this;do{if(function(t){if(t.nodeType===Node.TEXT_NODE){(f||m)&&(o||(d.text=d.text.replace(/^ +/g,"").replace(/ +$/g,"")),""!==d.text&&(h={text:"",parent:d.parent},g.parseClassName(u,h),e.hasClass(t.parentNode,"note")?(h.isNote=!0,d._note=h):d.parent.items.push(h),d=h)),f=!1,m=!1;var i=t.nodeValue.replace(/[\ud800-\udfff]+/g,"");""===d.text&&(i=o?i.replace(/^[\r\n\t]+/g,""):i.replace(/^[ \r\n\t]+/g,"")),g.parseClassName(u,d),d.text+=e.stripFormattingTags(i)}else t.nodeType===Node.COMMENT_NODE||("BR"===t.tagName||"P"===t.tagName||"LI"===t.tagName||"DIV"===t.tagName?(m=!0,u=t.className):"A"===t.tagName?d.text+="[":"UL"!==t.tagName&&"OL"!==t.tagName||(d.text=d.text.replace(/^ +/g,"").replace(/ +$/g,""),h={text:"",parent:d},g.parseClassName(u,h),d.items?d.items.push(h):d.items=[h],d=h,m=!1,u=""))}(c),p=c.firstChild)c=p;else if(p=c.nextSibling)c=p;else{do{p=c.parentNode.nextSibling,p?(i(c.parentNode),c=p):(c=c.parentNode,i(c))}while(!p&&c&&c.parentNode);if(!p)break}}while(c);return a&&this.stripParents(l),s&&n(l),l}},new s}),define("EmailPreview",["require","globals","Constants","util","platform","DisplaySettings","Observable","ObservableArray","Dispatcher","EmailHTML","ResourceLib","tracker","parse"],function(e){function t(){this.openOnPane=void 0,this.messages=new l,this.messagesLoaded=new c(!1),this.isLoading=new c(!1),this.errorMessage=new c(""),this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,a.forceBind("onAttachmentUpdate",this),a.forceBind("reset",this),a.forceBind("_onWindowResizeTimeout",this),o.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),this.init()}function i(e,t){!function(){function i(e){console.log("ERROR: ",e)}function n(e){var t=document.documentElement.clientWidth/e;return Math.max(t,.25)}function r(e){var i=1;t.isAndroid&&(i=n(document.documentElement.scrollWidth))<1&&(document.documentElement.style.transform="scale("+i+")"),InjectedJS.postMessage("resize",{canBeShorter:e,scale:i})}function a(){document.documentElement.addEventListener("click",function(e){InjectedJS.postMessage("click")}),document.addEventListener("keydown",function(e){var t={type:e.type,keyCode:e.keyCode,charCode:e.charCode,which:e.which,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey};InjectedJS.postMessage("keypress",t)},!0);for(var e=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=this.getAttribute("href");return t.startsWith("attach:")?InjectedJS.postMessage("reqResource",[t]):t.startsWith("moodoAction:")?InjectedJS.postMessage(t.replace(/^moodoAction:/gi,"")):InjectedJS.postMessage("href",t),!1},t=document.querySelectorAll("[mlink]"),i=0;i<t.length;++i)t[i].addEventListener("click",e);for(var n=document.querySelectorAll("[place]"),i=0;i<n.length;++i)n[i].addEventListener("click",function(e){for(var t=this.id,i=this.nextElementSibling,n=!1;i&&i.getAttribute("group")===t;){var a=i.getAttribute("quote"),s="collapsed"===a?"uncollapsed":"collapsed";"collapsed"===s&&(n=!0),i.setAttribute("quote",s),i=i.nextElementSibling}return setTimeout(function(){r(n)},0),e.stopImmediatePropagation(),e.preventDefault(),!1});for(var a=[],s=document.querySelectorAll("img"),i=0;i<s.length;++i){var o=s[i].getAttribute("cid");o&&a.push(o),s[i].addEventListener("load",function(){r()})}a.length>0&&InjectedJS.postMessage("reqResource",a)}function s(){document.removeEventListener("DOMContentLoaded",s,!1),o?r():(o=!0,a(),InjectedJS.postMessage("epLoaded"))}window.InjectedJS={postMessage:function(t,n){try{var r;if(void 0!==n)if("string"==typeof n)r="-"+n;else try{r="-"+JSON.stringify(n)}catch(e){i(e),r=""}else r="";window.parent.postMessage("-"+t+"-"+e+r,"*")}catch(e){i(e)}}},window.addEventListener("message",function(e){if(e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),n=e.data.substring(1,t),a=e.data.substring(t+1);switch(n){case"resLoad":try{if(a)for(var s=JSON.parse(a),o=document.querySelectorAll('[cid="'+s.cid+'"]'),c="data:"+s.mimeType+";base64,"+s.data,l=0;l<o.length;++l)o[l].src=c}catch(e){i(e)}break;case"contentLoad":try{if(a){var s=JSON.parse(a);document.open(),document.write(s.data),document.close(),setTimeout(r,0)}}catch(e){i(e)}break;default:i(new Error("Unknown PreviewFrame message: "+n))}}});var o=!1;"complete"===document.readyState||"interactive"===document.readyState?setTimeout(s):(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1))}()}var n=e("globals"),r=e("Constants"),a=e("util"),s=e("platform"),o=e("DisplaySettings"),c=e("Observable"),l=e("ObservableArray"),d=e("Dispatcher"),h=e("EmailHTML"),u=e("ResourceLib"),p=e("tracker");return t.prototype={init:function(){window.addEventListener("message",function(e){if(n.getLocationOrigin()===e.origin&&e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),i=e.data.indexOf("-",t+1);i<0&&(i=void 0);var r=e.data.substring(1,t),a=e.data.substring(t+1,i),s=i?e.data.substring(i+1):void 0;n.batchRenderUpdates(function(){this.handleFrameMessage(a,r,s,e)}.bind(this))}}.bind(this)),d.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),s.onResize.listen(this._onWindowResize.bind(this))},reset:function(e,t){if(this.threadAttach){for(var i=this.threadAttach.getField("messages"),n=0;n<i.length;++n){i[n].initializedForDisplay&&this._destroyMessageDisplay(i[n])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(t,!1),this.messagesLoaded.set(!1,!1),this.messages.get().length>0&&this.messages.set([],e)},_onWindowResizeTimeout:function(){if(this.threadAttach)for(var e=this.threadAttach.getField("messages"),t=0;t<e.length;++t)this.updateMessageHeight(e[t].id,!0)},_onWindowResize:function(){n.timeoutOnce("email resize",this._onWindowResizeTimeout,0)},getPlugin:function(){return this.threadAttach?this.threadAttach.getPlugin():n.vmMain.getDefaultEmailPlugin()},_sendReply:function(e,t,i){try{n.PAssert(4209,e,"Must supply a valid target")}catch(e){n.reportError(e)}try{n.PAssert(4210,t,"Must supply a valid action")}catch(e){n.reportError(e)}try{var r=void 0!==i?"-"+i:"",a="-"+t+r;e.postMessage(a,"*")}catch(e){n.reportError(e)}},handleFrameMessage:function(e,t,i,r){switch(t){case"resize":try{var a=JSON.parse(i);this.updateMessageHeight(e,!0===a.canBeShorter,a.scale)}catch(e){n.reportError(e)}break;case"click":n.fireCustomEvent("tapMain");break;case"keypress":try{var o=JSON.parse(i);s.normalizeKeys(o),n.fireKeyEvent(document.documentElement,o)}catch(e){n.reportError(e)}break;case"href":if(i.startsWith("mailto:")){var c=this.parseMailtoURL(i.replace(/^mailto:/gi,"")),l={to:[{email:c.to}],subject:c.subject&&unescape(c.subject),body:c.body&&unescape(c.body).replace(/\r?\n/g,"<br>")};n.menus.openComposeEmail(this.getPlugin(),void 0,void 0,l)}else n.openUrl(i);break;case"epLoaded":this.onMessageLoaded(e);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(e,this.threadAttach,e);break;case"reqResource":try{try{n.PAssert(4211,r,"Must provide a valid request event")}catch(e){n.reportError(e)}if(this.threadAttach)for(var d=JSON.parse(i),h=0;h<d.length;++h){var u=d[h],p=!1;u.startsWith("attach:")&&(u=u.replace(/^attach:/gi,""),p=!0),this.getPlugin().loadResource(this.threadAttach.id,e,u,function(e,t){var i;if(e){var a;a=p?this._createMessageHTML(this.getPlugin()._decodeEmail(e.data,void 0,{}),{},"text/html").parsed:e.data,i={cid:t,data:a,mimeType:e.mimeType}}try{if(r.source&&i){var s=p?"contentLoad":"resLoad";this._sendReply(r.source,s,i?JSON.stringify(i):void 0)}}catch(e){n.reportError(e)}}.bind(this))}}catch(e){n.reportError(e)}break;default:log("Unknown message from child frame: ",e,t,i,r)}},isOpen:function(){return this.openOnPane&&this.openOnPane.isExpanded.get()},isOpenOnPane:function(e){return this.openOnPane===e&&this.openOnPane.isExpanded.get()},isOpenOnThread:function(e){return this.isOpen()&&this.threadAttach===e},close:function(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),s.mobile?setTimeout(this.reset,r.EmailOpenTimeMobile):this.reset(),this.wantsPaneTransition=!1,d.fireEvent("EmailPreview","onClosed",[]))},setOpenPane:function(e,t){this.openOnPane&&this.openOnPane!==e&&this.openOnPane.setExpanded(!1,t),this.openOnPane=e,e&&e.setExpanded(!0,t)},_openPane:function(e,t){try{n.PAssert(4212,t,"Must supply a valid cb to openPane")}catch(e){n.reportError(e)}e!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout(function(){this.wantsPaneTransition=!1,t()}.bind(this),r.EmailOpenTime+100)):t(),this.setOpenPane(e)},getPane:function(){try{n.PAssert(4213,this.openOnPane,"Should not be trying to get pane if email preview is not open")}catch(e){n.reportError(e)}return this.openOnPane},startOpenOnLoad:function(e){this.setOpenPane(e,!1)},open:function(e,t,i,r){if(t!==this.threadAttach||i!==this.openOnPane){var a=t.getPlugin();this.reset(!0,!0),this.threadAttachLoading=t,s.mobile?n.closeKeyboard():n.vmMain.paneManager.ensurePaneInView(i)
;var o=2,c=!1;if(r){var l=function(e){if(e.length>0){return e[e.length-1].labelIds.indexOf("DRAFT")<0&&this.setLastMessageResponseMode(r),!1}}.bind(this);this.messages.listen(l)}var d=function(){0===--o&&t===this.threadAttachLoading&&(c?(this._setThread(t,e),p.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenEmail,data:{pane:i}})):this.errorMessage.get()?this.isLoading.set(!1):n.menus.alert({text:"Unable to load email messages. You may be offline.",actionText:"OKAY"}))}.bind(this);this._openPane(i,function(){d()}),a.loadThread(t,function(e,t,i){c=e,!e&&i?this.errorMessage.set(i):this.errorMessage.set(""),d()}.bind(this))}else r&&this.isOpen()&&this.setLastMessageResponseMode(r)},_getReplyToFromMessage:function(e){return this._selfSentMessage(e)?e.to:e.replyTo?[e.replyTo]:[e.from]},_getSenderFromMessage:function(e){var t=this.threadAttachLoading||this.threadAttach;return this._findSelf(t.getField("accountID"),e)},_selfSentMessage:function(e){return this.getPlugin().isMyAccountID(e.from.email)},_removeSelf:function(e){if(e){for(var t=e.slice(0),i=this.getPlugin(),n=0;n<t.length;n++)i.isMyAccountID(t[n].email)&&(t.splice(n,1),n--);return t}},_findSelf:function(e,t){var i,n=this.getPlugin(),r=n.getSendingAccounts(e);if(r.indexOf(t.from.email)>=0)i=t.from.email;else{if(t.to)for(var a=0;a<t.to.length;++a)if(r.indexOf(t.to[a].email)>=0){i=t.to[a].email;break}if(!i&&t.cc)for(var a=0;a<t.cc.length;++a)if(r.indexOf(t.cc[a].email)>=0){i=t.cc[a].email;break}if(!i&&t.bcc)for(var a=0;a<t.bcc.length;++a)if(r.indexOf(t.bcc[a].email)>=0){i=t.bcc[a].email;break}}return i||(i=n.getDefaultSendingAccount(e)),{text:n.getDisplayName(i),email:i}},areContactsEqual:function(e,t){return e.email===t.email},_updateDraftFromMessage:function(e,t,i){var a,s,o,c,l=this.getPlugin(),d=e.subject,h=this._getSenderFromMessage(e);try{n.PAssert(4214,i!==r.EmailResponseMode.Other,"Should never pass Other mode to _updateDraftFromMessage")}catch(e){n.reportError(e)}i===r.EmailResponseMode.Reply?a=this._getReplyToFromMessage(e):i===r.EmailResponseMode.ReplyAll?(a=this._removeSelf(this._getReplyToFromMessage(e).concat(e.to)),s=this._removeSelf(e.cc)):i===r.EmailResponseMode.Forward&&(c=e.resources.clone()),i&&(o=l.createMessageBody(e,t.from.email,i)),a=n.arrayUniques(a||[],this.areContactsEqual),s=n.arrayUniques(s||[],this.areContactsEqual),i===r.EmailResponseMode.Reply||i===r.EmailResponseMode.ReplyAll?(0!==d.toLowerCase().indexOf("re")&&(d="Re: "+d),c=t.resources):i===r.EmailResponseMode.Forward&&0!==d.toLowerCase().indexOf("fwd")&&(d="Fwd: "+d);var p={to:a,from:h,cc:s,bcc:void 0,subject:d,body:o,resources:c||new u};this.getPlugin().updateDraft(this.threadAttach,t.id,t.draftID,p,o,!0,!1,function(e){try{n.PAssert(4215,e,"Should always be able to update a draft")}catch(e){n.reportError(e)}})},requestAttachment:function(e,t,i,n){this.getPlugin().loadResource(e,t,i,n)},getAttachmentURL:function(e,t,i){return this.getPlugin().getAttachmentURL(e,t,i)},getPreviewURL:function(e){return this.getPlugin().getPreviewURL(e)},reportMessage:function(e,t,i,n,r){this.getPlugin().reportMessage(e,t,i,n,r)},dumpMessage:function(e,t,i){try{n.PAssert(4216,!1,"Should not be dumping message in non-DEBUG modes")}catch(e){n.reportError(e)}this.getPlugin().dumpMessage(e,t,i)},parseMailtoURL:function(e){var t={to:void 0,subject:void 0,body:void 0},i=e.split("?");if(t.to=i[0],i[1])for(var n=i[1].split("&"),r=0;r<n.length;++r){var a=n[r].split("=");switch(a[0].toUpperCase()){case"SUBJECT":t.subject=a[1];break;case"BODY":t.body=a[1]}}return t},parseListUnsubscribe:function(e){for(var t={emailData:void 0,url:void 0},i=e.split(","),r=0;r<i.length;++r){var a=/^<?(http|https|mailto):([^<>]*)>?/gi,s=a.exec(i[r]);if(s)switch(s[1]){case"http":case"https":t.url=s[1]+":"+s[2];break;case"mailto":t.emailData=this.parseMailtoURL(s[2]);break;default:try{n.PAssert(4217,!1,"Unknown List Unsubscribe Format: "+e)}catch(e){n.reportError(e)}}}return t},setMessageResponseMode:function(e,t){var i=this.messages.get()[this.messages.indexOfWithProperty("id",e)];try{n.PAssert(4218,i,"Must be able to find a valid reply message to update response mode for")}catch(e){n.reportError(e)}if(i){if(t!==r.EmailResponseMode.None){try{n.PAssert(4219,i.initializedForDisplay,"Must be initialized for display to set response mode")}catch(e){n.reportError(e)}var a=this.getPlugin(),o=a.getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,e,this._getSenderFromMessage(i));this._updateDraftFromMessage(i,o,t)}i.responseMode&&i.responseMode.set(t),s.mobile&&t!==r.EmailResponseMode.None&&n.menus.openModalNew(Modals.EmailReply,{threadAttach:this.getThreadAttach(),message:o,inReplyToMessage:i,responseMode:t})}},setLastMessageResponseMode:function(e){if(e){var t=this.messages.get()[this.messages.length()-1];try{n.PAssert(4220,t,"Setting message response mode when there are no messages")}catch(e){n.reportError(e)}t&&this.setMessageResponseMode(t.id,e)}},_createErrorHTML:function(){return h.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html")},_createMessageHTML:function(e,t,i,n){var r={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0};if(n)for(var a in n)n.hasOwnProperty(a)&&(r[a]=n[a]);return h.update(e,t,r,i)},_generateCSS:function(){if(!this._cachedCSS){var e={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};o.isDark()&&(e.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",e.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var t="";for(var i in e){t+=i+"{";for(var n in e[i]){t+=n+":"+e[i][n]+";"}t+="}"}this._cachedCSS="<style>"+t+"</style>"}return this._cachedCSS},_createFrameBlob:function(e,t,n){var r={isApp:s.app,isAndroid:s.android},a=this._generateCSS(),o="<script>("+i.toString()+')("'+n+'",'+JSON.stringify(r)+");<\/script>",t='<meta http-equiv="Content-Type" content="'+t+'">';return s.supportBlobURLIFrame?new Blob(["<!DOCTYPE html>","<html>","<head>",t,a,o,"</head>",e,"</html>"],{type:"text/html"}):["<!DOCTYPE html>","<html>","<head>",t,a,o,"</head>",e,"</html>"].join("")},onMessageLoaded:function(e){this.updateMessageHeight(e),this.messagesLoaded.set(!0)},getPreviewIFrame:function(e){return document.getElementById("emailPreview_"+e)},updateMessageHeight:function(e,t,i){var r=this.getPreviewIFrame(e);if(r){var a=this.messages.get()[this.messages.indexOfWithProperty("id",e)];t&&(r.style.height="0px");try{var s=r.contentDocument.documentElement;if(s){var o=i||a.defaultScale.get(),c=Math.ceil(s.scrollWidth*o),l=Math.ceil(s.scrollHeight*o);t&&l===a.height.get()&&(r.style.height=l+"px"),a.width.set(c),a.height.set(l),i&&a.defaultScale.get()!==i&&a.defaultScale.set(i)}}catch(e){n.reportError(e)}}},_generateAltParts:function(t,i){var r=this.getPlugin().getMessageAttachments(i);if(r)for(var a=0;a<r.length;++a){var s=r[a];"application/ics"===s.mimeType&&this.getPlugin().loadResource(t.id,i.id,s.cid,function(t){if(t){var i=e("parse").parseICS(n.b64_to_utf8(t.data));log("Parsed ICS Data: ",i)}})}},_computeResponseMode:function(e){var t=r.EmailResponseMode.None;return e&&e.labelIds.indexOf("DRAFT")>=0&&(t=e.subject.startsWith("Fwd:")?r.EmailResponseMode.Forward:e.subject.startsWith("Re:")?1===e.to.length?r.EmailResponseMode.Reply:r.EmailResponseMode.ReplyAll:r.EmailResponseMode.Other),t},_createMessageDisplay:function(e,t,i){try{n.PAssert(4221,!e.initializedForDisplay,"Should only initialize message for display once")}catch(e){n.reportError(e)}try{n.PAssert(4222,e.to,"Must have a valid to object")}catch(e){n.reportError(e)}try{n.PAssert(4223,e.from,"Mus have a valid from object")}catch(e){n.reportError(e)}var r,a=!0;if(e.decoded?(e.isErrorMessage=!1,r=this._createMessageHTML(e.decoded,e.resources,e.mimeType,i),r.missingResourceData&&(a=!1)):(n.reportError(!1,"Missing message decoded data: "+n.isString(e.decoded)),e.isErrorMessage=!0,r=this._createErrorHTML()),e.listUnsubscribe){var o=this.parseListUnsubscribe(e.listUnsubscribe);log("Unsub Data: ",o)}try{n.PAssert(4224,r.parsed,"Must have valid parsed data")}catch(e){n.reportError(e)}return e.blob=this._createFrameBlob(r.parsed,e.contentType,e.id),n.isString(e.blob)||(e.blobURL&&(s.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0),e.blobURL=s.URL.createObjectURL(e.blob)),e.specialLinks=r.specialLinks,e.width||(e.width=new c(0)),e.height||(e.height=new c(0)),e.defaultScale||(e.defaultScale=new c(1)),e.responseMode||(e.responseMode=new c(this._computeResponseMode(t))),e.initializedForDisplay=!0,a},_destroyMessageDisplay:function(e){try{n.PAssert(4225,e.initializedForDisplay,"Message must first be initialized before being destroyed")}catch(e){n.reportError(e)}e.initializedForDisplay=!1,e.isErrorMessage=!1,e.width=void 0,e.height=void 0,e.defaultScale=void 0,e.responseMode&&(e.responseMode=void 0),e.specialLinks=void 0,e.blob=void 0,e.blobURL&&(s.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0)},ensureDisplayMessages:function(e){if(e===this.threadAttach)try{for(var t=e.getField("messages"),i=[],r=0;r<t.length;++r){var a=t[r];if(!e.getPlugin().isMessageDraft(a)&&!a.initializedForDisplay){try{this._generateAltParts(e,a)}catch(e){n.reportError(e)}var s;s=0===r?this._createMessageDisplay(a,t[r+1],{collapseQuotes:!1}):this._createMessageDisplay(a,t[r+1]),s||this.getPlugin().reportMessage(e.getField("accountID"),e.id,a.id,"Error creating display",!1)}i.push(a)}i.equals(this.messages.get())||this.messages.set(i)}catch(e){n.reportError(e)}},_requestMessageReload:function(e,t,i){t.getPlugin().forceReloadMessage(t,i,function(r){try{n.PAssert(4226,r,"Must be able to re-load message data")}catch(e){n.reportError(e)}if(t===this.threadAttach){var a=t.getField("messages"),o=a.indexOfWithProperty("id",i),c=a[o];if(c){var l=this.getPreviewIFrame(e);if(l)if(c.initializedForDisplay=!1,this.ensureDisplayMessages(t),s.supportBlobURLIFrame)l.src=c.blobURL;else{var d=l.contentWindow.document;d.documentElement.innerHTML="",d.open(),d.write(c.blob),d.close()}}}}.bind(this))},onAttachmentUpdate:function(e,t,i){(!t||t.indexOf("messages")>=0)&&e.getPlugin().loadThread(e,function(t,i){try{n.PAssert(4227,t,"Must be able to re-load thread data")}catch(e){n.reportError(e)}i&&e===this.threadAttach&&this.ensureDisplayMessages(e)}.bind(this))},getThreadAttach:function(){return this.threadAttach},_setThread:function(e,t){try{n.PAssert(4228,e.hasField("messages"),"Must supply valid messages to the email preview")}catch(e){n.reportError(e)}try{n.PAssert(4229,this.errorMessage.get()||e.getField("dataLoaded"),"Must have loaded remote data or have an error")}catch(e){n.reportError(e)}this.threadAttach&&this.threadAttach.id===e.id||(this.reset(),this.threadAttach=e,this.threadItem=t,e.subscribe(this),this.ensureDisplayMessages(e),e.getPlugin().attachmentHasLabelByID(e,"UNREAD")&&e.getPlugin().performAction(r.PluginAction.Gmail.MarkRead,!0,e),d.fireEvent("EmailPreview","openThreadChanged",[]))},onSelectedIndexChanged:function(e,t,i){if(!s.mobile&&this.isOpen()&&t===this.openOnPane)if(i&&i.hasAttachmentType(r.PluginType.Email)){var n=i.getAttachmentByType(r.PluginType.Email);if(n.getPlugin()===this.getPlugin()){var a=this.getPlugin();a.openEmailByItem(i,t)}}else"PaneGmail"===t.type&&this.reset()},onDisplaySettingsChanged:function(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}},new t}),define("AScript",["require","globals","Constants","util","platform","data","tracker","react-dom","VMLI","edit","Sel","DragDrop","Dispatcher","EmailPreview","Observable","ObservableArray","Measure","DisplaySettings"],function(e){function t(){function e(t){if(t.data&&i.isString(t.data)&&t.data.indexOf("{")<0)for(var r=t.data.split("&"),a=0;a<r.length;a++){var s=r[a].split("=");try{i.PAssert(4230,s.length>=0,"Invalid number of params in message")}catch(e){i.reportError(e)}switch(s[0]){case"script":this.runScript(s[1]);break;case"data":if(this.isRunning)return this.stop(),clearTimeout(this.timeoutMessage),void(this.timeoutMessage=setTimeout(e.bind(this),100,t));this.loadScriptData(s[1]);break;case"start":this.start();break;case"stop":this.stop();break;case"pause":this.pause();break;case"resume":this.resume();break;case"restart":this.restart();break;case"alertDemo":i.menus.alert({text:'Click anywhere to try this <b class="blue">live demo</b>',callback:i.emptyFn});break;case"help":var o=s[1];"1"==o?i.vmMain.showHelp(n.HelpMode.Normal):i.intro.close();break;case"panes":this.loadPanes(s[1])}}}this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.isPaused=!1,this.stoppedFromPause=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.lastLoadedData=void 0,this.savedItems={},this.typingSpeed=30,this._scriptQueue=[],this.startText={},this.demoCaption=new h,i.isDemoMode()&&window.addEventListener("message",e.bind(this),!1),window.pauseScript=function(){this.isDisabled||(log("pause script"),this.isDisabled=!0)}.bind(this)}var i=e("globals"),n=e("Constants"),r=(e("util"),e("platform"),e("data")),a=e("tracker"),s=(e("react-dom"),e("VMLI")),o=(e("edit"),e("Sel")),c=e("DragDrop"),l=e("Dispatcher"),d=e("EmailPreview"),h=e("Observable"),u=(e("ObservableArray"),e("Measure")),p=e("DisplaySettings"),m=function(){this.queue.apply(this,arguments)},f=function(e,t,i,n){if(m("createItemAfter",void 0,t),void 0!==i&&0!==i)for(var r=0;r<Math.abs(i);r++)m("indent",i<0);n?m("setText",void 0,e):m("typeString",void 0,e)},g=function(e){m("delay",e)};return t.prototype={runScript:function(e){if(!this.isDisabled){var t=this.createScript(e);switch(this.activeScript=t,e){case"wait":this.demoEmpty(t);break;case"introEmail":this.demoEmail(t);break;case"introStyle":this.demoStyle(t);break;case"press":this.demoPress(t);break;case"none":return void this.notify("demoReady")}if(t.runQueue.length>0)this._scriptQueue.push(t);else try{i.PAssert(4231,!1,"Invalid script request: ",e)}catch(e){i.reportError(e)}this.repeat=!1,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&this.start()}},start:function(){i.toasts.clearMessage(MessageID.ThisIsDemo),this.onScriptStart(this.activeScript),this.run()},restart:function(){this.activeScript=this._scriptQueue[0],this.activeScript.index=0,this.start()},stop:function(){this._scriptQueue=[],this.isRunning=!1,this.activeScript=void 0,clearTimeout(this.timeoutDelay),this.timeoutDelay=void 0,clearTimeout(this.timeout),this.timeout=void 0,clearTimeout(this.timeoutMessage),this.timeoutMessage=void 0,i.autocomplete.hide(),c.stop(),c.finish()},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1,this.wasResumed=!0,this.stoppedFromPause&&(this.stoppedFromPause=!1,this.run())},demoReady:function(e){this.wasResumed||this.pause(),this.notify("demoReady"),e()},switchDemo:function(e){this.stop(),i.isDemoRunning=!0,selectedDemo=e;var t=this[e]();this.resetData(function(){this._scriptQueue.push(t),this.activeScript=t,this.start()}.bind(this))},loadScriptData:function(e,t){log("Load Script Data: ",e),this._scriptQueue=[],this.repeat=!1,this.lastLoadedData=e,l.fireEvent("resetEverything",[]),i.vmMain.paneManager.clearPanes(!1),i.vmMain.beginUpdateItems(),r.loadDemoData(e,!0,function(e){i.vmMain.changeRoot(e),i.vmMain.commitUpdateItems(),t&&t()})},loadPanes:function(e){i.vmMain.loadDemoPanes(e.split(":"))},onScriptStart:function(e){e&&window.parent.postMessage(e.getName(),"*")},createScript:function(){var e={_nextId:0,owner:this,index:0,_repeat:!1,noDelay:!1,runQueue:[],_activeQueue:function(){return this.runQueue},queue:function(e){var t=Array.prototype.slice.call(arguments,1),i=this.runQueue;return i.push({id:this._nextId++,name:e,args:t}),i},repeat:function(e){this._repeat=e},nextStep:function(){return this.runQueue[this.index++]},getName:function(){return this._name}};return m=m.bind(e),f=f.bind(e),e},run:function(){if(!this.isDisabled&&this.activeScript){if(this.isPaused)return void(this.stoppedFromPause=!0);try{i.PAssert(4233,this.activeScript,"Must have a script active to be running")}catch(e){i.reportError(e)}var e=this.activeScript.nextStep();if(e){var t=e.args;t.push(this.run.bind(this)),this.isRunning=!0,clearTimeout(this.timeout),this.timeout=setTimeout(function(){try{this[e.name].apply(this,t)}catch(e){i.reportError(e),this.onDisable()}}.bind(this),0)}}},onDisable:function(){this.isDisabled=!0},setSelection:function(e,t,n,r,a){try{i.PAssert(4234,e,"Must provide a valid item to select")}catch(e){i.reportError(e)}if(i.isNumber(e)){e=i.vmMain.paneManager.getPaneAtIndex(t).itemAtIndex(e)}e=this.getItemIfString(e);var s=t>=0?i.vmMain.paneManager.getPaneAtIndex(t):i.focusedPane;i.focusedPane&&i.focusedPane.id===s.id||o.focusPane(s),void 0===n||null===n?n=0:n<0&&(n=e.getParsedText().length+n+1),o.selectItem(e,n,n+r),this.hasSelection=!0,this.selectedItem=e,a&&a()},clearSelection:function(e){o.reset(),this.hasSelection=!1,this.selectedItem=void 0,e&&e()},scrollTo:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(e);try{i.PAssert(4235,r,"Must have selected a valid pane")}catch(e){i.reportError(e)}r.setScrollOffset(t),n&&n()},scrollMain:function(e,t,n){i.vmMain.setScrollOffset(e,t),setTimeout(n,t)},setText:function(e,t,i){e=e||this.selectedItem,e.setText(t,!0,ChangeType.Local),i&&i()},appendText:function(e,t,i){e.setText(e.getParsedText()+t,!0),i&&i()},setPriority:function(e,t,i){e=this.getItemIfString(e)||this.selectedItem,e.priority(t,ChangeType.Local),i&&i()},setStarred:function(e,t,i){e=e||this.selectedItem,e.isStarred(t,ChangeType.Local),i&&i()},setComplete:function(e,t,i,n){e=this.getItemIfString(e)||this.selectedItem,e.dateCompleted=i,e.isComplete(t,ChangeType.Local),n&&n()},removeItem:function(e,t){e=this.getItemIfString(e)||this.selectedItem,e.deleteSelf(ChangeType.Local),t()},setStarredEmail:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(e),a=r.itemAtIndex(t);r.toggleStar(a),n()},setPriorityEmail:function(e,t,n,r){var a=i.vmMain.paneManager.getPaneAtIndex(e),s=a.itemAtIndex(t),o=i.vmMain.pluginManager.getPlugin(PluginID.Gmail);s&&o.setAttachmentPriority(s.getAttachmentByPlugin(PluginID.Gmail),n),r()},indent:function(e,t){var n={normCode:KeyCode.Tab,shiftKey:e};i.fireKeyEvent(void 0,n),t&&t()},collapse:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(t);e=this.getItemIfString(e)||this.selectedItem,e.setCollapsed(!0,r),n&&n()},backspace:function(e,t,n,r){function a(){if(this.isTyping=!0,this.activeScript!==c)return void o();l=l.substr(0,n-1)+l.substr(n,l.length-n),n--,e.setText(l,!0,ChangeType.Local),++s>=t&&(o(),r&&r())}try{i.PAssert(4240,r,"typeString should always have a callback")}catch(e){i.reportError(e)}e=this.getItemIfString(e)||this.selectedItem;try{i.PAssert(4241,e,"Must be an item")}catch(e){i.reportError(e)}try{i.PAssert(4242,this.hasSelection,"Must set selection before typing")}catch(e){i.reportError(e)}try{i.PAssert(4243,!this.isTyping,"Must wait until previous typing is finished")}catch(e){i.reportError(e)}var s=0,o=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),c=this.activeScript,l=e.getParsedText();a.apply(this),t>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(a.bind(this),this.typingSpeed))},typeString:function(e,t,n){function r(){if(this.isTyping=!0,this.activeScript!==c)return void s();var r=t.charCodeAt(a);if(r===KeyCode.Delete&&(r=KeyCode.Period),r===KeyCode.End){var l=o.getStartOffset(),d=e.getParsedText(),h=d.substr(0,l)+t.charAt(a)+d.substr(l);e.setText(h,!0,ChangeType.Local),o.selectItem(e,l+1)}else i.fireKeyEvent(void 0,{normCode:r});++a>=t.length&&(s(),n&&n())}try{i.PAssert(4244,n,"typeString should always have a callback")}catch(e){i.reportError(e)}e=this.getItemIfString(e)||this.selectedItem;try{i.PAssert(4245,e,"Must be an item")}catch(e){i.reportError(e)}try{i.PAssert(4246,this.hasSelection,"Must set selection before typing")}catch(e){i.reportError(e)}try{i.PAssert(4247,!this.isTyping,"Must wait until previous typing is finished")}catch(e){i.reportError(e)}try{i.PAssert(4248,void 0!==t,"Must supply a string to be typed")}catch(e){i.reportError(e)}var a=0,s=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),c=this.activeScript;t&&(r.apply(this),t.length>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(r.bind(this),this.typingSpeed)))},typeIntoEmail:function(e,t,n){function r(){if(this.activeScript!==c)return void o();var t=e[s];a.insertCharAtIndex(t,s),++s>=e.length&&(o(),n&&n())}var a=i.reactEmailCompose.refs.body,s=0,o=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),c=this.activeScript;clearInterval(this.intervalTyping),this.intervalTyping=setInterval(r.bind(this),t)},setSearch:function(e,t,n){i.vmMain.paneManager.getPaneAtIndex(t).search.setValue(e),n&&n()},createItemAfter:function(e,t,n){e=e||this.selectedItem,this.setSelection(e,void 0,e.getParsedText().length,0),i.fireKeyEvent(void 0,{normCode:KeyCode.Enter}),requestAnimationFrame(function(){this.clearSelection(function(){var r;r=e.isHeader()?e.getChild(0):e.parent().getChild(e.getIndex()+1);try{i.PAssert(4253,r,"Error getting new item: ",t)}catch(e){i.reportError(e)}t&&(this.savedItems[t]=r),this.selectedItem=r,this.setSelection(r,void 0,-1,0,n)}.bind(this))}.bind(this))},zoomPane:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(e);t=this.getItemIfString(t),r.setItem(t,!0),n&&n()},zoomGmailPane:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(e),a=i.vmMain.pluginManager.getPlugin(PluginID.Gmail),s=a._getLabelByName("me",t);try{i.PAssert(4259,s,"Must be able to get a valid label if clicking a valid label")}catch(e){i.reportError(e)}var o=a.getVMLIForLabel("me",s);r.setItem(o,!0),r.selectIndex(-1),n&&n()},delay:function(e,t){t&&(0===e?t&&t():(this.delayCb=t,clearTimeout(this.timeoutDelay),this.timeoutDelay=setTimeout(function(){this.delayCb=this.timeoutDelay=void 0,t()}.bind(this),e)))},addPane:function(e,t,n,a,s,o){var c={};c.item=n?this.getItemIfString(n):r.getRootModel(),a&&(c.search=a);i.vmMain.paneManager.createPaneAtIndex(e,t,c,s);o()},removePane:function(e,t,n){i.vmMain.paneManager.removePaneAtIndex(e,t),n&&n()},cullPanes:function(e,t){var n=i.vmMain.paneManager.paneCount();n>e?(this.removePane(n-1),setTimeout(this.cullPanes.bind(this,e,t),60)):t()},selectItemInPane:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(e),a=r.itemAtIndex(t);this.selectedItem=a,n()},dragTo:function(e,t,n,r,a,s){function l(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}function d(e){if(I.activeScript!==A)return void i.fireMouseUp(f,ButtonCode.Left);_||(_=e);var t=l((e-_)/a);if(D=P*t+b.left+10,M=T*t+C,t>=1){var n,r=document.getElementById("preventInteraction");r&&(n=r.parentElement,n.removeChild(r))}m.dragMove({eventX:D,eventY:M,diffY:T>b.top?1:-1,preventDefault:i.emptyFn,stopPropagation:i.emptyFn}),r&&n.appendChild(r),t>=1?(m.dragEnd({clientX:D,clientY:M,target:f}),s&&s()):requestAnimationFrame(d)}var h=i.vmMain.paneManager.getPaneAtIndex(e),p=i.vmMain.paneManager.getPaneAtIndex(t),m=h.itemAtIndex(n),f=h.elementAtIndex(n),g=-1===r;g&&(r=p.numItems()-1);var v=p.elementAtIndex(r),y=p.itemAtIndex(r),b=f.getBoundingClientRect(),S=v.getBoundingClientRect(),E=h.dragMarginTop||0,C=b.top+(E||10),P=S.left-b.left,T=S.top-C+(g?u.lineItemHeight(y,1):0);o.focusPane(h);var D,M,_=null,I=this,A=this.activeScript;c.startDragItem=m,m.dragStart({startSrc:f,eventX:b.left+10,eventY:C}),requestAnimationFrame(d)},getItemIfString:function(e){var t;if(i.isString(e)){t=r.getModel(e)||this.savedItems[e];try{i.PAssert(4266,t,"Item was not saved correctly")}catch(e){i.reportError(e)}}else if(e){try{i.PAssert(4267,e instanceof s,"Must supply a valid VMLI: ",i.getObjectInfo(e))}catch(e){i.reportError(e)}t=e}return t},pushMessage:function(e,t){if(this._currentToast)return i.toasts.clearMessage(this._currentToast),this._currentToast=void 0,void setTimeout(this.pushMessage.bind(this),100,e,t);var n;if(n=i.isString(e)?i.toasts.pushMessage({text:e,hold:!0}):i.toasts.pushMessage(e),this._currentToast=n,e===MessageID.ThisIsDemo){var r=function(){i.toasts.clearMessage(n),window.removeEventListener("tapMain",r)};window.addEventListener("tapMain",r)}t&&t()},notify:function(e,t){window.parent.postMessage(e,"*"),t&&t()},demoDone:function(e){o.reset(),this.notify("done"),i.isDemoRunning=!1,i.autocomplete.isEnabled=!0;var t=document.getElementById("preventInteraction");t&&t.parentElement.removeChild(t),e()},addClass:function(e,t){i.addClass(document.documentElement||document.body,e),t&&t()},removeClass:function(e,t){i.removeClass(document.documentElement||document.body,e),t&&t()},switchClass:function(e,t,i){this.removeClass(e),this.addClass(t),i()},selectEmail:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(e);try{i.PAssert(4268,r,"Must have selected a valid pane")}catch(e){i.reportError(e)}o.focusPane(r),r.selectIndex(t),n&&n()},openEmail:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(e);try{i.PAssert(4269,r,"Must have selected a valid pane")}catch(e){i.reportError(e)}r.selectIndex(t);var a=r.itemAtIndex(t);r.openEmailByItem(a),n&&n()},closeEmail:function(e){d.close(),e&&e()},sendEmail:function(e){i.reactEmailCompose.onClickSend(),e()},toggleMessageExpanded:function(e,t){i.reactEmailPreview.toggleExpanded(e),t()},replyToMessage:function(e){d.setLastMessageResponseMode(n.EmailResponseMode.Reply),e()},archiveEmail:function(e,t,n){var r=i.vmMain.paneManager.getPaneAtIndex(e),a=r.itemAtIndex(t);r.archiveItem(!0,a),n()},addEmail:function(e,t){i.vmMain.pluginManager.getPlugin(PluginID.Gmail).refreshThreadCacheData("me",e,void 0,function(){},t)},waitPaneItems:function(e,t){var n=i.vmMain.paneManager.getPaneAtIndex(e);try{i.PAssert(4270,n,"Must have selected a valid pane")}catch(e){i.reportError(e)}if(n.items.length()>0)t();else{var r=function(e){e.length>0&&(n.items.unlisten(r),t())};n.items.listen(r)}},displaySetting:function(e,t){p.changeTheme(e),t()},caption:function(e,t,i){this.demoCaption.set({text:e,opacity:1,center:t,light:e.indexOf("<b>")>=0}),i()},captionFade:function(e){var t=this.demoCaption.get();this.demoCaption.set({text:t.text,opacity:0,center:t.center,light:t.light}),e()},resetData:function(e){if(this.isRunning)return this.stop(),clearTimeout(this.timeoutMessage),void(this.timeoutMessage=setTimeout(this.resetData.bind(this),100,e));this.loadScriptData(r.demoDataId,e)},waitAction:function(e,t){this._waitTracker={check:e,cb:t}},onTrackerAction:function(e){var t=this._waitTracker;t&&t.check(e)&&t.cb()},demoEmail:function(e){return i.isDemoRunning=!0,m("waitPaneItems",0),m("zoomGmailPane",1,"Needs Reply"),m("zoomGmailPane",2,"Starred"),m("removeClass","invisible"),m("demoReady"),g(1e3),m("dragTo",0,1,0,-1,1e3),g(200),m("dragTo",0,1,0,-1,1e3),g(800),m("setStarredEmail",0,1),g(500),m("setStarredEmail",0,3),g(800),m("setPriorityEmail",2,0,VMLIFlag.P0),g(500),m("setPriorityEmail",2,2,VMLIFlag.P2),g(1200),m("selectEmail",0,0),g(200),m("openEmail",0,0),m("pushMessage",MessageID.ThisIsDemo),m("demoDone"),e},demoStyle:function(e){i.isDemoRunning=!0,i.autocomplete.isEnabled=!1,this.collapse("ideas",0),this.collapse("todo",0),this.collapse("testing",0),m("removeClass","invisible"),m("demoReady"),g(500),m("dragTo",0,1,1,1,1e3),g(1e3),m("setSelection","tracking",0,-1,0),m("typeString",void 0," #Android"),g(800),m("typeString",void 0," @tomorrow "),g(800),m("setSelection","tracking",0,0,0),m("typeString",void 0,"+Grant "),g(1500),m("zoomPane",1,"release"),g(1500);for(var t="#Android",n=t.length;n>=0;n--)m("setSearch",t.substr(0,n),2),g(40);g(800),t="+Grant";for(var n=0;n<=t.length;n++)m("setSearch",t.substr(0,n),2),g(40);m("pushMessage",MessageID.ThisIsDemo),m("demoDone")},demoPress:function(e){a.addListener(this.onTrackerAction.bind(this)),m("pushMessage",{text:"Try dragging an email onto the Outline.",hold:!0,big:!0}),m("waitAction",function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&e.data.fromPane&&e.data.fromPane.type===PaneMode.Gmail}),m("pushMessage",{text:"Schedule an item by typing @ then a date.<br><br>Or drag it right onto the Agenda.",hold:!0,big:!0}),m("waitAction",function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate||e.type===TrackerType.Insert&&"@"===e.data[0].text}),m("pushMessage",{text:"Learn more on our homepage.",hold:!0,action:MessageAction.OpenURL,actionText:"https://moo.do",data:{url:"https://www.moo.do"}})},demoEmpty:function(e){i.isDemoRunning=!0,m("demoReady"),m("pushMessage",MessageID.ThisIsDemo),m("demoDone")}},t}),define("VMSetup",["data","Constants","globals","util","platform","goog","AScript","AccountManager"],function(e,t,i,n,r,a,s,o){function c(){this.loginState=i.createObservable(LoginState.NONE,"loginState","VMSetup");var e;e=navigator.onLine?o.canRunAuthenticate()?l.Normal:l.Loading:l.Offline,this.loginStatus=i.createObservable(e,"loginStatus","VMSetup"),this.downloadIcon=this.getDownloadIcon(),this.downloadText="Download "+this.getDownloadText()+" app",this.showDownload=r.mobile&&!r.app||r.canDownloadNativeApp()||r.canDownloadChromeApp(),this.showLogin=!r.mobile||r.app,o.canRunAuthenticate()||window.addEventListener("gapiLoaded",function(){this.loginStatus()===l.Loading&&this.loginStatus(l.Normal)}.bind(this)),this.loginRequested=!1,this.loginRequestTimer=void 0}var l={Normal:"Sign in with Google",Connecting:"Connecting...",LoggingIn:"Logging In...",Loading:"Loading...",Offline:"Offline"};return c.prototype={init:function(){if(i.isDemoMode())return LoginState.LOGGED_OUT;var e=i.getLoginState();return this._pageLoadLoginState=e,this.setLoginState(e),i.applyBindings(this,"setupInner"),window.addEventListener("gapiLoaded",function(){this.loginRequested&&(this.loginStatus(l.Normal),o.hasValidAccessToken("me")?this.userLogin():this.loginRequested=!1)}.bind(this)),window.addEventListener("offline",function(){log("Browser going offline."),i.vmMain.setGDriveStatus(DriveStatus.Offline),this.loginStatus(l.Offline)}.bind(this)),window.addEventListener("online",function(){if(log("Browser going online."),this.loginStatus(l.Normal),this.loginRequested&&(o.hasValidAccessToken("me")?this.userLogin():this.loginRequested=!1),i.getLoginState()==LoginState.LOGGED_IN&&!r.offline){var e=a.ensureDocConnection();log("Coming online. Already online:",e)}}.bind(this)),e},getDownloadIcon:function(){return r.getPlatformIcon()},getDownloadText:function(){return r.getPlatformName()},logoutButtonText:function(){return i.isDemoMode()?"Leave Demo":"LOGOUT"},setLoginState:function(e){e!=this.loginState()&&(i.setLoginState(e),this.loginState(e))},userLogin:function(){o.canRunAuthenticate()&&this.loginStatus()===l.Normal&&this.loginState()!=LoginState.LOGGED_IN?(i.authUserLoggedIn=!0,this.loginStatus(l.LoggingIn),this.loginRequested=!1,a.runAuthenticate(a.requiredScopes,!1,!0,function(e){if(this.loginStatus(l.Normal),e&&!e.error){i.settings.set(Settings.localIntegrity,!0),this.setLoginState(LoginState.LOGGED_IN),i.vmMain.paneManager.setupInitialTimeout();var n=a.loadClientDefaultFile();n!==t.DocLoadSkipReason.None&&this._reportLoginTapSkip("Skipped loading default client file: "+n)
}else this._reportLoginTapSkip("Invalid token returned when calling userLogin")}.bind(this))):(this._reportLoginTapSkip("Still in connecting login state"),this.loginStatus(l.Connecting),this.loginRequested=!0),clearTimeout(this.loginRequestTimer),this.loginRequestTimer=setTimeout(function(){this.loginStatus(navigator.onLine?l.Normal:l.Offline),this.loginRequested=!1}.bind(this),500)},shouldShowLogin:function(){return this.loginStatus()===l.Normal||this.loginStatus()===l.LoggingIn},openLogin:function(){this.loginState(LoginState.NONE)},logout:function(){this.setLoginState(LoginState.LOGGED_OUT),e.clearData(function(){n.storage.clear(),setTimeout(function(){n.hasURLParam("login")?n.removeURLParam("login"):n.hasURLParam("user")?n.removeURLParam("user"):r.app?r.app&&(i.nativeBridge.sendToApp("logout"),r.isFeatureEnabled(t.Feature.OAuth)&&i.reload()):i.reload()},0)})},logoutClicked:function(){if(i.isDemoMode())n.removeURLParam("demo");else{var t=!0;for(var r in e.pendingRemoteUpdates)if(e.pendingRemoteUpdates.hasOwnProperty(r)){i.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",function(e){e&&this.logout()}.bind(this)),t=!1;break}t&&this.logout()}},isLocal:function(){return"localhost"==window.location.hostname},onlineStatusToggle:function(){r.offline?n.removeURLParam("offline"):n.insertURLParam("offline","true")},getPageLoadLoginState:function(){return this._pageLoadLoginState},initDemo:function(){i.AScript||(i.AScript=new s)},runScript:function(e){i.AScript.runScript(e)},onTapDownloadApp:function(){i.openUrl(r.getAppDownloadURL())},onTapLogin:function(e){this.loginStatus()===l.Normal?this.userLogin():this._reportLoginTapSkip("Login Status not LoginStatus.Normal: "+this.loginStatus()),r.mobile&&e&&(e.preventDefault(),e.stopPropagation(),i.preventClick())},onTapLanding:function(e){(r.mobile||i.hasClass(e.target,"link"))&&i.openUrl("https://www.moo.do",e)},onPrivacyPolicy:function(e){(r.mobile||i.hasClass(e.target,"link"))&&i.openUrl("https://www.moo.do/privacy/",e)},onEmailKeydown:function(e,t){return t.normCode!==KeyCode.Enter||(this.onTapLogin(t),t.preventDefault(),t.stopImmediatePropagation(),!1)},_reportLoginTapSkip:function(e){}},c}),define("copypaste",["globals","platform","data","edit","VMLI","tracker","parse","NativeSel","Sel"],function(e,t,i,n,r,a,s,o,c){function l(){}return l.prototype={init:function(){try{e.PAssert(4271,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(t){e.reportError(t)}document.body.addEventListener("paste",this.handlepaste.bind(this),!1),document.body.addEventListener("cut",this.handlecut.bind(this),!1),document.body.addEventListener("copy",this.handlecopy.bind(this),!1)},killEvent:function(t){try{e.PAssert(4272,t.preventDefault,"Should always be defined")}catch(t){e.reportError(t)}try{e.PAssert(4273,t.stopPropagation,"Should always be defined")}catch(t){e.reportError(t)}t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},insertToNote:function(t,i,n){try{e.PAssert(4274,t,"Must have a valid start item")}catch(t){e.reportError(t)}try{e.PAssert(4275,i,"Must have a valid end item")}catch(t){e.reportError(t)}var r=t.getParsedText();a.beginAction();var s;s=i===t?r.substring(0,c.getStartOffset())+n+r.substring(c.getEndOffset()):r.substring(0,c.getStartOffset())+n,t.setText(s,!0,ChangeType.Local),a.endAction()},insert:function(r,o,l){if(!c.isValid()||e.elementInNonPaneEdit(o.target))return!1;var d,h,u,p="",m=t.ie?"Text":"text/plain";if(l===DataSource.Plugin)u={items:[{text:r}]};else if(r&&r.getData){if(a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Paste}),this.killEvent(o),p=t.ie?void 0:r.getData("moodo/html")||r.getData("text/html"),!t.ie&&p){if(!p)return;var f,g=document.createElement("div"),v=p.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/[ ]+/g," ").replace(/onload/gi,"never"),y=/<body(.|\s)*?\/body>/g;if((f=y.exec(v))&&(v=f[0]),g.innerHTML=v,c.isValid()&&c.getStartItem().isNote())this.insertToNote(c.getStartItem(),c.getEndItem(),g.innerText);else{var b=g.children[0];2===g.children.length&&"A"===b.nodeName&&e.isOneNoteLink(b.href)&&(g.innerHTML=b.outerHTML),u=s.traverseDOM({root:g,shouldPrint:!1,stripParents:!0,preserveWhitespace:!t.ie&&r.getData("moodo/html")}),1===u.items.length&&""===u.items[0].text&&(u=u.items[0])}}else if(p=r.getData(m)){var S,E=p.startsWith("<?xml "),C=p.startsWith("<?opml ")||p.startsWith("<opml ")||E&&p.indexOf("<opml ")>=0;if((E||C)&&(S=e.loadXML(p)),S){if(E&&!C)return e.toasts.pushMessage({text:"We currently do not support pasting XML, please contact support@moo.do.",action:MessageAction.Contact,hold:!0}),!1;if(C)return s.parseOPML(S,"OPML Import"),!1}else{if(p.startsWith("{")&&p.endsWith("}"))try{var P=JSON.parse(p),T=s.parseJSON(P,c.getStartItem().parent());if(T)return!1}catch(e){}var D=e.parseEvernoteLink(p),M=e.isBearLink(p);if(D||M){var _=c.save(),I="Enter title of "+(D&&"Evernote"||M&&"Bear")+" document";return void e.menus.prompt(I,function(e){e&&(p="["+e+"]("+p+")"),c.restore(_),this.insert(p,o,DataSource.Plugin)}.bind(this))}var v=p.replace(/[\t]/g,"    ");if(c.getStartItem().isNote())this.insertToNote(c.getStartItem(),c.getEndItem(),v);else{var A=v.split("\n");u=s.parseText(A)}}}else{if(r&&r.items&&r.items.length>0)return e.vmMain.pluginManager.handleDropEvent(o,function(e){a.beginAction();var t=c.getStartItem(),n=t.parent(),r=i.createVMLI({text:e},{parent:n,changeType:ChangeType.AllLocal});n.insertItem(r,t.getIndex()+1),a.endAction()}),!1;try{e.PAssert(4276,!1,"Paste with unexpected data type",r.types)}catch(t){e.reportError(t)}}if(!u||!u.items||0===u.items.length)return!1}if(u){a.beginAction(),e.vmMain.beginUpdateItems();var w=!0,k=c.getStartItem(),x=c.getEndItem(),R=c.getStartItem().parent(),O=c.getStartItem().getIndex(),L=c.getStartItem().getParsedText(),N=c.getEndItem().getParsedText();if(k!==x&&(x.isNote()&&(x=x.parent()),k!==x&&n.handleMultiselect({normCode:KeyCode.BackSpace,preventDefault:e.emptyFn,stopPropagation:e.emptyFn,stopImmediatePropagation:e.emptyFn})),d=k,1!==u.items.length||u.items[0].items)if(e.focusedPane.type===PaneMode.Timeline)e.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),w=!1;else{ShouldLog(LogLevels.Timing)&&console.time("paste");var F=[],B=!k.hasChildren()&&c.getStartOffset()>=0&&c.getEndOffset()<=N.length;!B&&c.getStartOffset()>0&&O++;for(var U=0;u&&U<u.items.length;++U){var H=u.items[U];if(""!==H.text||H.items)if(0===U&&B){if(H.text=L.substring(0,c.getStartOffset())+H.text,k.setText(H.text,!0,ChangeType.Local),a.performAction(TrackerType.Insert,{itemID:k.id,position:0,text:H.text}),O++,H.items){for(var V=0;V<H.items.length;++V){var q=H.items[V];if(""!==q.text||q.items){var W=i.createVMLI(q,{parent:k,changeType:ChangeType.AllLocal});k.insertItem(W),d=W}}F.indexOf(k)<0&&F.push(k)}}else{var W=i.createVMLI(H,{parent:R,changeType:ChangeType.AllLocal});if(R.insertItem(W,O++,!0),H._note){var z=i.createVMLI({text:H.text,isNote:!0},{parent:W,changeType:ChangeType.AllLocal});W.setNote(z,ChangeType.Local)}d=W,F.indexOf(R)<0&&F.push(R),a.performAction(TrackerType.Create,{itemID:W.id,parent:R.id,position:O-1,text:W.getParsedText()})}}for(;d.hasChildren();)d=d.getLastChild();h=d.getParsedText().length,B&&d.setText(d.getParsedText()+N.substring(c.getEndOffset()),!0,ChangeType.Local)}else{var G=u.items[0].text,j=L.substring(0,c.getStartOffset())+G+N.substring(c.getEndOffset());a.performAction(TrackerType.Remove,{itemID:k.id,position:0,text:k.getParsedText()}),k.setText(j,!0,ChangeType.Local),a.performAction(TrackerType.Insert,{itemID:k.id,position:0,text:j}),h=c.getStartOffset()+G.length}e.vmMain.commitUpdateItems(),a.endAction(),ShouldLog(LogLevels.Timing)&&console.timeEnd("paste")}return w&&d&&(c.selectItem(d,h),e.focusedPane.scrollItemIntoView(d,ScrollDuration.Snap)),!1},handlepaste:function(e){var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;return this.insert(t,e,DataSource.Paste)},handlecut:function(t){return!!this.handlecopy(t)||(n.keydown(void 0,{normCode:KeyCode.BackSpace,preventDefault:e.emptyFn,stopPropagation:e.emptyFn,stopImmediatePropagation:e.emptyFn}),!1)},padText:function(e,t){for(var i=0;i<t;++i)e="    "+e;return e},printLI:function(e,t,i){var n,r=e.getParsedText(),a=e.getPrefix();if(t=t||0,r=isNaN(i)?r.substring(t):r.substr(t,i-t),t>a.length&&(r=a+r),e.hasAttachments()){var s=0;if(!isNaN(t)&&t>0)for(var o=e.getParsedText(),c=0;c<t;++c)o[c]===window.AttachChar&&s++;n=e.generateExportText(r,s)}else n=r;var l=[],d=e.priority();d&&(d===VMLIFlag.P0?l.push("high"):d===VMLIFlag.P1?l.push("medium"):d===VMLIFlag.P2&&l.push("low")),e.isComplete()&&l.push("complete"),e.isStarred()&&l.push("starred");var h=a.length?r.substr(a.length):r;return{html:"<li"+(l.length>0?' class="'+l.join(" ")+'"':"")+">"+h+"</li>",plain:h,moodo:"<li"+(l.length>0?' class="'+l.join(" ")+'"':"")+">"+n+"</li>"}},handlecopy:function(i){var n=e.focusedPane,s=t.ie?"Text":"text/plain",o=i&&i.clipboardData?i.clipboardData:window.clipboardData;if(o){var l=e.findParent(i.target,"exportedArea",10);if(!t.mobile&&l)return!0;if(!c.isValid())return!0;if(!c.getPane().overrideCopyBehavior)return!0;var d=c.getStartItem(),h=c.getStartIndex(),u=c.getEndItem(),p=c.getEndIndex();try{e.PAssert(4277,d&&u,"Must have valid item selections")}catch(t){e.reportError(t)}try{e.PAssert(4278,d instanceof r&&u instanceof r,"Items must be valid VMLIs")}catch(t){e.reportError(t)}var m,f,g,v,y=!t.ie;if(d===u)v=c.getStartOffset()===c.getEndOffset()?this.printLI(d):this.printLI(d,c.getStartOffset(),c.getEndOffset()),m=v.html,f=v.plain,g=v.moodo;else{v=this.printLI(d,c.getStartOffset());var b=1;m="<ul>"+v.html,f=v.plain,g="<ul>"+v.moodo;do{var S=d;if(h=n.indexOfNextVMLI(h),d=n.itemAtIndex(h)){if(n.type!==PaneMode.Timeline){var E=d.levelsDeep.get()-S.levelsDeep.get();E>0&&(m+="<ul>",g+="<ul>",b++);for(var C=0;C<-E;C++)m+="</ul>",g+="</ul>",b--;b<=0&&(m+="<ul>",g+="<ul>",b++)}h!==p?(v=this.printLI(d),f+="\r\n"+this.padText(v.plain,b-1),m+=v.html,g+=v.moodo):(v=this.printLI(d,0,c.getEndOffset()),f+="\r\n"+this.padText(v.plain,b-1),m+=v.html+"</ul>",g+=v.moodo+"</ul>",b--)}}while(h!==p);for(;b>0;)m+="</ul>",g+="</ul>",b--}y&&m&&o.setData("text/html",m),y&&g&&o.setData("moodo/html",g),o.setData(s,f)}return t.ios||this.killEvent(i),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Copy}),!1}},new l}),define("InfiniteListCell",["require","Observable","Trigger"],function(e){function t(){this.isLive=!1,this.wasLive=!1,this.seenInPass=!1,this.deadNeedsNotify=!1,this.index=-1,this.width=0,this.height=0,this.offset=0,this.paneObject=void 0,this.cellChanged=new n,this.offsetX=new i(0),this.isAnimatingOffsetX=!1}var i=e("Observable"),n=e("Trigger");return t.prototype={kill:function(e){this.isLive=!1,this.index=-1,this.isAnimatingOffsetX=!1,e?(this.deadNeedsNotify=!1,this.cellChanged.notify()):this.deadNeedsNotify=!0},update:function(e,t,i,n,r,a){this.seenInPass=!0,this.wasLive=this.isLive,this.deadNeedsNotify=!1,this.isAnimatingOffsetX=!1,this.isLive&&e===this.index&&t===this.width&&i===this.height&&n===this.offset&&a===this.paneObject||(this.isLive=!0,this.index=e,this.width=t,this.height=i,this.paneObject=a,this.offset=n,this.prevOffset=r,this.cellChanged.notify())},getState:function(){return{item:this.paneObject&&this.paneObject.id,index:this.index,height:this.height,offset:this.offset,prevOffset:this.prevOffset,deadNeedsNotify:this.deadNeedsNotify,isLive:this.isLive}}},t}),define("InfiniteList",["globals","Constants","util","platform","Observable","ObservableArray","Sel","DragDrop","react","Dispatcher","NativeSel","InfiniteListCell","react-dom","DisplaySettings","EventDispatcher"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m){function f(e){this._pane=e.pane,this._isOverview=e.isOverview,this._itemsObs=e.itemsObs,this._getItemsList=e.itemsFn,this.getHeight=e.heightFn,this.getWidth=e.widthFn,this.itemsAreObjects=e.itemsAreObjects,this.minItemSize=e.minItemSize,this.hasSetHeightOnce=!1,this.scrollHandler=void 0,this._mobilePadBottom=!1,this.contentSize=new r(0),this.paddingBottom=new r(0),this._timeoutPointerEvents=void 0,this.disablePointerEvents=new r(!1),this._direction=Direction.None,this._scrollTop=0,this._lastProcessedScrollTop=0,this._itemInfoById={},this._savedScrollOfTop={},this._indexOfTop=0,this._inViewCount=0,this._reactList=void 0,this._isMounted=!1,this._panePadding=0,this.useCustomScroller=n.useCustomScroller,this.cellsObs=new a([]),this.cells=this.cellsObs.get(),this.cellsNew=[],this._tops=[],this.scrollListeners=[],this.offscreenScrollPadding=400,this._phase=g.None,this.init()}var g={None:0,OnScroll:1};return f.prototype={init:function(){i.forceBind("_onListChanged",this),i.forceBind("_onSettingChanged",this),i.forceBind("_onResize",this),i.forceBind("_onScroll",this),i.forceBind("_handleScroll",this),i.forceBind("handleItemTextChanged",this),i.forceBind("handleItemBoldChanged",this),i.forceBind("handleItemNoteSet",this),i.forceBind("_onTimeoutPointerEvents",this),i.forceBind("_computeRenderItemsBatched",this),i.forceBind("_onSetScrollComplete",this),i.forceBind("_onSetScrollCompleteTimeout",this),i.forceBind("_afterSetScrollComplete",this),i.forceBind("reMount",this)},getID:function(){return this._pane.id+(this._isOverview?"_o":"")},notifyInit:function(t){try{e.PAssert(4279,!this._isMounted,"Should not initialize a pane twice")}catch(t){e.reportError(t)}this.clearCache(),this.allocateCells(),this._onListChanged(),this._isMounted=!0,this._reactList=t,this._listenToItemsList(this._onListChanged),this._pane.rect.listen(this._onResize),this._pane.topBoxHeight.listen(this._onListChanged),e.settings.listen("settingChanged",Settings.UISettingsGroup,this._onSettingChanged)},notifyUnmounted:function(){i.destroy(this),this._isMounted=!1,this.isDelayingMounts=!1,this._unlistenToItemsList(this._onListChanged),this._pane.rect.unlisten(this._onResize),this._pane.topBoxHeight.unlisten(this._onListChanged),e.settings.unlisten("settingChanged",Settings.UISettingsGroup,this._onSettingChanged),clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this.removeNativeScrollListener(this._onScroll),this._reactList=void 0,this.useCustomScroller&&(this.iScroller.destroy(),this.iScroller=void 0),e.clearTimeoutOnce("afterScroll"+this.getID()),e.clearTimeoutOnce("listSettingChanged_"+this.getID()),n.mobile||this._isOverview||(this._pane=void 0)},allocateCells:function(){var e=p,t=this.cells.length,i=Math.ceil((n.windowHeight()+2*this.offscreenScrollPadding)/this.minItemSize())+4;if(i>t){log("Allocating cells",i,t,n.windowHeight(),e.itemLineHeight(),e.itemPadding(),this._isOverview);for(var r=this.cells,a=t;a<i;a++){var s=new h;r.push(s)}this.cellsObs.set(r),this.cells=this.cellsObs.get()}},setupScroller:function(e,t){this.scrollElement=e,this.useCustomScroller&&this.setupCustomScroller(e,t),this.addNativeScrollListener(this._onScroll),this.useCustomScroller&&setTimeout(this.refreshScrollListener.bind(this))},setupCustomScroller:function(t,i){var r;this.iScroller=e.createCustomScroller(t),this.iScroller.on("scrollStart",function(){n.ios&&(r=e.isKeyboardOpen?d.getSelectionRange(!0):null,e.addClass(i,"preventSelect"))}.bind(this)),this.iScroller.on("scrollEnd",function(){this._onSetScrollComplete(),n.ios&&(!r&&e.isKeyboardOpen&&(r=d.getSelectionRange(!0)),setTimeout(function(){e.removeClass(i,"preventSelect"),r&&(d.setSelectionRange(r),r=null)},0))}.bind(this))},clearItemInfoForItem:function(e){var t=this._itemInfoById;if(this.itemsAreObjects)for(var i in t)t.hasOwnProperty(i)&&t[i].paneObject.item===e&&(t[i].needsUpdate=!0);else t[e.id]&&(t[e.id].needsUpdate=!0)},handleItemNoteSet:function(e){this.clearItemInfoForItem(e.item)},handleItemBoldChanged:function(t){try{e.PAssert(4280,!this._isOverview,"Overviews should never listen to bold changes")}catch(t){e.reportError(t)}var i=t.item;this.clearItemInfoForItem(i)},handleItemTextChanged:function(t){try{e.PAssert(4281,!this._isOverview,"Overviews should never listen to text changes")}catch(t){e.reportError(t)}if(this._pane.shouldUpdateOnTextChanged&&(!n.android||!e.isKeyboardOpen)){var i=this._pane,r=t.item;if(i.isItemInPane(r)){var a=this.indexOfItem(r),s=r.metricsInPane(i,a);this._itemInfoById[r.id]&&s.height===this._itemInfoById[r.id].size?window.__TEXT_CHANGED_UPDATES.NoUpdate++:(this.clearItemInfoForItem(r),i.updateItems(!1,!0),window.__TEXT_CHANGED_UPDATES.CausedUpdate++)}else this.clearItemInfoForItem(r),window.__TEXT_CHANGED_UPDATES.PaneSkipped++}},getElementAtIndex:function(e){return this._reactList.getElementAtIndex(e)},isIndexMounted:function(e){return this._reactList.isIndexMounted(e)},hasItems:function(){return this._getItemsList().length>0},numItems:function(){return this._getItemsList().length},indexOfTop:function(){return this._indexOfTop},inViewCount:function(){return this._inViewCount},objectAtTop:function(){var t=this._getItemsList(),i=this.indexOfTop(),n=i>=0&&i<t.length;try{e.PAssert(4282,n,"Item at top is not in range",i,t.length)}catch(t){e.reportError(t)}return t[i]},itemAtTop:function(){var t=this.objectAtTop();return t&&(e.isVMLI(t)?t:t.item)},indexPageUp:function(e){for(var t=this.size.height,i=0,n=e-1;n>=0;--n){if((i+=this._sizes[n])>t)return n+1}return 0},indexPageDown:function(e){for(var t=this.size.height,i=0,n=this._sizes.length,r=e;r<n;++r){if((i+=this._sizes[r])>t)return r}return Math.max(n-1,0)},_listenToItemsList:function(e){this._itemsObs.listen(e)},_unlistenToItemsList:function(e){this._itemsObs.unlisten(e)},objectAtIndex:function(t){var i=this._getItemsList();try{e.PAssert(4283,t>=0&&t<i.length,"Invalid item index: "+t,i.length,this._pane.type)}catch(t){e.reportError(t)}return i[t]},itemAtIndex:function(t){var i=this._getItemsList();try{e.PAssert(4284,t>=0&&t<i.length,"Invalid item index: "+t,i.length,this._pane.type)}catch(t){e.reportError(t)}var n=i[t];return n&&(e.isVMLI(n)?n:n.item)},sizeAtIndex:function(e){return this._pane.sizeAtIndex(e,this._isOverview)},addPadding:function(){this.useCustomScroller?(this._panePadding=n.windowHeight()-2*e.topBarHeight,this.refreshScrollListener()):(this._mobilePadBottom=!0,this._computeContentSize(!0))},removePadding:function(){if(this.useCustomScroller){var e=this.iScroller;this._panePadding=0,this.refreshScrollListener(),e&&e.y<e.maxScroll&&this.iScroller.scrollTo(0,e.maxScroll,200)}else this._mobilePadBottom=!1,this._computeContentSize(!0)},addNativeScrollListener:function(e){this.useCustomScroller?this.iScroller.on("scroll",e):n.addPassiveListener(this.scrollElement,"scroll",e)},removeNativeScrollListener:function(e){this.useCustomScroller?this.iScroller.off("scroll",e):this.scrollElement&&this.scrollElement.removeEventListener("scroll",e)},addScrollListener:function(e){this.scrollListeners.push(e)},removeScrollListener:function(t){try{e.PAssert(4285,this.scrollListeners.indexOf(t)>=0,"Removing a listener that does not exist")}catch(t){e.reportError(t)}this.scrollListeners.remove(t)},refreshScrollListener:function(){if(this.useCustomScroller&&this.iScroller){var e=this.contentSize.get();this.iScroller.manualRefresh(e+this._panePadding)}},getScrollOffset:function(){if(this._isMounted){if(this.useCustomScroller){var e=this._pane.orientation.get()===t.Orientation.Vertical?"y":"x";return this.iScroller?-this.iScroller[e]:0}if(this.scrollElement){var e=this._pane.orientation.get()===t.Orientation.Vertical?"scrollTop":"scrollLeft";return this.scrollElement[e]}return 0}return 0},getScrollSize:function(){return Math.max(this.contentSize.get()+(n.mobile||e.noPanePadding?0:200),0)},getMaxScrollOffset:function(){var e=this._pane.orientation.get()===t.Orientation.Vertical?this.getHeight():this.getWidth();return Math.max(this.getScrollSize()-e,0)},setScrollOffset:function(i,r,a){try{e.PAssert(4286,this.scrollElement,"Pane must have loaded a scrollable element")}catch(t){e.reportError(t)}try{e.PAssert(4287,e.isNumber(i),"Must supply a valid scroll offset")}catch(t){e.reportError(t)}if(this.scrollElement&&this._pane){r=r||ScrollDuration.Snap;var s=this.getScrollOffset(),o=this.getMaxScrollOffset();if(n.mobile&&(o+=n.getKBSize()+t.KeyboardToolbarHeight),i<0?i=0:n.mobile&&i>o&&(i=o),this._isMounted&&this._scrollingTo!==i){this._scrollingTo=r?i:void 0,this._isSettingScroll=!0;var c,l,d=this._pane.orientation.get()===t.Orientation.Vertical;this.useCustomScroller?(c=d?0:-i,l=d?-i:0,this.iScroller.scrollTo(c,l,r),r||this.iScroller._execEvent("scroll"),a&&(r?setTimeout(a,r):a())):(c=d?void 0:i,l=d?i:void 0,e.scrollTo(c,l,r,this.scrollElement,function(){this._onSetScrollComplete(),a&&a()}.bind(this)))}else a&&(a(),e.timeoutOnce("setScrollComplete_"+this.getID(),this._onSetScrollComplete,0));return i-s}},_onSetScrollComplete:function(){this._restoringScroll?this._afterSetScrollComplete():e.timeoutOnce("scrollCompleteTimeout_"+this.getID(),this._onSetScrollCompleteTimeout,60)},_onSetScrollCompleteTimeout:function(){this._isMounted&&this.saveScrollOfTop(!0),this._afterSetScrollComplete()},_afterSetScrollComplete:function(){this._scrollingTo=void 0,this._isSettingScroll=!1},_computeContentSize:function(t){var i=this.getPaddingTop(),r=i;this._sizes=[],this._tops=[];for(var a=this._getItemsList(),s=this._pane.getItem().levelsDeep.get(),o=0;o<a.length;++o){var c,l=a[o],d=e.isVMLI(l),h=this._itemInfoById[l.id],u=d&&l.levelsDeep.get()-s;!h||h.needsUpdate||d&&h.levelsDeep!==u?(c=this.sizeAtIndex(o),h=this._itemInfoById[l.id]={size:c,levelsDeep:u,paneObject:l,needsUpdate:!0}):c=h.size,this._sizes[o]=c,this._tops[o]=o>0?this._tops[o-1]+this._sizes[o-1]:i,h.previousTop=h.top,h.top=this._tops[o],r+=h.size}if(n.mobile){var p=2*this.minItemSize();this._mobilePadBottom&&(p+=n.getKBSize()),this.paddingBottom.set(p)}return this.contentSize.set(r,t),this.useCustomScroller&&this.refreshScrollListener(),r},flushTimeoutPointerEvents:function(){this._timeoutPointerEvents&&(clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this._onTimeoutPointerEvents())},_onTimeoutPointerEvents:function(){this._pane.isDestroyed()||(this.disablePointerEvents.set(!1),this.killAllDeadCells(),this._isSettingScroll||this._wasSettingScroll||this.saveScrollOfTop(),this._scrollingTo=void 0,this._wasSettingScroll=!1)},reMount:function(){this.isDelayingMounts=!1,this.fireEvent("reMount",[])},_onScroll:function(t){if(!t||!e.findParent(t.target,"preventScrollPropagate")){this._restoringScroll&&!this._isSettingScroll||(this._prevScrollTop=this._scrollTop,this._scrollTop=this.getScrollOffset(),this._handleScroll());for(var i=0;i<this.scrollListeners.length;i++)this.scrollListeners[i](t)}},_handleScroll:function(){if(this._phase=g.OnScroll,n.mobile&&n.useCustomScroller||s.isMouseDown()||(this._prevScrollTop!==this._scrollTop&&this.disablePointerEvents.set(!0),this._timeoutPointerEvents&&clearTimeout(this._timeoutPointerEvents),this._wasSettingScroll=this._isSettingScroll,this._timeoutPointerEvents=setTimeout(this._onTimeoutPointerEvents,50),0===this._scrollTop&&0!==this._prevScrollTop&&this.saveScrollOfTop()),s.isMouseDown()||(this.isDelayingMounts=!0,e.timeoutOnce("afterScroll"+this.getID(),this.reMount,150)),n.mobile||e.tooltip.hideTip(),s.hoveredItem&&s.setHovered(this,null,null),this._scrollTop!==this._prevScrollTop){this._direction=this._scrollTop>this._prevScrollTop?Direction.Down:Direction.Up;if(Math.abs(this._scrollTop-this._lastProcessedScrollTop)>=this.offscreenScrollPadding/2){this._lastProcessedScrollTop=this._scrollTop;this._computeRenderItems()}else this.updateTopIndex()}this.scrollHandler&&this.scrollHandler(this._scrollTop),this._phase=g.None},_updateSize:function(){this.size={width:this._pane.getWidth(),height:this._pane.getHeight()}},_onListChanged:function(){if(this._needsResize)return this._needsResize=!1,void this._onResize(void 0,void 0,!0);this.rect=this._pane.rect.get(),this._updateSize(),this.killAllDeadCells(),this._computeContentSize(!1),this._computeRenderItems(this._isMounted)},_onSettingChanged:function(t){this._needsResize=!0,e.timeoutOnce("listSettingChanged_"+this.getID(),this._onResize,0,void 0,void 0,!0)},_onResize:function(i,n,r){e.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._needsResize=!1;var a=this.rect?this.rect.width:-1,o=this.rect?this.rect.height:-1;r||i&&(i.width!==a||i.height!==o)?(this._updateSize(),this.clearCache(),this.allocateCells(),e.vmMain.setItemAnimationMode(t.ItemAnimationMode.None),this._onListChanged(),e.vmMain.resetItemAnimationMode(),s.getPane()===this._pane&&s.updateCaret()):this._updateSize()},saveScrollOfTop:function(e){this._savedScrollOfTop;if(this.numItems()>0){for(var t,i,n=[],r=this.numItems(),a=e?this.getScrollOffset():this._scrollTop,s=this._indexOfTop;s<Math.min(this._indexOfTop+this._inViewCount-1,r);s++){t=this.objectAtIndex(s),i=a-this.topOfIndex(s);i-this._sizes[s]<-this.getPaddingTop()&&n.push({index:s,paneObject:t,scrollOffset:i})}this._savedScrollOfTop.inView=n}},restoreScrollOfTop:function(){var e=this._savedScrollOfTop;if(!this._pane.isIgnoringRestoreScroll()&&this._pane._didInitialScroll){if(e){var t=e.inView;if(t)for(var i=0;i<t.length;i++){var n=t[i];if(this.restoreScroll(n))break}}this._restoringScroll||this.setScrollOffset(0,ScrollDuration.Snap),this._restoringScroll=!1}},restoreScroll:function(t){var i=this.indexOfItem(t.paneObject);if(i>=0){var n=Math.max(this.topOfIndex(i)+(t.scrollOffset||0),0),r=this.getMaxScrollOffset();return n>r&&(n=r),this._restoringScroll=!0,this._scrollTop=n,this.setScrollOffset(n,ScrollDuration.Snap),e.animFrameOnce("restoreScroll_"+this.getID(),function(){this.setScrollOffset(n,ScrollDuration.Snap)}.bind(this)),!0}return!1},clearCache:function(){this._itemInfoById={};for(var e=0;e<this.cells.length;e++){var t=this.cells[e];t.isLive&&(t.width=t.height=void 0)}},_isInBounds:function(e,t){var i=!1;return e>this._getPVRBottom()+this.offscreenScrollPadding||t<this._getPVRTop()-this.offscreenScrollPadding||(i=!0),i},getScrollTop:function(){return this._scrollTop},_getPVRTop:function(){return this._scrollTop},_getPVRBottom:function(){return this._scrollTop+(this._pane.orientation.get()===t.Orientation.Vertical?this.size.height:this.size.width)},killAllDeadCells:function(){for(var e=0;e<this.cells.length;e++){var t=this.cells[e];!t.isLive&&t.deadNeedsNotify&&t.kill(!0)}},_startCellPassOnCell:function(e){e.seenInPass=!1},startCellPass:function(){this.cellsCurrent={};for(var e=0;e<this.cells.length;e++){var t=this.cells[e];t.isLive&&(this.cellsCurrent[t.paneObject.id]=t,this._startCellPassOnCell(t))}},_pruneCellPassOnCell:function(e,t){if(!e.seenInPass||t){var i,n=e.index;(this._phase!==g.OnScroll||this._isInBounds(this._tops[n],this._tops[n]+this._sizes[n]))&&(i=!0),e.kill(i)}},pruneCellPass:function(){for(var e=0;e<this.cells.length;e++){var t=this.cells[e];t.isLive&&this._pruneCellPassOnCell(t)}},updateCell:function(e){var i=this._pane,n=this._getItemsList()[e],r=n.id,a=this.cellsCurrent[r],s=this._isOverview||this._pane.orientation.get()===t.Orientation.Vertical,o=this._sizes[e],c=s?i.getContentWidth():o,l=s?o:i.getContentHeight(),d=this._tops[e],h=this._itemInfoById[r],u=h&&h.previousTop;a&&!a.seenInPass?a.update(e,c,l,d,u,n):!a&&this.cellsNew.indexOfWithProperty("index",e)<0&&this.cellsNew.push({index:e,width:c,height:l,offset:d,paneObject:n,prevOffset:u})},_addPassOnCell:function(t){for(var i,r=0;r<this.cells.length;r++)if(!this.cells[r].isLive){i=this.cells[r];break}try{e.PAssert(4288,i,"Must always have additional cells to use",n.windowHeight())}catch(t){e.reportError(t)}i||(i=new h,this.cells.push(i)),i.update(t.index,t.width,t.height,t.offset,t.prevOffset,t.paneObject)},addCellPass:function(){for(var e=0;e<this.cellsNew.length;e++){var t=this.cellsNew[e];this._addPassOnCell(t)}this.cellsNew=[]},_isIndexSeen:function(e){var t=this._getItemsList()[e],i=t.id,n=this.cellsCurrent[i];return n&&n.seenInPass},_computeRenderItems:function(t){e.batchRenderUpdates(this._computeRenderItemsBatched,t)},_computeRenderItemsBatched:function(t){var i,r,a,c=this._getItemsList(),l=0;this.startCellPass(),t&&this.restoreScrollOfTop();for(var d=0;d<c.length;++d)if(i=this._tops[d],r=this._sizes[d],this._isInBounds(i,i+r))isNaN(a)&&i+r>this._getPVRTop()&&(a=d),this.updateCell(d),!isNaN(a)&&i<this._getPVRBottom()&&l++;else if(i>this._getPVRBottom())break;isNaN(a)&&(a=0),this._indexOfTop=a,this._inViewCount=l;var h;s.isValid()&&(!n.mobile||n.mobile&&e.isKeyboardOpen)&&this._pane===s.getPane()&&(h=s.getStartIndex())<this._sizes.length&&!this._isIndexSeen(h)&&this.updateCell(h),n.mobile&&o.isDragging&&(h=this._pane.indexOfItem(o.dragItem))>=0&&!this._isIndexSeen(h)&&this.updateCell(h),this.pruneCellPass(),this.addCellPass(),this._isSettingScroll||this._phase===g.OnScroll||this.saveScrollOfTop()},updateTopIndex:function(){for(var e,t,i=this._getItemsList(),n=0;n<i.length;++n)if(e=this._tops[n],t=this._sizes[n],this._isInBounds(e,e+t)&&e+t>this._getPVRTop()){this._indexOfTop=n;break}},getItemInfo:function(e){return this._itemInfoById[e]},getItemInfosForItem:function(e){var t=this._itemInfoById,i=[];if(this.itemsAreObjects)for(var n in this._itemInfoById)t.hasOwnProperty(n)&&t[n].paneObject.item===e&&i.push(t[n]);else t[e.id]&&i.push(t[e.id]);return i},indexOfItem:function(t){var i=e.isVMLI(t),n=this._getItemsList();if(this.itemsAreObjects){for(var r=0;r<n.length;r++)if(i){if(n[r].item===t&&(!n[r].type||"agendaItem"===n[r].type))return r}else if(n[r].id===t.id)return r;return-1}return n.indexOf(t)},topOfItem:function(t){try{e.PAssert(4289,t,"Must provide a valid item to measure")}catch(t){e.reportError(t)}var i=this.indexOfItem(t);try{e.PAssert(4290,i>=0,"Must supply a valid item that is in this pane")}catch(t){e.reportError(t)}return this.topOfIndex(i)},topOfIndex:function(t){try{e.PAssert(4291,t>=0,"Must supply a valid index")}catch(t){e.reportError(t)}return this._tops[t]},scrollIndexToTop:function(e,t,i){var n=this.topOfIndex(e);return this.setScrollOffset(n,t,i)},scrollItemToTop:function(t,i,n){try{e.PAssert(4292,e.isVMLI(t),"Must be a valid VMLI instance")}catch(t){e.reportError(t)}try{e.PAssert(4293,e.isNumber(i),"Must have a valid scroll duration")}catch(t){e.reportError(t)}var r=this.indexOfItem(t);try{e.PAssert(4294,r>=0,"Must supply a valid item that is in this pane")}catch(t){e.reportError(t)}return this.scrollIndexToTop(r,i,n)},scrollIndexToMiddle:function(e,t,i){if(this._isMounted){var n=this.topOfIndex(e),r=this._sizes[e],a=Math.floor(n+r/2-this.getHeight()/2);return this.setScrollOffset(a,t,i)}i&&i()},scrollItemToMiddle:function(e,t,i){if(this._isMounted){var n=this.indexOfItem(e);return this.scrollIndexToMiddle(n,t,i)}i&&i()},scrollItemIntoView:function(e,t,i){if(this._isMounted){var n=this.indexOfItem(e);return this.scrollIndexIntoView(n,t,i)}i&&i()},scrollIndexIntoView:function(i,r,a){try{e.PAssert(4295,e.isNumber(i),"Must supply a valid index")}catch(t){e.reportError(t)}try{e.PAssert(4296,e.isNumber(r),"Must supply a valid scroll duration")}catch(t){e.reportError(t)}try{e.PAssert(4297,!a||e.isFunction(a),"Must supply a valid callback function")}catch(t){e.reportError(t)}var s=this.itemAtIndex(i);try{e.PAssert(4298,s,"Item does not exist to scroll to",i,this.numItems())}catch(t){e.reportError(t)}if(this._isMounted&&s){var o,c=n.getKBSize(),l=this.topOfIndex(i),d=this.getHeight();n.mobile?o=d-c-t.KeyboardToolbarHeight:(o=d,e.vmMain.paneManager.hasScrollbar()&&(o-=t.HorizScrollbarHeight));var h,u;n.mobile?(h=this.getScrollOffset(),u=h+o):(h=this.getScrollOffset(),u=h+d);var p=this._sizes[i],m=l,f=m+p,g=f>u,v=m<h;v&&p>o&&f>=u&&(v=!1);var y,b=0;return v?y=0===l?0:m:g&&(y=f-o),v||g?(b=y-h,this.setScrollOffset(y,r,function(){a&&setTimeout(a,0)})):a&&a(),b}return!1},getPaddingTop:function(){return this._isOverview?n.mobile?8:0:this._pane.topBoxHeight.get()+(n.mobile?e.topBarHeight:0)},notifyDragStart:function(){
this.useCustomScroller&&this.iScroller.disable()},notifyDragEnd:function(){this.useCustomScroller&&this.iScroller&&this.iScroller.enable()},notifySwappedIn:function(e){isNaN(e)||this.setScrollOffset(e)},addScrollDelta:function(t){try{e.PAssert(4299,this.scrollElement,"Pane must have loaded a scrollable element")}catch(t){e.reportError(t)}return this.setScrollOffset(this.getScrollOffset()+t)},setScrollHandler:function(e){this.scrollHandler=e},setInitialScrollOffset:function(e){this._scrollTop=e},checkHeightChanged:function(e,t){var i=this._pane,n=e.metricsInPane(i,t),r=this.getItemInfosForItem(e);if(r.length>0&&n.height!==r[0].size)return this.clearItemInfoForItem(e),!0}},i.defineBase(f),i.extend(f.prototype,m),f}),define("PaneOverview",["require","globals","Constants","DisplaySettings","util","platform","tracker","DragDrop","MobileUI","Observable","InfiniteList","Sel","Dispatcher"],function(e){function t(e,t){this.pane=e,this.root=e.getRootItem(),this.contentElement=void 0,this._scrollListenerAttached=!1,this.isVisible=new d(!!t);var i=s.mobile?0:-1;this.transform=new d(i),this.cursor=new d,this.topItem=void 0,this.dragHoverItem=void 0,this._infiniteList=new h({pane:e,isOverview:!0,itemsObs:e.headers,itemsFn:e.getHeaders,widthFn:e.getWidth,heightFn:e.getHeight,minItemSize:this.getMinItemSize}),this.init()}var i=e("globals"),n=e("Constants"),r=e("DisplaySettings"),a=e("util"),s=e("platform"),o=e("tracker"),c=e("DragDrop"),l=e("MobileUI"),d=e("Observable"),h=e("InfiniteList"),u=e("Sel"),p=e("Dispatcher");return t.prototype={init:function(){s.mobile?a.forceBind("refreshScrollListener",this):(a.forceBind("onPaneScroll",this),a.forceBind("onPaneItemsUpdated",this),p.listen("itemsUpdated",this.onPaneItemsUpdated))},destroy:function(){this.pane=void 0,s.mobile||p.unlisten("itemsUpdated",this.onPaneItemsUpdated),a.destroy(this)},onPaneLoad:function(){!s.mobile&&this.pane.overviewTracksScroll&&this.isVisible.get()&&this._attachScrollListener()},getInfiniteList:function(){return this._infiniteList},getContentElement:function(){return this.contentElement},onTapSection:function(e){i.vmMain.vmPicker.onTapSection(e)},getScrollOffset:function(){this._infiniteList.getScrollOffset()},refreshScrollListener:function(){this._infiniteList.refreshScrollListener()},onTap:{onStart:function(e){s.mobile&&s.useCustomScroller&&e.preventDefault();var t=(this.pane,i.getItemForElement(e.target));i.getElementParent(e.target)&&t&&(c.startDragItem=t)},onMove:function(e){if(!s.mobile){var t=c.startDragItem||c.dragItem;t&&t.checkDragOnMove(e,!0)}},onClick:function(e){var t,r=this.pane,a=i.dataFor(e.target),o=i.getElementParent(e.target);if(o&&a!==r&&a!==this){t=i.getItemForElement(e.target);try{i.PAssert(4300,t,"Element in overview was text but was not an item")}catch(e){i.reportError(e)}}if(t){try{i.PAssert(4301,o,"Item must have an overview element: "+(t.getRawText?t.getRawText():"not an item"))}catch(e){i.reportError(e)}if(o){var c=e.clientX-i.offset(o).left;if(c<r.getPaddingForItem(t,!0))t.setCollapsed(!t.isCollapsed(r,!0),r,!0);else if(this.pane.supportClickOverviewScroll&&c>=n.OverviewWidth-50&&r.isOverviewVisibleInPane(t)){this._disablePaneScrollListener=!0;for(var d=t;d&&d!==this.pane.getItem();){if(this.pane.indexOfItem(d)>=0){this.pane.scrollItemToTop(d,ScrollDuration.Default);break}d=d.parent()}this.updateTopPaneItem(t),setTimeout(function(){this._disablePaneScrollListener=!1}.bind(this),2*ScrollDuration.Default)}else this.pane.allowZoom(t)?(i.vmMain.zoomin(t),s.mobile&&l.setOverviewVisibility(this.pane,!1),i.sendEvent("Menu","OverviewZoom")):this.pane.performOverviewAction(t)}}e.preventDefault()},onEnd:function(e){if(!s.mobile){var t=c.startDragItem||c.dragItem;t&&t.checkDragOnEnd(e)}}},setVisibility:function(e){e&&u.reset(),e!==this.isVisible.get()&&(this.isVisible.set(e),p.fireEvent("panesChanged",[]),s.mobile||(i.vmMain.paneManager.updatePaneStateForPane(this),this.pane.overviewTracksScroll&&(e?this._attachScrollListener():this._detachScrollListener()))),s.mobile&&(e&&i.isKeyboardOpen&&!i.getActiveSearch().isFocused.get()&&i.blurActiveElement(),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOverview,data:{value:e,pane:this.pane}}),this.pane.onOverviewToggled(e))},_attachScrollListener:function(){try{i.PAssert(4302,!this._scrollListenerAttached,"Must not double attach scroll listener")}catch(e){i.reportError(e)}this._scrollListenerAttached||(this.pane.addScrollListener(this.onPaneScroll),this.onPaneScroll(),this._scrollListenerAttached=!0)},_detachScrollListener:function(){try{i.PAssert(4303,this._scrollListenerAttached,"Must only detach overview listener when already attached")}catch(e){i.reportError(e)}this._scrollListenerAttached&&(this.pane.removeScrollListener(this.onPaneScroll),this._scrollListenerAttached=!1)},toggleDesktop:function(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOverview,data:{value:this.isVisible.get(),pane:this.pane}})},onPaneScroll:function(){if(!this._disablePaneScrollListener){try{i.PAssert(4304,this.isVisible.get(),"Should not be tracking scroll if overview is not open")}catch(e){i.reportError(e)}var e=this.findTopPaneItem();e&&(this.updateTopPaneItem(e),this._infiniteList.scrollItemToMiddle(e,ScrollDuration.Default))}},findTopPaneItem:function(){var e=this.pane;if(this.pane.numItems()>0){for(var t,i,n=this.pane.indexOfTop();n>=0&&n<e.numItems()&&!i;){for(t=this.pane.itemAtIndex(n);t&&t!==this.root&&!i;){this._infiniteList.indexOfItem(t)<0?t=t.parent():i=t}i||n++}return!i&&this._infiniteList.numItems()>0&&(i=this._infiniteList.itemAtIndex(0)),i}},updateTopPaneItem:function(e){var t=this.topItem;this.topItem=e,t&&t.itemChanged.notify(),e.itemChanged.notify()},updateDragHoverItem:function(e){var t=this.dragHoverItem;this.dragHoverItem=e,t&&t.itemChanged.notify(),e&&e.itemChanged.notify()},onPaneItemsUpdated:function(e){if(e===this.pane&&this.isVisible.get()&&this.pane.overviewTracksScroll){var t=this.findTopPaneItem();t&&this.updateTopPaneItem(t)}},isItemAtTop:function(e){return e===this.topItem},isItemDragHovered:function(e){return e===this.dragHoverItem},getiScroller:function(){return this._infiniteList.iScroller},getMinItemSize:function(){return r.itemLineHeight()+2*r.itemPadding()}},t}),define("Search",["globals","Constants","util","platform","data","VMLI","tracker","Observable","ObservableArray","Trigger","Dispatcher"],function(e,t,i,n,r,a,s,o,c,l,d){function h(t,n,r){this.callback=r,this.pane=t,this.searchArr=[],this.matches={},this.previousSearch="",this.itemStoreFilter=void 0,this.UI=void 0,this.isFocused=new o,this._showHierarchy=new o(!n||void 0===n.showHierarchy||n.showHierarchy),this._destroyed=!1,i.forceBind("isMatched",this),i.forceBind("checkChildrenParams",this),t.supportSearchListenTextChanges&&d.listen("itemTextChanged",i.forceBind("handleItemTextChanged",this));for(var a={priority:{name:"priority",matchFn:this._matchFnPriority.bind(this)},complete:{name:"complete",initialValue:-1,icon:"icon-check",tooltip:"completed items",matchFn:this._matchFnComplete.bind(this)},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFn:this._matchFnStarred.bind(this)},header:{name:"header",initialValue:1,icon:"icon-header",tooltip:"headers",matchFn:this._matchFnHeader.bind(this)},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFn:this._matchFnTask.bind(this)}},s=[],c=0;c<t.searchFilters.length;c++){var h=t.searchFilters[c];e.isString(h)?s.push(a[h]):s.push(h)}this.setupFilters(s,n),this.filterDate=new o,this.value=n&&n.text||"",this.onChanged=new l(r),this._updateSearchArr()}var u=t.MatchState;return h.prototype={destroy:function(){this._destroyed=!0,this.pane.supportSearchListenTextChanges&&d.unlisten("itemTextChanged",this.handleItemTextChanged),this.onChanged.unlisten(this.callback),this.pane=void 0,this.UI=void 0,i.destroy(this)},setupFilters:function(t,i){for(var n=[],r=0;r<t.length;r++){var a=t[r],s=a.name,c=i&&i[s];a.value=c||0,a.enabled=new o(void 0===a.enabled||a.enabled);try{e.PAssert(4305,!this.hasOwnProperty("filter_"+s),"Should not double define filter properties")}catch(t){e.reportError(t)}this["filter_"+s]=a,n.push(a)}this.filters=n},setFilterEnabled:function(e,t){var i=this.filters.indexOfWithProperty("name",e);i>=0&&this.filters[i].enabled.set(t)},getValue:function(){return this.value},getRemoteValue:function(){for(var e=this.value,t=0;t<this.filters.length;++t){var i=this.filters[t];if(i.remoteStringFn&&i.enabled.get()){var n=i.remoteStringFn(i.value);n&&(e+=" "+n)}}return e.trim()},getState:function(){for(var e={text:this.getValue(),showHierarchy:this.showHierarchy()},t=0;t<this.filters.length;t++){var i=this.filters[t];e[i.name]=i.value}return e},focus:function(){this.UI.focus()},blur:function(){this.UI.blur()},onParsed:function(t){var i=t.dates&&t.dates[0];i===this.filterDate.get()||i&&e.isDateSoft(i.text)||(this.filterDate.set(i),this._updateSearchArr(),this.update(!0))},setValue:function(e){this.value=e,this._updateSearchArr(),this.update(!0),e&&s.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:this.getState()})},addToValue:function(e){var t=this.getSelectionOffset(),i=this.value;"-"!==i[i.length-1]&&"!"!==i[i.length-1]&&(e=" "+e),i+=e,this.setValue(i),this.setSelectionOffset(t+e.length)},toggleText:function(t,i){var r=this.value.trim(),a="\\B(-*)("+e.escapeRegExp(t)+")\\b",s=r.match(a);if(s){var o;o=!s[1]&&i?"-"+t:s[1]&&!i?t:" ",r=r.replace(new RegExp(a),o).replace(/  +/g," ")}else r+=" "+(i?"-":"")+t;r=r.trim(),this.setValue(r),n.mobile&&!e.isKeyboardOpen||this.setSelectionOffset(r.length)},getSelectionOffset:function(){return this.UI.getSelectionOffset()},setSelectionOffset:function(e){this.UI.setSelectionOffset(e)},getSearchBox:function(){return this.UI.refs.searchBox},isSearched:function(){if(this.value.length>0)return!0;for(var e=0;e<this.filters.length;e++){var t=this.filters[e];if(t.enabled.get()&&t.value)return!0}},reset:function(){this.setValue("")},resetFilters:function(){for(var e=0;e<this.filters.length;e++){this.filters[e].value=0}this.update(!0,!0)},getMatchedItems:function(){var e=[];for(var t in this.matches)this.matches[t]===u.Yes&&e.push(t);return e},isFlatSearchResult:function(e){return!this.showHierarchy()&&this.matches[e.id]===u.Yes},isMatched:function(t){if(this.pane.supportLocalSearch){var i=this.matches[t.id];return void 0===i&&t.hasText()&&!this.pane.isSettingText&&this.pane!==e.focusedPane&&(i=this.checkItem(t)),void 0===i||i===u.Yes||i===u.ChildYes||i===u.Unknown}return u.Yes},handleItemTextChanged:function(t){if(e.vmMain.paneManager.isPaneActive(this.pane.id)&&!n.mobile&&(t.force||e.focusedPane&&e.focusedPane.id!==this.pane.id)){var i=t.item,r=this.isMatched(i);this.checkItem(i);this.isMatched(i)!=r&&this.pane.refreshSearchResults()}},_updateSearchArr:function(){var e=this.value;this.filterDate.get()&&(e=e.replace("@"+this.filterDate.get().text,""));var t=e.toLowerCase().trim().split(/\s+/);t=t.filter(function(e){return!(!e||"-"===e)}),this.searchArr=[];for(var i=0;i<t.length;++i){var n=t[i].startsWith("-"),r=n?t[i].substr(1):t[i];this.searchArr.push({text:r,isNegated:n})}},toggleFilterDefault:function(e){var t=this["filter_"+e],i=t.value;i=i?0:t.initialValue,this.setFilter(e,i)},toggleFilter:function(e,t){var i=t?-1:1,n=this["filter_"+e],r=n.value;r=r===i?0:i,this.setFilter(e,r)},getFilter:function(e){return this["filter_"+e].value},setFilter:function(e,t){this["filter_"+e].value=t,this.update(!0,!0),s.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:this.getState()})},update:function(i,n){e.vmMain.beginUpdateItems(),this.pane.supportLocalSearch&&(this.matches={},this.checkChildren(i)),this.isUpdatingSearch=!0,this.pane.isLoaded&&i&&(e.vmMain.setItemAnimationMode(t.ItemAnimationMode.None),this.onChanged.notify(n)),e.vmMain.commitUpdateItems(),setTimeout(function(){this.isUpdatingSearch=!1,e.vmMain.resetItemAnimationMode()}.bind(this),0)},_checkMatch:function(i,n,r){var a=!0;if(r.length>0&&a&&!(a=r===t.Prefix.Task||r===t.Prefix.Task2||r===t.Prefix.Task3?i.isPrefixTask():r===t.Prefix.Bullet||r===t.Prefix.Bullet2||r===t.Prefix.Bullet3?i.isPrefixBullet():r===t.Prefix.Header?i.isPrefixHeader():n.indexOf(r)>=0)){var s=i.getAttachments();if(s)try{for(var o=0;o<s.length&&!a;++o)a=s[o].match(r)}catch(t){e.reportError(t)}}return a},_isMatchStateOk:function(e){return e===u.Yes||e===u.Unknown},_matchFilter:function(e,t,i){return e&&(i=t?e>0?u.Yes:u.Negated:e>0?u.No:u.Unknown),i},_matchFilters:function(e){for(var t=u.Unknown,i=0;i<this.filters.length;i++){var n=this.filters[i],r=n.matchFn(n.value,e,t);r===u.Unknown||r!==u.Negated&&!this._isMatchStateOk(t)||(t=r)}return t},_matchFnComplete:function(e,t,i){return this._matchFilter(e,t.isComplete(),i)},_matchFnStarred:function(e,t,i){return this._matchFilter(e,t.isStarred(),i)},_matchFnHeader:function(e,t,i){return this._matchFilter(e,t.isPrefixHeader(),i)},_matchFnTask:function(e,t,i){return this._matchFilter(e,t.isPrefixTask(),i)},_matchFnPriority:function(e,t,i){return t.priority()>=e?u.Yes:u.No},_matchFnEmail:function(t,i,n){var r=i.getAttachments(),a=r&&r[0],s=a&&a.getPlugin()===e.vmMain.getDefaultEmailPlugin();return this._matchFilter(t,s,n)},_matchDate:function(e,t){var i=this.filterDate.get();if(i){t=u.No;var n=i.date;e.isOnDate(n)&&(t=u.Yes)}return t},checkItem:function(t){var i=r.getRootModel(),n=this.matches;try{e.PAssert(4306,t.parent()||t.isRootItem(),"Item parent does not exist while being searched",t.isArchived(),t===i)}catch(t){e.reportError(t)}if(t.isRootItem())return n[t.id]=u.Yes;if(!t.parent())return n[t.id]=u.No;if(n[t.parent().id]===u.Negated)return n[t.id]=u.Negated,u.Negated;var a,s,o,c,l=u.Unknown,d=t.getSearchText();if(l=this._matchFilters(t),this._isMatchStateOk(l)&&(l=this._matchDate(t,l)),l!==u.Negated)for(s=0;s<this.searchArr.length;s++){c=this.searchArr[s];var h=c.isNegated;if(h){o=c.text;try{e.PAssert(4307,o,"Each value in the search array should be valid at this point")}catch(t){e.reportError(t)}if(this._checkMatch(t,d,o)){l=u.Negated;break}}}if(l!==u.Negated){if(this.pane.shouldSearchMatchParents&&t.parent()!==i&&this.showHierarchy()&&n[t.parent().id]===u.Yes)return n[t.id]=u.Yes,n[t.id];for(s=0;s<this.searchArr.length;s++){c=this.searchArr[s],o=c.text;try{e.PAssert(4308,o,"Each value in the search array should be valid at this point")}catch(t){e.reportError(t)}if(!c.isNegated&&!this._checkMatch(t,d,o))if(this.showHierarchy())for(a=t;a;){if(!(a=a.parent())||a===i){l=u.No;break}if(this._checkMatch(a,a.getSearchText(),o))break}else l=u.No;if(l===u.No)break}}if(l===u.Unknown&&(l=u.Yes),l===u.Yes)if(this.showHierarchy())for(a=t.parent();a&&!a.isRootItem()&&n[a.id]!==u.Negated&&n[a.id]!==u.Yes;)n[a.id]=u.ChildYes,a.hasNote()&&(n[a.getNote().id]=u.Yes),a=a.parent();else t.isNote()&&(n[t.parent().id]=u.Yes);else l===u.No&&t.isNote()&&(l=n[t.parent().id]);return n[t.id]=l,l},checkChildrenParams:function(e){return this.checkItem(e)!==u.Negated},checkChildren:function(t){var i={includeArchived:this.pane.showArchived.get(),includeNotes:!0,comparator:this.checkChildrenParams};this.itemStoreFilter&&(i.itemStoreFilter=this.itemStoreFilter),i.itemStore=this.pane.getItemStore(),e.searchVMLIs(i);for(var n=this.pane.getItem();n;)this.matches[n.id]=u.Yes,n=n.parent()},showHierarchy:function(){return this._showHierarchy.get()},setShowHierarchy:function(e){this.pane.supportSearchFlat&&(this._showHierarchy.set(e),this.clearListCache(),this.update(!0))},clearListCache:function(){this.pane.getInfiniteList().clearCache()}},h}),define("AutocompleteDates",["data","globals","platform"],function(e,t,i){function n(){this.soft=["now","soon","later","someday"],this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.repeatStart=["every"],this.repeatModifier=["first","other","last"],this.dict=this.soft.concat(this.repeatStart).concat(this.softDays).concat(this.repeatModifier).concat(this.dayModifiers).concat(this.days).concat(this.months),this.NextWordOptions={None:0,DayName:1,Days:2,Time:4,Repeat:8},this.nextDateWord=t.createObservable(this.NextWordOptions.None,"nextDateWord","AutocompleteDates"),this.init()}return n.prototype={init:function(){},showAllDates:function(){return""===t.autocomplete.text()},showRepeat:function(){return t.isFlagSet(this.nextDateWord(),this.NextWordOptions.Repeat)},showDate:function(){return this.nextDateWord()===this.NextWordOptions.None||t.isFlagSet(this.nextDateWord(),this.NextWordOptions.DayName)},showDays:function(){return t.isFlagSet(this.nextDateWord(),this.NextWordOptions.Days)},showTime:function(){return t.isFlagSet(this.nextDateWord(),this.NextWordOptions.Time)},getShortMonth:function(e){return Date.CultureInfo.abbreviatedMonthNames[e]},getLongMonth:function(e){return Date.CultureInfo.monthNames[e]},getShortDay:function(e){return Date.CultureInfo.abbreviatedDayNames[e]},getLongDay:function(e){return Date.CultureInfo.dayNames[e]},previewTemplate:function(){},getItemText:function(e){return e.text},getItemTextLength:function(e){return e?this.getItemText(e).length:0},getItemStyledText:function(e){return e.text},findMatchLike:function(e){for(var t=e.toLowerCase(),i=[],n=0;n<this.dict.length;++n)0===this.dict[n].indexOf(t)&&i.push({type:"date",text:this.dict[n]});return i},findMatchExact:function(e){if(this.dict.indexOf(e)>=0){if(!i.mobile)return{type:"date",text:e};if(this.nextWordOptions(e)===this.NextWordOptions.None)return{type:"date",text:e}}},nextWordOptions:function(e){var t=e.toLowerCase().split(" "),i=t[t.length-1];if(""===i&&(i=t[t.length-2]),this.soft.indexOf(i)>=0)return this.NextWordOptions.None;if(this.repeatStart.indexOf(i)>=0)return this.NextWordOptions.DayName|this.NextWordOptions.Repeat;if(this.repeatModifier.indexOf(i)>=0)return this.NextWordOptions.DayName;if(this.softDays.indexOf(i)>=0)return this.NextWordOptions.Time;if(this.dayModifiers.indexOf(i)>=0)return this.NextWordOptions.DayName;if(this.days.indexOf(i)>=0)return this.NextWordOptions.Time;if(this.months.indexOf(i)>=0)return this.NextWordOptions.Days;var n=parseInt(i,10);return isNaN(n)?i.indexOf(":")>=0?this.NextWordOptions.Time:this.NextWordOptions.None:this.NextWordOptions.Time},getMonthList:function(){var e=(new Date).getMonth(),t=e-1;t<0&&(t=12+t);for(var i=t+1+5,n=[],r=t;r<i;++r){var a=r%12;n.push(a)}return n},getDayList:function(){return[0,1,2,3,4,5,6]},getSoftList:function(){return this.repeatStart.concat(this.soft)},onTapDate:{onStart:t.handlerPreventStop,onClick:function(e){var i=e.target;if("SPAN"===i.nodeName){var n=i.parentNode;if(t.hasClass(n,"disabled"))return;var r=i.id||i.textContent,a=this.nextWordOptions(r);this.nextDateWord(a);var s=a===this.NextWordOptions.None;"autocompleteHours"!==n.id&&"autocompleteMinutes"!==n.id&&(r+=" "),t.autocomplete.onTapped(r,r.length,s,!0)}}}},n}),define("TagManager",["require","globals","util"],function(e){function t(){n.forceBind("tagComparatorNumber",this)}var i=e("globals"),n=e("util");return t.prototype={previewTemplate:function(){},getItemStyledText:function(e){return e.text},getItemText:function(e){return e.text},getItemTextLength:function(e){return e?this.getItemText(e).length:0},tagComparator:function(e,t){return e.localeCompare(t)},tagComparatorNumber:function(e,t){var i=e.count,n=t.count;return i===n?e.text.localeCompare(t.text):i>n?-1:1},findMatchExact:function(e){return!1},findMatchLike:function(e,t,n){var r={},a=[],s=e.toLowerCase(),o={comparator:function(e){return!!e.getTags()},each:function(e){for(var t=e.getTags(),i=0;i<t.length;i++){var n=t[i],o="t~"+n.toLowerCase();if(lower=n.toLowerCase(),!s||lower.startsWith(s)&&lower!==s){if(!r[o]){var c=r[o]={type:"tag",text:n,count:0};a.push(c)}r[o].count++}}}};return n?o.item=n.item.get():o.itemStore=i.vmMain.itemStoreManager.getDefaultItemStore(),i.searchVMLIs(o),a.sort(this.tagComparatorNumber),a.length>t&&(a=a.slice(0,t)),a},printStats:function(e){log("--- Tag stats ---",e);for(var t=this.findMatchLike("",100),i=0;i<t.length;i++)console.log(t[i].text,t[i].count)}},new t}),define("AutocompleteItems",["require","globals","data","util","platform"],function(e){function t(){this.items=[]}var i=e("globals");e("data"),e("util"),e("platform");return t.prototype={findMatchLike:function(e,t){var n=i.vmMain.itemStoreManager.getDefaultItemStore(),r=e.toLowerCase(),a=[];return i.searchVMLIs({itemStore:n,each:function(e){if(e.getSearchText().indexOf(r)>=0&&(a.push({type:"item",text:e.getParsedText(),item:e}),a.length>=t))return!1}}),a},findMatchExact:function(e,t){}},new t}),define("AutocompleteGmailLabels",["require","globals","Constants"],function(e){function t(){this.accountID=void 0}var i=e("globals"),n=e("Constants");return t.prototype={setAccountID:function(e){this.accountID=e},findMatchLike:function(e,t){for(var r=i.vmMain.getDefaultEmailPlugin(),a=r.getLabels(this.accountID,e,t),s=[],o=0;o<a.length;++o)a[o].isSystemLabel()||s.insertSorted(a[o],r.labelSortFn);return s.map(function(e){return{type:n.AutocompleteMode.GmailLabel,text:e.getName(),label:e}})},findMatchExact:function(e,t){}},new t}),define("Autocomplete",["require","globals","data","util","platform","Constants","react","ObservableArray","AutocompleteDates","TagManager","AutocompleteItems","AutocompleteGmailLabels"],function(e){function t(){this.matches=new o,this._isShowing=!1,this._isTempDisabled=!1,this._isPopup=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[ContactPrefix,DatePrefix,TagPrefix],this._prefixMap={},this._prefixMap[ContactPrefix]=n.contactManager,this._prefixMap[TagPrefix]=l,this._prefixMap[DatePrefix]=new c,r.forceBind("onClosed",this),this.supportedModes=null}var i=e("globals"),n=e("data"),r=e("util"),a=e("platform"),s=e("Constants"),o=(e("react"),e("ObservableArray")),c=e("AutocompleteDates"),l=e("TagManager"),d=e("AutocompleteItems"),h=e("AutocompleteGmailLabels");return t.prototype={isShowing:function(){return this._isShowing},getText:function(){return this.text},getProviderForPrefix:function(e){return this._prefixMap[e]||ACProvider.None},_checkPrefixes:function(e){for(var t=e.startsWith("-")?1:0,i=0;i<this._prefixes.length;i++){var n=this._prefixes[i];if(e[t]===n)return{length:t+1,prefix:n}}},_findClosestWithPrefix:function(e,t,i){for(var n,r=e.split(" "),a=0,s=-1,o=-1,c=-1,l=0,d=0;d<r.length&&a<=t;++d){var h=r[d];r[s]===n&&(l=0);var u=this._checkPrefixes(h);u?(s=d,o=a,c=o+h.length,l=u.length,n=u.prefix):l&&(c+=h.length+1),a+=h.length+1}if(l){var p=e.substr(o+l,c-o-l);return{mode:i,text:e,prefix:n,searchText:p,start:o+l,end:c}}},_findClosestDelimited:function(e,t,i){for(var n=e.split(","),r=!1,a=0,s=-1,o=-1,c=0;c<n.length&&a<=t;++c){var l=n[c];s=a+this._numStartSpaces(l),o=a+l.length-1-this._numEndSpaces(l),r=s<t&&t<=o+1&&l.length>0,a+=l.length+1}if(r||this._isPopup){var d=e.substr(s,o-s+1);return{mode:i,text:e,searchText:d,start:s,end:o}}},_findClosestVMLIElement:function(e,t,i,n){for(var r,a,s,o=0,c=!1,l=0;l<t.length&&!1===c;l++){var d=t[l].getParsedText();if(r=o+this._numStartSpaces(d),a=o+d.length-1-this._numEndSpaces(d),r<i&&i<=a+1&&d.length>0){c=l,s=d.trim();break}o+=d.length}if(!1!==c)return{mode:n,text:e,prefix:"",searchText:s,start:r,end:a,el:t[l]}},_numStartSpaces:function(e){for(var t=0,i=0;i<e.length&&" "===e[i];i++)t++;return t},_numEndSpaces:function(e){for(var t=0,i=e.length-1;i>=0&&" "===e[i];i--)t++;return t},insertMatch:function(e){var t=this._searchInfo,i=t.text,n=i.substr(0,t.start),r=i.substr(t.end+1,i.length),a=t.start+e.length;" "!==r[0]&&e&&(e+=" ",a++);var s=n+e+r;return{text:s,offset:a}},update:function(e){var t=e.mode;if(e.owner===this.owner&&e.elementInput===this.elementInput||(this._isTempDisabled=!1),this.text=e.text,this._isTempDisabled||!e.text&&!this._isPopup)this.matches.set([]),this._isPopup||this.hide();else{this.owner=e.owner,this.elementInput=e.elementInput;var n=e.text,r=null,a=null;this._searchInfo="all"===t?this._findClosestWithPrefix(n,e.offset,e.mode):this._findClosestDelimited(n,e.offset,e.mode);if(this._searchInfo){this.text=this._searchInfo.searchText;if("all"===t)a=this.getProviderForPrefix(this._searchInfo.prefix);else switch(t){case s.AutocompleteMode.Move:case s.AutocompleteMode.Jump:case s.AutocompleteMode.Item:a=d;break;case s.AutocompleteMode.Email:a=this._prefixMap[ContactPrefix],r=a.findEmailsLike(this._searchInfo.searchText.trim(),22);break;case s.AutocompleteMode.Contact:a=this._prefixMap[ContactPrefix];break;case s.AutocompleteMode.Tag:a=this._prefixMap[TagPrefix];break;case s.AutocompleteMode.Date:case s.AutocompleteMode.Snooze:a=this._prefixMap[DatePrefix];break;case s.AutocompleteMode.GmailLabel:var o=i.vmMain.getDefaultEmailPlugin(),c=o._getAccountIDFromItem(e.item);a=h,a.setAccountID(c);break;default:try{i.PAssert(4309,!1,"Unknown autocomplete mode: ",t)}catch(e){i.reportError(e)}}null===r&&(r=a.findMatchLike(this._searchInfo.searchText,22,i.focusedPane)),1===r.length&&a.findMatchExact(this._searchInfo.searchText,r)&&(r=[])}r=r||[],e.supportSearchItemAutocomplete&&"all"===t&&0===r.length&&e.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(n,e.parsedEls,e.offset,t)),this.matches.set(r),!this._isShowing&&r.length>0&&!this._isTempDisabled?this.show(e):0===r.length&&(this._isPopup||this.hide(),this._isTempDisabled=!1)}},clearDisabled:function(){this._isTempDisabled=!1},onClosed:function(e,t){this._isShowing=!1,this._owner=null},show:function(e){var t=a.mobile&&"email"===e.mode;this._isShowing=!0,this._isPopup=!1,this._owner=e.owner,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,i.menus.openContextMenuReact(e,t)},showPopup:function(e){this._isShowing=!0,this._isPopup=!0,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,a.mobile&&(e.position="full"),i.menus.openContextMenuReact(e)},hide:function(e){this._isShowing&&(this._isShowing=!1,i.menus.closeContextMenuReact("ReactAutocomplete"))}},new t}),define("VMPane",["require","globals","Constants","data","util","edit","tracker","PaneOverview","platform","International","Dispatcher","Observable","ObservableArray","Trigger","Search","Sel","Multiselect","MobileUI","DragDrop","DisplaySettings","NativeSel","InfiniteList","Autocomplete","AccountManager","Measure","EmailPreview"],function(e){function t(e){this.setPropDefault("type",PaneMode.Outline),this.setPropDefault("paneClass","paneOutline"),this.setPropDefault("contextMenuMode",n.ContextMenuMode.Default),this.setPropDefault("paneEmptyMessage","Write some things here to get started"),this.setPropDefault("paneEmptySearchMessage","No search results"),this.setPropDefault("titleContextMenuHeader","Zoom to item"),this.setPropDefault("overviewEmptyMessage","No lists in this item"),this.setPropDefault("searchFilters",["header","task","complete","starred","priority"]),this.setPropDefault("dropEffect",function(){return n.DropEffect.Move}),this.setPropDefault("isWriteable",!0),this.setPropDefault("isEditable",!0),this.setPropDefault("isDraggable",!0),this.setPropDefault("isDropTarget",!0),this.setPropDefault("hasNonVMLIs",!1),this.setPropDefault("canAddItem",!0),this.setPropDefault("overrideCopyBehavior",!0),this.setPropDefault("supportCollapsing",!0),this.setPropDefault("supportCompleting",!0),this.setPropDefault("supportArchiving",!1),this.setPropDefault("supportIndent",!0),this.setPropDefault("supportOffline",!0),this.setPropDefault("supportPerformArchive",!0),this.setPropDefault("supportDataRefresh",!1),this.setPropDefault("supportReportError",!1),this.setPropDefault("supportCompose",!1),this.setPropDefault("supportPagination",!1),this.setPropDefault("supportBullets",!0),this.setPropDefault("supportBulletZoom",!0),this.setPropDefault("supportBulletEdit",!1),this.setPropDefault("supportVertLines",!0),this.setPropDefault("supportStarClick",!1),this.setPropDefault("supportSearchItemAutocomplete",!0),this.setPropDefault("supportSearchListenTextChanges",!0),this.setPropDefault("supportSearchFlat",!0),this.setPropDefault("supportLocalSearch",!0),this.setPropDefault("supportClone",!0),this.setPropDefault("supportDates",!0),this.setPropDefault("supportMultiselect",!0),this.setPropDefault("supportDeferredItemLoad",!1),this.setPropDefault("supportCellTransition",!0),this.setPropDefault("useLineCache",!0),this.setPropDefault("supportSel",!0),this.setPropDefault("shouldSearchMatchParents",!0),this.setPropDefault("shouldUpdateOnTextChanged",!0),this.setPropDefault("noOverviewStyle",!1),this.setPropDefault("itemsAreObjects",!1),this.setPropDefault("titleOfFirstItem",n.RootItemName),this.setPropDefault("supportClickOverviewScroll",!l.mobile),this.setPropDefault("overviewTracksScroll",!0),this.setPropDefault("overviewHasPaneItems",!0),this.setPropDefault("overviewPadLevels",0),this.setPropDefault("minWidth",n.StdPaneWidthMin),this.setPropDefault("maxWidth",n.StdPaneWidthMax),this.setPropDefault("hasMoreButtons",!0),this.setPropDefault("_topBoxHeight",i.activeDisplayMode&DisplayMode.NoPaneTop?0:l.mobile?16:36),this.topBoxHeight=new u(this._topBoxHeight),this.rect=new u(e.rect),this.isExpanded=new u(!1);try{i.PAssert(4310,void 0!==e.id,"Must supply a valid pane id")}catch(e){i.reportError(e)}this.id=e.id,this.uniqueID=_++,e.item||(this.supportDeferredItemLoad?(e.item=this.getDefaultDisplayItem(),this.deferredItemState={itemID:e.deferredItemID,search:e.search,offset:0}):(e.item=this.getDefaultDisplayItem(),e.offset=0,e.search="")),this.item=new u(e.item),this.items=new p,this.headers=new p,this.isDefaultPane=e.isDefaultPane,this.initialOffset=e.offset,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.showArchived=new u(!1),this.numCompleteItems=new u(0),this._panePadding=0,this.paneTopText=new u,this.blurTrigger=new m,this.focusTrigger=new m,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new u(!1),this.isFocused=!1,this.caretPosition=new u,this.isReady=new u(!this.plugin||this.plugin.isReady()),this.isActive=new u(!l.mobile),this.hasBeenActive=this.isActive.get(),this.hasCollapsedObs=new u,a.forceBind("getItems",this),a.forceBind("getHeaders",this),a.forceBind("getWidth",this),a.forceBind("getHeight",this),a.forceBind("zoomInOnSwipe",this),a.forceBind("getMinItemSize",this),a.forceBind("onInputAndroid",this),a.forceBind("onInputSetText",this),this._infiniteList=new C({pane:this,offset:e.offset||0,isOverview:!1,itemsObs:this.items,itemsFn:this.getItems,widthFn:this.getWidth,heightFn:this.getHeight,itemsAreObjects:this.itemsAreObjects,intialOffset:this.initialOffset,minItemSize:this.getMinItemSize}),this.useCustomScroller=this._infiniteList.useCustomScroller,this.isLoadingNewPage=new u(!1),this.orientation=new u(n.Orientation.Vertical),this.showScrollbars=new u(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},l.mobile?(this.defaultOffset=Math.max(this.topBoxHeight.get()-16,0),this.offsetX=new u(0),this.swipeMenuItems=this.getSwipeMenuItems(),a.forceBind("onTouchHoldTimeout",this)):this.defaultOffset=0,a.forceBind("onInput",this),a.forceBind("compositionStart",this),a.forceBind("compositionEnd",this),a.forceBind("onShowArchivedChanged",this),a.forceBind("updateItems",this),this.showArchived.listen(this.onShowArchivedChanged),this.search=new f(this,e.search,this.onSearchChanged.bind(this)),this.overview=new c(this,e.isOverviewVisible)}
var i=e("globals"),n=e("Constants"),r=e("data"),a=e("util"),s=e("edit"),o=e("tracker"),c=e("PaneOverview"),l=e("platform"),d=e("International"),h=e("Dispatcher"),u=e("Observable"),p=e("ObservableArray"),m=e("Trigger"),f=e("Search"),g=e("Sel"),v=e("Multiselect"),y=e("MobileUI"),b=e("DragDrop"),S=e("DisplaySettings"),E=e("NativeSel"),C=e("InfiniteList"),P=e("Autocomplete"),T=e("AccountManager"),D=e("Measure"),M=e("EmailPreview"),_=0;return t.prototype={init:function(){this.getItem()&&this.setItem(this.getItem(),!1),this.plugin&&this.plugin.notifyPaneCreated(this)},isDestroyed:function(){return this._destroyed},getStats:function(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}},activate:function(){try{i.PAssert(4311,l.mobile,"Activating panes should only ever happen on mobile devices")}catch(e){i.reportError(e)}this.isActive.set(!0),this.hasBeenActive=!0,this.updateItemsImmediate(!0,!1)},deactivate:function(){try{i.PAssert(4312,l.mobile,"Deactivating panes should only ever happen on mobile devices")}catch(e){i.reportError(e)}this.isActive.set(!1)},destroy:function(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(this),this.showArchived.unlisten(this.onShowArchivedChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this._onAfterLoadedRAF&&(cancelAnimationFrame(this._onAfterLoadedRAF),this._onAfterLoadedRAF=void 0),this.isLoaded&&this.getItemStore()===i.vmMain.itemStoreManager.getDefaultItemStore()&&(h.unlisten("itemNoteSet",this._infiniteList.handleItemNoteSet),h.unlisten("itemTextChanged",this._infiniteList.handleItemTextChanged),h.unlisten("itemBoldChanged",this._infiniteList.handleItemBoldChanged)),this._infiniteList=void 0;try{i.PAssert(4313,i.focusedPane!==this,"Globally focused pane should never be the one destroyed")}catch(e){i.reportError(e)}try{i.PAssert(4314,g.getPane()!==this,"Selection focused pane should never be the one destroyed")}catch(e){i.reportError(e)}try{i.PAssert(4315,!i.vmMain.paneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}catch(e){i.reportError(e)}a.destroy(this)},notifyPluginLoaded:function(){try{i.PAssert(4316,!1,"Plugin load notification not supported by pane type: ",this.type)}catch(e){i.reportError(e)}},getContextMenuMode:function(e){return this.contextMenuMode},isItemDraggable:function(e){return this.isDraggable},getInfiniteList:function(e){var t;if(e){var n=this.getOverview();try{i.PAssert(4317,n,"Trying to get infinite list for overview that doesnt exist.")}catch(e){i.reportError(e)}n&&(t=n.getInfiniteList())}else t=this._infiniteList;return t},getItemStore:function(){return i.vmMain.itemStoreManager.getDefaultItemStore()},usesItemStore:function(e){return e===this.getItemStore()||!!this._activeItemStores[e.id]},useItemStore:function(e){try{i.PAssert(4318,!this._activeItemStores[e.id],"Should never use the same store twice")}catch(e){i.reportError(e)}this._activeItemStores[e.id]=e},stopUsingItemStore:function(e){try{i.PAssert(4319,this._activeItemStores[e.id],"Must be using item store to stop using it")}catch(e){i.reportError(e)}delete this._activeItemStores[e.id]},getOverview:function(){return this.overview},isOverviewVisible:function(){return this.overview.isVisible.get()},getiScroller:function(){return this._infiniteList.iScroller},numItems:function(){return this.getItems().length},getItems:function(){return i.vmMain.flushItemsUpdate(this),this.items.get()},getHeaders:function(){return this.headers.get()},itemAtIndex:function(e){return this._infiniteList.itemAtIndex(e)},objectAtIndex:function(e){return this._infiniteList.objectAtIndex(e)},indexOfItem:function(e){return this._infiniteList.indexOfItem(e)},indexOfObject:function(e){return this._infiniteList.indexOfItem(e)},topOfItem:function(e){return this._infiniteList.topOfItem(e,this.topBoxHeight.get())},topOfIndex:function(e){return this._infiniteList.topOfIndex(e,this.topBoxHeight.get())},indexOfTop:function(){return this._infiniteList.indexOfTop()},inViewCount:function(){return this._infiniteList.inViewCount()},itemAtTop:function(){return this._infiniteList.itemAtTop()},elementAtIndex:function(e){return this._infiniteList.getElementAtIndex(e)},isIndexMounted:function(e){return this._infiniteList.isIndexMounted(e)},notifyDragStart:function(){return this._infiniteList.notifyDragStart()},notifyDragEnd:function(){return this._infiniteList.notifyDragEnd()},notifySwappedIn:function(e){return this._infiniteList.notifySwappedIn(e)},getScrollOffset:function(){return this._infiniteList.getScrollOffset()},addScrollListener:function(e){return this._infiniteList.addScrollListener(e)},removeScrollListener:function(e){return this._infiniteList.removeScrollListener(e)},refreshScrollListener:function(){return this._infiniteList.refreshScrollListener()},setScrollOffset:function(e,t,i){return this._infiniteList.setScrollOffset(e,t,i)},scrollIndexIntoView:function(e,t,i){return this._infiniteList.scrollIndexIntoView(e,t,i)},scrollItemIntoView:function(e,t,i){return this._infiniteList.scrollItemIntoView(e,t,i)},scrollIndexToTop:function(e,t,i){return this._infiniteList.scrollIndexToTop(e,t,i)},scrollItemToTop:function(e,t,i){return this._infiniteList.scrollItemToTop(e,t,i)},scrollItemToMiddle:function(e,t,i){return this._infiniteList.scrollItemToMiddle(e,t,i)},scrollIndexToMiddle:function(e,t,i){return this._infiniteList.scrollIndexToMiddle(e,t,i)},addScrollDelta:function(e){return!!this._infiniteList&&this._infiniteList.addScrollDelta(e)},addPadding:function(){return this._infiniteList.addPadding()},removePadding:function(){return this._infiniteList.removePadding()},getScrollTop:function(){return this._infiniteList.getScrollTop()},closestIndexOfObject:function(e){return this.indexOfObject(e)},sizeAtIndex:function(e,t){var n=0,r=t?this.overview._infiniteList:this._infiniteList;try{i.PAssert(4321,r,"Must have a valid owner")}catch(e){i.reportError(e)}if(r){var a=r.objectAtIndex(e);try{i.PAssert(4322,a,"Must have found a valid item")}catch(e){i.reportError(e)}a&&(n=this.sizeOfItem(a,e,t))}return n},sizeOfItem:function(e,t,n){try{i.PAssert(4323,e,"Must provide a valid item to measure")}catch(e){i.reportError(e)}if(e.sizeInPane)return e.sizeInPane(this,t,n);try{i.PAssert(4324,!1,"Should have sizeInPane defined")}catch(e){i.reportError(e)}return 0},getPaneDoc:function(){return i.vmMain.docManager.getOpenDoc()},handleStatusClick:function(){},_getLoadingMessage:function(){return"Loading..."},getStatusMessage:function(e){var t;return e?0===this.headers.length()&&(t=this.overviewEmptyMessage):this.isLoading.get()?t=this._getLoadingMessage():0===this.numItems()?t=this.isSearched()?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(t=this._getNotReadyStatus()),t},_getNotReadyStatus:function(){return"Pane data is only available while online."},copyStateFrom:function(e){this.getItem()!==e.getItem()&&this.setItem(e.getItem())},getSaveInfo:function(){return{id:this.id,item:this.getItem().id,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),offset:this.getScrollOffset(),itemState:this.getSaveInfoItemState(),isOverviewVisible:!l.mobile&&this.overview.isVisible.get(),isExpanded:!l.mobile&&this.isExpanded.get()}},getSaveInfoItemState:function(){var e=this._perPaneState,t=[],i=[],n=[];for(var a in e)if(e.hasOwnProperty(a)){var s=r.getModel(a);if(s){var o=e[a];o[PerPaneStateField.Collapsed]&&t.push(a),o[PerPaneStateField.CollapsedSearch]&&i.push(a),!1===o[PerPaneStateField.Collapsed]&&s.isDemandLoad()&&n.push(a)}else delete e[a]}return{collapsed:t.length>0?t:void 0,collapsedSearch:i.length>0?i:void 0,uncollapsed:n.length>0?n:void 0}},getPerPaneState:function(e,t){if(this._perPaneState[e])return this._perPaneState[e][t]},setPerPaneState:function(e,t,i){this._perPaneState[e]||(this._perPaneState[e]={}),this._perPaneState[e][t]=i},clearPerPaneStateSearch:function(){var e=this._perPaneState;for(var t in e)e.hasOwnProperty(t)&&(e[t][PerPaneStateField.CollapsedSearch]=void 0)},deletePerPaneState:function(e){this._perPaneState[e]=void 0},isSearched:function(){try{i.PAssert(4325,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){i.reportError(e)}return!!this.search&&this.search.isSearched()},isSearchedFlat:function(){try{i.PAssert(4326,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){i.reportError(e)}return!!this.search&&!this.search.showHierarchy()},onSearchChanged:function(){var e=g.isValid();if(e&&g.reset(),this.refreshSearchResults(),e&&this.numItems()>0){var t=this.indexOfFirstItem();t>=0&&g.selectIndex(t,0)}i.vmMain.paneManager.updatePaneStateForPane(this)},refreshSearchResults:function(){this.updateItems(!0)},_applyItemStateArr:function(e,t,i){if(e)for(var n=0;n<e.length;n++){var r=e[n];this.setPerPaneState(r,t,i)}},applyItemState:function(e){e&&(this._applyItemStateArr(e.collapsed,PerPaneStateField.Collapsed,!0),this._applyItemStateArr(e.uncollapsed,PerPaneStateField.Collapsed,!1),this._applyItemStateArr(e.collapsedSearch,PerPaneStateField.CollapsedSearch,!0))},requestDemandLoadData:function(e,t){try{i.PAssert(4327,!1,"SubClass must override - by default demand load is not supported")}catch(e){i.reportError(e)}},requestDataPage:function(e){try{i.PAssert(4328,!1,"SubClass must override - by default data pagination is not supported")}catch(e){i.reportError(e)}},getDefaultDisplayItem:function(){return this.getRootItem()},getRootItem:function(){return i.vmMain.root.peek()},setRootItem:function(e,t){try{i.PAssert(4329,void 0===e.parent(),"Root should never have a parent")}catch(e){i.reportError(e)}try{i.PAssert(4330,this.getItem()!==e,"Should not be setting root to the same value")}catch(e){i.reportError(e)}this.setItem(e,t)},onTapSection:function(e){i.vmMain.vmPicker.onTapSection(e)},scrollFromMousePosition:function(e){var t,r=this.getHeight()-n.MobileBottomHeight,a=r-80,s=e-this.contentTop();s<80?(t=3*-(1-i.computeScrollSpeed(0,80,s)),i.repeatScroll(t,this)):s>=a?(t=3*i.computeScrollSpeed(a,r,s),i.repeatScroll(t,this)):i.cancelRepeatScroll()},getContentElement:function(){return this.paneContent},getPaneIcon:function(){return"icon-align-left"},itemHasChildren:function(){return this.getItem().numItems()>0},getItem:function(){return this.item.get()},allowZoom:function(e){return!0},performOverviewAction:function(e){},setItem:function(e,t){this._numItemSets++;var i=this.getItem();this.item.set(e,!1),this.updateItemsImmediate(!0,!1,!0),i.parent()&&i._updateStylePadding(i.parent().levelsDeep.get(),!0),t&&(e.itemChanged.notify(),e!==i&&i.itemChanged.notify(),this.item.notify(e,i))},getItemSearchParams:function(){return{item:this.getItem(),comparator:this.search.isMatched,noCollapsed:!0,includeNotes:!0,pane:this}},getHeaderSearchParams:function(){return{item:this.getRootItem(),comparator:this.search.isMatched,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}},setItemsDirty:function(){this._setDirtyState(!1,!1)},isItemsDirty:function(){return!!this.itemsDirtyState},_setDirtyState:function(e,t){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=e||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=t||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:e,forceNotify:t}},updateItems:function(e,t){this._setDirtyState(e,t),i.vmMain.updateAllItems()},updateItemsImmediate:function(e,t,n){if(this.isActive.get()){this.itemsDirtyState&&(e=e||this.itemsDirtyState.updateSearch,t=t||this.itemsDirtyState.forceNotify,this.itemsDirtyState=void 0),(e||this!==i.focusedPane&&!b.isDropping)&&this.search.update();var r=0,a=this.item.get(),s=[],o=this.getItemSearchParams(),c=o.each,l=!1,d=this;o.each=function(e){e.isNote()&&e.parent()===a||(s.push(e),c&&c(e),e.isArchived()||(e.isComplete()&&r++,!l&&e.isCollapsed(d)&&(l=!0)))},this.runItemSearch(o),this.numCompleteItems.set(r),this.hasCollapsedObs.set(l),this._numItemComputes++,this.setItems(s,t),this.updateHeaders(t||n),this.isInitialized||(this.isInitialized=!0),h.fireEvent("itemsUpdated",[this])}},runItemSearch:function(e){i.searchVMLIs(e)},setItems:function(e,t){!t&&this._searchShowHierarchy===this.search.showHierarchy()&&e.equals(this.items.get())||(this._searchShowHierarchy=this.search.showHierarchy(),this.items.set(e),g.getPane()===this&&g.checkValid())},getParentHeaders:function(){return[this.getRootItem()]},updateHeaders:function(e){var t=this.getParentHeaders(),n=this.getHeaderSearchParams();n.each=function(e){t.push(e)},i.searchVMLIs(n),this._numHeaderComputes++,this.setHeaders(t,e)},setHeaders:function(e,t){!t&&e.equals(this.headers.get())||this.headers.set(e)},clearItems:function(e){this.items.set([],e)},onLoad:function(){this.isLoaded=!0,this.getItemStore()===i.vmMain.itemStoreManager.getDefaultItemStore()&&(h.listen("itemNoteSet",this._infiniteList.handleItemNoteSet),h.listen("itemTextChanged",this._infiniteList.handleItemTextChanged),h.listen("itemBoldChanged",this._infiniteList.handleItemBoldChanged)),this._onAfterLoadedRAF=requestAnimationFrame(this.onAfterLoaded.bind(this))},onInfiniteListLoaded:function(){},onAfterLoaded:function(){this._onAfterLoadedRAF=void 0,this._didInitialScroll||this.isDestroyed()||(isNaN(this.initialOffset)&&(this.initialOffset=this.defaultOffset),0!==this.initialOffset&&this.setScrollOffset(this.initialOffset),this._didInitialScroll=!0,this._infiniteList.saveScrollOfTop())},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){if(!l.mobile&&this.isExpanded.get())return n.ExpandedPaneWidth;var e=this.rect.get().width;try{i.PAssert(4331,e>100,"Pane width is not set",this.rect.get())}catch(e){i.reportError(e)}return e>100?e:l.mobile?l.windowWidth():void 0},getHeight:function(){return this.rect.get().height-this.headerHeight()},getLeft:function(){return this.rect.get().left},toggleOverviewVisibility:function(){this.getOverview().toggleDesktop()},notifyDropFrom:function(e){},notifyDropFromToEdit:function(e,t){if(!e.hasChildren()&&e.hasAttachmentType(n.PluginType.Storage)){return e.getAttachmentByType(n.PluginType.Storage).getPlugin().notifyDropFromToEdit(e,t)}var i=document.createElement("ul");return i.innerHTML=r.toDropHtml(e),i},dropEffectCopyBehavior:function(e,t){return e.clone(t,ChangeType.Local)},convertElementToText:function(e){var t="";if("TEXTAREA"===e.nodeName)t+=e.value;else if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=n.AttachChar;else for(var i=0;i<e.childNodes.length;i++)t+=this.convertElementToText(e.childNodes[i]);return t},onInputAndroid:function(e){if(e.target&&i.findParent(e.target,"item")===g.getStartElement()){var t=this.convertElementToText(e.target),n=E.getSelectOffsetsInElement(e.target),r=g.getStartIndex(),a=t.indexOf("\n");if(!this._hasDetectedEnterAndroid)if(a>=0)a===n.start&&(i.clearTimeoutOnce("androidInputSetText"),this.setDetectedEnterAndroid(),i.fireKeyEvent(void 0,{normCode:KeyCode.Enter}));else{var s=g.getStartItem();i.timeoutOnce("androidInputSetText",this.onInputSetText,0,s,t,r,n.start,n.end)}}},onInput:function(e){if(g.isValid()){var t=g.getStartItem(),n=this.convertElementToText(e.target),r=E._getSelectionRange(),a=i.getElementParent(e.target),o=E.getSelectOffsetsInElement(a,r),c=g.getStartIndex();this.onInputSetText(t,n,c,o.start,o.end),s.updateAutocomplete(e)}},onInputSetText:function(e,t,i,n,r){this._hasDetectedEnterAndroid||(t=t.replace(new RegExp(TextSpace,"g"),""),this.isSettingText=!0,e.setText(t,!0,ChangeType.Local),t.length>0&&(l.ios?g.selectIndex(i,n,r):l.android||g.selectIndex(i,r)),this.isSettingText=!1,s.updateAutocomplete()),this._hasDetectedEnterAndroid=!1},setDetectedEnterAndroid:function(){this._hasDetectedEnterAndroid=!0,setTimeout(function(){this._hasDetectedEnterAndroid=!1}.bind(this),0)},updateSelectionAndroid:function(e){if(l.android&&!this._hasDetectedEnterAndroid){var t=i.hasClass(e.target,"item")&&e.target.firstElementChild||i.hasClass(e.target,"androidInput")&&e.target;if(t){var n=g.getStartIndex(),r=E.getSelectOffsetsInElement(t);g.setSelection(n,r.start,n,r.end)}}},keydown:function(e){if(e.handled)return!0;if(this.updateSelectionAndroid(e),g.isValid())if(i.autocomplete&&!i.autocomplete.onkeydown(e))i.preventDefault(e),i.stopPropagation(e);else{this.getInfiniteList(!1).reMount(),l.mobile||0!==this.numItems()||i.hasClass(this.paneContent,"loading")||this.addItem(e);try{s.keydown(this,e)||(i.preventDefault(e),i.stopPropagation(e))}catch(t){i.reportError(t,e)}}},keypress:function(e){if(g.isValid()){l.android&&e.normCode===KeyCode.Enter&&this.setDetectedEnterAndroid();try{s.keypress(this,e)||(i.preventDefault(e),i.stopPropagation(e))}catch(t){i.reportError(t,e)}}},keyup:function(e){if(i.vmMain.notifyActivity(),g.isValid())try{s.keyup(this,e)||(i.preventDefault(e),i.stopPropagation(e))}catch(t){i.reportError(t,e)}},compositionStart:function(){g.isComposing=!0},compositionEnd:function(e){g.isComposing=!1},addItemToPane:function(e,t){var i=this.getItem();e||(e=""),this.setIgnoreRestoreScroll(!0);var n=i.addItemAtIndex(e,t,this);return v.setSelected([t],this),n},runUnarchive:function(e){var t=function(e){e.isArchived()&&e.parent().unarchiveChild(e,ChangeType.Local)},n=function(){if(e.hasArchivedAncestor())for(var t=e.getCollapsedField(this,!1),i=e.parent();void 0!==i&&(void 0===this.getPerPaneState(i.id,t)&&i.setCollapsed(!1,this,!1),!i.isArchived());)i=i.parent()}.bind(this);e.hasArchivedAncestor()?i.menus.options("An ancestor of this item is still archived. Which items do you want to unarchive?",["Entire Tree","Single Item"],function(r){("Single Item"===r||"Entire Tree"===r)&&(n(),"Single Item"===r?t(e):"Entire Tree"===r&&i.vmMain.runFnOnSubtree(e.getArchivedAncestor(!0),t))}):e.hasArchivedDescendant()?i.menus.options("Which items do you want to unarchive?",["Entire Subtree","Single Item"],function(r){("Single Item"===r||"Entire Subtree"===r)&&(n(),"Single Item"===r?t(e):"Entire Subtree"===r&&i.vmMain.runFnOnSubtree(e,t))}):(n(),t(e)),g.reset()},archiveItem:function(e,t){return t.parent().archiveChild(t,ChangeType.Local)},archiveSelected:function(){var e=0,t=this.indexOfPrevVMLI(g.getStartIndex(),!0,!0);if(i.vmMain.applyToSelection(function(t){this.archiveItem(!0,t)&&e++}.bind(this)),e>0){if(t<0&&this.numItems()>0&&(t=this.indexOfFirstItem()),t>=0){var n=this.itemAtIndex(t),r=n.getParsedText().length;g.selectIndex(t,r)}var a=e>1?" items.":" item.";i.toasts.pushMessage({text:"Archived "+e+a,action:MessageAction.Undo,hold:l.mobile,timeout:l.mobile?void 0:8e3})}},deleteSelected:function(e,t){var n=this.indexOfPrevVMLI(g.getStartIndex(),!0,!0);if(i.vmMain.applyToSelection(function(t){e&&!e(t)||t.deleteSelf(ChangeType.Local)}),n<0&&this.numItems()>0&&(n=this.indexOfFirstItem()),n>=0){var r=this.itemAtIndex(n);if(r){var a=r.getParsedText().length;g.selectIndex(n,a)}else g.reset()}},handleLeftSideTap:function(e,t){if(this.supportCollapsing)if(l.mac&&t.metaKey||!l.mac&&t.ctrlKey)i.vmMain.zoomin(e);else if(e.isCollapsible()){var n=g.save();e.toggleCollapsed(this),n&&(l.mobile?n.startItem&&!n.startItem.isDescendantOf(e)||i.closeKeyboard():this.restoreSelectionAfterCollapse(n,e))}},handleRightSideTap:function(e){this.supportCompleting&&e.isComplete(!e.isComplete(),ChangeType.Local)},onClickTitle:function(e){i.vmMain.zoomout(e),i.sendEvent("Menu","Title")},onDoubleClickTitle:function(){this.toggleCollapseAll()},onTap:{onStart:function(e){if(this._disableClick)return void i.preventDefault(e);if(!i.findParent(e.target,"itemNotInPane")&&!i.hasClass(e.target,"androidInput")){var t;if(this.getInfiniteList(!1).reMount(),this.getInfiniteList(!0).reMount(),l.mobile&&(l.useCustomScroller&&i.preventDefault(e),i.touchHoldTimeout&&clearTimeout(i.touchHoldTimeout),y.isInMultiselect()||this.isOverviewVisible()||this.useCustomScroller&&this.getiScroller()&&this.getiScroller().moved||(t=i.dataFor(e.target,!0))&&t!==this&&(i.touchHoldTimeout=setTimeout(this.onTouchHoldTimeout,i.isKeyboardOpen?i.iOSDragTimeKeyboardOpen:i.iOSDragTime,e))),!(l.mobile&&y.start(e)||(g.setFocusedPane(this),t=i.dataFor(e.target,!0),l.mobile&&t===this&&(t=i.focusedPane.getLastItem()),t===this))){var n=i.getIndexForElement(e.target);t&&t.onStart&&t.onStart(n,e)}}},onMove:function(e){if(!i.findParent(e.target,"itemNotInPane")&&!i.hasClass(e.target,"androidInput")){if(l.mobile&&i.touchHoldTimeout&&(clearTimeout(i.touchHoldTimeout),i.touchHoldTimeout=void 0),i.autocomplete&&l.mobile&&i.autocomplete.hide(),!l.mobile||!y.update(e)){var t=i.dataFor(e.startSrc,!0),n=!1;l.mobile&&t===this&&(t=i.focusedPane.getLastItem(),n=!0),b.isDragging&&(t=b.dragItem),t&&t.onMove&&t.onMove(e,n)}return!1}},onClick:function(e){if(!(i.findParent(e.target,"itemNotInPane")||i.hasClass(e.target,"androidInput")||l.mobile&&y.onClickPane(e))){var t,n=i.dataFor(e.startSrc,!0);l.mobile&&n===this&&i.hasClass(e.startSrc,"paneScroller")&&(n=i.focusedPane.getLastItem(),t=i.focusedPane.numItems()-1,(n&&e.clientX<n.getPadding(this)||e.clientX>this.getWidth()-i.SPThresholdRight)&&(n=void 0)),n&&(e.targetItem=n),n&&n.onClick?(void 0===t&&(t=i.getIndexForElement(e.startSrc)),this.onClickItem(t,n,e)):(this.addIfEmpty(e),i.hasClass(e.startSrc,"paneDataPageLoad")||e.startSrc.parentElement&&i.hasClass(e.startSrc.parentElement,"paneDataPageLoad")?this.getItem().hasPaginationToken()&&this.requestDataPage(this.getItem()):i.hasClass(e.startSrc,"agendaCollapser")||l.mobile&&i.hasClass(e.startSrc,"dateHeader")||i.preventDefault(e))}},onEnd:function(e){if(!i.findParent(e.target,"itemNotInPane")&&!i.hasClass(e.target,"androidInput")){l.mobile&&i.touchHoldTimeout&&(clearTimeout(i.touchHoldTimeout),i.touchHoldTimeout=void 0),l.mobile&&!this.isOverviewVisible()&&y.end(e);var t=e.targetItem||i.dataFor(e.startSrc,!0);l.mobile&&t===this&&(t=i.focusedPane.getLastItem()),b.isDragging&&(t=b.dragItem),t&&("paneContent"===e.startSrc.id&&i.preventDefault(e),t&&t.onEnd&&t.onEnd(e))}},onDoubleClick:function(e){if(!i.findParent(e.target,"itemNotInPane")){var t=i.dataFor(e.startSrc,!0);if(t&&t.onDoubleClick){var n=i.getIndexForElement(e.startSrc);this.onDoubleClickItem(n,t,e)}}},onRightClick:function(e){if(!i.findParent(e.target,"itemNotInPane")&&!i.isDisplayModeActive(DisplayMode.NoRightClick)){g.setFocusedPane(this),this.addIfEmpty(e);var t=i.dataFor(e.target,!0);if(t&&t.onRightClick){var n=i.getIndexForElement(e.target);this.onRightClickItem(n,t,e)}o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.RightClick,data:{element:void 0,pane:this}})}}},onClickItem:function(e,t,i){t.onClick(e,i)},onRightClickItem:function(e,t,i){t.onRightClick(e,i)},onDoubleClickItem:function(e,t,i){t.onDoubleClick(e,i)},addIfEmpty:function(e){this.isWriteable&&0===this.numItems()&&this.canAddItem&&!i.hasClass(this.paneContent,"loading")&&this.addItem(e)},addItem:function(e,t){var n=i.focusedPane;if(t=t||"",g.reset(),this.addItemToPane(t,0),l.mobile&&v.setSelected([0],this),n&&n.paneContent){g.focusPane(n);var r=n.indexOfFirstItem();r>=0&&g.selectIndex(r,t.length)}l.mobile&&e&&i.openKeyboardOnIndex(e,n,0,function(){n.onFocus()},function(){n.onBlur()}),i.sendEvent("Menu","AddItemButton")},onClose:function(){},onTapAddItem:function(e,t){l.mobile?this.isOverviewVisible()||(g.setFocusedPane(this),this.getScrollOffset()>this.topBoxHeight.get()?this.setScrollOffset(0,ScrollDuration.Default,function(){this._infiniteList.saveScrollOfTop(),this.onTapAddItem(e,t)}.bind(this)):this.addItem(e,t)):this.addItem(e,t)},onTapOverviewButton:function(){this.toggleOverviewVisibility(),this.isOverviewVisible()?i.sendEvent("Menu","OpenOverview"):i.sendEvent("Menu","CloseOverview")},onTapClosePane:function(){var e=i.vmMain.paneManager.removePane(this);if(e){try{i.PAssert(4332,e===this.id,"Pane IDs must match")}catch(e){i.reportError(e)}o.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:e}),i.sendEvent("Menu","ClosePane"),i.tooltip.hideTip(),this.onClose()}},onTapArchiveCompleted:{onStart:function(e){e.stopImmediatePropagation()},onClick:function(e){this.archiveCompleted(),i.handlerPreventStop(e),i.sendEvent("Menu","ArchiveCompleted")}},onTapRefreshData:{onStart:function(e){e.stopImmediatePropagation()},onClick:function(e){try{i.PAssert(4333,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(e){i.reportError(e)}this.refreshPaneData(),i.sendEvent("Menu","PaneDataRefresh"),i.handlerPreventStop(e)}},onTapReportError:{onStart:function(e){e.stopImmediatePropagation()},onClick:function(e){try{i.PAssert(4334,this.supportReportError,"Pane does not support error reporting")}catch(e){i.reportError(e)}this.reportPaneError(),i.sendEvent("Menu","PaneReportError"),i.handlerPreventStop(e)}},archiveCompleted:function(){var e,t,n;if(g.isValid())for(t=g.getEndIndex();t<this.items.length();){if((n=this.itemAtIndex(t))&&!this.itemAtIndex(t).hasCompletedAncestor()){e=this.objectAtIndex(t);break}t++}var r=[];for(t=0;t<this.numItems();++t)(n=this.itemAtIndex(t))&&n.isComplete()&&!n.isNote()&&r.push(n);for(o.beginAction(),i.vmMain.beginUpdateItems(),t=r.length-1;t>=0;t--)n=r[t],n.parent().archiveChild(n,ChangeType.Local);if(i.vmMain.commitUpdateItems(),o.endAction(),r.length>0){var a=r.length>1?" items.":" item.";i.toasts.pushMessage({text:"Archived "+(r.length+a),action:MessageAction.Undo,hold:l.mobile,timeout:l.mobile?void 0:8e3})}else i.toasts.pushMessage({text:"No completed items to archive"});if(!l.mobile&&e){var s=this.indexOfObject(e);if(s>=0){n=this.itemAtIndex(s);try{i.PAssert(4335,n,"Could not restore selection to item")}catch(e){i.reportError(e)}if(n){var c=n.getParsedText().length;g.selectIndex(s,c)}}}else g.reset()},updatePosition:function(e,t){this.isAnimatingOffset=t,e=Math.round(e),this.offsetX.set(e)},updatePositionMobile:function(){this.updatePosition(this.isOverviewVisible()?y.overviewWidth():0)},bottomListMessage:function(){},isSearchingRemote:function(){return!1},getTitleList:function(){return this.getItem().parents().concat(this.getItem())},itemTitle:function(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem},onShowArchivedChanged:function(){this.showArchived.get()&&h.fireEvent("showArchived",[]),this.updateItems()},indexOfFirstItem:function(){return this.indexOfNextVMLI(-1)},indexOfLastItem:function(){return this.indexOfPrevVMLI(this.numItems(),!1,!0)},getFirstItem:function(){var e=this.indexOfFirstItem();if(e>=0){var t=this.getItems()[e];return t&&(this.itemsAreObjects?t.item:t)}},getLastItem:function(){var e=this.getItems()[this.indexOfLastItem()];return e&&(this.itemsAreObjects?e.item:e)},onBlur:function(){this.isFocused&&this.blurTrigger.notify(),this.isFocused=!1},onFocus:function(){this.isFocused||this.focusTrigger.notify(),this.isFocused=!0},focus:function(){this.paneContent.focus(),this.onFocus(!0)},headerHeight:function(){return l.mobile?0:76},handleUndo:function(){o.undoAction()},handleRedo:function(){o.redoAction()},contentTop:function(){return i.paneTop+this.headerHeight()},indexPageUp:function(e){return e=this._infiniteList.indexPageUp(e),this.itemAtIndex(e)||(e=this.indexOfNextVMLI(e)),e},indexPageDown:function(e){return e=this._infiniteList.indexPageDown(e),this.itemAtIndex(e)||(e=this.indexOfPrevVMLI(e)),e},adjustSelectionFromPaneObject:function(e){try{i.PAssert(4336,e,"Must pass in a valid saved selection")}catch(e){i.reportError(e)}var t=e;return e.startItem&&e.endItem&&(e.startIndex=this.indexOfObject(e.startObject),e.endIndex=this.indexOfObject(e.endObject),(e.startIndex<0||e.endIndex<0)&&(t=void 0)),t},maxWidthOfItem:function(e,t){var n,r;try{i.PAssert(4337,this.getWidth()>0,"Must have a valid pane width")}catch(e){i.reportError(e)}t&&l.mobile?(r=this.getPaddingForItem(e,t),n=y.overviewWidth()-r-i.scrollbarWidth):(r=this.getPaddingForItem(e,t),n=this.getWidth()-r-i.SPThresholdRight);try{i.PAssert(4338,i.isNumber(n)&&n>0,"Must have a valid spanWidth: "+n)}catch(e){i.reportError(e)}return n},restoreSelection:function(e){try{i.PAssert(4339,e,"Must always have a valid saved selection")}catch(e){i.reportError(e)}if(e){var t=this.indexOfObject(e.startObject),n=this.indexOfObject(e.endObject);if(t>=0&&n>=0){var r=e.startOffset,a=e.endOffset,s=e.startItem.getParsedText(),o=e.endItem.getParsedText();(r<0||r>s.length||a<0||a>o.length)&&(r=-1,a=-1),g.selectIndices(t,r,n,a)}else g.reset()}else g.reset()},restoreSelectionAfterCollapse:function(e,t){if(e){var n,r,a=e.startItem,s=this.indexOfItem(e.startItem),o=this.indexOfItem(e.endItem);if(s>=0&&o>=0)g.selectIndices(s,e.startOffset,o,e.endOffset),n=e.startItem;else if(s>=0)g.selectIndex(s,e.startOffset),n=e.startItem,r=!0;else if(o>=0)g.selectIndex(o,e.endOffset),n=e.endItem,r=!0;else if(!0===t)for(n=a;n;){var c=n.parent();if(c===i.focusedPane.item.get()){g.selectItem(n,n===a?g.getStartOffset():-1),r=!0;break}n=c}else g.reset();n&&r&&i.focusedPane.scrollItemToMiddle(n,ScrollDuration.Snap)}},_setCollapsedRecursive:function(e,t){for(var i=e.numChildren(),n=e.getItems(),r=0;r<i;++r){var a=n[r];a.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(a))&&(this.isSearchedFlat()&&!this.search.isMatched(a)||a.setCollapsed(t,this,!1,!this.isSearched()),this._setCollapsedRecursive(a,t))}},toggleCollapseAll:function(){if(this.supportCollapsing){var e=this.item.get(),t=!this.hasCollapsed(),n=g.save();i.vmMain.beginUpdateItems(),this._setCollapsedRecursive(e,t),i.vmMain.paneManager.updatePaneStateForPane(this),this.isSearchedFlat()&&this.updateItems(),i.vmMain.commitUpdateItems(),this.restoreSelectionAfterCollapse(n,t)}},hasCollapsed:function(e){e=e||this.item.get();for(var t=e.numChildren(),i=e.getItems(),n=0;n<t;++n){var r=i[n];if(r.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(r))){if(r.isCollapsed(this,!1))return!0;if(this.hasCollapsed(r))return!0}}return!1},onOverviewToggled:function(e){this.useCustomScroller&&(e?this.getiScroller().disable():(this.getiScroller().enable(),this._disableClick=!1))},onTouchHoldTimeout:function(e){i.touchHoldTimeout=void 0,i.isKeyboardOpen&&!this.isOverviewVisible()&&this.useCustomScroller&&this.getiScroller().disable(),y.disable(),h.fireEvent("touchHoldTimeout",[e])},getPaddingForItem:function(e,t){var n=e.getPadding(this,t);return n>this.getWidth()-i.SPThresholdRight&&(n=this.getWidth()-i.SPThresholdRight-8),n},getSpanWidthForItem:function(e){return e.getSpanWidth(this)},indexOfPrevVMLI:function(e,t,n){try{i.PAssert(4340,e>=0,"Must supply a valid selection index: "+e)}catch(e){i.reportError(e)}try{i.PAssert(4341,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(e){i.reportError(e)}if(this.itemsAreObjects){for(var r=t?this.itemAtIndex(e):void 0,a=e-1;a>=0;){var s=this.itemAtIndex(a);if(s&&r!==s&&(!n||!s.isNote()))return a;a--}return-1}var o=e>0?e-1:-1;if(n&&o>=0){this.itemAtIndex(o).isNote()&&(o>=1?o--:o=-1)}return isNaN(o)?-1:o},indexOfNextVMLI:function(e,t,n){try{i.PAssert(4342,e>=-1,"Must supply a valid selection index: "+e)}catch(e){i.reportError(e)}try{i.PAssert(4343,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(e){i.reportError(e)}if(this.itemsAreObjects){for(var r=t?this.itemAtIndex(e):void 0,a=e+1;a<this.numItems();){var s=this.itemAtIndex(a);if(s&&r!==s&&(!n||!s.isNote()))return a;a++}return-1}var o=e<this.numItems()-1?e+1:-1;if(n&&o>=0){this.itemAtIndex(o).isNote()&&(o<this.numItems()-1?o++:o=-1)}return isNaN(o)?-1:o},_getPrevNextItem:function(e,t,i){var n=i?this.indexOfNextVMLI:this.indexOfPrevVMLI,r=n.call(this,e);if(t)for(var a=this.itemAtIndex(e);r>=0;){var s=this.itemAtIndex(r);if(a.parent()===s.parent())return s;if(a.parent()===s||s.parent()===a.parent().parent()){r=-1;break}r=n.call(this,r)}else if(r>=0)return this.itemAtIndex(r)},getPreviousItem:function(e,t){return this._getPrevNextItem(e,t,!1)},getNextItem:function(e,t){return this._getPrevNextItem(e,t,!0)},getFirstSelectedItem:function(){var e
;return this.applyToSelection(function(t){return e=t,!1}),e},getFirstSelectedIndex:function(){return g.getStartIndex()},applyToSelection:function(e,t){y.isInMultiselect()?v.applyFnToSelected(e,this):i.vmMain.applyToSelection(e,t)},applyPriorityToSelection:function(e,t){t?i.vmMain.applyFnToSelection("priority",{toggle:!0,value:e,value2:ChangeType.Local,emptyValue:VMLIFlag.None}):i.vmMain.applyFnToSelection("priority",{value:e,value2:ChangeType.Local})},autocompleteTag:function(){var e={mode:"tag",text:"Add tag",buttonText:"Add"};this._autocompletePopup(e,function(e,t){var i=t.value.trim(),n=e.getParsedText()+" "+TagPrefix+i;e.setText(n,!0,ChangeType.Local)}.bind(this))},autocompleteDate:function(){var e={mode:"date",text:"Choose date",buttonText:"Schedule"};this._autocompletePopup(e,function(e,t){var i=t.value.trim(),n=e.getParsedText()+" "+DatePrefix+i;e.setText(n,!0,ChangeType.Local)})},autocompleteMove:function(e,t){e=e||{},e.mode=n.AutocompleteMode.Move,e.text="Select item to move to",e.buttonText="MOVE",this._autocompletePopup(e,function(e,t){var i;t.subItemText?(i=r.createVMLI({text:t.subItemText},{parent:t.item,changeType:ChangeType.AllLocal}),t.item.insertItem(i,0)):t.item===e||t.item.isDescendantOf(e)||(i=t.item),i&&this.moveItem(e,i)}.bind(this),function(){t&&t(),g.updateCaret()}.bind(this))},autocompleteJump:function(e,t){e=e||{},e.mode=n.AutocompleteMode.Jump,e.text="Select item to jump to",e.buttonText="JUMP",this._autocompletePopup(e,function(e,t){}.bind(this),function(e){e.item&&this.indexOfItem(e.item)>=0&&(g.selectItem(e.item,0,0),this.scrollItemToTop(e.item,ScrollDuration.Default)),t&&t(),g.updateCaret()}.bind(this))},autocompleteSnooze:function(e,t,r){var a,s=i.vmMain.pluginManager.getPlugin(PluginID.Gmail);if(!t){var o=e&&e.item||this.getFirstSelectedItem();o&&(a=o.getAttachmentByPlugin(s.id))&&(t=a.getField("accountID"))}var c=function(){var t=e&&e.elementDisplay;if(!t){var n=this.getFirstSelectedIndex();t=this.elementAtIndex(n)}i.menus.openContextMenuReact({componentName:"ReactContextMenuAuthorize",element:t,message:"Snooze requires server access to your account so Moo.do can manage your inbox while you're not around. Please enable Offline Features to enable Snooze."})}.bind(this),l=i.settings.get(Settings.enableOfflineAuth);T.isConnected()?l?(i.toasts.clearMessage(MessageID.SnoozeOffline),e=e||{},e.mode="snooze",e.text="Snooze until date",e.buttonText="SNOOZE",e.allowCustom=!0,this._autocompletePopup(e,function(e,t){s.beginAction();var r=t.value.trim(),o=d.parseDateDefaultFormat(r);if(a=e.getAttachmentByPlugin(s.id))if(i.isDateValid(o))if(T.isLinkedAccountAuthorized(a.getField("accountID"),GScope.GmailModify)){var l=o.getTime()-Date.now();l<i.weeks(1)?s.performAction(n.PluginAction.Gmail.Snooze,!1,a,l):i.toasts.pushMessage({text:"Maximum snooze delay is one week. Please enter a date less than a week from now.",action:MessageAction.Okay})}else i.menus.closeContextMenuReact(),c();else i.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:MessageAction.Okay});else i.toasts.pushMessage(MessageID.ReselectEmail);s.endAction()}.bind(this),r)):c():i.toasts.pushMessage(MessageID.SnoozeOffline)},autocompleteSchedule:function(e,t){e=e||{},e.mode="date",e.text="Add event on date",e.buttonText="Add",e.allowCustom=!0;var n=i.vmMain.pluginManager.getPlugin(PluginID.Gmail);this._autocompletePopup(e,function(e,t){o.beginAction();var r=t.value.trim(),a=d.parseDateDefaultFormat(r);i.isDateValid(a)?n.scheduleEmail(e,a):i.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:MessageAction.Okay}),o.endAction()}.bind(this),t)},autocompleteLabel:function(e,t){function r(e){var t=e.getAttachmentByPlugin(a.id),n=t.getPlugin().getDisplayTags(t);s=s?i.arrayIntersection(s,n):n}var a=i.vmMain.pluginManager.getPlugin(PluginID.Gmail);e=e||{};var s;e.item?r(e.item):this.applyToSelection(r),e.tokens=(s||[]).map(function(e){return{text:e}}),e.mode=n.AutocompleteMode.GmailLabel,e.text="Select a label",e.buttonText="LABEL",e.allowCustom=!0,e.allowEmpty=!0,e.onTokenRemoved=function(r){function s(e){var t=e.getAttachmentByPlugin(a.id);if(t)if(a.attachmentHasLabel(t,o))a.performAction(n.PluginAction.Gmail.RemoveLabel,!1,t,o);else try{i.PAssert(4344,!1,"Tried to remove a tag from an attachment without a tag")}catch(e){i.reportError(e)}else i.toasts.pushMessage(MessageID.ReselectEmail)}var o=r.text;a.beginAction(),e.item?s(e.item):this.applyToSelection(s),a.endAction(),t&&t(r)}.bind(this),this._autocompletePopup(e,function(e,t){var r=t.value.trim();try{i.PAssert(4345,e.hasPluginAttachment(a.id),"Must have valid plugin attachment")}catch(e){i.reportError(e)}var s=e.getAttachmentByPlugin(a.id);if(s){var o=a.createLabelString(r);o?a.attachmentHasLabel(s,o)||a.performAction(n.PluginAction.Gmail.AddLabel,!1,s,o):i.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:MessageAction.Okay})}else i.toasts.pushMessage(MessageID.ReselectEmail)}.bind(this))},_autocompletePopup:function(e,t,i){if(!l.mobile&&!e.elementDisplay){var n=g.getStartIndex(),r=this.elementAtIndex(n);e.elementDisplay=r}e.onSelected=function(n){e.item?t(e.item,n):this.applyToSelection(function(e){t(e,n)}),i&&i(n)}.bind(this),P.showPopup(e)},moveItem:function(e,t){if(o.beginAction(),i.vmMain.beginUpdateItems(),t.belongsToSameItemStore(e))e.moveTo({parent:t,index:0},ChangeType.Local);else try{i.PAssert(4346,!1,"Currently do not support moving items between item stores")}catch(e){i.reportError(e)}i.vmMain.commitUpdateItems(),o.endAction()},setPropDefault:function(e,t){void 0===this[e]&&(this[e]=t)},setExpanded:function(e,t){var n=this.isExpanded.get()!==e;this.isExpanded.set(e),n&&!1!==t&&(h.fireEvent("panesChanged",[]),i.vmMain.paneManager.updatePaneStateForPane(this),i.vmMain.paneManager.ensurePaneInView(this))},canAcceptDragOver:function(e,t,i,n){return this.isDropTarget},handleDragOver:function(e,t,n,r,a){var s,o=i.getElementParent(n),c=o&&i.getItemForElement(o);return o&&i.findParent(o,"overviewList")?(this.overview.updateDragHoverItem(c),s={overview:!0,targetItem:c,targetElement:o}):this.overview&&(this.overview.updateDragHoverItem(null),s=this._handleDragOverPane(e,t,n,o,c,r,a)),s},_handleDragOverPane:function(e,t,r,a,s,o,c){var d,h,u,p,m=!1,f=n.DragDropPosition.Below,g=!1,v=0;if(s){p=i.getReactCellForElement(a).getIndex(),s.isNote()&&(a=this.elementAtIndex(p-1),s=s.parent());var y=a.getBoundingClientRect();s.hasNote()&&(v=this.sizeOfItem(s.getNote()));var b=y.height+v;f=l.mobile?c<y.top+b/2?n.DragDropPosition.Above:n.DragDropPosition.Below:this.isSearchedFlat()&&this.search.isFlatSearchResult(s)?n.DragDropPosition.On:c<y.top+b/3?n.DragDropPosition.Above:c>y.top+2*b/3?n.DragDropPosition.Below:n.DragDropPosition.On,h=a,m=!0}else if(0===this.numItems())s=this.getItem(),g=!0;else if(l.mobile||!this.isSearchedFlat()&&i.findParent(r,"paneScroller")){var S=this.indexOfLastItem();if(!m&&S>=0&&this.isIndexMounted(S)&&(u=this.elementAtIndex(S),c>=u.getBoundingClientRect().bottom)){var E=this.getLastItem();s=E,h=u,f=n.DragDropPosition.Below,m=!0}}if(!m&&!this.isSearchedFlat()){var C=this&&this.indexOfFirstItem();if(this&&C>=0&&this.isIndexMounted(C)&&(u=this.elementAtIndex(C),c<u.getBoundingClientRect().top)){s=this.getFirstItem(),h=u,f=n.DragDropPosition.Above,m=!0}}if(m){var P=h.getBoundingClientRect(),T=f!==n.DragDropPosition.Below?P.top:P.top+P.height+v,D=f===n.DragDropPosition.On?P.height:void 0;if(T>this.contentTop()){var M;f===n.DragDropPosition.Below&&p+1<this.numItems()&&s.hasChildren()&&(M=this.itemAtIndex(p+1)),M=M||s;var _=this.getPaddingForItem(M);d={left:P.left+_,top:T,width:P.right-P.left-_,height:D}}}return this.scrollFromMousePosition(c),{position:f,targetElement:h,targetItem:s,linePosition:d,overview:!1,dropOnPane:g}},handleDragDrop:function(e,t,i,n){i&&e!==i.targetItem&&i.targetItem&&this._handleDragDrop(e,t.dataTransfer,i,n),this.revertDrag()},_handleDragDrop:function(e,t,r,a){for(var s=r.overview,c=!0,l=e,d=r.targetItem,u=d.parent();u&&c;)u===e&&(c=!1),u=u.parent();if(c){this.indexOfItem(e);if(c){var p,m=-1;if(s)p=d,m=p.numChildren();else if(r.dropOnPane)p=d,m=0;else if(r.position===n.DragDropPosition.Above)p=d.parent(),m=d.getIndex();else if(r.position===n.DragDropPosition.On)p=d,m=d.numItems();else{var f=this.indexOfItem(d),g=this.getNextItem(f);g&&g.parent()===d?(p=d,m=0):(p=d.parent(),m=d.getIndex()+1)}o.beginAction();try{i.PAssert(4347,p,"Trying to move without a target")}catch(e){i.reportError(e)}try{i.PAssert(4348,!isNaN(m),"Trying to move without a target index")}catch(e){i.reportError(e)}var v=!0;if(t.dropEffect===n.DropEffect.Move){var y=e.parent();if(y){var b=e.getIndex();y.belongsToSameItemStore(p)?(e.moveTo({parent:p,index:m},ChangeType.Local),o.performAction(TrackerType.Move,{itemID:e.id,oldParent:y.id,oldPosition:b,newParent:p.id,newPosition:m})):(e=e.clone(p,ChangeType.Local),p.insertItem(e,m),y.removeChildAtIndex(b,ChangeType.Local))}else e=e.clone(p,ChangeType.Local),p.insertItem(e,m)}else a||(e=t.pane?t.pane.dropEffectCopyBehavior(e,p):e.clone(p,ChangeType.Local)),e?(e.parent(p),p.insertItem(e,m)):v=!1;v&&(h.fireEvent("droppedItem",[l,this,t.pane]),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DropItem,data:{itemID:e.id,toPane:this,fromPane:t.pane}})),o.endAction(),v&&t.pane&&t.pane.notifyDropFrom(e,this)}}},revertDrag:function(){this.overview&&this.overview.updateDragHoverItem(null)},isItemHeader:function(e,t){return t?e.hasHeaderChildren():e.hasVisibleChildren(this)},onNotePopupClosed:function(){},openNoteContextMenu:function(){var e=g.getStartItem(),t=g.getStartIndex(),r=t-1,a=g.getStartOffset(),s=g.getEndOffset(),o=this.elementAtIndex(t);if(o){try{i.PAssert(4349,o.firstChild,"Opening a note should have a firstChild",i.getElementPath(o))}catch(e){i.reportError(e)}o.firstChild&&(o=o.firstChild),void 0!==a&&void 0===s&&(s=a);var c={componentName:"ReactNotePopup",onClosed:this.onNotePopupClosed.bind(this),element:o,item:e.parent(),note:e,pane:this,index:t,position:"fill",selectionStart:a,selectionEnd:s};if(i.menus.isContextMenuOpen()&&i.menus.closeContextMenuReact(),l.mobile){this._editingNote={note:e,index:t,itemIndex:r};var d=e.parent();c.bottom=l.getKBSize(),c.positionOffset={top:-12},this.scrollItemToTop(d,0,function(){i.menus.openContextMenuReact(c,!0),y.setTopBarMode(n.TopBarMode.Note)})}else g.clearSelection(!0),c.positionOffset={left:-4,top:-18},i.menus.openContextMenuReact(c)}},closeNoteContextMenu:function(){if(i.menus.isContextMenuOpen()){if(l.ios){var e=this._editingNote,t=e.note,n=e.itemIndex,r=t.parent(),a=r.getParsedText().length;g.selectIndex(n,a),this._editingNote=void 0}i.menus.closeContextMenuReact()}},canResetMultiselect:function(){return!0},applyAgendaDropToItem:function(e,t,r){var a=e;if(a.isDate){var s=!0;if(t.hasAttachmentType(n.PluginType.Calendar)){var o=t.getAttachmentByType(n.PluginType.Calendar);o&&o.getField("recurringEventId")&&t.getCalendarParsedText()===o.getField("summary")&&(i.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),s=!1)}if(s){var c="",l=t.date();if(i.isDateValid(a.date)){var h=!a.allDay&&(a.dateTime||l&&l.hasTimeOfDay()&&l);c=h?d.getAppendDateText(a.date,h):d.getAppendDateText(a.date)}else c=a.date;if(c){var u=t.getRawText(),p=a.duration?" "+i.round(a.duration,2)+"hr":"";if(c=c.toLowerCase()+p,t.getDateText()){if(t.getDuration()){p=t.getDurationText();var m=u.indexOf(DatePrefix),f=u.indexOf(p,m);u=u.substr(0,f-1)+u.substr(f+p.length)}u=u.replace(t.getDateText(),c)}else u+=" "+DatePrefix+c;t.setText(u,!0,ChangeType.Local);var g=i.vmMain.getDefaultCalendarPlugin();if(i.isDateValid(a.date)&&g&&r!==this&&!t.hasAttachmentType(n.PluginType.Calendar)){if(g.getDefaultExportCalendarID()){var v=i.vmMain.pluginManager,y=PluginSettingsID.GCalendar.SyncDraggedEvents,b=function(){v.getSetting(PluginID.GCalendar,y)&&g.createEventForItem(t)};i.vmMain.shouldShowHelp("syncNewEvents")?i.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",function(e){i.vmMain.closeHelp("syncNewEvents"),v.setSetting(PluginID.GCalendar,y,e),b()}):b()}}}}}else{var S;a.isStarred?t.isStarred(!0,ChangeType.Local):a.p0||a.isImportant?S=VMLIFlag.P0:a.p1?S=VMLIFlag.P1:a.p2&&(S=VMLIFlag.P2),S&&t.priority(S,ChangeType.Local)}},setIgnoreRestoreScroll:function(e){this._ignoreRestoreScroll=e},isIgnoringRestoreScroll:function(){return this._ignoreRestoreScroll},zoomInOnSwipe:function(e){var t=this.item.get();i.vmMain.zoomin(e),i.toasts.pushMessage({text:"<b>Zoomed in to:</b><br>"+e.getParsedText(),action:function(){i.vmMain.zoomin(t)},hold:!1,actionText:"UNDO"})},getSwipeMenuItems:function(){var e=this;return{leftOuter:{text:"Zoom",icon:"icon-zoom-in",color:"#09d",fn:e.zoomInOnSwipe},leftInner:{text:function(t){return e.supportCollapsing&&t.isCollapsible()?t.isCollapsed(e,!1)?"Uncollapse":"Collapse":"Zoom"},icon:function(t){return e.supportCollapsing&&t.isCollapsible()?"icon-"+(t.isCollapsed(e,!1)?"caret-down":"caret-right"):"icon-zoom-in"},color:function(t){return e.supportCollapsing&&t.isCollapsible()?"#777":"#09d"},fn:function(t){e.supportCollapsing&&t.isCollapsible()?(t.toggleCollapsed(e),i.closeKeyboard()):e.zoomInOnSwipe(t)}},rightInner:{text:function(e){return e.isComplete()?"Uncomplete":"Complete"},icon:"icon-check",color:"#0c0",fn:function(t){e.supportCompleting&&t.isComplete(!t.isComplete(),ChangeType.Local)}},rightOuter:{text:"Delete",icon:"icon-delete",color:"#a30",fn:function(e){e.deleteSelf(ChangeType.Local);var t;if(e.hasAttachmentType(n.PluginType.Email)){t=e.getAttachmentByType(n.PluginType.Email).getField("subject")}else t=e.getParsedText();i.toasts.pushMessage({text:"<b>Deleted:</b><br>"+t,action:function(){o.undoAction()},hold:!1,actionText:"UNDO"})}}}},getSwipeMenuItem:function(e,t){var i=l.windowWidth(),n=.16*i,r=.45*i,a=this.swipeMenuItems;return t>r?a.leftOuter:t>n?a.leftInner:t<-r?a.rightOuter:t<-n?a.rightInner:{color:"#ddd"}},_openSelectedInMode:function(e){var t=g.getStartItem();t&&this.openEmailByItem(t,e)},replySelected:function(){this._openSelectedInMode(n.EmailResponseMode.Reply)},replyAllSelected:function(){this._openSelectedInMode(n.EmailResponseMode.ReplyAll)},forwardSelected:function(){this._openSelectedInMode(n.EmailResponseMode.Forward)},openEmailByItem:function(e,t){if(e){var i=e.getAttachmentByPlugin(PluginID.Gmail);(i&&i!==M.getThreadAttach()||!M.isOpenOnPane(this)||t)&&i.getPlugin().openEmailByItem(e,this,t)}},markItemRead:function(e,t){var r=i.vmMain.getDefaultEmailPlugin(),a=t.getAttachmentByPlugin(r.id),s=e?n.PluginAction.Gmail.MarkRead:n.PluginAction.Gmail.MarkUnread;try{i.PAssert(4350,a,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}(e&&r.isItemUnread(t)||!e&&!r.isItemUnread(t))&&r.performAction(s,!1,a)},markReadSelected:function(e){var t=i.vmMain.getDefaultEmailPlugin();t.beginAction(),this.applyToSelection(this.markItemRead.bind(this,e)),t.endAction()},toggleStarSelected:function(){var e,t=i.vmMain.getDefaultEmailPlugin();t.beginAction(),this.applyToSelection(function(r){var a=r.getAttachmentByPlugin(t.id);try{i.PAssert(4351,a,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}var s=t.isItemStarred(r);void 0===e&&(e=s?n.PluginAction.Gmail.Unstar:n.PluginAction.Gmail.Star),(s&&e===n.PluginAction.Gmail.Unstar||!s&&e===n.PluginAction.Gmail.Star)&&t.performAction(e,!1,a)}.bind(this)),t.endAction()},selectIndex:function(e,t){g.selectIndex(e,t||0)},onAdded:function(){this.isEditable&&this.isWriteable&&setTimeout(function(){this.addIfEmpty();var e=this.indexOfFirstItem();e>=0&&g.selectIndex(e,0)}.bind(this),0)},isOverviewVisibleInPane:function(e){var t=this.item.get();return e===t||e.isDescendantOf(t)},getContentWidth:function(){return this.getWidth()},getContentHeight:function(){return this.getHeight()},getMinItemSize:function(){return Math.ceil(S.itemLineHeight()+2*S.itemPadding()+(S.noteLineHeight()+S.itemPadding()))/2},onZoom:function(){this.setScrollOffset(this.defaultOffset)},widthOfDrag:function(){},getSubItems:function(e){var t=[],i={item:e,comparator:this.search.isMatched,pane:this};return i.each=function(e){e.isComplete()||t.push(e)},this.runItemSearch(i),t},getStyledLinesForItem:function(e,t,n){if(e.isNote()){var r=i.escape(e.getParsedText()).replace(/\n|\r\n/g," "),a=Math.min(r.length,200);return r=r.substr(0,a),[r]}var s;try{s=D.measureItem(e,this,n)}catch(e){i.reportError(e)}return s?s.styledLines:[e.getParsedText()]},isItemInPane:function(e){return this.items.get().indexOf(e)>=0},isItemTopLevel:function(e){return e.levelsDeep.get()-this.item.get().levelsDeep.get()==1},checkHeightChanged:function(e,t){return this._infiniteList.checkHeightChanged(e,t)}},a.defineBase(t),i.VMPane=t,t}),define("VMTimelineBlock",["globals","data","util","VMLI","International","Observable"],function(e,t,i,n,r,a){function s(t){this.pane=t.pane,this.date=t.date,this.id=this.dateKey=t.dateKey,this.text=t.name,this.search=this.pane.search,this.items=[],this.isDate=t.isDate,this.isStarred=t.isStarred,this.isImportant=t.isImportant,this.isToday=t.isToday,this.isNow=t.isNow,this.isOverdue=t.isOverdue,this.emptyText=t.emptyText,i.forceBind("toggleCollapsed",this),i.forceBind("heightOfHeader",this);try{e.PAssert(4352,this.id,"Added an agenda block without an id")}catch(t){e.reportError(t)}}return s.prototype={heightOfHeader:function(){return this.isCollapsed()?28:44},heightOfTime:function(){return 20},heightOfEmpty:function(){return 26},_formatDateTime:function(e){return e.toString(r.getFormat(DFormat.ShortTime))},getLastItem:function(){var e=this.items[this.items.length-1];return e&&e.isNote()&&(e=e.parent()),e},showTime:function(e){var t=this.items,i=t[e];if(!this.isDate&&!t[0].isComplete())return!1;if(!this.getLastItem().hasTime()&&!t[0].isComplete())return!1;for(var n=e-1;n>0&&t[n].isNote();)n--;if(n<0)return!0;var r=t[n];return!r||this.getTime(i)!==this.getTime(r)},_getDisplayDateWithDuration:function(e){return e.getDate()?e.getDate().clone().clearTime().equals(this.date)?e.date():e.getEndDate().clone().clearTime().equals(this.date)?e.getEndDate():this.date:e.repeatDate()?e.repeatDate().getDateOnDay(this.date):this.date},getTime:function(e){var t;if(e.dateCompleted)t=this._formatDateTime(e.dateCompleted);else if(e.date())if(e.date().hasTimeOfDay())if(e.getDuration()>0){var i=this._getDisplayDateWithDuration(e);t=i.equals(e.date())?this._formatDateTime(e.date()):i.equals(e.getEndDate())?"Ends "+this._formatDateTime(e.getEndDate()):"All day"}else t=this._formatDateTime(e.date());else t="All day";else e.repeatDate()&&(t=e.repeatDate().hasTimeOfDay()?e.repeatDate().getTime(r.getFormat(DFormat.ShortTime)):"All day");return t},comparePriority:function(e,t){var i=e.priority(),n=t.priority();return i>n?-1:i<n?1:0},compareDate:function(e,t){var i=e.date()||e.repeatDate()&&e.repeatDate().getDateOnDay(this.date),n=t.date()||t.repeatDate()&&t.repeatDate().getDateOnDay(this.date);if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(i&&!n)return-1;if(!i&&n)return 1;if(!i&&!n)return 0;e.getDuration()>0&&(i=this._getDisplayDateWithDuration(e)),t.getDuration()>0&&(n=this._getDisplayDateWithDuration(t));var r=i.clone().clearTime(),a=n.clone().clearTime();if(!r.equals(a))return r<a?-1:1;if(i.hasTimeOfDay()&&n.hasTimeOfDay()){var s=i.getTimeOfDay(),o=n.getTimeOfDay();return s===o?0:s<o?-1:1}return i.hasTimeOfDay()?1:n.hasTimeOfDay()?-1:0},compareOrder:function(e,t){return e.hasAttachments()&&!t.hasAttachments()?-1:t.hasAttachments()&&!e.hasAttachments()?1:-1},compareItems:function(t,i){e.DAssert(t,"Must have a valid left item to compare"),e.DAssert(i,"Must have a valid right item to compare"),e.DAssert(!t||t.parent(),"Must have a valid left parent item"),e.DAssert(!i||i.parent(),"Must have a valid right parent item"),t.isNote()&&(t=t.parent()),i.isNote()&&(i=i.parent());var n=this.isStarred||this.isImportant?0:this.compareDate(t,i);if(0===n){var r=this.isStarred?0:this.comparePriority(t,i);if(0===r){var a=this.compareDate(t,i);return 0===a?this.compareOrder(t,i):a}return r}return n},addItem:function(t){try{e.PAssert(4354,t&&t instanceof n,"Must be adding a valid item: "+e.getObjectInfo(t))}catch(t){e.reportError(t)}this.items.indexOf(t)<0&&this.items.insertSorted(t,this.compareItems.bind(this))},toggleCollapsed:function(){this.pane.setAgendaBlockCollapsed(this,!this.isCollapsed())},isCollapsed:function(){return this.pane.isAgendaBlockCollapsed(this)}},s}),define("PaneObject",["require","globals"],function(e){function t(e){try{i.PAssert(4355,e.id&&e.type&&e.sizeInPane,"Pane object missing properties")}catch(e){i.reportError(e)}for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}var i=e("globals");return t.prototype={},t}),define("VMPane_Timeline",["require","globals","Constants","data","util","platform","DragDrop","VMTimelineBlock","RepeatDate","VMPane","Observable","ObservableComputed","International","Dispatcher","Sel","tracker","PaneObject"],function(e){function t(e){var t=i.vmMain.pluginManager.getPlugin(PluginID.GCalendar),o=t.isActive()&&!i.isDemoMode();this.searchFilters=["header","task","complete","starred","priority"],this.type=PaneMode.Timeline,this.paneClass="paneCalendar",this.contextMenuMode=n.ContextMenuMode.Default,this.paneEmptyMessage="Nothing on the agenda",this.isWriteable=!0,this.isDropTarget=!a.mobile,this.hasNonVMLIs=!0,this.canAddItem=!a.mobile,this.supportCollapsing=!1,this.supportCompleting=!0,this.supportIndent=!1,this.supportOffline=!0,this.supportVertLines=!1,this.supportMultiselect=!1,this.supportBulletZoom=!1,this.supportBulletEdit=!0,this.itemsAreObjects=!0,this.supportDataRefresh=o,this.supportClickOverviewScroll=!1,this.isDraggable=!0,this.titleOfFirstItem=a.mobile?"Agenda":"Calendar",this.overviewTracksScroll=!1,this.retainOverlayAfterDrop=new l(!1),this.dragHoveredBlock=new l,this.viewMode=new l(!a.mobile&&e.viewMode||n.CalendarViewMode.Agenda,this.onViewModeChanged.bind(this)),this.numAllDay=new l(0),a.mobile?this.isShowingOverlay=!1:this.isShowingOverlay=new d([this.retainOverlayAfterDrop,s.isVisible],function(){return this.viewMode.get()===n.CalendarViewMode.Agenda&&(this.retainOverlayAfterDrop.get()||s.isVisible.get()&&s.startPane.supportDates)}.bind(this)),this._super.constructor.call(this,e),this._allPaneItems=[],this.topBoxHeight.set(0,!1),this.displayLocalItems=new l(void 0===e.displayLocalItems||e.displayLocalItems),this.displayCalendars=new l(e.displayCalendars||{}),this.agendaBlocksCollapsed=new l(e.agendaBlocksCollapsed||{}),this.search.itemStoreFilter=ItemStoreFilter.Dates|ItemStoreFilter.Priority,this.dropEffect=function(e){var t=n.DropEffect.Move;return this.isCalendarItem(e)&&(t=n.DropEffect.Copy),t},this.setupViewMode(),r.forceBind("_itemSearchComparator",this),r.forceBind("getDayWidth",this),r.forceBind("onScroll",this),r.forceBind("updateAllDay",this),r.forceBind("scrollToToday",this),this.initTimeline()}var i=e("globals"),n=e("Constants"),r=(e("data"),e("util")),a=e("platform"),s=e("DragDrop"),o=e("VMTimelineBlock"),c=(e("RepeatDate"),e("VMPane")),l=e("Observable"),d=e("ObservableComputed"),h=e("International"),u=e("Dispatcher"),p=e("Sel"),m=e("tracker"),f=e("PaneObject"),g={initTimeline:function(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.updateNextTimeout=0,this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForItem=void 0,this.itemAnimationTimeout=void 0,this._timeoutUpdateAllDay=void 0;var e=i.vmMain.pluginManager.getPlugin(PluginID.GCalendar);e.isActive()&&this.useItemStore(e.getDefaultItemStore());var t=i.vmMain.pluginManager.getPlugin(PluginID.Gmail);t.isActive()&&this.useItemStore(t.getDefaultItemStore()),i.vmMain.pluginManager.listen("pluginActiveChanged",PluginID.GCalendar,r.forceBind("onGCalendarActiveChanged",this)),i.vmMain.pluginManager.listen("pluginActiveChanged",PluginID.Gmail,r.forceBind("onGmailActiveChanged",this)),u.listen("selectionChanged",r.forceBind("_onSelectionChanged",this)),i.settings.listen("settingChanged",Settings.DefaultGroup,Settings.dayWeekStart,this.scrollToToday)},init:function(){this._super.init.call(this)},destroy:function(){u.unlisten("selectionChanged",this._onSelectionChanged),i.settings.unlisten("settingChanged",Settings.DefaultGroup,Settings.dayWeekStart,this.scrollToToday),this.removeScrollListener(this.onScroll),i.vmMain.pluginManager.unlisten("pluginActiveChanged",PluginID.GCalendar,this.onGCalendarActiveChanged),i.vmMain.pluginManager.unlisten("pluginActiveChanged",PluginID.Gmail,this.onGmailActiveChanged),a.mobile||this.isShowingOverlay.destroy(),clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=void 0,this._super.destroy.call(this)},getPaneIcon:function(){return"icon-calendar"},getContextMenuMode:function(e){var t=this.contextMenuMode;return e.hasAttachmentType(n.PluginType.Calendar)&&(t=n.ContextMenuMode.Calendar),t},isItemDraggable:function(e){var t=this.isDraggable;if(e.hasAttachmentType(n.PluginType.Calendar)){var r=e.getAttachmentByType(n.PluginType.Calendar),a=r.getPlugin();i.isDemoMode()||a.hasWritePermissionForAttach(r)||(t=!1)}return t},keydown:function(e){if(p.isValid()&&p.getStartIndex()===p.getEndIndex()&&!m.undoRedoActive){this.preventUpdateItemsForItem=p.getStartObject();var t=p.getStartItem();t&&(t.date()||t.repeatDate())&&t.forceDate(t.date()||t.repeatDate())}this._super.keydown.call(this,e)},clearPreventUpdate:function(){var e=this.preventUpdateItemsForItem;if(e){var t=i.isVMLI(e)?e:e.item;t&&t.forceDate(void 0),this.preventUpdateItemsForItem=void 0}},_onSelectionChanged:function(){if(p.getPane()===this&&this.preventUpdateItemsForItem&&!m.undoRedoActive)if(p.isValid()){if(p.getStartObject().id!==this.preventUpdateItemsForItem.id)if(this.clearPreventUpdate(),a.mobile)setTimeout(this.updateItems,0);else{var e=p.save();i.vmMain.setItemAnimationMode(n.ItemAnimationMode.Move),this.updateItems(),this.restoreSelection(e),clearTimeout(this.itemAnimationTimeout),this.itemAnimationTimeout=setTimeout(function(){i.vmMain.resetItemAnimationMode()},300)}}else this.clearPreventUpdate(),this.updateItems();else this.clearPreventUpdate()},updateItemsImmediate:function(e,t){(!this.preventUpdateItemsForItem||m.undoRedoActive||t||this.itemsDirtyState&&this.itemsDirtyState.forceNotify)&&this._super.updateItemsImmediate.call(this,e,t)},isCalendarItem:function(e){return e.belongsToItemStore(i.vmMain.pluginManager.getPlugin(PluginID.GCalendar).getDefaultItemStore())},isEmailItem:function(e){return e.belongsToItemStore(i.vmMain.pluginManager.getPlugin(PluginID.Gmail).getDefaultItemStore())},_itemSearchComparator:function(e){if(e.isDestroyed())return!1;var t=this.search.isMatched(e)||e.isNote()&&e.parent()&&this.search.isMatched(e.parent())||this.preventUpdateItemsForItem&&e===this.preventUpdateItemsForItem.item,r=!1,a=!1;if(this.isCalendarItem(e)){var s=e.getAttachmentByPlugin(PluginID.GCalendar);s&&("cancelled"===s.getField("status")?a=!0:s.forEachItem(void 0,function(e){e.belongsToItemStore(i.vmMain.pluginManager.getPlugin(PluginID.GCalendar).getDefaultItemStore())||(r=!0)}))}else if(this.isEmailItem(e)&&this.viewMode.get()==n.CalendarViewMode.Agenda){var o=e.getAttachmentByPlugin(PluginID.Gmail);if(o){var c=i.vmMain.pluginManager.getPlugin(PluginID.Gmail);if(c.isItemArchived(e))t=!1;else{var l=c.getAttachmentPriority(o);l!==VMLIFlag.None&&(t=!0)}}}return t&&!r&&!a},getItemSearchParams:function(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.item.get(),comparator:this._itemSearchComparator,noCollapsed:!0,includeArchived:this.showArchived.get(),includeNotes:!0,pane:this}},setItems:function(e){this._allPaneItems=e,this.updateCalendarItems()},onAfterLoaded:function(){this.orientation.get()===n.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY()),this.initialOffset=this.getScrollOffsetOfToday(),this.setIgnoreRestoreScroll(!0),this._super.onAfterLoaded.call(this),this.setIgnoreRestoreScroll(!1),this.addScrollListener(this.onScroll)},getScrollOffsetOfToday:function(){var e,t=this.viewMode.get();if(t===n.CalendarViewMode.Agenda){var i=this.findIndexOfNextBlock();if(i>=0){var r=this.objectAtIndex(i);e=this.topOfIndex(i)+(r.isToday?8:0)}else e=0}else e=t===n.CalendarViewMode.Month?this.heightWeek()*(n.CalendarMonthViewNumWeeksPad+1):this.getDayWidth()*n.CalendarDayViewNumDaysPad+1;return e},_getDateInMiddle:function(){var e=(new Date).clearTime(),t=this.viewMode.get();return t===n.CalendarViewMode.Month?e=this.getMonthStart(e):t===n.CalendarViewMode.Week&&(e=this.getWeekStart(e)),e},scrollToToday:function(e){this.setIgnoreRestoreScroll(!0),this.dateInMiddle=this._getDateInMiddle(),this.updateCalendarItems();var t=this.getScrollOffsetOfToday();e=isNaN(e)?ScrollDuration.Default:e,this.setScrollOffset(t,e),this.orientation.get()===n.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY(),this.scrollElement.scrollTop=0),this.setIgnoreRestoreScroll(!1)},weekCount:function(e,t,i){var n=new Date(e,t,1),r=i?new Date(e,t,i):new Date(e,t+1,0),a=n.getDay()+r.getDate();return Math.ceil(a/7)},scrollJump:function(e,t){t=isNaN(t)?ScrollDuration.Default:t;var r,a,s=this.viewMode.get(),o=this._infiniteList.getScrollOffset(),c=this._infiniteList.indexOfTop(),l=this._infiniteList.objectAtIndex(c),d=o-this.topOfIndex(c);if(s===n.CalendarViewMode.Month){var h=l.date;if(e<0){var u=h.clone().addMonths(-1);r=this.weekCount(h.getFullYear(),h.getMonth(),h.getDate())-1,a=this.weekCount(u.getFullYear(),u.getMonth()),o-=this.heightWeek()*(a+r)+d}else a=this.weekCount(h.getFullYear(),h.getMonth()),r=this.weekCount(h.getFullYear(),h.getMonth(),h.getDate())-1,o+=this.heightWeek()*(a-r)-d}else if(s===n.CalendarViewMode.Week){var p,m=l.date.getDay(),f=i.settings.get(Settings.dayWeekStart);p=e<0?m>f?-m+f:-7:7-m+f,o+=this.getDayWidth()*p-d}else s===n.CalendarViewMode.Day&&(e<0&&d>200?o-=d:o+=this.getDayWidth()*e-d);this.setIgnoreRestoreScroll(!0),this.setScrollOffset(o,t),this.setIgnoreRestoreScroll(!1)},blockCompare:function(e,t){return e.date.compareTo(t.date)},findIndexOfNextBlock:function(){for(var e=new Date,t=this.items.get(),i=0;i<t.length;++i){var n=t[i];if("agendaHeader"===n.type){var r=n.block;if(r.isOverdue||r.isNow||r.isToday||r.isStarred||r.isImportant||r.date>=e)return i}}return-1},_getDateForItem:function(e){var t;if(e.isComplete()&&this.viewMode.get()==n.CalendarViewMode.Agenda)t=e.dateCompleted;else if(i.isDateSoft(e.getDateText()))t=e.getDateText().toUpperCase();else if(e.repeatDate())t=e.repeatDate().getDates();else if(e.date()){var r=e.date();if(e.getDuration()>0){t=[];for(var r=r.clone().clearTime(),a=e.getEndDate().clone().clearTime();r<=a;)r.equals(a)?t.push(e.getEndDate()):t.push(r.clone()),r.addDays(1)}else t=r}return t},_getKeyForDate:function(e){var t,i=Date.today(),n=Math.floor((e-i)/864e5);if(this.combineOverdue&&e<i)t="OVERDUE";else{switch(n){case-1:t="YESTERDAY";break;case 0:t="TODAY";break;case 1:t="TOMORROW";break;default:t=e.toString("dddd")}var r=e.getYear()!==i.getYear(),a=r?DFormat.MonthDayYearLong:DFormat.MonthDayLong,s=h.getFormat(a);t+=" "+e.toString(s)}return t.toUpperCase()},updateCalendarItems:function(e){var t=this.viewMode.get(),i=!1;if(this.updateBlocks(),t===n.CalendarViewMode.Agenda?this.updateAgenda():t===n.CalendarViewMode.Month?this.updateCalendarMonth():(this.updateCalendarWeek(),i=!0),e){var r=this.getScrollOffsetOfToday();isNaN(r)||this._infiniteList.setInitialScrollOffset(r)}this.items.notify(),i&&this.updateAllDay()},getMonthStart:function(e){return e.clone().clearTime().addDays(1-e.getDate())},getWeekStart:function(e){return e.clone().clearTime().addDays(-e.getDay()+i.settings.get(Settings.dayWeekStart))},doesWeekCrossMonth:function(e){if(e.clone().addDays(6).getDate()<e.getDate())return!0},updateCalendarMonth:function(){
var e,t,i,r=[],a=this.dateInMiddle,s=this.getWeekStart(a),o=n.CalendarMonthViewNumWeeksPad;for(i=-1;r.length<o;i--)e=s.clone().addWeeks(i),t=this.doesWeekCrossMonth(e),r.splice(0,0,this.updateCalendarMonthWeek(e,!1,t)),t&&r.length<o&&r.splice(0,0,this.updateCalendarMonthWeek(e,!0,!1));for(o=2*n.CalendarMonthViewNumWeeksPad+1,i=0;r.length<o;i++)e=s.clone().addWeeks(i),t=this.doesWeekCrossMonth(e),t&&r.length<o&&r.push(this.updateCalendarMonthWeek(e,!0,!1)),r.push(this.updateCalendarMonthWeek(e,!1,t));this.items.set(r,!1)},updateCalendarMonthWeek:function(e,t,i){for(var n,r,a=[],s=1===e.getDate(),o=0;o<7;o++){var c=e.clone().addDays(o);n&&c.getDate()<n.getDate()&&(s=!0);if(!(!s&&i||s&&t)){a[o]={date:c};var l=this._getKeyForDate(c),d=this.blocksByKey[l];d&&(a[o].items=d.items),r||(r=c)}n=c}return{type:"calendarWeek",id:"week_"+e+(t?"_end":""),date:r,dates:a,sizeInPane:this.heightWeek}},heightWeek:function(){return n.CalendarMonthViewWeekHeight},getItemsOnDay:function(e){var t=this._getKeyForDate(e),i=this.blocksByKey[t];return i&&i.items||[]},updateCalendarWeek:function(){for(var e=[],t=n.CalendarDayViewNumDaysPad,i=this.dateInMiddle,r=this.viewMode.get(),a=-t;a<t;a++){var s=i.clone().addDays(a),o=this._getKeyForDate(s),c=this.blocksByKey[o],l=c&&c.items||[];e.push({type:"calendarDay",id:r+"_day_"+(a+t),date:s,items:l,sizeInPane:this.getDayWidth})}this.items.set(e,!1)},updateBlocks:function(){var e,t;for(this!==i.focusedPane&&this.search.update(),this.blocks=[],this.blocksByKey={},this.viewMode.get()===n.CalendarViewMode.Agenda&&this.getBlock(Date.today()),e=0;e<this._allPaneItems.length;e++){t=this._allPaneItems[e];var r=!t.isNote();if(r)if(t.hasAttachmentType(n.PluginType.Calendar)){var a=t.getAttachmentByType(n.PluginType.Calendar),s=a.getField("calendarID");r=!1!==this.displayCalendars.get()[s]}else r=this.displayLocalItems.get();r&&this.addToBlock(this._allPaneItems[e])}},updateAgenda:function(){var e,t,i,n=0,r=[];for(i=0;i<this.blocks.length;i++){var a=this.blocks[i];if(a.items.length>0){if(r.push(new f({type:"agendaHeader",block:a,id:a.id,index:n++,isToday:a.isToday?-1:null,isFirstCollapsed:e&&a.isCollapsed()&&!e.isCollapsed(),sizeInPane:a.heightOfHeader})),!this.isAgendaBlockCollapsed(a))for(var s=0;s<a.items.length;s++){t=a.items[s];var o;if(o=!a.isDate||t.repeatDate()||t.isMultidayEvent()?t.id+"_"+a.id:t.id+"_date",a.showTime(s)&&!t.isNote()){var c={type:"agendaTime",text:a.getTime(t),id:o+"_time",block:a,timeItem:t,index:n++,sizeInPane:a.heightOfTime};t.isComplete()&&(c.isComplete=!0),r.push(new f(c))}r.push(new f({type:"agendaItem",item:t,id:o,block:a,index:n++,sizeInPane:t.sizeInPane}))}e=a}}this.items.set(r,!1)},addToBlock:function(e){if(!e.isComplete()&&this.viewMode.get()===n.CalendarViewMode.Agenda){if(e.isStarred()){var t=this.getBlock("STARRED");this.addItemToBlock(e,t)}if(e.isImportant()){var r=this.getBlock("IMPORTANT");this.addItemToBlock(e,r)}}var a=this._getDateForItem(e);if(a&&this._shouldAddToBlock(e))if(i.isArray(a))for(var s=this.search.filterDate.get(),o=0;o<a.length;++o)s&&!a[o].clone().clearTime().equals(s.date)||this.addToDateBlock(e,a[o]);else this.addToDateBlock(e,a)},_shouldAddToBlock:function(e){var t=!0;if(this.viewMode.get()==n.CalendarViewMode.Agenda&&e.hasAttachmentType(n.PluginType.Calendar)&&e.date()<Date.today()){var i=e.getAttachmentByType(n.PluginType.Calendar);i.getPlugin().shouldDisplayOverdueInAgenda()?i.getPlugin().hasWritePermissionForAttach(i)||(t=!1):t=!1}return t},addToDateBlock:function(e,t){var i=this.getBlock(t);i.isOverdue&&e.isComplete()||this.addItemToBlock(e,i)},addItemToBlock:function(e,t){t.addItem(e),e.hasNote()&&t.addItem(e.getNote())},isDateWithinRange:function(e){return!this.startDate||!this.endDate||e>=this.startDate&&e<this.endDate},getBlock:function(e){var t,r,a=e;i.isString(e)?(r=e,e=void 0):r=this._getKeyForDate(e);try{i.PAssert(4357,r,"Undefined key for block",e,a)}catch(e){i.reportError(e)}if(!(t=this.blocksByKey[r])){var s={pane:this,dateKey:r,name:r};if(e&&(s.date=e.clone().clearTime()),i.isString(r)&&0===r.indexOf("TODAY"))s.isToday=!0,s.isDate=!0;else switch(r){case"NOW":s.isNow=!0,s.date=Date.today().add({hours:-1});break;case"STARRED":s.date=Date.today().add({hours:2}),s.isStarred=!0;break;case"IMPORTANT":s.date=Date.today().add({hours:3}),s.isImportant=!0;break;case"NEXT":s.date=Date.today().add({hours:12});break;case"SOON":s.date=Date.today().add({days:1,hours:12});break;case"LATER":s.date=Date.today().add({days:3,hours:12});break;case"SOMEDAY":s.date=Date.today().add({days:14,hours:12});break;case"OVERDUE":s.date=Date.today().add({days:-1}),s.isOverdue=!0;break;default:s.isDate=!0}t=new o(s),this.blocksByKey[r]=t,this.viewMode.get()===n.CalendarViewMode.Agenda&&this.blocks.insertSorted(t,this.blockCompare)}return t},maxWidthOfItem:function(e){return this.getWidth()-i.agendaPadding-i.SPThresholdRight},closestIndexOfObject:function(e){var t,i=["STARRED","NOW","IMPORTANT"];i.some(function(i){if(e.id.indexOf(i)>0)return t=i,!0});for(var n=[],r=this.getItems(),a=0;a<r.length;a++)if(r[a].item===e.item){if(r[a].id===e.id){n=[a];break}n.push(a)}return 1===n.length?n[0]:t?n.filter(function(e){return r[e].id.indexOf(t)>=0})[0]||n[0]:n.filter(function(e){var t=r[e];return!i.some(function(e){if(t.id.indexOf(e)>=0)return!0})})[0]||n[0]},getPaddingForItem:function(e,t){return t?this._super.getPaddingForItem.call(this,e,t):i.agendaPadding},getSpanWidthForItem:function(){return this.getWidth()-i.agendaPadding-i.SPThresholdRight},onGCalendarActiveChanged:function(e,t){this.supportDataRefresh=t;var i=e.getDefaultItemStore();t?this.useItemStore(i):this.stopUsingItemStore(i)},onGmailActiveChanged:function(e,t){var i=e.getDefaultItemStore();t?this.useItemStore(i):this.stopUsingItemStore(i)},refreshPaneData:function(){var e=i.vmMain.pluginManager.getPlugin(PluginID.GCalendar);e.isActive()&&e.forceRemoteEventSync(this.id)},handleRightSideTap:function(e){this._super.handleRightSideTap.call(this,e),a.mobile||(p.reset(),i.vmMain.mousemove&&(p.setHovered(this,null,null),setTimeout(function(){var e=p.mousePos,t=i.elementFromPoint(e.x,e.y);i.vmMain.mousemove({clientX:e.x,clientY:e.y,target:t},!0)},i.itemTransitionTime)))},onViewModeChanged:function(){this.setupViewMode(),this._infiniteList.allocateCells(),this.updateCalendarItems(!0),i.vmMain.paneManager.updatePaneStateForPane(this)},setupViewMode:function(){var e=this.viewMode.get();e===n.CalendarViewMode.Agenda?(this.startDate=Date.today(),this.endDate=void 0,this.combineOverdue=!0,this.orientation.set(n.Orientation.Vertical)):(this.startDate=void 0,this.endDate=void 0,this.combineOverdue=!1),this.orientation.set(e===n.CalendarViewMode.Agenda||e===n.CalendarViewMode.Month?n.Orientation.Vertical:n.Orientation.Horizontal),this.showScrollbars.set(e===n.CalendarViewMode.Agenda),this.isEditable=this.supportSel=e===n.CalendarViewMode.Agenda,this.shouldUpdateOnTextChanged=e===n.CalendarViewMode.Agenda,e===n.CalendarViewMode.Month||e===n.CalendarViewMode.Week?(this.minWidth=900,this.maxWidth=1200):(this.minWidth=n.StdPaneWidthMin,this.maxWidth=n.StdPaneWidthMax),this.dateInMiddle=this._getDateInMiddle(),i.vmMain.paneManager.updatePaneRects()},onScroll:function(){var e=this.viewMode.get();if(e!==n.CalendarViewMode.Day&&e!==n.CalendarViewMode.Week||(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50)),e!==n.CalendarViewMode.Agenda){var t,i=this.indexOfTop(),r=this.getScrollOffset(),a=this.topOfIndex(i),s=this.items.length();(i<s/8||i>7*s/8)&&(this.setIgnoreRestoreScroll(!0),this.dateInMiddle=this._infiniteList.objectAtTop().date,this.updateCalendarItems(),t=e===n.CalendarViewMode.Month?this.heightWeek()*n.CalendarMonthViewNumWeeksPad+(r-a):this.getDayWidth()*n.CalendarDayViewNumDaysPad+(r-a),this._infiniteList.setInitialScrollOffset(t),this.setScrollOffset(t,ScrollDuration.Snap),this.setIgnoreRestoreScroll(!1))}},updateAllDay:function(){for(var e=this.indexOfTop(),t=this.inViewCount(),i=1,n=e;n<e+t;n++){var r=this.items.get()[n];if(r){for(var a=0,s=r.items||[],o=0;o<s.length;o++){var c=s[o],l=c.date()||c.repeatDate();l&&!l.hasTimeOfDay()&&a++}a>i&&(i=a)}}this.numAllDay.set(i)},_handleDragOverPane:function(e,t,r,a,o,c,l){if(e&&e.supportDates&&!i.findParent(r,"paneOverlay")&&i.findParent(r,"paneContent")&&!i.hasClass(r,"paneContent")&&this.viewMode.get()===n.CalendarViewMode.Agenda){var d,h=i.getReactCellForElement(r);return h&&h.props.cell&&(d=h.props.cell.paneObject.block),this.dragHoveredBlock.set(d),s.setAgendaInfo(d),{block:d}}return{}},handleDragDrop:function(e,t,i,n){s.agendaInfo&&s.startPane.applyAgendaDropToItem(s.agendaInfo,e,this),this.retainOverlayAfterDrop.get()||this.revertDrag()},revertDrag:function(){this._super.revertDrag.call(this),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)},getSaveInfo:function(){var e=this._super.getSaveInfo.call(this);return e.viewMode=this.viewMode.get(),e.displayCalendars=this.displayCalendars.get(),e.displayLocalItems=this.displayLocalItems.get(),e.agendaBlocksCollapsed=this.agendaBlocksCollapsed.get(),e},getContentHeight:function(){return 1224+this.getHeightAllDay()+2},getHeightAllDay:function(){return Math.min(n.CalendarDayViewMaxAllDayHeight,27*this.numAllDay.get())},getDayViewY:function(){return 408},getDayWidth:function(){var e=this.getWidth()-50;return this.viewMode.get()===n.CalendarViewMode.Day?e:Math.floor(Math.max(e/7,40))},getMinItemSize:function(){var e=this.viewMode.get();return e===n.CalendarViewMode.Day||e===n.CalendarViewMode.Week?this.getDayWidth():e===n.CalendarViewMode.Month?n.CalendarMonthViewWeekHeight:this._super.getMinItemSize.call(this)},onZoom:function(){this.viewMode.get()===n.CalendarViewMode.Agenda&&this._super.onZoom.call(this)},onInfiniteListLoaded:function(){this.initialOffset||this.viewMode.get()===n.CalendarViewMode.Agenda||(this.initialOffset=this.getScrollOffsetOfToday(),this._infiniteList.setInitialScrollOffset(this.initialOffset))},onTapAddItem:function(e){i.menus.openItemEditor({element:e.target,pane:this,selectIndex:0,addOnSave:!0,openFromBottom:!0,positionOffset:{bottom:8},side:"top left",onClosed:this.resetHovered})},setDisplayLocal:function(e){this.displayLocalItems.set(e),this.updateItems()},setDisplayCalendar:function(e,t){var n=i.clone(this.displayCalendars.get());n[e.id]=t,this.displayCalendars.set(n),this.updateItems()},openItemEditor:function(e){e.pane=this,i.menus.openItemEditor(e)},isAgendaBlockCollapsed:function(e){return!0===this.agendaBlocksCollapsed.get()[e.id]},setAgendaBlockCollapsed:function(e,t){var n=i.clone(this.agendaBlocksCollapsed.get());n[e.id]=t,this.agendaBlocksCollapsed.set(n),this.updateCalendarItems()}};return r.inherit(c,t),r.extend(t.prototype,g),t}),define("VMPane_Archived",["require","Constants","util","VMPane"],function(e){function t(e){this.type=PaneMode.Archived,this.paneClass="paneArchived",this.contextMenuMode=i.ContextMenuMode.Archived,this.isWriteable=!0,this.isEditable=!1,this.isDraggable=!1,this.isDropTarget=!1,this.canAddItem=!1,this.supportCollapsing=!0,this.supportCompleting=!1,this.supportArchiving=!0,this.supportPerformArchive=!1,this.supportIndent=!1,this.supportClone=!1,this.hasMoreButtons=!1,this.titleOfFirstItem="Archived Items",this._super.constructor.call(this,e),this._blocks=[],this._blocksById={},n.forceBind("isItemMatched",this),n.forceBind("itemEach",this),this.initArchived()}var i=e("Constants"),n=e("util"),r=e("VMPane"),a={initArchived:function(){this.showArchived.set(!0)},isItemMatched:function(e){return(e.isArchived()||e.isNote()&&e.parent().isArchived()||e.hasArchivedDescendant()||e.hasArchivedAncestor())&&this.search.isMatched(e)},itemEach:function(e){var t=e.getCollapsedField(this,!1);void 0!==this.getPerPaneState(e.id,t)||e.isNote()||(e.isArchived()&&!e.hasArchivedDescendant()||!e.isArchived()&&e.hasArchivedAncestor()&&!e.hasArchivedDescendant())&&e.setCollapsed(!0,this,!1,!1)},getItemSearchParams:function(){return{item:this.getItem(),comparator:this.isItemMatched,each:this.itemEach,includeArchived:!0,includeNotes:!0,noCollapsed:!0,pane:this}},getHeaderSearchParams:function(){return{item:this.getItem(),comparator:this.isItemMatched,includeArchived:!0,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}},getStatusMessage:function(){return"No archived items"},handleRightSideTap:function(e){this.runUnarchive(e)}};return n.inherit(r,t),n.extend(t.prototype,a),t}),define("PaneFactory",["globals","data","VMPane","VMPane_Timeline","VMPane_Archived","Observable","ObservableArray"],function(e,t,i,n,r,a,s){function o(){this._inactivePaneTypes={},this.activePaneTypes=new s,this._registeredTypes={},this.numInactivePanes=new a(0),this.registerPaneType(void 0,PaneMode.Outline,"Outline",i,"icon-align-left",100),this.registerPaneType(void 0,PaneMode.Timeline,"Calendar",n,"icon-calendar",99),this.registerPaneType(void 0,PaneMode.Archived,"Archived",r,"icon-inbox",90)}return o.prototype={paneSortCompare:function(e,t){return e.priority<t.priority?1:-1},registerPaneType:function(e,t,i,n,r,a){this._registeredTypes[t]={plugin:e,constructor:n};var s={type:t,name:i,icon:r,text:i,priority:a,tooltip:"Add "+i+" Pane"};!e||e.isActive()?this.activePaneTypes.insertSorted(s,this.paneSortCompare):(this._inactivePaneTypes[t]=s,this.numInactivePanes.set(this.numInactivePanes.get()+1))},activatePaneType:function(t){var i=this._inactivePaneTypes[t];try{e.PAssert(4358,i,"Must have previously registered pane type")}catch(t){e.reportError(t)}this._inactivePaneTypes[t]=void 0,this.activePaneTypes.insertSorted(i,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)},deactivatePaneType:function(t){var i=this.activePaneTypes.remove(function(e){return e.type===t})[0];try{e.PAssert(4359,i,"Must have previously activated pane type")}catch(t){e.reportError(t)}e.vmMain.paneManager.removePanesByType(t),this._inactivePaneTypes[t]=i,this.numInactivePanes.set(this.numInactivePanes.get()+1)},canCreatePane:function(e){var t=this._registeredTypes[e];return!(t.plugin&&(!t.plugin.isActive()||t.plugin.isPluginBlocked()))},createPane:function(t,i){if(i=i||{},i.id||(i.id=e.vmMain.paneManager.getNextPaneID()),"PaneTask"===t){t=PaneMode.Outline;var n=i.viewMode;n&&(n.indexOf("Calendar")>=0?(t=PaneMode.Timeline,i.viewMode=n.replace("Calendar_","")):n.indexOf("Agenda")>=0&&(t=PaneMode.Timeline,i.viewMode="Agenda"))}var r=this._registeredTypes[t];if(r){if(!r.plugin||r.plugin.isActive()&&!r.plugin.isPluginBlocked())try{e.vmMain.beginUpdateItems();var a=new r.constructor(i);return e.vmMain.commitUpdateItems(),a}catch(t){return void e.reportError(t)}}else try{e.PAssert(4360,!1,"Invalid pane type requested")}catch(t){e.reportError(t)}},isPaneTypeActive:function(e){var t=!!this._registeredTypes[e],i=!!this._inactivePaneTypes[e];return t&&!i},getRegisteredPanes:function(){return this.activePaneTypes.get()}},new o}),define("PluginSettings",["globals","data","util","platform","goog","tracker","Observable","ObservableArray","AccountManager"],function(e,t,i,n,r,a,s,o,c){function l(){this.pluginsAvailable=[PluginID.Contacts,PluginID.Drive,PluginID.GCalendar,PluginID.Gmail],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new s(!1),this.GCalendarsAvailable=new o,this.GCalendarSyncErrors=new o(void 0),this.GCalendarAddFailure=new s(!1),this.GCalendarListFailure=new s(!1),this.GCalendarListLoading=new s(!1),this.GmailNumSyncd=new s(0),this.GmailNumTotal=new s(0),this.GmailCacheSize=new s(0),this.GmailSyncAccounts=new o,this.enableOfflineAuth=new s(!1),this.isSaveEnabled=new s(!1),this.hasRefreshed=!1,i.forceBind("calendarComparator",this)}return l.prototype={init:function(){var t=e.vmMain.pluginManager.getPlugin(PluginID.GCalendar),i=t.getSetting(t.Settings.ImportCalendars);i&&this.GCalendarsAvailable.set(i)},checkRefresh:function(){this.hasRefreshed||this.refreshPluginStatus()},refreshPluginStatus:function(t){this.hasRefreshed=!0;for(var i=0;i<this.pluginsAvailable.length;++i){var n,r=this.pluginsAvailable[i];n=r===PluginID.Contacts?e.settings.get(Settings.syncContacts):e.vmMain.pluginManager.isAuthorized(r),this.updatePluginStatus(r,n)}t&&t!==PluginID.GCalendar||(this.updatePluginOptionStatus(PluginID.GCalendar,PluginSettingsID.GCalendar.WriteAccess),this.updatePluginOptionStatus(PluginID.GCalendar,PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(PluginID.GCalendar,PluginSettingsID.GCalendar.ExportCalendar)),t&&t!==PluginID.Drive||this.updatePluginOptionStatus(PluginID.Drive,PluginSettingsID.Drive.WriteAccess),this.enableOfflineAuth.set(e.settings.get(Settings.enableOfflineAuth))},refresh:function(e){this.refreshPluginStatus(),e&&e!==PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),e&&e!==PluginID.Gmail||this.updateGmailInfo()},calendarComparator:function(e,t){return e.summary.localeCompare(t.summary)},updateGmailInfo:function(){var t=e.vmMain.pluginManager.getPlugin(PluginID.Gmail);t.getTotalMessageCount(function(e){this.GmailNumTotal.set(e)}.bind(this)),t.getSyncdMessageCount(function(e){this.GmailNumSyncd.set(e)}.bind(this)),this.GmailSyncAccounts.set(t.getSyncAccounts())},updateCalendarList:function(){if(e.vmMain.pluginManager.isAuthorized(PluginID.GCalendar)){var t=e.vmMain.pluginManager.getPlugin(PluginID.GCalendar);this.GCalendarListLoading.set(!0),t.getFullCalendarList(function(e){this.GCalendarListLoading.set(!1,!1),e?(e.sort(this.calendarComparator),this.GCalendarsAvailable.set(e),this.GCalendarListFailure.set(!1)):this.GCalendarListFailure.set(!0)}.bind(this))}},getEnabledPlugins:function(){this.checkRefresh();var e=this._pluginEnabledObservables;return Object.keys(e).filter(function(t){return e[t].get()})},getPluginEnabledObservable:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e]},isPluginEnabled:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e].get()},getPluginOptionObservable:function(e,t){return this.checkRefresh(),this._pluginOptionObservables[e][t]},getPluginOptions:function(e){return this.checkRefresh(),this._pluginOptionObservables[e]},isPluginAnOption:function(e){return e===PluginID.Mailbird?n.embed===EmbedApps.Mailbird:this.pluginsAvailable.indexOf(e)>=0},updatePluginStatus:function(e,t,i){this._pluginEnabledObservables[e]?this._pluginEnabledObservables[e].set(t,i):this._pluginEnabledObservables[e]=new s(t)},updatePluginOptionStatus:function(t,i,n){var r=e.vmMain.pluginManager.getSetting(t,i);this._pluginOptionObservables[t]||(this._pluginOptionObservables[t]={}),this._pluginOptionObservables[t][i]?this._pluginOptionObservables[t][i].set(r||n&&[]):this._pluginOptionObservables[t][i]=n?new o(r):new s(r)},onFailedAuthenticate:function(t){e.toasts.pushMessage({text:"We failed to successfully authenticate you for "+t+", please try again.",actionText:"OKAY"})},_wasPluginAuthorized:function(t,i){var n=!1;if(t===PluginID.Contacts)i.indexOf(GScope.Contacts)>=0&&(n=!0);else{0===e.vmMain.pluginManager.getPlugin(t).verifyAuthorization(e.vmMain.getUserEmail()).length&&(n=!0)}try{e.PAssert(4361,n,"Should always be successful at authorizing plugins")}catch(t){e.reportError(t)}return n},setEnabledPlugins:function(t,i,n){for(var r=0;r<t.length;r++){var a=t[r],s=a.id,o=a.enable,c=this._pluginEnabledObservables[s].get(),l=e.vmMain.pluginManager.getPlugin(a.id);!o&&c&&this.disablePlugin(s),a.id!==PluginID.Drive||a.shared||l.setSetting(PluginSettingsID.Drive.WriteAccess,!1)}this.enableOfflineAuth.set(i),e.settings.set(Settings.enableOfflineAuth,i);var d=t.filter(function(e){return e.enable});this.enablePlugins(d,i,n)},enablePlugins:function(t,i,n){var a=t.map(function(t){var i=t.id,n=e.vmMain.pluginManager.getPlugin(t.id);return n?i===PluginID.Drive?n.googleScopes(t.shared):n.googleScopes():i===PluginID.Contacts?[GScope.Contacts]:void 0}).reduce(function(e,t){return e.concat(t)},[]);if(a&&a.length>0){var s=function(r){r&&!r.error?(this.refresh(),i&&(this.enableOfflineAuth.set(!0),e.settings.set(Settings.enableOfflineAuth,!0)),t.map(function(t){if(t.id===PluginID.Contacts)this.enableSyncContacts();else{var i=e.vmMain.pluginManager.getPlugin(t.id);e.vmMain.pluginManager.onPluginAuthorized(i,!0),t.id===PluginID.Drive&&t.shared&&i.setSetting(PluginSettingsID.Drive.WriteAccess,!0)}try{e.PAssert(4362,this._wasPluginAuthorized(t.id,r.scope),"Plugin "+t.id+" was not authorized properly.")}catch(t){e.reportError(t)}}.bind(this)),this.refresh(),n(!0)):n(!1)}.bind(this);i?r.runAuthenticateOffline(a,s):r.runAuthenticate(a,!1,!1,s)}else this.enableOfflineAuth.set(!0),e.settings.set(Settings.enableOfflineAuth,!0),n(!0)},_enablePlugin:function(t){var i=this._pluginEnabledObservables[t];e.vmMain.pluginManager.authorizePlugin(t,this.enableOfflineAuth.get(),function(n){n?(i.set(!0),this.refresh(t),e.sendEvent(t,"PluginEnabled")):(this.onFailedAuthenticate(t),e.sendEvent(t,"PluginEnableFailed"))}.bind(this))},enablePlugin:function(e){e===PluginID.Contacts?this.enableSyncContacts():this._enablePlugin(e)},disablePlugin:function(i){var n=this._pluginEnabledObservables[i];i===PluginID.Contacts?(e.sendEvent("Settings","DisableContacts"),r.loadedContacts=!1,e.settings.set(Settings.syncContacts,!1),t.clearContacts(),n.set(!1)):e.vmMain.pluginManager.deauthorizePlugin(i,function(){n.set(!1),e.sendEvent(i,"PluginDisabled")})},togglePlugin:function(e){this._pluginEnabledObservables[e].get()?this.disablePlugin(e):this.enablePlugin(e)},togglePluginOption:function(t,i){var n=this._pluginOptionObservables[t][i],r=!n.get();e.vmMain.pluginManager.setSetting(t,i,r),r?e.vmMain.pluginManager.authorizePlugin(t,this.enableOfflineAuth.get(),function(a){a?(e.vmMain.pluginManager.onAuthorizedSetting(t,i,r),n.set(!0),e.sendEvent(t,"OptionEnabled_"+i)):(this.onFailedAuthenticate(i),e.vmMain.pluginManager.setSetting(t,i,!r),e.sendEvent(t,"OptionEnableFailed_"+i))}.bind(this)):(n.set(!1),e.sendEvent(t,"OptionDisabled_"+i))},setPluginOption:function(t,i,n,r,a){var s=this._pluginOptionObservables[t][i],o=s.get();e.vmMain.pluginManager.setSetting(t,i,n),n&&r?e.vmMain.pluginManager.authorizePlugin(t,this.enableOfflineAuth.get(),function(r){r?(e.vmMain.pluginManager.onAuthorizedSetting(t,i,n),s.set(n),e.sendEvent(t,"OptionSet_"+i+"_"+n),a&&a(!0)):(this.onFailedAuthenticate(i),e.vmMain.pluginManager.setSetting(t,i,o),e.sendEvent(t,"OptionEnableFailed_"+i+"_"+n),a&&a(!1))}.bind(this)):(s.set(n),e.sendEvent(t,"OptionSet_"+i+"_"+n),a&&a(!0))},enableOfflineFeatures:function(t){var i=this.getEnabledPlugins(),n=i.map(function(e){return e===PluginID.Drive?{id:e,shared:this.getPluginOptionObservable(e,PluginSettingsID.Drive.WriteAccess).get()}:{id:e}}.bind(this));this.enablePlugins(n,!0,function(i){i?(e.settings.set(Settings.enableOfflineAuth,!0),e.sendEvent("OfflineAccess",!0)):(e.toasts.pushMessage({text:"We failed to successfully authenticate you for offline access.",actionText:"OKAY"}),e.sendEvent("OfflineAccessFailed",!0),this.enableOfflineAuth.set(!1),e.settings.set(Settings.enableOfflineAuth,!1)),t&&t(i)}.bind(this))},toggleOfflineFeatures:function(t,i){t?this.enableOfflineFeatures(i):(c.removeLinkedAccount(e.vmMain.getUserEmail(),function(i){i?(this.enableOfflineAuth.set(!1),e.settings.set(Settings.enableOfflineAuth,t)):e.toasts.pushMessage({text:"There was an error disabling offline authorization. Please try again in a few minutes.",actionText:"OKAY"})}.bind(this)),e.sendEvent("OfflineAccess",!1))},isNotificationsEnabled:function(){return!e.settings.get(Settings.disableNotifications)},toggleNotifications:function(){var t=e.settings.get(Settings.disableNotifications);e.settings.set(Settings.disableNotifications,!t),t?e.timeline.updateNotifications():e.timeline.clearNotifications()},enableSyncContacts:function(t){function i(i){i<0?(e.toasts.pushMessage({text:"There was an error syncing your contacts. Please try again.",actionText:"SYNC",action:function(){this.enableSyncContacts(t)}.bind(this)}),t&&t(!1)):(i>0&&e.vmMain.parseSubtree(e.vmMain.root(),ChangeType.Auto),t&&t(!0))}e.sendEvent("Settings","EnableContacts");var n=function(n){n&&!n.error?(e.settings.set(Settings.syncContacts,!0),this.updatePluginStatus(PluginID.Contacts,!0),r.loadContacts(i.bind(this)),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SyncContacts})):(e.settings.set(Settings.syncContacts,!1),this.updatePluginStatus(PluginID.Contacts,!1),e.toasts.pushMessage({text:"To sync your contacts we need permission to access them. Please try again.",actionText:"SYNC",action:function(){this.enableSyncContacts(t)}.bind(this)}),t&&t(!1))}.bind(this);this.enableOfflineAuth.get()?r.runAuthenticateOffline([GScope.Contacts],n):r.runAuthenticate([GScope.Contacts],!1,!1,n)},onTapRefreshContacts:function(t,i){var n=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),n=r.refreshContacts(function(e){this.isRefreshingContacts.set(!1),i&&i()}.bind(this)),e.sendEvent("Menu","RefreshContacts")),n},onAllDayTimeValid:function(t){this.isAllDayTimeValid(t),t&&this.datesAllDayTime(e.element("settings-allday").value)},addCalendar:function(t){var i=e.vmMain.pluginManager.getPlugin(PluginID.GCalendar);this.GCalendarListLoading.set(!0),i.createCalendar(t,function(e){this.GCalendarListLoading.set(!1),e?this.updateCalendarList():this.GCalendarAddFailure.set(!0)}.bind(this))},notifySyncError:function(e){this.GCalendarSyncErrors.set(e||[])}},new l}),define("Stack",["require"],function(e){function t(){this.stack=[]}return t.prototype={push:function(e){this.stack.push(e)},pop:function(e){this.stack.remove(e)},peek:function(){return this.stack[this.stack.length-1]},contains:function(e){return this.stack.indexOf(e)>=0}},t}),define("Hotkeys",["require","globals","util","platform","Constants","Observable","tracker","DesktopUI","edit","NativeSel","Stack","Sel"],function(e){function t(){function e(e){return(r.mac&&e.metaKey||!r.mac&&e.ctrlKey)&&e.normCode===KeyCode.A}function t(e){if(r.normalizeKeys(e),i.vmMain&&i.vmMain.updateCursorFromEvent(e),r.windows&&ie!==e.normCode&&(e.normCode===KeyCode.D1||e.normCode===KeyCode.D2||e.normCode===KeyCode.D3||e.normCode===KeyCode.D8)){p[e.normCode]&&(re(e),ie=void 0)}}var s=function(){var e=i.focusedPane||i.vmMain.paneManager.getPaneAtIndex(0);if(e){var t=e.search;t.isFocused.get()||t.focus(),i.sendEvent("Hotkey","Search")}},f=function(){i.focusedPane&&i.focusedPane.toggleOverviewVisibility(),i.sendEvent("Hotkey","Overview")},g=function(e){var t=i.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.toggleFilterDefault(e),!0)},v=function(e){var t=i.focusedPane;if(t&&t.search.isFocused.get()){return t.search.getFilter("priority")===e&&(e=0),t.search.setFilter("priority",e),!0}return!1},y=function(){i.focusedPane&&!v(VMLIFlag.P0)&&(i.focusedPane.applyPriorityToSelection(VMLIFlag.P0,!0),i.sendEvent("Hotkey","Important"))},b=function(){i.focusedPane&&!v(VMLIFlag.P1)&&(i.focusedPane.applyPriorityToSelection(VMLIFlag.P1,!0),i.sendEvent("Hotkey","Important"))},S=function(){i.focusedPane&&!v(VMLIFlag.P2)&&(i.focusedPane.applyPriorityToSelection(VMLIFlag.P2,!0),i.sendEvent("Hotkey","Important"))},E=function(){var e=i.focusedPane;e&&(e.search.setShowHierarchy(!e.search.showHierarchy()),i.sendEvent("Hotkey","SearchFlat"))},C=function(){g("starred")||(i.vmMain.applyFnToSelection("isStarred",{toggle:!0,restoreSelection:!0,value2:ChangeType.Local}),i.sendEvent("Hotkey","Star"))},P=function(){if(!g("complete")){var e,t=u.getSelectedItems();if(u.isValid()&&1===t.length&&!t[0].isComplete()&&(e=!0),i.vmMain.applyFnToSelection("isComplete",{toggle:!0,restoreSelection:!0,value2:ChangeType.Local}),e){for(var n=i.focusedPane,r=t[0],a=n.indexOfNextVMLI(u.getStartIndex());a>=0;){if(!n.itemAtIndex(a).isDescendantOf(r))break;a=n.indexOfNextVMLI(a)}a>=0&&u.selectIndex(a,0)}i.sendEvent("Hotkey","Complete")}},T=[KeyCode.D1,KeyCode.D2,KeyCode.D3,KeyCode.D4,KeyCode.D5,KeyCode.D6,KeyCode.D7],D=function(e){var t=T.indexOf(e.normCode);if(t>=0&&t<i.vmMain.paneManager.paneCount()){var n=i.vmMain.paneManager.getPaneAtIndex(t);if(n&&(u.focusPane(n),!u.isValid()&&n.isEditable)){var r=n.indexOfTop();n.selectIndex(r),n.scrollIndexIntoView(r,ScrollDuration.Default)}}},M=function(){i.focusedPane&&i.focusedPane.archiveCompleted(),i.sendEvent("Hotkey","ArchiveCompleted")},_=function(){i.vmMain.applyPrefixToSelection(a.Prefix.Header),i.sendEvent("Hotkey","PrefixHeader")},I=function(e){i.vmMain.applyPrefixToSelection(a.Prefix.Task),i.sendEvent("Hotkey","PrefixTask")},A=function(e){return u.isValid()&&i.vmMain.applyFormatToSelection("**"),e.preventDefault(),i.sendEvent("Hotkey","Bold"),!1},w=function(e){return u.isValid()&&i.vmMain.applyFormatToSelection("*"),e.preventDefault(),i.sendEvent("Hotkey","Italic"),!1},k=function(e){if(u.isValid()){u.getStartItem().insertLinkAtSelection()}return e.preventDefault(),i.sendEvent("Hotkey","InsertLink"),!1},x=function(){i.vmMain.applyToSelection(function(e){return e.isNote()||i.vmMain.zoomin(e),!1}),i.sendEvent("Hotkey","ZoomIn")},R=function(){var e=i.focusedItem;e&&e.parent()&&i.vmMain.zoomout(e.parent()),i.sendEvent("Hotkey","ZoomOut")},O=function(){i.vmMain.applyToSelection(function(e){i.focusedPane.supportCollapsing&&e.toggleCollapsed(i.focusedPane)}),i.sendEvent("Hotkey","Collapse")},L=function(){i.vmMain.applyToSelection(function(e){i.focusedPane.supportCollapsing&&e.setCollapsed(!0,i.focusedPane)}),i.sendEvent("Hotkey","Collapse")},N=function(){i.vmMain.applyToSelection(function(e){i.focusedPane.supportCollapsing&&e.setCollapsed(!1,i.focusedPane)}),i.sendEvent("Hotkey","Collapse")},F=function(){i.focusedItem&&i.focusedPane&&i.focusedPane.supportCollapsing&&i.focusedPane.toggleCollapseAll(),i.sendEvent("Hotkey","CollapseAll")},B=function(){u.isValid()&&(i.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}),i.sendEvent("Hotkey","Indent"))},U=function(){u.isValid()&&(i.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}),i.sendEvent("Hotkey","Unindent"))},H=function(e){var t=i.vmMain.paneManager.removeFocusedPane();void 0!==t&&(o.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:t}),i.sendEvent("Hotkey","ClosePane"),i.tooltip.hideTip(),e.stopImmediatePropagation())},V=function(){i.focusedPane&&u.isValid()&&i.focusedPane.autocompleteMove()},q=function(){var e=i.focusedPane;if(i.focusedPane&&i.focusedPane.type===PaneMode.Outline||(e=i.vmMain.paneManager.getPanesByType(PaneMode.Outline)[0]),e){var t=e.search,n={};t.isFocused.get()?n.elementDisplay=t.getSearchBox():e!==i.focusedPane&&(u.focusPane(e),n.elementDisplay=t.getSearchBox()),e.autocompleteJump(n)}},W=function(){var e=i.vmMain.getDefaultEmailPlugin();e.isEnabled()?i.menus.openComposeEmail(e):i.toasts.pushMessage(MessageID.NeedGmailPermission)},z=function(){if(d.hasRawSelection()&&i.elementInNonPaneEdit(d.getSelectionNode()))return!1;i.focusedPane?i.focusedPane.handleUndo():o.undoAction(),i.sendEvent("Hotkey","Undo")},G=function(){if(d.hasRawSelection()&&i.elementInNonPaneEdit(d.getSelectionNode()))return!1;i.focusedPane?i.focusedPane.handleRedo():o.redoAction(),i.sendEvent("Hotkey","Redo")},j=function(e,t){i.menus.openSidebarMenu(i.element(e),t,!1,!0)},K=function(){j("addPaneButton","ReactContextMenuAddPane")},Y=function(){i.vmMain.dropBucket.hasItems()&&j("dropBucketButton","ReactContextMenuDropBucket")},X=function(){j("newItemButton",{componentName:"ReactItemDetailsPopup",addOnSave:!0})},Q=function(){i.vmMain.applyToSelection(function(e){return i.scrollToAndHighlightItem(e,i.focusedPane),!1}),i.sendEvent("Hotkey","GoTo")},J=function(){c.toggleSidebar(),i.sendEvent("Hotkey","ToggleSidebar")},$=function(){},Z=function(){return!1};this.platformPrimaryKey=r.mac?m.Meta:m.Ctrl,this.platformSecondaryKey=r.mac?m.Ctrl:m.Alt,this.addHotkey("Search",!1,KeyCode.F,a.Primary.Either,a.Shift.No,s),this.addHotkey("Goto",!1,KeyCode.G,a.Primary.No,a.Shift.No,Q),this.addHotkey("Overview",!1,KeyCode.O,a.Primary.No,a.Shift.No,f),this.addHotkey("Complete",!1,KeyCode.Slash,a.Primary.Either,a.Shift.No,P),
this.addHotkey("Complete",!1,KeyCode.Enter,a.Primary.Never,a.Shift.No,P),this.addHotkey("ArchiveCompleted",!1,KeyCode.Slash,a.Primary.Either,a.Shift.Yes,M),this.addHotkey("Priority0",!1,KeyCode.D1,a.Primary.No,a.Shift.No,y),this.addHotkey("Priority1",!1,KeyCode.D2,a.Primary.No,a.Shift.No,b),this.addHotkey("Priority2",!1,KeyCode.D3,a.Primary.No,a.Shift.No,S),this.addHotkey("SelectPane1",!1,KeyCode.D1,a.Primary.Yes,a.Shift.Yes,D),this.addHotkey("SelectPane2",!1,KeyCode.D2,a.Primary.Yes,a.Shift.Yes,D),this.addHotkey("SelectPane3",!1,KeyCode.D3,a.Primary.Yes,a.Shift.Yes,D),this.addHotkey("SelectPane4",!1,KeyCode.D4,a.Primary.Yes,a.Shift.Yes,D),this.addHotkey("SelectPane5",!1,KeyCode.D5,a.Primary.Yes,a.Shift.Yes,D),this.addHotkey("SelectPane6",!1,KeyCode.D6,a.Primary.Yes,a.Shift.Yes,D),this.addHotkey("SelectPane7",!1,KeyCode.D7,a.Primary.Yes,a.Shift.Yes,D),this.addHotkey("Star",!1,KeyCode.D8,a.Primary.Either,a.Shift.Either,C),this.addHotkey("ZoomIn",!1,KeyCode.Enter,a.Primary.Yes,a.Shift.No,x),this.addHotkey("ZoomOut",!1,KeyCode.Enter,a.Primary.Yes,a.Shift.Yes,R),r.mac&&(this.addHotkey("ZoomOut",!1,KeyCode.LeftArrow,a.Primary.Never,a.Shift.No,R),this.addHotkey("ZoomIn",!1,KeyCode.RightArrow,a.Primary.Never,a.Shift.No,x),this.addHotkey("ZoomOut",!1,KeyCode.Comma,a.Primary.Yes,a.Shift.Yes,R),this.addHotkey("ZoomIn",!1,KeyCode.Period,a.Primary.Yes,a.Shift.Yes,x)),this.addHotkey("ToggleCollapse",!1,KeyCode.Space,a.Primary.No,a.Shift.No,O),this.addHotkey("CollapseAll",!1,KeyCode.Space,a.Primary.No,a.Shift.Yes,F),this.addHotkey("ToggleCollapse",!1,KeyCode.Comma,r.mac?a.Primary.Never:a.Primary.No,a.Shift.No,O),this.addHotkey("CollapseAll",!1,KeyCode.Comma,r.mac?a.Primary.Never:a.Primary.No,a.Shift.Yes,F),this.addHotkey("ToggleCollapse",!1,KeyCode.Period,a.Primary.Either,a.Shift.No,O),this.addHotkey("CollapseAll",!1,KeyCode.Period,a.Primary.No,a.Shift.Yes,F),this.addHotkey("Uncollapse",!1,KeyCode.DownArrow,a.Primary.Never,a.Shift.No,N),this.addHotkey("Collapse",!1,KeyCode.UpArrow,a.Primary.Never,a.Shift.No,L),this.addHotkey("Unindent",!1,KeyCode.LBracket,a.Primary.Either,a.Shift.No,U),this.addHotkey("Indent",!1,KeyCode.RBracket,a.Primary.Either,a.Shift.No,B),this.addHotkey("Unindent",!1,KeyCode.LeftArrow,a.Primary.Never,a.Shift.Yes,U),this.addHotkey("Indent",!1,KeyCode.RightArrow,a.Primary.Never,a.Shift.Yes,B);var ee=l.moveUp.bind(l),te=l.moveDown.bind(l);this.addHotkey("MoveUp",!1,KeyCode.UpArrow,a.Primary.Never,a.Shift.Yes,ee),this.addHotkey("MoveDown",!1,KeyCode.DownArrow,a.Primary.Never,a.Shift.Yes,te),r.mac?(this.addHotkey("MoveUp",!1,KeyCode.UpArrow,a.Primary.Both,a.Shift.No,ee,!0),this.addHotkey("MoveDown",!1,KeyCode.DownArrow,a.Primary.Both,a.Shift.No,te,!0),this.addHotkey("MoveUp",!1,KeyCode.UpArrow,void 0,a.Shift.No,ee,!0,!0),this.addHotkey("MoveDown",!1,KeyCode.DownArrow,void 0,a.Shift.No,te,!0,!0)):(this.addHotkey("MoveUp",!1,KeyCode.UpArrow,a.Primary.Never,a.Shift.Yes,ee,!0),this.addHotkey("MoveDown",!1,KeyCode.DownArrow,a.Primary.Never,a.Shift.Yes,te,!0)),r.mac&&(this.addHotkey("Unindent",!1,KeyCode.LeftArrow,a.Primary.Never,a.Shift.Yes,U,!0),this.addHotkey("Indent",!1,KeyCode.RightArrow,a.Primary.Never,a.Shift.Yes,B,!0),this.addHotkey("SelectAll",!1,KeyCode.L,a.Primary.Never,a.Shift.No,l.handleSelectAllItem,!0)),this.addHotkey("ClosePane",!1,KeyCode.F4,void 0,a.Shift.Yes,H),this.addHotkey("Passthrough",!0,KeyCode.Tilde,a.Primary.Either,a.Shift.No,Z),this.addHotkey("Bold",!1,KeyCode.B,a.Primary.Only,a.Shift.No,A),this.addHotkey("Italic",!1,KeyCode.I,a.Primary.Only,a.Shift.No,w),this.addHotkey("InsertLink",!1,KeyCode.K,a.Primary.Only,a.Shift.No,k),this.addHotkey("Save",!0,KeyCode.S,a.Primary.Either,a.Shift.No,$),this.addHotkey("Move",!1,KeyCode.M,a.Primary.Never,a.Shift.No,V),this.addHotkey("Jump",!1,KeyCode.J,a.Primary.Never,a.Shift.No,q),this.addHotkey("Undo",!1,KeyCode.Z,a.Primary.Yes,a.Shift.No,z),this.addHotkey("Redo",!1,KeyCode.Y,a.Primary.Yes,a.Shift.No,G),this.addHotkey("Redo",!1,KeyCode.Z,a.Primary.Yes,a.Shift.Yes,G),r.mobile||(this.addHotkey("AddPane",!1,KeyCode.T,a.Primary.No,a.Shift.No,K),this.addHotkey("OpenQuickAdd",!1,KeyCode.Q,r.mac?a.Primary.Never:a.Primary.No,a.Shift.No,Y),this.addHotkey("NewItem",!1,KeyCode.N,a.Primary.No,a.Shift.No,X),r.mac?this.addHotkey("ToggleSidebar",!1,KeyCode.S,a.Primary.Only,a.Shift.No,J,!0,!0):this.addHotkey("ToggleSidebar",!1,KeyCode.S,a.Primary.Never,a.Shift.Yes,J),this.addHotkey("ToggleSidebar",!1,KeyCode.L,a.Primary.Only,a.Shift.Yes,J),this.addHotkey("SearchFlat",!1,KeyCode.D6,a.Primary.Either,a.Shift.Either,E)),this.addHotkey("PrefixHeader",!1,KeyCode.D3,a.Primary.Never,a.Shift.Yes,_),this.addHotkey("PrefixTask",!1,KeyCode.LBracket,a.Primary.Never,a.Shift.Yes,I),this.addHotkey("EmailCompose",!0,KeyCode.E,a.Primary.Only,a.Shift.No,W);var ie,ne=function(e,t){for(var n,r=0;r<t.length;r++){var a,s,o,c,l=t[r],d=!l.mods;if(d||(a=!!l.mods[m.Ctrl]==!!e.ctrlKey,s=!!l.mods[m.Meta]==!!e.metaKey,o=!!l.mods[m.Alt]==!!e.altKey,c=!!l.mods[m.Shift]==!!e.shiftKey),(d||a&&s&&o&&c)&&(l.isGlobal||e.target===document.body&&!i.menus.isContextMenuOpen()&&!i.menus.isModalOpen()||i.findParent(e.target,"pane"))){n=l;break}}if(n){this.currentArrowsMode&&(this._exitingArrowsMode=this.currentArrowsMode,this._exitArrowsMode());var h=n.call(e);return n.stopPropagation&&e.stopPropagation(),this._exitingArrowsMode=void 0,!1===h||(e.handled=!0,e.preventDefault(),!1)}}.bind(this),re=function(t){r.normalizeKeys(t),ie=t.normCode,this.currentArrowsMode&&this._updateArrowsMode(t);var n,a=this.hotkeyStack.peek();if(a&&a[t.normCode]&&(n=ne(t,[a[t.normCode]])),void 0===n){var s=p[t.normCode];s&&(n=ne(t,s))}if(void 0!==n)return i.vmMain&&i.vmMain.updateCursorFromEvent(t),n;if(r.android&&t.target===document.body){if(e(t))return t.preventDefault(),!1;l.keydown(null,t)}}.bind(this);this.hotkeyStack=new h,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},n.forceBind("onMouseDownArrowsMode",this),document.addEventListener("keydown",re,!0),document.addEventListener("keyup",t,!0)}var i=e("globals"),n=e("util"),r=e("platform"),a=e("Constants"),s=e("Observable"),o=e("tracker"),c=e("DesktopUI"),l=e("edit"),d=e("NativeSel"),h=e("Stack"),u=e("Sel"),p={},m={Ctrl:0,Meta:1,Alt:2,Shift:3};return t.prototype={pushStack:function(e){for(var t={},i=0;i<e.length;i++){var n=e[i];t[n.keyCode]=n}return this.hotkeyStack.push(t),t},pushStackEscape:function(e){return this.pushStack([this.createEscape(e)])},popStack:function(e){this.hotkeyStack.pop(e)},getHotkey:function(e){var t,i=p[e.normCode];if(i)for(var n=0;n<i.length;n++){var r,a,s,o,c=i[n],l=!c.mods;if(l||(r=!!c.mods[m.Ctrl]==!!e.ctrlKey,a=!!c.mods[m.Meta]==!!e.metaKey,s=!!c.mods[m.Alt]==!!e.altKey,o=!!c.mods[m.Shift]==!!e.shiftKey),l||r&&a&&s&&o){t=c.name;break}}return t},create:function(e,t,n,s,o,c){try{i.PAssert(4363,i.isNumber(e),"Invalid keyCode")}catch(e){i.reportError(e)}try{i.PAssert(4364,i.isBoolean(t),"Invalid isGlobal")}catch(e){i.reportError(e)}try{i.PAssert(4365,i.isFunction(o),"Invalid callback")}catch(e){i.reportError(e)}var l={keyCode:e,mods:{},call:o,isGlobal:t};return n!==a.Primary.Yes&&n!==a.Primary.Both&&n!==a.Primary.Only||(l.mods[this.platformPrimaryKey]=!0),n!==a.Primary.No&&n!==a.Primary.Never&&n!==a.Primary.Both||(l.mods[this.platformSecondaryKey]=!0),c&&r.mac&&(l.mods[m.Alt]=!0),s===a.Shift.Yes&&(l.mods[m.Shift]=!0),l},createEscape:function(e){return this.create(KeyCode.Escape,!0,a.Primary.Either,a.Shift.Either,e)},addHotkey:function(e,t,n,s,o,c,l,d){try{i.PAssert(4366,n,"Must supply a valid keycode")}catch(e){i.reportError(e)}r.app&&!isNaN(s)&&s!==a.Primary.Both&&s!==a.Primary.Never&&s!==a.Primary.Only&&(s=a.Primary.Either),this._addHotkey(e,t,n,s,o,c,l,d)},_addHotkey:function(e,t,n,s,o,c,l,d){if(p[n]=p[n]||[],s===a.Primary.Either)return this._addHotkey(e,t,n,a.Primary.No,o,c,l),void this._addHotkey(e,t,n,a.Primary.Yes,o,c,l);if(o===a.Shift.Either)return this._addHotkey(e,t,n,s,a.Shift.No,c,l),void this._addHotkey(e,t,n,s,a.Shift.Yes,c,l);try{i.PAssert(4367,!r.windows||s!==a.Primary.Both,"Should never require AltGr combo on windows")}catch(e){i.reportError(e)}var h=this.create(n,t,s,o,c,d);h.stopPropagation=l,h.name=e,p[n].push(h)},registerArrowsMode:function(e,t,i,n,r,a){var o=this["arrowsModeIndex"+e]=new s(-1);return!0===t?this._enterArrowsMode(e,i,n,r):this._addHotkey(e,!0,t.keyCode,t.primary,t.shift,this._onKeyDownArrowsMode.bind(this,e,i,n,r,a)),o},getArrowsModeObs:function(e){return this["arrowsModeIndex"+e]},isInArrowsMode:function(e){return this.currentArrowsMode&&this.currentArrowsMode.name===e},exitArrowsMode:function(e){this.isInArrowsMode(e)&&this._exitArrowsMode()},_onKeyDownArrowsMode:function(e,t,i,n,r){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===e||this._enterArrowsMode(e,t,i,n,r)},_enterArrowsMode:function(e,t,i,n,r){this.currentArrowsMode={name:e,cbGetMax:t,cbSelect:i,cbKey:n,cbOnHotkey:r},r&&r(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+e].set(0)},_exitArrowsMode:function(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)},onMouseDownArrowsMode:function(e){this._exitArrowsMode()},_updateArrowsMode:function(e){var t=this.currentArrowsMode,i=this.getArrowsModeObs(t.name),n=r.getKeyCode(e),a=i.get(),s=t.cbGetMax();if(n===KeyCode.Enter)a>=0&&t.cbSelect(a),this._exitArrowsMode();else if(n===KeyCode.Escape)this._exitArrowsMode();else if(n===KeyCode.UpArrow)a>0&&i.set(a-1);else if(n===KeyCode.DownArrow)a<s-1&&i.set(a+1);else if(t.cbKey){var o=t.cbKey(n,e);o>=0&&(t.cbSelect(o),this._exitArrowsMode(),e.stopPropagation(),e.preventDefault())}}},new t}),define("ModalBase",["globals","util","Hotkeys"],function(e,t,i){function n(i){try{e.PAssert(4368,i,"Must supply each modal with a valid ID")}catch(t){e.reportError(t)}this.id=i,this.isRegistered=!1,this.isVisible=e.createObservable(!1,"isVisible","ModalBase"),this.openFn=void 0,this.closeFn=void 0,t.forceBind("_onEscape",this)}return n.prototype={registerModal:function(t,i){try{e.PAssert(4369,!t||e.isFunction(t),"May only supply a function as an open callback")}catch(t){e.reportError(t)}try{e.PAssert(4370,!i||e.isFunction(i),"May only supply a function as an open callback")}catch(t){e.reportError(t)}this.openFn=t,this.closeFn=i,this.isRegistered=!0,e.menus.registerModal(this.id,this)},openModal:function(){setTimeout(function(){this.isVisible(!0)}.bind(this),0),this.openFn&&this.openFn.apply(this,arguments),this.__hotkeys=i.pushStackEscape(this._onEscape)},closeModal:function(){this.isVisible(!1),i.popStack(this.__hotkeys),this.__hotkeys=void 0,this.closeFn&&this.closeFn.apply(this,arguments)},_onEscape:function(){e.menus.closeModal(this.id,!1)},close:function(){e.menus.closeModal(this.id,!0)}},t.defineBase(n),n}),define("VMMenus",["require","globals","data","util","gdata","ObservableArray","tracker","platform","Sel","Dispatcher","PluginSettings","Hotkeys","ModalBase"],function(e){function t(){try{i.PAssert(4371,!i.menus,"Should only have a single instance of VMMenus")}catch(e){i.reportError(e)}i.menus=this,this.isModalVisible=i.createObservable(!1,"isModalVisible","VMMenus"),this.billingManager=i.billingManager,this._registeredModals={},this._openModals=[],this.newModals=[Modals.Settings,Modals.Alert,Modals.Confirm,Modals.Prompt,Modals.ExportData,Modals.RevisionHistory,Modals.ImportData,Modals.ReportProblem,Modals.Billing,Modals.Welcome,Modals.EmailReply,Modals.EmailCompose,Modals.MobileSettings,Modals.DeleteAccount,Modals.Invoices,Modals.Options,Modals.Lightbox,Modals.EnterCode],this.oldModals=[Modals.ReportBug,Modals.ShareDoc],this.modalStack=new s,this.contextMenuStack=new s,this.emailComposeStack=new s,r.forceBind("onClosingSettings",this),this.main=function(){return i.vmMain},this.init()}var i=e("globals"),n=e("data"),r=e("util"),a=e("gdata"),s=e("ObservableArray"),o=e("tracker"),c=e("platform"),l=e("Sel"),d=e("Dispatcher"),h=e("PluginSettings"),u=e("Hotkeys"),p=e("ModalBase");return t.prototype={init:function(){d.listen("closeKeyboard",this.onCloseKeyboard.bind(this)),u.pushStackEscape(this.onEscapeKey.bind(this)),c.mobile||this.isModalVisible.subscribe(function(e){e?requestAnimationFrame(function(){requestAnimationFrame(function(){i.addClass(i.element("container"),"modalOpen"),i.addClass(i.element("desktopMenu"),"modalOpen")})}):requestAnimationFrame(function(){i.removeClass(i.element("container"),"modalOpen"),i.removeClass(i.element("desktopMenu"),"modalOpen")})}),setTimeout(function(){i.applyBindings(this,"modals")}.bind(this),0)},vmPicker:function(){return i.vmMain.vmPicker},onEscapeKey:function(){if(this.isModalVisible())return this._closeModalInternal(!1)},openSidebarMenu:function(e,t,n,r){var a;a=i.isFunction(t)?{fn:t}:i.isString(t)?{componentName:t}:t,a.element=e,a.positionOffset={left:4},a.side="right",a.openFromBottom=n,a.fromHotkey=r,l.reset(),"ReactItemDetailsPopup"===a.componentName?this.openItemEditor(a):this.openContextMenuReact(a)},toggleContextMenuReact:function(e,t){i.menus.isContextMenuOpen()?i.menus.closeContextMenuReact():this.openContextMenuReact(e,t)},openContextMenuReact:function(e,t){this.contextMenuNoFade=t,this.contextMenuStack.push(e)},indexOfContextMenuReact:function(e){var t=this.contextMenuStack.get(),i=t.indexOfWithProperty("fn",e);return i<0&&(i=t.indexOfWithProperty("componentName",e)),i},closeContextMenuReact:function(e,t,n){if(e){var r=this.indexOfContextMenuReact(e);try{i.PAssert(4372,r>=0,"Tried to close a context menu that was not open")}catch(e){i.reportError(e)}if(r>=0){var a=this.contextMenuStack.get()[r];a.onClosed&&a.onClosed(t,n),this.contextMenuStack.removeAt(r)}}else{for(var s=this.contextMenuStack.get(),o=s.length-1;o>=0;o--)s[o].onClosed&&s[o].onClosed(!1,n);this.contextMenuStack.clear()}},isContextMenuOpen:function(e){return e?this.indexOfContextMenuReact(e)>=0:this.contextMenuStack.get().length>0},getModalForId:function(e){return this._registeredModals[e]},isModalBound:function(e){var t=document.getElementById(e);return i.dataFor(t.firstElementChild)!==this},isModalOpen:function(e){var t=this.modalStack.get();if(!e)return t.length>0||this._openModals.length>0;for(var i=0;i<t.length;i++)if(t[i].id===e)return!0;return this._openModals.indexOf(e)>=0||void 0},getTopModal:function(){return this._openModals[this._openModals.length-1]},removeTopModal:function(){return this._openModals.pop()},addTopModal:function(e){this._openModals.push(e)},isTopModal:function(e){return this.getTopModal()===e},registerModal:function(e,t){try{i.PAssert(4373,e,"Must have a valid modal id")}catch(e){i.reportError(e)}try{i.PAssert(4374,t,"Must have a valid modal object to bind to")}catch(e){i.reportError(e)}try{i.PAssert(4375,!this._registeredModals[e],"Should only register a modal a single time: "+e)}catch(e){i.reportError(e)}try{i.PAssert(4376,t instanceof p,"Can only register valid modals")}catch(e){i.reportError(e)}this._registeredModals[e]=t},openModalNew:function(e,t){try{i.PAssert(4377,void 0===t||i.isObject(t),"Must always pass in a valid object for params")}catch(e){i.reportError(e)}try{i.PAssert(4378,this.newModals.indexOf(e)>=0,"Modal must be registered as a new modal to use this fn: ",e)}catch(e){i.reportError(e)}if(!this.isModalOpen(e)){t=t||{};try{i.PAssert(4379,void 0===t.id,"Should not already have an ID defined with modal params")}catch(e){i.reportError(e)}t.id=e,l.reset(),this.modalStack.push(t)}},closeModalNew:function(e,t){var i=this.modalStack.get().indexOfWithProperty("id",e);if(i>=0){var n=this.modalStack.get()[i],r=!0;n.onClosing&&(r=n.onClosing()),r&&(this.modalStack.removeAt(i),n.callback&&n.callback(t))}},openModal:function(e,t){if(this.newModals.indexOf(e)>=0)this.openModalNew(e,t);else{try{i.PAssert(4380,this._registeredModals[e],"Must have registered the modal before opening it")}catch(e){i.reportError(e)}try{i.PAssert(4381,!this.isModalOpen(e),"Must not have the same modal open multiple times: "+e)}catch(e){i.reportError(e)}try{i.PAssert(4382,this.oldModals.indexOf(e)>=0,"Missing old modal from list")}catch(e){i.reportError(e)}if(this.isModalOpen(e))return;l.reset();var n=this.getModalForId(e);n.openModal.apply(n,Array.prototype.slice.call(arguments,1)),this.isModalBound(e)||i.applyBindings(n,e),this.addTopModal(e),this.isModalVisible(!0)}},closeModal:function(e){try{i.PAssert(4383,this._registeredModals[e],"Must have registered the modal before closing it")}catch(e){i.reportError(e)}try{i.PAssert(4384,this.isModalOpen(e),"Modal must be open to be closed: "+e)}catch(e){i.reportError(e)}try{i.PAssert(4385,this.isTopModal(e),"Tried to close the wrong modal: "+e+", "+this.getTopModal())}catch(e){i.reportError(e)}arguments.length>1?this._closeModalInternal.apply(this,Array.prototype.slice.call(arguments,1)):this._closeModalInternal()},_closeModalInternal:function(){try{i.PAssert(4386,this._openModals.length>0,"Tried to close when no modal was open")}catch(e){i.reportError(e)}if(0!==this._openModals.length){var e=this.getModalForId(this.removeTopModal());this.modalInputOn=void 0,0===this._openModals.length&&this.isModalVisible(!1),d.fireEvent("closeKeyboard",[]),e.closeModal.apply(e,arguments)}},focusModalInputMobile:function(e,t){try{i.PAssert(4387,c.mobile,"Should not call this from non-mobile")}catch(e){i.reportError(e)}var n=this.getModalForId(this.getTopModal());this.modalInputOn?this.modalInputOn!==t?(t.focus(),n.onKeyboardOpened&&requestAnimationFrame(function(){n.onKeyboardOpened(e)}.bind(this)),e.preventDefault(),e.stopPropagation(),i.enforceScroll()):i.enforceScroll():i.openKeyboardOnElement(e,t,function(){c.app?(n&&n.onKeyboardOpened&&n.onKeyboardOpened(e),requestAnimationFrame(function(){requestAnimationFrame(function(){t.focus(),i.enforceScroll()})})):t.focus()}.bind(this))},onTapModal:{onClick:function(e){var t=!0;if("modals"===e.target.id){var n=this.getTopModal();n&&this.closeModal(n),this.modalInputOn=void 0}else e.target===this.modalInputOn?t=!1:i.isKeyboardInputElement(e.target)||i.hasClass(e.target,"input")?(c.mobile&&(t=!1,this.focusModalInputMobile(e,e.target)),this.modalInputOn=e.target):this.modalInputOn=void 0;t&&c.mobile&&(e.preventDefault(),e.stopPropagation())}},onCloseKeyboard:function(){this.modalInputOn=void 0},confirm:function(e,t){try{i.PAssert(4388,t,"Confirm modals should have callbacks",e)}catch(e){i.reportError(e)}this.openModalNew(Modals.Confirm,{text:e,callback:t})},prompt:function(e,t){try{i.PAssert(4389,t,"Prompt modals should have callbacks",e)}catch(e){i.reportError(e)}this.openModalNew(Modals.Prompt,{text:e,callback:t})},alert:function(e){try{i.PAssert(4390,!e.action,"Still using an old style alert",e)}catch(e){i.reportError(e)}e.action&&(e.callback=e.action),this.openModalNew(Modals.Alert,e)},options:function(e,t,n){try{i.PAssert(4391,i.isArray(t,"Must have valid options array"))}catch(e){i.reportError(e)}try{i.PAssert(4392,n,"Options modal must have a callback")}catch(e){i.reportError(e)}this.openModalNew(Modals.Options,{text:e,options:t,callback:n})},openSettings:function(e){o.performAction(TrackerType.UIAction,{type:TrackerUIAction.OpenSettingsMenu}),this.openModalNew(Modals.Settings,{section:e,onClosing:this.onClosingSettings})},onClosingSettings:function(){var e=!h.isSaveEnabled.get();return e||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(e){e&&(h.isSaveEnabled.set(!1),this.closeModalNew(Modals.Settings))}.bind(this)),e},openDisplaySettings:function(){i.vmMain.isDisplaySettingsOpen.set(!0),o.performAction(TrackerType.UIAction,{type:TrackerUIAction.OpenDisplaySettings})},getUserEmail:function(){return i.getUserIdentifier()},getUserName:function(){var e=a.authenticatedUser.get();return e?e.displayName:i.vmMain.gdriveStatus()===DriveStatus.Saved?"Connected":i.vmSetup.loginState()===LoginState.LOGGED_IN?"Connecting":"Demo"},openMenuExternalApp:function(e,t){this.openContextMenuReact({componentName:"ReactContextMenuMobileOpenLink",position:"bottom",html:e,onClick:t})},_indexOfCompose:function(e){for(var t=this.emailComposeStack.get(),i=0;i<t.length;++i){if(t[i].draftMsg.id===e)return i}return-1},isComposeOpenForEmail:function(e){return!c.mobile&&this._indexOfCompose(e)>=0},openComposeEmail:function(e,t,n,r){try{i.PAssert(4393,e,"Must have a valid email plugin")}catch(e){i.reportError(e)}try{i.PAssert(4394,!t||i.isString(t),"Must have a string threadID")}catch(e){i.reportError(e)}try{i.PAssert(4395,!n||i.isString(n),"Must have a string messageID")}catch(e){i.reportError(e)}if(l.reset(),this.isComposeOpenForEmail());else{var a=e.getDraftByID(e.getDefaultAccount(),t,n,r);try{i.PAssert(4396,a,"Must always create a valid draft")}catch(e){i.reportError(e)}if(c.mobile){var s={threadAttach:a.attach,message:a.draftMsg};this.openModalNew(Modals.EmailCompose,s)}else{try{i.PAssert(4397,this.emailComposeStack.indexOf(a)<0,"Must not double-open drafts, should re-use")}catch(e){i.reportError(e)}this.emailComposeStack.get().indexOfWithProperty("attach",a.attach)<0&&this.emailComposeStack.push(a)}}o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ComposeEmail})},closeComposeEmail:function(e,t){var n=this._indexOfCompose(t.id);try{i.PAssert(4398,n>=0,"Must have found a valid composing email to remove")}catch(e){i.reportError(e)}this.emailComposeStack.removeAt(n)},openItemEditor:function(e){try{i.PAssert(4399,!e.item==!!e.addOnSave,"Must be adding item if no item prop")}catch(e){i.reportError(e)}if(!e.item){e.parent||(e.parent=n.getRootModel());var t=n.createTempVMLI({text:e.text||""},{changeType:ChangeType.AllLocal});e.item=t;var r=e.endSave;e.endSave=function(){setTimeout(function(){n.destroyTempVMLI(t.id)},0),r&&r.apply(this,arguments)}}e.componentName="ReactItemDetailsPopup",this.openContextMenuReact(e)},openLightbox:function(e,t,n){try{i.PAssert(4400,!c.mobile,"Should never open lightbox on mobile")}catch(e){i.reportError(e)}this.openModalNew(Modals.Lightbox,{src:e,buttonText:t,buttonAction:n})}},t}),define("VMDocument",["require","globals","Constants","data","apis","goog","Observable"],function(e){function t(e,t){this._remoteData=t?e:void 0,e=e||{},this.id=e.id,this._title=new a(e.title||""),this._isShared=new a(e.shared||!1),this._isOwned=new a(!this._remoteData),this._isOpen=new a(!1),this._isDeleted=!1,this._isTrashed=this._isRemoteTrashed(this._remoteData),this._docFolderID=void 0,this._realtimeDoc=void 0,this._remoteData&&this.updateData(this._remoteData)}var i=e("globals"),n=(e("Constants"),e("data"),e("apis")),r=e("goog"),a=e("Observable");return t.prototype={_isRemoteTrashed:function(e){var t=!1;return e&&e.labels?t=!!e.labels.trashed:e||(t=!0),t},updateData:function(e,t){try{i.PAssert(4401,e,"Must supply remote data to update doc")}catch(e){i.reportError(e)}if(e){if(this._remoteData){try{i.PAssert(4402,!e.id||e.id===this.id,"ID must either not exist or be the same")}catch(e){i.reportError(e)}for(var n in e)e.hasOwnProperty(n)&&(this._remoteData[n]=e[n])}else this._remoteData=e,this.id=e.id;i.settings.get(Settings.gdocId)===this._remoteData.id&&i.settings.set(Settings.gdocTitle,this._remoteData.title),this._title.set(this._remoteData.title),this._isShared.set(this._remoteData.shared);var r=this._remoteData.userPermission;r&&"me"===r.id&&"owner"===r.role?this._isOwned.set(!0):this._isOwned.set(!1)}this._isTrashed=this._isRemoteTrashed(this._remoteData)},setRealtimeDoc:function(e){try{i.PAssert(4403,!this._realtimeDoc,"Must only have a single realtime doc instance per doc")}catch(e){i.reportError(e)}this._realtimeDoc=e},hasDriveBacking:function(){return!!this._remoteData},generateShareInfo:function(e){var t={};t.fromUser=i.getUserIdentifier(),e&&(t.toUser=e);var n;try{var r=JSON.stringify(t);n=i.utf8_to_b64(r)}catch(e){i.reportError(e)}return n},insertPermission:function(e,t){try{i.PAssert(4404,this._remoteData,"Must have remote data to add permissions")}catch(e){i.reportError(e)}try{i.PAssert(4405,this.id,"Must specify a valid document ID to operate on")}catch(e){i.reportError(e)}try{i.PAssert(4406,e,"Must specify a valid email to add")}catch(e){i.reportError(e)}var n="https://www.moo.do/app/#login=true&file="+this.id+"&sinfo="+this.generateShareInfo(e),r=function(r){i.XHR_PrivateAPI({type:"POST",path:"/sharing/shareDoc",data:{fromUser:i.getUserIdentifier(),toEmail:e,docURL:n},requireAuth:!0,cb:function(e){e.status}}),this.getDocumentFolder(function(t){var n=function(e){},r=function(e){};i.vmMain.remoteAPI().drivePermissionsInsert(t,e,!1,n,r)}),r&&(this._remoteData.permissions.push(r),this._remoteData.shared=!0,this._isShared.set(!0)),t(!!r)}.bind(this),a=function(n){var s=!1;if(n.error&&400===n.error.code)for(var o=n.error.errors,c=0;c<o.length;++c){var l=o[c];"invalidSharingRequest"===l.reason&&(i.vmMain.remoteAPI().drivePermissionsInsert(this.id,e,!0,r,a),s=!0)}s||t(!1)}.bind(this);i.vmMain.remoteAPI().drivePermissionsInsert(this.id,e,!1,r,a)},deletePermission:function(e,t){try{i.PAssert(4407,this._remoteData,"Must have valid remote data to remove permissions")}catch(e){i.reportError(e)}try{i.PAssert(4408,this.id,"Must specify a valid document ID to operate on")}catch(e){i.reportError(e)}try{i.PAssert(4409,e,"Must specify a valid permissionID to remove")}catch(e){i.reportError(e)}var n=function(i){for(var n=0;n<this._remoteData.permissions.length;++n)if(this._remoteData.permissions[n].id===e){this._remoteData.permissions.removeAt(n);break}1===this._remoteData.permissions.length&&(this._remoteData.shared=!1,this._isShared.set(!1)),t(!0)}.bind(this),r=function(e){t(!1)};i.vmMain.remoteAPI().drivePermissionsDelete(this.id,e,n,r),this.getDocumentFolder(function(t){var n=function(e){},r=function(e){};i.vmMain.remoteAPI().drivePermissionsDelete(t,e,n,r)})},listPermissions:function(e){try{i.PAssert(4410,this._remoteData,"Must have valid remote data to list permissions")}catch(e){i.reportError(e)}var t=function(t){e(t.items)},n=function(t){e(void 0)};i.vmMain.remoteAPI().drivePermissionsList(this.id,t,n)},getDocumentFolder:function(e){try{i.PAssert(4411,!i.isDemoMode(),"Should not be creating file structure in demo mode")}catch(e){i.reportError(e)}try{i.PAssert(4412,e,"Must provide a valid callback when getting the doc folder")}catch(e){i.reportError(e)}try{i.PAssert(4413,this.id,"Must have a valid id")}catch(e){i.reportError(e)}try{i.PAssert(4414,this.getTitle(),"Must have a valid doc title")}catch(e){i.reportError(e)}if(this._docFolderID)return e(this._docFolderID);var t,n,a=function(){this.createDocumentFileStructure(function(t){return t?(this._docFolderID=t,e(t)):e(void 0)})}.bind(this),s=r.DocFolderPropertyPrefix+this.id;try{var o="properties has {key='"+r.DocFolderProperty+"' and value='"+s+"' and visibility='PRIVATE'} and trashed=false",c={getAllPages:!0},t=function(t){if(0!==t.length){try{i.PAssert(4415,1===t.length,"Must have only a single document folder")}catch(e){i.reportError(e)}var n=t[0];return this._docFolderID=n.id,this.updateDocumentFolderProps(n),e(n.id)}a()}.bind(this),n=function(t){return e()};i.vmMain.remoteAPI().driveFilesList(o,t,n,c)}catch(t){return i.reportError(t),e()}},updateDocumentFolderProps:function(e){try{i.PAssert(4416,e,"Must provide valid doc folder info")}catch(e){i.reportError(e)}if(this.getTitle()){var t=!1,n=!1;if(e.properties){for(var a=0;a<e.properties.length;++a)if(e.properties[a].key===r.DocFolderTitleProperty){e.properties[a].value!==this.getTitle()&&(t=!0);break}}else n=!0;if(n){var s=function(){},o=function(e){i.reportError(new Error("Unable to update drive folder title property"))};i.vmMain.remoteAPI().drivePropertiesInsert(e.id,r.DocFolderTitleProperty,this.getTitle(),s,o)}else if(t){var s=function(){},o=function(e){i.reportError(new Error("Unable to update drive folder title property"))};i.vmMain.remoteAPI().drivePropertiesUpdate(e.id,r.DocFolderTitleProperty,this.getTitle(),s,o)}}r.getRootFolder(function(t){if(t){var n=!1;if(e.parents)for(var r=0;r<e.parents.length;++r)if(e.parents[r].id===t){n=!0;break}if(!n){var a=function(){},s=function(e){i.reportError(new Error("Unable to add shared doc folder to root folder"))};i.vmMain.remoteAPI().driveParentsInsert(e.id,t,a,s)}}}),this.hasDriveBacking()&&this.ensureFolderPermissions(e)},createDocumentFileStructure:function(e){try{i.PAssert(4417,this.id,"In order to create a valid folder structure we must have a valid document ID")}catch(e){i.reportError(e)}try{i.PAssert(4418,this.getTitle(),"Must provide a valid document title")}catch(e){i.reportError(e)}r.getRootFolder(function(t){if(!t)return e();var a=[{key:r.DocFolderProperty,value:r.DocFolderPropertyPrefix+this.id,visibility:"PRIVATE"}];this.getTitle()&&a.push({key:r.DocFolderTitleProperty,value:this.getTitle(),visibility:"PRIVATE"});var s=n.fns("drive").files.insert.packedFn,o={resource:{fields:"createdDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,userPermission(id,role,type)",mimeType:r.FOLDER_MIMETYPE,title:r.DocFolderTitlePrefix+this.id,writersCanShare:!1,parents:[{id:t}],properties:a}},c=function(t){return this._docFolderID=t.id,this.hasDriveBacking()&&this.ensureFolderPermissions(t),e(t.id)}.bind(this),l=function(t){return e()};i.vmMain.remoteAPI().runRemoteSingleRequest(s,o,c,l)}.bind(this))},ensureFolderPermissions:function(e){try{i.PAssert(4419,this._remoteData,"Must have valid remote data to take permissions from")}catch(e){i.reportError(e)}try{i.PAssert(4420,e,"Must supply a valid folder ID to set permissions on")}catch(e){i.reportError(e)}var t=function(e){},n=function(e){},r=e.permissions,a=this._remoteData.permissions;try{i.PAssert(4421,a,"Must always have a valid list of permissions for this doc")}catch(e){i.reportError(e)}if(a)for(var s=0;s<a.length;++s){var o=a[s];if("anyone"===o.type);else{var c=o.emailAddress;c&&"owner"!==o.role&&(function(e){var t=!1;if(r)for(var i=0;i<r.length;++i)if(r[i].emailAddress===e){t=!0;break}return t}(c)||i.vmMain.remoteAPI().drivePermissionsInsert(e.id,c,!1,t,n))}}},rename:function(e,t){if(this._remoteData||this.getTitle()){try{i.PAssert(4422,e,"Must specify a valid title to rename to")}catch(e){i.reportError(e)}try{i.PAssert(4423,i.isFunction(t),"Must supply a valid callback fn")}catch(e){i.reportError(e)}try{i.PAssert(4424,this.getTitle(),"Must have a valid title set already")}catch(e){i.reportError(e)}try{i.PAssert(4425,this.getTitle()!==e,"Should always be setting to a different title")}catch(e){i.reportError(e)}var a=n.fns("drive").files.patch.packedFn,s={fileId:this.id,resource:{title:e}},o=function(n){this.getDocumentFolder(function(t){var n=function(e){},a=function(e){i.reportError(new Error("Unable to update drive folder title property"))};i.vmMain.remoteAPI().drivePropertiesUpdate(t,r.DocFolderTitleProperty,e,n,a)}.bind(this)),this._title.set(e),this._remoteData.title=e,this.isOpen()&&r.setDocInfo(this.id,e),log("File renamed to:"+e),t(!0)}.bind(this),c=function(e){t(!1)};i.vmMain.remoteAPI().runRemoteSingleRequest(a,s,o,c)}else this._title.set(e),t(!0)},shareFile:function(e,t){try{i.PAssert(4426,e,"Must specify a valid fileID to share")}catch(e){i.reportError(e)}try{i.PAssert(4427,t,"Must specify a valid callback for sharing")}catch(e){i.reportError(e)}this.getDocumentFolder(function(n){var r=function(e){t(!0,e)},a=function(e){t(!1,e)};i.vmMain.remoteAPI().driveParentsInsert(e,n,r,a)})},unshareFile:function(e,t){try{i.PAssert(4428,e,"Must specify a valid fileID to unshare")}catch(e){i.reportError(e)}try{i.PAssert(4429,t,"Must specify a valid callback for unsharing")}catch(e){i.reportError(e)}this.getDocumentFolder(function(n){var r=function(e){t(!0)},a=function(e){t(!1)};i.vmMain.remoteAPI().driveParentsDelete(e,n,r,a)})},deleteData:function(e){var t=0,r=!1,a=function(){t--,o()},s=function(){r=!0,t--,o()},o=function(){0!==t||r||this.getDocumentFolder(function(e){
var t=function(){this._docFolderID=void 0},n=function(){};i.vmMain.remoteAPI().driveFilesTrash(e,t,n)})}.bind(this),c=function(r){this.getDocumentFolder(function(e){var r={getAllPages:!0,maxPageResults:500},o=function(r){for(var o=0;o<r.length;++o){var c=n.fns("drive").children.delete.packedFn,l={folderId:e,childId:r[o].id};t++,i.vmMain.remoteAPI().runRemoteSingleRequest(c,l,a,s)}},c=function(e){};i.vmMain.remoteAPI().driveChildrenList(e,o,c,r)}),this._isDeleted=!0,this._isTrashed=!0,this._remoteData&&(this._remoteData.trashed=!0),e(!0)}.bind(this),l=function(t){e(!1)};i.vmMain.remoteAPI().driveFilesTrash(this.id,c,l)},isShared:function(){return this._isShared.get()},isOwned:function(){return this._isOwned.get()},isTrashed:function(){return this._isTrashed&&!this.isShared()},open:function(){try{i.PAssert(4430,!this._isOpen.get(),"Document must be closed to be opened")}catch(e){i.reportError(e)}this._isOpen.set(!0),i.vmMain.docManager.setDocOpened(this.id)},close:function(){try{i.PAssert(4431,this._isOpen.get(),"Document must be opened to be closed")}catch(e){i.reportError(e)}this._isOpen.set(!1),i.vmMain.docManager.setDocClosed(this.id)},isOpen:function(){return this._isOpen.get()},getTitle:function(){return this._title.get()},getData:function(){return this._remoteData}},t}),define("ContactsAutocomplete",["globals","util","platform","data"],function(e,t,i,n){function r(i){try{e.PAssert(4432,i,"Must supply a valid selected callback")}catch(t){e.reportError(t)}this._matchedContacts=e.createObservableArray([],"_matchedContacts","ContactsAutocomplete"),this.selectedContactIndex=e.createObservable(0,"selectedContactIndex","ContactsAutocomplete"),this._element=void 0,this._inputElement=void 0,this.onSelectedCallback=i,t.forceBind("_onInputBlur",this)}var a={onLoad:function(e){this._element=e,this.contactsListEle=e.firstElementChild},setInputElement:function(t){this._inputElement!==t&&(this._inputElement&&this._cleanupInputElement(),this._inputElement=t,e.copyStyles(t,this._element,["width"]),this._setupInputElement())},_setupInputElement:function(){try{e.PAssert(4433,this._inputElement,"Must have specified a valid input element")}catch(t){e.reportError(t)}this._inputElement.addEventListener("blur",this._onInputBlur)},_cleanupInputElement:function(){try{e.PAssert(4434,this._inputElement,"Must have specified a valid input element")}catch(t){e.reportError(t)}this._inputElement.removeEventListener("blur",this._onInputBlur)},_onInputBlur:function(){this.forceHide()},onkeydown:function(t,n){if(i.normalizeKeys(n),n.normCode===KeyCode.Enter){var r=this.contactsListEle.children[this.selectedContactIndex()];return r&&this.onSelectedCallback(r.textContent),n.preventDefault(),n.stopImmediatePropagation(),!1}if(n.normCode===KeyCode.UpArrow){var a=this.selectedContactIndex()-1;return a<0&&(a=this._matchedContacts().length-1),this.selectedContactIndex(a),n.preventDefault(),n.stopImmediatePropagation(),e.scrollIntoView(this.contactsListEle.children[a],200),!1}if(n.normCode===KeyCode.DownArrow){var a=this.selectedContactIndex()+1;return a>=this._matchedContacts().length&&(a=0),this.selectedContactIndex(a),n.preventDefault(),n.stopImmediatePropagation(),e.scrollIntoView(this.contactsListEle.children[a],200),!1}return!0},onContactEmailUpdate:function(e){if(e){var t=n.contactManager.findEmailsLike(e);t&&this._matchedContacts(t)}else this._matchedContacts([]);var i=document.activeElement;"INPUT"===i.nodeName&&this.setInputElement(i)},showContactList:function(){return this._matchedContacts().length>0},forceHide:function(){this._matchedContacts([])},computeSelectionIndex:function(e){var t=0,i=e.target;for("#text"===i.tagName&&(i=i.parentNode);i=i.previousElementSibling;)++t;this.selectedContactIndex(t)},onTapContactList:function(e){this._matchedContacts([]);var t=e.startSrc.innerText;return this.onSelectedCallback(t),this.selectedContactIndex(0),e.preventDefault(),e.stopImmediatePropagation(),!1},onMouseoverContactList:function(e,t){this.computeSelectionIndex(t)},isContactSelected:function(e){return this.selectedContactIndex()===e()},renderContact:function(e){var t=e.email,i="",n=e.text&&e.text!==t;return n&&(i=e.text+" <"),i+=t,n&&(i+=">"),i}};return t.extend(r.prototype,a),r}),define("VMDocSharing",["globals","util","platform","data","goog","ContactsAutocomplete","ModalBase"],function(e,t,i,n,r,a,s){function o(){this._super.constructor.call(this,Modals.ShareDoc),this.doc=e.createObservable(void 0,"doc","VMDocSharing"),this.isLoading=e.createObservable(!1,"isLoading","VMDocSharing"),this.isCreating=e.createObservable(!1,"isCreating","VMDocSharing"),this.permissions=e.createObservableArray([],"permissions","VMDocSharing"),this.permissionsNew=e.createObservableArray([],"permissionsNew","VMDocSharing"),this.permissionsRemove=[],this.newEmail=e.createObservable("","newEmail","VMDocSharing"),this.errorGlobal=e.createObservable(!1,"errorGlobal","VMDocSharing"),this.errorName=e.createObservable(!1,"errorName","VMDocSharing"),this.errorInvite=e.createObservable(!1,"errorInvite","VMDocSharing"),this.isSaving=e.createObservable(!1,"isSaving","VMDocSharing"),this.editing=e.createObservable(!1,"editing","VMDocSharing"),this.helpID="NewFile",this.shouldShowHelp=e.createObservable(!1,"shouldShowHelp","VMDocSharing"),this.closeCallback=void 0,this.justCreated=!1,this._contactsAutocomplete=new a(this.onContactSelected.bind(this)),this.newEmail.subscribe(this._contactsAutocomplete.onContactEmailUpdate.bind(this._contactsAutocomplete)),this.init()}var c={init:function(){this.registerModal(this.open.bind(this),this.onClose.bind(this))},open:function(t,n){this.doc(t),this.closeCallback=n,this.isLoading(!0),this.isCreating(!this.doc().hasDriveBacking()),this.permissions.removeAll(),this.permissionsNew.removeAll(),this.permissionsRemove=[],this.newEmail(""),this.errorGlobal(!1),this.errorName(!1),this.errorInvite(!1),this.isSaving(!1),this.editing(!1),this.shouldShowHelp(e.vmMain.shouldShowHelp(this.helpID)),this.justCreated=!1,this.inputName=document.getElementById("shareNameInput"),this.inputName.value=this.doc().getTitle(),this.shareLink=document.getElementById("shareLinkInput"),this.shareLink&&(this.shareLink.value="https://moo.do/app/#file="+this.doc().id+"&sinfo="+this.doc().generateShareInfo()),i.mobile||setTimeout(function(){this.inputName.focus()}.bind(this),0),this.isCreating()?this.isLoading(!1):this.doc().listPermissions(this.permissionHandler.bind(this))},addPadding:function(){var t=i.windowHeight()-i.getKBSize()+e.topBarHeight;i.android&&(t=i.getKBSize()+20),e.element("shareScroller").style.paddingBottom=t+"px"},removePadding:function(){document.getElementById("shareScroller").style.paddingBottom=""},permissionHandler:function(t){if(t){this.isLoading(!1);for(var i=[],n=0;n<t.length;++n){var r=t[n];r.emailAddress!==e.getUserIdentifier()&&(r.onRemove=this.onRemove.bind(this,r),"anyone"!==r.id&&(r.emailAddress||("owner"===r.role?r.emailAddress="Owner":r.emailAddress=""),"owner"===r.role?i.splice(0,0,r):i.push(r)),r.emailDisplay="("+r.emailAddress+")")}this.permissions(i)}},isOwned:function(){return this.doc().isOwned&&this.doc().isOwned()},saveText:function(){if(this.isCreating())return this.isSaving()?"CREATING...":"CREATE";if(i.mobile&&this.editing()){switch(this.editing()){case"Name":return"SAVE";case"Invite User":return"INVITE"}return""}return this.newEmail().length>0?"INVITE":this.isSaving()?"SAVING...":"SAVE"},titleText:function(){return i.mobile&&this.editing()?this.editing():this.isCreating()?"Create File":"Edit File"},onKeyboardOpened:function(e){this.editing(e.target.title)},inviteUser:function(){var t=this.newEmail();if(0===t.length)return void this.errorInvite("");var i=this._getEmailAddrFromStr(t);if(!e.isEmail(i))return this.errorInvite("Please enter a valid email address."),!1;var r={emailAddress:i,error:e.createObservable(!1,"user.error","VMDocSharing")},a=n.contactManager.findContactByEmail(r.emailAddress.toLowerCase());return r.name=a?a.text:r.emailAddress,r.onRemove=this.onRemoveNew.bind(this,r),this.permissionsNew.push(r),this.newEmail(""),this.errorInvite(!1),!0},checkName:function(){var e=this.inputName.value.trim();return e.length>0&&e.length<255?(this.errorName(!1),!0):(this.errorName("Error: File name must be >0 and <255 characters."),!1)},rename:function(){var e=this.inputName.value.trim();e!==this.doc().getTitle()&&this.doc().rename(e,function(e){e||this.errorName("Error: Unable to update name on remote server.")}.bind(this))},create:function(t){this.justCreated=!0,this.isSaving(!0);var i=this.inputName.value.trim();this.doc().rename(i,function(t){try{e.PAssert(4435,t,"Rename during create must be successful")}catch(t){e.reportError(t)}}),r.createAndSetupDocument(this.doc(),!1,function(e){e&&!e.error?(this.isCreating(!this.doc().hasDriveBacking()),this.isSaving(!1),t&&t()):this.errorGlobal("Error: Unable to create new file.")}.bind(this))},save:function(){if((!this.isSaving()||this.justCreated)&&this.checkName()){if(this.isCreating())return void this.create(this.save.bind(this));if(this.newEmail().length>0){if(!this.inviteUser())return}else this.errorInvite(!1);this.rename();for(var t=this.doc().isShared(),i=0,n=function(n,r){r?--i<=0&&(e.menus.closeModal(Modals.ShareDoc,!1),this.doc().isOwned()&&this.doc().isOpen()&&e.vmMain.pluginManager.onDocumentShared(t)):(this.permissionsNew()[n].error(!0),this.errorInvite("Some people could not be invited."),this.isSaving(!1))}.bind(this),r=0;r<this.permissionsNew().length;r++){var a=this.permissionsNew()[r];a.error()||(i++,this.doc().insertPermission(a.emailAddress,n.bind(this,r)))}for(var r=0;r<this.permissionsRemove.length;r++){var s=this.permissionsRemove[r];this.doc().deletePermission(s.id,function(e){})}this.errorInvite()||this.errorName()||(0===i?e.menus.closeModal(Modals.ShareDoc,!0):(this.isSaving(!0),this.onClose(!0)))}},onClose:function(t){this.closeCallback&&(this.closeCallback(t),this.closeCallback=void 0),e.blurActiveElement()},onTapGotIt:{onStart:e.handlerPreventStop,onClick:function(t){e.vmMain.closeHelp(this.helpID),this.shouldShowHelp(!1)}},onTapInviteMessage:{onStart:e.handlerPreventStop,onClick:function(t){var n=e.element("inputShareInvite");i.mobile?e.menus.focusModalInputMobile(t,n):n.focus()}},onTapSave:{onStart:e.handlerPreventStop,onClick:function(){this.isSaving()||(this.editing()||this.newEmail().length>0?(e.blurActiveElement(),this.inviteUser(),this.editing("")):(this.save(),e.sendEvent("Menu","SharingSave")))}},onTapCancel:{onStart:e.handlerPreventStop,onClick:function(){this.editing()?(e.blurActiveElement(),this.editing("")):(e.blurActiveElement(),e.menus.closeModal(Modals.ShareDoc,!1),e.sendEvent("Menu","SharingCancel"))}},onTapDelete:{onClick:function(){e.sendEvent("Menu","SharingDelete");var t;(t=i.appPlatform===AppPlatform.Chrome||confirm("Are you sure you want to delete the file?"))&&(e.vmMain.docManager.deleteDoc(this.doc().id,function(t){log("File Delete Response: ",t),t||e.toasts.pushMessage({text:"Unable to delete file on the remote server."})}),e.menus.closeModal(Modals.ShareDoc,!1))}},onRemove:function(t){this.permissionsRemove.push(t),this.permissions.remove(t),e.sendEvent("Menu","SharingRemoveUser")},onRemoveNew:function(e){this.permissionsNew.remove(e)},_getEmailAddrFromStr:function(e){var t;if(e){var i=/(?:\"?([^\"]*)\"?\s)?<(.*)>/g,n=i.exec(e);t=n?n[2]:e}return t},onContactSelected:function(t){t?(e.scrollIntoView(e.element("inputShareInvite"),0),this.newEmail(t)):this.newEmail("")},onkeydown:function(e,t){return i.normalizeKeys(t),this._contactsAutocomplete.onkeydown(e,t),t.normCode===KeyCode.Enter&&this.inviteUser(),!0}};return t.inherit(s,o),t.extend(o.prototype,c),o}),define("VMPicker",["require","globals","data","util","platform","gdata","goog","tracker","Observable","VMDocument","VMDocSharing","Dispatcher"],function(e){function t(){this.fileMap={},this.isLoading=new l(!1),this.showError=new l(!1),this.listHeight=void 0,this.scrollDebounced=!1,this._openFile=void 0,this.loadCallbacks=[],this.init()}var i=e("globals"),n=e("data"),r=e("util"),a=e("platform"),s=e("gdata"),o=e("goog"),c=e("tracker"),l=e("Observable"),d=e("VMDocument"),h=e("VMDocSharing"),u=e("Dispatcher");return t.prototype={init:function(){new h,a.mobile&&setTimeout(function(){i.vmMain.docManager.getDocList().listen(function(){u.fireEvent("documentsLoaded",[])}.bind(this))}.bind(this),0)},hasFiles:function(){return i.vmMain.docManager.getDocList().get().length>0},showLoading:function(){return!this.hasFiles()&&!this.showError.get()},refreshFiles:function(){this.loadFileList()},runLoad:function(){i.vmMain.docManager.loadDocList(function(e){e||this.showError.set("Refresh Documents List"),this.isLoading.set(!1)}.bind(this))},loadFileList:function(){this.isLoading.get()||(this.isLoading.set(!0),this.showError.set(!1),this.runLoad())},requestOpenDocument:function(e){var t=i.vmMain.docManager.getDoc(e);t?this.openDocument(t):this.openDocumentFromId(e)},openDocumentFromId:function(e,t){try{i.PAssert(4436,e,"Document should always have a valid id")}catch(e){i.reportError(e)}try{i.PAssert(4437,t,"Document should always have a valid title")}catch(e){i.reportError(e)}o.getDocId()!==e&&(s.hasPotentialUnsavedData()&&!i.hasPageDataBeenCleared()?i.toasts.pushMessage({text:"You have made changes that have not been saved to the server. Go online to sync.",actionText:"OKAY"}):i.isOffline()?i.toasts.pushMessage({text:"You are currently offline. Connect to the internet to switch files.",actionText:"OKAY"}):n.clearData(function(){o.setDocInfo(e,t),r.hasURLParam("file")?r.removeURLParam("file",!0):r.hasURLParam("state")&&r.removeURLParam("state",!0),setTimeout(function(){i.reload()},500)},n.defaultSkipSettings,!0))},openDocument:function(e){i.localDocChangeRequested=!0,this.openDocumentFromId(e.id,e.getTitle())},onTapReloadDocuments:function(e){this.loadFileList()},openSharing:function(e,t){i.menus.openModal(Modals.ShareDoc,e,t)},onTapDocument:{onClick:function(e){var t=i.dataFor(e.target,!0);i.hasClass(e.target,"documentTitle")?this.onClickDocumentTitle(t):t instanceof d?(this.onClickDocumentSettings(t),e.stopImmediatePropagation()):"documentsList"!==e.target.id&&i.reportError(new Error("Incorrect document type: "+i.elementToString(e.target))),e.preventDefault(),e.stopImmediatePropagation()}},onTapAddDocument:function(){if(i.vmMain&&i.vmMain.isOnline()){var e=i.vmMain.docManager.createNewDoc();i.sendEvent("Menu","AddDocument"),this.openSharing(e,function(t){t&&i.vmMain.docManager.setDoc(e)}),c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddDocument})}else i.toasts.pushMessage({text:"You must be online to create a new document."})},onTapRefresh:{onStart:i.handlerStopProp,onClick:function(){i.vmMain&&i.vmMain.isOnline()&&!this.isLoading.get()&&this.refreshFiles()}}},t}),define("KeyboardToolbar",["globals","data","edit","platform","tracker","Sel","Dispatcher","Observable","Constants"],function(e,t,i,n,r,a,s,o,c){function l(){this.isVisible=new o(!1),this.mode=new o,this.aboutToShow=void 0,this.bottomPosition=new o(0),this.topBarHidden=!1,this.init()}return l.prototype={init:function(){s.listen("closeKeyboard",this.hide.bind(this)),s.listen("itemsUpdated",a.closeKeyboardIfNoSelection)},preShow:function(){this.aboutToShow=!0,setTimeout(function(){this.aboutToShow=!1}.bind(this),100)},show:function(t){this.aboutToShow=!1,this.updatePosition(),this.mode.set(t),e.isKeyboardOpen=!0,(!n.ie||n.ie&&(n.mobro||n.winphone))&&this.isVisible.set(!0),setTimeout(function(){r.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenKeyboard}),e.fireCustomEvent("keyboardOpened")},0)},hide:function(){!this.aboutToShow&&e.isKeyboardOpen&&(e.isKeyboardOpen=!1,e.focusedPane.removePadding(),e.onCloseKeyboard(),this.hideTopBarIfLandscape(),this.isVisible.set(!1),r.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseKeyboard}))},shouldHideTopBar:function(){return n.orientation===Orientation.Landscape&&(e.isKeyboardOpen||this.aboutToShow)&&!e.getActiveSearch().UI.isFocused},hideTopBarIfLandscape:function(){this.shouldHideTopBar()?(e.setTransform(e.element("container"),0,-e.topBarHeight),this.topBarHidden=!0):this.topBarHidden&&(this.topBarHidden=!1,e.setTransform(e.element("container"),0,0))},updatePosition:function(){var t=n.getKBSize()-(this.shouldHideTopBar()?e.topBarHeight:0);t!==this.bottomPosition.get()&&this.bottomPosition.set(t),e.isKeyboardOpen&&e.focusedPane.addPadding()},getScroll:function(){return e.settings.get(Settings.keyboardToolbarScroll)},setScroll:function(t){e.settings.set(Settings.keyboardToolbarScroll,t)}},new l}),define("IntroSection",["require","globals","platform","Observable"],function(e){function t(e,t,i){this.isComplete=new r(!1),this.id=e,this.text=t,this.noRender=i,this.items=[],this.inOrder=!1,this.enforceOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0}var i=e("globals"),n=e("platform"),r=e("Observable");return t.prototype={defaultShow:function(){this.isDisabled.set(!1)},loadFromSaveData:function(e){this.numComplete=0;for(var t=0,n=0;n<this.items.length;++n){var r=this.items[n];e[r.id]&&(r.isComplete.set(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,n+1))),r.hiddenObservable&&r.hiddenObservable.get()||r.visibleObservable&&!r.visibleObservable.get()||t++}if((this.numComplete===t||e[this.id])&&this.isComplete.set(!0),this.inOrder&&0!==this.next&&this.next<t){var a=this.items[this.next];a&&(a.show(),!i.isKeyboardOpen&&this.owner.needsKeyboardOpen&&i.tooltip.hideTip())}},saveData:function(e,t){for(var n=0;n<this.items.length;++n){var r=this.items[n];try{i.PAssert(4438,r,"Item entries must exist")}catch(e){i.reportError(e)}r.isComplete.get()&&(e[r.id]=1)}t&&this.isComplete.get()&&(e[this.id]=1)},addStep:function(e){try{i.PAssert(4439,!!e.id==!!e.check,"Invalid help step")}catch(e){i.reportError(e)}!1!==e.if&&(e.isComplete||(e.isComplete=new r(!1)),this.inOrder&&!n.mobile?e.isDisabled||(e.isDisabled=new r(this.items.length>0)):e.isDisabled=new r(!1),e.isHotkeyOr=e.isHotkeyOr,e.show||(e.show=this.defaultShow.bind(e)),this.items.push(e))},complete:function(e){e.isComplete.get()||(e.isComplete.set(!0),this.numComplete++,this.numComplete===this.items.length&&this.isComplete.set(!0),this.owner.notifyOfChange(e))},forceComplete:function(){this.isComplete.set(!0),this.numComplete=this.items.length,this.owner.notifyOfChange()},check:function(e){try{i.PAssert(4440,!this.isComplete.get(),"Should never be checking items in a completed section")}catch(e){i.reportError(e)}for(var t=0;t<this.items.length;t++){var n=this.items[t];if(!n.isComplete.get()&&((!0===e||n.check&&n.check(e))&&(this.complete(n),this.inOrder&&t===this.next&&++this.next<this.items.length&&this.items[this.next].show()),this.enforceOrder))break}}},t}),define("MooReact",["require","globals","Constants","react","react-dom","platform","Hotkeys","Observable","ObservableArray","Dispatcher","Trigger"],function(e){function t(e){if(e.componentDisplay)if(c.mobile)try{r.PAssert(4443,r.isFlagSet(e.componentDisplay,a.ComponentDisplay.Mobile),"Component created on wrong platform")}catch(e){r.reportError(e)}else try{r.PAssert(4444,r.isFlagSet(e.componentDisplay,a.ComponentDisplay.Desktop),"Component created on wrong platform")}catch(e){r.reportError(e)}else console.log("Create Unmarked Component: ",e.constructor.displayName)}function i(e,t){return e===t?0!==e||1/e==1/t:e!==e&&t!==t}function n(e,t,n){if(i(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(var s,o=0;o<r.length;o++){if(s=void 0,!hasOwnProperty.call(t,r[o]))return!1;if(n&&!1===(s=n(r[o],e[r[o]],t[r[o]])))return!1;if(void 0===s&&!i(e[r[o]],t[r[o]]))return!1}return!0}var r=e("globals"),a=e("Constants"),s=e("react"),o=e("react-dom"),c=e("platform"),l=e("Hotkeys"),d=e("Observable"),h=e("ObservableArray"),u=e("Dispatcher"),p=e("Trigger"),m={};m.createClass=function(e){try{r.PAssert(4441,!e.mixins,"Should not supply separate mixins value")}catch(e){r.reportError(e)}try{r.PAssert(4442,e.displayName,"Must always specify displayName for react components")}catch(e){r.reportError(e)}e.mixins=[m.MooReactMixin];var t=!1;return e.componentDisplay?c.mobile&&r.isFlagSet(e.componentDisplay,a.ComponentDisplay.Mobile)?t=!0:!c.mobile&&r.isFlagSet(e.componentDisplay,a.ComponentDisplay.Desktop)&&(t=!0):(t=!0,__warn("Unmarked React Create: ",e.displayName)),t?s.createClass(e):void 0};var f=0;return m.MooReactMixin={shouldComponentUpdate:function(e,t){return!n(this.props,e,this.arePropsEqual)||!n(this.state,t,this.areStatesEqual)},getInitialState:function(){t(this),this.init&&this.init();var e=this.getState?this.getState(this.props):{};this._observables&&(e=r.extend(e,this._observables));var i=null;return e&&(this.setupListeners(e),i=this.transformState(e)),i},createObservables:function(e){try{r.PAssert(4445,!this._listeners,"You have to run createObservables in init()")}catch(e){r.reportError(e)}for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];r.isArray(i)?e[t]=new h(i):e[t]=new d(i);try{r.PAssert(4446,!this.hasOwnProperty(t),"Must not multi-define observable properties")}catch(e){r.reportError(e)}this[t]=e[t]}try{r.PAssert(4447,!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables")}catch(e){r.reportError(e)}this._observables=e},_addListener:function(e){try{r.PAssert(4448,e&&e.target,"Must add a valid listener")}catch(e){r.reportError(e)}this._ensureListeners();try{r.PAssert(4449,!this._hasListener(e.target),"Must not double register the same observable/trigger")}catch(e){r.reportError(e)}this._listeners.push(e)},refreshListeners:function(){this.disposeListeners();var e=this.getState?this.getState(this.props):{};this._observables&&(e=r.extend(e,this._observables)),e&&this.setupListeners(e)},_ensureListeners:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])},setupListeners:function(e){this._ensureListeners(),e||(e=this.getState?this.getState(this.props):{});for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];i instanceof d&&this._addListener(i.listen(this.onListener))}},disposeListeners:function(e){if(this._listeners){for(var t=0;t<this._listeners.length;++t)this._listeners[t].dispose();if(this._listeners=[],e)for(var t=0;t<this._permanentListeners.length;++t)this._permanentListeners[t].dispose()}e&&this.disposeDispatcherListeners()},disposeDispatcherListeners:function(){if(this._dispatcherListeners){for(var e=0;e<this._dispatcherListeners.length;e++){var t=this._dispatcherListeners[e],i=t[0],n=t.slice(1);i.unlisten.apply(i,n)}this._dispatcherListeners=[]}},listenTo:function(e,t){try{r.PAssert(4450,e instanceof p||e instanceof d,"Can only listen to an Observable or a Trigger object")}catch(e){r.reportError(e)}if(e instanceof p||e instanceof d){var i=e.listen(this.onListener);!1!==t?this._addListener(i):this._permanentListeners.push(i)}},listenToDispatcher:function(){this._dispatcherListeners||(this._dispatcherListeners=[]);var e,t=Array.prototype.slice.call(arguments);r.isString(t[0])?e=u:(e=t[0],t.splice(0,1)),t.push(this.onListener),e.listen.apply(e,t);var i=[e].concat(t);this._dispatcherListeners.push(i)},listenToSetting:function(e,t){this.listenToDispatcher(r.settings,"settingChanged",t||Settings.DefaultGroup,e)},_hasListener:function(e){try{r.PAssert(4451,e,"Must have a valid target")}catch(e){r.reportError(e)}for(var t=!1,i=0;i<this._listeners.length;++i)if(this._listeners[i].target===e){t=!0;break}return t},_getState:function(e){var t=this.getState?this.getState(e||this.props):{};return this._observables&&(t=r.extend(t,this._observables)),this.transformState(t)},transformState:function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];i&&i instanceof d&&(e[t]=i.get(),i instanceof h&&(e[t+"_arrVer"]=i.version))}return e},onListener:function(){this.updateState()},updateState:function(e){try{r.PAssert(4453,this._isMounted,"updateState called on a component that is not yet mounted:",this.constructor&&this.constructor.displayName)}catch(e){r.reportError(e)}if(this._isMounted){var t=this.state,i=this._getState(e);this.onBeforeChanged&&(i=this.onBeforeChanged(i,t,e)||i),this.setState(i),this.onAfterChanged&&this.onAfterChanged(i,t)}},setData:function(e,t){try{r.PAssert(4454,this.__id,"A unique ID must have been generated for this object")}catch(e){r.reportError(e)}r.setDataFor(e,t,this.__id),this.__elementData=e},clearData:function(){this.__elementData&&(this.__elementData=void 0,r.clearDataFor(this.__id))},componentWillUnmount:function(){this.disposeListeners(!0),this.clearData(),this.__hotkeys&&(l.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1},addTap:function(e,t,i){var n=this.refs[e];try{r.PAssert(4455,n,"Invalid refName to add tap to: ",e)}catch(e){r.reportError(e)}n&&r.setupClick(n,t,i)},refElement:function(e){var t=this.refs[e];return r.isDOMNode(t)?t:o.findDOMNode(t)},getChildByKey:function(e){var t;return s.Children.forEach(this.props.children,function(i){i&&i.key===e&&(t=i)}),t},getChildByDisplayName:function(e){var t;return s.Children.forEach(this.props.children,function(i){i&&i.type&&i.type.displayName===e&&(t=i)}),t},componentDidMount:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=l.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=l.pushStackEscape(this.onEscapeKey))},getUniqueID:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+f++),this.__id)}},m});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("Components/FancyRippler",["require","globals","Constants","platform","react","react-dom","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("react-dom");return e("MooReact").createClass({displayName:"FancyRippler",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{rippleColor:r.PropTypes.string},init:function(){this.createObservables({ripples:[]}),this.rippleNum=0},componentDidMount:function(){n.mobile&&this.props.onClick&&t.setupClick(this.refs.element,this,this.onTap)},getElement:function(){return a.findDOMNode(this)},onMouseDown:function(e){var i=this.props;if(!1!==i.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(e),this.props.children&&!e.defaultPrevented&&!1!==i.ripple){var n,r,a=this.refs.element,s=a.offsetWidth,o=a.offsetHeight,c=Math.max(s,o);if(this.props.center)n="50%",r="50%";else{var l=t.offset(a);n=e.clientX-l.left,r=e.clientY-l.top}var d={id:this.rippleNum++,left:n,top:r,width:c,height:c};this.ripples.push(d),setTimeout(this.removeRipple,1e3)}e.stopPropagation()}},onTap:{onStart:function(e){!1===this.props.enabled||t.findParent(e.target,"fancyInput")||(this.onMouseDown(e),e.stopPropagation())},onClick:function(e){!1===this.props.enabled||t.findParent(e.target,"fancyInput")||(this.props.onClick(e),e.preventDefault(),e.stopPropagation())}},removeRipple:function(){this.ripples.removeAt(0)},render:function(){for(var e=this.state,i=this.props,a=[],s=0;s<e.ripples.length;s++){var o=e.ripples[s],c={left:o.left,top:o.top,width:o.width,height:o.height};a.push(r.createElement("div",{key:"ripple_"+o.id,className:"fancyRipple",style:c}))}var l=t.classNames(this.props.className,"fancyRippler",{rippleCenter:this.props.center}),d=(i.center,i.onClick),o=(i.enabled,i.ripple),h=_objectWithoutProperties(i,["center","onClick","enabled","ripple"]);return r.createElement("div",_extends({},h,{className:l,onMouseDown:!n.mobile&&this.onMouseDown,onClick:!n.mobile&&d,ref:"element"}),this.props.children,a.length>0&&r.createElement("div",{className:"fancyRipples"},a))}})}),define("Components/FancyButton",["require","globals","Constants","platform","react","react-dom","MooReact","Components/FancyRippler"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("react-dom"),s=e("MooReact"),o=e("Components/FancyRippler");return s.createClass({displayName:"FancyButton",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{onClick:r.PropTypes.func,onMouseDown:r.PropTypes.func,id:r.PropTypes.string,enabled:r.PropTypes.bool,className:r.PropTypes.string,raised:r.PropTypes.bool,primary:r.PropTypes.bool,cancel:r.PropTypes.bool,icon:r.PropTypes.string,selected:r.PropTypes.bool,width:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.number]),height:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.number])},init:function(){this.createObservables({isLoading:!1})},getElement:function(){return a.findDOMNode(this)},onClick:function(e){if(!this.isLoading.get()&&!1!==this.props.enabled){(this.props.onClick||this.props.onMouseDown)(e,this.onButtonClickCallback)&&this.isLoading.set(!0)}},onMouseDown:function(e){if(!1!==this.props.enabled){var t={target:e.target};this._holdTimeout=setTimeout(this.onHold,150,t)}},onMouseUp:function(){this._clearHoldTimeout()},onHold:function(e){this._clearHoldTimeout(),this.props.onHold(e)},_clearHoldTimeout:function(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)},onKeyDown:function(e){e.keyCode===KeyCode.Enter&&this.onClick(e)},focus:function(){this.getElement().focus()},onButtonClickCallback:function(){this.isLoading.set(!1)},removeRipple:function(){this.ripples.removeAt(0)},render:function(){var e,i=this.state,a=this.props,s=!1===a.enabled;a.primary?e=a.raised?"c-button-raised-primary":"c-button-primary":a.heavy?a.raised||(e="c-button-heavy"):e=a.cancel?a.raised?"c-button-raised-cancel":"c-button-cancel":a.raised?"c-button-raised":"c-button";var c={display:a.display,lineHeight:a.height?"auto"===a.height?null:a.height+"px":"36px",height:a.height,width:a.width,textAlign:"center",margin:a.margin,paddingLeft:a.paddingLeft,paddingTop:a.paddingTop,paddingRight:a.paddingRight,paddingBottom:a.paddingBottom,fontWeight:a.fontWeight,fontSize:a.fontSize,color:a.color};void 0===a.margin&&(c.marginLeft=a.marginLeft,c.marginTop=a.marginTop,c.marginRight=a.marginRight,c.marginBottom=a.marginBottom),c=t.extend(c,this.props.style),a.raised&&!a.children&&a.icon&&(c.borderRadius="50%");var l,d={fontSize:a.fontSize};if(a.icon){var h={height:a.height,fontSize:a.iconSize},u=t.classNames("fancyButtonIcon",a.icon);a.children?0!==a.padding&&(d.paddingLeft="6px",d.paddingRight=0,c.paddingLeft="16px",c.paddingRight="16px"):(c.width=a.width||36,c.height=a.height||36,c.textAlign="center"),l=r.createElement("i",{className:u,style:h})}isNaN(a.padding)||(d.padding="0 "+a.padding+"px");var p=a.children&&r.Children.count(a.children)>0,m=t.classNames("fancyButtonText"),f=p&&r.createElement("div",{className:m,style:d},a.children),g=t.classNames("fancyButton",e,{raised:a.raised},{loading:i.isLoading},{primary:a.primary},{cancel:a.cancel},{hasText:p},{hasIcon:!!a.icon},{disabled:s},a.className),v=i.isLoading&&r.createElement("div",{className:"fancyButtonLoading"},r.createElement("i",{className:"icon-spinner"}));return r.createElement(o,{className:g,style:c,enabled:a.enabled,onMouseEnter:!n.mobile&&this.onMouseEnter,onMouseLeave:!n.mobile&&this.onMouseLeave,onMouseDown:!n.mobile&&a.onMouseDown&&this.onClick||a.onHold&&this.onMouseDown,onMouseUp:!n.mobile&&a.onHold&&this.onMouseUp,onClick:a.onClick&&this.onClick,onKeyDown:this.onKeyDown,id:a.id,center:a.center||!!a.icon&&!p,ripple:a.ripple,tabIndex:a.tabIndex,"data-tooltip":s?null:a.tooltip,"data-tooltipHotkey":s?null:a.tooltipHotkey},l,f,v)}})}),define("Intro",["require","globals","data","Constants","react","util","tracker","platform","Observable","ObservableArray","ObservableComputed","IntroSection","Sel","Dispatcher","Components/FancyButton"],function(e){function t(){n.menus.openSettings(a.SettingsSections.Plugins)}function i(){l.mobile||(n.intro=this)}
var n=e("globals"),r=e("data"),a=e("Constants"),s=e("react"),o=e("util"),c=e("tracker"),l=e("platform"),d=e("Observable"),h=e("ObservableArray"),u=e("ObservableComputed"),p=e("IntroSection"),m=e("Sel"),f=e("Dispatcher"),g=e("Components/FancyButton"),v={display:"inline-block",height:"24px"},y=function(e,t,i){n.menus.openSidebarMenu(n.element(e),t,i)};return i.prototype={init:function(){this.mode=new d(a.HelpMode.None),this.position=new d,this.sections=new h,this.isVisible=new u([this.mode],function(){return this.isHelpShowing()}.bind(this)),this.priKey=l.priModKey,this.secKey=l.secModKey,this.secKeyForce=l.secModKeyForce,this.tooltipIntroSection=void 0;var e=n.settings.get(Settings.helpPaneState);void 0===e&&(e=a.HelpMode.None),this.initItemsDesktop(),n.isDemoMode()||(this.initState(e),!l.mobile&&n.settings.get(Settings.inTooltipIntro)&&this.tooltipIntroSection.isComplete.get()&&n.settings.set(Settings.inTooltipIntro,!1)),n.settings.registerForChangeNotification(Settings.helpPaneState,void 0,function(e,t){void 0!==t&&t!==e&&this.initState(t)}.bind(this)),n.settings.registerForChangeNotification(Settings.helpState,void 0,function(e,t){t&&t!==e&&this.loadState()}.bind(this)),c.addListener(this.onAction.bind(this))},isHelpShowing:function(){return this.mode.get()!==a.HelpMode.None},initState:function(e){try{n.PAssert(4456,void 0!==e,"Must pass in a valid intro mode")}catch(e){n.reportError(e)}this.sections.clear(),this.mode.set(e),this.isHotkeyMode()?this.initHotkeys():this.initHelp(),!l.mobile&&n.settings.get(Settings.inTooltipIntro)&&this.initTooltipIntro(),this.loadStateLegacy(),this.loadState()},initItemsDesktop:function(){this.itemIndent={id:"458052715",text:'Press <span class="hHotkey">Tab</span> to indent an item into a list and <span class="hHotkey">Shift + Tab</span> to unindent out of a list',check:this.checkIndent},this.itemDateTime={id:"321249113",text:"Add a date/time by typing @ in the text of an item",check:this.checkDate},this.itemRightClick={id:"3288459206",text:"Right click an item to explore more options",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.RightClick}};var e=n.vmMain.getDefaultEmailPlugin(),i=n.vmMain.pluginManager.getPlugin(PluginID.GCalendar),r=n.vmMain.pluginManager.getPlugin(PluginID.Drive);this.itemPluginSettings={id:"ep",jsx:s.createElement("span",null,s.createElement("span",{style:v},s.createElement(g,{raised:!0,primary:!0,marginRight:8,onClick:t},"Enable plugins")),"to connect to your other services"),hiddenObservable:new u([e.isActiveObs,i.isActiveObs,r.isActiveObs]),check:function(){}},this.itemOpenEmail={id:"dblE",text:"Double click an email to open it",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenEmail&&e.data.pane.type===PaneMode.Gmail}},this.itemDragEmail={id:"drgEm",text:"Drag an email to your Outline to organize it",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&e.data.fromPane&&e.data.fromPane.type===PaneMode.Gmail}},this.itemRightClickEmail={id:"rcE",text:"Right click an email to explore more options",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.RightClick&&e.data.pane.type===PaneMode.Gmail}},this.itemGmailLabels={id:"lbls",text:'Click <i class="overviewButtonNormal icon-menu g"></i> in the top left to access your labels',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleOverview&&e.data.pane.type===PaneMode.Gmail}},this.itemGmailCompose={id:"cmp",text:'Click <i class="icon-edit2 g"></i> in the sidebar to compose a new email',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ComposeEmail}}},setMode:function(e){this.mode.set(e),n.settings.set(Settings.helpPaneState,e)},show:function(e){this.setMode(e||a.HelpMode.Normal)},toggle:function(e){!this.isHelpShowing()||e&&this.mode.get()!==e?this.show(e):this.close()},close:function(){n.tooltip.hideTip(),this.setMode(a.HelpMode.None),n.sendEvent("Menu","CloseHelp")},isHotkeyMode:function(){return this.mode.get()===a.HelpMode.Hotkeys},loadStateLegacy:function(){if(n.shouldWriteLocal())try{var e=o.storage.getItem("help");if(e){var t=JSON.parse(e);if(t){for(var i=0;i<this.sections.get().length;++i){this.sections.get()[i].loadFromSaveData(t)}console.log("found old data and migrating it"),this.saveState(),o.storage.removeItem("help")}}}catch(e){n.reportError(e)}},_getHelpStateObj:function(){var e={},t=n.settings.get(Settings.helpState);if(t)try{e=JSON.parse(t),e&&!n.isString(e)||(e={})}catch(e){n.reportError(e)}return e||{}},loadState:function(){var e=this._getHelpStateObj();if(e)for(var t=0;t<this.sections.get().length;++t)this.sections.get()[t].loadFromSaveData(e)},saveState:function(){if(n.shouldWriteLocal())try{var e=this.getState();n.settings.set(Settings.helpState,JSON.stringify(e))}catch(e){n.reportError(e)}},getState:function(){for(var e=this._getHelpStateObj(),t=0;t<this.sections.get().length;++t){this.sections.get()[t].saveData(e)}return e},notifyOfChange:function(){this.saveState()},createSection:function(e,t,i,n){var r=new p(e,t,n);r.owner=this;for(var a=0;a<i.length;a++)r.addStep(i[a]);return r},addSection:function(e,t,i,n){var r=this.createSection(e,t,i,n);return this.sections.push(r),r},initHotkeys:function(){this.addSection(null,"Basic",[{text:'<span class="introHotkey">Tab</span>Indent an item'},{text:'<span class="introHotkey">'+this.secKey+" + ]</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKeyForce+" + Shift + Right</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">Shift + Tab</span>Un-indent an item'},{text:'<span class="introHotkey">'+this.secKey+" + [</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKeyForce+" + Shift + Left</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKey+" + /</span>Complete an item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Enter</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.priKey+" + N</span>Create new item"},{text:'<span class="introHotkey">'+this.secKey+" + 1 | 2 | 3</span>Set item priority"},{text:'<span class="introHotkey">'+this.secKey+" + 8</span>Star an item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Up</span>Collapse item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Down</span>Uncollapse item"},{text:'<span class="introHotkey">'+this.secKey+" + ,</span>Toggle collapsed"},{text:'<span class="introHotkey">'+this.secKey+" + .</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKeyForce+" + Space</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.priKey+" + F</span>Search for text"},{text:'<span class="introHotkey">'+this.secKeyForce+" + F</span>Search for text",isHotkeyOr:!0},{text:'<span class="introHotkey">Shift + Enter</span>Add multi-line note'},{text:'<span class="introHotkey">'+this.secKey+" + Shift + 3</span>Make item header"},{text:'<span class="introHotkey">'+this.secKey+" + Shift + [</span>Make item task"}]);var e=l.mac?l.priModKey+" + Option + S":"Alt + Shift + S";this.addSection(null,"Navigation",[{text:'<span class="introHotkey">'+this.priKey+" + Enter</span>Zoom a pane in an item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Right</span>",isHotkeyOr:!0,if:l.mac},{text:'<span class="introHotkey">'+this.priKey+" + Shift + Enter</span>Zoom out a pane"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Left</span>",isHotkeyOr:!0,if:l.mac},{text:'<span class="introHotkey">'+this.priKey+" + "+(l.mac?"Up":"Home")+"</span>Go to the top of a pane"},{text:'<span class="introHotkey">'+this.priKey+" + "+(l.mac?"Down":"End")+"</span>Go to the bottom of a pane"},{text:'<span class="introHotkey">'+this.secKey+" + G</span>Go to item in all panes"},{text:'<span class="introHotkey">'+this.secKey+" + J</span>Jump to item in current pane"},{text:'<span class="introHotkey">'+e+"</span>Toggle sidebar"},{text:'<span class="introHotkey">'+this.priKey+" + Shift + L</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.priKey+" + Shift + 1, 2, ...</span>Focus pane 1, 2, ..."}]),this.addSection(null,"Advanced",[{text:'<span class="introHotkey">'+this.secKey+" + Shift + /</span>Archive completed items"},{text:'<span class="introHotkey">'+(l.mac?"Ctrl + ⌘ + Up":"Alt + Shift + Up")+"</span>Move an item up in a list"},{text:'<span class="introHotkey">'+this.secKey+" + Shift + Up</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+(l.mac?"Ctrl + ⌘ + Down":"Alt + Shift + Down")+"</span>Move an item down in a list"},{text:'<span class="introHotkey">'+this.secKey+" + Shift + Down</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKey+" + Shift + ,</span>Collapse all top-level items"},{text:'<span class="introHotkey">'+this.secKey+" + Shift + .</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKey+" + Shift + Space</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">Shift + F4</span>Close the current pane'},{text:'<span class="introHotkey">'+this.secKey+" + T</span>Add new pane"},{text:'<span class="introHotkey">'+this.priKey+" + E</span>Add new item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + B</span>Select Board"},{text:'<span class="introHotkey">'+this.secKey+" + M</span>Move selected item to target"}]);var t=this.addSection(null,"Text Editor",[{text:'<span class="introHotkey">'+this.secKey+" + Z</span>Undo your last action"},{text:'<span class="introHotkey">'+this.secKey+" + Y</span>Redo your last action"},{text:'<span class="introHotkey">'+(l.mac?"Option":"Ctrl")+" + Backspace</span>Delete the previous word"},{text:'<span class="introHotkey">'+(l.mac?"Option":"Ctrl")+" + Delete</span>Delete the next word"},{text:'<span class="introHotkey">'+this.secKeyForce+" + L</span>Select the current item"},{text:'<span class="introHotkey">'+this.priKey+" + K</span>Add Link"}]);l.mac&&(t.addStep({text:'<span class="introHotkey">'+this.secKeyForce+" + Shift + A</span>Select to start of line"}),t.addStep({text:'<span class="introHotkey">'+this.secKeyForce+" + Shift + E</span>Select to end of line"})),this.addSection(null,"Gmail",[{text:'<span class="introHotkey">'+this.secKey+" + E</span>Compose new email"}]),this.addSection(null,"In Gmail Pane",[{text:'<span class="introHotkey">R</span>Reply'},{text:'<span class="introHotkey">Shift + R</span>Reply All'},{text:'<span class="introHotkey">F</span>Forward'},{text:'<span class="introHotkey">I</span>Mark as read'},{text:'<span class="introHotkey">U</span>Mark as unread'},{text:'<span class="introHotkey">8</span>Star / unstar'},{text:'<span class="introHotkey">S</span>',isHotkeyOr:!0},{text:'<span class="introHotkey">1 | 2 | 3</span>Priority'},{text:'<span class="introHotkey">D</span>Snooze'},{text:'<span class="introHotkey">L</span>Label'},{text:'<span class="introHotkey">M</span>Add to Outline'},{text:'<span class="introHotkey">V</span>',isHotkeyOr:!0},{text:'<span class="introHotkey">C</span>Move to Calendar'},{text:'<span class="introHotkey">E</span>Archive'},{text:'<span class="introHotkey">/</span>',isHotkeyOr:!0},{text:'<span class="introHotkey">Shift + E</span>Archive and close preview'},{text:'<span class="introHotkey">Y</span>Remove from current label'},{text:'<span class="introHotkey">Backspace</span>Delete'},{text:'<span class="introHotkey">Delete</span>',isHotkeyOr:!0}])},checkAddItem:function(e){if(e.type===TrackerType.Create){var t=r.getModel(e.data[0].itemID);return!(!t||t.parent()===r.getRootModel()&&0===e.data[0].position)}},checkIndent:function(e){if(e.type===TrackerType.Move){var t=r.getItem(e.data[0].oldParent);if(t&&t.items.indexOf(e.data[0].newParent)>=0)return!0}},checkSearch:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged},checkComplete:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isComplete"===t.field&&t.newValue}},checkOverview:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleOverview},checkZoom:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut&&n.focusedPane.overview.isVisible.get()},checkPriority:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"priority"===t.field&&t.newValue>0},checkDate:function(e){return e.type===TrackerType.Insert&&"@"===e.data[0].text},checkGoogleCalendar:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddToGCal},checkGoogleDrive:function(){},initHelp:function(){function e(){n.isDemoMode()||y("desktopDocumentsButton","ReactContextMenuDocuments")}function i(){y("optionsButton","ReactContextMenuOptions",!0)}function o(){n.menus.openModal(Modals.ReportBug)}this.sections.clear(),this.addSection("2102025841","Organization",[this.itemIndent,{id:"3825397189",text:"Click and drag on the left edge of an item to move it",check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&n.vmMain.isLoaded)return!0}},{id:"441256378",text:'Click the left edge of a list or press <span class="hHotkey">'+this.secKey+" + ,</span> to collapse its subitems",check:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isCollapsed"===t.field&&t.newValue}}}]),this.addSection("prefixes","Item Prefixes",[{id:"header",text:"Start a line with # to create a header",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SetPrefix&&e.data.prefix===a.Prefix.Header}},{id:"task",text:"Start a line with [ to create a task",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SetPrefix&&e.data.prefix===a.Prefix.Task}},{id:"bullet",text:"Start a line with - to create a bullet",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SetPrefix&&(e.data.prefix===a.Prefix.Bullet||e.data.prefix===a.Prefix.Bullet2||e.data.prefix===a.Prefix.Bullet3)}},{id:"numlist",text:"Start a line with 1. to create a numbered list",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SetPrefix&&e.data.prefix===a.Prefix.NumList}}]),this.addSection("3980400482","Dates",[this.itemDateTime,{id:"2538562480",text:'Write dates in plain English like <span class="date c-date">@tomorrow</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&n.vmMain.isLoaded){return!!e.data.date}}},{id:"745092254",text:'Schedule a full date and time like <span class="date c-date">@today 2:30pm</span> or <span class="date c-date">@5/25 6:00</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&n.vmMain.isLoaded){var t=e.data.date;if(t)return t.hasTimeOfDay()}}},{id:"3023653298",text:'Describe urgency with <span class="date c-date">@now</span>, <span class="date c-date">@soon</span>, or <span class="date c-date">@later</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&n.vmMain.isLoaded){var t=r.getModel(e.data.itemID);return!!t&&n.isDateSoft(t.getDateText())}}},{id:"1941003875",text:'Create a repeating date like <span class="date c-date">@every friday</span> or <span class="date c-date">@every other tuesday</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&n.vmMain.isLoaded){var t=e.data.date;if(t)return t.isRepeatDate()}}},{id:"766730775",text:'Create a repeating date with a beginning or end <span class="date c-date">@every friday from tomorrow</span> or <span class="date c-date">@every other tuesday until october</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&n.vmMain.isLoaded){var t=e.data.date;if(t&&t.isRepeatDate())return!t.getStartDate().equals(Date.today())||!!t.getEndDate()}}}]),this.addSection("cal","Google Calendar (Premium)",[{id:"enableCalendar",jsx:s.createElement("span",null,s.createElement(g,{raised:!0,primary:!0,marginRight:8,onClick:t},"Enable Google Calendar"),"to sync Google Calendar."),hiddenObservable:n.vmMain.pluginManager.getPlugin(PluginID.GCalendar).isActiveObs,check:function(){}},{id:"adc2",text:'Add an item with a date to Google Calendar by pressing <span class="hHotkey">'+this.secKeyForce+' + C</span> or right clicking the date.<span style="color: #777;"></span>',check:this.checkGoogleCalendar}]),this.addSection("3971635305","Priority",[this.itemRightClick,{id:"215510164",text:'Set a priority with the right click menu or <span class="hHotkey">'+this.secKey+" + 1|2|3</span>",check:this.checkPriority},{id:"2165585377",text:'Click the right edge of an item or <span class="hHotkey">'+this.secKey+" + /</span> to complete it",check:this.checkComplete},{id:"4286506454",text:'Press <span class="hHotkey">'+this.secKey+" + 8</span> to star an item and highlight it in yellow",check:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isStarred"===t.field&&t.newValue}}}]),this.addSection("4240025947","Contacts",[{id:"9158366",text:"Add a contact by typing + in the text of an item",check:function(e){return e.type===TrackerType.Insert&&"+"===e.data[0].text}},{id:"1594166733",text:'Click on a <span class="contact c-contact">+contact</span> to start a call or email',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenContact}}]),this.addSection("1493247039","Zooming",[{id:"1829655333",text:'To zoom in on an item, right click it and select Zoom In, press <span class="hHotkey">'+this.priKey+' + Enter</span>, or hold <span class="hHotkey">'+this.priKey+"</span> and click its left edge",check:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut}},{id:"3440644647",text:"To zoom back out, click the title of the list in the top of the pane",check:function(e){return e.type===TrackerType.Zoom&&e.data[0].zoomOut}},{id:"801492595",text:'Press <i class="overviewButtonNormal icon-menu g"></i> in the top left of a pane to open the overview',check:this.checkOverview},{id:"1720747864",text:'Click an item in the Overview to scroll to it or click <i class="icon-zoom-in g"></i> to zoom into it',check:this.checkZoom}]),this.addSection("1393893782","Search",[{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function(e){return e.type===TrackerType.Insert&&e.data[0].text===TagPrefix}},{id:"2783340419",text:'Filter by priority by clicking the <span class="searchPriority searchP0 hovered"></span> <span class="searchPriority searchP1 hovered"></span> <span class="searchPriority searchP2 hovered"></span> buttons',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&0!==e.data.priority}},{id:"923656242",text:'Show only starred items by clicking the <span class="c-foreground-faded icon-star"></span> button',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&0!==e.data.starred}},{id:"2227925102",text:'Hide completed items by clicking the <span class="c-foreground-faded icon-check"></span> button',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&0!==e.data.complete}},{id:"457209713",text:"Hide items you're not interested in by starting a search with - (dash)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data.text.indexOf("-")>=0}}]),this.addSection("gm","Gmail",[{id:"eG",jsx:s.createElement("span",null,s.createElement(g,{raised:!0,primary:!0,marginRight:8,onClick:t},"Enable Gmail"),"to sync Gmail."),hiddenObservable:n.vmMain.pluginManager.getPlugin(PluginID.Gmail).isActiveObs,check:function(){}},this.itemOpenEmail,this.itemDragEmail,this.itemRightClickEmail,this.itemGmailLabels]),this.addSection("formatting","Formatting",[{id:"format",text:"Format text like <i>*italic*</i>, <b>**bold**</b>, or <b><i>***both***</i></b>",check:function(e){}},{id:"link",text:"Insert links like [title](http://address.com)",check:function(e){}},{id:"hr",text:"--- to insert a horizontal line",check:function(e){}}]),this.addSection("327865517","Collaboration",[{id:"3453735943",jsx:s.createElement("span",null,s.createElement("span",{style:v},"Click ",s.createElement(g,{icon:"icon-folder",iconSize:18,onClick:e}))," in the sidebar to open the documents menu"),check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocumentsMenu}},{id:"4176091097",text:'Click <i class="icon-settings f18 g"></i> to change the sharing settings',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocSharing}}]),this.addSection("drv","Google Drive (Premium)",[{id:"eD",jsx:s.createElement("span",null,s.createElement(g,{raised:!0,primary:!0,marginRight:8,onClick:t},"Enable Google Drive"),"to sync Google Drive."),hiddenObservable:n.vmMain.pluginManager.getPlugin(PluginID.Drive).isActiveObs,check:function(){}},{id:"drL",text:"Drag a file from the Google Drive Pane to an Outline Pane to add it to a list",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&e.data.fromPane&&e.data.fromPane.type===PaneMode.Drive}},{id:"drDr",text:"Drag a file from your "+(l.mac?"Finder":"Explorer")+" to your Outline to upload it to Drive and add it to a list",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DriveUpload}}]),this.addSection("set","Settings",[{id:"oS",jsx:s.createElement("span",null,"Click ",s.createElement("span",{style:v},s.createElement(g,{icon:"icon-settings",iconSize:18,onClick:i}))," in the sidebar, then Settings, to access plugin and account settings."),check:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.OpenSettingsMenu}},{id:"oDS",jsx:s.createElement("span",null,"Click ",s.createElement("span",{style:v},s.createElement(g,{icon:"icon-settings",iconSize:18,onClick:i}))," in the sidebar, then Display Settings, to change display settings."),check:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.OpenDisplaySettings}}]),this.addSection("3926176240","Data",[{id:"1927292896",jsx:s.createElement("span",null,"Click on Import Data in the options menu in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please ",s.createElement(g,{primary:!0,onClick:o},"contact us")," and tell us what app you want to import from."),check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenImport}},{id:"67562060",text:"Click on Export Data in the options menu in the sidebar, then choose the format you'd like.",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenExport}}])},onAction:function(e){if(!n.menus.isModalOpen(Modals.ImportData))try{for(var t=this.sections.get(),i=0;i<t.length;++i)t[i].isComplete.get()||t[i].check(e)}catch(e){n.reportError(e)}},runTooltipIntro:function(){n.settings.set(Settings.inTooltipIntro,!0),this.initTooltipIntro()},initTooltipIntro:function(){function e(){return n.vmMain.pluginManager.isGmailPaneEnabled()}function t(e){try{n.PAssert(4457,e,"Must supply a valid tooltip descriptor")}catch(e){n.reportError(e)}try{n.PAssert(4458,!e||e.element,"Must specify a valid target tooltip element")}catch(e){n.reportError(e)}n.tooltip.hideSticky(e.text),e.blue=e.sticky=!0,"top"===e.arrowDirection&&(e.offset={top:15}),n.tooltip.displayTip(e)}function i(e){var i=!1;r.push({id:e.id,check:function(r){return!(!e.check2Invalidates1||!e.check2(r))||(e.check1(r)?(setTimeout(function(){var r=n.isFunction(e.element)?e.element():e.element,a=n.isFunction(e.text)?e.text():e.text;r&&(i=!0,t({text:a,element:r,arrowDirection:e.arrowDirection,onRight:e.onRight}))},1e3),!0):void 0)}}),r.push({id:e.id+"_complete",check:function(t){if(e.check2(t)){if(i){var r=n.isFunction(e.text)?e.text():e.text;n.tooltip.hideSticky(r)}return!0}}})}var r=[];i({id:"tipAddPaneMenu",text:"Click here to add a new pane",element:function(){return n.element("addPaneButton")},arrowDirection:"left",check2Invalidates1:!0,check1:this.checkAddItem,check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenAddPaneMenu}}),i({id:"tipAddPane",text:function(){return e()?"Add a Gmail pane to organize your email":"Add another Outline pane to get another view on your tasks."},element:function(){return e()?n.element("addPane_PaneGmail"):n.element("addPane_PaneOutline")},arrowDirection:"left",check2Invalidates1:!0,onRight:!0,check1:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenAddPaneMenu},check2:function(t){return t.type===TrackerType.UIAction&&t.data[0].type===TrackerUIAction.AddPane&&t.data[0].data.type===(e()?PaneMode.Gmail:PaneMode.Outline)}});var a;i({id:"tipNewOutlinePane",text:"Each Outline pane is a unique view on the same data. Customize your view by searching and filtering.",element:function(){if(a){var e=a.element;if(e)return e.getElementsByClassName("searchWrap")[0]}},arrowDirection:"top",check1:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane&&e.data[0].data.type===PaneMode.Outline)return a=e.data[0].data.pane,!0},check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged}});var s;i({id:"tipNewGmailPane",text:"Try dragging an email to your Outline",element:function(){if(s){var e=s.element;if(e)return e.getElementsByClassName("paneContent")[0]}},arrowDirection:"bottom",check2Invalidates1:!0,check1:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane&&e.data[0].data.type===PaneMode.Gmail&&n.vmMain.paneManager.getPanesByType(PaneMode.Outline).length>0)return s=e.data[0].data.pane,!0},check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&e.data.fromPane&&e.data.fromPane.type===PaneMode.Gmail}}),i({id:"tipNewGmailPane",text:"Each board is a different set of panes. Add a new pane to start setting up your new board.",element:function(){return n.element("addPaneButton")},arrowDirection:"left",onRight:!0,check1:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddBoard},check2:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane}});var o;i({id:"tipNoCalendarsSynced",text:"Set up which calendars you want to show in the Calendar pane",element:function(){if(o){var e=o.element;if(e)return e.getElementsByClassName("buttonCalendars")[0]}},arrowDirection:"top",check1:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane&&e.data[0].data.type===PaneMode.Timeline&&n.vmMain.isLoaded){if(n.vmMain.pluginManager.getPlugin(PluginID.GCalendar).isActive())return o=e.data[0].data.pane,!0}},check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenCalendarsMenu}}),i({id:"tipAddToCalendar",text:function(){return"Sync items with dates to Google Calendar by pressing "+l.secModKeyForce+" + C"},element:function(){var e=m.getStartElement();if(e)return e.getElementsByClassName("date")[0]},arrowDirection:"top",check1:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&n.vmMain.isLoaded){if(n.vmMain.pluginManager.getPlugin(PluginID.GCalendar).isActive())return!0}},check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddToGCal}});var c;i({id:"tipOverviewButton",text:"Toggle the Overview open and closed",element:function(){var e=c.element;if(e)return e.getElementsByClassName("overviewButton")[0]},arrowDirection:"top",check1:function(e){if(e.type===TrackerType.Zoom)return c=e.data[0].pane,!0},check2:this.checkOverview,check2Invalidates1:!0}),n.vmMain.shouldShowHelp("helpTooltip")&&function(){var e=function e(){if(n.tooltip.isOpenSticky())setTimeout(e,5e3);else{var i;!function(){var e=function e(){n.tooltip.hideSticky(i.text),f.unlisten("helpOpened",e)};i={text:"See the Help to learn more",element:n.element("helpButton"),arrowDirection:"left",onRight:!0},n.vmMain.closeHelp("helpTooltip"),f.listen("helpOpened",e),t(i)}()}};setTimeout(e,9e4)}(),this.tooltipIntroSection=this.addSection("tooltipIntro","Tooltip Intro",r,!0)}},new i}),define("Toast",["require","globals","Constants","util","Observable","tracker","platform"],function(e){function t(e,t){try{n.PAssert(4459,e,"Must provide valid message info")}catch(e){n.reportError(e)}try{n.PAssert(4460,t,"Must provide a valid message owner")}catch(e){n.reportError(e)}if(this.id=e.id||"Message_"+i++,this.owner=t,this.timeout=e.timeout||5e3,this.text=new s(e.text),this.action=e.action||MessageAction.Default,this.isBig=e.big,this.data=e.data,this.hold=!e.timeout&&!1!==e.hold&&(e.hold||this.action!==MessageAction.Default),this.noIgnore=e.noIgnore,this.onCloseFn=e.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=e.actionText,!this.actionText)switch(this.action){case MessageAction.Default:this.actionText="";break;case MessageAction.Reload:case MessageAction.ResetClient:this.actionText="RELOAD";break;case MessageAction.Okay:this.actionText="OKAY";break;case MessageAction.Blog:this.actionText="BLOG";break;case MessageAction.Undo:this.actionText="UNDO";break;case MessageAction.LoginScreen:this.actionText="LOGIN";break;case MessageAction.Contact:this.actionText="CONTACT";break;case MessageAction.OpenSettings:case MessageAction.OpenAccountSettings:case MessageAction.OpenLinkedSettings:case MessageAction.OpenGeneralSettings:case MessageAction.OpenCalendarSettings:this.actionText="SETTINGS";break;case MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case MessageAction.StartDemo:this.actionText="START DEMO"}}var i=0,n=e("globals"),r=e("Constants"),a=e("util"),s=e("Observable"),o=e("tracker"),c=e("platform");return t.prototype={show:function(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide.bind(this),this.timeout)),this.owner.onMessageShow(this))},hide:function(e){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),e||this.owner.onMessageHide(this))},isVisible:function(){return this._isVisible},doAction:function(e){if(this.isVisible()){if(n.isFunction(this.action))this.action();else switch(this.action){case MessageAction.None:case MessageAction.Okay:case MessageAction.Default:break;case MessageAction.Reload:n.reload();break;case MessageAction.Login:a.removeURLParam("demo");break;case MessageAction.Demo:a.insertURLParam("demo","true");break;case MessageAction.ResetClient:d.clearData(function(){n.reload()});break;case MessageAction.OpenURL:var t=this.data?this.data.url:void 0;try{n.PAssert(4461,t,"Should always have a valid URL to navigate")}catch(e){n.reportError(e)}t&&n.openUrl(t);break;case MessageAction.Blog:n.openUrl("https://www.moo.do/blog/updates");break;case MessageAction.Undo:o.undoAction();break;case MessageAction.LoginScreen:a.removeURLParam("demo",!0),a.removeURLParam("dmode");break;case MessageAction.Contact:n.menus.openModal(Modals.ReportBug);break;case MessageAction.OpenSettings:c.mobile?n.menus.openModalNew(Modals.MobileSettings):n.menus.openSettings(r.SettingsSections.Plugins);break;case MessageAction.OpenGeneralSettings:c.mobile?n.menus.openModalNew(Modals.MobileSettings):n.menus.openSettings(r.SettingsSections.General);break;case MessageAction.OpenAccountSettings:c.mobile?n.menus.openModalNew(Modals.MobileSettings):n.menus.openSettings(r.SettingsSections.Account);break;case MessageAction.OpenLinkedSettings:c.mobile||n.menus.openSettings(r.SettingsSections.Linked);break;case MessageAction.OpenCalendarSettings:c.mobile?n.menus.openModalNew(Modals.MobileSettings):n.menus.openSettings(r.SettingsSections.GoogleCalendar);break;case MessageAction.OpenGoogleDrive:n.openUrl("https://drive.google.com");break;case MessageAction.OpenDisplaySettings:c.mobile||n.vmMain.isDisplaySettingsOpen.set(!0);break;case MessageAction.StartDemo:window.postMessage("resume","*");break;default:try{n.PAssert(4462,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(e){n.reportError(e)
}}this.hide()}},onTapIgnore:function(e){this.isVisible()&&!this.noIgnore&&this.hide()},setText:function(e){this.text.set(e)}},t}),define("Toasts",["require","globals","Constants","platform","PluginSettings","util","data","Toast","ObservableArray"],function(e){function t(){this.queue=new s,this.remoteMessages={},this.defaultMessages=[],this.defaultMessages[MessageID.Undefined]=void 0,i.toasts=this}var i=e("globals"),n=(e("Constants"),e("platform")),r=e("PluginSettings"),a=(e("util"),e("data"),e("Toast")),s=e("ObservableArray");return t.prototype={getMessageById:function(e){void 0===this.defaultMessages[e]&&this.initMessageById(e);try{i.PAssert(4463,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(e){i.reportError(e)}return this.defaultMessages[e]},testMessageById:function(e){return!!this.defaultMessages[e]},initMessageById:function(e){switch(e){case MessageID.ConnectionError:this.defaultMessages[e]=new a({text:"Connection error detected. Please reload to try again.",action:MessageAction.Reload},this);break;case MessageID.OfflineUndo:this.defaultMessages[e]=new a({text:"Offline undo/redo has been disabled temporarily.",hold:!0},this);break;case MessageID.FatalError:this.defaultMessages[e]=new a({text:"There was a fatal error in the application. "+n.actionVerbCaps()+" to restart.",action:MessageAction.Reload},this);break;case MessageID.MailbirdClick:this.defaultMessages[e]=new a({text:"Sorry, emails can currently only be opened from inside Mailbird.",action:MessageAction.Okay},this);break;case MessageID.ExitDemo:this.defaultMessages[e]=new a({text:"Changes are not saved in demo",action:MessageAction.LoginScreen,hold:!0,noIgnore:!0},this);break;case MessageID.ShareFailure:this.defaultMessages[e]=new a({text:"There was an error sharing the file you attached.",action:MessageAction.OpenSettings,timeout:8e3},this);break;case MessageID.ThisIsDemo:this.defaultMessages[e]=new a({text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:function(){window.parent.postMessage("userInteracted","*")},hold:!0,big:!0},this);break;case MessageID.InviteFailure:this.defaultMessages[e]=new a({text:"Failed to use referral code. Please try again in your account settings.",action:MessageAction.OpenAccountSettings},this);break;case MessageID.InviteSuccess:this.defaultMessages[e]=new a({text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:MessageAction.Okay},this);break;case MessageID.PremiumRequired:this.defaultMessages[e]=new a({text:"You must be a premium subscriber to use plugins.",action:MessageAction.OpenAccountSettings,actionText:"LEARN MORE"},this);break;case MessageID.TrialOver:this.defaultMessages[e]=new a({text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:MessageAction.OpenAccountSettings,actionText:"SETTINGS"},this);break;case MessageID.TrialEndSoon:this.defaultMessages[e]=new a({text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:MessageAction.OpenAccountSettings,actionText:"SETTINGS"},this);break;case MessageID.DisabledFolderDrop:this.defaultMessages[e]=new a({text:"Drag/dropping folders is currently disabled while we polish some rough edges. Sorry for the inconvienience, please contact support@moo.do if you need this.",action:MessageAction.Okay},this);break;case MessageID.WarnLargeFile:this.defaultMessages[e]=new a({text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:MessageAction.OpenGoogleDrive},this);break;case MessageID.InviteInvalid:this.defaultMessages[e]=new a({text:"Invalid referral code. Please try again in your account settings.",action:MessageAction.OpenAccountSettings,actionText:"OKAY"},this);break;case MessageID.NoSharingWarning:this.defaultMessages[e]=new a({text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.LostPermission:this.defaultMessages[e]=new a({text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.CalendarSync:this.defaultMessages[e]=new a({text:"There was an error syncing your calendars.",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.EmailSendFail:this.defaultMessages[e]=new a({text:"Your email was not sent, there was an error contacting the remote server."},this);break;case MessageID.EmailUpdateFail:this.defaultMessages[e]=new a({text:"Unable to save draft to Gmail. Your draft is still saved locally."},this);break;case MessageID.EmailLabelFail:this.defaultMessages[e]=new a({text:"Unable to sync you changes to Gmail. Your changes are still saved locally."},this);break;case MessageID.EmailSyncFail:this.defaultMessages[e]=new a({text:"There was an error syncing your Gmail data.",action:function(){i.vmMain.pluginManager.getPlugin(PluginID.Gmail).runThreadSync()},actionText:"RETRY"},this);break;case MessageID.OldUserNewTrial:this.defaultMessages[e]=new a({text:"You have been started on a premium free trial. Enable premium plugins for free!",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.DemoPluginClick:this.defaultMessages[e]=new a({text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3},this);break;case MessageID.PromptScriptStart:this.defaultMessages[e]=new a({text:"Start demo",hold:!0,big:!0,action:MessageAction.StartDemo},this);break;case MessageID.SnoozeOffline:this.defaultMessages[e]=new a({text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:MessageAction.Okay},this);break;case MessageID.NeedDrivePermission:this.defaultMessages[e]=new a({text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:MessageAction.OpenSettings},this);break;case MessageID.NeedGmailPermission:this.defaultMessages[e]=new a({text:"Sending email requires the Gmail plugin to be enabled in settings.",action:MessageAction.OpenSettings},this);break;case MessageID.LostLinked:this.defaultMessages[e]=new a({text:"Moo.do has lost access to one of your linked accounts.",action:MessageAction.OpenLinkedSettings},this);break;case MessageID.GmailDisabled:this.defaultMessages[e]=new a({text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:MessageAction.Okay},this);break;case MessageID.LocalWritesDisabled:this.defaultMessages[e]=new a({text:"There was an error writing to the local cache. Please restart Moo.do.",action:MessageAction.Reload},this);break;case MessageID.MissingOffline:this.defaultMessages[e]=new a({text:"We are missing authorization for your account. Please disable and re-enable 'Offline Features'.",action:MessageAction.OpenSettings},this);break;case MessageID.MissingOfflineMobile:this.defaultMessages[e]=new a({text:"We are missing authoriziation for your account. Tap to reauthorize or visit settings.",action:function(){r.toggleOfflineFeatures(!0)},actionText:"Reauthorize"},this);break;case MessageID.FlatSearchMultiSelect:this.defaultMessages[e]=new a({text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."},this);break;case MessageID.FlatSearchEnter:this.defaultMessages[e]=new a({text:"Pressing Enter in flat search results is not supported because it would have unpredictable results."},this);break;case MessageID.FlatSearchTab:this.defaultMessages[e]=new a({text:"Indenting search results while in flat search results is not supported because it would have unpredictable results."},this);break;case MessageID.ReadOnlyCalendar:this.defaultMessages[e]=new a({text:"You do not have write permission for the calendar you are trying to modify."},this);break;case MessageID.CalendarSaveFail:this.defaultMessages[e]=new a({text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."},this);break;case MessageID.QuotaError:this.defaultMessages[e]=new a({text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3},this);break;case MessageID.ReselectEmail:this.defaultMessages[e]=new a({text:"Please re-select the email item and try again."},this);break;default:try{i.PAssert(4464,!1,"Invalid MessageID: ",e)}catch(e){i.reportError(e)}}},pushMessage:function(e){try{i.PAssert(4465,e,"Must supply a valid message to display")}catch(e){i.reportError(e)}var t;if(e instanceof a)t=e;else if(i.isObject(e))t=new a(e,this);else if(i.isString(e))t=new a({text:e},this);else if(!(t=this.getMessageById(e))){try{i.PAssert(4466,!1,"Invalid data passed to message creation")}catch(e){i.reportError(e)}log("Message not created properly",e)}return t&&t.show(),t},clearMessage:function(e){var t;return e instanceof a?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t},isMessageVisible:function(e){var t=!1;if(e instanceof a)t=e.isVisible();else if(this.testMessageById(e)){var i=this.getMessageById(e);t=i.isVisible()}return t},onMessageShow:function(e){try{i.PAssert(4467,e,"Must pass in a valid message to add to the queue")}catch(e){i.reportError(e)}try{i.PAssert(4468,e&&e.doAction,"Message added to queue must have valid API exposed - doAction")}catch(e){i.reportError(e)}e instanceof a?this.queue.push(e):i.reportError(new Error("Toast message must be an instance of Toast"),e)},onMessageHide:function(e){try{i.PAssert(4469,e,"Must pass in a valid message to be removed from the queue")}catch(e){i.reportError(e)}var t=this.queue.indexOf(e);if(t<0)try{i.PAssert(4470,!1,"Trying to remove an invalid message from the queue")}catch(e){i.reportError(e)}else this.queue.splice(t,1)}},new t}),define("VMAttachment",["globals","util","VMLI","International"],function(e,t,i,n){function r(e,t,i){this.id=t,this._oldLocalID=void 0,this._plugin=e,this._loadState=a.Unloaded,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=i,this.load()}var a={Unloaded:1,Waiting:2,Requesting:3,LoadedPreview:4,LoadedFull:5,FailedRequest:6,Updating:7};return r.prototype={load:function(e){this._loadState=a.Waiting,this._plugin.requestData(this,e)},notifyDataRequested:function(){try{e.PAssert(4471,!this.isLoaded(),"Should not request additional data once loaded")}catch(t){e.reportError(t)}this._numRemoteRequests++,this._loadState=a.Requesting},notifyDataLoaded:function(t,i,n,r){try{e.PAssert(4472,i||this._loadState!==a.LoadedFull||e.isFlagSet(t,PluginLoad.Full),"Should not load preview data after full data has been loaded")}catch(t){e.reportError(t)}try{e.PAssert(4473,!i||this._loadState===a.LoadedPreview||e.isFlagSet(t,PluginLoad.Full),"Incoming update much match previous type")}catch(t){e.reportError(t)}this._loadState=e.isFlagSet(t,PluginLoad.Full)?a.LoadedFull:a.LoadedPreview,this.onUpdate(!0,n,r)},notifyDataMutated:function(t,i){try{e.PAssert(4474,t&&e.isArray(t),"Must specify valid update fields when mutating attachment state manually")}catch(t){e.reportError(t)}this.onUpdate(!0,t,i)},notifyDataRequestFailed:function(){try{e.PAssert(4475,this._loadState===a.FailedRequest||this._loadState===a.Requesting||this._loadState===a.LoadedPreview,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(t){e.reportError(t)}if(this._loadState===a.FailedRequest);else if(this._loadState===a.Requesting)this._loadState=a.FailedRequest;else if(this._loadState===a.LoadedPreview)try{e.PAssert(4476,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(t){e.reportError(t)}else try{e.PAssert(4477,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(t){e.reportError(t)}},isLoaded:function(){return this._loadState===a.LoadedPreview||this._loadState===a.LoadedFull},needsRemoteData:function(){return this._loadState!==a.LoadedFull},getOldID:function(){return this._oldLocalID},changeID:function(t){try{e.PAssert(4478,this.id!==t,"Change the ID of an attachment to the same value")}catch(t){e.reportError(t)}if(this.id!==t){var i=this.id;this.id=t,this._oldLocalID=i;try{e.PAssert(4479,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(t){e.reportError(t)}this._iteratingSubscribers=!0;for(var n=0;n<this._subscribers.length;++n)try{this._subscribers[n].onAttachmentIDChange(this,i)}catch(t){e.reportError(t)}this._iteratingSubscribers=!1,this._oldLocalID=void 0}},delayChangeID:function(){try{e.PAssert(4480,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(t){e.reportError(t)}this._iteratingSubscribers=!0;for(var t=0;t<this._subscribers.length;++t){var i=this._subscribers[t];try{var n=i.onAttachmentIDChange.bind(i,this,this.id);setTimeout(n,0)}catch(t){e.reportError(t)}}this._iteratingSubscribers=!1},isFieldDefined:function(e){return this._plugin.isFieldDefined(e)},hasField:function(e){return this._plugin.hasAttachField(this,e)},getField:function(e){return this._plugin.getAttachField(this,e)},updateField:function(e,t){return this._plugin.updateAttachField(this,e,t)},fieldsHaveParseEffect:function(e){return this._plugin.fieldsHaveParseEffect(e)},isFieldDefault:function(e){return this._plugin.isAttachFieldDefault(this,e)},fieldNeedsWrite:function(e,t){return this._plugin.fieldNeedsWrite(this,e,t)},getFieldAsDate:function(t){var i=this._plugin.getAttachField(this,t);if(i){return new Date(i).toString(n.getFormat(DFormat.MonthDay))}try{e.PAssert(4481,!1,"Invalid attachment date field: ",this._plugin.id,t)}catch(t){e.reportError(t)}},getPlugin:function(){return this._plugin},getData:function(){return this._plugin.getCacheData(this.id)},getExportString:function(){return this._plugin.getAttachmentExportString(this)},getEmbedString:function(){return this._plugin.getAttachmentEmbedString(this)},getTitleString:function(){return this._plugin.getAttachmentTitleString(this)},unload:function(){this._loadState=a.Unloaded,this._plugin.releaseAttachment(this)},match:function(e){return!!this.isLoaded()&&this._plugin.matchAttachment(this,e)},markInUse:function(e){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,e),this._countInUse++},markUnused:function(t){0===--this._countInUse&&this._plugin.notifyAttachmentUnused(this,t);try{e.PAssert(4482,this._countInUse>=0,"Should never have negative users of the attachment")}catch(t){e.reportError(t)}},isInUse:function(){return this._countInUse>0},subscribe:function(t){try{e.PAssert(4483,this._subscribers.indexOf(t)<0,"Must not double subscribe")}catch(t){e.reportError(t)}try{e.PAssert(4484,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){e.reportError(t)}try{e.PAssert(4485,t.onAttachmentUpdate,"Must specify a valid subscriber callback")}catch(t){e.reportError(t)}this._subscribers.push(t)},unsubscribe:function(t){try{e.PAssert(4487,this._subscribers.indexOf(t)>=0,"Subscriber should be active")}catch(t){e.reportError(t)}try{e.PAssert(4488,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){e.reportError(t)}this._subscribers.remove(t)},forEachItem:function(t,n){try{e.PAssert(4490,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(t){e.reportError(t)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r)if(this._subscribers[r]instanceof i&&(!t||this._subscribers[r].belongsToItemStore(t)))try{n(this._subscribers[r])}catch(t){e.reportError(t)}this._iteratingSubscribers=!1},onUpdate:function(t,i,n){try{e.PAssert(4491,!i||e.isArray(i),"Must supply a valid value for updateFields:",i)}catch(t){e.reportError(t)}if(n=n||ChangeType.Remote,t&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(t){e.reportError(t)}if(t||(n|=ChangeType.PluginLoad),i)for(var r=0;r<i.length;++r)try{e.PAssert(4492,this._plugin.isFieldDefined(i[r]),"Invalid field supplied to be updated: ",i[r])}catch(t){e.reportError(t)}try{e.PAssert(4493,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(t){e.reportError(t)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r)try{this._subscribers[r].onAttachmentUpdate(this,i,n)}catch(t){e.reportError(t)}this._iteratingSubscribers=!1},notifyItemTextChanged:function(e,t){this._plugin.notifyItemTextChanged(this,e,t)},notifyItemPropertyChanged:function(e,t,i){this._plugin.notifyItemPropertyChanged(this,e,t,i)},isLocalOnlyAttachment:function(){return e.isTempId(this.id)},isType:function(e){return this._plugin.getType()===e},isPlugin:function(e){return this._plugin.id===e},shouldBeDeleted:function(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()},hasFatalError:function(){return this._loadState===a.FailedRequest&&this._numRemoteRequests>3},hasInlineData:function(){return!!this._inlineData},getInlineData:function(){return this._inlineData},clearInlineData:function(){this._inlineData=void 0}},t.defineBase(r),r}),define("PluginRenderer",["globals","util","VMAttachment","Measure","International"],function(e,t,i,n,r){function a(){this._registeredRenderers=[],this._registeredRenderers[PluginRenderTypes.Generic]={},this._registeredRenderers[PluginRenderTypes.StyledText]={},this._registeredRenderers[PluginRenderTypes.UnstyledText]={},this._registeredRenderers[PluginRenderTypes.AutocompleteText]={},this._registeredRenderers[PluginRenderTypes.AgendaEntry]={},this._registeredRenderers[PluginRenderTypes.Measure]={}}return a.prototype={registerDefaultRenderers:function(){var e=this;this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile,function(e){return e.isLoaded()?e.hasField("isDeleted")&&e.getField("isDeleted")?e.getField("title")+"  (Deleted)":e.getField("title"):e.hasField("title")?e.getField("title")+"  (Loading...)":"Loading..."},["title"]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.DriveFile,function(e){return e.hasField("title")?e.getField("title"):"Loading..."},["title"]),this.registerRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.DriveFile,function(e,t){var i='<div class="autocompleteDrive">';if(e.parents||e.modifiedDate){if(i+='<div class="metadata">',e.parents){i+='<span class="folderNames">';for(var n=0;n<e.parents.length;++n){var a=e.parents[n].title;n>0&&(i+=", "),i+=a||"My Drive"}i+="</span>"}if(e.modifiedDate){var s;s=e.modifiedDate.isToday()?r.getFormat(DFormat.ShortTime):r.getFormat(DFormat.MonthDay),i+='<span class="modified">'+e.modifiedDate.toString(s)+"</span>"}i+="</div>"}i+='<span class="plugin plugin_drive '+this.getMimetypeClass(e.mimeType)+'">';var o=e.titleLower.indexOf(t);return o>=0&&(o+=i.length),{text:i+e.title+"</span></div>",index:o}},["mimeType","title","titleLower","parents","modifiedDate"]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.DriveFile,function(t,i,r){var a=e.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile);return n.measureWord(i,a(t),r,!1)},["title"]),this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread,function(e,t){var i="";if(e&&e.isLoaded()){var n=e.getField("count"),a=e.getField("subject");if(a&&""!==a||(a="(no subject)"),a='<span class="subject c-foreground'+(n>1?" hasCount":"")+'">'+a+"</span>",t&&t.type===PaneMode.Gmail){var s=e.getPlugin().getDisplayTags(e,t);i+='<span class="line1"><span class="from">'+e.getPlugin().getDisplayParticipants(e)+"</span>";var o,c=e.getField("date");if(o=c.isToday()?r.getFormat(DFormat.ShortTime):c.getYear()!==(new Date).getYear()?r.getFormat(DFormat.MonthDayYearShort):r.getFormat(DFormat.MonthDay),i+='<span class="emailDate c-foreground-faded">'+c.toString(o)+"</span></span>",i+='<span class="line2">'+a,(e.getField("hasAttachments")||n>1)&&(i+='<span class="line2Right">',e.getField("hasAttachments")&&(i+='<span class="attach icon-attach_file"></span>'),n>1&&(i+='<span class="count">'+n+"</span>"),i+="</span>"),i+="</span>",e.hasField("snippet")||s.length){if(i+='<span class="line3">',e.hasField("snippet")&&(i+='<span class="snippet c-foreground-faded">'+e.getField("snippet")+"</span>"),s.length){i+='<span class="tags">';for(var l=0;l<s.length;++l)i+='<span class="emailLabel c-tag">'+s[l]+"</span>";i+="</span>"}i+="</span>"}}else i=a}else i="Loading...";return i},["from","subject","snippet","count","date"]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread,function(e){var t=e.getField("subject");return t&&""!==t||(t="(no subject)"),e.isLoaded()?t:"Loading..."},["from","subject"]),this.registerRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.EmailThread,function(e,t){var i=e.subject;i&&""!==i||(i="(no subject)");var n='<span class="plugin plugin_gmail"><span class="from">',r=e.from,a=r.text||r.email,s='</span><span class="subject">',o=i+"</span></span>",c=e.fromLower.indexOf(t);return c=e.subjectLower.indexOf(t),c+=n.length+a.length+s.length,{text:n+a+s+o,index:c}},["from","subject","subjectLower"]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread,function(e,t,i){var r;if(e.isLoaded()){var r=e.getField("subject");r&&""!==r||(r="(no subject)")}else r="Loading...";return n.measureWord(t,r,i,!1)},[]),this.registerRenderer(PluginRenderTypes.AgendaEntry,PluginRenderers.CalendarEvent,function(e){return"Agenda Entry!"},[]),this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent,function(e){return""},[]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.CalendarEvent,function(e){return"Unstyled Text!"},[]),this.registerRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.CalendarEvent,function(e,t){return"ACText!"},[]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.CalendarEvent,function(t,i,r){var a=e.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent);return n.measureWord(i,a(t),r,!1)},[]),this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.Unknown,function(e){return"Unknown Plugin"},[]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.Unknown,function(e,t,i){return n.measureWord(t,"Unknown Plugin",i,!0)},[])},registerRenderer:function(t,i,n,r){try{e.PAssert(4494,this._registeredRenderers[t],"Invalid renderer type",t,i)}catch(t){e.reportError(t)}try{e.PAssert(4495,!this._registeredRenderers[t][i],"Cannot register a renderer twice",t,i)}catch(t){e.reportError(t)}this._registeredRenderers[t][i]={fn:n,fields:r}},useRenderer:function(t,i){try{e.PAssert(4496,this._registeredRenderers[t],"Invalid renderer type",t,i)}catch(t){e.reportError(t)}try{e.PAssert(4497,this._registeredRenderers[t][i],"Renderer has not been registered yet",t,i)}catch(t){e.reportError(t)}return this._registeredRenderers[t][i].fn},ensureRendererFields:function(e,t,i){}},a}),define("LowImpactTask",["require","globals","util","Dispatcher"],function(e){function t(e){this._taskCB=e,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,n.forceBind("handleLowImpactBegin",this),n.forceBind("_onTaskEndRun",this),r.listen("lowImpactBegin",this.handleLowImpactBegin)}var i=e("globals"),n=e("util"),r=e("Dispatcher");return t.prototype={getStats:function(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},handleLowImpactBegin:function(){this._startTaskRun()},requestRun:function(){this._forceRun=!0,this._startTaskRun()},notifyWorkAvailable:function(){this._workAvailable=!0,i.vmMain.isLowImpact()&&!this._isRunning&&this._startTaskRun()},_startTaskRun:function(){if(!this._isRunning&&!this._disabled&&this._workAvailable){try{i.PAssert(4498,this._forceRun||i.vmMain.isLowImpact(),"Must always run a task during a low impact timeframe")}catch(e){i.reportError(e)}this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun)}},_onTaskEndRun:function(e){try{i.PAssert(4499,this._isRunning,"Must be currently running task to finish")}catch(e){i.reportError(e)}this._isRunning=!1,this._forceRun=!1,(e||this._workAvailable)&&(this._workAvailable=!0,i.vmMain.isLowImpact()&&this._startTaskRun())}},t}),define("PageToken",["require","globals","util"],function(e){function t(e,t,n,r,a,s){try{i.PAssert(4500,i.isFunction(a),"Must supply a valid entry CB")}catch(e){i.reportError(e)}try{i.PAssert(4501,i.isFunction(s),"Must supply a valid done CB")}catch(e){i.reportError(e)}this._nextPageToken=e,this._inUse=!1,this._q=t,this._info=n,this._maxResults=r,this._entryCB=a,this._doneCB=s}var i=e("globals"),n=e("util"),r={updateToken:function(e){try{i.PAssert(4502,this._nextPageToken!==e,"Should never update token to be same value")}catch(e){i.reportError(e)}this._nextPageToken=e},getNextPageToken:function(){return this._nextPageToken},getInfo:function(){return this._info},getQuery:function(){return this._q},getEntryCB:function(){return this._entryCB},getDoneCB:function(){return this._doneCB},getMaxResults:function(){return this._maxResults},hasMorePages:function(){return!!this._nextPageToken},notifyBeginUse:function(){try{i.PAssert(4503,!this._inUse,"Should not currently be in use")}catch(e){i.reportError(e)}this._inUse=!0},notifyEndUse:function(){try{i.PAssert(4504,this._inUse,"Should always be using token when done")}catch(e){i.reportError(e)}this._inUse=!1},isInUse:function(){return this._inUse}};return n.defineBase(t),n.extend(t.prototype,r),t}),define("VMPlugin",["globals","util","Constants","data","goog","gdata","PaneFactory","PluginRenderer","VMAttachment","Measure","Observable","LowImpactTask","AccountManager","PageToken","apis"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m){function f(i,n){try{e.PAssert(4505,i,"Must supply a valid id")}catch(t){e.reportError(t)}try{e.PAssert(4506,n,"Must supply a valid name")}catch(t){e.reportError(t)}this.id=i,this.name=n,this._previewCache="p_"+i,this._offlineCache="ocache_"+i,this._paneType="Pane"+i,this._rootId=i+"Root",this._acProviderId="AC"+i,this._settingsGroup="plugin"+this.id,this.loadedEvent="Plugin_"+i+"_Loaded",this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new d(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._registeredAutocomplete=!1,this._attachKeys=[],this._attachCache={},this._dataKeys=[],this._dataCache={},this._scorchOfflineCache=!1,this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._hasServicedPreviewCache=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this.Settings={},window.PluginSettingsID[this.id]={},t.forceBind("_retryRemoteRequest",this),t.forceBind("_onGoogleAuthorized",this),t.forceBind("_reqSortFn",this),e.settings.registerGroup(this._settingsGroup),this.registerSetting("IsEnabled","isEnabled",!0,!1,!this._isBuiltin),this.getDataPane()&&s.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),DETAILED_STATS&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,combinedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0,previewCacheIsAvailable:0,previewCacheUpdate:0,previewCacheQuery:0,previewCacheMissedWrites:0},this.__TrackedStats={},this.__ReqStats=[]),this.onSettingChanged(this.Settings.IsEnabled,function(t,i){i&&e.vmMain.pluginManager.activatePlugin(this)}.bind(this))}var g=[1,5,20,40,80,170],v=[i.HTTPStatusCode.Network,i.HTTPStatusCode.Timeout,i.HTTPStatusCode.TooMany,i.HTTPStatusCode.ServerError,i.HTTPStatusCode.BadGateway,i.HTTPStatusCode.Unavailable,i.HTTPStatusCode.GatewayTimeout,null],y=[i.HTTPStatusCode.Forbidden,i.HTTPStatusCode.TooMany],b=e.seconds(15),S=e.seconds(7),E={};return E[PluginDependency.DemoMode]={online:!1},E[PluginDependency.GoogleLogin]={online:!0},E[PluginDependency.PremiumSub]={online:!1},E[PluginDependency.EarlyAccess]={online:!1},E[PluginDependency.LocalLoaded]={online:!1},f.prototype={getType:function(){return i.PluginType.Unknown},sendEvent:function(t,i){return e.sendEvent(this.id,t,i)},getSetting:function(t){return e.settings.get(t,this._settingsGroup)},setSetting:function(t,i){return e.settings.set(t,i,this._settingsGroup)},onAuthorizedSetting:function(e,t){},registerSetting:function(t,i,r,a,s){window.PluginSettingsID[this.id][t]=i,this.Settings[t]=i,e.settings.registerSetting(i,this._settingsGroup,r,a),s&&e.settings.registerAPIServerNotification(i,this._settingsGroup),n.addDefaultSkipSetting(i,this._settingsGroup)},onSettingChanged:function(t,i){e.settings.registerForChangeNotification(t,this._settingsGroup,i)},getCacheStats:function(i){var n={};if(this.supportOfflineCache()&&e.shouldWriteLocal()){var r={},a=t.storage.getItem(this.getOfflineCacheName());if(a){r.size=a.length;try{var s=JSON.parse(a);if(s){r.props=s.props;var o=s.data;r.count=Object.keys(o).length}}catch(t){e.reportError(t)}}n.Offline=r}var c=Object.keys(this._registeredCaches).length,l=0;if(c>0)for(var d in this._registeredCaches){var h=this._registeredCaches[d];h.getStats(function(e){n[e.id]=e,c===++l&&i(n)})}else i()},getCacheState:function(){var e={};for(var t in this._registeredCaches){var i=this._registeredCaches[t];e[t]=i.getState()}return e},registerLocalCache:function(t,i,n,r){var a;a=n?this.id:this.id+"_"+t;var s=e.vmMain.cacheManager.registerLocalCache(a,t,i,r);return this._registeredCaches[a]=s,s},registerDeferredTaskType:function(t,i,n,r){try{e.PAssert(4507,t,"Must specify a valid deferred task type")}catch(t){e.reportError(t)}e.vmMain.deferredTaskManager.registerTaskType(t,i,n,r)},scheduleDeferredTask:function(t,i,n,r){try{e.PAssert(4508,t,"Must supply a valid local ID for deferred task")}catch(t){e.reportError(t)}try{e.PAssert(4509,i,"Must specify a valid deferred task type")}catch(t){e.reportError(t)}e.vmMain.deferredTaskManager.scheduleTask(t,i,n,!1,void 0,r)},cancelDeferredTask:function(t,i){e.vmMain.deferredTaskManager.cancelTask(t,i)},createRecurringTask:function(t,i){var n=this.id+"_"+t;return this._recurringTasks.push(t),e.vmMain.recurringTaskManager.createRecurringTask(n,i)},getRecurringTask:function(t){return e.vmMain.recurringTaskManager.getRecurringTask(this.id+"_"+t)},hasRecurringTask:function(t){return e.vmMain.recurringTaskManager.hasRecurringTask(this.id+"_"+t)},cancelRecurringTask:function(t){var i=this.id+"_"+t;return this._recurringTasks.remove(t),e.vmMain.recurringTaskManager.cancelRecurringTask(i)},cancelRecurringTasks:function(){for(;this._recurringTasks.length>0;)this.cancelRecurringTask(this._recurringTasks[0])},getRecurringStats:function(){for(var e={},t=0;t<this._recurringTasks.length;++t){var i=this._recurringTasks[t],n=this.getRecurringTask(i);e[i]=n.getStats()}return e},registerLowImpactTask:function(t,i){try{e.PAssert(4510,!this._lowImpactTasks[t],"Must specify different IDs for each task: ",t)}catch(t){e.reportError(t)}var n=new h(i);return this._lowImpactTasks[t]=n,n},getLowImpactStats:function(){var e={}
;for(var t in this._lowImpactTasks){var i=this._lowImpactTasks[t];e[t]=i.getStats()}return e},getTrackedStat:function(e){if(DETAILED_STATS)return this.__TrackedStats[e]},addTrackedStat:function(t){if(DETAILED_STATS){try{e.PAssert(4511,!this.__TrackedStats.hasOwnProperty(t),"Should not double define a tracked stat for a plugin")}catch(t){e.reportError(t)}this.__TrackedStats[t]=0}},reportTrackedStat:function(t){if(DETAILED_STATS){try{e.PAssert(4512,this.__TrackedStats.hasOwnProperty(t),"Must first register a tracked stat before reporting instantces of it")}catch(t){e.reportError(t)}this.__TrackedStats[t]++}},getStats:function(){return{fnCalls:DETAILED_STATS?this.__Stats:void 0,tracked:DETAILED_STATS?this.__TrackedStats:void 0,remoteReqs:DETAILED_STATS?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numDataCache:this._dataKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._totalRequestSendTime/this._numSendRequests,avgRequestHandleTime:this._totalRequestHandleTime/this._numHandledRequests,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}},getState:function(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,scorchedCaches:this._scorchOfflineCache,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState(),isPreviewCacheAvailable:this.isPreviewCacheAvailable(),hasServicedPreviewCache:this._hasServicedPreviewCache}},isPluginPane:function(e){return e.type===this._paneType},getPaneType:function(){return this._paneType},activate:function(t){if(!this.isActiveObs.get()){if(this.isActiveObs.set(!0),this.useItemStore()){this._defaultItemStore=e.vmMain.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions());var i=this._defaultItemStore.createRoot(this._rootId,"");setTimeout(function(){this.isActive()&&i.setText(this.useItemStore(),!0,ChangeType.Auto)}.bind(this),0)}if(this._hasLoadedCaches||(this.usesPreviewCache()&&this.registerPreviewCache(),this.supportOfflineCache()&&e.shouldWriteLocal()&&this.loadOfflineCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive(),this.registerAutocomplete(),this._unloadedDependencies)for(var n in t)this.onDependencyLoaded(n,t[n]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),e.vmMain.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),this._activate&&this._activate(),!0}return!1},deactivate:function(){try{e.PAssert(4513,this.isActiveObs.get(),"Must be active in order to deactivate pane")}catch(t){e.reportError(t)}return this.isActiveObs.set(!1),e.vmMain.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.unregisterAutocomplete(),this.getDataPane()&&e.vmMain.paneFactory.deactivatePaneType(this._paneType),this.useItemStore()&&(e.vmMain.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0},ensurePaneTypeIsActive:function(){(!this.hasDependency(PluginDependency.PremiumSub)||e.billingManager.hasPremiumFeatures())&&this.getDataPane()&&!s.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||e.isDemoMode())&&s.activatePaneType(this._paneType)},isActive:function(){return this.isActiveObs.get()},isReady:function(){return this._isReady},isEnabled:function(){return e.isDemoMode()||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)},isAvailable:function(){var t=!1,i=this.hasDependency(PluginDependency.EarlyAccess),n=this.hasDependency(PluginDependency.PremiumSub);try{e.PAssert(4514,!n||!i,"Must not require both early access and premium sub: "+this.id)}catch(t){e.reportError(t)}var r=e.billingManager.hasEarlyAccess(),a=e.billingManager.hasPremiumFeatures();return i&&r?t=!0:n&&a?t=!0:i||n?e.isDemoMode()&&(t=!0):t=!0,t},hasSettingsError:function(){return!1},isCurrentlyAuthorized:function(e){return u.isCurrentlyAuthorized(e)},_onGoogleAuthorized:function(t){try{e.PAssert(4515,"me"===t||u.isCurrentlyAuthorized(t),"Must have a valid access token")}catch(t){e.reportError(t)}this.onAuthorized(t)},onAuthorized:function(t){this._pendingRequests.length>0&&e.vmMain.pluginManager.notifyHasPendingRemoteRequest()},verifyAuthorization:function(e){return u.isDefaultEmail(e)?u.verifyLinkedTokenScopes(e,this.googleScopes()):[]},notifyUnauthorized:function(e,t){},isOnline:function(){return e.vmMain.pluginManager.isOnline()},goOnline:function(){},goOffline:function(){},onDocumentShared:function(e){},onShutdown:function(){},onDependencyLoaded:function(e,t){if(this._unloadedDependencies){var i=this._unloadedDependencies.indexOf(e);if(i>=0&&(this.isDependencyLoaded(e,t)&&this._unloadedDependencies.removeAt(i),e===PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var n=!1,r=0;r<this._unloadedDependencies.length;++r){var a=this._unloadedDependencies[r];E[a].online||(n=!0)}!n&&this.isActiveObs.get()&&this.offlineLoad()}}},onAllDependenciesLoaded:function(){this.isActiveObs.get()&&setTimeout(function(){this._isReady=!0,this._updateAttachmentStates(),this.offlineLoad(),this.load()}.bind(this),0)},areDependenciesLoaded:function(){return void 0===this._unloadedDependencies},hasDependencyBeenLoaded:function(e){var t=!1;return this.hasDependency(e)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(e)<0&&(t=!0):t=!0),t},isDependencyLoaded:function(e,t){return!0},getUnloadedDependencies:function(){return this._unloadedDependencies},loadRemoteAPIs:function(e,t){e&&e()},areRemoteAPIsLoaded:function(){return!0},forceLoad:function(){this._loadedInitialData=!1,this.activate(),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())},authorize:function(t,i){try{e.PAssert(4516,i&&e.isFunction(i),"Must provide a valid authoirzation callback")}catch(t){e.reportError(t)}this.googleScopes()?this._authorizeGoogle(t,i):i(!0)},_authorizeGoogle:function(t,i){try{e.PAssert(4517,this.googleScopes(),"Must have a valid google scope to request")}catch(t){e.reportError(t)}try{e.PAssert(4518,i&&e.isFunction(i),"Must provide a valid authoirzation callback")}catch(t){e.reportError(t)}t?r.runAuthenticateOffline(this.googleScopes(),function(e){i(e&&!e.error)}):r.runAuthenticate(this.googleScopes(),!1,!1,function(e){i(e&&!e.error)})},googleScopes:function(){},getDependencies:function(){},hasDependency:function(e){var t=this.getDependencies();return!!t&&t.indexOf(e)>=0},getOfflineCacheName:function(){return this._offlineCache},loadOfflineCache:function(){try{e.PAssert(4519,0===this._dataKeys.length,"Must have no data already loaded")}catch(t){e.reportError(t)}if(this.supportOfflineCache()&&e.shouldWriteLocal()){var i=t.storage.getItem(this.getOfflineCacheName());if(i)try{var n=JSON.parse(i);n&&this.loadDataFromObject(n)}catch(t){e.reportError(t)}}},loadDataFromObject:function(t){try{e.PAssert(4520,t,"Must provide a valid dataset to load")}catch(t){e.reportError(t)}var i=(t.props,t.data);try{e.PAssert(4521,i,"Load object must contain valid data")}catch(t){e.reportError(t)}this._dataKeys=Object.keys(i);for(var n=0;n<this._dataKeys.length;++n){var r=this._dataKeys[n];this._dataCache[r]=this.createEntryFromLocal(r,i[r]),this._dataCache[r].id=r}},saveOfflineCache:function(){if(this.supportOfflineCache()&&e.shouldWriteLocal()&&!this._scorchOfflineCache){for(var i=0,n={},r=0;r<this._activeAttachments.length;++r){var a=this._activeAttachments[r];try{e.PAssert(4522,a.isInUse(),"Attachments in the active list should always be in use")}catch(t){e.reportError(t)}if(a.isInUse()){var s=this.serializeEntry(a.id);s&&(n[a.id]=s,i++)}}var o={data:n,info:{writeDate:Date.now(),entries:i}};try{var c=JSON.stringify(o);t.storage.setItem(this.getOfflineCacheName(),c)}catch(t){e.reportError(t)}}},clearOfflineCache:function(i){this.supportOfflineCache()&&e.shouldWriteLocal()&&(t.storage.removeItem(this.getOfflineCacheName()),i&&(this._scorchOfflineCache=!0))},supportOfflineLoad:function(){return!1},supportOfflineCache:function(){return!1},createEntryFromLocal:function(t,i){try{e.PAssert(4523,!1,"SubClass must override")}catch(t){e.reportError(t)}},clearData:function(){for(var e=0;e<this._attachKeys.length;++e)this._attachCache[this._attachKeys[e]].unload();this._attachKeys=[],this._attachCache={},this._dataKeys=[],this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]},onCacheLimitExceeded:function(){for(var e in this._registeredCaches){var t=this._registeredCaches[e];t.usesDiskSpace()&&t.clearCache()}},changeID:function(t,i,n){try{e.PAssert(4524,i!==n,"Should never be switching to the same ID")}catch(t){e.reportError(t)}if(this._attachCache[n])t.delayChangeID(n),this._attachCache[i]=void 0,this._attachKeys.remove(i),this._dataCache[i]=void 0,this._dataKeys.remove(i);else{var r=this._attachCache[i];try{e.PAssert(4525,t===r,"Attach entries must match")}catch(t){e.reportError(t)}r&&(this._attachCache[i]=void 0,this._attachCache[n]=r,this._attachKeys.remove(i),this._attachKeys.push(n));var a=this._dataCache[i];if(this._dataCache[i]=void 0,a)a.id===i&&(a.id=n),this._dataCache[n]=a,this._dataKeys.remove(i),this._dataKeys.push(n);else try{e.PAssert(4526,this._dataKeys.indexOf(n)>=0,"Should have already changed the ID")}catch(t){e.reportError(t)}var s=t.isLocalOnlyAttachment();t.changeID(n),t.isInUse()&&s&&this.notifyAttachmentUpdated(t)}},_isPreviewData:function(e){for(var t=this.getPropertySet(PluginLoad.Preview),i=0;i<t.length;++i){if(!this.getPropertyDescriptor(t[i]).isOpt&&!e.hasOwnProperty(t[i]))return!1}return!0},_isFullData:function(e){for(var t=this.getPropertySet(PluginLoad.Full),i=0;i<t.length;++i){if(!this.getPropertyDescriptor(t[i]).isOpt&&!e.hasOwnProperty(t[i]))return!1}return!0},_addPreviewEntry:function(e,t){var i=this.createEntryFromLocal(e,t);return this.cacheData(e,i),i},cacheData:function(t,i,n,r,a){try{e.PAssert(4527,t,"Must supply a valid key for data")}catch(t){e.reportError(t)}DETAILED_STATS&&this.__Stats.cacheWrites++;var s=this._dataCache[t];if(this._dataCache[t]=i,s?DETAILED_STATS&&this.__Stats.cacheUpdates++:this._dataKeys.push(t),this._attachCache[t]){var o=this._attachCache[t],c=this._getPluginLoadType(i);try{e.PAssert(4529,c,"Must either contain valid preview or full data")}catch(t){e.reportError(t)}o.notifyDataLoaded(c,n,r,a)}},getCacheData:function(e){return this._dataCache[e]},_attachMetadataFields:function(){},fieldsHaveParseEffect:function(e){var t=!1;if(e){var i=this._attachMetadataFields();if(i){for(var n=0;n<e.length;++n)if(i.indexOf(e[n])<0){t=!0;break}}else t=!0}else t=!0;return t},isFieldDefined:function(e){return!!this.getPropertyDescriptor(e)},hasAttachField:function(t,i){var n=!1,r=this._dataCache[t.id];if(r&&r.hasOwnProperty(i))n=!0;else{var a=this.getPropertyDescriptor(i);try{e.PAssert(4531,a,"Must have a valid field descriptor",i)}catch(t){e.reportError(t)}if(a&&a.isOpt)n=!0;else{var s=t.getInlineData();s&&s.hasOwnProperty(i)&&(n=!0)}}return n},getAttachField:function(t,i){var n,r=this._dataCache[t.id];if(r&&r.hasOwnProperty(i))n=r[i];else{var a=this.getPropertyDescriptor(i);try{e.PAssert(4532,a,"Must have a valid field descriptor",i)}catch(t){e.reportError(t)}var s=t.getInlineData();if(s&&s.hasOwnProperty(i))n=s[i];else{try{e.PAssert(4533,!a||a.isOpt,"Field must be optional if it is not defined",i)}catch(t){e.reportError(t)}n=a?a.defaultValue:void 0}}return n},updateAttachField:function(t,i,n){var r=!1;try{e.PAssert(4534,this.isFieldDefined(i),"Must be updating a valid attachment field")}catch(t){e.reportError(t)}var a=this._dataCache[t.id];try{e.PAssert(4535,a,"Invalid field request: ",this.id,i)}catch(t){e.reportError(t)}if(a){this.dataFieldNeedsWrite(a,i,n)&&(a[i]=n,this.cacheData(t.id,a,!0,[i])),r=!0}var s=t.getInlineData();if(s&&s.hasOwnProperty(i))try{e.PAssert(4538,s[i]===n,"Should never change inline field value")}catch(t){e.reportError(t)}return r},isAttachFieldDefault:function(t,i){var n=!1,r=this._dataCache[t.id];try{e.PAssert(4539,r,"Invalid field request: ",this.id,i)}catch(t){e.reportError(t)}if(r){var a=this.getPropertyDescriptor(i);try{e.PAssert(4540,a,"Must have a valid field descriptor",i)}catch(t){e.reportError(t)}r.hasOwnProperty(i)?a&&a.isOpt&&a.defaultValue===r[i]&&(n=!0):a&&a.isOpt&&(n=!0)}return n},fieldNeedsWrite:function(t,i,n){var r=this._dataCache[t.id];try{e.PAssert(4541,r,"Invalid field request: ",this.id,i)}catch(t){e.reportError(t)}return this.dataFieldNeedsWrite(r,i,n)},dataFieldNeedsWrite:function(t,i,n){var r=!1;if(t){var a=this.getPropertyDescriptor(i);try{e.PAssert(4542,a,"Must have a valid field descriptor",i)}catch(t){e.reportError(t)}var s=this.compactCacheField(t,i);t.hasOwnProperty(i)?void 0===n&&s===a.defaultValue||(a&&a.comparator?a.comparator(s,n)||(r=!0):s!==n?r=!0:(e.isObject(s)||e.isObject(n)||e.isArray(s)||e.isArray(n))&&(r=!0)):void 0!==n&&(a&&a.isOpt&&a.defaultValue===n||(r=!0))}return r},hasCacheData:function(e){return!!this._dataCache[e]},findCachedItemsByField:function(e,t,i){DETAILED_STATS&&this.__Stats.findByField++;for(var n=[],r=0;r<this._dataKeys.length;r++){var a=this._dataCache[this._dataKeys[r]];if(a[e]===t&&(n.push(a),n.length>=i))break}return n},findCachedItemsByFn:function(t,i){try{e.PAssert(4543,t,"Must supply a valid match function")}catch(t){e.reportError(t)}try{e.PAssert(4544,e.isFunction(t),"Match function must be a valid function")}catch(t){e.reportError(t)}DETAILED_STATS&&this.__Stats.findByFn++;for(var n=[],r=0;r<this._dataKeys.length;r++){var a=this._dataCache[this._dataKeys[r]];if(t(a)&&(n.push(a),n.length>=i))break}return n},notifyAttachmentInUse:function(t,i){try{e.PAssert(4545,this._activeAttachments.indexOf(t)<0,"Attachment should not already be active")}catch(t){e.reportError(t)}this._activeAttachments.push(t),e.isLocalChange(i)&&this.usesPreviewCache()&&t.isLoaded()&&!t.isLocalOnlyAttachment()&&this.writeAttachmentToPreviewCache(t)},notifyAttachmentUpdated:function(e){this.usesPreviewCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.writeAttachmentToPreviewCache(e)},notifyAttachmentUnused:function(t,i){try{e.PAssert(4546,this._activeAttachments.indexOf(t)>=0,"Attachment should be marked active")}catch(t){e.reportError(t)}this._activeAttachments.remove(t),e.isLocalChange(i)&&this.usesPreviewCache()&&t.isLoaded()&&!t.isLocalOnlyAttachment()&&this.updatePreviewCache(t.id,void 0)},notifyItemTextChanged:function(e,t,i){},notifyItemPropertyChanged:function(e,t,i){},getAttachment:function(t,i){try{e.PAssert(4547,t,"Must provide a valid key")}catch(t){e.reportError(t)}return t&&!this._attachCache[t]&&(this._attachCache[t]=this._requestAttachment(t,i),this._attachKeys.push(t)),this._attachCache[t]},hasAttachment:function(e){return!!this._attachCache[e]},forEachActiveAttachment:function(e){for(var t=0;t<this._activeAttachments.length;++t)e(this._activeAttachments[t])},forEachAttachment:function(e){for(var t=0;t<this._attachKeys.length;++t)e(this._attachCache[this._attachKeys[t]])},numActiveAttachments:function(){return this._activeAttachments.length},getAttachmentExportString:function(t){for(var i=window.EmbedAttachChar+"p:"+this.id+",id:"+t.id,n=this.getPropertySet(PluginLoad.Inline),r=0;r<n.length;++r){var a=n[r],s=t.getField(a);try{e.PAssert(4548,s&&s.indexOf(":")<0&&s.indexOf(" ")<0,"Property value is invalid: "+a+", "+s)}catch(t){e.reportError(t)}i+=","+a+":"+s}return i+=window.EmbedAttachChar},getAttachmentEmbedString:function(e){return this._getTextForItem(e)},getAttachmentTitleString:function(e){return this.getUnstyledText(e)},_getTextForItem:function(t){try{e.PAssert(4549,t,"Must pass in a valid item to get text for")}catch(t){e.reportError(t)}return window.EmbedAttachChar+"p:"+this.id+",id:"+t.id+window.EmbedAttachChar},_requestAttachment:function(t,i){try{e.PAssert(4550,t,"Must provide a valid key")}catch(t){e.reportError(t)}return DETAILED_STATS&&this.__Stats.createdAttachments++,new c(this,t,i)},releaseAttachment:function(e){},registerPreviewCache:function(){var e=a.ensureCache(this._previewCache);a.requestNotifyWhenAvailable(this.serviceRemoteRequestsFromPreview.bind(this)),e||a.requestNotifyWhenAvailable(this.writeActiveAttachmentsToPreviewCache.bind(this))},isPreviewCacheAvailable:function(){return DETAILED_STATS&&this.__Stats.previewCacheIsAvailable++,a.isCacheAvailable(this._previewCache)},updatePreviewCache:function(t,i){try{e.PAssert(4551,e.isString(t),"Key must be a valid string")}catch(t){e.reportError(t)}return DETAILED_STATS&&this.__Stats.previewCacheUpdate++,a.updateCache(this._previewCache,t,i)},queryPreviewCache:function(t){try{e.PAssert(4552,e.isString(t),"Key must be a valid string")}catch(t){e.reportError(t)}return DETAILED_STATS&&this.__Stats.previewCacheQuery++,a.queryCache(this._previewCache,t)},onPreviewCacheChange:function(t,i,n){switch(t){case DataChangeType.Add:case DataChangeType.Remove:case DataChangeType.Change:break;default:try{e.PAssert(4553,!1,"Invalid or unhandled DataChangeType: ",t)}catch(t){e.reportError(t)}}log("Preview Cache Change: ",arguments)},writeActiveAttachmentsToPreviewCache:function(){a.ensureCache(this._previewCache);for(var e=0;e<this._activeAttachments.length;++e){var t=this._activeAttachments[e];t.isLoaded()&&!t.isLocalOnlyAttachment()&&this.writeAttachmentToPreviewCache(t)}},writeAttachmentToPreviewCache:function(t){try{e.PAssert(4554,t.isLoaded(),"Attachments should have data before saving them")}catch(t){e.reportError(t)}try{e.PAssert(4555,!t.isLocalOnlyAttachment(),"Should never write a local-only attachment to the preview cache")}catch(t){e.reportError(t)}var i=!1,n=this.getPropertySet(PluginLoad.Preview);if(this.isPreviewCacheAvailable()){var r=this.queryPreviewCache(t.id);i=!r;for(var a=0;!i&&a<n.length;++a){var s=n[a];t.fieldNeedsWrite(s,r[s])&&(i=!0)}}else DETAILED_STATS&&this.__Stats.previewCacheMissedWrites++;i&&this.updatePreviewCache(t.id,this.serializePreview(t))},dataHasChanged:function(e,t){for(var i=!e,n=this.getPropertySet(PluginLoad.Full),r=0;!i&&r<n.length;++r){var a=n[r];this.dataFieldNeedsWrite(e,a,t[a])&&(i=!0)}return i},getChangedFields:function(e,t){for(var i=[],n=this.getPropertySet(PluginLoad.Full),r=0;r<n.length;++r){var a=n[r];this.dataFieldNeedsWrite(e,a,t[a])&&i.push(a)}return i},serviceRemoteRequestsFromPreview:function(){for(var e=0;e<this._pendingRequests.length;++e){var t=this._pendingRequests[e];if(t.attach)for(var i=0;i<t.attach.length;++i){var n=this.queryPreviewCache(t.attach[i].id);n&&this._addPreviewEntry(t.attach[i].id,n)}}for(var e=0;e<this._activeAttachments.length;++e){var r=this._activeAttachments[e];if(!r.isLoaded()&&!r.isLocalOnlyAttachment()){var n=this.queryPreviewCache(r.id);n&&this._addPreviewEntry(r.id,n)}}this._hasServicedPreviewCache=!0},usesPreviewCache:function(){return!1},matchAttachment:function(t,i){try{e.PAssert(4556,!1,"SubClass must override")}catch(t){e.reportError(t)}},getStyledText:function(t){try{e.PAssert(4557,!1,"SubClass must override")}catch(t){e.reportError(t)}},getUnstyledText:function(t){try{e.PAssert(4558,!1,"SubClass must override")}catch(t){e.reportError(t)}},getBlockedText:function(e){return"Blocked"},useRenderer:function(t,i){var n,r=e.vmMain.pluginManager.useRenderer(t,i);switch(t){case PluginRenderTypes.StyledText:n="getStyledText";break;case PluginRenderTypes.UnstyledText:n="getUnstyledText";break;case PluginRenderTypes.AutocompleteText:n="getItemStyledText";break;case PluginRenderTypes.AgendaEntry:n="getAgendaStyledText";break;case PluginRenderTypes.Measure:n="getAttachMeasure";break;default:try{e.PAssert(4559,!1,"Unknown plugin renderer type")}catch(t){e.reportError(t)}}n&&(this[n]=r)},_getDisplayText:function(e,t,i){return this.isPluginBlocked()?this.getBlockedText(e,t,i):this.getStyledText(e,t,i)},createDisplayElement:function(t){var i=this.getAttachmentClass(t);try{e.PAssert(4560,e.isArray(i),"Must have a valid class list")}catch(t){e.reportError(t)}try{e.PAssert(4561,i.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(t){e.reportError(t)}i.push("plugin"),this.isPluginBlocked()&&i.push("blocked");var n=this._getDisplayText(t),r={attrs:{cls:i,plugin:this.id,"plugin-id":t.id},text:n},a=this.getAttachmentTooltip(t);return a&&(r.attrs["data-tooltip"]=a),r},measureAttachment:function(t,i){try{e.PAssert(4562,i&&i.attrs&&i.attrs["plugin-id"],"Must have a valid word style obj with attachment ID")}catch(t){e.reportError(t)}var n;if(i.attrs&&!i.attrs.isUnknown){var r=this.getAttachment(i.attrs["plugin-id"]);try{e.PAssert(4563,r,"Must have valid attachment to measure: ",i.attrs["plugin-id"])}catch(t){e.reportError(t)}n=this.isPluginBlocked()?l.measureWord(t,this.getBlockedText(r),i):this.getAttachMeasure(r,t,i)}else n=l.measureWord(t,"Unknown Plugin",i);if(i.attrs&&i.attrs.cls){var a=i.attrs.cls;n+=this.pluginMargin,a.indexOf("padB")>=0&&(n+=this.pluginMargin)}return n+=this.pluginPadding},getAttachmentClass:function(e){return""},getAttachmentTooltip:function(e){},isPluginBlocked:function(){var t=!1;return e.billingManager.hasPremiumFeatures()||!this.hasDependency(PluginDependency.PremiumSub)&&!this.hasDependency(PluginDependency.EarlyAccess)||(t=!0),t},_displayMissingProperties:function(t,i,n){var r=!1,a=this.getPropertySet(n);log("Displaying Missing Properties: ",t);for(var s=0;s<a.length;++s){this.getPropertyDescriptor(a[s]).isOpt||i.hasOwnProperty(a[s])||(log(" Missing Property: ",a[s]),r=!0)}try{e.PAssert(4564,r,"Must be missing props to run this")}catch(t){e.reportError(t)}},_getPluginLoadType:function(t){try{e.PAssert(4565,t,"Must be querying loaded data for load state with valid data")}catch(t){e.reportError(t)}var i=PluginLoad.None;return this._isPreviewData(t)&&(i|=PluginLoad.Preview,this._isFullData(t)&&(i|=PluginLoad.Full)),i},requestData:function(t,i){DETAILED_STATS&&this.__Stats.requestData++,i=i||PluginLoad.Preview|PluginLoad.Full;var n,r=this.getCacheData(t.id);r?(n=this._getPluginLoadType(r),e.isFlagSet(n,i)?t.notifyDataLoaded(n,!1,void 0,ChangeType.Remote):(e.forEachFlagSet(i,function(e){this._displayMissingProperties(t.id,r,e)}.bind(this)),!t.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(t,i))):t.isLocalOnlyAttachment()||(n=PluginLoad.None,this.isPreviewCacheAvailable()&&this._loadPreviewData(t,i),this.allowRemoteRequests()&&!e.isFlagSet(n,i)&&this._getRemoteAttachmentData(t,i))},_loadPreviewData:function(t,i){try{e.PAssert(4566,this.isPreviewCacheAvailable(),"Preview cache must always be available after gdata cb")}catch(t){e.reportError(t)}var n=!1,r=this.queryPreviewCache(t.id);return r&&(r=this.createEntryFromLocal(t.id,r),this.cacheData(t.id,r),loadState=this._getPluginLoadType(r),e.isFlagSet(loadState,i)&&t.notifyDataLoaded(loadState,!1,void 0,ChangeType.Remote),n=!0),n},_getRemoteAttachmentData:function(t,i){this.usesPreviewCache()&&!e.isDemoMode()?a.requestNotifyWhenAvailable(function(){this._loadPreviewData(t,i),this.getRemoteAttachmentData(t,i)}.bind(this)):this.getRemoteAttachmentData(t,i)},getRemoteAttachmentData:function(t,i){try{e.PAssert(4567,!1,"SubClass must override")}catch(t){e.reportError(t)}},_appendDupeRequest:function(t,i){try{e.PAssert(4568,t,"Must provide a valid queued request")}catch(t){e.reportError(t)}try{e.PAssert(4569,i,"Must provide a valid duped request")}catch(t){e.reportError(t)}try{e.PAssert(4570,!t.duped,"Must never use an already duped request as a dupe for another request")}catch(t){e.reportError(t)}i.attach&&(t.attach||(t.attach=[]),t.attach.pushOnlyUniques(i.attach)),t.successCB.pushOnlyUniques(i.successCB),t.failureCB.pushOnlyUniques(i.failureCB)},_areRequestFnsEqual:function(t,i){var n=!1;return t===i?n=!0:e.isArray(t)&&e.isArray(i)&&(n=t.equals(i)),n},_areRequestsEqual:function(t,i){try{e.PAssert(4571,t,"Must have a valid request A")}catch(t){e.reportError(t)}try{e.PAssert(4572,i,"Must have a valid request B")}catch(t){e.reportError(t)}var n=!0;if(t.accountID!==i.accountID)n=!1;else if(t.forceNoDupe||i.forceNoDupe)n=!1;else if(t.id!==i.id&&this._areRequestFnsEqual(t.requestFn,i.requestFn))if(t.data===i.data)n=!0;else{for(var r in t.data){if(!t.data.hasOwnProperty(r)||!i.data.hasOwnProperty(r)){n=!1;break}if(t.data[r]!==i.data[r]){n=!1;break}}if(n)for(var a in i.data){if(!t.data.hasOwnProperty(a)||!i.data.hasOwnProperty(a)){n=!1;break}if(t.data[a]!==i.data[a]){n=!1;break}}}else n=!1;return n},_getDupeRequest:function(e){for(var t,i=0;!t&&i<this._outstandingRequests.length;++i)!this._outstandingRequests[i].duped&&this._areRequestsEqual(this._outstandingRequests[i],e)&&(t=this._outstandingRequests[i]);for(var i=0;!t&&i<this._pendingRequests.length;++i)!this._pendingRequests[i].duped&&this._areRequestsEqual(this._pendingRequests[i],e)&&(t=this._pendingRequests[i]);return t},_combineRequest:function(t,i){try{e.PAssert(4573,t,"Must provide a valid queued request")}catch(t){e.reportError(t)}try{e.PAssert(4574,i,"Must provide a valid combine request")}catch(t){e.reportError(t)}try{e.PAssert(4575,!t.combined,"Must never use an already combined request as a target for another request")}catch(t){e.reportError(t)}t.data=e.mergeObjects(t.data,i.data),t.successCB.pushOnlyUniques(i.successCB),t.failureCB.pushOnlyUniques(i.failureCB)},_areRequestsCombinable:function(t,i){try{e.PAssert(4576,t,"Must have a valid request A")}catch(t){e.reportError(t)}try{e.PAssert(4577,i,"Must have a valid request B")}catch(t){e.reportError(t)}var n=!1;return t.id!==i.id&&t.combinable&&i.combinable&&t.accountID===i.accountID&&this._areRequestFnsEqual(t.requestFn,i.requestFn)&&t.type===i.type&&(t.attach||i.attach?t.attach&&i.attach&&t.attach.equals(i.attach)&&(n=!0):n=!0),n},_getCombineRequest:function(e){var t;if(e.combinable)for(var i=0;!t&&i<this._pendingRequests.length;++i)!this._pendingRequests[i].combined&&this._areRequestsCombinable(this._pendingRequests[i],e)&&(t=this._pendingRequests[i]);return t},_handleBatchRequestResponse:function(t){this._numOutstandingReqs--;try{e.PAssert(4578,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){e.reportError(t)}},_handleRequestResponse:function(t,i){if(!i){this._numOutstandingReqs--;try{e.PAssert(4579,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){e.reportError(t)}}},_handleRequestTimeout:function(t){if(this._pendingRequests.indexOf(t)>=0){t.timedOut=!0;for(var n={error:{code:i.HTTPStatusCode.Network,message:"Internal request timeout"}},r=0;r<t.failureCB.length;++r)try{t.failureCB[r](n)}catch(t){e.reportError(t)}this._pendingRequests.remove(t)}},_queueRemoteRequestMulti:function(t,i,n,r,a,s,o,c){try{e.PAssert(4580,t,"Missing accountID parameter")}catch(t){e.reportError(t)}try{e.PAssert(4581,!e.isArray(t),"Missing accountID paramter")}catch(t){e.reportError(t)}try{e.PAssert(4582,!e.isFunction(t),"Missing accountID parameter")}catch(t){e.reportError(t)}try{e.PAssert(4583,!c||void 0===c.accountID,"AccountID is specified as a separate param")}catch(t){e.reportError(t)}var l=c?e.clone(c):{};return l.accountID=t,this._queueRemoteRequest(i,n,r,a,s,o,l)},_computeTimeoutMS:function(e){var t=void 0;return e&&e.timeoutMS>-1&&e.timeoutMS,e&&void 0!==e.timeoutMS&&(0===e.timeoutMS?t=b:e.timeoutMS>=1e3&&(t=e.timeoutMS)),t},_updateRequestTimeout:function(e){e.timeoutMS&&(this._clearRequestTimeout(e),e.timeout=setTimeout(this._handleRequestTimeout.bind(this,e),e.timeoutMS))},_clearRequestTimeout:function(e){e.timeout&&(clearTimeout(e.timeout),e.timeout=void 0)},_queueRemoteRequest:function(t,n,r,a,s,o,c){try{e.PAssert(4584,t&&e.isArray(t),"RequestFn must be a valid packed function")}catch(t){e.reportError(t)}try{e.PAssert(4585,n,"Must provide valid data for the request")}catch(t){e.reportError(t)}try{e.PAssert(4587,r,"Must supply a callback for request success")}catch(t){e.reportError(t)}try{e.PAssert(4588,e.isFunction(r),"Success callback must be a valid function")}catch(t){e.reportError(t)}try{e.PAssert(4589,a,"Must supply a callback for request failure")}catch(t){e.reportError(t)}try{e.PAssert(4590,e.isFunction(a),"Failure callback must be a valid function")}catch(t){e.reportError(t)}try{e.PAssert(4591,o,"Request type must be specified")}catch(t){e.reportError(t)}try{e.PAssert(4592,!c||!c.combinable,"Combinable is not currently a valid option. Do not use.")}catch(t){e.reportError(t)}try{e.PAssert(4593,!s||!s.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",s?s.id:"UNDEFINED")}catch(t){e.reportError(t)}DETAILED_STATS&&(this.__ReqStats[o]=this.__ReqStats[o]?this.__ReqStats[o]+1:1);var l={id:++this._requestCounter,plugin:this,attach:s?[s]:void 0,request:void 0,requestFn:t,data:n,successCB:[r],failureCB:[a],type:o,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,requestsBehind:this._pendingRequests.length,accountID:c&&c.accountID?c.accountID:u.getDefaultEmail(),combinable:c&&c.combinable,autoRetry:!c||void 0===c.autoRetry||c.autoRetry,timeoutMS:this._computeTimeoutMS(c),forceNoDupe:c&&c.forceNoDupe,priority:c&&c.priority?c.priority:i.RequestPriority.Default};l.autoRetry&&(l.numRetries=c&&c.numRetries?c.numRetries:2,l.currentRetries=0),this._updateRequestTimeout(l);var d=this._insertPendingRequest(l);l.priority>i.RequestPriority.Default&&log("Insert Index: ",d,this._pendingRequests.length,l),e.vmMain.pluginManager.notifyHasPendingRemoteRequest()},_insertPendingRequest:function(e){e.priority++;var t=this._pendingRequests.insertSorted(e,this._reqSortFn);return e.priority--,t},_reqSortFn:function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1},_queuePagedRemoteRequestMulti:function(t,i,n,r,a,s,o,c){try{e.PAssert(4594,t,"Missing accountID parameter")}catch(t){e.reportError(t)}try{e.PAssert(4595,!e.isArray(t),"Missing accountID paramter")}catch(t){e.reportError(t)}try{e.PAssert(4596,!e.isFunction(t),"Missing accountID parameter")}catch(t){e.reportError(t)}try{e.PAssert(4597,!c||void 0===c.accountID,"AccountID is specified as a separate param")}catch(t){e.reportError(t)}var l=c?e.clone(c):{};return l.accountID=t,this._queuePagedRemoteRequest(i,n,r,a,s,o,l)},_queuePagedRemoteRequest:function(t,i,n,r,a,s,o){try{e.PAssert(4598,o,"Must supply a valid options param")}catch(t){e.reportError(t)}try{e.PAssert(4599,!o.getAllPages||!o.maxPages,"Should only define either maxPages or getAllPages: ",o.getAllPages,o.maxPages)}catch(t){e.reportError(t)}o.maxPages=o.maxPages||1,o.getAllPages=o.getAllPages||!1,o.maxPageResults=o.maxPageResults||100,o.maxResults=o.maxResults||1/0,o.resultsField=o.resultsField||"items";var c=0,l=[],d=e.clone(i);d.maxResults=o.maxPageResults;var h=function(e){e[o.resultsField]?l.pushArray(e[o.resultsField]):e.items?l.pushArray(e.items):e.history&&l.pushArray(e.history),e.nextPageToken&&(o.getAllPages||o.maxPages>c)&&l.length<o.maxResults?p(e.nextPageToken):e.nextPageToken||e.nextSyncToken||e.historyId?n(l,i,e):n(l)},u=function(e){r(e,l)},p=function(e){e&&(d.pageToken=e),c++,this._queueRemoteRequest(t,d,h,u,void 0,s,o)}.bind(this);p()},_retryRemoteRequest:function(t,i){
DETAILED_STATS&&this.__Stats.remoteRetries++,t.request=void 0,t.wasBatched=void 0,t.batchID=void 0,t.batchRequestID=void 0,setTimeout(function(){t.currentRetries=t.currentRetries?t.currentRetries+1:1,this._insertPendingRequest(t),e.vmMain.pluginManager.notifyHasPendingRemoteRequest()}.bind(this),this._getRetryDelay(t,i))},getNumOutstandingReqs:function(){return this._numOutstandingReqs},_pumpRequestQueue:function(t,n,r,a){try{e.PAssert(4600,this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue")}catch(t){e.reportError(t)}try{e.PAssert(4601,!this.hasDependency(PluginDependency.GoogleLogin)||this.hasDependencyBeenLoaded(PluginDependency.GoogleLogin),"Must be authorized to make remote requests")}catch(t){e.reportError(t)}var s=0,o=0,c=0,l=0,d=0,h=0,p=0;try{e.PAssert(4602,this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests")}catch(t){e.reportError(t)}var m=n;try{e.PAssert(4603,m>0,"Should never have more than max outstanding requests for a given plugin")}catch(t){e.reportError(t)}var f;m>1&&this._pendingRequests.length>1&&(f=this.createBatch());for(var g=[],v=0;m>0&&v<this._pendingRequests.length&&p<i.MaxBatchSize;++v){var y=this._pendingRequests[v];if(y.priority<t)h++;else{try{e.PAssert(4604,!e.isFunction(y),"Should never use a deferred request")}catch(t){e.reportError(t)}try{e.PAssert(4605,!1===y.handled,"Should never service a request that has already been handled")}catch(t){e.reportError(t)}var b=this._getDupeRequest(y);if(b)DETAILED_STATS&&this.__Stats.dupedRequests++,y.duped=!0,g.push(y),c++,this._appendDupeRequest(b,y);else{var S=this._getCombineRequest(y);if(S)DETAILED_STATS&&this.__Stats.combinedRequests++,y.combined=!0,g.push(y),l++,this._combineRequest(S,y);else{var E=!1;if(y.attach)for(var C=0;C<y.attach.length;++C)y.attach[C].needsRemoteData()&&(y.attach[C].notifyDataRequested(),E=!0);else E=!0;if(E)if(this.isCurrentlyAuthorized(y.accountID)){var P=this._runRemoteRequest(f,y,r);if(DETAILED_STATS&&this.__Stats.remoteRequests++,P.isNewRequest||0===p){try{e.PAssert(4606,n>s,"Should not be making more requests for plugin than allowed")}catch(t){e.reportError(t)}s++,m--,this._numOutstandingReqs++,DETAILED_STATS&&this.__Stats.actualRemoteCallsSent++}P.wasBatched&&p++,g.push(y)}else u.notifyUnauthorizedRequest(y.accountID),d++;else DETAILED_STATS&&this.__Stats.canceledRequests++,y.canceled=!0,o++,g.push(y)}}}}this._pendingRequests=this._pendingRequests.removeArray(g);for(var v=0;v<g.length;++v)g[v].canceled||g[v].duped||this._addRequest(this._outstandingRequests,g[v]);try{e.PAssert(4607,!f||p+o+c+l+d+h>1,"Batches should always have multiple items in them")}catch(t){e.reportError(t)}return f&&(p>0?(DETAILED_STATS&&this.__Stats.remoteBatches++,this.commitBatch(f,a)):DETAILED_STATS&&this.__Stats.canceledBatches++),s},_clearRequestQueue:function(){log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0},_addRequest:function(t,i){try{e.PAssert(4608,t.indexOf(i)<0,"Should never re-add a request to a queue without removing it first")}catch(t){e.reportError(t)}return t.push(i)},_removeRequest:function(e,t){return e.remove(t)},isRateLimited:function(){return this._isRateLimited},_notifyRateLimitedOver:function(){this._isRateLimited=!1},_notifyRateLimited:function(e){this._isRateLimited=!0,this._lastRateLimitTime=new Date},isRateLimitError:function(t){var n=!1;return t&&y.indexOf(t.status)>=0&&(t.status===i.HTTPStatusCode.Forbidden?e.hasGoogleError(t,i.GoogleErrorDomain.UsageLimits,i.GoogleError.UserRateLimitExceeded)?n=!0:e.hasGoogleError(t,i.GoogleErrorDomain.UsageLimits,i.GoogleError.RateLimitExceeded)?n=!0:e.hasGoogleError(t,i.GoogleErrorDomain.UsageLimits,i.GoogleError.QuotaExceeded)&&(n=!0):n=!0),n},_getRetryDelay:function(t,i){var n=t.currentRetries;return i&&(n=Math.max(2,t.currentRetries)),e.seconds(g[n])},_notifyRequestSuccess:function(e,t){var i={cbList:e.successCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(i)):this._handleResponse(i)},_notifyRequestFailure:function(e,t){var i={cbList:e.failureCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(i)):this._handleResponse(i)},_handleResponse:function(t){for(var i=0;i<t.cbList.length;++i)try{t.cbList[i](t.result)}catch(t){e.reportError(t)}},_notifyBatchCompleted:function(t){var i=this._batchedResponses[t.getBatchID()];if(delete this._batchedResponses[t.getBatchID()],i){e.vmMain.beginUpdateItems();for(var n=0;n<i.length;++n)this._handleResponse(i[n]);e.vmMain.commitUpdateItems()}},computeBatchGroupID:function(e){return e.accountID},computeRequestID:function(e){return e.id+"-"+Date.now()},_setSendTime:function(e){var t=Date.now();if(0===e.sendTimes.length){var i=t-e.queueTime;this._numSendRequests++,this._totalRequestSendTime+=i,i>S&&this._numLongWaitRequests++}e.sendTimes.push(t)},_setHandleTime:function(e){var t=Date.now();if(0===e.handleTimes.length){var i=t-e.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=i}e.handleTimes.push(t)},_runRemoteRequest:function(t,i,n){var r={wasBatched:!1,isNewRequest:!1};if(m.canConstruct(i.requestFn))i.request=m.createRequest(i.accountID,i.requestFn,i.data);else{var a=e.unpackFn(i.requestFn);try{e.PAssert(4609,e.isFunction(a,"Must specify a valid packed function: ",i.requestFn))}catch(t){e.reportError(t)}a&&(i.request=a(i.data))}if(i.request){try{e.PAssert(4610,i.request.then,"Remote request must be thenable")}catch(t){e.reportError(t)}if(t){var s=this.computeBatchGroupID(i),o=this.computeRequestID(i);r.isNewRequest=t.add(i.request,s,o);try{e.PAssert(4611,e.isBoolean(r.isNewRequest),"Add must return whether it will create a new remote request for this request")}catch(t){e.reportError(t)}r.wasBatched=!0,i.wasBatched=!0,i.batchID=t.getBatchID(),i.batchRequestID=o}else i.wasBatched=!1,i.batchID=void 0,i.batchRequestID=void 0;try{e.PAssert(4612,this.isCurrentlyAuthorized(i.accountID),"Must be currently authorized to make this request")}catch(t){e.reportError(t)}this._clearRequestTimeout(i),this._setSendTime(i),i.request.then(function(t){try{e.PAssert(4613,!1===i.handled,"Must not handle the same request multiple times")}catch(t){e.reportError(t)}this._setHandleTime(i),i.handled=!0,this._notifyRateLimitedOver(),this._notifyRequestSuccess(i,t.result),n(i.attach,i.plugin,i.wasBatched),this._removeRequest(this._outstandingRequests,i)},function(t){try{e.PAssert(4614,!1===i.handled,"Must not handle the same request multiple times")}catch(t){e.reportError(t)}this._setHandleTime(i);var r=this.isRateLimitError(t);if(r&&this._notifyRateLimited(t),(r||v.indexOf(t.status)>=0)&&i.autoRetry&&i.currentRetries<i.numRetries)n(i.attach,i.plugin,i.wasBatched),this._removeRequest(this._outstandingRequests,i),this._retryRemoteRequest(i,r);else{if(i.handled=!0,i.failed=!0,i.attach)for(var a=0;a<i.attach.length;++a)i.attach[a].notifyDataRequestFailed();this._notifyRequestFailure(i,t.result),n(i.attach,i.plugin,i.wasBatched),this._removeRequest(this._outstandingRequests,i)}},this)}return r},createPaginationToken:function(e,t,i,n,r,a){return new p(e,t,i,n,r,a)},updatePaginationToken:function(t,i){try{e.PAssert(4615,t,"Must specify a valid token to update")}catch(t){e.reportError(t)}try{e.PAssert(4616,i,"Must update the pagination token with a valid next page token")}catch(t){e.reportError(t)}return t.updateToken(i),t},createBatch:function(e){return m.createBatch(e)},commitBatch:function(t,i){try{e.PAssert(4617,t,"Batch to commit must be specified")}catch(t){e.reportError(t)}t.then(function(e){this._notifyBatchCompleted(t),i(this,!0)}.bind(this),function(){this._notifyBatchCompleted(t),i(this,!1)}.bind(this))},addModifiedOffline:function(t,i){try{e.PAssert(4618,t,"Must have a valid cache entry to update")}catch(t){e.reportError(t)}try{e.PAssert(4619,e.isBoolean(i)||e.isArray(i),"Incoming fields must be valid")}catch(t){e.reportError(t)}try{e.PAssert(4620,!1!==i,"Use removeModifiedOffline to clear data instead")}catch(t){e.reportError(t)}if(t){var n=t.modifiedOffline||!1;try{e.PAssert(4621,e.isBoolean(n)||e.isArray(n),"Previous fields must be valid")}catch(t){e.reportError(t)}!1===n?t.modifiedOffline=i:!0===n||(!0===i?t.modifiedOffline=!0:t.modifiedOffline.pushOnlyUniques(i))}},removeModifiedOffline:function(t,i){try{e.PAssert(4622,t,"Must have a valid cache entry to update")}catch(t){e.reportError(t)}try{e.PAssert(4623,e.isBoolean(i)||e.isArray(i),"Incoming fields must be valid")}catch(t){e.reportError(t)}try{e.PAssert(4624,!0!==i,"Use addModifiedOffline to add data instead")}catch(t){e.reportError(t)}if(t){var n=t.modifiedOffline||!1;try{e.PAssert(4625,e.isBoolean(n)||e.isArray(n),"Previous fields must be valid")}catch(t){e.reportError(t)}!1===n||(!0===n?!1===i&&(t.modifiedOffline=!1):!1===i?t.modifiedOffline=!1:(t.modifiedOffline=t.modifiedOffline.removeArray(i),0===t.modifiedOffline.length&&(t.modifiedOffline=!1)))}},compactCacheField:function(e,t){return e[t]},_serializeObj:function(t,i){try{e.PAssert(4626,t,"Must specify a valid entry to serialize")}catch(t){e.reportError(t)}try{e.PAssert(4627,i,"Must provide a valid property list")}catch(t){e.reportError(t)}for(var n={},r=0;r<i.length;++r){var a=i[r],s=this.getPropertyDescriptor(a);if(!s.isOpt||s.defaultValue!==t[a]){var o=this.compactCacheField(t,a);void 0!==o&&(n[a]=o)}}var c=this.getBlobData(t);return c&&(n._blob=c),n},serializeEntry:function(e){var t=this.getPropertySet(PluginLoad.Full),i=this.getCacheData(e);if(i)return this._serializeObj(i,t)},serializeExternalData:function(t){try{e.PAssert(4628,t,"Must supply valid data to serialize")}catch(t){e.reportError(t)}var i=this.getPropertySet(PluginLoad.Full),n=this._serializeObj(t,i);return n.id=t.id,t.parents&&(n.parents=t.parents),n},serializePreview:function(e){var t=this.getPropertySet(PluginLoad.Preview),i=this.getCacheData(e.id);if(i)return this._serializeObj(i,t)},registerAutocomplete:function(){if(e.autocomplete&&!this._registeredAutocomplete){var t=this.getAutocompletePrefixes();if(t){e.autocomplete.registerProvider(this._acProviderId,this);for(var i=0;i<t.length;++i)e.autocomplete.registerPrefix(this._acProviderId,t[i])}this._registeredAutocomplete=!0}},unregisterAutocomplete:function(){e.autocomplete&&this._registeredAutocomplete},declareProperty:function(t,i,n,r,a){try{e.PAssert(4629,!this._propertyDescriptors[t],"Should not declare the same property twice")}catch(t){e.reportError(t)}i=i||PluginLoad.Preview|PluginLoad.Full,n=n||!1,e.forEachFlagSet(i,function(e){this._propertySets[e]||(this._propertySets[e]=[]),this._propertySets[e].push(t)}.bind(this)),this._propertyDescriptors[t]={isOpt:n,defaultValue:r,comparator:a}},getPropertySet:function(e){return this._propertySets[e]||[]},getPropertyDescriptor:function(e){return this._propertyDescriptors[e]},getBlobData:function(e){},_updateAttachmentStates:function(){try{e.vmMain.beginUpdateItems();for(var t=0;t<this._attachKeys.length;++t){var i=this._attachCache[this._attachKeys[t]];i.isInUse()&&i.onUpdate(!1,void 0,ChangeType.Auto)}e.vmMain.commitUpdateItems()}catch(t){e.reportError(t)}},offlineLoad:function(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad()){this._hasRunOfflineLoad=!0;try{this._offlineLoad&&this._offlineLoad()}catch(t){e.reportError(t)}}},load:function(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(t){e.reportError(t)}}this._loadedInitialData||!e.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()},loadInitialData:function(){try{e.PAssert(4631,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(t){e.reportError(t)}try{e.PAssert(4632,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(t){e.reportError(t)}this._loadedInitialData=!0},finishedLoading:function(){e.fireCustomEvent(this.loadedEvent)},getDataPane:function(){},getPaneIcon:function(){return"icon-question"},getPanePriority:function(){return 0},getDefaultDisplayItem:function(){},useItemStore:function(){},itemStoreOptions:function(){},getDefaultItemStore:function(){try{e.PAssert(4633,this.useItemStore(),"Must request an item store")}catch(t){e.reportError(t)}return this._defaultItemStore},getActiveItemStore:function(t){try{e.PAssert(4634,t,"Must specify a valid paneID to get the item store for")}catch(t){e.reportError(t)}try{e.PAssert(4635,this.useItemStore(),"Must request item store usage")}catch(t){e.reportError(t)}var i=this._activeItemStore[t];return i||this._defaultItemStore},getBucketItemStore:function(e){return this._searchBuckets[e]},allowRemoteRequests:function(){return!1},handleDropEvent:function(e,t){return!1},handleTapClick:function(e,t,i,n){return!1},handleDoubleTap:function(e,t,i,n){return!1},getAutocompletePrefixes:function(){},notifyPaneCreated:function(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||(this.areDependenciesLoaded()?this.loadInitialData():this.loadRemoteAPIs())},notifyPaneDestroyed:function(){this._numActivePanes--;try{e.PAssert(4638,this._numActivePanes>=0,"Should never have negative active panes")}catch(t){e.reportError(t)}},notifyPanesReadyForLoad:function(){e.vmMain.paneManager.runForEachPane(function(e){e.notifyPluginLoaded()},this.getPaneType())},hasActiveDataPanes:function(){return this._numActivePanes>0},allowTextEditing:function(e,t){return!0},_createSearchBucket:function(t,i){var n;n=e.generateTempId();var r=e.vmMain.itemStoreManager.registerItemStore(n,this,{trackGlobally:!1});return r.createRoot(i||e.generateTempId(),"Search Results"),this._searchBuckets[n]=r,n},_destroySearchBucket:function(e){this._searchBuckets[e].clearStore()},swapInSearchBucket:function(t,i){try{e.PAssert(4639,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(t){e.reportError(t)}if(e.vmMain.paneManager.isPaneActive(i)){var n=e.vmMain.paneManager.getPaneById(i),r=this._searchBuckets[t];if(!this._activeSearchBucket[i]||this._activeSearchBucket[i].id!==t){var a=r.getRoot();this._activeSearchBucket[i]||(this._defaultZoomItems[i]=n.getItem()),this._activeItemStore[i]=r,this._activeSearchBucket[i]=r,n.setRootItem(a,!0),n.useItemStore(r)}}},swapOutSearchBucket:function(t,i){try{e.PAssert(4640,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(t){e.reportError(t)}var n=this._activeSearchBucket[t].id,r=e.vmMain.paneManager.getPaneById(t),a=this._searchBuckets[n];try{e.PAssert(4641,a,"Must have a valid bucket we are swapping from")}catch(t){e.reportError(t)}var s=r.getRootItem();try{e.PAssert(4642,s===a.getRoot(),"Current root for pane should match bucket root")}catch(t){e.reportError(t)}i=i||this._defaultZoomItems[t];try{e.PAssert(4643,i,"Must always be able to get a valid default zoom item")}catch(t){e.reportError(t)}this._activeItemStore[t]=void 0,this._activeSearchBucket[t]=void 0,this._defaultZoomItems[t]=void 0,r.setItem(i,!0),r.stopUsingItemStore(a),this._destroySearchBucket(n)},runSearch:function(t,i,n,r,a){try{e.PAssert(4644,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(t){e.reportError(t)}var s;return r&&(s=this._createSearchBucket(t,n)),this.runRemoteSearch(t,i,s,a)},getSearchRoot:function(t){var i=this._searchBuckets[t];try{e.PAssert(4645,i,"Should always reference a valid search bucket")}catch(t){e.reportError(t)}return i.getRoot()},runRemoteSearch:function(t,i,n){try{e.PAssert(4646,!1,"SubClass must override")}catch(t){e.reportError(t)}},isRemoteSearchBucketActive:function(e){return!!this._activeSearchBucket[e]},clearSearch:function(e,t){this._activeSearchBucket[e]&&this.swapOutSearchBucket(e,t)},refreshCurrentView:function(t){try{e.PAssert(4647,!1,"SubClass must override")}catch(t){e.reportError(t)}},dumpRequestQueue:function(t){console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(var i=0;i<this._outstandingRequests.length;++i){var n=this._outstandingRequests[i];console.log("  ",n.requestFn,":",n.id," - ",n.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(var i=0;i<this._pendingRequests.length;++i){var n=this._pendingRequests[i];console.log("  ",n.requestFn,":",n.id," - ",n.data)}if(t){try{e.PAssert(4648,!1,"Must be in DEBUG mode to display info on handled requests")}catch(t){e.reportError(t)}console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(var i=0;i<this._handledRequests.length;++i){var n=this._handledRequests[i];n.failed?console.log(" !",n.requestFn,":",n.id," - ",n.data):console.log("  ",n.requestFn,":",n.id," - ",n.data)}}},dumpQueueStats:function(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)},getCssClass:function(e){return""}},t.defineBase(f),f}),define("TokenHolder",["globals","util"],function(e,t){function i(e){this._cb=e,this._pageToken=void 0,this._validToken=!1}var n={hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(e){this._pageToken=e,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(e){e?this._pageToken.notifyEndUse():this._validToken=!1},notifyPaginationUpdate:function(){log("Pagination Update")}};return t.defineBase(i),t.extend(i.prototype,n),i}),define("CachedSearch",["globals","util","TokenHolder"],function(e,t,i){function n(e,i,n){this._super.constructor.call(this),this._searchQuery=e,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=n,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=i,t.forceBind("onEntry",this)}var r={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(t,i){try{e.PAssert(4649,e.isFunction(t)&&e.isFunction(i)||this._lastPageRequest,"Must provide valid callbacks")}catch(t){e.reportError(t)}try{e.PAssert(4650,!this._invalid,"Should never request another page from an invalidated search")}catch(t){e.reportError(t)}try{e.PAssert(4651,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(t){e.reportError(t)}try{e.PAssert(4652,!this._activePageRequest,"Should only run a single request at a time")}catch(t){e.reportError(t)}if(t||i||!this._lastPageRequest||(t=this._lastPageRequest.entryCB,i=this._lastPageRequest.doneCB),this._activePageRequest)i(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var n=0;n<this._pageSize;++n){var r=this._cachedResults[this._localPageOffset+n];try{t(r)}catch(t){e.reportError(t)}}this._localPageOffset+=this._pageSize,i(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:t,doneCB:i},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(var n=this._localPageOffset;n<this._cachedResults.length;++n){var r=this._cachedResults[n];try{t(r)}catch(t){e.reportError(t)}this._localPageOffset++}i(!0)}},onEntry:function(e){this._invalid||this._cachedResults.push(e)},onDone:function(e){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,e?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,pageRequest.doneCB(e)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};return t.inherit(i,n),t.extend(n.prototype,r),n}),define("plugins/Plugin_Drive_Pane",["Constants","globals","util","data","Observable","VMPane","International"],function(e,t,i,n,r,a,s){function o(i){this.plugin=t.vmMain.pluginManager.getPlugin(PluginID.Drive),this.type=this.plugin._paneType,this.paneClass="paneOutline panePlugin paneDrive noComplete",this.paneEmptyMessage="Loading Google Drive...",this.paneEmptySearchMessage="",this.titleContextMenuHeader="Open folder",this.dropEffect=function(){return e.DropEffect.Copy},this.isWriteable=!1,this.isDropTarget=!1,this.overrideCopyBehavior=!1,this.canAddItem=!1,this.supportCollapsing=!0,this.supportCompleting=!1,this.supportOffline=!1,this.supportPerformArchive=!1,this.supportDataRefresh=!0,this.supportPagination=!0,this.supportSearchListenTextChanges=!1,this.supportSearchFlat=!1,this.supportClickOverviewScroll=!1,this.supportClone=!1,this.supportDates=!1,this.shouldUpdateOnTextChanged=!1,this.overviewTracksScroll=!1,this.hasMoreButtons=!0,this.searchFilters=[],this._super.constructor.call(this,i),this._isSearchingRemote=new r(!1),this._currentSearch=void 0,this.initDrive()}var c={initDrive:function(){this.search.onChanged.listen(i.forceBind("notifySearchChanged",this)),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0},destroy:function(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this._super.destroy.call(this)},_getNotReadyStatus:function(){var e="Unknown Error: Unable to load pane data.",t=this.plugin.getUnloadedDependencies();return t&&(t.indexOf(PluginDependency.PremiumSub)>=0?e="Only available to premium subscribers.":t.indexOf(PluginDependency.GoogleLogin)>=0&&(e="Missing permissions for Google Drive access.")),e},getItemStore:function(){return this.plugin.getActiveItemStore(this.id)},getRootItem:function(){var e=this.getItemStore();return e?e.getRoot():void 0},bottomListMessage:function(){var e;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(e="LOAD MORE"),e},searchACName:function(){},getPaneIcon:function(){return this.plugin.getPaneIcon()},requestDemandLoadData:function(e){this.plugin.requestDemandLoadData(this.id,e)},requestDataPage:function(e){this.plugin.requestDataPage(e)},updateContents:function(){this._super.updateContents.call(this)},onAfterLoaded:function(){this._super.onAfterLoaded.call(this)},onClose:function(){this._super.onClose.call(this)},_runRemoteSearch:function(){if(t.vmMain.paneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var e=this.search.getValue();this._lastSearchValue=e,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(e,this.id,void 0,!1,function(e){switch(this.isLoading.set(!1),e){case SearchResultStatus.Done:this.paneTopText.set("");break;case SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{t.PAssert(4653,!1,"Invalid search state: ",e)}catch(e){t.reportError(e)}}}.bind(this))}},notifySearchChanged:function(e){var t=this.search.getValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var i=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),i)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")},refreshPaneData:function(){this.plugin.refreshCurrentView(this.id)},notifyDropFrom:function(e,t){this.plugin.notifyDropFrom(e,t)},notifyDropFromToEdit:function(e,t){return this.plugin.notifyDropFromToEdit(e,t)},applyAgendaDropToItem:function(i,n){if(i.isDate){var r,a=i.dateTime||i.date;r=t.isString(a)?s.parseDate(a,e.DateFormat.MDY):a;try{t.PAssert(4654,t.isDateValid(r),"Must provide a valid date when scheduling an email",i.dateTime,i.date)}catch(e){t.reportError(e)}t.isDateValid(r)&&this.plugin.scheduleFile(n,r)}},dropEffectCopyBehavior:function(e,i){return this.plugin.isItemDroppable(e)?this._super.dropEffectCopyBehavior.call(this,e,i):void t.toasts.pushMessage(MessageID.DisabledFolderDrop)},refreshPaneData:function(){this.plugin.refreshCurrentView(this.id)},isSearchingRemote:function(){return this._isSearchingRemote.get()},_onRemoteDataLoaded:function(){},isItemHeader:function(e,t){if(t){var i=this.plugin,n=e.getAttachmentByPlugin(i.id),r=n&&i.getCacheData(n.id);return!r||i.isFolder(r)}return e.isHeader()}};return i.inherit(a,o),i.extend(o.prototype,c),o}),define("plugins/Plugin_Drive",["globals","util","platform","Constants","data","gdata","apis","AccountManager","goog","TokenHolder","CachedSearch","PluginRenderer","VMPlugin","plugins/Plugin_Drive_Pane","tracker","DuchessHelpers","DesktopUI"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m,f,g){function v(){this._super.constructor.call(this,PluginID.Drive,"Drive"),this.autocompleteReplace=!0,this.displaySharedWithMe=!e.isDemoMode(),t.forceBind("sortFn",this),this.registerSetting("WriteAccess","writeAccess",!0),this.registerSetting("LastChangeId","lastChangeId"),this.registerSetting("DriveRootId","driveRootId"),this._folderCache=this.registerLocalCache("FolderCache",StorageType.IndexedDB,!0),this.declareProperty("titleLower",PluginLoad.Runtime,!1,""),this.declareProperty("pinToTop",PluginLoad.Runtime,!0,!1),this.declareProperty("title"),this.declareProperty("mimeType"),this.declareProperty("fileSize",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("alternateLink",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("isDeleted",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("modifiedDate",PluginLoad.Autocomplete,!0),this.declareProperty("parents",PluginLoad.Autocomplete,!0),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.DriveFile),this.useRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.DriveFile),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.DriveFile)}var y={Unknown:"application/octet-stream",Folder:"application/vnd.google-apps.folder",Sheet:"application/vnd.google-apps.spreadsheet",Slide:"application/vnd.google-apps.presentation",Document:"application/vnd.google-apps.document",Moodo:c.REALTIME_MIMETYPE+"."+c.APP_ID,ImagePng:"image/png",ImageJpg:"image/jpg",ImageJpeg:"image/jpeg",ImageGif:"image/gif"},b={SingleFile:1,FolderStruct:2,SubFolder:3,Search:4,DataPage:5,ChangeList:6,SingleFolder:7},S={SharedWithMe:"S~SharedWithMe"},E="https://drive.google.com/open?id=",C="-------314159265358979323846",P="\r\n--"+C+"\r\n",T={getType:function(){return n.PluginType.Storage},getDataPane:function(){try{e.PAssert(4655,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(t){e.reportError(t)}return p},getPaneIcon:function(){return"icon-drive-file"},getPanePriority:function(){return 96},useItemStore:function(){return"Google Drive"},itemStoreOptions:function(){return{requireStoredEls:!1,parserFn:f.runParseSinglePlugin.bind(f)}},allowRemoteRequests:function(){return!0},onAuthorizedSetting:function(e,t){switch(e){case this.Settings.WriteAccess:t&&this._ensureAttachmentsAreShared()}},_ensureSpecialFolders:function(){var t=this.getDefaultItemStore();if(t){var i=t.getRoot();if(this.displaySharedWithMe&&!t.hasItem(S.SharedWithMe)){var n=e.generateTempId();this.cacheData(n,{title:"Shared With Me",titleLower:"shared with me",mimeType:y.Folder,pinToTop:!0});var r=this.getAttachment(n),a=t.createItem(S.SharedWithMe,this.getAttachmentEmbedString(r),i.id,{demandLoadChildren:!0});i.insertSorted(a,this.sortFn)}}},_load:function(){this._ensureSpecialFolders(),e.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:e.minutes(15),minDelay:e.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate.bind(this)})},_notifyFailedRequest:function(t){t&&t.error&&e.reportError(new Error("Failed Drive request: ",t.error.code),t)},refreshCurrentView:function(){if(this.hasRecurringTask("ChangeListUpdates")){this.getRecurringTask("ChangeListUpdates").forceUpdate()}},loadInitialData:function(){this._super.loadInitialData.call(this),this._ensureSpecialFolders();var e=new l(function(e){}.bind(this));setTimeout(function(){this._folderCache.onCacheMetadataReady(function(){this._folderCache.getMetadata("isSyncd",function(t){t||(log("Folder cache unsyncd - running folder sync"),this._folderCache.onCacheReady(function(){var t=0,i=0,n="trashed=false and mimeType contains '"+y.Folder+"'";this._requestRemoteFiles(b.FolderStruct,e,n,999,function(e){this._folderCache.cacheEntry(e.id,this.serializeExternalData(e)),i++}.bind(this),function(e){t++}.bind(this)),this._folderCache.setMetadata("isSyncd",!0)}.bind(this)))}.bind(this))}.bind(this))}.bind(this),100);var t=!1,i=this.getDefaultItemStore(),n=i.getRoot(),r="trashed=false and 'root' in parents and mimeType != '"+y.Moodo+"'";this._requestRemoteFiles(b.SubFolder,n,r,70,function(e){if(this.hasCacheData(e.id)||this._addRemoteEntry(e),!this._hasSameItem(e.id,n.id,i)){var t=i.createItem(this._createItemID(e.id,i),this._getTextForItem(e),n.id,{demandLoadChildren:e.mimeType===y.Folder});n.insertSorted(t,this.sortFn)}if(!this.getSetting(this.Settings.DriveRootId)&&e.parents)for(var r=0;r<e.parents.length;++r)e.parents[r].isRoot&&this.setSetting(this.Settings.DriveRootId,e.parents[r].id)}.bind(this),function(){t||(t=!0,this.finishedLoading())}.bind(this))},performChangeListUpdate:function(){var t=-1,i=this.getSetting(this.Settings.LastChangeId);this._requestChangeList(i,function(n){try{e.PAssert(4656,!i||parseInt(n.id)>parseInt(i),"Must have correctly ordered change entry")}catch(t){e.reportError(t)}t=n.id;try{!n.fileId||n.file&&n.file.mimeType===y.Moodo||this._handleChange(n)}catch(t){e.reportError(t)}}.bind(this),function(e){e&&-1!=t&&this.setSetting(this.Settings.LastChangeId,t)}.bind(this))},_deleteFile:function(e){e.forEachItem(this.getDefaultItemStore(),function(e){e.parent().removeChild(e,ChangeType.Remote),e.parent(void 0)}.bind(this)),e.updateField("isDeleted",!0)},_handleChange:function(t){try{e.PAssert(4657,t&&(t.deleted||t.file),"Must have a valid formed change entry to handle")}catch(t){e.reportError(t)}if((t.deleted||t.file.mimeType===y.Folder)&&(t.deleted?this._folderCache.hasEntry(t.fileId,function(e){e&&this._folderCache.removeEntry(t.fileId)}.bind(this)):this._folderCache.cacheEntry(t.fileId,this.serializeExternalData(t.file))),!this.hasCacheData(t.fileId)&&!t.deleted&&t.file){for(var i=t.file.parents,n=!1,r=0;r<i.length;++r)if(this.hasCacheData(i[r].id)||i[r].isRoot){n=!0;break}n&&this._addRemoteEntry(t.file)}var a=this.getCacheData(t.fileId);if(a){t.deleted||this.dataHasChanged(a,t.file)&&this._addRemoteEntry(t.file);var s=this.getDefaultItemStore();if(t.deleted){var o=this.getAttachment(t.fileId);this._deleteFile(o)}else{var c=[],o=this.getAttachment(t.fileId);o.forEachItem(s,function(e){for(var i=!1,n=0;n<t.file.parents.length;++n){var r=t.file.parents[n];if(r.isRoot&&e.parent()&&e.parent().isRootItem()||e.parent()&&e.parent().hasAttachment(r.id)){i=!0,c.push(r.id);break}}e.parent()&&this._isSpecialFolder(e.parent().id)&&(i=!0,c.push(e.parent().id)),!i&&e.parent()&&(e.parent().removeChild(e,ChangeType.Remote),e.parent(void 0))}.bind(this));for(var r=0;r<t.file.parents.length;++r){var l=t.file.parents[r];if(c.indexOf(l.id)<0)if(l.isRoot){
var d=s.getRoot(),h=s.createItem(this._createItemID(t.fileId,s),this._getTextForItem(t.file),d.id,{demandLoadChildren:t.file.mimeType===y.Folder});d.insertSorted(h,this.sortFn)}else{var u=this.getAttachment(l.id);u.forEachItem(s,function(e){var i=s.createItem(this._createItemID(t.fileId,s),this._getTextForItem(t.file),e.id,{demandLoadChildren:t.file.mimeType===y.Folder});e.insertSorted(i,this.sortFn)}.bind(this))}}if(this.displaySharedWithMe&&t.file.sharedWithMeDate&&c.indexOf(S.SharedWithMe)<0){var p=s.getItem(S.SharedWithMe),h=s.createItem(this._createItemID(t.fileId,s),this._getTextForItem(t.file),p.id,{demandLoadChildren:t.file.mimeType===y.Folder});p.insertSorted(h,this.sortFn)}}}},_isValidFileID:function(e){return e.indexOf("~")<0},_createItemID:function(t,i){try{e.PAssert(4658,t,"Must provide a fileID")}catch(t){e.reportError(t)}try{e.PAssert(4659,this._isValidFileID(t),"Invalid fileID - "+t)}catch(t){e.reportError(t)}try{e.PAssert(4660,i,"Must provide a valid itemStore")}catch(t){e.reportError(t)}for(var n=t,r=0;i.hasItem(n)&&r<50;)n=t+"~"+ ++r;try{e.PAssert(4661,r<50,"SANITY: Should not have items with 50+ parents")}catch(t){e.reportError(t)}return n},_hasSameItem:function(e,t,i){for(var n=!1,r=e,a=0;i.hasItem(r)&&a<50;){var s=i.getItem(r);if(s&&s.parent()&&s.parent().id===t){n=!0;break}r=e+"~"+ ++a}return n},_isSpecialFolder:function(e){return e.startsWith("S~")},requestDemandLoadData:function(t,i){try{e.PAssert(4662,1===i.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(t){e.reportError(t)}var n,r=e.vmMain.paneManager.getPaneById(t),a=i.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(i.id))switch(i.id){case S.SharedWithMe:n="trashed=false and sharedWithMe and mimeType != '"+y.Moodo+"'";break;default:try{e.PAssert(4663,!1,"Invalid special folder ID")}catch(t){e.reportError(t)}}n||(n="trashed=false and '"+a.id+"' in parents and mimeType != '"+y.Moodo+"'");var s=this.getActiveItemStore(t);this._requestRemoteFiles(b.SubFolder,i,n,70,function(e){if(this.hasCacheData(e.id)||this._addRemoteEntry(e),!this._hasSameItem(e.id,i.id,s)){var t=s.createItem(this._createItemID(e.id,s),this._getTextForItem(e),i.id,{demandLoadChildren:e.mimeType===y.Folder});i.insertSorted(t,this.sortFn)}}.bind(this),function(e){e||i.hasPaginationToken()||i.notifyLoadDataFailed(r)}.bind(this)),this.sendEvent("RequestDemandLoadData")},requestDataPage:function(e){this._requestRemoteFiles(b.DataPage,e)},_ensureAncestorChain:function(t,i,n,r){try{e.PAssert(4664,n,"Must provide a valid success callback")}catch(t){e.reportError(t)}try{e.PAssert(4665,r,"Must provide a valid error callback")}catch(t){e.reportError(t)}if(i.parents&&i.parents.length)for(var a=i.parents.length,o=0,c=function(){++o===a&&n()},l=function(i){try{e.PAssert(4666,i,"Must provide valid fileInfo up ancestor chain")}catch(t){e.reportError(t)}this.hasCacheData(i.id)||this._addRemoteEntry(i),this._ensureAncestorChain(t,i,c,r)}.bind(this),d=function(e){if(e){var t=this.serializeExternalData(e);this._folderCache.cacheEntry(t.id,t),l(t)}else r({error:"Undefined success result."})}.bind(this),h=function(e,t){if(e)l(e);else{var i=s.fns("drive").files.get.packedFn,n={fileId:t};this._queueRemoteRequest(i,n,d,r,void 0,b.SingleFolder)}}.bind(this),u=0;u<i.parents.length;++u){var p=i.parents[u].id;try{e.PAssert(4667,p,"Must supply a valid parent ID to query")}catch(t){e.reportError(t)}this._folderCache.getEntry(p,h)}else n()},_hasAttachmentChild:function(e,t){for(var i=!1,n=0;n<e.numItems();++n){if(e.itemAtIndex(n).hasAttachment(t)){i=!0;break}}return i},_attachAncestorChain:function(t,i){try{e.PAssert(4668,i,"Must provide a valid cache entry to create items for")}catch(t){e.reportError(t)}if(i.parents&&i.parents.length>0)for(var n=0;n<i.parents.length;++n){var r=i.parents[n];try{e.PAssert(4669,r&&r.id,"Must supply a valid parent ID to query")}catch(t){e.reportError(t)}if(r.isRoot){var a=t.getRoot();if(!this._hasAttachmentChild(a,i.id)){var s=t.createItem(this._createItemID(i.id,t),this._getTextForItem(i),a.id,{demandLoadChildren:i.mimeType===y.Folder});a.insertSorted(s,this.sortFn)}}else this._folderCache.getEntry(r.id,function(e){this._attachAncestorChain(t,e),this.getAttachment(e.id).forEachItem(t,function(e){if(!this._hasAttachmentChild(e,i.id)){var n=t.createItem(this._createItemID(i.id,t),this._getTextForItem(i),e.id,{demandLoadChildren:i.mimeType===y.Folder});e.insertSorted(n,this.sortFn)}}.bind(this))}.bind(this))}},getNextSearchPage:function(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()},runRemoteSearch:function(t,i,n,r){try{e.PAssert(4670,t,"Must provide a valid search")}catch(t){e.reportError(t)}try{e.PAssert(4671,i,"Must provide a valid pane")}catch(t){e.reportError(t)}try{e.PAssert(4672,e.isFunction(r),"Must provide a valid search callback")}catch(t){e.reportError(t)}var a=!1,s=0,o=0,c=0,l=new d(t,10,this.requestDataPage.bind(this)),h=function(){if(s===o&&a){log("Done Searching! "+s);var t=SearchResultStatus.Done;if(l.isValid()){e.vmMain.paneManager.getPaneById(i).search.update(!0),l.isValid()&&l.hasMoreResults()?(log("Too many search results"),t=SearchResultStatus.TooMany):l.hasError()||c>0?t=SearchResultStatus.Error:0===s&&(t=SearchResultStatus.None),this._lastCompletedSearch=l}r(t)}}.bind(this),u=function(t){s++,this.hasCacheData(t.id)||this._addRemoteEntry(t);var n=this.getActiveItemStore(i);this._ensureAncestorChain(n,t,function(){l.isValid()&&this._attachAncestorChain(n,t),o++,h()}.bind(this),function(t){e.reportError(new Error("Error during remote search: ",t)),o++,c++,h()}.bind(this))}.bind(this),p=function(e){a=!0,h()}.bind(this),m=!1,f=function(e){l.onDone(e),m||(m=!0,l.isValid()&&(l.hasResults()?l.getNextPage(u,p):p(e)))},g="trashed=false and (fullText contains '"+t+"')";return this._requestRemoteFiles(b.Search,l,g,100,l.onEntry,f),this.sendEvent("RemoteSearch"),l},_requestRemoteFiles:function(t,i,n,r,a,o){var c;i&&i.hasPaginationToken()&&!i.paginationTokenInUse()?(c=i.beginDataPageLoad(),n=c.getQuery(),r=c.getMaxResults(),a=c.getEntryCB(),o=c.getDoneCB()):i&&i.needsPaginationToken()&&(c=this.createPaginationToken(void 0,n,{},r,a,o),i.setPaginationToken(c),i.beginDataPageLoad()),r=r||70;try{e.PAssert(4673,a&&e.isFunction(a),"Must define a valid entry callback")}catch(t){e.reportError(t)}try{e.PAssert(4674,o&&e.isFunction(o),"Must define a valid done callback")}catch(t){e.reportError(t)}var l,d,h=s.fns("drive").files.list.packedFn,u={fields:"items,nextPageToken",maxResults:r,q:n,pageToken:c&&c.hasMorePages()?c.getNextPageToken():void 0};c||!i?(l=function(t){if(t.items){e.vmMain.beginUpdateItems();for(var n=0;n<t.items.length;++n)a(t.items[n]);e.vmMain.commitUpdateItems()}t.nextPageToken&&c&&this.updatePaginationToken(c,t.nextPageToken),i&&c&&i.endDataPageLoad(!!t.nextPageToken),o(!0)}.bind(this),d=function(){c&&i.endDataPageLoad(!!c),o(!1)}.bind(this)):(l=function(){o(!0)},d=function(){o(!1)}),this._queueRemoteRequest(h,u,l,d,void 0,t)},getRemoteAttachmentData:function(t){var i=s.fns("drive").files.get.packedFn,r={fileId:t.id},a=function(i){try{e.PAssert(4675,!i||i.id===t.id,"If valid result, attachment should match remote file ID")}catch(t){e.reportError(t)}i&&(this._addRemoteEntry(i),(i.deleted||i.mimeType===y.Folder)&&(i.deleted?this._folderCache.hasEntry(i.id,function(e){e&&this._folderCache.removeEntry(i.id)}.bind(this)):this._folderCache.cacheEntry(i.id,this.serializeExternalData(i))))}.bind(this),o=function(i){if(e.isHTTPStatusCode(i,n.HTTPStatusCode.NotFound)){var r={id:t.id,mimeType:y.Unknown,title:"Unknown",titleLower:"unknown",fileSize:0};this._addRemoteEntry(r),this._deleteFile(t)}else t.notifyDataRequestFailed(),this._notifyFailedRequest(i)}.bind(this);this._queueRemoteRequest(i,r,a,o,t,b.SingleFile)},_requestChangeList:function(t,i,n){if(t){try{e.PAssert(4676,i,"Must supply a valid entry CB")}catch(t){e.reportError(t)}try{e.PAssert(4677,n,"Must provide a valid done CB")}catch(t){e.reportError(t)}var r=s.fns("drive").changes.list.packedFn,a={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+t+1,fields:"items,nextPageToken"},o=function(r){var a=t;e.vmMain.beginUpdateItems();for(var s=0;s<r.items.length;++s){var o=r.items[s];try{e.PAssert(4678,o,"Must have a valid change entry")}catch(t){e.reportError(t)}try{e.PAssert(4679,parseInt(o.id)<1e8,"Must have a valid entry ID")}catch(t){e.reportError(t)}try{e.PAssert(4680,parseInt(o.id)>parseInt(a),"Must be ordered monotonic increasing")}catch(t){e.reportError(t)}a=o.id,i(o)}e.vmMain.commitUpdateItems(),r.nextPageToken?this._requestChangeList(a,i,n):n(!0)}.bind(this),c=function(e){n(!1)}}else var r=s.fns("drive").changes.list.packedFn,a={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:1e8},o=function(e){var t=e.largestChangeId;i({id:t}),n(!0)},c=function(e){n(!1)};this._queueRemoteRequest(r,a,o,c,void 0,b.ChangeList)},_createRemoteEntry:function(e){var t={id:e.id,mimeType:e.mimeType,title:e.title,titleLower:e.title.toLowerCase(),alternateLink:e.alternateLink,fileSize:+e.fileSize,parents:e.parents,modifiedDate:e.modifiedDate?new Date(e.modifiedDate):void 0};if(t.parents)for(var i=0;i<t.parents.length;++i)this._updateParentsEntry(t.parents[i]);if(e.properties)for(var i=0;i<e.properties.length;++i){if(e.properties[i].key===c.DocFolderTitleProperty){t.title=e.properties[i].value;break}if(e.properties[i].key===c.DefaultRootFolderProperty){t.title="Shared Files",t.pinToTop=!0;break}}return this.isFolder(t)&&(t.items=[]),t},_addRemoteEntry:function(e){var t=this._createRemoteEntry(e);this.cacheData(t.id,t)},createEntryFromLocal:function(t,i){if(this.isFolder(i)&&(i.items=[]),i.titleLower=i.title.toLowerCase(),i.modifiedDate=i.modifiedDate?new Date(i.modifiedDate):void 0,i.isDeleted=i.isDeleted||e.isTempId(t),i.parents)for(var n=0;n<i.parents.length;++n)this._updateParentsEntry(i.parents[n]);return i},_updateParentsEntry:function(e){this._folderCache.getEntry(e.id,function(t){t&&(e.title=t.title)})},isFolder:function(e){return e.mimeType===y.Folder},_getCompStringForItem:function(e){return e.hasPluginAttachment(this.id)?e.getAttachmentByPlugin(this.id).getTitleString():e.getParsedText()},_isItemPinnedToTop:function(e){return!!e.hasPluginAttachment(this.id)&&e.getAttachmentByPlugin(this.id).getField("pinToTop")},sortFn:function(e,t){return this._isItemPinnedToTop(e)?-1:this._isItemPinnedToTop(t)?1:this._getCompStringForItem(e).localeCompare(this._getCompStringForItem(t))},getAttachmentClass:function(e){var t=["plugin_drive"];return e.hasField("mimeType")?t.push(this.getMimetypeClass(e.getField("mimeType"))):t.push("plugin_drive_unk"),e.hasField("isDeleted")&&e.getField("isDeleted")&&t.push("fileDeleted"),t},getMimetypeClass:function(e){switch(e){case y.Folder:return"plugin_drive_folder";case y.Sheet:return"plugin_drive_sheet";case y.Slide:return"plugin_drive_slide";case y.Document:return"plugin_drive_doc";case y.ImagePng:case y.ImageGif:case y.ImageJpg:case y.ImageJpeg:return"plugin_drive_image";default:return"plugin_drive_unk"}},isImage:function(e){return e.hasField("mimeType")&&"plugin_drive_image"===this.getMimetypeClass(e.getField("mimeType"))},googleScopes:function(e){return e||this.getSetting(this.Settings.WriteAccess)?[GScope.DriveFull]:[GScope.DriveMetadataRO]},getDependencies:function(){return[PluginDependency.LocalLoaded,PluginDependency.PremiumSub,PluginDependency.GoogleLogin]},onDependencyLoaded:function(t,n){if(this._super.onDependencyLoaded.call(this,t,n),t===PluginDependency.GoogleLogin){try{e.PAssert(4681,e.isArray(n),"Must provide a valid scope array")}catch(t){e.reportError(t)}this.getSetting(this.Settings.IsEnabled)&&!i.mobile&&(n.indexOf(GScope.DriveMetadataRO)<0&&n.indexOf(GScope.DriveFull)<0&&(e.toasts.pushMessage(MessageID.LostPermission),o.notifyUnauthorizedAccount("me",[GScope.DriveMetadataRO,GScope.DriveFull],"Missing Scope"),this.setSetting(this.Settings.IsEnabled,!1)),this.getSetting(this.Settings.WriteAccess)&&n.indexOf(GScope.DriveFull)<0&&(e.toasts.pushMessage(MessageID.LostPermission),o.notifyUnauthorizedAccount("me",[GScope.DriveFull],"Missing Write Scope"),this.setSetting(this.Settings.WriteAccess,!1)))}},isDependencyLoaded:function(e,t){var i=!1;switch(e){case PluginDependency.GoogleLogin:t&&(t.indexOf(GScope.DriveMetadataRO)>=0||t.indexOf(GScope.DriveFull)>=0)&&(i=!0);break;default:i=!0}return i},handleDropEvent:function(e,t){var i=e.dataTransfer?e.dataTransfer.getData("text/uri-list"):void 0;if(i&&i.startsWith(E)){var n=i.replace(E,""),r=n.indexOf("&"),a=n.substr(0,r);return t(this.getAttachment(a).getEmbedString()),!0}if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){for(var s=0;s<e.dataTransfer.files.length;++s){var o=e.dataTransfer.files[s];this._handleDropFile(o,e,t)}return m.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DriveUpload}),!0}if(e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0){for(var s=0;s<e.clipboardData.items.length;++s){var c=e.clipboardData.items[s],o=c?c.getAsFile():void 0;o&&(o.name="Moo.do Upload "+Date.now(),this._handleDropFile(o,e,t))}return m.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DriveUpload}),!0}return!1},isItemDroppable:function(t){var i=!0,n=t.getAttachmentByPlugin(this.id);try{e.PAssert(4682,n,"Should always have a valid attachment when copying from a Drive pane.")}catch(t){e.reportError(t)}if(n){n.getField("mimeType")===y.Folder&&(i=!1)}return i},_handleDropFile:function(t,i,n){for(var r=!1,a=this.findCachedItemsByField("title",t.name),s=e.getPaneForElement(i.target),o=0;o<a.length;++o){var c=a[o];if(c.fileSize===t.size&&!c.isDeleted){var l=this.getAttachment(c.id);s&&s.isWriteable&&s.plugin!==this?n(this.getAttachmentEmbedString(l),!1):s&&s.plugin===this&&l.forEachItem(p,function(e){e.highlight()}),r=!0;break}}if(!r){var d=e.generateTempId();this.cacheData(d,{title:t.name,titleLower:t.name.toLowerCase(),mimeType:t.type});var h,l=this.getAttachment(d),u=s&&s.isWriteable&&s.plugin!==this,p=this.getDefaultItemStore();if(s&&s.isWriteable&&s.plugin!==this)n(this.getAttachmentEmbedString(l),!0);else if(this.getSetting(this.Settings.WriteAccess)){var m=i.target;h=e.hasClass(m,"paneContent")?s.getItem():e.getItemForElement(m),h&&!h.isHeader()&&(h=h.parent())}var f;if(h){if(!h.isRootItem()){var g=h.getAttachmentByPlugin(this.id);try{e.PAssert(4683,g,"Drive items must have valid attachments")}catch(t){e.reportError(t)}f=g.id}}else h=p.getRoot(),f=this.getSetting(this.Settings.DriveRootId);this._upload(t,l,u,s.getPaneDoc(),f);try{e.PAssert(4684,!p.hasItem(l.id),"When uploading a new file, should never have duplicated items")}catch(t){e.reportError(t)}var v=p.createItem(l.id,this.getAttachmentEmbedString(l),h.id);h.insertSorted(v,this.sortFn)}},notifyDropFrom:function(t,i){try{e.PAssert(4685,t,"Must have a valid item that was dropped")}catch(t){e.reportError(t)}try{e.PAssert(4686,i,"Must have a valid pane the item was dropped on")}catch(t){e.reportError(t)}if(!e.isDemoMode()){var r=t.getAttachmentByPlugin(this.id),a=i.getPaneDoc();a.shareFile(r.id,function(t,i){t||(this.getSetting(this.Settings.WriteAccess)&&i.code===n.HTTPStatusCode.Unauthorized&&this.setSetting(this.Settings.WriteAccess,!1),a.isShared()&&e.toasts.pushMessage(MessageID.ShareFailure))}.bind(this)),this.sendEvent("AttachmentDropped")}},notifyDropFromToEdit:function(t,i){if(!e.isDemoMode())if(this.getSetting(this.Settings.WriteAccess)){var n=t.getAttachmentByPlugin(this.id);if(n){var r=document.createEvent("Event");r.item=t,r.initEvent("cdrop",!0,!0),i.dispatchEvent(r)}this.sendEvent("AttachmentDroppedEdit")}else e.toasts.pushMessage(MessageID.NeedDrivePermission)},handleTapStart:function(e,t,i,n){return!0},handleTapClick:function(t,n,r,a){var s=this.getCacheData(r);if(s){var o=this.getAttachment(r);if(this.isPluginPane(n)&&this.isFolder(s))e.vmMain.zoomin(t),this.sendEvent("Tap_FolderZoom");else if(i.mobile){var c=this.createDisplayElement(o).text;a.preventDefault(),e.preventClick(),e.menus.openMenuExternalApp(c,function(){s.alternateLink?e.openUrl(s.alternateLink,a):s.id?e.openUrl(this._createDriveURL(s.id,s.mimeType),a):e.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:MessageAction.Okay})}.bind(this)),this.sendEvent("Tap_OpenFileMobile")}else{var l;s.alternateLink?l=s.alternateLink:s.id?l=this._createDriveURL(s.id,s.mimeType):e.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:MessageAction.Okay}),l&&(i.mac&&a.metaKey||!i.mac&&a.ctrlKey||!this.isImage(o)||i.mobile?l&&(e.isDemoMode()?e.toasts.pushMessage(MessageID.DemoPluginClick):(e.openUrl(l,a),this.sendEvent("Tap_OpenFileDesktop"))):(l="https://drive.google.com/uc?export=view&id="+s.id,e.menus.openLightbox(l)))}return!0}return!1},createFolderURL:function(e){return"https://drive.google.com/drive/folders/"+e},_createDriveURL:function(e,t){var i="https://docs.google.com/";switch(t){case y.Folder:return i+"folderview?id="+e+"&usp=drivesdk";case y.Sheet:return i+"spreadsheets/d/"+e+"/edit?usp=drivesdk";case y.Document:return i+"document/d/"+e+"/edit?usp=drivesdk";case y.Slide:return i+"presentation/d/"+e+"/edit?usp=drivesdk";default:return i+"file/d/"+e+"/edit?usp=drivesdk"}},compactCacheField:function(e,t){var i;switch(t){case"alternateLink":e[t]!==this._createDriveURL(e.id,e.mimeType)&&(i=e[t]);break;default:i=e[t]}return i},supportOfflineCache:function(){return!0},usesPreviewCache:function(){return!0},matchAttachment:function(e,t){return e.getField("titleLower").indexOf(t)>=0},getBlockedText:function(e){return"Go Premium to view Drive files"},onDocumentShared:function(t){this.getSetting(this.Settings.WriteAccess)?t&&this._ensureAttachmentsAreShared():this.numActiveAttachments()>0&&e.toasts.pushMessage(MessageID.NoSharingWarning)},_ensureAttachmentsAreShared:function(){var t=e.vmMain.docManager.getOpenDoc();this.forEachActiveAttachment(function(e){t.shareFile(e.id,function(e){})}.bind(this))},notifyAttachmentUnused:function(t,i){if(this._super.notifyAttachmentUnused.call(this,t,i),!e.isDemoMode()){e.vmMain.docManager.getOpenDoc().unshareFile(t.id,function(e){})}},_upload:function(t,i,n,r,a){t.size>20971520?(e.toasts.pushMessage(MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var s=new FileReader;s.readAsBinaryString(t),s.onload=function(o){var c=t.type||y.Unknown,l=function(e){var r={title:t.name,mimeType:c,parents:a?[{id:a}]:[]};n&&e&&r.parents.push({id:e});var o=btoa(s.result),l=P+"Content-Type: application/json\r\n\r\n"+JSON.stringify(r)+P+"Content-Type: "+c+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+o+"\r\n---------314159265358979323846--",d=gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+C+'"'},body:l}),h=function(e){this.changeID(i,i.id,e.id),this._addRemoteEntry(e)}.bind(this);d.execute(h)}.bind(this);if(n){try{e.PAssert(4687,r,"Must supply a valid paneDoc if sharing a file")}catch(t){e.reportError(t)}r.getDocumentFolder(function(e){l(e)})}else l()}.bind(this)},scheduleFile:function(t,i){m.beginAction();var a=t.getAttachmentByPlugin(this.id);try{e.PAssert(4688,a,"Must be able to get a valid attachment from item")}catch(t){e.reportError(t)}var s=n.MSPerHour,o=e.vmMain.getDefaultCalendarPlugin();if(o){var c=o.getDefaultExportCalendarID();if(c&&(e.isDemoMode()||o.getSetting(o.Settings.WriteAccess))){var l=a.getField("title"),d=this._createDriveURL(a.id,a.getField("mimeType"));o.createEventForEmail(c,l,d,i,s,function(t,i,n,a){t||i?i||e.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:MessageAction.Okay}):e.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){r.overQuota?e.toasts.pushMessage({text:"You are offline and tour computer's storage quota has been exceeded. Please free up space on your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay}):e.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay})}})})}else e.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:MessageAction.OpenCalendarSettings})}else e.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:MessageAction.OpenSettings});m.endAction()},findMatchExact:function(e){},findMatchLike:function(e,t){var i=e.toLowerCase(),n=this.findCachedItemsByFn(function(e){return e.titleLower.indexOf(i)>=0},t);return n.sort(function(e,t){return e.modifiedDate&&t.modifiedDate?Date.compare(e.modifiedDate,t.modifiedDate):e.modifiedDate?-1:t.modifiedDate?1:e.titleLower.localeCompare(t.titleLower)}),n},previewTemplate:function(){},getItemText:function(e){return this.getAttachmentEmbedString(e)},getItemTextLength:function(e){return 1},autocompleteWidth:function(){return 350}};return t.inherit(u,v),t.extend(v.prototype,T),v}),define("plugins/Plugin_Mailbird",["globals","util","platform","goog","VMPlugin","DragDrop"],function(e,t,i,n,r,a){function s(){if(this._isBuiltin=!0,this._super.constructor.call(this,PluginID.Mailbird,"Mailbird"),this.autocompleteReplace=!0,this.declareProperty("subject",PluginLoad.Preview|PluginLoad.Full,!1,""),this.declareProperty("from",PluginLoad.Preview|PluginLoad.Full,!1,""),this.declareProperty("date",PluginLoad.Preview|PluginLoad.Full,!0,new Date),this.declareProperty("subjectLower",PluginLoad.Runtime,!1,""),this.declareProperty("fromLower",PluginLoad.Runtime,!1,""),this.declareProperty("unread",PluginLoad.Runtime,!0,!1),this.declareProperty("snippet",PluginLoad.Runtime,!0,""),this.declareProperty("count",PluginLoad.Runtime,!0,1),this.declareProperty("latestMessageAt",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("provider",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("threadID",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("hasAttachments",PluginLoad.Full,!0,!1),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread),this.isMailbirdEmbed=i.embed===EmbedApps.Mailbird,this.isMailbirdEmbed){this.setSetting(this.Settings.IsEnabled,!0),e.nativeBridge.registerEmbedBridge(this);var t=e.nativeBridge.registerInboundAPI("mailbird");try{e.PAssert(4689,t,"Error creating native inbound API for mailbird")}catch(t){e.reportError(t)}t&&(t.registerVariable("_prevX"),t.registerVariable("_prevY"),t.registerFunction("dragOver",c.dragOver,!0),t.registerFunction("drop",c.drop,!0),t.registerFunction("dragLeave",c.dragLeave,!0),t.registerFunction("reportError",c.reportError,!0)),this._mailbirdOutAPI=e.nativeBridge.registerOutboundAPI("mailbird");try{e.PAssert(4690,this._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(t){e.reportError(t)}this._mailbirdOutAPI&&(this._mailbirdOutAPI.requireFunction("selectConversation"),this._mailbirdOutAPI.requireFunction("selectConversationEx",!0),this._mailbirdOutAPI.requireFunction("scheduleNotifications",!0))}}var o={Gmail:"Gmail"},c={dragOver:function(t){var i=e.elementFromPoint(t.x,t.y);if(i){var n=void 0!==this._prevX?t.x-this._prevX:0,r=void 0!==this._prevY?t.y-this._prevY:0;this._prevX=t.x,this._prevY=t.y;var s={clientX:t.x,clientY:t.y,diffX:n,diffY:r,target:i,dataTransfer:{}};a.handleDragOver(s)}},drop:function(t){var i=e.elementFromPoint(t.x,t.y),n={clientX:t.x,clientY:t.y,target:i,dataTransfer:{getData:function(e){if("mailbird/email"===e){var i={subject:t.subject||"",from:t.from||"",id:t.mailMessageId?t.mailMessageId:"mailbird_"+t.id,latestMessageAt:t.latestMessageAt};return t.gmailID&&(i.provider="Gmail",i.threadID=t.gmailID),i}}},preventDefault:e.emptyFn,stopPropagation:e.emptyFn};setTimeout(function(){a.handleDrop(n)},0)},dragLeave:function(){a.handleDragLeave({target:document.getElementById("container")})},reportError:function(t){e.reportError(new Error(t))}},l={getPaneIcon:function(){return"icon-envelope"},useItemStore:function(){return"Mailbird"},_addRemoteEntry:function(e){var t={id:e.id,provider:e.provider,threadID:e.threadID,subject:e.subject,subjectLower:e.subject.toLowerCase(),from:e.from,fromLower:e.from.toLowerCase(),latestMessageAt:e.latestMessageAt};return this.cacheData(t.id,t),t},createEntryFromLocal:function(e,t){return t.subjectLower=t.subject.toLowerCase(),t.fromLower=t.from.toLowerCase(),t},getAttachmentClass:function(e){return["plugin_mailbird"]},isPluginBlocked:function(){return!1},handleEmbedMessage:function(t,i){switch(t){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var n=JSON.stringify(i);this._mailbirdOutAPI.call("scheduleNotifications",n)}catch(t){e.reportError(t)}break;default:try{e.PAssert(4691,!1,"Unknown embed message: "+t)}catch(t){e.reportError(t)}}},handleDropEvent:function(t,i){try{e.PAssert(4692,i,"Must provide a valid callback to the drop event")}catch(t){e.reportError(t)}if(t.dataTransfer){var n=t.dataTransfer.getData("mailbird/email");if(n){var r=this._addRemoteEntry(n);i(this._getTextForItem(r));var a=this.getAttachment(r.id);try{e.PAssert(4693,a.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(t){e.reportError(t)}return this.writeAttachmentToPreviewCache(a),!0}}return!1},handleTapStart:function(e,t,i,n){return!0},handleTapClick:function(t,i,n,r){var a=this.getCacheData(n);if(a){if(this.isMailbirdEmbed){var s,c=a.id.startsWith("mailbird_");if(!c&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var l=null;if("Gmail"===a.provider){try{e.PAssert(4694,a.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(t){e.reportError(t)}l=parseInt(a.threadID)}var n=a.id;s=this._mailbirdOutAPI.call("selectConversationEx",l,n,a.latestMessageAt)}else{var n=a.id.replace("mailbird_","");s=this._mailbirdOutAPI.call("selectConversation",n)}try{e.PAssert(4695,void 0!==s,"Must always receive a value back from Mailbird")}catch(t){e.reportError(t)}if(!0===s||!1===s)try{e.PAssert(4696,s,"Must have successfully selected the email conversation in Mailbird: ",a.id,a.provider)}catch(t){e.reportError(t)}else{try{e.PAssert(4697,s&&s.then,"Must have a valid promise object returned")}catch(t){e.reportError(t)}s.then(function(t){try{e.PAssert(4698,t,"Must have successfully selected the email conversation in Mailbird: ",a.id,a.provider)}catch(t){e.reportError(t)}},function(t){try{e.PAssert(4699,!1,"Failed to successfully select the email conversation in Mailbird: ",a.id,a.provider)}catch(t){e.reportError(t)}})}}else switch(a.provider){case o.Gmail:e.openUrl("https://mail.google.com/mail/u/0/#inbox/"+a.threadID);break;default:e.toasts.pushMessage(MessageID.MailbirdClick)}return!0}return!1},getDisplayTags:function(e){return[]},getDisplayParticipants:function(e){return""},matchAttachment:function(e,t){return e.getField("fromLower").indexOf(t)>=0||e.getField("subjectLower").indexOf(t)>=0},findMatchExact:function(e){},findMatchLike:function(e,t){var i=e.toLowerCase();return this.findCachedItemsByFn(function(e){return e.subjectLower.indexOf(i)>=0||e.fromLower.indexOf(i)>=0},t)},supportOfflineCache:function(){return!0},usesPreviewCache:function(){return!0},previewTemplate:function(){},getItemText:function(e){return this.getAttachmentEmbedString(e)},getItemTextLength:function(e){return 1},autocompleteWidth:function(){return 450},getAutocompletePrefixes:function(){return["m:","mailbird:"]}};return t.inherit(r,s),t.extend(s.prototype,l),s}),define("UndoStack",["require","globals"],function(e){function t(e){this._maxSize=e,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}var i=e("globals");return t.prototype={registerOwner:function(e,t){try{i.PAssert(4700,e,"Must supply a valid owner object")}catch(e){i.reportError(e)}try{i.PAssert(4701,!this._registeredOwners[t],"Must not double define an owner")}catch(e){i.reportError(e)}this._registeredOwners[t]=e,this._registeredActions[t]={}},registerAction:function(e,t,n){try{i.PAssert(4702,e,"Must provide a valid owner")}catch(e){i.reportError(e)}try{i.PAssert(4703,t,"Must provide a valid action ID")}catch(e){i.reportError(e)}try{i.PAssert(4704,this._registeredOwners[e],"Must have already registered a valid owner")}catch(e){i.reportError(e)}try{i.PAssert(4705,!this._registeredActions[e][t],"Must not double define an action for an owner")}catch(e){i.reportError(e)}try{i.PAssert(4706,n,"Must pass in a valid undo/redo descriptor")}catch(e){i.reportError(e)}try{i.PAssert(4707,i.isFunction(n.undo),"Must provide a valid undo fn")}catch(e){i.reportError(e)}try{i.PAssert(4708,i.isFunction(n.redo),"Must provide a valid redo fn")}catch(e){i.reportError(e)}this._registeredActions[e][t]=n},_getOwner:function(e){try{i.PAssert(4709,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(e){i.reportError(e)}return this._registeredOwners[e.ownerID]},_getActionData:function(e){try{i.PAssert(4710,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(e){i.reportError(e)}try{i.PAssert(4711,this._registeredActions[e.ownerID][e.actionID],"Must have previously registered action for owner")}catch(e){i.reportError(e)}return this._registeredActions[e.ownerID][e.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(e){return{id:this._useNextGroupID(),events:e||[]}},_pushNewGroup:function(e){var t=this._createGroup(e);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(t),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(e){if(0===this._aggregateActions){try{i.PAssert(4712,0===this._currentAction.length,"Current actions should be flushed")}catch(e){i.reportError(e)}this._actionsPreventUndo=!!e}this._aggregateActions++},runAction:function(e,t,i){var n={ownerID:e,actionID:t},r=this._getOwner(n);return this._getActionData(n).redo.apply(r,i)},performAction:function(e,t,n){try{i.PAssert(4713,this._aggregateActions>0,"Must be in a begin/end action block")}catch(e){i.reportError(e)}try{i.PAssert(4714,n,"Must provide valid data for the action")}catch(e){i.reportError(e)}this._currentAction.push({ownerID:e,actionID:t,data:n})},performActions:function(e){if(e&&e.length>0){this.beginAction();for(var t=0;t<e.length;++t){var i=e[t];this.performAction(i.ownerID,i.actionID,i.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var e=this._groups[this._cursor--],t=e.events.length-1;t>=0;t--){var i=e.events[t],n=this._getOwner(i),r=this._getActionData(i);r.undo.apply(n,i.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var e=this._groups[++this._cursor],t=0;t<e.events.length;++t){var i=e.events[t],n=this._getOwner(i),r=this._getActionData(i);r.redo.apply(n,i.data.redoParams)}}},t}),define("GmailLabel",["require","exports","module","globals","Constants"],function(e,t,i){function n(e,t,i,n,s,o){try{
r.PAssert(4715,e,"Must specify a valid account ID")}catch(e){r.reportError(e)}try{r.PAssert(4716,t,"Must specify a valid label ID")}catch(e){r.reportError(e)}try{r.PAssert(4718,!n||r.isDateValid(n),"Must provide a valid oldestSync date")}catch(e){r.reportError(e)}try{r.PAssert(4719,o,"Must supply a valid label store this label belongs to")}catch(e){r.reportError(e)}this._labelStore=o,this._accountID=e,this._labelID=t,this._fullName=i,this._minName=void 0,this._matchName=i?i.toUpperCase():void 0,this._oldestSync=n,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!s||!s.isDeleted),this._labelListVisibility=s&&s.labelListVisibility?s.labelListVisibility:a.LabelListVisibility.Show,this._messageListVisibility=s&&s.messageListVisibility?s.messageListVisibility:a.MessageListVisibility.Show,this._origLabelID=void 0}var r=e("globals"),a=e("Constants"),s={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},o={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},c={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},l={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},d={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0};return n.prototype={_getDisplayPriority:function(){return o[this.getLabelID()]||-1},displayCompare:function(e){var t=this.isSystemOrSpecialLabel(),i=e.isSystemOrSpecialLabel();return t&&i?this._getDisplayPriority()<e._getDisplayPriority()?1:-1:t?-1:i?1:this.getName().localeCompare(e.getName())},isDropTarget:function(){return!d[this.getLabelID()]},_getStoreLabel:function(e){var t,i=e.toUpperCase();for(var n in this._labelStore){var r=this._labelStore[n].getRawName();if(r&&r.toUpperCase()===i){t=this._labelStore[n];break}}return t},_computeAncestors:function(){try{r.PAssert(4720,this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors")}catch(e){r.reportError(e)}if(this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var e=this._fullName.split("/"),t="",i=0;i<e.length-1;++i){t+=e[i];var n=this._getStoreLabel(t);n&&n!==this&&this._ancestors.push(n),t+="/"}this._computeMinName()}try{r.PAssert(4721,this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")}catch(e){r.reportError(e)}},_computeMinName:function(){for(var e=this.getRawName(),t=0;t<this._ancestors.length;++t){var i=this._ancestors[t],n=i.getMinName()+"/",r=e.indexOf(n);e=e.substr(r+n.length)}this._minName=e},getAccountID:function(){return this._accountID},getLabelID:function(){return this._labelID},getRawName:function(){return this._fullName},getMinName:function(){return this._minName?this._minName:this._fullName},getMatchName:function(){return this._matchName},isMatched:function(e){try{r.PAssert(4722,r.isString(e),"Must pass in a valid string for label name")}catch(e){r.reportError(e)}var t=!1,i=this.getMatchName();return e&&i&&i.indexOf(e.toUpperCase())>=0&&(t=!0),t},isNamed:function(e){try{r.PAssert(4723,r.isString(e),"Must pass in a valid string for label name")}catch(e){r.reportError(e)}var t=!1,i=this.getMatchName();return e&&i&&i===e.toUpperCase()&&(t=!0),t},getName:function(e){var t;if(s[this.getLabelID()])t=s[this.getLabelID()];else if(c[this.getLabelID()])t=c[this.getLabelID()];else if(e&&this._minName)t=this.getMinName();else if(this._fullName)t=this._fullName;else{try{r.PAssert(4724,!this.isLocalOnly(),"Should not have a local-only label without a name")}catch(e){r.reportError(e)}t=this.getLabelID()}return t||""},hasName:function(){return s[this.getLabelID()]||c[this.getLabelID()]||!!this._fullName},clearOldestSync:function(){this._oldestSync=void 0},getOldestSync:function(){return this._oldestSync},setOldestSync:function(e){try{r.PAssert(4725,r.isDateValid(e),"Must provide a valid oldestSync date")}catch(e){r.reportError(e)}this._oldestSync=e},getMessageListVisibility:function(){return this._messageListVisibility},getLabelListVisibility:function(){return this._labelListVisibility},isLocalOnly:function(){return r.isTempId(this.getLabelID())},updateLabelID:function(e){try{r.PAssert(4727,this.isLocalOnly(),"Should only ever modify local labels")}catch(e){r.reportError(e)}this._origLabelID=this.getLabelID(),this._labelID=e},updateLabelName:function(e){this._fullName=e,this._matchName=e.toUpperCase(),this._computeAncestors()},getSaveData:function(){return{id:this.getLabelID(),name:this._fullName,oldestSync:this.getOldestSync(),messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted}},getDisplayText:function(e){var t;return this.getName()&&(t=this.getName().startsWith("Moo.do/")?this.getName().substr("Moo.do".length+1):this.getName(e)),t},getOutlineText:function(){var e=this.getDisplayText();return e?e.replace(/ /g,"_"):void 0},matchesText:function(e){return this.getDisplayText().toLowerCase().indexOf(e)>=0},hasAncestors:function(){return!!this._fullName&&this.getAncestors().length>0},getAncestors:function(){return this._computeAncestors(),this._ancestors},getParent:function(){var e=this.getAncestors();return e[e.length-1]},isSystemLabel:function(){return!!s[this.getLabelID()]},isSpecialLabel:function(){return!!c[this.getLabelID()]},isSystemOrSpecialLabel:function(){return this.isSystemLabel()||this.isSpecialLabel()},isCategoryLabel:function(){return!!l[this.getLabelID()]},isArchived:function(){return"Archived"===this.getName()},isStarred:function(){return"Starred"===this.getName()},isInbox:function(){return"Inbox"===this.getName()},isDraft:function(){return"Draft"===this.getName()},isTrash:function(){return"Trash"===this.getName()},isCustom:function(){return!this.isSystemLabel()&&!this.isSpecialLabel()},getUnreadCount:function(){return this._numUnread},shouldDisplayInLabelList:function(){var e=!1;return this._isDeleted||(this.getLabelListVisibility()===a.LabelListVisibility.Show?e=!0:this.getLabelListVisibility()===a.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0&&(e=!0)),e},shouldDisplayInMessageList:function(){return this._messageListVisibility===a.MessageListVisibility.Show},delete:function(){try{r.PAssert(4728,!this.isSystemOrSpecialLabel(),"Should never delete a special or system label")}catch(e){r.reportError(e)}this._isDeleted=!0}},n}),define("RFC822Message",["require","exports","module","globals","EmailHTML"],function(e,t,i){function n(e){this._plugin=e,this._headers=[],this._mimeTree=void 0}var r=e("globals"),a=e("EmailHTML"),s=0;return n.prototype={reset:function(){this._headers=[],this._mimeTree=void 0},getMessageText:function(e,t){return e.decoded},updateFromDraft:function(e,t,i,n,s,o){this.reset(),this.addHeader("From",this._plugin._formatAddressText(i,n,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(t.to,!0)),t.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(t.cc,!0)),t.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(t.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",r.encodeMIMEHeader(t.subject||"(no subject)"));var c;if(t.inReplyTo){this.addHeader("In-Reply-To",t.inReplyTo.trim());var l=e.messages.indexOfWithProperty("messageID",t.inReplyTo);try{r.PAssert(4729,l>=0,"Must always be able to find the message being replied to")}catch(e){r.reportError(e)}c=e.messages[l]}var d;t.references?d=t.references:c&&(d=(r.isTempId(c.messageID)?"":c.messageID)+(c.references?" "+c.references:"")),d&&this.addHeader("References",d.trim());var h,u=a.generatePlaintext(this.getMessageText(t,s),{}),p=this._getAttachedResources(t);if(p.length>0&&(h=this.createMimePart("multipart/mixed"),this.addMimePart(h)),u){var m=this.createMimePart("multipart/alternative");this.addMimePart(m,h);var f=this.createMimePart("text/plain",u,"7bit");this.addMimePart(f,m);var g=this._getInlineResources(t);if(g.length>0){var v=this.createMimePart("multipart/related");this.addMimePart(v,m);var y=this.createMimePart("text/html",this.getMessageText(t,s),"7bit");this.addMimePart(y,v);for(var b=0;b<g.length;++b){var S=g[b],E=this.createResourcePart(S);E&&this.addMimePart(E,v)}}else{var y=this.createMimePart("text/html",this.getMessageText(t,s),"7bit");this.addMimePart(y,m)}}else{var m=this.createMimePart(t.contentType||"text/html",this.getMessageText(t,s),"7bit");this.addMimePart(m,h)}if(h&&s)for(var C=0,P=function(){if(++C===p.length){for(var e=0;e<p.length;++e){var t=p[e],i=this.createResourcePart(t);i&&this.addMimePart(i,h)}o()}}.bind(this),b=0;b<p.length;++b)this._plugin.loadResource(e.id,t.id,p[b].cid,P);else setTimeout(o,0)},_getInlineResources:function(e){var t=[];return e.resources.forEachResource(function(e){"inline"===e.disposition&&t.push(e)}),t},_getAttachedResources:function(e){var t=[];return e.resources.forEachResource(function(e){"attachment"===e.disposition&&e.id&&t.push(e)}),t},addHeader:function(e,t){try{r.PAssert(4730,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(e){r.reportError(e)}var i=t.trim().replace(/[\r\n]/g,"");this._headers.push(e+": "+i)},_generateBoundary:function(){return"=========3141592653589moodo"+Date.now()+ ++s},createMimePart:function(e,t,i,n){try{r.PAssert(4731,e,"Must supply a valid content type")}catch(e){r.reportError(e)}try{r.PAssert(4732,void 0===t||i,"Must supply a valid content encoding")}catch(e){r.reportError(e)}return{boundary:this._generateBoundary(),contentType:e,content:t,contentEncoding:i,contentDisposition:n,children:[]}},createResourcePart:function(e){try{r.PAssert(4733,e&&e.data,"Must have valid data loaded for resource to embed it in message")}catch(e){r.reportError(e)}var t;if(e&&e.data){var i=e.mimeType+'; name="'+e.cid+'"',n=e.disposition+'; filename="'+e.cid+'"';t=this.createMimePart(i,e.data,e.contentEncoding,n),t.contentID=e.cid}return t},addMimePart:function(e,t){try{r.PAssert(4734,e,"Must supply a valid mime part")}catch(e){r.reportError(e)}if(t)t.children.push(e);else{try{r.PAssert(4735,!this._mimeTree,"Must not yet have a valid mime tree root")}catch(e){r.reportError(e)}this._mimeTree=e}},_mimePartToBlob:function(e){function t(e,t){if(t){try{r.PAssert(4736,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(e){r.reportError(e)}var i=t.trim().replace(/[\r\n]/g,"");n.push(e+": "+i)}}var i="\r\n",n=[],a=e.contentType;if(e.content||(a+='; boundary="'+e.boundary+'"'),t("MIME-Version","1.0"),t("Content-Type",a),t("Content-Transfer-Encoding",e.contentEncoding),t("Content-Disposition",e.contentDisposition),e.contentID){t("Content-ID","<"+e.contentID+">")}if(i=n.join("\r\n").trim(),i+="\r\n",e.content)i+="\r\n"+e.content+"\r\n";else if(e.children&&e.children.length>0){for(var s=0;s<e.children.length;++s)i+="\r\n--"+e.boundary+"\r\n",i+=this._mimePartToBlob(e.children[s]);i+="--"+e.boundary+"--\r\n"}else i+="\r\n(no text)\r\n";return i},generateBlob:function(){var e=this._headers.join("\r\n").trim();return e+="\r\n"+this._mimePartToBlob(this._mimeTree)}},n}),define("plugins/Plugin_Gmail_Pane",["require","globals","data","Constants","platform","util","tracker","Observable","Dispatcher","Measure","International","DuchessHelpers","AccountManager","MobileUI","EmailPreview","Autocomplete","Multiselect","VMPane"],function(e){function t(e){this.isInitializing=!0,this.plugin=i.vmMain.pluginManager.getPlugin(PluginID.Gmail),this._lines=[{text:" ",start:0,length:1,width:0}],this.searchFilters=[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:this._remoteFnEmailUnread.bind(this),matchFn:this._matchFnEmailUnread.bind(this)},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:this._remoteFnStarred.bind(this),matchFn:this._matchFnStarred.bind(this)},{name:"priority",remoteStringFn:this._remoteFnPriority.bind(this),matchFn:this._matchFnPriority.bind(this)},{name:"category",remoteStringFn:this._remoteFnCategory.bind(this),matchFn:this._matchFnCategory.bind(this)}],this.type=this.plugin._paneType,this.paneClass="panePlugin paneGmail",this.contextMenuMode=n.ContextMenuMode.Gmail,this.paneEmptyMessage="No emails here",this.paneEmptySearchMessageDefault="Press enter to search",this.paneEmptySearchMessage=this.paneEmptySearchMessageDefault,this.titleContextMenuHeader="Open label",this.overviewEmptyMessage="No labels",this.dropEffect=function(){return n.DropEffect.Copy},this.isWriteable=!1,this.overrideCopyBehavior=!1,this.supportCollapsing=!1,this.supportCompleting=!0,this.supportOffline=!1,this.supportPerformArchive=!1,this.supportDataRefresh=!0,this.supportReportError=!0,this.supportCompose=!0,this.supportPagination=!0,this.supportBullets=!1,this.supportVertLines=!1,this.supportSearchItemAutocomplete=!1,this.supportSearchListenTextChanges=!1,this.supportSearchFlat=!1,this.supportLocalSearch=!1,this.supportClone=!1,this.supportDeferredItemLoad=!0,this.supportCellTransition=!1,this.useLineCache=!1,this.shouldSearchMatchParents=!1,this.noOverviewStyle=!0,this.supportStarClick=!0,this.supportClickOverviewScroll=!1,this.shouldUpdateOnTextChanged=!1,this.overviewTracksScroll=!1,this.overviewHasPaneItems=!1,this.overviewPadLevels=-1,this.maxWidth=n.ExpandedPaneWidth,this._topBoxHeight=0,this._super.constructor.call(this,e),this.dragMarginTop=25,this.blocks=[],this.blocksByKey={},this._focusedTrash=!1,this.shouldCheckHeight=!0,this.maxScrollOffset=0,this.selectedIndex=new s(-1,this.onSelectedIndexChanged.bind(this)),this._isSearchingRemote=new s(!1),this._currentSearch=void 0,this._ignoreRestoreScroll=!0,this._failedPageRequest=new s(!1),this.sortType=new s(e.sortType||n.GmailSortType.TimeReceived),this.item.listen(this._onItemChange.bind(this)),this.sortType.listen(this._onSortChange.bind(this)),a.forceBind("onScroll",this),a.forceBind("_runRemoteSearch",this),a.forceBind("searchCompare",this),a.forceBind("onTopTextChanged",this),a.forceBind("headerSearchCompare",this),a.forceBind("onMultiselectReset",this),this.initGmail(),!r.mobile&&e.isExpanded?(p.startOpenOnLoad(this),this._firstSelectedItem=e.selectedItem,this._needsSelectFirst=!0):(this._firstSelectedItem=void 0,this._needsSelectFirst=!1),this.isInitializing=void 0}var i=e("globals"),n=(e("data"),e("Constants")),r=e("platform"),a=e("util"),s=(e("tracker"),e("Observable")),o=e("Dispatcher"),c=e("Measure"),l=e("International"),d=e("DuchessHelpers"),h=e("AccountManager"),u=e("MobileUI"),p=e("EmailPreview"),m=e("Autocomplete"),f=e("Multiselect"),g=e("VMPane"),v={initGmail:function(){f.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._onItemChange(this.getItem()),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),o.listen("EmailCompose","onClosed",a.forceBind("onEmailComposeClosed",this)),o.listen("EmailPreview","onClosed",a.forceBind("onEmailPreviewClosed",this))},destroy:function(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),o.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),o.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),f.unlisten("reset",this.onMultiselectReset),this._super.destroy.call(this)},onLoad:function(e){this._super.onLoad.call(this,e),this.addScrollListener(this.onScroll)},notifyPluginLoaded:function(){var e=this.deferredItemState;if(e){var t=this.getItemStore().getItem(e.itemID);t&&this.setItem(t,!0)}},getItemStore:function(){return this.plugin.getActiveItemStore(this.id)},getRootItem:function(){var e=this.getItemStore();return e?e.getRoot():void 0},getDefaultDisplayItem:function(){return this.plugin.getDefaultDisplayItem()},searchCompare:function(e){var t=!1;return i.vmMain.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0):this.search.isMatched(e,!1)&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0),t},runItemSearch:function(e){try{i.PAssert(4737,e,"Must supply a valid param set for local item search")}catch(e){i.reportError(e)}try{i.PAssert(4738,e.item,"Gmail pane always expects a valid item when running local item search")}catch(e){i.reportError(e)}return e.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(e):this._super.runItemSearch.call(this,e)},getItemSearchParams:function(){var e=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=e&&e.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}},headerSearchCompare:function(e){if(this.plugin.isLabelItem(e)){var t=this.plugin.getLabelForVMLI(e);return!t||t.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(e)},getHeaderSearchParams:function(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?0:NaN,overview:!0,pane:this}},saveSelection:function(){return f.getSelectedItems(this)},restoreSelection:function(e){if(e.length>0){for(var t=[],i=0;i<e.length;i++){var n=this.indexOfItem(e[i]);n>=0&&t.push(n)}if(t.length>1)this.selectedIndex.set(t[0],!1),f.setSelected(t,this);else if(1===t.length)this.selectIndex(t[0]);else{var n=this.selectedIndex.get();n>=this.numItems()&&(n=this.numItems()-1),this.selectIndex(n,!0)}}},setItems:function(e,t){if(!e.equals(this._allItems)||this._prevSortType!==this.sortType.get()){var i,r=this.saveSelection(),a=[],s={},o=this.sortType.get()===n.GmailSortType.TimeReceived?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn;this._allItems=e,this._prevSortType=this.sortType.get();for(var c=0;c<this._allItems.length;++c){var l=this._allItems[c],d=this.plugin._getThreadIDFromItem(l);d&&!s[d]&&(a.insertSorted(l,o),this._needsSelectFirst&&l.id===this._firstSelectedItem&&(i=l),s[d]=!0)}if(this.items.set(a),this.restoreSelection(r),this._needsSelectFirst&&e.length>0){if(this._firstSelectedItem){var h=Math.max(this.indexOfItem(i),0);this.selectIndex(h),requestAnimationFrame(function(){this.setScrollOffset(this.getScrollTop(),ScrollDuration.Snap)}.bind(this))}else this.selectIndex(0);this._needsSelectFirst=!1}}},setHeaders:function(e,t){this._allHeaders=e;for(var n,r=[],a={},s={},o=0;o<this._allHeaders.length;++o){var c=this._allHeaders[o],n=this.plugin._getAccountIDFromItem(c);if(a[n]||(a[n]=[]),this.plugin.isAccountItem(c))s[n]=c;else{var l=a[n];this.plugin.isDisplayHeader(c)&&l.insertSorted(c,this.plugin.labelVMLISortFn)}}var d=0;for(var n in a)if(a.hasOwnProperty(n)){var h=a[n];d>0&&r.push({type:"hr",id:"hr"+n+"x",sizeInPane:this.heightOverviewHR}),d++;var u=s[n];try{i.PAssert(4739,u,"Must have valid account item")}catch(e){i.reportError(e)}if(u){r.push(u);for(var o=0;o<h.length;++o){if(o>0){var p=this.plugin.getLabelForVMLI(h[o-1]),m=this.plugin.getLabelForVMLI(h[o]);(p.isSystemOrSpecialLabel()&&!m.isSystemOrSpecialLabel()||!p.isCategoryLabel()&&m.isCategoryLabel())&&r.push({type:"hr",id:"hr"+n+o,sizeInPane:this.heightOverviewHR})}r.push(h[o])}}}this.headers.set(r)},heightOverviewHR:function(){return 4},getTitleList:function(){if(this.getItem().isDescendantOf(this.getRootItem())){var e=this.plugin.getDescriptorForItem(this.getItem()),t=this.plugin.getVMLIForAccount(e.accountID);return t===this.getItem()?[this.getRootItem(),this.getItem(),"Everything"]:this.plugin.numSyncAccounts()>1?[this.getRootItem(),t,this.getItem()]:[this.getRootItem(),this.getItem()]}return[this.getItem()]},onClickTitle:function(e){this.plugin.isAccountItem(e)?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e)):e===this.getRootItem()?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(e)||(e=this.plugin.getDefaultDisplayItem()),this._super.onClickTitle.call(this,e)},onTopTextChanged:function(){this.topBoxHeight.set(this.paneTopText.get()?36:0)},searchACName:function(){},getPaneIcon:function(){return this.plugin.getPaneIcon()},requestDataPage:function(e){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(e,this.onDataPagedIn.bind(this))},dropEffectCopyBehavior:function(e,t){try{i.PAssert(4740,!e.belongsToSameItemStore(t),"Dropping onto a Gmail pane is not supported")}catch(e){i.reportError(e)}return this.plugin.createOutlinePaneItem(e,t)},refreshPaneData:function(){this.plugin.refreshCurrentView(this.id)},reportPaneError:function(){i.menus.openModal(Modals.ReportBug)},_onItemChange:function(e){f.reset(this),this._clearCurrentSearch();var t=this.plugin.getLabelForVMLI(e);this._focusedTrash=t&&t.isTrash(),e.hasPaginationToken()||this.plugin.handleItemChange(e,function(){this.isLoading.set(!1)}.bind(this)),!this.isInitializing&!r.mobile&&(this.numItems()>0?this.selectIndex(0):this._needsSelectFirst=!0)},_onSortChange:function(e){f.reset(this),this.plugin.handleSortChange(this.getItem(),e),setTimeout(function(){this.numItems()>0&&this.selectIndex(0)}.bind(this),0),i.vmMain.paneManager.updatePaneStateForPane(this),this.setScrollOffset(0)},getItemLabel:function(e){var t=e?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(t)},onDataPagedIn:function(e){e?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)},onScroll:function(){if(!this.isLoadingNewPage.get()&&!this.isSearched()){var e=this._infiniteList.getMaxScrollOffset();this.getScrollOffset()>=e&&this.requestDataPage(this.getItem())}},_matchFnEmailUnread:function(e,t){var i=this.plugin.isItemUnread(t);if(e)return i&&e>0||!i&&e<0?n.MatchState.Yes:n.MatchState.No},_matchFnStarred:function(e,t){var i=this.plugin.isItemStarred(t);if(e){return i&&e>0||!i&&e<0?n.MatchState.Yes:n.MatchState.No}},_matchFnPriority:function(e,t){return this.plugin.getItemPriority(t)>=e?n.MatchState.Yes:n.MatchState.No},_matchFnCategory:function(e,t){return e?this.plugin.itemHasLabel(t,e)?n.MatchState.Yes:n.MatchState.No:n.MatchState.Yes},_remoteFnEmailUnread:function(e){var t;switch(e){case-1:t="-in:trash -is:unread";break;case 1:t="-in:trash is:unread";break;default:t=""}return t},_remoteFnStarred:function(e){var t;switch(e){case-1:t="-is:starred";break;case 1:t="is:starred";break;default:t=""}return t},_remoteFnPriority:function(e){var t;switch(e){case VMLIFlag.P0:t="label:Moo.do/Priority High";break;case VMLIFlag.P1:t="label:Moo.do/Priority Medium";break;case VMLIFlag.P2:t="label:Moo.do/Priority Low";break;default:t=""}return t},_remoteFnCategory:function(e){return e?"category:"+e:""},handleStatusClick:function(){var e=this.plugin._getAccountIDFromItem(this.getItem());(h.getAccountError(e)&&h._hasLinkedAccount(e)||h.verifyLinkedTokenScopes(e,[GScope.GmailModify]).length>0)&&(h.isDefaultEmail(e)?i.menus.openSettings(n.SettingsSections.Plugins):i.menus.openSettings(n.SettingsSections.Linked))},_getLoadingMessage:function(){var e,t=this.plugin._getAccountIDFromItem(this.getItem());if(h.isAuthorized(t,GScope.GmailModify))e="Loading...";else{e=h.getAccountError(t)&&h._hasLinkedAccount(t)||h.verifyLinkedTokenScopes(t,[GScope.GmailModify]).length>0?"Error Authorizing. Click here to fix.":"Authorizing..."}return e},bottomListMessage:function(){var e;return this.getItem().hasPaginationToken()&&(e=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),e},_onRemoteDataLoaded:function(){},sizeOfItem:function(e,t,i){return"blockHeader"===e.type?40:i?this._super.sizeOfItem.call(this,e,t,i):i?c.lineItemHeight(e,this,1):n.EmailItemHeight},onClickItem:function(e,t,n){i.vmMain.activeInput.get()&&i.vmMain.activeInput.get().blur();var a=!0;if(r.mobile&&u.isInMultiselect()||(r.mac&&n.metaKey||!r.mac&&n.ctrlKey)&&f.getSelected(this).length>0)f.toggleSelected(e,this),a=!1;else if(n.shiftKey){var s=f.getFirstSelectedIndex(this),o=f.getLastSelectedIndex(this);e<s?s=e:e>o&&(o=e),f.selectInOrder(s,o,this),a=!1}else if(i.hasClass(n.target,"emailLabel")){var c=n.target.textContent,l=t.getAttachmentByPlugin(this.plugin.id),d=l.getField("accountID"),h=this.plugin._getLabelByName(d,c);try{i.PAssert(4741,h,"Must be able to get a valid label if clicking a valid label: ",c)}catch(e){i.reportError(e)}if(h){var p=this.plugin.getVMLIForLabel(d,h);i.vmMain.zoomin(p),a=!1}}else i.hasClass(n.target,"itemCheckbox")||this.selectIndex(e);a&&t.onClick(e,n)},onRightClickItem:function(e,t,i){(f.numSelectedInPane(this)<=1||!f.isSelected(e,this))&&this.selectIndex(e),this._super.onRightClickItem.call(this,e,t,i),i.preventDefault(),i.stopPropagation()},handleLeftSideTap:function(e,t){r.mobile?i.vmMain.pluginManager.handleTapClick(e,this,t):this.toggleStar(e)},handleRightSideTap:function(e,t){if(e&&e.hasPluginAttachment(this.plugin.id))if(r.mobile)i.vmMain.pluginManager.handleTapClick(e,this,t);else{var n=this.getItemLabel(!0),a=!n.isArchived();this.archiveItem(a,e),n.isInbox()||n.isArchived()||this.removeItemFromCurrentLabel(e);var s=this.selectedIndex.get();s>=this.numItems()&&(s=this.numItems()-1),this.selectIndex(s,!0),i.vmMain.redoLastMouseMove()}},onMultiselectReset:function(e){this===e&&this.selectedIndex.set(-1)},selectIndex:function(e,t){var n=this.selectedIndex.get();this.selectedIndex.set(e,t),e>=0?f.setSelected([e],this):f.reset(this),(t||n!==e)&&this.selectedIndex.notify(),this.isLoading.get()||i.vmMain.paneManager.updatePaneStateForPane(this)},selectItem:function(e,t){if(e){var i=this.indexOfItem(e);i>=0&&this.selectIndex(i,t)}else this.selectIndex(-1,t)},onSelectedIndexChanged:function(e){if(p.isOpenOnPane(this))if(e>=0){var t=this.itemAtIndex(e);this.openEmailByItem(t)}else e<0&&p.reset()},_runRemoteSearch:function(){if(i.vmMain.paneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var e=this.search.getRemoteValue(),t=this.plugin.getDescriptorForItem(this.item.get());if(t.labelID){var n=this.plugin._getLabelByID(t.accountID,t.labelID);n.isSpecialLabel()||n.isInbox()||!n.hasName()||(e+=" label:"+n.getName())}this._lastSearchValue=e,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var r="R~"+this.getActualPaneItem().id+"~"+i.generateTempId();log("Gmail Remote Search ItemID: ",r),this._currentSearch=this.plugin.runSearch(e,this.id,r,!0,function(e){if(!this._destroyed&&this._isSearchingRemote.get())switch(this.paneEmptySearchMessage=e===SearchResultStatus.Done?this.paneEmptySearchMessageDefault:"",this.isLoading.set(!1),e){case SearchResultStatus.Done:this.paneTopText.set(""),this.setScrollOffset(0);break;case SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{i.PAssert(4742,!1,"Invalid search state: ",e)}catch(e){i.reportError(e)}}}.bind(this))}},_clearCurrentSearch:function(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)},onSearchChanged:function(e){var t=this.search.getRemoteValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var i=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,i)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")},isSearchingRemote:function(){return this._isSearchingRemote.get()},isRemoteSearchActive:function(){return this.plugin.isRemoteSearchBucketActive(this.id)},onEmailComposeClosed:function(){var e=this.plugin,t=e.getDefaultAccount(),i=e._getLabelByID(t,e.SystemLabels.DRAFT),n=e.getVMLIForLabel(t,i);this.item.get()===n&&this.selectIndex(-1)},onEmailPreviewClosed:function(){r.mobile&&this.selectIndex(-1)},applyToSelection:function(e){var t=this.saveSelection();f.applyFnToSelected(e,this),this.restoreSelection(t)},_autocompletePopup:function(e,t,i){if(!e.elementDisplay){var n=f.getFirstSelectedIndex(this),r=this.elementAtIndex(n);e.elementDisplay=r}e.onSelected=function(n){this.plugin.beginAction(),e.item?t(e.item,n):f.applyFnToSelected(function(e){t(e,n)},this),i&&i(),this.plugin.endAction()}.bind(this),m.showPopup(e)},getPaddingForItem:function(e,t){return t?this._super.getPaddingForItem.call(this,e,t):24},getWidth:function(){return this.rect.get().width},getFirstSelectedItem:function(){return f.getFirstSelectedItem()},getFirstSelectedIndex:function(){return f.getFirstSelectedIndex()},moveItem:function(e,t,r){this.plugin.beginAction(),r||(e=e.clone(t,ChangeType.Local));var a=e.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4744,a,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}this.plugin.performAction(n.PluginAction.Gmail.Move,!1,a,e,t),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(n.PluginAction.Gmail.Archive,!1,a),this.plugin.attachmentHasLabel(a,"Moo.do/Handled")||this.plugin.performAction(n.PluginAction.Gmail.AddLabel,!1,a,"Moo.do/Handled"),this.plugin.endAction()},autocompleteSchedule:function(e,t){var i=this.selectedIndex.get();this._super.autocompleteSchedule.call(this,e,function(){i>=this.numItems()&&(i=this.numItems()-1),this.selectIndex(i,!0),t&&t()}.bind(this))},autocompleteSnooze:function(e,t,i){var n=this.selectedIndex.get();this._super.autocompleteSnooze.call(this,e,t,function(){n>=this.numItems()&&(n=this.numItems()-1),this.selectIndex(n,!0),i&&i()}.bind(this))},autocompleteMove:function(e,t){e=e||{};var i=this.selectedIndex.get();e.positionOffset={left:40},this._super.autocompleteMove.call(this,e,function(){i>=this.numItems()&&(i=this.numItems()-1),this.selectIndex(i,!0),t&&t()}.bind(this))},autocompleteCreateTask:function(){var e=this,t=this.selectedIndex.get();if(!isNaN(t)){var r=this.elementAtIndex(t),a=f.getSelectedItems(this);i.menus.openItemEditor({element:r,pane:this,selectIndex:0,addOnSave:!0,side:"bottom",children:a,positionOffset:{left:10},options:[{text:"Archive email",value:i.vmMain.pluginManager.getSetting(PluginID.Gmail,PluginSettingsID.Gmail.ArchiveOnOrganize),cb:function(){for(var t=0;t<a.length;t++){var i=a[t],r=i.getAttachmentByPlugin(e.plugin.id);e.plugin.performAction(n.PluginAction.Gmail.Archive,!1,r)}}}],beginSave:function(){i.vmMain.beginUpdateItems(),e.plugin.beginAction();for(var t=0;t<a.length;t++){var r=a[t],s=r.getAttachmentByPlugin(e.plugin.id);e.plugin.attachmentHasLabel(s,"Moo.do/Handled")||e.plugin.performAction(n.PluginAction.Gmail.AddLabel,!1,s,"Moo.do/Handled")}},endSave:function(t){e.plugin.endAction(),i.vmMain.commitUpdateItems()}})}},toggleStarSelected:function(){this._super.toggleStarSelected.call(this),this.updateItems()},toggleStar:function(e){var t=e.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4745,t,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}var r=t.getPlugin();r.isItemStarred(e)?r.performAction(n.PluginAction.Gmail.Unstar,!1,t):r.performAction(n.PluginAction.Gmail.Star,!1,t),this.updateItems()},_openSelectedInMode:function(e){var t=f.getFirstSelectedIndex(this);this.selectIndex(t);var i=this.itemAtIndex(t);this.openEmailByItem(i,e)},replySelected:function(){this._openSelectedInMode(n.EmailResponseMode.Reply)},replyAllSelected:function(){this._openSelectedInMode(n.EmailResponseMode.ReplyAll)},forwardSelected:function(){this._openSelectedInMode(n.EmailResponseMode.Forward)},archiveSelected:function(e){this.plugin.beginAction(),
this.applyToSelection(this.archiveItem.bind(this,e)),this.plugin.endAction()},archiveItem:function(e,t){var r=t.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4746,r,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}!e&&this.plugin.isItemArchived(t)?this.plugin.performAction(n.PluginAction.Gmail.Unarchive,!1,r):e&&!this.plugin.isItemArchived(t)&&this.plugin.performAction(n.PluginAction.Gmail.Archive,!1,r)},deleteSelected:function(e,t){this.plugin.beginAction(),this.applyToSelection(this._deleteItem.bind(this,t)),this.plugin.endAction()},_deleteItem:function(e,t){var r=t.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4747,r,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}var a=this.plugin.getLabelForVMLI(this.getItem());e&&a&&a.isDraft()&&this.plugin.itemHasDraft(t)?this.plugin.performAction(n.PluginAction.Gmail.DiscardDraft,!0,r):!e&&this.plugin.isItemFullTrashed(t)?this.plugin.performAction(n.PluginAction.Gmail.Untrash,!1,r):e&&!this.plugin.isItemFullTrashed(t)&&this.plugin.performAction(n.PluginAction.Gmail.Trash,!1,r)},applyPriorityToSelection:function(e,t){var r=e,a=!0;this.plugin.beginAction(),this.applyToSelection(function(s){var o=s.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4748,o,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}t&&a&&(this.plugin.getAttachmentPriority(o)===e&&(r=VMLIFlag.None),a=!1),this.plugin.performAction(n.PluginAction.Gmail.SetPriority,!1,o,r),this.updateItems()}.bind(this)),this.plugin.endAction()},handleUndo:function(){this.plugin.handleUndo()},handleRedo:function(){this.plugin.handleRedo()},keyMoveDown:function(e){var t;e&&e.shiftKey?(f.isInverted(this)&&1===f.numSelectedInPane(this)&&f.setInverted(!1,this),f.isInverted(this)?(t=f.getFirstSelectedIndex(this),f.removeSelected(t,this)):(t=this.indexOfNextVMLI(f.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(f.addSelected(t,this),this.scrollIndexIntoView(t,ScrollDuration.Default))):(t=this.indexOfNextVMLI(f.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(this.selectIndex(t),this.scrollIndexIntoView(t,ScrollDuration.Default))},keyMoveUp:function(e){var t;e&&e.shiftKey?(f.isInverted(this)||1!==f.numSelectedInPane(this)||f.setInverted(!0,this),f.isInverted(this)?(t=this.indexOfPrevVMLI(f.getFirstSelectedIndex(this)))>=0&&(f.addSelected(t,this),this.scrollIndexIntoView(t,ScrollDuration.Default)):(t=f.getLastSelectedIndex(this),f.removeSelected(t,this))):(t=this.indexOfPrevVMLI(f.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(t),this.scrollIndexIntoView(t,ScrollDuration.Default))},keydown:function(e){if(this.selectedIndex.get()>=0){var t=this.itemAtIndex(this.selectedIndex.get()),n=!e.metaKey&&!e.ctrlKey&&!e.altKey;if(t){var r=n;switch(e.normCode){case KeyCode.DownArrow:n&&this.keyMoveDown(e),e.preventDefault();break;case KeyCode.J:n&&this.keyMoveDown(e);break;case KeyCode.UpArrow:n&&this.keyMoveUp(e),e.preventDefault();break;case KeyCode.K:n&&this.keyMoveUp(e);break;case KeyCode.Enter:p.isOpenOnPane(this)||this.openEmailByItem(t);break;case KeyCode.Slash:case KeyCode.E:if(n){e.shiftKey&&p.isOpenOnPane(this)&&p.close();var a=this.getItemLabel(!0),s=!a.isArchived();this.archiveSelected(s)}break;case KeyCode.BackSpace:case KeyCode.Delete:this.deleteSelected(this.plugin.isGmailItem,!0);break;case KeyCode.C:n&&this.autocompleteSchedule();break;case KeyCode.D:n&&this.autocompleteSnooze();break;case KeyCode.M:case KeyCode.V:n&&this.autocompleteMove();break;case KeyCode.T:n&&this.autocompleteCreateTask();break;case KeyCode.L:this.autocompleteLabel({item:t});break;case KeyCode.I:n&&this.markReadSelected(!0);break;case KeyCode.U:n&&this.markReadSelected(!1);break;case KeyCode.D8:case KeyCode.S:n&&this.toggleStarSelected();break;case KeyCode.R:n&&(e.shiftKey?this.replyAllSelected():this.replySelected());break;case KeyCode.A:n&&this.replyAllSelected();break;case KeyCode.F:n&&this.forwardSelected();break;case KeyCode.D1:this.applyPriorityToSelection(VMLIFlag.P0,!0);break;case KeyCode.D2:this.applyPriorityToSelection(VMLIFlag.P1,!0);break;case KeyCode.D3:e.shiftKey?this.deleteSelected(this.plugin.isGmailItem,!0):this.applyPriorityToSelection(VMLIFlag.P2,!0);break;case KeyCode.Y:this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel.bind(this)),this.plugin.endAction());break;case KeyCode.Z:this.handleUndo();break;case KeyCode.P:if(1===f.numSelectedInPane(this)){var t=f.getFirstSelectedItem(this),o=this.plugin.createPrintURLForThread(t.getAttachmentByPlugin(this.plugin.id));i.printPage(o)}break;case KeyCode.G:if(1===f.numSelectedInPane(this)){var t=f.getFirstSelectedItem(this),c=this.plugin.createURLForThread(t.getAttachmentByPlugin(this.plugin.id));i.openUrl(c)}break;default:r=!1}r&&e.preventDefault()}}},removeItemFromCurrentLabel:function(e){var t=this.getItemLabel(!0);try{i.PAssert(4749,t,"Must be able to find a valid label for pane")}catch(e){i.reportError(e)}var r=e.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4750,r,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}t&&(t.isCustom()?this.plugin.performAction(n.PluginAction.Gmail.RemoveLabel,!1,r,t.getName()):t.isInbox()?this.plugin.performAction(n.PluginAction.Gmail.Archive,!1,r):t.isArchived()?this.plugin.performAction(n.PluginAction.Gmail.Unarchive,!1,r):t.isStarred()&&this.plugin.performAction(n.PluginAction.Gmail.Unstar,!1,r))},canAcceptDragOver:function(e,t,n,r){if(e&&this.type===e.type&&(r||e&&this!==e)){var a,s=e.getItemLabel();if(r){var o=i.getElementParent(n);a=o&&i.getItemForElement(o)}else a=this.getItem();if(a&&this.plugin.isLabelItem(a)&&this.plugin.areItemsFromSameAccount(t,a)){var c=this.plugin.getLabelForVMLI(a);if(c!==s&&c.isDropTarget())return!0}}return!1},_handleDragOverPane:function(e,t,i,n,r,a,s){return{targetElement:i,targetItem:this.getItem()}},_handleDragDrop:function(e,t,r,a){if(r){var s,o=t.pane,c=o.getItemLabel(),l=r.targetItem,d=this.plugin.getLabelForVMLI(l);if(e.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(e,l)){s=e.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4751,s,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}this.plugin.beginAction(),this.plugin.performAction(n.PluginAction.Gmail.RemoveLabel,!1,s,c.getName()),this.plugin.attachmentHasLabel(s,d.getName())||this.plugin.performAction(n.PluginAction.Gmail.AddLabel,!1,s,d.getName()),o.notifyDropFrom(e,this),this.plugin.endAction()}}},notifyDropFrom:function(e,t){if(this.selectIndex(-1),t.type===PaneMode.Outline){var r=e.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4752,r,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}this.plugin.attachmentHasLabel(r,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(n.PluginAction.Gmail.RemoveLabel,!1,r,"Inbox"),this.plugin.performAction(n.PluginAction.Gmail.AddLabel,!1,r,"Moo.do/Handled"),this.plugin.endAction());var a=this.plugin.getAttachmentPriority(r);a!==VMLIFlag.None&&e.priority(a,ChangeType.Local),this.plugin.attachmentHasLabelByID(r,"STARRED")&&e.isStarred(!0,ChangeType.Local)}},maxWidthOfItem:function(){return r.mobile?this.getWidth()-36:this.getWidth()-56},allowZoom:function(e){var t=!1;return this.plugin.isLabelItem(e)&&(t=!0),t},performOverviewAction:function(e){if(this.plugin.isAccountItem(e)){e.setCollapsed(!e.isCollapsed(this,!0),this,!0);var t=e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e));i.vmMain.zoomin(t),i.sendEvent("Menu","OverviewZoom_Gmail")}},setItem:function(e,t){return this.isLoading.set(!0),this.selectIndex(-1),this._super.setItem.call(this,e,t)},isItemHeader:function(e,t){if(!t)return e.isHeader();for(var i=this.plugin,n=e.getItems(),r=0;r<n.length;r++)if(i.isLabelItem(n[r])||i.isAccountItem(n[r]))return!0},getActualPaneItem:function(){return this.plugin._defaultZoomItems[this.id]||this.item.get()},canResetMultiselect:function(){return!p.isOpenOnPane(this)||0===this.numItems()},setExpanded:function(e,t){this._super.setExpanded.call(this,e,t),e||this===i.focusedPane||f.reset(this)},applyAgendaDropToItem:function(e,t){var r=e,a=t.getAttachmentByPlugin(this.plugin.id);try{i.PAssert(4753,a,"Must be able to get a valid attachment")}catch(e){i.reportError(e)}if(r.isDate){var s,o=r.dateTime||r.date;s=i.isString(o)?l.parseDate(o,n.DateFormat.MDY):o;try{i.PAssert(4754,i.isDateValid(s),"Must provide a valid date when scheduling an email",r.dateTime,r.date)}catch(e){i.reportError(e)}i.isDateValid(s)&&this.plugin.scheduleEmail(t,s)}else{var c;r.isStarred?this.plugin.performAction(n.PluginAction.Gmail.Star,!1,a):r.p0||r.isImportant?c=VMLIFlag.P0:r.p1?c=VMLIFlag.P1:r.p2&&(c=VMLIFlag.P2),c&&this.plugin.performAction(n.PluginAction.Gmail.SetPriority,!1,a,c)}},getSaveInfo:function(){var e=this._super.getSaveInfo.call(this);if(e.sortType=this.sortType.get(),!r.mobile){var t=f.getFirstSelectedItem(this);e.selectedItem=t?t.id:void 0}return e},setIgnoreRestoreScroll:function(){},getParentHeaders:function(){return[]},getSwipeMenuItems:function(){var e=this;return{leftOuter:{text:"Add to Outline",icon:"icon-align-left",color:"#09d",fn:function(t){e.autocompleteMove({item:t,position:"autocomplete"})}},leftInner:{text:"Snooze",icon:"icon-access_time",color:"#2a6",fn:function(t){e.autocompleteSnooze({item:t,position:"autocomplete"})}},rightInner:{text:"Archive",icon:"icon-check",color:"#0c0",fn:function(t){var i=e.getItemLabel(!0),n=!i.isArchived();e.archiveItem(n,t),i.isInbox()||i.isArchived()||e.removeItemFromCurrentLabel(t)}},rightOuter:{text:"Delete",icon:"icon-delete",color:"#a30",fn:function(t){e._deleteItem(!0,t)}}}},onTapAddItem:function(e){i.menus.openComposeEmail(i.vmMain.getDefaultEmailPlugin())},isOverviewVisibleInPane:function(){return!0},getMinItemSize:function(){return n.EmailItemHeight},widthOfDrag:function(e){return this.getWidth()},getStyledLinesForItem:function(e,t){return t?this._super.getStyledLinesForItem.call(this,e,t):(e.els||i.vmMain.runSingleParse(e,ChangeType.Auto),d.generateStyledLines(e.els,this._lines,this))}};return a.inherit(g,t),a.extend(t.prototype,v),t}),define("Aggregator",["require","exports","module","globals","util"],function(e,t,i){function n(e,t,i){try{r.PAssert(4755,r.isFunction(e),"Must provide a valid entry callback")}catch(e){r.reportError(e)}try{r.PAssert(4756,r.isFunction(t),"Must provide a valid done callback")}catch(e){r.reportError(e)}this._entryCB=e,this._doneCB=t,this._delay=i||s,this._flushTimeout=void 0,this._entries=[],a.forceBind("_onEntry",this),a.forceBind("_onDone",this),a.forceBind("_flushEntries",this),a.forceBind("_flushEntriesWatchdog",this)}var r=e("globals"),a=e("util"),s=5e3;return n.prototype={getEntryCB:function(){return this._onEntry},getDoneCB:function(){return this._onDone},_onEntry:function(e){e&&this._entries.push(e),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))},_onDone:function(e,t){r.vmMain.beginUpdateItems(),this._flushEntries();try{this._doneCB(e,t)}catch(e){r.reportError(e)}r.vmMain.commitUpdateItems()},_flushEntriesWatchdog:function(){},_flushEntries:function(){this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),r.vmMain.beginUpdateItems();for(var e=0;e<this._entries.length;++e)try{this._entryCB(this._entries[e])}catch(e){r.reportError(e)}this._entries=[],r.vmMain.commitUpdateItems()}},n}),define("DriveUploader",["require","exports","module","globals","Constants","goog","AccountManager"],function(e,t,i){function n(e,t,i,n,a){this.file=e,this.contentType=e.type,this.email=t,this.onComplete=n||r.emptyFn,this.onError=a||r.emptyFn,this.onProgress=i||r.emptyFn,this._callbacks=[],this.offset=0,this.chunkSize=1048576,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;var s={uploadType:"resumable"};this.url=this._buildURL(void 0,s),this._percent=0}var r=e("globals"),a=e("Constants"),s=e("goog"),o=e("AccountManager");return n.prototype={upload:function(){if(this._hasStarted=!0,r.isDemoMode())return void setTimeout(function(){this.onComplete()}.bind(this),2e3);if(o.isCurrentlyAuthorized("me")){var e=o.getDefaultAccessToken();if(e){var t={Authorization:"Bearer "+e,"Content-Type":"application/json","X-Upload-Content-Length":this.file.size,"X-Upload-Content-Type":this.contentType};s.getAttachFolder(function(e){var i,n={title:this.file.name,mimeType:this.contentType,parents:e?[{id:e}]:[]};try{i=JSON.stringify(n)}catch(e){r.reportError(e)}i?r.XHR({url:this.url,type:"POST",headers:t,data:i,autoRetry:!0,cb:function(e){if(e.status<a.HTTPStatusCode.BadRequest){var t=e.getResponseHeader("Location");this.url=t,this._runUpload()}else this._onError(e)}.bind(this)}):this._onError()}.bind(this))}}else this._onError()},_runUpload:function(){try{r.PAssert(4757,this.url,"Must have a valid remote URL to run upload")}catch(e){r.reportError(e)}this._isRunning=!0;var e=Math.min(this.offset+this.chunkSize,this.file.size),t=this.file.slice(this.offset,e),i={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(e-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};r.XHR({url:this.url,type:"PUT",headers:i,data:t,autoRetry:!0,cb:function(e){if(e.status===a.HTTPStatusCode.Success||e.status===a.HTTPStatusCode.Created)this.isCanceled()||this._onComplete(e);else if(e.status===a.HTTPStatusCode.PermRedirect){var t=this._extractRange(e.getResponseHeader("Range"));this.offset=t,this._onProgress(this.offset/this.file.size),this.isCanceled()||this._runUpload()}else this._onError(e)}.bind(this)})},resume:function(){try{r.PAssert(4758,!this.isDone(),"Should not resume a completed upload")}catch(e){r.reportError(e)}try{r.PAssert(4759,this._hasStarted,"Must have started an upload to resume it")}catch(e){r.reportError(e)}try{r.PAssert(4760,this.url,"Must have a valid remote URL to resume upload")}catch(e){r.reportError(e)}if(this._hasError=!1,this._isCanceled=!1,!this._isRunning)if(this._isRunning=!0,this._hasStarted&&this.url){var e={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};r.XHR({url:this.url,type:"PUT",headers:e,autoRetry:!0,cb:function(e){if(e.status===a.HTTPStatusCode.PermRedirect){var t=this._extractRange(e.getResponseHeader("Range"));this.offset=t,this._onProgress(this.offset/this.file.size),this._runUpload()}else this._onError(e)}.bind(this)})}else this.upload()},cancel:function(){try{r.PAssert(4761,!this._isDone,"Cannot cancel an upload that is already complete")}catch(e){r.reportError(e)}this._isCanceled=!0,this._isRunning=!1},_onError:function(e){this._hasError=!0,this._isRunning=!1,this.onError()},_onComplete:function(e){try{r.PAssert(4762,!this._isDone,"Should not call the complete CB twice")}catch(e){r.reportError(e)}try{r.PAssert(4763,!this._isCanceled,"Should not be able to complete a canceled upload")}catch(e){r.reportError(e)}this._isDone=!0,this._isRunning=!1;var t={};if(e&&e.response)try{t=JSON.parse(e.response)}catch(e){r.reportError(e)}this._onProgress(1),this.onComplete(t);for(var i=0;i<this._callbacks.length;++i)try{this._callbacks[i](t)}catch(e){r.reportError(e)}this._callbacks=[]},_onProgress:function(e){try{r.PAssert(4764,!this._hasError,"Should not make forward progress when an error has occurred")}catch(e){r.reportError(e)}this._percent=e,this.onProgress(e)},_extractRange:function(e){return r.parseInt(e.match(/\d+/g).pop())+1},_buildQueryString:function(e){return e=e||{},Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},_buildURL:function(e,t){var i="https://www.googleapis.com/upload/drive/v2/files/";e&&(i+=e);var n=this._buildQueryString(t);return n&&(i+="?"+n),i},notifyOnComplete:function(e){try{r.PAssert(4765,this._callbacks.indexOf(e)<0,"Should not include fn twice")}catch(e){r.reportError(e)}try{r.PAssert(4766,!this.isDone(),"Should not notify on complete after done")}catch(e){r.reportError(e)}try{r.PAssert(4767,!this.hasError(),"Should not notify on complete after error")}catch(e){r.reportError(e)}this._callbacks.push(e)},isCanceled:function(){return this._isCanceled},isDone:function(){return this._isDone},isRunning:function(){return this._isRunning},hasError:function(){return this._hasError},getPercent:function(){return this._percent}},n}),define("plugins/Plugin_Gmail",["require","globals","Constants","data","util","platform","tracker","apis","International","DuchessHelpers","Dispatcher","UndoStack","gdata","AccountManager","VMPlugin","CachedSearch","GmailLabel","RFC822Message","ResourceLib","plugins/Plugin_Gmail_Pane","Favorites","Aggregator","EmailPreview","EmailHTML","DriveUploader","Multiselect","VMAttachment"],function(e){function t(){this._super.constructor.call(this,PluginID.Gmail,"Gmail"),this.autocompleteReplace=!0,this.SystemLabels=A,this.SpecialLabels=k,this._lastSyncTime=void 0,a.forceBind("threadSortFn",this),a.forceBind("threadSortPriorityFn",this),a.forceBind("labelSortFn",this),a.forceBind("labelVMLISortFn",this),a.forceBind("sortFn",this),a.forceBind("_fromComparator",this),a.forceBind("_toComparator",this),a.forceBind("_dateComparator",this),a.forceBind("_messagesComparator",this),a.forceBind("_shallowObjComparator",this),a.forceBind("isGmailItem",this),a.forceBind("_flushPendingDraftUpdates",this),a.forceBind("driveMessageContentSync",this),a.forceBind("_cleanupLocalCaches",this),a.forceBind("_handleDeferredSnoozeTask",this),a.forceBind("_cancelDeferredSnoozeTask",this),a.forceBind("_persistRemoteSnoozeTask",this),a.forceBind("_handleDeferredSendMailTask",this),a.forceBind("_cancelDeferredSendMailTask",this),a.forceBind("_persistRemoteSendMailTask",this),this._emailCache={},this._labelsByID={},this._labelsByName={},this._priorityLabels={},this._creatingDrafts={},this._pendingDraftUpdates={},this._pendingThreadLoads={},this._loadThreadMutex=0,this._activeDraftUpdates=0,this._accountSettings={},this._pendingSends={},this._draftCache={},this._unsyncdMessages={},this._pendingSyncdMessages={},this._numUnsyncdMessages=0,this._numSyncdMessages=0,this._outstandingContentSync=!1,this._undoStack=new u(10),this._generateUndoRedo(),this._syncingOfflineChanges=!1,this._draftFlushTimer=void 0,this.registerSetting("WriteAccess","writeAccess",!0),this.registerSetting("SyncTime","syncTime",!0,n.MaxGmailSyncTime.Free),this.registerSetting("SyncAccounts","syncAccounts",!0,["me"]),this.registerSetting("ArchiveOnSchedule","archiveOnSchedule",!0,!1),this.registerSetting("ArchiveOnOrganize","archiveOnOrganize",!0,!1),this.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies",!0,!1),this.addTrackedStat(D.EnsureLabelVMLI),this.addTrackedStat(D.CreateLabelVMLI),this.addTrackedStat(D.MergeThread),this.addTrackedStat(D.SyncdMessage),this.addTrackedStat(D.ErrorSyncdMessage),this.addTrackedStat(D.UnsyncdMessage),this.addTrackedStat(D.OldUnsyncdMessage),this.addTrackedStat(D.MessagesSyncd),this.addTrackedStat(D.MessageDataCached),this._threadCache=this.registerLocalCache("GmailThreadCache",StorageType.IndexedDB,!0,{noInMemoryCache:!0}),this._rawCache=this.registerLocalCache("RawCache",StorageType.IndexedDB,!1,{noInMemoryCache:!0}),this.registerDeferredTaskType(M.Snooze,this._handleDeferredSnoozeTask,this._cancelDeferredSnoozeTask,this._persistRemoteSnoozeTask),this.registerDeferredTaskType(M.SendMail,this._handleDeferredSendMailTask,this._cancelDeferredSendMailTask,this._persistRemoteSendMailTask),this._contentSyncTask=this.registerLowImpactTask("ContentSync",this.driveMessageContentSync),this._cacheCleanup=this.registerLowImpactTask("CacheCleanup",this._cleanupLocalCaches),this._lastCacheCleanup=0,i.isDemoMode()?this.declareProperty("accountID",PluginLoad.Preview|PluginLoad.Full|PluginLoad.Inline,!0,"me"):this.declareProperty("accountID",PluginLoad.Preview|PluginLoad.Full|PluginLoad.Inline),this.declareProperty("from",PluginLoad.Preview|PluginLoad.Full,!1,void 0,this._fromComparator),this.declareProperty("to",PluginLoad.Preview|PluginLoad.Full,!1,void 0,this._toComparator),this.declareProperty("subject",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("date",PluginLoad.Preview|PluginLoad.Full,!0,new Date(0),this._dateComparator),this.declareProperty("lastModifiedDate",PluginLoad.Full,!0,void 0,this._dateComparator),this.declareProperty("modifiedOffline",PluginLoad.Full,!0,!1),this.declareProperty("pendingSend",PluginLoad.Full,!0,!1),this.declareProperty("messages",PluginLoad.Full,!0,[],this._messagesComparator),this.declareProperty("snippet",PluginLoad.Full),this.declareProperty("participants",PluginLoad.Runtime,!0,[]),this.declareProperty("subjectLower",PluginLoad.Runtime),this.declareProperty("count",PluginLoad.Runtime),this.declareProperty("dataLoaded",PluginLoad.Runtime,!0,!1),this.declareProperty("isDeleted",PluginLoad.Runtime,!0,!1),this.declareProperty("labelIds",PluginLoad.Runtime,!0,[]),this.declareProperty("hasAttachments",PluginLoad.Full,!0,!1),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread)}var i=e("globals"),n=e("Constants"),r=e("data"),a=e("util"),s=e("platform"),o=e("tracker"),c=e("apis"),l=e("International"),d=e("DuchessHelpers"),h=e("Dispatcher"),u=e("UndoStack"),p=(e("gdata"),e("AccountManager")),m=e("VMPlugin"),f=e("CachedSearch"),g=e("GmailLabel"),v=e("RFC822Message"),y=e("ResourceLib"),b=e("plugins/Plugin_Gmail_Pane"),S=e("Favorites"),E=e("Aggregator"),C=e("EmailPreview"),P=e("EmailHTML"),T=e("DriveUploader"),D={EnsureLabelVMLI:"EnsureLabelVMLI",CreateLabelVMLI:"CreateLabelVMLI",MergeThread:"MergeThread",SyncdMessage:"SyncdMessage",ErrorSyncdMessage:"ErrorSyncdMessage",UnsyncdMessage:"UnsyncdMessage",OldUnsyncdMessage:"OldUnsyncdMessage",MessagesSyncd:"MessagesSyncd",MessageDataCached:"MessageDataCached"},M={Snooze:"snoozemail",SendMail:"sendmail"},_={FullSync:1,History:2,ThreadFull:3,ThreadMeta:4,Search:5,DataPage:6,Send:7,Labels:8,CreateLabel:9,ModifyLabels:10,Trash:11,ThreadLabel:12,DraftCreate:13,DraftUpdate:14,DraftDelete:15,DraftSend:16,DraftList:17,GetAttachment:18,MessageFull:19,SendAs:20},I={HistoryIDs:"historyIDs",Labels:"labels",SendAs:"sendAs"},A={INBOX:"INBOX",SPAM:"SPAM",TRASH:"TRASH",UNREAD:"UNREAD",STARRED:"STARRED",IMPORTANT:"IMPORTANT",SENT:"SENT",DRAFT:"DRAFT",CHAT:"CHAT",CATEGORY_PERSONAL:"CATEGORY_PERSONAL",CATEGORY_SOCIAL:"CATEGORY_SOCIAL",CATEGORY_PROMOTIONS:"CATEGORY_PROMOTIONS",CATEGORY_UPDATES:"CATEGORY_UPDATES",CATEGORY_FORUMS:"CATEGORY_FORUMS"},w={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},k={ARCHIVED:"==MOODO_ARCHIVED==",ALLMAIL:"==MOODO_ALLMAIL=="},x={PRI0:"Moo.do/Priority High",PRI1:"Moo.do/Priority Medium",PRI2:"Moo.do/Priority Low"},R=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError"],O={Signed:"multipart/signed",Related:"multipart/related",Partial:"message/partial",Mixed:"multipart/mixed",Report:"multipart/report",Parallel:"multipart/parallel",Alternative:"multipart/alternative",Digest:"multipart/digest",Encrypted:"multipart/encrypted",VoiceMessage:"multipart/voice-message",Calendar:"text/calendar",Plain:"text/plain",HTML:"text/html",WatchHTML:"text/watch-html",XWatchHTML:"text/x-watch-html"},L={Unknown:"unknown",Inline:"inline",FormData:"form-data",Attachment:"attachment"},N=["application","audio","example","image","message","model","video","text"],F=[O.Alternative,O.Mixed,O.Plain,O.HTML,O.Report],B=[O.Plain,O.HTML],U=[O.Calendar,O.VoiceMessage,O.Encrypted,O.Mixed],H=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],V=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,q=/\'(.*)\'/g,W=25,z={getType:function(){return n.PluginType.Email},_attachMetadataFields:function(){return H},getDataPane:function(){try{i.PAssert(4769,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){i.reportError(e)}return b},getPaneIcon:function(){return"icon-envelope"},getPanePriority:function(){return 97},useItemStore:function(){return"Gmail"},itemStoreOptions:function(){return{requireStoredEls:!1,enabledFilters:ItemStoreFilter.Priority,parserFn:d.runParseSinglePlugin.bind(d)}},allowRemoteRequests:function(){return!0},ensureAccountEmail:function(e){return"me"===e?this.getDefaultAccount():e},getDefaultAccount:function(){var e,t=i.getUserIdentifier();if(t){try{i.PAssert(4770,i.isDemoMode()||"me"!==t,'Should never return "me" as a valid user')}catch(e){i.reportError(e)}e=t}else{try{i.PAssert(4771,!1,'Unable to get default account name, returning "me"')}catch(e){i.reportError(e)}e="me"}return e},isSameAccount:function(e,t){return"me"===e&&(e=this.getDefaultAccount()),"me"===t&&(t=this.getDefaultAccount()),e===t},areItemsFromSameAccount:function(e,t){var i=this._getAccountIDFromItem(e),n=this._getAccountIDFromItem(t);return this.isSameAccount(i,n)},_handleAccountChanges:function(){var e=[];i.vmMain.paneManager.runForEachPane(function(t){var n=this._getAccountIDFromItem(t.getItem());try{i.PAssert(4772,n,"Missing Account ID: ",t.id,t.getItem().id)}catch(e){i.reportError(e)}this.hasSyncAccount(n)||e.push(t)}.bind(this),this.getPaneType());for(var t=0;t<e.length;++t)i.vmMain.paneManager.removePane(e[t]);0===e.length&&i.vmMain.paneManager.notifyPanes()},addSyncAccount:function(e,t){var n=this.getSetting(this.Settings.SyncAccounts).slice(0);try{i.PAssert(4773,n.indexOf(e)<0,"Must not double add sync accounts to list")}catch(e){i.reportError(e)}n.indexOf(e)<0&&n.push(e),this.setSetting(this.Settings.SyncAccounts,n),this.isActive()?(this._ensureLabel(e,A.INBOX,"Inbox",void 0,void 0,ChangeType.Local),this._ensureLabel(e,A.UNREAD,"Unread",void 0,void 0,ChangeType.Local),this._ensureLabel(e,k.ARCHIVED,"Archived",void 0,void 0,ChangeType.Local),this._ensureLabel(e,k.ALLMAIL,"All Mail",void 0,void 0,ChangeType.Local),this._forceLabelSync(function(){this._forceThreadSync(t)}.bind(this))):t(!0),this._handleAccountChanges()},removeSyncAccount:function(e,t){var n=this.getSetting(this.Settings.SyncAccounts).slice(0);try{i.PAssert(4774,n.indexOf(e)>=0,"Must be able to find sync account if removing")}catch(e){i.reportError(e)}if(n.remove(e),this.setSetting(this.Settings.SyncAccounts,n),this._clearCachedData(e,t),this.getDefaultItemStore()){var r=this.getVMLIForAccount(e);r&&(r.deleteSelf(ChangeType.Local),r.getItemStore().destroyItem(r.id))}this._handleAccountChanges()},_iterateSendAs:function(e){for(var t=this.getSyncAccounts(),i=!1,n=0;!i&&n<t.length;++n){var r=this.getAccountSetting(t[n],"sendAs");if(r)for(var a=0;a<r.length;++a){var s=r[a];if(e(t[n],s)){i=!0;break}}else e(t[n])}},getSignature:function(e){var t;return this._iterateSendAs(function(i,n){if(n&&n.sendAsEmail===e)return t=n.signature,!0}),t},getReplyToAddress:function(e){var t;return this._iterateSendAs(function(i,n){if(n&&n.sendAsEmail===e&&n.replyToAddress)return t=n.replyToAddress,!0}),t},_computeDisplayName:function(e,t){return!t.displayName&&t.isPrimary?p.getAccountName(e):t.displayName},getDisplayName:function(e){var t;return this._iterateSendAs(function(i,n){if(n&&n.sendAsEmail===e)return t=this._computeDisplayName(i,n),!0}.bind(this)),t},getDefaultSendingAccount:function(e){var t;return this._iterateSendAs(function(i,n){if(i===e&&n&&n.isDefault)return t=n.sendAsEmail,!0}),t||(t=e),t},getDefaultFromInfo:function(e){var t=this.getDefaultSendingAccount(e);try{i.PAssert(4775,t,"Must have found a valid account to send from")}catch(e){i.reportError(e)}return{text:this.getDisplayName(t),email:t}},getSendingAccounts:function(e){var t=[];return this._iterateSendAs(function(i,n){e&&e!==i||(n?"pending"!==n.verificationStatus&&t.push(n.sendAsEmail):t.push(i))}),t},getSyncAccount:function(e){var t;return this._iterateSendAs(function(i,n){if(n){if(n.sendAsEmail===e)return t=i,!0}else if(e===i)return t=i,!0}),t},getSendingAccountInfo:function(e){var t;return this._iterateSendAs(function(i,n){if(n){if(n.sendAsEmail===e)return t={text:this._computeDisplayName(i,n),email:e},!0}else if(e===i)return t={text:p.getAccountName(i),email:i},!0}.bind(this)),t},getSyncAccounts:function(){for(var e=this.getSetting(this.Settings.SyncAccounts)||["me"],t=[],n=0;n<e.length;++n)"me"===e[n]?t.push(this.getDefaultAccount()):t.push(e[n]);try{i.PAssert(4776,i.isDemoMode()||t.indexOf("me")<0,'Must not contain "me" as an account')}catch(e){i.reportError(e)}return i.arrayUniques(t)},numSyncAccounts:function(){return this.getSyncAccounts().length},hasSyncAccount:function(e){return this.getSyncAccounts().indexOf(e)>=0},_getSettingsSendAs:function(e){for(var t=this.getSyncAccounts(),i=t.length,n=0,r={},a=function(t,a,s){t&&(r[a]=s.sendAs),++n===i&&e(r)},s=0;s<t.length;++s)this._requestSettings(t[s],a)},_requestSettings:function(e,t){var i=c.fns("gmail").users.settings.sendAs.list.packedFn,n={userId:e},r=function(i){t(!0,e,i)},a=function(i){t(!1,e,i),this._notifyFailedRequest(e,i)}.bind(this);this._queueRemoteRequestMulti(e,i,n,r,a,void 0,_.SendAs)},_fromComparator:function(e,t){var n=!1;if(e||t){if(e&&t){try{i.PAssert(4777,!i.isString(e),"Old from must not be a string")}catch(e){i.reportError(e)}try{i.PAssert(4778,!i.isString(t),"New from must not be a string")}catch(e){i.reportError(e)}e.text===t.text&&e.email===t.email&&(n=!0)}}else n=!0;return n},_toComparator:function(e,t){var n=!1;if(e||t){if(e&&t){try{i.PAssert(4779,i.isArray(e),"Old to must be an array")}catch(e){i.reportError(e)}try{i.PAssert(4780,i.isArray(t),"New to must be an array")}catch(e){i.reportError(e)}n=t.equals(e)}}else n=!0;return n},_dateComparator:function(e,t){var n=!1;if(e||t){if(e&&t){i.isString(e)&&(e=this.parseDateHeader(e)),i.isString(t)&&(t=this.parseDateHeader(t));try{i.PAssert(4781,i.isDateValid(e),"Must be an old valid date to compare")}catch(e){i.reportError(e)}try{i.PAssert(4782,i.isDateValid(t),"Must be a new valid date to compare")}catch(e){i.reportError(e)}i.isDateValid(e)&&i.isDateValid(t)&&(n=e.equals(t))}}else n=!0;return n},_messagesComparator:function(e,t){var i=!0;if(e&&t)if(e.length===t.length)for(var n=0;i&&n<t.length;++n)for(var r=e[n],a=t[n],s=0;s<R.length;++s){var o=R[s],c=!0;switch(o){case"from":c=this._fromComparator(r[o],a[o]);break;case"to":c=this._toComparator(r[o],a[o]);break;case"resources":case"listUnsubscribe":c=this._shallowObjComparator(r[o],a[o]);break;case"labelIds":c=a[o].equals(r[o]);break;case"date":case"internalDate":c=this._dateComparator(r[o],a[o]);break;default:c=r[o]===a[o]}c||(i=!1)}else i=!1;else i=!1;return i},_shallowObjComparator:function(e,t){var i=!1;if(e||t){if(e&&t)if(e===t)i=!0;else{i=!0;for(var n in e)if(!t.hasOwnProperty(n)){i=!1;break}}}else i=!0;return i},_offlineLoad:function(){this._threadCache.onCacheReady(function(){this._threadCache.onCacheMetadataReady(function(){i.isDemoMode()||this._threadCache.getMetadata(I.SendAs,function(e){if(e)for(var t in e)this.setAccountSetting(t,"sendAs",e[t])}.bind(this)),this._threadCache.getMetadata(I.Labels,function(e){i.batchRenderUpdates(function(){var t=this.getSyncAccounts();!i.isDemoMode()&&e||(e={}),e.me&&!e[this.getDefaultAccount()]&&(e[this.getDefaultAccount()]=e.me),i.vmMain.beginUpdateItems();for(var n=0;n<t.length;++n){var r=t[n];this._ensureLabel(r,A.INBOX,"Inbox",void 0,void 0,ChangeType.Local),this._ensureLabel(r,A.UNREAD,"Unread",void 0,void 0,ChangeType.Local),this._ensureLabel(r,k.ARCHIVED,"Archived",void 0,void 0,ChangeType.Local),this._ensureLabel(r,k.ALLMAIL,"All Mail",void 0,void 0,ChangeType.Local);var a=e[r];if(a){for(var s in a){var o=a[s];if(!A[o.id]){
var c=o.name||"LocalLabel"+Date.now();this._ensureLabel(r,s,c,o.oldestSync,o,ChangeType.Local)}}for(var s in A){var c=w[s];this._ensureLabel(r,s,c,void 0,void 0,ChangeType.Local)}}this._ensureLabelVMLIsForAccount(r)}i.vmMain.commitUpdateItems(),this.notifyPanesReadyForLoad();var l=this._getMetadataSyncTime(),d=this._getUnreadSyncTime(),h=function(e){return t.indexOf(e.accountID)>=0&&e.date.isAfter(d)},u=function(e,t){e&&e.length>0&&i.batchRenderUpdates(function(){i.vmMain.beginUpdateItems();for(var n=0;n<e.length;++n){var r=e[n];try{i.PAssert(4783,r,"Must always contain a valid entry when retreiving data from preload")}catch(e){i.reportError(e)}if(r&&(!t||h(r))){var a=this.createEntryFromLocal(r.id,r);(this.isPriorityData(a)||r.date.isAfter(l))&&(this.cacheData(a.id,a),this._updateSpecialLabels(a))}}i.vmMain.commitUpdateItems()}.bind(this))}.bind(this);this._threadCache.requestPreloadData(function(e){i.isArray(e)?u(e,!0):this._threadCache.getFilterEntries(h,u)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))},isPriorityData:function(e){var t=!1;return e.labelIds.indexOf(A.UNREAD)>=0?t=!0:e.labelIds.indexOf(x.PRI0)>=0?t=!0:e.labelIds.indexOf(x.PRI1)>=0?t=!0:e.labelIds.indexOf(x.PRI2)>=0&&(t=!0),t},_load:function(){i.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:i.minutes(15),minDelay:i.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:i.minutes(2),task:this.runThreadSync.bind(this)}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:i.minutes(30),minDelay:i.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync.bind(this)})},_notifyFailedRequest:function(e,t){try{i.PAssert(4784,i.isString(e),"Must supply a valid accountID string")}catch(e){i.reportError(e)}if(t&&t.error)if(t.error.code===n.HTTPStatusCode.Unauthorized)p.isDefaultEmail(e)?(i.toasts.pushMessage(MessageID.LostPermission),this.setSetting(this.Settings.IsEnabled,!1)):i.toasts.pushMessage(MessageID.LostLinked),p.notifyUnauthorizedAccount(e,[GScope.GmailCompose,GScope.GmailModify],t.error.message);else if(t.error.code===n.HTTPStatusCode.BadRequest)for(var r=t.error.errors,a=0;a<r.length;++a){var s=r[a];s.reason===n.GoogleError.FailedPrecondition&&(i.toasts.pushMessage(MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else if(t.error.code===n.HTTPStatusCode.Forbidden)for(var r=t.error.errors,a=0;a<r.length;++a){var s=r[a];s.reason===n.GoogleError.InsufficientPermissions&&(i.toasts.pushMessage(MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else t.error.code>=400&&t.error.code<500&&this._reportErrorCode(t.error.code)&&i.reportError(new Error("Failed Gmail request: "+t.error.code),t)},_reportErrorCode:function(e){var t=!1;return e!==n.HTTPStatusCode.NotFound&&(t=!0),t},_notifySendFailed:function(){i.toasts.pushMessage(MessageID.EmailSendFail)},_createResourceCID:function(e,t){t||(t="UnnamedFile");for(var i=t,n=1;e.has(i);){var r=t.split(".");i=r[0]+"_"+n,r[1]&&(i+="."+r[1]),n++}return i},_createResource:function(e,t){try{i.PAssert(4785,e,"Must have valid resources lib to add to")}catch(e){i.reportError(e)}return{cid:this._createResourceCID(e,t.name),id:i.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:L.Attachment,parentType:O.Mixed,mimeType:t.type,contentEncoding:void 0}},_getLinkedResourceString:function(e){return'<a cid="'+e.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+e.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+e.cid+"</a>"},_removeAttachContent:function(e,t,i){var n=!1,r=P.removeElementsByAttribute(t.decoded,"cid",i.cid);return n=r!==t.decoded,t.decoded=r,n},notifyAttachLinkedFile:function(e,t,i,n){var r={name:i.getField("title"),type:i.getField("mimeType")},a=this._createResource(t.resources,r);a.size=i.getField("fileSize"),a.link=i.getField("alternateLink"),this._shareAttachment(e,i.id,a,n),t.resources.add(a),e.notifyDataMutated(["hasAttachments"],ChangeType.Local)},notifyAttachFiles:function(e,t,n,r){for(var a=e.getField("accountID"),s=0;s<n.length;++s){var o=n[s],c=this._createResource(t.resources,o),l=function(t,i){e.notifyDataMutated(["hasAttachments"],ChangeType.Local)}.bind(this,c),d=function(t,i){t.error=!1,t.link=i.alternateLink,t.thumbnail=i.thumbnailLink,this._shareAttachment(e,i.id,t,r)}.bind(this,c),h=function(t){t.error=!0,i.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:function(){t.uploader.resume()}}),e.notifyDataMutated(["hasAttachments"],ChangeType.Local),r&&r(!1)}.bind(this,c);c.size=o.size,c.uploader=new T(o,a,l,d,h),c.uploader.upload(),t.resources.add(c)}e.notifyDataMutated(["messages"],ChangeType.Local)},_shareAttachment:function(e,t,r,a){try{i.PAssert(4786,t,"Must supply a valid fileID to share")}catch(e){i.reportError(e)}try{i.PAssert(4787,r,"Must supply a valid resource object to share")}catch(e){i.reportError(e)}i.vmMain.remoteAPI().drivePermissionsPublic(t,function(t){r.error=!1,e.notifyDataMutated(["messages"],ChangeType.Local),a&&a(!0)}.bind(this),function(s){r.error=!0,i.isHTTPStatusCode(s,n.HTTPStatusCode.Forbidden)?i.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):i.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:function(){this._shareAttachment(e,t,r,a)}.bind(this)}),e.notifyDataMutated(["hasAttachments"],ChangeType.Local),a&&a(!1)}.bind(this))},removeAttachFiles:function(e,t,n){try{i.PAssert(4788,n,"Must always specify a valid resource to remove from the message")}catch(e){i.reportError(e)}var r=!1;return n.uploader&&!n.uploader.isDone()&&(n.uploader.cancel(),r=!0),t.resources.has(n.cid)&&t.resources.remove(n),r=this._removeAttachContent(e,t,n)||r,e.notifyDataMutated(["messages"],ChangeType.Local),r},notifyItemPropertyChanged:function(e,t,i,n){var r=this.attachmentIsArchived(e);if(t.belongsToItemStore(this.getDefaultItemStore())){t.dateCompleted&&!r&&this.archiveAttachment(e)}if("priority"===n){this.getAttachmentPriority(e)!==t.priority()&&this.setAttachmentPriority(e,t.priority())}else"isArchived"===n&&(r&&!t.isArchived()?this.unarchiveAttachment(e):!r&&t.isArchived()&&(this.archiveAttachment(e),C.isOpenOnThread(e)&&C.reset()))},createLabelString:function(e){if(!w[e.toUpperCase()])return e},isDisplayTag:function(e,t){var i=!1;if(e&&e.shouldDisplayInMessageList()){var n=e.isCustom()||e.getLabelID()===A.DRAFT,r=t&&!t.isInbox()&&e.isInbox();if(n||r)switch(i=!0,e.getName()){case x.PRI0:case x.PRI1:case x.PRI2:case"Moo.do/Handled":case w.STARRED:i=!1}}return i},isDisplayHeader:function(e){var t=!1;if(this.isLabelItem(e)){this._getLabelIDFromItem(e)!==A.UNREAD&&(t=!0)}return t},isMessageDraft:function(e){return e&&e.labelIds&&e.labelIds.indexOf(A.DRAFT)>=0},getDisplayTags:function(e,t,i){var n,r=e.getField("labelIds"),a=e.getField("accountID"),s=[];t&&(n=t.getItemLabel(!0));for(var o=0;o<r.length;++o){var c=this._getLabelByID(a,r[o]);if(this.isDisplayTag(c,n)){var l=i?c.getOutlineText():c.getDisplayText();l&&s.push(l)}}return s},_getParticipantDisplayName:function(e,t){var i;if(this.isMyAccountID(e.email))i="me";else if(e.text)if(1===t)i=e.text;else{var n=e.text.split(" ");i=n&&n.length>0?n[0]:e.email}else i=e.email;return i},getDisplayParticipants:function(e){for(var t=e.getField("participants"),i=[],n=0;n<t.length;++n)i.push(this._getParticipantDisplayName(t[n],t.length));return i.join(", ")},getDefaultDisplayItem:function(e){e=e||this.getDefaultAccount();var t=this._getLabelByID(e,A.INBOX);return this.getVMLIForLabel(e,t)},getEmailRootItem:function(){return S.getItems(n.FavoriteGroup.EmailRoot)[0]},hasEmailRootItem:function(){return S.hasItems(n.FavoriteGroup.EmailRoot)},createEmailRootItem:function(){try{i.PAssert(4789,!this.hasEmailRootItem(),"Should not create email root if it already exists")}catch(e){i.reportError(e)}var e=i.vmMain.itemStoreManager.getDefaultItemStore(),t=e.getRoot(),a=r.createVMLI({text:"Email",favorites:[n.FavoriteGroup.EmailRoot]},{parent:t,changeType:ChangeType.AllLocal});return t.insertItem(a,0),i.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:MessageAction.Okay,hold:!0}),a},ensureEmailItem:function(e){o.beginAction(),this.hasEmailRootItem()||this.createEmailRootItem();for(var t,i=this.getEmailRootItem(),n=i.getItems(),a=0;a<n.length;++a)if(n[a].getRawText()===e){t=n[a];break}return t||(t=r.createVMLI({text:e},{parent:i,changeType:ChangeType.AllLocal}),i.insertItem(t,0)),o.endAction(),t},getWaitingItem:function(e){e(this.ensureEmailItem("Waiting"))},allowTextEditing:function(e,t){var i=!0,n=this.getDefaultItemStore();return e.belongsToItemStore(n)&&(i=!1),i},getDraftForMessage:function(e,t,n,r){try{i.PAssert(4790,t,"Must have a valid thread ID")}catch(e){i.reportError(e)}try{i.PAssert(4791,n,"Must have a valid message ID")}catch(e){i.reportError(e)}var a,s=this.getAttachment(t),o=s.getField("messages").indexOfWithProperty("id",n);try{i.PAssert(4792,o>=0,"Must be able to find the requested message")}catch(e){i.reportError(e)}var c=s.getField("messages")[o+1];c&&c.labelIds.indexOf(A.DRAFT)>=0?a=c:(this.createDraft(e,t,n,{from:r}),a=s.getField("messages")[o+1]);try{i.PAssert(4793,a.labelIds.indexOf(A.DRAFT)>=0,"Must return a valid draft")}catch(e){i.reportError(e)}return a},getDraftByID:function(e,t,n,r){var a,s;if(t){a=this.getAttachment(t),s=n?this._getMessageFromAttachment(a,n):a.getField("messages")[0];try{i.PAssert(4794,s.labelIds.indexOf(A.DRAFT)>=0,"Must be a valid draft")}catch(e){i.reportError(e)}}else{var o=this.createDraft(e,void 0,void 0,r);a=this.getAttachment(o.threadID),s=a.getField("messages")[0]}return{attach:a,draftMsg:s}},_notifyDraftMessage:function(e,t,n){try{i.PAssert(4795,e,"Must supply a valid accountID")}catch(e){i.reportError(e)}try{i.PAssert(4796,t&&!i.isTempId(t),"Must supply a valid threadID: ",t)}catch(e){i.reportError(e)}try{i.PAssert(4797,n&&!i.isTempId(n),"Must supply a valid messageID: ",n)}catch(e){i.reportError(e)}setTimeout(function(){this.hasCacheData(t)&&this._getRemoteDraftID(e,t,n,function(e,i){i&&(log("DraftID: ",e),this.cacheData(t,this.getCacheData(t),!0,["messages"]))}.bind(this))}.bind(this),0)},_notifyLocalDraftDelete:function(e,t,i){},_getInlineResources:function(e){var t=new y;return e.resources.forEachResource(function(e){e.disposition===L.Inline&&t.add(i.clone(e))}),t},createDraft:function(e,t,n,r){r=r||{};try{i.PAssert(4798,!r.body||!r.decoded,"Must not supply both a decoded field and a body")}catch(e){i.reportError(e)}this.sendEvent("CreateDraft");var a=i.generateTempId(),s=r.from||this.getDefaultFromInfo(e),o=r.body||r.decoded||"";""===o&&(o=this.createSignature(s.email));var c,l,d={id:a,modifiedOffline:!0,labelIds:[A.DRAFT],messageID:void 0,raw:"",decoded:o,mimeType:O.HTML,contentType:"text/html;charset=utf-8",from:s,replyTo:this.getReplyToAddress(s.email),to:r.to||[],cc:r.cc||[],bcc:r.bcc||[],snippet:"",subject:r.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:new y};if(t){c=this.getCacheData(t);try{i.PAssert(4799,n,"When supplying a thread ID, must also supply a valid message ID")}catch(e){i.reportError(e)}var h=c.messages.indexOfWithProperty("id",n);try{i.PAssert(4800,h>=0,"If requesting a reply to a message, it must exist in the thread")}catch(e){i.reportError(e)}var u=c.messages[h];if(u&&(d.references=(i.isTempId(u.messageID)?"":u.messageID)+(u.references?" "+u.references:""),i.isTempId(u.messageID)||(d.inReplyTo=u.messageID),d.resources=this._getInlineResources(u)),c.messages.splice(h+1,0,d),this.hasAttachment(t)){var p=this.getAttachment(t);this._updateAttachmentFromMessages(p,ChangeType.Local),p.notifyDataMutated(["messages"],ChangeType.Local)}this.addModifiedOffline(c,["messages"]),l=c}else c={id:a,accountID:e,modifiedOffline:!0,messages:[d],labelIds:[A.DRAFT],subject:r.subject||"",from:e},l=this.createEntryFromLocal(a,c),this.cacheData(l.id,l);return this.cacheThreadData(l.id,this.serializeExternalData(l)),{threadID:l.id,draftID:a,messageID:n}},_updateDraftID:function(e,t,n){try{i.PAssert(4801,n,"Must provide a valid set of draft info")}catch(e){i.reportError(e)}try{i.PAssert(4802,n.id&&n.message,"Draft info must contain valid data")}catch(e){i.reportError(e)}var r=e.isLocalOnlyAttachment();r&&(this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,n.message.threadId),this._threadCache.removeEntry(t));var a=this._findDraft(e,t,n.id);if(a){a.id=n.message.id;try{i.PAssert(4803,a.draftID===n.id,"Should have valid draft ID associated with the message")}catch(e){i.reportError(e)}this._draftCache[a.id]=n.id,r&&this.cacheData(e.id,e.getData()),this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[a.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[a.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}},_updateDraftFromSend:function(e,t,n){try{i.PAssert(4804,n,"Must provide a valid set of draft info")}catch(e){i.reportError(e)}try{i.PAssert(4805,n.id&&n.threadId,"Draft info must contain valid data")}catch(e){i.reportError(e)}e.isLocalOnlyAttachment();if(e.isLocalOnlyAttachment()){this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,n.threadId);try{i.PAssert(4806,!i.isTempId(e.id),"After an ID change, should never be a temp ID")}catch(e){i.reportError(e)}this._threadCache.removeEntry(t)}var r=this._getMessageFromAttachment(e,t);r.id=n.id,r.labelIds=n.labelIds||[],this._updateAttachmentFromMessages(e,ChangeType.Remote),this._draftCache[r.id]=n.id,this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[r.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[r.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))},_createRemoteDraft:function(e,t,n){if(this._creatingDrafts[t])n(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[t]=!0;var r=this._getMessageFromAttachment(e,t);if(r)this._createRFC822Message(e.getData(),r,!1,function(i){var a={raw:i};e.isLocalOnlyAttachment()||(a.threadId=e.id);var s=c.fns("gmail").users.drafts.create.packedFn,o={userId:e.getField("accountID"),resource:{message:a}},l=function(i){this._attachmentHasMessage(e,t)&&(delete this._creatingDrafts[t],r.draftID=i.id,this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(r,!1),this._pendingDraftUpdates[t]&&this._notifyPendingDraftUpdate(),this._updateDraftID(e,t,i),this._updateIsSavingDrafts()),n(!0)}.bind(this),d=function(i){delete this._creatingDrafts[t],this._updateIsSavingDrafts(),n(!1,i),this._notifyFailedRequest(e.getField("accountID"),i)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),s,o,l,d,void 0,_.DraftCreate)}.bind(this));else{try{for(var a=e.getField("messages"),s=0;s<a.length;++s)if(a[s].labelIds.indexOf(A.DRAFT)>=0){!0;break}var o={length:a.length};i.reportError(new Error("Unable to find valid draft for creation"),o)}catch(e){i.reportError(e)}n(!1,{msg:"Unable to find requested message in thread"})}}},_updateIsSavingDrafts:function(){i.isSavingDrafts=this._activeDraftUpdates>0||!i.isEmpty(this._pendingDraftUpdates)||!i.isEmpty(this._creatingDrafts)},_notifyPendingDraftUpdate:function(e,t,i,n){e&&t&&(this._pendingDraftUpdates[t]={attach:e,draftID:i,lastUpdate:Date.now()},n&&this._runDraftUpdate(t)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()},_flushPendingDraftUpdates:function(){if(this.isOnline()){for(var e in this._pendingDraftUpdates)this._runDraftUpdate(e);this._draftFlushTimer=void 0}},_runDraftUpdate:function(e){if(!this._creatingDrafts[e]){var t=this._pendingDraftUpdates[e];try{i.PAssert(4807,t,"Must be able to find valid draft info for pending draft update")}catch(e){i.reportError(e)}this._updateRemoteDraft(t.attach,e,t.draftID,!1,function(e,t){e?i.toasts.clearMessage(MessageID.EmailUpdateFail):i.isHTTPStatusCode(t,n.HTTPStatusCode.NotFound)?i.toasts.clearMessage(MessageID.EmailUpdateFail):i.toasts.pushMessage(MessageID.EmailUpdateFail),this._updateIsSavingDrafts()}.bind(this)),delete this._pendingDraftUpdates[e],this.sendEvent("UpdateDraft")}},_clearPendingDraftUpdate:function(e,t){var n=this._pendingDraftUpdates[t];if(n){try{i.PAssert(4808,n.attach===e,"Must have the correct attachment for the draft update")}catch(e){i.reportError(e)}delete this._pendingDraftUpdates[t]}},hasPendingSends:function(){return this._pendingSends.length>0},notifyPendingSend:function(e,t){try{i.PAssert(4809,!this._pendingSends[t],"Must not have an already pending send for a message")}catch(e){i.reportError(e)}this._pendingSends[t]=e,i.isSendingEmail=!0},notifySent:function(e,t){try{i.PAssert(4810,this._pendingSends[t],"Must have a pending send to be sent")}catch(e){i.reportError(e)}delete this._pendingSends[t],this.hasPendingSends()||(i.isSendingEmail=!1)},notifySendError:function(e,t){try{i.PAssert(4811,this._pendingSends[t],"Must have a pending send to have an error")}catch(e){i.reportError(e)}delete this._pendingSends[t],this.hasPendingSends()||(i.isSendingEmail=!1)},onShutdown:function(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()},_getLinkedResources:function(e){var t=[];return e.forEachResource(function(e){"attachment"===e.disposition&&e.link&&t.push(e)}),t},_createDraftBody:function(e,t){var i;if(t){var n=this._getLinkedResources(t);if(n.length>0){for(var r="<br/><br/>",a=0;a<n.length;++a)r+=this._getLinkedResourceString(n[a]);i=e+'<var id="moodoAttach" moodoAttach="true">'+r+"</var>"}else i=e}else i=e;return i},updateDraft:function(e,t,n,r,a,s,o,c){try{i.PAssert(4812,i.isBoolean(s),"Must supply a valid bool for updateRemoteDraft")}catch(e){i.reportError(e)}try{i.PAssert(4813,i.isBoolean(o),"Must supply a valid bool for forceFlush")}catch(e){i.reportError(e)}try{i.PAssert(4814,i.isFunction(c),"Must supply a valid bool for cb")}catch(e){i.reportError(e)}var l=this._findDraft(e,t,n);if(l){if(l.to=r.to,l.from=r.from||l.from,l.cc=r.cc,l.bcc=r.bcc,l.subject=r.subject,l.decoded=this._createDraftBody(r.body||r.decoded,l.resources),l.snippet=a?i.escape(a.substring(0,30)):"",r.hasOwnProperty("resources")){try{i.PAssert(4815,l.resources instanceof y,"Resources must always be a valid resource lib")}catch(e){i.reportError(e)}l.resources=r.resources}this._updateAttachmentFromMessages(e,ChangeType.Local),e.notifyDataMutated(["messages"],ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(this.getCacheData(e.id))),!this._creatingDrafts[l.id]&&s?i.isTempId(l.id)?this._createRemoteDraft(e,l.id,function(e,t){e||i.toasts.pushMessage(MessageID.EmailUpdateFail),c(e,t)}):(this._notifyPendingDraftUpdate(e,l.id,l.draftID,o),c(!0)):(s&&this._notifyPendingDraftUpdate(e,l.id,l.draftID,o),c(!0)),this._updateIsSavingDrafts()}else{try{i.PAssert(4816,!1,"Unable to update draft as expected from compose window")}catch(e){i.reportError(e)}c(!1)}return{threadID:e.id,draftID:l.draftID,messageID:l.id}},_updateRemoteDraft:function(e,t,n,r,a){try{i.PAssert(4817,t&&n,"Must specify both a valid messageID and draftID"+t+"."+n)}catch(e){i.reportError(e)}var s=this._findDraft(e,t,n);try{i.PAssert(4818,s&&s.labelIds.indexOf(A.DRAFT)>=0,"Must be updating a valid draft"+!!s)}catch(e){i.reportError(e)}try{i.PAssert(4819,!this._creatingDrafts[s.id],"Should not send a remote update while the original draft is being created")}catch(e){i.reportError(e)}this._activeDraftUpdates++,this._getRemoteDraftID(e.getField("accountID"),e.id,s.id,function(t){if(t)this._createRFC822Message(e.getData(),s,r,function(i){var n=c.fns("gmail").users.drafts.update.packedFn,r={userId:e.getField("accountID"),id:t,resource:{message:{raw:i,threadId:e.id}}},o=function(t){this._updateDraftID(e,s.id,t),this._activeDraftUpdates--,a(t)}.bind(this),l=function(t){a(void 0,t),this._activeDraftUpdates--,this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),n,r,o,l,void 0,_.DraftUpdate)}.bind(this));else{try{i.PAssert(4820,!1,"Must always be able to get a valid draft ID when updating")}catch(e){i.reportError(e)}a(!1)}}.bind(this))},sendDraft:function(e,t,r,a,s){try{i.PAssert(4821,!e.getField("pendingSend"),"Should not try to re-send a message after it has already been sent")}catch(e){i.reportError(e)}var o=!0,c=this._findDraft(e,t,r),l=function(t,r){t?(e.updateField("pendingSend",!1),this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(c,!1),this.notifySent(e,c.id)):(i.isHTTPStatusCode(r,n.HTTPStatusCode.Network)||e.updateField("pendingSend",!1),this.notifySendError(e,c.id)),s(t,r)}.bind(this),d=this._verifyEmailRecipients(e,c.id,c.draftID);if(d||(d=this._verifyEmailAttachments(e,c.id,c.draftID)),d){o=!1;var h=i.toasts.pushMessage({text:d.message,action:MessageAction.Okay});d.handleMessageFn&&d.handleMessageFn(h),this.notifyPendingSend(e,c.id),l(!1)}else if(!a){e.updateField("pendingSend",!0),this.notifyPendingSend(e,c.id);var u=!1;this.onEmailReadyToSend(c,function(){try{i.PAssert(4822,!u,"Should not send an email twice")}catch(e){i.reportError(e)}u||(u=!0,e.isLocalOnlyAttachment()||i.isTempId(c.id)?this._sendEmail(e,c.id,c.draftID,l):this._sendRemoteDraft(e,c.id,l))}.bind(this))}return o},onEmailReadyToSend:function(e,t){var n=!0;e.resources.forEachResource(function(r){if(r.uploader&&!r.uploader.isDone())if(n=!1,r.uploader.hasError())try{i.PAssert(4823,!1,"Attachment has error when sending.")}catch(e){i.reportError(e)}else r.uploader.notifyOnComplete(this.onEmailReadyToSend.bind(this,e,t))}.bind(this)),n&&setTimeout(t,0)},_sendRemoteDraft:function(e,t,n){this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(r){if(r)this._updateRemoteDraft(e,t,r,!0,function(t){if(t&&t.message){var a=c.fns("gmail").users.drafts.send.packedFn,s={userId:e.getField("accountID"),resource:{id:r}},o=function(i){this._updateLocalDraftFromSend(e,t.message.id,i,n)}.bind(this),l=function(t){this._notifySendFailed(),n(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),a,s,o,l,void 0,_.DraftSend)}else i.toasts.pushMessage(MessageID.EmailUpdateFail),n(!1)}.bind(this));else{try{i.PAssert(4824,!1,"Must always be able to get a valid draft ID when sending")}catch(e){i.reportError(e)}i.toasts.pushMessage(MessageID.EmailUpdateFail),n(!1)}}.bind(this))},_updateLocalDraftFromSend:function(e,t,n,r){try{i.PAssert(4825,n,"Must have a valid draft result")}catch(e){i.reportError(e)}var a=this._getMessageFromAttachment(e,t);try{i.PAssert(4826,a,"Must always be able to find the sent message")}catch(e){i.reportError(e)}a&&(this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(a,!1),this._updateDraftFromSend(e,t,n)),i.isDemoMode()||this._requestRemoteMessageData(e,n.id,function(e){try{i.PAssert(4827,e,"Should always be able to update message data after send")}catch(e){i.reportError(e)}}),r(!0)},runDiscardDraft:function(e){var t=this._getDraftFromAttachment(e);this.discardDraft(e,t.id,t.draftID,function(e){try{i.PAssert(4828,e,"Must be able to discard message draft")}catch(e){i.reportError(e)}})},discardDraft:function(e,t,n,r){var a=e.getData(),s=this._findDraft(e,t,n),o=a.messages.indexOf(s);i.isTempId(t)?r(!0):this._deleteRemoteDraft(e,t,r);var s=a.messages[o];a.messages.splice(o,1),this._removeRemoteResources(s),this._updateAttachmentFromMessages(e,ChangeType.Local),this._clearPendingDraftUpdate(e,t),e.notifyDataMutated(["messages"],ChangeType.Local),this.cacheThreadData(a.id,this.serializeExternalData(a)),this.sendEvent("DiscardDraft")},_removeRemoteResources:function(e){e&&e.resources.forEachResource(function(e){e.uploader&&!e.uploader.isDone()&&e.uploader.cancel()})},_deleteRemoteDraft:function(e,t,r){try{i.PAssert(4829,!i.isTempId(t),"Should not try to remotely delete a local message")}catch(e){i.reportError(e)}this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(t){if(t){var a=c.fns("gmail").users.drafts.delete.packedFn,s={userId:e.getField("accountID"),id:t},o=function(e){r(!0)},l=function(t){i.isHTTPStatusCode(t,n.HTTPStatusCode.NotFound)?r(!0):r(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),a,s,o,l,void 0,_.DraftDelete)}else{try{i.PAssert(4830,!1,"Must always be able to get a valid draft ID when deleting")}catch(e){i.reportError(e)}i.toasts.pushMessage(MessageID.EmailUpdateFail),r(!1)}}.bind(this))},_getRemoteDraftIDRaw:function(e,t,i,n){var r=c.fns("gmail").users.drafts.list.packedFn,a={userId:e,q:"rfc822msgid:"+t},s={getAllPages:!0,resultsField:"drafts"};this._queuePagedRemoteRequestMulti(e,r,a,i,n,void 0,_.DraftList,s)},_getRemoteDraftID:function(e,t,r,a){try{i.PAssert(4831,i.isString(e),"Must provide a valid accountID")}catch(e){i.reportError(e)}try{i.PAssert(4832,i.isString(t)&&!i.isTempId(t),"Should not try to remotely get the draft ID of a local thread: ",t)}catch(e){i.reportError(e)}try{i.PAssert(4833,i.isString(r)&&!i.isTempId(r),"Should not try to remotely get the draft ID of a local draft: ",r)}catch(e){i.reportError(e)}var s=this.getAttachment(t);try{i.PAssert(4834,s,"Must be able to find a valid attachment for the requested thread")}catch(e){i.reportError(e)}if(!s)return setTimeout(a,0,void 0,!1);var o=this._getMessageFromAttachment(s,r);try{i.PAssert(4835,o,"Must be able to find a valid message for the requested draft")}catch(e){i.reportError(e)}if(!o)return setTimeout(a,0,void 0,!1);if(o.draftID)setTimeout(a,0,o.draftID,!1);else{try{i.PAssert(4836,o.messageID&&!i.isTempId(o.messageID),"Must have a valid messageID for the draft being queried")}catch(e){i.reportError(e)}if(!o.messageID||i.isTempId(o.messageID))return setTimeout(a,0,void 0,!1);var c=function(c){try{i.PAssert(4837,c&&c.length<=1,"Must find only a single draft ID for a given message: ",c.length,o.messageID)}catch(e){i.reportError(e)}if(c){for(var l=0;l<c.length;++l){var d=c[l];if(1===c.length||d.message.threadId===t){try{i.PAssert(4838,!o.draftID||o.draftID===d.id,"Draft ID must either match or not be known yet")}catch(e){i.reportError(e)}o.draftID=d.id}}try{i.PAssert(4839,0===c.length||o.draftID,"Draft returned but IDs dont match: ",c[0]?c[0].message.threadId:"NO RESULT",t,c[0]?c[0].message.id:"NO RESULT",r)}catch(e){i.reportError(e)}}return o.draftID?a(o.draftID,!0):o.contentType&&o.mimeType&&o.decoded?void this._createRemoteDraft(s,o.id,function(r,s){return r?a(o.draftID,!0):(i.isHTTPStatusCode(s,n.HTTPStatusCode.NotFound)&&this._deleteCachedThread(e,t),a(void 0,!1))}.bind(this)):(this._notifyLocalDraftDelete(e,t,r),a(void 0,!1))}.bind(this),l=function(t){return this._notifyFailedRequest(e,t),a(void 0,!1)}.bind(this);this._getRemoteDraftIDRaw(e,o.messageID,c,l)}},_attachmentHasMessage:function(e,t){return e.getField("messages").indexOfWithProperty("id",t)>=0},_getMessageFromAttachment:function(e,t){var n=e.getField("messages"),r=n.indexOfWithProperty("id",t);try{i.PAssert(4843,r>=0,"Must have a vald draft")}catch(e){i.reportError(e)}return n[r]},_getDraftFromAttachment:function(e,t){for(var i,n=e.getField("messages"),r=0;r<n.length;++r)if(n[r].labelIds.indexOf(A.DRAFT)>=0){t&&t!==n[r].draftID||(i=n[r]);break}return i},_findDraft:function(e,t,n){var r,a=e.getField("messages"),s=a.indexOfWithProperty("id",t);if(s>=0)r=a[s];else if(n){var o=a.indexOfWithProperty("draftID",n);o>=0&&(r=a[o])}try{i.PAssert(4844,r,"Must be able to find a valid draft for given messageID/draftID")}catch(e){i.reportError(e)}return r},isAttachmentDraftOnly:function(e){return this.attachmentHasLabel(e,w.DRAFT)&&1===e.getField("messages").length},archiveAttachment:function(e){try{i.PAssert(4845,!this.attachmentIsArchived(e),"Should not archive a thread that is already archived")}catch(e){i.reportError(e)}return this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(e,w.INBOX)},unarchiveAttachment:function(e){try{i.PAssert(4846,this.attachmentIsArchived(e),"Thread must be unarchived to archive it")}catch(e){i.reportError(e)}return this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(e,w.INBOX)},trashAttachment:function(e){return this.sendEvent("TrashMail"),this.trashMail(e.getField("accountID"),e.id,void 0,function(e){try{i.PAssert(4847,e,"Must have successfully trashed remote thread")}catch(e){i.reportError(e)}})},untrashAttachment:function(e){return this.sendEvent("UntrashMail"),this.untrashMail(e.getField("accountID"),e.id,void 0,function(e){try{i.PAssert(4848,e,"Must have successfully untrashed remote thread")}catch(e){i.reportError(e)}})},markAttachmentRead:function(e){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(e,w.UNREAD)},markAttachmentUnread:function(e){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(e,w.UNREAD)},snoozeAttachment:function(e,t){this.sendEvent("SnoozeThread");var n=this._getLabelByName(e.getField("accountID"),"Moo.do/Snoozed");if(n&&!n.isLocalOnly()){var r=Date.now()+t,a=new Date(r);this.addLabelToAttachment(e,"Moo.do/Snoozed"),this.attachmentHasLabel(e,w.INBOX)&&this.removeLabelFromAttachment(e,w.INBOX),this.attachmentHasLabel(e,w.UNREAD)&&this.removeLabelFromAttachment(e,w.UNREAD);var s={scheduleDate:a.toISOString(),gidLinked:p.getAccountGID(e.getField("accountID")),threadID:e.id,labelID:n.getLabelID()};this.scheduleDeferredTask(e.id,M.Snooze,a,s)}else i.toasts.pushMessage({text:"Please restart the app and try again. There was an error syncing your labels with Gmail.",action:MessageAction.Okay})},unsnoozeAttachment:function(e){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(e,"Moo.do/Snoozed"),this.addLabelToAttachment(e,w.INBOX),this.addLabelToAttachment(e,w.UNREAD),this.cancelDeferredTask(e.id,M.Snooze)},_handleDeferredSnoozeTask:function(e){var t=e.getData();try{i.PAssert(4849,t.gidLinked,"Must have valid accountID")}catch(e){i.reportError(e)}try{i.PAssert(4850,t.threadID,"Must have a valid threadID")}catch(e){i.reportError(e)}log("Handling deferred snooze: ",e);var n=p.getAccountEmail(t.gidLinked),r=new Date(t.scheduleDate);this.setLastModifiedDate(n,t.threadID,r),e.isPersistedRemote()?(this.removeLabelsFromMessage(n,t.threadID,void 0,[t.labelID],ChangeType.Auto),this.addLabelsToMessage(n,t.threadID,void 0,[A.INBOX,A.UNREAD],ChangeType.Auto)):(this.removeLabel(n,t.threadID,void 0,"Moo.do/Snoozed"),this.addLabel(n,t.threadID,void 0,w.INBOX),this.addLabel(n,t.threadID,void 0,w.UNREAD))},scheduleSendMessage:function(e,t,i){this.sendEvent("ScheduleMail");var n=Date.now()+i,r=new Date(n);this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(t){if(t){this.addLabelFromAttachment(e,"Moo.do/ScheduledSend");var n={delay:i,scheduleDate:r.toISOString(),gidLinked:p.getAccountGID(e.getField("accountID")),threadID:e.id,draftID:t,labelID:this._getLabelByName(e.getField("accountID"),"Moo.do/ScheduledSend").getLabelID()};this.scheduleDeferredTask(t,M.SendMail,r,n)}}.bind(this))},cancelSendMessage:function(e,t){this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(e,"Moo.do/ScheduledSend"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(e){
e&&this.cancelDeferredTask(e,M.SendMail)}.bind(this))},_handleDeferredSendMailTask:function(e){var t=e.getData();try{i.PAssert(4851,t.gidLinked,"Must have valid gidLinked")}catch(e){i.reportError(e)}try{i.PAssert(4852,t.threadID,"Must have a valid threadID")}catch(e){i.reportError(e)}log("Handling deferred send mail: ",t)},_ensureNoPriority:function(e){var t=VMLIFlag.None;return this.attachmentHasLabel(e,x.PRI0)&&(this.removeLabelFromAttachment(e,x.PRI0),t=VMLIFlag.P0),this.attachmentHasLabel(e,x.PRI1)&&(this.removeLabelFromAttachment(e,x.PRI1),t=VMLIFlag.P1),this.attachmentHasLabel(e,x.PRI2)&&(this.removeLabelFromAttachment(e,x.PRI2),t=VMLIFlag.P2),t},getAttachmentPriority:function(e){return this._attachmentHasPriorityLabel(e,VMLIFlag.P0)&&VMLIFlag.P0||this._attachmentHasPriorityLabel(e,VMLIFlag.P1)&&VMLIFlag.P1||this._attachmentHasPriorityLabel(e,VMLIFlag.P2)&&VMLIFlag.P2||VMLIFlag.None},setAttachmentPriority:function(e,t){this.sendEvent("SetMailPriority");var n=this._ensureNoPriority(e);switch(t){case VMLIFlag.None:break;case VMLIFlag.P0:this.addLabelToAttachment(e,x.PRI0);break;case VMLIFlag.P1:this.addLabelToAttachment(e,x.PRI1);break;case VMLIFlag.P2:this.addLabelToAttachment(e,x.PRI2);break;default:try{i.PAssert(4853,!1,"Invalid priority for email attachment")}catch(e){i.reportError(e)}}return n},markAttachmentStarred:function(e){return this.sendEvent("StarMail"),this.addLabelToAttachment(e,w.STARRED)},markAttachmentUnstarred:function(e){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(e,w.STARRED)},attachmentHasLabelByID:function(e,t){return this.hasLabelByID(e.getField("accountID"),e.id,void 0,t)},attachmentHasLabel:function(e,t){return this.hasLabel(e.getField("accountID"),e.id,void 0,t)},attachmentHasFullLabel:function(e,t){return this.hasFullLabel(e.getField("accountID"),e.id,t)},attachmentIsArchived:function(e){return this._threadIsArchived(e.getData())},addLabelToAttachment:function(e,t){return this.addLabel(e.getField("accountID"),e.id,void 0,t)},removeLabelFromAttachment:function(e,t){return this.removeLabel(e.getField("accountID"),e.id,void 0,t)},trashMail:function(e,t,n,r){var a=this.getAttachment(t);if(this.isAttachmentDraftOnly(a)){var s=a.getField("messages")[0];this.discardDraft(a,s.id,s.draftID,r)}else this.removeLabelsFromMessage(e,t,n,[A.INBOX],ChangeType.Local),this.addLabelsToMessage(e,t,n,[A.TRASH],ChangeType.Local),i.isTempId(t)?r(!0):this._trashRemoteMail(e,t,n,r)},untrashMail:function(e,t,n,r){this.removeLabelsFromMessage(e,t,n,[A.TRASH],ChangeType.Local),i.isTempId(t)?(this.addLabelsToMessage(e,t,n,[A.INBOX],ChangeType.Local),r(!0)):(this.addLabel(e,t,n,w.INBOX),this._untrashRemoteMail(e,t,n,r))},moveItem:function(e,t,i){return i.insertItem(t,0),[t,i]},unmoveItem:function(e,t,i){return i.removeChild(t,ChangeType.Local),[t,i]},hasLabelByID:function(e,t,n,r){try{i.PAssert(4854,!n,"We don't support individual queries on messages, only threads")}catch(e){i.reportError(e)}return this.getAttachment(t).getField("labelIds").indexOf(r)>=0},hasLabel:function(e,t,n,r){try{i.PAssert(4855,!n,"We don't support individual queries on messages, only threads")}catch(e){i.reportError(e)}var a=!1;if(!n){var s=this._getLabelByName(e,r,!0);s&&(a=this.hasLabelByID(e,t,n,s.getLabelID()))}return a},hasFullLabel:function(e,t,i){var n=!1,r=this.getCacheData(t),a=this._getLabelByName(e,i,!0);if(a&&r){var s=r.messages;n=!0;for(var o=0;o<s.length;++o)if(s[o].labelIds.indexOf(a.getLabelID())<0){n=!1;break}}return n},hasLabelLike:function(e,t,i){var n=!1,r=this.getAttachment(t);if(r){var a=r.getField("labelIds"),s=this._getAccountLib(e,this._labelsByID);if(s)for(var o=0;o<a.length;++o){var c=s[a[o]];c&&c.isMatched(i)&&(n=!0)}}return n},addLabel:function(e,t,n,r){try{i.PAssert(4856,!n,"We currently do not support setting labels on single messages")}catch(e){i.reportError(e)}try{i.PAssert(4857,!this.hasLabel(e,t,n,r),"Should not add the same label to a thread/message twice")}catch(e){i.reportError(e)}var a=this._getLabelByName(e,r,!0);if(a)a.isLocalOnly()?this._createRemoteLabel(e,r,function(n){if(n){try{i.PAssert(4859,n,"Should have successfully created the remote label")}catch(e){i.reportError(e)}this._changeLabelID(e,a.getLabelID(),n.id),this._modifyRemoteThreadLabels(e,t,[n.id],void 0)}}.bind(this)):this._modifyRemoteThreadLabels(e,t,[a.getLabelID()],void 0);else{var s=i.generateTempId();a=this._ensureLabel(e,s,r,void 0,void 0,ChangeType.Local),this._ensureVMLIsForLabel(e,a),this._writeLabelsToCache(function(n){n&&this._createRemoteLabel(e,r,function(n){try{i.PAssert(4858,n,"Should have successfully created the remote label")}catch(e){i.reportError(e)}n&&(this._changeLabelID(e,s,n.id),this._modifyRemoteThreadLabels(e,t,[n.id],void 0))}.bind(this))}.bind(this))}return this.addLabelsToMessage(e,t,n,[a.getLabelID()],ChangeType.Local),r},removeLabel:function(e,t,n,r){try{i.PAssert(4860,!n,"We currently do not support setting labels on single messages")}catch(e){i.reportError(e)}var a=this._getLabelByName(e,r);try{i.PAssert(4861,a,"Must have valid label for gmail in order to remove")}catch(e){i.reportError(e)}return a&&(a.isLocalOnly()||this._modifyRemoteThreadLabels(e,t,void 0,[a.getLabelID()]),this.removeLabelsFromMessage(e,t,n,[a.getLabelID()],ChangeType.Local)),r},_threadIsArchived:function(e){if(e){var t=e.labelIds.indexOf(A.INBOX)>=0,n=this.hasFullLabel(e.accountID,e.id,w.TRASH),r=e.labelIds.indexOf(A.SPAM)>=0,a=this.hasFullLabel(e.accountID,e.id,w.DRAFT);return!(i.isTempId(e.id)||t||n||r||a)}return!1},_trashRemoteMail:function(e,t,n,r){try{i.PAssert(4862,!i.isTempId(t),"Should not try to trash local only threads")}catch(e){i.reportError(e)}try{i.PAssert(4863,!n||!i.isTempId(n),"Should not try to trash local only messages")}catch(e){i.reportError(e)}var a,s;n?(a=c.fns("gmail").users.messages.trash.packedFn,s={userId:e,id:n}):(a=c.fns("gmail").users.threads.trash.packedFn,s={userId:e,id:t});var o=function(e){r(!0)},l=function(t){r(!1,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,a,s,o,l,void 0,_.Trash)},_untrashRemoteMail:function(e,t,n,r){try{i.PAssert(4864,!i.isTempId(t),"Should not try to untrash local only threads")}catch(e){i.reportError(e)}try{i.PAssert(4865,!n||!i.isTempId(n),"Should not try to untrash local only messages")}catch(e){i.reportError(e)}var a,s;n?(a=c.fns("gmail").users.messages.untrash.packedFn,s={userId:e,id:n}):(a=c.fns("gmail").users.threads.untrash.packedFn,s={userId:e,id:t});var o=function(e){r(!0)},l=function(t){r(!1,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,a,s,o,l,void 0,_.Trash)},_createRemoteLabel:function(e,t,r){var a=c.fns("gmail").users.labels.create.packedFn,s={userId:e,resource:{name:t,labelListVisibility:"labelHide",messageListVisibility:"hide"}},o=function(e){r&&r(e)},l=function(t){i.isHTTPStatusCode(t,n.HTTPStatusCode.Conflict)?r&&r(void 0,t):(r&&r(void 0,t),this._notifyFailedRequest(e,t))}.bind(this);this._queueRemoteRequestMulti(e,a,s,o,l,void 0,_.CreateLabel)},_modifyRemoteThreadLabels:function(e,t,i,n,r){var a=c.fns("gmail").users.threads.modify.packedFn,s={userId:e,id:t,resource:{addLabelIds:i,removeLabelIds:n}},o=function(e){r&&r(e)},l=function(t){r&&r(void 0,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,a,s,o,l,void 0,_.ModifyLabels)},_ensureRemoteLabel:function(e,t,r,a){this._getLabelByName(e,t,!0)?a&&a(!0):(this._ensureLabel(e,i.generateTempId(),t,void 0,void 0,r),this._createRemoteLabel(e,t,function(e,t){try{i.PAssert(4866,e||i.isHTTPStatusCode(t,n.HTTPStatusCode.Conflict),"Should have successful root label creation")}catch(e){i.reportError(e)}a&&a(!!e)}))},_createInMemoryLabel:function(e,t,i,n,r,a){var s=new g(e,t,i,this._clampSyncTime(n),r,a);a[t]=s,this._ensureAccountLib(e,this._labelsByName)[i]=s},_updateLabelName:function(e,t){var n=e.getAccountID(),r=this._getAccountLib(n,this._labelsByName);try{i.PAssert(4867,r,"Must have valid label name bucket")}catch(e){i.reportError(e)}try{i.PAssert(4868,r[e.getRawName()],"Must have valid label in bucket")}catch(e){i.reportError(e)}e.updateLabelName(t),delete r[e.getRawName()],r[t]=e},_ensureLabel:function(e,t,n,r,a,s){var o=this._ensureAccountLib(e,this._labelsByID);if(o[t])!i.isRemoteChange(s)&&o[t].hasName()||o[t].isSystemLabel()||this._updateLabelName(o[t],n);else{var c=this._getLabelByName(e,n,!0);if(c)c.isLocalOnly()&&!i.isTempId(t)?this._changeLabelID(e,c.getLabelID(),t):c.isLocalOnly()||(o[t]=c);else{try{i.PAssert(4870,n||!i.isTempId(t),"All local labels must have a valid name")}catch(e){i.reportError(e)}this._createInMemoryLabel(e,t,n,r,a,o)}}return o[t]},_clampSyncTime:function(e){return e&&e.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():e},_ensureLabelVMLIsForAccount:function(e){var t=this._getAccountLib(e,this._labelsByID);for(var i in t)this._ensureVMLIsForLabel(e,t[i])},_changeLabelID:function(e,t,n){var r=this._getLabelByID(e,t,!0);i.vmMain.beginUpdateItems(),r.updateLabelID(n),this._getAccountLib(e,this._labelsByID)[n]=r,this._ensureVMLIsForLabel(e,r),i.vmMain.commitUpdateItems(),this.forEachAttachment(function(e){var i=e.getField("labelIds");if(i.remove(t)>=0){for(var r=e.getField("messages"),a=0;a<r.length;++a)r[a].labelIds.remove(t)>=0&&r[a].labelIds.push(n);i.push(n),e.updateField("labelIds",i)}});var a=a||this.getDefaultItemStore(),s="L~"+e+"~"+t;a.hasItem(s)&&a.destroyItem(s)},labelExists:function(e,t){var i=this._getAccountLib(e,this._labelsByID);return i&&i[t]},_getLabelByID:function(e,t){try{i.PAssert(4871,e,"Must supply a valid accountID")}catch(e){i.reportError(e)}try{i.PAssert(4872,t,"Must supply a valid labelID")}catch(e){i.reportError(e)}var n=this._ensureAccountLib(e,this._labelsByID);if(!n[t]){var r=w[t];this._createInMemoryLabel(e,t,r,void 0,void 0,n)}return n[t]},_getLabelByName:function(e,t,n){try{i.PAssert(4873,this.hasSyncAccount(e),"Must provide a valid accountID with a matching sync account: "+e)}catch(e){i.reportError(e)}var r=this._getAccountLib(e,this._labelsByName);try{i.PAssert(4874,n||r,"Unable to find labelsByName for given account: "+e)}catch(e){i.reportError(e)}var a;return r&&(a=r[t]),a},_getPriorityLabel:function(e,t){var n=this._ensureAccountLib(e,this._priorityLabels);if(!n[t]){var r;switch(t){case VMLIFlag.P0:r=x.PRI0;break;case VMLIFlag.P1:r=x.PRI1;break;case VMLIFlag.P2:r=x.PRI2;break;default:try{i.PAssert(4875,!1,"Invalid priority for email attachment")}catch(e){i.reportError(e)}}n[t]=this._getLabelByName(e,r)}return n[t]},_getAccountLib:function(e,t){try{i.PAssert(4876,e,"Must provide valid accountID")}catch(e){i.reportError(e)}try{i.PAssert(4877,t,"Must provide valid lib object")}catch(e){i.reportError(e)}var n;if(e)if(t[e])n=t[e];else for(var r in t)if(r.toUpperCase()===e.toUpperCase())try{i.PAssert(4878,!1,"Mismatch case request found for accountIDs: "+e,r)}catch(e){i.reportError(e)}return n},_ensureAccountLib:function(e,t){try{i.PAssert(4879,e,"Must provide valid accountID")}catch(e){i.reportError(e)}try{i.PAssert(4880,t,"Must provide valid lib object")}catch(e){i.reportError(e)}var n;if(e)if(t[e])n=t[e];else{for(var r in t)try{i.PAssert(4881,!e||!r||r.toUpperCase()!==e.toUpperCase(),"Dupe accountID found with non-matching case: "+e,r)}catch(e){i.reportError(e)}n=t[e]={}}return n},_deleteAccountLib:function(e,t){try{i.PAssert(4882,e,"Must provide valid accountID")}catch(e){i.reportError(e)}try{i.PAssert(4883,t,"Must provide valid lib object")}catch(e){i.reportError(e)}try{i.PAssert(4884,t[e],"Trying to delete an account lib that doesnt exist: ",e)}catch(e){i.reportError(e)}delete t[e]},_attachmentHasPriorityLabel:function(e,t){var i=this._getPriorityLabel(e.getField("accountID"),t);return!!i&&e.getField("labelIds").indexOf(i.getLabelID())>=0},getLabels:function(e,t,i){var n=[],r=t.toLowerCase(),a=0,s=this._labelsByID[e];for(var o in s){var c=s[o];if(c.matchesText(r)&&this.isDisplayTag(c)&&n.indexOf(c)<0&&(n.push(c),a++),i&&a>=i)break}return n},_writeLabelsToCache:function(e){var t={};for(var i in this._labelsByID){t[i]={};var n=this._labelsByID[i];for(var r in n)t[i][r]=n[r].getSaveData()}this._threadCache.setMetadata(I.Labels,t,e)},_writeSendAsToCache:function(e){var t={};this._iterateSendAs(function(e,i){t[e]||(t[e]=[]),t[e].push(i)}),this._threadCache.setMetadata(I.SendAs,t,e)},runLabelSync:function(e){this._threadCache.onCacheMetadataReady(function(){for(var t=function(t,n){i.vmMain.beginUpdateItems();var o={};if(n)for(var c=0;c<n.length;++c){var l=n[c];o[l.id]=!0;var d;d="system"===l.type&&w[l.id]?w[l.id]:l.name,this._ensureLabel(t,l.id,d,void 0,l,ChangeType.Remote)}this._ensureLabelVMLIsForAccount(t),this._ensureRemoteLabel(t,"Moo.do",ChangeType.Local),this._ensureRemoteLabel(t,x.PRI0,ChangeType.Local),this._ensureRemoteLabel(t,x.PRI1,ChangeType.Local),this._ensureRemoteLabel(t,x.PRI2,ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Snoozed",ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Handled",ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Scheduled",ChangeType.Local);var h=this._getAccountLib(t,this._labelsByID);if(h)for(var u in h){var p=h[u];if(p.isLocalOnly()){try{i.PAssert(4885,p.hasName(),"Label must have a valid name to be created on remote")}catch(e){i.reportError(e)}this._createRemoteLabel(t,p.getName(),function(e,i){i&&this._changeLabelID(t,e,i.id)}.bind(this,u))}else 0!==s||o[u]||p.isSystemOrSpecialLabel()||i.isDemoMode()||p.delete()}i.vmMain.commitUpdateItems(),this._writeLabelsToCache(),s+a===r&&e&&e()}.bind(this),n=this.getSyncAccounts(),r=n.length,a=0,s=0,o=function(e,i){a++,t(e,i.labels)},l=function(e,i){s++,t(e),this._notifyFailedRequest(e,i)}.bind(this),d=0;d<n.length;++d){var h=c.fns("gmail").users.labels.list.packedFn,u={userId:n[d],timeoutMS:0};this._queueRemoteRequestMulti(n[d],h,u,o.bind(this,n[d]),l.bind(this,n[d]),void 0,_.Labels)}}.bind(this))},getDescriptorForItem:function(e){try{i.PAssert(4887,e,"Must have a valid item to get a description for")}catch(e){i.reportError(e)}var t=this._getAccountIDFromItem(e),n=this._getLabelIDFromItem(e),r=this._getThreadIDFromItem(e),a={accountID:t,labelID:n,threadID:r};if(t&&n){var s=this._getLabelByID(t,n);a.labelName=s.getName()}return a},handleItemChange:function(e,t){this._threadCache.onCacheReady(function(){this._threadCache.onCacheMetadataReady(function(){var n=this.getDescriptorForItem(e);if(n.labelID){try{i.PAssert(4888,n.accountID,"Must specify a valid accountID")}catch(e){i.reportError(e)}this._getThreadsForLabel(n.accountID,this._getLabelByID(n.accountID,n.labelID),e,function(e){try{i.PAssert(4889,e,"Expected success when querying for remote threads")}catch(e){i.reportError(e)}t&&t()})}}.bind(this))}.bind(this))},handleSortChange:function(e,t){t===n.GmailSortType.Priority&&this._threadCache.onCacheReady(function(){var t=this._getAccountIDFromItem(e);try{i.PAssert(4890,t,"Missing Account ID: ",e.id)}catch(e){i.reportError(e)}var n=this._getLabelByName(t,x.PRI0);n&&this._getThreadsForLabel(t,n,void 0,function(e){try{i.PAssert(4891,e,"Expected success when querying for remote PRI0 threads")}catch(e){i.reportError(e)}});var r=this._getLabelByName(t,x.PRI1);r&&this._getThreadsForLabel(t,r,void 0,function(e){try{i.PAssert(4892,e,"Expected success when querying for remote PRI1 threads")}catch(e){i.reportError(e)}});var a=this._getLabelByName(t,x.PRI2);a&&this._getThreadsForLabel(t,a,void 0,function(e){try{i.PAssert(4893,e,"Expected success when querying for remote PRI2 threads")}catch(e){i.reportError(e)}})}.bind(this))},_getThreadsForLabel:function(e,t,n,r){try{i.PAssert(4894,t,"Must provide a valid label to get thrads for")}catch(e){i.reportError(e)}var a="-in:chats -in:spam label:"+t.getName(),s=t.getOldestSync();if(i.isDateValid(s)){a+=" before:"+Math.floor(s.getTime()/1e3)}var o=new Date,c=function(t){if(t){var i=this._addRemoteEntry(e,t);i.internalDate.isBefore(o)&&(o=i.internalDate),this.cacheThreadData(i.id,this.serializeExternalData(i))}}.bind(this),l=function(e){t.setOldestSync(o),this._writeLabelsToCache(),r(e)}.bind(this),d=new E(c,l);this._requestRemoteThreads(e,_.ThreadLabel,n,a,W,void 0,d.getEntryCB(),d.getDoneCB())},createOutlinePaneItem:function(e,t){for(var n=t.getItemStore(),r=e.getRawText(),a=e.getAttachmentByPlugin(this.id),s=this.getDisplayTags(a,void 0,!0),o=0;o<s.length;++o)r+=" #"+s[o];return n.createItem(i.generateTempId(),r,t.id,void 0,ChangeType.Local)},refreshCurrentView:function(){this._forceThreadSync()},goOnline:function(){this._forceThreadSync(this._notifyPendingDraftUpdate.bind(this))},loadInitialData:function(){this._super.loadInitialData.call(this),i.isDemoMode()&&this._forceThreadSync()},_forceThreadSync:function(e){if(this.hasRecurringTask("GmailThreadSync")){this.getRecurringTask("GmailThreadSync").forceUpdate(e)}},_forceLabelSync:function(e){if(this.hasRecurringTask("GmailLabelSync")){this.getRecurringTask("GmailLabelSync").forceUpdate(e)}},_syncOfflineChanges:function(e,t){try{i.PAssert(4895,!1,"Currently we do not perform a sync offline step for Gmail changes")}catch(e){i.reportError(e)}if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var r=0,a=0,s=0,o=[],c=(function(e,i){i===n.SyncResult.Success?a++:(s++,o.push({id:e,result:i})),r===a+s&&(this._syncingOfflineChanges=!1,t(a,s,o))}.bind(this),function(e){return!!e.modifiedOffline});this._threadCache.getFilterEntries(c,function(e){r=e.length;for(var t=0;t<e.length;++t){var n=this.createEntryFromLocal(e[t].id,e[t]);i.isTempId(n.id)}}.bind(this))}},_cleanupLocalCaches:function(e){try{i.PAssert(4896,i.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(e){i.reportError(e)}var t=0,n=0,r=this._getFullSyncTime(),a=this._getUnreadSyncTime(),s=this._getMetadataSyncTime(),o=function(e){return e&&e.date&&e.date.isBefore(r)};this._threadCache.getFilterEntries(o,function(i){if(i)for(var r=0;r<i.length;++r){var o=i[r],c=!0;if(!o.date.isBefore(a))for(var l=0;c&&l<o.messages.length;++l){var d=o.messages[l];if(this.isPriorityData(d)){c=!1;break}}if(c){o.date.isBefore(s)&&(this._threadCache.removeEntry(o.id),t++);for(var l=0;l<o.messages.length;++l){var d=o.messages[l];this._rawCache.removeEntry(d.id),n++}}}log("Gmail Cache Pruned: ",t,n),e(!1)}.bind(this))},_cleanupRawCache:function(e){try{i.PAssert(4897,i.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(e){i.reportError(e)}var t=0,n=this._getUnreadSyncTime(),r=function(e){return!e.internalDate||new Date(parseInt(e.internalDate)).isBefore(n)};this._rawCache.getFilterEntries(r,function(i){if(i)for(var n=0;n<i.length;++n){var r=i[n];this._rawCache.removeEntry(r.id),t++}log("Raw Cache Pruned: ",t),e()}.bind(this))},getAccountSetting:function(e,t){var i,n=this._getAccountLib(e,this._accountSettings);return n&&(i=n[t]),i},setAccountSetting:function(e,t,i){var n,r=this._ensureAccountLib(e,this._accountSettings);return n=r[t],r[t]=i,n},runSettingsSync:function(){this._getSettingsSendAs(function(e){for(var t in e)this.setAccountSetting(t,"sendAs",e[t]);this._writeSendAsToCache(function(){})}.bind(this))},_getSyncDays:function(){var e=this.getSetting(this.Settings.SyncTime);i.billingManager.isTrialOver()&&(e=n.MaxGmailSyncTime.Free);var t=i.vmMain.pluginManager.getCacheSizeRatio();return t<1&&t>0&&(e=Math.round(e*t)),e},_getMetadataSyncDays:function(){var e=Math.max(this.getSetting(this.Settings.SyncTime),15),t=i.vmMain.pluginManager.getCacheSizeRatio();return t<.5&&(e=Math.max(Math.round(e*t),7)),e},_getUnreadSyncTime:function(){var e=this._getSyncDays();return(new Date).addDays(-1.5*e)},_getFullSyncTime:function(){var e=this._getSyncDays();return(new Date).addDays(-e)},_getMetadataSyncTime:function(){var e=this._getMetadataSyncDays();return(new Date).addDays(-e)},_getFullSyncTimeStr:function(){return this._getSyncDays()+"d"},_getMetadataSyncTimeStr:function(){return this._getMetadataSyncDays()+"d"},runThreadSync:function(e){var t,r=0,a=0,s=[],o=[],c=function(c,l,d){c?(r++,s.push(l)):(a++,!i.isHTTPStatusCode(d,n.HTTPStatusCode.Network)&&i.vmMain.isOnline()&&o.push(l)),a+r===t&&(o.length>0?i.toasts.pushMessage(MessageID.EmailSyncFail):i.toasts.clearMessage(MessageID.EmailSyncFail),s.length>0&&this._contentSyncTask.requestRun(),e&&e(0===o.length))}.bind(this),l=!1,d=this._getSyncDays();void 0!==this._lastSyncTime&&this._lastSyncTime<d&&(l=!0,log("Forcing full gmail sync")),this._lastSyncTime=d,this._threadCache.onCacheMetadataReady(function(){this._threadCache.getMetadata(I.HistoryIDs,function(e){var i=this.getSyncAccounts();t=i.length;for(var n=0;n<i.length;++n){var r;if(!l){var a=e?e[i[n]]:void 0;r=a?a.historyID:void 0}this.performThreadSync(i[n],r,c)}}.bind(this))}.bind(this))},performThreadSync:function(e,t,n){t?(Date.now()-this._lastCacheCleanup>i.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(e,t,n)):this._performThreadSyncFull(e,n)},_performThreadSyncFull:function(e,t){var n="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),r=this.getDefaultItemStore(),a=r.getRoot();a.clearPaginationToken();var s,o=function(t){if(t&&(!s&&t.historyId&&(s=t.historyId,this.setHistoryID(e,s)),this._shouldCacheThread(t))){var i=this._addRemoteEntry(e,t);this.cacheThreadData(i.id,this.serializeExternalData(i))}}.bind(this),c=function(i){t(i,e)},l=new E(o,c);this._requestRemoteThreads(e,_.FullSync,a,n,999,0,l.getEntryCB(),l.getDoneCB()),this._getThreadsForLabel(e,this._getLabelByID(e,A.UNREAD),void 0,function(e){try{i.PAssert(4898,e,"Expect to be able to get all unread messages")}catch(e){i.reportError(e)}})},_compactHistoryEntries:function(e){for(var t={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},n=0;n<e.length;++n){var r=e[n],a=0;if(r.messagesAdded){for(var s=0;s<r.messagesAdded.length;++s){var o=r.messagesAdded[s].message,c=t.messagesAdded[o.threadId];c||(c=t.messagesAdded[o.threadId]=[]),c.indexOf(o.id)<0&&c.push(o.id)}a+=r.messagesAdded.length}if(r.messagesDeleted){for(var s=0;s<r.messagesDeleted.length;++s){var o=r.messagesDeleted[s].message,c=t.messagesDeleted[o.threadId];c||(c=t.messagesDeleted[o.threadId]=[]),c.indexOf(o.id)<0&&c.push(o.id)}a+=r.messagesDeleted.length}if(r.labelsAdded){for(var s=0;s<r.labelsAdded.length;++s){var o=r.labelsAdded[s].message,c=t.labelsAdded[o.threadId];c||(c=t.labelsAdded[o.threadId]={}),c[o.id]||(c[o.id]=[]),c[o.id].pushOnlyUniques(r.labelsAdded[s].labelIds)}a+=r.labelsAdded.length}if(r.labelsRemoved){for(var s=0;s<r.labelsRemoved.length;++s){var o=r.labelsRemoved[s].message,c=t.labelsRemoved[o.threadId];c||(c=t.labelsRemoved[o.threadId]={}),c[o.id]||(c[o.id]=[]),c[o.id].pushOnlyUniques(r.labelsRemoved[s].labelIds)}a+=r.labelsRemoved.length}try{i.PAssert(4899,0===a||a===r.messages.length,"Must have handled all or none of the generic messages")}catch(e){i.reportError(e)}if(0===a)for(var s=0;s<r.messages.length;++s){var o=r.messages[s],c=t.messages[o.threadId];c||(c=t.messages[o.threadId]=[]),c.indexOf(o.id)<0&&c.push(o.id)}}var l={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(var d in t.messages)l.messages.push({id:d,msgIDs:t.messages[d]});for(var d in t.messagesAdded)t.messages[d]||l.messagesAdded.push({id:d,msgIDs:t.messagesAdded[d]});for(var d in t.messagesDeleted)t.messages[d]||l.messagesDeleted.push({id:d,msgIDs:t.messagesDeleted[d]});for(var d in t.labelsAdded)if(!t.labelsAdded[d])for(var h in t.labelsAdded[d])l.labelsAdded.push({id:d,msgID:h,labelIDs:t.labelsAdded[d][h]});for(var d in t.labelsRemoved)if(!t.messages[d])for(var h in t.labelsRemoved[d])l.labelsRemoved.push({id:d,msgID:h,labelIDs:t.labelsRemoved[d][h]});return l},_performThreadSyncPartial:function(e,t,r){var a=c.fns("gmail").users.history.list.packedFn,s={userId:e,startHistoryId:t},o={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},l=function(e,t){log("History Sync Request Failed: ",e,t)}.bind(this),d=function(t,n,a){var s;a&&(s=a.historyId,this.setHistoryID(e,s)),i.vmMain.beginUpdateItems();var o=this._compactHistoryEntries(t);this._handleCompactHistory(e,o,l);i.vmMain.commitUpdateItems(),r(!0,e)}.bind(this),h=function(t){t&&t.error&&t.error.code===n.HTTPStatusCode.NotFound?this._clearCachedData(e,function(i){i?this.performThreadSync(e,void 0,r):r(!1,e,t)}.bind(this)):(r(!1,e,t),this._notifyFailedRequest(e,t))}.bind(this);this._queuePagedRemoteRequestMulti(e,a,s,d,h,void 0,_.History,o)},_handleCompactHistory:function(e,t,i){for(var n=0,r=0;r<t.messages.length;++r)for(var a=t.messages[r],s=0;s<a.msgIDs.length;++s)this._handleMessageUpdated(e,a.id,a.msgIDs[s],i),n++;for(var r=0;r<t.messagesAdded.length;++r)for(var a=t.messagesAdded[r],s=0;s<a.msgIDs.length;++s)this._handleMessageAdded(e,a.id,a.msgIDs[s],i),n++;for(var r=0;r<t.messagesDeleted.length;++r)for(var a=t.messagesDeleted[r],s=0;s<a.msgIDs.length;++s)this._handleMessageDeleted(e,a.id,a.msgIDs[s]),n++;for(var r=0;r<t.labelsAdded.length;++r){var a=t.labelsAdded[r];this._handleLabelsAdded(e,a.id,a.msgID,a.labelIDs),n++}for(var r=0;r<t.labelsRemoved.length;++r){var a=t.labelsRemoved[r];this._handleLabelsRemoved(e,a.id,a.msgID,a.labelIDs),n++}return n},_handleMessageAdded:function(e,t,i,n){this.refreshThreadCacheData(e,t,i,n)},_handleMessageDeleted:function(e,t,i){this._deleteCachedMessage(e,t,i)},_handleLabelsAdded:function(e,t,i,n){this.addLabelsToMessage(e,t,i,n,ChangeType.Remote)},_handleLabelsRemoved:function(e,t,i,n){this.removeLabelsFromMessage(e,t,i,n,ChangeType.Remote)},_handleMessageUpdated:function(e,t,i,n){this.refreshThreadCacheData(e,t,i,n)},getLastSyncTime:function(e,t){this._threadCache.getMetadata(I.HistoryIDs,function(i){var n;if(i){var r=i[e];r&&r.date&&(n=new Date(r.date))}t(n)})},getAllLastSyncTimes:function(e){this._threadCache.getMetadata(I.HistoryIDs,function(t){for(var i={},n=this.getSyncAccounts(),r=0;r<n.length;++r){var a=n[r],s=t?t[a]:void 0;s&&s.date?i[a]=new Date(s.date):i[a]=void 0}e(i)}.bind(this))},setHistoryID:function(e,t,n){try{i.PAssert(4901,i.isString(e),"Must provide a valid account ID to set history ID")}catch(e){i.reportError(e)}try{i.PAssert(4902,i.isString(t),"Must provide a valid history ID to set")}catch(e){i.reportError(e)}this._threadCache.getMetadata(I.HistoryIDs,function(i){i=i||{},i[e]={historyID:t,date:Date.now()},this._threadCache.setMetadata(I.HistoryIDs,i,n)}.bind(this))},clearHistoryID:function(e,t){try{i.PAssert(4903,i.isString(e),"Must provide a valid account ID to clear history ID for")}catch(e){i.reportError(e)}try{i.PAssert(4904,i.isFunction(t),"Must provide valid CB function when clearing history ID")}catch(e){i.reportError(e)}this._threadCache.getMetadata(I.HistoryIDs,function(i){i?(delete i[e],this._threadCache.setMetadata(I.HistoryIDs,i,t)):t(!1)}.bind(this))},clearCachedLabel:function(e,t){try{i.PAssert(4905,i.isString(e),"Must provide a valid account ID to clear history ID for")}catch(e){i.reportError(e)}try{i.PAssert(4906,i.isFunction(t),"Must provide valid CB function when clearing history ID")}catch(e){i.reportError(e)}this._threadCache.getMetadata(I.Labels,function(i){i?(delete i[e],this._threadCache.setMetadata(I.Labels,i,t)):t(!1)}.bind(this))},_clearCachedData:function(e,t){this.clearHistoryID(e,function(i){i?this.clearCachedLabel(e,function(i){i?this.clearAccountThreadCache(e,t):t(!1)}.bind(this)):t(!1)}.bind(this))},clearAccountThreadCache:function(e,t){try{i.PAssert(4907,i.isString(e),"Must provide a valid account ID to clear thread cache for")}catch(e){i.reportError(e)}try{i.PAssert(4908,i.isFunction(t),"Must provide valid CB function when clearing thread cache")}catch(e){i.reportError(e)}var n=function(t){return t.accountID===e};this._threadCache.getFilterEntries(n,function(i){if(i){log("Clearing account thread cache: "+e);for(var n=0;n<i.length;++n){var r=i[n];if(this._threadCache.removeEntry(r.id),r.messages)for(var a=0;a<r.messages.length;++a)this._rawCache.removeEntry(r.messages[a].id)}t(!0)}else t(!1)}.bind(this))},requestDataPage:function(e,t){log("Data Page: ",e.hasPaginationToken()),e.hasPaginationToken()&&!e.paginationTokenInUse()?this._requestRemoteThreads(void 0,_.DataPage,e,void 0,W,void 0,void 0,t):t(!0)},_requestRemoteThreads:function(e,t,n,r,a,s,o,l){var d;if(n&&n.hasPaginationToken()&&!n.paginationTokenInUse()){d=n.beginDataPageLoad();try{i.PAssert(4911,!r,"Should not define a new q for paged token")}catch(e){i.reportError(e)}try{i.PAssert(4912,!o,"Should not define a new entryCB for paged token")}catch(e){i.reportError(e)}if(r=d.getQuery(),a=d.getMaxResults(),o=d.getEntryCB(),l){var h=l;l=function(){d.getDoneCB().apply(null,arguments),h.apply(null,arguments)}}else l=d.getDoneCB();e=e||d.getInfo().accountID}else n&&n.needsPaginationToken()&&(d=this.createPaginationToken(void 0,r,{accountID:e},a,o,l),n.setPaginationToken(d),n.beginDataPageLoad());a=a||W;try{i.PAssert(4913,o&&i.isFunction(o),"Must define a valid entry callback")}catch(e){i.reportError(e)}try{i.PAssert(4914,l&&i.isFunction(l),"Must define a valid done callback")}catch(e){i.reportError(e)}var u,p,m=c.fns("gmail").users.threads.list.packedFn,f={userId:e,maxResults:a,timeoutMS:s,q:r,pageToken:d&&d.hasMorePages()?d.getNextPageToken():void 0};d||!n?(u=function(t){if(t.nextPageToken&&d&&this.updatePaginationToken(d,t.nextPageToken),n&&d&&n.endDataPageLoad(!!t.nextPageToken),t.threads)for(var i=t.threads.length,r=0,a=0,s=function(e){e?(o(e),r++):(o(void 0),a++),r+a===i&&l(!0)},c=0;c<t.threads.length;++c){var h=t.threads[c];this._requestRemoteThreadMetadata(e,h.id,void 0,s)}else l(!0)}.bind(this),p=function(t){n&&d&&n.endDataPageLoad(d),l(!1),this._notifyFailedRequest(e,t)}.bind(this)):(u=function(){l(!0)},p=function(t){l(!1),this._notifyFailedRequest(e,t)}.bind(this)),this._queueRemoteRequestMulti(e,m,f,u,p,void 0,t)},_requestRemoteMessageData:function(e,t,n){try{i.PAssert(4915,!e.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment")}catch(e){i.reportError(e)}var r=c.fns("gmail").users.messages.get.packedFn,a={userId:e.getField("accountID"),id:t,format:"full"},s=function(r){var a=this._parseMailMessage(r);try{i.PAssert(4916,a,"Must be able to parse message")}catch(e){i.reportError(e)}this._updateMessageData(e,t,a),n(!0)}.bind(this),o=function(t){n(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),r,a,s,o,void 0,_.MessageFull)},_requestRemoteMessageDataRaw:function(e,t,i,n){var r=c.fns("gmail").users.messages.get.packedFn,a={userId:e,id:i,format:"full"},s=function(t){n(void 0,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,r,a,n,s,void 0,_.MessageFull)},_requestRemoteThreadDataRaw:function(e,t,i){var n=c.fns("gmail").users.threads.get.packedFn,r={userId:e,id:t,format:"full"},a=function(t){i(void 0,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,n,r,i,a,void 0,_.ThreadFull)},_requestRemoteThreadMetadata:function(e,t,i,n){var r=c.fns("gmail").users.threads.get.packedFn,a={userId:e,id:t,format:"metadata"},s=function(e){n(e)},o=function(t){n(void 0,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,r,a,s,o,i,_.ThreadMeta)},_persistRemoteSnoozeTask:function(e,t){var n=e.getData();i.XHR_PrivateAPI({type:"POST",path:"/tasks/snoozeMail",data:n,requireAuth:!0,autoRetry:!1,cb:this._handleRemotePersist.bind(this,t)})},_cancelDeferredSnoozeTask:function(e,t){var r=e.getData();i.XHR_PrivateAPI({type:"POST",path:"/tasks/snoozeMail/cancel",data:r,requireAuth:!0,autoRetry:!1,cb:function(e){t(e.status===n.HTTPStatusCode.Success)}})},_persistRemoteSendMailTask:function(e,t){var n=e.getData();i.XHR_PrivateAPI({type:"POST",path:"/tasks/sendMail",data:n,requireAuth:!0,autoRetry:!1,cb:this._handleRemotePersist.bind(this,t)})},_cancelDeferredSendMailTask:function(e,t){var r=e.getData();i.XHR_PrivateAPI({type:"POST",path:"/tasks/sendMail/cancel",data:r,requireAuth:!0,autoRetry:!1,cb:function(e){t(e.status===n.HTTPStatusCode.Success)}})},_handleRemotePersist:function(e,t){
if(t.status!==n.HTTPStatusCode.Success)return e(!1);try{var r=JSON.parse(t.response).data;return e(!0,r.messageID)}catch(t){return i.reportError(t),e(!1)}},_parseMailThread:function(e,t){for(var n=[],r=0;r<t.messages.length;++r){var a=this._parseMailMessage(t.messages[r]);try{i.PAssert(4917,a,"Must be able to parse each message")}catch(e){i.reportError(e)}a&&n.push(a)}var s=e.getField("messages");this._mergeMessagesData(s,n,["labelIds","draftID"]),e.updateField("dataLoaded",!0),e.updateField("messages",n),this._updateAttachmentFromMessages(e,ChangeType.Remote)},getAttachmentURL:function(e,t,i){return"https://mail.google.com/mail/b/"+e+"/?ui=2&view=att&disp=safe&zw&th="+t+"&attid="+i},getPreviewURL:function(e){return e.link},reportMessage:function(e,t,n,r,a){var s=c.fns("gmail").users.messages.get.packedFn,o={userId:e,id:n,format:"full",forceNoDupe:!0},l=function(){try{i.PAssert(4918,!1,"Failed to report message")}catch(e){i.reportError(e)}};this._queueRemoteRequestMulti(e,s,o,this._sendReport.bind(this,a,r),l,void 0,_.MessageFull)},dumpMessage:function(e,t,i){var n=this.getAttachment(t),r=this._getMessageFromAttachment(n,i);console.log("Message Dump: ",r)},_sanitizeMessage:function(e){if(e.parts)for(var t=0;t<e.parts.length;++t)this._sanitizeMessage(e.parts[t]);if(e.body&&e.body.data){var i=this._runDecodeEmail(e);i&&i.mimeType===O.HTML?e.body.data=this._encodeEmail(P.sanitizeContent(i.decoded)):e.body.data=this._encodeEmail(P.sanitizePlaintext(i.decoded))}if(e.headers)for(var t=0;t<e.headers.length;++t){var n=e.headers[t];switch(n.name.toUpperCase()){case"TO":case"CC":case"BCC":case"FROM":n.value=n.value.replace(/[A-Za-z0-9]/g,"#");break;case"SUBJECT":case"SNIPPET":n.value=new Array(n.name.length+1).join("#")}}},_sendReport:function(e,t,n){try{i.PAssert(4919,i.isBoolean(e),"Must provide a valid boolean for sendContent")}catch(e){i.reportError(e)}try{i.PAssert(4920,i.isString(t),"Must provide a valid description string")}catch(e){i.reportError(e)}try{i.PAssert(4921,i.isObject(n),"Must provide valid raw data")}catch(e){i.reportError(e)}try{log("Sending Message Report",n),e||this._sanitizeMessage(n.payload);var r={description:t,payload:n.payload};i.reportError(new Error("Report Message"),r)}catch(e){i.reportError(e)}},loadResource:function(e,t,i,n){if(this.hasCacheData(e)){var r=this.getAttachment(e),a=this._getMessageFromAttachment(r,t),s=a.resources.find(i);s?(s.data?n(s,i):this._requestRemoteAttachment(r.getField("accountID"),t,s.id,function(e,t){e&&(s.data=e,s.size=t),n(s,i)}),this.sendEvent("FetchAttachment")):n(void 0,i)}else n(void 0,i)},_requestRemoteAttachment:function(e,t,i,n){var r=c.fns("gmail").users.messages.attachments.get.packedFn,a={id:i,messageId:t,userId:e},s=function(e){n(e.data.replace(/-/g,"+").replace(/_/g,"/"),e.size)},o=function(t){n(void 0),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,r,a,s,o,void 0,_.GetAttachment)},_parseAttachment:function(e,t,n){try{i.PAssert(4922,e,"Must have valid multipart lib")}catch(e){i.reportError(e)}try{i.PAssert(4923,n.body,"Must have a valid attachment body")}catch(e){i.reportError(e)}try{i.PAssert(4924,n.body.attachmentId,"Must have a valid attachment ID")}catch(e){i.reportError(e)}var r,a,s,o,c,l="0."+n.partId;if(n.headers)for(var d=0;d<n.headers.length;++d){var h=n.headers[d];switch(h.name.toUpperCase()){case"CONTENT-ID":var u=/^<(.*)>$/,p=u.exec(h.value);r=p?p[1]:h.value,a=r;break;case"CONTENT-TRANSFER-ENCODING":c=h.value;break;case"CONTENT-DISPOSITION":var m=h.value.split(";");o=m[0]?m[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":s=h.value}}r&&o!==L.Attachment||!n.filename?!r&&n.body.attachmentId&&(r=n.body.attachmentId):r=n.filename;try{i.PAssert(4925,r,"Must be able to find a valid resource ID")}catch(e){i.reportError(e)}var f={cid:r,rawContentID:a,id:n.body.attachmentId,attID:l,realAttrID:s,data:void 0,size:n.body.size,uploader:void 0,disposition:o,parentType:t.mimeType,mimeType:n.mimeType,contentEncoding:c};e.add(f)},_decodeFlowed:function(e,t){return e.split(/\r?\n/).reduce(function(e,i,n){var r=e;return t&&(r=r.replace(/[ ]+$/,"")),/ $/.test(e)&&!/(^|\n)\-\- $/.test(e)||1===n?r+i:r+"\n"+i}).replace(/^ /gm,"")},_decodeEmail:function(e,t,n){try{i.PAssert(4926,i.isString(e),"Passing in an invalid string to decode")}catch(e){i.reportError(e)}var r;if(e)try{r=i.b64_to_utf8(e),"FLOWED"===n.format&&(r=this._decodeFlowed(r,n.delSp))}catch(e){i.reportError(e)}return r},_encodeEmail:function(e){var t;try{t=i.utf8_to_b64(e)}catch(e){i.reportError(e)}return t},_runDecodeEmail:function(e){try{i.PAssert(4927,e&&e.body,"Must pass in a valid part")}catch(e){i.reportError(e)}var t,n=this._getHeader(e,"Content-Transfer-Encoding"),r=!1;if(U.indexOf(e.mimeType)>=0)return t=this._generateMessageDisplayNode(e),{decoded:t,mimeType:O.HTML,contentType:"text/html;charset=utf-8",name:"GeneratedContent",hasError:r};var a=this._getHeader(e,"Content-Type")||"text/html;charset=utf-8";try{i.PAssert(4928,a,"Must have a valid contentType")}catch(e){i.reportError(e)}var s=this._sanitizeContentType(a);return e.body&&e.body.data?t=this._decodeEmail(e.body.data,n,s):e.body&&e.body.attachmentId?t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>':(t="Unable to decode email content",r=!0),{decoded:t,mimeType:e.mimeType,contentType:s.type,name:s.name,hasError:r}},_runDecodeMessage:function(e){var t=this._decodeMessagePart(e);return 0===t.length&&e?F.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:U.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:[]:t},_decodeMessagePart:function(e){var t=[];if(e)if(e.mimeType===O.Mixed||e.mimeType===O.Report||e.mimeType===O.Partial)for(var i=0;i<e.parts.length;++i){var n=this._decodeMessagePart(e.parts[i]);t.pushArray(n)}else if(e.mimeType===O.Related||e.mimeType===O.Signed||e.mimeType===O.Signed||e.mimeType===O.Alternative){for(var i=e.parts.length-1;i>=0;i--)if(this._isValidDisplayPart(e.parts[i])){var n=this._decodeMessagePart(e.parts[i]);if(n.length>0){t.pushArray(n);break}}}else this._isValidDisplayPart(e)&&t.push(this._runDecodeEmail(e));return t},_combineMessageParts:function(e){var t="",i=O.Plain,n="text/html;charset=utf-8",r=!1;if(e&&e.length>0){i=e[0].mimeType,n=e[0].contentType;for(var a=0;a<e.length;++a)B.indexOf(e[a].mimeType)<0&&(r=!0);t=P.combineParts(e)}else t=" ";return i===O.Plain&&(i=O.HTML,n=O.HTML+";charset="+n.split(";charset=")[1]),{decoded:t,mimeType:i,contentType:n,reportMessage:r}},_isValidDisplayPart:function(e){var t=!1;return!this._isResourcePart(e)&&F.indexOf(e.mimeType)>=0&&(t=!0),t},_isResourcePart:function(e){var t=!1;return e.filename?t=!0:this._getHeader(e,"CONTENT-ID")&&(this._getHeader(e,"CONTENT-DISPOSITION")||F.indexOf(e.mimeType)<0)&&(t=!0),t},_parseMessagePart:function(e,t){var n={parent:t,raw:e,mimeType:e.mimeType,children:[],resources:[]};switch(e.mimeType){case O.Plain:case O.HTML:case O.Digest:break;case O.Signed:case O.Partial:case O.Encrypted:case O.Related:case O.Parallel:case O.Report:case O.VoiceMessage:case O.Mixed:for(var r=0;r<e.parts.length;++r){var a=e.parts[r],s=this._parseMessagePart(a,n);this._isResourcePart(a)?n.resources.push(s):n.children.push(s)}break;case O.Alternative:for(var r=0;r<e.parts.length;++r){var s=this._parseMessagePart(e.parts[r],n);n.children.push(s)}break;default:var o=e.mimeType.split("/")[0];N.indexOf(o)<0&&(log("Unknown Part Mimetype: ",e),i.reportError(new Error("Unknown attachment mimetype: "+e.mimeType)))}return n},_getMessageDisplay:function(e,t){switch(e.mimeType){case O.Plain:case O.HTML:case O.Mixed:case O.Report:case O.Parallel:t.push(e);break;case O.Related:case O.Signed:case O.Alternative:case O.Partial:for(var n=0;n<e.children.length;++n)this._getMessageDisplay(e.children[n],t);break;case O.WatchHTML:case O.XWatchHTML:break;case O.Encrypted:case O.Calendar:case O.VoiceMessage:t.push(e);break;default:try{i.PAssert(4929,!1,"Should never have an unknown multipart mimetype in the tree: ",e.mimeType)}catch(e){i.reportError(e)}}},_getResourcesForNode:function(e,t){for(var i=e.resources,n=0;n<i.length;++n){var r=i[n].raw;this._parseAttachment(t,e,r)}e.raw&&e.raw.body&&e.raw.body.attachmentId&&this._parseAttachment(t,e.parent,e.raw)},_getResourcesForPart:function(e){var t=new y;if(e.mimeType===O.Mixed||e.mimeType===O.Report)for(var i=0;i<e.children.length;++i)this._getResourcesForNode(e.children[i],t);for(;e;)this._getResourcesForNode(e,t),e=e.parent;return t},_displayAttachment:function(e,t){var i=!1;return e.cid===t&&(e.disposition===L.Attachment?i=!0:e.disposition===L.Inline&&e.parentType===O.Mixed&&(i=!0)),i},getMessageAttachments:function(e){var t=[];return e.resources.forEachResource(function(e){this._displayAttachment(e,e.cid)&&t.push(e)}.bind(this)),t},getMessageDisplayAttachments:function(e){var t,i=this.getMessageAttachments(e);if(e.initializedForDisplay)t=e.specialLinks?e.specialLinks.attachments:[];else{var n={ignoreQuotedAttachments:!!(e.labelIds.indexOf(A.DRAFT)>=0)};t=P.getAttachmentLinks(e.decoded,n)}for(var r=0;r<t.length;++r){var a=t[r];if(!e.resources.has(a.name)){var s=this._createResource(e.resources,a);s.link=a.href,i.push(s)}}return i},_verifyDKIM:function(e){var t=void 0;if(e)for(var i=e.split(";"),n=/([a-z]+)[=](.*)/i,r=0;r<i.length;++r){var a=i[r].trim();if(a){var s=n.exec(a);if(s)switch(t={},s[1]){case"d":t.domain=s[2];break;case"h":t.headers=s[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return t},_sanitizeContentType:function(e){var t="text/html;charset=utf-8";try{var n=e.replace(/[\"\']/g,"").split(";"),r=n[0].trim().toLowerCase();try{i.PAssert(4930,r===O.Plain||r===O.HTML,"Unknown ContentType MediaType: "+r)}catch(e){i.reportError(e)}for(var a,s,o,c,l=1;l<n.length;++l){var d=n[l].trim();if(d){var h=d.indexOf("=");if(h>=1){var u=d.substr(0,h).trim(),p=d.substr(h+1).trim();if(u&&p)switch(u.toUpperCase()){case"CHARSET":a=p;break;case"FORMAT":s=p.toUpperCase();break;case"DELSP":o="YES"===p.toUpperCase();break;case"NAME":c=p;break;case"BOUNDARY":break;default:try{i.PAssert(4931,!1,"Unknown param in ContentType: "+d)}catch(e){i.reportError(e)}}else try{i.PAssert(4932,!1,"Malformed contentType part: ",e)}catch(e){i.reportError(e)}}else try{i.PAssert(4933,!1,"Invalid contentType part: ",e)}catch(e){i.reportError(e)}}}a||(a="utf-8"),r&&a&&(t=r+";charset="+a)}catch(e){i.reportError(e)}return{type:t,format:s,delSp:o,name:c}},_getHeader:function(e,t){var i;if(e&&e.headers)for(var n=0;n<e.headers.length;++n)if(e.headers[n].name.toUpperCase()===t.toUpperCase()){i=e.headers[n].value;break}return i},_generateMessageDisplayNode:function(e){try{i.PAssert(4935,U.indexOf(e.mimeType)>=0,"Must be a valid mimeType to generate content from")}catch(e){i.reportError(e)}var t;if(e.body&&e.body.attachmentId)t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>';else{var n;switch(e.mimeType){case O.Calendar:case O.VoiceMessage:case O.Mixed:n="&nbsp;";break;case O.Encrypted:n="Unable to display encrypted message content.";break;default:n="Unable to display unknown content type: "+e.mimeType}t="<html><body>"+n+"</body></html>"}return t},_parseMailMessage:function(e){var t;try{t=this._parseMailMessageInternal(e)}catch(e){i.reportError(e)}return t},_parseMailMessageInternal:function(e){var t={},n=e.payload,r=!!n.body&&n.body.size>0;try{i.PAssert(4936,r!==n.mimeType.startsWith("multipart/")||n.mimeType===O.Partial,"Checking the body size should be the same as checking whether this is a multipart message")}catch(e){i.reportError(e)}for(var a=(this._verifyDKIM(this._getHeader(e.payload,"DKIM-Signature")),e.payload.headers),s=0;s<a.length;++s){var o=a[s];switch(o.name.toUpperCase()){case"FROM":e.from=this.parseEmailAddress(o.value);break;case"REPLY-TO":e.replyTo=this.parseEmailAddress(o.value);break;case"TO":e.to=this.parseEmailAddresses(o.value);break;case"CC":e.cc=this.parseEmailAddresses(o.value);break;case"BCC":e.bcc=this.parseEmailAddresses(o.value);break;case"SUBJECT":e.subject=o.value;break;case"DATE":e.date=this.parseDateHeader(o.value);try{i.PAssert(4937,i.isDateValid(e.date),"Must have a valid message date: ",e.date)}catch(e){i.reportError(e)}break;case"MESSAGE-ID":e.messageID=o.value;break;case"REFERENCES":e.references=o.value;break;case"IN-REPLY-TO":e.inReplyTo=o.value;break;case"LIST-UNSUBSCRIBE":e.listUnsubscribe=o.value}}e.messageID||(e.messageID=i.generateTempId());var c,l;if(r)l=n;else{var d=this._parseMessagePart(n),h=[];this._getMessageDisplay(d,h);for(var u,p=h.length-1;!u&&p>=0;p--)if(F.indexOf(h[p].mimeType)>=0)u=h[p];else if(U.indexOf(h[p].mimeType)>=0)u=h[p];else{log("Unknown bestNode mimepart: ",h[p]);try{i.PAssert(4938,!1,"Unknown mimePart display type: ",h[p].mimeType)}catch(e){i.reportError(e)}}u?(c=this._getResourcesForPart(u),l=u.raw):this._sendReport(!1,"Missing bestNode",e)}try{i.PAssert(4939,l,"Must have found a valid message part to display")}catch(e){i.reportError(e)}var m=this._runDecodeMessage(l);try{i.PAssert(4940,m.length>0,"Should have at least one decoded message part available")}catch(e){i.reportError(e)}if(0===m.length)try{var f=JSON.parse(JSON.stringify(e));this._sendReport(!0,"No valid decoded part",f)}catch(e){i.reportError(e)}var g=this._combineMessageParts(m);if(g){t={id:e.id,labelIds:e.labelIds,messageID:e.messageID,decoded:g.decoded,mimeType:g.mimeType,contentType:g.contentType,from:e.from,to:e.to||[],cc:e.cc,bcc:e.bcc,snippet:e.snippet,subject:e.subject||"",date:e.date,internalDate:e.internalDate?new Date(i.parseInt(e.internalDate)):new Date,references:e.references,inReplyTo:e.inReplyTo,listUnsubscribe:e.listUnsubscribe,resources:c||new y},g.reportMessage&&this._sendReport(!1,"Mismatch mimeType/contentType",e)}return t},parseEmailAddress:function(e){V.lastIndex=0;var t=V.exec(e),i={};if(t){var n=q.exec(t[1]);i.text=n?n[1]:t[1],i.email=t[2]}else i.email=e;return i.email&&(i.email=i.email.replace(/[\r\n]/g,"")),i.text&&(i.text=i.text.replace(/[\r\n]/g,"")),i},parseEmailAddresses:function(e){for(var t=[],n=i.parseEmailAddresses(e),r=0;r<n.length;++r){var a=n[r];"contact"===a.type&&a.email&&t.push(a)}return t},parseDateHeader:function(e){var t=new Date(e);return i.isDateValid(t)||(t=l.parseDate(e,n.DateFormat.MDY)),t},runRemoteSearch:function(e,t,n,r){try{i.PAssert(4942,e,"Must provide a valid search")}catch(e){i.reportError(e)}try{i.PAssert(4943,t,"Must provide a valid pane")}catch(e){i.reportError(e)}try{i.PAssert(4944,n,"Must provide a valid bucket ID")}catch(e){i.reportError(e)}try{i.PAssert(4945,i.isFunction(r),"Must provide a valid search callback")}catch(e){i.reportError(e)}var a="-in:chats -in:spam "+e,s=i.vmMain.paneManager.getPaneById(t),o=this._getAccountIDFromItem(s.getItem())||this.getDefaultAccount(),c=!1,l=0,d=0,h=0,u=new f(e,W,this.requestDataPage.bind(this)),p=function(e){if(l===d&&c){log("Done Searching: ",l);var i=e?SearchResultStatus.Error:l>0?SearchResultStatus.Done:SearchResultStatus.None;u.isValid()&&this.swapInSearchBucket(n,t),r(i)}}.bind(this),m=function(e){if(l++,e){var t=this._addRemoteEntry(o,e),i=this.getBucketItemStore(n);this._ensureVMLIsForSearchResult(t,i),d++}else d++,h++;p()}.bind(this),g=function(e){c=!0,p(!e)}.bind(this),v=!1,y=function(e){u.onDone(e),v||(v=!0,u.isValid()&&u.hasResults()?u.getNextPage(m,g):g(e))},b=new E(u.onEntry,y);return this._requestRemoteThreads(o,_.Search,void 0,a,W,void 0,b.getEntryCB(),b.getDoneCB()),u},_addSearchCacheEntryInternal:function(e,t,i){var n=!1,r=this._ensureAccountLib(e,this._emailCache);return r[t]||(r[t]={}),r[t][i]||(r[t][i]=!0,n=!0),n},_removeSearchCacheEntryInternal:function(e,t,i){var n,r=this._getAccountLib(e,this._emailCache);return r&&r[t]&&(n=r[t][i],delete r[t][i]),n},_getSearchCacheLabelEntryInternal:function(e,t){var i,n=this._getAccountLib(e,this._emailCache);return n&&n[t]&&(i=n[t]),i},_addEmailToSearchCache:function(e,t){var n=!1;if(t&&i.isArray(t.labelIds))for(var r=0;r<t.labelIds.length;++r)n|=this._addSearchCacheEntryInternal(t.accountID,t.labelIds[r],e);return n},_removeEmailFromSearchCache:function(e,t){var n=!1;if(t&&i.isArray(t.labelIds))for(var r=0;r<t.labelIds.length;++r){var a=!!this._removeSearchCacheEntryInternal(t.accountID,t.labelIds[r],e);n|=a,a&&this._removeThreadLabelVMLI(t.accountID,e,t.labelIds[r])}return n},_addEmailLabelToSearchCache:function(e,t,i){return this._addSearchCacheEntryInternal(e,i,t)},_removeEmailLabelFromSearchCache:function(e,t,i){var n=!!this._removeSearchCacheEntryInternal(e,i,t);return n&&this._removeThreadLabelVMLI(e,t,i),n},runLocalItemSearch:function(e){var t=this.getDescriptorForItem(e.item),n=this._getSearchCacheLabelEntryInternal(t.accountID,t.labelID);if(n)for(var r in n){var a=this.getCacheData(r);try{i.PAssert(4946,a,"Must have valid data for search entry")}catch(e){i.reportError(e)}if(a){var s=this._ensureThreadLabelVMLI(a,t.labelID);e.comparator&&!e.comparator(s)||e.each&&e.each(s)}}},getRemoteAttachmentData:function(e){try{i.PAssert(4947,e.hasField("accountID"),"Must have a valid accountID for a thread")}catch(e){i.reportError(e)}if(e.hasField("accountID")){var t=function(t,i){t?this._addRemoteEntry(e.getField("accountID"),t):(e.notifyDataRequestFailed(),this._notifyFailedRequest(e.getField("accountID"),i))}.bind(this);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,e,t)}else e.notifyDataRequestFailed()},_updateThreadFromMessages:function(e){try{i.PAssert(4948,!e.isDeleted||0===e.messages.length,"Should never run an update on a deleted thread with messages")}catch(e){i.reportError(e)}var t=e.labelIds,n=i.getUserIdentifier();"me"===e.accountID&&"me"!==n&&(e.accountID=n),e.labelIds=[],e.date=void 0,e.participants=[],e.count=e.messages.length,e.snippet=e.count>0?e.messages[e.messages.length-1].snippet:"",e.hasPriority=!1;for(var r=0;r<e.messages.length;++r){var a=e.messages[r];try{i.PAssert(4949,a.id,"Each message must have a valid ID")}catch(e){i.reportError(e)}e.labelIds.pushOnlyUniques(a.labelIds);var s=a.labelIds.indexOf(A.DRAFT)>=0,o=!1;if(a.labelIds.indexOf(A.SENT)>=0)for(var c=0;c<a.to.length;++c){var l=a.to[c];if(this.isMyAccountID(l.email)){o=!0;break}}else o=!0;if((!e.date||a.date&&e.date.isBefore(a.date)&&!s&&o)&&(e.date=a.date),(!e.internalDate||a.internalDate&&e.internalDate.isBefore(a.internalDate))&&(e.internalDate=a.internalDate),a.from&&e.participants.indexOfWithProperty("email",a.from.email)<0&&e.participants.push(a.from),a.resources instanceof y)a.resources.forEachResource(function(t){this._displayAttachment(t,t.cid)&&(e.hasAttachments=!0)}.bind(this));else try{i.PAssert(4950,!1,"Message must always be a resource lib")}catch(e){i.reportError(e)}}return e.date=e.date?new Date(e.date):new Date(0),i.isDateValid(e.date)||(e.date=new Date(0)),e.internalDate=e.internalDate?new Date(e.internalDate):new Date,i.isDateValid(e.internalDate)||(e.internalDate=new Date),e.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):e.date,i.isDateValid(e.lastModifiedDate)&&!e.lastModifiedDate.isBefore(e.date)||(e.lastModifiedDate=e.date),e.messages.length>0&&(e.subject=e.messages[0].subject,e.subjectLower=e.subject.toLowerCase(),e.from=e.messages[e.messages.length-1].from,e.to=e.messages[0].to),{labelsAdded:t?e.labelIds.removeArray(t):e.labelIds,labelsRemoved:t?t.removeArray(e.labelIds):void 0}},_updateAttachmentFromMessages:function(e,t){var i=this._updateThreadFromMessages(e.getData());this._handleThreadLabelUpdates(e.getData(),i.labelsAdded,i.labelsRemoved),e.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],t)},_createRemoteEntry:function(e,t){for(var n={id:t.id,accountID:e,messages:[],labelIds:[]},r=0;r<t.messages.length;++r){var a=t.messages[r];try{i.PAssert(4951,a.id,"Message must have a valid id")}catch(e){i.reportError(e)}try{i.PAssert(4952,!a.labelIds||a.labelIds.indexOf(A.CHAT)<0,"Should never receive a chat message")}catch(e){i.reportError(e)}a.labelIds&&a.labelIds.indexOf(A.DRAFT)>=0&&this._notifyDraftMessage(e,t.id,a.id);for(var s={id:a.id,messageID:void 0,internalDate:a.internalDate?new Date(i.parseInt(a.internalDate)):new Date,snippet:a.snippet,labelIds:a.labelIds||[],to:[],resources:new y,subject:""},o=0;o<a.payload.headers.length;++o){var c=a.payload.headers[o];switch(c.name.toUpperCase()){case"TO":s.to=this.parseEmailAddresses(c.value);break;case"FROM":s.from=this.parseEmailAddress(c.value);break;case"SUBJECT":s.subject=c.value;break;case"MESSAGE-ID":s.messageID=c.value;break;case"IN-REPLY-TO":s.inReplyTo=c.value;break;case"DATE":s.date=this.parseDateHeader(c.value);try{i.PAssert(4953,i.isDateValid(s.date),"Must have a valid message date: ",c.value)}catch(e){i.reportError(e)}}}i.isDateValid(s.date)||(s.date=s.internalDate),s.subject||(s.subject=""),s.messageID||(s.messageID=i.generateTempId()),n.messages.push(s)}return this._updateThreadFromMessages(n),n},_addRemoteEntry:function(e,t){var i=this._createRemoteEntry(e,t);if(this.hasCacheData(i.id)){var n=this.getCacheData(i.id);if(n){this._mergeThreadData(n,i);var r=this._updateThreadFromMessages(i);this._handleThreadLabelUpdates(i,r.labelsAdded,r.labelsRemoved)}var a=this.getChangedFields(n,i);if(this.cacheData(i.id,i,!!n,a),this.fieldsHaveParseEffect(a)&&this.hasAttachment(i.id)){this.getAttachment(i.id).notifyDataMutated(a,ChangeType.Remote)}}else this.cacheData(i.id,i),this._updateSearchPanes(i,i.labelIds,[]);return i},cacheData:function(e,t,i,n){this._verifyMessageState(t,!1);var r=this._addEmailToSearchCache(e,t);if(this._super.cacheData.call(this,e,t,i,n),t.messages&&this._checkUnsyncdMessageContent(t),r){var a=this.getDefaultItemStore();a&&a.updateItems()}},cacheThreadData:function(e,t){this._verifyMessageState(t,!0),this._threadCache.cacheEntry(e,t)},_verifyMessageState:function(e,t){},createEntryFromLocal:function(e,t){t.subjectLower=t.subject.toLowerCase(),t.messages=t.messages||[];for(var n=0;n<t.messages.length;++n){var r=t.messages[n];if(i.isString(r.date)?r.date=this.parseDateHeader(r.date):r.date||(r.date=new Date),i.isString(r.internalDate)?r.internalDate=new Date(r.internalDate):r.internalDate||(r.internalDate=new Date),r.to||(r.to=[]),r.resources){var a=r.resources;if(a instanceof y)r.resources=a.clone();else{r.resources=new y;for(var s in a)r.resources.add(a[s])}}else r.resources=new y;try{i.PAssert(4958,r.draftID||r.messageID||i.isTempId(r.id),"Remotely saved messages must have a valid message ID")}catch(e){i.reportError(e)}try{i.PAssert(4959,i.isDateValid(r.date),"Must have a valid message date: ",r.date)}catch(e){i.reportError(e)}try{i.PAssert(4960,i.isDateValid(r.internalDate),"Must have a valid internal message date: ",r.internalDate)}catch(e){i.reportError(e)}!i.isTempId(r.id)&&!r.draftID&&r.labelIds&&r.labelIds.indexOf(A.DRAFT)>=0&&this._notifyDraftMessage(t.accountID,e,r.id),r.decoded&&this.reportTrackedStat(D.MessageDataCached)}return this._updateThreadFromMessages(t),t},_updateMessageData:function(e,t,n){var r=e.getField("messages"),a=r.indexOfWithProperty("id",t);try{i.PAssert(4961,a>=0,"Must always be able to find the message being updated")}catch(e){i.reportError(e)}a>=0&&(this._mergeMessageData(r[a],n,["labelIds"]),r[a]=n,e.updateField("messages",r),this._updateAttachmentFromMessages(e,ChangeType.Remote))},_mergeMessageData:function(e,t,n){try{i.PAssert(4962,i.isObject(e),"Must pass in a valid old message")}catch(e){i.reportError(e)}try{i.PAssert(4963,i.isObject(t),"Must pass in a valid new message")}catch(e){i.reportError(e)}if(e.modifiedOffline){var r=e.modifiedOffline;try{i.PAssert(4964,i.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(e){i.reportError(e)}for(var a=0;a<r.length;++a)t[r[a]]=e[r[a]];t.modifiedOffline=e.modifiedOffline}if(n)for(var a=0;a<n.length;++a)e.hasOwnProperty(n[a])&&(t[n[a]]=e[n[a]]);for(var s in e)switch(s){case"snippet":this._pendingDraftUpdates[e.id]&&(t[s]=e[s]);break;default:t.hasOwnProperty(s)||(t[s]=e[s])}},_mergeMessagesData:function(e,t,n){try{i.PAssert(4965,i.isArray(e),"Must have a valid old messages array")}catch(e){i.reportError(e)}try{i.PAssert(4966,i.isArray(t),"Must have a valid new messages array")}catch(e){i.reportError(e)}try{i.PAssert(4967,e!==t,"Should not pass in the same array for old and new")}catch(e){i.reportError(e)}for(var r=0;r<e.length;++r){var a=e[r],s=t.indexOfWithProperty("id",a.id);if(s>=0){var o=t[s];try{i.PAssert(4968,o,"Must have a valid new message")}catch(e){i.reportError(e)}this._mergeMessageData(a,o,n)}else if(a.labelIds.indexOf(A.DRAFT)>=0)if(i.isTempId(a.id)){var c=t.indexOfWithProperty("messageID",a.inReplyTo);try{i.PAssert(4969,c>=0,"Must be able to find the message being replied to")}catch(e){i.reportError(e)}c>=0&&t.splice(c+1,0,a)}else if(a.inReplyTo){var l=t.indexOfWithProperty("inReplyTo",a.inReplyTo);if(l>=0){var o=t[l];try{i.PAssert(4970,o,"Must have a valid new message")}catch(e){i.reportError(e)}this._mergeMessageData(a,o,n)}}else try{i.PAssert(4971,!1,"Message is not in reply to anything and ID is not found: ",a.id,t.length,e.length)}catch(e){i.reportError(e)}}},_mergeThreadData:function(e,t){this.reportTrackedStat(D.MergeThread);try{i.PAssert(4972,!e.isDeleted,"Should never merge message data in a deleted thread")}catch(e){i.reportError(e)}if(this._mergeMessagesData(e.messages,t.messages,["resources","draftID"]),e.modifiedOffline){var n=e.modifiedOffline;try{i.PAssert(4973,i.isArray(n),"Should not be receiving an update for an event that was created locally")}catch(e){i.reportError(e)}for(var r=0;r<n.length;++r){var a=n[r];switch(a){case"messages":break;default:t[a]=e[a]}}t.modifiedOffline=e.modifiedOffline}for(var a in e)t.hasOwnProperty(a)||(t[a]=e[a]);t.labelIds=e.labelIds},_shouldCacheThread:function(e){for(var t=!0,i=0;i<e.messages.length;++i){var n=e.messages[i];if(n.labelIds&&(n.labelIds.indexOf(A.SPAM)>=0||n.labelIds.indexOf(A.CHAT)>=0)){t=!1;break}}return t},_shouldCacheMessageData:function(e){var t=!1,i=this._getFullSyncTime(),n=this._getUnreadSyncTime();if(e.date.isAfter(i))t=!0;else if(e.date.isAfter(n))for(var r=0;r<e.messages.length;++r){var a=e.messages[r];if(this.isPriorityData(a)){t=!0;break}}return t},refreshThreadCacheData:function(e,t,i,r,a){this._requestRemoteThreadMetadata(e,t,void 0,function(i,s){if(i)if(this._shouldCacheThread(i)){var o=this._addRemoteEntry(e,i);this.cacheThreadData(t,this.serializeExternalData(o),a)}else this._deleteCachedThread(e,t,a);else s&&s.error&&s.error.code===n.HTTPStatusCode.NotFound?this._deleteCachedThread(e,t,a):(r(e,t),a&&a(!1))}.bind(this))},_deleteCachedThread:function(e,t,n){if(this.hasCacheData(t)){for(var r=this.getAttachment(t),a=r.getField("messages"),s=0;s<a.length;++s)i.menus.isComposeOpenForEmail(a[s].id)&&(this._clearPendingDraftUpdate(r,a[s].id),h.fireEvent("EmailCompose","onClosed",[]),i.menus.closeComposeEmail(r,a[s])),this._rawCache.removeEntry(a[s].id);r.updateField("isDeleted",!0),r.updateField("messages",[]),this._updateAttachmentFromMessages(r,ChangeType.Remote)}this._threadCache.removeEntry(t,function(e){try{i.PAssert(4974,e,"Should be able to delete the thread from the local thread cache")}catch(e){i.reportError(e)}n&&n(e)})},_deleteCachedMessage:function(e,t,n){try{i.PAssert(4975,n,"Must specify a valid message ID to remove from thread")}catch(e){i.reportError(e)}if(this.hasCacheData(t))for(var r=this.getAttachment(t),a=r.getField("messages"),s=0;s<a.length;++s)if(a[s].id===n){a.removeAt(s),this._updateAttachmentFromMessages(r,ChangeType.Remote),r.updateField("messages",a);break}this._threadCache.getEntry(t,function(e){if(e)for(var i=0;i<e.messages.length;++i)if(e.messages[i].id===n){e.messages.removeAt(i),this.cacheThreadData(t,e);break}}.bind(this)),this._rawCache.removeEntry(n)},setLastModifiedDate:function(e,t,i){if(this.hasCacheData(t)){this.getAttachment(t).updateField("lastModifiedDate",i)}this._threadCache.getEntry(t,function(e){e&&(e.lastModifiedDate=i,this.cacheThreadData(t,e))}.bind(this))},addLabelsToMessage:function(e,t,n,r,a){if(this.hasCacheData(t)){for(var s=this.getAttachment(t),o=s.getField("messages"),c=0;c<o.length&&(n&&o[c].id!==n||(o[c].labelIds.pushOnlyUniques(r),!n));++c);this._updateAttachmentFromMessages(s,a),s.updateField("messages",o)}this._threadCache.getEntry(t,function(e){if(e){for(var a=!1,s=0;s<e.messages.length;++s)if(!n||e.messages[s].id===n){e.messages[s].labelIds.pushOnlyUniques(r),this.cacheThreadData(t,e),a=!0;break}try{i.PAssert(4977,a,"Must have found message to add labels to")}catch(e){i.reportError(e)}}}.bind(this))},removeLabelsFromMessage:function(e,t,n,r,a){if(this.hasCacheData(t)){for(var s=this.getAttachment(t),o=s.getField("messages"),c=0;c<o.length;++c)if(!n||o[c].id===n){for(var l=0;l<r.length;++l)o[c].labelIds.remove(r[l]);if(n)break}this._updateAttachmentFromMessages(s,a),s.updateField("messages",o)}this._threadCache.getEntry(t,function(e){if(e){for(var a=!1,s=0;s<e.messages.length;++s)if(!n||e.messages[s].id===n){for(var o=0;o<r.length;++o)e.messages[s].labelIds.remove(r[o]);this.cacheThreadData(t,e),a=!0;break}try{i.PAssert(4978,a,"Must have found message to remove labels from")}catch(e){i.reportError(e)}}}.bind(this))},changeMessageAccount:function(e,t,n,r,a,s){try{i.PAssert(4979,s,"Must supply a valid from contact")}catch(e){i.reportError(e)}var o=r!==e.getField("accountID"),c=this._findDraft(e,t,n);return o&&this.discardDraft(e,c.id,c.draftID,function(e){try{i.PAssert(4980,e,"Must successfully delete remote draft")}catch(e){i.reportError(e)}}),c.from=s,c.replyTo=this.getReplyToAddress(s.email),c.decoded=P.replaceSignature(c.decoded,this.getSignature(a)),o?this.createDraft(r,void 0,void 0,c):this.updateDraft(e,c.id,c.draftID,c,c.snippet,!0,!0,function(e){try{i.PAssert(4981,e,"Must be able to successfully update the draft when swiching sending accounts")}catch(e){i.reportError(e)}})},_ensureVMLIsForSearchResult:function(e,t){try{i.PAssert(4982,t,"Should never be ensuring a search VMLI in the default item store")}catch(e){i.reportError(e)}var n="S~"+e.accountID,r=this._ensureVMLIsForAccount(n,t),a=this._createThreadID(n,"",e.id);if(!t.hasItem(a)){var s=t.createItem(a,this._getTextForItem(e),r.id);r.insertSorted(s,this.sortFn)}},_removeVMLIFromSearchResult:function(e,t){try{i.PAssert(4983,t,"Should never be ensuring a search VMLI in the default item store")}catch(e){i.reportError(e)}var n="S~"+e.accountID,r=this._createThreadID(n,"",e.id);t.hasItem(r)&&t.destroyItem(r)},_createThreadID:function(e,t,i){return"T~"+e+"~"+t+"~"+i},_getItemProps:function(e,t){var i;return t.isNamed(x.PRI0)?i={priority:VMLIFlag.P0}:t.isNamed(x.PRI1)?i={priority:VMLIFlag.P1}:t.isNamed(x.PRI2)&&(i={priority:VMLIFlag.P2}),i},_ensureThreadLabelVMLI:function(e,t,i){var i=i||this.getDefaultItemStore(),n=this._getLabelByID(e.accountID,t),r=this._ensureVMLIsForLabel(e.accountID,n,i),a=this._createThreadID(e.accountID,t,e.id);this.reportTrackedStat(D.EnsureLabelVMLI);var s;if(i.hasItem(a))s=i.getItem(a);else{this.reportTrackedStat(D.CreateLabelVMLI);var o=this._getItemProps(e,n);s=i.createItem(a,this._getTextForItem(e),r.id,o),r.insertSorted(s,this.threadSortFn,!1)}return s},_removeThreadLabelVMLI:function(e,t,i,n){var n=n||this.getDefaultItemStore(),r=this._createThreadID(e,i,t);n.hasItem(r)&&n.destroyItem(r)},_getRequiredSearchLabels:function(e){for(var t=[A.INBOX],i=e.split(" "),n=0;n<i.length;++n){var r=i[n],a=r.split(":");a&&2===a.length&&("label"!==a[0]&&"category"!==a[0]&&"is"!==a[0]||t.push(a[1].toUpperCase()))}return t},_handleThreadLabelUpdates:function(e,t,n){i.vmMain.beginUpdateItems();var r=!1;if(t)for(var a=0;a<t.length;++a)r|=this._addEmailLabelToSearchCache(e.accountID,e.id,t[a]);if(n)for(var a=0;a<n.length;++a)r|=this._removeEmailLabelFromSearchCache(e.accountID,e.id,n[a]);this._updateSpecialLabels(e),this._updateSearchPanes(e,t,n),r&&this.getDefaultItemStore().updateItems(),i.vmMain.commitUpdateItems()},_updateSearchPanes:function(e,t,n){i.vmMain.beginUpdateItems(),i.vmMain.paneManager.runForEachPane(function(r){if(r.isSearchingRemote()){var a=this.getActiveItemStore(r.id),s=r.search.getRemoteValue(),o=this._getRequiredSearchLabels(s),c=!1,l=!1
;o.forEach(function(e){n&&n.indexOf(e)>=0?c=!0:t&&t.indexOf(e)>=0&&(l=!0)}),c?a!==this.getDefaultItemStore()&&(i.focusedPane===r&&0===t.length&&n&&1===n.length&&n[0]===A.UNREAD||this._removeVMLIFromSearchResult(e,a)):l&&a!==this.getDefaultItemStore()&&this._ensureVMLIsForSearchResult(e,a)}}.bind(this),this.getPaneType()),i.vmMain.commitUpdateItems()},_updateSpecialLabels:function(e){this._threadIsArchived(e)?this._addEmailLabelToSearchCache(e.accountID,e.id,k.ARCHIVED):this._removeEmailLabelFromSearchCache(e.accountID,e.id,k.ARCHIVED),this._addEmailLabelToSearchCache(e.accountID,e.id,k.ALLMAIL)},_ensureVMLIsForAccount:function(e,t){try{i.PAssert(4984,e,"Must specify a valid account ID")}catch(e){i.reportError(e)}var t=t||this.getDefaultItemStore(),n="A~"+e,r=t.getItem(n);if(!r){var a=t.getRoot();r=t.createItem(n,e,a.id),a.insertSorted(r,this.sortFn)}return r},_ensureVMLIsForLabel:function(e,t,n){try{i.PAssert(4985,t,"Must specify a valid label")}catch(e){i.reportError(e)}try{i.PAssert(4986,t instanceof g,"Must pass in a valid label object")}catch(e){i.reportError(e)}var n=n||this.getDefaultItemStore(),r="L~"+e+"~"+t.getLabelID(),a=n.getItem(r),s=t.getDisplayText(!0);if(a)a.getParsedText()!==s&&a.setText(s,!0,ChangeType.Auto);else{var o;if(t.hasAncestors()){var c=this._getLabelByName(e,t.getParent().getRawName(),!0);o=c?this._ensureVMLIsForLabel(e,c,n):this._ensureVMLIsForAccount(e,n)}else o=this._ensureVMLIsForAccount(e,n);a=n.createItem(r,s,o.id),o.insertSorted(a,this.sortFn)}return a},getVMLIForAccount:function(e){return this._ensureVMLIsForAccount(e)},getVMLIForLabel:function(e,t){return this._ensureVMLIsForLabel(e,t)},getLabelForVMLI:function(e){var t,i=this.getDescriptorForItem(e);return i.accountID&&i.labelID&&(t=this._getLabelByID(i.accountID,i.labelID)),t},_getAccountIDFromItem:function(e){var t,n=e.id;n.startsWith("R~")&&(n=n.substr(2)),n.startsWith("A~")?(t=n.substr(2),t.startsWith("S~")&&(t=t.substr(2))):n.startsWith("L~")?t=n.substring(2,n.indexOf("~",2)):n.startsWith("T~")&&(t=n.substring(2,n.indexOf("~",2)));try{i.PAssert(4987,!t||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(e){i.reportError(e)}return t},_getLabelIDFromItem:function(e){var t,n=e.id;n.startsWith("L~")?t=n.substr(n.indexOf("~",2)+1):n.startsWith("T~")&&(t=n.substr(n.indexOf("~",2)+1));try{i.PAssert(4988,!t||i.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(e){i.reportError(e)}try{i.PAssert(4989,!t||t.length>3,"Label ID should be longer than a couple of chars")}catch(e){i.reportError(e)}return t},_getThreadIDFromItem:function(e){return this._getThreadID(e.id)},_getThreadID:function(e){var t;e.startsWith("T~")?t=e.substr(e.lastIndexOf("~")+1):e.startsWith("A~")||e.startsWith("L~")||e.startsWith("R~")||(t=e);try{i.PAssert(4990,!t||i.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in thread ID")}catch(e){i.reportError(e)}try{i.PAssert(4991,!t||t.length>3,"Thread ID should be longer than a couple of chars")}catch(e){i.reportError(e)}return t},isAccountItem:function(e){return e.id.startsWith("A~")},isLabelItem:function(e){return e.id.startsWith("L~")},isThreadItem:function(e){return e.id.startsWith("T~")},getAttachmentClass:function(){return["plugin_gmail"]},googleScopes:function(){return[GScope.GmailModify,GScope.GmailCompose]},getDependencies:function(){return[PluginDependency.LocalLoaded,PluginDependency.GoogleLogin]},isDependencyLoaded:function(e,t){var i=!1;switch(e){case PluginDependency.GoogleLogin:t&&t.indexOf(GScope.GmailModify)>=0&&(i=!0);break;default:i=!0}return i},verifyAuthorization:function(e){var t=this.getSyncAccounts();return t.indexOf(e)>=0?p.verifyLinkedTokenScopes(e,this.googleScopes()):[]},handleUnauthorized:function(e,t){this.isDefaultEmail(e)?this.setSetting(this.Settings.IsEnabled,!1):this.removeSyncAccount(e)},_activate:function(){var e=this.getDefaultAccount();this.hasSyncAccount(e)||this.addSyncAccount(e)},_deactivate:function(){},handleTapStart:function(e,t,i,n){return!0},handleTapClick:function(e,t,n,r){var a=r.target;try{i.PAssert(4992,t,"Gmail tapped but is not actually a pane",i.getElementPath(a))}catch(e){i.reportError(e)}if(t&&(s.mobile||!this.isPluginPane(t)))return this.openEmailByItem(e,t)},handleDoubleTap:function(e,t,n,r){this.openEmailByItem(e,t),s.mobile&&(r.preventDefault(),i.preventClick())},isMyAccountID:function(e){try{i.PAssert(4993,"me"!==e||i.isDemoMode(),"Should not be checking me")}catch(e){i.reportError(e)}var t=i.getUserIdentifier();try{i.PAssert(4994,i.isDemoMode()||"me"!==t,"Should not be checking against current account until loaded")}catch(e){i.reportError(e)}return e===t},createURLForThread:function(e){var t=e.getField("accountID");return"me"===t&&(t=i.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"#all/"+e.id},createPrintURLForThread:function(e){var t=e.getField("accountID");return"me"===t&&(t=i.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"/?ui=2&view=pt&search=all&th="+e.id},openEmailByItem:function(e,t,n){var r=e.getAttachmentByPlugin(PluginID.Gmail);if(r&&r!==C.getThreadAttach()||!C.isOpenOnPane(this)||n){if(this.getCacheData(r.id)){return this.isAttachmentDraftOnly(r)?(this.sendEvent("Tap_DesktopDraft"),this.loadThread(r,function(e){i.menus.openComposeEmail(this,r.id)}.bind(this))):C.open(e,r,t,n),!0}}},_convertRawMessage:function(e,t,n,r){var a={id:t,payload:n},s=this._getMessageFromAttachment(e,t);try{i.PAssert(4995,s,"Must be able to get message metadata")}catch(e){i.reportError(e)}a.labelIds=s.labelIds,a.messageID=s.messageID,a.snippet=s.snippet,a.internalDate=n.internalDate,r(a)},getThreadData:function(e,t,i){if(0!==e.getField("messages").length)return this._getThreadData(e,t,i);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,void 0,function(r,a){var s=!0;r?this._addRemoteEntry(e.getField("accountID"),r):a&&a.error&&a.error.code===n.HTTPStatusCode.NotFound&&(s=!1),s?this._getThreadData(e,t,i):t(!1,"The conversation that you requested no longer exists.")}.bind(this))},_getThreadData:function(e,t,r){function a(){if(c===o&&d){for(var e={messages:[]},n=0,r=0;r<s.length;++r){var a=h[s[r].id];a?e.messages.push(a):++n}try{i.PAssert(4996,e.messages.length+n===s.length,"Messages should always be found for thread")}catch(e){i.reportError(e)}0===s.length?t(void 0,"This message is not cached locally and we could not contact the remote server."):t(e)}}for(var s=e.getField("messages"),o=s.length,c=0,l=0,d=!1,h={},u=0;u<s.length;++u){var p=s[u];this.getMessageData(e,p.id,function(e,t){e?h[e.id]=e:i.isHTTPStatusCode(t,n.HTTPStatusCode.NotFound)&&++l,++c,a()}.bind(this),r)}d=!0,setTimeout(a.bind(this),0)},getMessageData:function(e,t,i,n){this._rawCache.getEntry(t,function(n){n?this._convertRawMessage(e,t,n,i):(log("Warning: Local message cache missing email display data: ",e.id,t),this._requestRemoteMessageDataRaw(e.getField("accountID"),e.id,t,i))}.bind(this))},_handleThreadLoaded:function(e,t,n,r){var a=this._pendingThreadLoads[e];try{i.PAssert(4997,a,"Must always have a valid pending load when handling laod")}catch(e){i.reportError(e)}if(delete this._pendingThreadLoads[e],a)for(var s=0;s<a.length;++s)try{a[s](t,n,r)}catch(e){i.reportError(e)}},loadThread:function(e,t){try{i.PAssert(4998,0===this._loadThreadMutex,"Should never have an outstanding lock on thread load")}catch(e){i.reportError(e)}this._loadThreadMutex++;var n=e.getField("accountID");p.isAuthorized(n,GScope.GmailModify)?this._loadThread(e,t,8e3):p.onUserAuthorized(n,function(){p.isAuthorized(n,GScope.GmailModify)?this._loadThread(e,t,8e3):t(!1,!1,"This thread belongs to an account ("+e.getField("accountID")+") you are not authorized to access.")}.bind(this),8e3),this._loadThreadMutex--},_loadThread:function(e,t,n){var r=this.isAttachmentDraftOnly(e),a=this._pendingThreadLoads[e.id];if(a)log("Duped pending thread load: ",e.id),a.push(t);else if(this._pendingThreadLoads[e.id]=[t],e.getField("dataLoaded")||e.isLocalOnlyAttachment()){for(var s=e.getField("messages"),o=!1,c=!1,l=0,d=0,h=s.length,u=0,p=function(){o&&l===d&&(h===u&&(c=!0),setTimeout(function(){this._handleThreadLoaded(e.id,!0,c)}.bind(this),0))}.bind(this),m=0;m<s.length;++m){var f=s[m];void 0===f.decoded?(f.decoded="",l++,this.getMessageData(e,f.id,function(t){if(d++,t){""===t.decoded&&(t.decoded=void 0);var n=this._parseMailMessage(t);try{i.PAssert(4999,n,"Must be able to parse message")}catch(e){i.reportError(e)}this._updateMessageData(e,n.id,n),c=!0}p()}.bind(this),n)):(f.decoded||f.labelIds.indexOf(A.DRAFT)>=0)&&u++}o=!0,p()}else if(r){var g=e.getField("messages")[0];this.getMessageData(e,g.id,function(t){if(t){var n=this._parseMailMessage(t);try{i.PAssert(5e3,n,"Must be able to parse message")}catch(e){i.reportError(e)}this._updateMessageData(e,n.id,n)}c=!0,this._handleThreadLoaded(e.id,!0,c)}.bind(this),n)}else this.getThreadData(e,function(t,i){t&&this._parseMailThread(e,t),c=!0,this._handleThreadLoaded(e.id,!!e.getField("dataLoaded"),c,i)}.bind(this),n)},forceReloadMessage:function(e,t,i){this._requestRemoteMessageData(e,t,i)},_verifyEmailAttachments:function(e,t,n){var r,a,s=this._findDraft(e,t,n);return s?s.resources.forEachResource(function(e){e.uploader&&(e.uploader.hasError()?r="There was an error uploading one or more attachments. Please remove them or try uploading again.":e.uploader.isDone()||(r="One or more of your attachments is still uploading.",a=function(e){this.onEmailReadyToSend(s,function(){i.toasts.clearMessage(e)})}.bind(this)))}.bind(this)):r="Could not find message to verify attachments.",r?{message:r,handleMessageFn:a}:void 0},_verifyEmailRecipients:function(e,t,n){var r,a=this._findDraft(e,t,n);if(a)if(a.to&&0!==a.to.length)for(var s=0;s<a.to.length;++s){var o=a.to[s];o&&o.email?i.isEmail(o.email)||(r="You have entered an invalid email"):r="You have entered a contact with an invalid email address"}else r="You must enter at least one person to send this email to";else r="Unable to find the message you are trying to send";return r?{message:r}:void 0},_formatAddressText:function(e,t,n){return e?n?'"'+i.encodeMIMEHeader(e)+'" <'+t+">":'"'+e+'" <'+t+">":t},_createAddressTextFromTokens:function(e,t){var n="";if(e)for(var r=0;r<e.length;++r){var a=e[r];i.isEmail(a.email)&&(0!==r&&(n+=", "),n+=this._formatAddressText(a.text,a.email,t))}try{i.PAssert(5001,!n.startsWith(","),"Should not start with a comma")}catch(e){i.reportError(e)}try{i.PAssert(5002,!n.endsWith(","),"Should not end with a comma")}catch(e){i.reportError(e)}try{i.PAssert(5003,n.indexOf(",,")<0,"Should not have two commas in a row")}catch(e){i.reportError(e)}return n.trim()},_createRFC822Message:function(e,t,n,r){try{i.PAssert(5004,t,"Must specify a valid draft")}catch(e){i.reportError(e)}try{i.PAssert(5005,t.contentType,"Must specify a valid content type for the draft")}catch(e){i.reportError(e)}try{i.PAssert(5006,t.from,"Must be able to get the from information for a user.")}catch(e){i.reportError(e)}try{i.PAssert(5007,!t.inReplyTo||t.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+t.inReplyTo)}catch(e){i.reportError(e)}try{i.PAssert(5008,!t.references||t.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+t.references)}catch(e){i.reportError(e)}var a=t.from.text,s=t.from.email,o=new v(this);o.updateFromDraft(e,t,a,s,n,function(){var e=o.generateBlob();r(this._encodeEmail(e))}.bind(this))},createSignature:function(e){var t=this.getSignature(e);return t?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+t+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+t+"</div>":'<div class="gmail_signature"></div>'},createReplyQuote:function(e){var t;if(e){t='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+e.date.toString("MMM dd, y")+" at "+e.date.toString("hh:mm tt")+", "+i.escape(this._createAddressTextFromTokens([e.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+e.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n"}return t},createForwardQuote:function(e){var t,n=i.isArray(e.to)?e.to:[e.to];return e&&(t='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+i.escape(this._createAddressTextFromTokens([e.from]))+"<br>\nDate: "+e.date.toString("ddd, MMM dd, y")+" at "+e.date.toString("hh:mm tt")+"<br>\nSubject: "+e.subject+"<br>\nTo: "+i.escape(this._createAddressTextFromTokens(n))+"\n<br>\n<br>\n"+e.decoded+"\n</div>\n<br>\n"),t},createMessageBody:function(e,t,r){var a,s=this.createSignature(t);if(r===n.EmailResponseMode.Reply||r===n.EmailResponseMode.ReplyAll)a=this.createReplyQuote(e);else if(r===n.EmailResponseMode.Forward)a=this.createForwardQuote(e);else try{i.PAssert(5009,!1,"Invalid email response mode: "+r)}catch(e){i.reportError(e)}return this.getSetting(this.Settings.InsertSignatureAboveReplies)?s+a:a+s},_sendEmail:function(e,t,i,n){this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t);var r=this._findDraft(e,t,i);this._createRFC822Message(e.getData(),r,!0,function(t){var i=function(t){this._updateLocalDraftFromSend(e,r.id,t,n)}.bind(this),a=function(t){this._notifySendFailed(),n(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this),s={raw:t};e.isLocalOnlyAttachment()||(s.threadId=e.id);var o=c.fns("gmail").users.messages.send.packedFn,l={userId:e.getField("accountID"),resource:s};this._queueRemoteRequestMulti(e.getField("accountID"),o,l,i,a,void 0,_.Send)}.bind(this))},_shouldSaveMessageContent:function(e,t){return t.labelIds.indexOf(A.DRAFT)>=0},compactCacheField:function(e,t){var n;switch(t){case"messages":n=[];for(var r=e[t],a=0;a<r.length;++a){for(var s=r[a],o={},c=0;c<R.length;++c)o[R[c]]=s[R[c]];this._shouldSaveMessageContent(e,s)||(delete o.decoded,delete o.mimeType,delete o.contentType,delete o.listUnsubscribe);var l={};o.resources.forEachResource(function(e){var t=i.clone(e);delete t.data,delete t.size,delete t.uploader,l[e.id]=t}),o.resources=l,n.push(o)}break;default:n=e[t]}return n},_generateUndoRedo:function(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,n.PluginAction.Gmail.DiscardDraft,{undo:i.emptyFn,redo:this.runDiscardDraft})},performAction:function(e,t,n,r,a){try{i.PAssert(5010,e,"Must supply a valid action")}catch(e){i.reportError(e)}try{i.PAssert(5011,i.isBoolean(t),"Invalid preventUndo param")}catch(e){i.reportError(e)}this.beginAction(t);var s,o=[n,r,a];try{s=this._undoStack.runAction(this.id,e,o)}catch(e){i.reportError(e)}if(this._undoStack.isUndoableAction()){var c=[n];i.isArray(s)?c.pushArray(s):c.push(s),this._undoStack.performAction(this.id,e,{undoParams:c,redoParams:o})}this.endAction()},performActions:function(e,t){this.beginAction(t);for(var i=0;i<e.length;++i)this.performAction(e[i].action,e[i].attach,e[i].param);this.endAction()},beginAction:function(e){this._undoStack.beginAction(e),o.beginAction()},endAction:function(){this._undoStack.endAction(),o.endAction()},handleUndo:function(){o.beginAction(),this._undoStack.undoAction(),o.endAction()},handleRedo:function(){o.beginAction(),this._undoStack.redoAction(),o.endAction()},supportOfflineCache:function(){return!0},supportOfflineLoad:function(){return!0},usesPreviewCache:function(){return!0},_matchParticipant:function(e,t){var i=!1;return e&&(e.text&&(i=e.text.toLowerCase().indexOf(t)>=0),!i&&e.email&&(i=e.email.toLowerCase().indexOf(t)>=0)),i},_matchLabels:function(e,t){return this.hasLabelLike(e.accountID,e.id,t)},_matchEntry:function(e,t){return e.subjectLower.indexOf(t)>=0||this._matchParticipant(e.from,t)||this._matchLabels(e,t)},matchAttachment:function(e,t){return this._matchEntry(e.getData(),t)},findMatchExact:function(e){},findMatchLike:function(e,t){var i=e.toLowerCase();return this.findCachedItemsByFn(function(e){return this._matchEntry(e,i)}.bind(this),t)},previewTemplate:function(){},getItemText:function(e){return this.getAttachmentEmbedString(e)},getItemTextLength:function(e){return 1},autocompleteWidth:function(){return 350},getAutocompletePrefixes:function(){return["g:","gmail:"]},isGmailItem:function(e){return!!e.getAttachmentByPlugin(this.id)},itemHasLabelByID:function(e,t){var i=e.getAttachmentByPlugin(this.id);return!!i&&this.attachmentHasLabelByID(i,t)},itemHasLabel:function(e,t){var i=e.getAttachmentByPlugin(this.id);return!!i&&this.attachmentHasLabel(i,t)},itemHasFullLabel:function(e,t){var i=e.getAttachmentByPlugin(this.id);return!!i&&this.attachmentHasFullLabel(i,t)},itemHasDraft:function(e){return this.itemHasLabelByID(e,A.DRAFT)},isItemUnread:function(e){return this.itemHasLabelByID(e,A.UNREAD)},isItemImportant:function(e){return this.itemHasLabelByID(e,A.IMPORTANT)},isItemStarred:function(e){return this.itemHasLabelByID(e,A.STARRED)},isItemArchived:function(e){var t=e.getAttachmentByPlugin(this.id);return!!t&&this.attachmentIsArchived(t)},isItemTrashed:function(e){return this.itemHasLabelByID(e,A.TRASH)},isItemFullTrashed:function(e){return this.itemHasFullLabel(e,w.TRASH)},isItemSpam:function(e){return this.itemHasLabelByID(e,A.SPAM)},isDisplayItem:function(e,t){var i=!1;return this.isItemSpam(e)||!this.isThreadItem(e)||this.isItemFullTrashed(e)&&!t||(i=!0),i},getItemPriority:function(e){return e.hasPluginAttachment(this.id)?this.getAttachmentPriority(e.getAttachmentByPlugin(this.id)):0},_getCompDateForItem:function(e){var t=0,i=e.getAttachmentByPlugin(this.id);if(i){var n=i.getField("lastModifiedDate");if(n)t=n.getTime();else{var r=i.getField("internalDate");r&&(t=r.getTime())}}return t},_timeCompare:function(e,t){return e>t?1:e<t?-1:0},threadSortFn:function(e,t){return this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))},threadSortPriorityFn:function(e,t){var i=e.getAttachmentByPlugin(this.id),n=t.getAttachmentByPlugin(this.id),r=this.getAttachmentPriority(i),a=this.getAttachmentPriority(n),s=this.attachmentHasLabelByID(i,A.STARRED),o=this.attachmentHasLabelByID(n,A.STARRED);return r>a?-1:r<a?1:s&&!o?-1:o&&!s?1:this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))},labelSortFn:function(e,t){return e.displayCompare(t)},labelVMLISortFn:function(e,t){var i=this._getLabelByID(this._getAccountIDFromItem(e),this._getLabelIDFromItem(e)),n=this._getLabelByID(this._getAccountIDFromItem(t),this._getLabelIDFromItem(t));return this.labelSortFn(i,n)},sortFn:function(e,t){return e.getParsedText().localeCompare(t.getParsedText())},getCssClass:function(e,t){if(t&&t.type===this.getPaneType())return i.classNames({starred:this.attachmentHasLabelByID(e,A.STARRED)},{unread:this.attachmentHasLabelByID(e,A.UNREAD)},{p0:this.attachmentHasLabel(e,x.PRI0)},{p1:this.attachmentHasLabel(e,x.PRI1)},{p2:this.attachmentHasLabel(e,x.PRI2)})},getTotalMessageCount:function(e){var t=this._threadCache;t.onCacheReady(function(){t.count(e)})},getSyncdMessageCount:function(e){var t=this._rawCache;t.onCacheReady(function(){t.count(e)})},getUnsyncdMessageCount:function(){return this._numUnsyncdMessages},getSyncdMessageCount:function(){return this._numSyncdMessages},_checkUnsyncdMessageContent:function(e){for(var t=0;t<e.messages.length;++t){var i=e.messages[t];i.cached?(this.reportTrackedStat(D.SyncdMessage),this._numSyncdMessages++):i.cachedError?this.reportTrackedStat(D.ErrorSyncdMessage):this._shouldCacheMessageData(e)?(this.reportTrackedStat(D.UnsyncdMessage),this._notifyUnsyncdMessage(e.accountID,e.id,i.id)):this.reportTrackedStat(D.OldUnsyncdMessage)}},_notifyUnsyncdMessage:function(e,t,n){i.isTempId(t)||i.isTempId(n)||(this._handleSyncContentCacheOp(this._unsyncdMessages,e,t,n),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())},_notifyContentCached:function(e,t,i){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,e,t,i)},_handleSyncContentCacheOp:function(e,t,i,n){var r=this._ensureAccountLib(t,e);r[i]?!0!==r[i]&&r[i].indexOf(n)<0&&r[i].push(n):r[i]=!n||[n]},_removeUnsyncdMessage:function(e,t,n){this.reportTrackedStat(D.MessagesSyncd),this._numUnsyncdMessages--;var r=this._getAccountLib(e,this._unsyncdMessages);if(n){var a=r[t];a.remove(n),0===a.length&&delete r[t]}else delete r[t];i.isEmpty(r)&&this._deleteAccountLib(e,this._unsyncdMessages)},_setCachedFieldForMessage:function(e,t,i){if(this.hasCacheData(t))for(var n=this.getAttachment(t),r=n.getField("messages"),a=0;a<r.length;++a)(!0===i||i.indexOf(r[a].id)>=0)&&(r[a].cached=!0);this._threadCache.getEntry(t,function(e){if(e){for(var n=0;n<e.messages.length;++n){var r=e.messages[n];(!0===i||i.indexOf(r.id)>=0)&&(r.cached=!0)}this.cacheThreadData(t,e)}}.bind(this))},_updateCachedErrorFieldForMessage:function(e,t,i){if(this.hasCacheData(t))for(var n=this.getAttachment(t),r=n.getField("messages"),a=0;a<r.length;++a)(!0===i||i.indexOf(r[a].id)>=0)&&(r[a].cachedError?r[a].cachedError++:r[a].cachedError=1);this._threadCache.getEntry(t,function(e){if(e){for(var n=0;n<e.messages.length;++n){var r=e.messages[n];(!0===i||i.indexOf(r.id)>=0)&&(r.cached?r.cachedError++:r.cachedError=1)}this.cacheThreadData(t,e)}}.bind(this))},_processSyncdContent:function(){for(var e in this._pendingSyncdMessages){var t=this._pendingSyncdMessages[e];for(var n in t){var r=t[n];if(i.isArray(r)){for(var a=0;a<r.length;++a){var s=r[a];this._removeUnsyncdMessage(e,n,s)}this._setCachedFieldForMessage(e,n,r)}else!0===r&&this._removeUnsyncdMessage(e,n)}}this._pendingSyncdMessages={}},_processSyncErrors:function(e){log("Process Sync Errors: ",e);for(var t in e){var n=e[t];for(var r in n){var a=n[r];try{i.PAssert(5012,i.isArray(a),"Must have a valid message ID list")}catch(e){i.reportError(e)}for(var s=0;s<a.length;++s){var o=a[s];this._removeUnsyncdMessage(t,r,o)}this._updateCachedErrorFieldForMessage(t,r,a)}}},driveMessageContentSync:function(e){this._rawCache.onCacheReady(function(){if(i.vmMain.cacheManager.hasReportedQuotaError())return e(!1);this._outstandingContentSync=!0;this._runMessageContentSync(35,function(t,n){if(!t)try{this._processSyncErrors(n)}catch(e){i.reportError(e)}return this._processSyncdContent(),this._outstandingContentSync=!1,e(!i.isEmpty(this._unsyncdMessages))}.bind(this))}.bind(this))},_runMessageContentSync:function(e,t){function i(e,i,n){if(e?s++:(o++,c[i]=n),a&&s+o===r){var l=0===o;t(l,l?void 0:c)}}var n=0,r=0,a=!1,s=0,o=0,c={},l=this.getSyncAccounts();for(var d in this._unsyncdMessages)if(l.indexOf(d)>=0&&(n+=this._syncMessageContentForAccount(d,this._unsyncdMessages[d],e-n,i),r++,n>=e))break;return a=!0,0===n&&setTimeout(function(){t(!0)},0),n},_syncMessageContentForAccount:function(e,t,i,n){function r(t,i,r){if(t?o++:(c++,l[i]=r),o+c===s){var a=0===c;n(a,e,a?void 0:l)}}var a=0,s=0,o=0,c=0,l={};for(var d in t)if(a+=this._syncMessageContentForThread(e,d,t[d],i-a,r),s++,a>=i)break;return!0,a},_syncMessageContentForThread:function(e,t,n,r,a){function s(i,n){if(n?(l++,this._notifyContentCached(e,t,i)):d.push(i),c&&l+d.length===o){var r=0===d.length;a(r,t,r?void 0:d)}}var o=0;if(i.isArray(n)){for(var c=!1,l=0,d=[],h=0;h<n.length&&o<r;++h)this._requestRemoteMessageDataRaw(e,t,n[h],function(i,n,r){n?this._handleContentSyncdMessage(e,t,n,s.bind(this,i)):s.call(this,i,!1)}.bind(this,n[h])),o++;c=!0}else this._requestRemoteThreadDataRaw(e,t,function(i,n){i?this._handleContentSyncdThread(e,i,function(i){this._notifyContentCached(e,t),a(i,t)}.bind(this)):a(!1,t,!0)}.bind(this)),o++;return o},_handleContentSyncdMessage:function(e,t,i,n){i.payload.id=i.id,i.payload.internalDate=i.internalDate,this._rawCache.cacheEntry(i.id,i.payload,n)},_handleContentSyncdThread:function(e,t,i){for(var n=0;n<t.messages.length;++n){var r=t.messages[n];this._handleContentSyncdMessage(e,t.id,r,i)}},scheduleEmail:function(e,t){o.beginAction();var a=e.getAttachmentByPlugin(this.id);try{i.PAssert(5013,a,"Must be able to get a valid attachment from item")}catch(e){i.reportError(e)}var s=a.getField("subject"),c=this.createURLForThread(a),l=n.MSPerHour,d=i.vmMain.getDefaultCalendarPlugin();if(d){var h=d.getDefaultExportCalendarID();h&&(i.isDemoMode()||d.getSetting(d.Settings.WriteAccess))?d.createEventForEmail(h,s,c,t,l,function(e,t,n,s){e||t?t?(this.addLabelToAttachment(a,"Moo.do/Scheduled"),this.getSetting(this.Settings.ArchiveOnSchedule)&&this.archiveAttachment(a)):t||i.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:MessageAction.Okay}):i.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){r.overQuota?i.toasts.pushMessage({text:"You are offline and tour computer's storage quota has been exceeded. Please free up space on your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay}):i.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay})}})}.bind(this)):i.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:MessageAction.OpenCalendarSettings})}else i.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:MessageAction.OpenSettings});o.endAction()},getIconForLabel:function(e){switch(e.getParsedText()){case"Inbox":return"inbox2";case"Starred":return"star";case"Important":return"exclamation";case"Sent Mail":return"send";case"Draft":return"drafts";case"Archived":return"inbox";case"Trash":return"delete";case"Primary":return"user";case"Social":return"group";case"Promotions":return"tag";case"Updates":return"flag";case"Forums":return"question_answer";case"Chat":return"chat";case"Spam":return"warning"}}};return a.inherit(m,t),a.extend(t.prototype,z),t}),define("plugins/Plugin_Moodo",["globals","util","platform","apis","VMPlugin"],function(e,t,i,n,r){function a(){this._isBuiltin=!0,this._super.constructor.call(this,PluginID.Moodo,"Moodo"),this.setSetting(this.Settings.IsEnabled,!0),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.Unknown),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.Unknown)}var s={GenericSingle:1,GenericPaged:2,DrivePermissionsInsert:3,DrivePermissionsDelete:4,DrivePermissionsList:5,DriveFilesGet:6,DriveFilesList:7,DriveFilesTrash:8,DrivePropertiesInsert:9,DrivePropertiesUpdate:10,DriveParentsInsert:11,DriveParentsDelete:12,DriveChildrenList:13},o="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)",c={isPluginBlocked:function(){return!1},allowRemoteRequests:function(){return!0},getRemoteAttachmentData:function(e){this.cacheData(e.id,{})},runRemoteSingleRequest:function(e,t,i,n){this._queueRemoteRequest(e,t,i,n,void 0,s.GenericSingle)},runRemotePagedRequest:function(e,t,i,n,r,a){this._queuePagedRemoteRequest(e,t,i,n,void 0,a,r)},drivePermissionsInsert:function(t,i,r,a,o){try{e.PAssert(5014,e.isEmail(i),"Should pass in a valid email address")}catch(t){e.reportError(t)}var c=n.fns("drive").permissions.insert.packedFn,l={fileId:t,sendNotificationEmails:r,resource:{value:i,type:"user",role:"writer",withLink:!1}};this._queueRemoteRequest(c,l,a,o,void 0,s.DrivePermissionsInsert)},drivePermissionsDelete:function(e,t,i,r){var a=n.fns("drive").permissions.delete.packedFn,o={fileId:e,permissionId:t};this._queueRemoteRequest(a,o,i,r,void 0,s.DrivePermissionsDelete)},drivePermissionsList:function(e,t,i){var r=n.fns("drive").permissions.list.packedFn,a={fileId:e,fields:"items(id,name,role,type,emailAddress)"};this._queueRemoteRequest(r,a,t,i,void 0,s.DrivePermissionsList)},drivePermissionsPublic:function(e,t,i){var r=n.fns("drive").permissions.insert.packedFn,a={fileId:e,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this._queueRemoteRequest(r,a,t,i,void 0,s.DrivePermissionsInsert)},driveFilesGet:function(e,t,i){var r=n.fns("drive").files.get.packedFn,a={fileId:e,fields:o};this._queueRemoteRequest(r,a,t,i,void 0,s.DriveFilesGet)},driveFilesList:function(e,t,i,r){var a=n.fns("drive").files.list.packedFn,o={q:e,fields:"items(createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)),nextPageToken"};this.runRemotePagedRequest(a,o,t,i,r,s.DriveFilesList)},driveFilesTrash:function(e,t,i){var r=n.fns("drive").files.trash.packedFn,a={fileId:e};this._queueRemoteRequest(r,a,t,i,void 0,s.DriveFilesTrash)},driveFilesUntrash:function(e,t,i){var r=n.fns("drive").files.untrash.packedFn,a={fileId:e};this._queueRemoteRequest(r,a,t,i,void 0,s.DriveFilesTrash)},drivePropertiesInsert:function(e,t,i,r,a){var o=n.fns("drive").properties.insert.packedFn,c={fileId:e,resource:{key:t,value:i,visibility:"PRIVATE"}};this._queueRemoteRequest(o,c,r,a,void 0,s.DrivePropertiesInsert)},drivePropertiesUpdate:function(e,t,i,r,a){var o=n.fns("drive").properties.update.packedFn,c={fileId:e,propertyKey:t,resource:{key:t,value:i,visibility:"PRIVATE"}};this._queueRemoteRequest(o,c,r,a,void 0,s.DrivePropertiesUpdate)},driveParentsInsert:function(e,t,i,r){var a=n.fns("drive").parents.insert.packedFn,o={fileId:e,resource:{id:t}};this._queueRemoteRequest(a,o,i,r,void 0,s.DriveParentsInsert)},driveParentsDelete:function(e,t,i,r){var a=n.fns("drive").parents.delete.packedFn,o={fileId:e,parentId:t};this._queueRemoteRequest(a,o,i,r,void 0,s.DriveParentsDelete)},driveChildrenList:function(e,t,i,r){var a=n.fns("drive").children.list.packedFn,o={folderId:e,fields:"items(id),nextPageToken"};this.runRemotePagedRequest(a,o,t,i,r,s.DriveChildrenList)}};return t.inherit(r,a),t.extend(a.prototype,c),a}),
define("plugins/Plugin_GCalendar",["globals","util","platform","Constants","data","Sel","goog","gdata","RepeatDate","VMPlugin","International","PluginSettings","AccountManager","Hotkeys","tracker","apis"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m,f){function g(){this._super.constructor.call(this,PluginID.GCalendar,"Calendar"),this.pluginMargin=4,this.pluginPadding=14,this._numEntriesSyncd=0,this._calendarList={},t.forceBind("_flushEventUpdateQueue",this),t.forceBind("_purgeOldData",this),this.registerSetting("WriteAccess","writeAccess",!0),this.registerSetting("ImportCalendars","importCalendars",!0),this.registerSetting("ExportCalendar","exportCalendar",!0),this.registerSetting("WeeksPast","weeksPast",!0,v),this.registerSetting("WeeksFuture","weeksFuture",!0,y),this.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda",!0,!1),this.registerSetting("SyncNewEvents","syncNewEvents",!0,!0),this.registerSetting("SyncDraggedEvents","syncDraggedEvents",!0,!0),this.registerSetting("CreateLocalEvents","createLocalEvents",!0,!0),this._updateSyncTimes(),p.addHotkey("CalendarEvent",!1,KeyCode.C,n.Primary.Never,n.Shift.No,this.hotkeyCreateEvent.bind(this)),this._eventCache=this.registerLocalCache("EventCache",StorageType.IndexedDB,!0),this._cacheCleanup=this.registerLowImpactTask("CacheCleanup",this._purgeOldData),this.declareProperty("isInvalid",PluginLoad.Runtime,!0,!1),e.isDemoMode()?this.declareProperty("calendarID",PluginLoad.Preview|PluginLoad.Full|PluginLoad.Inline,!0,"me"):this.declareProperty("calendarID",PluginLoad.Preview|PluginLoad.Full|PluginLoad.Inline),this.declareProperty("summary",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("status",PluginLoad.Preview|PluginLoad.Full,!0,"confirmed"),this.declareProperty("startTime",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("endTime",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("allDayEvent",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("recurringEventId",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("eid",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("isComplete",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("isArchived",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("isStarred",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("priority",PluginLoad.Preview|PluginLoad.Full,!0,VMLIFlag.None),this.declareProperty("locked",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("modifiedOffline",PluginLoad.Full,!0,!1),this.declareProperty("source",PluginLoad.Full,!0),this.declareProperty("location",PluginLoad.Full,!0),this.declareProperty("description",PluginLoad.Full,!0),this.declareProperty("attendees",PluginLoad.Full,!0),this.declareProperty("organizer",PluginLoad.Full,!0),this.useRenderer(PluginRenderTypes.AgendaEntry,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.CalendarEvent),this._pendingCreates={},this._syncingOfflineChanges=!1,this._hasInitializedTasks=!1,this._purgeOldDataTimeout=void 0,this._eventUpdateTimeout=void 0,this._eventUpdateQueue={},this._propConverter={},this._propConverter[C.IsComplete]=e.parseDate,this._propConverter[C.IsArchived]=e.parseBoolean,this._propConverter[C.IsStarred]=e.parseBoolean,this._propConverter[C.Priority]=this.parsePriority.bind(this)}var v=1,y=4,b=["description","end","start","status","summary","extendedProperties"],S={SyncTokens:"syncTokens",CalendarList:"calendarList"},E="MDCProp_",C={IsComplete:"isComplete",Priority:"priority",IsStarred:"isStarred",IsArchived:"isArchived"},P=["modifiedOffline"],T={Settings:1,EventSync:2,PropUpdate:3,CalendarList:4,Colors:5,SingleEvent:6,CreateEvent:7,EventUpdate:8,OfflineUpdate:9,DeleteEvent:10,CreateCalendar:11,SummaryUpdate:12},D={getType:function(){return n.PluginType.Calendar},_attachMetadataFields:function(){return P},allowRemoteRequests:function(){return!0},useItemStore:function(){return"Google Calendar"},itemStoreOptions:function(){return{listenToItemStateChanged:!0,enabledFilters:ItemStoreFilter.Dates}},supportOfflineLoad:function(){return!0},supportOfflineCache:function(){return!0},usesPreviewCache:function(){return!0},googleScopes:function(){return this.getSetting(this.Settings.WriteAccess)?[GScope.Calendar]:[GScope.CalendarRO]},getDependencies:function(){return[PluginDependency.LocalLoaded,PluginDependency.PremiumSub,PluginDependency.GoogleLogin]},onDependencyLoaded:function(t,n){if(this._super.onDependencyLoaded.call(this,t,n),t===PluginDependency.GoogleLogin){try{e.PAssert(5015,e.isArray(n),"Must provide a valid scope array")}catch(t){e.reportError(t)}this.getSetting(this.Settings.IsEnabled)&&!i.mobile&&(n.indexOf(GScope.CalendarRO)<0&&n.indexOf(GScope.Calendar)<0&&(e.toasts.pushMessage(MessageID.LostPermission),u.notifyUnauthorizedAccount("me",[GScope.CalendarRO,GScope.Calendar],"Missing Scope"),this.setSetting(this.Settings.IsEnabled,!1)),this.getSetting(this.Settings.WriteAccess)&&n.indexOf(GScope.Calendar)<0?(e.toasts.pushMessage(MessageID.LostPermission),u.notifyUnauthorizedAccount("me",[GScope.Calendar],"Missing Write Scope"),this.setSetting(this.Settings.WriteAccess,!1)):!this.getSetting(this.Settings.WriteAccess)&&n.indexOf(GScope.Calendar)>=0&&this.setSetting(this.Settings.WriteAccess,!0))}},hasSettingsError:function(){var e=!1;if(this.verifyAuthorization(u.getDefaultEmail()).length>0)e=!0;else{var t=!!this.getSetting(this.Settings.ExportCalendar),i=!!this.getSetting(this.Settings.WriteAccess);t&&!i&&(e=!0)}return e},isDependencyLoaded:function(e,t){var i=!1;switch(e){case PluginDependency.GoogleLogin:t&&(t.indexOf(GScope.CalendarRO)>=0||t.indexOf(GScope.Calendar)>=0)&&(i=!0);break;default:i=!0}return i},getBlockedText:function(e){return""},computeBatchGroupID:function(e){var t="me";return e.data&&e.data.calendarId&&(t=e.data.calendarId),t},_serializeDate:function(t){return t instanceof Date?t.toISOString():e.isNumber(t)?new Date(t).toISOString():t},compactCacheField:function(e,t){var i;switch(t){case"startTime":case"endTime":i=this._serializeDate(e[t]);break;default:i=e[t]}return i},_updateSyncTimes:function(){var t=-(this.getSetting(this.Settings.WeeksPast)||v),i=this.getSetting(this.Settings.WeeksFuture)||y;try{e.PAssert(5016,e.isNumber(t)&&t<=0,"Invalid value for weeksPast: ",t)}catch(t){e.reportError(t)}try{e.PAssert(5017,e.isNumber(i)&&i>=0,"Invalid valid for weeksFuture: ",i)}catch(t){e.reportError(t)}var n=Math.min(-7,t),r=Math.max(20,i);this._minSyncStartTime=(new Date).clearTime().addWeeks(n),this._maxSyncStartTime=(new Date).clearTime().addWeeks(r),this._syncTokenDuration=e.weeks(10),this._minDisplayStartTime=(new Date).clearTime().addWeeks(t),this._maxDisplayStartTime=(new Date).clearTime().addWeeks(i);try{e.PAssert(5018,this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}catch(t){e.reportError(t)}},_shouldDisplayTime:function(e,t){return t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime||e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime},_filterDates:function(e,t,i){return function(n){var r=new Date(n[e]);return r>=t&&r<=i}},_getEndClearTime:function(){return this._minDisplayStartTime.clone().addDays(-1)},_purgeOldData:function(e){this._eventCache.onCacheReady(function(){this._eventCache.getFilterEntries(this._filterDates("startTime",new Date(0),this._getEndClearTime()),function(t){if(t){log("Removing "+t.length+" old calendar entries.");for(var i=0;i<t.length;++i)this._eventCache.removeEntry(t[i].id)}e&&e(!1)}.bind(this))}.bind(this))},_offlineLoad:function(){this._eventCache.onCacheMetadataReady(function(){this._eventCache.getMetadata(S.CalendarList,function(t){e.isEmpty(this._calendarList)&&(this._calendarList=t||{}),this._eventCache.onCacheReady(function(){var t=this._filterDates("startTime",this._minDisplayStartTime,this._maxDisplayStartTime),i=function(i,n){e.batchRenderUpdates(function(){e.vmMain.beginUpdateItems();for(var r=this.getDefaultItemStore(),a=r.getRoot(),s=0;s<i.length;++s){var o=i[s];if(!n||t(o)){var c=this.createEntryFromLocal(o.id,o);this.cacheData(c.id,c,void 0,void 0,ChangeType.Auto);try{e.PAssert(5019,!r.hasItem(c.id),"Load should never try to create a VMLI that has already been created")}catch(t){e.reportError(t)}if(this._eventNeedsItem(c)){if(c.source){var l=e.vmMain.pluginManager.parseEmailURL(c.source.url);if(l.plugin&&!l.plugin.hasCacheData(l.threadID)){var d=l.plugin.createEntryFromLocal(l.threadID,{accountID:l.accountID,subject:c.source.title});l.plugin.cacheData(l.threadID,d)}}var h=this._createItem(r,c,a.id);a.insertItem(h)}}}e.vmMain.commitUpdateItems(),this._cacheCleanup.notifyWorkAvailable()}.bind(this))}.bind(this);this._eventCache.requestPreloadData(function(n){e.isArray(n)?i(n,!0):this._eventCache.getFilterEntries(t,i)}.bind(this))}.bind(this))}.bind(this))}.bind(this))},_load:function(){e.isDemoMode()||(this.createRecurringTask("CalendarListSync",{delay:e.hours(2),minDelay:e.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:e.minutes(2),task:this.runCalendarListSync.bind(this)}),this.createRecurringTask("CalendarEventSync",{delay:e.minutes(15),minDelay:e.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:e.minutes(2),task:this.runCalendarSync.bind(this)}),this._hasInitializedTasks=!0)},goOnline:function(){if(this._hasInitializedTasks){this.getRecurringTask("CalendarEventSync").forceUpdate()}},handleTapStart:function(e,t,n,r){return i.mobile&&r.preventDefault(),!0},handleTapClick:function(t,n,r,a){var s=this.getCacheData(r);if(s){var o=this.getAttachment(r);if(i.mobile){var c=this.createDisplayElement(o).text;a.preventDefault(),e.preventClick(),e.menus.openMenuExternalApp(c,function(){var t;s.eid&&(t="https://www.google.com/calendar/event?eid="+s.eid),t&&e.openUrl(t,a)}.bind(this)),this.sendEvent("Tap_OpenGCalendarMobile")}else if(e.isDemoMode())e.toasts.pushMessage(MessageID.DemoPluginClick);else{var l;s.eid&&(l="https://www.google.com/calendar/event?eid="+s.eid),l&&e.openUrl(l,a),this.sendEvent("Tap_OpenGCalendarDesktop")}return!0}return!1},_durationToString:function(e){var t,i,n;(t=Math.round(e/6e4))>0&&(i=Math.floor(t/60),t-=60*i,i>0&&(n=Math.floor(i/24),i-=24*n));var r="";return n>0&&(r+=n+"d "),i>0&&(r+=i+"h "),t>0&&(r+=t+"m "),r.trim()},_createItemDateText:function(e){return e.allDayEvent?e.startTime.toString(d.getFormat(DFormat.MonthDayYear)):e.startTime.toString(d.getFormat(DFormat.DayYearTime))},_createItemDurationText:function(t){var i,n=t.endTime-t.startTime;if(t.allDayEvent)if(n>e.days(1)){var r=t.endTime.clone();r.addMilliseconds(-1),i="until "+r.toString(d.getFormat(DFormat.MonthDayYear))}else i="";else i=this._durationToString(n);return i},_createItemSummaryText:function(t){var i;if(t.source&&t.source.url){var n=e.vmMain.pluginManager.parseEmailURL(t.source.url);n.plugin&&(i=n.plugin._getTextForItem({id:n.threadID}))}return i||(i=t.summary?t.summary.replace(/\u2000/g,""):""),i},_createItemText:function(t){try{e.PAssert(5020,t,"Must specify a valid attachment")}catch(t){e.reportError(t)}var i=this._createItemDateText(t),n=this._createItemDurationText(t),r=this._createItemSummaryText(t);return this._assembleItemText(t,i,n,r)},_assembleItemText:function(e,t,i,n){return n+" "+DatePrefix+t+" "+(i?i+" ":"")+this._getTextForItem(e)},_eventNeedsItem:function(e){return"cancelled"!==e.status&&!e.isArchived},_createItem:function(t,i,n){var r;try{e.PAssert(5021,this._eventNeedsItem(i),"Item must always be required to cause create")}catch(t){e.reportError(t)}e.isDateValid(i.isComplete)&&(r=i.isComplete);var a={date:i.startTime.getTime(),dateText:this._createItemDateText(i),dateFormat:d.getCurrentDateFormat(),priority:i.priority,isComplete:!!i.isComplete,isArchived:i.isArchived,dateCompleted:r,isStarred:i.isStarred,duration:void 0,durationText:void 0};i.allDayEvent||(a.duration=i.endTime-i.startTime,a.durationText=this._createItemDurationText(i));var s=t.createItem(i.id,this._createItemText(i),n,a,ChangeType.Auto);if(i.description){var o=t.createItem(i.id+"_note",i.description,s.id,{isNote:!0},ChangeType.Auto);s.setNote(o,ChangeType.Auto)}return s},getRemoteAttachmentData:function(t,i){try{e.PAssert(5022,t.hasField("calendarID"),"Must have a valid calendarID for an event")}catch(t){e.reportError(t)}if(t.hasField("calendarID")){var n=t.getField("calendarID"),r=f.fns("calendar").events.get.packedFn,a={eventId:t.id,calendarId:n},s=function(i){try{e.PAssert(5023,!i||i.id===t.id,"If valid result, attachment should match remote event ID")}catch(t){e.reportError(t)}if(i){var r=this._addRemoteEntry(n,i);this._eventCache.cacheEntry(i.id,this.serializeExternalData(r))}}.bind(this),o=function(){t.notifyDataRequestFailed()};this._queueRemoteRequest(r,a,s,o,t,T.SingleEvent)}else t.updateField("status","cancelled")},_createRemoteEntry:function(t,i){var n,r,a,s=!1;try{e.PAssert(5024,i.start,"Must always have valid start data")}catch(t){e.reportError(t)}if(i.start.dateTime){try{e.PAssert(5025,i.end.dateTime,"End date format should always match start")}catch(t){e.reportError(t)}n=new Date(i.start.dateTime),r=new Date(i.end.dateTime)}else if(i.start.date){try{e.PAssert(5026,i.end.date,"End date format should always match start")}catch(t){e.reportError(t)}var o=i.start.date.split("-"),c=i.end.date.split("-");n=new Date(o[0],o[1]-1,o[2]),r=new Date(c[0],c[1]-1,c[2]),s=!0}i.htmlLink&&(a=i.htmlLink.split("?eid=")[1]);var l={id:i.id,calendarID:t,status:i.status,summary:i.summary,startTime:n,endTime:r,allDayEvent:s,recurringEventId:i.recurringEventId,eid:a,isComplete:this._getRemoteProperty(i,C.IsComplete),isArchived:this._getRemoteProperty(i,C.IsArchived),isStarred:this._getRemoteProperty(i,C.IsStarred),priority:this._getRemoteProperty(i,C.Priority),locked:i.locked||!1,attendees:i.attendees,location:i.location,description:i.description,organizer:i.organizer?i.organizer.displayName||i.organizer.email||i.organizer.id:"Unknown"};return i.source&&(l.source={title:i.source.title,url:i.source.url}),l},_addRemoteEntry:function(e,t){var i=this._createRemoteEntry(e,t);return this.cacheData(i.id,i),i},createEntryFromLocal:function(e,t){return t.startTime=t.startTime?new Date(t.startTime):void 0,t.endTime=t.endTime?new Date(t.endTime):void 0,t.isComplete=this._propConverter[C.IsComplete](t.isComplete),t.isArchived=this._propConverter[C.IsArchived](t.isArchived),t.isStarred=this._propConverter[C.IsStarred](t.isStarred),t.priority=this._propConverter[C.Priority](t.priority),t},_notifyFailedRequest:function(t,i){t&&t.error&&(t.error.code===n.HTTPStatusCode.Unauthorized?(e.toasts.pushMessage(MessageID.LostPermission),u.notifyUnauthorizedAccount("me",[GScope.CalendarRO,GScope.Calendar],t.error.message)):t.error.code>=400&&t.error.code<500&&e.reportError(new Error("Failed GCalendar request: "+t.error.code),t))},_getRemoteProperty:function(t,i){try{e.PAssert(5027,t,"Must provide valid event info")}catch(t){e.reportError(t)}try{e.PAssert(5028,i,"Must provide valid remote prop")}catch(t){e.reportError(t)}try{e.PAssert(5029,this._propConverter[i],"Missing prop converter: ",i)}catch(t){e.reportError(t)}var n;return t.extendedProperties&&t.extendedProperties.private&&(n=t.extendedProperties.private[E+i]),this._propConverter[i]&&(n=this._propConverter[i](n)),n},_updateAttachFromData:function(e,t){var i=[];for(var n in t)t.hasOwnProperty(n)&&e.isFieldDefined(n)&&(e.updateField(n,t[n]),i.push(n));return i},_runRemoteUpdate:function(t,i,n,r,a,s){function o(t,i,n){try{e.PAssert(5036,e.isFunction(t),"Must supply a valid CB function")}catch(t){e.reportError(t)}try{e.PAssert(5037,void 0!==i,"Must always pass success back from CB")}catch(t){e.reportError(t)}if(t.apply(this,Array.prototype.slice.call(arguments,1)),t===r){try{e.PAssert(5038,void 0===this._localSuccess,"Local CB called twice")}catch(t){e.reportError(t)}c=i,d=n}else if(t===a){try{e.PAssert(5039,void 0===this._remoteSuccess,"Remote CB called twice")}catch(t){e.reportError(t)}l=i,h=n}void 0!==c&&void 0!==l&&s(c,l,d,h)}try{e.PAssert(5030,this.getSetting(this.Settings.WriteAccess),"Should not be calling _runRemoteUpdate without proper permission")}catch(t){e.reportError(t)}try{e.PAssert(5031,!t.getField("locked"),"Should never try to modify an event that is locked")}catch(t){e.reportError(t)}try{e.PAssert(5032,e.isBoolean(i)||e.isArray(i),"Must specify a boolean or list of fields for modified value")}catch(t){e.reportError(t)}try{e.PAssert(5033,e.isFunction(r),"Must provide a valid localDoneCB")}catch(t){e.reportError(t)}try{e.PAssert(5034,e.isFunction(a),"Must provide a valid remoteDoneCB")}catch(t){e.reportError(t)}try{e.PAssert(5035,e.isFunction(s),"Must provide a valid allDoneCB")}catch(t){e.reportError(t)}var c,l,d,h,u=this.getCacheData(t.id);try{e.PAssert(5040,u,"Performing update on event that does not have local data")}catch(t){e.reportError(t)}u?(this.addModifiedOffline(u,i),this._eventCache.cacheEntry(t.id,this.serializeExternalData(u),function(e){e||o(r,!1),n(function(n,s){if(n){var c=this.getCacheData(t.id),l=!0!==i&&i;this.removeModifiedOffline(c,l),e&&this._eventCache.cacheEntry(t.id,this.serializeExternalData(c),function(e){o(r,e)}),o(a,!0)}else e&&o(r,!1),o(a,!1,s)}.bind(this))}.bind(this))):(o(r,!1),o(a,!1))},_updateEvent:function(e,t,i,n,r,a){var s=this._updateAttachFromData(e,t),o=function(n){this._updateRemoteEvent(e.getField("calendarID"),e.id,t,i,n)}.bind(this);this._runRemoteUpdate(e,s,o,n,r,a)},_updateRemoteEvent:function(t,i,r,a,s){try{e.PAssert(5041,this.getSetting(this.Settings.WriteAccess),"Should not be calling _updateRemoteEvent without proper permission")}catch(t){e.reportError(t)}try{e.PAssert(5042,this.hasWritePermissionForCalendar(t),"Should not be calling _updateRemoteEvent for a read-only calendar")}catch(t){e.reportError(t)}var o=this._createEventUpdateInfo(r),c=f.fns("calendar").events.patch.packedFn,l={calendarId:t,eventId:i,resource:o},d=function(){s(!0)},h=function(r){if(r&&r.error&&r.error.code===n.HTTPStatusCode.NotFound)this._eventCache.removeEntry(i),s(!0);else{var a=Object.keys(o);if(log("Failed Update: ",t,i,a),e.isHTTPStatusCode(r,n.HTTPStatusCode.Forbidden)&&!this.isRateLimitError(r)){var c=this.getCacheData(i);c&&(c.locked=!0),this.cacheData(i,c,!0,["locked"])}s(!1,r),this._notifyFailedRequest(r,t)}}.bind(this);this._queueRemoteRequest(c,l,d,h,void 0,T.EventUpdate||a)},_updateRemoteProperty:function(e,t,i,n,r,a){e.updateField(t,i);var s={},o=void 0===i?null:i;s[E+t]=o;var c={extendedProperties:{private:s}},l=function(t){this._updateRemoteEvent(e.getField("calendarID"),e.id,c,T.PropUpdate,t)}.bind(this);this._runRemoteUpdate(e,[t],l,n,r,a)},_getStartEndFromDateInfo:function(t,i){var n,r,a,s=!1;if(t instanceof Date)t.hasTimeOfDay()||(s=!0),n=t,r=t.clone().addMilliseconds(i);else if(t instanceof c)n=t.getStartDate(),r=t.getEndDate(),a=t.toICal();else try{e.PAssert(5043,!1,"Should always have a valid date")}catch(t){e.reportError(t)}return{startTime:n,endTime:r,allDayEvent:s,recurrence:a}},deleteCalendarEventForItem:function(e,t,i,n,r){this.sendEvent("DeleteEvent");var a=function(i){var n=e.getCalendarRawText().replace(t.getEmbedString(),"");e.setText(n,!0,ChangeType.Local),t.isLocalOnlyAttachment()?(t.updateField("status","cancelled"),i(!0)):this.deleteCalendarEvent(t,i)}.bind(this);this._runRemoteUpdate(t,["status"],a,i,n,r)},deleteCalendarEvent:function(t,i){try{e.PAssert(5044,!t.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event")}catch(t){e.reportError(t)}var r=f.fns("calendar").events.delete.packedFn,a={calendarId:t.getField("calendarID"),eventId:t.id},s=function(){var e=this.getDefaultItemStore();t.updateField("status","cancelled"),t.forEachItem(e,function(e){e.parent()&&(e.parent().removeChild(e),e.parent(void 0))}),this._eventCache.cacheEntry(t.id,this.serializeExternalData(t.getData())),i(!0)}.bind(this),o=function(){s()},c=function(e){e&&e.error&&e.error.code===n.HTTPStatusCode.Gone?s():e&&e.error&&e.error.code===n.HTTPStatusCode.NotFound?s():(i(!1,e),this._notifyFailedRequest(e,t.getField("calendarID")))}.bind(this);this._queueRemoteRequest(r,a,o,c,void 0,T.DeleteEvent)},forceRemoteEventSync:function(){if(!e.isDemoMode()&&this._hasInitializedTasks){if(this.hasRecurringTask("CalendarEventSync")){this.getRecurringTask("CalendarEventSync").forceUpdate()}if(this.hasRecurringTask("CalendarListSync")){this.getRecurringTask("CalendarListSync").forceUpdate()}}},getDefaultExportCalendarID:function(){return e.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)},isExportCalendarID:function(e){return this.getSetting(this.settings.ExportCalendar)===e},hasWritePermissionForAttach:function(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var i=e.getField("calendarID"),n=this._getCalendarInfo(i);n&&("writer"!==n.accessRole&&"owner"!==n.accessRole||(t=!0))}return t},hasWritePermissionForCalendar:function(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var i=this._getCalendarInfo(e);i&&("writer"!==i.accessRole&&"owner"!==i.accessRole||(t=!0))}return t},getCalendarBackgroundColor:function(e){var t="rgba(0, 120, 255, 0.85)",i=this._getCalendarInfo(e);return i&&i.backgroundColor&&(t=i.backgroundColor),t},getCalendarForegroundColor:function(e){var t="#000000",i=this._getCalendarInfo(e);return i&&i.foregroundColor&&(t=i.foregroundColor),t},getCalendarDisplayProps:function(e){var t,i=this._getCalendarInfo(e);return i&&"reader"===i.accessRole&&(t={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),t},shouldDisplayOverdueInAgenda:function(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)},createEventForEmail:function(t,i,n,r,a,s){try{e.PAssert(5045,e.isString(t),"Must provide a valid calendarID for email")}catch(t){e.reportError(t)}try{e.PAssert(5046,e.isString(i),"Must provide a valid subject")}catch(t){e.reportError(t)}try{e.PAssert(5047,e.isString(n),"Must provide a valid email url")}catch(t){e.reportError(t)}try{e.PAssert(5048,e.isDateValid(r),"Must provide a valid schedule date")}catch(t){e.reportError(t)}try{e.PAssert(5049,e.isNumber(a),"Must provide a valid event duration")}catch(t){e.reportError(t)}this.sendEvent("AddEmailEvent");var o={duration:a,summary:i,date:r,source:{title:i,url:n}};this.createNewCalendarEvent(t,o,function(t,i){if(t){var n=this.getDefaultItemStore();if(!n.hasItem(t.id)){e.vmMain.beginUpdateItems();var r=n.getRoot(),a=this._createItem(n,t,r.id);r.insertItem(a),e.vmMain.commitUpdateItems()}}}.bind(this),function(){},s)},createEventForItem:function(t){if(!e.isDateSoft(t.getDateText())&&!t.hasPluginAttachment(this.id)&&(t.date()||t.repeatDate())){var i=this.getDefaultExportCalendarID();i?t.date()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(i,t,function(i,n,a,s){i||n?n?m.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddToGCal,data:{item:t}}):s&&s.error&&-1===s.error.code?m.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddToGCal,data:{item:t}}):e.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:MessageAction.Okay}):a&&!1===a.isValid?e.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:MessageAction.Okay}):e.toasts.pushMessage({text:"There was an error creating your calendar event. It has not been properly saved.",actionText:"LEARN MORE",action:function(){r.overQuota?e.toasts.pushMessage({text:"You are offline and tour computer's storage quota has been exceeded. Please free up space on your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay}):e.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay})}})})):(this.sendEvent("AddRepeatEvent"),e.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:MessageAction.Okay})):e.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:MessageAction.OpenSettings})}},hotkeyCreateEvent:function(){this.isActive()&&!this.isPluginBlocked()&&e.vmMain.applyToSelection(this.createEventForItem.bind(this))},newCalendarEventForItem:function(t,i,r){try{e.PAssert(5050,i,"Must provide a valid item")}catch(t){e.reportError(t)}try{e.PAssert(5051,i.date()||i.repeatDate(),"Item must have a valid date")}catch(t){e.reportError(t)}try{e.PAssert(5052,!i.hasPluginAttachment(PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item")}catch(t){e.reportError(t)}var a=!0,s=i.getDuration();s||(s=i.allDayDate()?e.days(1):36e5);var o={duration:s,summary:i.getCalendarParsedText()};if(i.date())o.date=i.date();else if(i.repeatDate()){try{e.PAssert(5053,!1,"Repeated dates are not yet supported")}catch(t){e.reportError(t)}a=!1}if(i.hasNote()&&(o.description=i.getNote().getParsedText()),i.hasAttachmentType(n.PluginType.Email)){var c=i.getAttachmentByType(n.PluginType.Email);o.source={title:c.getField("subject"),url:c.getPlugin().createURLForThread(c)}}a?this.createNewCalendarEvent(t,o,function(t,n){if(t)if(i.isDestroyed()){var r=this.getDefaultItemStore();if(!r.hasItem(t.id)){e.vmMain.beginUpdateItems();var a=r.getRoot(),s=this._createItem(r,t,a.id);a.insertItem(s),e.vmMain.commitUpdateItems()}}else{var o=i.getCalendarRawText()+" "+DatePrefix+i.getDateText();i.getDurationText()?o+=" "+i.getDurationText():i.allDayDate()||(o+=" 1hr"),o+=" "+this._getTextForItem(t),i.setText(o,!0,ChangeType.Local)}}.bind(this),function(){},r):r(!1,!1,{isValid:!1})},createNewCalendarEvent:function(t,i,n,r,a){try{e.PAssert(5054,i,"Must have valid event info passed in")}catch(t){e.reportError(t)}try{e.PAssert(5055,i.date,"Must have valid date for event")}catch(t){e.reportError(t)}try{e.PAssert(5056,void 0!==i.duration,"Must have a valid event duration")}catch(t){e.reportError(t)}try{e.PAssert(5057,i.summary,"Must have a valid event summary")}catch(t){e.reportError(t)}try{e.PAssert(5058,e.isFunction(n),"Must supply a valid local done CB")}catch(t){e.reportError(t)}try{e.PAssert(5059,e.isFunction(r),"Must supply a valid remote done CB")}catch(t){e.reportError(t)}var s=e.generateTempId(),o=this._getStartEndFromDateInfo(i.date,i.duration),c={id:s,calendarID:t,status:"confirmed",summary:i.summary,source:i.source,description:i.description,startTime:o.startTime,endTime:o.endTime,allDayEvent:o.allDayEvent,recurrence:o.recurrence,organizer:u.getDefaultEmail(),modifiedOffline:!0};this.cacheData(s,c),this._eventCache.cacheEntry(s,c,function(i){n(c,i);var s=function(e){this._createRemoteEventFromCacheData(t,c,function(){},e,a)}.bind(this),o=this.getAttachment(c.id);e.isDemoMode()?(r(!0),a(i,!0)):this._runRemoteUpdate(o,!0,s,function(){},r,function(){this.getDefaultItemStore().updateItems()}.bind(this))}.bind(this))},_createRemoteEventFromCacheData:function(t,i,n,r,a){function s(t,i,s){try{e.PAssert(5061,e.isFunction(t),"Must supply a valid CB function")}catch(t){e.reportError(t)}try{e.PAssert(5062,void 0!==i,"Must always pass success back from CB")}catch(t){e.reportError(t)}if(t.apply(this,Array.prototype.slice.call(arguments,1)),t===n){try{e.PAssert(5063,void 0===this._localSuccess,"Local CB called twice")}catch(t){e.reportError(t)}o=i,l=s}else if(t===r){try{e.PAssert(5064,void 0===this._remoteSuccess,"Remote CB called twice")}catch(t){e.reportError(t)}c=i,d=s}void 0!==o&&void 0!==c&&a(o,c,l,d)}try{e.PAssert(5060,!this._pendingCreates[i.id],"Should never try and double create a calendar event")}catch(t){e.reportError(t)}this._pendingCreates[i.id]=!0;var o,c,l,d;this._createNewRemoteEvent(t,i,function(a,o){delete this._pendingCreates[i.id],e.vmMain.beginUpdateItems();var c=this.getAttachment(i.id);if(a){var l=i.id;this.changeID(c,c.id,a.id);var d=this.getDefaultItemStore(),h=d.getRoot();d.hasItem(l)&&d.destroyItem(l),this._eventCache.removeEntry(l,function(t){try{e.PAssert(5065,t,"Must always successfully remove the temp cached event: "+i.id)}catch(t){e.reportError(t)}});var u=this._addRemoteEntry(t,a),p=this._createItem(d,u,h.id);h.insertItem(p),this._eventCache.cacheEntry(a.id,this.serializeExternalData(u),s.bind(this,n)),c.updateField("isInvalid",!1),s(r,!0)}else c.updateField("isInvalid",!0),s(n,!1),s(r,!1,o);e.vmMain.commitUpdateItems()}.bind(this))},_createNewRemoteEvent:function(t,i,n){try{e.PAssert(5066,i,"Must specify valid event info")}catch(t){e.reportError(t)}try{e.PAssert(5067,i.startTime instanceof Date,"Must have a valid start time")}catch(t){e.reportError(t)}try{e.PAssert(5068,i.endTime instanceof Date,"Must have a valid end time")}catch(t){e.reportError(t)}try{e.PAssert(5069,i.summary,"Must have a valid event title")}catch(t){e.reportError(t)}var r,a;i.allDayEvent?(r={date:i.startTime.toString("yyyy-MM-dd")},a={date:i.endTime.toString("yyyy-MM-dd")}):(r={dateTime:i.startTime.toISOString()},a={dateTime:i.endTime.toISOString()});var s=f.fns("calendar").events.insert.packedFn,o={calendarId:t,resource:{start:r,end:a,recurrence:i.recurrence,summary:i.summary,description:i.description,status:i.status,source:i.source}},c=function(e){n(e)},l=function(e){n(void 0,e),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequest(s,o,c,l,void 0,T.CreateEvent)},getImportCalendarList:function(){return this.getSetting(this.Settings.ImportCalendars)||[]},getReadableCalendarList:function(e){return this._getCalendarList("reader",e)},getWritableCalendarList:function(e){return this._getCalendarList("writer",e)},getFullCalendarList:function(t){var i=this.getSetting(this.Settings.ImportCalendars);this.getReadableCalendarList(function(n){if(i&&n){var r=i.map(function(t){if(!e.isObject(t))return{id:t,accessRole:"none"};var i=e.clone(t);return i.accessRole="none",i}).filter(function(e){for(var t=0;t<n.length;++t)if(n[t].id===e.id)return!1;return!0});n.pushArray(r)}t(n)})},createCalendar:function(e,t){var i=f.fns("calendar").calendars.insert.packedFn,n={resource:{summary:e}},r=function(e){t(e)},a=function(e){t(),this._notifyFailedRequest(e,void 0)}.bind(this);this._queueRemoteRequest(i,n,r,a,void 0,T.CreateCalendar),this.sendEvent("CreateCalendar")},_getCalendarList:function(e,t){var i=f.fns("calendar").calendarList.list.packedFn,n={minAccessRole:e,userId:"me"},r={getAllPages:!0,timeoutMS:0},a=function(e){t(e)},s=function(e){t(),this._notifyFailedRequest(e,void 0)}.bind(this);this._queuePagedRemoteRequest(i,n,a,s,void 0,T.CalendarList,r)},handleEventUpdate:function(t,i){this._numEntriesSyncd++;var n=this.getDefaultItemStore();if("cancelled"===i.status){if(this._eventCache.removeEntry(i.id),this.hasCacheData(i.id)){var r=this.getAttachment(i.id);r.updateField("status","cancelled"),r.forEachItem(n,function(e){e.parent()&&(e.parent().removeChild(e,ChangeType.Remote),e.parent(void 0))})}}else{var a=this.getCacheData(i.id),s=this._createRemoteEntry(t,i);a&&a.modifiedOffline&&this._mergeEventData(a,s),this.cacheData(s.id,s),this._eventCache.cacheEntry(i.id,this.serializeExternalData(s));var o=n.getRoot(),r=this.getAttachment(i.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(r,a,s)}catch(t){e.reportError(t)}if(this._endIgnorePropertyChanges(),!n.hasItem(s.id)&&this._shouldDisplayTime(s.startTime,s.endTime)&&this._eventNeedsItem(s)){var c=this._createItem(n,s,o.id);o.insertItem(c)}}},_mergeEventData:function(t,i){try{e.PAssert(5072,t.modifiedOffline,"Should only merge events that were locally modified")}catch(t){e.reportError(t)}var n=t.modifiedOffline;try{e.PAssert(5073,e.isArray(n),"Should not be receiving an update for an event that was created locally")}catch(t){e.reportError(t)}for(var r=0;r<n.length;++r){var a=n[r];i[a]=t[a]}i.modifiedOffline=t.modifiedOffline},
updateVMLIsFromUpdate:function(t,i,r){try{e.PAssert(5074,t,"Must provide a valid attachment")}catch(t){e.reportError(t)}try{e.PAssert(5075,r,"Must provide valid new data")}catch(t){e.reportError(t)}if(i)t.forEachItem(void 0,function(e){var t,a=!1,s=e.getParsedText();this.areDatesEqual(i.startTime,r.startTime)||(t=this._createItemDateText(r),s=s.replace(DatePrefix+e.getDateText(),DatePrefix+t),a=!0);var o;if(i.endTime-i.startTime!=r.endTime-r.startTime){if(o=this._createItemDurationText(r),e.getDurationText())s=s.replace(e.getDurationText(),o);else{var c=DatePrefix+(t||e.getDateText());s=s.replace(c,c+" "+o)}a=!0}if(i.summary!==r.summary&&!e.hasAttachmentType(n.PluginType.Email)){var l=t||e.getDateText(),d=o||e.getDurationText(),h=r.summary?r.summary.replace(/\u2000/g,""):"";s=this._assembleItemText(r,l,d,h),a=!0}if(i.description!==r.description&&e.belongsToItemStore(this.getDefaultItemStore()))if(e.hasNote())if(r.description){var u=e.getNote();u.setText(r.description,!0,ChangeType.Remote)}else e.setNote(void 0,ChangeType.Remote);else if(r.description){var u,p=r.id+"_note";this.getDefaultItemStore().hasItem(p)?(u=this.getDefaultItemStore().getItem(p),u.setText(r.description,!0,ChangeType.Remote)):u=this.getDefaultItemStore().createItem(p,r.description,e.id,{isNote:!0},ChangeType.Remote),e.setNote(u,ChangeType.Remote)}if(this.areDatesEqual(i.isComplete,r.isComplete)||e.isComplete(!!r.isComplete,ChangeType.Remote),i.isArchived!==r.isArchived&&e.isArchived(r.isArchived,ChangeType.Remote),i.isStarred!==r.isStarred&&e.isStarred(r.isStarred,ChangeType.Remote),i.priority!==r.priority&&e.priority(r.priority,ChangeType.Remote),a){var m=e.generateSaveText(s);e.setText(m,!0,ChangeType.Remote)}}.bind(this));else{var a=this._createItemText(r);t.forEachItem(void 0,function(e){e.setText(a,!0,ChangeType.Remote)}.bind(this))}},setSyncToken:function(t,i,n){try{e.PAssert(5076,e.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(t){e.reportError(t)}try{e.PAssert(5077,e.isString(i),"Must provide a valid calendar ID to clear sync token for")}catch(t){e.reportError(t)}this._eventCache.getMetadata(S.SyncTokens,function(e){e=e||{};var r=Date.now()+this._syncTokenDuration;e[t]={token:i,date:Date.now(),expires:r},this._eventCache.setMetadata(S.SyncTokens,e,n)}.bind(this))},clearSyncToken:function(t,i){try{e.PAssert(5078,e.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(t){e.reportError(t)}try{e.PAssert(5079,e.isFunction(i),"Must provide valid CB function when clearing sync token")}catch(t){e.reportError(t)}this._eventCache.getMetadata(S.SyncTokens,function(e){e?(delete e[t],this._eventCache.setMetadata(S.SyncTokens,e,i)):i(!1)}.bind(this))},clearCalendarEventCache:function(t,i){try{e.PAssert(5080,e.isString(t),"Must provide a valid calendar ID to clear event cache for")}catch(t){e.reportError(t)}try{e.PAssert(5081,e.isFunction(i),"Must provide valid CB function when clearing event cache")}catch(t){e.reportError(t)}var n=function(e){return e.calendarID===t};this._eventCache.getFilterEntries(n,function(e){if(e){log("Clearing calendar cache: "+t);for(var n=0;n<e.length;++n)this._eventCache.removeEntry(e[n].id);i(!0)}else i(!1)}.bind(this))},_calendarSyncComplete:function(t,i){if(i.length>0){if(h.notifySyncError(i),!e.isOffline())for(var r=0;r<i.length;++r){var a=i[r];a.result!==n.SyncResult.FailureNetwork&&e.toasts.pushMessage(MessageID.CalendarSync)}}else h.notifySyncError(void 0),e.toasts.clearMessage(MessageID.CalendarSync);var s=this.getSetting(this.Settings.ExportCalendar);if(s){for(var o=!1,r=0;r<i.length;++r)if(i[r].id===s){o=!0;break}o||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}},_shouldExpireToken:function(e){var t=!0;return e&&(e.expires?t=e.expires<Date.now():e.date&&(t=e.date+this._syncTokenDuration<Date.now())),t},_getCalendarInfo:function(e){return this._calendarList[e]},allowTextEditing:function(e,t){var i=!1;if(this.getSetting(this.Settings.WriteAccess)){var n=t.getField("calendarID");(this.hasWritePermissionForCalendar(n)||t.isLocalOnlyAttachment())&&(i=!0)}return i},_createCalendarFromRemote:function(t){var i={id:t.id,summary:t.summary,accessRole:t.accessRole};return e.isValidColor(t.backgroundColor)&&(i.backgroundColor=t.backgroundColor),e.isValidColor(t.foregroundColor)&&(i.foregroundColor=t.foregroundColor),i},runCalendarListSync:function(t){this.getReadableCalendarList(function(i){if(i){this._calendarList={};for(var n=0;n<i.length;++n){var r=i[n];this._calendarList[r.id]=this._createCalendarFromRemote(r)}e.toasts.clearMessage(MessageID.CalendarSync);var a=this.getDefaultExportCalendarID();a&&!this._calendarList[a]&&(this.setSetting(this.Settings.ExportCalendar,void 0),e.toasts.pushMessage({text:"Your export calendar no longer exists, please select another.",action:MessageAction.OpenSettings})),this._eventCache.onCacheMetadataReady(function(){this._eventCache.setMetadata(S.CalendarList,this._calendarList)}.bind(this))}else e.isOffline()||e.toasts.pushMessage(MessageID.CalendarSync);t&&t()}.bind(this))},_notifyTokenExpired:function(e){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)},_notifyCalendarUnsyncd:function(e){log("Detected calendar "+e+" is no longer syncd"),this._clearCachedData(e,function(t){t||log("Failure unsyncing calendar "+e)}),this._clearCalendarItems(e)},_clearCalendarItems:function(t){var i=this.getDefaultItemStore();e.vmMain.beginUpdateItems(),i.forEach(function(e){if(e.hasAttachments()){e.getAttachment(0).getField("calendarID")===t&&i.destroyItem(e.id)}}),e.vmMain.commitUpdateItems()},_getSyncResultFromResult:function(e,t){var i=n.SyncResult.Success;if(t&&t.error&&t.error.code){var r=t.error.code;if(r===n.HTTPStatusCode.Unauthorized){var a=this._getCalendarInfo(e);i=a&&"owner"===a.accessRole?n.SyncResult.FailureOAuth:a&&"writer"===a.accessRole?n.SyncResult.FailureNoWrite:n.SyncResult.FailureNoRead}else i=r===n.HTTPStatusCode.NotFound?n.SyncResult.FailureNoRead:r===n.HTTPStatusCode.Network?n.SyncResult.FailureNetwork:r===n.HTTPStatusCode.Forbidden?n.SyncResult.FailureNoRead:n.SyncResult.FailureUnknown}return i},runCalendarSync:function(t){var i=0,r=0,a=[],s=[],o=function(o,c,l){try{e.PAssert(5082,r<i,"Should never have more calendars syncd than we tried to sync")}catch(t){e.reportError(t)}o?a.push({id:c,result:n.SyncResult.Success}):s.push({id:c,result:this._getSyncResultFromResult(c,l)}),++r===i&&(this._calendarSyncComplete(a,s),t&&t())}.bind(this);this._eventCache.onCacheMetadataReady(function(){this._eventCache.getMetadata(S.SyncTokens,function(n){this._updateSyncTimes();var r=this.getSetting(this.Settings.ImportCalendars);if(r&&r.length>0){i=r.length;for(var a=0;a<r.length;++a){var s=r[a];e.isObject(s)||(s={id:r[a]});var c,l=n?n[s.id]:void 0;this._shouldExpireToken(l)?(this._notifyTokenExpired(s.id),c=void 0):c=l.token,this.performCalendarSync(s.id,c,o)}for(var d in n){for(var h=!1,a=0;a<r.length;++a){var s=r[a];if(e.isObject(s)||(s={id:r[a]}),s.id===d){h=!0;break}}h||this._notifyCalendarUnsyncd(d)}}else this._clearAllData(),this._calendarSyncComplete([],[]),t&&t()}.bind(this))}.bind(this))},performCalendarSync:function(t,i,r){try{e.PAssert(5083,e.isString(t),"Must provide a valid calendar ID for each sync op")}catch(t){e.reportError(t)}var a=f.fns("calendar").events.list.packedFn,s={calendarId:t,singleEvents:!0},o={getAllPages:!0,timeoutMS:0};i?s.syncToken=i:(s.timeMin=this._minSyncStartTime.toISOString(),s.timeMax=this._maxSyncStartTime.toISOString());var c=function(i,n,a){var s;a&&(s=a.nextSyncToken,this.setSyncToken(t,s)),e.vmMain.beginUpdateItems();for(var o=0;o<i.length;++o)this.handleEventUpdate(t,i[o]);e.vmMain.commitUpdateItems(),r(!0,t)}.bind(this),l=function(e){e&&e.error&&e.error.code===n.HTTPStatusCode.Gone?this._clearCachedData(t,function(i){i?this.performCalendarSync(t,void 0,r):r(!1,t,e)}.bind(this)):(r(!1,t,e),this._notifyFailedRequest(e,t))}.bind(this);this._queuePagedRemoteRequest(a,s,c,l,void 0,T.EventSync,o)},_createEventUpdateInfo:function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&b.indexOf(i)>=0&&(t[i]=e[i]);return t},_notifyOfflineSyncFailures:function(e,t,i){t>0&&(h.notifySyncError(i),log("Failed to sync offlineChanges: ",t))},_syncOfflineChanges:function(t){if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var i=0,r=0,a=0,s=[],o=function(e,o){o===n.SyncResult.Success?r++:(a++,s.push({id:e,result:o})),i===r+a&&(this._syncingOfflineChanges=!1,t(r,a,s))}.bind(this),c=function(e){return!!e.modifiedOffline};this._eventCache.getFilterEntries(c,function(t){i=t.length;for(var r=0;r<t.length;++r){var a=this.createEntryFromLocal(t[r].id,t[r]);a.isInvalid||(e.isTempId(a.id)&&!this._pendingCreates[a.id]?this._createRemoteEventFromCacheData(a.calendarID,a,function(){},function(e,t,i){o(e,this._getSyncResultFromResult(e,i))}.bind(this,a.calendarID),function(){}):this.hasWritePermissionForCalendar(a.calendarID)?this._updateRemoteEvent(a.calendarID,a.id,a,T.OfflineUpdate,function(e,t,i){t?(delete a.modifiedOffline,this._eventCache.cacheEntry(a.id,a,function(t){t?o(e,n.SyncResult.Success):o(e,n.SyncResult.FailureUnknown)})):o(e,this._getSyncResultFromResult(e,i))}.bind(this,a.calendarID)):(delete a.modifiedOffline,this._eventCache.cacheEntry(a.id,a,function(e,t){t?o(e,n.SyncResult.Success):o(e,n.SyncResult.FailureUnknown)}.bind(this,a.calendarID))))}}.bind(this))}},_getEventDuration:function(t){try{e.PAssert(5084,!t.getField("allDayEvent"),"All day events do not have valid durations")}catch(t){e.reportError(t)}var i=t.getField("startTime"),n=t.getField("endTime");try{e.PAssert(5085,i&&n,"Must always have valid start and end times")}catch(t){e.reportError(t)}return n-i},_computeItemDates:function(t,i,n){try{e.PAssert(5086,i.getDate(!0)||i.getRepeatDate(),"Must have a valid date")}catch(t){e.reportError(t)}var r,a;i.getDate(!0)&&(r=i.getDate(!0).clone(),a=r.clone().addMilliseconds(i.getDuration())),i.allDayDate()?(t.start={date:r.toString("yyyy-MM-dd"),dateTime:null},t.end={date:a.toString("yyyy-MM-dd"),dateTime:null}):(t.start={dateTime:r.toISOString(),date:null},t.end={dateTime:a.toISOString(),date:null}),t.startTime=r,t.endTime=a},_queueEventUpdate:function(e,t){if(this._updateAttachFromData(e,t),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!e.isLocalOnlyAttachment()){var i=this._eventUpdateQueue[e.id];if(i)for(var n in t)t.hasOwnProperty(n)&&(i.info[n]=t[n]);else this._eventUpdateQueue[e.id]={attach:e,info:t}}},onShutdown:function(){if(r.overQuota&&!e.isEmpty(this._pendingCreates))return"Some of your calendar events may have not been fully saved. Continue?"},_flushEventUpdateQueue:function(){this._eventUpdateTimeout=void 0;var t=function(t,i,n,r){t||i?e.toasts.clearMessage(MessageID.CalendarSaveFail):e.toasts.pushMessage(MessageID.CalendarSaveFail)};for(var i in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(i)){var n=this._eventUpdateQueue[i];this._updateEvent(n.attach,n.info,T.SummaryUpdate,function(){},function(){},t)}this._eventUpdateQueue={}},_handleAttachDeleted:function(t,i){if(i.belongsToItemStore(this.getDefaultItemStore())){var n=t.getField("status");this.deleteCalendarEvent(t,function(r){if(r){var a=function(){this._updateEvent(t,{status:n},T.UndoDelete,function(){},function(t){t||e.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:a,timeout:1e4})},function(){});var r=this._createItemText(t.getData());i.setText(r,!0,ChangeType.Local),i.parent()||i.parent(this.getDefaultItemStore().getRoot()),i.getIndex()<0&&i.parent().insertItem(i)}.bind(this);e.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:a,timeout:1e4})}else e.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:this._handleAttachDeleted.bind(this,t,i),timeout:1e4})}.bind(this))}},notifyItemTextChanged:function(t,i,r){if(r)this._handleAttachDeleted(t,i);else if(t.getField("recurringEventId")&&i.getCalendarParsedText()===t.getField("summary"))e.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!e.isDemoMode())if(i.getDate(!0)){var a,s=i.getCalendarParsedText(),o=t.getField("summary"),c=t.getField("source");if(i.hasAttachmentType(n.PluginType.Email)){var l=i.getAttachmentByType(n.PluginType.Email);a={title:l.getField("subject"),url:l.getPlugin().createURLForThread(l)}}var d={summary:s,start:void 0,end:void 0,source:void 0},h=!1;s!==o&&(h=!0),c&&!a||!c&&a?h=!0:c&&a&&(c.title===a.title&&c.url===a.url||(h=!0));var u=i.getDate(!0),p=t.getField("startTime");this.areDatesEqual(p,u)||(h=!0);var m=i.getEndDate(!0),f=t.getField("endTime");this.areDatesEqual(f,m)||(h=!0),h&&(this._computeItemDates(d,i,t),d.source=a,this._queueEventUpdate(t,d)),t.updateField("isInvalid",!1)}else t.updateField("isInvalid",!0)},_beginIgnorePropertyChanges:function(){this._ignoringPropertyChanges=!0},_endIgnorePropertyChanges:function(){this._ignoringPropertyChanges=!1},_isIgnoringPropertyChanges:function(){return this._ignoringPropertyChanges},notifyItemPropertyChanged:function(t,i,n){if(this.getSetting(this.Settings.WriteAccess)&&!t.getField("locked")&&this.hasWritePermissionForCalendar(t.getField("calendarID"))&&(!e.isRemoteChange(n)||!this._isIgnoringPropertyChanges())){var r=t.getField("isComplete"),a=t.getField("isArchived"),s=t.getField("isStarred"),o=t.getField("priority"),c=i.dateCompleted,l=i.isArchived(),d=i.isStarred(),h=i.priority(),u=function(){},p=function(){},m=function(t,i,n,r){t||i?e.toasts.clearMessage(MessageID.CalendarSaveFail):e.toasts.pushMessage(MessageID.CalendarSaveFail)};this.areDatesEqual(r,c)||(e.isLocalChange(n)?this._updateRemoteProperty(t,"isComplete",c,u,p,m):t.updateField("isComplete",c)),a!==l&&(e.isLocalChange(n)?this._updateRemoteProperty(t,"isArchived",l,u,p,m):t.updateField("isArchived",l)),s!==d&&(e.isLocalChange(n)?this._updateRemoteProperty(t,"isStarred",d,u,p,m):t.updateField("isStarred",d)),o!==h&&(e.isLocalChange(n)?this._updateRemoteProperty(t,"priority",h,u,p,m):t.updateField("priority",h))}},_clearCachedData:function(e,t){this.clearSyncToken(e,function(i){i?this.clearCalendarEventCache(e,t):t&&t(!1)}.bind(this))},_clearAllData:function(e){this._eventCache.clearMetadata(function(t){t?this._eventCache.clearCache(function(t){e&&e(t)}):e&&e(!1)}.bind(this)),this.getDefaultItemStore().clearStore()},getAttachmentClass:function(e){var t=["plugin_gcalendar"];return e.isLoaded()&&(e.getField("isInvalid")&&t.push("invalid"),"cancelled"===e.getField("status")&&t.push("eventDeleted")),t},getAttachmentTooltip:function(e){var t;return this.isPluginBlocked()?t="Go premium to view calendar events":e.isLoaded()?(e.isLocalOnlyAttachment()?t="Syncing event...":e.getField("isInvalid")&&(t="Item has an invalid date"),"cancelled"===e.getField("status")&&(t="Item was deleted from Google Calendar")):t="Plugin is loading data",t},matchAttachment:function(e,t){var i=DatePrefix+e.getField("startTime").toString(d.getFormat(DFormat.ShortDayTime));return(e.getField("summary")||"").indexOf(t)>=0||i.indexOf(t)>=0},areDatesEqual:function(t,i){var n=!1;return t&&i?e.isDateValid(t)&&e.isDateValid(i)&&(n=t.equals(i)):n=!t&&!i,n},parsePriority:function(t){var i=e.parseInt(t);return isNaN(i)&&(i=VMLIFlag.None),i}};return t.inherit(l,g),t.extend(g.prototype,D),g}),define("VMPluginManager",["globals","util","Constants","platform","EventDispatcher","Dispatcher","PluginRenderer","VMPlugin","plugins/Plugin_Drive","plugins/Plugin_Mailbird","plugins/Plugin_Gmail","plugins/Plugin_Moodo","plugins/Plugin_GCalendar"],function(e,t,i,n,r,a,s,o,c,l,d,h,u){function p(){this._plugins={},this._activePlugins=[],this._loadedDependencies={},this._isOnline=navigator.onLine,this._iteratingPlugins=!1,this._hasAdjustedCacheSizeRatio=!1,this._queueTimeout=void 0,this._forcedLastPossible=!1,this._numOutstandingReqs=0,this._pluginRenderer=new s,this.init()}var m=e.seconds(30);return p.prototype={init:function(){t.forceBind("_pumpRequestQueues",this),t.forceBind("_handleRequestResponse",this),t.forceBind("_handleBatchRequestResponse",this),this._setupRequestQueues(),this._pluginRenderer.registerDefaultRenderers(),e.billingManager.hasPremiumFeatures()?(this.notifyDependencyLoad(PluginDependency.EarlyAccess),this.notifyDependencyLoad(PluginDependency.PremiumSub)):e.billingManager.hasEarlyAccess()&&this.notifyDependencyLoad(PluginDependency.EarlyAccess),e.isDemoMode()&&this.notifyDependencyLoad(PluginDependency.DemoMode),window.addEventListener("offline",this.goOffline.bind(this)),window.addEventListener("online",this.goOnline.bind(this)),a.listen("resetEverything",this._clearRequestQueues.bind(this)),log("Cache Size Ratio: ",this.getCacheSizeRatio())},printStats:function(e){if(log("---- Plugin Stats ----"),void 0!==e){var t=this._plugins[e];log(t.name),log(" Stats: ",t.getStats())}else for(var i=Object.keys(this._plugins),n=0;n<i.length;++n){var t=this._plugins[i[n]],r=t.getStats();log(t.name),log(" Stats: ",r)}log("----------------------")},dumpQueueState:function(){var e=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var t=0;t<e.length;++t){var i=this._plugins[e[t]];console.log(i.name),i.dumpRequestQueue(!1)}},dumpQueueStats:function(){for(var e=Object.keys(this._plugins),t=0;t<e.length;++t){var i=this._plugins[e[t]];console.log(i.name),i.dumpQueueStats()}},getStats:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getStats();else for(var i=Object.keys(this._plugins),n=0;n<i.length;++n){var r=this._plugins[i[n]];t[r.id]=r.getStats()}return t},getCacheStats:function(e,t){var i={};if(void 0!==e)this._plugins[e].getCacheStats(t);else for(var n=Object.keys(this._plugins),r=0,a=0;a<n.length;++a){var s=this._plugins[n[a]];s.getCacheStats(function(e,a){a&&(i[e]=a),n.length===++r&&t(i)}.bind(this,n[a]))}},getState:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getState();else for(var i=Object.keys(this._plugins),n=0;n<i.length;++n){var r=this._plugins[i[n]];t[r.id]=r.getState()}return t},registerPlugins:function(){try{this.registerPlugin(new h)}catch(t){e.reportError(t)}try{this.registerPlugin(new c)}catch(t){e.reportError(t)}try{this.registerPlugin(new d)}catch(t){e.reportError(t)}try{this.registerPlugin(new u)}catch(t){e.reportError(t)}try{this.registerPlugin(new l)}catch(t){e.reportError(t)}},registerPlugin:function(t){try{e.PAssert(5087,!this._plugins[t.id],"Should never double-register a plguin")}catch(t){e.reportError(t)}this._plugins[t.id]=t,this.isAuthorized(t.id)&&this.loadPlugin(t.id)},getPlugin:function(e){return this._plugins[e]},getPluginFromPreviewCache:function(e){for(var t in this._plugins){var i=this._plugins[t];if(i._previewCache===e)return i}},loadPlugin:function(t){var i=this.getPlugin(t);try{e.PAssert(5088,i,"Must register a plugin before loading it")}catch(t){e.reportError(t)}this.activatePlugin(i)},unloadPlugin:function(e){},authorizePlugin:function(t,i,n){try{e.PAssert(5089,n&&e.isFunction(n),"Must provide a valid callback fn")}catch(t){e.reportError(t)}var r=this.getPlugin(t);try{e.PAssert(5090,r,"Must register a plugin before loading it")}catch(t){e.reportError(t)}r.authorize(i,function(e){this.onPluginAuthorized(r,e),n(e)}.bind(this))},deauthorizePlugin:function(t,i){try{e.PAssert(5091,i&&e.isFunction(i),"Must provide a valid callback fn")}catch(t){e.reportError(t)}var n=this.getPlugin(t);try{e.PAssert(5092,n,"Must register a plugin before loading it")}catch(t){e.reportError(t)}n.setSetting(n.Settings.IsEnabled,!1),this.deactivatePlugin(n),i(!0)},onPluginAuthorized:function(e,t){e.setSetting(e.Settings.IsEnabled,t),t&&this.activatePlugin(e)},activatePlugin:function(t){try{e.PAssert(5093,t,"Plugin must be valid to be activated")}catch(t){e.reportError(t)}if(this._activePlugins.indexOf(t.id)<0){t.activate(this._loadedDependencies)&&this._activePlugins.push(t.id)}else t.ensurePaneTypeIsActive()},deactivatePlugin:function(t){try{e.PAssert(5094,t,"Plugin must be valid to be deactivated")}catch(t){e.reportError(t)}if(this._activePlugins.indexOf(t.id)>=0){t.deactivate()&&this._activePlugins.remove(t.id)}},isOnline:function(){return this._isOnline||e.isDemoMode()},goOnline:function(){this._isOnline=!0,setTimeout(function(){this._setupRequestQueues(!0);for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.goOnline()}catch(e){this._reportPluginError(e)}}}.bind(this),2500)},goOffline:function(){this._isOnline=!1;for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.goOffline()}catch(e){this._reportPluginError(e)}}},onDocumentShared:function(e){for(var t=0;t<this._activePlugins.length;++t){var i=this._plugins[this._activePlugins[t]];try{i.onDocumentShared(e)}catch(e){this._reportPluginError(e)}}},writeCaches:function(){for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.saveOfflineCache()}catch(e){this._reportPluginError(e)}}},onShutdown:function(e){e&&this.writeCaches();for(var t=[],i=0;i<this._activePlugins.length;++i){var n=this._plugins[this._activePlugins[i]];try{var r=n.onShutdown();r&&t.push(r)}catch(e){this._reportPluginError(e)}}return t.length>0?t:void 0},onPurgeData:function(){for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.clearOfflineCache(!0)}catch(e){this._reportPluginError(e)}}},onClearData:function(){for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.clearData()}catch(e){this._reportPluginError(e)}}},getCacheSizeRatio:function(){var t=e.settings.get(Settings.cacheSizeRatio)||1;try{e.PAssert(5095,t>=0&&t<=1,"Invalid ratio value: ",t)}catch(t){e.reportError(t)}return t},hasAdjustedCacheSizeRatio:function(){return this._hasAdjustedCacheSizeRatio},_adjustCacheSizeRatio:function(){var t=this.getCacheSizeRatio();1===t&&e.sendEvent("CacheRatioChange","FromDefault");t>.35?t-=.1:e.sendEvent("CacheRatioChange","Minimum"),e.sendEvent("CacheRatioChange","Change",t),e.settings.set(Settings.cacheSizeRatio,t)},onCacheLimitExceeded:function(){if(!this._hasAdjustedCacheSizeRatio){this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.onCacheLimitExceeded()}catch(e){this._reportPluginError(e)}}}},getPluginsForType:function(e){var t;switch(e){case i.PluginType.Calendar:t=[PluginID.GCalendar];break;case i.PluginType.Email:t=[PluginID.Gmail];break;case i.PluginType.Storage:t=[PluginID.Drive];break;case i.PluginType.Unknown:t=[PluginID.Mailbird,PluginID.Moodo]}return t},hasAttachmentType:function(e,t){var i=!1;if(e.hasAttachments())for(var n=this.getPluginsForType(t),r=0;r<n.length;++r)if(e.hasPluginAttachment(n[r])){i=!0;break}return i},allowTextEditing:function(e){var t=!0;if(e&&e.hasAttachments())for(var i=e.getAttachments(),n=0;n<i.length;++n)if(!i[n].getPlugin().allowTextEditing(e,i[n])){t=!1;break}return t},validatePlugin:function(e){},runForEachPlugin:function(t){this._iteratingPlugins=!0;for(var i=0;i<this._activePlugins.length;++i)try{t(this.getPlugin(this._activePlugins[i]))}catch(t){e.reportError(t)}this._iteratingPlugins=!1},getAttachment:function(t,i){try{e.PAssert(5096,t.p,"Must specify the plugin string to be used: ",t)}catch(t){e.reportError(t)}try{e.PAssert(5097,t.id,"Must specify the ID of the data to use from the plugin: ",t)}catch(t){e.reportError(t)}var n=this.getPlugin(t.p);try{e.PAssert(5098,n,"Must specify a valid plugin: ",t)}catch(t){e.reportError(t)}if(n)return n.isActive()||this.activatePlugin(n),n.getAttachment(t.id,i?t:void 0)},createDisplayElement:function(t,i){try{e.PAssert(5099,t.p,"Must specify the plugin string to be used")}catch(t){e.reportError(t)}try{e.PAssert(5100,t.id,"Must specify the ID of the data to use from the plugin")}catch(t){e.reportError(t)}var n,r=this.getPlugin(t.p);if(r){var a=this.getAttachment(t,i);if(a)try{n=r.createDisplayElement(a)}catch(e){this._reportPluginError(e),n=this.createUnknownPluginElement(t.p)}else n=this.createUnknownPluginElement(t.p)}else n=this.createUnknownPluginElement(t.p);return n},createUnknownPluginElement:function(e){return{attrs:{cls:[],isUnknown:!0,plugin:PluginID.Moodo,"plugin-id":"Invalid"}}},measureAttachment:function(t,i){try{e.PAssert(5101,i&&i.attrs&&i.attrs.plugin,"Must have a valid plugin ID for measuring")}catch(t){e.reportError(t)}var n=0,r=this.getPlugin(i.attrs.plugin);try{e.PAssert(5102,r,"Should always be able to find a valid plugin: ",i.attrs.plugin)}catch(t){e.reportError(t)}return r&&(n=r.measureAttachment(t,i)),n},parseAttachmentEmbedString:function(t,i){try{e.PAssert(5103,t,"Must provide a valid string to parse")}catch(t){e.reportError(t)}var n=t.replace(/&quot;/g,'"').split(","),r={};if(n.forEach(function(e){var t=e.indexOf(":"),i=e.substr(0,t),n=e.substr(t+1,e.length-t-1);r[i]=n}),i){var a=n.length>2;r.displayElement=this.createDisplayElement(r,a)}return r},getAttachmentFromElement:function(t){var i=t.getAttribute("plugin"),n=t.getAttribute("plugin-id");try{e.PAssert(5104,i,"Element must have a plugin set")}catch(t){e.reportError(t)}try{e.PAssert(5105,n,"Element must have a plugin ID set")}catch(t){e.reportError(t)}return this.getPlugin(i).getAttachment(n)},handleDropEvent:function(t,i){for(var n=!1,r=0;r<this._activePlugins.length&&!n;++r){var a=this._activePlugins[r],s=this.getPlugin(a);try{n=s.handleDropEvent(t,i)}catch(e){this._reportPluginError(e)}}return n||(t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length>0||t.clipboardData&&t.clipboardData.items&&t.clipboardData.items.length>0)&&e.toasts.pushMessage({text:"Attaching files is a Premium feature, using the Drive plugin. Please enable Drive in the settings.",action:MessageAction.OpenSettings}),n},handleTapEvent:function(t,i,n,r){var a=!1,s=e.getPluginForElement(n.target);if(s){var o=s.getAttribute("plugin"),c=this.getPlugin(o);try{e.PAssert(5106,c,"Must be able to get a valid plugin from a plugin element")}catch(t){e.reportError(t)}if(c.isPluginBlocked())e.toasts.pushMessage(MessageID.PremiumRequired),a=!0;else{var l=s.getAttribute("plugin-id");try{e.PAssert(5107,l,"Must have a valid item ID for a plugin element")}catch(t){e.reportError(t)}try{a=c[r](t,i,l,n)}catch(e){this._reportPluginError(e)}}}return a},handleTapStart:function(e,t,i){return this.handleTapEvent(e,t,i,"handleTapStart")},handleTapClick:function(e,t,i){return this.handleTapEvent(e,t,i,"handleTapClick")},handleDoubleTap:function(e,t,i){return this.handleTapEvent(e,t,i,"handleDoubleTap")},isAuthorized:function(t){return!!e.isDemoMode()||!!this.getPlugin(t)&&!!this.getSetting(t,this.getPlugin(t).Settings.IsEnabled)},getSetting:function(e,t){return this.getPlugin(e).getSetting(t)},setSetting:function(e,t,i){return this.getPlugin(e).setSetting(t,i)},onAuthorizedSetting:function(e,t,i){this.getPlugin(e).onAuthorizedSetting(t,i)},isDependencyLoaded:function(e){return!!this._loadedDependencies[e]},notifyDependencyLoad:function(e,t){this._loadedDependencies[e]=t||!0;for(var i in this._plugins)try{this.getPlugin(i).onDependencyLoaded(e,t)}catch(e){this._reportPluginError(e)}},notifyDependencyUnload:function(e,t){},_handleBatchRequestResponse:function(t,i){try{e.PAssert(5109,t,"Plugin must be passed to response to know who is handling it")}catch(t){e.reportError(t)}this._numOutstandingReqs--;try{e.PAssert(5110,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){e.reportError(t)}try{t._handleBatchRequestResponse(i)}catch(e){this._reportPluginError(e)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()},_handleRequestResponse:function(t,i,n){try{e.PAssert(5111,i,"Plugin must be passed to response to know who is handling it")}catch(t){e.reportError(t)}if(!n){this._numOutstandingReqs--;try{e.PAssert(5112,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){e.reportError(t)}}try{i._handleRequestResponse(t,n)}catch(e){this._reportPluginError(e)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()},notifyNoOutstandingReqs:function(){try{e.PAssert(5113,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(t){e.reportError(t)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)},notifyHasPendingRemoteRequest:function(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)},notifyAuthorizationAdded:function(e){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(e)},verifyAuthorization:function(e){for(var t=[],i=0;i<this._activePlugins.length;++i){var n=this._activePlugins[i],r=this.getPlugin(n);if(r.isEnabled()){var a=r.verifyAuthorization(e);a.length>0&&(t.pushArray(a),r.notifyUnauthorized(e,a))}}t.length>0&&this._reportInvalidScopes(e,t)},_reportInvalidScopes:function(t,i){e.settings.get(Settings.enableOfflineAuth)?(n.mobile?e.toasts.pushMessage(MessageID.MissingOfflineMobile):e.toasts.pushMessage(MessageID.MissingOffline),e.toasts.clearMessage(MessageID.LostPermission)):e.toasts.isMessageVisible(MessageID.MissingOffline)||e.toasts.isMessageVisible(MessageID.MissingOfflineMobile)||e.toasts.pushMessage(MessageID.LostPermission),e.reportError(new Error("Invalid scopes reported"),{accountID:t,scopes:i})},_setupRequestQueues:function(e){var t=e?1:m;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,t)),this._forcedLastPossible=this._forcedLastPossible||!!e},_pumpRequestQueues:function(){this._runPumpRequestQueues(i.RequestPriority.UserBlocking),this._runPumpRequestQueues(i.RequestPriority.Default),this._runPumpRequestQueues(i.RequestPriority.Low)},_runPumpRequestQueues:function(t){var i=0;if(this.isOnline()){var n=6-this._numOutstandingReqs;try{e.PAssert(5114,n>=0,"Should never have more than max outstanding requests at any given point in time")}catch(t){e.reportError(t)}for(var r=0;n>0&&r<this._activePlugins.length;++r){var a=this._activePlugins[r],s=this.getPlugin(a),o=4-s.getNumOutstandingReqs();try{e.PAssert(5115,o>=0,"Must always have a postiive number of available plugin reqs")}catch(t){e.reportError(t)}var c=Math.min(n,o);if(c>0&&s.isReady()){var l=0;try{l=s._pumpRequestQueue(t,c,this._handleRequestResponse,this._handleBatchRequestResponse);try{e.PAssert(5116,l>=0,"Number of requests sent can never be negative")}catch(t){e.reportError(t)}}catch(e){this._reportPluginError(e)}try{e.PAssert(5117,n-l>=0,"Too Many requests sent")}catch(t){e.reportError(t)}i+=l,n-=l,this._numOutstandingReqs+=l}}}return this._forcedLastPossible=!1,this._setupRequestQueues(),i},_clearRequestQueues:function(){this._numOutstandingReqs=0;for(var e=0;e<this._activePlugins.length;++e){var t=this._activePlugins[e],i=this.getPlugin(t);try{i._clearRequestQueue()}catch(e){this._reportPluginError(e)}}},useRenderer:function(e,t){return this._pluginRenderer.useRenderer(e,t)},_reportPluginError:function(t){e.reportError(t)},parseEmailURL:function(e){var t={accountID:void 0,threadID:void 0,plugin:void 0},i=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g,n=i.exec(e);return n&&(t.accountID=n[1],t.threadID=n[2],t.plugin=this.getPlugin(PluginID.Gmail)),t},isAvailable:function(e){return this.getPlugin(e).isAvailable()},isActive:function(e){return this.getPlugin(e).isActive()},isEnabled:function(e){return this.getPlugin(e).isEnabled()},isGmailPaneEnabled:function(){return this.isEnabled(PluginID.Gmail)}},t.defineBase(p),t.extend(p.prototype,r),p}),define("Workspaces",["require","globals","Constants","util","platform","Hotkeys","Observable","ObservableComputed","ObservableArray"],function(e){function t(){}var i=e("globals"),n=e("Constants"),r=e("util"),a=e("platform"),s=e("Hotkeys"),o=e("Observable"),c=e("ObservableComputed"),l=e("ObservableArray"),d=1;return t.prototype={
init:function(){this._isSaving=!1,this._docID=void 0,this._syncState=void 0,this._localState=void 0,this._selectionState=void 0,this._workspaces=new l,this.selectedIndex=new o,this.workspaceName=new o,this.selected=new c([this.selectedIndex],function(){return this.get()}.bind(this)),r.forceBind("getNumWorkspaces",this),r.forceBind("onArrowsModeSelect",this),r.forceBind("onArrowsModeKey",this),r.forceBind("onWorkspaceMouseDown",this);var e=s.registerArrowsMode("BoardsW",{keyCode:KeyCode.W,primary:a.mac?n.Primary.Never:n.Primary.No,shift:n.Shift.No},this.getNumWorkspaces,this.onArrowsModeSelect,this.onArrowsModeKey),t=s.registerArrowsMode("BoardsB",{keyCode:KeyCode.B,primary:n.Primary.Never,shift:n.Shift.No},this.getNumWorkspaces,this.onArrowsModeSelect,this.onArrowsModeKey);this.hotkeySelectedIndex=new c([e,t],function(){return e.get()>=0?e.get():t.get()}),i.settings.listen("settingChanged",Settings.DefaultGroup,Settings.workspaces,this.onSettingChanged.bind(this))},add:function(){var e={id:this.getNextID(),name:this.getNextName(),panes:[]};return this._workspaces.push(e),this.save(),e},removeWorkspace:function(e){if(this._workspaces.length()>1){var t=this._workspaces.indexOf(e),i=this.selectedIndex.get();this._workspaces.remove(e),i>=t&&this.setSelectedIndex(i-1),delete this._localState[this.getDocID()][e.id],this.save()}},length:function(){return this._workspaces.length()},setSelectedIndex:function(e){try{i.PAssert(5118,i.isNumber(e),"Workspace index must be a number")}catch(e){i.reportError(e)}try{i.PAssert(5119,e>=0,"Index must be positive")}catch(e){i.reportError(e)}var t=this.getDocID();this.selectedIndex.set(e),this._selectionState[t]!==e&&(this._selectionState[t]=e,i.settings.set(Settings.selectedWorkspace,this._selectionState)),this.workspaceName.set(this.get().name)},switchTo:function(e){var t=this._workspaces.indexOf(e);this.setSelectedIndex(t)},getDocID:function(){return this._docID||(this.trackPaneState()?this._docID=i.settings.get(Settings.gdocId):this._docID="TEST"),this._docID},_findMatchingLocalPane:function(e,t){var i;if(t)for(var n=0;n<t.length;++n)if(t[n].id===e){i=t[n];break}return i},_generateUsablePaneState:function(e,t){for(var i=[],n=0;n<e.length;++n){var r=e[n],a=this._findMatchingLocalPane(r.id,t);i.push({id:r.id,item:r.item,type:r.type,showarch:r.showarch,search:r.search,viewMode:r.viewMode,sortType:r.sortType,displayLocalItems:r.displayLocalItems,displayCalendars:r.displayCalendars,agendaBlocksCollapsed:r.agendaBlocksCollapsed,offset:a?a.offset:0,itemState:a?a.itemState:{},isOverviewVisible:!!a&&a.isOverviewVisible,isExpanded:!!a&&a.isExpanded,selectedItem:a?a.selectedItem:void 0})}return i},_loadWorkspaces:function(){var e=this._workspaces.get();if(!e||0===e.length){try{i.PAssert(5120,this.getDocID(),"Should have a docID before loading workspaces panes from state")}catch(e){i.reportError(e)}this.load(),e=this._workspaces.get()}try{i.PAssert(5121,e.length>0,"Must have loaded workspaces and pane state before accessing")}catch(e){i.reportError(e)}return e},hasLoadedPaneState:function(){return!!this._localState},getPaneState:function(){var e=this._loadWorkspaces(),t=e[this.selectedIndex.get()],i=this._localState?this._localState[this.getDocID()]||[]:[];return t?this._generateUsablePaneState(t.panes,i[t.id]):[]},_generateSyncPaneState:function(e){for(var t=[],i=0;i<e.length;++i){var n=e[i];t.push({id:n.id,item:n.item,type:n.type,showarch:n.showarch,search:n.search,viewMode:n.viewMode,sortType:n.sortType,displayCalendars:n.displayCalendars,displayLocalItems:n.displayLocalItems,agendaBlocksCollapsed:n.agendaBlocksCollapsed})}return t},_generateLocalPaneState:function(e){for(var t=[],i=0;i<e.length;++i){var n=e[i];t.push({id:n.id,offset:n.offset,itemState:n.itemState,isOverviewVisible:n.isOverviewVisible,isExpanded:n.isExpanded,selectedItem:n.selectedItem})}return t},savePaneState:function(e,t){this._loadWorkspaces();try{t||this._saveSyncState(e),this._saveLocalState(e),this.save(t)}catch(e){i.reportError(e,{numWorkspaces:this._workspaces.length(),selectedIndex:this.selectedIndex.get(),docID:this.getDocID()})}},_saveLocalState:function(e){var t=this._workspaces.get()[this.selectedIndex.get()].id;try{i.PAssert(5122,t,"Must have a valid workspace ID")}catch(e){i.reportError(e)}var n=this._generateLocalPaneState(e),r=this.getDocID();try{i.PAssert(5123,r,"Must have a valid doc ID")}catch(e){i.reportError(e)}this._localState[r]||(this._localState[r]={}),this._localState[r][t]=n},_saveSyncState:function(e){var t=this._workspaces.get()[this.selectedIndex.get()];try{i.PAssert(5124,t,"Selected workspace does not exist")}catch(e){i.reportError(e)}t&&(t.panes=this._generateSyncPaneState(e))},renameWorkspace:function(e,t){for(var i=!1,n=0;n<this._workspaces.length();n++){var r=this._workspaces.get()[n];r!==e&&r.name===t&&(i=!0)}return!i&&(e.name=t,this.save(),!0)},get:function(){return this._workspaces.get()[this.selectedIndex.get()]},migrateLocalFromPaneState:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];t[i]=this.createDefaultState(n,["id","offset","itemState","isOverviewVisible","isExpanded"])}return t},migrateSyncFromPaneState:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];t[i]=this.createDefaultState(n,["id","item","type","showarch","search"])}return t},createDefaultState:function(e,t){for(var i=[],n=0;n<e.length;++n){var r=e[n],a={};for(var s in r)r.hasOwnProperty(s)&&t.indexOf(s)>=0&&(a[s]=r[s]);i.push(a)}return{workspaces:[{name:this.getNextName(),panes:i}]}},getNextName:function(){var e,t,i=this._workspaces.get(),n=1;do{e=!1,t=1===n&&i.length<1?"My First Board":"Board "+n,n++;for(var r=0;r<i.length;r++){if(i[r].name===t){e=!0;break}}}while(e);return t},getNextID:function(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++d},load:function(){var e,t,n=this.getDocID(),a=!1;if(n){if(this.trackPaneState()){var s=i.settings.get(Settings.workspaces);if(s){try{e=JSON.parse(s)}catch(t){i.reportError(t),e={}}try{var o=i.settings.get(Settings.localPaneState);t=o?JSON.parse(o):{}}catch(e){i.reportError(e),t={}}}else{a=!0;var c=r.storage.getItem("paneState");if(c){try{c=JSON.parse(c)}catch(e){i.reportError(e),c={}}e=this.migrateSyncFromPaneState(c),t=this.migrateLocalFromPaneState(c)}else e={},t={},e[n]=this.createDefaultState([])}}else e={},t={};if(e){var l=e[n];l&&l.workspaces||(e[n]=this.createDefaultState([]),l=e[n],a=!0),this._selectionState=i.settings.get(Settings.selectedWorkspace),this._selectionState&&i.isObject(this._selectionState)||(this._selectionState={});var d=this._selectionState[n]||0;d>=l.workspaces.length&&(d=l.workspaces.length-1),isNaN(d)&&(d=0),this._syncState=e,this._localState=t;for(var h=0;h<l.workspaces.length;++h){var u=l.workspaces[h];u.name=u.name.replace("Workspace","Board"),u.id||(u.id=this.getNextID(),a=!0)}this._workspaces.set(l.workspaces),this.setSelectedIndex(d)}a&&this.save()}},save:function(e){if(this.trackPaneState()){this._isSaving=!0;try{e||i.settings.set(Settings.workspaces,JSON.stringify(this._syncState)),i.settings.set(Settings.localPaneState,JSON.stringify(this._localState))}catch(e){i.reportError(e)}this._isSaving=!1}this.workspaceName.set(this.get().name)},trackPaneState:function(){return!i.isRunningScript()&&!i.isDemoMode()&&!0},onSettingChanged:function(){this._isSaving||this.load()},getNumWorkspaces:function(){return this._workspaces.get().length},onArrowsModeSelect:function(e){this.selectedIndex.set(e)},onArrowsModeKey:function(e){if(e>=KeyCode.D1&&e<=KeyCode.D9){var t=e-KeyCode.D1;if(t<this.getNumWorkspaces())return t}},getHotkeySelected:function(){return this._workspaces.get()[this.hotkeySelectedIndex.get()]},onWorkspaceMouseDown:function(e){s.exitArrowsMode("BoardsW"),s.exitArrowsMode("BoardsB")},moveTo:function(e,t){var i=this._workspaces.get()[e],n=this.get();this._workspaces.splice(e,1,void 0,!1),this._workspaces.splice(t,0,i);var r=this._workspaces.indexOf(n);this.selectedIndex.set(r)}},new t}),define("PaneManagerMobile",["require","globals","util","Observable","PaneFactory"],function(e){function t(){}var i=e("globals"),n=e("util"),r=e("Observable"),a=e("PaneFactory");return t.prototype={init:function(){this._isLoaded=!1,this._isSaving=!1,this._docID=void 0,this._state=void 0,this._historyOfPanes={},this.selected=new r(PaneMode.Outline),i.settings.listen("settingChanged",Settings.DefaultGroup,Settings.paneHistoryMobile,this.onSettingChanged.bind(this))},getDocID:function(){return this._docID||(this.trackPaneState()?this._docID=i.settings.get(Settings.gdocId):this._docID="TEST"),this._docID},loadPanesFromState:function(){try{i.PAssert(5125,this.getDocID(),"Should have a docID before loading mobile panes from state")}catch(e){i.reportError(e)}this.load();var e=[];return i.vmMain.pluginManager.isGmailPaneEnabled()&&e.push(this.loadPaneFromState(PaneMode.Gmail)),e.push(this.loadPaneFromState(PaneMode.Outline)),e.push(this.loadPaneFromState(PaneMode.Timeline)),e},loadPaneFromState:function(e){var t,n=this.getHistoryByType(e);return t=n&&n.length>0&&n[0].type===e?i.vmMain.paneManager.loadPaneFromState(n[0]):a.createPane(e),t.init(),t},hasLoadedPaneState:function(){return!!this._historyOfPanes},getPaneState:function(){this._historyOfPanes||this.load();var e=[];return i.vmMain.pluginManager.isGmailPaneEnabled()&&e.push(this.getHistoryByType(PaneMode.Gmail)[0]),e.push(this.getHistoryByType(PaneMode.Outline)[0]),e.push(this.getHistoryByType(PaneMode.Timeline)[0]),e},savePaneState:function(e){try{i.PAssert(5126,e&&e.length>0,"Must provide at least one valid pane")}catch(e){i.reportError(e)}if(e[0]){var t=this.getDocumentState();try{i.PAssert(5127,t,"Document pane state must exist")}catch(e){i.reportError(e)}if(t){try{i.PAssert(5128,t.panes,"Panes must be defined here")}catch(e){i.reportError(e)}t.panes||(t.panes={});for(var n=0;n<e.length;n++){var r=e[n];this._historyOfPanes[r.type]=t.panes[r.type]=[r]}}}this.save()},getDocumentState:function(){var e=this.getDocID();return this._state[e]},getHistoryByType:function(e){var t=this._historyOfPanes[e];return t&&t[0]||(this._historyOfPanes[e]=[]),this._historyOfPanes[e]},migrateFromPaneState:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];t[i]=this.createDefaultState(n),n[0]&&(t[i].selected=n[0].type)}return t},createDefaultState:function(e){var t={selected:PaneMode.Outline,panes:{}};if(e)for(var i=0;i<e.length;i++)t.panes[e[i].type]=[e[i]];return t},load:function(){var e,t,r=this.getDocID(),a=!1;if(r){if(this.trackPaneState()){var s=i.settings.get(Settings.paneHistoryMobile);if(s)try{t="A",e=JSON.parse(s),t="AA"}catch(e){i.reportError(e),t="AB"}else{t="B",a=!0;var o=n.storage.getItem("paneState");if(o){try{o=JSON.parse(o),t="BA"}catch(e){t="BB",i.reportError(e),o={}}e=this.migrateFromPaneState(o)}else t="C"}}else t="D";e=e||{};var c=e[r];c||(c=e[r]=this.createDefaultState([]),a=!0),c.selected||(c.selected=PaneMode.Outline);try{i.PAssert(5129,c.panes,"Should have panes set by now",t)}catch(e){i.reportError(e)}c.panes||(c.panes={}),this._state=e,this._historyOfPanes=c.panes||{},this.selected.set(c.selected),a&&this.save()}else this._state={},this.selected.set(PaneMode.Outline);this._isLoaded=!0},save:function(){if(this.trackPaneState()){this._isSaving=!0;var e=this.getDocumentState();try{i.PAssert(5130,e,"Document pane state must exist")}catch(e){i.reportError(e)}e&&(e.selected=this.selected.get());try{i.settings.set(Settings.paneHistoryMobile,JSON.stringify(this._state))}catch(e){i.reportError(e)}this._isSaving=!1}},trackPaneState:function(){return!i.isRunningScript()&&!i.isDemoMode()},onSettingChanged:function(){this._isSaving||this.load()}},new t}),define("PaneManager",["globals","Constants","data","util","platform","PaneFactory","Dispatcher","Trigger","Sel","Observable","ObservableArray","tracker","Workspaces","PaneManagerMobile","MobileUI","DesktopUI","Autocomplete"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m,f,g){function v(){this.enableTempPanePosition=!1,this.totalWidth=new l(0),this._panesById={},this._panes=new d,this.displayPanes=new d,this.isLoading=new l(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0,e.getLoginState()===LoginState.LOGGED_IN&&this.setupInitialTimeout(),this.init()}window.__TOTAL_PANES=0;return v.prototype={init:function(){r.mobile?(p.init(),this.mobilePaneSelected=p.selected):u.init(),n.forceBind("onResize",this),n.forceBind("updateDisplayPanes",this),this._panes.listen(this.updateDisplayPanes),f.showSidebar.listen(this.onResize),r.onResize.listen(this.onResize),s.listen("panesChanged",this.updateDisplayPanes),r.mobile||setTimeout(function(){e.intro.isVisible.listen(this.onResize)}.bind(this),0),this.onResize()},onPluginGmailToggled:function(){this.savePaneState(),this.loadPanesFromState()},loadInitialState:function(){if(r.mobile){var t=e.vmMain.pluginManager.getPlugin(PluginID.Gmail);t.onSettingChanged(t.Settings.IsEnabled,this.onPluginGmailToggled.bind(this))}this.loadPanesFromState(),r.mobile||u.selected.listen(this.onWorkspaceChanged.bind(this)),this._isInitialStateLoaded=!0;var i=e.isDemoMode()&&n.getURLParam("panes"),a=i&&i.split(":");r.mobile||a&&this.loadDemoPanes(a)},loadDemoPanes:function(t){this.clearPanes();for(var n=0;n<t.length;n++){var r=t[n].split(",");if("help"===r[0])e.vmMain.showHelp();else{var s=r[0];"1"===s?s=PaneMode.Outline:"2"===s&&(s=PaneMode.Timeline);var o={};if(r.length>1){if(r[1]){for(var l={text:r[1]},d=r[1].split(" "),h=0;h<d.length;h++){var u=!1,p="-"===d[h][0],m=d[h].replace("-","");if(m.indexOf("//")>=0)u=!0,l.complete=p?-1:1;else if(m.indexOf("*")>=0)u=!0,l.starred=p?-1:1;else if(m.indexOf("!")>=0){u=!0;var f;3===m.length?f=VMLIFlag.P0:2===m.length?f=VMLIFlag.P1:1===m.length&&(f=VMLIFlag.P2),l.priority=f}u&&(l.text=l.text.replace(d[h],""))}o.search=l}var g=void 0;r[2]&&(g=i.getModel(r[2])),o.item=g||i.getRootModel()}var v=a.createPane(s,o);v&&this.addPaneAtIndex(v)}}var y=this.getPaneAtIndex(0);try{e.PAssert(5131,y,"Must always have at least one valid pane in demo mode")}catch(t){e.reportError(t)}y&&(c.setFocusedPane(y),e.vmMain.zoomin(y.getItem(),!0))},getStats:function(e){var t={};return void 0===e?this.runForEachPane(function(e){t[e.id]=e.getStats()}):t=this.getPaneById(e).getStats(),t},setupInitialTimeout:function(){0===this._panes.length()&&(this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))},_timeoutLoadFailed:function(){e.reportError(new Error("Pane Load Timeout")),this._initialTimeout=void 0},notifyPanes:function(){this._panes.notify()},getPaneTopPadding:function(){return r.mobile?e.topBarHeight:e.paneTop},onResize:function(){this.updatePaneRects()},getNextPaneID:function(){return++window.__TOTAL_PANES+"P"+Date.now()},getAllPerPaneState:function(e,t){for(var i=[],n=this.paneCount(),r=0;r<n;++r){var a=this.getPaneAtIndex(r);i.push(a.getPerPaneState(e,t))}return i},setAllPerPaneState:function(e,t,i){for(var n=this.paneCount(),r=0;r<n;++r){this.getPaneAtIndex(r).setPerPaneState(e,t,i)}},deletePerPaneState:function(e,t){var i=this.getPaneById(e);i&&i.deletePerPaneState(t)},addWorkspace:function(){try{e.PAssert(5132,!r.mobile,"Should never add a new workspace on mobile")}catch(t){e.reportError(t)}var t=u.add();return this.switchToWorkspace(t),t},switchToWorkspace:function(e){this.savePaneState(!0),u.switchTo(e)},getPaneState:function(){return r.mobile?p.getPaneState():u.getPaneState()},hasLoadedPaneState:function(){return r.mobile?p.hasLoadedPaneState():u.hasLoadedPaneState()},savePaneState:function(t){try{e.PAssert(5133,!this._isLoading,"Bad stuff! Saving pane state during load")}catch(t){e.reportError(t)}if(this._isInitialStateLoaded){var i=this.recreatePaneState();r.mobile?p.savePaneState(i,t):u.savePaneState(i,t)}},updatePaneStateForPane:function(t){try{e.PAssert(5134,t,"Must pass in a valid pane to update")}catch(t){e.reportError(t)}this.savePaneState()},recreatePaneState:function(){var e=[];return this.runForEachPane(function(t){e.push(t.getSaveInfo())}),e},loadPaneFromState:function(t){if(t.id&&this.isPaneActive(t.id))return this._panesById[t.id];var n=t.item||t.focus,r=i.getModel(n);r&&r.isDeleted()&&(r=void 0);var s=t.type||(1===t.mode?PaneMode.Outline:PaneMode.Timeline);"PaneNormal"===s&&(s=PaneMode.Outline);var o=e.clone(t);o.item=r,o.deferredItemID=r?void 0:n,o.offset=t.offset;var c;return o.id&&this.isPaneActive(o.id)||(c=a.createPane(s,o))&&(t.id=c.id,t.showarch&&c.showArchived.set(!0),c.applyItemState(t.itemState)),c},loadPanesFromState:function(){if(r.mobile){for(var t=p.loadPanesFromState(),i=0;i<t.length;i++){var n=t[i];this._panesById[n.id]=n}this._panes.set(t,!1);try{e.PAssert(5135,this.mobilePaneSelected.get(),"Mobile pane selected should be set")}catch(t){e.reportError(t)}var a=this.indexOfPaneType(this.mobilePaneSelected.get());t[a]||(this.mobilePaneSelected.set(PaneMode.Outline),a=this.indexOfPaneType(PaneMode.Outline));try{e.PAssert(5136,a>=0&&t[a],"Mobile selected pane does not exist",{selected:this.mobilePaneSelected.get(),isGmailEnabled:e.vmMain.pluginManager.isGmailPaneEnabled(),numPanes:t.length,outlineIsSomething:!!t[this.indexOfPaneType(PaneMode.Outline)]})}catch(t){e.reportError(t)}c.setFocusedPane(t[a]),this.notifyPanes()}else{var s=this.getPaneState();if(s){var o=!1;this._isLoading=!0,e.batchRenderUpdates(function(){var t=[];if(e.vmMain.beginUpdateItems(),this.paneCount()>0){for(var i=0;i<this.paneCount();++i){var n=this.getPaneAtIndex(i);t.push(n.id),this.unloadPane(n)}this._panes.set([])}for(var i=0;i<s.length;++i){var r=s[i];t.indexOf(r.id)>=0&&(r.id=this.getNextPaneID());var n=this.loadPaneFromState(r);n?(this.addPaneAtIndex(n,void 0,!0,!1),c.setFocusedPane(n,!0),e.vmMain.zoomin(n.getItem(),!0)):(s.splice(i,1),o=!0,--i)}this._isLoading=!1,o&&this.savePaneState(),this.notifyPanes(),e.vmMain.commitUpdateItems()}.bind(this))}}},isPaneActive:function(e){return!!this._panesById[e]},createDefaultPane:function(){if(r.mobile||u.length()<2){var t=a.createPane(PaneMode.Outline,{id:this.getNextPaneID(),isDefaultPane:!0,isOverviewVisible:!0});this.addPaneAtIndex(t),c.setFocusedPane(this.getPaneAtIndex(0)),e.vmMain.zoomin(e.vmMain.root(),!0)}},createPaneAtIndex:function(t,i,n,r){try{e.PAssert(5137,t,"Must supply a valid pane type")}catch(t){e.reportError(t)}try{e.PAssert(5138,!this._iteratingPanes,"Should not change pane array while iterating")}catch(t){e.reportError(t)}isNaN(i)&&(i=this.paneCount()),n=n||{},n.id=n.id||this.getNextPaneID();var s=a.createPane(t,n);return s?this.addPaneAtIndex(s,i,!1,r):e.reportError(new Error("Invalid pane created: "+t+" | "+i)),s},addPaneAtIndex:function(i,n,r,a){try{e.PAssert(5139,i,"Must supply a valid pane")}catch(t){e.reportError(t)}try{e.PAssert(5140,!this._panesById[i.id],"Should never add the same pane twice")}catch(t){e.reportError(t)}if(this._panesById[i.id]=i,this.enableTempPanePosition&&this._panes.length()>0&&n===this._panes.length()){var s=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:s,left:s.rect.get().left+t.PaneSpaceSize}}if(isNaN(n)?this._panes.push(i,a):this._panes.splice(n,0,i,a),i.init(),i.isExpanded.listen(this.onResize),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(i),!r){var o=this.getPaneState();isNaN(n)?o.push(i.getSaveInfo()):o.splice(n,0,i.getSaveInfo()),this.savePaneState()}},unloadPane:function(t){t.isExpanded.unlisten(this.onResize),s.fireEvent("paneRemoved",[t]);try{e.PAssert(5141,this._panesById[t.id],"Should never add the same pane twice")}catch(t){e.reportError(t)}this._panesById[t.id]=void 0,t.destroy()},removePaneAtIndex:function(t,i,n){try{e.PAssert(5142,!isNaN(t),"Must supply a valid index to remove from")}catch(t){e.reportError(t)}try{e.PAssert(5143,!this._iteratingPanes,"Should not change pane array while iterating")}catch(t){e.reportError(t)}var r,a=(this.getPaneAtIndex(t),this._panes.splice(t,1,void 0,i)[0]);try{e.PAssert(5144,a,"Must have removed a valid pane")}catch(t){e.reportError(t)}return this.unloadPane(a),this.getPaneState().splice(t,1),this.savePaneState(),r=a.id,this.ensurePaneInView(),r},removePanesByType:function(t){if(r.mobile){try{e.PAssert(5145,t,"Must supply a valid pane type to remove")}catch(t){e.reportError(t)}e.focusedPane&&e.focusedPane.type!==t||this.swapToPane(PaneMode.Outline)}else{var i=[];this.runForEachPane(function(e){i.push(e)},t);for(var n=0;n<i.length;++n)this.removePane(i[n])}},indexOfPaneType:function(e){return this._panes.indexOfWithProperty("type",e)},swapToPane:function(t,i){try{e.PAssert(5146,r.mobile,"We only perform pane swapping on mobile")}catch(t){e.reportError(t)}try{e.PAssert(5147,!this._iteratingPanes,"Should not change pane array while iterating")}catch(t){e.reportError(t)}m.setOverviewVisibility(e.focusedPane,!1);var n=this.indexOfPaneType(t);n<0&&(this.loadPanesFromState(),n=this.indexOfPaneType(t));var a=this._panes.get()[n];this.animatePaneSwap=i;try{e.PAssert(5148,a,"Swapping to undefined pane",t,this._panes.length())}catch(t){e.reportError(t)}return c.setFocusedPane(a),this.mobilePaneSelected.set(t),this.savePaneState(),a},removeFocusedPane:function(){return this.removePane(e.focusedPane)},removePane:function(e){var t=this.getPaneIndex(e);return this.removePaneAtIndex(t)},clearPanes:function(t){try{e.PAssert(5149,e.isDemoMode(),"Should only be clearing panes in demo mode")}catch(t){e.reportError(t)}c.setFocusedPane(void 0),this.runForEachPane(function(e){e.destroy()}),this._panesById={},this._panes.set([],t)},clearPaneCaches:function(){this.runForEachPane(function(e){e.getInfiniteList().clearCache()})},getPaneAtIndex:function(e){return this._panes.get()[e]},getPaneIndex:function(e){return this._panes.get().indexOf(e)},getPaneById:function(t){try{e.PAssert(5152,this._panesById[t],"Should never request a pane that is not currently loaded")}catch(t){e.reportError(t)}return this._panesById[t]},getPanesByType:function(e){for(var t=[],i=this.paneCount(),n=0;n<i;++n){var r=this.getPaneAtIndex(n);e&&r.type!==e||t.push(r)}return t},paneCount:function(){return this._panes.get().length},runForEachPane:function(t,i){this._iteratingPanes=!0;for(var n=this.paneCount(),r=0;r<n;++r){var a=this.getPaneAtIndex(r);try{e.PAssert(5153,!a.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(t){e.reportError(t)}if(!i||a.type===i)try{t(a)}catch(t){e.reportError(t)}}this._iteratingPanes=!1},applyFnToPanes:function(t,i){this._iteratingPanes=!0;for(var n=this.paneCount(),r=0;r<n;++r){var a=this.getPaneAtIndex(r);try{e.PAssert(5154,!a.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(t){e.reportError(t)}if(!i||a.type===i){var s=a[t];try{e.PAssert(5155,s,"Must provide a valid function name for the given pane type")}catch(t){e.reportError(t)}try{s.apply(a,Array.prototype.slice.call(arguments,2))}catch(t){e.reportError(t)}}}this._iteratingPanes=!1},dragPaneTo:function(e,t,i){for(var n,r=this._panes.get(),a=r.indexOf(e),s=-1,o=Number.MAX_VALUE,c=this.paneCount(),l=0;l<c;++l){var d=this.getPaneAtIndex(l),h=d.rect.get(),u=Math.abs(l<=a?h.left-t:h.right-i);u<o&&(o=u,s=l)}if(s>=0){var p=r.indexOf(e);p!==s&&(r.splice(s,0,r.splice(p,1)[0]),this._panes.set(r),this.savePaneState(),n=!0)}return n},paneSortFn:function(e,t){return e.uniqueID-t.uniqueID},clearLoadTimeout:function(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0},updateDisplayPanes:function(){this._initialTimeout&&this.clearLoadTimeout();for(var e=this._panes.get().slice(0).sort(this.paneSortFn),t=[],i=0;i<e.length;++i){var n=e[i];n.isOverviewVisible()&&t.push({type:"overview",pane:n}),t.push({type:"pane",pane:n}),n.isExpanded.get()&&t.push({type:"emailPreview",pane:n})}this.updatePaneRects(),this.displayPanes.set(t),this.isLoading.set(!1)},updatePaneRects:function(){var i,n,a=this._panes.get(),o=r.windowWidth()-(r.mobile?0:f.getSidebarWidth()-2),c=r.windowHeight()-this.getPaneTopPadding();if(e.isDemoInIframe()&&(o-=5),r.mobile){for(n=0;n<a.length;n++){var l={left:n*r.windowWidth(),top:0,width:o,height:c,right:o,bottom:c};i=a[n],e.areObjectsEqual(i.rect.get(),l)||i.rect.set(l)}this.mobilePaneSelected.notify()}else if(a.length>0){var d,h=t.PaneSpaceSize,u=t.FixedPaneWidth,p=[],m=[],g=0;for(n=0;n<a.length;n++)i=a[n],i.isExpanded.get()?(m[n]=t.ExpandedPaneWidth,g+=r.emailPreviewSize()+t.ExpandedPaneWidth):p.push({index:n,pane:i}),i.getOverview().isVisible.get()?g+=t.OverviewWidth:n>0&&(g+=h);for(var v=o-g;p.length>0;){var y=Math.floor(v/p.length),b=-1,S=y;for(n=0;n<p.length;n++)i=p[n].pane,i.maxWidth<S&&(b=n,S=i.maxWidth);if(b>=0)d=p[b].pane.maxWidth,m[p[b].index]=d,g+=d,v-=d,p.splice(b,1);else{var E=-1,C=y;for(n=0;n<p.length;n++)i=p[n].pane,i.minWidth>C&&(E=n,C=i.minWidth);if(!(E>=0)){for(n=0;n<p.length;n++)m[p[n].index]=y,g+=y;break}d=p[E].pane.minWidth,m[p[E].index]=d,g+=d,v-=d,p.splice(E,1)}}var P=Math.max((o-g)/2,0),T=Math.floor(P),D=!1;for(T!==Math.round(P)&&(D=g+1===o),e.isDemoInIframe()&&(T+=2),n=0;n<a.length;n++)i=a[n],d=m[n]+(D&&n===a.length-1?1:0),i.isOverviewVisible()?T+=t.OverviewWidth:0!==n&&(T+=h),this.tempPositionForNewPane&&i.rect.get()?(i.rect.get().width=d,i.rect.notify()):i.rect.set({left:T,top:0,width:d,height:c,right:T+d,bottom:c}),T+=d,i.isExpanded.get()&&(T+=r.emailPreviewSize());e.intro&&e.intro.isVisible&&e.intro.isVisible.get()&&(T+=h,e.intro.position.set(T),T+=u)}else T=(o-t.AddPaneAreaSize)/2;if(this.tempPositionForNewPane){var M=a[a.length-1],_=M.rect.get(),I=this.tempPositionForNewPane;_.left=I.left+I.pane.rect.get().width}this.totalWidth.set(T),s.fireEvent("paneSizeChanged",[])},ensurePaneInView:function(t){if(e.vmMain.panesContainer){if(!t){var i=this._panes.get();t=i[i.length-1]}if(t){var n=t.rect.get();if(n){var a=n.width+(t.isExpanded.get()?r.emailPreviewSize():0),s=r.windowWidth()-(r.mobile?0:f.getSidebarWidth()-2),o=e.vmMain.getScrollOffset(),c=n.left-o,l=n.left+a-o;(c<0||l>s)&&e.vmMain.setScrollOffset(n.left+a-s)}}}},hasScrollbar:function(){return this.totalWidth.get()>r.windowWidth()},onWorkspaceChanged:function(){this.loadPanesFromState()},addPaneByButton:function(t,i){if(e.vmMain.paneFactory.canCreatePane(t)){var n=this.createPaneAtIndex(t,void 0,{item:i});n&&(h.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddPane,data:{type:t,pane:n}}),e.sendEvent("Menu","AddPane_"+t)),c.setFocusedPane(n),n.onAdded(),e.menus.closeContextMenuReact()}},zoomPaneByButton:function(i,n){i===PaneMode.Gmail?e.menus.openContextMenuReact({componentName:"ReactContextMenuSelectGmailAccount",element:n}):g.showPopup({mode:t.AutocompleteMode.Move,text:"Select item to zoom to",buttonText:"ZOOM",elementDisplay:n,onSelected:function(e){this.addPaneByButton(i,e.item)}.bind(this)})}},n.defineBase(v),v}),define("RemoteDoc",["globals","data","util","platform","goog"],function(e,t,i,n,r){function a(e,t){this._type=e,this._name=t,this._doc=void 0,this._loadFn=void 0,this._errorFn=void 0,this._initFn=void 0}return a.prototype={open:function(t,i,n,r){try{e.PAssert(5156,!1,"SubClass must override")}catch(t){e.reportError(t)}},close:function(){try{e.PAssert(5157,!1,"SubClass must override")}catch(t){e.reportError(t)}},_getDocument:function(){return this._doc},getModel:function(){return this._doc.getModel()},setLoadFn:function(e){return this._loadFn=e,this._onLoad.bind(this)},setInitFn:function(e){return this._initFn=e,this._onInit.bind(this)},setErrorFn:function(e){return this._errorFn=e,this._onError.bind(this)},_onLoad:function(t){this._doc=t;try{this._loadFn(t)}catch(t){e.reportError(t)}},_onError:function(e){this._errorFn(e)},_onInit:function(t){try{this._initFn(t)}catch(t){e.reportError(t)}}},i.defineBase(a),a}),define("GRealtimeDoc",["globals","data","util","platform","goog","RemoteDoc"],function(e,t,i,n,r,a){function s(e){this._super.constructor.call(this,DocType.GRealtime,e),this.init()}var o={init:function(){},open:function(e,t,i,n){gdata.driveRealtimeLoad(e,this.setLoadFn(t),this.setInitFn(i),this.setErrorFn(n))},close:function(){}};return i.inherit(a,s),i.extend(s.prototype,o),s}),define("GAppDataDoc",["globals","data","util","platform","goog","RemoteDoc"],function(e,t,i,n,r,a){function s(e){this._super.constructor.call(this,DocType.GAppData,e),this.init()}var o={init:function(){},open:function(e,t,i,n){gapi.drive.realtime.loadAppDataDocument(this.setLoadFn(t),this.setInitFn(i),this.setErrorFn(n))},close:function(){}};return i.inherit(a,s),i.extend(s.prototype,o),s}),define("RealtimeDocManager",["globals","data","util","platform","goog","GRealtimeDoc","GAppDataDoc"],function(e,t,i,n,r,a,s){function o(){this._activeDocuments={},this._activeTypes={},this._authorizedTypes={},this._listeners=[],this.init()}return window.DocType={GRealtime:0,GAppData:1},o.prototype={init:function(){var t=function(){window.gapi.drive?(this._activateType(DocType.GRealtime),this._activateType(DocType.GAppData)):(e.reportError(new Error("Fatal error while loading google drive - did not add self to gapi")),window.addEventListener("gapiDriveLoaded",t.bind(this)))}.bind(this);window.gapi&&window.gapi.drive?t():window.addEventListener("gapiDriveLoaded",t.bind(this))},_activateType:function(t){if(this._activeTypes[t])try{e.PAssert(5158,!1,"Should only be activating a doc type once")}catch(t){e.reportError(t)}else this._activeTypes[t]=!0,this._authorizedTypes[t]&&this._notifyListeners(t)},_authorizeType:function(e){this._authorizedTypes[e]||(this._authorizedTypes[e]=!0,this._activeTypes[e]&&this._notifyListeners(e))},registerForReadyNotification:function(t,i){if(e.isArray(this._listeners[t]))this._listeners[t].push(i);else if(void 0===this._listeners[t])this._listeners[t]=[i];else{try{e.PAssert(5159,-1===this._listeners[t],"After a type is loaded, do not queue listners")}catch(t){e.reportError(t)}i()}},_notifyListeners:function(t){if(e.isArray(this._listeners[t]))for(var i=0;i<this._listeners[t].length;++i)this._listeners[t][i]();this._listeners[t]=-1},notifyGoogleAuthorization:function(){for(var e=r.getAuthorizedScopes(),t=0;t<e.length;++t)switch(e[t]){case GScope.Drive:case GScope.DriveFull:this._authorizeType(DocType.GRealtime);break;case GScope.DriveAppData:this._authorizeType(DocType.GAppData)}},createDocument:function(t,i){try{e.PAssert(5160,t,"Must provide a document type")}catch(t){e.reportError(t)}i=i||e.generateTempId();try{e.PAssert(5161,!this._activeDocuments[i],"Should not name two documents the same thing")}catch(t){e.reportError(t)}var n;switch(t){case DocType.GRealtime:n=new a(i);break;case DocType.GAppData:n=new s(i);break;default:try{e.PAssert(5162,!1,"Invalid document type requested",t)}catch(t){e.reportError(t)}}return this._activeDocuments[i]=n,n}},i.defineBase(o),o}),define("RecurringTimedTask",["globals","util","RingBuffer"],function(e,t,i){function n(t,n){try{e.PAssert(5163,n,"Must provide a valid set of task options: "+t)}catch(t){e.reportError(t)}this._id=t,this._iterationID=void 0,this._isAsync=n.async,this._isAsyncRunning=!1;try{e.PAssert(5165,n.task&&e.isFunction(n.task),"Must provide a valid task function")}catch(t){e.reportError(t)}this._task=n.task,this._delay=n.delay;try{e.PAssert(5166,void 0===n.asyncTimeout||n.async,"Should never specify an async timeout for a non-async task")}catch(t){e.reportError(t)}this._asyncTimeout=n.asyncTimeout||0,this._pauseWhileIdle=n.pauseWhileIdle||!1,this._minDelayOnResume=n.minDelayOnResume||!1;try{e.PAssert(5167,this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume")}catch(t){e.reportError(t)}this._suspended=!1,this._remainingTime=0,this._lastUpdate=n.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=n.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new i(10),this._actions=new i(20),this.init()}var r={Suspend:"Suspend",Resume:"Resume",AsyncSkip:"AsyncSkip",
SyncSkip:"SyncSkip",Run:"Run",AsyncBegin:"AsyncBegin",AsyncComplete:"AsyncComplete",AsyncAbort:"AsyncAbort",AsyncTimeout:"AsyncTimeout"},a={init:function(){t.forceBind("_runUpdate",this),t.forceBind("_notifyAsyncComplete",this),t.forceBind("_handleAsyncAbortTimeout",this),this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()},getStats:function(){var e={numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()};return e},cancel:function(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0},abortAsync:function(){this._numAsyncAborts++,this.performAction(r.AsyncAbort),this._notifyAsyncAborted()},performAction:function(t){try{e.PAssert(5168,t,"Invalid action reported")}catch(t){e.reportError(t)}this._actions.push({action:t,time:Date.now()})},notifyOfSuspend:function(){this._pauseWhileIdle&&(this.performAction(r.Suspend),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)},notifyOfResume:function(){if(this._pauseWhileIdle){this.performAction(r.Resume);var t=!this._suspended;this._suspended=!1;var i;if(this._minDelayOnResume)i=Math.max(0,this._minDelay-this._timeSinceLastUpdate());else{try{e.PAssert(5169,t||this._remainingTime>=0,"Must have a valid remaining time set for task")}catch(t){e.reportError(t)}i=this._remainingTime,this._remainingTime=-1}i=Math.max(500,i),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,i)}},isAsync:function(){return this._isAsync},isAsyncRunning:function(){return this.isAsync()&&this._isAsyncRunning},_notifyUpdateAsyncSkipped:function(){this._numUpdatesAsyncSkipped++,this.performAction(r.AsyncSkip)},_notifyUpdateSkipped:function(){this._numUpdatesSkipped++,this.performAction(r.SyncSkip)},_notifyUpdateRun:function(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(r.Run)},_timeSinceLastUpdate:function(){return Date.now()-this._lastUpdate},_asyncRunTime:function(){var e=0;return this._asyncStartTime>0&&(e=Date.now()-this._asyncStartTime),e},_notifyAsyncBegin:function(){return this.performAction(r.AsyncBegin),this._isAsyncRunning=!0,this._iterationID=e.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID},_notifyAsyncComplete:function(){this.performAction(r.AsyncComplete),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)},_notifyAsyncAborted:function(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)},_handleAsyncAbortTimeout:function(){this._numAsyncTimeouts++,this.performAction(r.AsyncTimeout),this._notifyAsyncAborted()},_runUpdate:function(t){try{e.PAssert(5170,!this._isCancelled,"Should never run a cancelled task")}catch(t){e.reportError(t)}try{e.PAssert(5172,!this._updateIsRunning,"Should not run another update while already running one: "+this._id)}catch(t){e.reportError(t)}if(!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,t),0)):this._notifyUpdateAsyncSkipped();else{var i=this._notifyAsyncBegin();try{this._task(function(){try{e.PAssert(5174,i===this._iterationID,"Callback is only valid while task is considered running")}catch(t){e.reportError(t)}this._notifyAsyncComplete(),t&&t.apply(this,arguments)}.bind(this))}catch(t){e.reportError(t),this._notifyAsyncComplete()}}else try{this._task()}catch(t){e.reportError(t)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}},requestUpdate:function(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var e=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e),this._lastSetDelay=this._minDelay}},forceUpdate:function(e){this._runUpdate(e)},breakOnNextUpdate:function(){}};return t.extend(n.prototype,a),n}),define("RecurringTaskManager",["globals","util","platform","RecurringTimedTask"],function(e,t,i,n){function r(){this._tasks={},this.init()}var a={init:function(){window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this))},getStats:function(){var e={};for(var t in this._tasks)e[t]=this._tasks[t].getStats();return e},createRecurringTask:function(t,i){try{e.PAssert(5175,!this._tasks[t],"Must not register multiple tasks with the same ID")}catch(t){e.reportError(t)}var r=new n(t,i);return this._tasks[t]=r,r},getRecurringTask:function(t){try{e.PAssert(5176,this._tasks[t],"Must only retreive a valid recurring task")}catch(t){e.reportError(t)}return this._tasks[t]},hasRecurringTask:function(e){return!!this._tasks[e]},cancelRecurringTask:function(t){try{e.PAssert(5177,this._tasks[t],"Must only cancel a valid recurring task")}catch(t){e.reportError(t)}this._tasks[t].cancel(),delete this._tasks[t]},_handleFocus:function(){for(var e in this._tasks)this._tasks[e].notifyOfResume()},_handleBlur:function(){for(var e in this._tasks)this._tasks[e].notifyOfSuspend()}};return t.extend(r.prototype,a),r}),define("DeferredTask",["require","globals","util","AccountManager"],function(e){function t(e,t,r,a,s,o,c,l,d){this._id=e,this._remoteID=s,this._type=t;try{i.PAssert(5178,i.isDateValid(r),"Must specify a valid schedule date for deferred task")}catch(e){i.reportError(e)}this._scheduleDate=r,this._timeout=void 0,this._data=o,this._cbRun=c,this._cbCancel=l,this._cbPersistRemote=d,this._hasRun=!1,this._isCanceled=a,this._destroyed=!1,n.forceBind("runTask",this),n.forceBind("_onCanceled",this),n.forceBind("_onPersistedRemote",this)}var i=e("globals"),n=e("util"),r=e("AccountManager");return t.prototype={schedule:function(){try{i.PAssert(5179,!this._timeout,"Should not schedule the same task multiple times")}catch(e){i.reportError(e)}try{i.PAssert(5180,!this._hasRun,"Should not schedule a task once it has already run once")}catch(e){i.reportError(e)}try{i.PAssert(5181,!this._isCanceled,"Should not schedule canceled tasks")}catch(e){i.reportError(e)}var e=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,e),!this._remoteID&&e>0&&r.onUserAuthorized("me",function(){try{this._cbPersistRemote(this,this._onPersistedRemote)}catch(e){i.reportError(e)}}.bind(this))},_onCanceled:function(e){e&&(this._destroyed=!0,i.vmMain.deferredTaskManager._notifyTaskComplete(this._id))},_onPersistedRemote:function(e,t){e&&(this._remoteID=t,i.vmMain.deferredTaskManager._updateTask(this._id))},reschedule:function(e){try{i.PAssert(5182,!this._hasRun,"Should never reschedule a task that has already run")}catch(e){i.reportError(e)}try{i.PAssert(5183,!this._isCanceled,"Should not reschedule canceled tasks")}catch(e){i.reportError(e)}try{i.PAssert(5184,this._timeout,"Must always have already schedule a task that is being rescheduled")}catch(e){i.reportError(e)}clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=e,this.schedule()},cancel:function(){try{i.PAssert(5185,this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled")}catch(e){i.reportError(e)}try{i.PAssert(5186,!this._hasRun,"Should not cancel tasks that have already been run")}catch(e){i.reportError(e)}this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&r.onUserAuthorized("me",function(){try{this._cbCancel(this,this._onCanceled)}catch(e){i.reportError(e)}}.bind(this)),i.vmMain.deferredTaskManager._updateTask(this._id)},runTask:function(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(e){i.reportError(e)}i.vmMain.deferredTaskManager._notifyTaskComplete(this._id)},getData:function(){return this._data},getType:function(){return this._type},getScheduleDate:function(){return this._scheduleDate},getSaveData:function(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}},isPersistedRemote:function(){return!!this._remoteID}},t}),define("DeferredTaskManager",["require","globals","util","DeferredTask","CacheManager"],function(e){function t(){this._taskCache=r.registerLocalCache("DeferredTasks","DeferredTasks",StorageType.LocalStorage),this._registeredTypes={},this._deferredTasks={},this._stats={},this.init()}var i=e("globals"),n=(e("util"),e("DeferredTask")),r=e("CacheManager");return t.prototype={init:function(){this._taskCache.onCacheReady(function(){this._taskCache.loadAll(function(e){try{i.PAssert(5187,e,"Must be able to load task cache")}catch(e){i.reportError(e)}this._taskCache.getFilterEntries(function(){return!0},function(e){for(var t=0;t<e.length;++t){var i=e[t];this.scheduleTask(i.id,i.type,new Date(i.scheduleDate),i.isCanceled,i.remoteID,i.data,!0)}}.bind(this))}.bind(this))}.bind(this))},getLastSyncDate:function(){var e=i.settings.get(Settings.lastTaskSync);try{i.PAssert(5188,!e||i.isString(e),"Must have a valid string sync date")}catch(e){i.reportError(e)}return e},getStats:function(){return{}},notifyRemoteTasks:function(e){for(var t=0;t<e.length;++t)this._handleRemoteTask(e[t]);i.settings.set(Settings.lastTaskSync,new Date)},_handleRemoteTask:function(e){log("Remote Task: ",e),this.scheduleTask(e.data.threadID,e.type,new Date(e.data.scheduleDate),!1,e.messageID,e.data)},registerTaskType:function(e,t,n,r){try{i.PAssert(5189,!this._registeredTypes[e],"Must not double register task type")}catch(e){i.reportError(e)}try{i.PAssert(5190,i.isFunction(t),"Must register a valid run callback")}catch(e){i.reportError(e)}try{i.PAssert(5191,i.isFunction(n),"Must register a valid cancel callback")}catch(e){i.reportError(e)}try{i.PAssert(5192,i.isFunction(r),"Must register a valid persist callback")}catch(e){i.reportError(e)}this._registeredTypes[e]={cbRun:t,cbCancel:n,cbPersistRemote:r}},_notifyTaskComplete:function(e){this._removeTask(e)},scheduleTask:function(e,t,r,a,s,o,c){try{i.PAssert(5193,e,"Must supply a valid task ID")}catch(e){i.reportError(e)}try{i.PAssert(5194,t,"Must supply a valid task type")}catch(e){i.reportError(e)}try{i.PAssert(5195,i.isDateValid(r),"Must always have a valid scheduled date available")}catch(e){i.reportError(e)}this._taskCache.onCacheReady(function(){try{i.PAssert(5196,this._registeredTypes[t],"Must request a valid registered task type")}catch(e){i.reportError(e)}if(this._deferredTasks[e]){var l=this._deferredTasks[e];try{i.PAssert(5197,l.getType()===t,"Task types must match")}catch(e){i.reportError(e)}try{i.PAssert(5198,l.getScheduleDate().equals(r),"Task schedule dates must match")}catch(e){i.reportError(e)}}else{var d=this._registeredTypes[t];if(d){var h=new n(e,t,r,a,s,o,d.cbRun,d.cbCancel,d.cbPersistRemote);if(this._deferredTasks[e]){log("Overriding existing task");try{i.PAssert(5199,this._deferredTasks[e].type===t,"Should only update deferred tasks of the same type")}catch(e){i.reportError(e)}}this._addTask(e,h,c),a?h.cancel():h.schedule()}}}.bind(this))},cancelTask:function(e,t){this._deferredTasks[e].cancel()},_updateTask:function(e){var t=this._deferredTasks[e];this._taskCache.cacheEntry(e,t.getSaveData())},_addTask:function(e,t,i){this._deferredTasks[e]=t,i||this._updateTask(e)},_removeTask:function(e){this._deferredTasks[e]=void 0,this._taskCache.removeEntry(e)}},t}),define("DocManager",["require","globals","data","util","goog","VMDocument","ObservableArray"],function(e){function t(){this._openDocuments={},this._docMap={},this._docList=new o,this._docListTrashed=new o,this._isLoading=!1,this._hasError=!1,this._hasLoadedDocList=!1,this._hasTrashedDocuments=!1,this._loadingCallbacks=[],this.init()}var i=e("globals"),n=e("data"),r=e("util"),a=e("goog"),s=e("VMDocument"),o=e("ObservableArray");return t.prototype={init:function(){},hasTrashedDocuments:function(){return this._hasTrashedDocuments},loadDocList:function(e){try{i.PAssert(5200,this._loadingCallbacks.indexOf(e)<0,"Should never add the same callback twice to doc list load")}catch(e){i.reportError(e)}if(this._loadingCallbacks.push(e),!this._isLoading){this._isLoading=!0,this._hasTrashedDocuments=!1;var t=[],n="mimeType='"+a.MoodoMimetype+"'",r={maxPageResults:999,maxPages:12},o=function(e,n){try{i.PAssert(5201,!n,"Should not have additional results when requesting a file list")}catch(e){i.reportError(e)}for(var r=0;r<e.length;++r)e[r].appDataContents||e[r].labels.trashed?e[r].labels.trashed&&(this._hasTrashedDocuments=!0,t.push(new s(e[r],!0))):this.loadDocFromData(e[r],!0,!1);this._docListTrashed.set(t),this._docList.notify();for(var r=0;r<this._loadingCallbacks.length;++r)try{this._loadingCallbacks[r](!0)}catch(e){i.reportError(e)}this._loadingCallbacks=[],this._isLoading=!1,this._hasLoadedDocList=!0,this.isOpenDocTrashed()&&(i.menus.confirm("Your document is in the Trash in Google Drive. If it gets deleted from Drive, your data will be lost, so we recommend restoring it. Do you want to restore it now?",function(e){function t(){i.toasts.pushMessage({text:"Successfully removed your document from the trash.",action:MessageAction.Okay})}function n(e){var t=i.vmMain.getUserEmail();i.toasts.pushMessage({text:"There was an error moving your document out of the trash. Click to try manually removing.",action:MessageAction.OpenURL,actionText:"UNTRASH",data:{url:"https://drive.google.com/drive/u/"+t+"/search?q=mimetype=application/vnd.google-apps.drive-sdk.597847337936%20is:trashed"}}),i.reportError(new Error("Failed to untrash doc: "+e.error.code),e)}if(e){var r=this.getOpenDoc();i.vmMain.remoteAPI().driveFilesUntrash(r.id,t,n)}}.bind(this)),i.reportError(new Error("Open doc trashed: "+this.getOpenDoc().id)))}.bind(this),c=function(e,t){this._hasError=!0;for(var n=0;n<this._loadingCallbacks.length;++n){try{this._loadingCallbacks[n](!1,e)}catch(e){i.reportError(e)}this._loadingCallbacks=[],this._isLoading=!1}}.bind(this);i.vmMain.remoteAPI().driveFilesList(n,o,c,r)}},loadDocFromData:function(e,t,n){try{i.PAssert(5202,e,"Must provide valid data to load doc from")}catch(e){i.reportError(e)}try{i.PAssert(5203,e.id,"Must have valid doc id in data")}catch(e){i.reportError(e)}var r=this._docMap[e.id];return r?r.updateData(e,t):(r=new s(e,t),this.setDoc(r,n)),r},setDoc:function(e,t){try{i.PAssert(5204,e,"Must supply a valid doc to set")}catch(e){i.reportError(e)}try{i.PAssert(5205,!this._docMap[e.id],"Should never override an existing doc with a new one")}catch(e){i.reportError(e)}this._docMap[e.id]=e,this._docList.insertSorted(e,this.sortFn,t)},sortFn:function(e,t){return e.getTitle().localeCompare(t.getTitle())},getAutoDefaultDoc:function(){var e;try{for(var t in this._docMap){var n=this._docMap[t];if(e){var r=new Date(e.getData().lastViewedByMeDate);new Date(n.getData().lastViewedByMeDate).isAfter(r)&&(e=n)}else e=n}}catch(e){i.reportError(e)}return e},getDoc:function(e){return this._docMap[e]},hasDoc:function(e){return!!this._docMap[e]},getDocList:function(){return this._docList},isOpenDocTrashed:function(){var e=!1;if(this._hasLoadedDocList){var t=this.getOpenDoc();t&&(e=t.isTrashed())}return e},deleteDoc:function(e,t){var r=this._docMap[e];try{i.PAssert(5206,r,"Must be deleting a document that we know about")}catch(e){i.reportError(e)}r.deleteData(function(i){i&&(delete this._docMap[e],this._docList.remove(r),r.isOpen()&&(delete this._openDocuments[e],n.clearDataAndReload(!0))),t(i)}.bind(this))},deleteAllDocs:function(e){a.deleteAllFiles(this._docList.get(),e)},createNewDoc:function(){return new s},isLoading:function(){return this._isLoading},getOpenDoc:function(){var e;for(var t in this._openDocuments){e=this._openDocuments[t];break}return e},isDocOpen:function(e){return!!this._openDocuments[e]},setDocOpened:function(e){try{i.PAssert(5207,e,"Must specify a valid ID when opening a doc")}catch(e){i.reportError(e)}try{i.PAssert(5208,!this._openDocuments[e],"Document must not have already been opened")}catch(e){i.reportError(e)}var t=this._docMap[e];try{i.PAssert(5209,t,"Must supply a valid ID matching a created doc")}catch(e){i.reportError(e)}this._openDocuments[e]=t},setDocClosed:function(e){var t=this._openDocuments[e];try{i.PAssert(5210,t,"Must have a valid opened doc")}catch(e){i.reportError(e)}delete this._openDocuments[e]}},r.defineBase(t),t}),define("ItemStoreManager",["globals","util","EventDispatcher","ItemStore","DuchessHelpers"],function(e,t,i,n,r){function a(){this._itemStores={},this._iteratingStores=!1,this.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},this.init()}return window.ItemStoreFilter={None:0,Dates:1,Contacts:2,Priority:4},a.prototype={init:function(){var e=ItemStoreFilter.Dates|ItemStoreFilter.Priority;this.registerItemStore("DefaultStore",void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:e}),this._tempItemStore=this.registerItemStore("TempStore",void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})},registerItemStore:function(t,i,a){try{e.PAssert(5211,!this._itemStores[t],"Should only register a single item store per plugin: ",t)}catch(t){e.reportError(t)}try{e.PAssert(5212,!this._iteratingStores,"Should never add a store while iterating")}catch(t){e.reportError(t)}var s=!0,o=!0,c=!0,l=!0,d=!1,h=ItemStoreFilter.None,u=r.runParseText.bind(r);a&&(void 0!==a.isReadonly&&(s=a.isReadonly),void 0!==a.isDestructible&&(o=a.isDestructible),void 0!==a.enabledFilters&&(h=a.enabledFilters),void 0!==a.parserFn&&(u=a.parserFn),void 0!==a.trackGlobally&&(c=a.trackGlobally),void 0!==a.requireStoredEls&&(l=a.requireStoredEls),void 0!==a.listenToItemStateChanged&&(d=a.listenToItemStateChanged));var p=new n(t,s,o,c,l,d,h,u,i);return a&&a.noRegister||(this._itemStores[t]=p,this.fireEvent(this.Events.StoreAdded,p.getEnabledFilters(),[p])),p},unregisterItemStore:function(t){try{e.PAssert(5213,this._itemStores[t],"Must register an item store before destroying it")}catch(t){e.reportError(t)}try{e.PAssert(5214,!this._iteratingStores,"Should never remove a store while iterating")}catch(t){e.reportError(t)}var i=this._itemStores[t];delete this._itemStores[t],i.destroy(),this.fireEvent(this.Events.StoreRemoved,i.getEnabledFilters(),[i])},getItemStore:function(t){try{e.PAssert(5215,this._itemStores[t],"Must register an item store before using it")}catch(t){e.reportError(t)}return this._itemStores[t]},getDefaultItemStore:function(){return this._itemStores.DefaultStore},getTempItemStore:function(){return this._tempItemStore},runForEachStore:function(t,i){i=i||ItemStoreFilter.None,this._iteratingStores=!0;for(var n in this._itemStores){var r=this._itemStores[n];if(i===ItemStoreFilter.None||r.areFiltersEnabled(i))try{t(r)}catch(t){e.reportError(t)}}this._iteratingStores=!1}},t.defineBase(a),t.extend(a.prototype,i),a});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("Components/FancyScroller",["require","globals","Constants","platform","react","Observable","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=(e("Observable"),e("MooReact"));return a.createClass({displayName:"FancyScroller",componentDisplay:i.ComponentDisplay.Everywhere,init:function(){var e=this.props;try{t.PAssert(5216,!(e.noOwnScroll&&e.onScroll),"FancyScroller can not have onScroll prop if it does not own its own scroll")}catch(e){t.reportError(e)}if(!n.mobile){var i={isVisible:!1,isDragging:!1,thumbTop:0,thumbHeight:0};this.props.trackHasScrolled&&(i.hasScrolled=!1),this.createObservables(i)}},componentDidMount:function(){this.refs.thumb&&this.addTap("thumb",this,this.onTapThumb)},onUnmount:function(){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)},getScrollSize:function(){return this.props.getScrollSize?this.props.getScrollSize():this.refs.scroller.scrollHeight},getClientHeight:function(){return this.props.getClientHeight?this.props.getClientHeight():this.refs.scroller.clientHeight},getScrollTop:function(){return this.props.getScrollTop?this.props.getScrollTop():this.refs.scroller.scrollTop},calculateThumb:function(){var e,t,i=(this.props,this.getScrollSize()),n=this.getClientHeight(),r=this.getScrollTop();if(i===n)e=0,t=n;else{t=n/i*n,this.thumbExtraHeight=t<30?30-t:0,t=Math.max(t,30);e=r/(i-n)*(n-t)}var a=t!==this.thumbHeight.get()||e!==this.thumbTop.get();this.thumbHeight.set(t,!1),this.thumbTop.set(e,a)},onScroll:function(e){this.handleScroll(),this.props.onScroll&&this.props.onScroll(e)},handleScroll:function(){this.isMouseDown||(this.calculateThumb(),this.isVisible.set(!0),this.hideTimeout()),this.props.trackHasScrolled&&this.hasScrolled.set(this.getScrollTop()>0)},onMouseMove:function(e){this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)},onMouseEnter:function(e){var t=this.refs.scroller;t.scrollHeight>t.clientHeight&&(this.timeoutShow&&clearTimeout(this.timeoutShow),this.timeoutShow=setTimeout(this.showScrollbar,100))},onMouseLeave:function(e){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.isMouseDown||this.hideTimeout()},onTapThumb:{onStart:function(e){e.button===ButtonCode.Left&&(this.isMouseDown=!0,this.lastY=e.clientY,t.disableMouseMove=!0,this.isDragging.set(!0)),e.stopPropagation()},onMove:function(e){if(this.isMouseDown){var i=this.refs.scroller,n=e.clientY-this.lastY;this.lastY=e.clientY;var r=t.clamp(this.thumbTop.get()+n,0,i.clientHeight-this.thumbHeight.get());this.thumbTop.set(r);var a=r/(i.clientHeight-this.thumbExtraHeight)*i.scrollHeight;i.scrollTop=a,e.preventDefault()}},onEnd:function(e){this.isMouseDown&&e.button===ButtonCode.Left&&(this.isMouseDown=!1,t.disableMouseMove=!1,this.isDragging.set(!1),this.hideTimeout())}},hideTimeout:function(){this.timeoutHide&&clearTimeout(this.timeoutHide),this.timeoutHide=setTimeout(this.hideScrollbar,500)},hideScrollbar:function(){this.isVisible.set(!1),this.timeoutHide=void 0},showScrollbar:function(){this.calculateThumb(this.refs.scroller),this.isVisible.set(!0),this.timeoutShow=void 0},getElement:function(){return this.refs.element},getScrollElement:function(){return n.mobile?this.getElement():this.refs.scroller},scrollTo:function(e,i,n){isNaN(n)&&(n=ScrollDuration.Default),t.scrollTo(e,i,n,this.refs.scroller)},render:function(){var e=this.state,a=this.props,s=(a.getScrollSize,a.getClientHeight,a.getScrollTop,a.noOwnScroll),o=a.showScrollbars,c=(a.trackHasScrolled,a.scrollable),l=_objectWithoutProperties(a,["getScrollSize","getClientHeight","getScrollTop","noOwnScroll","showScrollbars","trackHasScrolled","scrollable"]),d=!1!==c&&!t.noScrollbars,h=t.classNames("fancyScroller",a.className,{flexbox:!n.mobile},{"flexvert horizontal":a.orientation===i.Orientation.Horizontal},{vertical:a.orientation!==i.Orientation.Horizontal},{trackHasScrolled:a.trackHasScrolled},{scrolled:e.hasScrolled}),u=t.classNames("fancyScrollbar",{"visible c-background c-border":e.isVisible},{dragging:e.isDragging}),p=t.classNames("fancyScrollbarThumb c-bg-scrollthumb",{dragging:e.isDragging}),m={height:e.thumbHeight};m[n.transform.react]="translate3d(0,"+e.thumbTop+"px,0)";var f=t.classNames("fancyScrollContent",{hideScrollbar:void 0!==a.showScrollbars},{scrollable:d}),g={};return g[a.orientation===i.Orientation.Horizontal?"overflowX":"overflowY"]="auto",n.mobile?r.createElement("div",_extends({},l,{className:h,ref:"element","data-moo-id":this.getUniqueID()}),a.children):r.createElement("div",_extends({},l,{className:h,ref:"element"}),r.createElement("div",{className:f,style:g,ref:"scroller",onScroll:!s&&this.onScroll,"data-moo-id":this.getUniqueID()},a.children),!n.isFirefox&&d&&o&&r.createElement("div",{className:u,ref:"scrollbar",onMouseMove:this.onMouseMove,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},r.createElement("div",{className:p,style:m,ref:"thumb"})))}})}),define("Components/FancyContextMenu",["require","globals","Constants","platform","react","MooReact","Hotkeys","Components/FancyScroller"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("Hotkeys"),o=e("Components/FancyScroller");return a.createClass({displayName:"FancyContextMenu",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{element:r.PropTypes.object,width:r.PropTypes.number,id:r.PropTypes.string,loading:r.PropTypes.bool,className:r.PropTypes.string,style:r.PropTypes.object,overflowHeight:r.PropTypes.string,positionOffset:r.PropTypes.object,position:r.PropTypes.string},init:function(){this.listenToDispatcher("windowResize"),this.props.supportArrows&&(this.selectedIndex=s.registerArrowsMode("FancyContextMenu",!0,this.getNumItems,this.onArrowsModeSelect,this.onArrowsModeKey),this.props.fromHotkey&&this.selectedIndex.set(0,!1))},getHotkeys:function(){var e=this.props,t=[s.createEscape(this.onEscapeKey)];return e.hotkeys&&(t=t.concat(e.hotkeys)),t},componentDidMount:function(){n.mobile||(this.props.noBackdrop&&document.addEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.updateState())},onUnmount:function(){!n.mobile&&this.props.noBackdrop&&document.removeEventListener("mousedown",this.onMouseDownNoBackdrop,!0)},getState:function(){if(!n.mobile||this.props.useElementPosition){var e=this.updatePosition();return{selectedIndex:this.selectedIndex,left:e.left,top:e.top,right:e.right,bottom:e.bottom,maxHeight:e.maxHeight}}return{top:this.isAtPosition("search")&&t.topBarHeight+i.MobileHeaderRow2Height||this.isAtPosition("top")&&t.topBarHeight||null,bottom:this.isAtPosition("bottom")?0:null}},onMouseDownNoBackdrop:function(e){t.findParent(e.target,"fancyContextMenu")||t.menus.closeContextMenuReact()},isAtPosition:function(e){if(this.props.position){if(this.props.position.split("-").indexOf(e)>=0)return!0}return!1},getNumItems:function(){return this.numItems},onArrowsModeSelect:function(e){if(e>=0){var t=this.refs["el_"+e];t&&t.onClick&&t.onClick()}},onArrowsModeKey:function(e,t){this.props.onKeyPress&&this.props.onKeyPress(e,t)},onEscapeKey:function(){this.props.onEscape&&this.props.onEscape(),t.menus.closeContextMenuReact()},onChildMouseEnter:function(e){this.selectedIndex.set(e)},isOnSide:function(e){return this.props.side?this.props.side.indexOf(e)>=0:"bottom"===e},updatePosition:function(){var e=this.props,i=n.windowWidth(),r=n.windowHeight();try{t.PAssert(5217,e.element,"Context menu needs an element to open on",e.id)}catch(e){t.reportError(e)}if(e.element){var a,s,o=e.element.getBoundingClientRect(),c=e.pos,l=this.refs.menu,d=c?c.left:void 0,h=c?c.top:void 0;isNaN(d)&&(this.isOnSide("right")?d=o.right:this.isOnSide("left")?a=i-("top left"===e.side?o.right:o.left):d=o.left),isNaN(h)&&(this.isOnSide("bottom")?h=o.bottom:this.isOnSide("top")?s=r-o.top:h=o.top);var u=e.positionOffset;u&&(!isNaN(d)&&u.left&&(d+=u.left),!isNaN(a)&&u.right&&(a+=u.right),!isNaN(h)&&u.top&&(h+=u.top),!isNaN(s)&&u.bottom&&(s+=u.bottom));var p={left:d,top:h,right:a,bottom:s};if(n.mobile)p.left=0,p.bottom=n.getKBSize();else if(l){var m=d+l.clientWidth,f=h+l.clientHeight,g=i-8,v=r-8;"shrink"===this.props.overflowHeight&&s>r-8&&(p.maxHeight=Math.min(Math.max(r-h,260),500),f=Math.min(f,p.maxHeight+h)),m>g&&(p.left+=g-m),f>v&&(p.top+=v-f),(d<8||d+p.left<8)&&m<i&&(p.left+=8-d)}return p}return{left:0,top:0,maxHeight:400}},render:function(){var e=this.state,i=this.props,a=t.classNames("fancyContextMenu popup c-shadow-popup",i.className,i.position,i.background,{"c-bg-menu":!i.background},{loading:i.loading},{openFromBottom:i.openFromBottom},{top:this.isAtPosition("top")},{bottom:this.isAtPosition("bottom")},{left:this.isAtPosition("left")},{right:this.isAtPosition("right")},{fill:this.isAtPosition("fill")},{full:this.isAtPosition("full")}),s={left:e.left,top:e.top,right:e.right,bottom:isNaN(i.bottom)?e.bottom:i.bottom,width:i.width,height:i.height,minWidth:i.minWidth,maxHeight:e.maxHeight||i.maxHeight,maxWidth:i.maxWidth};n.mobile&&this.isAtPosition("fill")&&(s.top=t.topBarHeight),s=t.extend(s,this.props.style);var c=this.props.children;if(i.supportArrows){var l=0;c=r.Children.map(this.props.children,function(t){if(t&&"hr"!==t.type){if("scroller"===t.key){var i={maxHeight:n.mobile?.6*n.windowHeight():400};return r.createElement(o,{style:i},r.Children.map(t.props.children,function(t){return r.cloneElement(t,{onMouseEnter:this.onChildMouseEnter,ref:"el_"+l,selected:!n.mobile&&e.selectedIndex===l++})}.bind(this)))}return r.cloneElement(t,{onMouseEnter:this.onChildMouseEnter,ref:"el_"+l,selected:!n.mobile&&e.selectedIndex===l++})}return t}.bind(this)),this.numItems=l}return r.createElement("div",{ref:"menu",id:i.id,className:a,style:s},c)}})}),define("Components/FancyContextMenuItem",["require","globals","Constants","platform","react","MooReact","Components/FancyButton","Components/FancyRippler"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("Components/FancyButton"),o=e("Components/FancyRippler");return a.createClass({displayName:"FancyContextMenuItem",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{id:r.PropTypes.string,className:r.PropTypes.string,selected:r.PropTypes.bool,iconSize:r.PropTypes.number},init:function(){this.createObservables({isHovered:!1})},getElement:function(){var e=this.refs.element;return e.getElement?e.getElement():e},closeMenu:function(){!1!==this.props.canClose&&t.menus.closeContextMenuReact()},onClick:function(e){var t=this.props;t.hasButtons||this.didClickJustFire||!t.onClick||(!1!==t.clickCloses&&this.closeMenu(),t.onClick(e),this.didClickJustFire=!0,setTimeout(function(){this.didClickJustFire=!1}.bind(this),300))},onClickIcon:function(e){var t=this.props;t.onClickIcon?(this.closeMenu(),t.onClickIcon(e)):this.onClick(e)},onMouseDown:function(e){(this.props.onClickIcon||t.hasClass(e.target,"fancyContextMenuIcon"))&&e.preventDefault()},onMouseUp:function(e){var i=this.props;!isNaN(e.button)&&e.button!==ButtonCode.Left||n.mac&&e.ctrlKey||i.onClickIcon&&t.hasClass(e.target,"fancyContextMenuIcon")||this.onClick(e)},onMouseEnter:function(e){this.isHovered.set(!0),this.props.onMouseEnter&&this.props.onMouseEnter(e)},onMouseLeave:function(){this.isHovered.set(!1)},render:function(){var e,i=this.props,a=i.onClick||i.hoverEffects,c=t.classNames("fancyContextMenuItem c-popup-item",{"c-foreground":!i.faded},{"c-foreground-faded":i.faded},{selected:i.selected||!1!==i.hoverEffects&&this.state.isHovered},{active:i.active},{disabled:i.disabled},{hasIcon:!!i.icon},{hasContent:!!i.children},{bold:i.bold},{hasHotkey:i.hotkey},{"flex-center":i.center},{hasButtons:i.hasButtons},this.props.className);if(i.icon)if(i.onClickIcon)e=r.createElement(s,{className:"fancyContextMenuIcon",icon:i.icon,tooltip:i.iconTooltip,width:36,height:i.height||30,onClick:this.onClickIcon});else{var l=t.classNames("fancyContextMenuIcon c-foreground-faded",i.icon),d={fontSize:i.iconSize,height:i.height,
lineHeight:i.height&&i.height+"px",color:i.iconColor};e=r.createElement("span",{className:l,style:d,onClick:this.onClickIcon,"data-tooltip":i.iconTooltip})}var h;i.hotkey&&(h=r.createElement("span",{className:"fancyContextMenuHotkey c-foreground-faded"},i.hotkey));var u=i.style||{};u.height=i.height,u.lineHeight=i.height&&i.height+"px",u.cursor=a?"pointer":"";var p={id:i.id,className:c,"data-tooltip":i.tooltip,onMouseOver:i.onMouseOver,style:u,ref:"element"};return a&&(p.onMouseDown=i.onClick&&!n.mobile&&this.onMouseDown,p.onMouseUp=i.onClick&&!i.noMouseUp&&this.onMouseUp,p.onClick=i.onClick&&(i.noMouseUp||n.mobile)&&this.onMouseUp,p.onMouseEnter=!n.mobile&&!1!==i.hoverEffects&&this.onMouseEnter,p.onMouseLeave=!n.mobile&&!1!==i.hoverEffects&&this.onMouseLeave),r.createElement(i.onClick?o:"div",p,e,h?r.createElement("span",{className:"f1"},i.children):i.children,h)}})}),define("Components/FancyContextMenuHeader",["require","Constants","react","MooReact"],function(e){var t=e("Constants"),i=e("react");return e("MooReact").createClass({displayName:"FancyContextMenuHeader",componentDisplay:t.ComponentDisplay.Desktop,render:function(){var e=this.props,t={padding:isNaN(e.padding)?void 0:e.padding};return i.createElement("div",{className:"fancyContextMenuItem fancyContextMenuHeader c-foreground-very-faded c-border-light",style:t},this.props.children)}})}),define("ReactMenuItemAddPane",["require","globals","Constants","tracker","react","MooReact","Autocomplete","Sel","Components/FancyContextMenu","Components/FancyContextMenuItem","Components/FancyContextMenuHeader"],function(e){var t=e("globals"),i=e("Constants"),n=(e("tracker"),e("react")),r=e("MooReact"),a=(e("Autocomplete"),e("Sel"),e("Components/FancyContextMenu"),e("Components/FancyContextMenuItem"),e("Components/FancyContextMenuHeader"),[PaneMode.Outline,PaneMode.Timeline,PaneMode.Gmail]);return r.createClass({displayName:"ReactMenuItemAddPane",componentDisplay:i.ComponentDisplay.Desktop,canZoom:function(){var e=this.props.type,i=a.indexOf(e)>=0;if(i&&e===PaneMode.Gmail){i=t.vmMain.pluginManager.getPlugin(PluginID.Gmail).getSyncAccounts().length>1}return i},onClick:function(){this.addPane()},addPane:function(){t.vmMain.paneManager.addPaneByButton(this.props.type)},onClickZoom:function(e){e.stopPropagation(),e.preventDefault()},onMouseUpZoom:function(e){this.onClickZoom(e);var i=this.refs.element;i=i.getElement?i.getElement():i,t.vmMain.paneManager.zoomPaneByButton(this.props.type,i)},render:function(){var e=this.props,i=e.paneInfo,r=this.canZoom(i.type),a=e.hotkey,s="Open pane zoomed to an item"+(a?" (Shift + "+a+")":"");return n.createElement(e.elementType,{id:e.id,"data-tooltip":i.tooltip,onClick:this.onClick,onMouseEnter:e.onMouseEnter,selected:e.selected,className:t.classNames("menuItemAddPane",e.className),ref:"element"},n.createElement("i",{className:"addPaneButtonIcon c-foreground-faded "+i.icon}),n.createElement("span",{className:"addPaneButtonText f1"},i.text),a&&n.createElement("span",{className:"addPaneHotkey c-foreground-faded"},a),r?n.createElement("span",{className:"addPaneButtonZoom c-button c-border-light icon-zoom-in",onClick:this.onClickZoom,onMouseUp:this.onMouseUpZoom,"data-tooltip":s}):n.createElement("span",{className:"addPaneButtonZoom empty"}))}})}),define("ReactAddPaneArea",["require","globals","Constants","react","MooReact","ReactMenuItemAddPane","Components/FancyRippler"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("ReactMenuItemAddPane"),s=e("Components/FancyRippler");PaneMode.Outline,PaneMode.Timeline,PaneMode.Gmail;return r.createClass({displayName:"ReactAddPaneArea",componentDisplay:i.ComponentDisplay.Desktop,getState:function(){var e=t.vmMain.paneFactory,i=t.vmMain.paneManager;return{panes:i.displayPanes,registeredPanes:e.activePaneTypes,numInactivePanes:e.numInactivePanes,totalWidth:i.totalWidth}},render:function(){for(var e=this.state,r=e.registeredPanes,o=[],c=t.classNames("addPaneArea"),l=0;l<r.length;l++){var d=r[l],h=d.type,u=t.classNames("addPaneButton flexbox c-foreground-light",{selected:e.selectedIndex===l});o.push(n.createElement(a,{key:d.text,paneInfo:d,type:h,className:u,elementType:s}))}return 0===e.panes.length?n.createElement("div",{id:"addPaneAreaWrapper",className:"flexbox flexvert flex-center",style:{left:e.totalWidth}},n.createElement("div",{className:"addPaneMessage c-foreground-light"},"Each Board is a different set of panes for a unique view on your tasks. Add a new pane to get started with this Board.",n.createElement("br",null)),n.createElement("div",{className:c,style:{width:i.AddPaneAreaSize}},n.createElement("div",{className:"addPaneAreaTitle c-foreground-faded c-border-heavy"},n.createElement("i",{className:"icon-crop_portrait"}),n.createElement("span",null,"ADD PANE")),o)):null}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("Components/DivX",["require","globals","Constants","platform","react","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react");return e("MooReact").createClass({displayName:"DivX",componentDisplay:i.ComponentDisplay.Everywhere,componentDidMount:function(){n.mobile&&(this.props.onClick||this.props.onMouseDown)?t.setupClick(this.refs.element,this,this.onTap):!n.mobile&&this.props.globalEvents&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))},onUnmount:function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},getElement:function(){return this.refs.element},onMouseDown:function(e){this.lastX=e.clientX,this.lastY=e.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=e.target,this.props.onMouseDown&&this.props.onMouseDown(e)},onMouseMove:function(e){if(this.isDown){this.moveX+=Math.abs(e.clientX-this.lastX),this.moveY+=Math.abs(e.clientY-this.lastY),this.lastX=e.clientX,this.lastY=e.clientY;var i={startSrc:this.startSrc,target:e.target,clientX:e.clientX,clientY:e.clientY,eventX:e.clientX,eventY:e.clientY,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(i)}},onClick:function(e){this.moveX<t.ClickThreshold&&this.moveY<t.ClickThreshold&&this.props.onClick&&this.props.onClick(e)},onMouseUp:function(e){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(e)},onTap:{onStart:function(e){this.onMouseDown(e),e.stopPropagation()},onClick:function(e){this.props.onClick&&(this.props.onClick(e),e.stopPropagation())},onMove:function(e){this.props.onMouseMove&&this.props.onMouseMove(e),e.stopPropagation()},onEnd:function(e){this.onMouseUp(e),e.stopPropagation()}},render:function(){var e=this.props,t=(e.onClick,e.globalEvents),i=_objectWithoutProperties(e,["onClick","globalEvents"]);return r.createElement("div",_extends({},i,{onMouseDown:!n.mobile&&this.onMouseDown,onMouseMove:!t&&this.onMouseMove,onClick:!n.mobile&&this.onClick,onMouseUp:!n.mobile&&!t&&this.onMouseUp,ref:"element"}),this.props.children)}})}),define("ReactWrapper",["require","globals","Constants","react","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("react");return e("MooReact").createClass({displayName:"ReactWrapper",componentDisplay:i.ComponentDisplay.Everywhere,getState:function(){return t.clone(this.props.observe)},render:function(){var e=this.props,i=this.state;if(e.render)return e.render(i,e);var r=e.component||"div";return e=t.extend({style:e.renderStyle(i,e)},e),n.createElement(r,e,e.children)}})}),define("ReactSearchButton",["require","globals","Constants","platform","react","MooReact","Search"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact");e("Search");return a.createClass({displayName:"ReactSearchButton",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{filter:r.PropTypes.object.isRequired},init:function(){var e=this.props.filter;this.firstValue=this.props.filterValue||e.initialValue},onClickIcon:function(e){var t=this.props.filter,i=this.props.filterValue;i=(!n.mac&&e.ctrlKey||n.mac&&e.metaKey)&&!isNaN(t.initialValue)&&i!==-t.initialValue?-t.initialValue:i?0:t.initialValue,this.props.search.setFilter(t.name,i)},render:function(){var e=this.props,i=e.filter,a=e.filterValue,s=this.firstValue===a,o="Click to "+(a?"reset filter":(this.firstValue>0?"show only ":"hide ")+i.tooltip)+(a!==-this.firstValue?".\n"+n.priModKey+" + click to "+(this.firstValue<0?"show only ":"hide ")+i.tooltip+".":""),c=t.classNames("searchButton c-border-super-light",{selected:!!a},i.icon,(a?this.firstValue>0&&s||this.firstValue<0&&!s:this.firstValue>0)?"yes":"no");return r.createElement("div",{className:c,"data-tooltip":o,onClick:this.onClickIcon})}})}),define("Components/FancyInput",["require","globals","Constants","data","platform","International","react","MooReact","Hotkeys","DuchessHelpers","Autocomplete","NativeSel","Autocomplete"],function(e){var t=e("globals"),i=e("Constants"),n=e("data"),r=e("platform"),a=e("International"),s=e("react"),o=e("MooReact"),c=e("Hotkeys"),l=e("DuchessHelpers"),d=e("Autocomplete"),h=e("NativeSel");return o.createClass({displayName:"FancyInput",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{onChange:s.PropTypes.func,id:s.PropTypes.string,className:s.PropTypes.string,value:s.PropTypes.string,mode:s.PropTypes.string,buttonText:s.PropTypes.string,onButtonClick:s.PropTypes.func,padding:s.PropTypes.object,height:s.PropTypes.number,onEscape:s.PropTypes.func},init:function(){d=e("Autocomplete");var t={isFocused:this.props.focused,isComposing:!1,value:this.props.value||"",tokens:this.props.tokens||[],item:void 0};this.isInput="password"===this.props.type,this.isInput||(this.html=this.parseHTML(t.value||TextSpace)),this.props.buttonText&&(t.isLoading=!1),this.createObservables(t)},componentDidMount:function(){this.updateHTML(this.state.value,!1),this.props.focused&&(this.focus(),this.selectEnd())},onUnmount:function(){this.isFocused.get()&&this.onBlur()},componentWillReceiveProps:function(e){this.props.value!==e.value&&e.value!==this.state.value&&(this.setValue(e.value,!(r.mobile&&!t.isKeyboardOpen)),this.forceUpdate()),this.props.tokens!==e.tokens&&e.tokens!==this.state.tokens&&this.tokens.set(e.tokens)},componentDidUpdate:function(){var e=this._isDirty;if(this._isDirty=void 0,e&&this._dirtyCallbacks){for(var t=0;t<this._dirtyCallbacks.length;t++)this._dirtyCallbacks[t]();this._dirtyCallbacks=void 0}},clearValue:function(){this.setValue("")},isButtonEnabled:function(){return void 0!==this.props.buttonEnabled?this.props.buttonEnabled:this.state.value||this.state.tokens.length>0},getValue:function(){return this.value.get()},getTokens:function(){var e=this.getValue().trim(),t=this.tokens.get();return e?t.concat([{text:e,email:e,type:"contact"}]):t},getItem:function(){return this.state.item},parseHTML:function(e){var i;if(this.props.parse){var r=l.parseText(e,null,null,null,a.getCurrentDateFormat(),null,null,n.contactManager.getContacts(),!0,!0);this.props.onParsed&&this.props.onParsed(r),this.parsedEls=r.els,i=l.generateHTML(r.els,!0)}else i=e&&t.escape(e).replace(/ /g,"&nbsp;");return i},addDirtyCallback:function(e){this._dirtyCallbacks||(this._dirtyCallbacks=[]),this._dirtyCallbacks.push(e)},focus:function(){this._isDirty?this.addDirtyCallback(this.focus):this.refs.input.focus()},blur:function(){this.refs.input.blur()},select:function(){h.selectElement(this.refs.input)},selectEnd:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectEnd);else{var t=this.refs.input.innerText;t.length>0&&t!==TextSpace&&h.selectElement(this.refs.input,t.length)}},onFocus:function(e){this.props.autocompleteMode&&d.clearDisabled(),t.vmMain.activeInput.set(this),this.isFocused.set(!0),this.props.onEscape&&(this.__hotkeyEscape=c.pushStackEscape(this.handleEscapeKey)),this.props.onFocus&&this.props.onFocus(e)},onBlur:function(e){t.vmMain.activeInput.set(null),this.isFocused.set(!1),this.__hotkeyEscape&&(c.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0),this.props.onBlur&&this.props.onBlur(e)},getSelectionOffset:function(){var e=h._getSelectionRange(),t=0;return e&&(t=h.getSelectOffsetsInElement(this.refs.input,e).end),t},_setSelectionOffset:function(e){var i,n;if(e>0){var r=h.getOffsetChildElement(this.refs.input,e);i=r.element,n=r.offset}else i=this.refs.input,n=0;var a=h.createFakeRange(i,n,i,n);try{t.PAssert(5218,a,"Range should be valid when setting selection offset")}catch(e){t.reportError(e)}a&&h.setSelectionRange(a)},setSelectionOffset:function(e){this._setSelectionOffset(e)},updateAutocomplete:function(e){var t=this.refs.input,i=this.props.autocompleteMode;if(i&&(!r.mobile||"snooze"===i||"move"===i||"email"===i||"gmailLabel"===i||"item"===i)){var n=h.getSelectionInElement(t);r.mobile&&!n&&(n={start:0,end:0}),n&&n.start===n.end&&d.update({mode:i,text:this.value.get(),offset:n.start,owner:this,item:e,parsedEls:this.parsedEls,positionOffset:this.props.positionOffset,elementDisplay:this.props.autocompleteElementDisplay||this.refs.wrapper,elementInput:t,supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}},setValue:function(e,i,n){this._isDirty=!0;try{t.PAssert(5219,void 0!==e,"Should not set FancyInput value to undefined")}catch(e){t.reportError(e)}e=e||"",this.updateHTML(e,i,n),this.value.set(e)},updateHTML:function(e,t,i){var n=i;t&&void 0===n&&(n=this.getSelectionOffset());var r=this.parseHTML(e||TextSpace);r!==this.refs.input.innerHTML&&(this.refs.input.innerHTML=r),t&&(n>e.length&&(n=e.length),this.setSelectionOffset(n))},addToken:function(e){this.tokens.push(e);var t=this.refs.inner;t.scrollWidth>t.clientWidth&&(t.scrollLeft=t.scrollWidth-t.clientWidth)},updateTokens:function(e){for(var i=t.parseTokensFromText(this.value.get()),n="",r=0;r<i.length;++r){var a=i[r];"contact"===a.type?this.addToken(a):n+=a.text}this.setValue(n,!0)},onChange:function(){this.value.set(this.refs.input.value)},stripBRs:function(e){for(var t=e.children,i=t.length-1;i>=0;i--){var n=t[i];"BR"===n.nodeName?n.remove():n.children.length>0&&this.stripBRs(n)}},onInput:function(){if(!this.isComposing.get()){r.mobile&&this.stripBRs(this.refs.input);var e=this.refs.input.textContent.replace(/\u00a0/g," ").replace(new RegExp(TextSpace,"g"),"").replace(/\n/g,"");this.setValue(e,!0),this.updateAutocomplete(),this.props.onChange&&this.props.onChange(e)}},handleEscapeKey:function(){this.props.onEscape?this.props.onEscape():this.isInput||this.select(),this.__hotkeyEscape&&(c.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0)},onMouseDown:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(e)},onKeyDown:function(e){var t=this.props;this.isInput||(t.autocompleteMode&&d.isShowing()||t.buttonText&&e.keyCode===KeyCode.Enter&&this.onButtonClick(),e.keyCode===KeyCode.BackSpace&&(!this.state.value&&this.state.tokens.length>0&&this.removeToken(this.tokens.length()-1),0===this.refs.input.textContent.length&&(this.refs.input.textContent=TextSpace)),e.keyCode===KeyCode.Tab&&d.isShowing()&&d.hide(),e.keyCode===KeyCode.Enter&&(t.onEnter&&t.onEnter(e),e.preventDefault())),t.onKeyDown&&t.onKeyDown(e)},onKeyUp:function(e){var t=this.props;!this.isInput&&t.autocompleteMode&&(e.keyCode!==KeyCode.LeftArrow&&e.keyCode!==KeyCode.RightArrow||this.updateAutocomplete()),"email"===t.autocompleteMode&&(e.keyCode===KeyCode.Comma?this.updateTokens(!1):e.keyCode===KeyCode.Enter&&this.updateTokens(!0)),r.mobile&&e.keyCode===KeyCode.Enter&&this.selectEnd(!0),t.onKeyUp&&t.onKeyUp(e)},onCompositionStart:function(){r.android||this.isComposing.set(!0)},onCompositionEnd:function(e){r.android||(this.isComposing.set(!1),this.onInput(e))},onAutocompleteSelected:function(e){var t=this.props;void 0!==e.value&&(this.setValue(e.value,!0,e.offset),t.onChange&&t.onChange(e.value)),e.item&&this.item.set({item:e.item,text:e.item.getStyledTextAsOneLine()}),e.token&&this.addToken(e.token),t.onAutocompleteSelected&&t.onAutocompleteSelected(e)},onButtonClick:function(){var e=this.state;if(this.isButtonEnabled()){if(this.props.onButtonClick){this.props.onButtonClick(e.value,this.onButtonClickCallback)&&this.isLoading.set(!0)}d.isShowing()&&d.hide()}},onButtonClickCallback:function(){this.value.set(""),this.isLoading.set(!1)},removeToken:function(e){var t=this.props,i=this.tokens.get()[e];this.tokens.removeAt(e),t.onChange&&t.onChange(),t.onTokenRemoved&&t.onTokenRemoved(i)},removeItem:function(){this.item.set(void 0)},render:function(){var e,i,n=this.state,a=this.props,o=a.margin||{},c=a.padding||{};isNaN(c.left)&&(c.left=8),isNaN(c.right)&&(c.right=8);var l=!1!==a.border,d=l?2:0,h=t.classNames("fancyInput",{disabled:a.disabled},{hasFloatingText:!!a.floatingText},{hasButton:!!a.buttonText},{hasBorder:l},this.props.className),u=a.height||40,p=(u-40)/2,m=t.extend({width:a.width,height:u,display:a.display},a.style);if(a.floatingText)c.bottom=5+Math.min(p,2),c.top=u-16-c.bottom;else{var f=(u-d-16)/2;c.top=f,c.bottom=f}if(a.floatingText){var g={marginBottom:5+p,marginLeft:c.left,marginRight:c.right};n.isFocused||n.value?n.isFocused?g.color=t.colorBlue:g.color="#ccc":g.color="#aaa";var v=t.classNames("placeholder c-foreground-super-faded","noSelect",{floating:n.isFocused||n.value||n.tokens.length>0});e=s.createElement("div",{className:v,style:g},a.floatingText)}else if(a.placeholder&&!n.value&&!n.isComposing&&0===n.tokens.length){var y={paddingTop:c.top,marginLeft:c.left,marginRight:c.right};e=s.createElement("div",{className:"placeholder c-foreground-super-faded noSelect",style:y},a.placeholder)}if(a.floatingText){var b={right:a.buttonText&&50};n.isFocused?b[r.transform.react]="":b[r.transform.react]="scale(0,1)",i=s.createElement("div",{className:"focusUnderline",style:b})}var S;if(a.buttonText){var E=t.classNames("fancyInputButton c-button-raised-primary",{loading:n.isLoading},{disabled:!this.isButtonEnabled()}),C={width:a.buttonWidth,lineHeight:u+"px"};S=s.createElement("span",{className:E,style:C,onClick:this.onButtonClick},a.buttonText)}var P,T={paddingLeft:c.left,paddingRight:c.right,marginLeft:o.left,marginRight:o.right},D={paddingTop:c.top,paddingBottom:c.bottom},M={ref:"input",className:"fancyInputInput",style:D,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown,autoComplete:"false",tabIndex:a.tabIndex,disabled:n.isLoading};this.isInput?(M.type=a.type,M.onChange=this.onChange,P=s.createElement("input",M)):(M.onInput=this.onInput,M.contentEditable=a.readonly||n.item?null:"true",M.onCompositionStart=this.onCompositionStart,M.onCompositionEnd=this.onCompositionEnd,P=s.createElement("div",M));var _=[];if(n.tokens)for(var I=0;I<n.tokens.length;I++){var A=n.tokens[I],w={marginTop:c.top-4};_.push(s.createElement("div",{key:"token"+I,className:"token c-button-raised c-border",style:w},s.createElement("span",{dangerouslySetInnerHTML:{__html:A.text}}),s.createElement("i",{className:"icon-close c-button",onClick:this.removeToken.bind(this,I)})))}n.item&&_.push(s.createElement("div",{key:"token"+I,className:"token c-button-raised flexbox"},s.createElement("span",{className:"f1",dangerouslySetInnerHTML:{__html:n.item.text}}),s.createElement("i",{className:"icon-close c-button",onClick:this.removeItem})));var k=t.classNames("fancyInputWrap c-foreground c-background c-border",{hasTokens:_.length>0},{hasItem:n.item});return s.createElement("div",{className:h,id:this.props.id,style:m,onClick:this.props.onClick},s.createElement("div",{className:"fancyInputContent"},s.createElement("div",{className:k,ref:"wrapper"},e,s.createElement("div",{className:"fancyInputInner",style:T,ref:"inner"},_,s.createElement("div",{className:"fancyInputInner2"},P))),S,i))}})}),define("ReactSearch",["require","globals","data","Constants","platform","react","MooReact","VMPane","Sel","MobileUI","ReactSearchButton","Components/FancyInput","Components/FancyButton"],function(e){var t=e("globals"),i=(e("data"),e("Constants")),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("VMPane"),o=e("Sel"),c=(e("MobileUI"),e("ReactSearchButton")),l=e("Components/FancyInput"),d=e("Components/FancyButton");return a.createClass({displayName:"ReactSearch",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{pane:r.PropTypes.instanceOf(s).isRequired},componentDidMount:function(){this.props.pane.search.UI=this,this.listenTo(this.props.pane.search.onChanged),n.mobile?this.addTap("searchInnerWrap",this,this.onTapBox):this.forceUpdate()},getState:function(){for(var e=this.props.pane,t=e.search,i={search:t.value,paneItem:e.item,paneTitle:e.itemTitle(),showHierarchy:t._showHierarchy},n=0;n<t.filters.length;n++){var r=t.filters[n];i[r.name]=r.value,i[r.name+"Enabled"]=r.enabled}return i},onChange:function(e){this.props.pane.search.setValue(e)},onParsed:function(e){this.props.pane.search.onParsed(e)},setSearch:function(e,t){this.props.pane.search.setValue(e),n.mobile||!1===t||this.setSelectionOffset(e.length)},getSelectionOffset:function(){return this.refs.input.getSelectionOffset()},setSelectionOffset:function(e){this.refs.input.setSelectionOffset(e)},onFocus:function(){var e=this.props.pane.search;e&&(this._selectionBeforeBlur=o.save(),o.reset(),e.isFocused.set(!0),t.autocomplete.hide(),n.mobile?(t.keyboardToolbar.show(i.KeyboardToolbarMode.Search),t.sendEvent("SearchFocus","Mobile")):t.sendEvent("SearchFocus","Desktop"))},onBlur:function(){var e=this.props.pane.search;e&&e.isFocused.set(!1),n.mobile&&t.keyboardToolbar.hide()},focus:function(){this.refs.input.focus(),this.refs.input.selectEnd(),this.props.pane.onBlur()},blur:function(){this.refs.input.blur()},onTapBox:function(e){n.mobile&&(t.keyboardToolbar.preShow(),this.focus()),n.mobile&&(t.keyboardToolbar.show(i.KeyboardToolbarMode.Search),e.preventDefault())},onTapX:function(e){var i=this.props.pane,r=n.mobile;if(this.state.search.length>0){if(!r)var a=o.save();this.setSearch("",!1),!r&&a&&i.restoreSelection(a),e.preventDefault(),t.sendEvent("Menu","ClearSearch")}else r?this.onTapBox(e):this.focus(),t.sendEvent("Menu","FocusSearch")},onTapFlat:function(){var e=this.props.pane.search;e.setShowHierarchy(!e.showHierarchy())},onKeyDown:function(e){if(this.saveScrollOfTop(),!n.mobile){var i=this.props.pane;if(e.keyCode===KeyCode.Enter){i.search.update(!0,!0),this.setSelectionOffset(this.state.search.length)}if(e.keyCode===KeyCode.Tab||e.keyCode===KeyCode.Enter){var r=i.indexOfFirstItem();if(r>=0){var a=r,s=this._selectionBeforeBlur;s&&(o.restore(s)?(this._selectionBeforeBlur=void 0,a=s.startIndex):s=null),s||(this.blur(),i.selectIndex(r,0),setTimeout(function(){i.selectIndex(r,0)},0)),o.focusPane(i),a>=0&&t.focusedPane.scrollIndexIntoView(a,ScrollDuration.Default)}else i.type===PaneMode.Outline&&i.addItem(e);e.preventDefault(),e.stopPropagation()}}},onToggleButton:function(e){this.saveScrollOfTop(),this.props.pane.search.toggleFilter(e)},setPriority:function(e){this.saveScrollOfTop();var t=this.props.pane.search;t.getFilter("priority")===e&&(e=0),t.setFilter("priority",e)},onAutocompleteSelected:function(e){e.item&&t.vmMain.zoomin(e.item)},saveScrollOfTop:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)},renderSearchButton:function(e){var t=this.props.pane;return r.createElement(c,{key:e.name,filter:e,filterValue:e.value,search:t.search})},renderSearchPriority:function(){var e,i=this.props.pane,n=i.search.filter_priority,a=n.value;a&&(a===VMLIFlag.P0?e="p0":a===VMLIFlag.P1?e="p1":a===VMLIFlag.P2&&(e="p2"));var s=t.classNames("searchPriorities",e);return r.createElement("span",{key:"priority",className:s},r.createElement("span",{className:"searchPriority searchP0","data-tooltip":"Show only high priority",onClick:this.setPriority.bind(this,VMLIFlag.P0)}),r.createElement("span",{className:"searchPriority searchP1","data-tooltip":"Show medium priority and higher",onClick:this.setPriority.bind(this,VMLIFlag.P1)}),r.createElement("span",{className:"searchPriority searchP2","data-tooltip":"Show low priority and higher",onClick:this.setPriority.bind(this,VMLIFlag.P2)}))},render:function(){var e=this.state,i=this.props.pane,a=i.search,s=e.search,o=s.length>0?"icon-close":"",c=t.classNames("toggleFlat searchButton c-border-super-light yes icon-reorder",{selected:!e.showHierarchy}),h=n.mobile?40:24,u=[];if(!n.mobile){i.supportSearchFlat&&u.push(r.createElement("div",{key:"flat",className:c,onClick:this.onTapFlat,"data-tooltip":"Show only matching items"}));for(var p=0;p<a.filters.length;p++){var m=a.filters[p];m.enabled.get()&&(m.icon?u.push(this.renderSearchButton(m)):"priority"===m.name&&u.push(this.renderSearchPriority()))}}var f=r.createElement(d,{className:"searchX c-button",width:24,height:h,icon:o,onClick:this.onTapX}),g=r.createElement("div",{className:"searchInnerWrap",ref:"searchInnerWrap"},r.createElement(l,{ref:"input",className:"search",id:"search",height:n.mobile?30:h,value:s,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,onParsed:this.onParsed,parse:!0,placeholder:"Search",autocompleteMode:"all",border:!1,autocompleteElementDisplay:this.refs.searchBox,padding:{left:0,right:0},onAutocompleteSelected:this.onAutocompleteSelected,supportSearchItemAutocomplete:i.supportSearchItemAutocomplete}));return n.mobile?r.createElement("div",{className:"searchWrap c-background flexbox f1"},g,f):r.createElement("div",{className:"searchWrap flexbox f1"},r.createElement("div",{className:"f1 paneDraggable"}),r.createElement("div",{className:"searchBox c-background c-border-light flexbox",ref:"searchBox"},g,f),u.length>0&&r.createElement("div",{className:"searchButtons noShrink c-background c-border-light c-foreground-very-faded"},u),r.createElement("div",{className:"f1 paneDraggable"}))}})}),define("ReactTitle",["require","globals","Constants","platform","react","MooReact","VMPane","VMLI","MobileUI","Components/FancyContextMenuHeader","Components/FancyContextMenu","Components/FancyContextMenuItem","Components/FancyRippler"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("VMPane"),o=e("VMLI"),c=e("MobileUI"),l=e("Components/FancyContextMenuHeader"),d=e("Components/FancyContextMenu"),h=e("Components/FancyContextMenuItem"),u=e("Components/FancyRippler");return a.createClass({displayName:"ReactTitle",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{pane:r.PropTypes.instanceOf(s).isRequired,item:r.PropTypes.instanceOf(o).isRequired},componentDidMount:function(){this.listenTo(this.props.item.itemChanged)},onMouseDown:function(e){n.mobile||(this._holdTimeout=setTimeout(this.openContextMenu,150,{target:e.target}))},onMouseUp:function(){this.clearHoldTimeout()},onClick:function(e){if(n.mobile)c.toggleOverviewVisibility(this.props.pane);else{var i=this.props;t.isString(i.item)||(i.isLast?this.openContextMenu(e):i.pane.onClickTitle(i.item))}},onRightClick:function(e){e.preventDefault(),this.openContextMenu(e)},onDoubleClick:function(e){var i=this.props.pane;t.isString(this.props.item)||i.onDoubleClickTitle()},onClickMenuItem:function(e){this.props.pane.onClickTitle(e)},clearHoldTimeout:function(){clearTimeout(this._holdTimeout),this._holdTimeout=void 0},getTextForItem:function(e){return e.generateTitleText(e.getParsedTextWithoutPrefix())},getJSXForItem:function(e){var i=this.getTextForItem(e),n=t.vmMain.pluginManager.getPlugin(PluginID.Gmail);if(n.isLabelItem(e)){var a=n.getIconForLabel(e),s=t.classNames("labelText",{hasIcon:!!a});return r.createElement("span",{className:s},r.createElement("i",{className:a&&"c-foreground-light icon-"+a}),i)}return i},openContextMenu:function(e){var i=this.props,n=i.pane,r=i.item,a=r.parent()?r.parent().items.get():r.items.get();this.clearHoldTimeout(),t.menus.openContextMenuReact({fn:this.renderContextMenuSiblings,element:e.target,item:r,pane:n,siblings:a})},renderContextMenuSiblings:function(e){var t=this;return r.createElement(d,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},r.createElement(l,null,this.props.pane.titleContextMenuHeader),e.siblings.map(function(i){var n=t.getJSXForItem(i);return r.createElement(h,{key:i.id,active:i===e.item,onClick:t.onClickMenuItem.bind(t,i)},n)}))},render:function(){var e,i,a=this.props,s=a.pane,o=a.item,c=o.parent();o===t.vmMain.root()?i=e=s.titleOfFirstItem:t.isString(o)?i=e=o:(i=this.getTextForItem(o),e=this.getJSXForItem(o)),t.isObject(i);var l="Click to zoom to ",d=!n.mobile&&(a.isLast?c?l+"a sibling of "+i:l+"an item in the "+i:l+i+".\nPress and hold to zoom to a"+(c?" sibling of ":"n item in the ")+i+"."),h=t.classNames("titleWrapper",a.className,{"c-foreground":a.isLast},{"c-foreground-faded":!a.isLast}),p=t.classNames("title",{"c-button":!a.isLast});return r.createElement(u,{className:h,"data-tooltip":d,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onContextMenu:this.onRightClick,ripple:!n.mobile},r.createElement("span",{className:p},e))}})}),define("ReactMobileFilterBar",["require","globals","Constants","platform","react","MooReact","VMPane","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("react")),r=e("MooReact"),a=e("VMPane"),s=e("Components/FancyButton");return r.createClass({displayName:"ReactMobileFilterBar",componentDisplay:i.ComponentDisplay.Mobile,propTypes:{pane:n.PropTypes.instanceOf(a).isRequired},componentDidMount:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){for(var e=this.props.pane.search,t={},i=0;i<e.filters.length;i++){var n=e.filters[i];t[n.name]=n.value}return t},openMobileFilterMenu:function(){t.menus.toggleContextMenuReact({componentName:"ReactContextMenuMobileFilter",position:"search-right",pane:this.props.pane})},renderSearchButton:function(e){var i=e.value,r=t.classNames("searchFilterButton selected",e.icon,{yes:i>0},{no:i<0});return n.createElement("div",{key:e.name,className:r})},renderSearchPriorityButton:function(e){var r=e.value,a=t.classNames("searchPriorityButton",{p0:r===VMLIFlag.P0},{p1:r===VMLIFlag.P1},{p2:r===VMLIFlag.P2},{selected:r===e.value}),s={height:i.PaneHeaderRow2ButtonHeight,lineHeight:i.PaneHeaderRow2ButtonHeight+"px"};return n.createElement("div",{key:e.name,className:a,style:s})},render:function(){for(var e=this.props,t=e.pane.search,r=[],a=0;a<t.filters.length;a++){var o=t.filters[a];o.enabled.get()&&o.value&&(o.icon?r.push(this.renderSearchButton(o)):"priority"===o.name&&r.push(this.renderSearchPriorityButton(o)))}var c=r.length>0;return n.createElement("div",{className:"mobileFilterBar flexbox"},n.createElement(s,{icon:c?null:"icon-filter_list",iconSize:17,fontSize:14,height:i.PaneHeaderRow2ButtonHeight,paddingLeft:0,paddingRight:0,color:"#444",onClick:this.openMobileFilterMenu,ripple:!c},r))}})}),define("ReactPaneHeader",["require","globals","data","Constants","platform","tracker","react","MooReact","VMPane","MobileUI","Multiselect","ReactSearch","ReactTitle","ReactMobileFilterBar","Components/FancyContextMenu","Components/FancyContextMenuItem","Components/FancyButton"],function(e){var t=e("globals"),i=e("data"),n=e("Constants"),r=e("platform"),a=e("tracker"),s=e("react"),o=e("MooReact"),c=e("VMPane"),l=e("MobileUI"),d=e("Multiselect"),h=e("ReactSearch"),u=e("ReactTitle"),p=e("ReactMobileFilterBar"),m=e("Components/FancyContextMenu"),f=e("Components/FancyContextMenuItem"),g=e("Components/FancyButton");return o.createClass({displayName:"ReactPaneHeader",componentDisplay:n.ComponentDisplay.Everywhere,propTypes:{pane:s.PropTypes.instanceOf(c).isRequired,startDragging:s.PropTypes.func},init:function(){r.mobile&&(this.paneScrollOffset=0,this.createObservables({headerRow2Position:0}))},getState:function(){var e=this.props.pane,t={numComplete:e.numCompleteItems,isOverviewVisible:e.overview.isVisible,item:e.item,showingArchived:e.showArchived,isSearchFocused:e.search.isFocused,
titles:e.getTitleList()};return r.mobile&&(t.topBarMode=l.topBarMode,t.numSelected=d.numSelected),t},componentDidMount:function(e){r.mobile&&(this.props.pane.addScrollListener(this.onPaneScroll),setTimeout(function(){var e=this.props.pane.getScrollOffset();this.paneScrollOffset=e}.bind(this),0))},onUnmount:function(e){r.mobile&&this.props.pane.removeScrollListener(this.onPaneScroll)},onBeforeChanged:function(e,t){this.refs;r.mobile&&e.item!==t.item&&(this.headerRow2Position.set(0,!1),e.headerRow2Position=0)},onPaneScroll:function(e){var i=this.props.pane.getScrollOffset();if(void 0===this.paneScrollOffset&&(this.paneScrollOffset=i),i!==this.paneScrollOffset&&i>0){var r=this.headerRow2Position.get()+this.paneScrollOffset-i;this.headerRow2Position.set(t.clamp(r,-n.PaneHeaderRow2Height,0))}this.paneScrollOffset=i},onMouseDown:function(e){r.mobile||e.button!==ButtonCode.Left||this.props.startDragging(e)},onMouseDownMore:function(e){t.menus.openContextMenuReact({fn:this.renderContextMenu,element:e.target})},clonePane:function(e){var n=t.vmMain.paneManager.getPaneIndex(this.props.pane),r=this.props.pane.getSaveInfo();r.item=i.getModel(r.item),delete r.id,t.vmMain.paneManager.createPaneAtIndex(e,n+1,r)},onTapOverviewButtonMobile:function(){l.toggleOverviewVisibility(this.props.pane)},onTapMoreButtonMobile:function(){t.menus.toggleContextMenuReact({fn:this.renderContextMenuMobile})},onTapMultiselectMobile:function(){l.setMultiselectVisibility(!0)},onTapCloseTopStatus:function(){l.resetTopBarMode()},onTapSettings:function(){t.menus.openModalNew(Modals.MobileSettings)},onTapClearMultiselect:function(){d.setSelected([])},onTapUndoMobile:function(){a.undoAction()},renderContextMenuMobile:function(){var e,t=this.state,i=this.props.pane;if(i.supportCollapsing){var n=i.hasCollapsed();e=s.createElement(f,{icon:n?"icon-add":"icon-minus",onClick:i.toggleCollapseAll.bind(i)},(n?"Uncollapse":"Collapse")+" All Items")}return s.createElement(m,{key:"contextMenuMobileOptions",position:"top-right",className:"contextMenuMobile"},i.supportMultiselect&&s.createElement(f,{icon:"icon-done_all",onClick:this.onTapMultiselectMobile},"Multiselect"),s.createElement(f,{icon:"icon-reply",onClick:this.onTapUndoMobile},"Undo"),e,i.supportPerformArchive&&s.createElement(f,{icon:"icon-task",disabled:0===t.numComplete,onClick:i.onTapArchiveCompleted.onClick.bind(i)},"Archive Completed"),i.supportDataRefresh&&s.createElement(f,{icon:"icon-spinner",onClick:i.onTapRefreshData.onClick.bind(i)},"Refresh"))},renderContextMenu:function(e){var t=this.props.pane,i=t.supportDataRefresh||t.supportReportError||t.supportCompose;return s.createElement(m,{key:"contextMenuPaneHeader",element:e.element},t.supportDataRefresh&&s.createElement(f,{icon:"icon-spinner",onClick:t.onTapRefreshData.onClick.bind(t)},"Refresh"),t.supportReportError&&s.createElement(f,{icon:"icon-warning",onClick:t.onTapReportError.onClick.bind(t)},"Report Error"),t.supportClone&&r.isFeatureEnabled(n.Feature.ClonePane)&&[i&&s.createElement("hr",{key:"hr"}),s.createElement(f,{key:"cloneOutline",icon:"icon-align-left",onClick:this.clonePane.bind(this,PaneMode.Outline)},"Clone as Outline Pane"),s.createElement(f,{key:"cloneCalendar",icon:"icon-calendar",onClick:this.clonePane.bind(this,PaneMode.Timeline)},"Clone as Calendar Pane")])},renderTopStatus:function(e,i){return s.createElement("div",{className:"paneHeader"},s.createElement(g,{className:"topLeftButton",icon:"icon-close",color:"#444",iconSize:24,width:t.topBarHeight,height:t.topBarHeight,onClick:this.onTapCloseTopStatus}),s.createElement("div",{className:"topStatus"},e),i)},render:function(){var e=this.state,i=this.props.pane,a=this.getChildByKey("headerButtons");if(r.mobile){if(e.topBarMode===n.TopBarMode.Normal){var o=t.classNames("titles f1",{multiline:e.titles.length>1}),c={};return c[r.transform.react]="translate3d(0,"+e.headerRow2Position+"px,0)",s.createElement("div",{className:"paneHeader"},s.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox"},s.createElement("div",{className:"leftButtons"},s.createElement(g,{icon:"icon-menu",iconSize:24,width:t.topBarHeight,height:t.topBarHeight,onClick:this.onTapOverviewButtonMobile})),s.createElement("span",{className:o},e.titles.length>1&&s.createElement("div",{className:"titlesParents"},e.titles.map(function(t,n){if(n<e.titles.length-1)return s.createElement(u,{key:"title_"+n,isLast:!1,pane:i,item:t})})),s.createElement(u,{className:"currentTitle",isLast:!0,pane:i,item:e.titles[e.titles.length-1]})),s.createElement("div",{className:"rightButtons"},s.createElement(g,{icon:"icon-more",color:"#666",iconSize:24,width:t.topBarHeight,height:t.topBarHeight,onClick:this.onTapMoreButtonMobile}))),s.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox",style:c},a&&s.Children.map(a.props.children,function(e){return e}),!e.isOverviewVisible&&s.createElement(h,{pane:i}),!e.isOverviewVisible&&s.createElement(p,{pane:i})))}return e.topBarMode===n.TopBarMode.Multiselect?this.renderTopStatus(e.numSelected+" Selected",s.createElement(g,{className:"abs",style:{right:0},enabled:e.numSelected>0,height:44,fontSize:16,primary:!0,fontWeight:"normal",onClick:this.onTapClearMultiselect},"Clear")):this.renderTopStatus(e.topBarMode)}var l=n.PaneHeaderButtonHeight;return s.createElement("div",{className:"paneHeader c-bg-faded c-border-light"},s.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox paneDraggable",onMouseDown:this.onMouseDown},s.createElement(g,{className:"overviewButton",icon:"icon-menu",primary:e.isOverviewVisible,iconSize:18,width:44,height:l,onClick:i.onTapOverviewButton.bind(i),tooltip:(e.isOverviewVisible?"Close":"Open")+" Overview"}),s.createElement(h,{pane:i}),s.createElement(g,{className:"paneCloseButton",icon:"icon-close",iconSize:18,width:44,height:l,onClick:i.onTapClosePane.bind(i),tooltip:"Close Pane"})),s.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox paneDraggable",onMouseDown:this.onMouseDown},s.createElement("span",{className:"titles"},s.createElement("span",{className:"titlesInner paneDraggable"},e.titles.map(function(t,n){return s.createElement(u,{key:"title_"+n,isLast:n===e.titles.length-1,pane:i,item:t})}))),a&&s.Children.map(a.props.children,function(e){return e}),i.supportPerformArchive&&s.createElement(g,{icon:"icon-task",iconSize:16,width:l,height:l,enabled:e.numComplete>0,onClick:i.onTapArchiveCompleted.onClick.bind(i),tooltip:"Archive Completed Items"}),i.hasMoreButtons&&s.createElement(g,{icon:"icon-more-vert",iconSize:18,width:l,height:l,onMouseDown:this.onMouseDownMore,tooltip:"More"})))}})}),define("ReactHiddenInput",["require","globals","Constants","platform","react","MooReact","VMPane"],function(e){var t=(e("globals"),e("Constants")),i=(e("platform"),e("react")),n=e("MooReact"),r=e("VMPane");return n.createClass({displayName:"ReactHiddenInput",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{pane:i.PropTypes.instanceOf(r).isRequired},getState:function(){return{position:this.props.pane.caretPosition}},getElement:function(){return this.refs.hiddenInput},render:function(){var e=(this.state,this.state.position),t={};return e&&(t.left=e.left,t.top=e.top),i.createElement("div",{style:t,contentEditable:"true",className:"paneHiddenInput",ref:"hiddenInput"},TextSpace)}})}),define("ReactInfiniteList",["require","globals","Constants","platform","react","MooReact","VMPane","InfiniteList","ReactHiddenInput","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("VMPane"),o=e("InfiniteList"),c=e("ReactHiddenInput"),l=e("Components/FancyButton");return a.createClass({displayName:"ReactInfiniteList",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{owner:r.PropTypes.instanceOf(o).isRequired,pane:r.PropTypes.instanceOf(s).isRequired,overview:r.PropTypes.bool.isRequired,contentClass:r.PropTypes.string.isRequired,hiddenInput:r.PropTypes.bool,renderCell:r.PropTypes.func.isRequired,minItemHeight:r.PropTypes.number.isRequired},init:function(){this.props.pane.onInfiniteListLoaded(),this.props.owner.notifyInit(this)},componentDidMount:function(){this.props.hiddenInput&&(this.props.pane.hiddenInput=this.refs.hiddenInput.getElement())},onUnmount:function(){this.props.owner.notifyUnmounted()},getState:function(){var e=this.props.pane,t=this.props.owner;return{cells:t.cellsObs,paddingBottom:t.paddingBottom,contentSize:t.contentSize,bottomListMessage:e.bottomListMessage(),isLoadingNewPage:e.isLoadingNewPage,isLoading:e.isLoading,statusMessage:e.getStatusMessage(this.props.overview),disablePointerEvents:t.disablePointerEvents,rect:this.props.pane.rect,items:t._itemsObs}},isIndexMounted:function(e){return e>=0&&!!this._getElementAtIndex(e)},_getElementAtIndex:function(e){for(var t,i=this.props,n=this.state,r=0;r<n.cells.length;r++){if(n.cells[r].index===e){t=r;break}}var a=this.getChildByKey("topBox"),s=t+(i.hiddenInput?1:0)+(a?1:0);return this.refs.contentElement.children[s]},getElementAtIndex:function(e){var i=this._getElementAtIndex(e);try{t.PAssert(5220,i,"Must have a valid mounted item at index",e)}catch(e){t.reportError(e)}return i},handleClick:function(){this.props.pane.isLoading.get()&&this.state.statusMessage&&this.props.pane.handleStatusClick()},renderItems:function(){for(var e=[],t=this.state.cells,i=0;i<t.length;i++)e.push(this.props.renderCell(i,t[i]));return e},render:function(){var e,a=this.state,s=this.props,o=s.pane,d=t.classNames(s.contentClass,{noClickItems:a.disablePointerEvents}),h=a.statusMessage,u=a.contentSize+a.paddingBottom;if(!s.isLoading)if(s.owner.hasItems()){if(a.bottomListMessage&&!s.overview){var p={};p[n.transform.react]="translateY("+a.contentSize+"px)",e=r.createElement("div",{className:"paneBottomMessage",style:p},r.createElement(l,{className:"paneDataPageLoad",height:40},a.bottomListMessage)),u+=40}}else d+=" noItems"+(h?" displayStatus":"");var m={};s.orientation===i.Orientation.Horizontal?(m.width=(u||200)+"px",m.height="100%"):(m.height=(u||200)+"px",m.width="100%");var f=null;s.hiddenInput&&(f=r.createElement(c,{ref:"hiddenInput",pane:o}));var g=this.getChildByKey("topBox");return r.createElement("ul",{className:d,style:m,onClick:this.handleClick,spellCheck:"false",draggable:"false",ref:"contentElement","data-pane-status":h},f,g,this.renderItems(),e)}})}),define("ReactCaret",["require","Constants","platform","react","MooReact","DisplaySettings","VMPane","Sel"],function(e){var t=e("Constants"),i=e("platform"),n=e("react"),r=e("MooReact"),a=e("DisplaySettings"),s=e("VMPane"),o=e("Sel");return r.createClass({displayName:"ReactCaret",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{pane:n.PropTypes.instanceOf(s).isRequired},init:function(){this.createObservables({isOn:!1})},componentDidMount:function(){document.addEventListener("mousedown",this.setOn),document.addEventListener("mouseup",this.startAnim)},onUnmount:function(){document.removeEventListener("mouseup",this.startAnim),document.removeEventListener("mousedown",this.setOn),clearTimeout(this.animTimeout)},getState:function(){var e=this.props.pane;return{info:e.caretPosition,isWindowFocused:o.isWindowFocused,activePane:o.pane,isPaneActive:o.isWindowFocused.get()&&o.getPane()===e}},onAfterChanged:function(e,t){e.isPaneActive&&e.info&&(e.isPaneActive!==t.isPaneActive||e.info!==t.info)&&this.startAnim()},setOn:function(){this.state.isPaneActive&&(clearTimeout(this.animTimeout),this.isOn.set(!0))},startAnim:function(){this.animTick(!0)},animTick:function(e){this.state.isPaneActive&&this.state.info&&(clearTimeout(this.animTimeout),this.isOn.set(e||!this.isOn.get()),this.animTimeout=setTimeout(this.animTick,500))},render:function(){var e=this.state,t=this.state.info,r=t&&t.item,s=t&&t.pane,c={height:"18px"};return t&&e.isPaneActive&&o.isValid()&&o.getStartItem()?(t.isVisible&&(c.height=r&&s&&a.lineHeightForItem(r,s)+"px",c.opacity=e.isOn?1:0),c[i.transform.react]="translate3d("+t.left+"px, "+t.top+"px, 0)"):c[i.transform.react]="translate3d(-1000px, -1000px, 0)",n.createElement("div",{className:"caret c-bg-caret",style:c})}})}),define("CellRendererItem",["require","globals","Constants","platform","react","EmailPreview","DisplaySettings","Sel","Multiselect","Measure","MobileUI"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("EmailPreview"),s=e("DisplaySettings"),o=e("Sel"),c=e("Multiselect"),l=e("Measure"),d=e("MobileUI"),h=function(e,t,i,n){return 0===t&&i.isPrefixNumList()&&(e=e.replace('<span class="itemPrefix','<span data-listnum="'+n.numListNumber+'" class="itemPrefix')),e=e||TextSpace},u=function(e,t,i,a,c){var d=[],h=i.pane,u=h.getSpanWidthForItem(t);if(a.selected){var p={top:0,width:u,height:a.height};p[n.transform.react]="translateX("+c+"px)",d.push(r.createElement("span",{key:"selStart",className:"textSelected",style:p}))}else if(void 0!==a.selectedStart){var m,f=a.lines.reduce(function(e,t){return e+t.length},0),g=a.selectedStart,v=a.selectedEnd;g<0&&(g=0),v<0&&(v=f,m=!0);var y=l.getCaretOffset(t,h,g,o.preferLineStart),b=l.getCaretOffset(t,h,v,o.preferLineStart),S=s.paddingForItemTop(t,h),E=s.paddingForItemBottom(t,h),C=s.lineHeightForItem(t,h),P=!t.isNote()&&b.line>y.line,T=y.line*C+(y.line>0?S:0),D=b.line*C+S,M=C+(0===y.line?S:0)+(y.line===a.lines.length-1?E:0);if(y.lineOffset<y.lineLength||!P){var _=P||m?u-y.left:b.left-y.left,I={top:T,width:_,height:M};I[n.transform.react]="translateX("+(y.left+c)+"px)",d.push(r.createElement("span",{key:"selStart",className:"textSelected",style:I}))}if(P){var A=D-T,w=C+(b.line===a.lines.length-1?E:0),k=m?u:b.left;if(A>=2*C){var x=D-M-T,R={top:T+C+(0===y.line?S:0),width:u,height:x};R[n.transform.react]="translateX("+c+"px)",d.push(r.createElement("span",{key:"selMid",className:"textSelected",style:R}))}var O={top:D,width:k,height:w};O[n.transform.react]="translateX("+c+"px)",d.push(r.createElement("span",{key:"selEnd",className:"textSelected",style:O}))}}return d},p=function(e,a,o,c,l){var d=c.lines,u=o.pane,p=o.overview,m=u.maxWidthOfItem(a),f=[];try{t.PAssert(5221,d,"If an item is being rendered it must have styled lines")}catch(e){t.reportError(e)}if(d){try{t.PAssert(5222,!isNaN(l),"Should always have a valid number for padding")}catch(e){t.reportError(e)}var g={width:!p&&m};n.isFirefox||o.padInsteadOfTransformLines?g.marginLeft=l:p?g.paddingLeft=l:g[n.transform.react]="translateX("+l+"px)",p||a.isNote()?d=[d[0]||TextSpace]:m<t.MinItemWidth&&(d=["..."]);for(var v=0;v<d.length;++v){var y=t.classNames("line",{first:0===v},{last:v===d.length-1}),b=d[v],S=t.extend({paddingTop:!p&&0===v&&s.paddingForItemTop(a,u),paddingBottom:!p&&v===d.length-1&&s.paddingForItemBottom(a,u),height:!p&&s.lineHeightForItem(a,u)+"px",paddingLeft:a.isNote()&&a.parent().getPrefix()&&i.PrefixWidth+i.LineLeftPad},g);b=h(b,v,a,c),n.mobile||o.overview||u.type!==PaneMode.Outline||!c.isHovered||!a.isPrefixHeader()||u.isSearchedFlat()||v!==d.length-1||(b+='<span data-tooltip="Add new item to header" class="itemAddButton icon-add c-button" />'),f.push(r.createElement("span",{className:y,key:"line_"+v,style:S,dangerouslySetInnerHTML:{__html:b}}))}}return f},m=function(e,t,i,n,a){if(n.showVerticalLines){var o=s.itemIndentStart(i.pane)-5+10,c=a-o;if(c>0&&(!n.showBullets||c>s.itemIndentSize())){var l={left:o,width:c};return r.createElement("div",{className:"vertLines",style:l})}}},f=function(e,i,a,o,c){var d=a.pane,h=d.supportBulletEdit||d.isSearchedFlat();if(o.showBullets&&o.lines.length>0||!a.overview&&o.isHovered&&h&&!i.isNote()){var u=t.classNames("itemIconLeft",{bullet:!(h&&o.isHovered)},{"itemEditButton icon-edit":h&&o.isHovered}),p=l.lineItemHeight(i,d,1),m={height:p,paddingTop:!a.overview&&s.paddingForItemTop(i,d)};return m[n.transform.react]="translateX("+(c-20-5)+"px)",r.createElement("div",{className:u,style:m})}},g=function(e,i,a,o,c){var l=a.overview,d=a.pane,h=o.isHeader,u=(d.supportCollapsing||l)&&!d.isSearchedFlat();if(o.isHovered&&""===i.getParsedText()){var p=t.classNames("emptyItemAddButton icon-add c-background c-shadow-light"),m={marginLeft:1===o.levelsDeep?-4:-12};return m[n.transform.react]="translateX("+(c-24)+"px)",r.createElement("div",{className:p,style:m})}if(u&&(o.isCollapsed||!n.mobile&&o.isHovered&&!i.isNote()||h&&l)&&(!l||0!==o.levelsDeep)){var f=t.classNames("collapser",{collapsed:u&&h&&o.isCollapsed},{"icon-caret-down":u&&h&&!o.isCollapsed},{"icon-caret-right":u&&h&&o.isCollapsed}),g={width:c-5-(o.showBullets?20:0),paddingTop:!l&&s.paddingForItemTop(i,d)};return r.createElement("div",{className:f,style:g})}},v=function(e,i,a,s){var o=a.overview,c=a.pane;if(!n.mobile){var l,d,h={};return o||i.isNote()?o&&s.isHovered&&c.supportClickOverviewScroll&&s.isOverviewVisibleInPane&&!s.isOverviewFocused&&(l=t.classNames("itemCheckbox c-button","itemOverviewZoom","icon-unfold_less"),d="Scroll to item"):c.supportCompleting&&s.isHovered?l=t.classNames("itemCheckbox c-button","icon-check",{checked:i.isComplete()}):c.supportArchiving&&i.isArchived()&&(l=t.classNames("itemCheckbox c-button","itemUnarchive","icon-task"),d="Unarchive"),l&&r.createElement("div",{"data-tooltip":d,className:l,style:h})}};return{onMount:function(e,t,i,n,r){var a=n.pane,s=n.overview;e.listenTo(t.itemChanged),e.listenToDispatcher("numListChanged"),e.listenToDispatcher("EmailPreview","onClosed"),e.listenToDispatcher("EmailPreview","openThreadChanged"),a&&!s&&t.onLoad(a),e.setData(e.refs.li,t)},onUnmount:function(e){e.disposeDispatcherListeners()},onUpdate:function(e,t,i,r,a,s){if(n.mobile&&r.isEditable&&s.lines!==r.lines)if(n.android)e.refs.androidInput.value=t.getParsedText();else for(var o=e.state.lines,c=e.refs.li,l=c.getElementsByClassName("line"),d=0;d<l.length;d++)l[d].innerHTML=h(o[d],d,t,r)},getState:function(e,i,r,s){var l=s.pane,h=s.overview;if(l.isDestroyed())return{};var u=o.isSelected(r,l),p={flags:i.flags,levelsDeep:i.levelsDeep,styleProps:i.styleProps(l),draggedInPane:i.draggedInPane,isHoveredItem:o.isItemHovered(i),isHovered:o.isReactCellHovered(e),showBullets:!n.mobile&&!h&&!i.isNote()&&l.supportBullets&&t.settings.get(Settings.showBullets,Settings.UISettingsGroup),showVerticalLines:!n.mobile&&!h&&l.supportVertLines&&t.settings.get(Settings.showVerticalLines,Settings.UISettingsGroup),isSelected:!h&&l===t.focusedPane&&c.isSelected(r,l),hasSelection:!!u,hasNote:i.hasNote(),isCollapsed:i.isCollapsed(l,h),isHighlighted:i.isHighlighted,dropBucketItems:n.mobile&&!s.isInDragDrop&&l===t.focusedPane&&t.vmMain.dropBucket.getItems(),numListNumber:i.isPrefixNumList()&&i.numListNumber()};if(h){if(p.paneItem=l.item,p.lines=[i.getStyledTextAsOneLine()],l.type===PaneMode.Gmail){var m=t.vmMain.pluginManager.getPlugin(PluginID.Gmail),f=i.getParsedText(),g=m.getIconForLabel(i);g&&(p.lines[0]='<span class="labelText hasIcon"><i class="c-foreground-light icon-'+g+'"></i>'+f+"</span>")}n.mobile||(p.isOverviewAtTop=l.getOverview().isItemAtTop(i),p.isOverviewDragHover=l.getOverview().isItemDragHovered(i)),p.isOverviewVisibleInPane=l.isOverviewVisibleInPane(i),p.isOverviewFocused=l.getItem()===i,p.isOverviewRoot=l.getRootItem()===i}else{var v=i.getAttachmentByPlugin(PluginID.Gmail);if(p.isEmailOpen=v&&v===a.getThreadAttach()&&a.isOpenOnPane(l),p.lines=l.getStyledLinesForItem(i,h,p.hasSelection),n.mobile)n.mobile&&(p.isEditable=i.isEditable,p.isMultiselected=p.isSelected&&d.isInMultiselect());else if(p.selected=p.selectedText=p.selectedStart=p.selectedEnd=void 0,u){var y=o.getSelectionAtIndex(r);!0===y?p.selected=!0:y.start!==y.end&&(p.selectedStart=y.start,p.selectedEnd=y.end)}else p.selectedText=void 0;i.isNote()&&(p.parentFlags=i.parent().flags,p.parentStyleProps=i.parent().styleProps(l))}return p.isHeader=l.isItemHeader(i,h),p},render:function(e,i,a,o,c,l,d,h,y){var b=c.pane,S=c.overview,E=!!(b.isWriteable&&n.mobile&&l.isEditable)||null,C=b.getPaddingForItem(a,S),P=t.classNames("item c-foreground",h,l.styleProps,{"c-border-light":!S},{"c-border-heavy":S},{"c-background":!S},{"overviewItem c-button-overview":S},{overviewAncestor:S&&l.isOverviewAncestor},{overviewFocused:S&&l.isOverviewFocused},{overviewVisibleInPane:S&&l.isOverviewVisibleInPane},{overviewRoot:S&&l.isOverviewRoot},{"overviewAtTop c-background-overview-selected":S&&l.isOverviewAtTop},{overviewDragHover:S&&l.isOverviewDragHover},{collapsed:l.isCollapsed},{itemBeingDragged:l.draggedInPane===b||n.mobile&&b===t.focusedPane&&t.vmMain.dropBucket.hasItemEntry(a)},{hovered:l.isHoveredItem},{"c-background-hovered":!S&&l.isHoveredItem},{"c-background-overview-hovered":S&&l.isHoveredItem&&!l.isOverviewAtTop},{faded:l.faded},{selected:n.mobile&&l.isSelected&&l.isMultiselected},{"c-background-item-selected":!n.mobile&&l.isSelected&&a.hasPluginAttachment(PluginID.Gmail)},{"c-background-item-selected":l.isEmailOpen},{editable:E},{highlighted:l.isHighlighted&&b!==t.focusedPane},{firstItem:0===o},{hasSelection:l.hasSelection},{hasNote:l.hasNote},{swiping:!!y});if(S||(d=t.extend({fontSize:s.fontSizeForItem(a,b),lineHeight:s.lineHeightForItem(a,b)+"px"},d)),n.android&&E){var T={paddingLeft:C,height:d.height,paddingTop:s.paddingForItemTop(a),paddingRight:n.windowWidth()-b.getSpanWidthForItem(a)-C};return r.createElement("li",{"data-moo-id":i,className:P,style:d,ref:"li",contentEditable:E},r.createElement("textarea",{className:"androidInput",ref:"androidInput",style:T,defaultValue:a.getParsedText(),onInput:b.onInputAndroid,onChange:t.emptyFn}))}return r.createElement("li",{"data-moo-id":i,className:P,style:d,ref:"li",contentEditable:E},p(0,a,c,l,C),m(0,0,c,l,C),g(0,a,c,l,C),f(0,a,c,l,C),v(0,a,c,l),!S&&(l.selected||void 0!==l.selectedStart)&&u(0,a,c,l,C),y)}}}),define("CellRendererAgendaHeader",["require","globals","react"],function(e){var t=e("globals"),i=e("react");return{onMount:function(e,t,i,n){e.listenTo(n.pane.dragHoveredBlock)},getState:function(e,t,i,n){return{isHovered:n.cell.paneObject.block===n.pane.dragHoveredBlock.get()}},render:function(e,n,r,a,s,o,c,l){var d=r.block,h=d.isCollapsed(),u=t.classNames(l,"dateHeader c-border-light",{agendaBlockRed:!h&&(d.isToday||d.isNow||d.isOverdue)},{hovered:e.state.isHovered},{"c-blue":!h},{"collapsed c-foreground-super-faded":h},{firstBlock:0===a},{firstCollapsed:s.cell.paneObject.isFirstCollapsed}),p=d.isStarred&&i.createElement("i",{className:"icon-star"})||d.isImportant&&i.createElement("i",null,"!!!"),m=t.classNames("agendaCollapser c-foreground-super-faded",{"icon-caret-down":!h},{"icon-caret-right":h});return i.createElement("li",{ref:"li","data-moo-id":n,className:u,style:c,onClick:d.toggleCollapsed},i.createElement("span",{className:m}),p,d.text)}}}),define("CellRendererAgendaEmpty",["require","globals","react"],function(e){var t=e("globals"),i=e("react");return{render:function(e,n,r,a,s,o,c){var l=t.classNames("agendaEmpty",s.className);return i.createElement("li",{ref:"li","data-moo-id":n,className:l,style:c},r.text)}}}),define("CellRendererHR",["require","globals","react"],function(e){var t=e("globals"),i=e("react");return{render:function(e,n,r,a,s,o,c){var l=t.classNames("hr",s.className);return i.createElement("li",{"data-moo-id":n,className:l,style:c},r.text)}}}),define("ReactItem",["require","globals","platform","data","Constants","react","MooReact","DisplaySettings","NativeSel","Autocomplete","Components/DivX","VMPane","VMLI"],function(e){var t=e("globals"),i=e("platform"),n=e("data"),r=e("Constants"),a=e("react"),s=e("MooReact"),o=e("DisplaySettings"),c=e("NativeSel"),l=e("Autocomplete"),d=e("Components/DivX"),h=e("VMPane"),u=e("VMLI");return s.createClass({displayName:"ReactItem",componentDisplay:r.ComponentDisplay.Everywhere,propTypes:{item:a.PropTypes.instanceOf(u).isRequired,pane:a.PropTypes.instanceOf(h),maxWidth:a.PropTypes.number,editOnClick:a.PropTypes.bool,editable:a.PropTypes.bool},componentDidMount:function(){var e=this.props,i=e.item;this.listenTo(i.itemChanged),this.setData(this.getElement(),i);try{t.PAssert(5224,e.pane||!e.renderLikePane&&!e.padded,"Should not use these props if no pane")}catch(e){t.reportError(e)}this.props.editable&&(this._needsSelect=isNaN(e.selectIndex)?i.getParsedText().length:e.selectIndex,c.selectElement(this.getElement(),this._needsSelect))},getElement:function(){return this.refs.element.getElement()},getState:function(){var e=this.props,t=e.pane,i=e.item,n={flags:i.flags,styleProps:e.renderLikePane&&i.styleProps(t),priorityProps:e.showPriority&&i.getPriorityProps(),isComplete:i.isComplete()};return e.renderLikePane?(n.metrics=i.metricsInPane(t,void 0),n.lines=n.metrics.styledLines):n.lines=[i.getStyledTextAsOneLine(!0)],n},focus:function(){var e=this.props.item.getParsedText().length;c.selectElement(this.getElement(),e)},onKeyPress:function(e){var t=this.props;if(t.onKeyPress&&(t.onKeyPress(e),!e.defaultPrevented)){var i=this.props.item,n=c._getSelectionRange(),r=c.getSelectOffsetsInElement(e.target,n);if(this._needsSelect=void 0,r.start!==r.end){var a=i.getParsedText(),s=a.substr(0,r.start)+a.substr(r.end);i.setText(s,!0,!1!==t.shouldSave?ChangeType.Local:ChangeType.Auto),this._needsSelect=r.start}}},componentDidUpdate:function(){if(!isNaN(this._needsSelect)){var e=this.getElement(),t=e.innerHTML;(t.indexOf("<br")>=0||t.indexOf("></span>")>0||""===t)&&(e.innerHTML=this.getRenderedHtml()),c.selectElement(e,Math.min(e.textContent.length,this._needsSelect))}},convertElementToText:function(e){var t="";if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=r.AttachChar;else for(var i=0;i<e.childNodes.length;i++)t+=this.convertElementToText(e.childNodes[i]);return t},stopResizing:function(){this.isResizing=!1},onInput:function(e){e.target.innerHTML.indexOf("<br")>=0&&(e.target.innerHTML=e.target.innerHTML.replace("<br/>","").replace("<br>",""));var t=this.props,i=t.item,n=this.convertElementToText(e.target).replace(new RegExp(TextSpace,"g"),""),r=c._getSelectionRange(),a=c.getSelectOffsetsInElement(e.target,r);this._needsSelect=a.start,i.setText(n,!0,ChangeType.Local),this.updateAutocomplete(),e.preventDefault()},updateAutocomplete:function(){var e=this.getElement(),t=this.props.autocompleteMode;if(t&&(!i.mobile||"snooze"===t||"move"===t||"email"===t||"gmailLabel"===t||"item"===t)){var n=c.getSelectionInElement(e);i.mobile&&!n&&(n={start:0,end:0}),n&&n.start===n.end&&l.update({mode:t,text:this.convertElementToText(e).replace(new RegExp(TextSpace,"g"),""),offset:n.start,owner:this,parsedEls:this.parsedEls,positionOffset:this.props.positionOffset,elementDisplay:e,elementInput:e,supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}},onAutocompleteSelected:function(e){if(void 0!==e.value){this.props.item.setText(e.value,!0,ChangeType.Local),c.selectElement(this.getElement(),e.offset),setTimeout(function(){c.selectElement(this.getElement(),e.offset)}.bind(this),0)}},onClick:function(e){if(!this.isResizing){var i=this.props;if(t.menus.isContextMenuOpen("ReactContextMenuContactDetails")&&t.menus.closeContextMenuReact("ReactContextMenuContactDetails"),i.editOnClick)e.preventDefault(),e.stopPropagation(),t.menus.isContextMenuOpen()&&t.menus.closeContextMenuReact(),t.menus.openContextMenuReact({componentName:"ReactItemDetailsPopup",element:e.target,item:i.item,pane:i.pane});else{var r=!0;if((i.editable||i.inItemDetails)&&i.pane&&(r=!t.vmMain.pluginManager.handleTapClick(i.item,i.pane,e)),r&&!i.inItemDetails&&t.hasClass(e.target,"contact")){var a=e.target.textContent,s=n.contactManager.findMatchExact(a[0]===ContactPrefix?a.substr(1):a);s&&t.menus.openContextMenuReact({componentName:"ReactContextMenuContactDetails",position:"bottom",element:e.target,contact:s})}}}},onMouseDown:function(e){if(!i.mobile&&e.button===ButtonCode.Left){var t=this.props,n=t.item,a=t.resizable;if(a){var s=this.getElement().getBoundingClientRect();a=e.clientY-s.top<r.CalendarResizeHandleHeight?t.onItemResizeStart(n,this,!1):s.bottom-e.clientY<r.CalendarResizeHandleHeight&&t.onItemResizeStart(n,this,!0)}this.isResizing=a,!a&&t.allowDrag&&n.checkDragOnStart(e)}},onMouseMove:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnMove(e,!1)},onMouseUp:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnEnd(e)},onRightClick:function(e){var i=this.props;i.pane&&!1!==i.allowDrag&&(t.menus.openContextMenuReact({componentName:"ReactContextMenuItem",key:"contextMenuItem"+this.props.item.id,element:e.target,item:this.props.item,pane:this.props.pane,pos:{left:e.clientX,top:e.clientY}}),e.preventDefault(),e.stopPropagation())},getRenderedHtml:function(){for(var e,t=this.props,i=this.props.item,n=this.state.lines,r="",a=0;a<n.length;++a)e=t.renderLikePane?"padding-top: "+(0===a?o.paddingForItemTop(i)+"px":0)+"; padding-bottom: "+(a===n.length-1?(t.noNotes?o.paddingForItemTop(i):o.paddingForItemBottom(i))+"px":0)+";":"padding-top: 2px; padding-bottom: 2px",r+='<span class="line'+(a===n.length-1?" last":"")+'" style="'+e+'">'+(n[a]||TextSpace)+"</span>";return r},render:function(){var e=this.props,n=e.item,r=this.state,s=(r.lines,e.editable&&t.vmMain.pluginManager.allowTextEditing(n)),o=t.classNames("item itemNotInPane",e.className,r.styleProps,r.priorityProps,e.coloredInCalendar&&"colored",{autoSelect:s},{complete:r.isComplete}),c={};if(e.padded){var l=n.getPadding(e.pane)+(e.paddingOffset?e.paddingOffset:0);c.paddingLeft=l}var h=this.getRenderedHtml();if(e.style&&(c=t.extend(e.style,c)),e.coloredInCalendar){c.backgroundColor=n.getCalendarColor();var u=n.getCalendarDisplayProps();if(u)for(var p in u.style){try{t.PAssert(5225,!c[p],"Calendar display prop overwriting default styling")}catch(e){t.reportError(e)}c[p]=u.style[p]}}return a.createElement(d,{"data-moo-id":this.getUniqueID(),style:c,className:o,contentEditable:s,onClick:(e.editOnClick||s||e.inItemDetails)&&this.onClick,onKeyPress:s&&this.onKeyPress,onInput:s&&this.onInput,onMouseDown:!i.mobile&&!s&&this.onMouseDown,onMouseMove:!i.mobile&&!s&&this.onMouseMove,onMouseUp:!i.mobile&&!s&&this.onMouseUp,onContextMenu:!i.mobile&&this.onRightClick,tabIndex:e.tabIndex,dangerouslySetInnerHTML:{__html:h},ref:"element"})}})}),define("ReactMonthDay",["require","globals","Constants","react","MooReact","Dispatcher","data","International","tracker","VMPane","DragDrop","ReactItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Dispatcher"),s=(e("data"),e("International")),o=(e("tracker"),e("VMPane")),c=e("DragDrop"),l=e("ReactItem");return r.createClass({displayName:"ReactMonthDay",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{pane:n.PropTypes.instanceOf(o).isRequired,date:n.PropTypes.instanceOf(Date).isRequired,items:n.PropTypes.array},init:function(){a.listen("endDrag",this.onDragEnd),this.createObservables({isHovered:!1}),this.listenToDispatcher("dateChanged")},arePropsEqual:function(e,t,i){return"items"===e?t===i||t&&i&&t.length===i.length:"date"===e?t===i||t&&i&&t.equals(i):void 0},areStatesEqual:function(e,t,i){if("items"===e){if(!t||!i||t.length!==i.length)return!1;for(var n=0;n<t.length;n++)if(t[n].time!==i[n].time||t[n].item!==i[n].item)return!1;return!0}},componentWillReceiveProps:function(e){e.items!==this.props.items&&this.updateState(e)},getState:function(e){var t={};if(e.items){for(var i=[],n=[],r=0;r<e.items.length;r++){var a=e.items[r];if(!a.isNote()){var o=a.date()||a.repeatDate()&&a.repeatDate().getStartDate(),c=o.hasTimeOfDay()&&o.toString(s.getFormat(DFormat.ShortTime));c?n.push({time:c,item:a}):i.push({item:a})}}t.items=i.concat(n)}return t},onMouseDown:function(e){e.preventDefault()},onMouseEnter:function(){if(c.isDragging){this.isHovered.set(!0);var e=c.dragItem.date();c.setAgendaInfo({date:this.props.date,dateTime:e&&e.hasTimeOfDay()&&e,isDate:!0})}},onDragEnd:function(){this.isHovered.set(!1)},onMouseLeave:function(){this.isHovered.set(!1)},onDoubleClick:function(e){var t=this.props,i=t.pane,n=t.date,r=i.item.get(),a=s.getAppendDateText(n);i.openItemEditor({element:e.target,text:" @"+a,parent:r,selectIndex:0,pos:{top:e.clientY},addOnSave:!0})},render:function(){
var e,r=this.props,a=this.state,s=r.date,o=0===s.getDay()||6===s.getDay(),c=s.getDate(),d=Date.getDaysInMonth(s.getFullYear(),s.getMonth()),h=t.classNames("dateBlock c-border",{firstDay:1===s.getDate()},{lastDay:s.getDate()===d},{"weekend c-bg-faded":o},{"c-background":!o},{hoveredInDrag:a.isHovered},{today:s.isToday()}),u={left:r.left-1,width:r.width+1},p=t.classNames("dateBlockDay");if(a.items){for(var m=[],f=!1,g=0;g<a.items.length;g++){var v=a.items[g];v.time&&v.item.hasAttachmentType(i.PluginType.Calendar)&&(f=!0)}for(var g=0;g<a.items.length;g++){var v=a.items[g],y=v.time,b=v.item,S=f&&y,E=t.classNames("dateBlockItem flexbox",{hasCircle:S}),C=null;if(S){var P={background:b.hasAttachmentType(i.PluginType.Calendar)&&b.getCalendarColor()};C=n.createElement("div",{className:"monthItemColorCircle",style:P})}m.push(n.createElement("div",{className:E,key:b.id},C,n.createElement(l,{className:"itemInCalendar",item:b,pane:r.pane,coloredInCalendar:!y&&b.getCalendarColor(),showPriority:!0,allowDrag:!0,editOnClick:!0}),y&&r.width>100&&n.createElement("span",{className:"itemTime"},y)))}e=(r.items||a.isHovered)&&n.createElement("div",{className:"dateBlockItems"},m)}return n.createElement("div",{className:h,style:u,onMouseDown:this.onMouseDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onDoubleClick:this.onDoubleClick},n.createElement("div",{className:p},c),e)}})}),define("CellRendererCalendarWeek",["require","globals","react","ReactMonthDay"],function(e){var t=e("globals"),i=e("react"),n=e("ReactMonthDay");return{getState:function(e,t,i,n){return{paneRect:n.pane.rect}},render:function(e,r,a,s,o,c,l){var d=o.pane,h=t.classNames("calendarWeek c-bg-app","flexbox",o.className),u=d.getWidth()+1,p=Math.floor(u/7),m=u-7*p,f=0,g=0;m>0&&(f=Math.ceil(m/2),g=m-f),l.height+=1;for(var v,y=0;y<a.dates.length;y++){var b=a.dates[y];b&&(b=b.date,1===b.getDate()&&(v=b.toString("MMMM"),b.getYear()!==Date.today().getYear()&&(v+=b.toString(" yyyy"))))}return i.createElement("li",{"data-moo-id":r,className:h,style:l},a.dates.map(function(e,t){var r=p+(0===t?f:0)+(6===t?g:0);return i.createElement(n,{key:e.date.getTime(),pane:d,date:e.date,items:e.items,index:t,left:t*p+(t>0?f:0),width:r})}),v&&i.createElement("div",{className:"calendarMonthTitle c-bg-app"},v))}}}),define("ReactCalendarTimes",["require","Constants","react","MooReact","VMPane"],function(e){var t=e("Constants"),i=e("react"),n=e("MooReact"),r=e("VMPane");return n.createClass({displayName:"ReactCalendarTimes",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{pane:i.PropTypes.instanceOf(r).isRequired},init:function(){this.scrollTop=void 0},getState:function(){var e=this.props.pane;return{numAllDay:e.numAllDay,heightAllDay:e.getHeightAllDay()}},componentDidMount:function(){this.props.trackPane&&setTimeout(function(){this.props.pane.paneContent.addEventListener("scroll",this.onPaneScroll)}.bind(this),0)},onUnmount:function(){var e=this.props.pane.paneContent;e&&e.removeEventListener("scroll",this.onPaneScroll)},onPaneScroll:function(e){var t=e.target.scrollTop;t!==this.scrollTop&&this.refs.scroller&&(this.scrollTop=this.refs.scroller.scrollTop=t)},render:function(){for(var e=this.props,t=this.state,n={height:e.height},r={height:t.heightAllDay+2},a={top:t.heightAllDay+(e.inDayPreview?0:32)},s=[],o=0;o<24;o++){var c;12===o?c="Noon":(c=0===o?12:o%12,c+=" "+(o>=12?"pm":"am")),s.push(i.createElement("div",{key:o,className:"time"},c))}return i.createElement("div",{className:"calendarTimes c-background",style:n},i.createElement("div",{className:"calendarTimesInner hideScrollbar c-border-heavy",style:a,ref:"scroller"},s),e.showAllDay&&i.createElement("div",{className:"calendarTimesAllDay c-border-heavy",style:r},"All day"))}})}),define("ReactCalendarDay",["require","Constants","globals","platform","International","react","MooReact","VMPane","DragDrop","ReactItem","ReactCalendarTimes","Components/FancyScroller"],function(e){var t=e("Constants"),i=e("globals"),n=e("platform"),r=e("International"),a=e("react"),s=e("MooReact"),o=e("VMPane"),c=e("DragDrop"),l=e("ReactItem"),d=e("ReactCalendarTimes"),h=e("Components/FancyScroller");return s.createClass({displayName:"ReactCalendarDay",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{pane:a.PropTypes.instanceOf(o).isRequired,date:a.PropTypes.instanceOf(Date)},init:function(){this.createObservables({hoveredTime:void 0,hoveredDuration:void 0,isResizing:!1}),this.listenToDispatcher("dateChanged"),this.listenToDispatcher("endDrag")},arePropsEqual:function(e,t,i){return"items"===e?t===i||t&&i&&t.length===i.length:"date"===e?t===i||t&&i&&t.equals(i):void 0},areStatesEqual:function(e,t,i){if("items"===e){if(!t||!i||t.length!==i.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].date.equals(i[n].date)||t[n].item!==i[n].item||t[n].duration!==i[n].duration)return!1;return!0}},componentWillReceiveProps:function(e){e.date.equals(this.props.date)&&e.items===this.props.items||this.updateState(e)},getState:function(e){var t=e.date.isToday(),i={isToday:t,todayTime:t&&new Date,numAllDay:e.pane.numAllDay};if(i.heightHeader=e.pane.getHeightAllDay(),e.items){i.items=[];for(var n=0;n<e.items.length;n++){var r=e.items[n];if(!r.isNote()){var a=r.date()||r.repeatDate()&&r.repeatDate().getStartDate();i.items.push({date:a,duration:r.getDuration(),item:r})}}}return i},componentDidMount:function(){if(this.state.isToday&&this.runTimeTimer(),this.props.inDayPreview){var e=8*(t.CalendarDayViewBlockHeight+1);this.refs.scroller.scrollTo(0,e-8,ScrollDuration.Snap)}},onUnmount:function(){clearTimeout(this.timeTimeout)},componentDidUpdate:function(e){this.props.date.equals(e.date)||(this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0))},onAfterChanged:function(e,t){return e.isToday?this.runTimeTimer():t.isToday&&!e.isToday&&clearTimeout(this.timeTimeout),!t.hoveredTime||c.isDragging||this.resizing||(this.hoveredTime.set(void 0,!1),this.hoveredDuration.set(void 0,!1),e.hoveredTime=void 0,e.hoveredDuration=void 0),e},runTimeTimer:function(){clearTimeout(this.timeTimeout),this.timeTimeout=setTimeout(this.updateState,3e5)},resetHovered:function(){this.resizing&&(this.resizing.component&&this.resizing.component.stopResizing(),this.resizing=void 0,this.isResizing.set(!1)),this.mouseDownAtTime=void 0,this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0)},onMouseUp:function(e){document.removeEventListener("mouseup",this.onMouseUp),this.resizing&&this.resizing.placeholder?this.addTime(this.hoveredTime.get(),this.hoveredDuration.get(),e):this.resetHovered()},onMouseLeave:function(){this.resizing||this.resetHovered()},getTimeFromMouseEvent:function(e){var n=e.clientY;return c.isDragging&&c.startPane&&c.startPane.type===PaneMode.Timeline&&c.startInfo&&(n+=12-(c.startInfo.y-c.position.top)),n-=i.findParent(e.target,"calendarDayTimes").getBoundingClientRect().top,Math.floor(n/(t.CalendarDayViewBlockHeight+1)*4)/4},onMouseDown:function(e){document.addEventListener("mouseup",this.onMouseUp),i.hasClass(e.target,"calendarDayTimes")&&(this.mouseDownAtTime=this.getTimeFromMouseEvent(e)),e.preventDefault()},onMouseMove:function(e){if(void 0!==this.mouseDownAtTime&&(this.resizing={placeholder:!0,pivot:this.mouseDownAtTime},this.mouseDownAtTime=void 0),c.isDragging){var n=this.getTimeFromMouseEvent(e);if(!isNaN(n)){var r=1,a=c.dragItem;a&&a.getDuration()&&(r=a.getDuration()/t.MSPerHour),this.hoveredDuration.set(r,!1),this.hoveredTime.set(n);var s=this.props.date.clone();s.setHours(Math.floor(n)),s.setMinutes(60*(n-Math.floor(n))),c.setAgendaInfo({date:s,dateTime:s,duration:1!==r?r:null,isDate:!0})}}else if(this.resizing){var n=this.getTimeFromMouseEvent(e);if(!isNaN(n)){var o=this.resizing,l=o.pivot,d=n>=l?l:n,h=Math.floor(4*(n>=l?n-l+.5:l-n))/4;if(!isNaN(d)&&h>=.25)if(o.item){var u={isDate:!0},s=this.props.date.clone();s.setHours(Math.floor(d)),s.setMinutes(Math.round(60*(d-Math.floor(d)))),u.duration=h,u.date=u.dateTime=s,i.vmMain.beginUpdateItems();var p=this.props.pane;p.applyAgendaDropToItem(u,o.item,p),i.vmMain.commitUpdateItems()}else o.placeholder&&(h===this.hoveredDuration.get()&&d===this.hoveredTime.get()||(this.hoveredDuration.set(h,!1),this.hoveredTime.set(d,!0)))}}},onMouseEnterAllDay:function(){if(c.isDragging){var e=this.props.date;this.hoveredDuration.set(1,!1),this.hoveredTime.set(-1),c.setAgendaInfo({date:e,isDate:!0,allDay:!0})}},onDoubleClickTimes:function(e){var t=this.getTimeFromMouseEvent(e);this.addTime(t,1,e)},addTime:function(e,t,i){var n=this.props,a=n.pane,s=n.date,o=a.item.get(),c=r.getAppendDateText(s,e,t);a.openItemEditor({element:i.target,text:" @"+c,parent:o,selectIndex:0,pos:{left:i.clientX,top:i.clientY},addOnSave:!0,onClosed:this.resetHovered})},onItemResizeStart:function(e,n,r){if(e.hasTime()){var a=e.getTimeOfDay(),s=e.getDuration()/t.MSPerHour||1,o=i.round(a/t.MSPerHour,4),c=r?o:o+s;return this.resizing={item:e,component:n,pivot:c},this.isResizing.set(!0),!0}},addToDay:function(e,t,i,n){e.push({t:t,dur:i,item:n,top:t,bottom:t+i,obj:n})},packItems:function(e){for(var t=[],i=[],n=null,r=0;r<e.length;r++){var a=e[r];if(a.isPlaceholder)i=i.concat.apply(i,this.packEvents([[a]]));else{null!==n&&a.top>=n&&(this.packEvents(t),i=i.concat.apply(i,t),t=[],n=null);for(var s=!1,o=0;o<t.length;o++){var c=t[o];if(!this.collidesWith(c[c.length-1],a)){c.push(a),s=!0;break}}s||t.push([a]),(null===n||a.bottom>n)&&(n=a.bottom)}}return t.length>0&&(this.packEvents(t),i=i.concat.apply(i,t)),i},packEvents:function(e){for(var t=e.length,i=0;i<t;i++)for(var n=e[i],r=0;r<n.length;r++){var a=n[r],s=this.expandEvent(a,i,e);a.pos=i/t*95,a.width=95*s/t}return e},collidesWith:function(e,t){return e.bottom>t.top&&e.top<t.bottom},expandEvent:function(e,t,i){for(var n=1,r=t+1;r<i.length;r++){for(var a=i[r],s=0;s<a.length;s++){var o=a[s];if(this.collidesWith(e,o))return n}n++}return n},renderItems:function(){var e,n=this.props,r=this.state,s=r.items,o=[],c=r.hoveredTime,d=r.hoveredDuration;for(e=0;e<s.length;e++){var h=s[e].item,u=h.repeatDate(),p=h.date()||h.repeatDate(),m=h.getDuration()&&h.date()&&h.getEndDate();if(p&&p.hasTimeOfDay()&&(u||p.isSameDay(n.date))){var f=p.getHours(),g=p.getMinutes(),v=f+g/60,y=h.getDuration()?h.getDuration()/t.MSPerHour:1;y=Math.min(y,24-p.getHours()),this.addToDay(o,v,y,h)}else if(p&&p.hasTimeOfDay()&&m&&!p.isSameDay(n.date)){var y;y=m.isSameDay(n.date)?m.getHours()+m.getMinutes()/60:24,this.addToDay(o,0,y,h)}}isNaN(c)||isNaN(d)||o.push({t:c,dur:d,top:c,bottom:c+d,isPlaceholder:!0});var b,S=this.packItems(o);if(S.length)for(b=[],e=0;e<S.length;e++){var E=S[e],C=E.isPlaceholder,P=this.props.pane,T={height:E.dur*t.CalendarDayViewBlockHeight+Math.ceil(E.dur),left:C?0:E.pos+"%",width:C?"95%":E.width+"%",top:Math.floor(E.t*(t.CalendarDayViewBlockHeight+1))},D=i.classNames("dayTimeBlock abs",{placeholder:C});b.push(a.createElement("div",{className:D,key:C?"placeholder":E.item.id,style:T},E.item&&a.createElement(l,{className:"itemInCalendar itemInCalendarResizable",item:E.item,pane:P,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!this.props.inDayPreview})))}return b},renderItemsAllDay:function(){for(var e=this.props,t=this.state,i=t.items,n=e.pane,r=[],s=t.hoveredTime,o={},c=0;c<i.length;c++){var d=i[c].item,h=d.date()||d.repeatDate();h&&!h.hasTimeOfDay()&&r.push(a.createElement("div",{className:"dayTimeBlock",key:d.id,style:o},a.createElement(l,{className:"itemInCalendar",item:d,pane:n,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!e.inDayPreview})))}return!isNaN(s)&&s<0&&r.push(a.createElement("div",{className:"dayTimeBlock placeholder",key:"placeholder"})),r},render:function(){var e,r,s,o,c,l,u=this.props,p=this.state,m=u.pane,f=u.date,g=0===f.getDay()||6===f.getDay(),v=this.renderItemsAllDay();if(p.isToday){var y=p.todayTime,b={top:Math.floor((y.getHours()+y.getMinutes()/60)*(t.CalendarDayViewBlockHeight+1))};l=a.createElement("div",{className:"calendarDayTimeLine",style:b})}if(u.inDayPreview){r={height:24*(t.CalendarDayViewBlockHeight+1)},o=a.createElement("div",{className:"allDayWrapper flexbox",onMouseEnter:this.onMouseEnterAllDay},a.createElement("span",{className:"time noShrink"},"All day"),a.createElement("ul",{className:"allDayUL f1"},v));var S=i.classNames("calendarDayTimes c-border-heavy f1",{"c-bg-faded":g});c=a.createElement(h,{ref:"scroller",className:"f1 flexbox"},a.createElement(d,{pane:this.props.pane,height:24*(t.CalendarDayViewBlockHeight+1),inDayPreview:!0}),a.createElement("div",{className:S,style:r,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},a.createElement("div",{className:"calendarDayGradient"}),this.renderItems(),l))}else{e={width:m.getDayWidth()},r={top:p.heightHeader+30+3,height:u.height-p.heightHeader,width:m.getDayWidth()},s={height:p.heightHeader,minHeight:p.heightHeader},e[n.transform.react]=r[n.transform.react]=u.transform;var E=i.classNames("allDay c-border-heavy f1 preventScrollPropagate",{"c-bg-faded weekend":g}),S=i.classNames("calendarDayTimes c-border-heavy",{"c-bg-faded":g});o=a.createElement("ul",{className:E,style:s,onMouseEnter:this.onMouseEnterAllDay,onDoubleClick:this.addTime.bind(this,void 0,void 0),onMouseLeave:this.onMouseLeave},v),c=a.createElement("div",{className:S,style:r,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},a.createElement("div",{className:"calendarDayGradient"}),this.renderItems(),l)}var C,P={className:i.classNames("calendarDay",{"weekend c-bg-faded":g},{today:p.isToday},{resizing:p.isResizing},u.className),"data-moo-id":u["data-moo-id"]};return f.getYear()!==Date.today().getYear()&&(C=f.toString(", yyyy")),a.createElement(u.component,P,a.createElement("div",{className:"calendarDayHeader c-background c-border-heavy flexbox flexvert",style:e},a.createElement("div",{className:"dayTitle"},a.createElement("span",null,f.toString("ddd MMM ")),a.createElement("span",{className:"dayTitleDay"},f.getDate()),C&&a.createElement("span",null,C)),o),c)}})}),define("CellRendererCalendarDay",["require","globals","platform","react","ReactCalendarDay"],function(e){var t=e("globals"),i=e("platform"),n=e("react"),r=e("ReactCalendarDay");return{getState:function(e,t,i,n){return{numAllDay:n.pane.numAllDay}},render:function(e,a,s,o,c,l,d){var h=c.pane,u=t.classNames("calendarDay",c.className);return n.createElement(r,{"data-moo-id":a,component:"li",className:u,date:s.date,items:s.items,pane:h,height:d.height,transform:d[i.transform.react],width:h.getDayWidth()})}}}),define("CellRendererAgendaTime",["require","globals","react"],function(e){var t=e("globals"),i=e("react");return{render:function(e,n,r,a,s,o,c,l){var d=t.classNames(l,"timelineItemHeader",{pComplete:r.isComplete});return i.createElement("li",{ref:"li","data-moo-id":n,className:d,style:c},r.text)}}}),define("ReactCell",["require","globals","Constants","platform","react","MooReact","InfiniteListCell","CellRendererItem","CellRendererAgendaHeader","CellRendererAgendaEmpty","CellRendererHR","CellRendererCalendarWeek","CellRendererCalendarDay","CellRendererAgendaTime"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("InfiniteListCell"),o=e("CellRendererItem"),c=e("CellRendererAgendaHeader"),l=e("CellRendererAgendaEmpty"),d=e("CellRendererHR"),h=e("CellRendererCalendarWeek"),u=e("CellRendererCalendarDay"),p=e("CellRendererAgendaTime");return a.createClass({displayName:"ReactCell",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{cell:r.PropTypes.instanceOf(s).isRequired},init:function(){this.DISABLE_LISTENER_ASSERT=!0,this.allowTransition=this.props.pane.supportCellTransition&&this.props.cell.isLive,this.createObservables({isHoveredLong:!1}),this.props.list.listen("reMount",this.reMount)},areStatesEqual:function(e,t,i){var n=this.props.cell.isLive&&this._getRenderer();if(n&&n.areStatesEqual)return n.areStatesEqual(e,t,i)},getState:function(e){var i,n=e.cell,r=n.paneObject,a=r;n.isLive&&(i=this._getRenderer(),a=this._getRenderObj());var s={isLive:n.isLive,item:a,index:n.index,height:n.height,offset:n.offset,prevOffset:n.prevOffset,renderer:i,offsetX:n.offsetX,isAnimatingOffsetX:n.isAnimatingOffsetX,faded:!1};return n.isLive&&i&&i.getState&&(s=t.extend(s,i.getState(this,a,n.index,this.props))),s},componentDidMount:function(){this.listenTo(this.props.cell.cellChanged,!1),t.setReactCell(this,this.__id),this._onMount()},onBeforeChanged:function(e,t){this.allowTransition=this.props.pane.supportCellTransition&&e.isLive&&this.props.cell.wasLive,n.mobile||this.props.pane.type===PaneMode.Timeline&&e.isHovered!==t.isHovered&&(e.isHovered?setTimeout(function(){this.state.isHovered&&this.isHoveredLong.set(!0)}.bind(this),i.TooltipDelay):(this.isHoveredLong.set(!1,!1),e.isHoveredLong=!1))},componentDidUpdate:function(e,t){var i=this.state,n=i.item,r=t.item,a=this.state.renderer;a!==t.renderer&&t.renderer&&t.renderer.onUnmount&&t.renderer.onUnmount(this,r),n!==r&&(this.needsRefresh={prevState:t},this.props.list.isDelayingMounts||this.reMount()),a&&a.onUpdate&&a.onUpdate(this,n,this.props,this.state,e,t)},_onMount:function(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onMount&&t.onMount(this,e,this.state.index,this.props,this.state)},onUnmount:function(){var e=this.state.item,i=this.state.renderer;e&&i&&i.onUnmount&&i.onUnmount(this,e,this.state.index,this.props,this.state),this.__id&&t.clearReactCell(this,this.__id)},reMount:function(){if(this.needsRefresh){var e=this.needsRefresh.prevState,t=e.item;this.refreshListeners(),t&&(this.clearData(),e.renderer&&e.renderer.onUnmount&&e.renderer.onUnmount(this,t)),this._onMount(),this.needsRefresh=void 0}},_getRenderer:function(){var e,i=this.props.cell,n=i.paneObject;return t.isVMLI(n)?e=o:"agendaItem"===n.type?e=o:"agendaHeader"===n.type?e=c:"agendaTime"===n.type?e=p:"agendaEmpty"===n.type?e=l:"hr"===n.type?e=d:"calendarWeek"===n.type?e=h:"calendarDay"===n.type&&(e=u),e},_getRenderObj:function(){var e=this.props.cell,t=e.paneObject;return"agendaItem"===t.type?t.item:t},_getCellState:function(){var e=this.state,i={cell:this.props.cell.getState(),reactCell:{item:e.item.id,index:e.index,height:e.height,offset:e.offset,prevOffset:e.prevOffset,isLive:e.isLive}};return this.refs.li&&(i.element=t.getElementPath(this.refs.li)),i},getIndex:function(){try{t.PAssert(5226,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(e){t.reportError(e)}return this.state.index},getItem:function(){try{t.PAssert(5227,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(e){t.reportError(e)}return this.state.item},getCell:function(){return this.props.cell},renderSwipeMenu:function(e,i,n){var a=this.props.pane,s={left:(n>0?"-":"")+"100%"},o={},c=a.sizeOfItem(e,i),l=a.getSwipeMenuItem(e,n);if(l){o[n>0?"right":"left"]=16;var d=t.isFunction(l.icon)?l.icon(e):l.icon,h=t.isFunction(l.color)?l.color(e):l.color,u=t.isFunction(l.text)?l.text(e):l.text;s.background=h,c<44&&(s.height=44,s.marginTop=-(44-c)/2);var p={float:n<0?"right":"left",padding:n<0?"0 0 0 16px":"0 16px 0 0"};return r.createElement("div",{className:"itemSwipeMenu",style:s},d&&r.createElement("div",{className:"itemSwipeIcon",style:o},r.createElement("i",{className:d}),r.createElement("span",{style:p},u)))}},render:function(){var e=this.props,a=this.state,s=a.isLive?a.offset:-1e3,o=this.getUniqueID(),c=a.renderer,l=t.vmMain.getItemAnimationMode(),d={height:a.height},h=t.classNames({transition:this.allowTransition&&l!==i.ItemAnimationMode.None});if(a.offsetX?d[n.transform.react]="translate3d("+a.offsetX+"px,"+s+"px,0)":(a.isAnimatingOffsetX&&(d[n.transition.react]=n.transform.style+" 0.15s"),e.orientation===i.Orientation.Horizontal?d[n.transform.react]="translate("+s+"px,0)":d[n.transform.react]="translate(0,"+s+"px)"),c&&a.isLive){var u=!!a.offsetX;return c.render(this,o,a.item,a.index,e,a,d,h,u&&this.renderSwipeMenu(a.item,a.index,a.offsetX))}return r.createElement("li",{"data-moo-id":o,className:"itemdead",style:d})}})}),define("ReactFormattingToolbar",["require","globals","platform","Constants","react","Sel","MooReact","Components/FancyButton"],function(e){var t=e("globals"),i=e("platform"),n=e("Constants"),r=e("react"),a=e("Sel"),s=e("MooReact"),o=e("Components/FancyButton");return s.createClass({displayName:"ReactFormattingToolbar",componentDisplay:n.ComponentDisplay.Desktop,getState:function(){return{position:a.itemHighlightPosition,pane:a.getPane(),numSelected:a.getSelectedItems().length}},onClickFormat:function(e){t.vmMain.applyFormatToSelection(e)},onClickPrefix:function(e){t.vmMain.applyPrefixToSelection(e)},onClickNote:function(){var e=a.getStartItem();e&&e.editNote()},onClickLink:function(){a.getStartItem().insertLinkAtSelection()},render:function(){var e=this.state,t=this.props,a=i.priModKey,s=e.position;if(e.position&&e.pane===t.pane){var c=Math.min(Math.max(Math.floor(s.x),139),e.pane.getWidth()-135-4),l={height:36,width:270,marginLeft:-135};return l[i.transform.react]="translate3d("+c+"px,"+Math.floor(s.y)+"px,0)",r.createElement("div",{className:"formattingToolbar c-popup c-bg-sidebar c-shadow-popup",style:l},r.createElement(o,{icon:"icon-format_bold",width:32,height:36,iconSize:19,onClick:this.onClickFormat.bind(this,"**"),tooltip:"Bold",tooltipHotkey:a+" + B"}),r.createElement(o,{icon:"icon-format_italic",width:32,height:36,iconSize:19,onClick:this.onClickFormat.bind(this,"*"),tooltip:"Italic",tooltipHotkey:a+" + I"}),r.createElement("div",{className:"divider"}),r.createElement(o,{icon:"icon-header",width:32,height:36,iconSize:15,onClick:this.onClickPrefix.bind(this,n.Prefix.Header),tooltip:"Header",tooltipHotkey:n.Prefix.Header+"&nbsp;&nbsp; Space"}),r.createElement(o,{icon:"prefixTask",width:32,height:36,iconSize:20,onClick:this.onClickPrefix.bind(this,n.Prefix.Task),tooltip:"Task",tooltipHotkey:n.Prefix.Task+"&nbsp;&nbsp; Space"}),r.createElement(o,{icon:"icon-bullet",width:32,height:36,iconSize:26,onClick:this.onClickPrefix.bind(this,n.Prefix.Bullet),tooltip:"Bulleted list",tooltipHotkey:n.Prefix.Bullet+"&nbsp;&nbsp; Space"}),r.createElement(o,{icon:"icon-numlist",width:32,height:36,iconSize:14,onClick:this.onClickPrefix.bind(this,n.Prefix.NumList),tooltip:"Numbered list",tooltipHotkey:n.Prefix.NumList+"&nbsp;&nbsp; Space"}),r.createElement("div",{className:"divider"}),r.createElement(o,{icon:"icon-link",enabled:1===e.numSelected,width:32,height:36,iconSize:18,onClick:this.onClickLink,tooltip:"Create link",tooltipHotkey:a+" + K"}),r.createElement(o,{icon:"icon-sticky-note-o",enabled:1===e.numSelected,width:32,height:36,iconSize:14,onClick:this.onClickNote,tooltip:"Add note",tooltipHotkey:"Shift + Enter"}))}return null}})}),define("ReactPane",["require","globals","Constants","platform","react","MooReact","util","Components/DivX","VMPane","Dispatcher","DragDrop","MobileUI","ReactWrapper","ReactPaneHeader","ReactInfiniteList","ReactCaret","ReactCell","ReactFormattingToolbar","Components/FancyScroller","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=(e("util"),e("Components/DivX")),o=e("VMPane"),c=e("Dispatcher"),l=e("DragDrop"),d=e("MobileUI"),h=e("ReactWrapper"),u=e("ReactPaneHeader"),p=e("ReactInfiniteList"),m=e("ReactCaret"),f=e("ReactCell"),g=e("ReactFormattingToolbar"),v=e("Components/FancyScroller"),y=e("Components/FancyButton");return a.createClass({displayName:"ReactPane",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{pane:r.PropTypes.instanceOf(o).isRequired},init:function(){this.props.pane.isDefaultPane;this.createObservables({dragOffset:0})},componentDidMount:function(){var e=this.props.pane,i=e.scrollElement=this.refs.scroller.getScrollElement(),r=e.rootElement=this.refElement("rootElement"),a=e.paneContent=this.refElement("contentElement"),s=e.getInfiniteList(!1);e.element=this.refs.pane,s.setupScroller(i,a),n.mobile||s.setScrollHandler(this.onScroll),r.addEventListener("compositionstart",e.compositionStart),r.addEventListener("compositionend",e.compositionEnd),n.android||r.addEventListener("input",e.onInput),this.setData(e.element,e),t.setupClick(this.refs.scroller.getElement(),e,e.onTap),e.onLoad(),e.getOverview().onPaneLoad(),c.fireEvent("paneAdded",[e])},getState:function(){var e,i=this.props,r=i.pane;return r.isDestroyed()?e={}:(e={rect:r.rect,left:r.getLeft(),isExpanded:!n.mobile&&r.isExpanded,isActive:r.isActive,isOverviewVisible:r.overview.isVisible,isHelpVisible:!!t.intro&&t.intro.isVisible,item:r.item,paneTopText:r.paneTopText,orientation:r.orientation,showScrollbars:r.showScrollbars},n.mobile?(e.numComplete=r.numCompleteItems,e.bottomBarHeight=d.bottomBarHeight):e.parents=r.getItem().parents()),e},itemsObs:function(){return this.props.pane.items},getScrollSize:function(){return this.props.pane.getInfiniteList(!1).getScrollSize()},getClientHeight:function(){return this.props.pane.getHeight()},getScrollTop:function(){return this.props.pane.getInfiniteList(!1).getScrollTop()},onScroll:function(){this.refs.scroller&&this.refs.scroller.handleScroll()},startDragging:function(e){t.hasClass(e.target,"paneDraggable")&&t.vmMain.paneManager.paneCount()>1&&(this.hasMovedDrag=!1,this.dragStartX=e.clientX-this.props.pane.rect.get().left,document.addEventListener("mousemove",this.onDragMove),document.addEventListener("mouseup",this.onDragUp))},onDragMove:function(e){this.hasMovedDrag||(this.hasMovedDrag=!0,l.isDraggingPane.set(!0),t.addClass(this.refs.pane,"dragging"));var i=this.props.pane.rect.get(),n=e.clientX-this.dragStartX-i.left;this.updateDragOffset(n),t.vmMain.paneManager.dragPaneTo(this.props.pane,i.left+n,i.right+n)&&this.updateDragOffset(e.clientX-this.dragStartX-this.props.pane.rect.get().left)},onDragUp:function(){l.isDraggingPane.set(!1),t.removeClass(this.refs.pane,"dragging"),document.removeEventListener("mousemove",this.onDragMove),document.removeEventListener("mouseup",this.onDragUp),this.updateDragOffset(0)},updateDragOffset:function(e){this.dragOffset.set(e)},renderScrollerWrapper:function(e,t){if(n.mobile){var i={position:"relative"},a=e.offsetX;return a&&(i[n.transform.react]="translate3d("+a+"px,0,0)"),this.props.pane.isAnimatingOffset&&(i[n.transition.react]=n.transform.style+" 0.15s"),r.createElement("div",{className:"paneScrollerWrapper f1 flexbox flexvert",style:i},t.children)}return r.createElement("span",null,t.children)},onTouchMove:function(e){},onClickAddHeader:function(e){this.props.pane.onTapAddItem(e,i.Prefix.Header+" ")},onClickAddTask:function(e){this.props.pane.onTapAddItem(e,i.Prefix.Task+" ")},onClickAddItem:function(e){this.props.pane.onTapAddItem(e)},onMouseMovePaneBlocker:function(e){d.update(e)},onMouseUpPaneBlocker:function(e){d.end(e)},onClickPaneBlocker:function(e){d.onClickPane(e)},renderCell:function(e,t){var i=this.props.pane;return r.createElement(f,{key:e,list:i.getInfiniteList(!1),pane:i,orientation:this.state.orientation,cell:t})},render:function(){var e,a=this.props,o=this.state,c=a.pane,l=t.classNames("pane c-border-pane",c.paneClass,a.className,{overviewOpen:o.isOverviewVisible},{expanded:o.isExpanded},{none:!o.isActive},{hasTitles:!n.mobile&&o.parents.length>0},{horizontal:o.orientation===i.Orientation.Horizontal},{vertical:o.orientation!==i.Orientation.Horizontal},{"flexbox flexvert":n.mobile}),d=t.classNames("paneScroller c-background",{customScroller:c.useCustomScroller},"f1"),f=t.classNames("paneRoot"),b=t.classNames("paneContent",{editable:c.isWriteable});c.topBoxHeight.get()>0&&(!n.mobile&&c.isWriteable&&c.canAddItem?e=r.createElement("div",{className:"flexbox flex-center addItemButton addItemsMarkdown c-border-light c-foreground-ultra-faded"},r.createElement(y,{iconSize:20,onClick:this.onClickAddHeader},"Add Header"),r.createElement(y,{iconSize:20,onClick:this.onClickAddTask},"Add Task"),r.createElement(y,{iconSize:20,onClick:this.onClickAddItem},"Add Item")):o.paneTopText&&(e=r.createElement("span",{className:"loadingText"},o.paneTopText)));var S,E=r.createElement(p,{owner:c.getInfiniteList(!1),pane:c,overview:!1,renderCell:this.renderCell,itemsObs:a.itemsObs,hiddenInput:!n.mobile,contentClass:b,minItemHeight:a.minItemHeight,orientation:o.orientation,welcome:this.getChildByKey("welcome"),ref:"contentElement"},c.topBoxHeight.get()>0&&r.createElement("div",{key:"topBox",className:"paneTopBox c-background"},e)),C=!n.mobile&&c.isWriteable?r.createElement(m,{pane:c}):null,P=o.rect,T={width:P.width};n.mobile?(T.left=o.left,S={marginBottom:o.bottomBarHeight}):n.isFirefox&&!t.isRunningScript()?(T.left=o.left,o.dragOffset&&(T[n.transform.react]="translate3d("+o.dragOffset+"px,0,0)")):T[n.transform.react]="translate3d("+Math.round(o.left+(o.dragOffset||0))+"px,0,0)";var D={};return n.mobile&&(D.offsetX=c.offsetX),r.createElement("div",{key:"pane","data-moo-id":this.getUniqueID(),ref:"pane",className:l,style:T},r.createElement(h,{observe:D,render:this.renderScrollerWrapper},r.createElement(u,{pane:c,startDragging:this.startDragging},this.getChildByKey("headerButtons")),r.createElement(v,{className:d,style:S,getScrollSize:this.getScrollHeight,getClientHeight:this.getClientHeight,getScrollTop:this.getScrollTop,noOwnScroll:!0,orientation:o.orientation,showScrollbars:o.showScrollbars,ref:"scroller"},r.createElement("div",{className:f,ref:"rootElement",onTouchMove:this.onTouchMove},E,C,!n.mobile&&r.createElement(g,{pane:c}))),o.isOverviewVisible&&r.createElement(s,{className:"paneClickBlocker",onMouseMove:this.onMouseMovePaneBlocker,onClick:this.onClickPaneBlocker,onMouseUp:this.onMouseUpPaneBlocker})),this.getChildByKey("topButtons"),this.getChildByKey("overlay"))}})}),define("ReactPaneList",["require","globals","Constants","platform","react","MooReact","VMPane","ReactPane","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("VMPane"),o=e("ReactPane"),c=e("Components/FancyButton");return a.createClass({displayName:"ReactPaneList",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{pane:r.PropTypes.instanceOf(s).isRequired},getState:function(){var e=this.props.pane;return{rect:e.rect,numComplete:e.numCompleteItems,hasCollapsed:e.hasCollapsedObs,allowCollapsing:e.search._showHierarchy}},render:function(){var e=this.state,a=this.props.pane,s=e.hasCollapsed,l=(s?"Uncollapse":"Collapse")+" all items in view",d=n.secModKey+" + Shift + .",h=n.mobile?44:i.PaneHeaderButtonHeight,u=n.mobile?i.PaneHeaderRow2ButtonHeight:i.PaneHeaderButtonHeight;return r.createElement(o,{pane:a,minItemHeight:t.minItemHeight},r.createElement("div",{className:"f1",key:"headerButtons"},a.supportCollapsing&&!n.mobile&&r.createElement(c,{icon:s?"icon-caret-down":"icon-caret-right",iconSize:16,width:h,height:u,onClick:a.toggleCollapseAll.bind(a),tooltip:l,tooltipHotkey:d,enabled:e.allowCollapsing})))}})}),define("ReactDayPreview",["require","Constants","globals","react","MooReact","VMPane","ReactCalendarDay"],function(e){var t=e("Constants"),i=(e("globals"),e("react")),n=e("MooReact"),r=e("VMPane"),a=e("ReactCalendarDay");return n.createClass({displayName:"ReactDayPreview",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{pane:i.PropTypes.instanceOf(r).isRequired,date:i.PropTypes.instanceOf(Date)},getState:function(){return{paneItems:this.props.pane.items}},onMouseEnter:function(){this.props.pane.retainOverlayAfterDrop.set(!0)},onMouseLeave:function(){this.props.pane.retainOverlayAfterDrop.set(!1)},render:function(){var e=this.props,t=e.pane,n=e.date,r=t.getItemsOnDay(n);return i.createElement("div",{className:"dayPreviewWrapper popup",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},i.createElement(a,{component:"div",className:"inDayPreview flexbox flexvert",date:n,items:r,pane:t,inDayPreview:!0}))}})}),
define("ReactAgendaOverlay",["require","Constants","globals","International","react","MooReact","VMPane","DragDrop","ReactDayPreview","Components/FancyScroller"],function(e){var t=e("Constants"),i=e("globals"),n=e("International"),r=e("react"),a=e("MooReact"),s=e("VMPane"),o=e("DragDrop"),c=e("ReactDayPreview"),l=e("Components/FancyScroller");return a.createClass({displayName:"ReactAgendaOverlay",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{pane:r.PropTypes.instanceOf(s).isRequired},init:function(){this.listenToDispatcher("windowResize"),this.props.pane.dragHoveredBlock.listen(this.onDragHoveredBlockChanged),this.createObservables({hoveredDate:null}),this.hoveredDate.listen(function(e){this.hoveredDateIsDate=i.isDateValid(e)}.bind(this))},getState:function(){return{paneIsBig:this.props.pane.getWidth()>520}},componentDidMount:function(){var e=this.props.pane;i.setupClick(this.refs.element,e,e.onTap)},onDragHoveredBlockChanged:function(e){e?e.isDate?this.hoveredDate.set(e.date):this.hoveredDate.set(e.text):this.hoveredDate.set(null)},onMouseEnterDate:function(e,t){this.props.pane.revertDrag(),this.hoveredDate.set(e);var n={};t?i.isString(e)?(n.date=e.toLowerCase(),n.isDate=!0):(n.date=e,n.isDate=!0):"STARRED"===e?n.isStarred=!0:n[e]=e,o.setAgendaInfo(n)},onMouseLeave:function(){this.hoveredDate.set(null),this.props.pane.revertDrag()},renderDate:function(e,t,n,a){var s=this.state,o=i.isDateValid(t),c=s.hoveredDate;return c&&(o&&this.hoveredDateIsDate?t.equals(c):t===c)&&(n+=" hovered"),r.createElement("div",{key:e,className:n,onMouseEnter:this.onMouseEnterDate.bind(this,t,a&&t)},a)},render:function(){var e,t,i=this.state,a=this.props.pane,s=[this.renderDate(0,Date.today(),"today","TODAY")];for(e=1;e<30;e++)t=Date.today().addDays(e),s.push(this.renderDate(e,t,"",t.toString(n.getFormat(DFormat.DayDate))));var o=["NOW","NEXT","SOON","LATER"];i.paneIsBig&&o.push("SOMEDAY");var d=[];for(e=0;e<o.length;e++)t=o[e],d.push(this.renderDate(t,t,"soft "+t,t));var h=["STARRED","p0","p1","p2"];for(e=0;e<h.length;e++)t=h[e],d.push(this.renderDate(t,t,t,!1));var u;return i.hoveredDate&&this.hoveredDateIsDate&&(u=r.createElement(c,{date:i.hoveredDate,pane:a})),r.createElement("div",{className:"paneOverlay agendaOverlay flexbox noSelect",onMouseLeave:this.onMouseLeave,ref:"element"},r.createElement("div",{className:"agendaOverlayLeft f1 flexbox"},r.createElement("div",{className:"agendaOverlaySoftDates flexbox"},d),r.createElement("div",{className:"agendaOverlaySpacer"}),u),r.createElement(l,{className:"agendaOverlayDates"},s))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("Components/FancyCalendarDayButton",["require","Constants","globals","react","MooReact","Components/FancyButton"],function(e){var t=e("Constants"),i=(e("globals"),e("react")),n=e("MooReact"),r=e("Components/FancyButton");return n.createClass({displayName:"FancyCalendarDayButton",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{day:i.PropTypes.number.isRequired},render:function(){return i.createElement(r,_extends({},this.props,{className:"fancyCalendarDayButton",padding:0,tooltip:"Jump to Today",icon:"icon-calendar-o",center:!0}),this.props.day)}})}),define("ReactPaneCalendar",["require","Constants","globals","react","MooReact","platform","VMPane","PluginSettings","ReactPane","ReactAgendaOverlay","ReactCalendarTimes","Components/FancyContextMenu","Components/FancyContextMenuItem","Components/FancyCalendarDayButton","Components/FancyButton"],function(e){var t=e("Constants"),i=e("globals"),n=e("react"),r=e("MooReact"),a=e("platform"),s=e("VMPane"),o=e("PluginSettings"),c=e("ReactPane"),l=e("ReactAgendaOverlay"),d=e("ReactCalendarTimes"),h=e("Components/FancyContextMenu"),u=e("Components/FancyContextMenuItem"),p=e("Components/FancyCalendarDayButton"),m=e("Components/FancyButton");return r.createClass({displayName:"ReactPaneCalendar",componentDisplay:t.ComponentDisplay.Everywhere,propTypes:{pane:n.PropTypes.instanceOf(s).isRequired},init:function(){this.listenToDispatcher("dateChanged");var e=i.vmMain.pluginManager.getPlugin(PluginID.GCalendar);e.onSettingChanged(e.Settings.IsEnabled,this.updateState),this.listenToSetting(Settings.dayWeekStart)},getState:function(){var e=this.props.pane,t=i.vmMain.pluginManager.getPlugin(PluginID.GCalendar);return{rect:e.rect,hasPremiumFeatures:i.billingManager.hasPremiumFeaturesObservable,viewMode:e.viewMode,isShowingOverlay:e.isShowingOverlay,numComplete:e.numCompleteItems,displayCalendars:e.displayCalendars,displayLocalItems:e.displayLocalItems,date:(new Date).getDate(),isGCalEnabled:t.isEnabled(),calendars:o.GCalendarsAvailable,dayWeekStart:i.settings.get(Settings.dayWeekStart)}},onClickViewMode:function(e){var n=this.props.pane;i.vmMain.setItemAnimationMode(t.ItemAnimationMode.None),n.viewMode.set(e),a.mobile?i.vmMain.resetItemAnimationMode():(n.scrollToToday(ScrollDuration.Snap),requestAnimationFrame(function(){n.viewMode.get()===e&&(n.scrollToToday(ScrollDuration.Snap),i.vmMain.resetItemAnimationMode())}))},onClickToday:function(){this.props.pane.scrollToToday(ScrollDuration.Default)},onClickJumpBack:function(){this.props.pane.scrollJump(-1,ScrollDuration.Default)},onClickJumpForward:function(){this.props.pane.scrollJump(1,ScrollDuration.Default)},onClickModeButton:function(e){i.menus.openContextMenuReact({fn:this.renderContextMenuMode,element:e.target,pane:this.props.pane})},onClickSelectCalendars:function(e){i.menus.openContextMenuReact({componentName:"ReactContextMenuCalendars",element:e.target,pane:this.props.pane})},renderContextMenuItem:function(e){return n.createElement(u,{onClick:this.onClickViewMode.bind(this,e),selected:e===this.state.viewMode},e)},renderContextMenuMode:function(e){return n.createElement(h,{key:"contextMenuCalendarMode",id:"contextMenuCalendarMode",element:e.element},this.renderContextMenuItem(t.CalendarViewMode.Agenda),this.renderContextMenuItem(t.CalendarViewMode.Day),this.renderContextMenuItem(t.CalendarViewMode.Week),this.renderContextMenuItem(t.CalendarViewMode.Month))},renderHeaderButton:function(e,t){var r=e!==this.state.viewMode?{fontWeight:"normal",lineHeight:"28px"}:void 0,a=i.classNames({"selected c-foreground c-bg-faded":e===this.state.viewMode});return n.createElement(m,{key:e,className:a,height:26,width:t,padding:0,style:r,onClick:this.onClickViewMode.bind(this,e)},e)},render:function(){var e,r,s,o=this.state,h=this.props.pane,u=this.state.viewMode,f=o.rect.width>550,g=i.classNames("calendar"+u+"View",{showingButtons:o.hasPremiumFeatures});if(!a.mobile){u===t.CalendarViewMode.Agenda?this.state.isShowingOverlay&&!i.isDemoRunning&&(r=n.createElement(l,{key:"overlay",pane:h})):r=u===t.CalendarViewMode.Month?n.createElement("div",{className:"calendarMonthDays c-background c-border-heavy flexbox",key:"overlay"},0===o.dayWeekStart&&n.createElement("div",null,"SUN"),n.createElement("div",null,"MON"),n.createElement("div",null,"TUE"),n.createElement("div",null,"WED"),n.createElement("div",null,"THU"),n.createElement("div",null,"FRI"),n.createElement("div",null,"SAT"),1===o.dayWeekStart&&n.createElement("div",null,"SUN")):n.createElement(d,{pane:h,key:"overlay",trackPane:!0,showAllDay:!0});var v=i.classNames("calendarNavButtons noShrink c-border",{showBorder:o.hasPremiumFeatures});e=n.createElement(p,{day:this.state.date,height:26,onClick:this.onClickToday,width:30});var y,b=o.hasPremiumFeatures&&!a.mobile&&n.createElement("div",{className:"calendarModeButtons noShrink c-border"},this.renderHeaderButton(t.CalendarViewMode.Agenda,64),this.renderHeaderButton(t.CalendarViewMode.Day,41),this.renderHeaderButton(t.CalendarViewMode.Week,49),this.renderHeaderButton(t.CalendarViewMode.Month,54));if(o.isGCalEnabled>0){var S=o.displayCalendars,E=!o.displayLocalItems;for(var C in S)if(S.hasOwnProperty(C)&&!1===S[C]){E=!0;break}var P=i.classNames("buttonCalendars headerButton c-border",{"selected c-foreground c-bg-faded":E});y=n.createElement(m,{className:P,height:26,onClick:this.onClickSelectCalendars,padding:8,tooltip:"Select calendars to display in this pane"},"Calendars",n.createElement("i",{className:"icon-caret-down"}))}s=o.hasPremiumFeatures&&n.createElement("div",{key:"topButtons",className:"calendarButtons c-background"},n.createElement("div",{className:v},n.createElement(m,{icon:"icon-caret-left",width:f?20:14,height:26,onClick:this.onClickJumpBack,enabled:u!==t.CalendarViewMode.Agenda,tooltip:"Previous "+u}),e,n.createElement(m,{icon:"icon-caret-right",width:f?20:14,height:26,onClick:this.onClickJumpForward,enabled:u!==t.CalendarViewMode.Agenda,tooltip:"Next "+u})),b,y)}return n.createElement(c,{pane:h,itemsObs:this.itemsObs,className:g,minItemHeight:20},s,r)}})}),define("plugins/ReactPaneGmail",["require","globals","Constants","platform","react","MooReact","VMPane","EmailPreview","ReactPane","Components/FancyContextMenu","Components/FancyContextMenuHeader","Components/FancyContextMenuItem","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("VMPane"),o=e("EmailPreview"),c=e("ReactPane"),l=e("Components/FancyContextMenu"),d=e("Components/FancyContextMenuHeader"),h=e("Components/FancyContextMenuItem"),u=e("Components/FancyButton");return a.createClass({displayName:"ReactPaneGmail",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{pane:r.PropTypes.instanceOf(s).isRequired},componentDidMount:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){var e=this.props.pane;return e.isDestroyed()?{}:{rootItem:e.item,messages:o.messages,isActivePane:o.activePane===e,searchCategory:e.search.getFilter("category"),sortType:e.sortType}},onClickCategoryButton:function(e){t.menus.openContextMenuReact({fn:this.renderContextMenuCategory,element:e.target})},onHoldSortButton:function(e){t.menus.openContextMenuReact({fn:this.renderContextMenuSort,element:e.target})},onClickSortButton:function(){var e=this.props.pane,n=e.sortType.get()===i.GmailSortType.Priority?i.GmailSortType.TimeReceived:i.GmailSortType.Priority;this.switchSort(n),t.menus.closeContextMenuReact()},switchCategory:function(e){this.props.pane.search.setFilter("category","All"===e?"":e)},switchSort:function(e){var t=this.props.pane;t.sortType.set(e),t.updateItems(!1,!0)},renderContextMenuCategory:function(e){for(var t=this.props.pane,i=t.plugin,n=i.getDefaultAccount(),a=["All Categories",i.SystemLabels.CATEGORY_PERSONAL,i.SystemLabels.CATEGORY_SOCIAL,i.SystemLabels.CATEGORY_PROMOTIONS,i.SystemLabels.CATEGORY_UPDATES,i.SystemLabels.CATEGORY_FORUMS],s=[],o=0;o<a.length;o++){var c,d=a[o];if("All"===d)c=d;else{c=i._getLabelByID(n,d).getDisplayText()}s.push(r.createElement(h,{key:o,onClick:this.switchCategory.bind(this,c)},c))}return r.createElement(l,{key:"contextMenuGmailCategory",id:"contextMenuGmailCategory",element:e.element},s)},renderContextMenuSort:function(e){return r.createElement(l,{key:"contextMenuGmailCategory",id:"contextMenuGmailCategory",element:e.element},r.createElement(d,null,"Sort by"),r.createElement(h,{icon:"icon-access_time",onClick:this.switchSort.bind(this,i.GmailSortType.TimeReceived)},i.GmailSortType.TimeReceived),r.createElement(h,{icon:"icon-exclamation",onClick:this.switchSort.bind(this,i.GmailSortType.Priority)},i.GmailSortType.Priority))},renderSortButton:function(){var e="Time"===this.state.sortType?"icon-access_time":"icon-exclamation";return n.mobile?r.createElement(u,{key:"sort",tooltip:"Sort Order",icon:e,width:44,height:i.PaneHeaderRow2ButtonHeight,onClick:this.onClickSortButton}):r.createElement(u,{key:"sort",tooltip:"Sort Order",icon:e,height:i.PaneHeaderButtonHeight,onHold:this.onHoldSortButton,onClick:this.onClickSortButton})},render:function(){var e=this.props.pane,i=e.plugin,n=e.getActualPaneItem();i.getLabelForVMLI(n);return r.createElement(c,{key:"pane",pane:this.props.pane,minItemHeight:t.minItemHeight},r.createElement("div",{key:"headerButtons"},this.renderSortButton()))}})}),define("ReactDragDrop",["require","globals","Constants","platform","react","MooReact","DragDrop","ReactItem","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("DragDrop"),o=e("ReactItem"),c=e("Components/FancyButton");return a.createClass({displayName:"ReactDragDrop",componentDisplay:i.ComponentDisplay.Everywhere,getState:function(){var e=s,i=t.vmMain.paneManager,r={items:e.draggingItems,activePane:e.activePane,pane:e.startPane,position:e.position,transform:e.transform,isDragging:e.isVisible,linePosition:e.linePosition,fromOverview:e.fromOverview,dropBucketItems:t.vmMain.dropBucket.getItems(),onlineText:t.vmMain.onlineText(),contextMenus:t.menus.contextMenuStack};if(n.mobile){r.draggingToOutline=e.draggingToOutline,r.dragTargetHovered=e.dragTargetHovered,r.mobilePaneSelected=i.mobilePaneSelected;var a=e.startPane&&e.dragItem&&e.startPane.sizeOfItem(e.dragItem);r.dropBucketTop=!t.menus.isContextMenuOpen()&&e.position&&e.position.top+a/2}return r},onClickDropBucket:function(){this.state.dropBucketItems.length>0&&t.menus.toggleContextMenuReact({componentName:"ReactContextMenuDropBucket",position:"bottom",pane:t.focusedPane})},onClickCancelDragToOutline:function(){s.stopDraggingToOutline()},render:function(){var e,i,a,s,l=this.state,d=l.pane,h=l.items;if(d&&l.isDragging){if(h&&h.length>0&&l.position&&l.transform){for(var u=n.mobile?0:-(d.getPaddingForItem(h[0],!1)-t.overviewPaddingStart),p=[],m=Math.min(h.length,10),f=0;f<m;++f)p.push(r.createElement(o,{key:"drag_"+f,pane:d,item:h[f],renderLikePane:!0,noNotes:l.fromOverview,padded:!l.fromOverview,paddingOffset:u}));var g=h.length-m;g>0&&p.push(r.createElement("div",{className:"dotdotdot",key:"dotdotdot"},"... plus "+g+" more ..."));var v=l.position,y={left:n.mobile?0:v.left-u,top:v.top,width:d.widthOfDrag(h[0]),maxWidth:d.getWidth()},b=l.transform;y[n.transform.react]="translate3d("+b.left+"px, "+b.top+"px, 0)",e=r.createElement("ul",{id:"dragUL",style:y,className:"popup c-shadow-popup c-background"},p)}if(l.linePosition&&l.activePane){var S=l.linePosition,E={width:S.width,height:S.height},C=t.classNames({isLine:!S.height});E[n.transform.react]="translate("+S.left+"px, "+S.top+"px)",i=r.createElement("div",{id:"dragLine",style:E,className:C})}s=t.classNames("from_"+d.type,l.activePane.paneClass)}var P,T,D=n.mobile&&l.isDragging&&!t.menus.isContextMenuOpen(),M=l.pane===t.focusedPane,_=l.dropBucketItems,I=l.onlineText?60:44,A={top:l.dropBucketTop,bottom:!l.dropBucketTop&&I+24},w=t.classNames("dragTarget mobileDropBucket",{showIcon:!D},{hovered:"dragToSave"===l.dragTargetHovered}),k=t.classNames("dragTarget mobileDragToOutline",{hovered:"dragToOutline"===l.dragTargetHovered});D?M&&(P=r.createElement(c,{id:"dragToSave",width:50,height:50,color:"white",iconSize:20,style:A,key:"bucket",className:w,onClick:this.onClickDropBucket},r.createElement("span",{className:"buttonText"},"Drag",r.createElement("br",null),"here",r.createElement("br",null),"to",r.createElement("br",null),"save")),d.type===PaneMode.Gmail&&(T=r.createElement("div",{id:"dragToOutline",className:k,style:A},"Drag",r.createElement("br",null),"to",r.createElement("br",null),"outline"))):_.length>0&&!t.menus.isContextMenuOpen()&&(P=r.createElement(c,{width:50,height:50,color:"white",iconSize:20,style:A,key:"bucket",className:w,onClick:this.onClickDropBucket,enabled:t.focusedPane&&t.focusedPane.type===PaneMode.Outline},r.createElement("span",{className:"bucketIcon"},r.createElement("i",{className:"icon-content_paste"}),_.length>0&&r.createElement("div",null,_.length)))),a=r.createElement("div",{className:"dragTargets"},P,T);var x=l.draggingToOutline&&r.createElement("div",{className:"draggingToOutlineArea flexbox"},r.createElement("div",{className:"f1"},"Tap a destination for this email"),r.createElement(c,{color:"white",height:60,onClick:this.onClickCancelDragToOutline},"CANCEL"));return r.createElement("div",{id:"dragdrop",className:s},e,i,x,a)}})}),define("ReactContextMenuSelectGmailAccount",["require","globals","Constants","react","MooReact","Components/FancyContextMenu","Components/FancyContextMenuItem","Components/FancyContextMenuHeader"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Components/FancyContextMenu"),s=e("Components/FancyContextMenuItem"),o=e("Components/FancyContextMenuHeader");return r.createClass({displayName:"ReactContextMenuSelectGmailAccount",componentDisplay:i.ComponentDisplay.Everywhere,addPane:function(e){t.vmMain.paneManager.addPaneByButton(PaneMode.Gmail,e)},render:function(){var e=this,i=t.vmMain.pluginManager.getPlugin(PluginID.Gmail),r=i.getSyncAccounts();return n.createElement(a,{key:"contextMenuTitle",id:"contextMenuTitle",element:this.props.element,maxHeight:400},n.createElement(o,null,"Open Gmail Account"),r.map(function(t){var r=i.getDefaultDisplayItem(t);return n.createElement(s,{key:t,onClick:e.addPane.bind(e,r)},t)}))}})}),define("ReactContextMenuAddItem",["require","globals","Constants","react","MooReact","Components/FancyContextMenu","Components/FancyContextMenuItem","Components/FancyContextMenuHeader"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Components/FancyContextMenu"),s=e("Components/FancyContextMenuItem");e("Components/FancyContextMenuHeader");return r.createClass({displayName:"ReactContextMenuAddItem",componentDisplay:i.ComponentDisplay.Desktop,onClickPrefix:function(e){t.vmMain.applyPrefixToSelection(e,this.props.item)},onClickHR:function(){this.props.item.setText("---",!0,ChangeType.Local)},render:function(){return n.createElement(a,{key:"contextMenuAddItem",id:"contextMenuAddItem",element:this.props.element},n.createElement(s,{icon:"icon-header",hotkey:i.Prefix.Header+" Space",onClick:this.onClickPrefix.bind(this,i.Prefix.Header)},"Header"),n.createElement(s,{icon:"icon-check",hotkey:i.Prefix.Task+" Space",onClick:this.onClickPrefix.bind(this,i.Prefix.Task)},"Task"),n.createElement(s,{icon:"icon-bullet",hotkey:i.Prefix.Bullet+" Space",onClick:this.onClickPrefix.bind(this,i.Prefix.Bullet)},"Bullet"),n.createElement(s,{icon:"icon-numlist",hotkey:i.Prefix.NumList+" Space",iconSize:14,onClick:this.onClickPrefix.bind(this,i.Prefix.NumList)},"Numbered List"),n.createElement(s,{icon:"icon-hr",hotkey:"---",iconSize:14,onClick:this.onClickHR},"Horizontal Line"))}})}),define("Components/FancyCheckbox",["require","globals","Constants","platform","react","Observable","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("Observable");return e("MooReact").createClass({displayName:"FancyCheckbox",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{id:r.PropTypes.string,onChange:r.PropTypes.func,className:r.PropTypes.string,checked:r.PropTypes.oneOfType([r.PropTypes.bool,a]),radio:r.PropTypes.bool,error:r.PropTypes.bool,disabed:r.PropTypes.bool,canChange:r.PropTypes.bool},init:function(){var e={animCheck:!1};this.props.checked instanceof a?(this.checked=this.props.checked,this.trackObservable=!0):e.checked=this.props.checked||this.props.initialChecked,this.createObservables(e)},getState:function(){return this.trackObservable?{checked:this.checked}:{}},onClick:function(){var e=this.props;if(!e.disabled){this.animCheck.set(!0),setTimeout(function(){this.animCheck.set(!1)}.bind(this),300);var t=!this.checked.get();this.trackObservable&&!e.setObs||this.checked.set(t),e.onChange&&e.onChange(t)}e.onClick&&e.onClick(t)},getValue:function(){return this.checked.get()},setValue:function(e){return this.checked.set(e)},resetValue:function(){void 0!==this.props.initialChecked&&this.checked.set(this.props.initialChecked)},onKeyDown:function(e){e.keyCode===KeyCode.Enter&&this.onClick(e)},onChangeInput:function(){},componentWillReceiveProps:function(e){this.trackObservable||void 0===e.checked||e.checked===this.state.checked||this.checked.set(e.checked)},render:function(){var e=this.props,i=this.state.checked,a={background:i&&e.checkedColor,width:e.size,height:e.size,lineHeight:e.size&&e.size-1+"px",fontSize:e.size&&e.size-4+"px"};this.isTrackingObservable&&(i=i.get());var s=t.classNames("fancyCheckbox",{flexbox:n.mobile},{checked:i},{disabled:e.disabled},{animate:this.state.animCheck},{radio:e.radio},{error:e.error},{noBG:e.noBG},e.className),o=t.classNames("fancyCheckboxText",{f1:n.mobile}),c=t.classNames("fancyCheckboxCheck",{"c-button-raised-primary":i}),l=r.createElement("span",{className:c,style:a});return r.createElement("span",{className:s,onClick:!1!==e.canChange&&this.onClick,id:e.id,style:e.style,tabIndex:e.tabIndex,onKeyDown:this.onKeyDown},r.createElement("input",{className:"fancyCheckboxInput",type:"checkbox",checked:i,onChange:this.onChangeInput}),!n.mobile&&l,this.props.children&&r.createElement("span",{className:o},this.props.children),n.mobile&&l)}})}),define("ReactContextMenuCalendars",["require","globals","Constants","react","MooReact","tracker","Components/FancyButton","Components/FancyCheckbox","Components/FancyContextMenu","Components/FancyContextMenuHeader","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("tracker"),s=e("Components/FancyButton"),o=e("Components/FancyCheckbox"),c=e("Components/FancyContextMenu"),l=e("Components/FancyContextMenuHeader"),d=e("Components/FancyContextMenuItem");return r.createClass({displayName:"ReactContextMenuCalendars",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.createObservables({anyCalendarsSync:this.computeAnyCalendarsSync()}),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenCalendarsMenu})},getState:function(){var e=this.props.pane;return{displayCalendars:e.displayCalendars,displayLocalItems:e.displayLocalItems}},getSyncCalendars:function(){return t.vmMain.pluginManager.getPlugin(PluginID.GCalendar).getImportCalendarList()},computeAnyCalendarsSync:function(){for(var e=this.props.pane,t=e.displayCalendars.get(),i=this.getSyncCalendars(),n=0,r=0;r<i.length;r++)!1!==t[i[r].id]&&n++;return n>0},onChangeDisplayCalendar:function(e,t){this.props.pane.setDisplayCalendar(e,t),this.anyCalendarsSync.set(this.computeAnyCalendarsSync())},onChangeDisplayLocal:function(e){this.props.pane.setDisplayLocal(e)},onChangeAllCalendars:function(e){for(var t=this.props.pane,i=this.getSyncCalendars(),n=this.state.displayCalendars,r=0;r<i.length;r++){var a=i[r];n[a.id]!==e&&t.setDisplayCalendar(a,e)}},onClickAdd:function(){t.menus.closeContextMenuReact(),t.menus.openSettings(i.SettingsSections.GoogleCalendar)},render:function(){var e=this.state,i=this.props,r=t.vmMain.pluginManager.getPlugin(PluginID.GCalendar),a=this.getSyncCalendars(),h=e.displayCalendars;return n.createElement(c,{key:"contextMenuSelectCalendars",id:"contextMenuSelectCalendars",element:i.element},n.createElement(d,null,n.createElement(o,{checked:e.displayLocalItems,onChange:this.onChangeDisplayLocal},"Display local events")),n.createElement("hr",null),n.createElement(l,null,n.createElement(o,{checked:e.anyCalendarsSync,onChange:this.onChangeAllCalendars,size:14},"Google Calendars")),a&&a.map(function(e){var t=r.getCalendarBackgroundColor(e.id);return n.createElement(d,{key:e.id},n.createElement(o,{checked:!1!==h[e.id],checkedColor:t,onChange:this.onChangeDisplayCalendar.bind(this,e)},e.summary||e.id))}.bind(this)),(!a||0===a.length)&&n.createElement("div",{className:"center",style:{marginTop:8}},n.createElement(s,{raised:!0,primary:!0,onClick:this.onClickAdd},"ADD CALENDARS")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuInsertLink",["require","globals","Constants","react","MooReact","PluginSettings","Hotkeys","Components/FancyInput","Components/FancyContextMenu","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=(e("PluginSettings"),e("Hotkeys")),s=e("Components/FancyInput"),o=e("Components/FancyContextMenu"),c=e("Components/FancyButton");return r.createClass({displayName:"ReactContextMenuInsertLink",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{element:n.PropTypes.object.isRequired},init:function(){var e=this.props.text;null===new RegExp(/\S{2,}\.[^0-9.\s]{2,}\S*$/).exec(e)?this.text=e:this.link=e},getHotkeys:function(){return[a.create(KeyCode.Enter,!0,i.Primary.Either,i.Shift.Either,this.onClick),a.create(KeyCode.Escape,!0,i.Primary.Either,i.Shift.Either,this.close)]},componentDidMount:function(){var e;e=this.link||!this.text?this.refs.text:this.refs.link,e.focus(),e.selectEnd()},close:function(){t.menus.closeContextMenuReact()},onClick:function(){var e=this.refs.text.getValue(),t=this.refs.link.getValue();this.close(),e&&t&&(t.startsWith("http")||(t="http://"+t),this.props.onInsertLink({text:e,url:t}))},render:function(){return n.createElement(o,_extends({},this.props,{key:"contextMenuInsertLink",id:"contextMenuInsertLink"}),n.createElement("div",{className:"flexbox"},n.createElement("span",null,"Text"),n.createElement(s,{className:"f1",ref:"text",height:28,width:260,value:this.text})),n.createElement("div",{className:"flexbox"},n.createElement("span",null,"Link"),n.createElement(s,{className:"f1",ref:"link",height:28,width:260,value:this.link})),n.createElement("div",{className:"flexbox"},n.createElement(c,{primary:!0,raised:!0,onClick:this.onClick},"INSERT")))}})}),define("ReactContactDetails",["require","Constants","globals","react","MooReact"],function(e){var t=e("Constants"),i=e("globals"),n=e("react");return e("MooReact").createClass({displayName:"ReactContactDetails",componentDisplay:t.ComponentDisplay.Everywhere,propTypes:{contact:n.PropTypes.object.isRequired},init:function(){},onClickPhone:function(e,t){i.openUrl(e.link,t,!0)},onClickEmail:function(e,t){var n=i.vmMain.getDefaultEmailPlugin();if(n.isActive()){this.props.onClose&&this.props.onClose();var r={to:[{text:"",email:e.address}]};i.menus.openComposeEmail(n,void 0,void 0,r)}else i.openUrl(e.link,t,!0)},renderPhoneNumbers:function(e,t){return n.createElement("div",{className:"contactRow contactPhone",key:t},n.createElement("i",{className:"contactButton icon-phone"}),n.createElement("span",{className:"contactNumber link",onClick:this.onClickPhone.bind(this,e)},e.number),n.createElement("span",{className:"phoneType"},e.type))},renderEmails:function(e,t){return n.createElement("div",{className:"contactRow contactEmail",key:t},n.createElement("i",{className:"icon-envelope contactButton"}),n.createElement("span",{className:"contactInfo link",onClick:this.onClickEmail.bind(this,e)},e.address))},render:function(){var e=this.props,t=e.contact;return n.createElement("div",{className:"contactPreview"},n.createElement("div",{className:"contactName c-border"},t.text),t.phoneNumbers.map(this.renderPhoneNumbers),t.emails.map(this.renderEmails))}})}),define("ReactContextMenuContactDetails",["require","globals","Constants","react","MooReact","ReactContactDetails","Components/FancyContextMenu"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("ReactContactDetails"),s=e("Components/FancyContextMenu");return r.createClass({displayName:"ReactContextMenuContactDetails",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{contact:n.PropTypes.object.isRequired},onClose:function(){t.menus.closeContextMenuReact("ReactContextMenuContactDetails")},render:function(){return n.createElement(s,{key:"contextMenuContactDetails",id:"contextMenuContactDetails",element:this.props.element,position:this.props.position},n.createElement(a,{contact:this.props.contact,onClose:this.onClose}))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuMobileOpenLink",["require","globals","Constants","react","MooReact","VMPane","Components/DivX","Components/FancyButton","Components/FancyContextMenu","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=(e("VMPane"),e("Components/DivX"),e("Components/FancyButton")),s=e("Components/FancyContextMenu");e("Components/FancyContextMenuItem");return r.createClass({displayName:"ReactContextMenuMobileOpenLink",componentDisplay:i.ComponentDisplay.Mobile,propTypes:{onClick:n.PropTypes.func.isRequired},onClickOpen:function(){this.props.onClick(),t.menus.closeContextMenuReact()},render:function(){var e=this.props;return n.createElement(s,_extends({},e,{key:"contextMenuMobileOpenLink",id:"contextMenuMobileOpenLink",className:"flexbox"}),n.createElement("div",{className:"f1"},e.html),n.createElement(a,{primary:!0,onClick:this.onClickOpen},"OPEN"))}})}),define("Components/FancyTextarea",["require","globals","Constants","react","MooReact","platform","Hotkeys"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=(e("platform"),e("Hotkeys"));return r.createClass({displayName:"FancyTextArea",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{selectionStart:n.PropTypes.number,selectionEnd:n.PropTypes.number,spellCheck:n.PropTypes.bool,focused:n.PropTypes.bool,value:n.PropTypes.string,onFocus:n.PropTypes.func,onBlur:n.PropTypes.func,isReadOnly:n.PropTypes.bool},init:function(){this.createObservables({isFocused:this.props.focused||!1})},componentDidMount:function(){var e=this.refs.input;this.props.value&&(e.value=this.props.value),this.props.focused&&requestAnimationFrame(function(){e.focus(),void 0!==this.props.selectionStart&&(e.selectionStart=this.props.selectionStart),void 0!==this.props.selectionEnd&&(e.selectionEnd=this.props.selectionEnd),e.scrollTop=0}.bind(this))},onUnmount:function(){this.isFocused.get()&&this.onBlur()},focus:function(){this.refs.input.focus()},blur:function(){this.refs.input.blur()},getValue:function(){return this.refs.input.value},setValue:function(e){this.refs.input.value=e},getSelectionStart:function(){return this.refs.input.selectionStart},getSelectionEnd:function(){return this.refs.input.selectionEnd},onFocus:function(e){t.vmMain.activeInput.set(this),this.isFocused.set(!0),this.props.onEscape&&(this.__hotkeyEscape=a.pushStackEscape(this.handleEscapeKey)),this.props.onFocus&&this.props.onFocus(e)},onBlur:function(e){t.vmMain.activeInput.set(null),this.isFocused.set(!1),this.__hotkeyEscape&&(a.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0),this.props.onBlur&&this.props.onBlur(e)},onKeyPress:function(e){this.props.onKeyPress&&this.props.onKeyPress(e)},handleEscapeKey:function(){this.props.onEscape&&this.props.onEscape()},render:function(){var e=this.props,i=t.classNames("fancyTextarea c-background c-foreground",e.className),r=e.spellCheck?"true":null,a={fontSize:e.fontSize,height:e.height||150,margin:void 0!==e.margin?e.margin:"16px 0",overflow:e.height<=34&&"hidden"};return n.createElement("textarea",{className:i,style:a,ref:"input",readOnly:!!e.isReadOnly,spellCheck:r,onClick:e.onClick,onChange:e.onChange,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:e.onKeyDown,onKeyPress:e.onKeyPress,placeholder:e.placeholder,tabIndex:e.tabIndex})}})}),define("ReactNoteEditor",["require","Constants","globals","platform","react","MooReact","DisplaySettings","tracker","Components/FancyTextarea"],function(e){var t=e("Constants"),i=e("globals"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("DisplaySettings"),o=e("tracker"),c=e("Components/FancyTextarea");return a.createClass({displayName:"ReactNoteEditor",componentDisplay:t.ComponentDisplay.Everywhere,propTypes:{item:r.PropTypes.object.isRequired,selectionStart:r.PropTypes.number,selectionEnd:r.PropTypes.number},init:function(){var e=this.props,t=e.item.hasNote()&&e.item.getNote(),i=t?t.getParsedText():void 0;this.createObservables({hasValue:!!i})},onUnmount:function(){clearTimeout(this._noteUpdateTimeout),
this._noteUpdateTimeout=void 0,this._saveNote(),n.mobile&&i.closeKeyboard()},getValue:function(){return this.refs.noteText.getValue()},_saveNote:function(){o.beginAction(),i.vmMain.beginUpdateItems();var e=this.props.item,t=e.hasNote()&&e.getNote(),n=this.refs.noteText.getValue();!t&&n&&(t=e.createNote()),t&&(t.setText(n,!0,ChangeType.Local),n||e.setNote(void 0,ChangeType.Local)),i.vmMain.commitUpdateItems(),o.endAction()},onChange:function(){var e=this.refs.noteText.getValue().length>0;e!==this.hasValue.get()&&(this.hasValue.set(e),e&&this.props.onValueSet&&requestAnimationFrame(this.props.onValueSet,0)),clearTimeout(this._noteUpdateTimeout),this._noteUpdateTimeout=setTimeout(this._saveNote,8e3)},render:function(){var e=this.props,t=s.fontSize(),i=e.item.hasNote()&&e.item.getNote(),n=i?i.getParsedText():void 0,a=i?void 0:"Add note",o=this.state.hasValue?e.heightValue:e.heightEmpty,l=!e.item.canHaveNote();return r.createElement(c,{ref:"noteText",className:e.className,value:n,placeholder:a,focused:e.focused,onChange:this.onChange,onKeyDown:e.onKeyDown,onKeyPress:e.onKeyPress,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,fontSize:t,margin:0,height:o,tabIndex:e.tabIndex,isReadOnly:l})}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactNotePopup",["require","globals","Constants","react","MooReact","Sel","platform","Dispatcher","ReactNoteEditor","Components/FancyContextMenu"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Sel"),s=e("platform"),o=e("Dispatcher"),c=e("ReactNoteEditor"),l=e("Components/FancyContextMenu");return r.createClass({displayName:"ReactNotePopup",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{element:n.PropTypes.object.isRequired,item:n.PropTypes.object.isRequired,pane:n.PropTypes.object.isRequired,selectionStart:n.PropTypes.number,selectionEnd:n.PropTypes.number},componentDidMount:function(){s.mobile||o.listen("windowResize",this.onResize)},onResize:function(){this.updateState(),setTimeout(function(){this.refs.menu.updateState()}.bind(this),300)},onUnmount:function(){var e=this.props.item;s.mobile||o.unlisten("windowResize",this.onResize),a.selectIndex(this.props.index-1,e.getParsedText().length),s.mobile&&t.keyboardToolbar.show(i.KeyboardToolbarMode.Item)},onKeyPress:function(e){s.getKeyCode(e)!==KeyCode.Enter||!e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||(t.menus.closeContextMenuReact(),e.preventDefault(),e.stopPropagation())},getState:function(){return{maxWidth:this.props.pane.getWidth()-20}},render:function(){var e=this.props,t=this.state.maxWidth,i=s.mobile&&e.bottom;return n.createElement(l,_extends({},this.props,{key:e.note.id+"_Note",id:"contextMenuNote",width:600,maxWidth:t,bottom:i,ref:"menu"}),n.createElement(c,{ref:"noteText",item:e.item,focused:!0,onKeyPress:this.onKeyPress,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd}))}})}),define("VMPane_Autocomplete",["require","globals","util","VMPane"],function(e){function t(){var e={id:"paneAutocomplete",rect:{width:400}};this._super.constructor.call(this,e)}var i=(e("globals"),e("util")),n=e("VMPane"),r={getPaddingForItem:function(e,t){return 0},maxWidthOfItem:function(e,t){this.getPaddingForItem(e,t);return this.getWidth()}};return i.inherit(n,t),i.extend(t.prototype,r),t});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuDropBucket",["require","globals","Constants","platform","tracker","react","MooReact","Autocomplete","VMPane","Components/DivX","MobileUI","VMPane_Autocomplete","DragDrop","Dispatcher","Sel","ReactItem","Components/FancyButton","Components/FancyContextMenu","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("tracker"),a=e("react"),s=e("MooReact"),o=e("Autocomplete"),c=e("VMPane"),l=e("Components/DivX"),d=(e("MobileUI"),e("VMPane_Autocomplete")),h=e("DragDrop"),u=e("Dispatcher"),p=e("Sel"),m=e("ReactItem"),f=e("Components/FancyButton"),g=e("Components/FancyContextMenu"),v=e("Components/FancyContextMenuItem");return s.createClass({displayName:"ReactContextMenuDropBucket",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{pane:a.PropTypes.instanceOf(c).isRequired},init:function(){this.pane=new d,this.createObservables({draggingItem:void 0})},componentDidMount:function(){u.listen("droppedItem",this.onItemDropped)},onUnmount:function(){u.unlisten("droppedItem",this.onItemDropped)},getState:function(){return{items:t.vmMain.dropBucket.getItems(),isDragging:h.isVisible}},createEvent:function(e,i){var n=t.findChild(i.target,"item")||t.findParent(i.target,"item",5);return{fromDropBucket:!0,startSrc:n,target:n,clientX:i.clientX,clientY:i.clientY,eventX:i.eventX||i.clientX,eventY:i.eventY||i.clientY,pageX:i.pageX,pageY:i.pageY,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn,pane:e.pane}},onMouseDown:function(e,t){if(e.item&&n.mobile){var i=this.createEvent(e,t);h.startDragItem=e.item,e.item.dragStart(i),e.item.dragMove(i)}},onClickItem:function(e,a){if(!t.hasClass(a.target,"fancyButton")&&!n.mobile){var s={mode:i.AutocompleteMode.Move,text:"Select item to move to",buttonText:"MOVE",elementDisplay:a.target,onSelected:function(i){r.beginAction();var n=e.item.clone(i.item,ChangeType.Local);i.item.insertItem(n,0),e.item.parent().removeChild(e.item,ChangeType.Local),t.vmMain.dropBucket.removeTextEntry(e.id),0===this.state.items.length&&t.menus.closeContextMenuReact(),r.endAction()}.bind(this)};o.showPopup(s)}},onMouseMove:function(e,t){if(e.item&&n.mobile){var i=this.createEvent(e,t);p.onMouseMoveDocument(i),e.item.onMove(i),this.draggingItem.set(e.item)}},onMouseUp:function(e,i){if(e.item&&n.mobile){var r=this.createEvent(e,i);e.item.onEnd(r),this.draggingItem.set(void 0),0===this.state.items.length&&t.menus.closeContextMenuReact()}},onCloseButton:function(e,i){e.item&&t.vmMain.dropBucket.hasItemEntry(e.item)&&t.vmMain.dropBucket.removeItemEntry(e.item),t.vmMain.dropBucket.hasTextEntry(e.id)&&t.vmMain.dropBucket.consumeTextEntry(e.id),i.stopPropagation()},onItemDropped:function(e){t.vmMain.dropBucket.hasItemEntry(e)&&t.vmMain.dropBucket.removeItemEntry(e),t.vmMain.dropBucket.hasTextEntry(e.id)&&t.vmMain.dropBucket.removeTextEntry(e.id)},_renderBucketItem:function(e,t){return e.item?a.createElement(m,{item:e.item,index:t,pane:this.pane,allowDrag:!0,inAutocomplete:!0}):a.createElement(l,null,e.text)},render:function(){for(var e=this.props,i=this.state,r=[],s=0;s<i.items.length;s++){var o=i.items[s],c=o.item,d=o.id,h={width:"100%",overflow:"hidden"},u=t.classNames({dragging:i.draggingItem===c});n.mobile||(h.maxWidth="335px"),r.push(a.createElement(v,{key:d,className:u,onClick:this.onClickItem.bind(this,o),clickCloses:!1,hasButtons:!0,hoverEffects:!0},a.createElement(l,{style:h,onMouseDown:this.onMouseDown.bind(this,o),onMouseMove:this.onMouseMove.bind(this,o),onMouseUp:this.onMouseUp.bind(this,o)},this._renderBucketItem(o,s)),a.createElement(f,{icon:"icon-close",width:"48px",iconSize:20,onClick:this.onCloseButton.bind(this,o)})))}return a.createElement(g,_extends({},e,{key:"contextMenuDropBucket",id:"contextMenuDropBucket",supportArrows:!0}),r)}})}),define("Components/FancyFocusGuard",["require","react","MooReact","Constants"],function(e){var t=e("react"),i=e("MooReact"),n=e("Constants");return i.createClass({displayName:"FancyFocusGuard",componentDisplay:n.ComponentDisplay.Desktop,onFocus:function(){var e=this.props.component.refs[this.props.target];e&&e.focus()},render:function(){return t.createElement("input",{className:"fancyFocusGuard",onFocus:this.onFocus,tabIndex:this.props.tabIndex})}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactItemDetailsPopup",["require","globals","Constants","data","react","MooReact","tracker","platform","Dispatcher","edit","Hotkeys","ReactItem","ReactNoteEditor","Components/FancyFocusGuard","Components/FancyCheckbox","Components/FancyInput","Components/FancyButton","Components/FancyContextMenu"],function(e){var t=e("globals"),i=e("Constants"),n=(e("data"),e("react")),r=e("MooReact"),a=e("tracker"),s=e("platform"),o=e("Dispatcher"),c=(e("edit"),e("Hotkeys")),l=e("ReactItem"),d=e("ReactNoteEditor"),h=e("Components/FancyFocusGuard"),u=e("Components/FancyCheckbox"),p=e("Components/FancyInput"),m=e("Components/FancyButton"),f=e("Components/FancyContextMenu");return r.createClass({displayName:"ReactItemDetailsPopup",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{element:n.PropTypes.object.isRequired,pane:n.PropTypes.object,item:n.PropTypes.object},init:function(){this.createObservables({canSyncDate:!1,addingLocal:!0})},getHotkeys:function(){return[c.create(KeyCode.Escape,!0,i.Primary.Either,i.Shift.Either,this.onEscape),c.create(KeyCode.C,!0,i.Primary.Never,i.Shift.No,this.onHotkeyCreateEvent)]},getState:function(){var e=this.props.item;return{flags:e.flags,maxWidth:this.props.pane&&Math.min(this.props.pane.getWidth()-20,500),isStarred:e.isStarred(),priority:e.priority()}},componentDidMount:function(){this.props.item.itemChanged.listen(this.onItemChanged),s.mobile||(o.listen("windowResize",this.onResize),o.listen("panesChanged",this.onResize))},onResize:function(){this.updateState(),setTimeout(function(){this.refs.menu&&this.refs.menu.updateState()}.bind(this),300)},onUnmount:function(){if(this.props.item.itemChanged.unlisten(this.onItemChanged),!s.mobile){var e=this.props;if(e.addOnSave&&this.needsSave){var i=this.addItem();e.beginSave&&e.beginSave();try{var n=e.options;if(n)for(var r=0;r<n.length;r++){var a=n[r],c=this.refs[a.text].getValue();if(c)try{a.cb(i)}catch(e){t.reportError(e)}}if(e.children)for(var r=0;r<e.children.length;r++){var l=e.children[r].clone(i,ChangeType.Local);i.insertItem(l)}var d=t.vmMain.getDefaultCalendarPlugin();d&&d.isAvailable()&&this.refs.checkAddCalendar.getValue()&&d.createEventForItem(i)}catch(e){t.reportError(e)}e.endSave&&e.endSave()}o.unlisten("windowResize",this.onResize),o.unlisten("panesChanged",this.onResize)}},onItemChanged:function(){var e=this.props.item;this.canSyncDate.set(!(!e.getDateText()||t.isDateSoft(e.getDateText())||!e.date()&&!e.repeatDate()))},onHotkeyCreateEvent:function(){var e=t.vmMain.getDefaultCalendarPlugin(),i=this.props.item;e&&(this.props.addOnSave?this.state.canSyncDate&&this.refs.checkAddCalendar.setValue(!0):(e.createEventForItem(i),i.itemChanged.notify()))},onKeyPress:function(e){s.getKeyCode(e)===KeyCode.Enter?(this.save(),e.preventDefault()):this.wasAKeyPressed=!0},save:function(){this.props.item.hasText()?(this.needsSave=!0,t.menus.closeContextMenuReact()):t.toasts.pushMessage({text:"Please enter text for the item before adding it.",timeout:2e3})},addItem:function(){var e=this.props.item,i=!0,n=t.vmMain.getDefaultCalendarPlugin();if(n&&n.isAvailable()&&(i=this.refs.checkAddLocal.getValue()),e.getRawText().length>0){if(i){var r=this.props.parent,s=this.refs.addTo.getItem(),o=0;s&&(r=s.item,o=r.numItems()),a.beginAction();var c=e.clone(r,ChangeType.AllLocal),l=this.refs.noteText.getValue();if(l){var d=c.createNote();d&&d.setText(l,!0,ChangeType.Local)}return r.insertItem(c,o),a.endAction(),c}return e}return!1},onEscape:function(){this.wasEscapeKeyPressed=!0,t.menus.closeContextMenuReact()},onNoteValueSet:function(){this.refs.menu.updateState()},onKeyDownNote:function(e){s.getKeyCode(e)===KeyCode.Enter&&s.mac&&e.metaKey&&this.save()},onClickStar:function(){var e=this.props.item;e.isStarred(!e.isStarred(),ChangeType.Local)},setPriority:function(e){var t=this.props.item;t.priority()===e&&(e=VMLIFlag.None),t.priority(e,ChangeType.Local)},onChangeAddToCalendar:function(e){e||this.refs.checkAddLocal.setValue(!0)},onChangeAddLocal:function(e){e||this.refs.checkAddCalendar.setValue(!0),this.addingLocal.set(e)},render:function(){var e,i=this.props,r=this.state,a=i.pane,o=i.item,c=this.state.maxWidth,g=s.mobile&&this.props.bottom,v=t.parentTextForItem(o),y=i.children||(a?a.getSubItems(o):[]),b=o.allowTextEditing(),S=b&&(o.canHaveNote()||o.hasNote()),E=r.canSyncDate,C=t.vmMain.pluginManager.getPlugin(PluginID.GCalendar),P=C.isActive()&&t.vmMain.pluginManager.getSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.SyncNewEvents),T=C.isActive()&&t.vmMain.pluginManager.getSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.CreateLocalEvents),D=C&&C.isAvailable();if(y.length>0){e=[];for(var M=-y[0].getPadding(a),_=0;_<y.length;_++){var I=y[_];e.push(n.createElement(l,{key:I.id,item:I,pane:i.pane,padded:!0,allowDrag:!1,paddingOffset:M,maxWidth:508}))}}var A=10,w=t.classNames("c-foreground-faded",{disabled:!r.addingLocal});return n.createElement(f,_extends({},i,{key:o.id+"_Edit",id:"contextMenuItemDetails",className:"flexbox flexvert",width:540,maxWidth:c,bottom:g,onEscape:this.onEscape,ref:"menu"}),n.createElement(h,{component:this,target:"buttonSave",tabIndex:A++}),v&&n.createElement("div",{className:"detailsSection flexbox itemContext c-foreground-faded"},n.createElement("div",{className:"c-foreground-faded"},"Parents"),n.createElement("div",null,v)),n.createElement("div",{className:"detailsSection flexbox noShrink"},n.createElement("div",{className:"c-foreground-faded"},"Item text"),n.createElement(l,{ref:"item",className:"detailsItem c-background c-border",item:o,maxWidth:508,onKeyPress:this.onKeyPress,selectIndex:i.selectIndex,showPriority:!0,shouldSave:!i.addOnSave,autocompleteMode:"all",tabIndex:A,inItemDetails:!0,pane:a,editable:b})),i.addOnSave&&n.createElement("div",{className:"detailsSection flexbox"},n.createElement("div",{className:w},"Add to"),n.createElement(p,{autocompleteMode:"item",height:33,placeholder:"Select item to add to",tabIndex:A++,ref:"addTo",disabled:!r.addingLocal})),S&&n.createElement("div",{className:"detailsSection flexbox"},n.createElement("div",{className:"c-foreground-faded"},"Note"),n.createElement(d,{className:"c-border",ref:"noteText",item:o,heightEmpty:34,heightValue:150,onValueSet:this.onNoteValueSet,onKeyDown:this.onKeyDownNote,tabIndex:A++})),n.createElement("div",{className:"detailsSection flexbox"},n.createElement("div",{className:"c-foreground-faded"},"Options"),n.createElement("span",{className:"itemDetailOption c-border pointer",onClick:this.onClickStar},n.createElement("span",{className:"c-foreground-super-faded"},"Star:"),n.createElement("i",{className:t.classNames("starButton icon-star c-foreground-super-faded",{selected:r.isStarred})})),n.createElement("span",{className:"itemDetailOption c-border"},n.createElement("span",{className:"c-foreground-super-faded"},"Priority:"),n.createElement("span",{className:t.classNames("searchPriority searchP0",{selected:r.priority===VMLIFlag.P0}),onClick:this.setPriority.bind(this,VMLIFlag.P0)}),n.createElement("span",{className:t.classNames("searchPriority searchP1",{selected:r.priority===VMLIFlag.P1}),onClick:this.setPriority.bind(this,VMLIFlag.P1)}),n.createElement("span",{className:t.classNames("searchPriority searchP2",{selected:r.priority===VMLIFlag.P2}),onClick:this.setPriority.bind(this,VMLIFlag.P2)}))),e&&n.createElement("div",{className:"detailsSection"},n.createElement("div",{className:"c-foreground-faded"},"Subitems"),n.createElement("div",{className:"children c-border"},e)),i.addOnSave&&(D||i.options)&&n.createElement("div",{className:"detailsSection"},n.createElement("div",{className:"options c-foreground-faded"},"Options"),D&&n.createElement(u,{key:"addLocal",initialChecked:T,ref:"checkAddLocal",onChange:this.onChangeAddLocal,disabled:!E,tabIndex:E&&A++},"Create local item"),D&&n.createElement(u,{key:"addToCalendar",initialChecked:P,ref:"checkAddCalendar",onChange:this.onChangeAddToCalendar,disabled:!E,tabIndex:E&&A++},"Sync with Google Calendar"),i.options&&i.options.map(function(e){return n.createElement(u,{key:e.text,initialChecked:e.value,ref:e.text,tabIndex:A++},e.text)})),i.addOnSave&&n.createElement("div",{className:"bottomRow flexbox"},n.createElement(m,{onClick:this.onEscape},"CANCEL"),n.createElement(m,{primary:!0,marginLeft:8,onClick:this.save,tabIndex:A++,ref:"buttonSave"},"SAVE")),n.createElement(h,{component:this,target:"item",tabIndex:A++}))}})}),define("ReactContextMenuEmailDetails",["require","globals","Constants","react","MooReact","International","Components/FancyContextMenu"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("International"),s=e("Components/FancyContextMenu");return r.createClass({displayName:"ReactContextMenuEmailDetails",componentDisplay:i.ComponentDisplay.Desktop,_generateParticipantTextExpanded:function(e){return e.text?n.createElement("span",null,n.createElement("b",null,e.text)," <"+e.email+">"):e.email},renderLabels:function(){for(var e=t.vmMain.getDefaultEmailPlugin(),i=this.props.accountID,r=this.props.message.labelIds,a=[],s=0;s<r.length;s++){var o=e._getLabelByID(i,r[s]);a.push(n.createElement("div",{key:s},o.getName()))}return this.renderLine("labels",a)},renderParticipants:function(e){var t=this.props.message[e].map(function(e,t){return n.createElement("div",{key:t},this._generateParticipantTextExpanded(e))}.bind(this));return this.renderLine(e,t)},renderLine:function(e,t){return n.createElement("div",{className:"emailDetailsLine flexbox"},n.createElement("div",null,e+":"),n.createElement("span",{className:"f1"},t))},render:function(){var e=this.props.message,t=e.date,i=t.toString(a.getFormat(DFormat.DayMonthDateYear))+" at "+t.toString(a.getFormat(DFormat.ShortTime));return n.createElement(s,{key:"contextMenuEmailDetails",id:"contextMenuEmailDetails",element:this.props.element},this.renderLine("from",this._generateParticipantTextExpanded(e.from)),e.to&&this.renderParticipants("to"),e.cc&&this.renderParticipants("cc"),e.bcc&&this.renderParticipants("bcc"),this.renderLine("date",i),this.renderLine("subject",e.subject),e.labelIds&&this.renderLabels())}})}),define("ReactContextMenuItem",["require","globals","platform","Constants","react","MooReact","PaneFactory","Sel","AccountManager","Components/FancyButton","Components/FancyContextMenu","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("platform"),n=e("Constants"),r=e("react"),a=e("MooReact"),s=e("PaneFactory"),o=e("Sel"),c=e("AccountManager"),l=e("Components/FancyButton"),d=e("Components/FancyContextMenu"),h=e("Components/FancyContextMenuItem");return a.createClass({displayName:"ReactContextMenuItem",componentDisplay:n.ComponentDisplay.Desktop,init:function(){this.mod=i.secModKey,this.priMod=i.priModKey,this.props.useItem||this.props.pane.applyToSelection(function(e){return this.item=e,this.hasSelection=!0,!1}.bind(this)),this.item||(this.item=this.props.item,this.hasSelection=!1);try{t.PAssert(5228,this.item,"Must have a valid item")}catch(e){t.reportError(e)}},onClickComplete:function(){this.hasSelection?t.vmMain.applyFnToSelection("isComplete",{toggle:!0,value2:ChangeType.Local}):this.item.isComplete(!this.item.isComplete(),ChangeType.Local)},onClickStar:function(){this.hasSelection?t.vmMain.applyFnToSelection("isStarred",{toggle:!0,value2:ChangeType.Local}):this.item.isStarred(!this.item.isStarred(),ChangeType.Local)},onClickPriority:function(e){this.hasSelection?this.props.pane.applyPriorityToSelection(e):this.item.priority(e,ChangeType.Local),t.menus.closeContextMenuReact()},onClickIndent:function(e){t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:e})},onClickMove:function(){this.props.pane.autocompleteMove()},onClickCreateTask:function(){this.props.pane.autocompleteCreateTask()},onClickNote:function(){this.item.editNote()},onClickCollapse:function(){this.item.toggleCollapsed(this.props.pane)},onClickZoom:function(){this.item.canZoom()&&(o.setFocusedPane(this.props.pane),t.vmMain.zoomin(this.item))},onClickZoomNewPane:function(){var e=this.props.pane;if(this.item.canZoom()){var i=t.vmMain.paneManager.getPaneIndex(e)+1,n=e.getSaveInfo();n.item=this.item,delete n.id;var r=s.createPane(PaneMode.Outline,n);return t.vmMain.paneManager.addPaneAtIndex(r,i),o.setFocusedPane(r),r.onAdded(),!1}},onClickGoto:function(){t.scrollToAndHighlightItem(this.item,this.props.pane)},onClickArchive:function(){var e=this.props.pane;if(e.isWriteable)if(this.hasSelection)e.archiveSelected(!0);else{var t=this.props.item;t.parent().archiveChild(t,ChangeType.Local)}},onClickUnarchive:function(){t.focusedPane.runUnarchive(this.item)},onClickDelete:function(){var e=this.item,i=this.props.pane;if(e.isNote()){var r=o.getStartIndex(),a=e.parent();e.parent().setNote(void 0,ChangeType.Local),o.selectIndex(r-1,a.getParsedText().length)}else if(i.isWriteable)if(i.type===PaneMode.Timeline&&!e.hasAttachmentType(n.PluginType.Calendar)&&e.hasChildren()){t.menus.options("The item you are deleting has children.",["Remove Date","Delete All"],function(t){if("Remove Date"===t){var i=e.getParsedText().replace(e.getItemDateString(),"");e.setText(i,!0,ChangeType.Local)}else"Delete All"===t&&e.deleteSelf(ChangeType.Local)}.bind(this))}else this.hasSelection?i.deleteSelected():this.props.item.deleteSelf(ChangeType.Local)},onClickAddCalendar:function(){var e=t.vmMain.getDefaultCalendarPlugin(),i=this.item;e&&(e.createEventForItem(i),i.itemChanged.notify())},onClickDeleteCalendar:function(){var e=this.item,i=this.props.pane;if(e.hasAttachmentType(n.PluginType.Calendar)){var r=e.getAttachmentByPlugin(PluginID.GCalendar);try{t.PAssert(5229,r,"Must be able to get a valid attachment")}catch(e){t.reportError(e)}try{t.PAssert(5230,this.item,"Must have a valid item")}catch(e){t.reportError(e)}var a=r.getPlugin();a.hasWritePermissionForAttach(r)?(o.reset(),a.deleteCalendarEventForItem(this.item,r,t.emptyFn,t.emptyFn,function(e,n,r,a){n?i.updateItems():t.toasts.pushMessage({text:"There was an error removing the event from your Google Calendar.",action:MessageAction.Okay})})):t.toasts.pushMessage(MessageID.ReadOnlyCalendar)}},onClickReply:function(){this.hasSelection?this.props.pane.replySelected():this.props.pane.openEmailByItem(this.item,n.EmailResponseMode.Reply)},onClickReplyAll:function(){this.hasSelection?this.props.pane.replyAllSelected():this.props.pane.openEmailByItem(this.item,n.EmailResponseMode.ReplyAll)},onClickForward:function(){this.hasSelection?this.props.pane.forwardSelected():this.props.pane.openEmailByItem(this.item,n.EmailResponseMode.Forward)},onClickRead:function(){var e=this.item,t=e.getAttachmentByType(n.PluginType.Email),i=t.getPlugin(),r=i.isItemUnread(e);this.hasSelection?this.props.pane.markReadSelected(r):r?i.performAction(n.PluginAction.Gmail.MarkRead,t):i.performAction(n.PluginAction.Gmail.MarkUnread,t)},onClickStarGmail:function(){if(this.hasSelection)this.props.pane.toggleStarSelected();else{var e=this.item,t=e.getAttachmentByType(n.PluginType.Email),i=t.getPlugin();i.isItemStarred(this.item)?i.performAction(n.PluginAction.Gmail.Unstar,t):i.performAction(n.PluginAction.Gmail.Star,t)}},onClickSnooze:function(){this.props.pane.autocompleteSnooze()},onClickLabel:function(){this.props.pane.autocompleteLabel()},onClickSchedule:function(){this.props.pane.autocompleteSchedule()},onClickArchiveGmail:function(){var e=this.item,t=e.getAttachmentByType(n.PluginType.Email),i=t.getPlugin(),r=i.isItemArchived(e);"PaneGmail"===this.props.pane.type&&this.hasSelection?this.props.pane.archiveSelected(!r):r?i.performAction(n.PluginAction.Gmail.Unarchive,!1,t):i.performAction(n.PluginAction.Gmail.Archive,!1,t)},onClickDeleteGmail:function(){var e=this.item,t=e.getAttachmentByType(n.PluginType.Email),i=t.getPlugin(),r=i.isItemFullTrashed(e);this.hasSelection?this.props.pane.deleteSelected(i.isGmailItem,!r):i.isGmailItem(e)&&(this.onClickDeleteCalendar(),e.deleteSelf(ChangeType.Local))},onClickPrefix:function(e){t.vmMain.applyPrefixToSelection(e,!this.hasSelection&&this.item)},onViewInDrive:function(){var e=this.item,i=e.getAttachmentByPlugin(PluginID.Drive),n=i.getPlugin(),r=i.getData();if(r&&r.parents){var a=r.parents[0];if(a){var s=a.id,o=n.createFolderURL(s);t.openUrl(o)}}},renderMenuDate:function(){return r.createElement("span",null,r.createElement(h,{icon:"icon-calendar",hotkey:i.secModKeyForce+" + C",onClick:this.onClickAddCalendar},"Add to Google Calendar"))},renderMenuNote:function(){return r.createElement("span",null,r.createElement(h,{icon:"icon-edit",hotkey:"Shift + Enter",onClick:this.onClickNote},"Edit"),r.createElement(h,{icon:"icon-delete",onClick:this.onClickDelete},"Delete"))},renderMenuPrefix:function(){return r.createElement("span",null,r.createElement(h,{className:"mat-subheader c-foreground-faded"},"Actions"),r.createElement(h,{icon:"icon-check",hotkey:this.mod+" + /",onClick:this.onClickComplete},"Complete"),r.createElement(h,{icon:"icon-zoom-in",hotkey:this.priMod+" + Enter",onClick:this.onClickZoom},"Zoom In"),r.createElement("hr",null),r.createElement(h,{className:"mat-subheader c-foreground-faded"},"Item Type"),r.createElement(h,{icon:"icon-none",onClick:this.onClickPrefix.bind(this,void 0)},"Normal Item"),r.createElement(h,{icon:"icon-header",hotkey:n.Prefix.Header,onClick:this.onClickPrefix.bind(this,n.Prefix.Header)},"Header"),r.createElement(h,{icon:"icon-check",hotkey:n.Prefix.Task,onClick:this.onClickPrefix.bind(this,n.Prefix.Task)},"Task"),r.createElement(h,{icon:"icon-bullet",hotkey:n.Prefix.Bullet,onClick:this.onClickPrefix.bind(this,n.Prefix.Bullet)},"Bullet"),r.createElement(h,{icon:"icon-numlist",hotkey:n.Prefix.NumList,iconSize:14,onClick:this.onClickPrefix.bind(this,n.Prefix.NumList)},"Numbered List"))},renderMenuDefault:function(){var e,a=this.props.pane,s=this.item,o=this.mod,c=this.priMod,d=a.type===PaneMode.Timeline,u=!d||a.viewMode.get()===n.CalendarViewMode.Agenda,p=s.isCollapsed(a,!1),m=a.supportIndent&&!s.isNote()&&0!==s.getIndex()&&!a.search.isFlatSearchResult(s),f=a.supportIndent&&!s.isNote()&&s.parent()!==t.focusedItem&&!(a.search.isFlatSearchResult(s)||a.search.isFlatSearchResult(s.parent())),g=a.supportCollapsing&&(s.isHeader()||s.hasChildren()),v=t.vmMain.getDefaultCalendarPlugin();if(v&&s.date())if(s.hasAttachmentType(n.PluginType.Calendar)){var y=s.getAttachmentByType(n.PluginType.Calendar);e=r.createElement(h,{icon:"icon-delete",disabled:!y.getPlugin().hasWritePermissionForAttach(y),onClick:this.onClickDeleteCalendar},"Delete Event")}else e=r.createElement(h,{icon:"icon-calendar",hotkey:u&&i.secModKeyForce+" + C",onClick:this.onClickAddCalendar},"Add to Google Calendar");return r.createElement("span",null,r.createElement(h,{icon:"icon-check",hotkey:u&&o+" + /",onClick:this.onClickComplete},s.isComplete()?"Uncomplete":"Complete"),r.createElement(h,{icon:"icon-star",hotkey:u&&o+" + 8",onClick:this.onClickStar},s.isStarred()?"Unstar":"Star"),r.createElement("hr",null),r.createElement(h,{className:"mat-subheader c-foreground-faded",hotkey:u&&o+" + #"},"Priority"),r.createElement("div",{className:"horizontalMenu"},r.createElement(l,{className:"c-border-heavy",id:"itemPriorityNone",onClick:this.onClickPriority.bind(this,VMLIFlag.None)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityLow",tooltip:u&&o+" + 3",onClick:this.onClickPriority.bind(this,VMLIFlag.P2)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityMed",tooltip:u&&o+" + 2",onClick:this.onClickPriority.bind(this,VMLIFlag.P1)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityHigh",tooltip:u&&o+" + 1",onClick:this.onClickPriority.bind(this,VMLIFlag.P0)})),r.createElement("hr",null),r.createElement(h,{className:"mat-subheader c-foreground-faded"},"Item Type"),r.createElement("div",{className:"horizontalMenu"},r.createElement(l,{className:"c-border-heavy",iconSize:14,width:24,height:24,tooltip:"None",onClick:this.onClickPrefix.bind(this,null)}),r.createElement(l,{className:"c-border-heavy",icon:"icon-header",iconSize:15,width:24,height:24,tooltip:"Header",onClick:this.onClickPrefix.bind(this,n.Prefix.Header)}),r.createElement(l,{className:"c-border-heavy",icon:"icon-check",iconSize:15,width:24,height:24,tooltip:"Task",onClick:this.onClickPrefix.bind(this,n.Prefix.Task)}),r.createElement(l,{className:"c-border-heavy",icon:"icon-bullet",iconSize:28,width:24,height:24,tooltip:"Bullet",onClick:this.onClickPrefix.bind(this,n.Prefix.Bullet)}),r.createElement(l,{className:"c-border-heavy",icon:"icon-numlist",iconSize:13,width:24,height:24,tooltip:"Numbered List",onClick:this.onClickPrefix.bind(this,n.Prefix.NumList)})),e&&r.createElement("hr",null),e,r.createElement("hr",null),m&&r.createElement(h,{icon:"icon-format_indent_increase",hotkey:"Tab",onClick:this.onClickIndent.bind(this,!1)},"Indent"),f&&r.createElement(h,{icon:"icon-format_indent_decrease",hotkey:"Shift + Tab",onClick:this.onClickIndent.bind(this,!0)},"Unindent"),!d&&r.createElement(h,{icon:"icon-align-left",hotkey:i.secModKeyForce+" + M",onClick:this.onClickMove},"Move"),r.createElement("hr",null),!d&&r.createElement(h,{icon:"icon-sticky-note-o",hotkey:"Shift + Enter",onClick:this.onClickNote},"Add Note"),g&&r.createElement(h,{icon:p?"icon-add":"icon-minus",hotkey:o+" + ,",onClick:this.onClickCollapse},p?"Uncollapse":"Collapse"),r.createElement(h,{icon:"icon-zoom-in",hotkey:u&&c+" + Enter",onClick:this.onClickZoom},"Zoom In"),r.createElement(h,{icon:"icon-zoom-in-plus",onClick:this.onClickZoomNewPane},"Open in New Pane"),r.createElement(h,{icon:"icon-keyboard-tab",hotkey:u&&o+" + G",onClick:this.onClickGoto},"Go to in all panes"),r.createElement("hr",null),r.createElement(h,{icon:"icon-task",onClick:this.onClickArchive},"Archive Item"),r.createElement(h,{icon:"icon-delete",onClick:this.onClickDelete},"Delete"))},renderMenuArchived:function(){return r.createElement("span",null,r.createElement(h,{icon:"icon-task",onClick:this.onClickUnarchive},"Unarchive"),r.createElement(h,{icon:"icon-delete",onClick:this.onClickDelete},"Delete"))},renderMenuDrive:function(){var e=this.props.pane,t=this.item,i=t.isCollapsed(e,!1),n=e.supportCollapsing&&(t.isHeader()||t.hasChildren()),a=t.isHeader()||t.hasChildren();return r.createElement("span",null,r.createElement(h,{disabled:!n,icon:i?"icon-add":"icon-minus",hotkey:this.mod+" + ,",onClick:this.onClickCollapse},i?"Uncollapse":"Collapse"),r.createElement(h,{disabled:!a,icon:"icon-zoom-in",hotkey:this.priMod+" + Enter",onClick:this.onClickZoom},"Zoom In"),r.createElement(h,{onClick:this.onViewInDrive},"View in Drive"))},renderMenuGCalendar:function(e){return e.getPlugin().hasWritePermissionForAttach(e)?r.createElement("span",null,r.createElement(h,{icon:"icon-check",onClick:this.onClickComplete},e.getField("isComplete")?"Uncomplete":"Complete"),r.createElement(h,{icon:"icon-task",onClick:this.onClickArchive},e.getField("isArchived")?"Unarchive":"Archive"),r.createElement("hr",null),r.createElement(h,{className:"mat-subheader"},"Priority"),r.createElement("div",{id:"contextMenuPriority",className:"horizontalMenu"},r.createElement(l,{className:"c-border-heavy",id:"itemPriorityNone",onClick:this.onClickPriority.bind(this,VMLIFlag.None)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityLow",onClick:this.onClickPriority.bind(this,VMLIFlag.P2)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityMed",onClick:this.onClickPriority.bind(this,VMLIFlag.P1)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityHigh",onClick:this.onClickPriority.bind(this,VMLIFlag.P0)})),r.createElement("hr",null),r.createElement(h,{icon:"icon-delete",onClick:this.onClickDeleteCalendar},"Delete Event")):r.createElement("span",null,r.createElement(h,{icon:"icon-warning"},"Read-Only Event"))},renderMenuGmail:function(e){var t=this.item,i=this.mod,n="PaneGmail"===this.props.pane.type,a=e.getPlugin(),s=a.isItemUnread(t),o=a.isItemStarred(t),d=a.isItemArchived(t),u=a.isItemFullTrashed(t),p=c.isLinkedAccountAuthorized(e.getField("accountID"),GScope.GmailModify)
;return r.createElement("span",null,r.createElement(h,{icon:"icon-reply",hotkey:n&&"R",onClick:this.onClickReply},"Reply"),r.createElement(h,{icon:"icon-reply-all",hotkey:n&&"Shift + R",onClick:this.onClickReplyAll},"Reply All"),r.createElement(h,{icon:"icon-forward",hotkey:n&&"F",onClick:this.onClickForward},"Forward"),r.createElement("hr",null),n&&r.createElement(h,{icon:s?"icon-drafts":"icon-unread",iconSize:14,hotkey:s?"":"U",onClick:this.onClickRead},s?"Mark as read":"Mark as unread"),r.createElement(h,{icon:"icon-star",hotkey:n?"8":i+" + 8",onClick:this.onClickStarGmail},o?"Unstar":"Star"),r.createElement("hr",null),r.createElement(h,{className:"mat-subheader",hotkey:i+" + #"},"Priority"),r.createElement("div",{id:"contextMenuPriority",className:"horizontalMenu"},r.createElement(l,{className:"c-border-heavy",id:"itemPriorityNone",onClick:this.onClickPriority.bind(this,VMLIFlag.None)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityLow",onClick:this.onClickPriority.bind(this,VMLIFlag.P2)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityMed",onClick:this.onClickPriority.bind(this,VMLIFlag.P1)}),r.createElement(l,{className:"c-border-heavy",id:"itemPriorityHigh",onClick:this.onClickPriority.bind(this,VMLIFlag.P0)})),r.createElement("hr",null),n&&r.createElement(h,{disabled:!p,icon:"icon-access_time",hotkey:"D",onClick:this.onClickSnooze},"Snooze"),r.createElement(h,{icon:"icon-tag",hotkey:n&&"L",onClick:this.onClickLabel},"Label"),n&&r.createElement(h,{icon:"icon-check",hotkey:"T",onClick:this.onClickCreateTask},"Create Task"),n&&r.createElement(h,{icon:"icon-align-left",hotkey:"M",onClick:this.onClickMove},"Add to Outline"),n&&r.createElement(h,{icon:"icon-calendar",hotkey:"C",onClick:this.onClickSchedule},"Add To Calendar"),!n&&r.createElement(h,{disabled:u,icon:"icon-inbox",onClick:this.onClickArchiveGmail},d?"Move to Inbox":"Remove from Inbox"),r.createElement("hr",null),!n&&r.createElement(h,{icon:"icon-task",onClick:this.onClickArchive},"Archive Item"),n&&r.createElement(h,{disabled:u,icon:"icon-task",hotkey:"E",onClick:this.onClickArchiveGmail},d?"Unarchive":"Archive"),r.createElement(h,{disabled:u,icon:"icon-delete",hotkey:n&&"Backspace",onClick:this.onClickDeleteGmail},u?"Undelete":"Delete"))},render:function(){var e,i=this.props,a=i.pane,s=this.item,o=i.element,c=t.getPluginForElement(o);if(c){var l=c.getAttribute("plugin");if(s.hasPluginAttachment(l))switch(l){case PluginID.Drive:e=this.renderMenuDrive();break;case PluginID.GCalendar:e=this.renderMenuGCalendar(s.getAttachmentByPlugin(l));break;case PluginID.Gmail:e=this.renderMenuGmail(s.getAttachmentByPlugin(l))}}else if(t.hasClass(o,"date")){var h=t.vmMain.getDefaultCalendarPlugin();h&&(e=s.hasAttachmentType(n.PluginType.Calendar)?this.renderMenuGCalendar(s.getAttachmentByPlugin(PluginID.GCalendar)):this.renderMenuDate())}else t.hasClass(o,"itemPrefix")?e=this.renderMenuPrefix():s.isNote()&&(e=this.renderMenuNote());if(!e){var u=a.getContextMenuMode(s);switch(u){case n.ContextMenuMode.Default:e=this.renderMenuDefault();break;case n.ContextMenuMode.Archived:e=this.renderMenuArchived();break;case n.ContextMenuMode.Gmail:e=this.renderMenuGmail(s.getAttachmentByPlugin(PluginID.Gmail));break;case n.ContextMenuMode.Calendar:e=this.renderMenuGCalendar(s.getAttachmentByPlugin(PluginID.GCalendar));break;default:try{t.PAssert(5231,!1,"Unknown context menu mdoe: "+u)}catch(e){t.reportError(e)}}}return r.createElement(d,{id:"contextMenuItem",element:i.element,supportArrows:!0,pos:i.pos,noBackdrop:i.noBackdrop},e)}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuOnlineStatus",["require","globals","Constants","platform","data","gdata","goog","react","MooReact","International","AccountManager","Components/FancyContextMenu","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("data"),a=e("gdata"),s=e("goog"),o=e("react"),c=e("MooReact"),l=e("International"),d=e("AccountManager"),h=e("Components/FancyContextMenu"),u=e("Components/FancyContextMenuItem");return c.createClass({displayName:"ReactContextMenuOnlineStatus",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.createObservables({syncTimes:{}}),t.vmMain.pluginManager.getPlugin(PluginID.Gmail).getAllLastSyncTimes(function(e){this.syncTimes.set(e)}.bind(this)),this.listenTo(d.onAccountsUpdated)},getState:function(){var e=t.vmMain,i=e.gdriveStatus(),s={gDriveStatus:e.gDriveStatusObs,lastChangeTime:a.lastChangeTime,lastSyncText:this.getLastSyncText(),isOnline:i!==DriveStatus.Offline,undoRedoDisabled:!e.canRunUndoRedo(),isTrashed:e.docManager.isOpenDocTrashed(),hasTrashedDocs:e.docManager.hasTrashedDocuments(),isBlocked:t.hasOnlineBlockingError(),isCookiesBlocked:t.hasCookieBlockingError(),supportsOffline:!!window.applicationCache,overQuota:r.overQuota,nearQuota:!r.overQuota&&n.isNearStorageQuota,hasUnsavedData:a.hasPotentialUnsavedData(),cacheRatioWarning:!r.overQuota&&parseFloat(t.vmMain.pluginManager.getCacheSizeRatio())<.6,isConnected:i===DriveStatus.Saving||i===DriveStatus.Saved};return s.hasWarning=s.isTrashed||s.hasTrashedDocs||s.overQuota||s.nearQuota||s.hasUnsavedData||s.isBlocked||s.isCookiesBlocked||s.undoRedoDisabled||s.cacheRatioWarning||!s.supportsOffline,s},getLastSyncText:function(){var e,t=a.lastChangeTime.get();if(t>0){e="Last Sync: "+new Date(t).toString(l.getFormat(DFormat.LongDayTime))}else e="Not synced";return e},_handleTrashClick:function(e){var i=t.vmMain.getUserEmail(),n="https://drive.google.com/drive/b/"+i+"/search?q=mimetype=application/vnd.google-apps.drive-sdk.597847337936%20is:trashed";t.openUrl(n,e)},_handleQuotaOverClick:function(){t.toasts.pushMessage({text:"Your computer's offline storage quota has been exceeded. Please try freeing space on your device. Offline access will not work.",action:MessageAction.Okay})},_handleQuotaNearClick:function(){t.toasts.pushMessage({text:"Your computer's offline storage quota is almost exceeded. Please try freeing space on your device, running out will cause offline access to not work.",action:MessageAction.Okay})},_handleUnsavedClick:function(){t.toasts.pushMessage({text:"Your local changes have been unable to be persisted to disk and have not been saved remotely. You must reconnect to the internet to save them. Free up disk space to prevent this happening.",action:MessageAction.Okay})},_handleRatioClick:function(){t.toasts.pushMessage({text:"Due to low disk space your cache size was restricted. View your General Settings to reset your cache size.",action:MessageAction.OpenGeneralSettings})},_handleBlockClick:function(){},_handleCookiesClick:function(){},_handleStatusClick:function(){this.state.isConnected||s.ensureDocConnection()},_handleIconWarningClick:function(e){try{t.PAssert(5232,!n.mobile,"User should never see account warnings on mobile")}catch(e){t.reportError(e)}d.isDefaultEmail(e)?t.menus.openSettings(i.SettingsSections.Plugins):t.menus.openSettings(i.SettingsSections.Linked)},componentDidUpdate:function(){this.refs.menu.updateState()},_renderAccounts:function(){var e,i,n,r,a=this.state,s=[];for(var c in a.syncTimes)if(a.syncTimes.hasOwnProperty(c)){var h=a.syncTimes[c];if(e=void 0,i=void 0,n=void 0,r=h?c+": "+h.toString(l.getFormat(DFormat.ShortDayTime)):c+": Not synced",d.isConnected()){var p=d.getAccountError(c);if(p)e="icon-warning",i=p,n=this._handleIconWarningClick.bind(this,c);else{var m=t.vmMain.pluginManager.getPlugin(PluginID.Gmail).verifyAuthorization(c);m.length>0&&(e="icon-warning",i="Missing authorization",n=this._handleIconWarningClick.bind(this,c))}}s.push(o.createElement(u,{key:c,icon:e,iconTooltip:i,onClickIcon:n},r))}return s.length>0&&o.createElement("div",null,o.createElement("hr",null),o.createElement(u,{className:"onlineStatusHeader"},"Email accounts"),s)},render:function(){var e=this.state,i=this._renderAccounts();return o.createElement(h,_extends({},this.props,{ref:"menu",key:"contextMenuOnlineStatus",id:"contextMenuOnlineStatus",element:this.props.element}),o.createElement(u,{className:"onlineStatusHeader"},"File Content"),o.createElement(u,{tooltip:"Force Reconnect",onClick:this._handleStatusClick},e.lastSyncText),e.hasWarning&&o.createElement("div",null,o.createElement("hr",null),o.createElement(u,{className:"onlineStatusHeader"},"Warnings"),e.isBlocked&&o.createElement(u,{tooltip:"Learn More",onClick:this._handleBlockClick},t.blockedMessage),e.isCookiesBlocked&&o.createElement(u,{tooltip:"Learn More",onClick:this._handleCookiesClick},"Cookies are blocked. Unable to keep you logged in."),!e.supportsOffline&&o.createElement(u,{tooltip:"Learn More",onClick:this._handleOfflineClick},"Your browser does not support offline access"),e.isTrashed&&o.createElement(u,{tooltip:"View Trash",onClick:this._handleTrashClick},"Document is in the trash"),e.hasTrashedDocs&&o.createElement(u,{tooltip:"View Trash",onClick:this._handleTrashClick},"Trashed documents detected"),e.overQuota&&o.createElement(u,{tooltip:"Learn More",onClick:this._handleQuotaOverClick},"Disk quota exceeded"),e.nearQuota&&o.createElement(u,{tooltip:"Learn More",onClick:this._handleQuotaNearClick},"Nearly out of disk space"),e.hasUnsavedData&&o.createElement(u,{tooltip:"Learn More",onClick:this._handleUnsavedClick},"Unsaved changes will be lost"),e.cacheRatioWarning&&o.createElement(u,{tooltip:"Learn More",onClick:this._handleRatioClick},"Your data is not efficiently being cached"),e.undoRedoDisabled&&o.createElement(u,null,"You cannot undo/redo while offline")),i)}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuAddPane",["require","globals","Constants","tracker","react","MooReact","Hotkeys","Sel","ReactMenuItemAddPane","Components/FancyContextMenu","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("tracker"),r=e("react"),a=e("MooReact"),s=(e("Hotkeys"),e("Sel"),e("ReactMenuItemAddPane")),o=e("Components/FancyContextMenu"),c=e("Components/FancyContextMenuItem");PaneMode.Outline,PaneMode.Timeline,PaneMode.Gmail;return a.createClass({displayName:"ReactContextMenuAddPane",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.addHotkey("O",PaneMode.Outline),this.addHotkey("C",PaneMode.Timeline),this.addHotkey("A",PaneMode.Archived),this.addHotkey("G",PaneMode.Gmail),this.addHotkey("D",PaneMode.Drive),setTimeout(function(){n.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenAddPaneMenu})},0)},addHotkey:function(e,t){this.hotkeysByKeyCode||(this.hotkeysByKeyCode={}),this.hotkeysByType||(this.hotkeysByType={}),this.hotkeysByType[t]=e,this.hotkeysByKeyCode[KeyCode[e]]=t},getState:function(){var e=t.vmMain.paneFactory;return{registeredPanes:e.activePaneTypes,numInactivePanes:e.numInactivePanes}},onKeyPress:function(e,i){var n=this.hotkeysByKeyCode[e];if(n){i.preventDefault(),i.stopPropagation();var r=t.vmMain.paneManager;if(i.shiftKey){var a=document.getElementById("addPane_"+n);r.zoomPaneByButton(n,a)}else r.addPaneByButton(n);return!0}},onClickEnableMorePanes:function(){t.menus.openSettings(i.SettingsSections.Plugins)},render:function(){for(var e=this.props,t=this.state,i=t.registeredPanes,n=[],a=t.numInactivePanes>0,l=0;l<i.length;l++){var d=i[l],h=d.type,u=this.hotkeysByType[d.type];n.push(r.createElement(s,{key:d.type,id:"addPane_"+d.type,paneInfo:d,type:h,hotkey:u,elementType:c}))}return r.createElement(o,_extends({},e,{ref:"menu",key:"contextMenuAdd",supportArrows:!0,onKeyPress:this.onKeyPress}),n,a&&r.createElement("hr",null),a&&r.createElement(c,{onClick:this.onClickEnableMorePanes},"Enable more panes"))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuAuthorize",["require","globals","Constants","react","MooReact","PluginSettings","Components/FancyContextMenu","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("PluginSettings"),s=e("Components/FancyContextMenu"),o=e("Components/FancyButton");return r.createClass({displayName:"ReactContextMenuAuthorize",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{element:n.PropTypes.object.isRequired},onClickEnable:function(){a.refresh(),a.toggleOfflineFeatures(!0,this.onEnable)},onEnable:function(e){e&&t.menus.closeContextMenuReact()},render:function(){return n.createElement(s,_extends({},this.props,{key:"contextMenuAuthorize",id:"contextMenuAuthorize"}),n.createElement("div",null,this.props.message),n.createElement("div",{className:"center"},n.createElement(o,{primary:!0,raised:!0,onClick:this.onClickEnable},"ENABLE")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuMobileFilter",["require","globals","Constants","react","MooReact","VMPane","Components/DivX","Components/FancyButton","Components/FancyContextMenu","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("VMPane"),s=e("Components/DivX"),o=e("Components/FancyButton"),c=e("Components/FancyContextMenu");e("Components/FancyContextMenuItem");return r.createClass({displayName:"ReactContextMenuMobileFilter",componentDisplay:i.ComponentDisplay.Mobile,propTypes:{pane:n.PropTypes.instanceOf(a).isRequired},init:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){for(var e=this.props.pane.search,t={hasFilter:!1},i=0;i<e.filters.length;i++){var n=e.filters[i];t[n.name]=n.value,0!==n.value&&(t.hasFilter=!0)}return t},onClickClear:function(){for(var e=this.props.pane.search,t=0;t<e.filters.length;t++){var i=e.filters[t];0!==i.value&&e.setFilter(i.name,0)}},onClickFilter:function(e,t){var i=this.props.pane.search;i.getFilter(e.name)===t&&(t=0),i.setFilter(e.name,t)},renderSearchButton:function(e,i){var r=t.classNames("searchFilterButton c-border",e.icon,{yes:i>0},{no:i<0},{selected:i===e.value});return n.createElement(s,{className:r,onClick:this.onClickFilter.bind(this,e,i)})},renderSearchFilter:function(e){return n.createElement("div",{key:e.name,className:"searchFilter flexbox"},n.createElement("div",{className:"menuItemText f1"},e.name[0].toUpperCase()+e.name.substring(1)),this.renderSearchButton(e,1),this.renderSearchButton(e,-1))},renderSearchPriorityButton:function(e,i){var r=t.classNames("searchPriorityButton c-border",{p0:i===VMLIFlag.P0},{p1:i===VMLIFlag.P1},{p2:i===VMLIFlag.P2},{selected:i===e.value});return n.createElement(s,{className:r,onClick:this.onClickFilter.bind(this,e,i)})},renderSearchPriority:function(e){return n.createElement("div",{key:e.name,className:"searchPriority flexbox"},this.renderSearchPriorityButton(e,VMLIFlag.P0),this.renderSearchPriorityButton(e,VMLIFlag.P1),this.renderSearchPriorityButton(e,VMLIFlag.P2))},render:function(){for(var e,t=this.props,i=t.pane.search,r=[],a=0;a<i.filters.length;a++){var s=i.filters[a];s.enabled.get()&&(s.icon?r.push(this.renderSearchFilter(s)):"priority"===s.name&&(e=this.renderSearchPriority(s)))}return n.createElement(c,_extends({},t,{key:"contextMenuMobileFilter",id:"contextMenuMobileFilter"}),n.createElement(o,{icon:"icon-close",display:"block",enabled:this.state.hasFilter,onClick:this.onClickClear},"Clear filters"),n.createElement("div",{className:"searchFilter filterTitle flexbox c-foreground-very-faded c-border"},n.createElement("div",{className:"menuItemText f1"},"Filter"),n.createElement("div",null,"Show"),n.createElement("div",null,"Hide")),r,e&&n.createElement("div",{className:"searchFilter filterTitle c-foreground-very-faded c-border"},"Minimum Priority"),e)}})}),define("ReactInviteSection",["require","globals","Constants","react","MooReact","NativeSel","Components/FancyButton","Components/FancyInput"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("NativeSel"),s=e("Components/FancyButton"),o=e("Components/FancyInput");return r.createClass({displayName:"ReactInviteSection",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},getState:function(){var e=t.billingManager;return{validBilling:e._hasValidBillingData,premiumStatus:e._premiumStatus,inviteEmailSuccess:e.inviteEmailSuccess,inviteEmailError:e.inviteEmailError,inviteCodeError:e.inviteCodeError}},onTapInviteUrl:function(e){var i=e.target;i!==document.activeElement&&(a.selectElement(i),e.preventDefault(),t.sendEvent("Billing","TapInviteUrl"))},inviteEmails:function(){for(var e=this.refs.inviteEmails.getTokens(),i=[],n=0;n<e.length;n++)i.push(e[n].email);t.billingManager.sendInviteEmail(i)},render:function(){var e=t.billingManager,i=this.state;return n.createElement("span",{className:"new-modal-group"},n.createElement("div",{className:"new-modal-title"},n.createElement("div",{className:"title"},"Share Moo.do with your friends"),n.createElement("div",{className:"subtext center"},"Thank you for spreading the ",n.createElement("i",{className:"icon-heart red"}))),n.createElement("div",{className:"new-modal-center"},n.createElement("div",null,n.createElement("div",{className:"subtitle"},"Social"),n.createElement("span",{className:"shareIcons"},n.createElement(s,{iconSize:22,icon:"icon-twitter",tooltip:"@MooDoApp",onClick:e.shareTwitter.bind(e)}),n.createElement(s,{iconSize:22,marginLeft:16,marginRight:16,icon:"icon-facebook",tooltip:"@MooDoApp",onClick:e.shareFacebook.bind(e)}),n.createElement(s,{iconSize:22,icon:"icon-google-plus",tooltip:"@MooDoApp",onClick:e.shareGoogle.bind(e)})),n.createElement("br",null),n.createElement("br",null),n.createElement("div",{className:"subtitle"},"Share Link"),n.createElement("div",{className:"subtext"},e.getSelectText()),n.createElement(o,{display:"inline-block",width:280,height:36,value:e.getInviteUrl(),onMouseDown:this.onTapInviteUrl,readonly:!0}),n.createElement("br",null),n.createElement("br",null),n.createElement("div",{className:"subtitle"},"Share by email"),n.createElement("div",{className:"subtext"},"Separate multiple email addresses with commas."),n.createElement(o,{ref:"inviteEmails",width:350,buttonWidth:70,height:36,autocompleteMode:"email",placeholder:"Add friends' email addresses",buttonText:"SEND",onButtonClick:this.inviteEmails}),(i.inviteEmailSuccess||i.inviteEmailError)&&n.createElement("div",{id:"inviteEmailMessage",className:t.classNames({success:i.inviteEmailSuccess},{error:i.inviteEmailError})},i.inviteEmailSuccess||i.inviteEmailError))))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuOptions",["require","globals","Constants","platform","react","MooReact","tracker","ReactInviteSection","Components/FancyContextMenu","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("tracker"),o=e("ReactInviteSection"),c=e("Components/FancyContextMenu"),l=e("Components/FancyContextMenuItem");return a.createClass({displayName:"ReactContextMenuOptions",componentDisplay:i.ComponentDisplay.Desktop,init:function(){},onClickSettings:function(){t.menus.openSettings()},onClickDisplaySettings:function(){t.menus.openDisplaySettings()},onClickImport:function(){s.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenImport}),t.menus.openModalNew(Modals.ImportData)},onClickExport:function(){s.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenExport}),t.menus.openModalNew(Modals.ExportData)},onClickRevision:function(){t.menus.openModalNew(Modals.RevisionHistory)},onClickFeedback:function(){t.menus.openModal(Modals.ReportBug)},onClickBlog:function(){t.openUrl("/blog/")},onClickLogout:function(){t.vmSetup.logoutClicked()},onClickShare:function(){t.menus.openContextMenuReact({fn:this.renderContextMenuHeart,element:this.props.element})},onClickDownloadApp:function(){t.openUrl(n.getAppDownloadURL())},renderContextMenuHeart:function(e){return r.createElement(c,{key:"contextMenuHeart",id:"contextMenuHeart",element:e.element},r.createElement(o,{shouldShowInvitedBy:!1}))},render:function(){var e=t.vmMain.getUserName();return r.createElement(c,_extends({},this.props,{key:"contextMenuOptions",id:"contextMenuOptions",supportArrows:!0}),r.createElement(l,{onClick:this.onClickSettings},"Settings"),r.createElement(l,{onClick:this.onClickDisplaySettings},"Display Settings"),r.createElement("hr",null),r.createElement(l,{onClick:this.onClickImport},"Import Data"),r.createElement(l,{onClick:this.onClickExport},"Export Data"),r.createElement(l,{onClick:this.onClickRevision},"Revision History"),r.createElement("hr",null),r.createElement(l,{onClick:this.onClickFeedback},"Contact Support"),r.createElement(l,{onClick:this.onClickBlog},"Moo.do Blog"),r.createElement(l,{onClick:this.onClickShare},"Share Moo.do"),n.canDownloadNativeApp()&&r.createElement(l,{onClick:this.onClickDownloadApp},"Get "+n.getPlatformName()+" app"),r.createElement("hr",null),r.createElement(l,{onClick:this.onClickLogout},"Logout"),r.createElement(l,{className:"username",faded:!0},e),r.createElement(l,{className:"useremail",faded:!0},t.getUserIdentifier()),n.isDevURL&&r.createElement(l,{className:"ver",faded:!0},window.__jsVersion))}})}),define("ReactContextMenus",["require","globals","Constants","platform","react","MooReact","DragDrop","ReactContextMenuSelectGmailAccount","ReactContextMenuAddItem","ReactContextMenuCalendars","ReactContextMenuInsertLink","ReactContextMenuContactDetails","ReactContextMenuMobileOpenLink","ReactNotePopup","ReactContextMenuDropBucket","ReactItemDetailsPopup","ReactContextMenuEmailDetails","ReactContextMenuItem","ReactContextMenuOnlineStatus","ReactContextMenuAddPane","ReactContextMenuAuthorize","ReactContextMenuMobileFilter","ReactContextMenuOptions"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=r.addons.CSSTransitionGroup,s=e("MooReact"),o=e("DragDrop");e("ReactContextMenuSelectGmailAccount"),e("ReactContextMenuAddItem"),e("ReactContextMenuCalendars"),e("ReactContextMenuInsertLink"),e("ReactContextMenuContactDetails"),e("ReactContextMenuMobileOpenLink"),e("ReactNotePopup"),e("ReactContextMenuDropBucket"),e("ReactItemDetailsPopup"),e("ReactContextMenuEmailDetails"),e("ReactContextMenuItem"),e("ReactContextMenuOnlineStatus"),e("ReactContextMenuAddPane"),e("ReactContextMenuAuthorize"),e("ReactContextMenuMobileFilter"),e("ReactContextMenuOptions");return s.createClass({displayName:"ReactContextMenus",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{},getState:function(){return{contextMenus:t.menus.contextMenuStack,noFade:t.menus.contextMenuNoFade,isDragging:o.isVisible}},close:function(e){t.menus.closeContextMenuReact(),e.preventDefault(),e.stopPropagation()},render:function(){for(var i=this.state,s=[],o=0;o<i.contextMenus.length;o++){var c=i.contextMenus[o];c.noBackdrop||s.push(r.createElement("div",{key:"backdrop_"+o,className:"contextMenusBackdrop",onMouseDown:!n.mobile&&this.close,onTouchStart:n.mobile&&this.close})),c.fn?s.push(c.fn(c)):c.componentName&&(c.key=c.key||c.componentName,c.id=c.id||c.key,s.push(r.createElement(e(c.componentName),c)))}var l=t.classNames("contextMenusReact",{open:s.length>0},{takeClick:s.length>0&&!c.noBackdrop},{none:0===s.length},{hideBackground:i.noFade||n.mobile&&i.isDragging});return r.createElement(a,{className:l,transitionName:"contextMenuAnim",transitionEnterTimeout:150,transitionLeaveTimeout:200},s)}})}),define("Components/FancyModal",["require","globals","Constants","platform","react","MooReact","Components/FancyScroller","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("Components/FancyScroller"),o=e("Components/FancyButton");return a.createClass({displayName:"FancyModal",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{id:r.PropTypes.string.isRequired,modalID:r.PropTypes.string.isRequired,width:r.PropTypes.number,height:r.PropTypes.number,title:r.PropTypes.string,backdropClose:r.PropTypes.bool},close:function(e){n.mobile&&t.closeKeyboard(),t.menus.closeModalNew(this.props.modalID,e)},onCloseButton:function(e){this.props.onCloseButton?this.props.onCloseButton():this.close()},onEscapeKey:function(){this.close()},render:function(){var e=this.props,i=this.getChildByKey("sidebar"),a=this.getChildByKey("content"),c=this.getChildByKey("buttons"),l={maxHeight:e.height?"95%":null},d=t.classNames("fancyModal c-bg-app popup c-shadow-popup",e.className,{"flexbox flexvert":!n.mobile},{small:e.small},{hasSidebar:!!i},{hasTitle:!!e.title},{hasButtons:!!c}),h=t.classNames("fancyModalWrapper",{"small flexbox":e.small}),u=t.classNames("fancyModalContent c-border c-background",{flex1:!n.mobile},a.props.className),p=n.mobile?t.topBarHeight:50,m=r.createElement(s,{className:u,scrollable:e.scrollable},a.props.children||a);if(n.mobile){var f,g;return e.confirmIcon?f=r.createElement(o,{className:"fancyModalMobileConfirm",icon:e.confirmIcon,iconSize:20,width:p,height:p,onClick:e.onConfirm}):e.confirmText&&(f=r.createElement(o,{className:"fancyModalMobileConfirm",width:e.topButtonWidth,fontSize:14,height:p,onClick:e.onConfirm},e.confirmText)),!1!==e.closeButton&&(g=t.isString(e.closeButton)?r.createElement(o,{className:"fancyModalClose",width:e.topButtonWidth,fontSize:14,height:p,onClick:this.onCloseButton},e.closeButton):r.createElement(o,{className:"fancyModalClose",icon:"icon-close",iconSize:20,width:p,height:p,onClick:this.onCloseButton})),r.createElement("span",{className:h},r.createElement("div",{className:d,style:l,id:e.id},r.createElement("div",{className:"flexbox"},g,r.createElement("div",{className:"fancyModalTitle f1"},e.title),f),m,c&&r.createElement("div",{className:t.classNames("fancyModalButtons",{border:e.buttonsBorder})},c)))}e.small||(l.width=e.width,l.height=e.height,l.minWidth=e.minWidth);var v;if(i){var y={width:i.props.width||180};v=r.createElement("div",{className:"fancyModalSidebar",style:y},i.props.children)}return r.createElement("span",{className:h},r.createElement("div",{className:"fancyModalBackdrop",onClick:!1!==e.backdropClose&&this.close.bind(this,!1)}),r.createElement("div",{className:d,style:l,id:e.id},!1!==e.closeButton&&r.createElement(o,{className:"fancyModalClose",icon:"icon-close",iconSize:20,width:p,height:p,onClick:this.onCloseButton,tooltip:"Close"}),e.title&&r.createElement("div",{className:"fancyModalTitle"},e.title),r.createElement("div",{className:"fancyModalInside flexbox flex1"},v,r.createElement("div",{className:"fancyModalContentArea c-border c-background flexbox flexvert f1"},m,c&&r.createElement("div",{className:t.classNames("fancyModalButtons c-background",{border:e.buttonsBorder})},c)))))}})}),define("Components/FancyLoader",["require","react","globals"],function(e){var t=e("react"),i=e("globals");return function(e){var n={},r=e.size||20,a=e.size||20,s={fontSize:r,height:a,width:a,lineHeight:a+"px"};(e.top||e.left)&&(n.position="absolute",n.left=e.left||"50%",n.top=e.top||"50%",s.marginLeft=-r/2,s.marginTop=-r/2+20);var o=i.classNames("fancyLoader",{center:e.center},{inline:e.inline});return t.createElement("div",{className:o,style:n},t.createElement("div",{className:"icon-spinner",style:s}),e.children&&t.createElement("div",{className:"fancyLoaderText"},e.children))}}),define("ReactModalLightbox",["require","globals","Constants","platform","react","MooReact","Components/FancyModal","Components/FancyButton","Components/FancyLoader"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("Components/FancyModal"),o=e("Components/FancyButton"),c=e("Components/FancyLoader");return a.createClass({displayName:"ReactModalLightbox",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.createObservables({isLoaded:!1,error:!1})},onLoaded:function(){this.isLoaded.set(!0)},onError:function(){this.isLoaded.set(!0,!1),this.error.set("Could not load image")},openExternal:function(){this.props.buttonAction?this.props.buttonAction():t.openUrl(this.props.src),this.close()},close:function(){this.refs.modal.close()},render:function(){var e=this.props,i=this.state,a=e.src,l=Math.min(.95*n.windowWidth(),900),d=Math.min(.95*n.windowHeight()-30,900),h={maxWidth:l,maxHeight:d,visibility:!i.isLoaded&&"hidden"},u=t.classNames({loaded:i.isLoaded});return r.createElement(s,{id:"modalLightbox",className:u,closeButton:!1,scrollable:!1,modalID:Modals.Lightbox,ref:"modal"},r.createElement("div",{key:"content"},!i.isLoaded&&r.createElement(c,{center:!0}),!i.error&&r.createElement("img",{src:a,style:h,onLoad:this.onLoaded,onError:this.onError,onClick:this.close,ref:"image"}),i.error&&r.createElement("div",{className:"lightboxText"},i.error),i.isLoaded&&r.createElement(o,{id:"lightboxOpen",className:"c-border-heavy",primary:!0,height:30,onClick:this.openExternal},e.buttonText||(n.app?"Open in browser":"Open in new tab"))))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalPrompt",["require","react","MooReact","Hotkeys","Constants","Components/FancyButton","Components/FancyInput","Components/FancyModal"],function(e){var t=e("react"),i=e("MooReact"),n=e("Hotkeys"),r=e("Constants"),a=e("Components/FancyButton"),s=e("Components/FancyInput"),o=e("Components/FancyModal");return i.createClass({displayName:"ReactModalPrompt",componentDisplay:r.ComponentDisplay.Everywhere,propTypes:{text:t.PropTypes.string.isRequired},getHotkeys:function(){return[n.create(KeyCode.Enter,!0,r.Primary.Either,r.Shift.Either,this.onClickYes)]},onClickYes:function(){this.refs.modal.close(this.refs.input.getValue())},onClickNo:function(){this.refs.modal.close(!1)},render:function(){return t.createElement(o,_extends({},this.props,{id:"modalPrompt",title:this.props.text,small:!0,scrollable:!1,modalID:Modals.Prompt,ref:"modal"}),t.createElement("div",{key:"content"},t.createElement(s,{focused:!0,ref:"input"})),t.createElement("div",{key:"buttons"},t.createElement(a,{primary:!0,width:100,onClick:this.onClickYes},"OK"),t.createElement(a,{width:100,onClick:this.onClickNo},"NO")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalMobileSettings",["require","react","platform","MooReact","globals","Constants","goog","PluginSettings","AccountManager","International","Components/FancyCheckbox","Components/FancyButton","Components/FancyModal"],function(e){var t=e("react"),i=e("platform"),n=e("MooReact"),r=e("globals"),a=e("Constants"),s=e("goog"),o=e("PluginSettings"),c=e("AccountManager"),l=e("International"),d=e("Components/FancyCheckbox"),h=e("Components/FancyButton"),u=e("Components/FancyModal");return n.createClass({displayName:"ReactModalEmailCompose",componentDisplay:a.ComponentDisplay.Mobile,init:function(){o.refresh();for(var e={enableOfflineAuth:o.enableOfflineAuth.get(),enableNotifications:!r.settings.get(Settings.disableNotifications)},t=o.pluginsAvailable,i=0;i<t.length;++i){var n=t[i];e[n+"Enabled"]=o.isPluginEnabled(n)}this.createObservables(e),this.listenTo(c.onAccountsUpdated)},getState:function(){return{isLoggedIn:!0,driveStatus:r.vmMain.gdriveStatusObs,hasPremiumFeatures:r.billingManager.hasPremiumFeaturesObservable,gmailSyncAccounts:o.GmailSyncAccounts,linkedAccounts:c.getLinkedAccounts()}},onSaveButton:function(){var e=o.pluginsAvailable,t=this.state;t.enableNotifications!==!r.settings.get(Settings.disableNotifications)&&o.toggleNotifications()
;var n=[PluginID.Contacts,PluginID.Gmail],a=n.filter(function(e){var i=e+"Enabled";return t[i]&&t[i]!==o.isPluginEnabled(e)}.bind(this)).map(function(e){return{id:e}}.bind(this));if(a.length>0){var s=t.enableOfflineAuth||i.mobile;o.enablePlugins(a,s,function(e){}.bind(this))}t.enableOfflineAuth||t.enableOfflineAuth===o.enableOfflineAuth.get()||o.toggleOfflineFeatures(!1);for(var c=0;c<e.length;++c){var l=e[c],d=l+"Enabled";t[d]||t[d]===o.isPluginEnabled(l)||o.togglePlugin(l)}this.refs.modal.close()},onClickSendFeedback:function(){r.menus.openModal(Modals.ReportBug),r.sendEvent("Menu","GiveFeedback")},onClickReauthorize:function(){o.toggleOfflineFeatures(!0)},onClickReconnect:function(){r.reload()},onClickLogout:function(){r.vmSetup.logoutClicked()},renderPluginOptionCheckbox:function(e,i,n){return t.createElement(d,{checked:this[e+"_"+i],setObs:!0},n)},renderPluginCheckbox:function(e,i,n){var r=e+"Enabled";return t.createElement(d,{checked:this[r],setObs:!0},n,i)},linkAccount:function(e,t,i){var n=[GScope.UserInfoEmail];return n.pushArray(t),s.linkAccount(e,n,i)},removeAccount:function(e){var t=r.vmMain.pluginManager.getPlugin(PluginID.Gmail);c.removeLinkedAccount(e,function(t){t||r.toasts.pushMessage({text:"There was an error unlinking your account.",actionText:"RETRY",action:this.removeAccount.bind(this,e)})}.bind(this)),t.hasSyncAccount(e)&&t.removeSyncAccount(e,function(){o.refresh()})},enableGmailSync:function(e,t){var i=r.vmMain.pluginManager.getPlugin(PluginID.Gmail),n=function(){o.refresh()}.bind(this);t?this.linkAccount(e,[GScope.GmailCompose,GScope.GmailModify],function(e,t){e?i.addSyncAccount(t,function(e){e||n(),o.refresh()}):n()}):i.removeSyncAccount(e,function(e){e||n(),o.refresh()})},renderAccount:function(e){var i=r.vmMain.pluginManager.getPlugin(PluginID.Gmail).isEnabled(),n=this.state.gmailSyncAccounts.indexOf(e)>=0,a=n&&c.isConnected()&&(!c.isAuthorized(e,GScope.GmailCompose)||!c.isCurrentlyAuthorized(e)),s=r.classNames("accountRow");return t.createElement("div",{key:"row"+e,className:s},t.createElement(d,{disabled:!i,checked:n&&!a,error:a,onChange:this.enableGmailSync.bind(this,e)},t.createElement(h,{icon:"icon-close",iconSize:20,display:"inline",width:50,height:50,onClick:this.removeAccount.bind(this,e)}),t.createElement("span",null,e)))},renderAccounts:function(){return this.getAccountList().map(this.renderAccount)},getAccountList:function(){var e=[];e.pushOnlyUniques(this.state.linkedAccounts),e.pushOnlyUniques(this.state.gmailSyncAccounts);var t=c.getDefaultEmail();return e.filter(function(e){return e!==t})},render:function(){var e,i=this.props,n=this.state,a=r.billingManager,s=(a.isTrialState(),[]);return t.createElement(u,_extends({},i,{id:"modalMobileSettings",title:"Settings",modalID:Modals.MobileSettings,ref:"modal",topButtonWidth:80,closeButton:"CANCEL",confirmText:"SAVE",onConfirm:this.onSaveButton}),t.createElement("div",{key:"content"},t.createElement("div",{className:"modalSection"},t.createElement("div",{className:"modalSectionTitle"},"OPTIONS"),t.createElement("div",{className:"modalSectionList"},t.createElement(d,{checked:this.enableNotifications,setObs:!0},"Notifications"))),t.createElement("div",{className:"modalSection"},t.createElement("div",{className:"modalSectionTitle"},"PLUGINS"),t.createElement("div",{className:"modalSectionList featureCheckboxes"},this.renderPluginCheckbox(PluginID.Contacts,"Google Contacts",t.createElement("i",{className:"icon-group"})),n[PluginID.Contacts+"Enabled"]&&t.createElement(h,{height:44,primary:!0},"Refresh Contacts"),this.renderPluginCheckbox(PluginID.Gmail,"Gmail",t.createElement("img",{src:"/img/plugin-gmail.png"})))),s.length>0&&t.createElement("div",{className:"modalSection"},t.createElement("div",{className:"modalSectionTitle"},"LINKED ACCOUNTS"),t.createElement("div",{className:"modalSectionList featureCheckboxes"},s)),t.createElement("div",{className:"modalSection"},t.createElement("div",{className:"modalSectionTitle"},"ACTIONS"),t.createElement("div",{className:"modalSectionList"},t.createElement(h,{height:44,primary:!0,onClick:this.onClickReauthorize},"Reauthorize"),t.createElement(h,{height:44,primary:!0,onClick:this.onClickSendFeedback},"Contact Support"),n.isLoggedIn&&t.createElement(h,{height:44,primary:!0,onClick:this.onClickReconnect},"Force Reconnect"),t.createElement(h,{height:44,primary:!0,enabled:r.vmMain.isOnline(),onClick:this.onClickLogout},"Logout"))),t.createElement("div",{className:"modalSection"},t.createElement("div",{className:"modalSectionTitle"},"ACCOUNT STATUS"),t.createElement("div",{className:"modalSectionList modalSectionText g"},a.hasPremium()&&t.createElement("div",{className:"text"},"Premium since ",a.getPremiumStartDate().toString(l.getFormat(DFormat.LongStrDate))),t.createElement("div",{className:"text"},"Logged in as ",r.billingManager.getBillingIdentifier()),t.createElement("div",{className:"text"},"Please open Moo.do on your computer to modify your account."))),e))}})}),define("Components/FancyProgressBar",["require","Constants","globals","platform","react","MooReact","Components/FancyButton"],function(e){var t=e("Constants"),i=(e("globals"),e("platform")),n=e("react"),r=e("MooReact");e("Components/FancyButton");return r.createClass({displayName:"FancyProgressBar",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{percent:n.PropTypes.number.isRequired},render:function(){var e=this.props,t={height:e.height},r={};r[i.transform.react]="scale("+e.percent+", 1)";var a={lineHeight:e.height-2+"px"};return n.createElement("div",{className:"fancyProgressBar",style:t},!e.error&&n.createElement("div",{className:"fancyProgressInside",style:r}),e.error&&n.createElement("div",{className:"fancyProgressError",style:a},e.errorMsg))}})}),define("ReactMessageAttachments",["require","globals","Constants","platform","react","MooReact","DesktopUI","DragDrop","EmailPreview","Components/FancyProgressBar","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=(e("DesktopUI"),e("DragDrop")),o=e("EmailPreview"),c=e("Components/FancyProgressBar"),l=e("Components/FancyButton");return a.createClass({displayName:"ReactMessageAttachments",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{threadAttach:r.PropTypes.object.isRequired,message:r.PropTypes.object.isRequired,editable:r.PropTypes.bool.isRequired},init:function(){this.props.threadAttach.subscribe(this)},onUnmount:function(){this.props.threadAttach.unsubscribe(this)},onAttachmentUpdate:function(){this.updateState()},onAttachmentIDChange:function(){},getState:function(){return{attachments:this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message)}},isAttachImage:function(e){var t=e.mimeType;return"image/png"===t||"image/jpg"===t||"image/jpeg"===t||"image/gif"===t},onClickAttach:function(e,i){if(e.error)e.uploader&&!e.uploader.isDone()&&e.uploader.resume();else if(!e.uploader||e.uploader.isDone()){var r=this._getURL(e);this.props.editable?t.openUrl(r):e.attID?n.mac&&i.metaKey||!n.mac&&i.ctrlKey||!this.isAttachImage(e)||n.mobile?t.downloadFile(r,e.cid):t.menus.openLightbox(r,"Download",function(){t.downloadFile(r,e.cid)}):t.openUrl(r)}i.stopPropagation()},onClickDelete:function(e,t){var i=this.props.threadAttach.getPlugin(),n=i.removeAttachFiles(this.props.threadAttach,this.props.message,e);this.props.onUpdate&&this.props.onUpdate(n),t.stopPropagation()},onAttachDragStart:function(e){var t=e.target.getAttribute("data-downloadurl");e.stopPropagation(),e.dataTransfer.setData("DownloadURL",t),s.setExternalData(t)},_getURL:function(e){return this.props.editable||!e.attID?o.getPreviewURL(e):o.getAttachmentURL(this.props.threadAttach.getField("accountID"),this.props.message.id,e.attID)},_renderAttachment:function(e){var i=e.mimeType+":"+e.cid+":"+this._getURL(e),a=e.uploader?t.clamp(e.uploader.getPercent(),.05,1):1,s=this.isAttachImage(e)?"Click to open image.\n"+n.priModKey+" click to download image.":"Click to download image";return r.createElement("div",{key:e.id,className:"messageAttachment flexbox c-button-raised",draggable:!0,"data-downloadurl":i,onClick:this.onClickAttach.bind(this,e),onDragStart:this.onAttachDragStart,"data-tooltip":s},r.createElement("div",{className:"attachmentIcon icon-drive-file"}),r.createElement("div",{className:"attachmentText"},e.cid),r.createElement("div",{className:"f1"}),a<1&&r.createElement(c,{percent:a,height:22,error:e.error,errorMsg:"Click to retry"}),1===a&&e.error&&r.createElement("div",null,"ERROR"),r.createElement("div",{className:"attachmentSize"},t.toFileSize(e.size)),this.props.editable&&r.createElement(l,{className:"attachmentClose",icon:"icon-close",onClick:this.onClickDelete.bind(this,e),tooltip:"Remove"}))},render:function(){var e=null,t=this.state.attachments;if(t.length>0){for(var i=[],n=0;n<t.length;++n){var a=t[n];i.push(this._renderAttachment(a))}e=r.createElement("div",{className:"messageAttachments c-border"},i)}return e}})}),define("Components/FancyContenteditable",["require","globals","Constants","react","MooReact","NativeSel"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("NativeSel");return r.createClass({displayName:"FancyContenteditable",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{spellCheck:n.PropTypes.bool,focused:n.PropTypes.bool,value:n.PropTypes.string,onFocus:n.PropTypes.func,onBlur:n.PropTypes.func},init:function(){this.createObservables({isFocused:this.props.focused||!1})},componentDidMount:function(){this.props.focused&&requestAnimationFrame(function(){this.refs.div.focus()}.bind(this))},onUnmount:function(){this.isFocused.get()&&this.onBlur()},focus:function(){t.isDemoRunning||this.refs.div.focus()},blur:function(){this.refs.div.blur()},setValue:function(e){this.refs.div.innerHTML=e},getValue:function(){return this.refs.div.innerHTML},getTextValue:function(){return this.refs.div.innerText},getElement:function(){return this.refs.div},insertCharAtIndex:function(e,t){var i=this.refs.div,n=i.innerHTML;n=n.substr(0,t)+e+n.substr(t,n.length),i.innerHTML=n,a.selectElement(i,t+1),this.props.onChange&&this.props.onChange()},onFocus:function(e){t.vmMain.activeInput.set(this),this.isFocused.set(!0),this.props.onFocus&&this.props.onFocus(e)},onBlur:function(e){t.vmMain.activeInput.set(null),this.isFocused.set(!1),this.props.onBlur&&this.props.onBlur(e)},hasFocus:function(){return this.isFocused.get()},onEscapeKey:function(){this.props.onEscape&&this.props.onEscape()},onDrop:function(e){this.props.onDrop&&this.props.onDrop(e.dataTransfer)},onDragEnter:function(){this.props.onDrop&&t.addClass(this.refs.div,"dragTarget")},onDragLeave:function(){this.props.onDrop&&t.removeClass(this.refs.div,"dragTarget")},insertNode:function(e){this.focus(),a.deleteRangeContents(),a.insertNode(e),a.selectAfterNode(e)},render:function(){var e=this.props,i=t.classNames("fancyContenteditable",e.className),r=e.spellCheck?"true":null;return n.createElement("div",{contentEditable:!1!==e.editable,className:i,style:this.props.style,ref:"div",spellCheck:r,onInput:e.onChange,onClick:e.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave})}})}),define("ReactEmailCompose",["require","globals","Constants","platform","react","MooReact","Sel","EmailHTML","EmailPreview","NativeSel","Hotkeys","DragDrop","ReactMessageAttachments","AccountManager","Components/FancyInput","Components/FancyContenteditable","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("Sel"),o=e("EmailHTML"),c=e("EmailPreview"),l=e("NativeSel"),d=e("Hotkeys"),h=e("DragDrop"),u=e("ReactMessageAttachments"),p=e("AccountManager"),m=e("Components/FancyInput"),f=e("Components/FancyContenteditable"),g=e("Components/FancyButton");return a.createClass({displayName:"ReactEmailCompose",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{threadAttach:r.PropTypes.object.isRequired,message:r.PropTypes.object.isRequired,onClose:r.PropTypes.func.isRequired},init:function(){var e=this.props;this._dragEnterCounter=0,this._escapedFromDrag=!1,this.to=this._createTokensFromAddressText(e.message.to),this.cc=this._createTokensFromAddressText(e.message.cc);var i=!!e.message.cc&&e.message.cc.length>0;if(this.createObservables({showSubject:e.showSubject||n.mobile,showCc:i,showBcc:!1,isSending:!1,isDragOver:!1}),this.listenTo(p.onAccountsUpdated),this.props.message.inReplyTo){var r=this.props.threadAttach.getData().messages,a=r.indexOfWithProperty("messageID",this.props.message.inReplyTo);if(a>=0){var s=r[a];try{t.PAssert(5233,s.initializedForDisplay,"Message must be ready to display if being replied to")}catch(e){t.reportError(e)}s&&s.responseMode&&(this.modeListener=s.responseMode.listen(this.onReplyModeChanged))}}t.isDemoMode()&&(t.reactEmailCompose=this)},onReplyModeChanged:function(){this.to=this._createTokensFromAddressText(this.props.message.to),this.cc=this._createTokensFromAddressText(this.props.message.cc),this.cc&&this.cc.tokens&&this.cc.tokens.length>0&&this.showCc.set(!0),this.updateState()},_getHotkeys:function(){return[d.create(KeyCode.Escape,!0,i.Primary.Either,i.Shift.Either,this.onEscape),d.create(KeyCode.Enter,!0,i.Primary.Yes,i.Shift.Either,this.send),d.create(KeyCode.K,!0,i.Primary.Yes,i.Shift.No,this.insertLinkHotkey)]},getState:function(){return{attachments:this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message),fromAccounts:this.getSendingAccounts()}},componentDidMount:function(){var e=this._getComposeBody(this.props.message);e&&this.refs.body.setValue(e),this.refs.container.addEventListener("cdrop",this.onItemDrop);var t=this;this.refs.picker.addEventListener("change",function(){return t.props.threadAttach.getPlugin().notifyAttachFiles(t.props.threadAttach,t.props.message,this.files,t.onAttachUpdated),this.value=null,!1},!1),this.refs.container.addEventListener("paste",function(e){var i=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;if(i&&i.items&&i.items.length>0){for(var n=[],r=0;r<i.items.length;++r)"file"===i.items[r].kind&&n.push(i.items[r].getAsFile());if(n.length>0){return t.props.threadAttach.getPlugin().notifyAttachFiles(t.props.threadAttach,t.props.message,n,t.onAttachUpdated),!1}}},!1),n.mobile||(document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown))},onUnmount:function(){this.modeListener&&(this.modeListener.dispose(),this.modeListener=void 0),this._clearDraftDebounce(!0,!0),n.mobile||document.removeEventListener("mouseup",this.onMouseUp)},discard:function(){this.close(!1,!0,!0)},onEscape:function(){this.isDragOver.get()||(this.refs.to.getTokens().length>0||this.refs.body.getValue()||this.state.attachments.length>0?t.menus.confirm("Do you want to discard this draft?",function(e){e&&this.discard()}.bind(this)):this.discard())},send:function(){this.onClickSend()},onFocus:function(){this.__hotkeys||(this.__hotkeys=d.pushStack(this._getHotkeys())),s.clearSelection()},onBlur:function(){this.__hotkeys&&(d.popStack(this.__hotkeys),this.__hotkeys=void 0)},onClickAttach:function(){this.refs.picker.click()},onAttachUpdated:function(e){this._isMounted&&(this.onDraftChanged(),e&&this._clearDraftDebounce(!0,!0),this.updateState())},onDragEnter:function(e){e.preventDefault(),this._escapedFromDrag||(this._dragEnterCounter++,this.isDragOver.set(!0))},onDragLeave:function(){0===--this._dragEnterCounter&&this.isDragOver.set(!1)},onMouseUp:function(){this._escapedFromDrag=!1,this.isDragOver.set(!1)},onKeyDown:function(e){e.keyCode===KeyCode.Escape&&this.isDragOver.get()&&(this._escapedFromDrag=!0,this.isDragOver.set(!1))},onFileDrop:function(e){if(!this._escapedFromDrag){this.isDragOver.set(!1);var t=e.dataTransfer;if(t.files&&t.files.length>0){this.props.threadAttach.getPlugin().notifyAttachFiles(this.props.threadAttach,this.props.message,t.files,this.onAttachUpdated.bind(this)),e.preventDefault(),e.stopPropagation(),h.stop(),h.finish()}}},onItemDrop:function(e){if(e.item&&e.item.hasAttachmentType(i.PluginType.Storage)){var t=e.item.getAttachmentByType(i.PluginType.Storage);this.props.threadAttach.getPlugin().notifyAttachLinkedFile(this.props.threadAttach,this.props.message,t,this.onAttachUpdated.bind(this))}},close:function(e,i,n){try{t.PAssert(5234,t.isBoolean(e),"Must supply a valid value for sendDraft")}catch(e){t.reportError(e)}try{t.PAssert(5235,t.isBoolean(i),"Must supply a valid value for discardDraft")}catch(e){t.reportError(e)}try{t.PAssert(5236,t.isBoolean(n),"Must supply a valid value for forceFlush")}catch(e){t.reportError(e)}this._clearDraftDebounce(e,n),!e&&i&&this._discardDraftUpdates(),this.props.onClose()},_clearDraftDebounce:function(e,t){this._draftUpdateDebounce&&(clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._saveDraftUpdates(e,t))},openSubject:function(){this.showSubject.set(!0),setTimeout(function(){this._setFocus(this.refs.subject),this.refs.subject.selectEnd()}.bind(this),0)},openCc:function(){this.showCc.set(!0),setTimeout(function(){this._setFocus(this.refs.cc)}.bind(this),0)},openBcc:function(){this.showBcc.set(!0),setTimeout(function(){this._setFocus(this.refs.bcc)}.bind(this),0)},focusTo:function(){this._setFocus(this.refs.to)},focusBody:function(){this._setFocus(this.refs.body)},_setFocus:function(e){e.isFocused.get()||e.focus()},_createTokensFromAddressText:function(e){var t=[];if(e)for(var i=0;i<e.length;i++){var n=e[i];n.text?t.push(n):n.email&&t.push({email:n.email,text:n.email})}return{tokens:t}},onClickSend:function(){var e=this.props,n=this.refs,r=function(n,r){n?this.close(!1,!1,!0):(t.isHTTPStatusCode(r,i.HTTPStatusCode.Network)?t.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:MessageAction.Okay,hold:!0}):r&&t.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:MessageAction.Okay}),this.isSending.set(!1)),c.ensureDisplayMessages(e.threadAttach)}.bind(this),a=function(t){if(t){this._clearDraftDebounce(!1,!1),l.clearSelection(),this.isSending.set(!0);e.threadAttach.getPlugin().sendDraft(e.threadAttach,e.message.id,e.message.draftID,void 0,r)||this.isSending.set(!1)}}.bind(this);n.subject&&!n.subject.getValue()?t.menus.confirm("There is no email subject, send anyway?",a):n.body.getValue()?a(!0):t.menus.confirm("There is no email body, send anyway?",a)},onDraftChanged:function(){clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._isMounted&&(this._draftUpdateDebounce=setTimeout(this._saveDraftUpdates.bind(this,!0,!1),1e3))},_saveDraftUpdates:function(e,i){if(this._isMounted){var n=this.refs,r=this.props,a=n.to.getTokens(),s=n.cc&&n.cc.getTokens(),o=n.bcc&&n.bcc.getTokens(),c=n.subject&&n.subject.getValue()||this.props.message.subject,l=n.body.getValue()||"(no text)",d=n.body.getTextValue()||"(no text)",h={to:a,cc:s,bcc:o,subject:c,body:l};r.threadAttach.getPlugin().updateDraft(r.threadAttach,r.message.id,r.message.draftID,h,d,e,i,function(e){try{t.PAssert(5237,e,"Should always be able to update a draft")}catch(e){t.reportError(e)}}),clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0}},_discardDraftUpdates:function(){this.props.threadAttach.getPlugin().discardDraft(this.props.threadAttach,this.props.message.id,this.props.message.draftID,function(e){try{t.PAssert(5238,e,"Should always be able to delete a draft")}catch(e){t.reportError(e)}})},_getComposeBody:function(e){var t;return e&&e.decoded&&(t=o.getComposeBody(e.decoded,e.resources)),t},onChangeFrom:function(){var e=this.refs.from.value,i=this.props.threadAttach,n=i.getPlugin(),r=n.getSyncAccount(e),a=n.getSendingAccountInfo(e),s=!!this.props.message.inReplyTo;s?this._clearDraftDebounce(!1,!1):this.close(!1,!1,!1);var o=n.changeMessageAccount(i,this.props.message.id,this.props.message.draftID,r,e,a),c=o?o.threadID:i.id;s||t.menus.openComposeEmail(n,c),this.refs.body.setValue(this._getComposeBody(this.props.message))},getSendingAccounts:function(){var e,t=this.props.threadAttach.getPlugin();return this.props.message.inReplyTo&&(e=this.props.threadAttach.getField("accountID")),t.getSendingAccounts(e)},getFromAccount:function(){var e=this.state.fromAccounts;return e.length<2?e[0]:this.refs.from.value},insertLinkHotkey:function(){this.refs.body.hasFocus()&&this.insertLink()},insertLink:function(){var e=l.getSelectedText(),i=this.refs.buttonLink.getElement();this.savedSel=l.getSelectionRange(),t.menus.openContextMenuReact({componentName:"ReactContextMenuInsertLink",element:i,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:e})},onInsertLinkClosed:function(){this.savedSel&&(this.refs.body.focus(),l.setSelectionRange(this.savedSel))},onInsertLink:function(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.refs.body.insertNode(t)},render:function(){var e=this.state,i=this.props,a=this.to,s=this.cc,o="(no subject)"===i.message.subject?"":i.message.subject,c=this.state.showCc||this.cc&&this.cc.length>0,l=(n.mobile?16:8)+(c?0:28)+(e.showBcc?0:34),d=i.message.from.email,h=e.fromAccounts.slice(0),p=e.fromAccounts.length>1,v={},y=t.classNames("emailCompose validDropTarget flexbox flexvert",i.className);h.remove(d),h.unshift(d);var b,S=t.classNames("composeHeader",{showingFrom:e.fromAccounts.length>1});return n.mobile&&(b={paddingBottom:n.getKBSize()}),i.hidden&&(v.height=0,v.paddingTop=0,v.overflow="hidden"),r.createElement("div",{className:y,style:v,ref:"container",onFocus:this.onFocus,onBlur:this.onBlur,onDrop:this.onFileDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave},r.createElement("div",{className:S},r.createElement("div",{className:"composeButtons"},!e.showSubject&&r.createElement(g,{height:24,padding:6,onClick:this.openSubject},"Subject"),!c&&r.createElement(g,{height:24,padding:6,onClick:this.openCc},"Cc"),!e.showBcc&&r.createElement(g,{height:24,padding:6,onClick:this.openBcc},"Bcc")),r.createElement(m,{className:"toBox",height:50,floatingText:"To",display:"block",ref:"to",tokens:a.tokens,focused:"to"===this.props.focus,autocompleteMode:"email",padding:{right:0},margin:{right:l},onChange:this.onDraftChanged,onEscape:i.onEscape}),c&&r.createElement(m,{height:50,floatingText:"Cc",display:"block",ref:"cc",tokens:s.tokens,autocompleteMode:"email",padding:i.paddingInput,onChange:this.onDraftChanged,onEscape:i.onEscape}),e.showBcc&&r.createElement(m,{height:50,floatingText:"Bcc",display:"block",ref:"bcc",autocompleteMode:"email",padding:i.paddingInput,onChange:this.onDraftChanged,onEscape:i.onEscape}),e.showSubject&&r.createElement(m,{height:50,floatingText:"Subject",display:"block",ref:"subject",value:o,padding:i.paddingInput,onChange:this.onDraftChanged,onEscape:i.onEscape}),p&&r.createElement("div",{className:"composeFrom"},r.createElement("span",null,"From"),r.createElement("select",{ref:"from",onChange:this.onChangeFrom},h.map(function(e){return r.createElement("option",{key:e,value:e},e)})))),r.createElement(f,{className:"emailComposeTextarea c-border-heavy f1",ref:"body",style:b,onChange:this.onDraftChanged,spellCheck:!0,onEscape:i.onEscape,editable:!e.isSending}),r.createElement(u,{onUpdate:this.onAttachUpdated,threadAttach:i.threadAttach,message:i.message,editable:!0}),!n.mobile&&r.createElement("div",{className:"composeFooter"},r.createElement(g,{className:"discardDraft",icon:"icon-delete",iconSize:20,onClick:this.discard,tooltip:"Discard Draft"}),r.createElement(g,{className:"attachFile",icon:"icon-attach_file",iconSize:20,marginLeft:8,onClick:this.onClickAttach,tooltip:"Attach File"}),r.createElement(g,{className:"insertLink",icon:"icon-link",iconSize:20,marginLeft:8,onClick:this.insertLink,ref:"buttonLink",tooltip:"Insert Link"}),r.createElement(g,{className:"buttonSend",primary:!0,marginLeft:16,onClick:this.onClickSend},"SEND")),r.createElement("input",{type:"file",ref:"picker",className:"hidden",multiple:!0}),e.isDragOver&&r.createElement("div",{className:"dropNotice flexbox flex-center"},r.createElement("div",{className:"dropBg absFull"}),r.createElement("div",{className:"f1 center"},r.createElement("div",{className:"icon-attach_file"}),r.createElement("div",null,"Drop to attach"))),e.isSending&&r.createElement("div",{className:"clickBlocker flexbox flex-center c-bg-faded"},r.createElement("div",{className:"f1 center c-foreground"},"Sending...")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalEmailCompose",["require","react","MooReact","Constants","globals","EmailPreview","ReactEmailCompose","Components/FancyButton","Components/FancyModal"],function(e){var t=e("react"),i=e("MooReact"),n=e("Constants"),r=e("globals"),a=(e("EmailPreview"),e("ReactEmailCompose")),s=(e("Components/FancyButton"),e("Components/FancyModal"));return i.createClass({displayName:"ReactModalEmailCompose",componentDisplay:n.ComponentDisplay.Everywhere,propTypes:{},onClickSend:function(){this.refs.compose.send(),this.refs.modal.close()},onComposeClose:function(){r.menus.closeContextMenuReact(),this.refs.modal&&this.refs.modal.close()},onCloseButton:function(){this.refs.compose.discard()},render:function(){var e=this.props;return t.createElement(s,_extends({},e,{id:"modalEmailCompose",title:"New Message",modalID:Modals.EmailCompose,ref:"modal",confirmIcon:"icon-send",onConfirm:this.onClickSend,onCloseButton:this.onCloseButton}),t.createElement(a,{key:"content",threadAttach:e.threadAttach,message:e.message,ref:"compose",onClose:this.onComposeClose,showSubject:!0,focus:"to"}))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalEmailReply",["require","react","MooReact","Constants","EmailPreview","ReactEmailCompose","Components/FancyButton","Components/FancyModal"],function(e){var t=e("react"),i=e("MooReact"),n=e("Constants"),r=e("EmailPreview"),a=e("ReactEmailCompose"),s=(e("Components/FancyButton"),e("Components/FancyModal"));return i.createClass({displayName:"ReactModalEmailReply",componentDisplay:n.ComponentDisplay.Everywhere,propTypes:{},componentDidMount:function(){var e=this.props,t=this.refs.compose;setTimeout(function(){e.responseMode===n.EmailResponseMode.Forward?t.focusTo():t.focusBody()},250)},onUnmount:function(){r.setMessageResponseMode(this.props.inReplyToMessage.id,n.EmailResponseMode.None)},onClickSend:function(){this.refs.compose.send(),this.refs.modal.close()},onComposeClose:function(){var e=this.refs.modal;e&&e.close()},onCloseButton:function(){this.refs.compose.discard()},_getModalTitle:function(e){var t;return e===n.EmailResponseMode.Reply?t="Reply":e===n.EmailResponseMode.ReplyAll?t="Reply All":e===n.EmailResponseMode.Forward?t="Forward":e===n.EmailResponseMode.Other&&(t="Compose"),t},render:function(){var e=this.props,i=e.responseMode,n=this._getModalTitle(i);return t.createElement(s,_extends({},e,{id:"modalEmailReply",title:n,modalID:Modals.EmailReply,ref:"modal",confirmIcon:"icon-send",onConfirm:this.onClickSend,onCloseButton:this.onCloseButton}),t.createElement(a,{key:"content",threadAttach:e.threadAttach,message:e.message,ref:"compose",onClose:this.onComposeClose,responseMode:this.state.responseMode}))}})}),define("Components/FancyInputNumber",["require","globals","Constants","platform","react","MooReact","Autocomplete","Sel","NativeSel"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("react")),r=e("MooReact"),a=(e("Autocomplete"),e("Sel"));e("NativeSel");return r.createClass({displayName:"FancyInputNumber",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{onChange:n.PropTypes.func,value:n.PropTypes.number,parseFn:n.PropTypes.func,id:n.PropTypes.string,className:n.PropTypes.string,minValue:n.PropTypes.number,maxValue:n.PropTypes.number,interval:n.PropTypes.number},init:function(){var e={value:this.props.value||0,tempValue:void 0};this.createObservables(e)},componentWillReceiveProps:function(e){e.value!==this.state.value&&this.value.set(e.value)},setValue:function(e){try{t.PAssert(5239,t.isNumber(e),"Must only report a numerical value")}catch(e){t.reportError(e)}this.value.get()!==e&&(this.tempValue.set(void 0),this.value.set(e),this.props.onChange&&this.props.onChange(e))},focus:function(){this.refs.input.focus()},onBlur:function(){void 0!==this.tempValue.get()&&(this.refs.input.value=this.value.get(),this.tempValue.set(void 0))},onMouseDown:function(){a.reset()},interval:function(){return this.props.interval||1},onClickUp:function(){var e=Math.min(this.value.get()+this.interval(),this.props.maxValue||1/0);this.setValue(e)},onClickDown:function(){var e=Math.max(this.value.get()-this.interval(),this.props.minValue||0);this.setValue(e)},onChange:function(){var e=this.props.parseFn||t.parseInt,i=this.refs.input.value,n=e(i);isNaN(n)?this.tempValue.set(i):this.setValue(n)},render:function(){var e=this.state,i=this.props,r=void 0!==e.tempValue?e.tempValue:e.value,a=t.classNames("fancyInputNumber c-border",i.className),s={};return n.createElement("div",{className:a,id:i.id,style:s},n.createElement("input",{className:"c-foreground",onMouseDown:this.onMouseDown,onChange:this.onChange,value:r,ref:"input",onBlur:this.onBlur}),n.createElement("div",{className:"fancyInputNumberButton up icon-caret-up",onClick:this.onClickUp}),n.createElement("div",{className:"fancyInputNumberButton down icon-caret-down",onClick:this.onClickDown}))}})}),define("ReactModalSettingsGeneral",["require","globals","Constants","react","MooReact","platform","International","Components/FancyCheckbox","Components/FancyButton","Components/FancyInputNumber"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("platform"),s=e("International"),o=e("Components/FancyCheckbox"),c=e("Components/FancyButton"),l=e("Components/FancyInputNumber");return r.createClass({displayName:"ReactModalSettingsGeneral",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.createObservables({isStoragePersisted:!1,usage:NaN,quota:NaN}),a.isStoragePersisted(function(e){this.isStoragePersisted.set(e)}.bind(this)),a.estimateAvailableStorage(function(e){this.usage.set(e.usage),this.quota.set(e.quota)}.bind(this),function(){})},onNotificationsChanged:function(e){t.settings.set(Settings.disableNotifications,!e),e?a.usesHTML5Notifications()?a.hasNotificationPermission()||Notification.requestPermission(function(e){"granted"===e?t.timeline.updateNotifications():(t.settings.set(Settings.disableNotifications,!0),this.refs.notifications.setValue(!1),t.toasts.pushMessage({text:"To enable notifications in the future, you must first give permission in your browser.",action:MessageAction.OpenURL,actionText:"LEARN MORE",data:{url:"https://support.google.com/chrome/answer/6148059"}}))}.bind(this)):t.timeline.updateNotifications():t.timeline.clearNotifications()},onCacheRatioClick:function(){this.getCacheRatio()<.98&&(t.settings.set(Settings.cacheSizeRatio,1),t.sendEvent("CacheRatio","Changed",1),t.toasts.pushMessage({text:"Success!",action:MessageAction.Okay}))},onDelayChanged:function(e){t.settings.set(Settings.notificationDelay,e),t.sendEvent("NotificationDelay","Changed",e)},onSettingChanged:function(e,i){t.settings.set(e,i)},parseFn:function(e){return parseFloat(e.toFixed(2))},getCacheRatio:function(){return this.parseFn(t.vmMain.pluginManager.getCacheSizeRatio())},onPersistClick:function(){a.requestStoragePersistence(function(){this.isStoragePersisted.set(!0)}.bind(this),function(){this.isStoragePersisted.set(!1)}.bind(this))},onChangeDateFormat:function(){var e=this.refs.selectDateFormat.value;t.settings.set(Settings.dateFormat,e)},onChangeDayWeekStart:function(){
t.settings.set(Settings.dayWeekStart,+this.refs.selectDayWeekStart.value)},render:function(){var e=this.getCacheRatio()<.98,r=!a.app&&a.supportsPersistedStorage(),d=a.supportsEstimatedStorage(),h=t.settings.get(Settings.notificationDelay),u=!t.settings.get(Settings.disableNotifications)&&a.hasNotificationPermission(),p=(this.usage.get()/1024/1024).toFixed(2),m=(this.quota.get()/1024/1024).toFixed(2),f=s.getCurrentDateFormat(),g=t.settings.get(Settings.dayWeekStart);return n.createElement("div",{key:"content",className:"new-modal-group"},n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement("div",null,"Date Format"),n.createElement("br",null),n.createElement("select",{defaultValue:f,ref:"selectDateFormat",onChange:this.onChangeDateFormat},n.createElement("option",{value:i.DateFormat.MDY},"Month / Day / Year"),n.createElement("option",{value:i.DateFormat.DMY},"Day / Month / Year"),n.createElement("option",{value:i.DateFormat.YMD},"Year / Month / Day"))),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement("div",null,"Start week on"),n.createElement("br",null),n.createElement("select",{defaultValue:g,ref:"selectDayWeekStart",onChange:this.onChangeDayWeekStart},n.createElement("option",{value:0},"Sunday"),n.createElement("option",{value:1},"Monday"))),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(o,{ref:"notifications",checked:t.settings.get(Settings.openEvernoteApp),onChange:this.onSettingChanged.bind(this,Settings.openEvernoteApp)},"Open Evernote links in Evernote app")),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(o,{ref:"notifications",checked:t.settings.get(Settings.searchExpandsCollapsed),onChange:this.onSettingChanged.bind(this,Settings.searchExpandsCollapsed)},"Automatically expand collapsed items while searching"),n.createElement("div",{className:"subtext",style:{marginLeft:24}},"Collapsed state while searching is separate from normal collapsed state, and search collapse state is cleared when the search is cleared.")),a.supportsNotifications()&&n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(o,{ref:"notifications",checked:u,onChange:this.onNotificationsChanged},"Enable notifications"),n.createElement("div",{className:"subtext",style:{marginLeft:24}},"Display native notifications for items that use a specific @date and time in their text. These are only displayed for the currently open document on this device."),n.createElement("div",{style:{marginTop:16}},n.createElement("span",{style:{display:"inline-block",marginLeft:24,width:140}},"Notification Time"),n.createElement(l,{value:h,minValue:0,maxValue:120,interval:5,onChange:this.onDelayChanged}),n.createElement("div",{className:"subtext",style:{marginLeft:24}},"Time in minutes before event to display a notification about the event."))),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement("div",{className:"modal-group-title"},"Storage / Caching"),r&&!this.isStoragePersisted.get()&&n.createElement("div",null,n.createElement(c,{raised:!0,margin:"16px 0",onClick:this.onPersistClick},"Enable Persistent Storage"),n.createElement("div",{className:"subtext"},"Allow Moo.do to store your data offline without potential for the browser to delete it. This can help Moo.do's performance if your disk is low on free-space.")),e&&n.createElement("div",null,n.createElement(c,{raised:!0,margin:"16px 0",onClick:this.onCacheRatioClick},"Reset Cache Ratio"),n.createElement("div",{className:"subtext"},"If you have run out of disk space in the past, we may not be efficiently caching your data. If you have resolved any disk space issues, click this button to efficiently cache your data again.")),d&&n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement("div",{className:"modal-group-title"},"Estimated disk usage"),n.createElement("div",{className:"subtext"},n.createElement("b",null,"Usage: "),Math.round(p)," MB / ",n.createElement("b",null,"Quota: "),Math.round(m)," MB"))))}})}),define("ReactModalSettingsPlugins",["require","globals","Constants","data","goog","react","MooReact","PluginSettings","AccountManager","Components/FancyCheckbox","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=(e("data"),e("goog"),e("react")),r=e("MooReact"),a=e("PluginSettings"),s=e("AccountManager"),o=e("Components/FancyCheckbox"),c=e("Components/FancyButton");return r.createClass({displayName:"ReactModalSettingsPlugins",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.pluginsEnabled={},this.pluginOptions={},a.refresh()},componentDidMount:function(){this.listenTo(s.onAccountsUpdated),this.checkTiers()},getState:function(){for(var e={isSaveEnabled:a.isSaveEnabled,premiumStatus:t.billingManager._premiumStatus,enableOfflineAuth:a.enableOfflineAuth,linkedAccounts:s.getLinkedAccounts(),hasError:a.enableOfflineAuth.get()&&s.isConnected()&&!!s.getAccountError(s.getDefaultEmail())},i=a.pluginsAvailable,n=0;n<i.length;++n){var r=i[n];this.pluginsEnabled[r]=e[r+"Enabled"]=a.getPluginEnabledObservable(r);var o=a.getPluginOptions(r);for(var c in o)if(o.hasOwnProperty(c)){var l=r+"_"+c;this.pluginOptions[l]=e[l]=o[c]}}return e},openSection:function(e){this.props.openSection(e)},onChangeFree:function(e){this.refs[PluginID.Contacts].setValue(e),this.refs[PluginID.Gmail].setValue(e),this.onChangeFeature()},onChangePremium:function(e){this.refs[PluginID.GCalendar].setValue(e),this.refs[PluginID.Drive].setValue(e),this.refs.DriveShared.setValue(e),this.onChangeFeature()},checkTier:function(e,t){for(var i=0,n=0;n<t.length;n++)this.refs[t[n]].getValue()?i++:i--;i===t.length&&e.setValue(!0),i===-t.length&&e.setValue(!1)},checkTiers:function(){this.checkTier(this.refs.free,[PluginID.Contacts,PluginID.Gmail]),this.checkTier(this.refs.premium,[PluginID.GCalendar,PluginID.Drive,"DriveShared"])},onChangeFeature:function(){a.isSaveEnabled.set(!0),this.checkTiers()},onEnablePremium:function(){if(t.billingManager.isTrialOver())return this.openSection(i.SettingsSections.Account),!1;t.billingManager.startTrial()},onClickFixError:function(){a.enableOfflineFeatures(function(){a.refresh(),this.updateState()}.bind(this))},onClickCancel:function(e){for(var t in this.refs)if(this.refs.hasOwnProperty(t)){var i=this.refs[t];i.checked&&i.resetValue()}this.checkTiers()},onClickSave:function(e,t){var i=[PluginID.Contacts,PluginID.GCalendar,PluginID.Gmail,PluginID.Drive].map(function(e){var t=!!this.refs[e].getValue(),i={id:e,enable:t};return e===PluginID.Drive&&(i.shared=!!this.refs.DriveShared.getValue()),i}.bind(this)),n=this.refs.offlineFeatures.getValue(),r=!1;return a.setEnabledPlugins(i,n,function(){r=!0,t(),a.isSaveEnabled.set(!1)}),!r},renderPluginOptionCheckbox:function(e,t,i,r){return n.createElement(o,{className:"subcheckbox",ref:t,initialChecked:!!this.state[e+"_"+i],onChange:this.onChangeFeature},r)},renderPluginCheckbox:function(e,t,i){return n.createElement(o,{ref:e,initialChecked:!!this.state[e+"Enabled"],onChange:this.onChangeFeature},i,t)},render:function(){var e=t.billingManager,r=this.state,a=e.hasPremiumFeatures(),s=e.isTrialOver(),l=r.hasError;return n.createElement("div",{key:"content",className:"new-modal-group"},n.createElement("div",{className:"new-modal-title"},n.createElement("div",{className:"title"},"Integrate with your other services"),n.createElement("div",{className:"subtext center c-foreground-light"},"Use ",n.createElement("b",null,"Moo.do")," to organize everything in one place")),n.createElement("div",{className:"setupFeatures featureCheckboxes"},l&&n.createElement("div",{className:"new-modal-row new-modal-row-1c settingError"},n.createElement("div",{className:"bold"},"Error detected"),n.createElement("div",{className:"errorSubtext"},"There is an error with your offline authentication. Click here to fix it."),n.createElement("div",{className:"center"},n.createElement(c,{raised:!0,onClick:this.onClickFixError},"FIX ERROR"))),n.createElement("div",{className:"featureTier c-border"},n.createElement("div",{className:"tierTitleWrapper"},n.createElement(o,{ref:"free",className:"tierTitle c-background",initialChecked:!1,onChange:this.onChangeFree},"Free Plugins")),n.createElement("div",{className:"flexbox"},n.createElement("div",{className:"setupFeatureHalf"},this.renderPluginCheckbox(PluginID.Contacts,"Google Contacts",n.createElement("i",{className:"icon-group"})),this.renderPluginCheckbox(PluginID.Gmail,"Gmail",n.createElement("img",{src:"/img/plugin-gmail.png"}))),n.createElement("div",{className:"setupFeatureHalf"},n.createElement("div",{className:"setupFeature"},n.createElement(o,{ref:"offlineFeatures",initialChecked:!!r.enableOfflineAuth,onChange:this.onChangeFeature},"Offline Features"),n.createElement("div",{className:"setupFeatureDesc c-foreground-light"},"Gmail features like Snooze require server access to your account so Moo.do can manage your inbox."))))),n.createElement("div",{className:"featureTier c-border"},n.createElement("div",{className:"tierTitleWrapper"},n.createElement(o,{ref:"premium",className:"tierTitle c-background",initialChecked:!1,onChange:this.onChangePremium},"Premium Plugins")),!a&&s&&n.createElement("div",{className:"featureTierDesc c-foreground-light"},"Your free trial of Premium has ended. Please signup to continue using premium features or contact support@moo.do to extend."),!a&&!s&&n.createElement("div",{className:"featureTierDesc c-foreground-light"},"Enabling Premium features will start a free "+i.TrialDuration+" day trial of Moo.do Premium."),n.createElement("div",{className:"flexbox"},n.createElement("div",{className:"setupFeature setupFeatureHalf"},this.renderPluginCheckbox(PluginID.GCalendar,"Google Calendar",n.createElement("img",{src:"/img/plugin-gcal.png"}))),n.createElement("div",{className:"setupFeature setupFeatureHalf"},this.renderPluginCheckbox(PluginID.Drive,"Google Drive",n.createElement("img",{src:"/img/plugin-gdrive.png"})),this.renderPluginOptionCheckbox(PluginID.Drive,"DriveShared",PluginSettingsID.Drive.WriteAccess,"Share files with collaborators")))),n.createElement("div",{className:"setupSubtext"},n.createElement("b",null,"Moo.do")," connects with your Google services to integrate everything together. ",n.createElement("b",null,"Moo.do")," data is stored in your personal Google Drive account and is never sent to any other server. Nobody can access any of your data. See our ",n.createElement("span",{className:"link"},"Privacy Policy")," for more details."),n.createElement("div",{className:"setupButtons center"},n.createElement(c,{raised:!0,primary:!0,onClick:this.onClickSave,enabled:r.isSaveEnabled},"SAVE"),n.createElement(c,{raised:!0,marginLeft:24,onClick:this.onClickCancel,enabled:r.isSaveEnabled},"RESET"))))}})}),define("ReactModalSettingsAccounts",["require","globals","Constants","react","MooReact","International","Components/FancyCheckbox","Components/FancyInput","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("International"),s=e("Components/FancyCheckbox"),o=e("Components/FancyInput"),c=e("Components/FancyButton");return r.createClass({displayName:"ReactModalSettingsAccounts",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},componentDidMount:function(){this.listenTo(t.billingManager.triggerBlocksUpdated)},getState:function(){var e=t.billingManager;return{validBilling:e._hasValidBillingData,premiumStatus:e._premiumStatus,daysLeftInTrial:e.daysLeftInTrial,trialOverHidden:t.settings.get(Settings.trialOverHidden),monthlyInvoice:t.settings.get(Settings.monthlyInvoice),invoiceEmail:t.settings.get(Settings.invoiceEmail),invoiceCompany:t.settings.get(Settings.invoiceCompany),invoiceAddress:t.settings.get(Settings.invoiceAddress),isUnsubscribed:t.settings.get(Settings.isUnsubscribed)}},onClickDismissTrial:function(){t.settings.set(Settings.trialOverHidden,!0),this.updateState()},onUnsubscribedChanged:function(e){var n=t.settings.get(Settings.isUnsubscribed);t.settings.set(Settings.isUnsubscribed,e),e?t.XHR_PrivateAPI({type:"POST",path:"/feedback/unsubscribe",data:{email:t.vmMain.getUserEmail()},requireAuth:!0,cb:function(r){r.status!==i.HTTPStatusCode.Success?(t.settings.set(Settings.isUnsubscribed,n),t.toasts.pushMessage({text:"There was an error updating your subscription status. Please retry or contact support@moo.do.",actionText:"RETRY",timeout:8e3,action:function(){this.onUnsubscribedChanged(e)}.bind(this)})):t.toasts.pushMessage({text:"You have successfully unsubscribed from further emails.",actionText:"OKAY",timeout:2e3})}.bind(this)}):t.XHR_PrivateAPI({type:"POST",path:"/feedback/subscribe",data:{email:t.vmMain.getUserEmail()},requireAuth:!0,cb:function(r){r.status!==i.HTTPStatusCode.Success?(t.settings.set(Settings.isUnsubscribed,n),t.toasts.pushMessage({text:"There was an error updating your subscription status. Please retry or contact support@moo.do.",actionText:"RETRY",timeout:8e3,action:function(){this.onUnsubscribedChanged(e)}.bind(this)})):t.toasts.pushMessage({text:"Success!",actionText:"OKAY",timeout:2e3})}.bind(this)})},onInvoiceEnabledChanged:function(e){this._onInvoiceChanged(e,t.settings.get(Settings.invoiceEmail),t.settings.get(Settings.invoiceCompany),t.settings.get(Settings.invoiceAddress))},onInvoiceEmailChanged:function(e){clearTimeout(this._invoiceEmailTimeout),this._invoiceEmailTimeout=setTimeout(function(){this._onInvoiceChanged(t.settings.get(Settings.monthlyInvoice),e,t.settings.get(Settings.invoiceCompany),t.settings.get(Settings.invoiceAddress)),this._invoiceEmailTimeout=void 0}.bind(this),3e3)},onInvoiceCompanyChanged:function(e){clearTimeout(this._invoiceCompanyTimeout),this._invoiceCompanyTimeout=setTimeout(function(){this._onInvoiceChanged(t.settings.get(Settings.monthlyInvoice),t.settings.get(Settings.invoiceEmail),e,t.settings.get(Settings.invoiceAddress)),this._invoiceCompanyTimeout=void 0}.bind(this),3e3)},onInvoiceAddressChanged:function(e){clearTimeout(this._invoiceAddressTimeout),this._invoiceAddressTimeout=setTimeout(function(){this._onInvoiceChanged(t.settings.get(Settings.monthlyInvoice),t.settings.get(Settings.invoiceEmail),t.settings.get(Settings.invoiceCompany),e),this._invoiceAddressTimeout=void 0}.bind(this),3e3)},_onInvoiceChanged:function(e,n,r,a){var s=t.settings.get(Settings.monthlyInvoice),o=t.settings.get(Settings.invoiceEmail),c=t.settings.get(Settings.invoiceCompany),l=t.settings.get(Settings.invoiceAddress);t.settings.set(Settings.monthlyInvoice,e),t.settings.set(Settings.invoiceEmail,n),t.settings.set(Settings.invoiceCompany,r),t.settings.set(Settings.invoiceAddress,a),t.sendEvent("InvoiceChanged",e);var d=e?1:0;t.XHR_PrivateAPI({type:"POST",path:"/billing/invoice",data:{isEnabled:d,invoiceEmail:n,invoiceCompany:r,invoiceAddress:a},requireAuth:!0,cb:function(d){d.status!==i.HTTPStatusCode.Success?(t.settings.set(Settings.monthlyInvoice,s),t.settings.set(Settings.invoiceEmail,o),t.settings.set(Settings.invoiceCompany,c),t.settings.set(Settings.invoiceAddress,l),t.toasts.pushMessage({text:"There was an error updating your invoice status on the server. Please retry in a minute.",actionText:"RETRY",timeout:8e3,action:function(){this._onInvoiceChanged(e,n,r,a)}.bind(this)})):t.toasts.pushMessage({text:"Your invoice information was successfully updated.",actionText:"OKAY",timeout:2e3}),this.updateState()}.bind(this)})},render:function(){var e=t.billingManager,i=this.state,r=t.vmMain.getUserName(),l=t.vmMain.getUserEmail(),d=e.getMonthlyPrice(),h=e.getYearlyPrice();return n.createElement("div",{key:"content",className:"new-modal-group"},e.isTrialOver()&&!i.trialOverHidden&&n.createElement("div",{className:"new-modal-row-1c"},n.createElement("div",{className:"new-modal-row trialEnd"},n.createElement("div",null,"Your trial has ended. Please sign up to continue using Premium features."),n.createElement("div",{className:"center",style:{marginTop:16}},n.createElement(c,{raised:!0,onClick:this.onClickDismissTrial},"DISMISS"))),n.createElement("hr",null)),n.createElement("div",{className:"new-modal-title"},n.createElement("div",{className:"title"},r&&"Hi "+r),i.validBilling&&e.isTrialState()&&n.createElement("div",{className:"subtext center"},"We hope your trial of Premium is going well."),i.validBilling&&e.hasPremium()&&n.createElement("div",{className:"subtext center"},"We are very happy to have you as a Premium Member."),i.validBilling&&!e.hasPremium()&&!e.isTrialState()&&n.createElement("div",{className:"subtext center"},"We hope Moo.do is helping you be productive.")),n.createElement("div",{className:"new-modal-row new-modal-row-2c"},n.createElement("div",{className:"left-header"},"ACCOUNT STATUS"),n.createElement("div",{className:"right-content"},n.createElement("div",{className:"new-modal-subrow"},n.createElement("div",null,n.createElement("div",{className:"subtitle"},"Account email"),n.createElement("div",{className:"subtext"},l)),n.createElement("div",null,n.createElement("div",{className:"subtitle"},"Member since"),n.createElement("div",{className:"subtext"},e.getJoinDate().toString(a.getFormat(DFormat.LongStrDate)))),e.isTrialState()&&!e.isTrialOver()&&n.createElement("div",null,n.createElement("div",{className:"subtitle"},"Days left in trial"),n.createElement("div",{className:"subtext"},i.daysLeftInTrial)),e.hasPremium()&&n.createElement("div",null,n.createElement("div",{className:"subtitle"},"Premium since"),n.createElement("div",{className:"subtext"},e.getPremiumStartDate().toString(a.getFormat(DFormat.LongStrDate)))),(e.canceledUserHasPremiumAccess()||!1)&&n.createElement("div",null,n.createElement("div",{className:"subtitle"},"Premium end"),n.createElement("div",{className:"subtext"},e.getPremiumEndDate().toString(a.getFormat(DFormat.LongStrDate)))),e.hasPremium()&&e.hasSubscription()&&n.createElement("div",null,n.createElement("div",{className:"subtitle"},"Next billing cycle"),n.createElement("div",{className:"subtext"},e.getNextBillingDate().toString(a.getFormat(DFormat.LongStrDate))))))),n.createElement("div",{className:"new-modal-row new-modal-row-2c"},n.createElement("div",{className:"left-header"},"MANAGE ACCOUNT"),n.createElement("div",{className:"right-content"},n.createElement("div",{className:"new-modal-subrow"},!e.hasPremium()&&n.createElement("div",null,n.createElement(c,{raised:!0,onClick:e.onTapDeleteAccount.bind(e)},"DELETE ACCOUNT")),e.hasPremium()&&e.hasSubscription()&&n.createElement("div",null,n.createElement(c,{raised:!0,onClick:e.onTapUpdatePaymentMethod.bind(e)},"UPDATE PAYMENT METHOD")),e.hasPremium()&&n.createElement("div",null,n.createElement(c,{raised:!0,onClick:e.onTapCancelSubscription.bind(e)},"CANCEL PREMIUM")),n.createElement("div",null,n.createElement(s,{checked:t.settings.get(Settings.isUnsubscribed),onChange:this.onUnsubscribedChanged},"Unsubscribe from emails"))))),e.hasPremium()&&e.hasSubscription()&&n.createElement("div",{className:"new-modal-row new-modal-row-2c"},n.createElement("div",{className:"left-header"},"INVOICES"),n.createElement("div",{className:"right-content"},n.createElement("div",{className:"new-modal-subrow"},n.createElement("div",null,n.createElement(s,{checked:t.settings.get(Settings.monthlyInvoice),onChange:this.onInvoiceEnabledChanged},"Receive Billing Invoice")),i.monthlyInvoice&&n.createElement(o,{height:50,floatingText:"Invoice Email",display:"block",ref:"invoiceEmail",value:i.invoiceEmail,onChange:this.onInvoiceEmailChanged}),i.monthlyInvoice&&n.createElement(o,{height:50,floatingText:"Name",display:"block",ref:"invoiceCompany",value:i.invoiceCompany,onChange:this.onInvoiceCompanyChanged}),i.monthlyInvoice&&n.createElement(o,{height:50,floatingText:"Address",display:"block",ref:"invoiceAddress",value:i.invoiceAddress,onChange:this.onInvoiceAddressChanged}),n.createElement("div",null,n.createElement(c,{raised:!0,onClick:e.onTapViewInvoices.bind(this)},"VIEW INVOICES"))))),!e.hasPremium()&&n.createElement("span",{id:"accountSettingsPremium"},n.createElement("hr",null),n.createElement("div",{className:"new-modal-title"},n.createElement("div",{className:"title"},"Moo.do Premium"),n.createElement("div",{className:"subtext center"},"Integrate more of your services together and unlock advanced organization and customization features."),n.createElement("div",{className:"center",style:{marginTop:24}},n.createElement(c,{fontSize:14,raised:!0,primary:!0,onClick:e.onTapSignupMonth.bind(e)},"$"+d+" / month"),n.createElement(c,{fontSize:14,raised:!0,primary:!0,marginLeft:16,onClick:e.onTapSignupYear.bind(e)},"$"+h+" / year"),n.createElement(c,{fontSize:14,raised:!0,primary:!0,marginLeft:16,onClick:e.onTapCodeSignup.bind(e)},"Enter Code"))),n.createElement("div",{id:"premiumFeatures"},n.createElement("div",{className:"flexbox c-border"},n.createElement("div",{className:"premiumImg premiumShadow"},n.createElement("img",{src:"/img/about/CalendarPane.gif"})),n.createElement("div",{className:"premiumDesc"},n.createElement("div",{className:"premiumTitle"},"Calendar Pane"),n.createElement("div",{className:"premiumText"},"Day, Week, and Month views for managing your calendar."))),n.createElement("div",{className:"flexbox c-border"},n.createElement("div",{className:"premiumImg premiumShadow"},n.createElement("img",{src:"/img/about/DrivePane.png"})),n.createElement("div",{className:"premiumDesc"},n.createElement("div",{className:"premiumTitle"},"Google Drive Pane"),n.createElement("div",{className:"premiumText"},"Attach documents to your tasks. Dragging a file from your computer into Moo.do automatically uploads it to Drive."))),n.createElement("div",{className:"flexbox c-border"},n.createElement("div",{className:"premiumImg premiumShadow"},n.createElement("img",{src:"/img/about/GCalSettings.jpg"})),n.createElement("div",{className:"premiumDesc"},n.createElement("div",{className:"premiumTitle"},"Google Calendar Sync"),n.createElement("div",{className:"premiumText"},"Two way sync: Manage your Google Calendar in Moo.do and/or sync your Moo.do events with your Google Calendar."))),n.createElement("div",{className:"flexbox c-border"},n.createElement("div",{className:"premiumImg premiumShadow"},n.createElement("img",{src:"/blog/img/update-workspaces.png"})),n.createElement("div",{className:"premiumDesc"},n.createElement("div",{className:"premiumTitle"},"Boards"),n.createElement("div",{className:"premiumText"},"Save sets of panes to easily switch between workflows."))),n.createElement("div",{className:"flexbox c-border"},n.createElement("div",{className:"premiumImg premiumShadow"},n.createElement("img",{src:"/img/about/DisplaySettings-Small.jpg"})),n.createElement("div",{className:"premiumDesc"},n.createElement("div",{className:"premiumTitle"},"Advanced Display Settings"),n.createElement("div",{className:"premiumText"},"Customize Moo.do's look and feel to your liking."))),n.createElement("div",{className:"flexbox c-border"},n.createElement("div",{className:"premiumImg"},n.createElement("img",{src:"/img/about/GmailCache.jpg"})),n.createElement("div",{className:"premiumDesc"},n.createElement("div",{className:"premiumTitle"},"Gmail Sync Time"),n.createElement("div",{className:"premiumText"},"Cache emails for access while offline and quicker load time.")))),n.createElement("table",{id:"pricingTable"},n.createElement("tbody",null,n.createElement("tr",{className:"c-border c-bg-faded"},n.createElement("td",null),n.createElement("td",null,"Free"),n.createElement("td",null,"Premium")),n.createElement("tr",{className:"empty"},n.createElement("td",null),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",{className:"header price"},n.createElement("td",null,"Price"),n.createElement("td",null,"$0"),n.createElement("td",null,n.createElement("div",null,"$"+d+" / month"),n.createElement("div",null,"$"+h+" / year"))),n.createElement("tr",{className:"header"},n.createElement("td",null,"Core Features"),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",null,n.createElement("td",null,"Unlimited items"),n.createElement("td",{className:"icon-check"}),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,"Powerful search"),n.createElement("td",{className:"icon-check"}),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,"Realtime collaboration"),n.createElement("td",{className:"icon-check"}),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,"Multiple Boards"),n.createElement("td",null),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,"Day, Week, Month views"),n.createElement("td",null),n.createElement("td",{className:"icon-check"})),n.createElement("tr",{className:"empty"},n.createElement("td",null),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",{className:"header"},n.createElement("td",null,"Plugins"),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",null,n.createElement("td",null,n.createElement("i",{className:"icon-group"}),"Google Contacts"),n.createElement("td",{className:"icon-check"}),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,n.createElement("img",{src:"/img/plugin-mailbird.png"}),"Mailbird"),n.createElement("td",{className:"icon-check"}),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,n.createElement("img",{src:"/img/plugin-gdrive.png"}),"Google Drive"),n.createElement("td",null),n.createElement("td",{className:"icon-check"})),n.createElement("tr",{className:"empty"},n.createElement("td",null),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",{className:"header"},n.createElement("td",null,n.createElement("img",{src:"/img/plugin-gmail.png"}),"Gmail"),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",null,n.createElement("td",null,"Standard email features"),n.createElement("td",{className:"icon-check"}),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,"Offline sync"),n.createElement("td",null,"2 days"),n.createElement("td",null,"30 days")),n.createElement("tr",{className:"empty"},n.createElement("td",null),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",{className:"header"},n.createElement("td",null,n.createElement("img",{src:"/img/plugin-gcal.png"}),"Google Calendar"),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",null,n.createElement("td",null,"Sync Moo.do tasks"),n.createElement("td",null),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,"Manage Calendar in Moo.do"),n.createElement("td",null),n.createElement("td",{className:"icon-check"})),n.createElement("tr",{className:"empty"},n.createElement("td",null),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",{className:"header"},n.createElement("td",null,"Customization"),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",null,n.createElement("td",null,"Display settings presets"),n.createElement("td",{className:"icon-check"}),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,"Advanced display settings"),n.createElement("td",null),n.createElement("td",{className:"icon-check"})),n.createElement("tr",{className:"empty"},n.createElement("td",null),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",{className:"header"},n.createElement("td",null,"We love you",n.createElement("i",{className:"icon-heart"})),n.createElement("td",null),n.createElement("td",null)),n.createElement("tr",null,n.createElement("td",null,"Early access to new features"),n.createElement("td",null),n.createElement("td",{className:"icon-check"})),n.createElement("tr",null,n.createElement("td",null,"Premium support"),n.createElement("td",null),n.createElement("td",{className:"icon-check"})),n.createElement("tr",{className:"empty"},n.createElement("td",null),n.createElement("td",null),n.createElement("td",null))))))}})}),define("ReactModalSettingsEarly",["require","globals","Constants","platform","gdata","react","MooReact","Components/FancyLoader","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("gdata"),e("react")),r=e("MooReact"),a=e("Components/FancyLoader"),s=e("Components/FancyButton");return r.createClass({displayName:"ReactModalSettingsEarly",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},init:function(){this.createObservables({isSendingFeedback:!1})},openSection:function(e){this.props.openSection(e)},onClickDiscard:function(){this.refs.feedback.value="",this.refs.feedback.focus()},onClickSend:function(e,i){var n=this.refs.feedback.value;if(n&&n.length>2){this.isSendingFeedback.set(!0);return t.sendFeedback("Moo.do Feedback",n,function(){this.refs.feedback.value="",this.isSendingFeedback.set(!1),i&&t.isFunction(i)&&i()}.bind(this)),!0}},render:function(){var e=(t.billingManager,this.props,this.state);return n.createElement("div",{key:"content",className:"new-modal-group"},n.createElement("div",{className:"new-modal-title"},n.createElement("div",{className:"title"},"Send Feedback"),n.createElement("div",{className:"subtext middle"},"Send the developers bug reports, feedback, or suggestions. Your feedback is very helpful in planning what to do next.")),n.createElement("div",{className:"earlyAccessFeedback"},n.createElement("textarea",{className:"feedbackTextArea c-background c-foreground",ref:"feedback",style:{marginBottom:16,color:e.isSendingFeedback?"#aaa":null}}),e.isSendingFeedback&&n.createElement(a,{top:100}),n.createElement("div",{style:{textAlign:"right"}},n.createElement(s,{raised:!0,onClick:this.onClickDiscard},"DISCARD"),n.createElement(s,{raised:!0,primary:!0,marginLeft:16,onClick:this.onClickSend},"SEND"))))}})}),define("Components/FancyTable",["require","globals","Constants","platform","react","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("react"));return e("MooReact").createClass({displayName:"FancyTable",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{id:n.PropTypes.string,className:n.PropTypes.string},render:function(){var e=t.classNames("fancyTable",this.props.className);return n.createElement("div",{className:e,id:this.props.id},this.props.children)}})}),define("ReactModalSettingsLinked",["require","globals","Constants","gdata","goog","react","MooReact","AccountManager","PluginSettings","Components/FancyLoader","Components/FancyButton","Components/FancyCheckbox","Components/FancyInput","Components/FancyTable"],function(e){var t=e("globals"),i=e("Constants"),n=(e("gdata"),e("goog")),r=e("react"),a=e("MooReact"),s=e("AccountManager"),o=e("PluginSettings"),c=e("Components/FancyLoader"),l=e("Components/FancyButton"),d=e("Components/FancyCheckbox"),h=e("Components/FancyInput"),u=e("Components/FancyTable");return a.createClass({displayName:"ReactModalSettingsLinked",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},init:function(){this.createObservables({addingAccount:!1,errorMessage:"",linkingAccount:!1}),o.refresh()},componentDidMount:function(){this.listenTo(s.onAccountsUpdated)},getState:function(){return{gmailSyncAccounts:o.GmailSyncAccounts,linkedAccounts:s.getLinkedAccounts()}},linkAccount:function(e,t,i){var r=[GScope.UserInfoEmail];return r.pushArray(t),n.linkAccount(e,r,i)},removeAccount:function(e){this.errorMessage.set("");var i=t.vmMain.pluginManager.getPlugin(PluginID.Gmail);s.removeLinkedAccount(e,function(i){i||t.toasts.pushMessage({text:"There was an error unlinking your account.",actionText:"RETRY",action:this.removeAccount.bind(this,e)})}.bind(this)),i.hasSyncAccount(e)&&i.removeSyncAccount(e,function(){o.refresh()})},addAccount:function(e){
s.isDefaultEmail(e)?t.toasts.pushMessage({text:"Please use the 'Plugins' section to manage your main account."}):(s.addLinkedAccount(e),t.vmMain.pluginManager.getPlugin(PluginID.Gmail).isEnabled()&&this.enableGmailSync(e,!0))},enableGmailSync:function(e,i){this.errorMessage.set("");var n=t.vmMain.pluginManager.getPlugin(PluginID.Gmail),r=function(){this.errorMessage.set("There was an error linking your account. Please try again in a minute."),o.refresh()}.bind(this);if(i){var a=this.linkingAccount;a.set(e),this.linkAccount(e,[GScope.GmailCompose,GScope.GmailModify],function(e,t){e?n.addSyncAccount(t,function(e){e||r(),a.set(!1),o.refresh()}):(a.set(!1),r())})}else n.removeSyncAccount(e,function(e){e||r(),o.refresh()})},onAddAccountClick:function(){this.errorMessage.set(""),this.addingAccount.set(!0),setTimeout(function(){this.refs.addAccount.focus()}.bind(this),0)},onAddButtonClick:function(){this.errorMessage.set("");var e=this.refs.addAccount.getValue();this.addAccount(e),this.addingAccount.set(!1)},handleGmailClick:function(){t.vmMain.pluginManager.getPlugin(PluginID.Gmail).isEnabled()||this.props.openSection(i.SettingsSections.Plugins)},renderAccount:function(e){var i=t.vmMain.pluginManager.getPlugin(PluginID.Gmail).isEnabled(),n=this.state.gmailSyncAccounts.indexOf(e)>=0,a=n&&s.isConnected()&&(!s.isAuthorized(e,GScope.GmailCompose)||!s.isCurrentlyAuthorized(e)),o=this.state.linkingAccount===e,h=t.classNames("accountRow",{linking:o});return r.createElement("div",{key:"row"+e,className:h},r.createElement(l,{icon:"icon-close",iconSize:20,width:50,height:50,onClick:this.removeAccount.bind(this,e),tooltip:"Unlink Account"}),r.createElement("div",null,e),r.createElement(d,{disabled:!i,checked:n,error:a,onClick:this.handleGmailClick,onChange:this.enableGmailSync.bind(this,e)}),o&&r.createElement(c,{inline:!0},"Linking account..."))},getAccountList:function(){var e=[];e.pushOnlyUniques(this.state.linkedAccounts),e.pushOnlyUniques(this.state.gmailSyncAccounts);var t=s.getDefaultEmail();return e.filter(function(e){return e!==t})},render:function(){var e=this.getAccountList(),t=r.createElement(u,{className:"gmailAccountTable"},r.createElement("div",{key:"header"},r.createElement("div",null),r.createElement("div",null,"Account"),r.createElement("div",null,"Enabled")),e.map(this.renderAccount));return r.createElement("div",{key:"content",className:"new-modal-group"},r.createElement("div",{className:"new-modal-title"},r.createElement("div",{className:"title"},"Email Accounts"),r.createElement("div",{className:"subtext center"},"Manage email from multiple Gmail accounts")),t,this.state.addingAccount&&r.createElement("div",{key:"footer",style:{padding:"0 32px"}},r.createElement(h,{ref:"addAccount",floatingText:"Account Email",padding:{left:24,right:24},height:50,buttonText:"ADD",onButtonClick:this.onAddButtonClick})),this.state.errorMessage&&r.createElement("div",{key:"errorMessage",style:{textAlign:"center"}},this.state.errorMessage),!this.state.addingAccount&&r.createElement("div",{key:"footer"},r.createElement("div",{style:{textAlign:"center"}},r.createElement(l,{height:50,onClick:this.onAddAccountClick},"LINK ACCOUNT"))))}})}),define("ReactModalSettingsGCal",["require","globals","Constants","data","react","MooReact","PluginSettings","AccountManager","Components/FancyLoader","Components/FancyCheckbox","Components/FancyButton","Components/FancyTable","Components/FancyInputNumber","Components/FancyInput"],function(e){var t=e("globals"),i=e("Constants"),n=(e("data"),e("react")),r=e("MooReact"),a=e("PluginSettings"),s=e("AccountManager"),o=e("Components/FancyLoader"),c=e("Components/FancyCheckbox"),l=e("Components/FancyButton"),d=e("Components/FancyTable"),h=e("Components/FancyInputNumber"),u=e("Components/FancyInput");return r.createClass({displayName:"ReactModalSettingsGCal",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.hadCalendarSyncUpdated=!1,this.createObservables({addingCalendar:!1}),a.refresh()},openSection:function(e){this.props.openSection(e)},componentDidMount:function(){this.listenTo(s.onAccountsUpdated)},onUnmount:function(){if(this.hadCalendarSyncUpdated){var e=t.vmMain.pluginManager.getPlugin(PluginID.GCalendar);e.isActive()&&e.forceRemoteEventSync()}},getState:function(){var e={premiumStatus:t.billingManager._premiumStatus,GCalendarsAvailable:a.GCalendarsAvailable,GCalendarSyncErrors:a.GCalendarSyncErrors,GCalendarAddFailure:a.GCalendarAddFailure,GCalendarListFailure:a.GCalendarListFailure,GCalendarListLoading:a.GCalendarListLoading},i=a.getPluginOptions(PluginID.GCalendar);for(var n in i)if(i.hasOwnProperty(n)){var r=PluginID.GCalendar+"_"+n;e[r]=i[n]}return e},toggleCalendarImport:function(e){var i=PluginSettingsID.GCalendar.ImportCalendars,n=(this.state[PluginID.GCalendar+"_"+i]||[]).slice(0),r=this.isExportCalendar(e);r&&this.disableCalendarExport(e);var s=n.indexOfWithProperty("id",e.id);if(s>=0)n.removeAt(s);else{try{t.PAssert(5240,!r,"Export calendar state must be matching with import calendar state")}catch(e){t.reportError(e)}n.push({id:e.id,summary:e.summary,accessRole:e.accessRole})}a.setPluginOption(PluginID.GCalendar,i,n,!1),this.hadCalendarSyncUpdated=!0},enableCalendarExport:function(e){a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.WriteAccess,!0,!0,function(t){t&&(a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.ExportCalendar,e.id,!1),this.hadCalendarSyncUpdated=!0,this.isImportCalendar(e)||this.toggleCalendarImport(e))}.bind(this))},disableCalendarExport:function(e){a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.WriteAccess,!1,!1,function(e){e&&a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.ExportCalendar,null,!1)})},toggleCalendarExport:function(e){this.isExportCalendar(e)?this.disableCalendarExport(e):this.enableCalendarExport(e)},onAddCalendarClick:function(){a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.WriteAccess,!0,!1,function(e){e?(this.addingCalendar.set(!0),setTimeout(function(){this.refs.addCalendar.focus()}.bind(this),0)):t.toasts.pushMessage({text:"Moo.do needs write access to create a new calendar.",actionText:"OKAY"})}.bind(this))},onAddButtonClick:function(){var e=this.refs.addCalendar.getValue();a.addCalendar(e),this.addingCalendar.set(!1)},isImportCalendar:function(e){var i=!1;if(this.state.GCalendar_importCalendars)for(var n=0;n<this.state.GCalendar_importCalendars.length;++n){var r=this.state.GCalendar_importCalendars[n];if(t.isObject(r)||(r={id:r}),r.id===e.id){i=!0;break}}return i},isExportCalendar:function(e){var t=!1;return this.state.GCalendar_exportCalendar&&(t=this.state.GCalendar_exportCalendar===e.id),t},onDisplayOverdueChange:function(e){t.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.DisplayOverdueInAgenda,e)},onSyncNewEventsChange:function(e){t.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.SyncNewEvents,e)},onSyncDraggedEventsChange:function(e){t.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.SyncDraggedEvents,e)},onCreateLocalChange:function(e){t.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.CreateLocalEvents,e)},renderCalendarSettings:function(){var e,r,s,p,m=this.state,f=0,g=m.GCalendarSyncErrors,v=!1;if(g)for(var y=0;y<g.length;y++){var b=g[y].result;b===i.SyncResult.FailureOAuth?v=!0:b!==i.SyncResult.FailureNoRead&&b!==i.SyncResult.FailureNoWrite||f++}var S=t.vmMain.pluginManager.getPlugin(PluginID.GCalendar),E=S.getSetting(PluginSettingsID.GCalendar.WriteAccess),C=S.getSetting(PluginSettingsID.GCalendar.WeeksPast),P=S.getSetting(PluginSettingsID.GCalendar.WeeksFuture),T=S.getSetting(PluginSettingsID.GCalendar.DisplayOverdueInAgenda),D=S.getSetting(PluginSettingsID.GCalendar.SyncNewEvents),M=S.getSetting(PluginSettingsID.GCalendar.SyncDraggedEvents),_=S.getSetting(PluginSettingsID.GCalendar.CreateLocalEvents),I=!1;return!E&&this.state.GCalendar_exportCalendar&&(I=!0),t.billingManager.hasPremiumFeatures()?v&&0===m.GCalendarsAvailable.length?p=n.createElement("center",null,n.createElement("div",{className:"error"},"We encountered a sync error. Please allow access to your calendar."),n.createElement("br",null),n.createElement(l,{raised:!0,primary:!0,onClick:a.enablePlugin.bind(a,PluginID.GCalendar)},"ALLOW")):m.GCalendarListFailure?p=n.createElement("center",null,n.createElement("div",{className:"error"},"There was an error syncing your calendar list. Please try again."),n.createElement("br",null),n.createElement(l,{raised:!0,primary:!0,onClick:a.updateCalendarList.bind(a)},"RETRY")):m.GCalendarListLoading?p=n.createElement(o,null,"Loading Google Calendars..."):(f>0&&(p=n.createElement("center",null,n.createElement("div",{style:{maxWidth:600,lineHeight:1.5,marginBottom:16},className:"error"},"There was an error reading or saving to your calendars. Please check your Google Calendar settings. The affected calendars are marked with a ",n.createElement(c,{checked:!0,error:!0,style:{marginLeft:5,marginRight:5}})," below."))),e=n.createElement(d,{className:"calendarSettingsTable new-modal-row"},n.createElement("div",{key:"header"},n.createElement("div",null,"Calendar Name"),n.createElement("div",null,"Sync From"),n.createElement("div",null,"Save To")),m.GCalendarsAvailable.map(function(e,r){var a=this.isImportCalendar(e),s=this.isExportCalendar(e),o="owner"===e.accessRole||"writer"===e.accessRole,l=t.classNames("calendarSettingsName",{import:a},{export:s});if(g){var d=g.indexOfWithProperty("id",e.id),h=null,u=null;if(d>=0){var p=g[d];p.result===i.SyncResult.FailureNoRead?h=!0:p.result===i.SyncResult.FailureNoRead&&(u=!0)}}var m=S.getCalendarBackgroundColor(e.id);return n.createElement("div",{key:"row"+r},n.createElement("div",{className:l},e.summary||e.id),n.createElement(c,{checked:a,error:h,checkedColor:m,onChange:this.toggleCalendarImport.bind(this,e)}),o?n.createElement(c,{checked:s,enabled:o,checkedColor:m,error:h||u||s&&I,radio:!0,onChange:this.toggleCalendarExport.bind(this,e)}):n.createElement("div",null))}.bind(this)),m.GCalendarAddFailure&&n.createElement("div",{key:"footerError"},n.createElement("div",{style:{textAlign:"center"}},"There was an error creating your new calendar. Please try again.")),m.addingCalendar&&n.createElement("div",{key:"footer"},n.createElement(u,{ref:"addCalendar",floatingText:"New calendar name",padding:{left:24,right:24},height:50,buttonText:"ADD",onButtonClick:this.onAddButtonClick})),!m.addingCalendar&&n.createElement("div",{key:"footer"},n.createElement("div",{style:{textAlign:"center"}},n.createElement(l,{height:"auto",onClick:this.onAddCalendarClick},"ADD NEW CALENDAR"))))):p=n.createElement("center",null,n.createElement("div",{className:"error"},"You must have an active Premium subscription or Trial to use Google Calendar."),n.createElement("br",null),n.createElement(l,{raised:!0,primary:!0,onClick:this.openSection.bind(this,i.SettingsSections.Account)},"ABOUT PREMIUM")),r=n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement("span",{style:{display:"inline-block",width:140}},"Weeks in the past"),n.createElement(h,{value:C,minValue:0,maxValue:7,onChange:this.onChangeWeeksPast}),n.createElement("span",{style:{display:"inline-block",marginLeft:32,width:140}},"Weeks in the future"),n.createElement(h,{value:P,minValue:0,maxValue:12,onChange:this.onChangeWeeksFuture})),s=n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(c,{ref:"displayoverdue",checked:T,onChange:this.onDisplayOverdueChange},"Display overdue events in agenda"),n.createElement("div",{className:"subtext"},"In the Agenda view of the Calendar Pane, display events from Google Calendar that happened in the past.")),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(c,{ref:"syncDraggedEvents",checked:M,onChange:this.onSyncDraggedEventsChange},"Sync dragged events"),n.createElement("div",{className:"subtext"},"Sync events with Google Calendar when dragging onto the Calendar pane.")),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(c,{ref:"syncNewEvents",checked:D,onChange:this.onSyncNewEventsChange},"Sync new events created in add item popup by default"),n.createElement("div",{className:"subtext"},"When adding events in the New Item popup, Create Task in the Gmail pane, or in the Day, Week, and Month views in the Calendar Pane, the option to sync the event with Google Calendar will be checked by default.")),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(c,{ref:"createLocalEvents",checked:_,onChange:this.onCreateLocalChange},"Create a local item for new calendar events by default"),n.createElement("div",{className:"subtext"},"When adding events in the New Item popup, Create Task in the Gmail pane, or in the Day, Week, and Month views in the Calendar Pane, a new local task will be created for Google Calendar events."))),n.createElement("div",{className:"calendarSettings"},p,e,r,s)},onChangeWeeksPast:function(e){t.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.WeeksPast,e)},onChangeWeeksFuture:function(e){t.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.WeeksFuture,e)},render:function(){return n.createElement("div",{className:"new-modal-group"},n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement("div",{className:"subtext"},"By default we are not able to modify your calendar or calendar events. Adding a 'Save To' calendar to below will sync your local changes to your Google Calendar."),this.renderCalendarSettings()))}})}),define("ReactModalSettingsContacts",["require","globals","Constants","data","react","MooReact","PluginSettings","Components/FancyButton"],function(e){var t=(e("globals"),e("Constants")),i=e("data"),n=e("react"),r=e("MooReact"),a=e("PluginSettings"),s=e("Components/FancyButton");return r.createClass({displayName:"ReactModalSettingsContacts",componentDisplay:t.ComponentDisplay.Desktop,getState:function(){return{contacts:i.contactManager._contacts}},render:function(){var e=this.state;return n.createElement("div",{className:"settingPluginOptions"},n.createElement("div",{className:"subtext"},n.createElement("span",null,"We will not send emails or otherwise communicate with your contacts unless you ask us to."),n.createElement("span",null," If you need instant access to contacts you just added you can sync them by pressing the button below, otherwise your contacts will appear automatically after a few hours.")),n.createElement("div",{className:"center"},n.createElement(s,{id:"refreshContacts",raised:!0,primary:!0,onClick:a.onTapRefreshContacts.bind(a)},"REFRESH CONTACTS"),n.createElement("div",{id:"numContacts"},e.contacts.length+" contacts loaded")))}})}),define("ReactModalSettingsGmail",["require","globals","Constants","data","react","MooReact","PluginSettings","Components/FancyCheckbox","Components/FancyButton","Components/FancyInputNumber"],function(e){var t=e("globals"),i=e("Constants"),n=(e("data"),e("react")),r=e("MooReact"),a=e("PluginSettings"),s=e("Components/FancyCheckbox"),o=e("Components/FancyButton"),c=e("Components/FancyInputNumber");return r.createClass({displayName:"ReactModalSettingsGmail",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.hadGmailSyncUpdated=!1},onUnmount:function(){if(this.hadGmailSyncUpdated){var e=t.vmMain.pluginManager.getPlugin(PluginID.Gmail);e.isActive()&&e._forceThreadSync()}},getState:function(){return{GmailNumSyncd:a.GmailNumSyncd,GmailNumTotal:a.GmailNumTotal,GmailCacheSize:a.GmailCacheSize,GmailSyncAccounts:a.GmailSyncAccounts}},onSyncTimeChanged:function(e){t.vmMain.pluginManager.setSetting(PluginID.Gmail,PluginSettingsID.Gmail.SyncTime,e),this.hadGmailSyncUpdated=!0},onScheduleChange:function(e){t.vmMain.pluginManager.setSetting(PluginID.Gmail,PluginSettingsID.Gmail.ArchiveOnSchedule,e)},onOrganizeChange:function(e){t.vmMain.pluginManager.setSetting(PluginID.Gmail,PluginSettingsID.Gmail.ArchiveOnOrganize,e)},onSignatureChange:function(e){t.vmMain.pluginManager.setSetting(PluginID.Gmail,PluginSettingsID.Gmail.InsertSignatureAboveReplies,e)},onClickSetupAccounts:function(){this.props.openSection(i.SettingsSections.Linked)},render:function(){var e=t.vmMain.pluginManager.getPlugin(PluginID.Gmail),r=e.getSetting(PluginSettingsID.Gmail.SyncTime),a=e.getSetting(PluginSettingsID.Gmail.ArchiveOnSchedule),l=e.getSetting(PluginSettingsID.Gmail.ArchiveOnOrganize),d=e.getSetting(PluginSettingsID.Gmail.InsertSignatureAboveReplies),h=t.billingManager.hasPremium()?i.MaxGmailSyncTime.Premium:i.MaxGmailSyncTime.Free;return n.createElement("div",{className:"new-modal-group gmailSettings"},n.createElement("div",{className:"new-modal-row new-modal-row-1c center"},n.createElement(o,{raised:!0,onClick:this.onClickSetupAccounts},"SETUP ACCOUNTS")),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement("span",{style:{width:140}},"Offline sync days  "),n.createElement(c,{value:r,minValue:0,maxValue:h,onChange:this.onSyncTimeChanged}),n.createElement("div",{className:"subtext"},"The number of days in the past that your email will be saved for offline access.")),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(s,{ref:"archiveOnSchedule",checked:a,onChange:this.onScheduleChange},"Archive emails when scheduled"),n.createElement("div",{className:"subtext"},"If enabled, when you use the 'Schedule' feature to put an email on your calendar it will be archived.")),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(s,{ref:"archiveOnOrganize",checked:l,onChange:this.onOrganizeChange},"Archive emails when organized"),n.createElement("div",{className:"subtext"},"If enabled, when you drag an email to your outline it will be archived and marked as Moo.do/Handled.")),n.createElement("div",{className:"new-modal-row new-modal-row-1c"},n.createElement(s,{ref:"insertSignatureAboveReplies",checked:d,onChange:this.onSignatureChange},"Insert signature before quoted text in replies"),n.createElement("div",{className:"subtext"},"If enabled, your signature will be inserted above the quoted text in replies and will remove the '--' line that precedes it.")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("Components/FancyListItem",["require","globals","Constants","platform","react","MooReact","Components/FancyRippler"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("react")),r=e("MooReact"),a=e("Components/FancyRippler");return r.createClass({displayName:"FancyListItem",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{id:n.PropTypes.string,className:n.PropTypes.string,selected:n.PropTypes.bool},render:function(){var e=this.props,i=e.header,r=(e.clickable,e.subtext,_objectWithoutProperties(e,["header","clickable","subtext"])),s=t.classNames("fancyListItem c-popup-item",{header:e.header},{clickable:!e.header&&!1!==e.clickable},{"selected c-popup-item-selected c-border-heavy":e.selected},{subtext:e.subtext},e.className);return!1===e.ripple||i||!1===e.clickable?n.createElement("div",_extends({},r,{className:s}),this.props.children):n.createElement(a,_extends({},r,{className:s}),e.children)}})}),define("ReactModalSettings",["require","globals","Constants","platform","react","MooReact","PluginSettings","AccountManager","ReactInviteSection","ReactModalSettingsGeneral","ReactModalSettingsPlugins","ReactModalSettingsAccounts","ReactModalSettingsEarly","ReactModalSettingsLinked","ReactModalSettingsGCal","ReactModalSettingsContacts","ReactModalSettingsGmail","Components/FancyModal","Components/FancyListItem"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("react")),r=e("MooReact"),a=e("PluginSettings"),s=e("AccountManager"),o=e("ReactInviteSection"),c=e("ReactModalSettingsGeneral"),l=e("ReactModalSettingsPlugins"),d=e("ReactModalSettingsAccounts"),h=e("ReactModalSettingsEarly"),u=e("ReactModalSettingsLinked"),p=e("ReactModalSettingsGCal"),m=e("ReactModalSettingsContacts"),f=e("ReactModalSettingsGmail"),g=e("Components/FancyModal"),v=e("Components/FancyListItem");return r.createClass({displayName:"ReactModalSettings",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.createObservables({sectionOpened:this.props.section||i.SettingsSections.Plugins}),a.refresh(),a.getPluginEnabledObservable(PluginID.GCalendar).listen(this.onToggleGCal)},componentDidMount:function(){this.listenTo(t.billingManager.triggerBlocksUpdated)},getState:function(){for(var e={},t=a.pluginsAvailable,i=0;i<t.length;++i){var n=t[i];e[n+"Enabled"]=a.getPluginEnabledObservable(n)}return e},onToggleGCal:function(e){e&&setTimeout(function(){this.openSection(i.SettingsSections.GoogleCalendar)}.bind(this),0)},openSection:function(e){var i=!a.isSaveEnabled.get();i||t.menus.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(t){t&&(a.isSaveEnabled.set(!1),this.openSection(e))}.bind(this)),i&&this.sectionOpened.set(e)},showEarlyAndAccount:function(){return!t.isDemoMode()||!1},_checkLinkedAccountErrors:function(){for(var e=!1,i=t.vmMain.pluginManager.getPlugin(PluginID.Gmail).getSyncAccounts(),n=0;n<i.length;++n){var r=i[n];if(s.isConnected()){s.getAccountError(r)&&(e=!0)}}return e},_checkSectionError:function(e){var t=!1;switch(e){case i.SettingsSections.Linked:t=this._checkLinkedAccountErrors()}return t},renderListItem:function(e,i){var r,a=this._checkSectionError(e);if(a){var s=t.classNames("error","icon-warning");r=n.createElement("span",null,n.createElement("span",{className:s}),n.createElement("span",null,"\t"+e))}else r=n.createElement("span",null,"\t"+e);return n.createElement(v,{className:i&&!a?"indented":null,selected:this.state.sectionOpened===e,onClick:this.openSection.bind(this,e)},r)},renderPluginListItem:function(e,i){var r,a=t.vmMain.pluginManager.getPlugin(e),s=a&&a.hasSettingsError();if(s){var o=t.classNames("error","icon-warning");r=n.createElement("span",null,n.createElement("span",{className:o}),n.createElement("span",null,"\t"+i))}else r=n.createElement("span",null,"\t"+i);return n.createElement(v,{className:s?null:"indented",selected:this.state.sectionOpened===i,onClick:this.openSection.bind(this,i)},r)},isPluginEnabled:function(e){return this.state[e+"Enabled"]},render:function(){var e,r,a=(t.billingManager,this.state),s=a.sectionOpened;switch(s){case i.SettingsSections.General:r=c;break;case i.SettingsSections.Plugins:r=l;break;case i.SettingsSections.Invite:r=o;break;case i.SettingsSections.EarlyAccess:r=h;break;case i.SettingsSections.Account:r=d;break;case i.SettingsSections.Linked:r=u;break;case i.SettingsSections.GoogleCalendar:r=p;break;case i.SettingsSections.Contacts:r=m;break;case i.SettingsSections.Gmail:r=f;break;default:try{t.PAssert(5241,!1,"Unknown settings sections requested: ",s)}catch(e){t.reportError(e)}}e=n.createElement(r,{key:"content",openSection:this.openSection});var v="Settings - "+this.sectionOpened.get();return n.createElement(g,{id:"modalSettings",title:v,width:960,height:900,modalID:Modals.Settings},n.createElement("div",{key:"sidebar",width:170},this.renderListItem(i.SettingsSections.General),this.showEarlyAndAccount()&&this.renderListItem(i.SettingsSections.Account),this.renderListItem(i.SettingsSections.Plugins),this.isPluginEnabled(PluginID.GCalendar)&&this.renderPluginListItem(PluginID.GCalendar,i.SettingsSections.GoogleCalendar),this.isPluginEnabled(PluginID.Contacts)&&this.renderPluginListItem(PluginID.Contacts,i.SettingsSections.Contacts),this.isPluginEnabled(PluginID.Gmail)&&this.renderPluginListItem(PluginID.Gmail,i.SettingsSections.Gmail),this.showEarlyAndAccount()&&this.renderListItem(i.SettingsSections.Linked),this.renderListItem(i.SettingsSections.EarlyAccess),this.renderListItem(i.SettingsSections.Invite)),e)}})}),define("ReactModalAlert",["require","react","MooReact","Hotkeys","Constants","Components/FancyButton","Components/FancyModal"],function(e){var t=e("react"),i=e("MooReact"),n=e("Hotkeys"),r=e("Constants"),a=e("Components/FancyButton"),s=e("Components/FancyModal");return i.createClass({displayName:"ReactModalAlert",componentDisplay:r.ComponentDisplay.Everywhere,propTypes:{text:t.PropTypes.string.isRequired,actionText:t.PropTypes.string},getHotkeys:function(){return[n.create(KeyCode.Enter,!0,r.Primary.Either,r.Shift.Either,this.onClickButton)]},onClickButton:function(){this.refs.modal.close()},render:function(){var e=this.props.actionText||"OKAY";return t.createElement(s,{id:"modalAlert",closeButton:!1,small:!0,backdropClose:!1,scrollable:!1,modalID:Modals.Alert,ref:"modal"},t.createElement("div",{key:"content",dangerouslySetInnerHTML:{__html:this.props.text}}),t.createElement("div",{key:"buttons"},t.createElement(a,{primary:!0,onClick:this.onClickButton},e)))}})}),define("ReactModalBilling",["require","react","Constants","globals","MooReact","Components/FancyButton","Components/FancyLoader","Components/FancyModal"],function(e){var t={None:null,NoBraintreeGlobal:1,AddScriptFailure:2,NoRemoteToken:3,RemoteTokenParse:4,ContactingServer:5,NoClientIdentifier:6},i={None:null,MissingNonce:1,MissingPlanID:2,ServerFailure:3,UnauthorizedUser:4,InvalidParameter:5,MissingParameter:6,BraintreeUnknown:7,BraintreePaypalBlock:8,BraintreeInvalidCCN:9},n=["2m4b","gjgm","pmjw","5pm2"],r=e("react"),a=e("Constants"),s=e("globals"),o=e("MooReact"),c=e("Components/FancyButton"),l=e("Components/FancyLoader"),d=e("Components/FancyModal");return o.createClass({displayName:"ReactModalBilling",componentDisplay:a.ComponentDisplay.Desktop,init:function(){this._braintreeRequested=!1,this._braintreeLoaded=!1,this._clientTokenRequested=!1,this._clientTokenLoaded=!1,this._clientToken=void 0,this._btClient=void 0,this._btIntegration=void 0,this._isMethodUpdate=this.props.isUpdate,this.createObservables({isSubmitting:!1,isLoading:!0,billingFailureCode:t.None,signupFailureCode:i.None,signupErrorMessage:void 0}),this._ensureBraintreeLib(),this._ensureClientToken()},onUnmount:function(){this._btIntegration&&(this._btIntegration.teardown(),this._btIntegration=void 0)},_handlePaymentMethodUpdate:function(e){this._isMethodUpdate?e&&e.nonce?this._processUpdateNonce(void 0,e.nonce):this._processUpdateNonce({error:!0},void 0):e&&e.nonce?this._processPaymentNonce(void 0,e.nonce):this._processPaymentNonce({error:!0},void 0)},_notifyDependencyLoaded:function(){this._braintreeLoaded&&this._clientTokenLoaded&&(this._btClient=new braintree.api.Client({clientToken:this._clientToken}),braintree.setup(this._clientToken,"dropin",{container:"braintreeDropin",onPaymentMethodReceived:this._handlePaymentMethodUpdate,onError:function(e){s.reportError(e)},onReady:function(e){this.isLoading.set(!1),this._btIntegration=e}.bind(this)}))},_notifyDependencyLoadError:function(e){this.billingFailureCode.set(e),s.reportError(new Error("Client hit error in billing: "+e)),s.billingManager.setLastSignupError(e),s.sendEvent("Billing","SignupError_"+e)},_ensureBraintreeLib:function(){this._braintreeRequested||(window.braintree?(this._braintreeLoaded=!0,this._notifyDependencyLoaded()):(this._braintreeRequested=!0,s.addScriptHack("https://js.braintreegateway.com/v2/braintree.js","braintreeScript",function(){window.braintree?(this._braintreeLoaded=!0,this._notifyDependencyLoaded()):(this._braintreeRequested=!1,this._notifyDependencyLoadError(t.NoBraintreeGlobal))}.bind(this),function(){this._braintreeRequested=!1,this._notifyDependencyLoadError(t.AddScriptFailure)}.bind(this))))},_ensureClientToken:function(){var e=s.billingManager.getBillingIdentifier();e?this._clientTokenRequested||(this._clientTokenRequested=!0,s.XHR_PrivateAPI({type:"POST",path:"/billing/getToken",data:{email:e},requireAuth:!0,autoRetry:!0,maxRetries:1,cb:function(e){if(200===e.status){this._clientTokenLoaded=!0;try{var i=JSON.parse(e.responseText).data;i&&i.token?(this._clientToken=i.token,this._notifyDependencyLoaded()):this._notifyDependencyLoadError(t.NoRemoteToken)}catch(e){s.reportError(e),this._notifyDependencyLoadError(t.RemoteTokenParse)}}else this._clientTokenRequested=!1,this._notifyDependencyLoadError(t.ContactingServer)}.bind(this)})):this._notifyDependencyLoadError(t.NoClientIdentifier)},_setPaymentResponse:function(e){switch(e.code){case PrivateAPIErrorCodes.UnauthorizedUser:this.signupFailureCode.set(i.UnauthorizedUser),this.signupErrorMessage.set(void 0);break;case PrivateAPIErrorCodes.InvalidParameter:this.signupFailureCode.set(i.InvalidParameter),this.signupErrorMessage.set(void 0);break;case PrivateAPIErrorCodes.MissingParameter:this.signupFailureCode.set(i.MissingParameter),this.signupErrorMessage.set(void 0);break;case PrivateAPIErrorCodes.BraintreePaypalBlock:this.signupFailureCode.set(i.BraintreePaypalBlock),this.signupErrorMessage.set(e.data);break;case PrivateAPIErrorCodes.BraintreeInvalidCCN:this.signupFailureCode.set(i.BraintreeInvalidCCN),this.signupErrorMessage.set(e.data);break;case PrivateAPIErrorCodes.BraintreeUnknown:this.signupFailureCode.set(i.BraintreeUnknown),this.signupErrorMessage.set(e.data);break;default:this.signupFailureCode.set(i.ServerFailure),this.signupErrorMessage.set(void 0)}},_processUpdateNonce:function(e,t){s.sendEvent("Billing","PremiumUpdate"),!e&&t&&(this.isSubmitting.get()||(this.isSubmitting.set(!0),s.XHR_PrivateAPI({type:"POST",path:"/billing/updateMethod",data:{nonce:t},requireAuth:!0,cb:function(e){if(this.isSubmitting.set(!1),200===e.status)s.menus.isModalOpen(this.id)&&this.onClickClose(),s.menus.alert({text:"Your payment information has been updated.",actionText:"OKAY"}),s.sendEvent("Billing","PremiumUpdateSUCCESS");else{if(e.response)try{var t=JSON.parse(e.response);this._setPaymentResponse(t)}catch(e){s.reportError(e),this.signupFailureCode.set(i.ServerFailure),this.signupErrorMessage.set(void 0)}else this.signupFailureCode.set(i.ServerFailure),this.signupErrorMessage.set(void 0);s.sendEvent("Billing","PremiumUpdateFAILURE")}}.bind(this)})))},_processPaymentNonce:function(e,t){if(s.sendEvent("Billing","PremiumSignup"),!e&&t){this.signupFailureCode.set(i.None),this.signupErrorMessage.set(void 0);var r=n[s.billingManager.getBillingPeriod()];try{s.PAssert(5242,r,"Must have selected a valid plan to signup")}catch(e){s.reportError(e)}r?this.isSubmitting.get()||(this.isSubmitting.set(!0),s.XHR_PrivateAPI({type:"POST",path:"/billing/signup",data:{email:s.billingManager.getBillingIdentifier(),nonce:t,planID:r},requireAuth:!0,cb:function(e){if(this.isSubmitting.set(!1),200===e.status){s.billingManager.setPremiumStatus(PremiumStatus.Active),s.menus.isModalOpen(this.id)&&this.onClickClose(),s.menus.alert({text:"Thank you for signing up for <b>Moo.do</b> premium!",actionText:"OKAY"}),s.sendEvent("Billing","PremiumSignupSUCCESS");var t=s.parseInt(s.billingManager.getPlanPrice(n.indexOf(r)));s.reportAdConversion(a.ConversionID.Purchase,t)}else{if(e.response)try{var o=JSON.parse(e.response);this._setPaymentResponse(o)}catch(e){s.reportError(e),this.signupFailureCode.set(i.ServerFailure),this.signupErrorMessage.set(void 0)}else this.signupFailureCode.set(i.ServerFailure),this.signupErrorMessage.set(void 0);s.sendEvent("Billing","PremiumSignupFAILURE")}}.bind(this)})):(this.signupFailureCode.set(i.MissingPlanID),this.signupErrorMessage.set(void 0),s.sendEvent("Billing","PremiumSignupFAILURE"))}else this.signupFailureCode.set(i.MissingNonce),this.signupErrorMessage.set(void 0),s.sendEvent("Billing","PremiumSignupFAILURE")},onClickSubmit:function(){this.refs.form.submit()},onClickClose:function(){this.refs.modal.close()},render:function(){var e=this.state,t=e.billingFailureCode||e.signupFailureCode?200:400,i=s.classNames("billingSubmit loading20 right",{loading:e.isSubmitting},{
disabled:e.isLoading}),n=e.signupErrorMessage?e.signupErrorMessage:"There was an error processing your payment. We will follow up with you shortly.";return r.createElement(d,{id:"modalBilling",title:"Enter Billing Info",width:400,height:t,backdropClose:!1,scrollable:!1,modalID:Modals.Billing,ref:"modal"},r.createElement("div",{key:"content"},!e.billingFailureCode&&!e.signupFailureCode&&r.createElement("form",{id:"billingForm",method:"post",action:"javascript:void(0);",ref:"form"},r.createElement("div",{id:"braintreeDropin"}),e.isLoading&&r.createElement(l,{center:!0},"Loading billing system..."),!e.billingFailureCode&&r.createElement("div",{className:i},r.createElement("input",{type:"submit",className:"new-modal-button mat-button-raised mat-button-blue",value:"SUBMIT"}))),e.signupFailureCode&&r.createElement("div",{id:"billingSignupError"},n),e.billingFailureCode&&r.createElement("div",{id:"billingError"},"There was an error loading our payment system. Please contact support@moo.do with code "+e.billingFailureCode+" or try again in a few minutes.")),r.createElement("div",{key:"buttons",style:{textAlign:"right"}},e.billingFailureCode&&r.createElement(c,{primary:!0,onClick:this.onClickClose},"OK")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalConfirm",["require","react","MooReact","Hotkeys","Constants","Components/FancyButton","Components/FancyModal"],function(e){var t=e("react"),i=e("MooReact"),n=e("Hotkeys"),r=e("Constants"),a=e("Components/FancyButton"),s=e("Components/FancyModal");return i.createClass({displayName:"ReactModalConfirm",componentDisplay:r.ComponentDisplay.Everywhere,propTypes:{text:t.PropTypes.string.isRequired},getHotkeys:function(){return[n.create(KeyCode.Escape,!0,r.Primary.Either,r.Shift.Either,this.onClickNo),n.create(KeyCode.N,!0,r.Primary.Either,r.Shift.Either,this.onClickNo),n.create(KeyCode.Enter,!0,r.Primary.Either,r.Shift.Either,this.onClickYes),n.create(KeyCode.Y,!0,r.Primary.Either,r.Shift.Either,this.onClickYes)]},onClickYes:function(){this.refs.modal.close(!0)},onClickNo:function(){this.refs.modal.close(!1)},render:function(){return t.createElement(s,_extends({},this.props,{id:"modalConfirm",small:!0,backdropClose:!1,scrollable:!1,closeButton:!1,modalID:Modals.Confirm,ref:"modal"}),t.createElement("div",{key:"content"},this.props.text),t.createElement("div",{key:"buttons"},t.createElement(a,{primary:!0,width:100,onClick:this.onClickYes},"YES"),t.createElement(a,{width:100,onClick:this.onClickNo},"NO")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalOptions",["require","Constants","react","MooReact","Components/FancyButton","Components/FancyModal"],function(e){var t=e("Constants"),i=e("react"),n=e("MooReact"),r=e("Components/FancyButton"),a=e("Components/FancyModal");return n.createClass({displayName:"ReactModalOptions",componentDisplay:t.ComponentDisplay.Everywhere,propTypes:{text:i.PropTypes.string.isRequired,options:i.PropTypes.array.isRequired},onClickOption:function(e){this.refs.modal.close(e)},render:function(){return i.createElement(a,_extends({},this.props,{id:"modalOptions",title:"Please Choose",small:!0,backdropClose:!1,scrollable:!1,modalID:Modals.Options,ref:"modal"}),i.createElement("div",{key:"content"},this.props.text),i.createElement("div",{key:"buttons"},this.props.options.map(function(e,t){return i.createElement(r,{key:t,raised:!0,width:120,margin:"0 8px",onClick:this.onClickOption.bind(this,e)},e)}.bind(this)),i.createElement(r,{cancel:!0,raised:!0,width:100,margin:"0 8px",onClick:this.onClickOption},"Cancel")))}})}),define("ReactModalExport",["require","globals","Constants","data","platform","react","MooReact","NativeSel","Components/FancyButton","Components/FancyListItem","Components/FancyCheckbox","Components/FancyModal"],function(e){var t=e("globals"),i=e("Constants"),n=e("data"),r=e("platform"),a=e("react"),s=e("MooReact"),o=e("NativeSel"),c=e("Components/FancyButton"),l=e("Components/FancyListItem"),d=e("Components/FancyCheckbox"),h=e("Components/FancyModal");return s.createClass({displayName:"ReactModalExport",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},init:function(){this.createObservables({exportArchived:!1,includeNotes:!0,dataType:"html"})},setDataType:function(e){this.dataType.set(e)},exportData:function(){var e,t,i=n.getRootItem(),r=this.state.exportArchived,a=this.state.includeNotes;if("html"===this.dataType.get())e=n.toHtml(i,r,a),t=e;else if("text"===this.dataType.get()){e=n.toPlainText(i,0,r,a),t=e.replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")}else"json"===this.dataType.get()&&(e=n.toJSON(i,!1,r,a),t=e);return this.exportedContent=e,t},onChangeArchiveItems:function(e){e&&t.vmMain.parseSubtreeArchive(t.vmMain.root(),ChangeType.Auto),this.exportArchived.set(e)},onChangeIncludeNotes:function(e){this.includeNotes.set(e)},onTapOpen:function(){var e="text"===this.dataType.get()?this.exportData():this.exportedContent;open("url").document.write(e)},onTapSelect:function(){var e=o.createSelectionRange();e.selectNodeContents(this.refs.exportedContent),o.setSelectionRange(e)},onTapSaveExport:function(){var e;"html"===this.dataType.get()?e="html":"text"===this.dataType.get()?e="txt":"json"===this.dataType.get()&&(e="json");try{t.saveFile(this.exportedContent,"moodo."+e)}catch(e){t.reportError(e)}},onKeyDown:function(e){var t=r.getKeyCode(e);(r.mac&&e.metaKey||!r.mac&&e.ctrlKey)&&t===KeyCode.A&&this.onTapSelect(),e.preventDefault(),e.stopPropagation()},render:function(){var e=this.state.dataType,i=t.classNames("exportedContent",e),n=this.exportData();return a.createElement(h,{id:"modalExport",title:"Export Data",width:860,height:900,modalID:Modals.ExportData},a.createElement("div",{key:"sidebar",width:180},a.createElement(l,{header:!0},"Data Type"),a.createElement(l,{selected:"html"===e,onClick:this.setDataType.bind(this,"html")},"HTML"),a.createElement(l,{selected:"text"===e,onClick:this.setDataType.bind(this,"text")},"Plain Text"),a.createElement(l,{selected:"json"===e,onClick:this.setDataType.bind(this,"json")},"JSON"),a.createElement(l,{header:!0},"Options"),a.createElement(l,null,a.createElement(d,{checked:this.state.includeNotes,onChange:this.onChangeIncludeNotes},"Include Notes")),a.createElement(l,null,a.createElement(d,{checked:this.state.exportArchived,onChange:this.onChangeArchiveItems},"Archived Items")),a.createElement(l,{header:!0},"Export"),!r.app&&a.createElement(c,{onClick:this.onTapOpen},"OPEN IN TAB"),a.createElement(c,{onClick:this.onTapSelect},"SELECT"),a.createElement(c,{onClick:this.onTapSaveExport},"SAVE")),a.createElement("div",{key:"content"},a.createElement("div",{className:i,onKeyDown:this.onKeyDown,contentEditable:!0,dangerouslySetInnerHTML:{__html:n},ref:"exportedContent"})))}})}),define("dimport",["globals","platform","data","tracker","VMLI","parse","goog","International","AccountManager"],function(e,t,i,n,r,a,s,o,c){function l(){this.workflowy={login:this.workflowyLogin.bind(this),import:this.workflowyImport.bind(this),save:this.workflowySave.bind(this)},this.wunderlist={login:this.wunderlistLogin.bind(this),import:this.wunderlistImport.bind(this),save:this.wunderlistSave.bind(this)},this.iqtell={login:this.iqtellLogin.bind(this),import:this.iqtellImport.bind(this),save:this.iqtellSave.bind(this)},this.opml={login:this.opmlLogin.bind(this),import:this.opmlImport.bind(this),save:this.opmlSave.bind(this)},this.json={login:this.jsonLogin.bind(this),import:this.jsonImport.bind(this),save:this.jsonSave.bind(this)},this.gtasks={login:this.gtasksLogin.bind(this),import:this.gtasksImport.bind(this),save:this.gtasksSave.bind(this)},this.trello={preload:this.trelloPreload.bind(this),login:this.trelloLogin.bind(this),import:this.trelloImport.bind(this),save:this.trelloSave.bind(this)},this.todoist={login:this.todoistLogin.bind(this),import:this.todoistImport.bind(this),save:this.todoistSave.bind(this)}}function d(e){return e.toString(o.getFormat(DFormat.MonthDay))}return l.prototype={workflowyLogin:function(t,i,n,r){try{e.PAssert(5243,n,"Workflowy requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5244,r,"Workflowy requires an error callback")}catch(t){e.reportError(t)}return t?i?void e.XHR_PrivateAPI({type:"POST",path:"/oauth/workflowy",data:{username:t,password:i},cb:function(t){if(200===t.status){try{var i=JSON.parse(t.response);this.workflowy.data=JSON.parse(i.data)}catch(t){return e.reportError(t),r("Error parsing successful response from server. The developers have been notified with details of the error.")}return!this.workflowy.data||this.workflowy.data.error?r("Invalid username or password."):n()}var a;try{var s=JSON.parse(t.response);switch(s.code){case PrivateAPIErrorCodes.InvalidParameter:a="Must specify a username and password.";break;case PrivateAPIErrorCodes.UnauthorizedUser:a="Invalid username or password.";break;case PrivateAPIErrorCodes.ErrorContactingRemote:a=s.data;break;default:a="Error contacting server. The developers have been notified with details of the error."}}catch(t){a="Error parsing error response from server. The developers have been notified with details of the error.",e.reportError(t)}return r(a)}.bind(this)}):r("Must provide a password."):r("Must provide a valid username.")},workflowyImport:function(t,i){try{e.PAssert(5245,t,"Workflowy requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5246,i,"Workflowy requires an error callback")}catch(t){e.reportError(t)}return t(this.workflowy.data)},workflowyIterateItem:function(t,n){try{e.PAssert(5247,t&&void 0!==t.nm,"All items must exist and have stars and text, children and notes are optional",t)}catch(t){e.reportError(t)}try{e.PAssert(5249,n,"A valid parent must always be defined")}catch(t){e.reportError(t)}if(t&&n)try{var r=!!t.cp;if(!r){var a=e.stripFormattingTags(t.nm),s=i.createVMLI({text:a,isComplete:r},{parent:n,changeType:ChangeType.AllLocal});if(n.insertItem(s),t.no){var o=e.stripFormattingTags(t.no),c=i.createVMLI({text:o,isNote:!0},{parent:s,changeType:ChangeType.AllLocal});s.setNote(c,ChangeType.Local)}if(t.ch)for(var l=0;l<t.ch.length;++l){var d=t.ch[l];this.workflowyIterateItem(d,s)}}}catch(t){throw e.reportError(t),t}},workflowySave:function(t,r,a){try{e.PAssert(5250,t,"Workflowy requires having valid data")}catch(t){e.reportError(t)}try{e.PAssert(5251,r,"Workflowy requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5252,a,"Workflowy requires an error callback")}catch(t){e.reportError(t)}try{try{e.PAssert(5253,t.projectTreeData,"Missing Workflowy projectTreeData")}catch(t){e.reportError(t)}try{e.PAssert(5254,t.projectTreeData.mainProjectTreeInfo,"Missing Workflowy mainProjectTreeInfo")}catch(t){e.reportError(t)}var s=t.projectTreeData.mainProjectTreeInfo;try{e.PAssert(5255,s.rootProjectChildren,"Missing Workflowy rootProjectChildren")}catch(t){e.reportError(t)}n.beginAction(),e.vmMain.beginUpdateItems();var o=i.getRootModel();try{e.PAssert(5256,o,"Root item must exist in order to import")}catch(t){e.reportError(t)}var c=i.createVMLI({text:"Workflowy Import"},{parent:o,changeType:ChangeType.AllLocal});o.insertItem(c);try{for(var l=0;l<s.rootProjectChildren.length;++l){var d=s.rootProjectChildren[l];this.workflowyIterateItem(d,c)}e.vmMain.parseSubtree(c,ChangeType.Local|ChangeType.All)}catch(t){return e.reportError(t),a("There was an error iterating your Workflowy items. The developers have been notified with daetails of the error.",t)}return e.vmMain.commitUpdateItems(),n.endAction(),r()}catch(t){return e.reportError(t),a("There was an error parsing your Workflowy data. The developers have been notified with details of the error.",t)}},wunderlistLogin:function(t,i,n,r){try{e.PAssert(5257,n,"Wunderlist requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5258,r,"Wunderlist requires an error callback")}catch(t){e.reportError(t)}var a="localhost"===window.location.hostname?"f06a1334e250a9bb0b03":"ad988eeb954e9aabc288",s=window.location.protocol+"//"+window.location.host+"/oauthRelay.html";this.wunderlist.clientId=a;var o="Dchs"+(new Date).getTime(),c="https://www.wunderlist.com/oauth/authorize?client_id="+a+"&redirect_uri="+s+"&state="+o;window.open(c,"wunderlist","height=600,width=550");var l=function(t){var i=e.getLocationOrigin(),a=!1;try{a=t.data.state===o}catch(t){e.reportError(t)}if(i&&a)if(window.removeEventListener("message",l),t.data.error)r("Error authenticating with Wunderlist");else{var s=t.data.code;s&&e.XHR_PrivateAPI({type:"POST",path:"/oauth/wunderlist",data:{code:s},requireAuth:!0,cb:function(e){if(200===e.status){try{var t=JSON.parse(e.response).data;this.wunderlist.token=t.access_token}catch(e){r("Error parsing response from remote server.",e)}this.wunderlist.token?n():r("Invalid username or password.")}else r("Error contacting remote server.")}.bind(this)})}}.bind(this);window.addEventListener("message",l)},wunderlistImport:function(t,i){try{e.PAssert(5259,t,"Wunderlist requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5260,i,"Wunderlist requires an error callback")}catch(t){e.reportError(t)}var n={inbox:{title:"inbox",items:{},p:0}},r=0;this.wunderlistGetLists(function(e){for(var a=0;a<e.length;++a){var s=e[a];n[s.id]={title:s.title,items:{},p:s.position},this.wunderlistGetTasks(s.id,function(a){for(var o=0;o<a.length;++o){var c=a[o];if(c.parent_id){var l=n[c.list_id].items[c.parent_id];l?(l.items||(l.items=[]),l.items.push(c)):n[c.list_id].items[c.parent_id]={items:[c]}}else{var d=n[c.list_id].items[c.id];n[c.list_id].items[c.id]=c,d&&(n[c.list_id].items[c.id].items=d.items)}}this.wunderlistGetSubtasks(s.id,function(i){for(var a=0;a<i.length;++a){var s=i[a],o=n[s.list_id];if(o)if(s.parent_id){var c=o.items[s.parent_id];c?(c.items||(c.items=[]),c.items.push(s)):o.items[s.parent_id]={items:[s]}}else{var l=o.items[s.id];o.items[s.id]=s,l&&(o.items[s.id].items=l.items)}}++r===e.length&&t(n)}.bind(this),i)}.bind(this),i)}}.bind(this),i)},wunderlistGetLists:function(t,i){try{e.PAssert(5261,t,"Wunderlist requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5262,i,"Wunderlist requires an error callback")}catch(t){e.reportError(t)}e.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/lists",headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var n;try{n=JSON.parse(e.response)}catch(e){i("There was an error parsing your Wunderlist data. The developers have been notified with details of the error.",e)}t(n)}else i("Error contacting remote server.")}.bind(this)})},wunderlistGetTasks:function(t,i,n){try{e.PAssert(5263,i,"Wunderlist requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5264,n,"Wunderlist requires an error callback")}catch(t){e.reportError(t)}e.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/tasks?list_id="+t,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var t=JSON.parse(e.response);i(t)}else n("Error contacting remote server.")}.bind(this)})},wunderlistGetSubtasks:function(t,i,n){try{e.PAssert(5265,i,"Wunderlist requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5266,n,"Wunderlist requires an error callback")}catch(t){e.reportError(t)}e.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/subtasks?list_id="+t,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var t=JSON.parse(e.response);i(t)}else n("Error contacting remote server.")}.bind(this)})},wunderlistSave:function(t,r,a){try{e.PAssert(5267,r,"Wunderlist requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5268,a,"Wunderlist requires an error callback")}catch(t){e.reportError(t)}try{n.beginAction(),e.vmMain.beginUpdateItems();var s=i.getRootModel();try{e.PAssert(5269,s,"Root item must exist in order to import")}catch(t){e.reportError(t)}var o=i.createVMLI({text:"Wunderlist Import"},{parent:s,changeType:ChangeType.AllLocal});s.insertItem(o);for(var c in t){var l=t[c],d=l.title,h=i.createVMLI({text:d},{parent:o,changeType:ChangeType.AllLocal});o.insertItem(h);for(var u in l.items){var p=l.items[u],m=i.createVMLI({text:p.title,isComplete:!!p.completed_at,dateCompleted:p.completed_at,isStarred:p.starred},{parent:h,changeType:ChangeType.AllLocal});if(h.insertItem(m),p.note){var f=i.createVMLI({text:p.note},{parent:m,changeType:ChangeType.AllLocal});m.insertItem(f)}if(p.items)for(var g=0;g<p.items.length;++g){var v=p.items[g],y=i.createVMLI({text:v.title,isComplete:!!v.completed_at,dateCompleted:v.completed_at,isStarred:v.starred},{parent:m,changeType:ChangeType.AllLocal});m.insertItem(y)}}}e.vmMain.parseSubtree(o,ChangeType.Local|ChangeType.All),e.vmMain.commitUpdateItems(),n.endAction(),r()}catch(e){a(void 0,e)}},iqtellLogin:function(t,i,n,r){try{e.PAssert(5270,n,"IQTell requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5271,r,"IQTell requires an error callback")}catch(t){e.reportError(t)}var a=document.getElementById("importFileUploadButton");a.onchange=n,a.click()},_readMultipleFiles:function(t,i,n){function r(){var e="";for(var t in m)e+=a._parseIQTellFilename(t)+": "+m[t]+"\r\n";return e}function s(){h&&l+d===t.length&&(d>0?n(r()):i(u,p))}function o(e,t,i){u[t]=e,p[t]=i,l++,s()}function c(e,t){m[t]=e,d++,s()}for(var l=0,d=0,h=!1,u={},p={},m={},f=0;f<t.length;++f){var g=new FileReader;g.onload=function(t,i){var n=i.target.result;if(n){var r=a.parseCSV(n);r&&!e.isString(r)?o(r,t,n):c(r||"Error parsing IQTell import. Please validate your data.",t)}else c("Unable to load IQTell data. Please contact support.",t)}.bind(this,t[f].name),g.onerror=function(e,t){c(t,e)}.bind(this,t[f].name),g.readAsText(t[f])}h=!0,s()},iqtellImport:function(t,i){function r(r,s){n.beginAction(),e.vmMain.beginUpdateItems();var o;try{o=a.iqtellProcess(r,s)}catch(t){e.reportError(t,s)}log("IQTell output: ",o),e.vmMain.commitUpdateItems(),n.endAction(),o?t():i("Error parsing IQTell import. Please contact support")}try{e.PAssert(5272,t,"IQTell requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5273,i,"IQTell requires an error callback")}catch(t){e.reportError(t)}try{var s=document.forms.importFileUpload.importFile.files;s&&0!==s.length?this._readMultipleFiles(s,r,i):i("You must select a file before importing.")}catch(e){i(void 0,e)}},iqtellSave:function(t,i,n){try{e.PAssert(5274,i,"IQTell requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5275,n,"IQTell requires an error callback")}catch(t){e.reportError(t)}i()},opmlLogin:function(t,i,n,r){try{e.PAssert(5276,n,"OPML requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5277,r,"OPML requires an error callback")}catch(t){e.reportError(t)}var a=document.getElementById("importFileUploadButton");a.onchange=n,a.click()},opmlImport:function(t,i){try{e.PAssert(5278,t,"OPML requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5279,i,"OPML requires an error callback")}catch(t){e.reportError(t)}try{var r=new FileReader,s=document.forms.importFileUpload.importFile.files[0];s?(r.onload=function(r){var o,c=r.target.result;if((c.startsWith("<?xml ")||c.startsWith("<?opml ")||c.startsWith("<opml "))&&(o=e.loadXML(c)),o){n.beginAction(),e.vmMain.beginUpdateItems();var l=a.parseOPML(o,s.name);e.vmMain.commitUpdateItems(),n.endAction(),l?t():i("Error parsing OPML. Please validate your data.")}else i("Unable to load XML lib. Please update or try another browser.")},r.onerror=i,r.readAsText(s)):i("You must select a file before importing.")}catch(e){i(void 0,e)}},opmlSave:function(t,i,n){try{e.PAssert(5280,i,"OPML requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5281,n,"OPML requires an error callback")}catch(t){e.reportError(t)}i()},jsonLogin:function(t,i,n,r){try{e.PAssert(5282,n,"JSON requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5283,r,"JSON requires an error callback")}catch(t){e.reportError(t)}var a=document.getElementById("importFileUploadButton"),s=!1;a.onchange=function(e){s=!0,n(e)},a.click();var o=function(){s||r(!1),document.body.onfocus=void 0};document.body.onfocus=o},jsonImport:function(t,i){try{var r=new FileReader,s=document.forms.importFileUpload.importFile.files[0];s?(r.onload=function(r){var s=r.target.result;if(!s)return i("Unable to import your requested file. Please try a different file.");try{var o=JSON.parse(s)}catch(e){return i("The JSON is not properly formatted. Please re-validate or send the file to support@moo.do.")}try{n.beginAction(),e.vmMain.beginUpdateItems();var c=a.parseJSON(o);return e.vmMain.commitUpdateItems(),n.endAction(),c?t():i("Invalid JSON format. The developers have been notified with details of the error.")}catch(e){return i("The JSON file has errors. The developers have been notified with details of the error.",e)}},r.onerror=i,r.readAsText(s)):i("You must select a file before importing.")}catch(e){i(void 0,e)}},jsonSave:function(t,i,n){try{e.PAssert(5284,i,"JSON requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5285,n,"JSON requires an error callback")}catch(t){e.reportError(t)}i()},gtasksLogin:function(t,i,n,r){try{e.PAssert(5290,n,"GTasks requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5291,r,"GTasks requires an error callback")}catch(t){e.reportError(t)}s.runAuthenticate([GScope.TasksRO],!1,!1,function(e){e&&!e.error?(this.gtasks.token=e,n(e)):r("Unable to authenticate with Google. Please try again.",e)}.bind(this))},gtasksImport:function(t,i){try{e.PAssert(5292,t,"GTasks requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5293,i,"GTasks requires an error callback")}catch(t){e.reportError(t)}var n={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(function(r){try{e.PAssert(5294,e.isArray(r),"List data must be an array")}catch(t){e.reportError(t)}for(var a=r.length,s=0,o=0;o<r.length;++o){var c=r[o];n.remoteItems[c.id]={id:c.id,text:c.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},n.roots.push(c.id),this.gtasksGetTasks(c,function(r,o){if(r){try{e.PAssert(5295,e.isArray(r),"List data must be an array")}catch(t){e.reportError(t)}if(e.isArray(r)){for(var c=0;c<r.length;++c){var l=r[c];if(l&&"completed"!==l.status){n.remoteItems[l.id]={id:l.id,text:l.title,isComplete:"completed"===l.status,dateCompleted:l.completed?new Date(l.completed):void 0,isArchived:l.hidden,due:l.due?new Date(l.due):void 0,notes:l.notes,parent:l.parent||o.id,items:[]};var d=n.remoteItems[l.parent||o.id];d?d.items.push(l.id):n.unassigned.push(l.id)}}s++,s===a&&t(n)}else i("Invalid task list returned.")}else s++}.bind(this),i)}}.bind(this),i)},gtasksGetLists:function(t,i){try{e.PAssert(5296,t,"GTasks requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5297,i,"GTasks requires an error callback")}catch(t){e.reportError(t)}e.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults=2000&key="+window.gapiKey+"&access_token="+c.getDefaultAccessToken(),cb:function(n){if(200===n.status)try{var r=JSON.parse(n.response);try{e.PAssert(5298,r&&r.items,"Must have a valid set of data to get tasks from")}catch(t){e.reportError(t)}r&&r.items?t(r.items):i("Error getting data from remote server.")}catch(e){i(e)}else i("Error contacting remote server.")}.bind(this)})},gtasksGetTasks:function(t,i,n){try{e.PAssert(5299,t,"GTasks requires a valid list to get tasks from")}catch(t){e.reportError(t)}try{e.PAssert(5300,i,"GTasks requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5301,n,"GTasks requires an error callback")}catch(t){e.reportError(t)}e.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/lists/"+t.id+"/tasks?maxResults=2500&key="+window.gapiKey+"&access_token="+c.getDefaultAccessToken(),cb:function(r){if(200===r.status)try{var a=JSON.parse(r.response);try{e.PAssert(5302,a,"Must have a valid array of tasks")}catch(t){e.reportError(t)}a&&a.items?i(a.items,t):i([],t)}catch(e){n(e)}else n("Error contacting remote server.")}.bind(this)})},gtasksSave:function(t,r,a){function s(e,n){var r=e.text;e.due&&(r+=" @"+d(e.due));var a=i.createVMLI({text:r,isComplete:e.isComplete,dateCompleted:e.dateCompleted?e.dateCompleted.getTime():e.dateCompleted,isArchived:e.isArchived},{parent:n,changeType:ChangeType.AllLocal});if(n.insertItem(a),e.notes){var o=i.createVMLI({text:e.notes,isNote:!0},{parent:a,changeType:ChangeType.AllLocal});a.setNote(o,ChangeType.Local)}for(var c=0;c<e.items.length;++c)s(t.remoteItems[e.items[c]],a)}try{e.PAssert(5303,r,"GTasks requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5304,a,"GTasks requires an error callback")}catch(t){e.reportError(t)}try{try{e.PAssert(5305,0===t.unassigned.length,"We should never have unassigned tasks")}catch(t){e.reportError(t)}n.beginAction(),e.vmMain.beginUpdateItems();var o=i.getRootModel();try{e.PAssert(5306,o,"Root item must exist in order to import")}catch(t){e.reportError(t)}var c=i.createVMLI({text:"Google Tasks Import"},{parent:o,changeType:ChangeType.AllLocal});o.insertItem(c);for(var l=0;l<t.roots.length;++l)s(t.remoteItems[t.roots[l]],c);e.vmMain.parseSubtree(c,ChangeType.Local|ChangeType.All),e.vmMain.commitUpdateItems(),n.endAction(),r()}catch(e){a(void 0,e)}},trelloPreload:function(t,i){window.Trello||this.trello.isLoading?t():(this.trello.isLoading=!0,e.addScript("https://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",function(){e.addScript("https://api.trello.com/1/client.js?key=667ecf0c3d3e029c51d205b7173f6c38","trelloScript",function(){this.trello.isLoading=!1;try{e.PAssert(5307,window.Trello,"The Trello client lib must have been loaded correctly")}catch(t){e.reportError(t)}window.Trello?t():i("Error loading Trello. Please try again.")}.bind(this),function(e){this.trello.isLoading=!1,i(e)})}.bind(this),function(e){this.trello.isLoading=!1,i(e)}))},trelloLogin:function(i,n,r,a){try{e.PAssert(5308,window.Trello,"The Trello client lib was not properly loaded")}catch(t){e.reportError(t)}if(window.Trello){if(t.appPlatform===AppPlatform.Chrome){var s=function(t){e.getLocationOrigin()&&(window.removeEventListener("message",s),t.data.error?a("Error authenticating with Trello."):(Trello.setToken(t.data.token),r()))};window.addEventListener("message",s)}Trello.authorize({type:t.appPlatform===AppPlatform.Chrome?"redirect":"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:r,error:a})}else a("Error loading Trello. Please try again.")},trelloImport:function(t,i){var n=[];Trello.get("members/me/boards",e.protectFn(function(e){function r(){s===o&&t(n)}function a(e){o++,r()}e=e||[];for(var s=e.length,o=0,c=0;c<e.length;++c){var l=e[c];if(l.closed)s--;else{var d={text:l.name,items:[]};n.push(d),this._handleBoard(d,l.id,i,a)}}r()}.bind(this),i),i)},_handleBoard:function(t,i,n,r){Trello.get("boards/"+i+"/lists",e.protectFn(function(e){function i(){s===o&&r()}function a(){s++,i()}for(var s=0,o=e.length,c=0;c<e.length;++c){var l=e[c];if(l.closed)o--;else{var d={text:l.name,items:[]};t.items.push(d),this._handleList(d,l.id,n,a)}}i()}.bind(this),n),n)},_handleList:function(t,i,n,r){Trello.get("lists/"+i+"/cards",e.protectFn(function(e){function i(){s===o&&r()}function a(){s++,i()}for(var s=0,o=e.length,c=0;c<e.length;++c){var l=e[c];if(l.closed)o--;else{var h={text:l.name};if(l.labels&&l.labels.length>0){for(var u="",p=0;p<l.labels.length;++p){var m=l.labels[p];u+=TagPrefix+(m.name.length>0?m.name:m.color)+" "}h.text=u+h.text}if(l.due&&(h.text+=" "+DatePrefix+d(new Date(l.due))),l.desc&&l.desc.length>0){h.items=[];for(var f=l.desc.split("\n"),p=0;p<f.length;++p){var g=f[p];g&&g.length>0&&h.items.push({text:g})}}if(l.idChecklists&&l.idChecklists.length>0){h.items||(h.items=[]);for(var p=0;p<l.idChecklists.length;++p)this._handleChecklist(h,l.idChecklists[p],n,a)}else s++;t.items.push(h)}}i()}.bind(this),n),n)},_handleChecklist:function(t,i,n,r){Trello.get("checklists/"+i+"/",e.protectFn(function(e){for(var i={text:e.name,isCollapsed:!0,items:[]},n=0;n<e.checkItems.length;++n){var a=e.checkItems[n],s="complete"===a.state;if(!s){var o={text:a.name,isComplete:s};i.items.push(o)}}t.items.push(i),r()}.bind(this),n),n)},trelloSave:function(t,r,a){function s(e,t){var n=i.createVMLI({text:e.text,isComplete:e.isComplete,isCollapsed:e.isCollapsed},{parent:t,changeType:ChangeType.AllLocal});if(t.insertItem(n),e.items)for(var r=0;r<e.items.length;++r)s(e.items[r],n);return n}try{n.beginAction(),e.vmMain.beginUpdateItems();var o=i.getRootModel();try{e.PAssert(5309,o,"Root item must exist in order to import")}catch(t){e.reportError(t)}var c=i.createVMLI({text:"Trello Import"},{parent:o,changeType:ChangeType.AllLocal});o.insertItem(c);for(var l=0;l<t.length;++l)s(t[l],c);e.vmMain.commitUpdateItems(),n.endAction()}catch(e){return a(e)}r()},todoistLogin:function(t,i,n,r){try{e.PAssert(5310,n,"Todoist requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5311,r,"Todoist requires an error callback")}catch(t){e.reportError(t)}var a="localhost"===window.location.hostname?"5d361221eddb4bcdb018457c7c74e698":"b701ac04f4df419ca4144ab208a9fb06",s="Dchs"+(new Date).getTime(),o="https://todoist.com/oauth/authorize?client_id="+a+"&scope=data:read&state="+s;window.open(o,"todoist","height=600,width=550");var c=function(t){var i=e.getLocationOrigin(),a=!1;try{a=t.data.state===s}catch(t){e.reportError(t)}if(i&&a)if(window.removeEventListener("message",c),t.data.error)r("Error authenticating with Todoist");else{var o=t.data.code;o&&e.XHR_PrivateAPI({type:"POST",path:"/oauth/todoist",data:{code:o},requireAuth:!0,cb:function(e){if(200===e.status){try{var t=JSON.parse(e.response).data;this.todoist.data=t}catch(e){r("Error parsing response from remote server.",e)}this.todoist.data?n():r("Invalid username or password")}else r("Error contacting remote server.")}.bind(this)})}}.bind(this);window.addEventListener("message",c)},todoistImport:function(t,i){try{e.PAssert(5312,t,"Todoist requires a success callback")}catch(t){e.reportError(t)}try{e.PAssert(5313,i,"Todoist requires an error callback")}catch(t){e.reportError(t)}for(var n=this.todoist.data,r={},a=0;a<n.projects.length;++a){var s=n.projects[a];s.is_archived||s.is_deleted||(r[s.id]={name:s.name,items:[]})}for(var a=0;a<n.items.length;++a){var o=n.items[a];!r[o.project_id]||o.is_deleted||o.is_archived||o.checked||r[o.project_id].items.push(o)}t(r)},todoistSave:function(t,r,a){var s=[VMLIFlag.None,VMLIFlag.None,VMLIFlag.P2,VMLIFlag.P1,VMLIFlag.P0];try{n.beginAction(),e.vmMain.beginUpdateItems();var o=i.getRootModel();try{e.PAssert(5314,o,"Root item must exist in order to import")}catch(t){e.reportError(t)}var c=i.createVMLI({text:"Todoist Import"},{parent:o,changeType:ChangeType.AllLocal});o.insertItem(c);for(var l in t){var h=t[l],u=h.items;u.sort(function(e,t){return e.item_order>t.item_order});var p=i.createVMLI({text:h.name},{parent:c,changeType:ChangeType.AllLocal});c.insertItem(p);for(var m={},f=0;f<u.length;++f){var g=u[f];try{e.PAssert(5315,!g.parent_id||m[g.parent_id],"Parent exists and has not been created yet")}catch(t){e.reportError(t)}var v=g.parent_id?m[g.parent_id]:p;v||(v=p,g.content="[Error] "+g.content),m[g.id]=function(e,t){e.priority&&(e.priority=s[e.priority]),e.due_date_utc&&(e.content+=" @"+d(new Date(e.due_date_utc)));var n=i.createVMLI({text:e.content||"",isCollapsed:!!e.collapsed,priority:e.priority},{parent:t,changeType:ChangeType.AllLocal});return t.insertItem(n),n}(g,v)}}e.vmMain.commitUpdateItems(),n.endAction()}catch(e){return a(e)}r()}},l}),
define("ReactModalImport",["require","globals","Constants","react","MooReact","dimport","Components/FancyModal","Components/FancyListItem","Components/FancyButton","Components/FancyInput"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("dimport"),s=e("Components/FancyModal"),o=e("Components/FancyListItem"),c=e("Components/FancyButton"),l=e("Components/FancyInput");return r.createClass({displayName:"ReactModalImport",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},init:function(){var e=this.props.importer;"GTasks"===e&&(e="Google Tasks"),this.createObservables({isImporting:!1,preloadDisable:0,currentImporter:e||"JSON",importMessage:""}),this.importer=new a},getImporterFromName:function(e){var i;switch(e){case"Wunderlist":i=this.importer.wunderlist;break;case"Workflowy":i=this.importer.workflowy;break;case"OPML":i=this.importer.opml;break;case"JSON":i=this.importer.json;break;case"Text":i=this.importer.text;break;case"GTasks":case"Google Tasks":i=this.importer.gtasks;break;case"Trello":i=this.importer.trello;break;case"Todoist":i=this.importer.todoist;break;case"Toodledo":i=this.importer.toodledo;break;case"IQTell":i=this.importer.iqtell;break;default:try{t.PAssert(5316,!1,"Must add valid importer: ",e)}catch(e){t.reportError(e)}}return i},selectImporter:function(e){var t=this.getImporterFromName(e);this.currentImporter.set(e),this.importMessage.set(""),this.isImporting.set(!1),t&&t.preload&&!t.isLoaded&&(this.preloadDisable.set(this.preloadDisable.get()+1),this.importMessage.set("Loading Trello login..."),t.preload(function(){this.preloadDisable.set(this.preloadDisable.get()-1);var e=this.getImporterFromName(this.currentImporter.get());0===this.preloadDisable.get()&&e&&e.preload&&this.importMessage.set("")}.bind(this),function(e){this.preloadDisable.set(this.preloadDisable.get()-1),this.importMessage.set("Error loading Trello. Please try again.")}.bind(this)))},onImportError:function(e,i){!1!==e?(e&&t.isString(e)||(i||(i=e),e="Moo.do encountered an error importing your data. The developers have been notified with details of the error."),t.reportError(i||e,e),this.importMessage.set(e)):this.importMessage.set(""),this.isImporting.set(!1)},runImport:function(e,i,n){if(!(this.isImporting.get()||this.preloadDisable.get()>0)){var r=this.getImporterFromName(e);if(r){t.sendEvent("Menu","Import"+e),this.isImporting.set(!0),this.importMessage.set("Importing...");try{setTimeout(function(){r.login(i,n,function(){r.import(function(i){r.save(i,function(){this.isImporting.set(!1),this.importMessage.set(""),t.menus.alert({text:"Your data has been imported successfully!",actionText:"OK",callback:function(){t.menus.closeModalNew(Modals.ImportData)}}),t.sendEvent("ImportSuccess",e)}.bind(this),this.onImportError)}.bind(this),this.onImportError)}.bind(this),this.onImportError)}.bind(this),0)}catch(e){this.onImportError("There was an issue importing your data. Please try again later.",e)}}}},onTapSelect:function(e){this.selectImporter(e,this.onImportSuccess,this.onImportError)},whichArea:function(){switch(this.state.currentImporter){case"Wunderlist":return"OAuthArea";case"Workflowy":return"LoginArea";case"OPML":case"JSON":return"UploadArea";case"Google Tasks":case"GTasks":case"Trello":case"Todoist":case"Toodledo":return"OAuthArea";case"IQTell":return"UploadAreaIQTell";default:try{t.PAssert(5317,!1,"Must add valid importer")}catch(e){t.reportError(e)}}return!1},onClickImport:function(){if(!this.isImporting.get()){var e=this.refs.email&&this.refs.email.getValue(),t=this.refs.password&&this.refs.password.getValue();this.runImport(this.state.currentImporter,e,t)}},renderListItem:function(e){return n.createElement(o,{selected:this.state.currentImporter===e,onClick:this.onTapSelect.bind(this,e)},e)},renderContent:function(){var e,t=this.state,i=this.state.currentImporter,r=this.whichArea(i);return"LoginArea"===r?e=n.createElement("div",null,n.createElement("div",{className:"importTitle"},"Import data from ",i),n.createElement(l,{floatingText:"Email",display:"block",ref:"email"}),n.createElement(l,{type:"password",floatingText:"Password",display:"block",ref:"password"}),n.createElement("br",null)):"UploadArea"===r?e=n.createElement("div",{id:"importUploadArea"},n.createElement("div",{className:"importTitle"},"Upload ",i," file"),n.createElement("div",null,"Select a","OPML"===i?"n":""," ",i," file to upload"),n.createElement("form",{name:"importFileUpload"},n.createElement("input",{id:"importFileUploadButton",type:"file",required:"required",name:"importFile"}))):"UploadAreaIQTell"===r?e=n.createElement("div",{id:"importUploadArea"},n.createElement("div",{className:"importTitle"},"Upload ",i," files [BETA]"),n.createElement("div",null,"Export each folder from IQTell that you would like to import. You must include either the 'Short Descripton' or 'Title' fields for each. Select *all* of the exported files at once to do a single import otherwise data may be missing."),n.createElement("div",null," "),n.createElement("div",null,"Please report any issues to support@moo.do with a description of what you expect vs what you are seeing. Screenshots are very helpful."),n.createElement("form",{name:"importFileUpload"},n.createElement("input",{id:"importFileUploadButton",type:"file",required:"required",name:"importFile",multiple:!0}))):"OAuthArea"===r&&(e=n.createElement("div",null,n.createElement("div",{className:"importTitle"},"Import data from ",i),n.createElement("div",null,"Click to login to your account"))),n.createElement("div",{className:"importInside"},e,n.createElement(c,{primary:!0,enabled:0===t.preloadDisable&&!t.isImporting,onClick:this.onClickImport},"IMPORT"),n.createElement("div",{className:"importMessage"},t.importMessage))},render:function(){return n.createElement(s,{id:"modalImport",title:"Import Data",width:600,height:600,modalID:Modals.ImportData},n.createElement("div",{key:"sidebar",width:180},n.createElement(o,{header:!0},"Import from app"),this.renderListItem("Wunderlist"),this.renderListItem("Google Tasks"),this.renderListItem("Workflowy"),this.renderListItem("IQTell"),this.renderListItem("Trello"),this.renderListItem("Todoist"),n.createElement(o,{header:!0},"Import from data"),this.renderListItem("JSON"),this.renderListItem("OPML")),n.createElement("div",{key:"content"},this.renderContent()))}})}),define("recovery",["globals","data","gdata","AccountManager"],function(e,t,i,n){function r(e){return e?e.value:void 0}function a(e){var t;if(e){var i;o.lastIndex=0,t=null!==(i=o.exec(e.json))?e.json.substr(0,i.index)+window.EmbedAttachChar+i[1]+window.EmbedAttachChar+e.json.substr(i.index+i[0].length):e.json}return t}function s(){}var o=/(?:â(p:[^â]+)â)/gi;s.prototype={_fixPlugins:function(e){this.transformRawRevisionData(e,function(e){if(e.t){var t=a(e.t);t!==e.t.json&&log("Fixed Plugin: "+t),e.t.json=t}})},recoverRevision:function(e,t,i){var n=this.getCurrentDocID();this.getRawRevisionData(n,e,function(e){if(!e)return log("Unable to get revision data"),i();this._fixPlugins(e),this.runRecovery(n,e,t,i)}.bind(this))},runRecovery:function(n,r,a,s){var o={path:"/upload/drive/v2/files/"+n+"/realtime",method:"PUT",params:{uploadType:"media",fileId:n},headers:{"Content-Type":"text/plain;"},body:r},c=gapi.client.request(o),l=i.model.getRoot().get("recoverVersion")||0;i.model.getRoot().set("recoverVersion",l+1),i.clearItemEventListeners(),c.then(function(n){log("Recovery Success: ",n),e.settings.set(Settings.localRecoverVersion,l+1),i.model.getRoot().set("recoverVersion",l+1),t.addDefaultSkipSetting(Settings.gdocId,"Default"),t.addDefaultSkipSetting(Settings.gdocTitle,"Default"),i.close(!0),a()},function(e){log("Recovery Failure: ",e),s()})},getCurrentRevision:function(){var t;try{t=i.doc.getModel().serverVersion}catch(t){e.reportError(t)}return t},getCurrentDocID:function(){var t;try{t=e.settings.get(Settings.gdocId)}catch(t){e.reportError(t)}return t},getRawRevisionData:function(t,i,r){var a=n.getDefaultAccessToken();if(a){var s="https://www.googleapis.com/drive/v2/files/"+(t||this.getCurrentDocID())+"/realtime";i&&(s+="?revision="+i),e.XHR({type:"GET",url:s,headers:{Authorization:"Bearer "+a},cb:function(t){if(200===t.status)try{var i=JSON.parse(t.responseText);r(i)}catch(t){e.reportError(t),r()}else r()}})}else log("Invalid OAuth token"),r()},getDefaultRawRevisionData:function(e,t){return this.getRawRevisionData(this.getCurrentDocID(),e,t)},transformRawRevisionData:function(t,i){function n(e,t){if(t>=0&&i(e,t),e.i)for(var a=r(e.i),s=0;s<a.length;++s){var o=r(a[s]);o&&n(o,t+1)}if(e.n){var c=r(e.n);c&&n(c,t+1)}}var a=r(t.data);if(a){n(r(a.root),-1)}else e.reportError("Invalid Revision Data: ",t)},_makeConsumableOutput:function(t,i,n,r){this.getRawRevisionData(t,i,function(t){try{e.PAssert(5318,t&&t.data,"Missing expected recovery data")}catch(t){e.reportError(t)}if(t&&t.data)try{this.transformRawRevisionData(t,n)}catch(i){e.reportError(i),t=void 0}r&&r(t)}.bind(this))},_padText:function(e,t,i){var n="";i=i||" ";for(var r=0;r<t;++r)n+=i;return n+=e},printRevisionData:function(e,t){this._makeConsumableOutput(e,t,function(e,t){console.log(this._padText(a(e.t),t))}.bind(this))},printDefaultRevisionData:function(e){return this.printRevisionData(this.getCurrentDocID(),e)},printRevisionOffset:function(e){var t=this.getCurrentRevision()-e;return t<0?log("Maximum offset is: "+this.getCurrentRevision()):this.printDefaultRevisionData(t)},getRevisionData:function(e,t,i,n){var r="",s=-1;this._makeConsumableOutput(e,t,function(e,t){if(i&&"text"!==i){if("html"===i){if(t>s)r+="<ul>";else if(t<s)for(var n=t;n<s;n++)r+="</ul>";r+="<li>"+a(e.t)+"</li>",s=t}}else r+=this._padText(a(e.t),t,"\t")+"\r\n"}.bind(this),function(e){n(r,e)})},saveRevisionData:function(e,t,i){var n="";this._makeConsumableOutput(e,t,function(e,t){n+=this._padText(a(e.t),t,"\t")+"\r\n"}.bind(this),function(){var e=new Blob([n],{type:"text/plain;charset=utf-8"});saveAs(e,"DataRecovery_"+t+".txt")})},saveDefaultRevisionData:function(e,t){return this.saveRevisionData(this.getCurrentDocID(),e,t)},saveRevisionOffset:function(e,t){var i=this.getCurrentRevision()-e;return i<0?log("Maximum offset is: "+this.getCurrentRevision()):this.saveDefaultRevisionData(i,t)},getHelp:function(){return console.log("To recover your data input __MoodoRecovery.saveRevisionOffset(<revision offset>)"),console.log("The maximum <revision offset> for this document is "+this.getCurrentRevision()),console.log("If you just lost data, an offset of 10 is a good place to start"),console.log("You may need to try larger offsets if the returned file does not contain the data you need"),console.log("This is a temporary tool to help recover data, please report any issues or data loss to support@moo.do"),window.__SendInfo("Recover Help Used!"),""},dumpRawIndexedDB:function(){var e=require("data"),t=require("globals");e.dbi.settings.get("root").done(function(i){var n=i.root;e.dbi.items.query().all().execute().done(function(i){var r;i.forEach(function(i){i.id===n&&(r=i),e.getItem(i.id)||e.setItem(i.id,t.translateObjOut(i))});var a=e.toJSON(r,!1,!1,!0);saveAs(new Blob([a],{type:"text/plain;charset=utf-8"}),"MoodoRecovery.json")})})}};var c=new s;return window.__MoodoRecovery={maxUIRevisions:2e3,raw:c,help:c.getHelp.bind(c),getCurrentRevision:c.getCurrentRevision.bind(c),getCurrentDocID:c.getCurrentDocID.bind(c),getRawData:c.getDefaultRawRevisionData.bind(c),printRevision:c.printDefaultRevisionData.bind(c),saveRevision:c.saveDefaultRevisionData.bind(c),printRevisionOffset:c.printRevisionOffset.bind(c),saveRevisionOffset:c.saveRevisionOffset.bind(c),dumpRawIndexedDB:c.dumpRawIndexedDB.bind(c),_getRawRevisionData:c.getRawRevisionData.bind(c)},c}),define("ReactModalRevisionHistory",["require","globals","Constants","data","gdata","platform","react","MooReact","recovery","NativeSel","Components/FancyModal","Components/FancyListItem","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("data"),r=e("gdata"),a=e("platform"),s=e("react"),o=e("MooReact"),c=e("recovery"),l=e("NativeSel"),d=e("Components/FancyModal"),h=e("Components/FancyListItem"),u=e("Components/FancyButton");return o.createClass({displayName:"ReactModalRevisionHistory",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},init:function(){if(this.maxRevision=0,this.revisions=[],this.selectedRevision=null,this.isOnline=!!r.doc,this.createObservables({isLoading:!1,recoveredPreview:null}),r.doc){var e=c.getCurrentRevision()-1;this.maxRevision=e,this.selectedRevision=e;for(var t=Math.max(e-window.__MoodoRecovery.maxUIRevisions,0),i=[],n=e;n>=t;--n)i.push(n);this.revisions=i,this.updatePreview()}else this.recoveredPreview.set("You must be online to view your revision history. Please go online and try again.")},updatePreview:function(){this.recoveredPreview.set("",!1),this.isLoading.set(!0);var e=c.getCurrentDocID();c.getRevisionData(e,this.selectedRevision,"html",function(e){this.recoveredPreview.set(e,!1),this.isLoading.set(!1)}.bind(this))},onSelectChange:function(e){this.selectedRevision=this.revisions[e.target.selectedIndex],log(this.selectedRevision),this.updatePreview()},onTapSelect:function(){var e=l.createSelectionRange();e.selectNodeContents(this.refs.exportedContent),l.setSelectionRange(e)},onKeyDown:function(e){var t=a.getKeyCode(e);log(e.metaKey,e.ctrlKey,e.keyCode),(a.mac&&e.metaKey||!a.mac&&e.ctrlKey)&&t===KeyCode.A&&this.onTapSelect(),e.preventDefault(),e.stopPropagation()},onTapRestore:function(e,i){var r=function(){t.menus.alert({text:"Your data has been recovered.",actionText:"OKAY",callback:n.clearDataAndReload}),i()},a=function(){t.menus.alert({text:"There was an error recovering your data. Please contact support@moo.do for additional help.",actionText:"OKAY"}),i()};return c.recoverRevision(this.selectedRevision,r,a),!0},render:function(){var e=t.classNames({loading:this.state.isLoading});return s.createElement(d,{id:"modalRevisionHistory",title:"Revision History",width:860,height:900,modalID:Modals.RevisionHistory},s.createElement("div",{key:"sidebar",width:180},s.createElement(h,{header:!0},"Choose Revision"),s.createElement(h,{style:{lineHeight:"24px",height:"36px"},clickable:!1},s.createElement("select",{onChange:this.onSelectChange},this.revisions.map(function(e){return s.createElement("option",{key:e,value:e},e)}))),s.createElement(u,{primary:!0,enabled:this.isOnline,onClick:this.onTapRestore},"RESTORE"),s.createElement(h,{header:!0},"Directions"),s.createElement(h,{clickable:!1,subtext:!0},s.createElement("p",null,"Choose the revision from the dropdown that you want to revert to."),s.createElement("p",null,"Each change is a new revision, so if you've made a lot of changes you may want to go back by 50 or 100."),s.createElement("p",null,"You may need to reload or re-login to other clients to see the recovered data there."))),s.createElement("div",{key:"content",className:e},s.createElement("div",{className:"exportedContent",onKeyDown:this.onKeyDown,contentEditable:!0,dangerouslySetInnerHTML:{__html:this.state.recoveredPreview},ref:"exportedContent"})))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalReportProblem",["require","globals","Constants","react","EmailPreview","MooReact","Components/FancyButton","Components/FancyTextarea","Components/FancyModal"],function(e){var t=(e("globals"),e("Constants")),i=e("react"),n=e("EmailPreview"),r=e("MooReact"),a=e("Components/FancyButton"),s=e("Components/FancyTextarea"),o=e("Components/FancyModal");return r.createClass({displayName:"ReactModalReportProblem",componentDisplay:t.ComponentDisplay.Desktop,propTypes:{accountID:i.PropTypes.string.isRequired,threadID:i.PropTypes.string.isRequired,msgID:i.PropTypes.string.isRequired},componentDidMount:function(){this.refs.textarea.focus()},sendReport:function(e){var t=this.props;n.reportMessage(t.accountID,t.threadID,t.msgID,this.refs.textarea.getValue(),e),this.refs.modal.close()},onClickSend:function(){this.sendReport(!0)},onClickCancel:function(){this.sendReport(!1)},render:function(){return i.createElement(o,_extends({},this.props,{id:"modalReportProblem",title:"Report Problem",scrollable:!1,modalID:Modals.ReportProblem,ref:"modal"}),i.createElement("div",{key:"content"},i.createElement("div",{className:"fancyModalText"},"Please describe the display problem."),i.createElement(s,{ref:"textarea"}),i.createElement("div",{className:"fancyModalText"},"This will send the content of your email to the developers to fix display errors.")),i.createElement("div",{key:"buttons",style:{textAlign:"right"}},i.createElement(a,{width:100,onClick:this.onClickCancel},"CANCEL"),i.createElement(a,{primary:!0,width:100,onClick:this.onClickSend},"SEND")))}})}),define("ReactModalWelcome",["require","react","util","globals","Constants","MooReact","PluginSettings","DisplaySettings","AccountManager","Components/FancyCheckbox","Components/FancyButton","Components/FancyLoader","Components/FancyModal"],function(e){var t=e("react"),i=e("util"),n=e("globals"),r=e("Constants"),a=e("MooReact"),s=e("PluginSettings"),o=e("DisplaySettings"),c=e("AccountManager"),l=e("Components/FancyCheckbox"),d=e("Components/FancyButton"),h=e("Components/FancyLoader"),u=e("Components/FancyModal"),p={Connecting:1,EnableTrial:2,PluginSelect:3,ThemeSelect:4,ImportData:5};return a.createClass({displayName:"ReactModalWelcome",componentDisplay:r.ComponentDisplay.Desktop,init:function(){var e=p.Connecting,t=i.getURLParam("ispremium");t&&(e=p.PluginSelect),this.createObservables({page:e,isConnected:!1,colorTheme:r.ColorTheme.Light}),c.onConnected(function(){this.isConnected.set(!0),t||(n.billingManager.hasPremiumFeatures()?this.page.set(p.PluginSelect):this.page.set(p.EnableTrial))}.bind(this)),i.removeURLParam("ispremium",!0)},onClickEnable:function(){try{n.PAssert(5319,this.state.isConnected,"Must always be connected to the server before enabling")}catch(e){n.reportError(e)}var e=this.state.page,t=[PluginID.Contacts,PluginID.GCalendar,PluginID.Gmail,PluginID.Drive],i=e===p.EnableTrial?t:t.filter(function(e){return this.refs[e].getValue()}.bind(this)),r=i.map(function(t){return t===PluginID.Drive?{id:t,shared:e===p.EnableTrial||this.refs.DriveShared.getValue()}:{id:t}}.bind(this)),a=e===p.EnableTrial||this.refs.offlineFeatures.getValue();s.enablePlugins(r,a,function(e){e&&this.refs.modal&&(n.billingManager.hasPremiumFeatures()||(i.indexOf(PluginID.Drive)>=0||i.indexOf(PluginID.GCalendar)>=0)&&n.billingManager.startTrial(),this.page.set(p.ThemeSelect))}.bind(this))},onClickChoose:function(){this.page.set(p.PluginSelect)},onChangeDrive:function(e){this.onChangeFeature(e),e||this.refs.DriveShared.setValue(!1)},onChangeDriveShared:function(e){this.onChangeFeature(e),e&&this.refs[PluginID.Drive].setValue(!0)},onChangeFree:function(e){this.refs[PluginID.Contacts].setValue(e),this.refs[PluginID.Gmail].setValue(e),this.refs.offlineFeatures.setValue(e)},onChangePremium:function(e){this.refs[PluginID.GCalendar].setValue(e),this.refs[PluginID.Drive].setValue(e),this.refs.DriveShared.setValue(e)},checkTier:function(e,t){for(var i=0,n=0;n<t.length;n++)this.refs[t[n]].getValue()?i++:i--;i===t.length&&e.setValue(!0),i===-t.length&&e.setValue(!1)},onChangeFeature:function(e){this.checkTier(this.refs.free,[PluginID.Contacts,PluginID.Gmail]),this.checkTier(this.refs.premium,[PluginID.GCalendar,PluginID.Drive,"DriveShared"])},setColorTheme:function(e){this.colorTheme.set(e),e&&o.changeColorTheme(e)},onClickDisplaySettings:function(){this.page.set(p.ImportData)},onClickGetStarted:function(){this.refs.modal.close()},onClickImport:function(e){this.refs.modal.close(),n.menus.openModalNew(Modals.ImportData,{importer:e})},renderPage:function(e){switch(e){case p.Connecting:return this.renderPageConnecting();case p.EnableTrial:return this.renderPageEnableTrial();case p.PluginSelect:return this.renderPagePluginSelect();case p.ThemeSelect:return this.renderPageThemeSelect();case p.ImportData:return this.renderPageImportData();default:try{n.PAssert(5320,!1,"Invalid intro page requested: "+e)}catch(e){n.reportError(e)}}},renderPageConnecting:function(){return t.createElement("div",{key:"content"},t.createElement("div",{className:"setupTitle"},"Welcome to ",t.createElement("span",{className:"logoPseudo"}),"!"),t.createElement("div",{className:"flexbox flex-center",style:{margin:"64px 0"}},t.createElement(h,{center:!0},"Connecting to server...")))},renderPageEnableTrial:function(){var e=this.state.isConnected?"NEXT":"Connecting...";return t.createElement("div",{key:"content"},t.createElement("div",{className:"setupTitle"},"Welcome to ",t.createElement("span",{className:"logoPseudo"}),"!"),t.createElement("div",{className:"setupFeatures featureCheckboxes"},t.createElement("div",{className:"setupPage1Subtitle"},"Start your ",r.TrialDuration," day free trial of ",t.createElement("b",null,"Moo.do Premium")," and enable syncing with:"),t.createElement("div",{className:"featureTier flexbox c-border"},t.createElement("div",{className:"setupFeature setupFeatureRow f1"},t.createElement("img",{src:"/img/plugin-gcal.png"}),t.createElement("div",null,"Google Calendar")),t.createElement("div",{className:"setupFeature setupFeatureRow f1"},t.createElement("img",{src:"/img/plugin-gmail.png"}),t.createElement("div",null,"Gmail")),t.createElement("div",{className:"setupFeature setupFeatureRow f1"},t.createElement("img",{src:"/img/plugin-gdrive.png"}),t.createElement("div",null,"Google Drive")),t.createElement("div",{className:"setupFeature setupFeatureRow f1"},t.createElement("i",{className:"icon-group"}),t.createElement("div",null,"Google Contacts"))),t.createElement("div",{className:"setupSubtext"},t.createElement("b",null,"Moo.do")," connects with your Google services to integrate everything together. ",t.createElement("b",null,"Moo.do")," data is stored in your personal Google Drive account and is never sent to any other server. Nobody can access any of your data. See our ",t.createElement("span",{className:"link"},"Privacy Policy")," for more details."),t.createElement("div",{className:"setupButtons flexbox"},t.createElement(d,{raised:!0,onClick:this.onClickChoose},"No thanks, I'll choose what to enable"),t.createElement(d,{enabled:this.state.isConnected,raised:!0,primary:!0,onClick:this.onClickEnable},e))))},renderPagePluginSelect:function(){var e=this.state.isConnected?"NEXT":"Connecting...";return t.createElement("div",{key:"content",className:"pageConnect"},t.createElement("div",{className:"setupTitle"},"Connect ",t.createElement("span",{className:"logoPseudo"})," with..."),t.createElement("div",{className:"setupFeatures featureCheckboxes"},t.createElement("div",{className:"featureTier c-border"},t.createElement("div",{className:"tierTitleWrapper"},t.createElement(l,{ref:"free",className:"tierTitle c-background",checked:!0,onChange:this.onChangeFree},"Free Features")),t.createElement("div",{className:"flexbox"},t.createElement("div",{className:"setupFeatureHalf"},t.createElement(l,{ref:PluginID.Contacts,checked:!0,onChange:this.onChangeFeature},t.createElement("i",{className:"icon-group"}),"Google Contacts"),t.createElement(l,{ref:PluginID.Gmail,checked:!0,onChange:this.onChangeFeature},t.createElement("img",{src:"/img/plugin-gmail.png"}),"Gmail")),t.createElement("div",{className:"setupFeatureHalf"},t.createElement("div",{className:"setupFeature"},t.createElement(l,{ref:"offlineFeatures",checked:!0,onChange:this.onChangeFeature},"Offline Features"),t.createElement("div",{className:"setupFeatureDesc c-foreground-light"},"Gmail features like Snooze require server access to your account so Moo.do can manage your inbox."))))),t.createElement("div",{className:"featureTier c-border"},t.createElement("div",{className:"tierTitleWrapper"},t.createElement(l,{ref:"premium",className:"tierTitle c-background",checked:!0,onChange:this.onChangePremium},"Premium Features")),!n.billingManager.hasPremiumFeatures()&&t.createElement("div",{className:"featureTierDesc c-foreground-light"},"Enabling Premium features will start a free "+r.TrialDuration+" day trial of Moo.do Premium."),t.createElement("div",{className:"flexbox"},t.createElement("div",{className:"setupFeature setupFeatureHalf"},t.createElement(l,{ref:PluginID.GCalendar,checked:!0,onChange:this.onChangeFeature},t.createElement("img",{src:"/img/plugin-gcal.png"}),"Google Calendar")),t.createElement("div",{className:"setupFeature setupFeatureHalf"},t.createElement(l,{ref:PluginID.Drive,checked:!0,onChange:this.onChangeDrive},t.createElement("img",{src:"/img/plugin-gdrive.png"}),"Google Drive"),t.createElement(l,{ref:"DriveShared",checked:!0,className:"subcheckbox",onChange:this.onChangeDriveShared},"Share files with collaborators")))),t.createElement("div",{className:"setupSubtext"},t.createElement("b",null,"Moo.do")," connects with your Google services to integrate everything together. ",t.createElement("b",null,"Moo.do")," data is stored in your personal Google Drive account and is never sent to any other server. Nobody can access any of your data. See our ",t.createElement("span",{className:"link"},"Privacy Policy")," for more details."),t.createElement("div",{className:"setupButtons"},t.createElement(d,{enabled:this.state.isConnected,raised:!0,primary:!0,onClick:this.onClickEnable},e))))},renderPageThemeSelect:function(){var e=this.state,i=e.colorTheme;return t.createElement("div",{key:"content"},t.createElement("div",{className:"setupTitle"},"What's your style?"),t.createElement("div",{className:"flexbox flex-center",style:{margin:"24px 0"}},t.createElement("div",{className:"setupStyle",onClick:this.setColorTheme.bind(this,r.ColorTheme.Light)},t.createElement(l,{radio:!0,ref:"checkLight",checked:i===r.ColorTheme.Light},"Light")),t.createElement("div",{className:"setupStyle",onClick:this.setColorTheme.bind(this,r.ColorTheme.Dark)},t.createElement(l,{radio:!0,ref:"checkDark",checked:i===r.ColorTheme.Dark},"Dark"))),t.createElement("div",{className:"setupSubtext center"},"Don't worry! You can always change your style later."),t.createElement("div",{className:"setupButtons"},t.createElement(d,{raised:!0,primary:!0,onClick:this.onClickDisplaySettings},"NEXT")))},renderPageImportData:function(){var e=(this.state,["Wunderlist","Workflowy","Trello","Google Tasks","Todoist","IQTell"]);return t.createElement("div",{key:"content"},t.createElement("div",{className:"setupTitle"},"Import from another app"),t.createElement("div",{className:"welcomeImporters"},e.map(function(e,i){return t.createElement(d,{key:i,heavy:!0,onClick:this.onClickImport.bind(this,e)},e)}.bind(this))),t.createElement("div",{className:"setupSubtext center"},"Don't worry! You can always import your data later."),t.createElement("div",{className:"setupButtons"},t.createElement(d,{raised:!0,primary:!0,onClick:this.onClickGetStarted},"FINISH")))},render:function(){this.state.page;return t.createElement(u,{id:"modalWelcome",width:720,minWidth:600,modalID:Modals.Welcome,closeButton:!1,backdropClose:!1,ref:"modal"},this.renderPage(this.state.page))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalDeleteAccount",["require","react","MooReact","Hotkeys","Constants","Components/FancyButton","Components/FancyTextarea","Components/FancyModal"],function(e){var t=e("react"),i=e("MooReact"),n=(e("Hotkeys"),e("Constants")),r=e("Components/FancyButton"),a=e("Components/FancyTextarea"),s=e("Components/FancyModal");return i.createClass({displayName:"ReactModalDeleteAccount",componentDisplay:n.ComponentDisplay.Desktop,propTypes:{},componentDidMount:function(){this.refs.textarea.focus()},onClickCancel:function(){this.refs.modal.close(!1)},onClickDelete:function(){this.refs.modal.close(!0)},render:function(){return t.createElement(s,_extends({},this.props,{id:"modalDeleteAccount",title:"Please Confirm",scrollable:!1,modalID:Modals.DeleteAccount,ref:"modal"}),t.createElement("div",{key:"content"},t.createElement("div",{className:"fancyModalText"},"It would be very helpful if you could describe how Moo.do could be more useful to you. Your feedback will help us improve Moo.do for you and others. Thanks!"),t.createElement(a,{ref:"textarea"})),t.createElement("div",{key:"buttons",style:{textAlign:"right"}},t.createElement(r,{width:100,onClick:this.onClickCancel},"CANCEL"),t.createElement(r,{primary:!0,width:100,onClick:this.onClickDelete},"DELETE")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalInvoices",["require","globals","react","MooReact","Hotkeys","Constants","International","Components/FancyButton","Components/FancyTable","Components/FancyModal"],function(e){var t=e("globals"),i=e("react"),n=e("MooReact"),r=(e("Hotkeys"),e("Constants")),a=e("International"),s=e("Components/FancyButton"),o=e("Components/FancyTable"),c=e("Components/FancyModal");return n.createClass({displayName:"ReactModalInvoices",componentDisplay:r.ComponentDisplay.Desktop,propTypes:{},onTransactionClick:function(e){var i=t.clone(e);i.company=t.settings.get(Settings.invoiceCompany),i.address=t.settings.get(Settings.invoiceAddress);var n=window.btoa(JSON.stringify(i));t.openUrl(window.location.protocol+"//"+window.location.host+"/invoice#d="+n)},render:function(){return i.createElement(c,_extends({},this.props,{id:"modalInvoices",title:"Account Invoices",scrollable:!1,modalID:Modals.Invoices,ref:"modal"}),i.createElement("div",{key:"content"},this.props.transactions.length>0&&i.createElement(o,{className:"transactionsTable"},i.createElement("div",{key:"header"},i.createElement("div",null,"Transaction Date"),i.createElement("div",null,"Amount"),i.createElement("div",null)),this.props.transactions.map(function(e,t){var n=new Date(e.date),r=n.toString(a.getFormat(DFormat.LongStrDate));return i.createElement("div",{key:e.id},i.createElement("div",null,r),i.createElement("div",null,e.amount),i.createElement(s,{onClick:this.onTransactionClick.bind(this,e),height:"auto"},"View"))}.bind(this)),";"),0===this.props.transactions.length&&i.createElement("div",null,"There are not transactions available for this account.")))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactModalEnterCode",["require","globals","Constants","react","MooReact","Components/FancyButton","Components/FancyInput","Components/FancyModal"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Components/FancyButton"),s=e("Components/FancyInput"),o=e("Components/FancyModal");return r.createClass({displayName:"ReactModalEnterCode",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},componentDidMount:function(){this.refs.code.focus()},onClickConfirm:function(){t.billingManager.redeemCode(this.refs.code.getValue()),this.refs.modal.close()},onClickCancel:function(){this.refs.modal.close()},render:function(){return n.createElement(o,_extends({},this.props,{id:"modalEnterCode",title:"Redeem Code",width:325,scrollable:!1,modalID:Modals.EnterCode,ref:"modal"}),n.createElement("div",{key:"content"},n.createElement("div",{className:"fancyModalText"},"Enter your code below to redeem"),n.createElement(s,{ref:"code"})),n.createElement("div",{key:"buttons",style:{textAlign:"right"}},n.createElement(a,{width:100,onClick:this.onClickCancel},"CANCEL"),n.createElement(a,{primary:!0,width:100,onClick:this.onClickConfirm},"CONFIRM")))}})}),
define("ReactModals",["require","globals","Constants","react","MooReact","ReactModalLightbox","ReactModalPrompt","ReactModalMobileSettings","ReactModalEmailCompose","ReactModalEmailReply","ReactModalSettings","ReactModalAlert","ReactModalBilling","ReactModalConfirm","ReactModalOptions","ReactModalExport","ReactModalImport","ReactModalRevisionHistory","ReactModalReportProblem","ReactModalWelcome","ReactModalDeleteAccount","ReactModalInvoices","ReactModalEnterCode"],function(e){var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},i=e("globals"),n=e("Constants"),r=e("react"),a=r.addons.CSSTransitionGroup,s=e("MooReact"),o=e("ReactModalLightbox"),c=e("ReactModalPrompt"),l=e("ReactModalMobileSettings"),d=e("ReactModalEmailCompose"),h=e("ReactModalEmailReply"),u=e("ReactModalSettings"),p=e("ReactModalAlert"),m=e("ReactModalBilling"),f=e("ReactModalConfirm"),g=e("ReactModalOptions"),v=e("ReactModalExport"),y=e("ReactModalImport"),b=e("ReactModalRevisionHistory"),S=e("ReactModalReportProblem"),E=e("ReactModalWelcome"),C=e("ReactModalDeleteAccount"),P=e("ReactModalInvoices"),T=e("ReactModalEnterCode");return s.createClass({displayName:"ReactModals",componentDisplay:n.ComponentDisplay.Everywhere,propTypes:{},getState:function(){return{modals:i.menus.modalStack}},renderModal:function(e){var n=e.id,a=n===Modals.Settings&&u||n===Modals.Alert&&p||n===Modals.Confirm&&f||n===Modals.Prompt&&c||n===Modals.Options&&g||n===Modals.ExportData&&v||n===Modals.ImportData&&y||n===Modals.RevisionHistory&&b||n===Modals.ReportProblem&&S||n===Modals.Billing&&m||n===Modals.EmailReply&&h||n===Modals.EmailCompose&&d||n===Modals.MobileSettings&&l||n===Modals.Welcome&&E||n===Modals.Lightbox&&o||n===Modals.DeleteAccount&&C||n===Modals.EnterCode&&T||n===Modals.Invoices&&P;try{i.PAssert(5321,a,"Could not find modal with id "+n)}catch(e){i.reportError(e)}return r.createElement(a,t({key:e.id},e))},render:function(){for(var e=[],t=0;t<this.state.modals.length;t++)e.push(this.renderModal(this.state.modals[t]));var n=i.classNames("modals",{none:0===e.length});return r.createElement(a,{className:n,transitionName:"modalTransition",transitionEnterTimeout:400,transitionLeaveTimeout:300},e)}})}),define("Components/FancyColorPickerContextMenu",["require","globals","globals","Constants","react","MooReact","Components/FancyContextMenu"],function(e){var t=e("globals"),i=["#4D4D4D","#999999","#CCCCCC","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#BBBBBB","#EEEEEE","#D33115","#E27300","#FCC400","#22AA66","#16A5A5","#0099DD","#7B64FF","#FA28FF","#000000","#666666","#AAAAAA","#DDDDDD","#AA3300","#C45100","#FB9E00","#194D33","#0C797D","#0062B1","#653294","#AB149E"],n={hex3:/^(#)([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^(#)([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},t=e("globals"),r=e("Constants"),a=e("react"),s=e("MooReact"),o=e("Components/FancyContextMenu");return s.createClass({displayName:"FancyColorPickerContextMenu",componentDisplay:r.ComponentDisplay.Desktop,propTypes:{color:a.PropTypes.string.isRequired,onChange:a.PropTypes.func.isRequired},init:function(){this.createObservables({color:this.props.color,value:this.props.color,isValid:!0})},parseColor:function(e){var t;return(t=n.hex3.exec(e))?"#"+t[2]+t[2]+t[3]+t[3]+t[4]+t[4]:(t=n.hex6.exec(e))?e:void 0},onClickColor:function(e){this.color.set(e),this.value.set(e),this.props.onChange(e)},onChangeInputColor:function(e){var t=e.target.value.toUpperCase();0!==t.indexOf("#")&&(t="#"+t);var i=this.parseColor(t);i&&(this.color.set(i),this.props.onChange(i)),t.length<8&&this.value.set(t),this.isValid.set(!!this.parseColor(this.value.get()))},onChangeInputComponent:function(){var e=this.refs,i=e.r.value,n=e.g.value,r=e.b.value;if(i>=0&&i<=255&&n>=0&&n<=255&&r>=0&&r<=255){var a="#"+t.rgbToHex(i,n,r);this.value.set(a),this.color.set(a),this.props.onChange(a)}},render:function(){for(var e=this.state,n=this.state.color,r=t.hexToRgb(n),s=[],c=0;c<i.length;c++){var l=i[c],d=t.classNames("fancyColor",{selected:l===n},{isWhite:"#FFFFFF"===l.toUpperCase()}),h={background:l};s.push(a.createElement("div",{key:l,className:d,style:h,onClick:this.onClickColor.bind(this,l)}))}var u=t.classNames("fancyColorInputColor",{invalid:!e.isValid});return a.createElement(o,{id:"fancyColorPicker",element:this.props.element,offset:{left:-120,top:4}},a.createElement("div",{className:"fancyColors"},s),a.createElement("div",{className:"fancyColorText"},a.createElement("div",{key:n,className:"fancyColor",style:{background:n}}),a.createElement("input",{type:"text",className:u,value:e.value,onChange:this.onChangeInputColor}),a.createElement("span",null,"R"),a.createElement("input",{type:"text",ref:"r",className:"fancyColorInputComponent",value:r.r,onChange:this.onChangeInputComponent}),a.createElement("span",null,"G"),a.createElement("input",{type:"text",ref:"g",className:"fancyColorInputComponent",value:r.g,onChange:this.onChangeInputComponent}),a.createElement("span",null,"B"),a.createElement("input",{type:"text",ref:"b",className:"fancyColorInputComponent",value:r.b,onChange:this.onChangeInputComponent})))}})}),define("Components/FancyColorPicker",["require","globals","Constants","react","MooReact","Components/FancyColorPickerContextMenu"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Components/FancyColorPickerContextMenu");return r.createClass({displayName:"FancyColorPicker",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{color:n.PropTypes.string.isRequired,onChange:n.PropTypes.func.isRequired},init:function(){this.createObservables({color:this.props.color})},componentWillReceiveProps:function(e){e.color!==this.props.color&&this.color.set(e.color)},openMenu:function(e){t.menus.openContextMenuReact({fn:this.renderContextMenu,element:e.target})},onChange:function(e){this.color.set(e),this.props.onChange(e)},renderContextMenu:function(e){return n.createElement(a,{key:"fancyColorPicker",color:this.state.color,onChange:this.onChange,element:e.element})},render:function(){var e={background:this.state.color,border:"1px solid #666"},i=t.classNames("fancyColor",{isWhite:"#FFFFFF"===this.state.color.toUpperCase()});return n.createElement("div",{className:i,style:e,onClick:this.openMenu})}})}),define("ReactDisplaySettingsSidebar",["require","globals","Constants","react","MooReact","DisplaySettings","Components/FancyInputNumber","Components/FancyButton","Components/FancyColorPicker","Components/FancyCheckbox","Components/FancyScroller"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=n.addons.CSSTransitionGroup,a=e("MooReact"),s=e("DisplaySettings"),o=e("Components/FancyInputNumber"),c=e("Components/FancyButton"),l=e("Components/FancyColorPicker"),d=e("Components/FancyCheckbox"),h=e("Components/FancyScroller");return a.createClass({displayName:"ReactDisplaySettingsSidebar",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{},init:function(){this.createObservables({showAdvanced:!1})},componentDidMount:function(){},getState:function(){return{isOpen:t.vmMain.isDisplaySettingsOpen,colorTheme:t.settings.get(Settings.theme),layoutTheme:t.settings.get(Settings.layoutTheme,Settings.UISettingsGroup)}},updateSetting:function(e,i){t.settings.set(e,i,Settings.UISettingsGroup)},onClickColorTheme:function(e){s.changeColorTheme(e),this.updateState()},onClickTheme:function(e){s.changeTheme(e),this.updateState(),this.forceUpdate()},isGrayscale:function(){return!0===t.settings.get(Settings.grayscale,Settings.UISettingsGroup)},toggleAdvanced:function(){this.showAdvanced.set(!this.showAdvanced.get())},updateGrayscale:function(e){this.updateSetting(Settings.grayscale,e),this.updateSetting(Settings.underlineP,e),this.forceUpdate()},close:function(){t.vmMain.isDisplaySettingsOpen.set(!1)},render:function(){var e,a=this.state;if(a.showAdvanced){var s=t.classNames("settingsAdvanced",{disabledSettings:!t.billingManager.hasPremiumFeatures()}),u=this.isGrayscale(),p=t.classNames({disabled:u});e=n.createElement("div",null,n.createElement("div",{style:{color:"#aaa",margin:"16px 0"}},"Advanced (Premium Only)"),n.createElement("div",{className:s},n.createElement("div",null,n.createElement(d,{checked:t.settings.get(Settings.showBullets,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.showBullets)},"Show Bullets")),n.createElement("div",null,n.createElement(d,{checked:t.settings.get(Settings.showVerticalLines,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.showVerticalLines)},"Show Vertical Lines")),n.createElement("div",null,n.createElement("span",null,"Item Font Size: "),n.createElement(o,{value:t.settings.get(Settings.fontSize,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.fontSize)})),n.createElement("div",null,n.createElement("span",null,"Header Font Size: "),n.createElement(o,{value:t.settings.get(Settings.fontSizeHeader,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.fontSizeHeader)})),n.createElement("div",null,n.createElement("span",null,"Top Level Header Font Size: "),n.createElement(o,{value:t.settings.get(Settings.fontSizeHeaderTopLevel,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.fontSizeHeaderTopLevel)})),n.createElement("div",null,n.createElement("span",null,"Note Font Size: "),n.createElement(o,{value:t.settings.get(Settings.noteFontSize,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.noteFontSize)})),n.createElement("div",null,n.createElement("span",null,"Item Line Height: "),n.createElement(o,{value:t.settings.get(Settings.itemLineHeight,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.itemLineHeight)})),n.createElement("div",null,n.createElement("span",null,"Item Padding: "),n.createElement(o,{value:t.settings.get(Settings.itemPadding,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.itemPadding)})),n.createElement("div",null,n.createElement("span",null,"Indent Size: "),n.createElement(o,{value:t.settings.get(Settings.itemIndentSize,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.itemIndentSize)})),n.createElement("div",null,n.createElement("span",null,"Bullet Opacity: "),n.createElement(o,{value:t.settings.get(Settings.bulletOpacity,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.bulletOpacity),minValue:0,maxValue:100})),n.createElement("div",null,n.createElement("span",null,"Checkbox Opacity: "),n.createElement(o,{value:t.settings.get(Settings.checkboxOpacity,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.checkboxOpacity),minValue:0,maxValue:100})),n.createElement("div",null,n.createElement("span",null,"Checkbox Background: "),n.createElement(o,{value:t.settings.get(Settings.checkboxBackgroundOpacity,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.checkboxBackgroundOpacity),minValue:0,maxValue:100})),n.createElement("div",null,n.createElement("span",null,"Vertical Lines Color: "),n.createElement(l,{color:t.settings.get(Settings.verticalLinesColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.verticalLinesColor)})),u&&n.createElement("div",{className:"colorsDisabled"},"Colors disabled in Grayscale mode"),n.createElement("div",{className:p},n.createElement("span",null,"Tag Color: "),n.createElement(l,{color:t.settings.get(Settings.tagColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.tagColor)})),n.createElement("div",{className:p},n.createElement("span",null,"Date Color: "),n.createElement(l,{color:t.settings.get(Settings.dateColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.dateColor)})),n.createElement("div",{className:p},n.createElement("span",null,"Contact Color: "),n.createElement(l,{color:t.settings.get(Settings.contactColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.contactColor)})),n.createElement("div",{className:p},n.createElement("span",null,"Link Color: "),n.createElement(l,{color:t.settings.get(Settings.linkColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.linkColor)})),n.createElement("div",null,n.createElement(d,{checked:t.settings.get(Settings.underlineP,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.underlineP)},"Underline tags, dates, contacts"))))}var m=a.isOpen&&n.createElement("div",{className:"sidebar displaySettings"},n.createElement("div",{className:"popup c-shadow-popup c-background"},n.createElement("div",{className:"overlayTitleBar c-bg-popup-title flexbox"},n.createElement("div",{className:"displayTitle f1"},"Display Settings"),n.createElement(c,{icon:"icon-close",width:36,height:36,onClick:this.close})),n.createElement(h,null,n.createElement("div",null,n.createElement("div",{style:{color:"#aaa",fontStyle:"bold"}},"Color Theme"),n.createElement("div",{className:"themeButtons"},n.createElement(c,{raised:!0,primary:a.colorTheme===i.ColorTheme.Light,onClick:this.onClickColorTheme.bind(this,i.ColorTheme.Light)},"Light"),n.createElement(c,{raised:!0,primary:a.colorTheme===i.ColorTheme.Dark,marginLeft:16,onClick:this.onClickColorTheme.bind(this,i.ColorTheme.Dark)},"Dark")),n.createElement("div",{style:{color:"#aaa",fontStyle:"bold"}},"Layout Theme"),n.createElement("div",{className:"themeButtons"},n.createElement("div",{className:"themeRow"},n.createElement(c,{raised:!0,padding:8,primary:a.layoutTheme===i.DisplayTheme.Markdown,onClick:this.onClickTheme.bind(this,i.DisplayTheme.Markdown)},"Markdown"),n.createElement(c,{raised:!0,padding:8,primary:a.layoutTheme===i.DisplayTheme.Simple,marginLeft:8,onClick:this.onClickTheme.bind(this,i.DisplayTheme.Simple)},"Simple")),n.createElement("div",{className:"themeRow"},n.createElement(c,{raised:!0,padding:8,primary:a.layoutTheme===i.DisplayTheme.OutlineLight,onClick:this.onClickTheme.bind(this,i.DisplayTheme.OutlineLight)},"Outline Light"),n.createElement(c,{raised:!0,padding:8,primary:a.layoutTheme===i.DisplayTheme.OutlineHeavy,marginLeft:8,onClick:this.onClickTheme.bind(this,i.DisplayTheme.OutlineHeavy)},"Outline Heavy"))),n.createElement("div",{style:{color:"#aaa",fontStyle:"bold"}},"Options"),n.createElement("div",{style:{marginTop:16}},n.createElement(d,{checked:u,onChange:this.updateGrayscale},"Grayscale")),n.createElement("div",{style:{marginTop:16}},n.createElement(d,{checked:t.settings.get(Settings.boldHeaders,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.boldHeaders)},"Automatically Bold Parents"))),e,n.createElement("div",{style:{marginTop:16,textAlign:"center"}},n.createElement(c,{raised:!0,onClick:this.toggleAdvanced},(a.showAdvanced?"Hide":"Show")+" Advanced (Premium)")))));return n.createElement(r,{transitionName:"previewOpen",component:"div",transitionEnterTimeout:200,transitionLeaveTimeout:200},m)}})}),define("ReactIntroItem",["require","globals","Constants","react","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("react");return e("MooReact").createClass({displayName:"ReactIntroItem",componentDisplay:i.ComponentDisplay.Desktop,getState:function(){var e=this.props.item;return{isComplete:e.isComplete,isDisabled:e.isDisabled,isHotkeyOr:e.isHotkeyOr,text:e.text,jsx:e.jsx,isVisible:e.visibleObservable,isHidden:e.hiddenObservable}},render:function(){var e=this.state,i=t.classNames({checked:e.isComplete},{disabled:e.isDisabled},{hotkeyOr:e.isHotkeyOr}),r=t.classNames("icon-check",{"c-foreground-super-faded":!e.isComplete},{"c-blue":e.isComplete});return!1!==e.isVisible&&!0!==e.isHidden&&n.createElement("li",{className:i},n.createElement("span",{className:r}),e.text&&n.createElement("span",{dangerouslySetInnerHTML:{__html:e.text}}),e.jsx)}})}),define("ReactHelpSidebar",["require","globals","Constants","react","MooReact","ReactIntroItem","Components/FancyButton","Components/FancyScroller"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=n.addons.CSSTransitionGroup,a=e("MooReact"),s=e("ReactIntroItem"),o=e("Components/FancyButton"),c=e("Components/FancyScroller");return a.createClass({displayName:"ReactHelpSidebar",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.intro=t.intro},componentDidMount:function(){},getState:function(){return{isOpen:this.intro.isVisible,sections:this.intro.sections,mode:this.intro.mode}},close:function(){this.intro.close()},onTapFeatures:function(){this.intro.setMode(i.HelpMode.Normal),this.refs.scroller.scrollTo(0,0,0)},onTapHotkeys:function(){this.intro.setMode(i.HelpMode.Hotkeys),this.refs.scroller.scrollTo(0,0,0)},renderSection:function(e){return n.createElement("div",{className:"helpSection c-border-heavy",key:e.id||e.text},n.createElement("div",{className:"helpTitle"},e.text),e.note&&n.createElement("div",{className:"helpNote c-foreground-faded"},e.note),n.createElement("ul",null,e.items.map(function(e,t){return n.createElement(s,{item:e,key:t})})))},render:function(){var e=this.state;if(e.isOpen){for(var a=[],s=0;s<e.sections.length;s++)e.sections[s].noRender||a.push(this.renderSection(e.sections[s]));var l=t.classNames("tab tabFeatures c-border-heavy f1",{selected:e.mode===i.HelpMode.Normal}),d=t.classNames("tab tabHotkeys c-border-heavy f1",{selected:e.mode===i.HelpMode.Hotkeys}),h=t.classNames("sidebar sidebarHelp intro",{helpHotkeys:e.mode===i.HelpMode.Hotkeys},{helpNormal:e.mode===i.HelpMode.Normal}),u=e.isOpen&&n.createElement("div",{className:h},n.createElement("div",{className:"popup c-shadow-popup c-background"},n.createElement("div",{className:"overlayTitleBar c-bg-popup-title flexbox"},n.createElement("div",{className:"displayTitle f1"},"Help"),n.createElement(o,{icon:"icon-close",width:36,height:36,onClick:this.close})),n.createElement("div",{className:"helpHeaderRow flexbox"},n.createElement(o,{height:36,className:l,onClick:this.onTapFeatures},"Features"),n.createElement(o,{height:36,className:d,onClick:this.onTapHotkeys},"Hotkeys")),n.createElement(c,{ref:"scroller"},a)))}return n.createElement(r,{transitionName:"previewOpen",component:"div",transitionEnterTimeout:200,transitionLeaveTimeout:200},u)}})}),define("Components/Portal",["require","react","react-dom","globals"],function(e){var t=e("react"),i=e("react-dom"),n=e("globals");return t.createClass({displayName:"Portal",propTypes:{id:t.PropTypes.string.isRequired},render:function(){return null},componentDidMount:function(){try{n.PAssert(5322,this.props.id,"Must provide a valid Portal ID")}catch(e){n.reportError(e)}if(this.props.id){var e=document.getElementById(this.props.id);if(!e){var e=document.createElement("div");e.id=this.props.id,document.body.appendChild(e)}this.portalElement=e,this.componentDidUpdate()}},componentWillUnmount:function(){this.portalElement&&(n.removeDOM(this.props.id),this.portalElement=void 0)},componentDidUpdate:function(){i.render(t.createElement("div",this.props,this.props.children),this.portalElement)}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactWorkspaceItem",["require","globals","Constants","react","MooReact","Workspaces","Components/Portal","Components/FancyContextMenu","Components/FancyContextMenuHeader","Components/FancyContextMenuItem","Components/FancyButton","Components/FancyInput"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Workspaces"),s=e("Components/Portal"),o=e("Components/FancyContextMenu"),c=e("Components/FancyContextMenuHeader"),l=(e("Components/FancyContextMenuItem"),e("Components/FancyButton")),d=e("Components/FancyInput");return r.createClass({displayName:"ReactWorkspaceItem",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{workspace:n.PropTypes.object.isRequired},init:function(){this.createObservables({isHovered:!1})},getState:function(){return{name:this.props.workspace.name,hotkeySelectedIndex:a.hotkeySelectedIndex,hotkeySelected:a.getHotkeySelected()}},componentDidMount:function(){this.props.isAdding&&this.onClickEdit()},onUnmount:function(){document.removeEventListener("mousemove",this.onMouseMove)},onClickEdit:function(){this.onMouseLeave(),t.menus.openSidebarMenu(this.refs.menu,this.renderEditMenu)},onBoardRename:function(e){a.renameWorkspace(this.props.workspace,e)?(t.tooltip.hideTip(),t.menus.closeContextMenuReact(),this.updateState()):t.tooltip.displayTip({text:"Please give this board a unique name.",element:this.refs.menu})},onMouseEnter:function(e){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)},onMouseMove:function(e){var t=this.refs.menu.getBoundingClientRect();(e.clientY<t.top||e.clientY>t.bottom||e.clientX>i.DesktopMenuWidth+64)&&this.onMouseLeave()},onMouseLeave:function(){this.isHovered.get()&&(this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove))},onClickRemove:function(){this.props.active?t.tooltip.displayTip({text:"Cannot remove the active board.",element:this.refs.deleteButton.getElement()}):a.removeWorkspace(this.props.workspace)},onClick:function(){t.vmMain.paneManager.switchToWorkspace(this.props.workspace)},renderEditMenu:function(e){return n.createElement(o,_extends({},e,{key:"contextMenuEditBoard",id:"contextMenuEditBoard",width:400,ref:"menuEdit"}),n.createElement(c,{padding:0},"Rename board"),n.createElement(d,{buttonText:"SAVE",value:this.props.workspace.name,onButtonClick:this.onBoardRename,focused:!0}))},render:function(){var e=this.props,r=this.state,a=(this.props.workspace,e.number),o=e.workspace,c=e.active,d=e.padding,h=(e.isAdding,e.fontSize),u=e.isSmall,p=e.numWorkspaces,m=e.isBoardsHovered,f=_objectWithoutProperties(e,["number","workspace","active","padding","isAdding","fontSize","isSmall","numWorkspaces","isBoardsHovered"]),g=p>1,v=t.classNames(e.className,"sidebarBoard c-bg-sidebar",{active:c},{showDragHandle:g},{selected:r.hotkeySelected===o}),y=t.classNames("sidebarTextButton clickable",{active:c}),b=r.name||"Board",S=!u&&r.isHovered,E=u&&(m||r.hotkeySelected),C={width:S&&64,left:e.isSmall?i.DesktopMenuWidthSmall:i.DesktopMenuWidth},P=t.classNames("sidebarBoardOutside c-bg-sidebar c-button sidebarOutsideName pointer",{active:c},{selected:r.hotkeySelected===o});if(S||E){var T=t.offset(this.refs.menu),D=this.refs.menu.getBoundingClientRect();C.top=T.top,C.height=D.height,C.lineHeight=D.height+"px"}return e.isSmall&&(b=b.substr(0,Math.min(r.name.length,4))),n.createElement("div",_extends({},f,{className:v,ref:"menu",onMouseEnter:this.onMouseEnter}),n.createElement("div",{className:"sidebarBoardInside"},!e.isSmall&&g&&n.createElement("i",{className:"icon-drag-handle"}),n.createElement(l,{className:y,fontSize:u?9:h,padding:d,onClick:this.onClick},b),r.hotkeySelected&&n.createElement("div",{className:"boardNumber pointer flexbox flex-center",onMouseDown:this.onClick},n.createElement("span",null,a))),S&&n.createElement(s,{id:"portalBoardOutside_"+a},n.createElement("div",{className:"sidebarBoardOutside c-bg-sidebar",style:C},n.createElement(l,{icon:"icon-edit",iconSize:16,width:32,height:32,onClick:this.onClickEdit,tooltip:"Rename Board"}),n.createElement(l,{icon:"icon-delete",iconSize:16,width:32,height:32,onClick:this.onClickRemove,enabled:e.canDelete,tooltip:"Delete Board",ref:"deleteButton"}))),E&&n.createElement(s,{id:"portalBoardOutside_"+a},n.createElement("div",{className:P,style:C,onMouseDown:this.onClick},r.name)))}})}),define("Components/FancySortableItem",["require","globals","Constants","platform","react","Observable","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react");e("Observable");return e("MooReact").createClass({displayName:"FancySortableItem",componentDisplay:i.ComponentDisplay.Everywhere,init:function(){this.startY=void 0,this.isDragging=!1,this.createObservables({dragPosition:void 0})},getElement:function(){return this.refs.element},getDragPosition:function(){return this.state.dragPosition},onMouseDown:function(e){this.startY=e.clientY,this.dragOffset=t.offset(this.refs.element).top-e.clientY,document.addEventListener("mousemove",this.onMouseMoveDragging),document.addEventListener("mouseup",this.onMouseUpDragging)},onMouseMove:function(e){isNaN(this.startY)&&this.props.onDragMove(this,this.refs.element,e)},onMouseMoveDragging:function(e){if(!isNaN(this.startY)&&Math.abs(e.clientY-this.startY)>3){this.isDragging||(this.isDragging=!0,this.props.onDragStart(this));var i=this.refs.element,n=i.parentElement,r=n.getBoundingClientRect(),a=t.offset(n),s=i.getBoundingClientRect(),o=e.clientY+this.dragOffset;o=t.clamp(o,a.top,a.top+r.height-s.height),this.dragPosition.set(o)}},onMouseUpDragging:function(e){this.startY=void 0,this.dragOffset=void 0,this.isDragging=!1,this.dragPosition.set(void 0),this.props.onDragEnd(this),document.removeEventListener("mousemove",this.onMouseMoveDragging),document.removeEventListener("mouseup",this.onMouseUpDragging)},render:function(){var e=this.state,i=this.props,a=!isNaN(e.dragPosition),s=t.classNames(this.props.className,"fancySortableItem",{dragging:a}),o={};return o[n.transform.react]="translate3d(0,"+e.dragPosition+"px,0)",r.createElement("div",{className:s,onMouseDownCapture:this.onMouseDown,onMouseMove:this.onMouseMove,ref:"element"},i.children,a&&r.createElement("div",{className:"draggingElement",style:o},i.children))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("Components/FancySortableList",["require","globals","Constants","platform","react","Observable","MooReact","Components/FancySortableItem"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("react")),r=(e("Observable"),e("MooReact")),a=e("Components/FancySortableItem");return r.createClass({displayName:"FancySortableList",componentDisplay:i.ComponentDisplay.Everywhere,init:function(){this.createObservables({draggingChild:void 0})},getState:function(){return{obs:this.props.obs}},onDragStart:function(e){this.draggingChild.set(e)},onDragMove:function(e,i,n){var r=this.state.draggingChild;if(r){var a=i.getBoundingClientRect(),s=t.offset(i).top,o=s+a.height,c=r.getElement().getBoundingClientRect(),l=r.getDragPosition(),d=l+c.height,h=r.props.index,u=e.props.index,p=l-s,m=d-o,f=Math.abs(p)<Math.abs(m),g=f?u-1:u;g!==h&&this.props.moveChild(h,g)}},onDragEnd:function(){this.draggingChild.set(void 0)},render:function(){var e=this,i=t.classNames("fancySortableList",this.props.className,{dragging:!!this.state.draggingChild}),r=this.props,s=(r.index,r.obs,r.moveChild,_objectWithoutProperties(r,["index","obs","moveChild"])),o=n.Children.map(this.props.children,function(t,i){return n.createElement(a,{onDragStart:e.onDragStart,onDragMove:e.onDragMove,onDragEnd:e.onDragEnd,ref:"el_"+i,index:i},t)});return n.createElement("div",_extends({},s,{className:i}),o)}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactSidebarBoards",["require","globals","Constants","react","MooReact","Workspaces","tracker","ReactWorkspaceItem","Components/FancyContextMenu","Components/FancySortableList","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Workspaces"),s=e("tracker"),o=e("ReactWorkspaceItem"),c=e("Components/FancyContextMenu"),l=e("Components/FancySortableList"),d=e("Components/FancyButton");return r.createClass({displayName:"ReactSidebarBoards",componentDisplay:i.ComponentDisplay.Desktop,init:function(){this.createObservables({isAdding:!1,isHovered:!1})},getState:function(){return{hasPremiumFeatures:t.billingManager.hasPremiumFeaturesObservable,workspaces:a._workspaces,selectedIndex:a.selectedIndex}},moveChild:function(e,t){a.moveTo(e,t)},onMouseEnter:function(){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)},onMouseMove:function(e){t.findParent(e.target,"sidebarBoardOutside")||t.findParent(e.target,"sidebarBoard")||this.onMouseLeave()},onMouseLeave:function(e){this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove)},onClickNew:function(){!t.billingManager.hasPremiumFeatures()&&this.state.workspaces.length>=2?t.menus.openSidebarMenu(this.refs.newButton.getElement(),this.renderUpsell):(this.isAdding.set(!0,!1),t.vmMain.paneManager.addWorkspace(),s.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddBoard}),setTimeout(function(){this.isAdding.set(!1)}.bind(this),0))},onClickUpsell:function(){var e=!t.billingManager.isTrialOver();t.menus.closeContextMenuReact(),e?t.billingManager.startTrial():t.menus.openSettings(i.SettingsSections.Account)},renderUpsell:function(e){var r=!t.billingManager.isTrialOver();return n.createElement(c,_extends({},e,{key:"contextMenuBoardsUpsell",id:"contextMenuBoardsUpsell",background:"c-background"}),n.createElement("div",null,n.createElement("div",null,"Using more than 2 boards is a Premium feature that allows you to customize your workflow and save multiple sets of panes."),n.createElement("br",null),r&&n.createElement("div",null,"Start your ",i.TrialDuration," day free trial to enable unlimited Boards."),!r&&n.createElement("div",null,"Go Premium to enable unlimited Boards.")),n.createElement("br",null),n.createElement("div",{className:"center"},n.createElement(d,{primary:!0,raised:!0,onClick:this.onClickUpsell},r?"Start Trial":"Go Premium")))},render:function(){for(var e=this.state,i=this.props,r=(t.classNames({upsell:!e.hasPremiumFeatures}),[]),s=0;s<e.workspaces.length;s++){var c=e.workspaces[s];r.push(n.createElement(o,{key:c.id,number:s+1,workspace:c,active:s===e.selectedIndex,fontSize:i.fontSize,padding:i.padding,isAdding:e.isAdding&&s===e.workspaces.length-1,numWorkspaces:e.workspaces.length,isBoardsHovered:e.isHovered,isSmall:i.isSmall}))}return n.createElement("div",{className:"sidebarBoards"},n.createElement(l,{moveChild:this.moveChild,obs:a._workspaces,onMouseEnter:this.onMouseEnter},r),n.createElement(d,{key:"add",id:"newBoard",onClick:this.onClickNew,icon:"icon-add",iconSize:16,fontSize:i.fontSize,padding:i.padding,ref:"newButton",tooltip:i.isSmall?"New Board":void 0},!i.isSmall&&"New Board"))}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactDesktopMenu",["require","globals","Constants","platform","data","react","MooReact","tracker","gdata","Sel","Workspaces","AccountManager","DesktopUI","Components/DivX","Dispatcher","ReactInviteSection","ReactSidebarBoards","Components/FancyContextMenuItem","Components/FancyContextMenu","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("data"),a=e("react"),s=e("MooReact"),o=e("tracker"),c=(e("gdata"),e("Sel"),e("Workspaces")),l=e("AccountManager"),d=e("DesktopUI"),h=(e("Components/DivX"),e("Dispatcher")),u=e("ReactInviteSection"),p=e("ReactSidebarBoards"),m=e("Components/FancyContextMenuItem"),f=e("Components/FancyContextMenu"),g=e("Components/FancyButton");return s.createClass({displayName:"ReactDesktopMenu",componentDisplay:i.ComponentDisplay.Desktop,propTypes:{main:a.PropTypes.object.isRequired},init:function(){this.listenToDispatcher(t.settings,"settingChanged",Settings.DefaultGroup,Settings.gdocTitle),this.listenToDispatcher(t.vmMain.pluginManager,"pluginActiveChanged"),this.listenTo(l.onAccountsUpdated)},getState:function(){var e=(t.vmMain.paneFactory,this.props.main),i=t.billingManager,n=e.gdriveStatus(),a=t.settings.get(Settings.gdocTitle),s={hasPremiumFeatures:i.hasPremiumFeaturesObservable,gdriveStatus:e.gdriveStatusObs,
daysLeftInTrial:t.billingManager.daysLeftInTrial,showCompose:t.vmMain.pluginManager.isEnabled(PluginID.Gmail),premiumStatus:t.billingManager._premiumStatus,documentName:a||t.isDemoMode()&&"Demo Doc",isOnline:n!==DriveStatus.Offline,isConnected:n===DriveStatus.Saving||n===DriveStatus.Saved,onlineText:e.onlineText(),dropBucketItems:t.vmMain.dropBucket.getItems(),workspaces:c._workspaces,isDraggingSidebar:d.isDraggingSidebar,sidebarPosition:d.sidebarPosition};if(!t.isDemoMode()){var o;o=n===DriveStatus.Offline?"icon-cloud_off":t.hasOnlineBlockingError()||l.isMissingAccountToken()||r.overQuota?"icon-warning":n===DriveStatus.Saving||n===DriveStatus.Saved?"icon-cloud_done":"icon-cloud_queue",s.statusIcon=o}return s},openContextMenu:function(e,i,n){var r=t.findParent(e.target,"fancyButton")||e.target;t.menus.openSidebarMenu(r,i,n),e.preventDefault()},onClickDocuments:function(e){o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocumentsMenu}),this.openContextMenu(e,"ReactContextMenuDocuments")},onMouseDownAddPane:function(e){this.openContextMenu(e,"ReactContextMenuAddPane")},onMouseDownOptions:function(e){this.openContextMenu(e,"ReactContextMenuOptions",!0)},onMouseDownEmail:function(){t.menus.openComposeEmail(t.vmMain.getDefaultEmailPlugin())},onClickTrial:function(){t.menus.openSettings(i.SettingsSections.Account)},onClickHelp:function(e){h.fireEvent("helpOpened",[]),this.openContextMenu(e,this.renderContextMenuHelp,!0)},onClickStatusText:function(e){t.isDemoMode()?t.menus.confirm("Go to the Moo.do homepage?",function(e){if(e)if(window.parent)try{window.parent.location="https://www.moo.do"}catch(e){window.location="/"}else window.location="/"}):this.openContextMenu(e,"ReactContextMenuOnlineStatus",!0)},onClickDropBucket:function(e){this.state.dropBucketItems.length>0&&this.openContextMenu(e,"ReactContextMenuDropBucket")},onClickShare:function(e){this.openContextMenu(e,this.renderContextMenuHeart,!0)},onClickAddItem:function(e){this.openContextMenu(e,{componentName:"ReactItemDetailsPopup",addOnSave:!0})},onClickToggle:function(){d.toggleSidebar(),t.tooltip.hideTip()},onClickVideo:function(){var e="https://www.youtube.com/watch?v="+i.IntroVideoID;t.openUrl(e)},onClickGetStarted:function(){var e=t.createPath("help/basics");t.openUrl(e)},onClickGTDEmail:function(){var e=t.createPath("help/email");t.openUrl(e)},onClickAdvancedHelp:function(){t.intro.toggle(i.HelpMode.Normal)},onClickHotkeys:function(){t.intro.toggle(i.HelpMode.Hotkeys)},onMouseDownExpand:function(e){this.expandingFrom=e.clientX,this.startPosition=this.state.sidebarPosition,document.addEventListener("mousemove",this.onMouseMoveExpand),document.addEventListener("mouseup",this.onMouseUpExpand)},onMouseMoveExpand:function(e){if(this.expandingFrom){var n=t.clamp(this.startPosition+e.clientX-this.expandingFrom,i.DesktopMenuWidthSmall,i.DesktopMenuWidth);d.setPosition(n)}},onMouseUpExpand:function(){this.expandingFrom=void 0,this.startPosition=void 0,t.vmMain.cursor.set(void 0),d.setFromPosition(),document.removeEventListener("mousemove",this.onMouseMoveExpand),document.removeEventListener("mouseup",this.onMouseUpExpand)},renderContextMenuHelp:function(e){return a.createElement(f,_extends({},e,{key:"contextMenuHelp",id:"contextMenuHelp"}),a.createElement(m,{className:"helpVideoLink",onClick:this.onClickVideo},a.createElement("i",{className:"icon-youtube-play"}),a.createElement("div",null,"Introduction Video")),a.createElement("hr",null),a.createElement(m,{onClick:this.onClickGetStarted},"How to get started"),a.createElement(m,{onClick:this.onClickGTDEmail},"How to GTD your email"),a.createElement("hr",null),a.createElement(m,{onClick:this.onClickAdvancedHelp},"Advanced Help"),a.createElement(m,{onClick:this.onClickHotkeys},"Hotkeys"))},renderContextMenuHeart:function(e){return a.createElement(f,_extends({},e,{key:"contextMenuHeart",id:"contextMenuHeart",background:"c-background"}),a.createElement(u,{shouldShowInvitedBy:!1}))},render:function(){var e=this.state,r=t.billingManager,s=t.classNames("desktopMenuText","desktopOnline",{offline:!e.isOnline},{connected:e.isConnected}),o=r.isTrialState()&&!t.settings.get(Settings.trialOverHidden),c=r.isTrialOver(),l=(e.dropBucketItems.length,{cursor:"pointer"}),h={position:"absolute",top:"2px"};e.dropBucketItems.length<10?(h.left="14px",h.fontSize="10px"):(h.left="12px",h.fontSize="8px");var u=(n.secModKey,{});u[n.transform.react]="translate("+(e.sidebarPosition-i.DesktopMenuWidth)+"px,0)";var m=e.sidebarPosition<i.DesktopMenuWidthSmall+10,f=t.classNames("ns flexbox flexvert c-bg-sidebar c-border-pane",{transition:d.sidebarTransitioning},{noClick:e.isDraggingSidebar},{small:m},{big:!m}),v=(n.mac?n.priModKey+" + Option":"Alt + Shift")+" + S",y=(n.mac?"Ctrl":"Alt")+" + B",b={minHeight:e.workspaces.length>1&&100},S=m?0:8;return n.isMailbirdSidebar()?a.createElement("div",{id:"desktopMenuMailbird"},a.createElement(g,{id:"desktopDocumentsButton",ref:"documentsButton",tooltip:"Files",icon:"icon-folder",iconSize:18,onClick:this.onClickDocuments},e.documentName),a.createElement(g,{id:"optionsButton",ref:"options",tooltip:"More",icon:"icon-settings",iconSize:20,onMouseDown:this.onMouseDownOptions})):a.createElement("div",{id:"desktopMenu",className:f,style:u},a.createElement("div",{className:"desktopMenuTop"}),a.createElement(g,{className:"sidebarToggle c-button noShrink",icon:m?"icon-angle-right":"icon-angle-left",iconSize:16,width:36,height:30,onClick:this.onClickToggle,tooltip:"Toggle Sidebar",tooltipHotkey:v}),a.createElement("div",{className:"sidebarHeader",onClick:this.onClickDocuments,"data-tooltip":"A File contains all of your projects and tasks. Share a File with your friends or team to collaborate with them. In general, you should only have a single File unless you are using Moo.do to collaborate."},a.createElement("i",{className:"icon-folder"}),!m&&a.createElement("span",null,"FILE")),a.createElement("div",{className:"sidebarSection noShrink"},a.createElement(g,{id:"desktopDocumentsButton",className:"sidebarTextButton",fontSize:11,padding:S,ref:"documentsButton",tooltip:m?e.documentName:"Switch to a different file",onClick:this.onClickDocuments},m?e.documentName.substr(0,Math.min(e.documentName.length,2)):e.documentName)),a.createElement("div",{className:"desktopDrag flex-spacer sectionSpacer"}),a.createElement("div",{className:"sidebarHeader","data-tooltip":"Use Boards to save your pane layouts and customize your workflow.","data-tooltipHotkey":y},a.createElement("i",{className:"icon-filter_none"}),!m&&a.createElement("span",null,"BOARDS")),a.createElement("div",{className:"sidebarSection sectionBoards",style:b},a.createElement(p,{fontSize:11,height:30,padding:S,isSmall:m})),a.createElement("div",{className:"desktopDrag flex-spacer sectionSpacer"}),a.createElement("div",{className:"sidebarHeader"},a.createElement("i",{className:"icon-adjust",style:{fontSize:"12px"}}),!m&&a.createElement("span",null,"ACTIONS")),a.createElement("div",{className:"sidebarSection noShrink"},a.createElement(g,{id:"addPaneButton",ref:"addPane",tooltip:"Add Pane",tooltipHotkey:n.secModKey+" + T",icon:"icon-crop_portrait",iconSize:15,fontSize:11,height:30,onMouseDown:this.onMouseDownAddPane},"Add Pane"),e.showCompose&&a.createElement(g,{id:"newEmailButton",iconSize:10,fontSize:11,height:30,ref:"newEmail",icon:"icon-envelope",tooltip:"Compose Email",tooltipHotkey:n.priModKey+" + E",onMouseDown:this.onMouseDownEmail},"New Email"),a.createElement(g,{id:"newItemButton",icon:"icon-edit",iconSize:13,fontSize:11,height:30,tooltip:"New Item",tooltipHotkey:n.secModKey+" + N",onClick:this.onClickAddItem},"New Item")),a.createElement("div",{className:"desktopDrag flex-spacer"}),a.createElement("div",{className:"sidebarSection desktopMenuBottom noShrink"},a.createElement("div",{className:"sidebarHeader"},a.createElement("i",{className:"icon-more-vert"}),!m&&a.createElement("span",null,"MORE")),a.createElement(g,{icon:e.statusIcon,tooltip:"Check sync status",onClick:this.onClickStatusText,style:l,className:s,iconSize:15,fontSize:11,height:30,padding:S},!m&&e.onlineText),o&&!c&&a.createElement(g,{tooltip:e.daysLeftInTrial+" days left in trial",onClick:this.onClickTrial,fontSize:11,height:30,padding:S},"TRIAL"),o&&c&&a.createElement(g,{tooltip:"Learn more about Premium",onClick:this.onClickTrial,fontSize:11,height:30,padding:S},"TRIAL OVER"),a.createElement(g,{tooltip:"Share Moo.do with your friends or team",icon:"icon-heart",ref:"share",iconSize:12,fontSize:11,height:30,onClick:this.onClickShare},!m&&"Share"),a.createElement(g,{id:"helpButton",ref:"help",tooltip:"Show the Help",icon:"icon-question",iconSize:16,fontSize:11,height:30,onClick:this.onClickHelp},!m&&"Help"),a.createElement(g,{id:"optionsButton",ref:"options",tooltip:"Show more options",icon:"icon-settings",iconSize:14,fontSize:11,height:30,onMouseDown:this.onMouseDownOptions},!m&&"Options"),a.createElement("div",{style:{height:8}})),a.createElement("div",{className:"sidebarDragHandle",onMouseDown:this.onMouseDownExpand,onDoubleClick:this.onClickToggle}))}})}),define("ReactEmailComposeWindow",["require","globals","Constants","react","MooReact","platform","Sel","Dispatcher","ReactEmailCompose","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("platform"),s=e("Sel"),o=e("Dispatcher"),c=e("ReactEmailCompose"),l=e("Components/FancyButton");return r.createClass({displayName:"ReactEmailComposeWindow",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{threadAttach:n.PropTypes.object.isRequired,message:n.PropTypes.object.isRequired},init:function(){this.listenToDispatcher("windowResize"),this.createObservables({minimized:!1})},getState:function(){var e=a.windowWidth(),t=a.windowHeight();return{width:Math.min(Math.max(Math.min(.4*e,800),500),e-20),height:Math.min(Math.max(Math.min(.4*t,800),500),t)}},minimize:function(){this.minimized.set(!this.minimized.get())},close:function(){this.refs.compose.close(!0,!1,!0)},onClose:function(){o.fireEvent("EmailCompose","onClosed",[]),t.menus.closeComposeEmail(this.props.threadAttach,this.props.message)},onMouseDown:function(){s.reset()},openCc:function(){this.cc.set(!0)},openBcc:function(){this.bcc.set(!0)},componentDidMount:function(){var e=this.refs.compose;e.focusTo(),requestAnimationFrame(function(){e.focusTo()})},render:function(){var e=this.state,i={height:e.minimized?36:e.height,width:e.width},r=t.classNames("composeMinimize",{minimized:e.minimized});return n.createElement("div",{className:"composeEmail c-shadow-popup c-background flexbox flexvert",ref:"element",style:i,onMouseDown:this.onMouseDown},n.createElement("div",{className:"overlayTitleBar c-bg-popup-title composeTitleBar flexbox"},n.createElement("div",{className:"composeTitle f1"},"New Message"),n.createElement(l,{className:r,icon:"icon-minus",iconSize:14,width:36,height:36,onClick:this.minimize,tooltip:"Minimize"}),n.createElement(l,{className:"composeClose",icon:"icon-close",iconSize:18,width:36,height:36,onClick:this.close,tooltip:"Close"})),n.createElement(c,{className:"f1",threadAttach:this.props.threadAttach,message:this.props.message,showSubject:!0,onClose:this.onClose,ref:"compose",focus:"to",hidden:e.minimized}))}})}),define("ReactEmailComposes",["require","globals","Constants","react","ReactEmailComposeWindow","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("ReactEmailComposeWindow");return e("MooReact").createClass({displayName:"ReactEmailComposes",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{},getState:function(){return{emailComposes:t.menus.emailComposeStack}},render:function(){for(var e=this.state,t=[],i=0;i<e.emailComposes.length;i++){var a=e.emailComposes[i];t.push(n.createElement(r,{key:a.draftMsg.id,threadAttach:a.attach,message:a.draftMsg}))}return n.createElement("div",{className:"emailComposes flexbox"},t)}})}),define("ReactOverview",["require","globals","Constants","platform","react","MooReact","VMPane","ReactCell","ReactInfiniteList","Components/FancyScroller"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("VMPane"),o=e("ReactCell"),c=e("ReactInfiniteList"),l=e("Components/FancyScroller");return a.createClass({displayName:"ReactOverview",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{pane:r.PropTypes.instanceOf(s).isRequired},componentDidMount:function(){var e=this.props.pane,i=e.getOverview(),n=i.scrollElement=this.refs.overviewScroller.getScrollElement(),r=i.contentElement=this.refElement("overviewContentElement");e.getInfiniteList(!0).setupScroller(n,r),this.setData(n,e),t.setupClick(n,e.getOverview(),e.getOverview().onTap)},getState:function(){var e=this.props.pane,t=e.getOverview(),i={isVisible:t.isVisible,zoomed:e.item};return n.mobile?i.offsetX=e.offsetX:(i.cursor=t.cursor,i.rect=e.rect),i},renderCell:function(e,t){var i=this.props.pane;return r.createElement(o,{key:e,list:i.getInfiniteList(!0),pane:i,cell:t,overview:!0})},sizeAtIndex:function(e){var t=this.props.pane;return t.headers.get()[e].sizeInPane(t,!0)},itemsObs:function(){return this.props.pane.headers},render:function(){var e=this.state,a=this.props.pane,s={};n.mobile||(s.width=i.OverviewWidth,s.cursor=e.cursor,s[n.transform.react]="translate("+(e.rect.left-i.OverviewWidth)+"px,0)");var o=t.classNames("paneOverview",a.type+"Overview"),d=t.classNames(this.props.className,"paneOverviewScroller","scroller",{customScroller:a.useCustomScroller});return r.createElement(l,{className:d,ref:"overviewScroller",style:s,"data-moo-id":this.getUniqueID()},r.createElement("div",{className:"overviewContent"},r.createElement("div",{className:o,ref:"overview"},r.createElement(c,{owner:a.getInfiniteList(!0),pane:a,overview:!0,renderCell:this.renderCell,itemsObs:this.itemsObs,minItemHeight:t.minItemHeight,contentClass:"overviewList noSelect mat-list",ref:"overviewContentElement"}))))}})}),define("ReactFile",["require","globals","Constants","tracker","react","MooReact","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=e("tracker"),r=e("react"),a=e("MooReact"),s=e("Components/FancyContextMenuItem");return a.createClass({displayName:"ReactFile",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{file:r.PropTypes.object.isRequired},getState:function(){var e=this.props.file;return{isShared:e._isShared,title:e._title,isOpen:e.isOpen()}},onClickDocumentTitle:function(){var e=this.props.file;t.vmMain.vmPicker.openDocument(e),n.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocument})},onClickDocumentSettings:function(){var e=this.props.file;t.vmMain.vmPicker.openSharing(e),t.sendEvent("Menu","OpenSharing"),n.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocSharing})},render:function(){var e=this.state;return r.createElement(s,{icon:e.isShared?"icon-user":"icon-settings",active:e.isOpen,selected:this.props.selected,tooltip:"Open "+e.title,iconTooltip:"Share / Rename / Delete",onClick:this.onClickDocumentTitle,onClickIcon:this.onClickDocumentSettings},e.title)}})});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};define("ReactContextMenuDocuments",["require","globals","Constants","platform","react","MooReact","ReactFile","Components/FancyScroller","Components/FancyContextMenu","Components/FancyContextMenuItem"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("react")),r=e("MooReact"),a=e("ReactFile"),s=(e("Components/FancyScroller"),e("Components/FancyContextMenu")),o=e("Components/FancyContextMenuItem");return r.createClass({displayName:"ReactContextMenuDocuments",componentDisplay:i.ComponentDisplay.Everywhere,getState:function(){var e=t.vmMain.vmPicker;return{files:t.vmMain.docManager._docList,showError:e.showError,isLoading:e.isLoading}},render:function(){var e=t.vmMain.vmPicker,i=this.props,r=this.state;t.classNames("flexbox flexvert",{loading:r.isLoading||0===r.files.length});return r.showError?n.createElement(s,_extends({},i,{key:"contextMenuDocuments",id:"contextMenuDocuments",supportArrows:!0}),n.createElement(o,{onClick:e.onTapReloadDocuments.bind(e)},r.showError)):r.isLoading||0===r.files.length?n.createElement(s,_extends({},i,{key:"contextMenuDocuments",id:"contextMenuDocuments",loading:!0,supportArrows:!0})):n.createElement(s,_extends({},i,{key:"contextMenuDocuments",id:"contextMenuDocuments",supportArrows:!0,maxWidth:360}),n.createElement(o,{id:"addDocument",onClick:e.onTapAddDocument.bind(e),icon:"icon-add",iconSize:18},"New File"),n.createElement("hr",null),n.createElement("div",{key:"scroller"},r.files.map(function(e){return n.createElement(a,{key:"file_"+e.id,file:e})})))}})}),define("ReactMobileOverview",["require","globals","Constants","platform","react","MooReact","MobileUI","ReactSearch","ReactMobileFilterBar","ReactOverview","ReactContextMenuDocuments","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("MobileUI"),o=e("ReactSearch"),c=e("ReactMobileFilterBar"),l=e("ReactOverview"),d=e("ReactContextMenuDocuments"),h=e("Components/FancyButton");return a.createClass({displayName:"ReactMobileOverview",componentDisplay:i.ComponentDisplay.Mobile,getState:function(){var e=this.props.pane,i={documentName:t.settings.get(Settings.gdocTitle)||t.isDemoMode()&&"DEMO",mounted:this._isMounted};return n.mobile&&(i.rect=e.rect,i.left=e.rect.get().left,i.overviewWidth=s.overviewWidth()),i},onTapFiles:function(){t.menus.openContextMenuReact({fn:this.renderContextMenuDocuments})},onTapSettings:function(){t.menus.openModalNew(Modals.MobileSettings)},renderContextMenuDocuments:function(){return r.createElement(d,{key:"contextMenuDocuments",position:"bottom"})},render:function(){var e=this.state,t=this.props.pane,n=i.MobileBottomHeight,a={left:e.left,width:Math.floor(e.overviewWidth)},s={height:n,lineHeight:n+"px"};return r.createElement("div",{className:"mobileOverview flexbox flexvert",style:a},r.createElement("div",{className:"mobileOverviewSearchBar flexbox"},r.createElement(o,{pane:t}),r.createElement(c,{pane:t})),r.createElement(l,{pane:t,className:"f1"}),r.createElement("div",{className:"mobileOverviewBottom flexbox",style:s},r.createElement(h,{icon:"icon-folder",color:"#777",iconSize:20,width:n,height:n,onClick:this.onTapFiles}),r.createElement("div",{className:"mobileDocumentName f1",onClick:this.onTapFiles},e.documentName),r.createElement(h,{icon:"icon-settings",color:"#777",iconSize:24,width:n,height:n,onClick:this.onTapSettings})))}})}),define("ReactMessagePreview",["require","globals","Constants","platform","react","MooReact","International","EmailPreview","Sel","ReactMessageAttachments","Components/DivX","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("International"),o=e("EmailPreview"),c=e("Sel"),l=e("ReactMessageAttachments"),d=e("Components/DivX"),h=e("Components/FancyButton");return a.createClass({displayName:"ReactMessagePreview",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{threadAttach:r.PropTypes.object.isRequired,message:r.PropTypes.object.isRequired},init:function(){this._initializedFrame=!1,this.createObservables({hovered:!1})},componentDidMount:function(){this.props.isLastMessage&&this.props.index>0&&(this.needsScrollIntoView=!0),this.checkIsHovered(),this._initializeFrame()},_initializeFrame:function(){if(!this._initializedFrame&&this.refs.frame){this._initializedFrame=!0;var e=this.refs.frame.contentWindow.document;n.supportBlobURLIFrame||(e.open(),e.write(this.props.message.blob),e.close())}},getState:function(){var e=this.props.message;return{responseMode:e.responseMode,height:e.height,width:e.width}},onAfterChanged:function(e,t){this._initializeFrame(),e.height!==t.height&&e.height>0&&(this.checkIsHovered(),this.needsScrollIntoView&&(this.needsScrollIntoView=!1,this.scrollIntoView()))},checkIsHovered:function(){if(!n.mobile){var e=c.getMousePos(),i=document.elementFromPoint(e.x,e.y);if(i){t.findParent(i,"emailMessageWrapper")===this.refs.message&&this.hovered.set(!0)}}},scrollIntoView:function(){var e=this.refs.message,i=t.findParent(e,n.mobile?"fancyScroller":"fancyScrollContent"),r=0;r=e.clientHeight>i.clientHeight?e.offsetTop:i.scrollHeight-i.clientHeight,t.scrollTo(0,r,ScrollDuration.Snap,i)},onClickHeader:function(){this.props.toggleExpanded()},onMouseEnterMessage:function(){this.hovered.set(!0)},onMouseLeaveMessage:function(){this.hovered.set(!1)},onClickReply:function(e){o.setMessageResponseMode(this.props.message.id,i.EmailResponseMode.Reply),e.stopPropagation()},onClickReplyAll:function(e){o.setMessageResponseMode(this.props.message.id,i.EmailResponseMode.ReplyAll),e.stopPropagation()},onClickForward:function(e){o.setMessageResponseMode(this.props.message.id,i.EmailResponseMode.Forward),e.stopPropagation()},onClickReport:function(){t.menus.openModalNew(Modals.ReportProblem,{accountID:this.props.threadAttach.getField("accountID"),threadID:this.props.threadAttach.id,msgID:this.props.message.id})},_generateParticipantText:function(e){return e.text?e.text:e.email},isExpanded:function(){return this.props.expanded||this.props.isLastMessage||this.state.responseMode!==i.EmailResponseMode.None},openEmailDetails:function(e){var i=this.refs.messageHeaderText;t.menus.openContextMenuReact({componentName:"ReactContextMenuEmailDetails",element:i,message:this.props.message,accountID:this.props.threadAttach.getField("accountID")}),e.stopPropagation()},render:function(){var e,a=this.props,o=this.state,c=a.message,u=this.isExpanded(),p={height:o.height},m=s.formatDate(c.date,DFormat.MonthDay),f=s.formatDate(c.date,DFormat.ShortTime),g=!n.mobile&&(a.isLastMessage||o.responseMode!==i.EmailResponseMode.None),v=!n.mobile||u,y=n.windowWidth()>1080&&!n.mobile&&!t.isDemoMode(),b={},S={},E={};if(n.mobile||u||(b.opacity=o.hovered?"1":"0"),y&&(S.opacity=o.hovered?"1":"0"),n.ios){var C=Math.max(i.MinEmailScale,(n.windowWidth()-32)/o.width);C<1&&(p[n.transform.react]="scale("+C+")",E.height=o.height*C,E.overflow="hidden")}var P,T,D={cursor:u?"pointer":null};if(P=r.createElement("span",{className:"from",onClick:u&&!n.mobile&&this.openEmailDetails,style:D},this._generateParticipantText(c.from)),u){var M=(c.to?c.to:[]).concat(c.cc?c.cc:[]),_=M.map(this._generateParticipantText).join(", ");T=r.createElement("span",{className:"to c-foreground-faded",onClick:!n.mobile&&this.openEmailDetails,style:{cursor:"pointer"}},n.mobile&&"To ",!n.mobile&&r.createElement("i",{className:"icon-long-arrow-right"}),r.createElement("span",null,_))}else T=r.createElement("span",{className:"snippet",dangerouslySetInnerHTML:{__html:c.snippet}});var I=r.createElement("span",{className:"emailDate c-foreground-faded"},r.createElement("div",{className:"emailDateDate"},m),r.createElement("div",{className:"emailDateTime"},f)),A=n.mobile?22:16,w=n.mobile?50:40;e=r.createElement(d,{className:"messageHeader flexbox",onClick:this.onClickHeader},r.createElement("span",{className:"messageHeaderText f1",ref:"messageHeaderText"},P,T,n.mobile&&u&&I),v&&r.createElement("span",{className:"headerButtons",style:b},y&&r.createElement(h,{height:40,className:"reportEmail",style:S,onClick:this.onClickReport},"Report Problem"),r.createElement(h,{iconSize:A,width:w,height:w,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply}),r.createElement(h,{iconSize:A,width:w,height:w,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll}),r.createElement(h,{iconSize:A,width:w,height:w,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward})),!n.mobile&&I);var k;k=n.supportBlobURLIFrame?r.createElement("iframe",{key:"ep_"+this.props.message.id,ref:"frame",sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",src:c.blobURL,style:p,scrolling:"no"}):r.createElement("iframe",{key:"ep_"+this.props.message.id,ref:"frame",sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",style:p,scrolling:n.ios?"no":void 0});var x=t.classNames("emailMessage emailBox c-border",{collapsed:!u},{prevCollapsed:!a.prevExpanded},{nextCollapsed:!a.nextExpanded}),R=t.classNames("emailMessageWrapper",{replying:o.responseMode!==i.EmailResponseMode.None});return r.createElement("div",{className:R,onMouseEnter:this.onMouseEnterMessage,onMouseLeave:this.onMouseLeaveMessage,ref:"message"},r.createElement("div",{className:x},e,u&&r.createElement("div",{className:"messageContent",style:E},k,r.createElement(l,{threadAttach:a.threadAttach,message:a.message,editable:!1}))),g&&r.createElement("div",{className:"replyPlaceholder flexbox flex-center",ref:"placeholder"},r.createElement("div",{className:"replyPlaceholderInner c-background c-shadow-light"},r.createElement(h,{iconSize:A,width:w,height:w,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply,selected:o.responseMode===i.EmailResponseMode.Reply,padding:24}),r.createElement(h,{iconSize:A,width:w,height:w,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll,selected:o.responseMode===i.EmailResponseMode.ReplyAll,padding:24}),r.createElement(h,{iconSize:A,width:w,height:w,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward,selected:o.responseMode===i.EmailResponseMode.Forward,padding:24}))))}})}),define("ReactEmailReplyBox",["require","globals","platform","Constants","react","MooReact","EmailPreview","ReactEmailCompose"],function(e){var t=e("globals"),i=e("platform"),n=e("Constants"),r=e("react"),a=e("MooReact"),s=e("EmailPreview"),o=e("ReactEmailCompose");return a.createClass({displayName:"ReactEmailReplyBox",componentDisplay:n.ComponentDisplay.Everywhere,propTypes:{threadAttach:r.PropTypes.object.isRequired,message:r.PropTypes.object.isRequired,inReplyToMessage:r.PropTypes.object.isRequired},componentDidUpdate:function(){this._updateFocus()},componentDidMount:function(){this.refs.message&&(this.scrollIntoView(),this._updateFocus())},getState:function(){var e=this.props.inReplyToMessage;return{responseMode:e.responseMode,replytoMessageHeight:e.height}},onAfterChanged:function(e,t){e.replytoMessageHeight!==t.replytoMessageHeight&&this.scrollIntoView()},scrollIntoView:function(){var e=this.refs.message;if(e){var n=t.findParent(e,i.mobile?"fancyScroller":"fancyScrollContent"),r=e.offsetTop+e.offsetHeight,a=r-n.clientHeight+16;t.scrollTo(0,a,ScrollDuration.Default,n)}},_updateFocus:function(){var e=this.state.responseMode;switch(e){case n.EmailResponseMode.None:break;case n.EmailResponseMode.Reply:case n.EmailResponseMode.ReplyAll:case n.EmailResponseMode.Other:this.focusBody();break;case n.EmailResponseMode.Forward:this.focusTo();break;default:try{t.PAssert(5323,!1,"Unknown response mode for reply box",e)}catch(e){t.reportError(e)}}},focusTo:function(){this.refs.compose.focusTo()},focusBody:function(){this.refs.compose.focusBody()},onClose:function(){s.setMessageResponseMode(this.props.inReplyToMessage.id,n.EmailResponseMode.None)},render:function(){return this.state.responseMode!==n.EmailResponseMode.None?r.createElement("div",{className:"emailReplyBox emailBox c-shadow-popup",ref:"message"},r.createElement(o,{threadAttach:this.props.threadAttach,message:this.props.message,ref:"compose",onClose:this.onClose,responseMode:this.state.responseMode,closeOnEscape:!0})):null}})}),define("ReactEmailPreview",["require","globals","Constants","platform","react","MooReact","Sel","International","EmailPreview","MobileUI","ReactMessagePreview","ReactEmailReplyBox","Components/FancyContextMenu","Components/FancyContextMenuItem","Components/FancyLoader","Components/FancyButton","Components/FancyScroller"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("Sel"),o=(e("International"),e("EmailPreview")),c=e("MobileUI"),l=e("ReactMessagePreview"),d=e("ReactEmailReplyBox"),h=e("Components/FancyContextMenu"),u=e("Components/FancyContextMenuItem"),p=e("Components/FancyLoader"),m=e("Components/FancyButton"),f=e("Components/FancyScroller");return a.createClass({displayName:"ReactEmailPreview",componentDisplay:i.ComponentDisplay.Everywhere,propTypes:{messages:r.PropTypes.array},init:function(){this.listenToDispatcher("windowResize"),this.createObservables({expandedMessages:[]}),t.isDemoMode()&&(t.reactEmailPreview=this)},onBeforeChanged:function(e,t){if(e.thread!==t.thread){var i=e.messages,n=[];if(i.length>0)for(var r=this.getLastMessage(e),a=0;a<i.length;a++){var s=i[a];(s===r||this.isMessageUnread(s))&&n.push(s.id)}this.expandedMessages.set(n,!1),e.expandedMessages=n}},getState:function(){return{rect:this.props.pane.rect,pane:o.openOnPane,isLoading:o.isLoading,thread:o.threadAttach,threadItem:o.threadItem,messages:o.messages,errorMessage:o.errorMessage,messagesLoaded:o.messagesLoaded,bottomBarHeight:c.bottomBarHeight}},getLastMessage:function(e){var e=e||this.state,t=e.messages,i=e.thread,n=t.length-1;return this.isMessageDraft(t[n])&&!i.getPlugin().getAttachField(i,"pendingSend")&&n--,t[n]},onEscapeKey:function(){o.close()},isMessageDraft:function(e){return e.labelIds.indexOf("DRAFT")>=0},isMessageUnread:function(e){return e.labelIds.indexOf("UNREAD")>=0},onClickClose:function(){o.close()},onClickArchive:function(){this.state.pane.archiveItem(!0,this.state.threadItem)},onClickLabel:function(e){this.state.pane.autocompleteLabel({elementDisplay:e.target,item:this.state.threadItem})},onClickMove:function(e){this.state.pane.autocompleteMove({elementDisplay:e.target,item:this.state.threadItem})},onClickSchedule:function(e){this.state.pane.autocompleteSchedule({elementDisplay:e.target,item:this.state.threadItem})},onClickSnooze:function(e){var t=this.state.thread.getField("accountID");this.state.pane.autocompleteSnooze({elementDisplay:e.target,item:this.state.threadItem},t)},onClickUnread:function(){this.state.pane.markItemRead(!1,this.state.threadItem)},onClickDelete:function(){var e,i=this.state,n=i.pane,r=t.vmMain.getDefaultEmailPlugin();if(n.type===PaneMode.Gmail)this.state.pane.deleteSelected(r.isGmailItem,!0);else if(s.getStartItem()===i.threadItem&&(e=n.indexOfPrevVMLI(s.getStartIndex(),!0,!0)),i.threadItem.deleteSelf(ChangeType.Local),o.reset(),e){var a=n.itemAtIndex(e);if(a){var c=a.getParsedText().length;s.selectIndex(e,c)}}},onClickPrint:function(){var e=t.vmMain.getDefaultEmailPlugin(),i=e.createPrintURLForThread(this.state.thread);t.printPage(i)},onClickViewInGmail:function(){var e=t.vmMain.getDefaultEmailPlugin(),i=e.createURLForThread(this.state.thread);t.openUrl(i)},onClickReply:function(e){var t=this.getLastMessage();o.setMessageResponseMode(t.id,i.EmailResponseMode.Reply)},onClickReplyAll:function(e){var t=this.getLastMessage();o.setMessageResponseMode(t.id,i.EmailResponseMode.ReplyAll)},onClickForward:function(e){var t=this.getLastMessage();o.setMessageResponseMode(t.id,i.EmailResponseMode.Forward)},toggleExpanded:function(e){var t=this.state.messages,i=t[e];this.expandedMessages.indexOf(i.id)>=0?!(t.length>1&&e<t.length-1)||t[e+1]&&this.isMessageDraft(t[e+1])||this.expandedMessages.remove(i.id):this.expandedMessages.push(i.id)},onClickDown:function(){this.props.pane.keyMoveDown()},onClickUp:function(){this.props.pane.keyMoveUp()},onClickMobileReply:function(){t.menus.openContextMenuReact({fn:this.renderContextMenuReply})},renderContextMenuReply:function(e){return r.createElement(h,{key:"contextMenuGmailReply",id:"contextMenuGmailReply",className:"contextMenuMobile",element:e.element,position:"bottom"},r.createElement(u,{icon:"icon-reply",onClick:this.onClickReply},"Reply"),r.createElement(u,{icon:"icon-reply-all",onClick:this.onClickReplyAll},"Reply All"),r.createElement(u,{icon:"icon-forward",onClick:this.onClickForward},"Forward"))},render:function(){var e=this.state,a=this.props.pane.type===PaneMode.Gmail,s=e.thread,o=e.messages||[],c=[];if(o.length>0){
for(var h=o[0],u=(s.getPlugin().getDisplayParticipants(s),h.subject||"(no subject)"),g=[],v=this.expandedMessages.get(),y=this.getLastMessage(),b=0;b<o.length;++b){var S,E=o[b],C=this.isMessageDraft(E);if(C){try{t.PAssert(5324,b>0,"Should never have a draft as the first message in the list")}catch(e){t.reportError(e)}var P=o[b-1];S=n.mobile?null:r.createElement(d,{key:P.id+"_draft",threadAttach:s,message:E,inReplyToMessage:P})}else{var T=v.indexOf(E.id)>=0,D=o[b-1],M=o[b+1],_=0===b||v.indexOf(D.id)>=0||this.isMessageDraft(D),I=b>=o.length-2||v.indexOf(M.id)>=0||this.isMessageDraft(M);S=r.createElement(l,{key:E.id,index:b,threadAttach:s,message:E,toggleExpanded:this.toggleExpanded.bind(this,b),expanded:T,isLastMessage:E===y,prevExpanded:_,nextExpanded:I})}g.push(S)}c=r.createElement("div",{className:"emailMessages c-background c-border c-foreground",style:{opacity:e.messagesLoaded?1:0}},g)}else c=e.isLoading?r.createElement(p,{center:!0},"Loading messages..."):e.errorMessage?r.createElement("div",{className:"noMessages center"},e.errorMessage):r.createElement("div",{className:"noMessages center"},"No conversation selected");var A=t.classNames("emailPreview c-background c-border"),w={};n.mobile?w.left=e.rect.left:(w.width=n.emailPreviewSize(),w[n.transform.react]="translate("+(e.rect.left+i.ExpandedPaneWidth-1)+"px,0)");var k=n.mobile?"#444":void 0;return n.mobile?r.createElement("div",{className:A,style:w},r.createElement("div",{className:"emailPreviewTop c-border c-foreground"},r.createElement(m,{className:"closeButton",icon:"icon-angle-left",iconSize:24,width:t.topBarHeight,height:t.topBarHeight,color:k,onClick:this.onClickClose,tooltip:"Close"}),a&&r.createElement(m,{icon:"icon-angle-up",iconSize:24,width:t.topBarHeight,height:t.topBarHeight,onClick:this.onClickUp}),a&&r.createElement(m,{icon:"icon-angle-down",iconSize:24,width:t.topBarHeight,height:t.topBarHeight,onClick:this.onClickDown})),r.createElement(f,{className:"emailMessagesScroller"},r.createElement("div",{className:"emailHeaderMobile"},r.createElement("div",{className:"emailSubject bold"},u)),c),r.createElement("div",{className:"emailPreviewBottom flexbox",style:{height:i.MobileBottomHeight}},r.createElement(m,{icon:"icon-tag",iconSize:19,width:36,height:i.MobileBottomHeight,onClick:this.onClickLabel}),r.createElement(m,{icon:"icon-align-left",iconSize:19,width:36,height:i.MobileBottomHeight,onClick:this.onClickMove}),r.createElement(m,{icon:"icon-access_time",iconSize:21,width:36,height:i.MobileBottomHeight,onClick:this.onClickSnooze}),r.createElement(m,{icon:"icon-check",iconSize:24,width:36,height:i.MobileBottomHeight,onClick:this.onClickArchive}),r.createElement(m,{icon:"icon-delete",iconSize:24,width:36,height:i.MobileBottomHeight,onClick:this.onClickDelete})),r.createElement(m,{className:"mobileAddButton emailReply",icon:"icon-reply",iconSize:24,width:50,height:50,style:{bottom:e.bottomBarHeight+24},onClick:this.onClickMobileReply})):r.createElement("div",{className:A,style:w},r.createElement("div",{className:"emailPreviewTop c-border c-foreground c-bg-faded"},r.createElement("div",{className:"emailHeaderRow"},r.createElement("div",{className:"emailButtons"},r.createElement(m,{icon:"icon-check",iconSize:17,width:36,height:36,tooltip:"Archive (E)",onClick:this.onClickArchive}),r.createElement(m,{icon:"icon-access_time",iconSize:17,width:36,height:36,tooltip:"Snooze (D)",onClick:this.onClickSnooze}),r.createElement(m,{icon:"icon-unread icon-unread-header",iconSize:14,width:36,height:36,tooltip:"Mark Unread (U)",onClick:this.onClickUnread}),r.createElement(m,{icon:"icon-tag",iconSize:15,width:36,height:36,tooltip:"Label (L)",onClick:this.onClickLabel}),r.createElement(m,{icon:"icon-align-left",iconSize:15,width:36,height:36,tooltip:"Add to Outline (M)",onClick:this.onClickMove}),r.createElement(m,{icon:"icon-calendar",iconSize:15,width:36,height:36,tooltip:"Add to Calendar (C)",onClick:this.onClickSchedule}),r.createElement(m,{icon:"icon-delete",iconSize:18,width:36,height:36,tooltip:"Delete (Backspace)",onClick:this.onClickDelete}),!n.app&&r.createElement(m,{icon:"icon-print",iconSize:18,width:36,height:36,tooltip:"Print (P)",onClick:this.onClickPrint}),r.createElement(m,{icon:"icon-gmail",iconSize:15,width:36,height:36,tooltip:"Open in Gmail (G)",onClick:this.onClickViewInGmail}))),!n.mobile&&r.createElement("div",{className:"emailHeaderRow emailSubject"},u),r.createElement(m,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,color:k,onClick:this.onClickClose,tooltip:"Close"})),r.createElement(f,{className:"emailMessagesScroller"},c))}})}),define("ReactToast",["require","globals","Constants","react","MooReact","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Components/FancyButton");return r.createClass({displayName:"ReactToast",componentDisplay:i.ComponentDisplay.Everywhere,getState:function(){return{text:this.props.toast.text}},render:function(){var e=this.props.toast,i=this.state.text,r=t.classNames("toast noSelect",{hasAction:!!e.actionText},{big:e.isBig});return n.createElement("div",{className:r,onClick:e.onTapIgnore.bind(e)},n.createElement(a,{width:40,height:40,icon:"icon-close",className:"messageClose",onClick:e.onTapIgnore.bind(e)}),n.createElement("span",{className:"messageText f1",dangerouslySetInnerHTML:{__html:i}}),n.createElement(a,{primary:!0,className:"messageAction",onClick:e.doAction.bind(e)},e.actionText))}})}),define("ReactToasts",["require","globals","Constants","react","MooReact","Toasts","ReactToast"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=n.addons.CSSTransitionGroup,a=e("MooReact"),s=e("Toasts"),o=e("ReactToast");return a.createClass({displayName:"ReactToasts",componentDisplay:i.ComponentDisplay.Everywhere,getState:function(){return{toasts:s.queue}},render:function(){for(var e=this.state,i=[],a=0;a<e.toasts.length;a++){var s=e.toasts[a];t.classNames("toast noSelect",{hasAction:!!s.actionText},{big:s.isBig});i.push(n.createElement(o,{key:s.id,toast:s}))}return n.createElement(r,{id:"toasts",transitionName:"reactFade",transitionEnterTimeout:800,transitionLeaveTimeout:100},i)}})}),define("ReactDemoUI",["require","globals","Constants","react","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("react");return e("MooReact").createClass({displayName:"ReactDemoUI",componentDisplay:i.ComponentDisplay.Everywhere,getState:function(){return{caption:t.AScript.demoCaption}},render:function(){var e=this.state,i=e.caption;if(void 0!==i){var r=t.classNames("demoCaption",{center:i.center},{light:i.light});return n.createElement("div",{className:r,style:{opacity:i.opacity}},n.createElement("div",{className:"demoCaptionText",dangerouslySetInnerHTML:{__html:i.text}}))}return null}})}),define("ReactMobileKeyboardToolbar",["require","globals","Constants","platform","react","MooReact","tracker","Sel","KeyboardToolbar","DisplaySettings","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("tracker"),o=e("Sel"),c=e("KeyboardToolbar"),l=e("DisplaySettings"),d=e("Components/FancyButton");return a.createClass({displayName:"ReactMobileKeyboardToolbar",componentDisplay:i.ComponentDisplay.Mobile,init:function(){this.createObservables({isPriorityVisible:!1})},getState:function(){var e=c;return{panes:t.vmMain.paneManager.displayPanes,position:e.bottomPosition,mode:e.mode,pane:t.focusedPane}},componentDidMount:function(){this.refs.toolbarButtons&&(this.refs.toolbarButtons.scrollLeft=c.getScroll())},onUnmount:function(){this.refs.toolbarButtons&&c.setScroll(this.refs.toolbarButtons.scrollLeft)},insertCharacter:function(e,i){t.menus.isContextMenuOpen()||o.isValid()&&(o.insertTextAtCaret(e,i),t.autocomplete.update({owner:o.getStartItem(),index:o.getStartIndex(),start:o.getStartOffset()}))},onClickOutdent:function(){t.menus.isContextMenuOpen()||t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0})},onClickIndent:function(){t.menus.isContextMenuOpen()||t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1})},onClickOpenPriority:function(){this.state.mode===i.KeyboardToolbarMode.Search?t.getActiveSearch().addToValue("!"):this.isPriorityVisible.set(!this.isPriorityVisible.get())},onClickNote:function(){if(o.isValid()){var e=o.getStartItem();n.ios&&t.menus.isContextMenuOpen()&&t.focusedPane.closeNoteContextMenu(),e&&(s.beginAction(),(e.hasNote()||e.isNote())&&t.menus.isContextMenuOpen()&&t.menus.closeContextMenuReact(),e.editNote(),s.endAction())}},onClickDate:function(){this.state.mode===i.KeyboardToolbarMode.Search?t.getActiveSearch().addToValue(DatePrefix):(this.insertCharacter(DatePrefix,!0),s.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.AtButton}))},onClickContact:function(){this.state.mode===i.KeyboardToolbarMode.Search?t.getActiveSearch().addToValue(ContactPrefix):this.insertCharacter(ContactPrefix,!0)},onClickTag:function(){this.state.mode===i.KeyboardToolbarMode.Search?t.getActiveSearch().addToValue(TagPrefix):this.insertCharacter(TagPrefix,!0)},onClickPrefix:function(e){if(!t.menus.isContextMenuOpen()&&o.isValid()){var i=o.getStartItem();e=i.prefix===e?null:e,i.setPrefix(e)}},onClickClose:function(){t.closeKeyboard()},onClickMove:function(){this.state.pane.autocompleteMove({position:"autocomplete"})},onClickClosePriority:function(){this.isPriorityVisible.set(!1)},onClickP0:function(){this.state.pane.applyPriorityToSelection(VMLIFlag.P0,!0)},onClickP1:function(){this.state.pane.applyPriorityToSelection(VMLIFlag.P1,!0)},onClickP2:function(){this.state.pane.applyPriorityToSelection(VMLIFlag.P2,!0)},onClickStar:function(){t.vmMain.applyFnToSelection("isStarred",{toggle:!0,value2:ChangeType.Local})},openMobileFilterMenu:function(){t.menus.openContextMenuReact({componentName:"ReactContextMenuMobileFilter",position:"top-right",pane:t.focusedPane})},render:function(){var e=this.state,a=e.mode,s=i.KeyboardToolbarMode,o=this.state.pane,c=i.KeyboardToolbarHeight,h={bottom:e.position},u=n.windowWidth()-c,p=Math.floor(u/c),m=u-p*c,f=p<12?c-Math.round((c/2-m)/p):c,g=a!==s.Modal?r.createElement("div",{id:"mobileToolbarButtons",className:"flexbox"},r.createElement("div",{className:"f1"}),r.createElement("div",{className:"toolbarButtonsLeft",ref:"toolbarButtons"},a===s.Item&&o.type===PaneMode.Outline&&r.createElement(d,{icon:"icon-format_indent_decrease",width:f,height:c,iconSize:18,onClick:this.onClickOutdent}),a===s.Item&&o.type===PaneMode.Outline&&r.createElement(d,{icon:"icon-format_indent_increase",width:f,height:c,iconSize:18,onClick:this.onClickIndent}),a!==s.Search&&r.createElement(d,{id:"keyboardButtonHeader",icon:"icon-header",width:f,height:c,iconSize:20,onClick:this.onClickPrefix.bind(this,i.Prefix.Header)}),a!==s.Search&&r.createElement(d,{icon:"prefixTask",width:f,height:c,iconSize:24,onClick:this.onClickPrefix.bind(this,i.Prefix.Task)}),a!==s.Search&&r.createElement(d,{icon:"icon-bullet",width:f,height:c,iconSize:30,onClick:this.onClickPrefix.bind(this,i.Prefix.Bullet)}),a!==s.Search&&r.createElement(d,{icon:"icon-numlist",width:f,height:c,iconSize:16,onClick:this.onClickPrefix.bind(this,i.Prefix.NumList)}),a!==s.Search&&r.createElement(d,{icon:"icon-align-left",color:t.colorBlue,width:f,height:c,iconSize:18,onClick:this.onClickMove}),a!==s.Search&&r.createElement(d,{icon:"icon-sticky-note-o",width:f,height:c,iconSize:18,onClick:this.onClickNote}),r.createElement(d,{icon:"icon-calendar",color:l.dateColor(),width:f,height:c,iconSize:20,onClick:this.onClickDate}),r.createElement(d,{icon:"icon-user",color:l.contactColor(),width:f,height:c,iconSize:24,onClick:this.onClickContact}),r.createElement(d,{className:"tagIcon",color:l.tagColor(),width:f,height:c,fontSize:22,onClick:this.onClickTag},"#"),a!==s.Search&&r.createElement(d,{className:"exclamationIcon",width:f,height:c,fontSize:22,onClick:this.onClickOpenPriority},"!")),r.createElement("div",{className:"toolbarButtonsRight"},r.createElement("div",{className:"keyboardButtonSkew"}),(n.iphone||n.android)&&r.createElement(d,{id:"closeKeyboardButton",icon:"icon-angle-down",width:c,height:c,iconSize:24,onClick:this.onClickClose}))):r.createElement("div",{id:"mobileToolbarButtons",className:"flexbox"},r.createElement("div",{className:"f1"}),r.createElement(d,{icon:"icon-angle-down",width:c,height:c,iconSize:26,onClick:this.onClickClose}));return!(a===s.Modal&&n.ipad)&&r.createElement("div",{id:"mobileKeyboardToolbar",style:h},e.isPriorityVisible&&r.createElement("div",{id:"priorityMenu"},r.createElement(d,{className:"priorityButton",width:c,height:c,onClick:this.onClickP2},r.createElement("div",{className:"p2Button"})),r.createElement(d,{className:"priorityButton",width:c,height:c,onClick:this.onClickP1},r.createElement("div",{className:"p1Button"})),r.createElement(d,{className:"priorityButton",width:c,height:c,onClick:this.onClickP0},r.createElement("div",{className:"p0Button"})),r.createElement(d,{icon:"icon-star",width:c,height:c,iconSize:22,onClick:this.onClickStar}),r.createElement(d,{icon:"icon-angle-down",width:c,height:c,iconSize:24,onClick:this.onClickClosePriority})),g)}})}),define("ReactMobileMultiselect",["require","globals","Constants","platform","react","MooReact","Multiselect","VMPane","tracker","MobileUI","AccountManager","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=r.addons.CSSTransitionGroup,s=e("MooReact"),o=e("Multiselect"),c=e("VMPane"),l=e("tracker"),d=e("MobileUI"),h=e("AccountManager"),u=e("Components/FancyButton");return s.createClass({displayName:"ReactMobileMultiselect",componentDisplay:i.ComponentDisplay.Mobile,props:{pane:r.PropTypes.instanceOf(c).isRequired},init:function(){this.createObservables({inc:0})},getState:function(){var e=d;return{offset:e.multiselectOffset,isAnimating:e.multiselectAnimate,isOpen:e.isInMultiselect(),numSelected:o.numSelected}},applyFn:function(e,i,n){var r=this.props.pane;"gmailDelete"===i?r.deleteSelected(r.plugin.isGmailItem,!0):"gmailUndelete"===i?r.deleteSelected(r.plugin.isGmailItem,!1):"gmailArchive"===i?r.archiveSelected(!0):"gmailUnarchive"===i?r.archiveSelected(!1):"markRead"===i?r.markReadSelected(!0):"markUnread"===i?r.markReadSelected(!1):"gmailStar"===i?r.toggleStarSelected():"move"===i?r.autocompleteMove({position:"autocomplete"},o.reset):"snooze"===i?r.autocompleteSnooze({position:"autocomplete"}):"label"===i?r.autocompleteLabel({position:"autocomplete"}):(t.vmMain.beginUpdateItems(),l.beginAction(),o.applyFnToSelected(function(e){e.isNote()||(void 0!==n?e[i](n,ChangeType.Local):e[i](ChangeType.Local))},this.props.pane),l.endAction(),t.vmMain.commitUpdateItems(),"deleteSelf"===i&&o.reset())},checkComplete:function(e){return!e.isComplete()},checkStarred:function(e){return!e.isStarred()},checkP0:function(e){return e.priority()===VMLIFlag.P0?VMLIFlag.None:VMLIFlag.P0},checkP1:function(e){return e.priority()===VMLIFlag.P1?VMLIFlag.None:VMLIFlag.P1},checkP2:function(e){return e.priority()===VMLIFlag.P2?VMLIFlag.None:VMLIFlag.P2},onClick:function(e,t){var i=this.props.pane;if(o.getSelected(i).length>0){var n=o.getFirstSelectedItem(i);if(n){var r;e&&this[e]&&(r=this[e](n)),this.applyFn(n,t,r),this.inc.set(this.inc.get()+1)}}},renderButton:function(e,t,n,a,s){return r.createElement("div",{key:t,className:"f1 multiselectButton flexbox"},r.createElement(u,{icon:t,width:i.RightMenuWidth,enabled:this.state.numSelected>0&&!1!==s,iconSize:24,onClick:this.onClick.bind(this,a,n)},e))},renderPriorityButton:function(){var e=t.classNames("f1 priorityButtons flexbox flexvert",{disabled:this.state.numSelected<1});return r.createElement("div",{key:"priority",className:e,style:{justifyContent:"center"}},r.createElement("div",null,r.createElement(u,{icon:"priorityButton p0Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP0","priority")}),r.createElement(u,{icon:"priorityButton p1Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP1","priority")}),r.createElement(u,{icon:"priorityButton p2Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP2","priority")})),r.createElement("div",{className:"fancyButtonText"},"Priority"))},render:function(){var e,i=this.state,s=this.props.pane,c=i.numSelected,l=t.classNames("flexbox flexvert",{open:i.isOpen}),d={top:t.topBarHeight,bottom:this.props.bottom},u=[];if(i.isAnimating||(d[n.transform.react]="translate3d("+(i.offset+100)+"px,0,0)"),c&&(e=o.getFirstSelectedItem(s)),s.type===PaneMode.Gmail){var p=s.plugin,m=e&&p.isItemUnread(e),f=e&&p.isItemStarred(e),g=e&&p.isItemArchived(e),v=e&&p.isItemFullTrashed(e),y=e&&e.getAttachmentByPlugin(p.id),b=e&&y&&h.isLinkedAccountAuthorized(y.getField("accountID"),GScope.GmailModify);u=[this.renderButton(g?"Unarchive":"Archive","icon-check",g?"gmailUnarchive":"gmailArchive"),this.renderButton("Mark "+(m?"Read":"Unread"),"icon-unread",m?"markRead":"markUnread"),this.renderButton(f?"Unstar":"Star","icon-star","gmailStar"),this.renderPriorityButton(),this.renderButton("Label","icon-tag","label"),this.renderButton("Move","icon-align-left","move"),this.renderButton("Snooze","icon-access_time","snooze",null,b),this.renderButton(v?"Undelete":"Delete","icon-delete",v?"gmailUndelete":"gmailDelete")]}else{var S=e&&e.isComplete(),f=e&&e.isStarred();u=[this.renderButton(S?"Uncomplete":"Complete","icon-check","isComplete","checkComplete"),this.renderButton(f?"Unstar":"Star","icon-star","isStarred","checkStarred"),this.renderPriorityButton(),this.renderButton("Move","icon-align-left","move"),this.renderButton("Delete","icon-delete","deleteSelf")]}return r.createElement(a,{id:"mobileUIMultiselectWrapper",transitionName:"reactAnimMultiselect",transitionEnterTimeout:150,transitionLeaveTimeout:150},i.isOpen&&r.createElement("div",{id:"mobileUIMultiselect",className:l,style:d},u))}})}),define("ReactMobileUI",["require","globals","Constants","react","MooReact","DragDrop","MobileUI","Sel","ReactMobileMultiselect","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("DragDrop"),s=e("MobileUI"),o=e("Sel"),c=e("ReactMobileMultiselect"),l=e("Components/FancyButton");return r.createClass({displayName:"ReactMobileUI",componentDisplay:i.ComponentDisplay.Mobile,init:function(){this.DISABLE_LISTENER_ASSERT=!0,this.listenToDispatcher(t.vmMain.pluginManager,"pluginActiveChanged");var e=t.vmMain.pluginManager.getPlugin(PluginID.Gmail);e.onSettingChanged(e.Settings.IsEnabled,this.updateState)},getState:function(){var e=t.vmMain,i=o.pane.get(),n={pane:o.pane,paneExpanded:i.isExpanded,hasPremiumFeatures:t.billingManager.hasPremiumFeaturesObservable,gdriveStatus:e.gdriveStatusObs,canAddItem:i.canAddItem,multiselectOffset:s.multiselectOffset,isGmailPaneEnabled:t.vmMain.pluginManager.isGmailPaneEnabled(),isDragging:a.isVisible,bottomBarHeight:s.bottomBarHeight};return n.showAddButton=i.canAddItem&&!s.isInMultiselect()&&!a.isVisible.get()&&!t.menus.isContextMenuOpen()&&!i.isExpanded.get(),n.onlineText=e.onlineText(),n},switchPane:function(e){this.state.pane.type!==e&&t.vmMain.switchPaneMobile(e),this.refreshListeners()},onClickAdd:function(e){this.state.pane.onTapAddItem(e)},renderButton:function(e,t,r,a){return n.createElement(l,{className:"f1",icon:r,primary:this.state.pane.type===e,iconSize:a,width:i.MobileBottomHeight,height:i.MobileBottomHeight,ripple:!1,onClick:this.switchPane.bind(this,e)},t)},render:function(){var e=this.state,i=this.state.pane,r=e.bottomBarHeight,a={bottom:r+24},s=t.classNames("mobileAddButton",{outline:i.type===PaneMode.Outline},{email:i.type===PaneMode.Gmail}),o={height:r,display:e.paneExpanded?"none":void 0};return n.createElement("div",{id:"mobileUI"},n.createElement(c,{pane:i,bottom:r}),n.createElement("div",{id:"mobileUIBottom",className:"mobileUIBottom",style:o},e.onlineText&&n.createElement("div",{className:"mobileOnlineStatus"},e.onlineText),n.createElement("div",{id:"mobileBottomBar",className:"flexbox"},e.isGmailPaneEnabled&&this.renderButton(PaneMode.Gmail,"Gmail","icon-envelope",18),this.renderButton(PaneMode.Outline,"Outline","icon-align-left",19),this.renderButton(PaneMode.Timeline,"Agenda","icon-calendar",20))),e.showAddButton&&n.createElement(l,{icon:"icon-add",className:s,width:50,height:50,color:"white",iconSize:24,style:a,onClick:this.onClickAdd}))}})}),define("ReactTrashError",["require","globals","Constants","platform","react","MooReact","goog","Components/FancyLoader","Components/FancyScroller","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react"),a=e("MooReact"),s=e("goog"),o=e("Components/FancyLoader"),c=e("Components/FancyScroller"),l=e("Components/FancyButton");return a.createClass({displayName:"ReactTrashError",componentDisplay:i.ComponentDisplay.Everywhere,init:function(){this.createObservables({failedRestoring:!1,isRestoring:!1,isRedirecting:!1})},getState:function(){return{filesTrashed:t.vmMain.docManager._docListTrashed}},getTrashUrl:function(){return"https://drive.google.com/drive/u/"+t.vmMain.getUserEmail()+"/search?q=mimetype=application/vnd.google-apps.drive-sdk.597847337936%20is:trashed"},reload:function(){t.reload()},onClickRestore:function(){var e=this.state,i=e.filesTrashed.length,n=0,r=function(){++n===i&&(this.isRestoring.set(!1),this.isRedirecting.set(!0),setTimeout(this.reload,1e3))}.bind(this),a=function(e){t.reportError(new Error("Failed to untrash doc: "+e.error.code),e),this.isRestoring.set(!1),this.failedRestoring.set(!0)}.bind(this);this.isRestoring.set(!0);for(var s=0;s<i;s++){var o=e.filesTrashed[s];t.vmMain.remoteAPI().driveFilesUntrash(o.id,r,a)}},onClickNew:function(){s.createDefaultRealtimeFile(),t.vmMain.clearTrashedDocumentError()},render:function(){var e=this.state,t=e.filesTrashed.length;return e.isRedirecting?r.createElement(o,{center:!0},"Loading Moo.do..."):e.isRestoring?r.createElement(o,{center:!0},"Restoring files..."):e.failedRestoring?r.createElement("div",{className:"centerVH trashedFiles"},r.createElement("div",null,"There was an error restoring your files. Please manually restore them from your Trash, which you can access ",r.createElement("a",{href:this.getTrashUrl(),target:"_blank"},"here"),", then click Retry."),r.createElement(l,{marginTop:32,raised:!0,primary:!0,onClick:this.reload},"Retry")):r.createElement("div",{className:"centerVH trashedFiles c-foreground",style:{textAlign:"left"}},r.createElement("div",{style:{textAlign:"left"}},1===t?"It looks like your document is in the Trash in Google Drive. Would you like to restore it or create a new document?":"It looks like your documents are in the Trash in Google Drive. Would you like to restore them or create a new document?"),r.createElement("div",{style:{marginTop:32,textAlign:"center"}},r.createElement(l,{raised:!0,primary:!0,onClick:this.onClickRestore},"Restore Document"+(t>1?"s":"")),r.createElement(l,{raised:!0,marginLeft:32,onClick:this.onClickNew},"New Document")),t>1&&r.createElement("div",null,r.createElement("div",{style:{margin:"32px 0 8px 8px"}},"Documents in the Trash:"),r.createElement(c,{className:"trashedFilesList c-background c-border-heavy",style:{maxHeight:300}},r.createElement("ul",null,e.filesTrashed.map(function(e,t){return r.createElement("li",{key:t,className:"c-border"},e.getTitle())}))),r.createElement("div",{style:{marginTop:32}},"If you'd prefer to restore the files from your Trash manually, you can access your Trash ",r.createElement("a",{href:this.getTrashUrl(),target:"_blank"},"here"),". Then reload the ",n.app?"app":"page",".")))}})}),define("ReactIntroPopup",["require","globals","Constants","react","MooReact","Components/FancyButton"],function(e){var t=e("globals"),i=e("Constants"),n=e("react"),r=e("MooReact"),a=e("Components/FancyButton");return r.createClass({displayName:"ReactIntroPopup",componentDisplay:i.ComponentDisplay.Desktop,close:function(){t.vmMain.closeHelp("firstRunIntro")},showHelp:function(){this.close();var e=t.createPath("help/basics");t.openUrl(e)},render:function(){return n.createElement("div",{id:"introPopup",className:"intro"},n.createElement("div",{className:"popup c-shadow-popup c-background"},n.createElement("div",{className:"overlayTitleBar c-bg-popup-title flexbox"},n.createElement("div",{className:"displayTitle f1"},"Introduction"),n.createElement(a,{icon:"icon-close",width:36,height:36,onClick:this.close})),n.createElement("div",null,n.createElement("div",{className:"helpSection c-border-heavy"},n.createElement("div",{className:"helpVideo"},n.createElement("iframe",{src:"https://www.youtube.com/embed/"+i.IntroVideoID,frameBorder:"0",allowFullScreen:!0}))),n.createElement("div",{id:"introOpenHelp"},n.createElement(a,{primary:!0,raised:!0,onClick:this.showHelp},"How to get started")))))}})}),define("ReactTooltip",["require","globals","Constants","platform","react","MooReact"],function(e){var t=e("globals"),i=e("Constants"),n=e("platform"),r=e("react");return e("MooReact").createClass({displayName:"ReactTooltip",componentDisplay:i.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize")},getState:function(){var e=this.updatePosition();return{left:e.left,top:e.top}},componentDidMount:function(){n.mobile||this.updateState()},updatePosition:function(){var e,i=this.props.tip,n=document.documentElement.getBoundingClientRect(),r=this.refs.element;if(i.element)e=i.element.getBoundingClientRect();else try{t.PAssert(5325,!1,"Adjust bounds had no valid tip for determining an offset",i)}catch(e){t.reportError(e)}if(e){if(r){var a,s,o=t.width(r),c=t.height(r),l=e.left+e.width/2-o/2,d=i&&i.offset;return i&&(i.onRight||t.findParentID(i.element,"desktopMenu",8))&&(s=!0,d={left:8+e.right+((d?d.left:0)||0)}),a=s?e.top+(e.height-c)/2:i&&i.above||e.bottom+c>n.bottom?e.top-c:e.bottom,d?(d.x?l+=d.x:d.right?l=n.right-o-d.right:d.left&&(l=d.left),d.y?a+=d.y:d.top&&(a+=d.top)):i&&i.above?a-=5:a+=5,l+o>n.right?l=n.right-o-4:l<0&&(l=4),a<0&&(a=4),l=Math.round(l),a=Math.round(a),{left:l,top:a}}return{left:e.left,top:e.top}}},onClick:function(){t.tooltip.hideSticky(this.props.tip.text)},render:function(){var e=this.state,i=this.props.tip,a=i.text+(i.hotkey?'<div class="tooltipHotkey">'+i.hotkey+"</div>":""),s=t.classNames("tooltip c-shadow-popup",{blue:i.blue},{sticky:i.sticky},{arrowDirection:i.arrowDirection}),o=t.classNames("tooltipArrow c-tooltip c-shadow-popup",i.arrowClass),c={maxWidth:i.maxWidth};return c[n.transform.react]="translate3d("+e.left+"px,"+e.top+"px,0)",r.createElement("div",{className:s,style:c,onClick:this.onClick,ref:"element"},r.createElement("div",{className:o}),r.createElement("div",{className:"tooltipText c-tooltip",dangerouslySetInnerHTML:{__html:a}}))}})}),define("ReactTooltips",["require","globals","Constants","platform","react","MooReact","ReactTooltip"],function(e){var t=e("globals"),i=e("Constants"),n=(e("platform"),e("react")),r=e("MooReact"),a=e("ReactTooltip");return r.createClass({displayName:"ReactTooltips",componentDisplay:i.ComponentDisplay.Everywhere,getState:function(){return{tooltip:t.tooltip.tooltip,tooltipsSticky:t.tooltip.tooltipsSticky}},render:function(){var e=this.state,t=e.tooltip?e.tooltipsSticky.concat(e.tooltip):e.tooltipsSticky;return t.length>0?n.createElement("div",{className:"tooltips"},t.map(function(e){return n.createElement(a,{key:e.text,tip:e})})):null}})}),define("ReactAutocomplete",["require","globals","platform","Constants","International","react","react-dom","MooReact","Autocomplete","ReactItem","VMPane_Autocomplete","Components/FancyButton","Components/FancyInput","Components/FancyScroller","Components/FancyContextMenu","Components/FancyContextMenuItem","Autocomplete"],function(e){var t=e("globals"),i=e("platform"),n=e("Constants"),r=e("International"),a=e("react"),s=e("react-dom"),o=e("MooReact"),c=e("Autocomplete"),l=e("ReactItem"),d=e("VMPane_Autocomplete"),h=e("Components/FancyButton"),u=e("Components/FancyInput"),p=e("Components/FancyScroller"),m=e("Components/FancyContextMenu"),f=e("Components/FancyContextMenuItem");return o.createClass({displayName:"ReactAutocomplete",componentDisplay:n.ComponentDisplay.Everywhere,propTypes:{elementDisplay:a.PropTypes.object,elementInput:a.PropTypes.object,mode:a.PropTypes.string,owner:a.PropTypes.object},init:function(){var t=this.props;c=e("Autocomplete"),this.createObservables({selectedIndex:t.elementInput?0:-1,expanded:!1}),t.elementInput&&t.elementInput.addEventListener("keydown",this.onInputKeyDown),this.pane=new d},componentDidMount:function(){if(!this.props.elementInput){var e=this.refs.input;e.focus(),e.updateAutocomplete(this.props.item)}},onUnmount:function(){var e=this.props;e.elementInput&&e.elementInput.removeEventListener("keydown",this.onInputKeyDown),t.closeKeyboard()},onBeforeChanged:function(e,t){var i=this.refs;if(e.matches!==t.matches&&!e.hasSpecialMatches){this.expanded.set(!1,!1),e.expanded=!1;var n=!i.input||!this.props.allowCustom&&i.input.getValue()&&this.state.matches.length>0?0:-1;this.selectedIndex.set(n,!1),e.selectedIndex=n}},onAfterChanged:function(e,t){e.matches.length>t.matches.length&&setTimeout(function(){this.refs.contextMenu&&this.refs.contextMenu.updateState()}.bind(this),0)},getState:function(){var e=this.getSpecialMatches();return{matches:e||c.matches,hasSpecialMatches:!!e,kbsize:i.kbsize}},updateTextFromIndex:function(){if(!this.props.elementInput){var e=this.refs.input,t=this.selectedIndex.get(),i="";if(t>=0){var n=this.state.matches[t];i=this.getInsertText(n)}e.setValue(i),e.selectEnd()}},onInputKeyDown:function(e){var i=this.state,n=this.props;if(n.allowCustom&&e.keyCode===KeyCode.Enter)this.onSelected(),e.preventDefault(),e.stopPropagation();else if(i.matches.length>0){var r=this.selectedIndex.get();if(e.keyCode===KeyCode.DownArrow||e.keyCode===KeyCode.UpArrow){if(e.keyCode===KeyCode.UpArrow?--r<(n.allowCustom?-1:0)&&(r=i.matches.length-1):e.keyCode===KeyCode.DownArrow&&++r>i.matches.length-1&&(r=n.allowCustom?-1:0),r!==this.selectedIndex.get()&&(this.selectedIndex.set(r),this.updateTextFromIndex(),r>=0)){var a=this.refs["item_"+this.selectedIndex.get()];try{t.PAssert(5326,a,"Item must exist in autocomplete to be scrolled to")}catch(e){t.reportError(e)}if(a){var o=s.findDOMNode(a);t.scrollIntoView(o,ScrollDuration.Default)}}e.preventDefault()}else e.keyCode===KeyCode.RightArrow?this.expanded.set(r):e.keyCode===KeyCode.Enter&&r>=0&&(this.onSelected(),e.preventDefault(),e.stopPropagation())}},onEscapeKey:function(){this.hide(!0)},hide:function(e){c.hide(e)},onMouseOver:function(e){this.selectedIndex.set(e)},onClick:function(e){this.selectedIndex.set(e),this.updateTextFromIndex(),this.onSelected()},onButtonClick:function(){this.onSelected()},onSelected:function(){var e,t,i=this.props,n={};if(i.allowCustom)(i.allowEmpty||this.refs.input.getValue())&&(t={text:this.refs.input.getValue()});else{var r=this.selectedIndex.get();t=this.state.matches[r]}t&&("contact"===t.type&&"email"===this.props.mode?(e=c.insertMatch(""),n.token=t):"item"===t.type?(e=c.insertMatch(""),n.item=t.item):e=c.insertMatch(this.getInsertText(t)),e&&(n.value=e.text,n.offset=e.offset),i.owner?i.owner.onAutocompleteSelected(n):i.onSelected&&i.onSelected(n),this.hide())},componentWillReceiveProps:function(e){this.props.elementInput!==e.elementInput&&(this.props.elementInput.removeEventListener("keydown",this.onInputKeyDown),e.elementInput.addEventListener("keydown",this.onInputKeyDown))},getInsertText:function(e){return"email"===this.props.mode?e.text+" <"+e.email+">":"snooze"===e.type?e.insertText:e.text},insertHighlight:function(e){var t=[],i=c.getText(),n=e.toUpperCase().indexOf(i.toUpperCase());return n>=0&&i.length>0?(n>0&&t.push(e.substr(0,n)),t.push(a.createElement("span",{key:"match",className:"ac-match c-bg-autocomplete-highlight"},e.substr(n,i.length))),e.length>n+i.length&&t.push(e.substr(n+i.length))):t=e,t},onClickExpand:function(e,t){this.expanded.set(e),t.stopPropagation()},onClickExpandedInput:function(e){
e.stopPropagation()},onSelectedAddChild:function(){var e=this.props,t=this.state,i=t.expanded,n=t.matches[i];if(e.onSelected){var r={item:n.item,subItemText:this.refs.inputAdd.getValue()};e.onSelected(r)}},getSpecialMatches:function(){if("snooze"===this.props.mode){var e=new Date,i=e.getHours(),n=e.getDay(),a=e.clone().clearTime().addHours(Math.min(i+3,23+59/60)),s=e.clone().clearTime();i<18?s.addHours(19):s.addHours(Math.min(i+2,23+59/60));var o=e.clone().clearTime();n<6?o.addDays(6-e.getDay()).addHours(9):6===n?o.addDays(1).addHours(9):o.addHours(Math.min(i+3,23+59/60));var c=e.clone().clearTime();n>0?c.addDays(8-e.getDay()).addHours(9):c.addDays(1).addHours(9);var l=e.clone().clearTime().addDays(1).addHours(9),d=e.clone().clearTime().addDays(1).addHours(19);return[{type:"snooze",icon:"icon-access_time",iconColor:"#f30",text:"Later Today",insertText:"Today "+a.toString(r.getFormat(DFormat.ShortTime)),date:a,showDay:!1},{type:"snooze",icon:"icon-access_time",iconColor:"#fa0",text:"Tonight",insertText:"Today "+s.toString(r.getFormat(DFormat.ShortTime)),date:s,showDay:!1},{type:"snooze",icon:"icon-access_time",iconColor:"#fd0",text:"Tomorrow Morning",insertText:"Tomorrow "+l.toString(r.getFormat(DFormat.ShortTime)),date:l,showDay:!0},{type:"snooze",icon:"icon-access_time",iconColor:"#2a6",text:"Tomorrow Night",insertText:"Tomorrow "+d.toString(r.getFormat(DFormat.ShortTime)),date:d,showDay:!0},{type:"snooze",icon:"icon-access_time",iconColor:t.colorBlue,text:"This Weekend",insertText:o.toString(r.getFormat(DFormat.NoPadShortDayTime)),date:o,showDay:!0},{type:"snooze",icon:"icon-access_time",iconColor:"#b0d",text:"Next Week",insertText:c.toString(r.getFormat(DFormat.NoPadShortDayTime)),date:c,showDay:!0}]}},onCloseButton:function(){t.menus.closeContextMenuReact()},renderObject:function(e,i){var r;switch(e.type){case"contact":if(e.text&&e.email){r=this.insertHighlight(e.text);var s=this.insertHighlight(" <"+e.email+">");return a.createElement("span",null,a.createElement("span",{className:"contact c-contact"},r),s)}if(e.email)return e.email;if(e.text)return r=this.insertHighlight(e.text),a.createElement("span",{className:"contact c-contact"},r);break;case"tag":return r=this.insertHighlight(e.text),[a.createElement("span",{key:"tag",className:"tag c-tag"},r),a.createElement("span",{key:"number",className:"number"},e.count)];case"date":return r=this.insertHighlight(e.text),a.createElement("span",{className:"date c-date"},r);case"snooze":var o=(e.showDay?e.date.toString("dddd")+" ":"")+e.date.toString("h:mm tt");return[a.createElement("span",{key:"snoozeDate",className:"snoozeDate"},e.text),a.createElement("span",{key:"snoozeDetail",className:"snoozeDetail"},o)];case"item":var c=e.item,d=t.parentTextForItem(c),p=i===this.state.expanded,m=t.classNames("autocompleteItem flexbox",{hasParent:!!d},{itemExpanded:p}),f=this.props.mode===n.AutocompleteMode.Move;return a.createElement("div",{className:m},a.createElement("div",{className:"autocompleteItemInside f1"},d&&a.createElement("div",{className:"parentPath"},d),a.createElement(l,{key:c.id,item:c,pane:this.pane}),f&&p&&a.createElement(u,{ref:"inputAdd",placeholder:"Add subitem",buttonText:"MOVE TO CHILD",focused:!0,onButtonClick:this.onSelectedAddChild,onClick:this.onClickExpandedInput})),f&&a.createElement(h,{icon:p?"icon-angle-down":"icon-angle-right",className:"autocompleteExpand",width:50,height:50,onClick:this.onClickExpand.bind(this,i),tooltip:"Add sub-item"}));case n.AutocompleteMode.GmailLabel:return r=this.insertHighlight(e.text),a.createElement("span",null,r);default:try{t.PAssert(5327,!1,"Invalid insert text",e.type)}catch(e){t.reportError(e)}}},render:function(){for(var e=this.state,n=this.props,r=[],s=0;s<e.matches.length;s++){var o=e.matches[s],c=t.classNames("c-border autocomplete_"+o.type,{selected:!i.mobile&&s===e.selectedIndex});r.push(a.createElement(f,{key:s,ref:"item_"+s,icon:o.icon,iconColor:o.iconColor,className:c,onMouseOver:this.onMouseOver.bind(this,s),canClose:!1,noMouseUp:!0,onClick:this.onClick.bind(this,s),hoverEffects:!1},this.renderObject(o,s)))}var l,d=n.text,g=n.buttonText;n.elementInput||(l=!!n.allowEmpty||(n.allowCustom?void 0:e.selectedIndex>=0));var v=t.classNames("newAutocomplete flexbox flexvert",n.className,{hasOwnInput:!n.elementInput},{expanded:!1!==e.expanded}),y=i.mobile&&i.windowHeight()-e.kbsize,b=i.mobile&&"full"===n.position||!n.elementInput;return a.createElement(m,{className:v,id:n.id,element:n.elementDisplay,width:i.mobile?null:320,minWidth:i.mobile?null:260,height:y,positionOffset:n.positionOffset,position:n.position,useElementPosition:!i.mobile||"email"===n.mode,overflowHeight:"shrink",ref:"contextMenu"},b&&a.createElement("div",{className:"newAutocompleteTopBar flexbox c-border-heavy"},i.mobile&&a.createElement(h,{className:"fancyModalClose",icon:"icon-close",iconSize:20,width:40,height:40,onClick:this.onCloseButton}),!n.elementInput&&a.createElement(u,{ref:"input",display:"block",className:"f1",placeholder:d,onKeyDown:this.onInputKeyDown,autocompleteMode:n.mode,padding:{left:16,right:16},tokens:n.tokens,onTokenRemoved:n.onTokenRemoved,border:!1,buttonText:g,onEscape:this.onEscape,buttonEnabled:l,onButtonClick:this.onButtonClick})),a.createElement(p,{className:"matches"},r))}})}),define("ReactMain",["require","globals","platform","Constants","react","MooReact","Sel","DragDrop","KeyboardToolbar","DesktopUI","ReactAddPaneArea","ReactPaneList","ReactPaneCalendar","plugins/ReactPaneGmail","ReactDragDrop","ReactContextMenus","ReactModals","ReactDisplaySettingsSidebar","ReactHelpSidebar","ReactDesktopMenu","ReactEmailComposes","ReactMobileOverview","ReactOverview","ReactEmailPreview","ReactToasts","ReactDemoUI","ReactMobileKeyboardToolbar","ReactMobileUI","ReactTrashError","ReactIntroPopup","ReactTooltips","ReactAutocomplete","Components/FancyButton"],function(e){var t=e("globals"),i=e("platform"),n=e("Constants"),r=e("react"),a=r.addons.CSSTransitionGroup,s=e("MooReact"),o=e("Sel"),c=e("DragDrop"),l=e("KeyboardToolbar"),d=e("DesktopUI"),h=e("ReactAddPaneArea"),u=e("ReactPaneList"),p=e("ReactPaneCalendar"),m=e("plugins/ReactPaneGmail"),f=e("ReactDragDrop"),g=e("ReactContextMenus"),v=e("ReactModals"),y=e("ReactDisplaySettingsSidebar"),b=e("ReactHelpSidebar"),S=e("ReactDesktopMenu"),E=e("ReactEmailComposes"),C=e("ReactMobileOverview"),P=e("ReactOverview"),T=e("ReactEmailPreview"),D=e("ReactToasts"),M=e("ReactDemoUI"),_=e("ReactMobileKeyboardToolbar"),I=e("ReactMobileUI"),A=e("ReactTrashError"),w=e("ReactIntroPopup"),k=e("ReactTooltips");e("ReactAutocomplete"),e("Components/FancyButton");return s.createClass({displayName:"ReactMain",componentDisplay:n.ComponentDisplay.Everywhere,propTypes:{main:r.PropTypes.object.isRequired},componentDidMount:function(){this.setPanesContainer(),document.addEventListener("keydown",this.keydown),document.addEventListener("keypress",this.keypress),document.addEventListener("keyup",this.keyup),this.listenToDispatcher("panesChanged"),t.settings.listen("settingChanged",Settings.DefaultGroup,Settings.closedHelps,this.onClosedHelpsChanged),t.settings.listen("settingChanged",Settings.DefaultGroup,Settings.inTooltipIntro,this.updateState)},componentDidUpdate:function(){this.setPanesContainer()},setPanesContainer:function(){var e=this.props.main;e.panesContainer||(e.panesContainer=this.refs.panes)},onClosedHelpsChanged:function(e,t){!t||!t.firstRunIntro||e&&e.firstRunIntro||this.updateState()},_isOkToSendKey:function(e){return!e.defaultPrevented&&o.getPane()&&!t.menus.isContextMenuOpen()&&!t.menus.isModalOpen()&&!this.props.main.activeInput.get()},keydown:function(e){if(this._isOkToSendKey(e)&&o.getPane().keydown(e),e.target===document.body&&e.normCode===KeyCode.BackSpace)return e.handled=!0,e.preventDefault(),!1},keypress:function(e){this._isOkToSendKey(e)&&o.getPane().keypress(e)},keyup:function(e){this._isOkToSendKey(e)&&o.getPane().keyup(e)},getState:function(){var e=this.props.main,n=e.paneManager,r={panes:n.displayPanes,failedInitialDocLoad:e.failedInitialDocLoad,showTrashedDocumentError:e._isShowingTrashedDocumentError,isHelpShowing:!i.mobile&&t.intro.isVisible,helpPosition:!i.mobile&&t.intro.position,isWindowFocused:o.isWindowFocused,isDragging:c.isVisible,isDraggingPane:c.isDraggingPane,isLoading:n.isLoading,isKeyboardOpen:l.isVisible,animatePaneSwap:n.animatePaneSwap,sidebarPosition:d.sidebarPosition,isDraggingSidebar:d.isDraggingSidebar,cursor:e.cursor,showIntroPopup:!i.mobile&&t.settings.get(Settings.inTooltipIntro)&&e.shouldShowHelp("firstRunIntro")};if(i.mobile){var a=n.mobilePaneSelected;try{t.PAssert(5328,a.get(),"Mobile pane selected should be set. Is handled but should fix this.")}catch(e){t.reportError(e)}var s=a.get()||PaneMode.Outline,h=n.indexOfPaneType(s);r.mobilePaneSelected=a,r.mobilePaneOffset=h*i.windowWidth()}return r},render:function(){for(var e,s=this.state,o=[],c=0;c<s.panes.length;++c){var l=s.panes[c],x=l.type,R=l.pane;if(R.hasBeenActive)if("overview"===x)i.mobile?o.push(r.createElement(C,{key:"overview"+R.id,pane:R})):o.push(r.createElement(P,{key:"overview"+R.id,pane:R})),R.isActive.get()&&(e=!0);else if("pane"===x)switch(R.type){case PaneMode.Timeline:o.push(r.createElement(p,{key:"pane"+R.id,pane:R}));break;case PaneMode.Archived:case PaneMode.Outline:case PaneMode.Drive:o.push(r.createElement(u,{key:"pane"+R.id,pane:R}));break;case PaneMode.Gmail:o.push(r.createElement(m,{key:"pane"+R.id,pane:R}));break;default:try{t.PAssert(5329,!1,"Invalid pane mode requested"+R.type)}catch(e){t.reportError(e)}}else"emailPreview"===x&&o.push(r.createElement(T,{key:"emailPreview"+R.id,pane:R}))}var O=s.cursor;s.isDraggingSidebar&&(O="cursor-ew-resize");var L,N,F,B=t.classNames("renderedContent c-foreground",O,{windowBlurred:!s.isWindowFocused},{draggingItems:!!s.isDragging||s.isDraggingPane},{draggingPane:s.isDraggingPane},{overviewOpen:i.mobile&&e});if(s.showTrashedDocumentError)L=r.createElement(A,{key:"trashError"});else if(!s.isLoading||t.isDemoMode()||s.failedInitialDocLoad){if(i.mobile){var U={},H=t.classNames("panes",{transition:s.animatePaneSwap});U[i.transform.react]="translate("+-s.mobilePaneOffset+"px,0)",F=r.createElement(a,{className:H,ref:"panes","data-moo-id":"panes",transitionName:"reactMobilePaneAnim",transitionEnterTimeout:n.EmailOpenTimeMobile,transitionLeaveTimeout:n.EmailOpenTimeMobile,style:U},o)}else{var V,q=t.classNames("panes c-bg-app",{noPanes:0===o.length},{noClick:s.isDraggingSidebar},{transition:d.sidebarTransitioning}),W={left:s.sidebarPosition-1,bottom:i.isMailbirdSidebar()?40:0};if(s.isHelpShowing){var z={};z[i.transform.react]="translate("+s.helpPosition+"px,0)",V=r.createElement("div",{id:"helpPlaceholder",style:z})}F=r.createElement("div",{id:"panes",className:q,ref:"panes","data-moo-id":"panes",style:W},o,V,r.createElement(h,null))}N=r.createElement("div",{key:"renderedContent",className:B},i.mac&&i.isNativeApp()&&r.createElement("div",{className:"appTopBar desktopDrag c-bg-app"}),!i.mobile&&r.createElement(S,{main:this.props.main}),F,s.showIntroPopup&&r.createElement(w,null),this.props.main.getDefaultEmailPlugin()&&r.createElement(E,null),r.createElement(v,null),!i.mobile&&r.createElement(y,null),!i.mobile&&r.createElement(b,null),r.createElement(g,null),r.createElement(f,null),r.createElement(D,null),r.createElement(k,null),t.isDemoInIframe()&&r.createElement(M,null),i.mobile&&s.panes.length>0&&r.createElement(I,null),s.isKeyboardOpen&&r.createElement(_,null))}else L=r.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"centerVH"},r.createElement("div",{className:"loading loading20"}),r.createElement("div",{className:"loadingText"},"Loading file"));return r.createElement(a,{transitionName:"reactFadeMain",transitionEnterTimeout:800,transitionLeaveTimeout:100},N,L)}})}),define("DropBucket",["require","exports","module","globals","Constants","AccountManager","ObservableArray"],function(e,t,i){function n(){this._items=new o,this._remoteItems=void 0,this._localLoaded=!1,this._cache=r.vmMain.cacheManager.registerLocalCache("QuickAdd","QuickAdd",StorageType.IndexedDB),this._itemStore=r.vmMain.itemStoreManager.registerItemStore("QuickAdd",this,{isReadonly:!0}),this._itemStore.createRoot("QuickAddRoot","Quick Add"),this._cache.onCacheReady(function(){this._cache.loadAll(function(e,t){e&&this._notifyLocalItems(t)}.bind(this))}.bind(this))}var r=e("globals"),a=e("Constants"),s=e("AccountManager"),o=e("ObservableArray");return n.prototype={notifyRemoteItems:function(e){r.settings.set(Settings.lastQuickAddSync,new Date),this._localLoaded?(this._remoteItems=void 0,this._cache.onCacheReady(function(){r.vmMain.beginUpdateItems();for(var t=0;t<e.length;++t){var i=e[t];if(i.dateConsumed){!!this.removeTextEntry(i.quickAddID)&&this._cache.removeEntry(i.quickAddID)}else{this.addTextEntry(i.quickAddID,i.text,i.note)&&this._cache.cacheEntry(i.quickAddID,{id:i.quickAddID,isPersisted:!0,text:i.text,note:i.note})}}r.vmMain.commitUpdateItems()}.bind(this))):this._remoteItems=e},_notifyLocalItems:function(e){r.vmMain.beginUpdateItems();for(var t=0;e&&t<e.length;++t){var i=e[t];this.addTextEntry(i.id,i.text,i.note),i.isPersisted||this.persistTextEntry(i.id,!0)}this._localLoaded=!0,this._remoteItems&&this.notifyRemoteItems(this._remoteItems),r.vmMain.commitUpdateItems()},runQuickAddSync:function(e){r.XHR_PrivateAPI({type:"POST",path:"/quick/list",data:{lastQuickAddSync:this.getLastSyncDate()},requireAuth:!0,cb:function(t){if(t.status===a.HTTPStatusCode.Success)try{var i=JSON.parse(t.response).data;if(i.quickAddItems){try{r.PAssert(5330,r.isArray(i.quickAddItems),"Must be an array of items")}catch(e){r.reportError(e)}this.notifyRemoteItems(i.quickAddItems)}}catch(e){r.reportError(e)}e&&e()}.bind(this)})},getLastSyncDate:function(){var e=r.settings.get(Settings.lastQuickAddSync);try{r.PAssert(5331,!e||r.isString(e),"Must have a valid string sync date")}catch(e){r.reportError(e)}return e},addItemEntry:function(e,t){this.hasItemEntry(e)||this._items.push({id:e.id,item:e,pane:t})},addTextEntry:function(e,t,i){var n=!1;if(!this.hasTextEntry(e)){var r=this._itemStore.getRoot(),a=this._itemStore.createItem(e,t,r.id,ChangeType.Local);r.insertItem(a,0),this._items.push({id:e,isText:!0,item:a,text:t,note:i}),n=!0}return n},removeItemEntry:function(e){var t=this._items.indexOfWithProperty("id",e.id);if(t>=0)return this._items.splice(t,1)[0]},removeTextEntry:function(e){var t=this._items.indexOfWithProperty("id",e);if(t>=0)return this._items.splice(t,1)[0]},hasItemEntry:function(e){var t=this.getItemEntry(e);return!(!t||t.isText)},hasTextEntry:function(e){var t=this.getTextEntry(e);return!(!t||!t.isText)},getItemEntry:function(e){var t=this._items.indexOfWithProperty("id",e.id);return this._items.get()[t]},getTextEntry:function(e){var t=this._items.indexOfWithProperty("id",e);return this._items.get()[t]},getItems:function(){return this._items},_notifyPersisted:function(e){var t=this.getTextEntry(e);t&&this._cache.onCacheReady(function(){this._cache.cacheEntry(e,{id:e,text:t.text,note:t.note,isPersisted:!0})}.bind(this))},_notifyConsumed:function(e){this._cache.onCacheReady(function(){this._cache.removeEntry(e)}.bind(this))},persistTextEntry:function(e,t){s.onUserAuthorized("me",function(){this._persistTextEntry(e,t)}.bind(this))},_persistTextEntry:function(e,t){try{r.PAssert(5332,this.hasTextEntry(e),"Must be persisting a valid text entry")}catch(e){r.reportError(e)}var i=this.getTextEntry(e);if(i){t||this._cache.onCacheReady(function(){this._cache.cacheEntry(e,{id:e,text:i.text,note:i.note,isPersisted:!1})}.bind(this));var n={quickAddID:e,text:i.text};i.note&&(n.note=i.note),r.XHR_PrivateAPI({type:"POST",path:"/quick/add",data:n,requireAuth:!0,cb:function(t){if(t.status===a.HTTPStatusCode.Success)this._notifyPersisted(e);else if(t.status===a.HTTPStatusCode.BadRequest)try{var i=JSON.parse(t.responseText);i.code===PrivateAPIErrorCodes.AlreadyExists&&this._notifyPersisted(e)}catch(e){r.reportError(e)}}.bind(this)})}},consumeTextEntry:function(e){try{r.PAssert(5333,this.hasTextEntry(e),"Must be persisting a valid text entry")}catch(e){r.reportError(e)}this.removeTextEntry(e),this._cache.onCacheReady(function(){this._cache.removeEntry(e)}.bind(this));var t={quickAddID:e};r.XHR_PrivateAPI({type:"POST",path:"/quick/consume",data:t,requireAuth:!0,cb:function(t){t.status===a.HTTPStatusCode.Success&&this._notifyConsumed(e)}.bind(this)})},hasItems:function(){return this._items.get().length>0}},n}),define("VMMain",["globals","Constants","Dispatcher","util","CacheManager","data","gdata","goog","edit","copypaste","VMLI","tracker","platform","VMPane","PaneFactory","VMMenus","VMPicker","KeyboardToolbar","Intro","Toasts","International","VMPluginManager","PaneManager","RealtimeDocManager","RecurringTaskManager","DeferredTaskManager","DocManager","ItemStoreManager","react","react-dom","ReactMain","Measure","NativeSel","Sel","DragDrop","Observable","AccountManager","Workspaces","DropBucket","MobileUI","DesktopUI","PluginSettings"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m,f,g,v,y,b,S,E,C,P,T,D,M,_,I,A,w,k,x,R,O,L,N,F,B,U,H,V){var q=function(){function c(t){e.isLoadingRemote=!0;try{a.beginTransaction();e.settings.get(Settings.lastServerVersion)===s.getServerVersion()?(log("Client and Server Versions Match!"),e.sendEvent("PageLoad","VersionMatch")):e.sendEvent("PageLoad","VersionDiff"),h.beginAction(!0);!1===e.settings.get(Settings.localIntegrity)&&(ShouldLog(LogLevels.Warning)&&log("Previous remote sync had an issue!"),e.reportError(new Error("Previous remote sync had an issue!"))),s.loadSeen={},p.beginQueuedParseItems(ChangeType.Remote|ChangeType.DocLoad|ChangeType.All),e.settings.set(Settings.localIntegrity,!1),p.root().initFromGDrive(t),e.settings.set(Settings.localIntegrity,!0),s.loadSeen={},h.endAction(),ShouldLog(LogLevels.Timing)&&log("Drive done init",log.now()),p.flushParseItems(),p.flushModifiedItems(),log("Pending Updates: "+Object.keys(a.pendingRemoteUpdates).length),i.fireEvent("remoteDataLoaded",[]),setTimeout(function(){},5e3)}catch(t){e.reportError(t),e.toasts.pushMessage({text:"There was an error loading your data from the server. Please try again.",action:MessageAction.Reload})}finally{a.endTransaction(),e.isLoadingRemote=!1}}function d(){log("Last Update Items Stack: "+p._lastUpdateItemsStack);try{e.PAssert(5411,!1,"Update Watchdog Triggered - This should never happen.",p._isWaitingUpdateItems)}catch(t){e.reportError(t)}p._isWaitingUpdateItems=1,p.commitUpdateItems()}H.init();var p={root:e.createObservable(void 0,"root","VMMain"),isLoaded:!1,isRendered:!1,isInit:!1,_hasDisplayedArchivedItems:!1,gdriveStatusObs:new L(-1),isPhone:u.phone,help:void 0,lastActivity:Date.now(),cacheManager:r,recurringTaskManager:new T,deferredTaskManager:new D,itemStoreManager:new _,pluginManager:new E,paneManager:new C,paneFactory:m,docManager:new M,realtimeDocManager:new P,vmPicker:new g,_itemAnimationMode:t.ItemAnimationMode.Normal,isDisplaySettingsOpen:new L(!1),failedInitialDocLoad:new L(!1),activeInput:new L(null),_isShowingTrashedDocumentError:new L(!1),cursor:new L};e.vmMain=p,p.remoteAPI=function(){return p.pluginManager.getPlugin(PluginID.Moodo)},p.loadPlugins=function(){},p.getDefaultCalendarPlugin=function(){var t,i=p.pluginManager.getPlugin(PluginID.GCalendar);return(e.isDemoMode()||i.getSetting(i.Settings.IsEnabled))&&(t=i),t},p.showTrashedDocumentError=function(){p._isShowingTrashedDocumentError.set(!0),p.paneManager.clearLoadTimeout()},p.clearTrashedDocumentError=function(){p._isShowingTrashedDocumentError.set(!1)},p.notifyFailedLoad=function(){z||p.failedInitialDocLoad.set(!0)},p.notifySuccessfulLoad=function(){p.failedInitialDocLoad.set(!1),n.hasURLParam("sinfo")&&n.removeURLParam("sinfo")},p.getDefaultEmailPlugin=function(){return p.pluginManager.getPlugin(PluginID.Gmail)},p.isOnline=function(){return p.gdriveStatus()!==DriveStatus.Offline},p.isReconnecting=function(){return p.gdriveStatus()===DriveStatus.Reconnecting},p.isLocal=function(){return"localhost"===window.location.hostname},p.canRunUndoRedo=function(){return p.isOnline()||h.allowOfflineUndo},p.getUserEmail=function(){return N.getDefaultEmail()||e.getActiveUser()||void 0},p.getUserName=function(){var t;if(p.isDemoMode())t="Demo";else{var i=s.authenticatedUser.get();t=i?i.displayName:e.settings.get(Settings.displayName)||void 0}return t},p.getUserDomain=function(){},p.getUserID=function(){return N.getDefaultGID()||e.settings.get(Settings.userId)||void 0},p.isDemoMode=function(){return e.isDemoMode()},p.onlineText=function(){var t=p.gdriveStatus();return e.isDemoMode()&&"DEMO"||t===DriveStatus.Connecting&&"Syncing"||t===DriveStatus.Reconnecting&&"Syncing"||t===DriveStatus.Offline&&"OFFLINE"||t===DriveStatus.Saved&&s.isReadOnly()&&"READ ONLY"||t===DriveStatus.Saved&&!u.mobile&&"Saved"||""},p.handleGapiLoadError=function(){p.setGDriveStatus(DriveStatus.Offline),setTimeout(o.goOnline,3e4)};var f;p.connectFailed=function(){p.setGDriveStatus(DriveStatus.Offline),f=void 0,o.ensureDocConnection()},p.gdriveStatus=function(){return p.gdriveStatusObs.get()},p.setGDriveStatus=function(t){var i=p.gdriveStatus();t!==i&&t!==DriveStatus.Saving&&(p.gdriveStatusObs.set(t),t===DriveStatus.Connecting||t===DriveStatus.Reconnecting?s.loadedOnce&&(clearTimeout(f),f=setTimeout(p.connectFailed,s.offlineTimeoutMS)):(clearTimeout(f),f=void 0),t===DriveStatus.Offline?e.goOffline():i===DriveStatus.Offline&&e.goOnline())},p.init=function(){try{e.PAssert(5334,!p.isInit,"Should never double init VMMain, may cause severe issues")}catch(t){e.reportError(t)}p.isInit=!0,e.settings._ensureRemoteSettings(),U.init(),l.init(),V.init(),p.loadPlugins(),p.dropBucket=new B,u.mobile||e.intro.init(),i.fireEvent("VMMainLoaded",[]),i.listen("showArchived",function(){p._hasDisplayedArchivedItems||(p._hasDisplayedArchivedItems=!0,p.parseSubtreeArchive(p.root(),ChangeType.Auto))})},p.hasDisplayedArchivedItems=function(){return p._hasDisplayedArchivedItems},p.addModifiedItem=function(e,t,i){};var y={},b=!1,S=void 0;p.flushModifiedItems=function(){},p.addParseItem=function(t,i){try{e.PAssert(5335,b,"Must be marked as queueing items")}catch(t){e.reportError(t)}try{e.PAssert(5336,i===S,"ChangeType of queue must match")}catch(t){e.reportError(t)}y[t.id]=t},p.beginQueuedParseItems=function(t){try{e.PAssert(5337,!b,"Should not be already queueing parse items")}catch(t){e.reportError(t)}b||(b=!0,S=t)},p.flushParseItems=function(){try{e.PAssert(5338,b,"Must be marked as queueing items before flushing")}catch(t){e.reportError(t)}if(b){b=!1;try{for(var t in y){var i=y[t];p.runSingleParse(i,S)}}catch(t){e.reportError(t)}y={},S=void 0}},p.parseSubtree=function(t,i){try{e.PAssert(5341,t,"Must supply a valid item to parse")}catch(t){e.reportError(t)}p.runSingleParse(t,i);for(var n=t.getItems(),r=0;r<n.length;r++)p.parseSubtree(n[r],i)},p.parseSubtreeArchive=function(t,i){try{e.PAssert(5342,t,"Must supply a valid item to parse")}catch(t){e.reportError(t)}p.runSingleParse(t,i);for(var n=t.getItems(),r=0;r<n.length;r++)p.parseSubtreeArchive(n[r],i);if(t.hasArchivedChildren())for(var a=t.archivedItems(!0),r=0;r<a.length;r++)p.parseSubtreeArchive(a[r],i)},p.runFnOnSubtree=function(e,t){t(e);for(var i=e.getItems(),n=0;n<i.length;n++)p.runFnOnSubtree(i[n],t);if(e.hasArchivedChildren())for(var r=e.archivedItems(!0),n=0;n<r.length;n++)p.runFnOnSubtree(r[n],t)},p.runSingleParse=function(t,i){try{e.PAssert(5349,t,"Must have a valid item to parse")}catch(t){e.reportError(t)}try{e.PAssert(5350,!b,"Should not run single parse while queueing item parses")}catch(t){e.reportError(t)}var n={};t.parseText(!0,i,n)&&t.save(n,SaveFlag.None)},p.createWorkerFromObj=function(t,i,n){var r;try{r=new Worker(t),r.onmessage=i,r.onerror=n}catch(t){e.reportError(t)}return r},p.createWorkerFromFnList=function(t,i,n){try{e.PAssert(5355,!u.ie,"IE does not support creating workers from blob URLs")}catch(t){e.reportError(t)}var r=[];try{for(var a=0;a<t.length;++a)r.push(window[t[a]].toString()),r.push(t[a]+"();")}catch(t){e.reportError(t)}return p.createWorkerFromStrings(r,i,n)},p.createWorkerFromStrings=function(e,t,i){var n=u.URL.createObjectURL(new Blob(e,{type:"text/javascript"}));return p.createWorkerFromObj(n,t,i)};var F=0,q=0,W=void 0;p.runDateRollover=function(){function t(){p.root()&&p.parseSubtree(p.root(),ChangeType.Auto|ChangeType.Rollover),k.clearItemCache(),k.clearLineCache(),p.updateAllItems(!1,!0),e.timeline.updateNotifications(),log("-------------------------------")}try{e.PAssert(5356,p.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(t){e.reportError(t)}var n=F-new Date;if(log("---- Running Date Rollover: "+n+" ----"),q=new Date,F=0,clearTimeout(W),W=void 0,p.setupDateRollover(),Date.Parsing.Normalizer.buildReplaceData(),e.timeline.clearDailyCaches(),e.settings.get(Settings.syncContacts)){var r=setTimeout(function(){t()},1e4);o.loadedContacts=!1,o.loadContacts(function(){clearTimeout(r),r=void 0,t()})}else t();i.fireEvent("dateChanged",[])},p.setupDateRollover=function(){try{e.PAssert(5357,!W,"Should never reschedule a date rollover over another one")}catch(t){e.reportError(t)}var t=new Date,i=t.clone().addDays(1).clearTime();try{e.PAssert(5358,i>t,"Rollover time must be in the future")}catch(t){e.reportError(t)}try{e.PAssert(5359,i>q,"Rollover time must be after the last rollover")}catch(t){e.reportError(t)}log("Rollover Run Time: ",t),log("Next Rollover Time: ",i),W=setTimeout(p.runDateRollover,i-t),F=i},p.ensureDateRollover=function(){setTimeout(function(){var e=new Date;F-e<0&&p.runDateRollover()},1e4)};var z=!1;p.notifyDriveDisconnect=function(){z=!1,h.resetAggregateActionCount()},p.notifyDriveOperationError=function(){h.resetAggregateActionCount()},p.loadGDriveData=function(){if(!z){try{e.PAssert(5375,a.localDataLoaded(),"Must have already loaded local data from db")}catch(t){e.reportError(t)}try{e.PAssert(5376,!0===e.vmMain.isLoaded,"Must have already loaded local data")}catch(t){e.reportError(t)}z=!0,u.mobile||(p.selectionOnLoad=R.save());var t=s.rootItem;try{if(!p.root()){a.createRootItem(t.id);var n=a.createVMLI(a.getRootItem(),{changeType:ChangeType.Auto,isRoot:!0});e.vmMain.itemStoreManager.getDefaultItemStore().setRoot(n),p.root(n)}p.root().linkToGDrive(t)}catch(t){e.reportError(t),e.menus.alert({text:"There was a fatal error in the application. Please reload to try again.",actionText:"RELOAD",callback:e.reload})}try{s.checkRemoteIntegrity()}catch(t){e.reportError(t)}var r;R.isValid()&&(r=R.save(),R.reset()),e.vmMain.beginUpdateItems(),c(t),e.vmMain.commitUpdateItems(),s.lastChangeTime.set(Date.now()),r&&R.restore(r),i.fireEvent("gdataLoaded",[]),p.vmPicker.refreshFiles()}};var G=!1;p.loadDemoContacts=function(e){for(var t=[],i=0,n=0;n<e.length;n++)!function(e){var n="test-"+e.split(" ")[0].toLowerCase()+"@moo.do";t.push({id:"contact_"+i++,name:e,isDemo:!0,emails:[{address:n,primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}(e[n]);a.contactManager.loadContacts(t,!0)},p.loadData=function(){if(!G){try{e.PAssert(5377,a.localDataLoaded(),"Must have already loaded local data")}catch(t){e.reportError(t)}if(ShouldLog(LogLevels.Timing))var t=log.now();if(G=!0,p.isDemoMode()){var r=["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"];p.loadDemoContacts(r)}if(a.getRootItem()){e.vmMain.beginUpdateItems();var s=a.createVMLI(a.getRootItem(),{changeType:ChangeType.Auto,isRoot:!0});e.vmMain.itemStoreManager.getDefaultItemStore().setRoot(s),p.root(s),e.vmMain.commitUpdateItems()}e.checkpoint(Checkpoint.LocalDocLoad),p.isLoaded=!0,e.requireGDriveDataCallback&&p.loadGDriveData(),ShouldLog(LogLevels.Timing)&&log("Run loading/parseWorker",log.now()),e.vmSetup.initDemo(),setTimeout(function(){p.isDemoMode()&&(u.script&&e.vmSetup.runScript(n.getURLParam("script")),window.parent.postMessage("loaded","*"))},0),a.getRootItem()?p.afterLoaded():i.listen("gdataLoaded",function(){p.afterLoaded()}),A.render(I.createElement(w,{main:this}),document.getElementById("container")),p.isDemoMode()&&u.script&&e.setupClick(document.getElementById("container"),p,p.onTapMain),p.isRendered=!0,document.getElementById("container").style.display="block",u.app&&e.nativeBridge.sendToApp("localLoaded"),p.pluginManager.notifyDependencyLoad(PluginDependency.LocalLoaded),ShouldLog(LogLevels.Timing)&&(log("DONE LOCALLY",log.now()),setTimeout(function(){var e=log.now();log("time react:",e-t,e)},0))}},p.changeRoot=function(t){try{e.PAssert(5378,t,"Cannot use to reset root to undefined")}catch(t){e.reportError(t)}var i=a.getModel(t);i||(i=a.createVMLI(a.getItem(t),{changeType:ChangeType.Auto,isRoot:!0}));try{e.PAssert(5379,i,"Must have a new root VMLI at this point, otherwise failed creation")}catch(t){e.reportError(t)}i&&(p.itemStoreManager.getDefaultItemStore().setRoot(i),p.root(i),p.paneManager.runForEachPane(function(e){R.reset(),e.setItem(i)}))},p.resetScrollOffsets=function(){p.paneManager.runForEachPane(function(e){e.setScrollOffset(e.defaultOffset)})},p.onTapMain={onStart:function(){e.fireCustomEvent("tapMain")},onClick:function(){try{e.PAssert(5380,p.isDemoMode()&&u.script,"Tap handler should only be active on demo page")}catch(t){e.reportError(t)}window.parent.postMessage("click","*")}},p.afterLoaded=function(){p.paneManager.loadInitialState(),u.mobile&&(e.keyboardToolbar=v),u.app&&(document.onreadystatechange=function(){u.mobile&&e.nativeBridge.sendToApp("kbsize"),e.nativeBridge.sendToApp("loaded")},document.onreadystatechange()),e.timeline.updateNotifications()},p.switchPaneMobile=function(t,i){try{e.PAssert(5386,u.mobile,"Should only call on mobile devices")}catch(t){e.reportError(t)}x.clearSelection(),O.stop(),O.finish(),e.vmMain.beginUpdateItems();var n=p.paneManager.swapToPane(t,i);e.keyboardToolbar.hide(),R.setFocusedPane(n),U.setMultiselectVisibility(!1),e.vmMain.commitUpdateItems()},p.zoomin=function(t,i){try{e.PAssert(5403,t,"Must supply a valid item to zoom to")}catch(t){e.reportError(t)}var n=e.focusedPane,r=n&&n.item.get();if(p._zoom(t,i),t.isDemandLoad()&&t.notifyDemandLoadUpdate(!0,n),i||e.sendEvent("Menu","ZoomIn"),!u.mobile&&n.paneContent&&n.isWriteable){n.addIfEmpty();var a=n.indexOfFirstItem();a>=0?R.selectIndex(a,0,0):R.clearSelection()}n.isLoaded&&n.onZoom(),i||h.performAction(TrackerType.Zoom,{itemID:t.id,oldItemID:r.id,zoomIn:!0,time:e.zoomTime,pane:n})},p.zoomout=function(t,i){try{e.PAssert(5404,t,"Must supply a valid item to zoom to")}catch(t){e.reportError(t)}var n=e.focusedPane,r=n&&n.item.get(),a=R.save();if(p._zoom(t,!1),e.sendEvent("Menu","ZoomOut"),n.isWriteable&&a){for(var s=a.startItem,o=a.startOffset,c=a.endItem,l=a.endOffset;s&&n.indexOfItem(s)<0;)s=s.parent(),o=0;s&&(n.indexOfItem(a.endItem)<0&&(c=s,l=o),R.selectItems(s,o,c,l),n.scrollItemToMiddle(s,ScrollDuration.Snap))}i||h.performAction(TrackerType.Zoom,{itemID:t.id,oldItemID:r.id,zoomOut:!0,time:e.zoomTime,pane:n})},p._zoom=function(t,i){try{e.PAssert(5405,t,"Must supply a valid item to zoom to")}catch(t){e.reportError(t)}var n=e.focusedPane,r=n&&n.item.get();r&&r.id===t.id||(R.reset(),n.setItem(t,!0),e.focusedItem=t,i||p.paneManager.updatePaneStateForPane(e.focusedPane))},p.applyFormatToSelection=function(i){var n,r,a=!1;e.vmMain.setItemAnimationMode(t.ItemAnimationMode.None),p.applyToSelection(function(e,s,o){var c=0===s?R.getStartOffset():0,l=s===o-1?R.getEndOffset():e.getParsedText().length,d=e.applyFormatToSelection(i,c,l,0===s?t.SetMode.Toggle:a?t.SetMode.Yes:t.SetMode.No);0===s&&(a=d.didSet,n=d.selStart),s===o-1&&(r=d.selEnd)}),R.selectIndices(R.getStartIndex(),n,R.getEndIndex(),r),e.vmMain.resetItemAnimationMode()},p.applyPrefixToSelection=function(e,t){var i,n;if(R.isValid()&&(i=R.getStartItem().getPrefixLength(),n=R.getEndItem().getPrefixLength()),t)e=t.prefix===e?null:e,t.setPrefix(e);else{var r=!0
;p.applyToSelection(function(t){if(t.prefix!==e)return r=!1,!1}),r&&(e=null),p.applyFnToSelection("setPrefix",{value:e})}if(!isNaN(i)){var a=R.getStartItem().getPrefixLength()-i,s=R.getEndItem().getPrefixLength()-n;a||s?R.selectIndices(R.getStartIndex(),R.getStartOffset()+a,R.getEndIndex(),R.getEndOffset()+s):R.updateCaret()}},p.applyFnToSelection=function(t,i){var n=R.save(),r=i&&i.toggle,a=!i||void 0===i.value||i.value,s=i&&void 0!==i.value2?i.value2:void 0;if(p.applyToSelection(function(e){r&&e[t]()!==a&&(r=!1),r||e[t](a,s)}),r){var o=o=!(!i||void 0===i.emptyValue)&&i.emptyValue;p.applyToSelection(function(e){e[t](o,s)})}n&&e.focusedPane.restoreSelection(n)},p.applyToSelection=function(t,i){try{e.PAssert(5406,!i||!i.restoreSelection,"restoreSelection is no longer a valid option")}catch(t){e.reportError(t)}h.beginAction();var n=R.getSelectedItems();i&&i.resetSelection&&R.reset(),p.beginUpdateItems();for(var r=0;r<n.length;++r){if(!1===t(n[r],r,n.length))break}return p.commitUpdateItems(),h.endAction(),n.length};var j;p.updateCursorFromEvent=function(t){if(j){var i=j.target;if(i&&e.isAttachedToDoc(i)){var n=e.getPaneForElement(i);if(n){var r=e.elementFromPoint(j.clientX,j.clientY,j.target);if(r){var a=e.dataFor(r,!0);e.isVMLI(a)||(a=void 0),p.updateCursor(t,n,r,a)}}}}},p.getCursorForClass=function(e,t,i){for(var n=e.classList,r=0;r<n.length;r++){switch(n[r]){case"link":case"date":return u.mac&&t.metaKey||!u.mac&&t.ctrlKey?"cursor-pointer":null}}if(i)return"cursor-pointer"},p.updateCursor=function(i,n,r,a){var s;if(n&&r){if(a&&e.isVMLI(a)){var o=e.findParentInItem(r,"plugin");o&&(r=o)}var c=!!e.findParent(r,"paneOverviewScroller");if(!R.isMouseDown()&&!(s=p.getCursorForClass(r,i,c))){var l=e.findParent(r,"itemInCalendarResizable");if(l){var d=l.getBoundingClientRect();(i.clientY-d.top<t.CalendarResizeHandleHeight||d.bottom-i.clientY<t.CalendarResizeHandleHeight)&&(s="cursor-row-resize")}}}p.cursor.set(s)},u.touch||(p.redoLastMouseMove=function(){var e=j,t=document.elementFromPoint(e.clientX,e.clientY),i={target:t,clientX:e.clientX,clientY:e.clientY};p.mousemove(i,!0)},p.mousemove=function(t,n){if(p.notifyActivity(),(!e.disableMouseMove||t.target)&&(n||!j||t.clientX!==j.clientX||t.clientY!==j.clientY)){var r,a,s,o=e.ensureDOMNode(t.target);if(o)(e.findParent(o,"paneRoot")||e.findParent(o,"paneOverviewScroller"))&&(s=e.getPaneForElement(o))&&(r=e.dataFor(o,!0),e.isVMLI(r)?a=e.getReactCellForElement(o):r=void 0),p.updateCursor(t,s,o,r),R.setHovered(s,r,a),j&&j.target===o||(j&&j.target&&i.fireEvent("mouseout",[{target:j.target}]),o&&i.fireEvent("mouseover",[{clientX:t.clientX,clientY:t.clientY,target:o}])),j={clientX:t.clientX,clientY:t.clientY,target:o};else try{e.PAssert(5407,!o,"Target should be defined",e.getElementPath(t.target))}catch(t){e.reportError(t)}}},e.element("outerWrapper").addEventListener("mousemove",p.mousemove)),p.showHelp=function(t){e.intro.show(t)},p.runAfterWelcome=function(){p.paneManager.createDefaultPane(),e.intro.runTooltipIntro()},p.runFirstRun=function(){u.mobile||(u.isMailbirdSidebar()?setTimeout(function(){p.paneManager.createPaneAtIndex(PaneMode.Outline,void 0,{isDefaultPane:!0})},500):e.menus.openModalNew(Modals.Welcome,{callback:p.runAfterWelcome}))},p.oldUserNewTrial=function(){e.toasts.pushMessage(MessageID.OldUserNewTrial)};var K=void 0,Y=void 0,X=void 0,Q=e.seconds(5);p.notifyActivity=function(){p.lastActivity=Date.now(),X||(X=setTimeout(p.checkLowActivity,2*Q)),p.whenLowImpactEnd()},p.checkLowActivity=function(){Date.now()-p.lastActivity>Q&&p.whenLowImpactBegin(),X=void 0};var J=!1;if(p.whenLowImpactBegin=function(){J||(J=!0,i.fireEvent("lowImpactBegin",[]))},p.whenLowImpactEnd=function(){J&&(i.fireEvent("lowImpactEnd",[]),J=!1)},p.isLowImpact=function(){return J},p.isDemoMode()||(!function(){function t(){u.isPageVisible()?(Y&&(clearTimeout(Y),Y=void 0),p.whenLowImpactEnd()):Y=setTimeout(function(){e.AppCache.checkForUpdate(!1,!0),e.vmMain.pluginManager.writeCaches(),p.whenLowImpactBegin()},5e3)}function i(){Date.now()>p.lastActivity+e.minutes(90)&&e.AppCache.checkForUpdate(!1,!0),K=setTimeout(i,e.minutes(90))}u.pageVisibilityChange&&document.addEventListener(u.pageVisibilityChange,t),!u.mobile&&window.applicationCache&&(K=setTimeout(i,e.minutes(90)))}(),p.checkLowActivity()),p.paneManager.onResize(),e.shouldWriteLocal()){var $="version"+(u.mobile?"Mobile":"Desktop"),Z=+n.storage.getItem($),ee=u[$];if(!e.isFirstRun&&!e.isDemoMode()&&(!Z||ee>Z))for(var te=u.getUpdateMessages(Z),ie=0;ie<te.length;++ie)if(e.isString(te[ie]))e.toasts.pushMessage({text:te[ie],hold:!0,action:MessageAction.Blog});else{try{e.PAssert(5408,e.isFunction(te[ie]),"Must supply a valid getter fn for the message")}catch(t){e.reportError(t)}var ne=te[ie]();ne.isPremiumOnly&&!e.billingManager.hasPremium()||e.toasts.pushMessage({text:ne.text,hold:!0,action:ne.action||MessageAction.Blog,actionText:ne.actionText})}n.storage.setItem($,ee)}u.displayRepeatedOptionalUpdateMessage();return p._updateAllItems=function(){var e=p._forceNotify;p._forceNotify=!1;var t=p._updateSearch;if(p._updateSearch=!1,p._itemsDirty||e){p._itemsDirty=!1,p._isUpdating=!0;p.paneManager.runForEachPane(function(i){if(e||i.isItemsDirty()){i.updateItemsImmediate(t,e)}i.setIgnoreRestoreScroll(!1)}),p._isUpdating=!1}},p._isSearching=!1,p._isUpdating=!1,p._numFlushesInCommit=0,p._isWaitingUpdateItems=0,p._itemsDirty=!1,p._forceNotify=!1,p._updateSearch=!1,p._itemsUpdateWatchdog=void 0,p._lastUpdateItemsStack=void 0,p.isUpdatingItems=function(){return p._isWaitingUpdateItems>0&&p._itemsDirty},p.beginUpdateItems=function(){1===++p._isWaitingUpdateItems&&(p._lastUpdateItemsStack=e.getCurrentStack("Update Items Stack"),p._itemsUpdateWatchdog=setTimeout(d,0))},p.commitUpdateItems=function(t,i){try{e.PAssert(5414,p._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",p._isWaitingUpdateItems)}catch(t){e.reportError(t)}p._isWaitingUpdateItems--,0===p._isWaitingUpdateItems&&(clearTimeout(p._itemsUpdateWatchdog),p._itemsUpdateWatchdog=void 0,p._lastUpdateItemsStack=void 0,p._numFlushesInCommit=0),p._itemsDirty&&p.updateAllItems(t,i)},p.flushItemsUpdate=function(e){p.isUpdatingItems()&&(e?e.isItemsDirty()&&(p._itemsDirty||p._forceNotify)&&(p._numFlushesInCommit++,e.updateItemsImmediate(p._updateSearch,p._forceNotify),e.setIgnoreRestoreScroll(!1)):(p._numFlushesInCommit++,p._updateAllItems()))},p.updateAllItems=function(t,i){try{e.PAssert(5415,void 0===t||e.isBoolean(t),"Must supply a bool param for updateSearch")}catch(t){e.reportError(t)}try{e.PAssert(5416,void 0===i||e.isBoolean(i),"Must supply a bool param for forceNotify")}catch(t){e.reportError(t)}p._itemsDirty=!0,i&&(p._forceNotify=i),t&&(p._updateSearch=t),0===p._isWaitingUpdateItems&&p._updateAllItems()},p.notifySearchStart=function(){p._isSearching=!0},p.notifySearchEnd=function(){p._isSearching=!1},p.getItemAnimationMode=function(){return p._itemAnimationMode},p.setItemAnimationMode=function(e){p._itemAnimationMode=e},p.resetItemAnimationMode=function(){p._itemAnimationMode=t.ItemAnimationMode.Normal},p.getScrollOffset=function(){return p.panesContainer.scrollLeft},p.setScrollOffset=function(t,i){e.scrollTo(t,0,i||ScrollDuration.Default,p.panesContainer)},p.shouldShowHelp=function(t){var i=e.settings.get(Settings.closedHelps);return!i||!i[t]},p.closeHelp=function(t){var i=e.settings.get(Settings.closedHelps)||{};i[t]=!0,e.settings.set(Settings.closedHelps,i)},p.pluginManager.registerPlugins(),p.init(),p};return n.defineBase(q),q}),define("ModalReportBug",["globals","util","platform","ModalBase","Multiselect"],function(e,t,i,n,r){function a(){this._super.constructor.call(this,Modals.ReportBug),this.bugDescription=e.createObservable("","bugDescription","ModalReportBug"),this.shareDocument=e.createObservable(!1,"shareDocument","ModalReportBug"),this.init()}var s={init:function(){this.registerModal(this.onModalOpen.bind(this))},onModalOpen:function(){i.mobile||setTimeout(function(){document.getElementById("bugDescription").focus()}),this.shareDocument(!1)},onTapCancelBug:function(){e.menus.closeModal(this.id),e.blurActiveElement(),i.mobile&&r.reset()},onTapSaveBug:function(){var t=this.bugDescription()||e.element("bugDescription").value;if(t&&t.length>2){var n="Moo.do Feedback";if(this.shareDocument()){var a=e.vmMain.docManager.getOpenDoc();if(a){n+=" [DocShared]",t+="\r\n\r\nShared Document - "+a.id;var s=function(){e.reportError(new Error("Unable to share doc with debug account"))};e.vmMain.remoteAPI().drivePermissionsInsert(a.id,"debug@moo.do",!1,e.emptyFn,s)}}e.sendFeedback(n,t,function(){this.bugDescription("")}.bind(this)),e.menus.closeModal(Modals.ReportBug),e.toasts.pushMessage({text:"Thanks for taking the time to send us feedback!"}),e.sendEvent("Menu","SendFeedback"),e.blurActiveElement(),i.mobile&&r.reset()}},onTapSocialTwitter:function(t){e.openUrl("https://www.twitter.com/MooDoApp",t),e.sendEvent("Menu","FeedbackTwitter")},onTapSocialFacebook:function(t){e.openUrl("https://www.facebook.com/MooDoApp",t),e.sendEvent("Menu","FeedbackFacebook")},onTapSocialGoogle:function(t){e.openUrl("https://www.google.com/+MooDoApp",t),e.sendEvent("Menu","FeedbackGoogle")},onTapSocialUserVoice:function(t){e.openUrl("https://feedback.moo.do/",t),e.sendEvent("Menu","FeedbackUserVoice")}};return t.inherit(n,a),t.extend(a.prototype,s),a}),define("VMDebug",["globals","platform","data","ModalReportBug"],function(e,t,i,n){function r(){this.init()}return r.prototype={init:function(){new n},addPadding:function(){var i=t.windowHeight()-t.getKBSize()+e.topBarHeight;t.android&&(i=t.getKBSize()+20),e.element("feedbackScroller").style.paddingBottom=i+"px"},removePadding:function(){document.getElementById("feedbackScroller").style.paddingBottom=""}},r}),define("VMTimeline",["globals","platform","Dispatcher","util","PluginSettings"],function(e,t,i,n,r){function a(){this.dateKeyCache={},this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduledItems={},this.notifiedItems={},this.scheduleTimeout=void 0,n.forceBind("showHTML5Notification",this),n.forceBind("setupNotifications",this)}return window.__FULL_NOTIFICATION_UPDATES=0,window.__SINGLE_NOTIFICATION_UPDATES=0,a.prototype={clearDailyCaches:function(){this.dateKeyCache={}},addNotification:function(t){try{e.PAssert(5419,t,"Must provide a valid item to schedule notifications for")}catch(t){e.reportError(t)}this.notificationItems[t.id]=t,this.numNotificationItemsChanged++,this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.setupNotifications,500))},removeNotification:function(t){try{e.PAssert(5420,t,"Must provide a valid item to unschedule notifications for")}catch(t){e.reportError(t)}this.notificationItems[t.id]&&(this.notificationItems[t.id]=void 0,this.numNotificationItemsChanged++,this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.setupNotifications,500)))},clearNotifications:function(){for(var e in this.notificationItems)this.notificationItems.hasOwnProperty(e)&&(this.notificationItems[e]=void 0,this.numNotificationItemsChanged++);this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.setupNotifications.bind(this),500))},shouldNotify:function(t,i){i||(i=new Date);var n=t.date();return!e.isDateSoft(t.getDateText())&&!t.isDestroyed()&&!t.isDeleted()&&!t.isComplete()&&!t.hasCompletedAncestor()&&!t.allDayDate()&&!t.isArchived()&&(n&&n>i&&n-Date.now()<864e5||t.repeatDate())},updateNotifications:function(i){if(t.supportsNotifications()&&r.isNotificationsEnabled()&&!e.isDemoMode()){var n=new Date;i?(window.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(i,n)?this.addNotification(i):this.removeNotification(i)):(window.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),e.searchVMLIs({item:e.vmMain.root(),includeArchived:!1,each:function(e){this.shouldNotify(e,n)&&this.addNotification(e)}.bind(this)}))}},setupNotifications:function(){try{e.PAssert(5421,t.supportsNotifications(),"Platform must support notifications")}catch(t){e.reportError(t)}var i=[];for(var n in this.notificationItems)if(this.notificationItems.hasOwnProperty(n)){var r=this.notificationItems[n];if(r&&r.getNotificationEntries){var a=r.getNotificationEntries();if(a)if(e.isArray(a))for(var s=0;s<a.length;++s)i.push(a[s]);else i.push(a)}else delete this.notificationItems[n]}if(t.usesHTML5Notifications()){var o=new Date;for(var c in this.scheduledItems)if(this.scheduledItems.hasOwnProperty(c)){for(var l=!1,s=0;s<i.length;++s)if(i[s].id===c){l=!0;break}l||this.cancelHTML5Notification(c)}for(var d=o.clone().addDays(2),s=0;s<i.length;++s){var h=i[s],u=(new Date(h.alertDate),new Date(h.date));this.notifiedItems[h.id]||this.scheduledItems[h.id]&&this.scheduledItems[h.id].timestamp===u.getTime()||u.isAfter(o)&&u.isBefore(d)&&this.scheduleHTML5Notification(h)}}else e.nativeBridge.isEnabled()?e.nativeBridge.sendToApp("scheduledItems",i):e.nativeBridge.hasEmbedBridge()&&e.nativeBridge.sendToEmbed("scheduledItems",i);this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0},scheduleHTML5Notification:function(t){var i=new Date(t.alertDate),n=new Date(t.date),r=Math.max(i.getTime()-Date.now(),0),a=n.getTime()-Date.now();try{e.PAssert(5422,a>=0,"Should always schedule notifications in the future")}catch(t){e.reportError(t)}this.cancelHTML5Notification(t.id),t.timeout=setTimeout(this.showHTML5Notification.bind(this,t),r),this.scheduledItems[t.id]=t},cancelHTML5Notification:function(e){var t=this.scheduledItems[e];t&&t.timeout&&(clearTimeout(t.timeout),t.timeout=void 0)},showHTML5Notification:function(i){try{e.PAssert(5423,t.supportsHTML5Notifications(),"Must support HTML5 notifications to display them")}catch(t){e.reportError(t)}var n=new Date(i.alertDate),r=new Date(i.date);if(r.isAfter(new Date)){try{e.PAssert(5424,n.isBefore(r),"Alert must always be before actual event")}catch(t){e.reportError(t)}var a=Math.round((r.getTime()-Date.now())/6e4);new Notification(i.text,{body:"in "+a+" minutes",icon:"/img/favicon-96x96.png"})}this.notifiedItems[i.id]=!0}},a}),define("TemplateCache",["ko","globals"],function(e,t){"use strict";window.__TOTAL_TEMPLATES=0;var i={};i.templateSources=function(i){var n={elem:i,__proto__:new e.templateSources.domElement(i)};return n.text=function(e){if(0===arguments.length)return n.elem.text;n.elem.text=e},n.nodes=function(i){try{t.PAssert(5425,0===arguments.length)}catch(e){t.reportError(e)}if(0===arguments.length){var r=e.utils.domData.get(n.elem,"__cached_template__");if(!r){for(var a=n.text().replace(/(\r\n|\n|\r|\s*(?=<)|\s*$)/gm,""),s=e.utils.parseHtmlFragment(a),o=document.createElement("div"),c=0;c<s.length;c++)o.appendChild(s[c]);return e.utils.domData.set(n.elem,"__cached_template__",{cachedNodes:o}),o}return r.cachedNodes}},n},i.templateEngine=function(){var n={__proto__:new e.nativeTemplateEngine};return n.cachedDoc=void 0,n.makeTemplateSource=function(e,r){try{t.PAssert(5426,"string"==typeof e)}catch(e){t.reportError(e)}var a=r||document,s=n.cachedDoc;if(!n.cachedDoc){try{t.PAssert(5427,a)}catch(e){t.reportError(e)}s={doc:a,cachedTemplates:{}},n.cachedDoc=s}try{t.PAssert(5428,s)}catch(e){t.reportError(e)}var o=s.cachedTemplates[e];if(!o){var c=s.doc.getElementById(e);try{t.PAssert(5429,c)}catch(e){t.reportError(e)}if(c)try{o=new i.templateSources(c);try{t.PAssert(5430,o)}catch(e){t.reportError(e)}}catch(e){t.reportError(e)}else t.reportError(new Error('Unable to find element for template "'+e+'". '+c));s.cachedTemplates[e]=o,window.__TOTAL_TEMPLATES++}return o},n};var n=i.templateEngine();return n instanceof e.templateEngine&&e.setTemplateEngine(n),i}),define("VMAutocompleteItem",["data","globals"],function(e,t){function i(e){this.id=e.id,this.text=t.createObservable(e.text||"","text","VMAutocompleteItem"),this.index=e.index,this.object=e.object,this.isVisible=t.createObservable(!0,"isVisible","VMAutocompleteItem"),this.isSelected=t.createObservable(!1,"isSelected","VMAutocompleteItem"),this.element=void 0,this.init()}return i.prototype={init:function(){},html:function(){var e=t.autocomplete.text(),i=this.text();try{t.PAssert(5431,t.isString(e),"Search text must be a string: ",e)}catch(e){t.reportError(e)}try{t.PAssert(5432,t.isString(i),"Item text must be a string: ",i)}catch(e){t.reportError(e)}if(void 0!==i&&void 0!==e&&e.length>0){var n=i.toLowerCase().indexOf(e.toLowerCase());return n>=0?i.substr(0,n)+"<b>"+i.substr(n,e.length)+"</b>"+i.substr(n+e.length):i}return i},onLoad:function(e){this.element=e}},i}),define("VMNoneManager",["globals"],function(e){function t(){}return t.prototype={init:function(){},previewTemplate:function(){},getItemStyledText:function(e){return e},getItemText:function(){},getItemTextLength:function(){return 0},findMatchExact:function(e){},findMatchLike:function(e,t){}},t}),define("VMAutocomplete",["data","globals","Constants","util","goog","platform","tracker","VMAutocompleteItem","AutocompleteDates","VMNoneManager","Sel","NativeSel","Measure","TagManager","DisplaySettings","Hotkeys","MobileUI","Dispatcher","PluginSettings"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m,f,g,v,y){function b(){try{t.PAssert(5433,!t.autocomplete,"Autocomplete is a singleton")}catch(e){t.reportError(e)}t.autocomplete=this,this.isEnabled=!0,this.items=t.createObservableArray([],"items","VMAutocomplete"),this.isVisible=t.createObservable(!1,"isVisible","VMAutocomplete"),this.contactsEnabled=t.createObservable(!0,"contactsEnabled","VMAutocomplete"),this.element=void 0,this.trackingTag=void 0,this._activeOwner=void 0,this.selectedIndex=t.createObservable(-1,"selectedIndex","VMAutocomplete").extend({notify:"always"}),this.exactMatch=t.createObservable(!1,"exactMatch","VMAutocomplete"),this.text=t.createObservable("","text","VMAutocomplete"),this.lastParams=void 0,this.autocompleteDates=new c,this.previousSelectionRect={},this.mode=t.createObservable(void 0,"mode","VMAutocomplete"),this._validProviders=[],this._provider=void 0,this.registerProvider(ACProvider.None,new l),this.registerProvider(ACProvider.Contact,e.contactManager),this.registerProvider(ACProvider.DatePicker,this.autocompleteDates),this.registerProvider(ACProvider.DateList,this.autocompleteDates),this.registerProvider(ACProvider.Tag,p),this._prefixes=[ContactPrefix,DatePrefix,TagPrefix],this._prefixMap={},this._prefixMap[ContactPrefix]=ACProvider.Contact,this._prefixMap[TagPrefix]=ACProvider.Tag,this._prefixMap[DatePrefix]=a.mobile&&a.app?ACProvider.DatePicker:ACProvider.DateList,t.vmMain.pluginManager.runForEachPlugin(function(e){e.registerAutocomplete()}),this.mode(ACProvider.None),n.forceBind("hide",this),this.init()}return b.prototype={showDates:function(){return this.mode()===ACProvider.DatePicker&&(""===this.text()||this.autocompleteDates.nextDateWord())},showList:function(){return!(this.exactMatch()||this.showDates()||this.mode()===ACProvider.Contact&&!this.contactsEnabled())},showPreview:function(){return this.mode()&&this._provider.previewTemplate()&&this.items().length>0&&this.selectedIndex()>=0&&this.selectedItem()&&(!a.mobile||this.exactMatch())},showEnableContactsUI:function(){return this.mode()===ACProvider.Contact&&this.isVisible()&&!this.contactsEnabled()},hasContent:function(){return this.showDates()||this.showList()||this.showPreview()||!this.contactsEnabled()},previewTemplate:function(){try{t.PAssert(5434,this._provider,"Provider must be valid")}catch(e){t.reportError(e)}return this._provider.previewTemplate()},autocompleteWidth:function(){return this.mode()&&this._provider.autocompleteWidth?this._provider.autocompleteWidth()+"px":void 0},selectedItem:function(){try{t.PAssert(5435,this.selectedIndex()>=0,"Should always have a valid selection index")}catch(e){t.reportError(e)}if(!(this.selectedIndex()<0)){try{t.PAssert(5436,void 0!==this.items()[this.selectedIndex()],"Autocomplete should always have valid entries")}catch(e){t.reportError(e)}return this.items()[this.selectedIndex()]}},init:function(){this.onkeydown=this.onkeydown.bind(this),v.listen("closeKeyboard",this.hide.bind(this)),this.element=document.getElementById("autocomplete"),setTimeout(function(){t.applyBindings(this,"autocomplete")}.bind(this),0)},registerProvider:function(e,i){try{t.PAssert(5437,!this._validProviders[e],"Registering a provider that has already been registered")}catch(e){t.reportError(e)}this._validProviders[e]=i},registerPrefix:function(e,i){try{t.PAssert(5438,!this._prefixMap[i],"Should only register a prefix once")}catch(e){t.reportError(e)}this._prefixes.push(i),this._prefixMap[i]=e},setProviderMode:function(e){if(this.mode()!==e){this._provider=this._validProviders[e];try{t.PAssert(5439,this._provider,"Provider must be valid",e)}catch(e){t.reportError(e)}this.clear(),this.mode(e)}},getProviderForPrefix:function(e){return this._prefixMap[e]||ACProvider.None},show:function(e){if(!this.isVisible()){var n=e;if(this.mode()===ACProvider.Contact&&s.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenContact}),this.showList())try{t.PAssert(5441,this.element.children.length>0,"Must always have an items element when showing list")}catch(e){t.reportError(e)}var r=document.documentElement.getBoundingClientRect();if(!a.mobile){var o=u.getCaretScreenPosition(d.getPane(),d.getStartIndex(),d.getStartOffset()),c={left:o.left,top:o.top,right:o.left,bottom:o.top+m.itemLineHeight()+5};if(!(Math.abs(c.top-this.previousSelectionRect.top)>10||!this.isVisible()||e))return;var l={left:c.left,top:c.bottom,bottom:c.bottom+600},p=t.adjustHeightToBeInsideBounds(r,l,100,600,10),v=this.mode()===ACProvider.Contact?550:250;if(l.left=Math.max(10,t.adjustLeftToBeInsideBounds(r,l.left,v,10)),this.showList()){try{t.PAssert(5442,this.element.children.length>0,"Must always have an items element when showing list")}catch(e){t.reportError(e)}this.element.children[0].style.maxHeight=p+"px"}var y="translate("+l.left+"px, "+l.top+"px)";t.isDemoMode()&&window.__AUTOCOMPLETE_SCALE&&(y+=" scale("+window.__AUTOCOMPLETE_SCALE+")"),this.element.style[a.transform.style]=y}if(this.isVisible(!0),a.mobile&&this._activeOwner){var b=0;if(this.mode()===ACProvider.Contact&&e)this.element.style.top="",t.isKeyboardOpen?(this.element.style.paddingBottom="30px",a.android?this.element.style.bottom=a.getKBSize()+"px":this.element.style.bottom=0):(this.element.style.paddingBottom=0,this.element.style.bottom=0);else{var S,E=t.focusedPane,C=E.scrollItemToTop(this._activeOwner,150,a.ios&&function(){h.setSelectionRangeToWhatItAlreadyIs()})||0;if(n)S=n.getBoundingClientRect();else{var P=E.elementAtIndex(this._activeIndex);try{t.PAssert(5443,P,"Element should exist in autocomplete")}catch(e){t.reportError(e)}var T=E.topOfIndex(this._activeIndex)-(E.getScrollOffset()+C)+t.topBarHeight;S={top:T,bottom:T+E.sizeAtIndex(this._activeIndex)}}b=S.bottom,this.element.style.paddingBottom="",this.element.style.top=b+"px",this.element.style.bottom=a.getKBSize()+"px",this.mode()===ACProvider.Contact?g.setTopBarMode(i.TopBarMode.Contact):this.mode()===ACProvider.DatePicker?g.setTopBarMode(i.TopBarMode.Date):this.mode()===ACProvider.Tag&&g.setTopBarMode(i.TopBarMode.Tag)}t.keyboardToolbar.isVisible.set(!1);var D=a.windowHeight()-a.getKBSize()-b;t.setTransform(this.element,0,D),requestAnimationFrame(function(){t.setTransform(this.element,0,0,150,"ease-out")}.bind(this))}this.previousSelectionRect=c,this.__hotkeys=f.pushStackEscape(this.hide),s.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenAutocomplete})}},clear:function(){this.items.removeAll(),this.selectedIndex(-1),this.trackingTag=!1},hide:function(){if(this.isVisible()){if(a.mobile){var e=a.windowHeight()-a.getKBSize();t.setTransform(this.element,0,e,200,"ease-out"),setTimeout(function(){this.selectedIndex(-1),this.isVisible(!1),t.isKeyboardOpen&&t.keyboardToolbar.isVisible.set(!0),this.clear(),g.resetTopBarMode()}.bind(this),200)}else this.selectedIndex(-1),this.isVisible(!1);f.popStack(this.__hotkeys),this.__hotkeys=void 0,s.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseAutocomplete})}},onkeydown:function(e){if(!this.isEnabled)return!0;if(0===this.items().length||!this.isVisible()||this.exactMatch()&&e.normCode!==KeyCode.Escape)return!0;if(e.normCode===KeyCode.UpArrow||e.normCode===KeyCode.DownArrow){if(this.items().length>1){var i=this.selectedIndex()+(e.normCode===KeyCode.DownArrow?1:-1);i<0?this.selectedIndex(this.items().length+i):i>=this.items().length?this.selectedIndex(i%this.items().length):this.selectedIndex(i);var n=document.getElementById("autocompleteItems");return t.scrollIntoView(n.children[this.selectedIndex()],200),!1}this.hide()}else{if(e.normCode===KeyCode.Enter){if(this.selectedIndex()>=0){var r=this.items()[this.selectedIndex()];this.onTapped(this._provider.getItemText(r),this._provider.getItemTextLength(r),!0)}return this.hide(),!1}if(e.normCode===KeyCode.Escape)return this.hide(),!1}return!0},onTap:{onClick:function(e){var i=t.dataFor(e.target);i&&i!==this&&this.onTapped(this._provider.getItemText(i),this._provider.getItemTextLength(i),!0),a.mobile&&t.handlerPreventStop(e)}},onTapped:function(e,i,n,r){try{t.PAssert(5444,!e||t.isString(e),"Text must be a valid string",e)}catch(e){t.reportError(e)}try{t.PAssert(5445,i,t.isNumber(i),"TextLength must be a valid number",i)}catch(e){t.reportError(e)}try{t.PAssert(5446,void 0===n||t.isBoolean(n),"Hide must be a boolean value",n)}catch(e){t.reportError(e)}if(this.trackingTag&&(this.text(e),this._activeOwner)){var a=r?e:e+" ";this._activeOwner.onAutocompleteTapped(a,a.length,this.trackingTag)}n&&this.hide()},find:function(e,i,n,r){if(!(i+n>e.length-1||this.mode()===ACProvider.None||""===e[i]&&""===e[i+1])){try{t.PAssert(5447,this._provider,"Must have a valid AC provider in use")}catch(e){t.reportError(e)}var a=e[i];isNaN(n)&&(n=0);for(var s=0;s<n&&e[i+s+1];s++)a+=" "+e[i+s+1];r&&void 0!==e[i+n+1]&&(a+=" ");var o=this._provider.findMatchLike(a,22);return o.length>0?this.find(e,i,n+1,r)||{text:a,results:o}:void 0}},setItems:function(e){this.selectedIndex()>=e.length&&this.selectedIndex(0),this.items(e)},checkPrefixes:function(e){for(var t=0;t<this._prefixes.length;t++)if(e.startsWith(this._prefixes[t]))return this._prefixes[t].length},getAutocompleteInfo:function(e,t){for(var i,n=ACProvider.None,r=0,a=-1,s=-1,o=0,c=0;c<e.length&&r<=t;++c){var l=e[c],d=this.checkPrefixes(l);d&&(a=c,s=r,o=d),r+=l.length+1}return a>=0&&(i=e[a].substr(0,o),n=this.getProviderForPrefix(i),e[a]=e[a].substr(o)),{startWord:a,startChar:s,provider:n,prefix:i,prefixLength:o}},update:function(e){if(!this.isEnabled)return!0;try{t.PAssert(5448,e,"Params must be passed in")}catch(e){t.reportError(e)}this.lastParams=e,this._activeOwner=e.owner||this._activeOwner,this._activeIndex=e.index;var i=this._activeOwner.getACText()||"",n=e.start,r=e.fromArrows;this.trackingTag=!1;var s,o=i.split(" "),c=i[e.start-1],l=" "===c;if(s=this._activeOwner.getAutocompleteInfo?this._activeOwner.getAutocompleteInfo(o,n):this.getAutocompleteInfo(o,n),this.setProviderMode(s.provider),s.provider!==ACProvider.None&&("#"!==s.prefix&&"+"!==s.prefix||!(e.start<=1))){try{t.PAssert(5449,n>=s.startChar,"Start of autocomplete word must be before selection start")}catch(e){t.reportError(e)}var d=this.find(o,s.startWord,0,l),h=s.prefixLength;" "===c&&i[e.start-2]!==s.prefix&&h++;var u=!1,p=d&&s.startChar+h+d.text.length;if(d&&n>s.startChar&&p>=n){var m=this._provider.findMatchExact(d.text);this.exactMatch(!!m),this.selectedIndex(0),m?" "!==c&&this.mode()===ACProvider.Contact&&p!==n&&(this.setItems([m]),this.trackingTag=!0,r||a.mobile||(u=!0)):1===d.results.length&&d.results[0]===d.text||(this.trackingTag={text:d.text,index:s.startChar+s.prefixLength,replaceLength:this._provider.autocompleteReplace?s.prefixLength:0,length:d.text.length},this.text(d.text),this.setItems(d.results),r||(u=!0))}else if(!(d||this.mode()!==ACProvider.Contact||t.settings.get(Settings.syncContacts)||r||t.isDemoMode())){for(var f=!1,g=s.startChar;g<n;++g)if(" "===i[g]){f=!0;break}f||(this.trackingTag=void 0,this.contactsEnabled(!1),u=!0)}u&&this.show()}if(this.autocompleteDates.nextDateWord(this.autocompleteDates.NextWordOptions.None),!1===this.trackingTag){try{t.PAssert(5450,!u,"Should never show then hide autocomplete in the same call")}catch(e){t.reportError(e)}this.hide()}},isItemSelected:function(e){return this.selectedIndex()===e()},renderItem:function(e){var i=this.text(),n=this._provider.getItemStyledText(e,i);if(void 0!==n&&void 0!==i&&i.length>0){var r;t.isString(n)?r=n.toUpperCase().indexOf(i.toUpperCase()):(r=n.index,n=n.text);return r>=0?n.substr(0,r)+"<b>"+n.substr(r,i.length)+"</b>"+n.substr(r+i.length):n}return t.isString(n)?n:n?n.text:void 0},onMouseover:function(e,i){if(this.showList()){var n=0,r=i.target,a=t.dataFor(r);if(a&&a!==this){n=this.items.indexOf(a);try{t.PAssert(5451,n>=0,"Must be able to compute a valid selection index")}catch(e){t.reportError(e)}this.selectedIndex(n)}}},onTapEnableContacts:{onClick:function(e){y.enableSyncContacts(function(e){if(e){this.contactsEnabled(!0),t.settings.set(Settings.syncContacts,!0);this.lastParams&&(this.update(this.lastParams),this.show(this.completionElement))}}.bind(this)),e.preventDefault(),e.stopImmediatePropagation()}}},b}),define("VMTooltip",["require","Constants","globals","platform","DragDrop","Sel","Observable","ObservableArray","Dispatcher"],function(e){function t(){this.tooltip=new o,this.tooltipsSticky=new c,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,this.arrowClass=n.createObservable("hidden","arrowClass","VMTooltip"),this.init()}var i=e("Constants"),n=e("globals"),r=e("platform"),a=e("DragDrop"),s=e("Sel"),o=e("Observable"),c=e("ObservableArray"),l=e("Dispatcher"),d=i.TooltipDelay;return t.prototype={init:function(){r.touch||(l.listen("mouseover",this.handleEleOver.bind(this)),l.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))},windowOut:function(e){(e.pageX>r.windowWidth()||e.pageY>r.windowHeight()||e.pageX<0||e.pageY<0)&&this.hideTip()},register:function(e,t){this.update(e,t)},update:function(e,t){e.setAttribute("tooltip",t)},displayTip:function(e){try{n.PAssert(5452,e,"When display a tooltip, must pass in some info")}catch(e){n.reportError(e)}clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var t=this.displayElement=e.element;if(e&&t&&t.offsetWidth>0&&t.offsetHeight>0){var i=e.text;this.isSticky=e.sticky;try{n.PAssert(5453,i,"When display a tooltip, elements should always have valid data set")}catch(e){n.reportError(e)}if(i){var r={text:i,hotkey:e.hotkey,element:t,blue:e.blue,sticky:e.sticky,maxWidth:e.maxWidth,onRight:e.onRight,arrowClass:e.arrowDirection||"hidden"};e.sticky?this.tooltipsSticky.push(r):this.tooltip.set(r)}}},tipOut:function(e){var t=!0;e.target&&(t=n.isAttachedToDoc(e.target)&&!n.findParent(e.target,"tooltip")),t&&this.hideTip()},getAttr:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltip")||e.getAttribute("data-tooltip"))},getAttrHotkey:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltipHotkey")||e.getAttribute("data-tooltipHotkey"))},handleEleOver:function(e){try{n.PAssert(5454,n.isDOMNode(e.target),"Must have a valid DOM node: ",typeof e.target)}catch(e){n.reportError(e)}if(e.target){var t,i,r;if((t=this.getAttr(e.target))?r=e.target:(t=this.getAttr(e.target.parentElement))&&(r=e.target.parentElement),i=this.getAttrHotkey(r),t&&this.displayElement!==r&&!a.isDragging&&!s.isMouseDown()){var o={y:5};clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),d,{element:r,offset:o,text:t,hotkey:i})}}},handleEleOut:function(e){this.tipOut(e)},isOpenSticky:function(){return this.tooltipsSticky.get().length>0},hideSticky:function(e){for(var t=this.tooltipsSticky.get(),i=0;i<t.length;i++)if(t[i].text===e){this.tooltipsSticky.removeAt(i);break}},hideTip:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}},t}),define("AppCache",["globals","platform"],function(e,t){function i(){
this.updateWaitTime=e.minutes(120),this.notifiedOfNew=!1,this.isFinished=!1,this.downloadingTimeout=0,this.lastUpdate=0,this.startStatus=window.applicationCache?window.applicationCache.status:-2,this.continuedUpdate=!1,this.updateActionDone=!1,this.fnToRun=[],this.requiredUpdate=!1,this.appUpdatePending=!1,this.runUpdate=!1,this.init()}return i.prototype={init:function(){log("Cache Status: "+this.startStatus),window.applicationCache?(window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()):this.onCacheLoadFinished()},isVisible:function(t){t&&e.isDemoMode()&&e.reload(!0)},update:function(){if(Date.now()-this.lastUpdate>this.updateWaitTime&&window.applicationCache&&window.applicationCache.status===window.applicationCache.IDLE){this.lastUpdate=Date.now();try{window.applicationCache.update()}catch(e){}}},checkForUpdate:function(t,i){this.requiredUpdate=!!t,this.runUpdate=!!i,this.appUpdatePending?this.appUpdatePending&&this.runUpdate&&e.reload(!0):this.update()},endRunUpdate:function(){this.runUpdate=!1},runOnFinish:function(t){try{e.PAssert(5455,0===this.fnToRun.length,"Only a single callback is allowed to be run at this point.")}catch(t){e.reportError(t)}this.isFinished?setTimeout(t,0):this.fnToRun.push(t)},onUpdateReady:function(){log("Cache: New version available"),this.appUpdatePending=!0,this.startStatus===window.applicationCache.UNCACHED&&log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction()},onFirstUpdateReady:function(){log("Cache: first update")},onUpdateError:function(i){t.demo||e.vmMain&&!e.vmMain.isOnline()||(log("Update Error: ",i),"quota"===i.reason&&e.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"})),this.isVisible(!1),this.onCacheLoadFinished()},onUpdateDownloading:function(){log("Cache: New version downloading")},onCacheLoadFinished:function(){if(log("Cache: No update"),!this.isFinished){this.isFinished=!0;for(var e=0;e<this.fnToRun.length;++e)this.fnToRun[e]()}},notifyOfUpdate:function(){this.notifiedOfNew||(this.notifiedOfNew=!0,e.setAppCacheUpdateState(!0),this.startStatus!==window.applicationCache.UNCACHED&&this.isVisible(!0))},updateAction:function(){this.runUpdate||!t.isPageVisible()?e.reload(!0):this.requiredUpdate?e.menus.alert({text:"A software update is required to continue. Please reload to update.",actionText:"RELOAD",callback:e.reload}):this.isVisible(!0),e.sendEvent("AppCache","Update")}},i}),define("NativeAPI",["globals","util"],function(e,t){function i(t){try{e.PAssert(5456,void 0===window.__MoodoBridge[t],"Registering an Inbound API that already exists on the window object",t)}catch(t){e.reportError(t)}this._name=t,this._publicObj={},this._privateObj={},window.__MoodoBridge[t]=this._publicObj,this.init()}return i.prototype={init:function(){},_createWrapper:function(t){function i(){try{return t.apply(this,arguments)}catch(t){e.reportError(t)}}return i},registerFunction:function(t,i,n){try{e.PAssert(5457,t,"Name must be provided to register function")}catch(t){e.reportError(t)}try{e.PAssert(5458,i,"A valid function must be provided to register")}catch(t){e.reportError(t)}try{e.PAssert(5459,void 0===this._privateObj[t],"Re-registering an api function on private obj",t)}catch(t){e.reportError(t)}try{e.PAssert(5460,void 0===this._publicObj[t],"Re-registering an api function on public obj",t)}catch(t){e.reportError(t)}this._privateObj[t]=i.bind(this._privateObj),n&&(this._publicObj[t]=this._createWrapper(this._privateObj[t]))},registerVariable:function(t,i,n){try{e.PAssert(5461,t,"Name must be provided to register variable")}catch(t){e.reportError(t)}try{e.PAssert(5462,!n,"Public variables are not currently supported")}catch(t){e.reportError(t)}try{e.PAssert(5463,void 0===this._privateObj[t],"Re-registering an api variable on private obj")}catch(t){e.reportError(t)}try{e.PAssert(5464,void 0===this._publicObj[t],"Re-registering an api variable on public obj")}catch(t){e.reportError(t)}this._privateObj[t]=i}},t.defineBase(i),i}),define("NativeOutAPI",["globals","util"],function(e,t){function i(e){this._name=e,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}return i.prototype={init:function(){e.isObject(window[this._name])?this.onAPILoaded():(t.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){try{e.PAssert(5465,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(t){e.reportError(t)}e.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){this._apiLoaded=!0;for(var t=0;t<this._requiredFns.length;++t)e.isFunction(window[this._name][name])||(this._apiError=!0,this._addMissingFn(name));this.notifyListeners()},requestNotification:function(e){this._apiLoaded?setTimeout(e,0):this._listeners?this._listeners.push(e):this._listeners=[e]},notifyListeners:function(){try{e.PAssert(5466,this._apiLoaded,"API must be loaded to notify listeners")}catch(t){e.reportError(t)}if(this._listeners)for(var t=0;t<this._listeners.length;++t)this._listeners[t]();this._listeners=void 0},requireFunction:function(t,i){try{e.PAssert(5467,this._requiredFns.indexOf(t)<0,"Should not double require a single function")}catch(t){e.reportError(t)}this._requiredFns.push(t),this._apiLoaded&&(e.isFunction(window[this._name][t])||i||(this._apiError=!0,this._addMissingFn(t)))},_addMissingFn:function(t){if(this._missingFns){try{e.PAssert(5468,this._missingFns.indexOf(t)<0,"Should not be missing the same function multiple times")}catch(t){e.reportError(t)}this._missingFns.push(t)}else this._missingFns=[t]},hasOptionalFunction:function(t){try{e.PAssert(5469,this._requiredFns.indexOf(t)>=0,"Must be querying for a registered function")}catch(t){e.reportError(t)}return!!window[this._name]&&!!window[this._name][t]},call:function(t){try{e.PAssert(5470,this._apiLoaded,"Trying to call an API function before it is loaded",t)}catch(t){e.reportError(t)}if(this._apiLoaded){var i=Array.prototype.slice.call(arguments,1);try{return window[this._name][t].apply(window[this._name],i)}catch(t){e.reportError(t)}}}},t.defineBase(i),i}),define("NativeBridge",["globals","platform","Constants","tracker","goog","gdata","edit","NativeAPI","NativeOutAPI","Dispatcher","Multiselect","DesktopUI"],function(e,t,i,n,r,a,s,o,c,l,d,h){function u(){if(t.app)try{this.backlog=[],this._iOS7Queue=[],this._iOS7QueueTimeout=void 0,this.flushingBacklog=!1,this.isPokingBackground=!1,this.setupFns=[],this.setupFns[AppPlatform.iOS]=this.setupiOS.bind(this),this.setupFns[AppPlatform.Android]=this.setupAndroid.bind(this),this.setupFns[AppPlatform.WinPhone]=void 0,this.setupFns[AppPlatform.Chrome]=this.setupChrome.bind(this),this.setupFns[AppPlatform.Electron]=this.setupElectron.bind(this),this.sendFns=[],this.sendFns[AppPlatform.iOS]=this.sendToAppiOS.bind(this),this.sendFns[AppPlatform.Android]=this.sendToAppAndroid.bind(this),this.sendFns[AppPlatform.WinPhone]=void 0,this.sendFns[AppPlatform.Chrome]=this.sendToAppChrome.bind(this),this.sendFns[AppPlatform.Electron]=this.sendToAppElectron.bind(this),this.setupFn=this.setupFns[t.appPlatform],this.sendFn=this.sendFns[t.appPlatform],this.init(),this._isEnabled=!0}catch(t){log("Native API Bridge Disabled"),e.reportError(t)}else this._isEnabled=!1;if(this._embedBridge=void 0,t.app||t.embed){try{e.PAssert(5471,void 0===window.__MoodoBridge,"Must not have a previous bridge in place")}catch(t){e.reportError(t)}window.__MoodoBridge={},this._canRegisterAPIs=!0,this._inboundAPIs={},this._outboundAPIs={}}}return u.prototype={init:function(){try{e.PAssert(5472,this.setupFn,"Must have a valid setup function")}catch(t){e.reportError(t)}try{e.PAssert(5473,this.sendFn,"Must have a valid send function")}catch(t){e.reportError(t)}this.setupFn&&this.sendFn&&(this.initAppEvents(),this.setupFn(),this.backlog=e.nativeBacklog,this.flushBacklog(),t.isFeatureEnabled(i.Feature.OAuth)&&r.addOAuthMethod(OAuthSchemeType.Native),window.__testNative=function(e,t){log("Sending To App: "+e),this.nativeBridge.sendToApp(e,t)}.bind(this))},isEnabled:function(){return this._isEnabled},flushBacklog:function(){this.flushingBacklog=!0;for(var e=0;e<this.backlog.length;++e){var t=this.backlog[e];this.sendToApp(t.method,t.data)}this.flushingBacklog=!1},addToBacklog:function(t,i){try{e.PAssert(5474,!this.flushingBacklog,"Should never be adding to backload while flushing it")}catch(t){e.reportError(t)}this.flushingBacklog||this.backlog.push({method:t,data:i})},registerEmbedBridge:function(i){try{e.PAssert(5475,i,"Must supply a valid embed bridge")}catch(t){e.reportError(t)}try{e.PAssert(5476,t.embed,"Must be embedded")}catch(t){e.reportError(t)}this._embedBridge=i},hasEmbedBridge:function(){return!!this._embedBridge},sendToEmbed:function(t,i){try{e.PAssert(5477,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",t)}catch(t){e.reportError(t)}this._embedBridge.handleEmbedMessage(t,i)},registerInboundAPI:function(t){try{e.PAssert(5478,!this._inboundAPIs[t],"Should not have already registered an outbound API with this name")}catch(t){e.reportError(t)}if(this._canRegisterAPIs){var i=new o(t);return this._inboundAPIs[t]=i,i}},registerOutboundAPI:function(t){try{e.PAssert(5479,!this._outboundAPIs[t],"Should not have already registered an outbound API with this name")}catch(t){e.reportError(t)}if(this._canRegisterAPIs){var i=new c(t);return this._outboundAPIs[t]=i,i}},initAppEvents:function(){window.appEvents=this.appEvents,window.reportLowMemory=this.appEvents.reportLowMemory,window._SENDJSMESSAGE_=this.handleNativeMessage},setupChrome:function(){window.addEventListener("message",this.onChromeMessage.bind(this))},setupAndroid:function(){},setupiOS:function(){this.setupiOSUI(),a.registerSaveNotify(this.onSaveChange.bind(this))},setupiOSUI:function(){this.iframeApp=document.createElement("IFRAME"),this.iframeApp.setAttribute("height","1px"),this.iframeApp.setAttribute("width","1px"),this.iframeApp.id="appComm",document.documentElement.appendChild(this.iframeApp)},setupElectron:function(){this.ipcBridge=electronRequire("electron").ipcRenderer,this.ipcBridge.on("appEvents",function(e,t){this.handleNativeMessage(t.action,t.data)}.bind(this))},onSaveChange:function(e){this.isPokingBackground&&(this.sendToApp("pokeChanged",e>0?"true":"false"),this.isPokingBakground=!1)},onChromeMessage:function(t){if(0===t.origin.indexOf("chrome"))if(this.appWindow&&this.appOrigin||(this.appWindow=event.source,this.appOrigin=event.origin,setTimeout(this.flushBacklog.bind(this),0)),t.data&&e.isString(t.data)){var i=t.data.indexOf(":"),n=t.data.substr(0,i),r=t.data.substr(i+1);switch(n){case"chrome":switch(log("Chrome Message: ",n,"->",r),r){case"start":this.sendToApp("loaded");break;default:log("Unhandled Chrome Message: ",r)}break;default:this.handleNativeMessage(n,r)}}else log("Invalid Chrome Message: ",t.data)},sendToApp:function(i,n){try{e.PAssert(5480,t.app,"Only use native bridge when creating an app")}catch(t){e.reportError(t)}try{e.PAssert(5481,this.sendFn,"Must have a valid send method for the native bridge")}catch(t){e.reportError(t)}var r=!1;try{var a;n&&(a=e.isString(n)?n:JSON.stringify(n)),this.sendFn&&(this.sendFn(i,a),r=!0)}catch(t){e.reportError(t)}return r},sendToAppiOS:function(e,i){t.ioswk?this.sendToAppiOS8(e,i):this.sendToAppiOS7(e,i)},sendToAppiOS7:function(e,t){if(this.iframeApp){var i="duchess://"+e;void 0!==t&&(i+="//"+t),this._addiOS7Queue(i)}else this.addToBacklog(e,t)},_addiOS7Queue:function(e){this._iOS7Queue.push(e),this._iOS7QueueTimeout||(this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue.bind(this),17))},_pumpiOS7Queue:function(){var t=this._iOS7Queue.shift();try{e.PAssert(5482,t,"Must have a valid href",t)}catch(t){e.reportError(t)}this.iframeApp.src=t,this._iOS7Queue.length>0?this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue.bind(this),17):this._iOS7QueueTimeout=void 0},sendToAppiOS8:function(e,t){if(window.webkit.messageHandlers&&window.webkit.messageHandlers.MoodoEvents){var i=e;void 0!==t&&(i+="//"+t),window.webkit.messageHandlers.MoodoEvents.postMessage(i)}else this.addToBacklog(e,t)},sendToAppAndroid:function(e,t){window.AppInterface&&void 0!==window.AppInterface.sendAppMessage&&null!==window.AppInterface.sendAppMessage?window.AppInterface.sendAppMessage(e,t):this.addToBacklog(e,t)},sendToAppChrome:function(e,t){if(this.appWindow){var i=e+":";void 0!==t&&(i+=t),this.appWindow.postMessage(i,"*")}else this.addToBacklog(e,t)},sendToAppElectron:function(e,t){if(this.ipcBridge){var i=e+":";void 0!==t&&(i+=t),this.ipcBridge.send("moodo-message",i)}else this.addToBacklog(e,t)},handleNativeMessage:function(t,i){try{window.appEvents[t]?window.appEvents[t](i):t.startsWith("-")||e.reportError(new Error("Calling invalid JS method from native: "+t))}catch(t){e.reportError(t)}},appEvents:{undo:function(){log("Native Undo"),e.sendEvent("Hotkey","ShakeUndo"),n.undoAction()},redo:function(){log("Native Redo"),e.sendEvent("Hotkey","ShakeRedo"),n.redoAction()},selectAll:function(){e.focusedPane&&s.handleSelectAll(e.focusedPane)},kbsize:function(i){i>0&&+i!==t.getKBSize()&&(t.setKBSize(i),e.keyboardToolbar&&e.keyboardToolbar.updatePosition())},closeKeyboard:function(){!t.mobile||e.menus&&e.menus.isModalOpen(Modals.EmailCompose)||(e.closeKeyboard(),d.reset())},enterBackground:function(){e.AppCache&&e.AppCache.checkForUpdate(!1,!0),e.onunload()},enterForeground:function(){a.poke(),e.checkForRemoteChanges(),e.AppCache&&e.AppCache.endRunUpdate(),l.fireEvent("enterForeground",[])},backButtonPressed:function(){e.fireKeyEvent(document.documentElement,{normCode:KeyCode.Escape})},quickAddItems:function(t){try{for(var i=t.replace(/\r/g," ").replace(/\n/g," "),n=JSON.parse(i),r=0;r<n.length;++r){var a=n[r];log("Quick Add Item: ",a),e.vmMain.dropBucket.addTextEntry(a.key,a.value),e.vmMain.dropBucket.persistTextEntry(a.key)}e.nativeBridge.sendToApp("quickAddConsumed",[])}catch(i){e.reportError(i,t)}},pokeBackground:function(){e.nativeBridge.isPokingBackground=!0,a.poke()},reportLowMemory:function(t){e.handleLowMemory(t)},statusBarTap:function(){e.focusedPane&&e.focusedPane.setScrollOffset(0,ScrollDuration.Default)},features:function(n){try{var a=JSON.parse(n);a.oauth&&(t._enableFeature(i.Feature.OAuth),r.addOAuthMethod(OAuthSchemeType.Native)),a.version&&t.recordAppSubVersion(a.version),!1===a.notifications&&t.disallowNativeNotifications()}catch(t){e.reportError(t)}},notifyOAuth:function(t){try{e.isString(t)&&(t=JSON.parse(t)),r.handleNativeOAuthResponse(t)}catch(t){e.reportError(t)}},onMenuClick:function(t){if("NewMessage"===t||"NewEmail"===t){var i=e.vmMain.getDefaultEmailPlugin();i.isEnabled()?e.menus.openComposeEmail(i):e.toasts.pushMessage(MessageID.NeedGmailPermission)}else if("NewPane"===t){var n=e.element("addPaneButton");e.menus.openContextMenuReact({componentName:"ReactContextMenuAddPane",element:n})}else if("NewItem"===t){var n=e.element("newItemButton");e.menus.openSidebarMenu(n,{componentName:"ReactItemDetailsPopup",addOnSave:!0})}else"Preferences"===t?e.menus.openSettings():"DisplaySettings"===t?e.menus.openDisplaySettings():"ToggleSidebar"===t?h.toggleSidebar():e.reportError(new Error("Unknown Native Menu Click: "+t))},reportError:function(t){e.reportError(new Error("Native Error: "+t))},downloadProgress:function(t){e.handleNativeDownloadProgress(t)}}},u}),define("BillingManager",["globals","Constants","util","platform","International","goog","gdata","Observable","ObservableComputed","ObservableArray","Trigger","AccountManager","DisplaySettings","react","ReactInviteSection"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m){function f(){this._premiumStatus=new o(PremiumStatus.Unknown),v&&this._premiumStatus.set(PremiumStatus.Active),this.hasPremiumFeaturesObservable=new c([this._premiumStatus],function(){return this.hasPremiumFeatures()}.bind(this)),this._lastSignupError=-1,this._earlyAdopter=!1,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._referralCount=new o(0),this._usedReferrals=0,this._nextMonthReferrals=0,this._nonReferralDiscounts=0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._pricingSelected=t.Pricing.None,this._billingIdentifier=void 0,this._hasValidBillingData=new o(!1),this.daysLeftInTrial=new o(-1),this.communityBlocks=[],this.alreadyBlocks=[],this.thisBlocks=[],this.nextBlocks=[],this.triggerBlocksUpdated=new d,this.inviteCodeError=new o,this.inviteEmailError=new o,this.inviteEmailSuccess=new o,this.init()}var g=["4.95","49.95","5","49"],v=n.demo;return f.prototype={init:function(){if(this._premiumStatus.listen(function(t,i){e.vmMain&&e.vmMain.pluginManager&&(this.hasPremiumFeatures()?(e.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.EarlyAccess),e.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.PremiumSub)):this.hasEarlyAccess()&&e.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.EarlyAccess)),t!==i&&i&&u.onSettingChanged()}.bind(this)),this._referralCount.listen(function(t){e.vmMain&&e.vmMain.pluginManager&&t>=5&&e.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.EarlyAccess)}.bind(this)),v)setTimeout(function(){h.setConnected()},1500);else{var n=e.settings.get(Settings.premiumStatus),r=i.getURLParam("premium");if(void 0!==r&&i.removeURLParam("premium",!0),void 0!==n){var a=e.settings.get(Settings.trialStart)||Date.now(),s=e.settings.get(Settings.trialDuration)||0,o=e.settings.get(Settings.trialExtended)||!1;this._updateTrialDaysLeft(a,s,o);var c=e.settings.get(Settings.premiumEndDate)||Date.now();this._premiumEndDate=new Date(c),this.setPremiumStatus(n),r&&setTimeout(function(){e.menus.openSettings(t.SettingsSections.Account)},100)}this.checkRemotePremiumStatus()}},runServerPing:function(i){e.XHR_PrivateAPI({type:"POST",path:"/user/ping",data:{platformConfig:n.getUserPlatformConfig()},requireAuth:!0,cb:function(e){e.status!==t.HTTPStatusCode.Success&&log("Failed to notify server of lastSeen: ",e.status,e.response),i&&i()}.bind(this)})},checkRemotePremiumStatus:function(){try{e.PAssert(5483,!e.isDemoMode()||!1,"Should not be querying for premium status in demo mode")}catch(t){e.reportError(t)}h.setConnecting(),h.onUserAuthorized("me",function(){var r=this.getBillingIdentifier(),s={email:r,gid:h.getDefaultGID(),lastTaskSync:e.settings.get(Settings.lastTaskSync),lastQuickAddSync:e.settings.get(Settings.lastQuickAddSync),clientVersion:window.__jsVersion,platformConfig:n.getUserPlatformConfig()};e.XHR_PrivateAPI({type:"POST",path:"/billing/getStatus",data:s,requireAuth:!0,autoRetry:!0,maxRetries:6,cb:function(n){var s=i.hasURLParam("invite"),o=!1;if(h.setNotConnecting(),n.status===t.HTTPStatusCode.Success&&n.response)try{h.setConnected();var c=JSON.parse(n.response).data;if(this.setBillingData(c),c.linkedAccounts)for(var l=0;l<c.linkedAccounts.length;++l)try{var d=c.linkedAccounts[l],u=PrivateAPIErrorCodes.Success;d.token||(u=PrivateAPIErrorCodes.TokenMissing),h.updateServerLinkedAccount(d.email,d.gid,d.name,d.scopes,d.token,u)}catch(t){e.reportError(t)}if(h.isAccountValidLinked(r)?h.notifyRemoteAccountsLinked():(log("Missing account token: ",r),a.ensureScopeAccess(function(t){try{e.PAssert(5484,t,"Must always be able to receive permission for unknown scopes")}catch(t){e.reportError(t)}h.notifyRemoteAccountsLinked()})),c.tasks&&e.vmMain.deferredTaskManager.notifyRemoteTasks(c.tasks),c.quickAddItems&&e.vmMain.dropBucket.notifyRemoteItems(c.quickAddItems),window.__GLOBAL_CLOCK||e.vmMain.recurringTaskManager.hasRecurringTask("ServerPing")||e.vmMain.recurringTaskManager.createRecurringTask("ServerPing",{delay:e.hours(24),minDelay:e.hours(24),runOnCreate:!1,pauseWhileIdle:!1,minDelayOnResume:!1,async:!0,task:this.runServerPing.bind(this)}),s){o=!0,e.sendEvent("Billing","URLReferralCode");var p=i.getURLParam("invite");e.XHR_PrivateAPI({type:"POST",path:"/sharing/setReferral",data:{email:this.getBillingIdentifier(),refCode:p},requireAuth:!0,autoRetry:!0,cb:function(n){if(n.status===t.HTTPStatusCode.Success){switch(e.toasts.clearMessage(MessageID.InviteFailure),e.toasts.clearMessage(MessageID.InviteInvalid),p.toUpperCase()){case"PRODUCTHUNT":e.toasts.pushMessage({text:"You have successfully applied your ProductHunt promotion. Thanks for checking out Moo.do!"});break;default:e.toasts.pushMessage(MessageID.InviteSuccess)}i.removeURLParam("invite",!0),this.checkRemotePremiumStatus()}else try{var r=JSON.parse(n.response).data;["PRODUCTHUNT","UMICHEDU"].indexOf(p.toUpperCase())<0&&(r.code===PrivateAPIErrorCodes.InvalidReferralCode||r.code===PrivateAPIErrorCodes.InvalidParameter?e.toasts.pushMessage(MessageID.InviteInvalid):e.toasts.pushMessage(MessageID.InviteFailure))}catch(t){e.reportError(t)}}.bind(this)})}if(e.isFlagSet(c.loginFlags,t.LoginFlags.TrialAutoReset)&&e.toasts.pushMessage({text:"Your premium trial was reset. Please visit your account settings to learn more.",action:MessageAction.OpenSettings}),c.premiumStatus===PremiumStatus.Trial){try{e.PAssert(5485,void 0!==c.trialStart,"Must have a valid trialStart set")}catch(t){e.reportError(t)}try{e.PAssert(5486,void 0!==c.trialDuration,"Must have a valid trialDuration set")}catch(t){e.reportError(t)}if(c.trialStart&&c.trialDuration)try{var m=new Date(c.trialStart).getTime();e.settings.set(Settings.trialStart,m),e.settings.set(Settings.trialDuration,c.trialDuration),e.settings.set(Settings.trialExtended,c.trialExtended),this._updateTrialDaysLeft(m,c.trialDuration,c.trialExtended)}catch(t){e.reportError(t)}else this.setPremiumStatus(PremiumStatus.TrialOver),e.settings.set(Settings.trialStart,Date.now()),e.settings.set(Settings.trialDuration,0);e.isFlagSet(c.loginFlags,t.LoginFlags.OldUserNewTrial)&&e.vmMain.oldUserNewTrial()}else if(c.premiumStatus===PremiumStatus.CanceledUser||c.premiumStatus===PremiumStatus.CanceledPastDue)if(c.premiumEndDate)try{var f=new Date(c.premiumEndDate).getTime();e.settings.set(Settings.premiumEndDate,f)}catch(t){e.reportError(t)}else e.settings.set(Settings.premiumEndDate,Date.now());else c.premiumStatus===PremiumStatus.TrialOver?(this.daysLeftInTrial.set(-1),e.isFlagSet(c.loginFlags,t.LoginFlags.TrialOver)&&this.notifyTrialOver()):c.premiumStatus===PremiumStatus.Active?(e.toasts.clearMessage(MessageID.TrialOver),e.settings.get(Settings.notifiedTrialOver)&&e.settings.set(Settings.notifiedTrialOver,!1)):e.isFlagSet(c.loginFlags,t.LoginFlags.NewUser)&&h.getSignupUserData(function(t){e.reportSignup(t.email,t)}.bind(this))}catch(t){e.reportError(t)}else try{if(n.response){var c=JSON.parse(n.response);c.code===PrivateAPIErrorCodes.NoSignupFound?(o=!0,h.getSignupUserData(function(t){e.reportSignup(t.email,t,function(e){e?this.checkRemotePremiumStatus():this._reportRemoteStatusFailure()}.bind(this))}.bind(this))):this._reportRemoteStatusFailure()}else this._reportRemoteStatusFailure()}catch(t){this._reportRemoteStatusFailure(),e.reportError(t)}s&&!o&&e.toasts.pushMessage(MessageID.InviteFailure)}.bind(this)})}.bind(this))},setLastSignupError:function(e){this._lastSignupError=e},_reportRemoteStatusFailure:function(){e.sendEvent("Billing","RemoteStatusFailure")},_updateTrialDaysLeft:function(t,i,n){var r=i-Math.ceil((Date.now()-t)/864e5);try{e.PAssert(5487,r<=320,"Sanity check on trial length",r)}catch(t){e.reportError(t)}this._trialStart=t,this._trialDuration=i,this._trialExtended=n,this.daysLeftInTrial.set(r),this._premiumStatus.get()===PremiumStatus.Trial&&r<0?(this.setPremiumStatus(PremiumStatus.TrialOver),this.notifyTrialOver()):this._premiumStatus.get()===PremiumStatus.Trial&&r<5&&this.notifyTrialEndSoon()},getBillingIdentifier:function(){if(!this._billingIdentifier){var t;t=h.isCurrentlyAuthorized("me")?h.getDefaultEmail():e.getActiveUser(),t&&(this._billingIdentifier=t)}return this._billingIdentifier},onBillingIdentifierAvailable:function(e){this._billingIdentifier?setTimeout(e,0):h.onUserAuthorized("me",e)},onConnected:function(e){return h.onConnected(e)},hasPremium:function(){return this._premiumStatus.get()===PremiumStatus.Active||this._premiumStatus.get()===PremiumStatus.PastDue},isTrialState:function(){return this._premiumStatus.get()===PremiumStatus.Trial||this._premiumStatus.get()===PremiumStatus.TrialOver},isCanceledState:function(){return this._premiumStatus.get()===PremiumStatus.CanceledUser||this._premiumStatus.get()===PremiumStatus.CanceledPastDue},canceledUserHasPremiumAccess:function(){return this.isCanceledState()&&this.getPremiumEndDate().getTime()>Date.now()},isInFreeMonthAndPremium:function(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts>=100},hasSubscription:function(){return!this._premiumCode},setBillingData:function(i){try{e.PAssert(5488,i,"Must have a valid data bundle")}catch(t){e.reportError(t)}this._earlyAdopter=i.earlyAdopter,this._loginFlags=i.loginFlags||t.LoginFlags.None,this._inviteCode=i.inviteCode,this._referredBy=i.referredBy,this._joinDate=i.joinDate?new Date(parseInt(i.joinDate)):new Date,this._premiumStartDate=i.premiumStartDate?new Date(parseInt(i.premiumStartDate)):new Date,this._premiumEndDate=i.premiumEndDate?new Date(parseInt(i.premiumEndDate)):new Date,this._premiumCode=i.premiumCode,this._premiumCodeExpired=i.premiumCodeExpired||!1,this._nextBillingDate=i.nextBillingDate?new Date(parseInt(i.nextBillingDate)):new Date,this._referralCount.set(i.totalReferralCount||0),this._usedReferrals=i.totalReferralsUsed||0,this._nextMonthReferrals=i.nextMonthReferrals||0,this._trialStart=i.trialStart?new Date(parseInt(i.trialStart)):new Date,this._trialDuration=i.trialDuration||0,this._trialExtended=i.trialExtended||!1,this._nonReferralDiscounts=i.nonReferralDiscounts||0,e.settings.set(Settings.isUnsubscribed,!!i.isUnsubscribed),e.settings.set(Settings.monthlyInvoice,!!i.monthlyInvoice),e.settings.set(Settings.invoiceEmail,i.invoiceEmail),e.settings.set(Settings.invoiceCompany,i.invoiceCompany),e.settings.set(Settings.invoiceAddress,i.invoiceAddress),this.setPremiumStatus(i.premiumStatus),this.updatePremiumBlocks(),this._hasValidBillingData.set(!0)},setPremiumStatus:function(i){try{e.PAssert(5489,e.isNumber(i),"Status must be a valid number",i)}catch(t){e.reportError(t)}try{e.PAssert(5490,i>0&&i<8,"Should be a valid status identifier",i)}catch(t){e.reportError(t)}i!==this._premiumStatus.get()&&(this._premiumStatus.set(i),e.settings.set(Settings.premiumStatus,i),e.fireCustomEvent("premiumStatusChanged"),e.setDimension(t.Analytics.Dimensions.PremiumStatus,i))},hasValidBillingData:function(){return this._hasValidBillingData.get()},getPremiumStatus:function(){return this._premiumStatus.get()},getInviteCode:function(){return this._inviteCode},getJoinDate:function(){return this._joinDate||new Date},getPremiumStartDate:function(){return this._premiumStartDate||new Date},getPremiumEndDate:function(){return this._premiumEndDate||new Date},hasTrialExtended:function(){return this._trialExtended||!1},isEligibleForTrialExtension:function(){return!1},getNextBillingDate:function(){return this._nextBillingDate||new Date},getActiveReferrals:function(){return this._nextMonthReferrals},getTotalReferrals:function(){return this._referralCount.get()},getUnusedReferrals:function(){return this._referralCount.get()-this._usedReferrals-this._nextMonthReferrals},getPastReferrals:function(){return this._usedReferrals},hasEarlyAccess:function(){return this._referralCount.get()>=5||this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()},onTapCancelSubscription:function(t,i){e.sendEvent("Billing","SubCancelTapped");var n=function(){i&&e.isFunction(i)&&i()}.bind(this);return e.menus.confirm("Are you sure you want to cancel your subscription?",function(t){t?(e.sendEvent("Billing","SubCancelYES"),e.XHR_PrivateAPI({type:"POST",path:"/billing/cancel",data:{email:this.getBillingIdentifier()},requireAuth:!0,cb:function(t){var i;if(200===t.status&&t.response){var r;try{r=JSON.parse(t.response)}catch(t){e.reportError(t)}if(r){var a=r.data,s=new Date(a.premiumEndDate).getTime();this._premiumEndDate=new Date(s),e.settings.set(Settings.premiumEndDate,s),this.setPremiumStatus(PremiumStatus.CanceledUser),i="Your premium subscription has been canceled. Please contact support@moo.do if you need assistance."}else i="There was a server error, please try again in a few minutes or contact support@moo.do."}else i="There was a server error, please try again in a few minutes or contact support@moo.do.";e.menus.alert({text:i,actionText:"OKAY"}),n()}.bind(this)})):(n(),e.sendEvent("Billing","SubCancelNO"))}.bind(this)),!0},getCustomPurchaseURL:function(){var t=e.vmMain.getUserID(),i=e.vmMain.getUserEmail(),n=h.getDefaultAccessToken();return window.location.protocol+"//"+window.location.host+"/purchase/#gid="+encodeURIComponent(t)+"&email="+encodeURIComponent(i)+"&token="+encodeURIComponent(n)},_openPaymentWindow:function(t){if(n.requireCustomPurchase)e.openUrl(this.getCustomPurchaseURL());else if(n.requireCustomPaypal){var i="Credit Card";e.menus.options("If you are using PayPal, a new window will be opened to complete your purchase.",["PayPal",i],function(n){(n===i||"PayPal"===n)&&(n===i?e.menus.openModalNew(Modals.Billing,{isUpdate:t}):"PayPal"===n&&e.openUrl(this.getCustomPurchaseURL()))}.bind(this))}else e.menus.openModalNew(Modals.Billing,{isUpdate:t})},onTapUpdatePaymentMethod:function(e,t){this._openPaymentWindow(!1)},onTapViewInvoices:function(t,i){e.XHR_PrivateAPI({type:"GET",path:"/billing/listTransactions",requireAuth:!0,cb:function(t){var i;try{i=JSON.parse(t.response)}catch(t){e.reportError(t)}200===t.status&&i?e.menus.openModalNew(Modals.Invoices,i.data):e.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do.",callback:e.emptyFn})}.bind(this)})},onTapDeleteAccount:function(t,i){try{e.PAssert(5499,i&&e.isFunction(i),"Delete account cannot be called without a callback")}catch(t){e.reportError(t)}e.sendEvent("Billing","DeleteAccountTapped");var n=function(){i&&e.isFunction(i)&&i()}.bind(this),r=function(t){t?(e.sendEvent("Billing","DeleteAccountYES"),a.deleteAccount(function(t,i){t||i===a.DeleteErrorCode.RootFolder?e.vmMain.docManager.deleteAllDocs(function(t){t?e.XHR_PrivateAPI({type:"POST",path:"/tracking/delete",data:{email:this.getBillingIdentifier()},requireAuth:!0,cb:function(t){200===t.status?e.menus.alert({text:"Your account has been successfully deleted.",actionText:"OKAY",callback:function(){e.vmSetup.logout()}.bind(this)}):e.menus.alert({text:"There was an error removing your email address from our server. Please contact support@moo.do for further assistance with code 3.",actionText:"OKAY"}),n()}.bind(this)}):(e.menus.alert({text:"There was an error deleting your Moo.do documents. Please contact support@moo.do for further assistance with code 2.",actionText:"OKAY"}),n())}.bind(this)):(e.menus.alert({text:"There was an error deleting your shared account data. Please contact support@moo.do for further assistance with code 1.",actionText:"OKAY"}),n())}.bind(this))):(n(),e.sendEvent("Billing","DeleteAccountNO"))}.bind(this);return e.menus.openModalNew(Modals.DeleteAccount,{callback:r}),!0},shouldShowAlready:function(){
return this.getPastReferrals()>0},shouldShowNext:function(){return this.isInFreeMonthAndPremium()||this.getActiveReferrals()>2},alreadyText:function(){var e="Already saved: ",t=this.getPastReferrals()/5;return t<1?e+100*t+"%":e+t+" months"},thisMonthSubtitle:function(){if(this.isInFreeMonthAndPremium())return"Next month is free!";return"Next month: "+this.getActiveReferrals()/5*100+"% saved"},thisMonthSubtext:function(){var e=5-this.getActiveReferrals();return this.isInFreeMonthAndPremium()?"Be sure to thank to your friend for inviting you.":0===e?"You get next month for free!":"Invite "+e+" more friend"+(e>1?"s":"")+" to save 100%"},nextMonthSubtitle:function(){var e="Following month",t=this.getUnusedReferrals();this.isInFreeMonthAndPremium()&&(t+=this.getActiveReferrals()),t>5&&(e+="s");var i=t/5;return 0===i?e:e+": "+100*i+"%"},nextMonthSubtext:function(){var e=0;return e=5===this.getActiveReferrals()?this.isInFreeMonthAndPremium()?-this.getUnusedReferrals():5-this.getUnusedReferrals():this.isInFreeMonthAndPremium()?5-this.getActiveReferrals():5-this.getActiveReferrals()+5,e<=0?"You get the following month for free too!":"Invite "+e+(this.isInFreeMonthAndPremium()?"":" more")+" friend"+(e>1?"s":"")+" to save 100%"},earlySubtitle:function(){var e=5-this.getTotalReferrals();return e>0?"Invite "+e+" "+(e<5?"more ":"")+"friend"+(e>1?"s":"")+" to become a Community Member":""},earlySubtext:function(){return 1==5-this.getTotalReferrals()?"You're almost there! Just one more!":""},updatePremiumBlocks:function(){if(this.shouldShowAlready()){this.alreadyBlocks=[];for(var e=this.getPastReferrals(),t=0;t<Math.max(e,5);t++)this.alreadyBlocks.push({value:t<e})}var i=this.getActiveReferrals();this.isInFreeMonthAndPremium()&&(i=5),this.thisBlocks=[];for(var t=0;t<5;t++)this.thisBlocks.push({value:t<i});if(this.shouldShowNext()){this.nextBlocks=[];var n=this.getUnusedReferrals();this.isInFreeMonthAndPremium()&&(n+=this.getActiveReferrals());for(var t=0;t<5;t++)this.nextBlocks.push({value:t<n})}this.communityBlocks=[];for(var r=this.getTotalReferrals(),t=0;t<5;t++)this.communityBlocks.push({value:t<r});this.triggerBlocksUpdated.notify()},getInviteUrl:function(){return"https://www.moo.do/"},getSelectText:function(){return"Select and press "+n.cmdChar+" + C to copy to clipboard"},wasInvited:function(){return!!this._referredBy},submitInviteCode:function(t,i){if(t&&t.length>2)return e.sendEvent("Billing","EnterRefCode"),e.XHR_PrivateAPI({type:"POST",path:"/sharing/setReferral",data:{email:this.getBillingIdentifier(),refCode:t},requireAuth:!0,autoRetry:!0,cb:function(t){if(t.response){try{var n=JSON.parse(t.response)}catch(t){e.reportError(t)}if(200===t.status&&n){var r=n.data;this._referredBy=r.referredBy,this._nonReferralDiscounts=r.nonReferralDiscounts||0,this._premiumStatus.set(r.premiumStatus);var a=new Date(r.trialStart).getTime();this._updateTrialDaysLeft(a,r.trialDuration,r.trialExtended),this.updatePremiumBlocks(),this.inviteCodeError.set(""),e.sendEvent("Billing","EnterRefCodeSuccess")}else{if(n)switch(n.code){case PrivateAPIErrorCodes.AlreadyReferred:this.inviteCodeError.set(""),this.checkRemotePremiumStatus();break;case PrivateAPIErrorCodes.InvalidReferralCode:this.inviteCodeError.set("Referral code not found");break;default:this.inviteCodeError.set("Unable to use referral code")}else this.inviteCodeError.set("Unable to contact server");e.sendEvent("Billing","EnterRefCodeFailure")}}else this.inviteCodeError.set("Unable to contact server"),e.sendEvent("Billing","EnterRefCodeFailure");i&&i()}.bind(this)}),!0;this.inviteCodeError.set("Please enter a valid code")},sendInviteEmail:function(t,i){if(t&&t.length>0){for(var n=[],r=/.+@.+\..+/i,a=[],s=0;s<t.length;++s){r.lastIndex=0;var o=t[s];o&&(o=o.trim(),null===r.exec(o)?n.push(o):a.push(o))}if(0===n.length)return e.sendEvent("Billing","SendReferralEmail",a.length),e.XHR_PrivateAPI({type:"POST",path:"/sharing/sendReferral",data:{fromUser:this.getBillingIdentifier(),toEmailList:a},requireAuth:!0,autoRetry:!1,cb:function(t){if(i&&i(),200===t.status&&t.response){var n;try{n=JSON.parse(t.response).data}catch(t){e.reportError(t)}if(n&&0!==n.length){for(var r,a=[],s=0;s<n.length;++s)a.push(n[s].email),r||(r=n[s].reason);a.join(",");"exists"===r?this.inviteEmailError.set("One or more of the users is already a Moo.do user."):this.inviteEmailError.set("One or more of your emails could not be sent.")}else this.inviteEmailSuccess.set("Invite emails sent!"),this.inviteEmailError.set(""),setTimeout(function(){this.inviteEmailSuccess.set("")}.bind(this),4e3)}else this.inviteEmailError.set("Sorry! There was an error sending emails, please try again later.")}.bind(this)}),!0;this.inviteEmailError.set("Please enter a valid email: "+n[0])}},joinDateText:function(){return this.getJoinDate().toString(r.getFormat(DFormat.LongStrDate))},premiumStartDateText:function(){return this.getPremiumStartDate().toString(r.getFormat(DFormat.LongStrDate))},premiumEndDateText:function(){return this.getPremiumEndDate().toString(r.getFormat(DFormat.LongStrDate))},nextBillingDateText:function(){return this.getNextBillingDate().toString(r.getFormat(DFormat.LongStrDate))},shareTwitter:function(){var t="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(t,550,420),e.sendEvent("Billing","ShareTwitter")},shareFacebook:function(){var t="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(t,600,303),e.sendEvent("Billing","ShareFacebook")},shareGoogle:function(){var t="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(t,500,650),e.sendEvent("Billing","ShareGoogle")},showPopup:function(e,t,i){var n=t,r=i,a=window.screen.height,s=window.screen.width,o=Math.round(s/2-n/2),c=Math.round(a/2-r/2),l="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+n+",height="+r+",left="+o+",top="+c;window.open(e,null,l)},onTapSignupMonth:function(){this._pricingSelected=this.getMonthlyPricing(),this._openPaymentWindow(!1),e.sendEvent("Billing","OpenSignupModal")},onTapSignupYear:function(){this._pricingSelected=this.getYearlyPricing(),this._openPaymentWindow(!1),e.sendEvent("Billing","OpenSignupModal")},onTapCodeSignup:function(){e.menus.openModalNew(Modals.EnterCode,{}),e.sendEvent("Blling","OpenEnterCodeModal")},redeemCode:function(i){e.isString(i)&&i.length>10?e.XHR_PrivateAPI({type:"POST",path:"/billing/useCode",requireAuth:!0,autoRetry:!0,data:{code:i},cb:function(n){if(n.status===t.HTTPStatusCode.Success)try{var r=JSON.parse(n.response).data;this._premiumStartDate=new Date(e.parseInt(r.premiumStartDate)),this._premiumEndDate=new Date(e.parseInt(r.premiumEndDate)),this._nextBillingDate=new Date(e.parseInt(r.nextBillingDate)),this._premiumCode=i,this._premiumCodeExpired=!1,this.setPremiumStatus(r.premiumStatus),e.toasts.pushMessage({text:"Success! Thank you for going premium!",timeout:8e3})}catch(t){e.reportError(t)}else n.status===t.HTTPStatusCode.BadRequest?e.toasts.pushMessage({text:"The code that you entered was not valid or has already been used.",timeout:8e3}):e.toasts.pushMessage({text:"There was an error processing your request. Please contact support@moo.do for help.",timeout:8e3})}.bind(this)}):e.toasts.pushMessage({text:"The code that you entered was not valid.",timeout:8e3})},getMonthlyPricing:function(){return this._earlyAdopter?t.Pricing.EarlyMonthly:t.Pricing.RegMonthly},getYearlyPricing:function(){return this._earlyAdopter?t.Pricing.EarlyYearly:t.Pricing.RegYearly},getMonthlyPrice:function(){return g[this.getMonthlyPricing()]},getYearlyPrice:function(){return g[this.getYearlyPricing()]},getPlanPrice:function(e){return g[e]},notifyTrialOver:function(){if(!e.settings.get(Settings.notifiedTrialOver)){if(!e.toasts)return void setTimeout(this.notifyTrialOver.bind(this),0);e.toasts.pushMessage(MessageID.TrialOver),e.settings.set(Settings.notifiedTrialOver,!0)}},notifyTrialEndSoon:function(){if(!e.settings.get(Settings.notifiedTrialEndSoon)){if(!e.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);e.toasts.pushMessage(MessageID.TrialEndSoon),e.settings.set(Settings.notifiedTrialEndSoon,!0)}},isTrialOver:function(){var e=!1;return this._premiumStatus.get()===PremiumStatus.TrialOver?e=!0:this._premiumStatus.get()!==PremiumStatus.CanceledUser&&this._premiumStatus.get()!==PremiumStatus.CanceledPastDue||this.canceledUserHasPremiumAccess()||(e=!0),e},startTrial:function(){try{e.PAssert(5500,!this.isTrialOver(),"Should never try to start a trial once it is over")}catch(t){e.reportError(t)}e.XHR_PrivateAPI({type:"POST",path:"/billing/startTrial",requireAuth:!0,autoRetry:!0,cb:function(i){if(i.status===t.HTTPStatusCode.Success){this._premiumStatus.set(PremiumStatus.Trial);try{var n=JSON.parse(i.response).data,r=new Date(n.trialStart).getTime();e.settings.set(Settings.trialStart,r),e.settings.set(Settings.trialDuration,n.trialDuration),e.settings.set(Settings.trialExtended,n.trialExtended),this._updateTrialDaysLeft(r,n.trialDuration,n.trialExtended)}catch(t){e.reportError(t)}}else if(i.status===t.HTTPStatusCode.BadRequest)try{var n=JSON.parse(i.response);n.code===PrivateAPIErrorCodes.TrialOver&&(e.toasts.pushMessage({text:"Your free trial of Premium has ended. Please contact support@moo.do to extend.",actionText:"OKAY"}),this._premiumStatus.set(PremiumStatus.TrialOver))}catch(t){e.reportError(t)}else{try{e.PAssert(5501,!1,"Failed to start trial for user")}catch(t){e.reportError(t)}e.toasts.pushMessage({text:"There was an error starting your trial. Please contact support@moo.do.",action:MessageAction.Contact})}}.bind(this)})},extendTrial:function(){e.XHR_PrivateAPI({type:"POST",path:"/billing/extendTrial",requireAuth:!0,autoRetry:!0,cb:function(i){if(i.status===t.HTTPStatusCode.Success){this._premiumStatus.set(PremiumStatus.Trial);try{var n=JSON.parse(i.response).data,r=new Date(n.trialStart).getTime();e.settings.set(Settings.trialStart,r),e.settings.set(Settings.trialDuration,n.trialDuration),e.settings.set(Settings.trialExtended,n.trialExtended),this._updateTrialDaysLeft(r,n.trialDuration,n.trialExtended)}catch(t){e.reportError(t)}}else{try{e.PAssert(5502,!1,"Failed to extend trial for user")}catch(t){e.reportError(t)}e.toasts.pushMessage({text:"There was an error restarting your trial. Please contact support@moo.do.",action:MessageAction.Contact})}}.bind(this)})},hasPremiumFeatures:function(){return this.hasPremium()||this._premiumStatus.get()===PremiumStatus.Trial||this.canceledUserHasPremiumAccess()},getBillingPeriod:function(){return this._pricingSelected}},f}),"undefined"==typeof DETAILED_STATS&&(DETAILED_STATS=!0),"http:"===window.location.protocol&&(window.location.hash.indexOf("state=")<0||window.location.hash.indexOf("app")<0&&window.location.hash.indexOf("appv")<0)&&(window.location=window.location.href.replace(/^http:/,"https:")),Date.Config={DEBUG:!0,DisableCache:!0},Error.stackTraceLimit=1/0;try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.__SESSION_BEGIN=Date.now();var empty=function(){};window.appEvents=window.appEvents||{kbsize:empty,enterBackground:empty,enterForeground:empty,statusBarTap:empty,closeKeyboard:empty,undo:empty,redo:empty,notifyOAuth:empty,features:empty,reportLowMemory:empty,pokeBackground:empty},window.console||(window.console={log:function(){},error:function(){}});var bindLog=!1;window.log=bindLog?function(){}:window.console.log.bind(window.console),window.__log=bindLog?function(){}:window.console.log.bind(window.console),window.__warn=bindLog?function(){}:window.console.warn.bind(window.console),window.__error=bindLog?function(){}:window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){}),window.LogLevels={Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,ScrMgr:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},window.LogLevel=LogLevels.Error|LogLevels.Warning,window.ShouldLog=function(e){return window.DEBUG===e},window.inspectLocal=function(e){if(!e)return void log("Must specify either an item ID or item object to inspect");var t=e;return"string"==typeof e&&(t=window.getModel(e)),log("---- Inspecting Item:",t.id,"----"),log("  RawText:",t.getRawText()),log("  ParsedText:",t.getParsedText()),log("  Els:",t.els),log('  Parent: "'+t.parent().id+'"'),log("  Date:",t.date()),log("  AllDayDate:",t.allDayDate()),log("--------------------------------------------"),t}}catch(e){console.log("Error in main header",e),window.__ERRORINMAINHEADER=e}if(function(){var e;e={paths:{ko:"lib/knockout-3.2.0",date:"lib/date",FileSaver:"lib/FileSaver",IndexedDBShim:"lib/IndexedDBShim",database:"lib/db",react:"lib/react-with-addons.min","react-dom":"lib/react-dom.min",IScroll:"lib/iscroll-probe",papaparse:"lib/papaparse.min"},shim:{IScroll:{exports:"IScroll"}},waitSeconds:0},require.config(e)}(),window.gapiKey="AIzaSyB9HEdSJ-nhLJG_ssSSqhI2DX74GSiKSao",window.gapiCalled=!1,window.gapiLoadError=!1,window.gapiTimeout=!1,window.gapiClientCalled=!1,window.gapiClientLoadError=!1,window.gapiClientTimeout=!1,window.pendingGoogleClientLoad=!1,window.location.hash.indexOf("demo=true")<0){var scr=document.createElement("script");scr.src="https://apis.google.com/js/api.js?onload=GoogleClientAPILoaded",scr.async=1,scr.id="gapiScript",scr.onloadDone=!1;var gapiScriptTimeout=setTimeout(function(){require(["globals"],function(e){window.gapiCalled||(window.gapiClientTimeout=!0,e.blockedMessage||(e.blockedMessage="An extension has blocked apis.google.com from loading."))})},2e4);scr.onerror=function(e){window.gapiClientLoadError=!0,clearTimeout(gapiScriptTimeout),require(["globals"],function(t){t.reportGapiScriptError(scr,e)})},scr.onload=function(e){scr.onloadDone=!0,clearTimeout(gapiScriptTimeout),require(["globals"],function(t){t.reportGapiScriptLoad(scr,e)})},scr.onreadystatechange=function(e){"loaded"!==scr.readyState||scr.onloadDone||(scr.onloadDone=!0,require(["globals"],function(t){t.reportGapiScriptLoad(scr,e)}))},document.getElementsByTagName("head")[0].appendChild(scr)}requirejs(["data","globals","util","SettingsManager","gdata","goog","platform","edit","VMMain","VMSetup","VMDebug","VMTimeline","TemplateCache","VMAutocomplete","VMMenus","VMTooltip","AppCache","NativeBridge","copypaste","International","RepeatDate","BillingManager","Dispatcher","Multiselect","Toasts","Workspaces"],function(e,t,i,n,r,a,s,o,c,l,d,h,u,p,m,f,g,v,y,b,S,E,C,P,T,D){t.checkpoint(Checkpoint.RequireLoaded),window.__ERRORINMAINHEADER&&t.reportError(window.__ERRORINMAINHEADER),t.nativeBridge=new v,t.billingManager=new E,t.runOnLoad(function(){function n(){s.updateOrientation(),s.mobile&&(t.keyboardToolbar&&t.keyboardToolbar.isVisible.get()&&t.keyboardToolbar.updatePosition(!0),document.body.scrollTop=0,t.keyboardToolbar&&t.keyboardToolbar.hideTopBarIfLandscape())}function r(e){t.animFrameOnce("windowResize",I)}function o(){A||(A=!0,t.checkpoint(Checkpoint.InitializeMain),t.openMainPage(),t.registerEvent("ItemCreated","ItemAction","Create"),t.registerEvent("ItemCompleted","ItemAction","Complete"),e.initData(u),u())}function u(){try{if(w||!A||!e.localDataLoaded())return;w=!0,t.checkpoint(Checkpoint.OnInitializedData),a.loadClientDefaultFile(),t.isDemoMode()||(t.vmMain.setupDateRollover(),window.addEventListener("focus",t.vmMain.ensureDateRollover)),t.vmMain.loadData(),ShouldLog(LogLevels.Timing)&&log("Data done loading: ",log.now()),new p}catch(e){t.reportError(e)}}try{try{t.PAssert(5504,-1===navigator.userAgent.indexOf("Electron")||s.appPlatform===AppPlatform.Electron,"Electron app missing app platform set")}catch(e){t.reportError(e)}t.checkpoint(Checkpoint.PageLoad);try{t.PAssert(5505,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(e){t.reportError(e)}if("loading"===document.readyState){var v="ERROR: MainJS running before document load! "+document.readyState;ShouldLog(LogLevels.Error)&&log(v),t.reportError(new Error(v))}for(var y in window.scriptErrors)t.fireCustomEvent("scriptLoadError",{src:y,id:window.scriptErrors[y],firstChance:!0});if(window.scriptErrors=window.scriptErrors||{},window.handleLoadError=function(e){try{window.scriptErrors[e.target.src]=e.target.id,t.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(e){t.reportError(e)}},window.oncontextmenu=function(e){t.isKeyboardInputElement(e.target)||e.preventDefault()},t.isDemoMode()||s.offline);else!function(e,t,i,n,r,a,s){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,a=t.createElement(i),s=t.getElementsByTagName(i)[0],a.async=1,a.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(a,s)}(window,document,"script",0,"ga"),ga("create","UA-37740918-2",{cookieDomain:"auto"}),ga("send","pageview");s.updateBodyClass();var b=function(e){document.documentElement.addEventListener(e,function(e){t.reportEvent(e)},!0)};b("keydown"),b("keyup"),b("keypress"),b("MSPointerDown"),b("MSPointerUp"),b("MSPointerHover"),b("MSPointerCancel"),b("mousedown"),b("mouseup"),b("touchstart"),b("touchend"),t.tooltip=new f,t.AppCache=new g;var S=s.blockClient();if(void 0!==S){t.errorPlatformInfo=S;var E,P=S.platform,T=!1;if(P?S.update?"iOS App"===P?E="Please update your iOS app to the latest version in the App Store.":"Android App"===P?E="Please update your Android app to the latest version in the Play Store.":"Firefox"===P?E='Please update your Firefox browser to use Moo.do. Moo.do requires at least Firefox 16. See <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">https://support.mozilla.org/en-US/kb/update-firefox-latest-version</a> for more information.':"Chrome"===P?E='Please update your Chrome browser to use Moo.do. Moo.do requires at least Chrome 26. See <a href="https://support.google.com/chrome/answer/95414">https://support.google.com/chrome/answer/95414</a> for more information.':"Native Android"===P?E="Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"===P?E='Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"===P?E=s.mobile?"Please update your "+s.OSName+" to use Moo.do. Moo.do requires at least iOS 6.":'Please update your Safari browser to use Moo.do. Moo.do requires at least Safari 6.1. See <a href="http://support.apple.com/kb/HT6103">http://support.apple.com/kb/HT6103</a> for more information.':(E="Please update your browser to use Moo.do. If you are unable to update your browser, please let us know. Thanks!",T=!0):(T=!0,E="Sorry, we don't support "+P+" yet. Please let us know that you're interested in using "+P+" and we will make it a higher priority. Thanks!"):S.version?E="Please update your app to the latest version of Moo.do. Thanks!":S.cacheUpdate&&(E="There was an issue while updating the app, "+s.actionVerb()+" to try again.",t.AppCache.update(),S.error&&setTimeout(function(){t.AppCache.runOnFinish(function(){i.insertURLParam("cacheError",!0,!0),t.reload(!0)},!0)},100)),s.app&&t.nativeBridge.sendToApp("localLoaded"),E){var D=function(){return t.requestNotification(navigator.userAgent)},M=function(){t.AppCache.runOnFinish(function(){t.reload(!0)},!0)};t.applyBindings({platformError:E,showSignup:T,onTapRefresh:M,onTapSubmit:D},"OSError")}return t.removeDOM("outerWrapper"),t.removeDOM("setupWrapper"),void t.removeDOM("templates")}if(i.removeURLParam("cacheError",!0),t.removeDOM("OSError"),t.localDocChangeRequested=!1,!t.isDemoMode()){var _=!1;t.settings.registerForChangeNotification(Settings.gdocId,void 0,function(e,i){!t.localDocChangeRequested&&e&&e!==i&&(_||(_=!0,t.menus.alert({text:"The document was changed in another tab. Please close this tab or reload.",actionText:"RELOAD",callback:t.reload})))})}new m,t.vmDebug=new d,t.vmSetup=new l,C.listen("remoteDataLoaded",function(){function e(){try{t.PAssert(5507,t.vmMain&&t.vmMain.vmPicker,"VMMain must be initialized before loading another doc")}catch(e){t.reportError(e)}t.vmMain.vmPicker.requestOpenDocument(n)}var n=i.getURLParam("file"),r=i.getURLParam("state");if(n||r){if(!n)try{var s=JSON.parse(r);"open"===s.action&&s.ids&&s.ids.length>=0&&(n=s.ids[0])}catch(e){t.reportError(e)}var o=a.getDocId();if(n&&o!==n){var c,l,d=t.decodeURLObject(i.getURLParam("sinfo")),h=!1;if(d){var u=t.getUserIdentifier();d.fromUser&&(c=d.fromUser,d.fromUser===u&&(h=!0)),d.toUser&&(l=d.toUser,d.toUser===u&&(h=!0))}else h=!0;h?t.menus.alert({text:"You have requested to view another document.",actionText:"OPEN IT",callback:e}):l?t.menus.alert({text:"You have requested to view another document meant for "+l+".",actionText:"OPEN IT",callback:e}):c&&t.menus.alert({text:"You have requested to view another document shared by "+c+".",actionText:"OPEN IT",callback:e})}}});var I=function(e){var i=s.getActualWindowWidth(),n=s.getActualWindowHeight();try{t.PAssert(5508,0!==i&&!isNaN(i)&&0!==n&&!isNaN(n),"Window size is 0",i,n)}catch(e){t.reportError(e)}var r=s.windowWidth(!0),a=s.windowHeight(!0);if(s.ipad&&!s.app&&!0!==e&&!1!==e&&setTimeout(I,0,!0),(i!==r||n!==a)&&(s.setWindowSize(i,n),s.onResize.notify(),t.documentHeight=n,t.isMainPageOpen)){var o=n-a,c=(s.android||s.mobileie)&&n>a&&(!s.app||o<=s.getKBSize())&&t.vmMain&&t.vmMain.isLoaded;c&&t.blurActiveElement(),t.autocomplete&&c&&t.autocomplete.hide(),r!==i&&e&&s.mobile&&t.focusedPane&&(s.mobile&&t.focusedPane&&t.focusedPane.updatePositionMobile(),t.isKeyboardOpen&&t.focusedPane.addPadding()),s.mobile||(t.fireCustomEvent("windowResize"),C.fireEvent("windowResize",[]))}};I(!1),n(),ShouldLog(LogLevels.Timing)&&log("Running main.js: ",log.now()),window.onblur=function(){t.hasFocus=!1},window.onfocus=function(){t.hasFocus=!0,a.onFocusHandler()},new c,t.timeline=new h,s.mobile&&!s.android?window.addEventListener("resize",r):window.addEventListener("resize",I),window.addEventListener("orientationchange",n),window.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),window.addEventListener("dragover",function(e){return e.preventDefault(),!1});var A=!1,w=!1;t.vmSetup.loginState.subscribe(function(e){e==LoginState.LOGGED_IN?(o(),t.openMainPage()):e==LoginState.LOGGED_OUT&&(t.isSetupPageOpen||(t.isSetupPageOpen=!0,i.hasURLParam("login","true")||t.openSetupPage(),t.vmSetup.openLogin())),s.offline||!navigator.onLine?t.vmMain.setGDriveStatus(DriveStatus.Offline):t.vmMain.setGDriveStatus(DriveStatus.Connecting)}),t.vmSetup.init(),t.isDemoMode()&&o();t.getLoginState()!=LoginState.LOGGED_OUT?e.initData(o):!t.isDemoMode()&&s.app&&t.nativeBridge.sendToApp("loaded")}catch(e){t.handleCriticalError(),t.reportError(e,"Critical Error")}})}),define("main",function(){});
//# sourceMappingURL=main-min.js.map